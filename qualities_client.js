(()=>{var IP=Object.defineProperty;var Xn=(t,e)=>{for(var n in e)IP(t,n,{get:e[n],enumerable:!0})};function ue(){}var wr=t=>t;function Nl(t,e){for(let n in e)t[n]=e[n];return t}function lh(t){return t()}function ju(){return Object.create(null)}function at(t){t.forEach(lh)}function To(t){return typeof t=="function"}function Ue(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}var Nu;function lt(t,e){return t===e?!0:(Nu||(Nu=document.createElement("a")),Nu.href=e,t===Nu.href)}function Fn(t,e){return t!=t?e==e:t!==e}function B2(t){return Object.keys(t).length===0}function ls(t,...e){if(t==null){for(let i of e)i(void 0);return ue}let n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function re(t,e,n){t.$$.on_destroy.push(ls(e,n))}function jl(t,e,n,i){if(t){let s=U2(t,e,n,i);return t[0](s)}}function U2(t,e,n,i){return t[1]&&i?Nl(n.ctx.slice(),t[1](i(e))):n.ctx}function Wl(t,e,n,i){if(t[2]&&i){let s=t[2](i(n));if(e.dirty===void 0)return s;if(typeof s=="object"){let o=[],r=Math.max(e.dirty.length,s.length);for(let l=0;l<r;l+=1)o[l]=e.dirty[l]|s[l];return o}return e.dirty|s}return e.dirty}function Gl(t,e,n,i,s,o){if(s){let r=U2(e,n,i,o);t.p(r,s)}}function Hl(t){if(t.ctx.length>32){let e=[],n=t.ctx.length/32;for(let i=0;i<n;i++)e[i]=-1;return e}return-1}function Eo(t){return t??""}function nt(t,e,n){return t.set(n),e}var O2=typeof window<"u",Wu=O2?()=>window.performance.now():()=>Date.now(),Mc=O2?t=>requestAnimationFrame(t):ue;var Yl=new Set;function $2(t){Yl.forEach(e=>{e.c(t)||(Yl.delete(e),e.f())}),Yl.size!==0&&Mc($2)}function Gu(t){let e;return Yl.size===0&&Mc($2),{promise:new Promise(n=>{Yl.add(e={c:t,f:n})}),abort(){Yl.delete(e)}}}var Fc=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var Hu=class t{_listeners="WeakMap"in Fc?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,n){return this._listeners.set(e,n),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(e=>{for(let n of e)t.entries.set(n.target,n),this._listeners.get(n.target)?.(n)}))}};Hu.entries="WeakMap"in Fc?new WeakMap:void 0;var N2=!1;function j2(){N2=!0}function W2(){N2=!1}function d(t,e){t.appendChild(e)}function ah(t){if(!t)return document;let e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function G2(t){let e=h("style");return e.textContent="/* empty */",LP(ah(t),e),e.sheet}function LP(t,e){return d(t.head||t,e),e.sheet}function w(t,e,n){t.insertBefore(e,n||null)}function x(t){t.parentNode&&t.parentNode.removeChild(t)}function it(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function qP(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function T(t){return document.createTextNode(t)}function Ne(){return T(" ")}function ve(){return T("")}function Z(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function H2(t){return function(e){e.target===this&&t.call(this,e)}}function p(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Wt(t){return t===""?null:+t}function Y2(t){return Array.from(t.childNodes)}function G(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ge(t,e){t.value=e??""}function ze(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,i?"important":"")}function wn(t,e,n){for(let i=0;i<t.options.length;i+=1){let s=t.options[i];if(s.__value===e){s.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function ki(t){let e=t.querySelector(":checked");return e&&e.__value}function Do(t,e,n){t.classList.toggle(e,!!n)}function Cc(t,e,{bubbles:n=!1,cancelable:i=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:i})}var Yu=class{is_svg=!1;e=void 0;n=void 0;t=void 0;a=void 0;constructor(e=!1){this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,n,i=null){this.e||(this.is_svg?this.e=qP(n.nodeName):this.e=h(n.nodeType===11?"TEMPLATE":n.nodeName),this.t=n.tagName!=="TEMPLATE"?n:n.content,this.c(e)),this.i(i)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)w(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(x)}};function X2(t){let e={};return t.childNodes.forEach(n=>{e[n.slot||"default"]=!0}),e}var Xu=new Map,Qu=0;function RP(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function zP(t,e){let n={stylesheet:G2(e),rules:{}};return Xu.set(t,n),n}function Sc(t,e,n,i,s,o,r,l=0){let a=16.666/i,c=`{
`;for(let b=0;b<=1;b+=a){let y=e+(n-e)*o(b);c+=b*100+`%{${r(y,1-y)}}
`}let f=c+`100% {${r(n,1-n)}}
}`,u=`__svelte_${RP(f)}_${l}`,m=ah(t),{stylesheet:g,rules:v}=Xu.get(m)||zP(m,t);v[u]||(v[u]=!0,g.insertRule(`@keyframes ${u} ${f}`,g.cssRules.length));let _=t.style.animation||"";return t.style.animation=`${_?`${_}, `:""}${u} ${i}ms linear ${s}ms 1 both`,Qu+=1,u}function Zu(t,e){let n=(t.style.animation||"").split(", "),i=n.filter(e?o=>o.indexOf(e)<0:o=>o.indexOf("__svelte")===-1),s=n.length-i.length;s&&(t.style.animation=i.join(", "),Qu-=s,Qu||BP())}function BP(){Mc(()=>{Qu||(Xu.forEach(t=>{let{ownerNode:e}=t.stylesheet;e&&x(e)}),Xu.clear())})}var Io;function no(t){Io=t}function Xl(){if(!Io)throw new Error("Function called outside component initialization");return Io}function ch(t){Xl().$$.before_update.push(t)}function Pn(t){Xl().$$.on_mount.push(t)}function Ac(t){Xl().$$.after_update.push(t)}function Tn(t){Xl().$$.on_destroy.push(t)}function Mr(){let t=Xl();return(e,n,{cancelable:i=!1}={})=>{let s=t.$$.callbacks[e];if(s){let o=Cc(e,n,{cancelable:i});return s.slice().forEach(r=>{r.call(t,o)}),!o.defaultPrevented}return!0}}function io(t,e){let n=t.$$.callbacks[e.type];n&&n.slice().forEach(i=>i.call(this,e))}var Fr=[];var $t=[],Zl=[],uh=[],Q2=Promise.resolve(),mh=!1;function ph(){mh||(mh=!0,Q2.then(Ju))}function dh(){return ph(),Q2}function _n(t){Zl.push(t)}function Vo(t){uh.push(t)}var fh=new Set,Ql=0;function Ju(){if(Ql!==0)return;let t=Io;do{try{for(;Ql<Fr.length;){let e=Fr[Ql];Ql++,no(e),UP(e.$$)}}catch(e){throw Fr.length=0,Ql=0,e}for(no(null),Fr.length=0,Ql=0;$t.length;)$t.pop()();for(let e=0;e<Zl.length;e+=1){let n=Zl[e];fh.has(n)||(fh.add(n),n())}Zl.length=0}while(Fr.length);for(;uh.length;)uh.pop()();mh=!1,fh.clear(),no(t)}function UP(t){if(t.fragment!==null){t.update(),at(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(_n)}}function Z2(t){let e=[],n=[];Zl.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),Zl=e}var Pc;function J2(){return Pc||(Pc=Promise.resolve(),Pc.then(()=>{Pc=null})),Pc}function Tc(t,e,n){t.dispatchEvent(Cc(`${e?"intro":"outro"}${n}`))}var Ku=new Set,Ls;function Pe(){Ls={r:0,c:[],p:Ls}}function Te(){Ls.r||at(Ls.c),Ls=Ls.p}function P(t,e){t&&t.i&&(Ku.delete(t),t.i(e))}function q(t,e,n,i){if(t&&t.o){if(Ku.has(t))return;Ku.add(t),Ls.c.push(()=>{Ku.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}var K2={duration:0};function e_(t,e,n){let i={direction:"out"},s=e(t,n,i),o=!0,r,l=Ls;l.r+=1;let a;function c(){let{delay:f=0,duration:u=300,easing:m=wr,tick:g=ue,css:v}=s||K2;v&&(r=Sc(t,1,0,u,f,m,v));let _=Wu()+f,b=_+u;_n(()=>Tc(t,!1,"start")),"inert"in t&&(a=t.inert,t.inert=!0),Gu(y=>{if(o){if(y>=b)return g(0,1),Tc(t,!1,"end"),--l.r||at(l.c),!1;if(y>=_){let k=m((y-_)/u);g(1-k,k)}}return o})}return To(s)?J2().then(()=>{s=s(i),c()}):c(),{end(f){f&&"inert"in t&&(t.inert=a),f&&s.tick&&s.tick(1,0),o&&(r&&Zu(t,r),o=!1)}}}function hh(t,e,n,i){let o=e(t,n,{direction:"both"}),r=i?0:1,l=null,a=null,c=null,f;function u(){c&&Zu(t,c)}function m(v,_){let b=v.b-r;return _*=Math.abs(b),{a:r,b:v.b,d:b,duration:_,start:v.start,end:v.start+_,group:v.group}}function g(v){let{delay:_=0,duration:b=300,easing:y=wr,tick:k=ue,css:S}=o||K2,A={start:Wu()+_,b:v};v||(A.group=Ls,Ls.r+=1),"inert"in t&&(v?f!==void 0&&(t.inert=f):(f=t.inert,t.inert=!0)),l||a?a=A:(S&&(u(),c=Sc(t,r,v,b,_,y,S)),v&&k(0,1),l=m(A,b),_n(()=>Tc(t,v,"start")),Gu(F=>{if(a&&F>a.start&&(l=m(a,b),a=null,Tc(t,l.b,"start"),S&&(u(),c=Sc(t,r,l.b,l.duration,0,y,o.css))),l){if(F>=l.end)k(r=l.b,1-r),Tc(t,l.b,"end"),a||(l.b?u():--l.group.r||at(l.group.c)),l=null;else if(F>=l.start){let M=F-l.start;r=l.a+l.d*y(M/l.duration),k(r,1-r)}}return!!(l||a)}))}return{run(v){To(o)?J2().then(()=>{o=o({direction:v?"in":"out"}),g(v)}):g(v)},end(){u(),l=a=null}}}function me(t){return t?.length!==void 0?t:Array.from(t)}function t_(t,e){t.d(1),e.delete(t.key)}function Ii(t,e){q(t,1,1,()=>{e.delete(t.key)})}function ui(t,e,n,i,s,o,r,l,a,c,f,u){let m=t.length,g=o.length,v=m,_={};for(;v--;)_[t[v].key]=v;let b=[],y=new Map,k=new Map,S=[];for(v=g;v--;){let D=u(s,o,v),R=n(D),E=r.get(R);E?i&&S.push(()=>E.p(D,e)):(E=c(R,D),E.c()),y.set(R,b[v]=E),R in _&&k.set(R,Math.abs(v-_[R]))}let A=new Set,F=new Set;function M(D){P(D,1),D.m(l,f),r.set(D.key,D),f=D.first,g--}for(;m&&g;){let D=b[g-1],R=t[m-1],E=D.key,L=R.key;D===R?(f=D.first,m--,g--):y.has(L)?!r.has(E)||A.has(E)?M(D):F.has(L)?m--:k.get(E)>k.get(L)?(F.add(E),M(D)):(A.add(L),m--):(a(R,r),m--)}for(;m--;){let D=t[m];y.has(D.key)||a(D,r)}for(;g;)M(b[g-1]);return at(S),b}function em(t,e){let n={},i={},s={$$scope:1},o=t.length;for(;o--;){let r=t[o],l=e[o];if(l){for(let a in r)a in l||(i[a]=1);for(let a in l)s[a]||(n[a]=l[a],s[a]=1);t[o]=l}else for(let a in r)s[a]=1}for(let r in i)r in n||(n[r]=void 0);return n}function tm(t){return typeof t=="object"&&t!==null?t:{}}var OP=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],$P=new Set([...OP]);function Lo(t,e,n){let i=t.$$.props[e];i!==void 0&&(t.$$.bound[i]=n,n(t.$$.ctx[i]))}function ne(t){t&&t.c()}function ee(t,e,n){let{fragment:i,after_update:s}=t.$$;i&&i.m(e,n),_n(()=>{let o=t.$$.on_mount.map(lh).filter(To);t.$$.on_destroy?t.$$.on_destroy.push(...o):at(o),t.$$.on_mount=[]}),s.forEach(_n)}function te(t,e){let n=t.$$;n.fragment!==null&&(Z2(n.after_update),at(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function jP(t,e){t.$$.dirty[0]===-1&&(Fr.push(t),ph(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ce(t,e,n,i,s,o,r=null,l=[-1]){let a=Io;no(t);let c=t.$$={fragment:null,ctx:[],props:o,update:ue,not_equal:s,bound:ju(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:ju(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};r&&r(c.root);let f=!1;if(c.ctx=n?n(t,e.props||{},(u,m,...g)=>{let v=g.length?g[0]:m;return c.ctx&&s(c.ctx[u],c.ctx[u]=v)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](v),f&&jP(t,u)),m}):[],c.update(),f=!0,at(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){j2();let u=Y2(e.target);c.fragment&&c.fragment.l(u),u.forEach(x)}else c.fragment&&c.fragment.c();e.intro&&P(t.$$.fragment),ee(t,e.target,e.anchor),W2(),Ju()}no(a)}var WP;typeof HTMLElement=="function"&&(WP=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(t,e,n){super(),this.$$ctor=t,this.$$s=e,n&&this.attachShadow({mode:"open"})}addEventListener(t,e,n){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let i=this.$$c.$on(t,e);this.$$l_u.set(e,i)}super.addEventListener(t,e,n)}removeEventListener(t,e,n){if(super.removeEventListener(t,e,n),this.$$c){let i=this.$$l_u.get(e);i&&(i(),this.$$l_u.delete(e))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(s){return()=>{let o;return{c:function(){o=h("slot"),s!=="default"&&p(o,"name",s)},m:function(a,c){w(a,o,c)},d:function(a){a&&x(o)}}}};if(await Promise.resolve(),!this.$$cn)return;let e={},n=X2(this);for(let s of this.$$s)s in n&&(e[s]=[t(s)]);for(let s of this.attributes){let o=this.$$g_p(s.name);o in this.$$d||(this.$$d[o]=gh(o,s.value,this.$$p_d,"toProp"))}for(let s in this.$$p_d)!(s in this.$$d)&&this[s]!==void 0&&(this.$$d[s]=this[s],delete this[s]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});let i=()=>{this.$$r=!0;for(let s in this.$$p_d)if(this.$$d[s]=this.$$c.$$.ctx[this.$$c.$$.props[s]],this.$$p_d[s].reflect){let o=gh(s,this.$$d[s],this.$$p_d,"toAttribute");o==null?this.removeAttribute(this.$$p_d[s].attribute||s):this.setAttribute(this.$$p_d[s].attribute||s,o)}this.$$r=!1};this.$$c.$$.after_update.push(i),i();for(let s in this.$$l)for(let o of this.$$l[s]){let r=this.$$c.$on(s,o);this.$$l_u.set(o,r)}this.$$l={}}}attributeChangedCallback(t,e,n){this.$$r||(t=this.$$g_p(t),this.$$d[t]=gh(t,n,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{this.$$cn||(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function gh(t,e,n,i){let s=n[t]?.type;if(e=s==="Boolean"&&typeof e!="boolean"?e!=null:e,!i||!n[t])return e;if(i==="toAttribute")switch(s){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(s){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var Me=class{$$=void 0;$$set=void 0;$destroy(){te(this,1),this.$destroy=ue}$on(e,n){if(!To(n))return ue;let i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{let s=i.indexOf(n);s!==-1&&i.splice(s,1)}}$set(e){this.$$set&&!B2(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var n_="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(n_);var Jl=[];function ie(t,e=ue){let n,i=new Set;function s(l){if(Ue(t,l)&&(t=l,n)){let a=!Jl.length;for(let c of i)c[1](),Jl.push(c,t);if(a){for(let c=0;c<Jl.length;c+=2)Jl[c][0](Jl[c+1]);Jl.length=0}}}function o(l){s(l(t))}function r(l,a=ue){let c=[l,a];return i.add(c),i.size===1&&(n=e(s,o)||ue),l(t),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:r}}var Ec=ie([]),Qn=ie({role:0,nearby:0,exprate:1,itemfind:1,queues:[],membercount:0}),nm=ie({parties:[],filterActivity:-1}),Gi=ie({flashing:!1,message:"",activity:0,listed:!1,applications:[]}),Kl=ie([]),bn=ie(),so=ie([]),Cr=ie({}),qs=ie(),im=ie(!1),i_=ie(),s_=ie(!1),xi=ie("Loading World"),Dc=ie([]),Rs=ie({}),zs=ie({}),Ic=ie([]),ea=ie([]),En=ie(),sm=ie("auto"),Hi=ie(0),ta=ie(0),qo=ie(0),na=ie([]),ia=ie({}),Ro=ie({}),om=ie({current:0,max:1}),rm=ie(),lm=ie(),Vc=ie(!1),am=ie(0),cm=ie([0,0]),oo=ie(),Bs=ie(),Us=ie(!1),Lc=ie(new Map),zo=ie(new Map),qc=ie(),Bo=ie(),as=ie(),sa=ie([]),cs=ie(),fm=ie(0),Sr=ie(!1),Ar=ie(!1),Vi=ie(),um=ie([]),Yi=ie(),Os=ie(),Uo=ie(),oa=ie(),Oo=ie({}),Rc=ie({}),mm=ie({}),pm=ie({}),dm=ie(),ra=ie(),wi=[];function GP(t){let e;return{c(){e=h("div"),e.innerHTML='<div class="bounce1 svelte-twvoek"></div><div class="bounce2 svelte-twvoek"></div><div class="bounce3 svelte-twvoek"></div>',p(e,"class","spinner svelte-twvoek")},m(n,i){w(n,e,i)},p:ue,i:ue,o:ue,d(n){n&&x(e)}}}var vh=class extends Me{constructor(e){super(),Ce(this,e,null,GP,Fn,{})}},o_=vh;function hm(t,{delay:e=0,duration:n=400,easing:i=wr}={}){let s=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:i,css:o=>`opacity: ${o*s}`}}function r_(t){let e,n,i,s,o,r;return n=new o_({}),{c(){e=h("div"),ne(n.$$.fragment),i=h("h2"),s=T(t[0]),o=h("small"),o.innerHTML='<img alt="Hordes.io" class="svgicon" src="/data/ui/icon.svg?v=8588529"/> 0.50.8588 Live',ze(i,"margin-top","100px"),p(o,"class","version textgrey textcenter svelte-aoht7k"),p(e,"class","l-ui container svelte-aoht7k")},m(l,a){w(l,e,a),ee(n,e,null),d(e,i),d(i,s),d(e,o),r=!0},p(l,a){(!r||a&1)&&G(s,l[0])},i(l){r||(P(n.$$.fragment,l),r=!0)},o(l){q(n.$$.fragment,l),r=!1},d(l){l&&x(e),te(n)}}}function HP(t){let e,n,i=t[0]&&r_(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=r_(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function YP(t,e,n){let{active:i}=e;return t.$$set=s=>{"active"in s&&n(0,i=s.active)},[i]}var _h=class extends Me{constructor(e){super(),Ce(this,e,YP,HP,Ue,{active:0})}},l_=_h;function fs(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function a_(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function bh(t,e){let n=e[0],i=e[1],s=e[2],o=e[3],r=e[4],l=e[5],a=e[6],c=e[7],f=e[8],u=e[9],m=e[10],g=e[11],v=e[12],_=e[13],b=e[14],y=e[15],k=n*l-i*r,S=n*a-s*r,A=n*c-o*r,F=i*a-s*l,M=i*c-o*l,D=s*c-o*a,R=f*_-u*v,E=f*b-m*v,L=f*y-g*v,B=u*b-m*_,I=u*y-g*_,N=m*y-g*b,j=k*N-S*I+A*B+F*L-M*E+D*R;return j?(j=1/j,t[0]=(l*N-a*I+c*B)*j,t[1]=(s*I-i*N-o*B)*j,t[2]=(_*D-b*M+y*F)*j,t[3]=(m*M-u*D-g*F)*j,t[4]=(a*L-r*N-c*E)*j,t[5]=(n*N-s*L+o*E)*j,t[6]=(b*A-v*D-y*S)*j,t[7]=(f*D-m*A+g*S)*j,t[8]=(r*I-l*L+c*R)*j,t[9]=(i*L-n*I-o*R)*j,t[10]=(v*M-_*A+y*k)*j,t[11]=(u*A-f*M-g*k)*j,t[12]=(l*E-r*B-a*R)*j,t[13]=(n*B-i*E+s*R)*j,t[14]=(_*S-v*F-b*k)*j,t[15]=(f*F-u*S+m*k)*j,t):null}function gm(t,e,n){let i=e[0],s=e[1],o=e[2],r=e[3],l=e[4],a=e[5],c=e[6],f=e[7],u=e[8],m=e[9],g=e[10],v=e[11],_=e[12],b=e[13],y=e[14],k=e[15],S=n[0],A=n[1],F=n[2],M=n[3];return t[0]=S*i+A*l+F*u+M*_,t[1]=S*s+A*a+F*m+M*b,t[2]=S*o+A*c+F*g+M*y,t[3]=S*r+A*f+F*v+M*k,S=n[4],A=n[5],F=n[6],M=n[7],t[4]=S*i+A*l+F*u+M*_,t[5]=S*s+A*a+F*m+M*b,t[6]=S*o+A*c+F*g+M*y,t[7]=S*r+A*f+F*v+M*k,S=n[8],A=n[9],F=n[10],M=n[11],t[8]=S*i+A*l+F*u+M*_,t[9]=S*s+A*a+F*m+M*b,t[10]=S*o+A*c+F*g+M*y,t[11]=S*r+A*f+F*v+M*k,S=n[12],A=n[13],F=n[14],M=n[15],t[12]=S*i+A*l+F*u+M*_,t[13]=S*s+A*a+F*m+M*b,t[14]=S*o+A*c+F*g+M*y,t[15]=S*r+A*f+F*v+M*k,t}function aa(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function c_(t,e){let n=e[0],i=e[1],s=e[2],o=e[4],r=e[5],l=e[6],a=e[8],c=e[9],f=e[10];return t[0]=Math.sqrt(n*n+i*i+s*s),t[1]=Math.sqrt(o*o+r*r+l*l),t[2]=Math.sqrt(a*a+c*c+f*f),t}function f_(t){let e=t[0],n=t[1],i=t[2],s=t[4],o=t[5],r=t[6],l=t[8],a=t[9],c=t[10],f=e*e+n*n+i*i,u=s*s+o*o+r*r,m=l*l+a*a+c*c;return Math.sqrt(Math.max(f,u,m))}function vm(t,e){let n=e[0]+e[5]+e[10],i=0;return n>0?(i=Math.sqrt(n+1)*2,t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=Math.sqrt(1+e[0]-e[5]-e[10])*2,t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=Math.sqrt(1+e[5]-e[0]-e[10])*2,t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=Math.sqrt(1+e[10]-e[0]-e[5])*2,t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function _m(t,e,n,i){let s=e[0],o=e[1],r=e[2],l=e[3],a=s+s,c=o+o,f=r+r,u=s*a,m=s*c,g=s*f,v=o*c,_=o*f,b=r*f,y=l*a,k=l*c,S=l*f,A=i[0],F=i[1],M=i[2];return t[0]=(1-(v+b))*A,t[1]=(m+S)*A,t[2]=(g-k)*A,t[3]=0,t[4]=(m-S)*F,t[5]=(1-(u+b))*F,t[6]=(_+y)*F,t[7]=0,t[8]=(g+k)*M,t[9]=(_-y)*M,t[10]=(1-(u+v))*M,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function u_(t,e,n,i,s){let o=1/Math.tan(e/2),r=1/(i-s);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(s+i)*r,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*s*i*r,t[15]=0,t}function m_(t,e,n,i,s,o,r){let l=1/(e-n),a=1/(i-s),c=1/(o-r);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*l,t[13]=(s+i)*a,t[14]=(r+o)*c,t[15]=1,t}function yh(t,e,n,i){let s=e[0],o=e[1],r=e[2],l=i[0],a=i[1],c=i[2],f=s-n[0],u=o-n[1],m=r-n[2],g=f*f+u*u+m*m;g>0&&(g=1/Math.sqrt(g),f*=g,u*=g,m*=g);let v=a*m-c*u,_=c*f-l*m,b=l*u-a*f;return g=v*v+_*_+b*b,g>0&&(g=1/Math.sqrt(g),v*=g,_*=g,b*=g),t[0]=v,t[1]=_,t[2]=b,t[3]=0,t[4]=u*b-m*_,t[5]=m*v-f*b,t[6]=f*_-u*v,t[7]=0,t[8]=f,t[9]=u,t[10]=m,t[11]=0,t[12]=s,t[13]=o,t[14]=r,t[15]=1,t}function p_(t,e){return t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0),t}function mi(t){let e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)}function st(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Y(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function pi(t,e){return t[0]=e,t[1]=e,t[2]=e,t}function Rn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Jn(t,e,n,i){return t[0]+=e,t[1]+=n,t[2]+=i,t}function Xt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function dn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function sn(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t}function Tr(t,e){let n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(n*n+i*i+s*s)}function Kn(t,e){let n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return n*n+i*i+s*s}function zc(t){let e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function bm(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Zn(t,e){let n=e[0],i=e[1],s=e[2],o=n*n+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function pn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Xi(t,e,n){let i=e[0],s=e[1],o=e[2],r=n[0],l=n[1],a=n[2];return t[0]=s*a-o*l,t[1]=o*r-i*a,t[2]=i*l-s*r,t}function ca(t,e,n,i){let s=e[0],o=e[1],r=e[2];return t[0]=s+i*(n[0]-s),t[1]=o+i*(n[1]-o),t[2]=r+i*(n[2]-r),t}function Mi(t,e,n){let i=e[0],s=e[1],o=e[2],r=n[3]*i+n[7]*s+n[11]*o+n[15];return r=r||1,t[0]=(n[0]*i+n[4]*s+n[8]*o+n[12])/r,t[1]=(n[1]*i+n[5]*s+n[9]*o+n[13])/r,t[2]=(n[2]*i+n[6]*s+n[10]*o+n[14])/r,t}function Er(t,e,n,i,s){return t[0]=s[0]*e+s[4]*n+s[8]*i+s[12],t[1]=s[1]*e+s[5]*n+s[9]*i+s[13],t[2]=s[2]*e+s[6]*n+s[10]*i+s[14],t}function ym(t,e,n,i,s){return t[0]=s[0]*e+s[4]*n+s[8]*i,t[1]=s[1]*e+s[5]*n+s[9]*i,t[2]=s[2]*e+s[6]*n+s[10]*i,t}function kh(t,e,n){let i=e[0],s=e[1],o=e[2],r=n[0],l=n[1],a=n[2],c=n[3],f=l*o-a*s,u=a*i-r*o,m=r*s-l*i,g=l*m-a*u,v=a*f-r*m,_=r*u-l*f,b=c*2;return f*=b,u*=b,m*=b,g*=2,v*=2,_*=2,t[0]=i+f+g,t[1]=s+u+v,t[2]=o+m+_,t}var zU=function(){let t=[0,0,0],e=[0,0,0];return function(n,i){st(t,n),st(e,i),Zn(t,t),Zn(e,e);let s=pn(t,e);return s>1?0:s<-1?Math.PI:Math.acos(s)}}();function d_(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Dr(t,e,n){let i=Math.sin(n),s=Math.cos(n);return t[0]=e[2]*i+e[0]*s,t[1]=e[1],t[2]=e[2]*s-e[0]*i,t}function h_(t,e,n){let i=Math.sin(n),s=Math.cos(n);return t[0]=e[1]*i+e[0]*s,t[2]=e[1]*s-e[0]*i,t}function Ir(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ei(t,e,n,i,s){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t}function g_(t,e){let n=e[0],i=e[1],s=e[2],o=e[3],r=n*n+i*i+s*s+o*o;return r>0&&(r=1/Math.sqrt(r)),t[0]=n*r,t[1]=i*r,t[2]=s*r,t[3]=o*r,t}function QP(t,e,n){n=n*.5;let i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function xh(t,e,n,i){let s=e[0],o=e[1],r=e[2],l=e[3],a=n[0],c=n[1],f=n[2],u=n[3],m,g,v,_,b;return g=s*a+o*c+r*f+l*u,g<0&&(g=-g,a=-a,c=-c,f=-f,u=-u),1-g>1e-6?(m=Math.acos(g),v=Math.sin(m),_=Math.sin((1-i)*m)/v,b=Math.sin(i*m)/v):(_=1-i,b=i),t[0]=_*s+b*a,t[1]=_*o+b*c,t[2]=_*r+b*f,t[3]=_*l+b*u,t}function ZP(t,e){let n=e[0]+e[4]+e[8],i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);let o=(s+1)%3,r=(s+2)%3;i=Math.sqrt(e[s*3+s]-e[o*3+o]-e[r*3+r]+1),t[s]=.5*i,i=.5/i,t[3]=(e[o*3+r]-e[r*3+o])*i,t[o]=(e[o*3+s]+e[s*3+o])*i,t[r]=(e[r*3+s]+e[s*3+r])*i}return t}function km(t,e){let n=Math.sin(e[0]*.5),i=Math.cos(e[0]*.5),s=Math.sin(e[1]*.5),o=Math.cos(e[1]*.5),r=Math.sin(e[2]*.5),l=Math.cos(e[2]*.5);return t[0]=n*o*l+i*s*r,t[1]=i*s*l-n*o*r,t[2]=i*o*r-n*s*l,t[3]=i*o*l+n*s*r,t}var v_=g_;var HU=function(){let t=[0,0,0],e=[1,0,0],n=[0,1,0];return function(i,s,o){let r=pn(s,o);return r<-.999999?(Xi(t,e,s),mi(t)<1e-6&&Xi(t,n,s),Zn(t,t),QP(i,t,Math.PI),i):r>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Xi(t,s,o),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+r,v_(i,i))}}(),YU=function(){let t=[0,0,0,1],e=[0,0,0,1];return function(n,i,s,o,r,l){return xh(t,i,r,l),xh(e,s,o,l),xh(n,t,e,2*l*(1-l)),n}}(),XU=function(){let t=[1,0,0,0,1,0,0,0,1];return function(e,n,i,s){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],v_(e,ZP(e,t))}}();var wh=fs(),JP=()=>({parent:null,children:[],visible:!0,geometry:void 0,matrix:fs(),worldMatrix:fs(),position:[0,0,0],scale:[1,1,1],quaternion:[-0,-0,-0,1],rotation:[-0,-0,-0],matrixAutoUpdate:!1,matrixNeedsUpdate:!0,data:{}}),Mn=(t,e,n=!0)=>{n&&t.parent!==null&&e!==t.parent&&eT(t.parent,t,!1),t.parent=e,t.matrixNeedsUpdate=!0,n&&e&&KP(e,t,!1)},KP=(t,e,n=!0)=>{~t.children.indexOf(e)||t.children.push(e),n&&Mn(e,t,!1)},eT=(t,e,n=!0)=>{~t.children.indexOf(e)&&t.children.splice(t.children.indexOf(e),1),n&&Mn(e,null,!1)},qt=(t,e)=>{if(!t.visible)return;let n=ro(t),i=tT(t,e,n);t.children.forEach(s=>{s.visible&&qt(s,i)})},ro=t=>!t.matrixAutoUpdate&&!t.matrixNeedsUpdate?!1:(t.matrixNeedsUpdate=!1,km(t.quaternion,t.rotation),_m(t.matrix,t.quaternion,t.position,t.scale),!0),tT=(t,e,n)=>t.parent!==null?e||n?(gm(t.worldMatrix,t.parent.worldMatrix,t.matrix),!0):!1:n?(a_(t.worldMatrix,t.matrix),!0):!1,wm=(t,e,n,i)=>{let s=Xt([0,0,0],n.position,e.position);Zn(s,s),sn(t.position,e.position,s,i),t.rotation[0]=0,t.rotation[1]=Math.atan2(s[0],s[2])+1.5,t.rotation[2]=Math.sin(-s[1])+1.5,qt(t,!1)},Vr=(t,e,n=!1,i)=>{n?yh(wh,t.position,e,i):yh(wh,e,t.position,i),p_(t.rotation,wh)},xm=[],on=()=>xm.length>0?xm.pop():JP(),us=t=>{nT(t),xm.indexOf(t)<0?xm.push(t):console.log("tried returning transform that is already known")},nT=t=>{t.data={},t.geometry=void 0,t.visible=!0,t.matrixAutoUpdate=!1,Y(t.position,0,0,0),Y(t.scale,1,1,1),Y(t.rotation,0,0,0),Mn(t,null,!0);for(let e=0;e<t.children.length;++e)Mn(t.children[e],null);t.children.length=0};var Mm=[0,0,0],Bc=(t=.1,e=100,n=45,i=1)=>{let s={near:t,far:e,fov:n,aspect:i,transform:on(),projectionMatrix:fs(),viewMatrix:fs(),unprojectionViewMatrix:fs(),projectionViewMatrix:fs(),worldPosition:[0,0,0],frustum:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],frustumConstants:[0,0,0,0,0,0]};return s.transform.matrixAutoUpdate=!0,s},Uc=t=>{u_(t.projectionMatrix,t.fov*(Math.PI/180),t.aspect,t.near,t.far)},b_=(t,e,n,i,s)=>{m_(t.projectionMatrix,e,n,i,s,t.near,t.far)},Mh=t=>{aa(t.worldPosition,t.transform.worldMatrix)},fa=(t,e)=>{qt(t.transform,e),bh(t.viewMatrix,t.transform.worldMatrix),gm(t.projectionViewMatrix,t.projectionMatrix,t.viewMatrix),bh(t.unprojectionViewMatrix,t.projectionViewMatrix),Mh(t)};var lo=(t,e,n)=>{let i=t.unprojectionViewMatrix,s=n[0],o=n[1],r=i[3]*s+i[7]*o+i[11]*-1+i[15];return e[0]=(i[0]*s+i[4]*o+i[8]*-1+i[12])/r,e[1]=(i[1]*s+i[5]*o+i[9]*-1+i[13])/r,e[2]=(i[2]*s+i[6]*o+i[10]*-1+i[14])/r,e},Fm=t=>{let e=t.projectionViewMatrix;Y(t.frustum[0],e[3]-e[0],e[7]-e[4],e[11]-e[8]),Y(t.frustum[1],e[3]+e[0],e[7]+e[4],e[11]+e[8]),Y(t.frustum[2],e[3]+e[1],e[7]+e[5],e[11]+e[9]),Y(t.frustum[3],e[3]-e[1],e[7]-e[5],e[11]-e[9]),Y(t.frustum[4],e[3]-e[2],e[7]-e[6],e[11]-e[10]),Y(t.frustum[5],e[3]+e[2],e[7]+e[6],e[11]+e[10]),t.frustumConstants[0]=e[15]-e[12],t.frustumConstants[1]=e[15]+e[12],t.frustumConstants[2]=e[15]+e[13],t.frustumConstants[3]=e[15]-e[13],t.frustumConstants[4]=e[15]-e[14],t.frustumConstants[5]=e[15]+e[14];for(let n=0;n<6;n++){let i=t.frustum[n],s=1/mi(i);dn(i,i,s),t.frustumConstants[n]*=s}},y_=(t,e,n)=>{st(Mm,e.bounds.center),Mi(Mm,Mm,n.worldMatrix);let i=e.bounds.radius*f_(n.worldMatrix);return Fh(t,Mm,i)},Fh=(t,e,n)=>{for(let i=0;i<6;i++)if(pn(t.frustum[i],e)+t.frustumConstants[i]<-n)return!1;return!0};var Fi=document.createElement("canvas"),$=Fi.getContext("webgl2",{depth:!0,stencil:!1,premultipliedAlpha:!1,alpha:!1,antialias:!1,powerPreference:"high-performance",preserveDrawingBuffer:!0}),In=document.createElement("canvas"),Ci=In.getContext("2d",{alpha:!0}),ua=$.vertexAttribDivisor.bind($),x_=$.drawArraysInstanced.bind($),w_=$.drawElementsInstanced.bind($),M_=$.createVertexArray.bind($),Cm=$.bindVertexArray.bind($),iT=$.deleteVertexArray.bind($),Ch=$.getExtension("EXT_texture_filter_anisotropic"),F_=$.getExtension("WEBGL_compressed_texture_s3tc"),et={maxTextureUnits:$.getParameter($.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxAnisotropy:$.getParameter(Ch.MAX_TEXTURE_MAX_ANISOTROPY_EXT),blendFunc:{src:$.ONE,dst:$.ZERO,srcAlpha:0,dstAlpha:0},blendEquation:{modeRGB:$.FUNC_ADD,modeAlpha:0},frontFace:$.CCW,depthFunc:$.LESS,cullFace:null,depthMask:!0,flipY:!1,framebuffer:null,viewport:{width:-1,height:-1},textureUnits:[],activeTextureUnit:0,width:0,height:0,currentGeometry:-1,currentProgram:-1},C_=(t,e)=>{et.width=t,et.height=e,Fi.width=t,Fi.height=e,In.width=t,In.height=e},Oc=(t,e)=>{et.viewport.width===t&&et.viewport.height===e||(et.viewport.width=t,et.viewport.height=e,$.viewport(0,0,t,e))},$c=t=>{et[t]!==!0&&($.enable(t),et[t]=!0)},Sm=t=>{et[t]!==!1&&($.disable(t),et[t]=!1)},S_=(t,e,n,i)=>{et.blendFunc.src===t&&et.blendFunc.dst===e&&et.blendFunc.srcAlpha===n&&et.blendFunc.dstAlpha===i||(et.blendFunc.src=t,et.blendFunc.dst=e,et.blendFunc.srcAlpha=n,et.blendFunc.dstAlpha=i,n!==void 0?$.blendFuncSeparate(t,e,n,i):$.blendFunc(t,e))},A_=(t,e)=>{et.blendEquation.modeRGB===t&&et.blendEquation.modeAlpha===e||(et.blendEquation.modeRGB=t,et.blendEquation.modeAlpha=e,e!==void 0?$.blendEquationSeparate(t,e):$.blendEquation(t))},P_=t=>{et.cullFace!==t&&(et.cullFace=t,$.cullFace(t))},T_=t=>{et.frontFace!==t&&(et.frontFace=t,$.frontFace(t))},Sh=t=>{et.depthMask!==t&&(et.depthMask=t,$.depthMask(t))},E_=t=>{et.depthFunc!==t&&(et.depthFunc=t,$.depthFunc(t))},Nc=t=>{et.activeTextureUnit!==t&&(et.activeTextureUnit=t,$.activeTexture($.TEXTURE0+t))},k_=({target:t=$.FRAMEBUFFER,buffer:e=null}={})=>{et.framebuffer!==e&&(et.framebuffer=e,$.bindFramebuffer(t,e))},D_=t=>{t?(k_(t),Oc(t.width,t.height)):(k_(),Oc(et.width,et.height))},Ah=t=>{(!t||!t.depth)&&($c($.DEPTH_TEST),Sh(!0)),$.clear($.COLOR_BUFFER_BIT|$.DEPTH_BUFFER_BIT)};var ma=`#version 300 es
in vec2 uv;
in vec2 position;
out vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = vec4(position, 0.0, 1.0);
}`;var I_=[0,1,0],V_=[0,0,0],gt=Bc(.3,500,70),Gt=on();Mn(gt.transform,Gt);Y(gt.transform.position,0,0,-1);gt.transform.rotation[1]=Math.PI;Gt.matrixAutoUpdate=!0;function sT(t){let e;return{c(){e=h("div"),ze(e,"cursor",t[1])},m(n,i){w(n,e,i),t[2](e)},p(n,[i]){i&2&&ze(e,"cursor",n[1])},i:ue,o:ue,d(n){n&&x(e),t[2](null)}}}function oT(t,e,n){let i;re(t,sm,r=>n(1,i=r));let s;Pn(()=>{s.appendChild(Fi),s.appendChild(In)});function o(r){$t[r?"unshift":"push"](()=>{s=r,n(0,s)})}return[s,i,o]}var Ph=class extends Me{constructor(e){super(),Ce(this,e,oT,sT,Ue,{})}},L_=Ph;function q_(t){let e,n,i,s,o;return{c(){e=h("div"),n=h("img"),p(n,"class",i=Eo(t[2].css)+" svelte-fc7xg3"),lt(n.src,s=t[2].img)||p(n,"src",s),p(e,"class",o="container border "+t[2].border+" svelte-fc7xg3"),ze(e,"top",t[1]+"px"),ze(e,"left",t[0]+"px")},m(r,l){w(r,e,l),d(e,n)},p(r,l){l&4&&i!==(i=Eo(r[2].css)+" svelte-fc7xg3")&&p(n,"class",i),l&4&&!lt(n.src,s=r[2].img)&&p(n,"src",s),l&4&&o!==(o="container border "+r[2].border+" svelte-fc7xg3")&&p(e,"class",o),l&2&&ze(e,"top",r[1]+"px"),l&1&&ze(e,"left",r[0]+"px")},d(r){r&&x(e)}}}function rT(t){let e,n=t[2]&&t[0]&&t[1]&&q_(t);return{c(){n&&n.c(),e=ve()},m(i,s){n&&n.m(i,s),w(i,e,s)},p(i,[s]){i[2]&&i[0]&&i[1]?n?n.p(i,s):(n=q_(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ue,o:ue,d(i){i&&x(e),n&&n.d(i)}}}function lT(t,e,n){let i;re(t,En,l=>n(2,i=l));let s,o,r=l=>{(i||s||o)&&(i?(n(0,s=l.clientX-10),n(1,o=l.clientY-10)):(n(0,s=0),n(1,o=0)))};return Pn(()=>{document.addEventListener("mousemove",r,!1)}),Tn(()=>{document.removeEventListener("mousemove",r)}),[s,o,i]}var Th=class extends Me{constructor(e){super(),Ce(this,e,lT,rT,Ue,{})}},R_=Th;var z_=(t,e,n)=>n.items[t][t=="book"?Math.floor(e/5):e],B_=(t,e,n)=>z_(t,e,n).name+(t=="book"?" Lv. "+(e%5+1):""),U_=(t,e,n)=>z_(t,e,n).description;var Ns={};Xn(Ns,{activeWorld:()=>Lr,alwaysShowLevel:()=>$m,ambienceVolume:()=>Yc,anisotropy:()=>Hc,audioVolume:()=>Br,audioVolumeLowered:()=>Ur,bloom:()=>Em,buffCdFlashingDuration:()=>cf,buffCdFlashingInterval:()=>af,buffcountParty:()=>uf,buffcountUnitframes:()=>ff,buffsHideIrrelevant:()=>np,cameraZoom:()=>Vm,cdTextBuffs:()=>Km,cdTextSkills:()=>Jm,charpanelOpen:()=>mo,chat:()=>ef,chatbubbles:()=>Hm,clanOpen:()=>fo,classColorBars:()=>jm,combatTextPush:()=>Nm,command:()=>Qi,current:()=>le,disableoffscreen:()=>Pm,dpsmeterMode:()=>Kc,dpsmeterOpen:()=>Gr,dpsmeterParty:()=>Jc,dpsmeterTarget:()=>Hr,expmeterOpen:()=>Zc,filteredChannels:()=>nf,fogpattern:()=>Im,foliage:()=>Wc,fov:()=>Rr,fxaa:()=>Am,inventoryCols:()=>jr,inventoryOpen:()=>ao,invertMouseX:()=>ip,invertMouseY:()=>sp,itemProtectQuality:()=>rf,itemQualityFilter:()=>of,itemQualityPercent:()=>Zm,itemTypeFilter:()=>sf,itemmeterOpen:()=>Qc,kbAltBack:()=>W_,kbAltForward:()=>j_,kbBack:()=>H_,kbCharacter:()=>eb,kbClan:()=>nb,kbForward:()=>O_,kbInventory:()=>tb,kbLeft:()=>G_,kbMap:()=>J_,kbNextParty:()=>Q_,kbNextTarget:()=>X_,kbParty:()=>sb,kbPvp:()=>ib,kbRight:()=>Y_,kbSkillbar1:()=>ob,kbSkillbar10:()=>db,kbSkillbar11:()=>hb,kbSkillbar12:()=>gb,kbSkillbar13:()=>vb,kbSkillbar14:()=>_b,kbSkillbar15:()=>bb,kbSkillbar16:()=>yb,kbSkillbar17:()=>kb,kbSkillbar18:()=>xb,kbSkillbar19:()=>wb,kbSkillbar2:()=>rb,kbSkillbar20:()=>Mb,kbSkillbar21:()=>Fb,kbSkillbar22:()=>Cb,kbSkillbar23:()=>Sb,kbSkillbar24:()=>Ab,kbSkillbar3:()=>lb,kbSkillbar4:()=>ab,kbSkillbar5:()=>cb,kbSkillbar6:()=>fb,kbSkillbar7:()=>ub,kbSkillbar8:()=>mb,kbSkillbar9:()=>pb,kbSkills:()=>K_,kbTurnLeft:()=>$_,kbTurnRight:()=>N_,kbUntarget:()=>Z_,lang:()=>Or,lastConnectedChar:()=>jc,lockedcamera:()=>op,mapLowQuality:()=>Gm,mapShowMonsters:()=>Wm,mouseSensitivity:()=>pf,musicVolume:()=>Xc,nameShowEnemyPlayers:()=>Um,nameShowFriendlyPlayers:()=>Bm,nameShowMonsters:()=>zm,nameplateShowEnemyPlayers:()=>Rm,nameplateShowFriendlyPlayers:()=>qm,nameplateShowMonsters:()=>Lm,nameplateShowTransparency:()=>Om,nameplateViewRange:()=>tf,nextFriendlyTargetAllowNonParty:()=>lp,nextFriendlyTargetCycle:()=>df,particles:()=>Dm,partyBuffLimitUpdateRate:()=>ep,partyOpen:()=>Zi,partyWidth:()=>Yr,pointerlock:()=>rp,pvpOpen:()=>uo,registerSetting:()=>Pb,resolution:()=>zr,settingsOpen:()=>Wr,shadowmapResolution:()=>Gc,shadows:()=>Tm,showFpsPing:()=>da,showIncomingDamage:()=>Xm,showIncomingHeal:()=>Ym,showIncomingMana:()=>Qm,showPartyMana:()=>ha,showSelfInParty:()=>tp,skillConfigs:()=>ga,skillPresetVisible:()=>mf,skillbarAmount:()=>Xr,skillbarsettings:()=>po,skillmenuOpen:()=>co,stashCols:()=>$r,stashHeight:()=>Nr,subscriptionOpen:()=>Li,tutprogress:()=>$s,twitchOpen:()=>pa,viewRange:()=>qr,windowSettings:()=>lf});var Eh={};Xn(Eh,{activeWorld:()=>Lr,alwaysShowLevel:()=>$m,ambienceVolume:()=>Yc,anisotropy:()=>Hc,audioVolume:()=>Br,audioVolumeLowered:()=>Ur,bloom:()=>Em,buffCdFlashingDuration:()=>cf,buffCdFlashingInterval:()=>af,buffcountParty:()=>uf,buffcountUnitframes:()=>ff,buffsHideIrrelevant:()=>np,cameraZoom:()=>Vm,cdTextBuffs:()=>Km,cdTextSkills:()=>Jm,charpanelOpen:()=>mo,chat:()=>ef,chatbubbles:()=>Hm,clanOpen:()=>fo,classColorBars:()=>jm,combatTextPush:()=>Nm,command:()=>Qi,disableoffscreen:()=>Pm,dpsmeterMode:()=>Kc,dpsmeterOpen:()=>Gr,dpsmeterParty:()=>Jc,dpsmeterTarget:()=>Hr,expmeterOpen:()=>Zc,filteredChannels:()=>nf,fogpattern:()=>Im,foliage:()=>Wc,fov:()=>Rr,fxaa:()=>Am,inventoryCols:()=>jr,inventoryOpen:()=>ao,invertMouseX:()=>ip,invertMouseY:()=>sp,itemProtectQuality:()=>rf,itemQualityFilter:()=>of,itemQualityPercent:()=>Zm,itemTypeFilter:()=>sf,itemmeterOpen:()=>Qc,kbAltBack:()=>W_,kbAltForward:()=>j_,kbBack:()=>H_,kbCharacter:()=>eb,kbClan:()=>nb,kbForward:()=>O_,kbInventory:()=>tb,kbLeft:()=>G_,kbMap:()=>J_,kbNextParty:()=>Q_,kbNextTarget:()=>X_,kbParty:()=>sb,kbPvp:()=>ib,kbRight:()=>Y_,kbSkillbar1:()=>ob,kbSkillbar10:()=>db,kbSkillbar11:()=>hb,kbSkillbar12:()=>gb,kbSkillbar13:()=>vb,kbSkillbar14:()=>_b,kbSkillbar15:()=>bb,kbSkillbar16:()=>yb,kbSkillbar17:()=>kb,kbSkillbar18:()=>xb,kbSkillbar19:()=>wb,kbSkillbar2:()=>rb,kbSkillbar20:()=>Mb,kbSkillbar21:()=>Fb,kbSkillbar22:()=>Cb,kbSkillbar23:()=>Sb,kbSkillbar24:()=>Ab,kbSkillbar3:()=>lb,kbSkillbar4:()=>ab,kbSkillbar5:()=>cb,kbSkillbar6:()=>fb,kbSkillbar7:()=>ub,kbSkillbar8:()=>mb,kbSkillbar9:()=>pb,kbSkills:()=>K_,kbTurnLeft:()=>$_,kbTurnRight:()=>N_,kbUntarget:()=>Z_,lang:()=>Or,lastConnectedChar:()=>jc,lockedcamera:()=>op,mapLowQuality:()=>Gm,mapShowMonsters:()=>Wm,mouseSensitivity:()=>pf,musicVolume:()=>Xc,nameShowEnemyPlayers:()=>Um,nameShowFriendlyPlayers:()=>Bm,nameShowMonsters:()=>zm,nameplateShowEnemyPlayers:()=>Rm,nameplateShowFriendlyPlayers:()=>qm,nameplateShowMonsters:()=>Lm,nameplateShowTransparency:()=>Om,nameplateViewRange:()=>tf,nextFriendlyTargetAllowNonParty:()=>lp,nextFriendlyTargetCycle:()=>df,particles:()=>Dm,partyBuffLimitUpdateRate:()=>ep,partyOpen:()=>Zi,partyWidth:()=>Yr,pointerlock:()=>rp,pvpOpen:()=>uo,resolution:()=>zr,settingsOpen:()=>Wr,shadowmapResolution:()=>Gc,shadows:()=>Tm,showFpsPing:()=>da,showIncomingDamage:()=>Xm,showIncomingHeal:()=>Ym,showIncomingMana:()=>Qm,showPartyMana:()=>ha,showSelfInParty:()=>tp,skillConfigs:()=>ga,skillPresetVisible:()=>mf,skillbarAmount:()=>Xr,skillbarsettings:()=>po,skillmenuOpen:()=>co,stashCols:()=>$r,stashHeight:()=>Nr,subscriptionOpen:()=>Li,tutprogress:()=>$s,twitchOpen:()=>pa,viewRange:()=>qr,windowSettings:()=>lf});var Lr=ie(""),jc=ie(0),qr=ie(60),Rr=ie(70),zr=ie(100),Wc=ie(100),Gc=ie(2),Am=ie(!0),Pm=ie(!0),Tm=ie(!0),Em=ie(!0),Dm=ie(!0),Hc=ie(4),Im=ie(!0),Yc=ie(40),Br=ie(70),Ur=ie(80),Xc=ie(30),Or=ie("en"),Qi=ie("faction"),$r=ie(8),Nr=ie(300),jr=ie(5),ao=ie(!1),Wr=ie(!1),co=ie(!1),Gr=ie(!1),Qc=ie(!0),Zc=ie(!0),pa=ie(!0),Li=ie(!1),Zi=ie(!1),fo=ie(!1),uo=ie(!1),Jc=ie(!0),Kc=ie(0),Hr=ie(0),mo=ie(!1),po=ie({}),ef=ie([0,0,0,0,0,0,1,1,1,1,1,1]),Vm=ie(7),tf=ie(100),Lm=ie(!0),qm=ie(!0),Rm=ie(!0),zm=ie(!0),Bm=ie(!0),Um=ie(!0),Om=ie(!0),$m=ie(!1),Nm=ie(!0),jm=ie(!1),Wm=ie(!0),Gm=ie(!1),$s=ie(0),Hm=ie(!0),Ym=ie(!0),Xm=ie(!0),Qm=ie(!0),nf=ie([]),sf=ie(""),of=ie(0),Zm=ie(!1),da=ie(!1),rf=ie(70),lf=ie([]),Jm=ie(!0),Km=ie(!0),af=ie(.5),cf=ie(3),ep=ie(!0),Yr=ie(200),tp=ie(!0),ha=ie(!1),ff=ie(14),uf=ie(8),np=ie(!1),ga=ie([]),mf=ie(!1),pf=ie(1),ip=ie(!1),sp=ie(!1),op=ie(!0),rp=ie(!0),lp=ie(!0),df=ie(10),O_=ie("w"),$_=ie("arrowleft"),N_=ie("arrowright"),j_=ie("arrowup"),W_=ie("arrowdown"),G_=ie("a"),H_=ie("s"),Y_=ie("d"),X_=ie("tab"),Q_=ie("x"),Z_=ie("escape"),J_=ie("m"),K_=ie("k"),eb=ie("c"),tb=ie("b"),nb=ie("g"),ib=ie("v"),sb=ie("p"),ob=ie("1"),rb=ie("2"),lb=ie("3"),ab=ie("4"),cb=ie("5"),fb=ie("6"),ub=ie("7"),mb=ie("8"),pb=ie("9"),db=ie("0"),hb=ie(""),gb=ie(""),vb=ie(""),_b=ie(""),bb=ie(""),yb=ie(""),kb=ie(""),xb=ie(""),wb=ie(""),Mb=ie(""),Fb=ie(""),Cb=ie(""),Sb=ie(""),Ab=ie(""),Xr=ie(12);var Dh;Dh={...Eh};var Pb=(t,e)=>{{let n=localStorage.getItem(t),i=JSON.parse(n=="undefined"?null:n);i!==null&&e.set(i)}e.subscribe(n=>{le[t]=n,localStorage.setItem(t,JSON.stringify(n))})},le={};for(let t in Dh)Pb(t,Dh[t]);var C;Or.subscribe(async t=>{await fetch(`/data/loc/${t}.json?v=8588529`).then(async e=>{C=await e.json(),im.set(!0)})});var hn=(t,e)=>B_(t,e,C),Ih=(t,e)=>U_(t,e,C);function Tb(t,e,n){let i=t.slice();return i[6]=e[n],i}function Eb(t){let e,n,i=me(t[2].opts),s=[];for(let r=0;r<i.length;r+=1)s[r]=Vb(Tb(t,i,r));let o=null;return i.length||(o=Db(t)),{c(){e=h("div");for(let r=0;r<s.length;r+=1)s[r].c();o&&o.c(),p(e,"class","panel context border grey"),p(e,"style",n="left:"+t[2].x+"px; top:"+t[2].y+"px; "+(t[2].right?"transform: translateX(-100%);":"")+";")},m(r,l){w(r,e,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null);o&&o.m(e,null),t[4](e)},p(r,l){if(l&5){i=me(r[2].opts);let a;for(a=0;a<i.length;a+=1){let c=Tb(r,i,a);s[a]?s[a].p(c,l):(s[a]=Vb(c),s[a].c(),s[a].m(e,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=i.length,!i.length&&o?o.p(r,l):i.length?o&&(o.d(1),o=null):(o=Db(r),o.c(),o.m(e,null))}l&4&&n!==(n="left:"+r[2].x+"px; top:"+r[2].y+"px; "+(r[2].right?"transform: translateX(-100%);":"")+";")&&p(e,"style",n)},d(r){r&&x(e),it(s,r),o&&o.d(),t[4](null)}}}function Db(t){let e;return{c(){e=h("div"),e.textContent=`${C.ui.noOptions}`,p(e,"class","choice disabled")},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function Ib(t){let e,n;return{c(){e=h("img"),p(e,"class","svgicon"),lt(e.src,n="/data/ui/icons/"+t[6].icon+".svg?v=8588529")||p(e,"src",n)},m(i,s){w(i,e,s)},p(i,s){s&4&&!lt(e.src,n="/data/ui/icons/"+i[6].icon+".svg?v=8588529")&&p(e,"src",n)},d(i){i&&x(e)}}}function Vb(t){let e,n=t[6].name+"",i,s,o,r,l=t[6].icon&&Ib(t);function a(...c){return t[3](t[6],...c)}return{c(){e=h("div"),l&&l.c(),i=T(n),p(e,"class",s="choice "+(t[6].css||""))},m(c,f){w(c,e,f),l&&l.m(e,null),d(e,i),o||(r=Z(e,"mouseup",a),o=!0)},p(c,f){t=c,t[6].icon?l?l.p(t,f):(l=Ib(t),l.c(),l.m(e,i)):l&&(l.d(1),l=null),f&4&&n!==(n=t[6].name+"")&&G(i,n),f&4&&s!==(s="choice "+(t[6].css||""))&&p(e,"class",s)},d(c){c&&x(e),l&&l.d(),o=!1,r()}}}function aT(t){let e,n=t[2]&&Eb(t);return{c(){n&&n.c(),e=ve()},m(i,s){n&&n.m(i,s),w(i,e,s)},p(i,[s]){i[2]?n?n.p(i,s):(n=Eb(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ue,o:ue,d(i){i&&x(e),n&&n.d(i)}}}function cT(t,e,n){let i;re(t,bn,c=>n(2,i=c));let s,o=c=>{c.target!=s&&c.target.parentNode!=s&&i&&bn.set(void 0)},r=(c,f)=>{f.fun(c),bn.set(void 0)};Pn(()=>{document.addEventListener("pointerdown",o,!1)}),Tn(()=>{document.removeEventListener("pointerdown",o)});let l=(c,f)=>r(f,c);function a(c){$t[c?"unshift":"push"](()=>{s=c,n(1,s)})}return[r,s,i,l,a]}var Vh=class extends Me{constructor(e){super(),Ce(this,e,cT,aT,Ue,{opt:0})}get opt(){return this.$$.ctx[0]}},Lb=Vh;var z=0,qb={string:t=>{let e=$b(t);return Ji(e)+e},varuint:t=>Ji(t),varint:t=>fT(t),buffer8:t=>{let e=t.length;return Ji(e)+e},buffer16:(t,e)=>{let n=t.length*2,i=Ji(n);return(e+i)%2==1&&i++,i+n}};var he=t=>{let e=0,n=0,i=0;do i=t[z++],e|=(i&127)<<7*n,n++;while(i&128);return e};var jo=(t,e)=>{for(;e>127;)t[z++]=e&127|128,e>>=7;t[z++]=e&127},Ji=t=>t<=0?1:Math.floor(Math.log(t)/Math.log(128))+1,fT=t=>Ji(t<<1^t>>31),ms=t=>t[z]&128?(255-t[z]+1)*-1:t[z],uT=(t,e)=>{e<0&&(e=255+e+1),t[z]=e&255,z+=1},De=t=>t[z],js=(t,e)=>{t[z]=e,z+=1},ap=t=>{let e=t[z]|t[z+1]<<8;return e&32768?e|4294901760:e},cp=(t,e)=>{t[z]=e&255,t[z+1]=e>>>8,z+=2},Rt=t=>t[z]|t[z+1]<<8;var ho=t=>(t[z]|t[z+1]<<8|t[z+2]<<16)+t[z+3]*16777216,Bb=(t,e)=>{t[z]=e&255,t[z+1]=e>>>8,t[z+2]=e>>>16,t[z+3]=e>>>24,z+=4},Lh=new ArrayBuffer(8),Wo=new Uint8Array(Lh),Ub=new Float32Array(Lh),CO=new Float64Array(Lh),rt=t=>(Wo[0]=t[z],Wo[1]=t[z+1],Wo[2]=t[z+2],Wo[3]=t[z+3],Ub[0]),Ob=(t,e)=>{Ub[0]=e,t[z]=Wo[0],t[z+1]=Wo[1],t[z+2]=Wo[2],t[z+3]=Wo[3],z+=4};var Rb=t=>{let e=he(t);z%2==1&&z++;let n=new Uint16Array(t.buffer,z,e/2);return z+=e,n},$b=t=>{let e=t.length;for(let n=t.length-1;n>=0;n--){let i=t.charCodeAt(n);i>127&&i<=2047?e++:i>2047&&i<=65535&&(e+=2),i>=56320&&i<=57343&&n--}return e},zb=(t,e)=>{let n=$b(e);jo(t,n);for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[z++]=s:s<2048?(t[z++]=s>>6|192,t[z++]=s&63|128):(s&64512)==55296&&i+1<e.length&&(e.charCodeAt(i+1)&64512)==56320?(s=65536+((s&1023)<<10)+(e.charCodeAt(++i)&1023),t[z++]=s>>18|240,t[z++]=s>>12&63|128,t[z++]=s>>6&63|128,t[z++]=s&63|128):(t[z++]=s>>12|224,t[z++]=s>>6&63|128,t[z++]=s&63|128)}},zn=t=>{let e=he(t),n="",i=z+e;for(;z<i;){let s=t[z++];if(s<128)n+=String.fromCharCode(s);else if(s>191&&s<224){let o=t[z++];n+=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){let o=t[z++],r=t[z++],l=t[z++],a=((s&7)<<18|(o&63)<<12|(r&63)<<6|l&63)-65536;n+=String.fromCharCode(55296+(a>>10)),n+=String.fromCharCode(56320+(a&1023))}else{let o=t[z++],r=t[z++];n+=String.fromCharCode((s&15)<<12|(o&63)<<6|r&63)}}return n},Nb={encode:t=>{let e=t,n=e.doubles,i=e.int8s,s=e.uint16s,o=e.uint8s,r=0;r+=1,r+=Ji(n.length);for(let a=0;a<n.length;a++)r+=4;r+=Ji(i.length);for(let a=0;a<i.length;a++)r+=1;r+=Ji(s.length);for(let a=0;a<s.length;a++)r+=2;r+=Ji(o.length);for(let a=0;a<o.length;a++)r+=1;let l=new Uint8Array(r);z=0,js(l,e._header),jo(l,n.length);for(let a=0;a<n.length;a++)Ob(l,n[a]);jo(l,i.length);for(let a=0;a<i.length;a++)uT(l,i[a]);jo(l,s.length);for(let a=0;a<s.length;a++)cp(l,s[a]);jo(l,o.length);for(let a=0;a<o.length;a++)js(l,o[a]);return l}},jb={encode:t=>{let e=t,n=0;n+=1,n+=2;let i=new Uint8Array(n);return z=0,js(i,e._header),cp(i,e.target),i}},Wb={encode:t=>{let e=t,n=e.info,i=0;i+=1,i+=2,i+=Ji(n.length);for(let o=0;o<n.length;o++)i+=4;let s=new Uint8Array(i);z=0,js(s,e._header),cp(s,e.id),jo(s,n.length);for(let o=0;o<n.length;o++)Bb(s,n[o]);return s}},Gb={encode:t=>{let e=t,n=e.info,i=e.pos,s=0;s+=1,s+=2,s+=Ji(n.length);for(let r=0;r<n.length;r++)s+=4;s+=Ji(i.length);for(let r=0;r<i.length;r++)s+=4;let o=new Uint8Array(s);z=0,js(o,e._header),cp(o,e.id),jo(o,n.length);for(let r=0;r<n.length;r++)Bb(o,n[r]);jo(o,i.length);for(let r=0;r<i.length;r++)Ob(o,i[r]);return o}},Hb={encode:t=>{let e=t,n=0;n+=1,n+=1;let i=new Uint8Array(n);return z=0,js(i,e._header),js(i,e.id),i}},Yb={encode:t=>{let e=t,n=0;n+=1,n+=qb.string(e.command,n),n+=qb.string(e.string,n);let i=new Uint8Array(n);return z=0,js(i,e._header),zb(i,e.command),zb(i,e.string),i}},Xb={decode:t=>{let e=t,n={};z=0,n._header=De(e),z+=1;let i=[];n.inputs=i;let s=he(e);for(let u=0;u<s;u++){let m={};i[u]=m,m.id=Rt(e),z+=2,m.jump=De(e),z+=1,m.rot=rt(e),z+=4,m.speed=Rt(e),z+=2;let g=[];m.steer=g,g[0]=ms(e),z+=1;let v=he(e);for(let _=1;_<v;_++)g[_]=ms(e),z+=1}let o=[];n.log=o;let r=he(e);for(let u=0;u<r;u++){let m={};o[u]=m;let g=[];m.data=g;let v=he(e);for(let _=0;_<v;_++)g[_]=he(e);m.type=De(e),z+=1}let l=[];n.logPersonal=l;let a=he(e);for(let u=0;u<a;u++){let m={};l[u]=m;let g=[];m.data=g;let v=he(e);for(let _=0;_<v;_++)g[_]=he(e);m.type=De(e),z+=1}let c=[];n.movements=c;let f=he(e);for(let u=0;u<f;u++){let m={};c[u]=m,m.id=Rt(e),z+=2;let g=[];m.pos=g,g[0]=rt(e),z+=4,g[1]=rt(e),z+=4;let v=he(e);for(let y=2;y<v;y++)g[y]=rt(e),z+=4;let _=[];m.vel=_,_[0]=rt(e),z+=4,_[1]=rt(e),z+=4;let b=he(e);for(let y=2;y<b;y++)_[y]=rt(e),z+=4}return n.tickId=ho(e),z+=4,n}},Qb={decode:t=>{let e=t,n={};z=0,n._header=De(e),z+=1;let i=[];n.members=i;let s=he(e);for(let l=0;l<s;l++){let a={};i[l]=a,a.class=De(e),z+=1,a.entityid=Rt(e),z+=2,a.level=De(e),z+=1,a.name=zn(e),a.role=Rt(e),z+=2,a.world=zn(e)}let o=[];n.queues=o;let r=he(e);for(let l=0;l<r;l++)o[l]=zn(e);return n}},Zb={decode:t=>{let e=t,n={};z=0,n._header=De(e),z+=1,n.contrib=he(e);let i=[];n.contributors=i;let s=he(e);for(let l=0;l<s;l++){let a={};i[l]=a,a.class=De(e),z+=1,a.faction=De(e),z+=1,a.level=De(e),z+=1,a.name=zn(e);let c=[];a.stats=c;let f=he(e);for(let u=0;u<f;u++)c[u]=he(e)}n.duration=he(e);let o=[];n.kills=o,o[0]=he(e);let r=he(e);for(let l=1;l<r;l++)o[l]=he(e);return n.level=he(e),n.reward=he(e),n.status=De(e),z+=1,n}},Jb={decode:t=>{let e=t,n={};z=0,n._header=De(e),z+=1;let i=[];n.members=i;let s=he(e);for(let o=0;o<s;o++){let r={};i[o]=r,r.entityid=Rt(e),z+=2;let l=[];r.pos=l;let a=he(e);for(let c=0;c<a;c++)l[c]=Rt(e),z+=2}return n}},Kb={decode:t=>{let e=t,n={};z=0,n._header=De(e),z+=1;let i=[];n.icons=i;let s=he(e);for(let o=0;o<s;o++){let r={};i[o]=r,r.blink=!!ms(e),z+=1,r.id=Rt(e),z+=2;let l=[];r.pos=l,l[0]=Rt(e),z+=2;let a=he(e);for(let c=1;c<a;c++)l[c]=Rt(e),z+=2}return n}},e3={decode:t=>{let e=t,n={};z=0,n._header=De(e),z+=1;let i=[];n.messages=i;let s=he(e);for(let o=0;o<s;o++){let r={};i[o]=r,r.channel=zn(e),r.clan=zn(e),r.class=De(e),z+=1,r.faction=De(e),z+=1,r.from=zn(e),r.id=ho(e),z+=4,r.level=De(e),z+=1,r.message=zn(e),r.subscribed=De(e),z+=1}return n}},t3={decode:t=>{let e=t,n={};return z=0,n._header=De(e),z+=1,n.world=zn(e),n}},n3={decode:t=>{let e=t,n={};z=0,n._header=De(e),z+=1;let i=[];n.messages=i;let s=he(e);for(let o=0;o<s;o++){let r={};i[o]=r,r.message=zn(e),r.type=zn(e)}return n}},i3={decode:t=>{let e=t,n={};return z=0,n._header=De(e),z+=1,n.file=zn(e),n.playerId=Rt(e),z+=2,n.tickId=ho(e),z+=4,n.world=zn(e),n}},s3={decode:t=>{let e=t,n={};return z=0,n._header=De(e),z+=1,n.pos=Rt(e),z+=2,n}},o3={decode:t=>{let e=t,n={};return z=0,n._header=De(e),z+=1,n.id=De(e),z+=1,n},encode:t=>{let e=t,n=0;n+=1,n+=1;let i=new Uint8Array(n);return z=0,js(i,e._header),js(i,e.id),i}};var r3={decode:t=>{let e=t,n={};z=0;let i=[];n.aabb=i;let s=he(e);for(let F=0;F<s;F++)i[F]=rt(e),z+=4;let o=[];n.area=o;let r=he(e);for(let F=0;F<r;F++)o[F]=Rt(e),z+=2;let l=[];n.environment=l;let a=he(e);for(let F=0;F<a;F++)l[F]=Rt(e),z+=2;let c=[];n.holes=c;let f=he(e);for(let F=0;F<f;F++)c[F]=Rt(e),z+=2;let u=[];n.props=u;let m=he(e);for(let F=0;F<m;F++){let M={};u[F]=M,M.id=ho(e),z+=4,M.rx=ap(e),z+=2,M.ry=ap(e),z+=2,M.rz=ap(e),z+=2,M.scale=Rt(e),z+=2,M.x=Rt(e),z+=2,M.y=ho(e),z+=4,M.z=Rt(e),z+=2}let g=[];n.shore=g;let v=he(e);for(let F=0;F<v;F++)g[F]=Rt(e),z+=2;n.terrain=Rb(e);let _=[];n.texture=_;let b=he(e);for(let F=0;F<b;F++)_[F]=Rb(e);let y=[];n.textureid=y;let k=he(e);for(let F=0;F<k;F++){let M=[];y[F]=M;let D=he(e);for(let R=0;R<D;R++)M[R]=Rt(e),z+=2}let S=[];n.water=S;let A=he(e);for(let F=0;F<A;F++)S[F]=Rt(e),z+=2;return n}},l3={decode:t=>{let e=t,n={};z=0;let i=[];n.color=i;let s=he(e);for(let y=0;y<s;y++)i[y]=De(e),z+=1;let o=[];n.flags=o;let r=he(e);for(let y=0;y<r;y++)o[y]=De(e),z+=1;let l=[];n.index=l;let a=he(e);for(let y=0;y<a;y++)l[y]=he(e);let c=[];n.indexInvisible=c;let f=he(e);for(let y=0;y<f;y++)c[y]=he(e);let u=[];n.normal=u;let m=he(e);for(let y=0;y<m;y++)u[y]=ms(e),z+=1;let g=[];n.position=g;let v=he(e);for(let y=0;y<v;y++)g[y]=ap(e),z+=2;n.sx=ho(e),z+=4,n.sy=ho(e),z+=4,n.sz=ho(e),z+=4;let _=[];n.uv=_;let b=he(e);for(let y=0;y<b;y++)_[y]=Rt(e),z+=2;return n}},a3={decode:t=>{let e=t,n={};z=0;let i=[];n.animations=i;let s=he(e);for(let Q=0;Q<s;Q++){let U={};i[Q]=U,U.duration=rt(e),z+=4;let fe=[];U.effects=fe;let je=he(e);for(let qe=0;qe<je;qe++){let Re={};fe[qe]=Re,Re.body=De(e),z+=1,Re.end=rt(e),z+=4,Re.id=De(e),z+=1,Re.priority=De(e),z+=1,Re.start=rt(e),z+=4,Re.type=De(e),z+=1}U.id=De(e),z+=1,U.movement=De(e),z+=1,U.priority=De(e),z+=1;let Ie=[];U.sounds=Ie;let ye=he(e);for(let qe=0;qe<ye;qe++){let Re={};Ie[qe]=Re,Re.end=De(e),z+=1,Re.id=De(e),z+=1,Re.start=rt(e),z+=4}}let o=[];n.areas=o;let r=he(e);for(let Q=0;Q<r;Q++){let U={};o[Q]=U,U.ambientday=De(e),z+=1,U.ambientnight=De(e),z+=1,U.id=De(e),z+=1,U.music=De(e),z+=1,U.name=zn(e)}let l=[];n.arenas=l;let a=he(e);for(let Q=0;Q<a;Q++){let U={};l[Q]=U,U.group=De(e),z+=1,U.id=De(e),z+=1;let fe=[];U.pos=fe;let je=he(e);for(let Ie=0;Ie<je;Ie++)fe[Ie]=rt(e),z+=4;U.radius=De(e),z+=1,U.rot=rt(e),z+=4,U.type=De(e),z+=1,U.world=De(e),z+=1}let c=[];n.classes=c;let f=he(e);for(let Q=0;Q<f;Q++){let U={};c[Q]=U;let fe=[];U.baseStats=fe;let je=he(e);for(let Qe=0;Qe<je;Qe++){let Et=[];fe[Qe]=Et;let be=he(e);for(let Je=0;Je<be;Je++)Et[Je]=De(e),z+=1}let Ie=[];U.engineSkills=Ie;let ye=he(e);for(let Qe=0;Qe<ye;Qe++)Ie[Qe]=De(e),z+=1;U.id=De(e),z+=1;let qe=[];U.startSkills=qe;let Re=he(e);for(let Qe=0;Qe<Re;Qe++)qe[Qe]=De(e),z+=1;let pt=[];U.statPerLevel=pt;let wt=he(e);for(let Qe=0;Qe<wt;Qe++){let Et=[];pt[Qe]=Et;let be=he(e);for(let Je=0;Je<be;Je++)Et[Je]=De(e),z+=1}}let u=[];n.creatures=u;let m=he(e);for(let Q=0;Q<m;Q++){let U={};u[Q]=U;let fe=[];U.col1=fe;let je=he(e);for(let qe=0;qe<je;qe++)fe[qe]=rt(e),z+=4;let Ie=[];U.col2=Ie;let ye=he(e);for(let qe=0;qe<ye;qe++)Ie[qe]=rt(e),z+=4;U.drProtection=!!ms(e),z+=1,U.faction=De(e),z+=1,U.id=Rt(e),z+=2,U.level=De(e),z+=1,U.name=zn(e),U.skin=De(e),z+=1,U.type=De(e),z+=1}let g=[];n.creaturesConjurer=g;let v=he(e);for(let Q=0;Q<v;Q++){let U={};g[Q]=U,U.id=Rt(e),z+=2,U.war=!!ms(e),z+=1}let _=[];n.creaturesMonster=_;let b=he(e);for(let Q=0;Q<b;Q++){let U={};_[Q]=U,U.aggroMode=De(e),z+=1,U.id=Rt(e),z+=2,U.rarity=De(e),z+=1}let y=[];n.creaturesTrader=y;let k=he(e);for(let Q=0;Q<k;Q++){let U={};y[Q]=U,U.id=Rt(e),z+=2,U.shop=De(e),z+=1}let S=[];n.effects=S;let A=he(e);for(let Q=0;Q<A;Q++){let U={};S[Q]=U,U.duration=rt(e),z+=4;let fe=[];U.events=fe;let je=he(e);for(let qe=0;qe<je;qe++){let Re={};fe[qe]=Re,Re.fraction=rt(e),z+=4,Re.id=De(e),z+=1;let pt=[];Re.params=pt;let wt=he(e);for(let Qe=0;Qe<wt;Qe++)pt[Qe]=rt(e),z+=4}U.id=De(e),z+=1;let Ie=[];U.periods=Ie;let ye=he(e);for(let qe=0;qe<ye;qe++){let Re={};Ie[qe]=Re,Re.fractionEnd=rt(e),z+=4,Re.fractionStart=rt(e),z+=4,Re.id=De(e),z+=1;let pt=[];Re.modifiers=pt;let wt=he(e);for(let be=0;be<wt;be++){let Je={};pt[be]=Je,Je.id=De(e),z+=1,Je.mode=De(e),z+=1;let yt=[];Je.params=yt;let St=he(e);for(let Ae=0;Ae<St;Ae++)yt[Ae]=rt(e),z+=4}let Qe=[];Re.params=Qe;let Et=he(e);for(let be=0;be<Et;be++)Qe[be]=rt(e),z+=4}}let F=[];n.environments=F;let M=he(e);for(let Q=0;Q<M;Q++){let U={};F[Q]=U;let fe=[];U.ambient=fe;let je=he(e);for(let we=0;we<je;we++){let ot=[];fe[we]=ot;let Xe=he(e);for(let ut=0;ut<Xe;ut++)ot[ut]=rt(e),z+=4}let Ie=[];U.bloom=Ie;let ye=he(e);for(let we=0;we<ye;we++)Ie[we]=rt(e),z+=4;let qe=[];U.clouds=qe;let Re=he(e);for(let we=0;we<Re;we++){let ot=[];qe[we]=ot;let Xe=he(e);for(let ut=0;ut<Xe;ut++)ot[ut]=rt(e),z+=4}let pt=[];U.direct=pt;let wt=he(e);for(let we=0;we<wt;we++){let ot=[];pt[we]=ot;let Xe=he(e);for(let ut=0;ut<Xe;ut++)ot[ut]=rt(e),z+=4}let Qe=[];U.fog=Qe;let Et=he(e);for(let we=0;we<Et;we++){let ot=[];Qe[we]=ot;let Xe=he(e);for(let ut=0;ut<Xe;ut++)ot[ut]=rt(e),z+=4}let be=[];U.horizon=be;let Je=he(e);for(let we=0;we<Je;we++){let ot=[];be[we]=ot;let Xe=he(e);for(let ut=0;ut<Xe;ut++)ot[ut]=rt(e),z+=4}U.id=De(e),z+=1;let yt=[];U.skybot=yt;let St=he(e);for(let we=0;we<St;we++){let ot=[];yt[we]=ot;let Xe=he(e);for(let ut=0;ut<Xe;ut++)ot[ut]=rt(e),z+=4}let Ae=[];U.skymid=Ae;let ft=he(e);for(let we=0;we<ft;we++){let ot=[];Ae[we]=ot;let Xe=he(e);for(let ut=0;ut<Xe;ut++)ot[ut]=rt(e),z+=4}let Ut=[];U.skytop=Ut;let Ve=he(e);for(let we=0;we<Ve;we++){let ot=[];Ut[we]=ot;let Xe=he(e);for(let ut=0;ut<Xe;ut++)ot[ut]=rt(e),z+=4}let Ct=[];U.sun=Ct;let Vt=he(e);for(let we=0;we<Vt;we++){let ot=[];Ct[we]=ot;let Xe=he(e);for(let ut=0;ut<Xe;ut++)ot[ut]=rt(e),z+=4}let We=[];U.water=We;let Ke=he(e);for(let we=0;we<Ke;we++){let ot=[];We[we]=ot;let Xe=he(e);for(let ut=0;ut<Xe;ut++)ot[ut]=rt(e),z+=4}}let D=[];n.files=D;let R=he(e);for(let Q=0;Q<R;Q++){let U={};D[Q]=U,U.ext=De(e),z+=1,U.id=Rt(e),z+=2,U.type=De(e),z+=1}let E=[];n.filesExt=E;let L=he(e);for(let Q=0;Q<L;Q++)E[Q]=zn(e);let B=[];n.foliages=B;let I=he(e);for(let Q=0;Q<I;Q++){let U={};B[Q]=U,U.id=De(e),z+=1;let fe=[];U.nodes=fe;let je=he(e);for(let Ie=0;Ie<je;Ie++){let ye={};fe[Ie]=ye,ye.arc=rt(e),z+=4;let qe=[];ye.end=qe;let Re=he(e);for(let be=0;be<Re;be++)qe[be]=rt(e),z+=4;ye.geotype=De(e),z+=1,ye.jitter_radius=rt(e),z+=4,ye.jitter_rotation=rt(e),z+=4,ye.jitter_size=rt(e),z+=4,ye.jitter_slant=rt(e),z+=4,ye.jitter_y=rt(e),z+=4,ye.leafCount=De(e),z+=1;let pt=[];ye.points=pt;let wt=he(e);for(let be=0;be<wt;be++)pt[be]=rt(e),z+=4;ye.radius=rt(e),z+=4,ye.size=rt(e),z+=4,ye.slant=rt(e),z+=4;let Qe=[];ye.start=Qe;let Et=he(e);for(let be=0;be<Et;be++)Qe[be]=rt(e),z+=4;ye.y=rt(e),z+=4}U.seed=ho(e),z+=4,U.texture=Rt(e),z+=2,U.type=De(e),z+=1}let N=[];n.meshes=N;let j=he(e);for(let Q=0;Q<j;Q++){let U={};N[Q]=U,U.cull=De(e),z+=1;let fe=[];U.effects=fe;let je=he(e);for(let Ie=0;Ie<je;Ie++){let ye={};fe[Ie]=ye,ye.id=De(e),z+=1;let qe=[];ye.pos=qe;let Re=he(e);for(let be=0;be<Re;be++)qe[be]=rt(e),z+=4;let pt=[];ye.rot=pt;let wt=he(e);for(let be=0;be<wt;be++)pt[be]=rt(e),z+=4;let Qe=[];ye.scale=Qe;let Et=he(e);for(let be=0;be<Et;be++)Qe[be]=rt(e),z+=4}U.geometry=Rt(e),z+=2,U.id=Rt(e),z+=2,U.shader=De(e),z+=1,U.shadow=De(e),z+=1,U.texture=Rt(e),z+=2}let W=[];n.minimap=W;let O=he(e);for(let Q=0;Q<O;Q++){let U={};W[Q]=U,U.img=Rt(e),z+=2;let fe=[];U.pos=fe;let je=he(e);for(let Ie=0;Ie<je;Ie++)fe[Ie]=Rt(e),z+=2;U.world=De(e),z+=1}let se=[];n.particles=se;let X=he(e);for(let Q=0;Q<X;Q++){let U={};se[Q]=U;let fe=[];U.acc=fe;let je=he(e);for(let pt=0;pt<je;pt++)fe[pt]=rt(e),z+=4;U.blend=De(e),z+=1;let Ie=[];U.colEnd=Ie;let ye=he(e);for(let pt=0;pt<ye;pt++)Ie[pt]=rt(e),z+=4;let qe=[];U.colStart=qe;let Re=he(e);for(let pt=0;pt<Re;pt++)qe[pt]=rt(e),z+=4;U.duration=rt(e),z+=4,U.friction=rt(e),z+=4,U.id=De(e),z+=1,U.idEnd=De(e),z+=1,U.idLoop=De(e),z+=1,U.idStart=De(e),z+=1,U.interp=De(e),z+=1,U.randomRota=rt(e),z+=4,U.rota=rt(e),z+=4,U.rotaEnd=rt(e),z+=4,U.scaleEnd=rt(e),z+=4,U.scaleStart=rt(e),z+=4}let oe=[];n.ribbons=oe;let ce=he(e);for(let Q=0;Q<ce;Q++){let U={};oe[Q]=U;let fe=[];U.colEnd=fe;let je=he(e);for(let qe=0;qe<je;qe++)fe[qe]=rt(e),z+=4;let Ie=[];U.colStart=Ie;let ye=he(e);for(let qe=0;qe<ye;qe++)Ie[qe]=rt(e),z+=4;U.id=De(e),z+=1,U.interval=rt(e),z+=4,U.steps=De(e),z+=1,U.texture=Rt(e),z+=2}let xe=[];n.skeletons=xe;let pe=he(e);for(let Q=0;Q<pe;Q++){let U={};xe[Q]=U,U.cape=!!ms(e),z+=1,U.groundNormal=!!ms(e),z+=1,U.height=rt(e),z+=4,U.helmet=!!ms(e),z+=1,U.id=De(e),z+=1,U.shoulders=!!ms(e),z+=1}let $e=[];n.skins=$e;let Ee=he(e);for(let Q=0;Q<Ee;Q++){let U={};$e[Q]=U,U.animset=De(e),z+=1;let fe=[];U.body=fe;let je=he(e);for(let Ae=0;Ae<je;Ae++){let ft={};fe[Ae]=ft,ft.bid=De(e),z+=1;let Ut=[];ft.col=Ut;let Ve=he(e);for(let Xe=0;Xe<Ve;Xe++)Ut[Xe]=rt(e),z+=4;ft.colMode=De(e),z+=1,ft.lod=De(e),z+=1,ft.mid=Rt(e),z+=2,ft.pid=ms(e),z+=1;let Ct=[];ft.pos=Ct;let Vt=he(e);for(let Xe=0;Xe<Vt;Xe++)Ct[Xe]=rt(e),z+=4;let We=[];ft.rot=We;let Ke=he(e);for(let Xe=0;Xe<Ke;Xe++)We[Xe]=rt(e),z+=4;let we=[];ft.scl=we;let ot=he(e);for(let Xe=0;Xe<ot;Xe++)we[Xe]=rt(e),z+=4;ft.ts=De(e),z+=1}U.capeswing=De(e),z+=1;let Ie=[];U.colPrim=Ie;let ye=he(e);for(let Ae=0;Ae<ye;Ae++)Ie[Ae]=rt(e),z+=4;let qe=[];U.colSec=qe;let Re=he(e);for(let Ae=0;Ae<Re;Ae++)qe[Ae]=rt(e),z+=4;let pt=[];U.effects=pt;let wt=he(e);for(let Ae=0;Ae<wt;Ae++){let ft={};pt[Ae]=ft,ft.bid=De(e),z+=1,ft.id=De(e),z+=1}U.id=De(e),z+=1,U.mountPart=De(e),z+=1;let Qe=[];U.mountPos=Qe;let Et=he(e);for(let Ae=0;Ae<Et;Ae++)Qe[Ae]=rt(e),z+=4;let be=[];U.sheathedPos=be;let Je=he(e);for(let Ae=0;Ae<Je;Ae++)be[Ae]=rt(e),z+=4;U.size=rt(e),z+=4,U.skeleton=De(e),z+=1,U.soundset=De(e),z+=1;let yt=[];U.unsheathedPos=yt;let St=he(e);for(let Ae=0;Ae<St;Ae++)yt[Ae]=rt(e),z+=4}let Fe=[];n.sounds=Fe;let _e=he(e);for(let Q=0;Q<_e;Q++){let U={};Fe[Q]=U,U.distance=rt(e),z+=4;let fe=[];U.files=fe;let je=he(e);for(let Ie=0;Ie<je;Ie++)fe[Ie]=Rt(e),z+=2;U.id=De(e),z+=1}let H=[];n.soundsetSteps=H;let Le=he(e);for(let Q=0;Q<Le;Q++){let U={};H[Q]=U,U.id=De(e),z+=1;let fe=[];U.steps=fe;let je=he(e);for(let Ie=0;Ie<je;Ie++)fe[Ie]=De(e),z+=1}let Oe=[];n.soundsets=Oe;let He=he(e);for(let Q=0;Q<He;Q++){let U={};Oe[Q]=U,U.id=De(e),z+=1;let fe=[];U.sounds=fe;let je=he(e);for(let Ie=0;Ie<je;Ie++)fe[Ie]=De(e),z+=1;U.steps=De(e),z+=1}let Ye=[];n.terrains=Ye;let Ze=he(e);for(let Q=0;Q<Ze;Q++){let U={};Ye[Q]=U,U.brightest=De(e),z+=1,U.darkest=De(e),z+=1;let fe=[];U.foliage=fe;let je=he(e);for(let Ie=0;Ie<je;Ie++){let ye=[];fe[Ie]=ye;let qe=he(e);for(let Re=0;Re<qe;Re++)ye[Re]=De(e),z+=1}U.id=De(e),z+=1,U.scale=De(e),z+=1,U.spec=De(e),z+=1,U.texture=Rt(e),z+=2}let ge=[];n.traderShopItems=ge;let ae=he(e);for(let Q=0;Q<ae;Q++){let U={};ge[Q]=U,U.bind=De(e),z+=1,U.id=De(e),z+=1,U.shop=De(e),z+=1,U.stacks=De(e),z+=1,U.tier=Rt(e),z+=2,U.type=zn(e),U.upgrade=De(e),z+=1}let Be=[];n.worlds=Be;let J=he(e);for(let Q=0;Q<J;Q++){let U={};Be[Q]=U,U.chunkAmount=De(e),z+=1,U.id=De(e),z+=1,U.minlevel=De(e),z+=1,U.music=De(e),z+=1,U.name=zn(e)}return n}};var Ft={clientPlayerInput:Nb,clientPlayerChangeTarget:jb,clientPlayerSkill:Wb,clientPlayerEnvSkill:Gb,clientPlayerInteract:Hb,clientCommand:Yb,serverOnClientConnect:i3,serverEntityDelta:Xb,serverPartyUpdate:Qb,serverWarUpdate:Zb,serverPartyPositions:Jb,serverChangeWorld:t3,serverMapUpdate:Kb,serverChat:e3,serverSystemMessage:n3,serverQueue:s3,ping:o3},va={chunk:r3,gamedata:a3,modelformat:l3},c3=[],pT=0;for(let t in Ft)Ft[t]&&(Ft[t].header=pT++,Ft[t].packData=function(e){return e._header=this.header,this.encode(e)},c3.push(Ft[t]));var f3=t=>{if(t.length===0)return;let e=c3[t[0]];if(!(e&&e.maxSize<t.length))return e};var V,fp=[0,1,0];var bt=[0,0,0],yn=[0,0,0],Qr=[0,0,0],ps=[0,0,0],up=[0,0,0],hf=[0,0,0];var go=[0,0,0,0];var Bn=[0,0],Ws=[0,0];var AO=fs(),u3=t=>{V=t},vo=0,m3=t=>vo=t;var Nh={};Xn(Nh,{onWorldEnter:()=>hT,parseBandwidth:()=>Oh,parseFrameDelta:()=>p3,parseLatency:()=>$h,tick:()=>dT});var vt=(t,e,n)=>Math.min(Math.max(t,e),n),_a=(t,e)=>(t%e+e)%e,gf=(t,e,n)=>{let i=vt((n-t)/(e-t),0,1);return i*i*(3-2*i)},ds=(t,e,n,i,s)=>i+(vt(t,e,n)-e)/(n-e)*(s-i),vf=(t,e,n)=>e+vt(t,0,1)*(n-e),Qt={linear:t=>t,easeInQuad:t=>t*t,easeInQuart:t=>t**4,easeOutQuad:t=>t*(2-t),easeOutExpo:t=>-Math.pow(2,-10*t)+1,easeOutFlick:t=>1-Math.pow(1-t,10),sin:t=>Math.sin(t*3.14),sinReverse:t=>1-Math.sin(t*3.14),easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeBounce:t=>t<.36363636363636365?7.5625*t*t:t<.7272727272727273?7.5625*(t-=.5454545454545454)*t+.75:t<.9090909090909091?7.5625*(t-=.8181818181818182)*t+.9375:7.5625*(t-=.9545454545454546)*t+.984375,anticipate:t=>-1/(1+Math.exp((t-.5)*50))+Math.sin((t-.5)*6.2)*1.4*(1-t*.5)+1,flicker:t=>Math.sin(t*3.14)*(1+Math.sin(t*38)*.3)},Go=(t,e,n)=>t<e?ds(t,0,e,0,n):ds(Qt.easeInOutCubic(ds(t,e,1,0,1)),0,1,n,1),ba=[Qt.linear,Qt.easeInQuad,Qt.easeInQuart,Qt.easeOutQuad,Qt.easeOutExpo,Qt.easeOutFlick,Qt.sin,Qt.sinReverse,Qt.easeInOutCubic,Qt.easeInOutQuint,Qt.easeBounce,Qt.anticipate,Qt.flicker];var kt=class{constructor(e=0,n=0){this.start=e,this.end=e+n,this.duration=n}done(e){return e>this.end}fraction(e){return vt(1-(this.end-e)/this.duration,0,1)}remaining(e){return this.end-e}passed(e){return e-this.start}reset(e,n=this.duration){return this.start=e,this.end=e+n,this.duration=n,!0}set(e,n){return this.start=e,this.end=n,this.duration=this.end-this.start,!0}};var zh=.016,p3=t=>{zh=(zh*10+t)/11},d3=0,qh=0,Oh=t=>{d3=t},Bh=0,$h=t=>{Bh=(Bh*2+t)/3},Rh=0,Uh=new kt(0,.05),dT=t=>{p3(t),le.showFpsPing&&Uh.done(V.time)&&(qh=(qh*10+d3)/11,Rh=(Rh*5+V.netData.length)/6,Uh.reset(V.time),cm.update(e=>(e[0]=vt(Bh>>0,1,999),e[1]=(1/zh).toFixed(1),e[2]=(qh/1e3).toFixed(1),e[3]=V.player?`${~~V.player.pos[0]} ${~~V.player.pos[1]} ${~~V.player.pos[2]}`:"-",e[4]=Rh.toFixed(1),e)))},hT=t=>{Uh.reset(t.time)};var gT=performance,_f=()=>gT.now();var hs,Wh=0,h3=0,_3=(t,e)=>{Un(Ft.serverOnClientConnect.header,n=>{t(Ft.serverOnClientConnect.decode(n))}),Un("close",n=>{e(n.code)})},Zr={open:[],close:[]};for(let t in Ft)Zr[Ft[t].header]=[];var vT=t=>{},_T=t=>{console.log("Connected"),Wh=1;for(let e=0,n=Zr.open.length;e<n;++e)Zr.open[e](t)},bT=t=>{console.log("Connection closed:",t.reason,t.code),Wh=0,hs.close(),hs=void 0;for(let e=0,n=Zr.close.length;e<n;++e)Zr.close[e](t)},yT=t=>{kT(t.data.byteLength),t=new Uint8Array(t.data);let e=f3(t),n=e&&Zr[e.header];if(n)for(let i=0,s=n.length;i<s;++i)n[i](t)},Un=(t,e)=>{Zr[t].push(e)},Si=t=>{hs===void 0||Wh!==1||hs.send(t)},b3=t=>{if(hs!==void 0)return;let e="game1.hordes.io";hs=new WebSocket(`wss://${e}:`+t+"/play"),hs.binaryType="arraybuffer",hs.onerror=vT,hs.onopen=_T,hs.onclose=bT,hs.onmessage=yT};var g3=0,jh=0,kT=t=>{jh+=t,vo-g3>1e3/4&&(h3=jh*4,jh=0,g3=vo,Oh(h3))},y3=()=>{le.showFpsPing&&vo-v3>(yf.length<10?100:2e3)&&(v3=vo,xT())},k3=t=>{if(yf[t.id]){let e=_f();if(yf[t.id]<=e){let n=e-yf[t.id];$h(n)}}},bf=0,v3=0,yf=[],xT=()=>{bf>254&&(bf=0),yf[bf]=_f(),Si(Ft.ping.packData({id:bf})),bf++};var xt=(t,e="")=>{Si(Ft.clientCommand.packData({command:t,string:e+""}))};var Kr={report:{client:!0},partyleave:{},partyinvite:{a:1},partycreate:{},time:{},bosslog:{},party:{a:1,chat:!0},clan:{a:1,chat:!0},faction:{a:1,chat:!0}},_o={itemmove:{a:2},itemdrop:{a:1},itemauctionpost:{a:2},itemauctionfind:{a:5},itemauctionbuy:{a:1},itemauctioncancel:{a:1},itemstash:{a:1},itemunstash:{a:1},itemsplithalf:{a:1},itemsplitone:{a:1},goldstash:{a:1},itemtradersell:{a:1},itemtraderbuy:{a:1},itemblacksmithupgrade:{a:1},petlootsettings:{a:2},statincrease:{a:2},skillconfig:{a:1},cancelbuff:{a:1},respawn:{},startqueue:{a:1},stopqueue:{a:1},partyaccept:{a:1},partydecline:{a:1},partykick:{a:1},partysetrole:{a:2},summonaccept:{a:1},whisper:{a:2,chat:!0},global:{a:1},...Kr};var x3=t=>{navigator.clipboard.writeText(t)};var Yh={};Xn(Yh,{addRequest:()=>ya,confirmationBasedCallback:()=>pp,onWorldDestroy:()=>FT,onWorldEnter:()=>MT,postTick:()=>wT,removeTopRequest:()=>Hh});var Gh=new kt(0,1),Gs=[],wT=(t,e)=>{Gh.done(e.time)&&(Gh.reset(e.time),Gs.length&&(Gs.forEach(n=>{w3(n,1)}),so.set(Gs)))},MT=t=>{Gh.reset(0)},FT=t=>{Gs.length=0,so.set(Gs)},ya=(t,e,n)=>{let i={title:t,text:e,choices:n};Gs.push(i),w3(i,0),so.set(Gs)},w3=(t,e)=>{for(let n=0;n<t.choices.length;++n){let i=t.choices[n];if(i.blockedTime!==void 0)i.blockedTime>1?(i.blockedTime-=e,i.unavailable=`(${i.blockedTime} s)`):i.unavailable=void 0;else if(i.nocombat&&V&&V.player&&V.player.stats){let s=~~V.player.stats.combatTimer.remaining(V.time);s>0?i.unavailable=`(Combat - ${s}s)`:i.unavailable=void 0}i.remaining!==void 0&&(i.remaining>1?(i.remaining-=e,i.additional=`(${~~i.remaining}s remaining)`):(i.additional=void 0,i.unavailable="(Timed out)"))}},Hh=()=>{Gs.length&&(Gs.shift(),so.set(Gs))},mp=!0,pp=(t,e,n,i)=>{t?mp&&(ya(n,i,[{text:n,fun:()=>{mp=!0,e()}},{text:C.ui.decline,fun:()=>{mp=!0}}]),mp=!1):e()};var dp={normal:{partyBasedHostility:!1,pvpprotect:!0,instanced:!1},arena3v3:{name:"Arena 3v3",queue:!0,instanced:!0,groupsize:3,groupcount:2,partyBasedHostility:!0,pvpprotect:!1,startTimer:30},arena5v5:{name:"Arena 5v5",startTimer:30,groupsize:5,groupcount:2,queue:!0,instanced:!0,partyBasedHostility:!0,pvpprotect:!1}};var gp={};Xn(gp,{init:()=>ST,onRemoveEntity:()=>Xh,onWorldDestroy:()=>PT,party:()=>en,postTick:()=>AT});var hp,CT=0,en=new Map,ST=()=>{Un(Ft.serverPartyUpdate.header,t=>{hp=t}),Un(Ft.serverPartyPositions.header,t=>{t=Ft.serverPartyPositions.decode(t).members,en.forEach(e=>{let n=t.find(i=>i.entityid===e.id);n&&(e.pos[0]=n.pos[0],e.pos[1]=n.pos[1])})})},AT=(t,e)=>{if(e.player!==void 0){if(hp){en.forEach(i=>{i.found=!1});let n=Ft.serverPartyUpdate.decode(hp);n.members.forEach(i=>{if(!en.has(i.name))en.set(i.name,{id:i.entityid,found:!0,pos:[0,0],local:i.world===e.id,name:i.name,buffStore:i.entityid===e.playerId?ea:ie([]),unitStore:i.entityid===e.playerId?Rs:ie({id:i.entityid,name:i.name,level:i.level,class:i.class,world:i.world,role:i.role,party:e.player.party,faction:e.player.faction,type:0,visible:!0,alive:!0,rarity:!1,range:!1})});else{let s=en.get(i.name);i.entityid!==e.playerId&&(s.local=i.world===e.id,s.unitStore.update(o=>(o.id=i.entityid,o.name=i.name,o.level=i.level,o.class=i.class,o.world=i.world,o.party=e.player.party,o.faction=e.player.faction,o.role=i.role,o))),s.id=i.entityid,s.found=!0}}),en.forEach((i,s)=>{i.found||en.delete(s)}),Kl.set(Array.from(en.values()).filter(i=>le.showSelfInParty||i.id!==e.playerId)),Qn.update(i=>(i.membercount=n.members.length,i.queues=n.queues,le.partyinfo=i,i)),hp=void 0}if(e.player.party>0)if(!le.partyBuffLimitUpdateRate)e.entities.type[0].forEach(n=>{n.party===e.player.party&&(n.buffDisplayDirty=!0)});else{let n=Array.from(en.values())[CT++%en.size];if(n){let i=e.entity(n.id);i!==void 0&&i.id!==e.playerId&&(i.buffDisplayDirty=!0)}}}},Xh=t=>{if(en.has(t.name)){let e=en.get(t.name);e.unitStore.update(n=>(n.timedSkill=void 0,n.timedCast=void 0,n.alive=!0,n.range=!1,n.mp=n.hp=n.hpMax=n.mpMax=0,n)),e.buffStore.set([])}},PT=()=>{en.clear()};var S1={};Xn(S1,{onWorldEnter:()=>n7,postTick:()=>i7,steps:()=>Pi,tut:()=>tn});function M3(t,e){return t[0]=e[0],t[1]=e[1],t}function di(t,e,n){return t[0]=e,t[1]=n,t}function F3(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function ka(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function kf(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function Qh(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t}function xa(t){let e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function C3(t){let e=t[0],n=t[1];return e*e+n*n}function vp(t,e){let n=e[0],i=e[1],s=n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t}function S3(t,e,n){let i=Math.sin(n),s=Math.cos(n);return t[0]=e[1]*i+e[0]*s,t[1]=e[1]*s-e[0]*i,t}var _p=[0,0,0],A3=(t,e,n,i,s)=>{if(t.length>0){Y(e,1/0,1/0,1/0),Y(n,-1/0,-1/0,-1/0);for(let o=0,r=t.length;o<r;o+=3){let l=t[o],a=t[o+1],c=t[o+2];e[0]=Math.min(l,e[0]),e[1]=Math.min(a,e[1]),e[2]=Math.min(c,e[2]),n[0]=Math.max(l,n[0]),n[1]=Math.max(a,n[1]),n[2]=Math.max(c,n[2])}}else Y(e,0,0,0),Y(n,-0,-0,-0);Xt(s,n,e),dn(i,Rn(i,e,n),.5)},TT=t=>{A3(t.attributes.position.data,t.bounds.min,t.bounds.max,t.bounds.center,t.bounds.scale),t.bounds.initiated=!0},ET=t=>{let e=0;for(let n=0,i=t.attributes.position.data.length;n<i;n+=3)_p[0]=t.attributes.position.data[n],_p[1]=t.attributes.position.data[n+1],_p[2]=t.attributes.position.data[n+2],e=Math.max(e,Kn(t.bounds.center,_p));t.bounds.radius=Math.sqrt(e)},P3=t=>{t.bounds.initiated||TT(t),ET(t)};var DT=1,IT=1,Cn=t=>{let e={id:DT++,vao:M_(),vaoNeedsUpdate:!0,attributes:t,drawRangeStart:0,drawRangeCount:0,attrRange:0,instancedCount:0,isInstanced:!1,bounds:{min:[0,0,0],max:[0,0,0],center:[0,0,0],scale:[0,0,0],radius:1/0,initiated:!1}};return Zh(e,e.attributes),e},hi=(t,e)=>{et.boundBuffer!==e.id&&($.bindBuffer(e.target,e.buffer),et.boundBuffer=e.id),e.bufferLen<e.data.length?(e.bufferLen=e.data.length,$.bufferData(e.target,e.data,e.bufferMode,0,e.data.length)):$.bufferSubData(e.target,0,e.data,0,e.data.length)},bp=(t,e,n)=>{et.boundBuffer!==e.id&&($.bindBuffer(e.target,e.buffer),et.boundBuffer=e.id);let i=n*e.size;e.bufferLen<i?(e.bufferLen=i,$.bufferData(e.target,e.data,e.bufferMode,0,i)):$.bufferSubData(e.target,0,e.data,0,i)},VT=(t,e,n)=>{n.id=IT++,n.size=n.size||1,n.type=n.type||(n.data.constructor===Float32Array?$.FLOAT:n.data.constructor===Uint16Array?$.UNSIGNED_SHORT:$.UNSIGNED_INT),n.target=e==="index"?$.ELEMENT_ARRAY_BUFFER:$.ARRAY_BUFFER,n.normalize=n.normalize||!1,n.count=n.data.length/n.size,n.divisor=n.instanced?typeof n.instanced=="number"?n.instanced:1:0,n.bufferMode=n.bufferMode||$.STATIC_DRAW,n.bufferLen=0,n.buffer||(n.buffer=$.createBuffer()),hi(t,n)},LT=(t,e,n)=>{if(t.attributes[e]=n,n.divisor){if(t.isInstanced=!0,t.instancedCount&&t.instancedCount!==n.count*n.divisor)return t.instancedCount=Math.min(t.instancedCount,n.count*n.divisor);t.instancedCount=n.count*n.divisor}else e==="index"?t.drawRangeCount=n.count:t.attributes.index||(t.drawRangeCount=Math.max(t.drawRangeCount,n.count))},Zh=(t,e)=>{Cm(null),et.currentGeometry=-1;for(let n in e)e[n].id===void 0&&VT(t,n,e[n]),LT(t,n,e[n]);t.attributes.position&&P3(t)},E3=(t,e,n)=>{t.attrRange=n,t.drawRangeStart=e,t.drawRangeCount=n},yp=(t,e)=>{t.instancedCount=e},qT=(t,e)=>{Cm(t.vao);for(let n=0;n<e.attributeLocations.length;++n){let i=e.attributeLocations[n];if(!t.attributes[i])continue;let s=t.attributes[i];if($.bindBuffer($.ARRAY_BUFFER,s.buffer),et.boundBuffer=s.id,s.size>4){let o=s.size/4,r=o*4,l=r*4;for(let a=0;a<o;++a)$.vertexAttribPointer(n+a,o,$.FLOAT,!1,l,r*a),$.enableVertexAttribArray(n+a),ua(n+a,1)}else $.vertexAttribPointer(n,s.size,s.type,s.normalize,0,0),$.enableVertexAttribArray(n),ua(n,s.divisor)}t.attributes.index&&$.bindBuffer($.ELEMENT_ARRAY_BUFFER,t.attributes.index.buffer),t.vaoNeedsUpdate=!1},wa=(t,e)=>{et.currentGeometry!==t.id&&(t.vaoNeedsUpdate&&qT(t,e),Cm(t.vao),et.currentGeometry=t.id)},Ma=(t,e,n)=>{wa(t,e),t.isInstanced?t.attributes.index?w_(n,t.drawRangeCount,t.attributes.index.type,t.drawRangeStart,t.instancedCount):x_(n,t.drawRangeStart,t.drawRangeCount,t.instancedCount):t.attributes.index?$.drawElements(n,t.drawRangeCount,t.attributes.index.type,t.drawRangeStart):$.drawArrays(n,t.drawRangeStart,t.drawRangeCount)};var RT=1,cn=({vertex:t,fragment:e,uniforms:n={},instanced:i=[],active:s=!0,transparent:o=!1,cullFace:r=$.BACK,frontFace:l=$.CCW,depthTest:a=!0,depthWrite:c=!0,depthFunc:f=$.LESS,globalUniforms:u={},attributeLocations:m})=>{let g={id:RT++,program:$.createProgram(),active:s,transparent:o,cullFace:r,frontFace:l,depthTest:a,depthWrite:c,depthFunc:f,blendFunc:{},blendEquation:{},uniforms:n,autoUniforms:[],uniformArray:[],samplerNames:[],samplerTexUnits:[],samplerTexArray:[],samplerTextures:[],globalUniforms:u,instancedAttributes:i,attributeLocations:m};g.transparent&&!g.blendFunc.src&&wf(g,$.SRC_ALPHA,$.ONE_MINUS_SRC_ALPHA);let v=D3(t,$.VERTEX_SHADER),_=D3(e,$.FRAGMENT_SHADER);for(let b=0;b<m.length;++b)$.bindAttribLocation(g.program,b,m[b]);return $.attachShader(g.program,v),$.attachShader(g.program,_),$.linkProgram(g.program),$.deleteShader(v),$.deleteShader(_),g},I3=(t,e)=>{$.useProgram(t.program),et.currentProgram=t.id;let n=$.getProgramParameter(t.program,$.ACTIVE_UNIFORMS),i=0,s=2;for(let o=0;o<n;o++){let r=$.getActiveUniform(t.program,o),l=$.getUniformLocation(t.program,r.name);if(l===null)continue;let a=r.name.match(/(\w+)/g)[0],c=r.type,f=c===35678||c===35682||c===36289,u=c===35682;if(f){let m=r.size,g=[];for(let v=0;v<m;++v){let _=u?i++:s++;g.push(_),t.samplerNames.push(a),t.samplerTexUnits.push(_),t.samplerTexArray.push(m===1?-1:v)}m===1?$.uniform1i(l,g[0]):$.uniform1iv(l,g)}else{e[a]?t.uniforms[a]||(t.uniforms[a]=e[a]):t.uniforms[a]||(UT.has(a)||t.autoUniforms.push(a),t.uniforms[a]={value:void 0});let m={name:a,location:l,type:c,data:t.uniforms[a],fun:BT(c,t.uniforms[a].value)};t.uniformArray.push(m)}}},V3=(t,e)=>{for(let n=0;n<e.length;++n){let i=e[n],s=$.getUniformBlockIndex(t.program,i.name);s!==$.INVALID_INDEX&&i.index>=0&&$.uniformBlockBinding(t.program,s,i.index)}},Fa=(t,e)=>{e||($.useProgram(t.program),et.currentProgram=t.id),Ca(t),Kh(t.uniformArray),xf(t),Sa(t)},Vn=(t,e,n,i)=>{let s=i.samplerNames.indexOf(t);s>=0?i.samplerTextures[s+n]=e:console.log("unknown texture type",t,i)},Ca=t=>{for(let e=0;e<t.samplerNames.length;++e){let n=t.samplerNames[e],i=t.samplerTexArray[e];t.globalUniforms[n]&&t.globalUniforms[n].value&&(i<0?t.samplerTextures[e]=t.globalUniforms[n].value:t.samplerTextures[e]=t.globalUniforms[n].value[i])}},kp=(t,e)=>{for(let n=0;n<e.samplerNames.length;++n){let i=e.samplerNames[n],s=e.samplerTexArray[n];t[i]&&(s<0?e.samplerTextures[n]=t[i]:e.samplerTextures[n]=t[i][s])}},xf=t=>{for(let e=0;e<t.samplerTexUnits.length;++e){let n=t.samplerTexUnits[e],i=t.samplerTextures[e];i&&et.textureUnits[n]!==i.id&&(Nc(n),$.bindTexture(i.target,i.texture),et.textureUnits[n]=i.id)}},wf=(t,e,n,i,s)=>{t.blendFunc.src=e,t.blendFunc.dst=n,t.blendFunc.srcAlpha=i,t.blendFunc.dstAlpha=s,e&&(t.transparent=!0)},Jh={},D3=(t,e)=>{if(Jh[t]!==void 0)return Jh[t];let n=Jh[t]=$.createShader(e);return $.shaderSource(n,t),$.compileShader(n),n},Sa=t=>{t.depthTest?$c($.DEPTH_TEST):Sm($.DEPTH_TEST),t.cullFace?$c($.CULL_FACE):Sm($.CULL_FACE),t.blendFunc.src?$c($.BLEND):Sm($.BLEND),t.cullFace&&P_(t.cullFace),T_(t.frontFace),Sh(t.depthWrite),E_(t.depthFunc),t.blendFunc.src&&S_(t.blendFunc.src,t.blendFunc.dst,t.blendFunc.srcAlpha,t.blendFunc.dstAlpha),t.blendEquation.modeRGB&&A_(t.blendEquation.modeRGB,t.blendEquation.modeAlpha)},Kh=t=>{for(let e=0;e<t.length;++e){let n=t[e];zT($,n.fun,n.location,n.data.value)}};var zT=(t,e,n,i)=>{switch(e){case 12:return t.uniformMatrix4fv(n,!1,i);case 9:return t.uniform4fv(n,i);case 8:return t.uniform3fv(n,i);case 5:return t.uniform1f(n,i);case 0:return t.uniform1i(n,i);case 1:return t.uniform1iv(n,i);case 2:return t.uniform2iv(n,i);case 3:return t.uniform3iv(n,i);case 4:return t.uniform4iv(n,i);case 6:return t.uniform1fv(n,i);case 7:return t.uniform2fv(n,i);case 10:return t.uniformMatrix2fv(n,!1,i);case 11:return t.uniformMatrix3fv(n,!1,i)}},BT=(t,e)=>{switch(t){case 5126:return Array.isArray(e)?6:5;case 35664:return 7;case 35665:return 8;case 35666:return 9;case 35670:case 5124:case 35678:case 35682:case 36289:case 35680:return Array.isArray(e)?1:0;case 35671:case 35667:return 2;case 35672:case 35668:return 3;case 35673:case 35669:return 4;case 35674:return 10;case 35675:return 11;case 35676:return 12}};var UT=new Set(["projectionViewMatrix","shadowPVMatrix","modelMatrix","viewMatrix","projectionMatrix","cameraPosition"]);var OT=0,qi=(t,e,n,i=on(),s=0)=>({id:OT++,uniformData:{},transform:i,geometry:t,program:e,shadowProgram:s,mode:n}),Ki=(t,e)=>{e.uniforms.modelMatrix&&(e.uniforms.modelMatrix.value=t.transform.worldMatrix);for(let n=0;n<e.autoUniforms.length;++n){let i=e.autoUniforms[n];e.uniforms[i].value=t.uniformData[i]}kp(t.uniformData,e),Fa(e,et.currentProgram===e.id),Ma(t.geometry,e,t.mode)};function L3(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function q3(t,e,n){switch(t){case R3:return(e+3>>2)*(n+3>>2)*8;case z3:return(e+3>>2)*(n+3>>2)*16;default:return 0}}var R3=33777,z3=33778,$T=131072,NT=31,jT=1,WT=2,GT=3,HT=4,YT=7,XT=21,QT=L3("DXT1"),ZT=L3("DXT3");function B3(t){let e=new Int32Array(t,0,NT),n=e[XT],i;switch(n){case QT:i=R3;break;case ZT:i=z3;break;default:console.error("Unsupported texture"+n)}let s=1;e[WT]&$T&&(s=Math.max(1,e[YT]));let o=e[HT],r=e[GT],l=e[jT]+4;return{data:new Uint8Array(t,l),width:o,height:r,levels:s,internalFormat:i}}var KT=1,Ho=function({image:t,buffer:e,target:n=$.TEXTURE_2D,type:i=$.UNSIGNED_BYTE,format:s=$.RGBA,internalFormat:o=s,wrapS:r=$.CLAMP_TO_EDGE,wrapT:l=$.CLAMP_TO_EDGE,generateMipmaps:a=!0,minFilter:c=a?$.LINEAR_MIPMAP_LINEAR:$.LINEAR,magFilter:f=$.LINEAR,flipY:u=!0,width:m,depth:g=0,height:v=m,compareMode:_=$.NONE,compareFunc:b=$.LEQUAL,anisotropy:y=1}){return{id:KT++,image:t,buffer:e,target:n,type:i,format:s,internalFormat:o,minFilter:c,magFilter:f,wrapS:r,wrapT:l,generateMipmaps:a,flipY:u,width:m,height:v,depth:g,compareMode:_,texture:$.createTexture(),anisotropy:Math.min(Math.max(1,y),et.maxAnisotropy),needsUpdate:!0,state:{flipY:!1,minFilter:$.NEAREST_MIPMAP_LINEAR,magFilter:$.LINEAR,wrapS:$.REPEAT,wrapT:$.REPEAT,compareMode:$.NONE,anisotropy:1,image:void 0}}},U3=t=>{et.textureUnits[et.activeTextureUnit]!==t.id&&($.bindTexture(t.target,t.texture),et.textureUnits[et.activeTextureUnit]=t.id)},es=(t,e=0)=>{let n=!(t.image===t.state.image&&!t.needsUpdate);if((n||et.textureUnits[e]!==t.id)&&(Nc(e),U3(t)),!!n){if(t.needsUpdate=!1,t.flipY!==et.flipY&&($.pixelStorei($.UNPACK_FLIP_Y_WEBGL,t.flipY),et.flipY=t.flipY),t.minFilter!==t.state.minFilter&&($.texParameteri(t.target,$.TEXTURE_MIN_FILTER,t.minFilter),t.state.minFilter=t.minFilter),t.magFilter!==t.state.magFilter&&($.texParameteri(t.target,$.TEXTURE_MAG_FILTER,t.magFilter),t.state.magFilter=t.magFilter),t.wrapS!==t.state.wrapS&&($.texParameteri(t.target,$.TEXTURE_WRAP_S,t.wrapS),t.state.wrapS=t.wrapS),t.wrapT!==t.state.wrapT&&($.texParameteri(t.target,$.TEXTURE_WRAP_T,t.wrapT),t.state.wrapT=t.wrapT),t.anisotropy!==t.state.anisotropy&&($.texParameterf(t.target,Ch.TEXTURE_MAX_ANISOTROPY_EXT,t.anisotropy),t.state.anisotropy=t.anisotropy),t.compareMode!==t.state.compareMode&&($.texParameteri(t.target,$.TEXTURE_COMPARE_MODE,t.compareMode),t.state.compareMode=t.compareMode),t.image)t.image.width&&(t.width=t.image.width,t.height=t.image.height),$.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.type,t.image),t.generateMipmaps&&$.generateMipmap(t.target);else if(t.buffer){let i=0,s=t.height,o=t.width,r=t.buffer.data;for(let l=0;l<t.buffer.levels;++l){let a=q3(t.internalFormat,s,s),c=new Uint8Array(r.buffer,r.byteOffset+i,a);$.compressedTexImage2D(t.target,l,t.internalFormat,o,s,0,c),o=o>>1,s=s>>1,i+=a}}else t.target!==$.TEXTURE_2D_ARRAY?$.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.type,null):$.texImage3D(t.target,0,t.internalFormat,t.width,t.height,t.depth,0,t.format,t.type,null);t.state.image=t.image}},xp=(t,e)=>{t.anisotropy=Math.min(Math.max(1,e),et.maxAnisotropy),t.needsUpdate=!0};var O3=(t,e,n,i,s)=>{Nc(0),U3(t),t.flipY!==et.flipY&&($.pixelStorei($.UNPACK_FLIP_Y_WEBGL,t.flipY),et.flipY=t.flipY),$.texSubImage3D(t.target,0,0,0,e,n,i,1,t.format,t.type,s),t.generateMipmaps&&$.generateMipmap(t.target)};var yo=(t=$.canvas.width,e=$.canvas.height,n=1,i=!1,s=$.NONE,o=$.CLAMP_TO_EDGE,r=$.CLAMP_TO_EDGE)=>{let l=$.LINEAR,a=$.LINEAR,c={width:t,height:e,target:$.FRAMEBUFFER,buffer:$.createFramebuffer()};if($.bindFramebuffer(c.target,c.buffer),n&&(c.colorTexture=Ho({width:t,height:e,wrapS:o,wrapT:r,minFilter:l,magFilter:a,flipY:!1,generateMipmaps:!1,internalFormat:$.RGBA8}),es(c.colorTexture),$.framebufferTexture2D(c.target,$.COLOR_ATTACHMENT0,$.TEXTURE_2D,c.colorTexture.texture,0)),i){let f=s===$.COMPARE_REF_TO_TEXTURE?$.LINEAR:$.NEAREST;c.depthTexture=Ho({width:t,height:e,wrapS:o,wrapT:r,minFilter:f,magFilter:f,flipY:!1,format:$.DEPTH_COMPONENT,internalFormat:$.DEPTH_COMPONENT24,type:$.UNSIGNED_INT,generateMipmaps:!1,compareMode:s}),es(c.depthTexture),$.framebufferTexture2D(c.target,$.DEPTH_ATTACHMENT,$.TEXTURE_2D,c.depthTexture.texture,0)}return $.bindFramebuffer(c.target,null),c},Mf=(t,e,n)=>{t.colorTexture.width=e,t.colorTexture.height=n,t.colorTexture.needsUpdate=!0,es(t.colorTexture),t.depthTexture&&(t.depthTexture.width=e,t.depthTexture.height=n,t.depthTexture.needsUpdate=!0,es(t.depthTexture)),t.width=e,t.height=n};var Ot=async(t,e,n)=>{let i=await fetch(t,{method:e!==void 0?"POST":"GET",body:e?JSON.stringify(e):void 0});return i.status===500?n(await i.text()):await i.json()};var Mp=new Map,Ff=new Map,Fp=new Map,t1=new Map,n1=new Map,Aa=new Map,_s=new Map,i1=new Map,Pa=new Map,Ta=new Map,Cf=new Map,Ea=new Map,Sf=new Map,s1=new Map,o1=new Map,r1=new Map,l1=new Map,e9=new Map,a1=new Map,Af=new Map,Pf=[],Tf=[],c1=new Map,Cp=new Map;var e1=t=>{t.classes.forEach(e=>Cp.set(e.id,e)),t.files.forEach(e=>Aa.set(e.id,e)),t.particles.forEach(e=>Mp.set(e.id,e)),t.effects.forEach(e=>Ff.set(e.id,e)),t.sounds.forEach(e=>Fp.set(e.id,e)),t.soundsets.forEach(e=>t1.set(e.id,e)),t.soundsetSteps.forEach(e=>n1.set(e.id,e)),t.meshes.forEach(e=>_s.set(e.id,e)),t.ribbons.forEach(e=>i1.set(e.id,e)),t.areas.forEach(e=>Cf.set(e.id,e)),t.terrains.forEach(e=>Pa.set(e.id,e)),t.foliages.forEach(e=>Ta.set(e.id,e)),t.environments.forEach(e=>Ea.set(e.id,e)),t.animations.forEach(e=>Sf.set(e.id,e)),t.skins.forEach(e=>s1.set(e.id,e)),t.skeletons.forEach(e=>o1.set(e.id,e)),t.creatures.forEach(e=>r1.set(e.id,e)),t.creaturesMonster.forEach(e=>l1.set(e.id,e)),t.creaturesConjurer.forEach(e=>e9.set(e.id,e)),t.creaturesTrader.forEach(e=>a1.set(e.id,e)),t.traderShopItems.forEach(e=>Af.set(e.id,e)),t.worlds.forEach(e=>{c1.set(e.id,e)});for(let e=0;e<t.filesExt.length;++e)Tf.push(t.filesExt[e]);for(let e=0;e<t.minimap.length;++e)Pf.push(t.minimap[e])};var Sp=(t,e)=>{if(!Aa.has(t))return console.log("unknown file id: "+t),"";let n=Aa.get(t);return`${t}.${e||Tf[n.ext]}`};var On="webp",Gn="webp",f1="webp",u1=()=>new Promise((t,e)=>{let n=new Image;n.onerror=()=>{e()},n.onload=()=>{On=Gn=f1="avif",t(!0)},n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="}).catch(()=>{console.log("Avif not supported",navigator.userAgent)});u1();var t9=127,n9=254,m1=2**15-1,i9=2**16-1,p1=2**32-1;var N3=t=>{let e=va.modelformat.decode(t),n=m1/(p1/e.sx),i=m1/(p1/e.sy),s=m1/(p1/e.sz);for(let o=0;o<e.position.length;o+=3)e.position[o+0]=e.position[o+0]/n,e.position[o+1]=e.position[o+1]/i,e.position[o+2]=e.position[o+2]/s;for(let o=0;o<e.uv.length;++o)e.uv[o]/=i9;for(let o=0;o<e.color.length;++o)e.color[o]/=n9;for(let o=0,r=e.normal.length;o<r;o++)e.normal[o]=e.normal[o]/t9;return e};var d1=async(t,e,n,i,s,o=3)=>{switch(e.split(".").pop()){case"jpg":case"png":case"avif":case"webp":{let r=new Image;r.onload=()=>{n[e]=i(r),s(n[e],t+e),r.onload=void 0},r.src=t+e+"?v=8588529";break}default:{fetch(t+e+"?v=8588529").then(r=>{if(!r.ok)throw new Error;r.arrayBuffer().then(async l=>{n[e]=await i(l),s(n[e],t+e)})}).catch(r=>{console.log(e+" fetch failed"),o>1&&d1(t,e,n,i,s,--o)});break}}};var tl={},o9=(t,e)=>{for(let n=0,i=tl[e].length;n<i;++n)tl[e][n](...t);tl[e]=void 0},Ef=async(t,e,n,i,s)=>{n[e]?s(...n[e]):tl[t+e]?tl[t+e].push(s):(tl[t+e]=[],tl[t+e].push(s),d1(t,e,n,i,o9))},r9=t=>{let e=N3(new Uint8Array(t));return[{index:{type:5125,data:new Uint32Array(e.index)},position:{size:3,data:new Float32Array(e.position)},normal:{size:3,data:new Float32Array(e.normal)},uv:{size:2,data:new Float32Array(e.uv)},color:{size:4,data:new Float32Array(e.color)}},e]},l9={},Yo=(t,e)=>{Ef("data/assets/",Sp(t),l9,r9,e)};var Df,ko,j3=()=>{Df=qi(Cn({position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),0,$.TRIANGLES),fetch("/data/items/atlas.json?v=8588529").then(async t=>{ko=await t.json();for(let e in ko)e!="s"&&(ko[e]=ko[e].map(n=>n/ko.s))})},a9=t=>{let e=Ho({image:t,wrapS:$.REPEAT,wrapT:$.REPEAT,minFilter:$.LINEAR_MIPMAP_LINEAR,anisotropy:2**le.anisotropy});return es(e),[e]},c9=t=>{let e=B3(t),n=Ho({buffer:e,minFilter:$.LINEAR_MIPMAP_LINEAR,wrapS:$.REPEAT,wrapT:$.REPEAT,width:e.width,height:e.height,anisotropy:2**le.anisotropy,format:e.internalFormat,internalFormat:e.internalFormat});return es(n),[n]},h1={},gi=(t,e)=>{Aa.has(t)||console.log("unknown file id: "+t);let n=Aa.get(t);n.ext===3&&F_?Ef("data/assets/",`${t}.${Tf[n.ext]}`,h1,c9,e):Ef("data/assets/",`${t}.${f1||Tf[n.ext]}`,h1,a9,e)},W3,G3=(t,e,n)=>{W3=e,Ef("data/assets/",t+".ogg",h1,f9,n)},f9=async t=>[await W3.decodeAudioData(t)];var Zt=(t,e)=>t+Math.random()*(e-t),g1=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;var H3=t=>v1(t,Math.random()),v1=(t,e)=>t[Math.floor(e*t.length)];var gn,Qo=[],Xo=new Map,xo=new Map,Ap=new Set,Q3=t=>{gn&&(u9(),m9(t),Ap.clear())},u9=()=>{Z3(gn.listener,gt.transform.worldMatrix),vm(go,Gt.worldMatrix),Y(bt,0,0,1),kh(bt,bt,go),Y(yn,0,1,0),kh(yn,yn,go),gn.listener.setOrientation(bt[0],bt[1],bt[2],yn[0],yn[1],yn[2])},m9=t=>{let e=0,n=0;for(;n<Qo.length;){let i=Qo[n];i.ended?p9(i.id):(Qo[e]=i,e++),++n}Qo.length=e},Z3=(t,e)=>{t.setPosition(e[12],e[13],e[14])},J3=function(){this.ended=!0},p9=t=>{xo.set(t,Math.max(0,xo.get(t)-1))},Y3=(t,e)=>{if(!xo.has(t))xo.set(t,1);else{if(xo.get(t)>=e)return!1;xo.set(t,xo.get(t)+1)}return!0},_1={},K3=(t,e)=>{let n=H3(t);_1[n]!==void 0?e.buffer=_1[n]:G3(n,gn,i=>{_1[n]=i,e.buffer=i})},Hs=(t,e,n,i,s)=>{if(gn===void 0||gn.state=="suspended"||Ap.has(t))return;if(n===0){if(Qo.length>35||(Y(bt,e.worldMatrix[12],e.worldMatrix[13],e.worldMatrix[14]),1/((xo.get(t)||0)+10+Tr(Gt.position,bt))*1e3/(Qo.length+20)**1.2<.4)||!Y3(t,2))return}else if(n===1&&!Y3(t,5))return;let o=Fp.get(t);if(!o){console.log("unknown sound id:"+t);return}Ap.add(t);let r=gn.createBufferSource();r.id=t,r.loop=i,r.playbackRate.value=s,K3(o.files,r);let l=Xo.get(n).in;return r.panner=gn.createPanner(),r.panner.distanceModel="exponential",r.panner.refDistance=o.distance,r.panner.rolloffFactor=1,Z3(r.panner,e.worldMatrix),r.connect(r.panner),r.panner.connect(l),r.start(0,0),r.onended=J3,Qo.push(r),r},ey=t=>{gn=new(window.AudioContext||window.webkitAudioContext),["ambience","music"].forEach((o,r)=>{let l=gn.createGain();l.connect(gn.destination),Xo.set(2+r,{gain:l,in:l}),Ns[o+"Volume"].subscribe(a=>{Xo.get(2+r).gain.gain.value=(a/100)**2})});let e=gn.createDynamicsCompressor(),n=gn.createGain();e.threshold.value=0,e.knee.value=0,e.ratio.value=15,e.attack.value=.005,e.release.value=.05,e.connect(n),n.connect(gn.destination);let i=gn.createGain();i.gain.value=2,i.connect(e);let s=gn.createGain();s.gain.value=.4,s.connect(e),Xo.set(1,{gain:n,in:i}),Xo.set(0,{gain:n,in:s}),Br.subscribe(o=>{Xo.get(1).gain.gain.value=(o/150)**2}),Ur.subscribe(o=>{Xo.get(0).in.gain.value=o/100}),s_.set(!0),document.removeEventListener("click",ey)},X3=!1,ty=(t,e)=>{X3||(X3=!0,document.addEventListener("click",ey))},ny=t=>{Qo.length=0,xo.clear(),Ap.clear()},b1=(t,e,n,i)=>{if(gn===void 0||gn.state=="suspended")return;let s=Fp.get(t);if(!s)return;let o=gn.createBufferSource();o.id=t,o.loop=n,K3(s.files,o);let r=Xo.get(e).in;return i&&(o.gain=gn.createGain(),o.gain.connect(r),r=o.gain),o.connect(r),o.start(0,n?Zt(0,1):0),o.onended=J3,o},Mt=(t,e)=>{let n=b1(t,1,!1,e!==void 0);e!==void 0&&n&&(n.gain.gain.value=e)},iy=(t,e)=>b1(t,e,!0,!0),sy=(t,e)=>b1(t,e,!1,!0);var il=Math.PI*2,h9=Math.PI*3,Da=t=>t<0||t>il?(t%il+il)%il:t,If=(t,e,n,i)=>(Xt(yn,i,n),Xt(bt,e,n),Xi(yn,yn,bt),Zn(t,yn));var Pp=(t,e,n,i,s,o)=>{let r=[n[0]-t[0],n[1]-t[1],n[2]-t[2]],l=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],a=[i-t[0],s-t[1],o-t[2]],c=pn(r,r),f=pn(r,l),u=pn(r,a),m=pn(l,l),g=pn(l,a),v=1/(c*m-f*f),_=(m*u-f*g)*v,b=(c*g-f*u)*v;return _>=0&&b>=0&&_+b<=1},Tp=(t,e)=>{let n=Math.sin(t[1]),i=Math.cos(t[1]);t[0]=e[2]*i+e[0]*n,t[2]=e[2]*n-e[0]*i},sl=t=>{let e=Math.atan2(t[0],t[1]);return e<0&&(e+=2*Math.PI),e},Ep=t=>{let e=Math.atan2(t[0],t[2]);return e<0&&(e+=2*Math.PI),e},ol=(t,e)=>(e-t+h9)%il-Math.PI;var Dp=(t,e,n)=>{Xt(bt,n,t);let i=pn(bt,e);return sn(bt,t,e,i)},oy=(t,e,n,i,s,o,r,l,a)=>{let c=-(r*i+l*s+a*o);return r*t+l*e+a*n+c},y1=(t,e,n,i,s,o,r,l,a)=>{let c=-(r*i+l*s+a*o);return e+(r*t+a*n+c)/l},ry=(t,e,n,i,s,o,r,l,a)=>{let c=(r*(i-t)+l*(s-e)+a*(o-n))/(r*r+l*l+a*a),f=t+c*r,u=n+c*a;return Math.sqrt(Math.pow(f-t,2)+Math.pow(u-n,2))};var Ia=(t,e)=>(t[0]=e[0],t[1]=e[2],t);var Ip=(t,e,n)=>(t[0]=e[0]+n[0],t[2]=e[2]+n[1],t);var ly=(t,e,n,i,s)=>{Xt(bt,e,i);let o=2*pn(n,bt),r=pn(bt,bt)-s*s,l=o*o-4*r;l>0?(t[0]=(-o-Math.sqrt(l))/2,t[1]=(-o+Math.sqrt(l))/2):t[0]=t[1]=-1},Va=(t,e,n,i,s,o)=>{Xt(bt,e,t),Xt(yn,n,t),Xi(Qr,bt,yn);let r=pn(s,Qr),l;if(r>0){if(!o)return 1/0;l=1}else if(r<0)l=-1,r=-r;else return 1/0;Xt(ps,i,t);let a=l*pn(s,Xi(yn,ps,yn));if(a<0)return 1/0;let c=l*pn(s,Xi(bt,bt,ps));if(c<0||a+c>r)return 1/0;let f=-l*pn(ps,Qr);return f<0?1/0:f/r};var ay=(t,e,n,i)=>{let s=0,o=0,r=1;e.length>2&&(s=i.findIndex(f=>f>=n),s<0&&(s=i.length),o=s>0?i[s-1]:0,r=s>=i.length?1:i[s]);let l=e[s],a=e[s+1],c=(n-o)/(r-o);return ca(t,l,a,c),s};var Vp=[0,0],La=[0,0],ti=[0,0],tt={},cy={},g9=function(t){return this.press.push(t),t},v9=function(t){return this.release.push(t),t},fn=(t,e)=>(e.press||(e.down=!1,e.onPress=g9,e.onRelease=v9,e.press=[],e.release=[],e.mappings=[],e.store||(e.store=ie(!1))),t=Array.isArray(t)?t:[t],t.forEach(n=>{cy[n]=e,e.mappings.push(n)}),i_.set(tt),e),fy=()=>{fn(le.kbForward,tt.fwd={}),fn(le.kbLeft,tt.left={}),fn(le.kbBack,tt.back={}),fn(le.kbRight,tt.right={}),fn(le.kbNextTarget,tt.nextTarget={}),fn(le.kbNextParty,tt.nextParty={}),fn(le.kbUntarget,tt.untarget={}),fn(" ",tt.jump={}),fn(le.kbAltForward,tt.fwd),fn(le.kbAltBack,tt.back),fn(le.kbTurnRight,tt.turnright={}),fn(le.kbTurnLeft,tt.turnleft={}),fn("shift",tt.shift={}),fn("m0",tt.lmb={}),fn("m2",tt.rmb={}),fn("control",tt.ctrl={}),fn("alt",tt.alt={}),fn(le.kbMap,tt.map={}),fn(le.kbSkills,tt.skills={}).onPress(()=>{co.update(t=>!t),Mt(89)}),fn(le.kbCharacter,tt.char={}).onPress(()=>{mo.update(t=>!t),Mt(89)}),fn(le.kbInventory,tt.inventory={}).onPress(()=>{ao.update(t=>!t),Mt(90)}),fn(le.kbClan,tt.clan={}).onPress(()=>{fo.update(t=>!t),Mt(90)}),fn(le.kbPvp,tt.pvp={}).onPress(()=>{uo.update(t=>!t),Mt(90)}),fn(le.kbParty,tt.party={}).onPress(()=>{Zi.update(t=>!t),Mt(90)}),document.addEventListener("wheel",k9,{passive:!0}),document.addEventListener("keydown",w9,!1),document.addEventListener("keyup",M9,!1),document.addEventListener("contextmenu",x9,!1),document.addEventListener("mousedown",b9,!1),document.addEventListener("mouseup",y9,!1),document.addEventListener("mousemove",_9,!1)},uy=t=>{k1&&(k1=!1,le.pointerlock&&!(tt.lmb.down||tt.rmb.down)&&(document.exitPointerLock(),Lp=!1))},Vf=0,_9=t=>{if(di(Vp,2*(t.x*le.resolutionScale/Fi.width)-1,2*(1-t.y*le.resolutionScale/Fi.height)-1),di(La,~~(t.x*le.resolutionScale),~~(t.y*le.resolutionScale)),tt.rmb.down||tt.lmb.down){let e=vt(t.movementX,-100,100),n=vt(t.movementY,-100,100);ti[1]=vt(ti[1]+n*.0028*(le.invertMouseY?-le.mouseSensitivity:le.mouseSensitivity),-Math.PI/2,Math.PI/2),ti[0]=Da(ti[0]-e*.005*(le.invertMouseX?-le.mouseSensitivity:le.mouseSensitivity)),Vf+=Math.abs(n)+Math.abs(e)}},my=!1;En.subscribe(t=>{my=t!==void 0});var Lp=!1,k1=!1,b9=t=>{(t.target==Fi||t.target.id=="chat")&&(le.pointerlock&&(Lp=!0,Fi.requestPointerLock()),Zo("m"+t.button,!0),my&&En.update(e=>{e&&e.discard&&e.discard()}))},y9=t=>{Zo("m"+t.button,!1),Vf=0,k1=!0},k9=t=>{t.target==Fi&&Vm.update(e=>vt(e+(t.deltaY>0?1:-1),2,18))},x9=t=>{t.preventDefault()},Zo=(t,e,n)=>{let i=cy[t];return i!==void 0?(i.down!=e&&(i.down=e,i[e?"press":"release"].forEach(s=>{s(n)}),i.store.set(i.down)),n&&n.preventDefault(),!0):!1},w9=t=>{if(!py(t))return;let e=t.key.toLowerCase();t.ctrlKey&&Zo("ctrl+"+e,!0,t)||t.shiftKey&&Zo("shift+"+e,!0,t)||Zo(e,!0,t)},M9=t=>{if(!py(t))return;let e=t.key.toLowerCase();Zo("ctrl+"+e,!1),Zo("shift+"+e,!1),Zo(e,!1)},py=t=>{let e=t.target.tagName.toLowerCase();return e!=="input"&&e!=="textarea"};var dy=(t,e,n,i)=>{window.gtag&&window.gtag("event",t,{event_category:e,event_label:n,value:i})};var x1=t=>1+(t-1)*.23,hy=t=>{let e=0;return t.forEach(n=>{e+=n.stats.getStat(18)}),C9(e,t.length)},C9=(t,e)=>t/Math.max(1,e)/100;var S9=[300,600,1e3,1400,2e3,2600,3200,4e3,4800,5700,6700,7700,8800,1e4,11500,13e3,14600,16400,18400,20400,22600,25100,27700,30400,33400,36600,4e4,43700,47500,51500,56200,61e3,66600,72500,78500,85300,92400,99700,107300,115700,124400,133400,142700,152300,162100],Jo=t=>S9[vt(t,1,45)-1];var qp=class{constructor(e){this.id=e.id,this.cd=e.cd!==void 0?e.cd:0,this.costMp=e.costMp,this.targetMode=e.targetMode||0,this.onCast=e.onCast,this.onPermanent=e.onPermanent,this.range=e.range||0,this.graceRange=this.range+Math.min(this.range*.2,10),this.auto=e.auto||!1,this.engineOnly=e.engineOnly||!1,this.minlevel=e.minlevel||0,this.castLen=e.castLen||0,this.gcd=e.gcd!==void 0?e.gcd:1.5,this.custom=e.custom,this.skilllevels=Math.min(5,e.skilllevels||5),this.goldValue=e.goldValue||0,this.noReward=e.noReward||!1,this.outOfCombat=e.outOfCombat||!1,this.pvpBoundsAdd=e.pvpBoundsAdd||0,this.ignoreGcd=e.ignoreGcd||!1,this.ignoreIncapacitated=e.ignoreIncapacitated||!1,this.disablingBuffs=e.disablingBuffs||[],this.hasteAffected=e.hasteAffected!==void 0?e.hasteAffected:!0,this.skillpoints=e.skillpoints!==void 0?e.skillpoints:1,this.envCast=e.envCast||0}can(e,n,i=0,s){if(this.outOfCombat&&!e.stats.combatTimer.done(V.time))return 11;if(this.costMp!==void 0&&e.stats.getResource(7)<this.costMp(n))return 5;if(this.targetMode!==1){let o=V.getEntityById(i),r=o===void 0||o.stats.alive,l=o===void 0?-1:e.hostility(o);if(this.targetMode===4096){if((l===-1||l===0)&&r)return 3;if(!e.canCombatInteract(o))return 13}else if(this.targetMode===256){if((l===-1||l!==0)&&r)return 4}else if(this.targetMode===16)o=e;else if(this.targetMode===17&&(o===void 0||o===e))return 3;if(o!==void 0&&!o.stats.alive)return 10;if(o&&i!==e.id&&o!==e&&this.range>0&&!e.combatRangeCheck(o,s?this.range:this.graceRange))return 6}return this.disablingBuffs.some(o=>e.buffs.hasAnyWithTag(o))?12:0}};var ke=class extends qp{constructor(e){super(e),this.fx=e.fx||{},this.autoSkillbar=e.autoSkillBar!==!1}};var qa=(t,e,n,i)=>({id:t,minlevel:n,engineOnly:!1,cd:0,custom:i,autoSkillBar:!1,onPermanent:()=>e}),Ai=(t,e,n,i,s,o,r,l)=>({id:t,targetMode:16,minlevel:n,cd:s,costMp:r,fx:l,onCast:(a,c,f)=>({id:e,mode:4,stacks:1,duration:i,caster:a.id,target:a.id,aoe:{faction:!0,limit:o,circleRadius:30,circleHeight:20},level:c})}),Rp=(t,e,n,i,s,o,r,l=5,a)=>({id:t,targetMode:256,range:30,minlevel:n,cd:s,castLen:i,costMp:r,fx:a,onCast:(c,f,u)=>({id:e,mode:l,stacks:1,caster:c.id,target:u,refresh:!0,duration:o,level:f})}),rl=(t,e,n=0,i=!0,s,o=!1,r=!1,l)=>({id:t,targetMode:16,cd:e,gcd:0,hasteAffected:!1,ignoreIncapacitated:o,ignoreGcd:!0,castLen:n,engineOnly:!0,outOfCombat:s,fx:l});var gy=new ke(qa(21,77,1));var vy=new ke({id:2,targetMode:16,minlevel:5,cd:30,gcd:0,costMp:t=>3+t*5,fx:{animCast:6},custom:[[t=>7+t*12," heal on block"]],onCast:(t,e,n)=>({id:59,mode:4,stacks:1,duration:9,caster:t.id,target:t.id,level:e})});var _y=t=>.7+t*.2,A9=t=>_y(t)+30/(250/20),by=new ke({id:33,targetMode:17,skilllevels:1,minlevel:11,cd:15,range:30,disablingBuffs:[4],costMp:t=>12,custom:[[_y,"s stunned at min range"],[A9,"s stunned at max range"]],onCast:(t,e,n)=>{}});var yy=new ke(Ai(20,76,15,300,150,20,t=>t*8,{animCast:6}));var ky=new ke({id:18,cd:0,minlevel:8,autoSkillBar:!1,fx:{},onPermanent:()=>73});var xy=new ke({id:3,targetMode:1,minlevel:3,cd:6,costMp:t=>2+t*2,fx:{animCast:5,effectDirImpact:9},onCast:(t,e,n)=>({id:3,mode:0,caster:t.id,dmg:t.stats.getDamageRoll()*(1+e*.18),type:1,aoe:{faction:!1,circleRadius:2+5*t.size}})});var wy=new ke({id:17,targetMode:16,minlevel:13,cd:50,gcd:0,costMp:t=>t*8,fx:{animCast:6},onCast:(t,e,n)=>({id:72,mode:4,stacks:1,duration:17,caster:t.id,target:t.id,level:e})});var My=new ke({id:50,targetMode:1,minlevel:7,cd:30,costMp:t=>t*4,fx:{animCast:40},custom:[[t=>20+t*5," % missing + 100 HP recovered"]],onCast:(t,e,n)=>({id:121,mode:4,stacks:1,caster:t.id,buffdata:[0],sendBuffData:!0,duration:1+e,level:e,aoe:{faction:!1,circleRadius:8}})});var P9=t=>t*8,Fy=new ke({id:1,targetMode:4096,minlevel:1,cd:1,range:2,custom:[[P9,"% chance to daze target for 3 seconds"]],costMp:t=>1+t,fx:{animImpact:3},onCast:(t,e,n)=>{let i=5+t.stats.getDamageRoll()*(.38+e*.39);return{id:1,mode:0,caster:t.id,target:n,dmg:i,type:1}}});var Cy=t=>1e4+t*1e4,T9=(t,e)=>{if(e.type===1){let n=0;e.aggroValues.forEach((i,s)=>{i>n&&(n=i)}),e.aggroValues.set(t.caster,n+Cy(t.level)),e.buffs.buffs.has(122)&&add({id:125,mode:5,stacks:t.level,caster:e.id,target:t.caster,refresh:!0,duration:60,level:1})}},Sy=new ke({id:34,targetMode:1,minlevel:6,cd:15,costMp:t=>t*4,fx:{animCast:7},custom:[[Cy," aggro generation"]],onCast:(t,e,n)=>({custom:T9,id:89,mode:4,stacks:1,caster:t.id,duration:2+e,level:e,aoe:{faction:!1,circleRadius:10}})});var Ay=new ke({id:41,targetMode:16,minlevel:25,cd:30,skilllevels:1,gcd:0,costMp:t=>3+t*5,onCast:(t,e,n)=>{}});var Py=new ke(Ai(19,75,18,300,150,20,t=>t*8,{animCast:6}));var Ty=new ke({id:46,targetMode:1,range:30,minlevel:4,cd:30,castLen:0,costMp:t=>10+t*3,fx:{effectTarget:106},onCast:(t,e,n)=>{}});var Ey=new ke(Ai(22,78,17,300,120,20,t=>5+t*10,{animCast:6}));var Dy=new ke(Rp(24,80,15,1.5,0,300,t=>2+t*3,4,{animCast:9,animChannel:18}));var Iy=new ke({id:52,targetMode:1,minlevel:7,envCast:7,cd:6,range:25,costMp:t=>t*2,fx:{effectMissile:107,effectTarget:111},onCast:(t,e,n,i,s,o)=>{}});var Vy=new ke({id:14,targetMode:1,minlevel:3,cd:25,costMp:t=>t*4,fx:{animCast:31},onCast:(t,e,n)=>({id:69,mode:4,stacks:1,caster:t.id,duration:5.5+e*.5,level:e,aoe:{faction:!1,circleRadius:8}})});var Ly=new ke({id:16,targetMode:16,minlevel:13,cd:45,gcd:0,fx:{animCast:6},onCast:(t,e,n)=>({id:71,mode:4,stacks:1,duration:12,caster:t.id,target:t.id,level:e})});var qy=new ke({id:53,targetMode:16,minlevel:9,cd:80,gcd:0,ignoreIncapacitated:!0,ignoreGcd:!0,costMp:t=>t*5,onCast:(t,e,n)=>({id:117,mode:4,duration:5,stacks:1,caster:t.id,target:t.id,level:e})});var Ry=new ke({id:4,targetMode:4096,range:30,minlevel:1,cd:0,castLen:1.5,custom:[[t=>100+t*10,"% frozen buff multiplier"]],costMp:t=>1+t*2,fx:{animCast:29,effectDirImpact:30,animChannel:30,effectMissile:27},onCast:(t,e,n)=>({id:4,mode:6,speed:25,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.3+e*.32),type:1}),onPermanent:()=>100});var zy=t=>2+t*2,By=new ke({id:23,targetMode:16,minlevel:5,cd:60,gcd:0,costMp:t=>t*5,custom:[[zy," attacks blocked"]],fx:{animCast:6},onCast:(t,e,n)=>({id:79,mode:4,stacks:zy(e),duration:60,caster:t.id,target:t.id,level:e})});var Uy=new ke({id:15,targetMode:1,range:30,minlevel:8,cd:8,castLen:1.5,costMp:t=>5+t*5,fx:{animCast:29,animChannel:30,effectDirImpact:31,effectMissile:28},onCast:(t,e,n)=>({id:15,mode:6,speed:10,timeout:2.5,caster:t.id,rot:t.rot,dmg:10+t.stats.getDamageRoll()*(.56+e*.6),type:1,aoe:{circleRadius:4+e*.5,faction:!1,onlyOnce:[]}})});var Oy=new ke({id:51,targetMode:4096,range:30,minlevel:4,cd:10,castLen:2.8,costMp:t=>1+t*2,fx:{animCast:37,effectDirImpact:119,animChannel:30,effectMissile:118},onCast:(t,e,n)=>({id:51,mode:6,speed:20,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(1.25+e*1.33),type:1,noBlock:!0})});var E9=()=>12,$y=new ke({id:32,targetMode:1,skilllevels:1,minlevel:5,gcd:.7,cd:12,disablingBuffs:[4],costMp:t=>t*4,fx:{animCast:32},custom:[[E9,"m distance"]],onCast:(t,e,n)=>{}});var Ny=new ke({id:37,targetMode:4096,range:30,minlevel:15,cd:40,castLen:2.3,costMp:t=>5+t*5,fx:{animCast:9,effectImpact:50,animChannel:16},onCast:(t,e,n)=>({id:91,mode:4,stacks:1,caster:t.id,target:n,duration:2.4+e*1,level:e})});var jy=new ke(Ai(28,84,12,15,60,15,t=>1+t*3,{animCast:6}));var Wy=new ke({id:12,targetMode:4096,range:30-5,minlevel:1,castLen:0,cd:3,costMp:t=>Math.round(1+t*4.5),fx:{animCast:10,effectMissile:48},onCast:(t,e,n)=>({id:12,mode:6,dmg:5+t.stats.getDamageRoll()*(.03+e*.13),type:1,speed:15,caster:t.id,target:n,level:e})});var Gy=new ke({id:30,targetMode:1,range:30,minlevel:18,cd:60,castLen:2.3,costMp:t=>10+t*8,fx:{effectImpact:70,animCast:14,animChannel:15,effectMissile:69},onCast:(t,e,n)=>({id:30,mode:6,speed:0,timeout:30,caster:t.id,rot:t.rot,interval:new kt(0,2),heal:t.stats.getDamageRoll()*(.08+e*.05),type:1,aoe:{circleRadius:30,circleHeight:30,faction:!0,limit:15}})});var Hy=new ke(Ai(13,68,6,15,90,15,void 0,{animCast:22}));var Yy=new ke({id:6,targetMode:256,range:30,minlevel:8,cd:0,castLen:1.7,costMp:t=>4+t*4,fx:{animCast:11,effectImpact:36,animChannel:12},onCast:(t,e,n)=>({id:6,mode:2,caster:t.id,target:n,heal:15+t.stats.getDamageRoll()*(.2+e*.18)})});var Xy=new ke({id:47,targetMode:256,range:30,minlevel:14,cd:12,castLen:0,costMp:t=>4+t*4,fx:{animCast:9,effectTarget:112},custom:[[t=>t," effects removed"]],onCast:(t,e,n)=>{let i=0;return{id:47,mode:2,caster:t.id,target:n,heal:(1+i)*(15+t.stats.getDamageRoll()*.25)}}});var D9=t=>1+t*2,I9=t=>1+t*2,Qy=new ke(qa(43,106,3,[[D9,"% haste per stack"],[I9," jumps"]]));var Zy=new ke(Rp(7,60,3,0,0,12,t=>2+t*2,5,{animCast:9}));var V9=t=>Math.round(t*1.3),L9=t=>t*2,Jy=new ke({id:42,targetMode:1,minlevel:8,cd:8,castLen:0,range:30-5,custom:[[V9," mana gained per soul"],[L9," extended Decay duration"]],costMp:t=>1+t*3,fx:{animCast:13,effectImpact:46},onCast:(t,e,n)=>({id:42,mode:1,caster:t.id,target:0,type:1,dmg:4+t.stats.getDamageRoll()*(.25+e*.4),level:e})});var Ky=new ke({id:105,engineOnly:!0,cd:0,fx:{effectImpact:47,effectMissile:45}});var ek=new ke({id:36,targetMode:16,minlevel:10,cd:30,gcd:0,costMp:t=>8+t*2,onCast:(t,e,n)=>({id:90,mode:4,stacks:1,duration:5+e*5,caster:t.id,target:t.id,level:e})});var tk=new ke({id:35,targetMode:1,skilllevels:1,minlevel:5,cd:120,skillpoints:0,castLen:5,outOfCombat:!0,hasteAffected:!1,pvpBoundsAdd:5,costMp:t=>20+t*5,fx:{animCast:20,animChannel:21},onCast:(t,e,n)=>{}});var nk=new ke({id:49,targetMode:4096,range:30,minlevel:13,cd:25,costMp:t=>1+t*1,fx:{animCast:38,effectMissile:123,animChannel:28},onCast:(t,e,n)=>({id:49,buffid:119,mode:7,speed:60,caster:t.id,level:e,stacks:1,duration:1+e*2,refresh:!0,target:n})});var ik=new ke({id:54,targetMode:4096,range:30,minlevel:8,cd:10,castLen:2.8,costMp:t=>8+t*3,fx:{animCast:39,effectDirImpact:121,animChannel:25,effectMissile:114},onCast:(t,e,n)=>({id:54,mode:6,speed:60,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(1.25+e*1.33),type:1,noBlock:!0})});var sk=new ke(qa(26,82,15));var q9=t=>3+t*5,ok=new ke({id:11,targetMode:16,minlevel:7,cd:50,gcd:0,fx:{animCast:6},custom:[[q9,"% of max mp recovered"]],onCast:(t,e,n)=>({id:66,mode:4,stacks:1,duration:17,caster:t.id,target:t.id,level:e})});var rk=new ke(Ai(27,83,12,10,80,20,t=>5+t*7,{animCast:6}));var lk=new ke({id:29,cd:0,minlevel:9,autoSkillBar:!1,onPermanent:()=>85});var ak=new ke({id:9,targetMode:4096,range:30,minlevel:3,cd:6,castLen:1.7,costMp:t=>2+t*3,fx:{animCast:24,effectDirImpact:85,animChannel:25,effectMissile:33},onCast:(t,e,n)=>({id:9,mode:6,speed:120,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.53+e*.45),type:1})});var ck=new ke({id:10,targetMode:16,minlevel:5,cd:0,autoSkillBar:!1,skillpoints:0,onPermanent:()=>65});var fk=new ke({id:38,targetMode:16,minlevel:5,skilllevels:1,cd:10,gcd:0,disablingBuffs:[4],costMp:t=>6,fx:{animCast:23},onCast:(t,e,n)=>!0});var uk=new ke({id:31,targetMode:4096,range:30,minlevel:1,cd:0,castLen:1.5,costMp:t=>1+t*1,fx:{animCast:27,effectDirImpact:84,effectMissile:34,animChannel:28},onCast:(t,e,n)=>({id:31,mode:6,speed:60,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.24+e*.25),type:1})});var mk=new ke(Ai(25,81,18,300,120,20,t=>5+t*5,{animCast:6}));var pk=new ke({id:48,targetMode:4096,range:30,minlevel:6,cd:20,ignoreGcd:!0,costMp:t=>1+t*1,fx:{animCast:36,effectDirImpact:115,effectMissile:113,animChannel:28},custom:[[t=>t*120," HP recovered"]],onCast:(t,e,n)=>({id:48,mode:6,speed:80,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.28+e*.28),type:1})});var dk=new ke({id:106,engineOnly:!0,cd:0,fx:{effectMissile:116,effectImpact:117}});var hk=new ke({id:45,targetMode:1,range:30,minlevel:4,cd:25,castLen:0,costMp:t=>18+t*3,fx:{effectDirImpact:11,effectMissile:103},onCast:(t,e,n)=>{}});var R9={medalValue:1e3,goldValue:5e4,buyElo:1600,quality:90,level:45,gs:30,uniqueEquipped:!0},w1=[{id:0,custom:["Use: Removes all movement limiting effects."],useCd:60,incap:!0,animCast:45},{id:1,custom:["Use: Protects you against 30% of incoming damage for 10 seconds."],useCd:60,animCast:6,incap:!1},{id:2,custom:["Use: Increases your damage by 20% for 10 seconds."],useCd:80,incap:!1,animCast:6},{id:3,custom:["Use: Speeds up your movement by 45 for 8 seconds."],useCd:50,incap:!1,animCast:6},{id:4,custom:["Use: Attacks made against you grant 20 MP (up to 200) for 20 seconds."],useCd:60,incap:!1,animCast:6}],gk=t=>{w1.forEach((e,n)=>{t["charm"+e.id]={...R9,...e,type:"charm",tier:e.id,useSkill:107+n}})};var vk=new ke(rl(100,30,0,!0,!0,!1,!1,{animCast:17})),_k=new ke(rl(101,1.5,0,!0,!1,!1,!1)),bk=new ke(rl(104,1.5,0,!1,!1,!1,!1,{animCast:6})),yk=new ke(rl(103,1.5,3,!0,!1,!1,!1,{animCast:19,animChannel:18})),kk=new ke(rl(102,1.5,1.5,!1,!0,!1,!1,{animCast:9,animChannel:18})),xk=w1.map((t,e)=>new ke(rl(107+e,t.useCd,0,!1,!1,t.incap,!0,{animCast:t.animCast}))).reduce((t,e)=>({...t,["charm"+e.id]:e}),{});var wk=new ke({id:5,targetMode:4096,range:30,engineOnly:!0,auto:!0,cd:t=>100/t.stats.getStat(17),fx:{animCast:26,effectDirImpact:11,effectMissile:32},onCast:(t,e,n)=>({id:5,mode:6,speed:15*3,caster:t.id,target:n,dmg:t.stats.getDamageRoll(),type:0})});var Mk=new ke({id:56,targetMode:1,range:50,cd:10,engineOnly:!0,castLen:2,fx:{animCast:41,animChannel:42}});var Fk=new ke({id:44,targetMode:1,range:50,minlevel:3,cd:5,engineOnly:!0,castLen:1.5,costMp:t=>t*4});var Ck=new ke({id:55,targetMode:1,range:50,minlevel:3,cd:20,engineOnly:!0,castLen:2,fx:{effectMissile:131,animCast:43,animChannel:42}});var Sk=new ke({id:58,targetMode:1,range:10,cd:2,engineOnly:!0,hasteAffected:!1,castLen:30,fx:{animCast:9,animChannel:44}});var Ak=new ke({id:57,targetMode:4096,engineOnly:!0,fx:{effectMissile:153,effectDirImpact:154}});var Pk=new ke({id:0,targetMode:4096,engineOnly:!0,auto:!0,range:2,cd:t=>100/t.stats.getStat(17),fx:{animImpact:4},onCast:(t,e,n)=>({id:0,mode:0,caster:t.id,target:n,dmg:t.stats.getDamageRoll(),type:0})});var Tk=new ke({id:39,engineOnly:!1,skilllevels:1,minlevel:30,cd:0,goldValue:25e3,skillpoints:0,noReward:!0,autoSkillBar:!1});var Ek=new ke({id:40,targetMode:1,engineOnly:!0,cd:300,castLen:5,outOfCombat:!0,hasteAffected:!1,costMp:t=>20+t*5,fx:{animCast:9,animChannel:8},onCast:(t,e,n)=>{}});var Dk=new ke({id:8,engineOnly:!0,cd:0,onPermanent:t=>t.class+61});var z9={...xk,hellspawn_missile:Ak,conjurer_obeliskport:Sk,boss_bigaoe:Mk,boss_puddledot:Ck,recall:Ek,arrow:wk,melee:Pk,potion:vk,book:_k,specialization:Dk,mount:Tk,activatemount:kk,container:yk,boss_flamepits:Fk,useGeneric:bk},B9={relentlessCry:My,whirlwind:Ty,temper:Ay,taunt:Sy,charge:by,warcry:Py,courage:yy,armorreinforcement:gy,enrage:wy,slash:Fy,blockBuff:vy,crescentStrike:xy,crescentBleed:ky},U9={frostcall:Iy,iceblock:qy,shatterfrost:Oy,teleport:$y,enchantment:Dy,arcticaura:Ey,iceshield:By,hypothermic:Ly,frostnova:Vy,icebolt:Ry,icicle:Uy},O9={vampiricarrowReturn:dk,boneshot:ik,blindingshot:nk,vampiricarrow:pk,volley:hk,snipe:fk,poisonarrows:lk,temporaldilation:mk,pathfinding:rk,preciseShot:ak,serpentArrows:ck,invigorate:ok,swiftshot:uk,cranialpunctures:sk},$9={mimirscleanse:Xy,soulharvestReturn:Ky,plaguespreader:Qy,soulharvest:Jy,agonize:Ny,caninehowl:jy,mana:Hy,mend:Yy,revitalize:Zy,decay:Wy,healingtotem:Gy,summon:tk,spiritanimal:ek},Pt=new Map;[B9,U9,O9,$9,z9].forEach((t,e)=>{for(let n in t)e<=3&&(t[n].class=e),Pt.set(t[n].id,t[n])});Pt.set(60,new ke({id:60,engineOnly:!0}));var Vk=[1600,1800,2e3,2200],Ik=Vk.length,Ra=t=>{for(let e=0;e<Ik;++e)if(Vk[e]>t)return e;return Math.max(0,Ik)},N9=10,j9=30,W9=240,G9=-.0015,H9=930,Y9=100,Lf=t=>N9+Math.round(Math.max(t/j9,W9*(1-Math.exp(G9*(t-H9)))-Y9));var X9=[0,0,1,1,2,3],M1=(t,e)=>"book"+(e!==void 0?e:"")+X9[t%5],qf=(t,e,n,i)=>`https://raw.githubusercontent.com/2f147f0487a9fe5b/cb2e2197348007b8/main/${t}/${t=="book"?M1(e,n):t+e}_q${i}.webp?v=8588529`,Rf=t=>`/data/ui/skills/${t}.${Gn}?v=8588529`,Lk=t=>`/data/ui/slotbg/${t}.${On}?v=8588529`,qk=(t,e,n)=>`/data/world/${t}/map/${e}/${n}.${Gn}?v=8588529`,Ys=t=>`/data/ui/classes/${t}.${On}?v=8588529`,F1=t=>`/data/ui/factions/${t}.${On}?v=8588529`,Rk=t=>`/data/ui/elo/${Ra(t)}.svg?v=8588529`,zk="/data/ui/currency/medal.svg?v=8588529",za="/data/ui/currency/prestige.svg?v=8588529",Ko="/data/ui/currency/fame.svg?v=8588529",Bk=t=>`/data/ui/rank/rank${t}.svg?v=8588529`;var Uk=t=>{Pt.forEach(e=>{if(!e.engineOnly)for(let n=0;n<e.skilllevels;++n){let i=e.id*5+n;t[`book${i}`]={type:"book",tier:i,level:e.minlevel+n*8,skillid:e.id,skilllevel:n,class:e.class,noReward:e.noReward||!1,goldValue:e.goldValue||(e.minlevel+n*5<5?4:0),quality:Math.round(Math.min(99,30+70*(n/5))),art:M1(i,e.class),useSkill:101}}})};var Q9=[{id:0,storeValue:300,quality:90,level:1,custom:["Contains random mount (account bound) of rare or epic quality"],bindOnPurchase:1,useSkill:103},{id:1,storeValue:900,quality:90,level:1,custom:["Adds one month of Elixir to your account"],bindOnMerchant:1,useSkill:103},{id:2,storeValue:700,quality:90,level:1,bindOnMerchant:1,custom:["Used to upgrade rare pets, allowing them to pick up items."]}],Ok=t=>{Q9.forEach(e=>{t["box"+e.id]={...e,type:"box",tier:e.id,unsellable:!0}})};var Ri={hammer:{sound:119,rot:1},bow:{sound:120,rot:1},staff:{sound:120,rot:1},sword:{sound:119,rot:1},armlet:{sound:121},armor:{sound:122},bag:{sound:121},boot:{sound:121},glove:{sound:121},ring:{sound:123},amulet:{sound:123},quiver:{sound:121,rot:1},shield:{sound:122},totem:{sound:122,rot:1},orb:{sound:122},rune:{sound:123,rot:0},misc:{sound:124,rot:1},book:{sound:121},mount:{sound:121,rot:0},pet:{sound:121,rot:0},box:{sound:125,rot:0},gold:{sound:126},charm:{sound:123}},Sn={hammer:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:3,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:15,min:.05,max:.1}},stackable:!1},bow:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:2,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}},stackable:!1},staff:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:1,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}},stackable:!1},sword:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:0,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:20,min:.05,max:.1}},stackable:!1},armlet:{baselvl:1,slot:[102],tiers:13,drop:1,weight:.3,stats:{6:{base:10,min:.5,max:.9},12:{base:7,min:.5,max:.8}},stackable:!1},armor:{baselvl:2,slot:[103],tiers:11,drop:1,weight:1,stats:{12:{base:10,min:1.4,max:2.8},6:{base:20,min:1,max:2}},stackable:!1},bag:{baselvl:5,slot:[104],tiers:5,drop:1,weight:.1,stats:{19:{base:1,min:.1,max:.3}},stackable:!1},boot:{baselvl:2,slot:[105],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.6,max:1.1},15:{base:3,min:.03,max:.1}},stackable:!1},glove:{baselvl:2,slot:[106],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.7,max:1.1},14:{base:1,min:.1,max:1.5}},stackable:!1},ring:{baselvl:5,slot:[107],tiers:12,drop:.8,weight:.2,stats:{6:{base:10,min:.5,max:.9},7:{base:5,min:.6,max:1}},stackable:!1},amulet:{baselvl:7,slot:[108],tiers:12,drop:.8,weight:.3,stats:{7:{base:10,min:1,max:1.8},9:{base:1,min:.2,max:.3}},stackable:!1},quiver:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:2,stats:{14:{base:5,min:.1,max:.9},9:{base:1,min:.1,max:.3}},stackable:!1},shield:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:0,stats:{12:{base:20,min:.8,max:1.4},13:{base:4,min:1,max:2.8}},stackable:!1},totem:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:3,stats:{12:{base:10,min:.4,max:.9},9:{base:1,min:.1,max:.4}},stackable:!1},orb:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:1,stats:{3:{base:10,min:.3,max:.7},9:{base:1,min:.1,max:.3}},stackable:!1},rune:{baselvl:1,tiers:11,drop:.8,quality:70,stackable:!0},misc:{drop:8,weight:.1,stackable:!0},book:{drop:1.6,weight:.5,stackable:!0},charm:{slot:[110,111],noupgrade:!0,undroppable:!0,drop:0,stackable:!1},mount:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},box:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},pet:{undroppable:!0,drop:0,stackable:!1},gold:{drop:24}},$k=Object.keys(Sn),zf={6:{min:.2,max:.8,round:!0},7:{min:.2,max:.5,round:!0},8:{min:.1,max:1},9:{min:.1,max:.5},10:{min:.03,max:.13,round:!0},11:{min:.1,max:.2,round:!0},12:{min:.1,max:.8,round:!0},13:{min:.1,max:.4},14:{min:.1,max:.5},16:{min:.1,max:.4},2:{min:.08,max:.45,round:!0},0:{min:.08,max:.45,round:!0},3:{min:.08,max:.45,round:!0},4:{min:.08,max:.45,round:!0},1:{min:.08,max:.45,round:!0},5:{min:.08,max:.45,round:!0},18:{min:.01,max:.15,round:!0}},Nk=Object.keys(zf),Bf={6:4,7:3,8:5,9:4,10:1,11:1,12:5,13:5,14:5,15:.3,16:5,17:0,2:2,0:2,3:2,4:2,1:2,5:2,19:1,18:2};var jk=t=>{for(let e in Sn)if(Sn[e].tiers){let n=Sn[e];for(let i=0;i<n.tiers;++i)J9({type:e,tier:i,stats:n.stats,level:Z9(e,i),class:n.class,quality:n.quality},t)}},Z9=(t,e)=>Sn[t].baselvl+Math.floor(e/Sn[t].tiers*100),J9=(t,e)=>{let n={level:t.level,type:t.type,tier:t.tier,stats:t.stats?new Map:void 0,class:t.class,quality:t.quality};t.stats&&Object.keys(t.stats).sort((i,s)=>i-s).forEach(i=>{let s=t.stats[i];n.stats.set(parseInt(i),{min:s.base+t.level*s.min,max:s.base+(t.level+10)*s.max})}),e[t.type+t.tier]=n};var K9=[250,100,500,200,1e3,300],Wk=t=>{for(let e=0;e<6;++e){let n=Math.floor(e/2),i=e%2==0;t["misc"+e]={type:"misc",tier:e,level:1+n*20,goldvalue:5**n,quality:15,custom:[""+K9[e]+(i?" HP recovered":" MP recovered")],useSkill:100}}};var e7=[{lvl:30,g:1e4,qual:50,store:0,skin:6},{lvl:30,g:2e4,qual:50,store:0,skin:21},{lvl:30,g:5e4,qual:80,store:300,skin:51},{lvl:30,g:5e4,qual:80,store:300,skin:52},{lvl:30,g:5e4,qual:95,store:1200,skin:22},{lvl:30,g:5e4,qual:90,store:600,skin:23},{lvl:30,g:5e4,qual:80,store:300,skin:24},{lvl:30,g:5e4,qual:90,store:600,skin:25},{lvl:30,g:5e4,qual:95,store:1200,skin:27},{lvl:30,g:5e4,qual:95,store:1200,skin:28},{lvl:30,g:5e4,qual:80,store:300,skin:30},{lvl:30,g:5e4,qual:95,store:1200,skin:31},{lvl:30,g:5e4,qual:95,store:1200,skin:32},{lvl:30,g:5e4,qual:85,store:400,skin:29},{lvl:30,g:5e4,qual:95,store:1200,skin:33},{lvl:30,g:5e4,qual:95,store:0,skin:94},{lvl:30,g:5e4,qual:95,store:0,skin:95},{lvl:30,g:5e4,qual:95,store:0,skin:96},{lvl:30,g:5e4,qual:95,store:0,skin:97},{lvl:30,g:5e4,qual:95,store:0,skin:98},{lvl:30,g:5e4,qual:95,store:0,skin:100},{lvl:30,g:5e4,qual:95,store:0,skin:101},{lvl:30,g:5e4,qual:95,store:0,skin:93},{lvl:30,g:5e4,qual:95,store:0,skin:91},{lvl:30,g:5e4,qual:95,store:0,skin:99},{lvl:30,g:5e4,qual:95,store:0,skin:92}].map(t=>({level:t.lvl,goldValue:t.g,storeValue:t.store,bindOnUse:1,bindOnMerchant:t.store>0?1:0,quality:t.qual,skin:t.skin})),Gk=t=>{e7.forEach((e,n)=>{t["mount"+n]={...e,type:"mount",tier:n,requiredSkill:39,useSkill:102}})};var t7=[1919,1920,1944,1945,1946,1947,1948,1960,1968,1969,1970,1971,1972,1973,1974,1975],Hk=t=>{t7.forEach((e,n)=>{t["pet"+n]={level:10,unsellable:!0,storeValue:e>1920?0:900,quality:90,bindOnUse:1,bindOnMerchant:e>=1968?0:1,type:"pet",tier:n,useSkill:104,skin:e}})};var rn={};jk(rn);Wk(rn);Uk(rn);Gk(rn);gk(rn);Hk(rn);Ok(rn);var tr=Object.values(rn);tr.forEach((t,e)=>t.id=e);var Pi=[{step:10,fun:()=>tt.fwd.down||tt.left.down||tt.right.down},{step:10,fun:()=>tt.lmb.down||tt.rmb.down,click:!0},{click:!0},{element:"ufplayer",click:!0},{},{element:"uftarget",click:!0},{element:"sk1"},{},{click:!0},{element:"expbar",click:!0},{},{element:"sysbag",step:100,fun:()=>le.inventoryOpen},{element:"bag2",click:!0},{click:!0},{element:"syschar",step:100,fun:()=>le.charpanelOpen},{element:"equipslots",click:!0},{fixed:()=>V.player.stats.getStat(22)>0?100:Math.round(V.player.exp/Jo(V.player.level)*100)},{element:"syschar",step:100,fun:()=>le.charpanelOpen},{element:"statpoints"},{step:100,fixed:()=>Math.round(V.player.exp/Jo(V.player.level)*100),fun:()=>V.player.level>3},{click:!0},{fixed:()=>Math.round(V.player.inventory.gold/32*100)},{fun:()=>le.traderWindow},{element:()=>{let t=0;return Af.forEach(e=>{let n=rn[e.type+e.tier];n.type==="book"&&n.level===3&&n.class===V.player.class&&(t=e.id)}),"trader"+t}},{element:"bag0",click:!0},{element:"sysbook",step:100,fun:()=>le.skillmenuOpen},{element:"skilllist",click:!0},{element:"tutsetskillpoint",click:!0},{element:"tutapplyskills",click:!0},{element:"skillbar",click:!0},{click:!0},{click:!0},{click:!0},{click:!0,element:"partybtn"},{click:!0},{click:!0},{click:!0},{click:!0},{click:!0},{click:!0},{element:"chat"},{element:"chatinput"},{element:"syscog",step:100,click:!0,fun:()=>le.settingsOpen},{click:!0},{step:100,fun:()=>!le.settingsOpen},{click:!0},{click:!0},{gate:()=>V.player.level>=25,click:!0}],Yk=!1,n7=()=>{C1.reset(V.smoothtime),Yk||(Yk=!0,$s.subscribe(t=>{let e=Pi[t];e&&(e.gate===void 0||e.gate())?Bo.set(Xk(t)):Bo.set()}))},Xk=t=>(Mt(91),{...Pi[t],msg:C.ui.tutorial.msg[t],progress:0}),C1=new kt(0,.2),i7=()=>{let t=Pi[le.tutprogress];t&&C1.done(V.smoothtime)&&(C1.reset(V.smoothtime),(t.gate===void 0||t.gate())&&(t.gate&&t.gate()&&tn(le.tutprogress,void 0,1),t.fun&&t.fun()&&tn(le.tutprogress,t.step),t.fixed&&tn(le.tutprogress,void 0,t.fixed())))},tn=(t,e,n)=>(n||e>0)&&(t===-1||le.tutprogress===t)?(Bo.update(i=>i?(i.progress=Math.min(100,n||i.progress+e),i.complete=i.progress>=100,i.complete&&!i.closing&&(i.closing=!0,Mt(92),setTimeout(()=>{Bo.set(),setTimeout(()=>{$s.update(s=>(dy("tutorial","completestep",s,Math.round(performance.now()/1e3)),Pi[s+1]&&Pi[s+1].element&&typeof Pi[s+1].element!="string"&&(Pi[s+1].element=Pi[s+1].element()),s+1))},100)},1e3)),i):Xk(t)),!0):!1;var nn={partyleave:t=>({name:C.ui.party.leave,fun:()=>{xt("partyleave")}}),partyinvite:t=>({name:C.ui.party.invite,fun:()=>{xt("partyinvite",t)}}),partykick:t=>({name:C.ui.party.kick,fun:()=>{xt("partykick",t)}}),partygiveassistant:t=>({name:C.ui.party.giveAssistant,fun:()=>{xt("partysetrole",t+" 1")}}),partygiveleader:t=>({name:C.ui.party.giveLeader,fun:()=>{xt("partysetrole",t+" 2")}}),partyremoveassistant:t=>({name:C.ui.party.removeAssistant,fun:()=>{xt("partysetrole",t+" 0")}}),partycreate:t=>({name:C.ui.party.create,fun:()=>{xt("partycreate")}}),whisper:t=>({name:C.ui.chat.whisper,fun:()=>{Qi.set(t)}}),itemdrop:(...t)=>({name:C.ui.inventory.drop,fun:()=>A1(...t)}),itemsell:(...t)=>({name:C.ui.inventory.sell,fun:()=>Uf(...t)}),itemstash:t=>({name:C.ui.stash.stash,fun:()=>{xt("itemstash",t)}}),itemmove:(t,e)=>({name:C.ui.inventory.equip,fun:()=>{tn(13,100),xt("itemmove",`${t} ${e}`)}}),itemsplithalf:t=>({name:C.ui.inventory.splithalf,fun:()=>{xt("itemsplithalf",t)}}),itemsplitone:t=>({name:C.ui.inventory.splitone,fun:()=>{xt("itemsplitone",t)}}),itemuse:(t,e,n,i)=>({name:C.ui.inventory.use,fun:()=>{pp(n<i,()=>Si(Ft.clientPlayerSkill.packData({id:e,info:[t]})),"Bind Item","Using this item will bind it to you. Continue?")}}),itemcopyid:t=>({name:C.ui.inventory.copyitemid,fun:()=>{x3(t)}}),report:(t,e,n)=>({name:"Report",fun:i=>{oo.set({name:t,reason:0,messageId:e,info:n})}})},Qk=(t,e)=>{let n=[{name:e.name,css:"disabled"}];e.type===0&&(e.id==V.playerId?le.partyinfo.membercount>0?n.push(nn.partyleave()):n.push(nn.partycreate()):(e.faction==V.player.faction&&(en.has(e.name)?le.partyinfo.role>e.role&&(le.partyinfo.role==2&&n.push(nn.partykick(e.name)),e.role==0?n.push(nn.partygiveassistant(e.name)):e.role==1&&n.push(nn.partyremoveassistant(e.name)),le.partyinfo.role>1&&n.push(nn.partygiveleader(e.name))):n.push(nn.partyinvite(e.name))),n.push(nn.report(e.name)),n.push(nn.whisper(e.name)))),bn.set({x:t.pageX,y:t.pageY,opts:n})},Zk=(t,e,n,i,s,o,r,l)=>{pp(e>=le.itemProtectQuality||n>0,()=>{xt(t,`${i}`)},r,`${l} ${hn(s,o)}?`)},Uf=(t,e,n,i,s)=>{Zk("itemtradersell",t,e,n,i,s,"Sell item","Really sell")},A1=(t,e,n,i,s)=>{Zk("itemdrop",t,e,n,i,s,"Drop item","Really drop")};function Jk(t){let e,n;return{c(){e=h("img"),p(e,"class","icon svelte-erbdzy"),lt(e.src,n="/data/ui/icons/gem.svg?v=8588529")||p(e,"src",n)},m(i,s){w(i,e,s)},d(i){i&&x(e)}}}function s7(t){let e,n,i,s,o,r,l,a,c=t[4]&&Jk(t);return{c(){e=h("span"),c&&c.c(),n=h("img"),s=T(t[1]),o=Ne(),r=h("span"),l=T(t[0]),p(n,"class","icon svelte-erbdzy"),lt(n.src,i=Ys(t[2]))||p(n,"src",i),p(e,"class","textwhite"),p(r,"class",a="name textf"+t[3]+" svelte-erbdzy")},m(f,u){w(f,e,u),c&&c.m(e,null),d(e,n),d(e,s),d(e,o),w(f,r,u),d(r,l)},p(f,[u]){f[4]?c||(c=Jk(f),c.c(),c.m(e,n)):c&&(c.d(1),c=null),u&4&&!lt(n.src,i=Ys(f[2]))&&p(n,"src",i),u&2&&G(s,f[1]),u&1&&G(l,f[0]),u&8&&a!==(a="name textf"+f[3]+" svelte-erbdzy")&&p(r,"class",a)},i:ue,o:ue,d(f){f&&(x(e),x(r)),c&&c.d()}}}function o7(t,e,n){let{name:i}=e,{level:s}=e,{pclass:o}=e,{faction:r}=e,{sub:l=!1}=e;return t.$$set=a=>{"name"in a&&n(0,i=a.name),"level"in a&&n(1,s=a.level),"pclass"in a&&n(2,o=a.pclass),"faction"in a&&n(3,r=a.faction),"sub"in a&&n(4,l=a.sub)},[i,s,o,r,l]}var P1=class extends Me{constructor(e){super(),Ce(this,e,o7,s7,Ue,{name:0,level:1,pclass:2,faction:3,sub:4})}},zi=P1;var{Map:r7}=Fc;function Kk(t,e,n){let i=t.slice();return i[31]=e[n],i}function ex(t,e,n){let i=t.slice();return i[34]=e[n],i}function tx(t,e,n){let i=t.slice();return i[37]=e[n],i}function nx(t){let e,n,i,s,o;n=new zi({props:{name:t[37].sender,pclass:t[37].cclass,level:t[37].level,faction:t[37].faction,sub:t[37].sub}});function r(...a){return t[14](t[37],...a)}function l(...a){return t[15](t[37],...a)}return{c(){e=h("span"),ne(n.$$.fragment),p(e,"class","sender svelte-16y0b84")},m(a,c){w(a,e,c),ee(n,e,null),i=!0,s||(o=[Z(e,"contextmenu",r),Z(e,"dblclick",l)],s=!0)},p(a,c){t=a;let f={};c[0]&32&&(f.name=t[37].sender),c[0]&32&&(f.pclass=t[37].cclass),c[0]&32&&(f.level=t[37].level),c[0]&32&&(f.faction=t[37].faction),c[0]&32&&(f.sub=t[37].sub),n.$set(f)},i(a){i||(P(n.$$.fragment,a),i=!0)},o(a){q(n.$$.fragment,a),i=!1},d(a){a&&x(e),te(n),s=!1,at(o)}}}function l7(t){let e,n=t[37].text+"",i,s;return{c(){e=h("span"),i=T(n),p(e,"class",s="text"+t[37].channel+" svelte-16y0b84")},m(o,r){w(o,e,r),d(e,i)},p(o,r){r[0]&32&&n!==(n=o[37].text+"")&&G(i,n),r[0]&32&&s!==(s="text"+o[37].channel+" svelte-16y0b84")&&p(e,"class",s)},d(o){o&&x(e)}}}function a7(t){let e,n=t[37].text+"",i;return{c(){e=h("span"),p(e,"class",i="text"+t[37].channel+" svelte-16y0b84")},m(s,o){w(s,e,o),e.innerHTML=n},p(s,o){o[0]&32&&n!==(n=s[37].text+"")&&(e.innerHTML=n),o[0]&32&&i!==(i="text"+s[37].channel+" svelte-16y0b84")&&p(e,"class",i)},d(s){s&&x(e)}}}function ix(t,e){let n,i,s,o=e[37].time+"",r,l,a,c=e[37].channel+"",f,u,m,g,v=e[37].sender&&nx(e);function _(k,S){return k[37].interpolate?a7:l7}let b=_(e,[-1,-1]),y=b(e);return{key:t,first:null,c(){n=h("article"),i=h("div"),s=h("span"),r=T(o),l=h("span"),a=h("span"),f=T(c),u=Ne(),v&&v.c(),y.c(),p(s,"class","time svelte-16y0b84"),p(a,"class","capitalize channel svelte-16y0b84"),p(l,"class",m="text"+e[37].channel+" content svelte-16y0b84"),p(i,"class","linewrap svelte-16y0b84"),p(n,"class","line svelte-16y0b84"),this.first=n},m(k,S){w(k,n,S),d(n,i),d(i,s),d(s,r),d(i,l),d(l,a),d(a,f),d(l,u),v&&v.m(l,null),y.m(i,null),g=!0},p(k,S){e=k,(!g||S[0]&32)&&o!==(o=e[37].time+"")&&G(r,o),(!g||S[0]&32)&&c!==(c=e[37].channel+"")&&G(f,c),e[37].sender?v?(v.p(e,S),S[0]&32&&P(v,1)):(v=nx(e),v.c(),P(v,1),v.m(l,null)):v&&(Pe(),q(v,1,1,()=>{v=null}),Te()),(!g||S[0]&32&&m!==(m="text"+e[37].channel+" content svelte-16y0b84"))&&p(l,"class",m),b===(b=_(e,S))&&y?y.p(e,S):(y.d(1),y=b(e),y&&(y.c(),y.m(i,null)))},i(k){g||(P(v),g=!0)},o(k){q(v),g=!1},d(k){k&&x(n),v&&v.d(),y.d()}}}function sx(t){let e,n,i=t[34]+"",s,o,r,l;function a(...c){return t[17](t[34],...c)}return{c(){e=h("div"),n=T("/"),s=T(i),p(e,"class",o="choice textsystem text"+t[34]+" svelte-16y0b84")},m(c,f){w(c,e,f),d(e,n),d(e,s),r||(l=Z(e,"click",a),r=!0)},p(c,f){t=c},d(c){c&&x(e),r=!1,l()}}}function ox(t){let e,n=t[31]+"",i,s,o,r;function l(...a){return t[21](t[31],...a)}return{c(){e=h("small"),i=T(n),p(e,"class",s="btn border black text"+(t[0].indexOf(t[31])<0?t[31]:"grey")+" svelte-16y0b84")},m(a,c){w(a,e,c),d(e,i),o||(r=Z(e,"click",l),o=!0)},p(a,c){t=a,c[0]&1&&s!==(s="btn border black text"+(t[0].indexOf(t[31])<0?t[31]:"grey")+" svelte-16y0b84")&&p(e,"class",s)},d(a){a&&x(e),o=!1,r()}}}function c7(t){let e,n,i=[],s=new r7,o,r,l,a,c,f,u,m,g,v,_,b,y,k,S,A=me(t[5]),F=L=>L[37].key;for(let L=0;L<A.length;L+=1){let B=tx(t,A,L),I=F(B);s.set(I,i[L]=ix(I,B))}let M=me(Object.keys(Kr)),D=[];for(let L=0;L<M.length;L+=1)D[L]=sx(ex(t,M,L));let R=me(t[12]),E=[];for(let L=0;L<R.length;L+=1)E[L]=ox(Kk(t,R,L));return{c(){e=h("div"),n=h("section");for(let L=0;L<i.length;L+=1)i[L].c();o=h("div"),r=h("section"),l=h("div"),a=h("div");for(let L=0;L<D.length;L+=1)D[L].c();c=h("div"),c.textContent="/[playername]",f=h("div"),u=T(t[6]),g=h("input"),_=h("div");for(let L=0;L<E.length;L+=1)E[L].c();p(n,"id","chat"),p(n,"class","panel frame scrollbar svelte-16y0b84"),p(c,"class","choice textwhisper"),p(a,"class","panel context commandlist textsystem svelte-16y0b84"),ze(a,"display",t[4]?"block":"none"),p(f,"class",m="command btn black text"+(_o[t[6]]?_o[t[6]].chat?t[6]:"system":"whisper")+" svelte-16y0b84"),p(g,"maxlength","480"),p(g,"type","text"),p(g,"class","svelte-16y0b84"),p(l,"id","chatinput"),p(l,"class","inputcontainer panel-black border black svelte-16y0b84"),p(r,"class",v="chatsection "+(t[3]?"":"hidden")+" svelte-16y0b84"),p(_,"class",b="channelselect "+(t[3]?"hidden":"")+" svelte-16y0b84"),p(o,"class","lowercontainer svelte-16y0b84"),p(e,"class","l-corner-ll container uiscaled svelte-16y0b84")},m(L,B){w(L,e,B),d(e,n);for(let I=0;I<i.length;I+=1)i[I]&&i[I].m(n,null);t[16](n),d(e,o),d(o,r),d(r,l),d(l,a);for(let I=0;I<D.length;I+=1)D[I]&&D[I].m(a,null);d(a,c),d(l,f),d(f,u),d(l,g),t[19](g),d(o,_);for(let I=0;I<E.length;I+=1)E[I]&&E[I].m(_,null);y=!0,k||(S=[Z(f,"click",t[18]),Z(g,"input",t[20])],k=!0)},p(L,B){if(B[0]&2336&&(A=me(L[5]),Pe(),i=ui(i,B,F,1,L,A,s,n,Ii,ix,null,tx),Te()),B[0]&512){M=me(Object.keys(Kr));let I;for(I=0;I<M.length;I+=1){let N=ex(L,M,I);D[I]?D[I].p(N,B):(D[I]=sx(N),D[I].c(),D[I].m(a,c))}for(;I<D.length;I+=1)D[I].d(1);D.length=M.length}if((!y||B[0]&16)&&ze(a,"display",L[4]?"block":"none"),(!y||B[0]&64)&&G(u,L[6]),(!y||B[0]&64&&m!==(m="command btn black text"+(_o[L[6]]?_o[L[6]].chat?L[6]:"system":"whisper")+" svelte-16y0b84"))&&p(f,"class",m),(!y||B[0]&8&&v!==(v="chatsection "+(L[3]?"":"hidden")+" svelte-16y0b84"))&&p(r,"class",v),B[0]&5121){R=me(L[12]);let I;for(I=0;I<R.length;I+=1){let N=Kk(L,R,I);E[I]?E[I].p(N,B):(E[I]=ox(N),E[I].c(),E[I].m(_,null))}for(;I<E.length;I+=1)E[I].d(1);E.length=R.length}(!y||B[0]&8&&b!==(b="channelselect "+(L[3]?"hidden":"")+" svelte-16y0b84"))&&p(_,"class",b)},i(L){if(!y){for(let B=0;B<A.length;B+=1)P(i[B]);y=!0}},o(L){for(let B=0;B<i.length;B+=1)q(i[B]);y=!1},d(L){L&&x(e);for(let B=0;B<i.length;B+=1)i[B].d();t[16](null),it(D,L),t[19](null),it(E,L),k=!1,at(S)}}}function f7(t,e,n){let i,s,o,r;re(t,nf,X=>n(0,s=X)),re(t,Dc,X=>n(13,o=X)),re(t,Qi,X=>n(6,r=X));let l,a=!0;ch(()=>{a=l&&(l.offsetHeight+l.scrollTop>l.scrollHeight-20||l.scrollTop==0)}),Ac(()=>{a!==!1&&l.scrollTo(0,l.scrollHeight)});let c,f=!1,u=[],m=0,g=!1,v,_="faction",b=new Map([["c","clan"],["p","party"],["f","faction"]]),y=X=>{let oe=X.match(/^\/[a-zA-Z0-9]+ /g);if(oe){let ce=oe[0].substring(1,oe[0].length-1);if(ce==="r"||ce==="w")for(let xe=o.length-1;xe>0;--xe){let pe=o[xe];pe.channel=="from"&&(nt(Qi,r=pe.sender,r),xe=0)}else nt(Qi,r=b.has(ce)?b.get(ce):ce,r);n(2,c.value=X.substring(oe[0].length),c)}},k=X=>_o[X]&&_o[X].chat,S=X=>{if(X.keyCode===13)if(X.target==c){if(X.target.value!=""){tn(41,100);let xe=X.target.value.match(/^\/[a-zA-Z0-9]+/g);xe&&(nt(Qi,r=xe[0].substring(1),r),n(2,c.value="",c)),Kr[r]!==void 0&&Kr[r].client?Kr[r].fun(c.value):xt(r,c.value),n(2,c.value="",c),n(3,f=!1),c.blur()}else k(r)||xt(r,c.value),n(3,f=!1),c.blur();let oe=`/${r} `,ce=u.indexOf(oe);ce>=0&&u.splice(ce,1),u.length>10&&u.splice(0,1),u.push(oe),k(r)?_=r:(nt(Qi,r=_,r),m=u.length)}else document.activeElement==document.body&&F();else(X.keyCode===38||X.keyCode===40)&&u.length?X.target==c&&(m+=X.keyCode===38?-1:1,m=vt(m,0,u.length-1),y(u[m]),X.preventDefault()):X.keyCode===27&&(n(3,f=!1),c.blur())},A=X=>{c&&c.focus()},F=X=>{X&&nt(Qi,r=X,r),n(3,f=!0),dh().then(A),tn(40,100)},M=X=>{nt(Qi,r=X,r),n(4,g=!1),c&&c.focus()};Pn(()=>{document.addEventListener("keydown",S)}),Tn(()=>{document.removeEventListener("keydown",S),n(2,c=void 0)});let D=X=>{let oe=s.indexOf(X);nf.update(ce=>(oe>=0?ce.splice(oe,1):ce.push(X),ce))},R=(X,oe)=>{let ce=[{name:oe.sender,css:"disabled"}];V.player.name!==oe.sender&&(oe.faction==V.player.faction&&!en.has(oe.sender)&&ce.push(nn.partyinvite(oe.sender)),oe.channel!=="to"&&ce.push(nn.report(oe.sender,oe.id,`Message: \u201C${oe.text.length>40?oe.text.substring(0,37)+"...":oe.text}\u201D`)),ce.push({name:"Whisper",fun:xe=>{F(oe.sender)}})),bn.set({x:X.pageX,y:X.pageY,opts:ce}),X.preventDefault()},E=["faction","party","clan","pvp","inv","yell"],L=(X,oe)=>R(oe,X),B=(X,oe)=>{F(X.sender)};function I(X){$t[X?"unshift":"push"](()=>{l=X,n(1,l)})}let N=(X,oe)=>M(X),j=X=>n(4,g=!g);function W(X){$t[X?"unshift":"push"](()=>{c=X,n(2,c)})}let O=X=>y(X.target.value),se=(X,oe)=>D(X);return t.$$.update=()=>{t.$$.dirty[0]&8193&&n(5,i=o.filter(X=>s.indexOf(X.channel)<0))},[s,l,c,f,g,i,r,y,F,M,D,R,E,o,L,B,I,N,j,W,O,se]}var T1=class extends Me{constructor(e){super(),Ce(this,e,f7,c7,Ue,{},null,[-1,-1])}},rx=T1;function lx(t){let e,n;return{c(){e=h("img"),lt(e.src,n="/data/ui/icons/"+t[1]+".svg?v=8588529")||p(e,"src",n),p(e,"class","titleicon svgicon svelte-i6tm3j")},m(i,s){w(i,e,s)},p(i,s){s&2&&!lt(e.src,n="/data/ui/icons/"+i[1]+".svg?v=8588529")&&p(e,"src",n)},d(i){i&&x(e)}}}function ax(t){let e,n,i,s;return{c(){e=h("img"),lt(e.src,n="/data/ui/icons/cross.svg?v=8588529")||p(e,"src",n),p(e,"class","btn black svgicon")},m(o,r){w(o,e,r),i||(s=Z(e,"click",t[17]),i=!0)},p:ue,d(o){o&&x(e),i=!1,s()}}}function u7(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v,_,b=t[1]&&lx(t),y=t[2]&&ax(t),k=t[16].default,S=jl(k,t,t[15],null);return{c(){e=h("div"),n=h("div"),i=h("div"),b&&b.c(),s=h("div"),o=h("div"),r=T(t[0]),l=h("img"),y&&y.c(),f=h("div"),S&&S.c(),p(s,"class","textprimary title svelte-i6tm3j"),lt(l.src,a="/data/ui/icons/cog.svg?v=8588529")||p(l,"src",a),p(l,"class","btn black svgicon marg-right"),p(i,"class","titleframe svelte-i6tm3j"),p(i,"style",c=t[5]?"":"cursor: pointer;"),p(f,"class",u="slot "+(t[3]?"scrollbar":"")+" svelte-i6tm3j"),p(n,"class","window panel-black svelte-i6tm3j"),p(e,"class","window-pos"),p(e,"style",m="z-index: 9; position: absolute; "+t[8]+": "+Math.round(t[6][0])+"px; "+t[9]+": "+Math.round(t[6][1])+"px;")},m(A,F){w(A,e,F),d(e,n),d(n,i),b&&b.m(i,null),d(i,s),d(s,o),d(o,r),d(i,l),y&&y.m(i,null),d(n,f),S&&S.m(f,null),t[18](n),g=!0,v||(_=[Z(l,"click",t[11]),Z(i,"mousedown",H2(t[10]))],v=!0)},p(A,[F]){A[1]?b?b.p(A,F):(b=lx(A),b.c(),b.m(i,s)):b&&(b.d(1),b=null),(!g||F&1)&&G(r,A[0]),A[2]?y?y.p(A,F):(y=ax(A),y.c(),y.m(i,null)):y&&(y.d(1),y=null),(!g||F&32&&c!==(c=A[5]?"":"cursor: pointer;"))&&p(i,"style",c),S&&S.p&&(!g||F&32768)&&Gl(S,k,A,A[15],g?Wl(k,A[15],F,null):Hl(A[15]),null),(!g||F&8&&u!==(u="slot "+(A[3]?"scrollbar":"")+" svelte-i6tm3j"))&&p(f,"class",u),(!g||F&64&&m!==(m="z-index: 9; position: absolute; "+A[8]+": "+Math.round(A[6][0])+"px; "+A[9]+": "+Math.round(A[6][1])+"px;"))&&p(e,"style",m)},i(A){g||(P(S,A),g=!0)},o(A){q(S,A),g=!1},d(A){A&&x(e),b&&b.d(),y&&y.d(),S&&S.d(A),t[18](null),v=!1,at(_)}}}function m7(t,e,n){let i;re(t,lf,X=>n(23,i=X));let{$$slots:s={},$$scope:o}=e,r=Mr(),{title:l="Title"}=e,{icon:a=void 0}=e,{close:c=!0}=e,{scroll:f=!1}=e,{settings:u=[]}=e,{origin:m="right bottom"}=e,{defaultOffset:g=[3,3]}=e,v,_,b=m==="center"?"left":m.split(" ")[0],y=m==="center"?"top":m.split(" ")[1],k=b==="right"?1:-1,S=y==="bottom"?1:-1,A=0,F=0,M=!1,D=[...g],R=[0,0],E=X=>{X.button!==0||M||(R=[X.clientX,X.clientY],document.addEventListener("mousemove",L),document.addEventListener("mouseup",B))},L=X=>{n(6,D=[D[0]-(X.clientX-R[0])*k,D[1]-(X.clientY-R[1])*S]),R=[X.clientX,X.clientY],I()},B=()=>{document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",B)},I=()=>{let[X,oe,ce]=[v.offsetWidth,v.offsetHeight,30];n(6,D[0]=Math.max(-X+ce,Math.min(D[0],A-ce)),D),n(6,D[1]=y==="bottom"?Math.max(-oe+ce,Math.min(D[1],F-oe)):Math.max(0,Math.min(D[1],F-ce)),D),N()};Pn(()=>{let X=v.parentElement.parentElement;A=X.clientWidth,F=X.clientHeight;let oe=i.find(ce=>ce.id===l);oe?(n(6,D=oe.offset),n(5,M=oe.locked)):j(),_=new ResizeObserver(ce=>{let{width:xe,height:pe}=ce[0].contentRect;m==="center"&&(n(6,D[0]+=(xe-A)/2,D),n(6,D[1]+=(pe-F)/2,D)),A=xe,F=pe,I()}),_.observe(v.parentElement.parentElement)}),Tn(()=>{document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",B),_.disconnect(),n(4,v=_=void 0)});let N=()=>{lf.update(X=>{let oe=X.find(ce=>ce.id===l);return oe||(oe={id:l},X.push(oe)),oe.offset=D,oe.locked=M,X})},j=()=>{if(m==="center"){let[X,oe]=[v.offsetWidth,v.offsetHeight];n(6,D=[A/2-X/2,F/2-oe/2])}else n(6,D=[...g])},W=X=>{let oe=[{name:l,css:"disabled"},{name:(M?"Unlock":"Lock")+" Window",fun:()=>{n(5,M=!M),N()}},{name:"Reset Window",fun:()=>{j(),N()}},...u];bn.set({x:X.pageX,y:X.pageY,right:!0,opts:oe})},O=()=>r("close");function se(X){$t[X?"unshift":"push"](()=>{v=X,n(4,v)})}return t.$$set=X=>{"title"in X&&n(0,l=X.title),"icon"in X&&n(1,a=X.icon),"close"in X&&n(2,c=X.close),"scroll"in X&&n(3,f=X.scroll),"settings"in X&&n(12,u=X.settings),"origin"in X&&n(13,m=X.origin),"defaultOffset"in X&&n(14,g=X.defaultOffset),"$$scope"in X&&n(15,o=X.$$scope)},[l,a,c,f,v,M,D,r,b,y,E,W,u,m,g,o,s,O,se]}var E1=class extends Me{constructor(e){super(),Ce(this,e,m7,u7,Ue,{title:0,icon:1,close:2,scroll:3,settings:12,origin:13,defaultOffset:14})}},Nt=E1;var cx=t=>{let e=(t||0).toString().split(""),n=e.splice(-2).join(""),i=e.splice(-2).join(""),s=e.join("");return{c:n,s:i,g:s}};var Ba=(t,e=!0)=>{let n=Object.entries(t);return n.forEach(i=>{i[0]=parseInt(i[0]),e&&typeof i[1]=="object"&&(i[1]=Ba(i[1]))}),new Map(n)};var ni=t=>t>=1e4?(t/1e3).toFixed(1)+"k":ht(t);var ht=t=>t<1e3?t+"":ht(~~(t/1e3))+","+("00"+~~(t%1e3)).substr(-3,3),ux=(t,e)=>t.length>e?`${t.slice(0,e-2)}...`:t,fx=Ba({14:.1,13:.1,9:.1,8:.1,16:.1}),p7=Ba({14:"%",13:"%",16:"%",18:"%"}),ii=(t,e)=>(fx.has(t)&&(e*=fx.get(t),e=e.toFixed(e>=.1?1:2)),e+(p7.get(t)||""));var d7=t=>t.replace(/\$c(\d)/g,(e,n)=>`<img class=texticon src='${Ys(n)}'>`),h7=t=>t.replace(/\$l(\d+)/g,(e,n)=>`<span class=textwhite>${n}</span>`),g7=t=>t.replace(/\$f(\d)(\w*)/g,(e,n,i)=>`<span class=textf${n}>${i}</span>`),v7=t=>t.replace(/\$gt/g,(e,n)=>'<img class="svgicon" src="/data/ui/icons/check.svg?v=8588529">'),_7=t=>t.replace(/\$e(\d+)/g,(e,n)=>Of(n,!1)),b7=t=>t.replace(/\$g(\d+)/g,(e,n)=>D1(n,!1)),y7=t=>t.replace(/\$m(\d+)/g,(e,n)=>I1(n,!1)),k7=t=>t.replace(/\$sp(\d+)/g,(e,n)=>"<img class=texticon src=/data/ui/icons/gem.svg?v=8588529/>"+n),x7=t=>t.replace(/\$fm(\d+)/g,(e,n)=>`<span class=textfame><img class=svgicon src='/data/ui/currency/fame.svg?v=8588529'> ${n}</span>`),D1=(t,e=!1)=>{let{c:n,s:i,g:s}=cx(t),o="<span/>";return s!=""&&(o+=`<span class=${e?"textred":"textgold"}>${s}</span> <img class=texticon src='/data/ui/currency/gold.${On}?v=8588529'/>`),i!=""&&(o+=`<span class=${e?"textred":"textsilver"}>${i}</span> <img class=texticon src='/data/ui/currency/silver.${On}?v=8588529'/>`),n!=""&&(o+=`<span class=${e?"textred":"textcopper"}>${n}</span> <img class=texticon src='/data/ui/currency/copper.${On}?v=8588529'/>`),o+"</span>"};var I1=(t,e=!1)=>`<span class='${e?"textred":"textgold"}'><img class='svgicon' src='${zk}'> ${ht(t)}</span>`,Of=t=>`<span class='bold textpvp'><img class='svgicon' src='${Rk(t)}'> ${ht(t)}</span>`,ll=(t,e)=>`<span class='bold textprimary'><img class='svgicon' src='${Bk(t)}'> ${e}</span>`,w7=[d7,h7,g7,b7,x7,v7,k7,y7,_7],$f=t=>w7.reduce((e,n)=>n(e),t);function mx(t,e,n){let i=t.slice();return i[4]=e[n],i[6]=n,i}function px(t){let e,n;return e=new Nt({props:{origin:"center",title:C.ui.headers.interaction,$$slots:{default:[M7]},$$scope:{ctx:t}}}),e.$on("close",t[3]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&129&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function dx(t){let e,n,i=$f(t[4])+"",s,o,r;function l(...a){return t[2](t[6],...a)}return{c(){e=h("div"),n=h("span"),p(e,"class","btn border black textgreen"),p(e,"value",s=t[6])},m(a,c){w(a,e,c),d(e,n),n.innerHTML=i,o||(r=Z(e,"click",l),o=!0)},p(a,c){t=a,c&1&&i!==(i=$f(t[4])+"")&&(n.innerHTML=i)},d(a){a&&x(e),o=!1,r()}}}function M7(t){let e,n,i=t[0].title+"",s,o,r=t[0].text+"",l,a=me(t[0].choices),c=[];for(let f=0;f<a.length;f+=1)c[f]=dx(mx(t,a,f));return{c(){e=h("div"),n=h("h3"),s=T(i),o=h("p"),l=T(r);for(let f=0;f<c.length;f+=1)c[f].c();p(n,"class","textprimary name svelte-k1vie9"),p(e,"class","container svelte-k1vie9")},m(f,u){w(f,e,u),d(e,n),d(n,s),d(e,o),d(o,l);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(e,null)},p(f,u){if(u&1&&i!==(i=f[0].title+"")&&G(s,i),u&1&&r!==(r=f[0].text+"")&&G(l,r),u&3){a=me(f[0].choices);let m;for(m=0;m<a.length;m+=1){let g=mx(f,a,m);c[m]?c[m].p(g,u):(c[m]=dx(g),c[m].c(),c[m].m(e,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=a.length}},d(f){f&&x(e),it(c,f)}}}function F7(t){let e,n,i=t[0]&&px(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=px(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function C7(t,e,n){let i;re(t,qs,l=>n(0,i=l));function s(l){Si(Ft.clientPlayerInteract.packData({id:l})),nt(qs,i=void 0,i)}return[i,s,(l,a)=>s(l),()=>{nt(qs,i=void 0,i)}]}var V1=class extends Me{constructor(e){super(),Ce(this,e,C7,F7,Ue,{})}},hx=V1;function S7(t){let e,n,i,s,o,r,l,a,c,f=t[7].default,u=jl(f,t,t[6],null);return{c(){e=h("div"),n=h("div"),i=h("span"),s=T(t[0]),o=h("span"),r=T(t[1]),u&&u.c(),p(i,"class","left svelte-i7i7g5"),p(o,"class","right svelte-i7i7g5"),p(n,"class",l="progressBar "+t[3]+" svelte-i7i7g5"),ze(n,"width",t[2]+"%"),ze(n,"font-size",t[4]),p(e,"class",a="bar "+(t[5]?"dark":"")+" svelte-i7i7g5"),ze(e,"z-index",t[3]=="hp"?"1":"0")},m(m,g){w(m,e,g),d(e,n),d(n,i),d(i,s),d(n,o),d(o,r),u&&u.m(e,null),c=!0},p(m,[g]){(!c||g&1)&&G(s,m[0]),(!c||g&2)&&G(r,m[1]),(!c||g&8&&l!==(l="progressBar "+m[3]+" svelte-i7i7g5"))&&p(n,"class",l),(!c||g&4)&&ze(n,"width",m[2]+"%"),(!c||g&16)&&ze(n,"font-size",m[4]),u&&u.p&&(!c||g&64)&&Gl(u,f,m,m[6],c?Wl(f,m[6],g,null):Hl(m[6]),null),(!c||g&32&&a!==(a="bar "+(m[5]?"dark":"")+" svelte-i7i7g5"))&&p(e,"class",a),(!c||g&8)&&ze(e,"z-index",m[3]=="hp"?"1":"0")},i(m){c||(P(u,m),c=!0)},o(m){q(u,m),c=!1},d(m){m&&x(e),u&&u.d(m)}}}function A7(t,e,n){let{$$slots:i={},$$scope:s}=e,{left:o=""}=e,{right:r=""}=e,{fract:l}=e,{barcol:a}=e,{size:c}=e,{darken:f}=e;return t.$$set=u=>{"left"in u&&n(0,o=u.left),"right"in u&&n(1,r=u.right),"fract"in u&&n(2,l=u.fract),"barcol"in u&&n(3,a=u.barcol),"size"in u&&n(4,c=u.size),"darken"in u&&n(5,f=u.darken),"$$scope"in u&&n(6,s=u.$$scope)},[o,r,l,a,c,f,s,i]}var L1=class extends Me{constructor(e){super(),Ce(this,e,A7,S7,Fn,{left:0,right:1,fract:2,barcol:3,size:4,darken:5})}},vi=L1;var q1={};Xn(q1,{init:()=>P7,updateCd:()=>jf});var Nf=new Map,gx=!1,P7=()=>{fetch("/data/ui/circlecooldowns/circlecooldowns.txt?v=8588529").then(async t=>{let e=(await t.text()).split(`
`);for(let n=0;n<3;++n){let i=[];for(let s=0;s<101;++s){let o=new Image;o.src=e.shift(),i.push([o])}Nf.set([40,31,23][n],i)}gx=!0})},jf=(t,e,n)=>{gx&&e&&t!==e.step&&(e.cdimg!==void 0&&(Nf.get(n)[e.step].push(e.removeChild(e.cdimg)),e.cdimg=void 0),(e.step=t)>0&&(Nf.get(n)[e.step].length===1?e.cdimg=Nf.get(n)[e.step][0].cloneNode():e.cdimg=Nf.get(n)[e.step].pop(),e.appendChild(e.cdimg)))};function vx(t){let e,n;return{c(){e=h("div"),n=T(t[0]),p(e,"class","stacks slottext svelte-1nn7wcb")},m(i,s){w(i,e,s),d(e,n)},p(i,s){s&1&&G(n,i[0])},d(i){i&&x(e)}}}function _x(t){let e,n=(t[5]>99?Math.round(t[5]/60)+"'":Math.ceil(t[5]))+"",i;return{c(){e=h("div"),i=T(n),p(e,"class","time absCentered slottext svelte-1nn7wcb")},m(s,o){w(s,e,o),d(e,i)},p(s,o){o&32&&n!==(n=(s[5]>99?Math.round(s[5]/60)+"'":Math.ceil(s[5]))+"")&&G(i,n)},d(s){s&&x(e)}}}function T7(t){let e,n,i,s,o,r,l,a,c,f,u=t[0]>1&&vx(t),m=t[3]>30&&le.cdTextBuffs&&t[5]>0&&_x(t);return{c(){e=h("div"),n=h("div"),i=h("img"),o=h("div"),u&&u.c(),r=ve(),m&&m.c(),p(i,"class","icon svelte-1nn7wcb"),lt(i.src,s=t[1])||p(i,"src",s),ze(i,"max-width",t[3]+"px"),p(o,"class","overlay svelte-1nn7wcb"),p(n,"class",l="slot border "+(t[2]===1?"negative":"positive")+" svelte-1nn7wcb"),p(e,"class",a="container "+(t[5]<le.buffCdFlashingDuration&&t[5]%le.buffCdFlashingInterval*2>le.buffCdFlashingInterval?"soon":"")+" svelte-1nn7wcb")},m(g,v){w(g,e,v),d(e,n),d(n,i),d(n,o),t[10](o),u&&u.m(n,null),d(n,r),m&&m.m(n,null),c||(f=Z(e,"contextmenu",t[6]),c=!0)},p(g,[v]){v&2&&!lt(i.src,s=g[1])&&p(i,"src",s),v&8&&ze(i,"max-width",g[3]+"px"),g[0]>1?u?u.p(g,v):(u=vx(g),u.c(),u.m(n,r)):u&&(u.d(1),u=null),g[3]>30&&le.cdTextBuffs&&g[5]>0?m?m.p(g,v):(m=_x(g),m.c(),m.m(n,null)):m&&(m.d(1),m=null),v&4&&l!==(l="slot border "+(g[2]===1?"negative":"positive")+" svelte-1nn7wcb")&&p(n,"class",l),v&32&&a!==(a="container "+(g[5]<le.buffCdFlashingDuration&&g[5]%le.buffCdFlashingInterval*2>le.buffCdFlashingInterval?"soon":"")+" svelte-1nn7wcb")&&p(e,"class",a)},i:ue,o:ue,d(g){g&&x(e),t[10](null),u&&u.d(),m&&m.d(),c=!1,f()}}}function E7(t,e,n){let{stacks:i}=e,{duration:s}=e,{time:o}=e,{icon:r}=e,{type:l}=e,{size:a}=e,{cancel:c}=e,f=1,u=0,m,g=()=>{c>=0&&xt("cancelbuff",c)};function v(_){$t[_?"unshift":"push"](()=>{m=_,n(4,m)})}return t.$$set=_=>{"stacks"in _&&n(0,i=_.stacks),"duration"in _&&n(7,s=_.duration),"time"in _&&n(8,o=_.time),"icon"in _&&n(1,r=_.icon),"type"in _&&n(2,l=_.type),"size"in _&&n(3,a=_.size),"cancel"in _&&n(9,c=_.cancel)},t.$$.update=()=>{t.$$.dirty&408&&(n(5,u=s-o),jf(Math.round(o/s*100),m,a))},[i,r,l,a,m,u,g,s,o,c,v]}var R1=class extends Me{constructor(e){super(),Ce(this,e,E7,T7,Fn,{stacks:0,duration:7,time:8,icon:1,type:2,size:3,cancel:9})}},bx=R1;var sg={};Xn(sg,{envSkillId:()=>sr,findEnvironmentTarget:()=>Sw,hoverinteractive:()=>nd,hovertarget:()=>vn,init:()=>UE,onWorldDestroy:()=>HE,parseHudTargets:()=>ig,playertarget:()=>qn,preTick:()=>jE,ray:()=>nr,setEnvCast:()=>Qf,setHoverTarget:()=>Xf,setTarget:()=>ir,targetSwitchConciliate:()=>ng,targetSwitchNetTimer:()=>ml,tick:()=>WE});var kx=(t,e,n)=>{let i=$.getUniformBlockIndex(t,e),s=$.getActiveUniformBlockParameter(t,i,$.UNIFORM_BLOCK_DATA_SIZE),o={name:e,size:s,uniforms:[],index:n},r=$.getActiveUniformBlockParameter(t,i,$.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES),l=$.getActiveUniforms(t,r,$.UNIFORM_OFFSET);for(let a=0;a<r.length;++a){let c=r[a],f=$.getActiveUniform(t,c),u=l[a],m=f.size,g=0,v=0,_=!1;f.type===$.FLOAT_VEC3?(g=3,v=m>1?4:3):f.type===$.FLOAT_VEC2?(g=2,v=m>1?4:2):f.type===$.FLOAT_VEC4?(g=4,v=4):f.type===$.FLOAT_MAT4?(g=16,v=16):f.type===$.FLOAT?(g=1,v=1):f.type===$.INT&&(g=1,v=1,_=!0),m*=g;let b={name:f.name.replace("[0]",""),size:m,offset:u,divisor:v,elements:g,isInt:_};o.uniforms.push(b)}return o.uniforms.sort((a,c)=>a.offset-c.offset),o},Ua=t=>{let e={layout:t,buffer:$.createBuffer(),data:{},dataArray:[]};$.bindBuffer($.UNIFORM_BUFFER,e.buffer),$.bufferData($.UNIFORM_BUFFER,t.size,$.DYNAMIC_DRAW),$.bindBuffer($.UNIFORM_BUFFER,null);for(let n=0;n<t.uniforms.length;++n){let i=t.uniforms[n],s=[];for(let o=0;o<i.size;++o)s.push(0);e.data[i.name]=s,e.dataArray.push(s)}return e},al=t=>{$.bindBufferBase($.UNIFORM_BUFFER,t.layout.index,t.buffer)},wo=(t,e,n,i=0)=>{i===0&&(i=e.length);for(let s=0;s<i;++s)t[s+n]=e[s]},xx=new ArrayBuffer(1e3),D7=new Int32Array(xx),yx=new Float32Array(xx),zp=t=>{for(let e=0;e<t.layout.uniforms.length;++e){let n=t.layout.uniforms[e];t.data[n.name]!==t.dataArray[e]&&(t.dataArray[e]=t.data[n.name])}},si=t=>{let e=0;for(let n=0;n<t.layout.uniforms.length;++n){let i=t.layout.uniforms[n],s=t.dataArray[n],o=i.isInt?D7:yx,r=0;for(;r<s.length;)for(let l=0;l<i.divisor;++l)l<i.elements&&(o[e]=s[r],r++),e++}$.bindBuffer($.UNIFORM_BUFFER,t.buffer),$.bufferSubData($.UNIFORM_BUFFER,0,yx,0,t.layout.size/4),$.bindBuffer($.UNIFORM_BUFFER,null)};var Oa=[],$a,bs,Mo,fl,ul,wx=t=>{let e=et.width,n=et.height;for(let i=0;i<2;++i)Oa.push(yo(t,t,0,!0,$.COMPARE_REF_TO_TEXTURE));$a=yo(t,t,0,!0,$.COMPARE_REF_TO_TEXTURE),bs=yo(e,n,1,!0),Mo=yo(e,n,1,!0),fl=yo(Math.ceil(e/4),Math.ceil(n/4)),ul=yo(Math.ceil(e/4),Math.ceil(n/4))},Mx=(t,e)=>{Mf(bs,t,e),Mf(Mo,t,e),Mf(fl,Math.ceil(t/4),Math.ceil(e/4)),Mf(ul,Math.ceil(t/4),Math.ceil(e/4))};var Zp={};Xn(Zp,{bloom:()=>O1,bloomMerge:()=>$1,drop:()=>Bp,foliagePlant:()=>Up,foliageStatic:()=>Op,fxaa:()=>N1,multimeshEffect:()=>$p,multimeshFlat:()=>Np,multimeshSimple:()=>jp,multimeshTextured:()=>Wf,multimeshTexturedVcol:()=>Wp,multimeshTree:()=>z1,particles:()=>Gp,particles_additive:()=>B1,particles_normal:()=>U1,ribbon:()=>Gf,ribbonTextured:()=>W1,shadowInstanced:()=>Hf,shadowInstancedAlpha:()=>G1,simple:()=>Hp,simpleTextured:()=>TE,simpleVcol:()=>EE,sky:()=>H1,skyStarTex:()=>Y1,sun:()=>X1,terrain:()=>Yp,terrainEditorAreas:()=>DE,terrainEditorGrid:()=>IE,terrainEditorHeights:()=>VE,terrainEditorTiles:()=>LE,terrainFog:()=>Xp,tint:()=>j1,water:()=>Qp,waterEditorGrid:()=>qE});var Cx=`#version 300 es
precision highp float;precision highp int;out vec4 fragColor;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D diffuse;in vec2 vUv;in float vShine;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 a=texture(diffuse,vUv);if(a.a<0.5)discard;a.rgb=mix(a.rgb*worldlight[1],a.rgb*1.1,smoothstep(-0.7,0.7,sin(time*6.0+vShine)));float b=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);a.rgb=mix(fog[0],a.rgb,b);fragColor=a;}`;var Sx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in mat4 worldMatrix;in vec4 uvshift;in float shine;out float vShine;out vec2 vUv;void main(){vShine=shine;vWorldPos=worldMatrix*vec4(position,1.0);vUv=uvshift.zw-uv*uvshift.xy;vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);}`;var Ax=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform sampler2D foliageDiffuse;in vec3 vLight;in vec3 vLightAmb;in vec3 vLightDir;in vec2 vUv;out vec4 fragColor;void main(){vec4 b=texture(foliageDiffuse,vUv);float c=0.1;b.a=b.a*smoothstep(1.0,0.0,(vCameraDistance-110.0)/20.0);if(b.a<c){discard;};float d=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float e=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 f=shadowPVMatrix[1]*(vWorldPos);vec3 g=(f.xyz/f.w)*0.5+0.5;d=texture(shadowMaps[1],g);}else{vec4 f=shadowPVMatrix[0]*(vWorldPos);vec3 g=(f.xyz/f.w)*0.5+0.5;d=texture(shadowMaps[0],g);}d=d;d=max(d,e);}b.rgb=b.rgb*(vLight+vLightAmb+vLightDir*d);float h=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,h);fragColor=b;}`;var Px=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec4 instPos;in vec3 instNorm;in vec3 position;in vec2 uv;out vec3 vLightAmb;out vec3 vLightDir;out vec2 vUv;void main(){vUv=uv;vec3 b=vec3(0.0);for(int c=0;c<lightCount;++c){vec3 d=lightPos[c]-instPos.xyz;float e=lightCols[c].w-dot(d,d);if(e>0.0){e/=(lightCols[c].w);e=e*e;b+=0.3*lightCols[c].rgb*e;;}};vLight=b;vLightAmb=worldlight[1];vLightDir=worldlight[0]*max(0.0,dot(instNorm.xyz,worldlight[2]));vec3 f=position;float e=sin(time+instPos.x+f.x)*0.1*f.y;f.xz+=e;mat3 g;g[1]=instNorm.xyz;g[2]=normalize(cross(vec3(sin(instPos.x*100.0),0.0,cos(instPos.z*100.0)),g[1]));g[0]=normalize(cross(g[1],g[2]));vec3 h=g*f;vWorldPos=vec4(h*instPos.w+instPos.xyz,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var Tx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform sampler2D foliageDiffuse;in vec3 vLightAmb;in vec3 vLightDir;in vec3 vLight;in vec2 vUv;out vec4 fragColor;void main(){vec4 b=texture(foliageDiffuse,vUv);b.a=b.a*smoothstep(1.0,0.0,(vCameraDistance-110.0)/20.0);if(b.a<0.5){discard;};float c=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float d=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 e=shadowPVMatrix[1]*(vWorldPos);vec3 f=(e.xyz/e.w)*0.5+0.5;c=texture(shadowMaps[1],f);}else{vec4 e=shadowPVMatrix[0]*(vWorldPos);vec3 f=(e.xyz/e.w)*0.5+0.5;c=texture(shadowMaps[0],f);}c=c;c=max(c,d);}b.rgb=b.rgb*(vLight+vLightAmb+vLightDir*c);float g=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,g);fragColor=b;}`;var Ex=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec4 instPos;in vec3 instNorm;in vec3 position;in vec2 uv;out vec2 vUv;out vec3 vLightAmb;out vec3 vLightDir;void main(){vUv=uv;vec3 b=vec3(0.0);for(int c=0;c<lightCount;++c){vec3 d=lightPos[c]-instPos.xyz;float e=lightCols[c].w-dot(d,d);if(e>0.0){e/=(lightCols[c].w);e=e*e;b+=0.3*lightCols[c].rgb*e;;}}vLight=b;vLightAmb=worldlight[1];vLightDir+=worldlight[0]*max(0.0,dot(instNorm.xyz,worldlight[2]));vec3 f=position;mat3 g;g[1]=instNorm.xyz;g[2]=normalize(cross(vec3(sin(instPos.x*100.0),0.0,cos(instPos.z*100.0)),g[1]));g[0]=normalize(cross(g[1],g[2]));vec3 h=g*f;vWorldPos=vec4(h*instPos.w+instPos.xyz,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var Dx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vCol;in vec2 vYcutoff;in vec4 vUvshift;out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec2 a=vec2((vUv.x+vUvshift.x)*vUvshift.z,(vUv.y+vUvshift.y)*vUvshift.w);vec4 b=vec4(1.0,1.0,1.0,texture(diffuse,a).r)*vCol;b.a*=min(1.0,max(0.0,vUv.y/vYcutoff[0]));b.a*=min(1.0,max(0.0,(vYcutoff[1]-vUv.y)/(1.0-vYcutoff[1])));if(b.a<0.01){discard;}float c=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,c);fragColor=b;fragColor.rgb*=fragColor.a;}`;var Ix=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in mat4 worldMatrix;in vec4 uvshift;in vec2 ycutoff;in vec4 color;out vec3 vNormal;out vec2 vUv;out vec4 vCol;out vec2 vYcutoff;out vec4 vUvshift;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vUvshift=uvshift;vCol=color;vYcutoff=ycutoff;vWorldPos=worldMatrix*vec4(position,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var Vx=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 vLight;in vec4 vColor;in vec3 vNormal;in vec4 vInteriorlight;in float vAlpha;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}float o=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float p=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 q=shadowPVMatrix[1]*(vWorldPos);vec3 r=(q.xyz/q.w)*0.5+0.5;o=texture(shadowMaps[1],r);}else{vec4 q=shadowPVMatrix[0]*(vWorldPos);vec3 r=(q.xyz/q.w)*0.5+0.5;o=texture(shadowMaps[0],r);}o=o;o=max(o,p);}vec3 s=worldlight[1];vec3 t=worldlight[0];s=mix(s,vInteriorlight.rgb*0.5,vInteriorlight.a);t=mix(t,vInteriorlight.rgb,vInteriorlight.a);float u=max(0.0,min(1.0,vColor[3]*0.2));vec4 v=vec4(b(s,t,vColor.rgb,vNormal,o,vLight,u),vAlpha);float w=max(0.0,min(1.0,-vColor[3]));v.rgb=mix(v.rgb,vColor.rgb,w);float x=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);v.rgb=mix(fog[0],v.rgb,x);fragColor=v;}`;var Lx=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 position;in vec3 normal;in vec4 color;in vec4 interiorlight;in float alpha;in mat4 worldMatrix;out vec4 vColor;out vec3 vNormal;out vec4 vInteriorlight;out float vAlpha;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vWorldPos=worldMatrix*vec4(position,1.0);vColor=color;vAlpha=alpha;vInteriorlight=interiorlight;vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var qx=`#version 300 es
precision highp float;precision highp int;in vec4 vColor;out vec4 fragColor;void main(){fragColor=vColor;fragColor.a=1.0;}`;var Rx=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 position;in vec4 color;in mat4 worldMatrix;out vec4 vColor;void main(){vColor=color;gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);;}`;var zx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Circle{vec4 circlePos;vec4 circleInfo;};in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vInteriorlight;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 o=texture(diffuse,vUv);if(o.a<0.5)discard;float p=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float q=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 r=shadowPVMatrix[1]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[1],s);}else{vec4 r=shadowPVMatrix[0]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[0],s);}p=p;p=max(p,q);}vec3 t=worldlight[1];vec3 u=worldlight[0];t=mix(t,vInteriorlight.rgb*0.5,vInteriorlight.a);u=mix(u,vInteriorlight.rgb,vInteriorlight.a);o.rgb=b(t,u,o.rgb,vNormal,p,vLight,0.0);o.rgb/=o.a;float v=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,v);float w=distance(vWorldPos.xz,circlePos.xz);float x=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(w<circlePos.w+0.1&&x>0.0){o.rgb=mix(o.rgb,circleInfo.rgb,x*circleInfo.a*((w<circlePos.w?w/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-w))/0.1)));}fragColor=o;}`;var Bx=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in vec4 interiorlight;in mat4 worldMatrix;out vec3 vNormal;out vec2 vUv;out vec4 vInteriorlight;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vWorldPos=worldMatrix*vec4(position,1.0);vInteriorlight=interiorlight;vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var Ux=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Circle{vec4 circlePos;vec4 circleInfo;};in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vCol;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 o=texture(diffuse,vUv);if(o.a<0.5)discard;float p=(float(gl_FrontFacing)*2.0-1.0);float q=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float r=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 s=shadowPVMatrix[1]*(vWorldPos);vec3 t=(s.xyz/s.w)*0.5+0.5;q=texture(shadowMaps[1],t);}else{vec4 s=shadowPVMatrix[0]*(vWorldPos);vec3 t=(s.xyz/s.w)*0.5+0.5;q=texture(shadowMaps[0],t);}q=q;q=max(q,r);}vec3 u=mix(worldlight[1],vCol.rgb,vCol.a);vec3 v=worldlight[0]*(1.0-vCol.a);o.rgb=b(u,v,o.rgb,vNormal,q,vLight,0.0);float w=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,w);float x=distance(vWorldPos.xz,circlePos.xz);float y=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(x<circlePos.w+0.1&&y>0.0){o.rgb=mix(o.rgb,circleInfo.rgb,y*circleInfo.a*((x<circlePos.w?x/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-x))/0.1)));}fragColor=o;}`;var Ox=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in vec4 color;in mat4 worldMatrix;out vec3 vNormal;out vec2 vUv;out vec4 vCol;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vCol=color;vWorldPos=worldMatrix*vec4(position,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var $x=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){vec4 o=texture(diffuse,vUv);if(o.a<0.7)discard;if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}float p=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float q=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 r=shadowPVMatrix[1]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[1],s);}else{vec4 r=shadowPVMatrix[0]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[0],s);}p=p;p=max(p,q);}o.rgb=b(worldlight[1],worldlight[0],o.rgb,vNormal,p,vLight,0.0);o.rgb/=o.a;float t=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,t);fragColor=o;}`;var Nx=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec3 position;in vec4 info;in vec2 progress;in vec4 scaleRota;in vec4 colStart;in vec4 colEnd;out vec4 vCol;out float vRotationCos;out float vRotationSin;out vec2 vOffset;void main(){float a=min(info[3]-1.0,floor(mix(info[2],info[3],mod(info[0]*progress[0],1.0))));vOffset=vec2(fract(a*0.125),-floor(a/8.0)*0.125);vCol=mix(colStart,colEnd,progress[1]);float b=mix(scaleRota[2],scaleRota[3],progress[0]);vRotationCos=cos(b);vRotationSin=sin(b);float c=mix(scaleRota[0],scaleRota[1],progress[1])*(abs(vRotationSin)+abs(vRotationCos));vec4 d=viewMatrix*vec4(position,1.0);gl_PointSize=c*resolution[1]*projectionMatrix[1][1]/length(d.xyz);gl_Position=projectionMatrix*d;}`;var jx=`#version 300 es
precision highp float;precision highp int;uniform sampler2D particleDiffuse;in vec4 vCol;in vec2 vOffset;in float vRotationCos;in float vRotationSin;out vec4 fragColor;const float a=1.0/(1024.0/8.0);void main(){float b=0.5;float c=abs(vRotationSin)+abs(vRotationCos);vec2 d=vec2(gl_PointCoord.x-b,gl_PointCoord.y-b)*c;vec2 e=d*vRotationCos;vec2 f=d*vRotationSin;d=vec2(e.x+f.y+b,e.y-f.x+b);if(d.x<a||d.x>1.0-a||d.y>1.0-a||d.y<a){discard;}d.x*=0.125;d.y=1.0-d.y*0.125;vec4 g=vec4(1.0,1.0,1.0,texture(particleDiffuse,d+vOffset).r);g*=vCol;if(g.a<0.01){discard;}fragColor=g;fragColor.rgb*=fragColor.a;fragColor.a*=0.33;}`;var Wx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D particleDiffuse;in vec4 vCol;in vec2 vOffset;in float vRotationCos;in float vRotationSin;out vec4 fragColor;const float a=1.0/(1024.0/8.0);void main(){float b=0.5;float c=abs(vRotationSin)+abs(vRotationCos);vec2 d=vec2(gl_PointCoord.x-b,gl_PointCoord.y-b)*c;vec2 e=d*vRotationCos;vec2 f=d*vRotationSin;d=vec2(e.x+f.y+b,e.y-f.x+b);if(d.x<a||d.x>1.0-a||d.y>1.0-a||d.y<a){discard;}d.x*=0.125;d.y=1.0-d.y*0.125;vec3 g=texture(particleDiffuse,d+vOffset).rgb;if((g.r+g.g+g.b)<0.1){discard;}fragColor=vec4(g.rgb,1.0);}`;var Gx=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;uniform vec2 offset[4];uniform vec4 amount;in vec2 vUv;out vec4 fragColor;void main(){vec3 a=texture(inputA,vUv+offset[0]).rgb*amount[0];a+=texture(inputA,vUv+offset[1]).rgb*amount[1];a+=texture(inputA,vUv+offset[2]).rgb*amount[2];a+=texture(inputA,vUv+offset[3]).rgb*amount[3];fragColor=vec4(a,1.0);}`;var Hx=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;uniform sampler2D inputB;uniform float amount;in vec2 vUv;out vec4 fragColor;void main(){vec4 a=texture(inputA,vUv);vec3 b=texture(inputB,vUv).rgb;b=b*b;fragColor.w=a.w;fragColor.xyz=b*amount+a.xyz;}`;var Yx=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;in vec2 vUv;out vec4 fragColor;
#define a  4.0
#define b (1.0/a)
#define c (1.0/128.0)
#define d (1.0/8.0)
vec3 e(vec4 f,sampler2D g,vec2 h){vec3 i=textureLod(g,f.zw,0.0).xyz;vec3 j=textureLod(g,f.zw+vec2(1,0)*h.xy,0.0).xyz;vec3 k=textureLod(g,f.zw+vec2(0,1)*h.xy,0.0).xyz;vec3 l=textureLod(g,f.zw+vec2(1,1)*h.xy,0.0).xyz;vec3 m=textureLod(g,f.xy,0.0).xyz;vec3 n=vec3(0.299,0.587,0.114);float o=dot(i,n);float p=dot(j,n);float q=dot(k,n);float r=dot(l,n);float s=dot(m,n);float t=min(s,min(min(o,p),min(q,r)));float u=max(s,max(max(o,p),max(q,r)));vec2 v;v.x=-((o+p)-(q+r));v.y=((o+q)-(p+r));float w=max((o+p+q+r)*(0.25*b),c);float x=1.0/(min(abs(v.x),abs(v.y))+w);v=min(vec2(a,a),max(vec2(-a,-a),v*x))*h.xy;vec3 y=(1.0/2.0)*(textureLod(g,f.xy+v*(1.0/3.0-0.5),0.0).xyz+textureLod(g,f.xy+v*(2.0/3.0-0.5),0.0).xyz);vec3 az=y*(1.0/2.0)+(1.0/4.0)*(textureLod(g,f.xy+v*(0.0/3.0-0.5),0.0).xyz+textureLod(g,f.xy+v*(3.0/3.0-0.5),0.0).xyz);float aa=dot(az,n);if((aa<t)||(aa>u))return y;return az;}void main(){vec2 h=1.0/resolution;vec4 f=vec4(vUv,vUv-(h*(0.5+d)));vec3 ab=e(f,inputA,1.0/resolution);fragColor=vec4(ab,1.);}`;var Xx=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D inputA;uniform vec4 tint;uniform float warp;in vec2 vUv;out vec4 fragColor;void main(){float a=0.01;float b=5.0;vec2 c;c.x=sin(vUv.y*10.0+time)*a;c.y=cos(vUv.x*10.0+time)*a;vec4 d=texture(inputA,vUv);vec4 e=texture(inputA,vUv+c);vec4 f=mix(d,e,warp);f.rgb=mix(f.rgb,tint.rgb*0.2+0.8*tint.rgb*length(f.rgb),tint.a);fragColor=f;}`;var Qx=`#version 300 es
precision highp float;precision highp int;uniform vec4 colStart;uniform vec4 colEnd;uniform vec2 offset;in vec2 vUv;out vec4 fragColor;void main(){fragColor=mix(colStart,colEnd,vUv.x);if(fragColor.a<0.01){discard;}fragColor.rgb*=fragColor.a;fragColor.a*=0.5;}`;var Zx=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform vec2 offset;in vec3 position;in vec2 uv;out vec2 vUv;void main(){vUv=vec2(uv.x-min(uv.x/offset.y,1.0)*offset.x,uv.y);gl_Position=projectionViewMatrix*vec4(position,1.0);}`;var Jx=`#version 300 es
precision highp float;precision highp int;uniform vec4 colStart;uniform vec4 colEnd;uniform vec2 offset;uniform sampler2D diffuse;in vec2 vUv;out vec4 fragColor;void main(){fragColor=texture(diffuse,vUv);fragColor*=mix(colStart,colEnd,vUv.x);if(fragColor.a<0.01){discard;}}`;var Kx=`#version 300 es
precision highp float;precision highp int;void main(){}`;var ew=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in mat4 worldMatrix;in vec3 position;in vec2 uv;out vec2 vUv;void main(){vUv=uv;gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);}`;var tw=`#version 300 es
precision highp float;precision highp int;in vec2 vUv;uniform sampler2D diffuse;void main(){if(texture(diffuse,vUv).a<0.7)discard;}`;var nw=`#version 300 es
precision highp float;precision highp int;uniform vec4 color;out vec4 fragColor;void main(){fragColor=color;}`;var iw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 position;in vec2 uv;in vec3 normal;out vec2 vUv;out vec3 vNormal;out vec3 vPos;void main(){vUv=uv;vNormal=normal;vPos=position;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var sw=`#version 300 es
precision highp float;precision highp int;uniform sampler2D diffuse;in vec2 vUv;out vec4 fragColor;void main(){vec4 a=texture(diffuse,vUv);vec3 b=normalize(vec3(1.0,1.0,0.3));fragColor=a;if(fragColor.a<0.2)discard;}`;var ow=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec2 uv;in vec3 position;in vec3 normal;out vec2 vUv;out vec3 vNormal;void main(){vUv=uv;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var rw=`#version 300 es
precision highp float;precision highp int;in vec4 vColor;out vec4 fragColor;void main(){fragColor=vColor;}`;var lw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 position;in vec4 color;out vec4 vColor;void main(){vColor=color;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var aw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Sky{vec3 skycolors[5];vec3 suncolor;};uniform sampler2D skyDiffuse;uniform sampler2D cloudDiffuse;in vec2 vUv;in vec3 vPos;out vec4 fragColor;void main(){gl_FragDepth=0.999999;vec3 a=vec3(0.0);float b=vPos.y/0.5;if(b>0.4){a=mix(skycolors[1],skycolors[0],smoothstep(0.4,1.0,b));}else if(b>0.25){a=mix(skycolors[2],skycolors[1],smoothstep(0.25,0.4,b));}else if(b>0.06){a=mix(skycolors[3],skycolors[2],smoothstep(0.06,0.25,b));}else{a=mix(fog[0],skycolors[3],smoothstep(0.0,0.06,b));}float c=1.0-sin(daycycle*6.28)+0.02;float d=smoothstep(0.1,0.5,b)*smoothstep(0.9,0.6,b);a+=texture(skyDiffuse,vUv*vec2(4.0,1.0)).rgb*c*d;float e=texture(cloudDiffuse,vec2(vUv.x+time/80.0,vUv.y*0.6+time/120.0)).r*texture(cloudDiffuse,vec2(vUv.x*2.0+time/300.0,vUv.y*0.6)).r;e=e*smoothstep(0.0,0.1,b)*smoothstep(0.9,0.6,b);e=smoothstep(0.25,0.7,e);a=mix(a,skycolors[4],e);fragColor=vec4(a,1.0);}`;var cw=`#version 300 es
precision highp float;precision highp int;in vec2 vUv;uniform float seed;float a(in vec2 uv,float scale){uv*=scale;vec2 b=floor(uv),f=fract(uv),p;float c=3.,d;p=.5+.35*sin(11.*fract(sin((b+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);c=min(d,c);return smoothstep(0.,c,sin(f.x+f.y)*0.003);}vec2 d(vec2 e){e=vec2(dot(e,vec2(127.1,311.7)),dot(e,vec2(269.5,183.3)));return-1.0+2.0*fract(sin(e)*43758.5453123);}float f(in vec2 e){const float g=0.366025404;const float h=0.211324865;vec2 i=floor(e+(e.x+e.y)*g);vec2 j=e-i+(i.x+i.y)*h;vec2 l=(j.x>j.y)?vec2(1.0,0.0):vec2(0.0,1.0);vec2 m=j-l+h;vec2 n=j-1.0+2.0*h;vec3 q=max(0.5-vec3(dot(j,j),dot(m,m),dot(n,n)),0.0);vec3 r=q*q*q*vec3(dot(j,d(i+0.0)),dot(m,d(i+l)),dot(n,d(i+1.0)));float t=dot(r,vec3(70.0));return smoothstep(-1.0,1.0,t);}out vec4 fragColor;void main(){vec2 u=vec2(vUv.x+seed,vUv.y);float r=a(vUv,10.0);r+=a(vUv,20.0)*0.5;r+=a(vUv,30.0)*0.2;r*=f(vUv*20.0);fragColor.rgb+=r*4.0;}`;var fw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Sky{vec3 skycolors[5];vec3 suncolor;};in vec2 vUv;in vec3 vPos;out vec4 fragColor;void main(){gl_FragDepth=0.999998;float a=length(vec2(0.5,0.5)-vUv);float b=smoothstep(0.3,0.2,a)*2.0;b+=smoothstep(0.5,0.1,a);b*=smoothstep(0.08,0.15,(vPos.y+0.2)*0.2+abs(sin(daycycle*6.282)));fragColor.rgba=vec4(suncolor,b);}`;var uw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;vec3 f(vec3 g,vec3 h,vec3 i,vec3 j,float k,vec3 l,float m){float n=clamp(dot(j,worldlight[2]),0.0,k);vec3 o=g*mix(0.7,1.1,0.5+(0.5*n));vec3 p=normalize(worldlight[2]+vViewDir);vec3 q=h*pow(max(0.0,dot(p,j)),20.0)*m*max(k*0.7+0.2,0.2)*20.0;vec3 r=o+h*n+l;return r*i+q;}void s(vec4 t,float u,vec4 v){float w=t.x+t.y+t.z;e+=v[3]*smoothstep(v[1],v[2],w)*u;t.a=u;t.rgb*=u;d+=t;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 x=texture(atlas,vUvChannel);x[3]=max(0.0,min(1.0,1.0-(x.r+x.g+x.b)));if(x[0]==1.0&&x[1]==1.0&&x[2]==1.0)discard;s(texture(diffuse[0],vUvTexture[0]),x[0],terrainInfo[0]);s(texture(diffuse[1],vUvTexture[1]),x[1],terrainInfo[1]);s(texture(diffuse[2],vUvTexture[2]),x[2],terrainInfo[2]);s(texture(diffuse[3],vUvTexture[3]),x[3],terrainInfo[3]);d.rgb/=d.a;e/=d.a;d.a=1.0;float y=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float az=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 aa=shadowPVMatrix[1]*(vWorldPos);vec3 ab=(aa.xyz/aa.w)*0.5+0.5;y=texture(shadowMaps[1],ab);}else{vec4 aa=shadowPVMatrix[0]*(vWorldPos);vec3 ab=(aa.xyz/aa.w)*0.5+0.5;y=texture(shadowMaps[0],ab);}y=y;y=max(y,az);}d.rgb=f(worldlight[1],worldlight[0],d.rgb,vNormal,y,vLight,e);float ac=distance(vWorldPos.xz,circlePos.xz);float ad=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(ac<circlePos.w+0.1&&ad>0.0){d.rgb=mix(d.rgb,circleInfo.rgb,ad*circleInfo.a*((ac<circlePos.w?ac/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-ac))/0.1)));}float ae=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,ae);fragColor=d;}`;var mw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float a=256.0;const float b=4.0;in vec3 position;in vec3 normal;out vec3 vNormal;out vec3 vUvChannel;out vec2 vUvTexture[4];out vec3 vViewDir;void main(){vNormal=normal;vWorldPos=modelMatrix*vec4(position,1.0);vUvChannel=vec3(position[0],position[2],0.0)/32.0;int c=quadrant%2;int d=int(quadrant%4);if(c==1)vUvChannel.x-=1.0;if(d>1)vUvChannel.y-=1.0;vUvChannel.z=float(quadrant);vec2 e=vec2(-vWorldPos[0],vWorldPos[2])/4.0;vUvTexture[0]=e*terrainInfo[0][0];vUvTexture[1]=e*terrainInfo[1][0];vUvTexture[2]=e*terrainInfo[2][0];vUvTexture[3]=e*terrainInfo[3][0];for(int f=0;f<lightCount;++f){vec3 g=lightPos[f]-vWorldPos.xyz;float h=lightCols[f].w-dot(g,g);if(h>0.0){h/=(lightCols[f].w);h=h*h;vLight+=0.2*lightCols[f].rgb*h;}}vViewDir=-normalize(vWorldPos.xyz-cameraPosition);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var pw=`#version 300 es
precision highp float;precision highp int;in vec4 vWorldPos;out vec4 fragColor;uniform vec4 colors[576];uniform int divider;void main(){float a=64.0/float(divider);int b=int(floor(mod(vWorldPos.x,64.0)/a)+floor(mod(vWorldPos.z,64.0)/a)*float(divider));fragColor.rgba=colors[b];}`;var dw=`#version 300 es
precision highp float;precision highp int;in vec3 vPos;in vec3 vNormal;out vec4 fragColor;void main(){float a=0.0;if(vNormal.y<0.93){a=1.0;}fragColor=vec4(0.0,0.0,a,0.4+a*0.6);if(abs(vPos.x-0.0)<0.001||abs(vPos.x-64.0)<0.001||abs(vPos.z-0.0)<0.001||abs(vPos.z-64.0)<0.001)fragColor=vec4(1.0,1.0,0.0,1.0);if((abs(vPos.x-32.0)<0.001&&mod(vPos.z,1.0)<0.5)||(abs(vPos.z-32.0)<0.001&&mod(vPos.x,1.0)<0.5))fragColor=vec4(1.0,1.0,0.0,1.0);}`;var hw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 normal;in vec3 position;out vec3 vPos;out vec3 vNormal;void main(){vNormal=normal;vPos=position;gl_Position=projectionViewMatrix*modelMatrix*vec4(position[0],position[1]+0.05,position[2],1.0);}`;var gw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;void f(vec4 g,float h,vec4 i){float j=g.x+g.y+g.z;e+=i[3]*smoothstep(i[1],i[2],j)*h;g.a=h;g.rgb*=h;d+=g;}out vec4 fragColor;void main(){vec4 k=texture(atlas,vUvChannel);k[3]=max(0.0,min(1.0,1.0-(k.r+k.g+k.b)));if(k[0]==1.0&&k[1]==1.0&&k[2]==1.0)discard;f(texture(diffuse[0],vUvTexture[0]),k[0],terrainInfo[0]);f(texture(diffuse[1],vUvTexture[1]),k[1],terrainInfo[1]);f(texture(diffuse[2],vUvTexture[2]),k[2],terrainInfo[2]);f(texture(diffuse[3],vUvTexture[3]),k[3],terrainInfo[3]);d.rgb/=d.a;e/=d.a;d.a=1.0;if(mod(vWorldPos.y,2.0)<0.2){d.rgb=mix(d.rgb,vec3(0.8),0.5);}else{d.rgb=mix(d.rgb,vec3(0.2),0.5);}vec3 l=worldlight[2];l.y*=0.5;l=normalize(l);d.rgb*=max(0.3,min(1.0,dot(l,vNormal)*0.5+0.5));float m=distance(vWorldPos.xz,circlePos.xz);if(m<circlePos.w+0.1){d.rgb=mix(d.rgb,circleInfo.rgb,circleInfo.a*(max(0.,(0.3-abs(circlePos.w-m))/0.3)));}float n=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,n);fragColor=d;}`;var vw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;void f(vec4 g,float h,vec4 i){float j=g.x+g.y+g.z;e+=i[3]*smoothstep(i[1],i[2],j)*h;g.a=h;g.rgb*=h;d+=g;}out vec4 fragColor;void main(){vec4 k=texture(atlas,vUvChannel);k[3]=max(0.0,min(1.0,1.0-(k.r+k.g+k.b)));if(k[0]==1.0&&k[1]==1.0&&k[2]==1.0)discard;d.rgb=texture(diffuse[0],vUvTexture[0]).rgb;float l=64.0/12.0;float m=l/2.0;bool n=mod(vWorldPos.z,l)>m;if(mod(vWorldPos.x,l)<m){if(n){d.rgb=vec3(0.45);}else{d.rgb=vec3(0.55);}}else{if(n){d.rgb=vec3(0.55);}else{d.rgb=vec3(0.45);}}vec3 o=worldlight[2];o.y*=0.5;o=normalize(o);d.rgb*=max(0.3,min(1.0,dot(o,vNormal)*0.5+0.5));float p=distance(vWorldPos.xz,circlePos.xz);if(p<circlePos.w+0.1){d.rgb=mix(d.rgb,circleInfo.rgb,circleInfo.a*(max(0.,(0.3-abs(circlePos.w-p))/0.3)));}float q=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,q);fragColor=d;}`;var _w=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;out vec4 fragColor;void main(){fragColor.rgb=fog[0];}`;var bw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};in vec3 position;void main(){vec4 a=modelMatrix*vec4(position,1.0);gl_Position=projectionViewMatrix*a;}`;var yw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};uniform sampler2D waterLines;uniform sampler2D waterNoise;uniform sampler2D bufferPongColor;uniform sampler2D bufferPongDepth;in vec2 vUv;out vec4 fragColor;void main(){float a=length(cameraPosition-vWorldPos.xyz);float b=(texture(waterNoise,vUv.yx/4.0+time*0.1).r-0.5);float c=gl_FragCoord.z;c=c*2.0-1.0;c=projectionMatrix[3][2]/(c+projectionMatrix[2][2]);if(a>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec2 d=gl_FragCoord.xy/resolution;float e=texture(bufferPongDepth,d.xy).r;e=e*2.0-1.0;e=projectionMatrix[3][2]/(e+projectionMatrix[2][2]);float f=e-c;vec2 g=vec2(b*0.05,0.0);float h=f;float i=1.0-clamp(h/0.1,0.0,1.0);float j=1.0-clamp(h/0.6,0.0,1.0);float k=1.0-clamp(h/2.0,0.0,1.0);float l=1.0-clamp(h/10.0,0.0,1.0);float m=1.0-clamp(h/100.0+0.5,0.0,1.0);float n=texture(waterLines,vUv.yx+b*0.15).r;vec3 o=mix(watercolors[2],watercolors[1],l);vec3 p=texture(bufferPongColor,d.xy+g).rgb;vec3 q=(worldlight[0]+worldlight[1]);vec3 r=mix(o,p*o,m)+n*watercolors[0]*(0.05+k*0.3);r=mix(r,watercolors[0],j)*q;vec4 s=vec4(r,1.0-i);float t=min(1.0,max(0.0,(n*(b+0.3)*0.5)));s.rgb+=t*worldlight[0];float u=clamp((fog[1][1]-a)/(fog[1][1]-fog[1][0]),0.0,1.0);s.rgb=mix(fog[0],s.rgb,u);fragColor=s;}`;var kw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Water{vec3 verts[4];};in vec3 position;in vec3 color;in vec3 colorFoam;in vec3 colorShallow;out vec2 vUv;void main(){vWorldPos.xyz=verts[gl_VertexID];vWorldPos.w=1.0;vUv=vWorldPos.xz/2.0;gl_Position=projectionViewMatrix*vWorldPos;}`;var xw=`#version 300 es
precision highp float;precision highp int;in vec4 vWorldPos;out vec4 fragColor;void main(){fragColor.rgba=vec4(1.0,mod(vWorldPos.y+0.001,1.0),0.0,0.5);}`;var Bp={frag:Cx,vert:Sx},Up={frag:Ax,vert:Px},Op={frag:Tx,vert:Ex},$p={frag:Dx,vert:Ix},Np={frag:Vx,vert:Lx},jp={frag:qx,vert:Rx},Wf={frag:zx,vert:Bx},Wp={frag:Ux,vert:Ox},z1={frag:$x},Gp={vert:Nx},B1={frag:jx},U1={frag:Wx},O1={frag:Gx},$1={frag:Hx},N1={frag:Yx},j1={frag:Xx},Gf={frag:Qx,vert:Zx},W1={frag:Jx},Hf={frag:Kx,vert:ew},G1={frag:tw},Hp={frag:nw,vert:iw},TE={frag:sw,vert:ow},EE={frag:rw,vert:lw},H1={frag:aw},Y1={frag:cw},X1={frag:fw},Yp={frag:uw,vert:mw},DE={frag:pw},IE={frag:dw,vert:hw},VE={frag:gw},LE={frag:vw},Xp={frag:_w,vert:bw},Qp={frag:yw,vert:kw},qE={frag:xw};var mt=[],Q1=[],un={},Ht={},Yf={},Mw=()=>{un={shadowMaps:{value:[$a.depthTexture,Oa[1].depthTexture]}};for(let e in Zp){let n=Zp[e];n.vert&&(n.vert=n.vert.replace("#SHADOWS",le.shadows?1:0)),n.frag&&(n.frag=n.frag.replace("#SHADOWS",le.shadows?1:0))}let t={mesh:["position","uv","normal","color","interiorlight","alpha","worldMatrix"],effect:["position","uv","normal","color","uvshift","ycutoff","worldMatrix"],drop:["position","shine","uv","uvshift","worldMatrix"],particle:["position","info","progress","scaleRota","colStart","colEnd"],ribbon:["position","uv"],foliage:["position","uv","instPos","instNorm"],post:["position","uv"]};mt[13]=cn({vertex:Up.vert,fragment:Up.frag,cullFace:null,instanced:[{name:"instPos",size:4},{name:"instNorm",size:3}],globalUniforms:un,transparent:!0,attributeLocations:t.foliage}),mt[14]=cn({vertex:Op.vert,fragment:Op.frag,cullFace:null,instanced:[{name:"instPos",size:4},{name:"instNorm",size:3}],globalUniforms:un,transparent:!0,attributeLocations:t.foliage}),mt[3]=cn({vertex:Np.vert,fragment:Np.frag,instanced:[{name:"color",size:4},{name:"alpha",size:1},{name:"interiorlight",size:4}],globalUniforms:un,attributeLocations:t.mesh,transparent:!0}),mt[4]=cn({vertex:Wf.vert,fragment:Wf.frag,instanced:[{name:"interiorlight",size:4}],globalUniforms:un,attributeLocations:t.mesh}),mt[5]=cn({vertex:Wp.vert,fragment:Wp.frag,globalUniforms:un,attributeLocations:t.mesh}),mt[15]=cn({vertex:$p.vert,fragment:$p.frag,globalUniforms:un,transparent:!0,depthWrite:!1,instanced:[{name:"color",size:4},{name:"uvshift",size:4},{name:"ycutoff",size:2}],attributeLocations:t.effect}),mt[6]=cn({vertex:Wf.vert,fragment:z1.frag,globalUniforms:un,instanced:[{name:"interiorlight",size:4}],attributeLocations:t.mesh}),mt[7]=cn({vertex:jp.vert,fragment:jp.frag,instanced:[{name:"color",size:4}],globalUniforms:un,attributeLocations:t.mesh}),mt[10]=cn({vertex:Bp.vert,fragment:Bp.frag,instanced:[{name:"uvshift",size:4},{name:"shine",size:1}],globalUniforms:un,attributeLocations:t.drop}),mt[8]=cn({vertex:Yp.vert,fragment:Yp.frag,globalUniforms:un,attributeLocations:t.mesh}),mt[9]=cn({vertex:Xp.vert,fragment:Xp.frag,globalUniforms:un,attributeLocations:t.mesh}),mt[12]=cn({vertex:Hp.vert,fragment:X1.frag,transparent:!0,globalUniforms:un,attributeLocations:t.mesh}),mt[20]=cn({vertex:Qp.vert,fragment:Qp.frag,transparent:!0,cullFace:!1,globalUniforms:un,attributeLocations:t.mesh}),mt[11]=cn({vertex:Hp.vert,fragment:H1.frag,cullFace:null,depthTest:!0,globalUniforms:un,attributeLocations:t.mesh}),mt[1]=cn({cullFace:null,vertex:Hf.vert,fragment:G1.frag,globalUniforms:un,attributeLocations:t.mesh}),mt[2]=cn({vertex:Hf.vert,fragment:Hf.frag,globalUniforms:un,attributeLocations:t.mesh}),mt[16]=cn({vertex:Gp.vert,fragment:B1.frag,transparent:!0,depthWrite:!1,globalUniforms:un,attributeLocations:t.particle}),mt[17]=cn({vertex:Gp.vert,fragment:U1.frag,transparent:!1,globalUniforms:un,attributeLocations:t.particle}),mt[18]=cn({vertex:Gf.vert,fragment:Gf.frag,transparent:!0,cullFace:null,depthWrite:!1,globalUniforms:un,attributeLocations:t.ribbon}),mt[19]=cn({vertex:Gf.vert,fragment:W1.frag,transparent:!0,cullFace:null,depthWrite:!1,globalUniforms:un,attributeLocations:t.ribbon}),mt[32]=cn({vertex:ma,fragment:N1.frag,depthWrite:!1,depthTest:!1,globalUniforms:un,uniforms:{inputA:{value:null}},attributeLocations:t.post}),mt[30]=cn({vertex:ma,fragment:O1.frag,depthWrite:!1,depthTest:!1,uniforms:{inputA:{value:null},offset:{value:[0,0,0,0,0,0,0,0]},amount:{value:[0,0,0,0]}},globalUniforms:un,attributeLocations:t.post}),mt[31]=cn({vertex:ma,fragment:$1.frag,depthWrite:!1,depthTest:!1,uniforms:{inputA:{value:null},inputB:{value:null},amount:{value:1}},globalUniforms:un,attributeLocations:t.post}),mt[33]=cn({vertex:ma,fragment:j1.frag,depthWrite:!1,depthTest:!1,globalUniforms:un,uniforms:{inputA:{value:null},tint:{value:[0,0,0,0]},warp:{value:.5}},attributeLocations:t.post}),mt[34]=cn({vertex:ma,fragment:Y1.frag,uniforms:{seed:{value:Date.now()%1e3}},attributeLocations:["position","uv"]}),RE(mt,un),wf(mt[18],$.ONE,$.ONE_MINUS_SRC_ALPHA),wf(mt[16],$.ONE,$.ONE_MINUS_SRC_ALPHA),wf(mt[15],$.ONE,$.ONE_MINUS_SRC_ALPHA),Q1.push(3,4,6,7,10,15,5)},RE=(t,e)=>{let n=t[4].program,i=["Environment","Camera","Pointlights","Shadows","Circle","Screen","Sky","MeshTerrain","Water"],s=[n,n,n,n,n,t[32].program,t[11].program,t[8].program,t[20].program],o=[!0,!0,!0,!0,!0,!0,!0,!1,!1],r=[];for(let l=0;l<i.length;++l){let a=i[l],c=kx(s[l],a,l),f=a.toLowerCase();if(Yf[f]=c,r.push(c),o[l]){let u=Ua(c);al(u),Ht[f]=u}}for(let l=0;l<t.length;++l){let a=t[l];a&&(I3(a,e),V3(a,r))}},ww,Jp=(t,e)=>{if(t!==ww||e){let n=Ht.camera.data;ww=t,wo(n.cameraPosition,t.worldPosition,0),wo(n.viewMatrix,t.viewMatrix,0),wo(n.projectionMatrix,t.projectionMatrix,0),wo(n.projectionViewMatrix,t.projectionViewMatrix,0),si(Ht.camera)}},Fw=(t,e)=>{di(Ht.screen.data.resolution,t,e),si(Ht.screen)};var Tt=(t,e)=>{let n=t>>16&255,i=t>>8&255,s=t&255,o=[n/255,i/255,s/255];return e!==void 0&&o.push(e),o};var BE=[["white","common"],["green","uncommon"],["blue","rare"],["purp","epic"],["orange", "legendary"],["red", "mythical"]],Na=t=>t>=110?5:t>=99?4:t>=90?3:t>=70?2:t>=50?1:0,Yt=t=>BE[Na(t)];var Ln={black:Tt(0,0),white:Tt(16777215,0),deadgrey:Tt(3355443,0),teal:Tt(3384995,0),magicblue:Tt(3362252,0),paleskin:Tt(14267315,0),darkskin:Tt(8411481,0),slimegreen:Tt(2542694,0),mushgreen:Tt(2077529,0),linen:Tt(13408614,0),woodbrown:Tt(4859433,0),woodbrown2:Tt(10250315,0),tealsteel:Tt(3358797,.5),darksteel:Tt(3355443,.5),greysteel:Tt(5066061,.5),blacksteel:Tt(988178,.5),leather:Tt(4337198,0),emerald:Tt(22866,-.1),gold:Tt(16751616,.9),darkgold:Tt(16747008,.9),paper:Tt(15129011,0),richpurple:Tt(7484623,0),fireorange:Tt(14715686,-.7),archergreen:Tt(10471258,0),warbrown:Tt(15172191,0),bronze:Tt(9258571,.5),silver:Tt(11583679,.6),shamanblue:Tt(3687924,0),mageblue:Tt(6607340,0),bone:Tt(14535066,.2),bone2:Tt(11836267,.2),ice:Tt(14610164,-.2),vanguard:Tt(2848511,0),bloodlust:Tt(14289947,0),pink:Tt(16711935,0),warden:Tt(14755623,0),evilred:Tt(13239043,0),ruby:Tt(15733030,1),moss:Tt(2925637,.2),rock:Tt(5006687,.4),death:Tt(3750201,.8),diamond:Tt(3076559,.9)},Z1=[Ln.woodbrown,Ln.bronze,Ln.greysteel,Ln.silver,Ln.gold],Cw=[Ln.diamond,Ln.ruby],J1=[Ln.leather,Ln.greysteel,Ln.silver,Ln.gold,Ln.diamond];var nr=[0,0,0],Kp={enemy:[1,0,0],friendly:[0,1,0],dead:[.6,.6,.6]},ir=t=>{if(V&&V.player){let e=Ft.clientPlayerChangeTarget.packData({target:t});if(t!==qn)if(t>0){let n=V.entity(t);n!==void 0&&(n.type===3?n.canBePickedUpBy(V.player)&&Mt(95):(Mt(93),n.faction===2&&tn(4,100)))}else t===0&&Mt(94);Ga=qn,ml.reset(V.time),V.player.setTarget(t),Si(e)}qn=t},qn=0,vn=0,nd=!1,ml=new kt(0,1),Ga=0,ng=t=>{Ga!==t&&(Ga=t,ml.done(V.time)?(V.player.setTarget(t),qn=t):ml.reset(V.time,vt(ml.passed(V.time)+.5,.5,2)))},eg=0,UE=()=>{tt.lmb.onPress(t=>{eg=V.time}),tt.lmb.onRelease(t=>{sr>0?GE():vn>0&&Vf<20&&V.time-eg<.3&&ir(vn)}),tt.nextTarget.onPress(t=>{Wa=t.shiftKey?2:1}),tt.nextParty.onPress(t=>{Wa=2}),tt.untarget.onPress(t=>{ir(0)})},Xf=(t,e=!0)=>{vn=t,nd=e&&vn>0,sm.set(nd?"pointer":"auto"),am.set(vn)},OE=(t,e,n,i)=>{let s=[0,0,0];for(let o=0,r=i.length;o<r;++o){let l=i[o],[a,c,f]=l.hudPos;if(a>0&&a<e&&c>0&&c<n&&f<1){st(s,l.pos),s[1]+=l.size*.3;let u=Kn(s,Dp(gt.worldPosition,nr,s));u<t&&u<(l.size+.7)**2&&l.stats.alive&&(t=u,vn=l.id)}}return t},$E=(t,e,n,i)=>{let s=!1;for(let o=0,r=i.length;o<r;++o){let l=i[o];if(l.hudPos[2]<1){let a=Kn(l.pos,Dp(gt.worldPosition,nr,l.pos));a<t&&(t=a,vn=l.id,s=!0)}}return s},NE=()=>{lo(gt,nr,Vp),Xt(nr,nr,gt.worldPosition),Zn(nr,nr);let t=In.width,e=In.height,n=vn,i=20,s=!1;vn=0;for(let o=0;o<=12;++o)o!==3&&o!==11&&(i=OE(i,t,e,V.entities.type[o]));s=vn!==0,$E(Math.min(i,.7),t,e,V.entities.type[3])&&(s=V.entity(vn).canBePickedUpBy(V.player)),(n!=vn||s!==nd)&&Xf(vn,s)},Sw=t=>{let e=[0,0,0];aa(An,gt.transform.worldMatrix),lo(gt,e,Vp),Xt(e,e,An),Zn(e,e);let n=[0,0];ly(n,An,e,V.player.pos,td);let i=999;if(t)if(i=n[1]-Math.max(0,n[0]),i<5||n[0]===-1&&n[0]===-1){let o=Dp(An,e,V.player.pos),r=o[0]-V.player.pos[0],l=o[2]-V.player.pos[2],a=1/Math.sqrt(r*r+l*l);st(An,V.player.pos),An[0]+=r*a*td,An[1]+=10,An[2]+=l*a*td,Y(e,0,-1,0),i=20}else n[0]>0&&sn(An,An,e,n[0]);dn(e,e,i);let s=V.raycastEnvironmentClosest(An[0],An[1],An[2],e[0],e[1],e[2]);return sn(An,An,e,s),s===1&&(An[1]=V.getHeight(An[0],An[2])),An},jE=t=>{if(ml.done(V.time)&&qn!==Ga&&V.player.setTarget(Ga),!tt.shift.down){if(Lp){vn>0&&(Vf>=20||V.time-eg>.3)&&Xf(0,!1);return}NE()}},ts,tg=0,ja=0,K1=[1,1,1,.3],WE=t=>{let e=qn,n=vn>0?V.getEntityById(vn):void 0;n!==void 0?n!==ts&&(ts!==void 0&&ts.visual!==void 0&&ts.type!==3&&ts.visual.removeColor(K1),n.visual!==void 0&&n.type!==3&&n.visual.addColor(K1),ts=n):ts!==void 0&&ts.visual!==void 0&&(ts.type!==3&&ts.visual.removeColor(K1),ts=void 0);let i=Ht.circle.data;if(sr>0){let s=Sw(!0);ei(i.circleInfo,...Kp.friendly,1),ei(i.circlePos,s[0],s[1],s[2],Aw)}else if(e!==tg?(tg=e,ja=1):ja=Math.max(ja*(1-t*10),0),e>0){let s=V.getEntityById(e);if(s!==void 0){ei(i.circlePos,s.pos[0],s.pos[1]-s.radius,s.pos[2],s.size+ja);let o=s.stats&&s.stats.alive?V.player.hostility(s)>0?Kp.enemy:Kp.friendly:Kp.dead;ei(i.circleInfo,...o,1-ja)}}else ei(i.circlePos,0,0,0,0);si(Ht.circle)},ed=[],Wa=0,ig=t=>{if(V.player){if(Wa===1){let e=0,n=0;t=t.filter(s=>s.visual!==void 0&&s.stats!==void 0&&s.stats.alive&&s!==V.player&&V.player.hostility(s)>0&&V.player.canCombatInteract(s)&&Math.abs(ol(V.player.rot,V.player.rotationToV3(s.pos)))<.7);let i=qn===0;for(let s=t.length-1;s>=0;--s){let o=t[s];i&&(e=o.id),qn===o.id&&(i=!0),n||(n=o.id),e!==0&&(s=0)}e===0&&n!==0&&(e=n),ir(e),Wa=0}else if(Wa===2){let e=V.entities.type[0].filter(s=>!le.nextFriendlyTargetAllowNonParty&&!en.has(s.name)?!1:s.stats&&s.stats.alive&&s.faction===V.player.faction&&Tr(s.pos,V.player.pos)<30).sort((s,o)=>{let r=en.has(s.name),l=en.has(o.name);return r&&!l?-1:!r&&l?1:0}),n=e.length;if(e=e.filter(s=>ed.indexOf(s.id)<0),e.length===0)ir(V.playerId);else{let s=e[0];ir(s.id)}ed.push(qn);let i=Math.min(10,le.nextFriendlyTargetCycle||10,n);for(;i>0&&ed.length>=i;)ed.shift();Wa=0}}},sr=0,td=0,Aw=0,An=[0,0,0],Qf=(t,e,n)=>{sr=t,td=e,Aw=n},GE=()=>{sr!==0&&(Si(Ft.clientPlayerEnvSkill.packData({id:sr,info:[],pos:An})),Qf(0,0,0))},HE=()=>{Ga=0,ml.reset(0),ts=void 0,tg=0,ja=0};function Pw(t,e,n){let i=t.slice();return i[26]=e[n],i}function Tw(t){let e,n,i,s,o,r,l,a,c,f,u,m=[],g=new Map,v,_,b,y,k,S,A=t[2]=="default"&&Ew(t);a=new vi({props:{size:"1.3em",fract:t[8],barcol:t[13],left:t[10],right:t[6],darken:!1,$$slots:{default:[YE]},$$scope:{ctx:t}}});let F=(t[2]=="default"||t[18])&&Iw(t);function M(I,N){return I[5].role>=1?ZE:QE}let D=M(t,-1),R=D(t),E=t[2]=="default"&&t[5].combat&&t[5].alive&&Vw(t),L=me(t[19]),B=I=>I[26].id;for(let I=0;I<L.length;I+=1){let N=Pw(t,L,I),j=B(N);g.set(j,m[I]=Lw(j,N))}return{c(){e=h("div"),n=h("div"),A&&A.c(),i=h("img"),r=h("div"),l=h("div"),ne(a.$$.fragment),F&&F.c(),R.c(),f=ve(),E&&E.c(),u=h("div");for(let I=0;I<m.length;I+=1)m[I].c();p(i,"class",s="pclass icon border black bgc"+t[5].class+" svelte-g292qg"),lt(i.src,o=(t[5].rarity!==!1?"/data/ui/mobpower/"+t[5].rarity:"/data/ui/classes/"+t[5].class)+"."+On+"?v=8588529")||p(i,"src",o),p(n,"class","iconcontainer svelte-g292qg"),p(l,"class",c="panel-black barsInner "+(t[5].id&&t[5].range?"targetable":"")+" svelte-g292qg"),p(u,"class",v="buffarray "+t[2]+" svelte-g292qg"),p(r,"class",_="bars "+(t[17]&&t[5].id==t[17].id&&t[2]=="party"?"target":"")+" svelte-g292qg"),p(e,"id",t[4]),p(e,"class",b="grid "+(t[3]?"right":"left")+" svelte-g292qg"),ze(e,"font-size",t[15]+"%"),ze(e,"opacity",t[5].range?"":.6)},m(I,N){w(I,e,N),d(e,n),A&&A.m(n,null),d(n,i),d(e,r),d(r,l),ee(a,l,null),F&&F.m(l,null),R.m(r,null),d(r,f),E&&E.m(r,null),d(r,u);for(let j=0;j<m.length;j+=1)m[j]&&m[j].m(u,null);y=!0,k||(S=[Z(l,"click",t[20]),Z(l,"contextmenu",t[25])],k=!0)},p(I,N){I[2]=="default"?A||(A=Ew(I),A.c(),A.m(n,i)):A&&(A.d(1),A=null),(!y||N&32&&s!==(s="pclass icon border black bgc"+I[5].class+" svelte-g292qg"))&&p(i,"class",s),(!y||N&32&&!lt(i.src,o=(I[5].rarity!==!1?"/data/ui/mobpower/"+I[5].rarity:"/data/ui/classes/"+I[5].class)+"."+On+"?v=8588529"))&&p(i,"src",o);let j={};N&256&&(j.fract=I[8]),N&8192&&(j.barcol=I[13]),N&1024&&(j.left=I[10]),N&64&&(j.right=I[6]),N&536895748&&(j.$$scope={dirty:N,ctx:I}),a.$set(j),I[2]=="default"||I[18]?F?(F.p(I,N),N&262148&&P(F,1)):(F=Iw(I),F.c(),P(F,1),F.m(l,null)):F&&(Pe(),q(F,1,1,()=>{F=null}),Te()),(!y||N&32&&c!==(c="panel-black barsInner "+(I[5].id&&I[5].range?"targetable":"")+" svelte-g292qg"))&&p(l,"class",c),D===(D=M(I,N))&&R?R.p(I,N):(R.d(1),R=D(I),R&&(R.c(),R.m(r,f))),I[2]=="default"&&I[5].combat&&I[5].alive?E||(E=Vw(I),E.c(),E.m(r,u)):E&&(E.d(1),E=null),N&524292&&(L=me(I[19]),Pe(),m=ui(m,N,B,1,I,L,g,u,Ii,Lw,null,Pw),Te()),(!y||N&4&&v!==(v="buffarray "+I[2]+" svelte-g292qg"))&&p(u,"class",v),(!y||N&131108&&_!==(_="bars "+(I[17]&&I[5].id==I[17].id&&I[2]=="party"?"target":"")+" svelte-g292qg"))&&p(r,"class",_),(!y||N&16)&&p(e,"id",I[4]),(!y||N&8&&b!==(b="grid "+(I[3]?"right":"left")+" svelte-g292qg"))&&p(e,"class",b),(!y||N&32768)&&ze(e,"font-size",I[15]+"%"),(!y||N&32)&&ze(e,"opacity",I[5].range?"":.6)},i(I){if(!y){P(a.$$.fragment,I),P(F);for(let N=0;N<L.length;N+=1)P(m[N]);y=!0}},o(I){q(a.$$.fragment,I),q(F);for(let N=0;N<m.length;N+=1)q(m[N]);y=!1},d(I){I&&x(e),A&&A.d(),te(a),F&&F.d(),R.d(),E&&E.d();for(let N=0;N<m.length;N+=1)m[N].d();k=!1,at(S)}}}function Ew(t){let e;return{c(){e=h("div"),p(e,"class","deco svelte-g292qg")},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function Dw(t){let e,n,i;return{c(){e=h("div"),p(e,"class",n="progressBar "+t[13]+" hpdelta svelte-g292qg"),p(e,"style",i=(t[14]?"transition:none;":"")+"width:"+t[8]+"%;")},m(s,o){w(s,e,o)},p(s,o){o&8192&&n!==(n="progressBar "+s[13]+" hpdelta svelte-g292qg")&&p(e,"class",n),o&16640&&i!==(i=(s[14]?"transition:none;":"")+"width:"+s[8]+"%;")&&p(e,"style",i)},d(s){s&&x(e)}}}function YE(t){let e,n=t[2]=="default"&&Dw(t);return{c(){n&&n.c(),e=ve()},m(i,s){n&&n.m(i,s),w(i,e,s)},p(i,s){i[2]=="default"?n?n.p(i,s):(n=Dw(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(i){i&&x(e),n&&n.d(i)}}}function Iw(t){let e,n;return e=new vi({props:{size:"0.7em",fract:t[9],barcol:t[16],left:t[11],right:t[7],darken:!0,$$slots:{default:[XE]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&512&&(o.fract=i[9]),s&65536&&(o.barcol=i[16]),s&2048&&(o.left=i[11]),s&128&&(o.right=i[7]),s&536875008&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function XE(t){let e;return{c(){e=h("div"),p(e,"class","progressBar bgspell castbar svelte-g292qg"),ze(e,"width",t[12]+"%"),ze(e,"display",t[12]>0?"inherit":"none")},m(n,i){w(n,e,i)},p(n,i){i&4096&&ze(e,"width",n[12]+"%"),i&4096&&ze(e,"display",n[12]>0?"inherit":"none")},d(n){n&&x(e)}}}function QE(t){let e,n,i;return{c(){e=h("img"),p(e,"class",n="tag icon border black bgf"+t[5].faction+" round svelte-g292qg"),lt(e.src,i="/data/ui/factions/"+t[5].faction+"."+On+"?v=8588529")||p(e,"src",i)},m(s,o){w(s,e,o)},p(s,o){o&32&&n!==(n="tag icon border black bgf"+s[5].faction+" round svelte-g292qg")&&p(e,"class",n),o&32&&!lt(e.src,i="/data/ui/factions/"+s[5].faction+"."+On+"?v=8588529")&&p(e,"src",i)},d(s){s&&x(e)}}}function ZE(t){let e,n;return{c(){e=h("img"),p(e,"class","tag icon border black bgblack round svelte-g292qg"),lt(e.src,n="/data/ui/icons/"+(t[5].role==2?"star":"starsilver")+"."+On+"?v=8588529")||p(e,"src",n)},m(i,s){w(i,e,s)},p(i,s){s&32&&!lt(e.src,n="/data/ui/icons/"+(i[5].role==2?"star":"starsilver")+"."+On+"?v=8588529")&&p(e,"src",n)},d(i){i&&x(e)}}}function Vw(t){let e;return{c(){e=h("div"),p(e,"class","tag icon border black round combat svelte-g292qg")},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function Lw(t,e){let n,i,s,o=[e[26],{size:e[2]=="default"?31:23}],r={};for(let l=0;l<o.length;l+=1)r=Nl(r,o[l]);return i=new bx({props:r}),{key:t,first:null,c(){n=ve(),ne(i.$$.fragment),this.first=n},m(l,a){w(l,n,a),ee(i,l,a),s=!0},p(l,a){e=l;let c=a&524292?em(o,[a&524288&&tm(e[26]),a&4&&{size:e[2]=="default"?31:23}]):{};i.$set(c)},i(l){s||(P(i.$$.fragment,l),s=!0)},o(l){q(i.$$.fragment,l),s=!1},d(l){l&&x(n),te(i,l)}}}function JE(t){let e,n,i=t[5].visible&&Tw(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[5].visible?i?(i.p(s,o),o&32&&P(i,1)):(i=Tw(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function KE(t,e,n){let i,s,o,r,l=ue,a=()=>(l(),l=ls(v,se=>n(5,r=se)),v),c,f,u,m=ue,g=()=>(m(),m=ls(_,se=>n(19,u=se)),_);re(t,zs,se=>n(17,c=se)),re(t,ha,se=>n(18,f=se)),t.$$.on_destroy.push(()=>l()),t.$$.on_destroy.push(()=>m());let{unit:v}=e;a();let{buffs:_}=e;g();let{mode:b="default"}=e,{order:y=0}=e,{id:k=""}=e,S,A,F,M,D,R,E,L,B,I,N=!1,j=0,W=se=>{r.id&&ir(r.id)},O=se=>Qk(se,r);return t.$$set=se=>{"unit"in se&&a(n(0,v=se.unit)),"buffs"in se&&g(n(1,_=se.buffs)),"mode"in se&&n(2,b=se.mode),"order"in se&&n(3,y=se.order),"id"in se&&n(4,k=se.id)},t.$$.update=()=>{t.$$.dirty&32&&n(24,i=r.world==V.id?r.alive?!1:"Dead":r.world),t.$$.dirty&18874404&&(n(21,S=r.hpMax?b=="default"?ni(r.hp)+"/"+ni(r.hpMax):ni(r.hp):"?"),n(6,F=i||S),n(8,D=i!="offline"?~~(r.hpMax?r.hp/r.hpMax*100:100):0),n(13,I=i?"bggrey":(V.mode.partyBasedHostility?r.party===V.player.party:r.faction===V.player.faction)?"bghealth":"bgenemy")),t.$$.dirty&36&&n(22,A=r.mpMax?b=="default"?ni(r.mp)+"/"+ni(r.mpMax):ni(r.mp):"?"),t.$$.dirty&32&&n(10,E=r.name?ux(r.name,10):""),t.$$.dirty&32&&n(11,L=r.timedSkill?(C.ui.hiddenskills[r.timedSkill.id]||C.items.book[r.timedSkill.id]).name:`Lv. ${r.level}`),t.$$.dirty&20971552&&n(7,M=i||(r.timedSkill?r.timedCast.remaining(V.smoothtime).toFixed(1):A)),t.$$.dirty&16777248&&n(9,R=i!="offline"?~~(r.mpMax?r.mp/r.mpMax*100:100):0),t.$$.dirty&16777248&&n(12,B=i!="offline"&&r.timedSkill?r.timedCast.fraction(V.smoothtime)*100:0),t.$$.dirty&16777216&&n(16,s=i?"bggrey":"bgmana"),t.$$.dirty&4&&n(15,o=Math.round(b=="default"?100:85)),t.$$.dirty&8388640&&(n(14,N=j!=r.id),n(23,j=r.id))},[v,_,b,y,k,r,F,M,D,R,E,L,B,I,N,o,s,c,f,u,W,S,A,j,i,O]}var og=class extends Me{constructor(e){super(),Ce(this,e,KE,JE,Ue,{unit:0,buffs:1,mode:2,order:3,id:4})}},Zf=og;function eD(t){let e,n,i,s;return n=new Zf({props:{id:"ufplayer",order:0,unit:Rs,buffs:ea}}),i=new Zf({props:{id:"uftarget",order:1,unit:zs,buffs:Ic}}),{c(){e=h("div"),ne(n.$$.fragment),ne(i.$$.fragment),p(e,"class","targetframes svelte-17up9g6")},m(o,r){w(o,e,r),ee(n,e,null),ee(i,e,null),s=!0},p:ue,i(o){s||(P(n.$$.fragment,o),P(i.$$.fragment,o),s=!0)},o(o){q(n.$$.fragment,o),q(i.$$.fragment,o),s=!1},d(o){o&&x(e),te(n),te(i)}}}var rg=class extends Me{constructor(e){super(),Ce(this,e,null,eD,Fn,{})}},qw=rg;function Rw(t){let e,n;return{c(){e=h("span"),n=T(t[2]),p(e,"class","slottext key svelte-1p1x0hl")},m(i,s){w(i,e,s),d(e,n)},p(i,s){s[0]&4&&G(n,i[2])},d(i){i&&x(e)}}}function zw(t){let e,n;return{c(){e=h("span"),n=T(t[3]),p(e,"class","slottext stacks svelte-1p1x0hl")},m(i,s){w(i,e,s),d(e,n)},p(i,s){s[0]&8&&G(n,i[3])},d(i){i&&x(e)}}}function Bw(t){let e,n=(t[5]>99?Math.round(t[5]/60)+"'":t[5]<=3?t[5].toFixed(1):Math.ceil(t[5]))+"",i;return{c(){e=h("div"),i=T(n),p(e,"class","time absCentered slottext svelte-1p1x0hl")},m(s,o){w(s,e,o),d(e,i)},p(s,o){o[0]&32&&n!==(n=(s[5]>99?Math.round(s[5]/60)+"'":s[5]<=3?s[5].toFixed(1):Math.ceil(s[5]))+"")&&G(i,n)},d(s){s&&x(e)}}}function Uw(t){let e;return{c(){e=h("div"),p(e,"class","autocast svelte-1p1x0hl")},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function Ow(t){let e,n,i,s=t[31].default,o=jl(s,t,t[30],null);return{c(){e=h("div"),o&&o.c(),p(e,"class",n="border "+t[6]+" slotdescription svelte-1p1x0hl"),p(e,"style",t[10])},m(r,l){w(r,e,l),o&&o.m(e,null),t[33](e),i=!0},p(r,l){o&&o.p&&(!i||l[0]&1073741824)&&Gl(o,s,r,r[30],i?Wl(s,r[30],l,null):Hl(r[30]),null),(!i||l[0]&64&&n!==(n="border "+r[6]+" slotdescription svelte-1p1x0hl"))&&p(e,"class",n),(!i||l[0]&1024)&&p(e,"style",r[10])},i(r){i||(P(o,r),i=!0)},o(r){q(o,r),i=!1},d(r){r&&x(e),o&&o.d(r),t[33](null)}}}function tD(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v,_,b,y=t[2]!==void 0&&Rw(t),k=t[3]!==void 0&&zw(t),S=le.cdTextSkills&&t[5]!==void 0&&Bw(t),A=t[11]&&Uw(t),F=t[9]&&t[0]&&!t[15]&&Ow(t);return{c(){e=h("div"),y&&y.c(),n=ve(),k&&k.c(),i=ve(),S&&S.c(),s=h("div"),r=h("div"),a=h("div"),A&&A.c(),f=h("img"),F&&F.c(),p(s,"class",o="overlay "+(t[4]!==void 0?"":"hidden")+" svelte-1p1x0hl"),p(r,"class",l="overlay "+t[16]+" svelte-1p1x0hl"),p(a,"class",c="overlay "+(!t[14]||t[4]>0&&t[4]<10?"hidden":"offCd")+" svelte-1p1x0hl"),p(f,"class",u="icon "+t[7]+" svelte-1p1x0hl"),lt(f.src,m=t[17])||p(f,"src",m),p(e,"id",t[8]),p(e,"class",g="border "+t[6]+" "+(t[15]&&t[15].data==t[1]?"grey":"")+" slot "+(t[1]?"filled":"")+" svelte-1p1x0hl")},m(M,D){w(M,e,D),y&&y.m(e,null),d(e,n),k&&k.m(e,null),d(e,i),S&&S.m(e,null),d(e,s),t[32](s),d(e,r),d(e,a),A&&A.m(e,null),d(e,f),F&&F.m(e,null),v=!0,_||(b=[Z(e,"pointerenter",t[20]),Z(e,"pointerleave",t[21]),Z(e,"pointerdown",t[18]),Z(e,"pointerup",t[19])],_=!0)},p(M,D){M[2]!==void 0?y?y.p(M,D):(y=Rw(M),y.c(),y.m(e,n)):y&&(y.d(1),y=null),M[3]!==void 0?k?k.p(M,D):(k=zw(M),k.c(),k.m(e,i)):k&&(k.d(1),k=null),le.cdTextSkills&&M[5]!==void 0?S?S.p(M,D):(S=Bw(M),S.c(),S.m(e,s)):S&&(S.d(1),S=null),(!v||D[0]&16&&o!==(o="overlay "+(M[4]!==void 0?"":"hidden")+" svelte-1p1x0hl"))&&p(s,"class",o),(!v||D[0]&65536&&l!==(l="overlay "+M[16]+" svelte-1p1x0hl"))&&p(r,"class",l),(!v||D[0]&16400&&c!==(c="overlay "+(!M[14]||M[4]>0&&M[4]<10?"hidden":"offCd")+" svelte-1p1x0hl"))&&p(a,"class",c),M[11]?A||(A=Uw(M),A.c(),A.m(e,f)):A&&(A.d(1),A=null),(!v||D[0]&128&&u!==(u="icon "+M[7]+" svelte-1p1x0hl"))&&p(f,"class",u),(!v||D[0]&131072&&!lt(f.src,m=M[17]))&&p(f,"src",m),M[9]&&M[0]&&!M[15]?F?(F.p(M,D),D[0]&33281&&P(F,1)):(F=Ow(M),F.c(),P(F,1),F.m(e,null)):F&&(Pe(),q(F,1,1,()=>{F=null}),Te()),(!v||D[0]&256)&&p(e,"id",M[8]),(!v||D[0]&32834&&g!==(g="border "+M[6]+" "+(M[15]&&M[15].data==M[1]?"grey":"")+" slot "+(M[1]?"filled":"")+" svelte-1p1x0hl"))&&p(e,"class",g)},i(M){v||(P(F),v=!0)},o(M){q(F),v=!1},d(M){M&&x(e),y&&y.d(),k&&k.d(),S&&S.d(),t[32](null),A&&A.d(),F&&F.d(),_=!1,at(b)}}}function nD(t,e,n){let i,s,o,r;re(t,En,H=>n(15,r=H));let{$$slots:l={},$$scope:a}=e,{data:c=void 0}=e,{key:f}=e,{stacks:u}=e,{cd:m}=e,{remaining:g}=e,{border:v="grey"}=e,{img:_}=e,{meta:b}=e,{css:y=""}=e,{id:k=""}=e,{describe:S=!0}=e,{queued:A=!1}=e,{pickable:F=!0}=e,{descRoot:M}=e,{descPos:D="bottom: 100%; right: 100%;"}=e,{auto:R=!1}=e,{status:E=0}=e,{hover:L=!1}=e,{clickToUse:B=!1}=e,{shift:I=!1}=e,N=!1,j=(H,Le)=>H?"queued":Le==5?"oom":Le==6?"range":Le==11||Le==9?"combat":"hidden",W,O=H=>{B&&!I?$e("use",{e:H,...b}):(N=!0,xe(!1),$e("click",b))},se=H=>{H.button==2?I?$e("use",{e:H,...b}):$e("context",{e:H,...b}):r?(r.data.type&&Mt(Ri[r.data.type].sound),$e("move",{from:r.meta,to:b}),r.meta&&r.meta.store&&r.meta.store.set(),nt(En,r=void 0,r)):(!B||I)&&pe(),N=!1},X=H=>{xe(!0)},oe=()=>{$e("discard")},ce=H=>{xe(!1),c&&N&&(N=!1,pe())},xe=H=>{L!=="force"&&n(0,L=H)},pe=()=>{!c||F===!1||(c.moving||nt(En,r={data:c,img:_,meta:b,border:v,css:y,discard:oe},r),c.type&&Mt(Ri[c.type].sound))},$e=Mr(),Ee;function Fe(H){$t[H?"unshift":"push"](()=>{Ee=H,n(13,Ee)})}function _e(H){$t[H?"unshift":"push"](()=>{W=H,n(12,W)})}return t.$$set=H=>{"data"in H&&n(1,c=H.data),"key"in H&&n(2,f=H.key),"stacks"in H&&n(3,u=H.stacks),"cd"in H&&n(4,m=H.cd),"remaining"in H&&n(5,g=H.remaining),"border"in H&&n(6,v=H.border),"img"in H&&n(22,_=H.img),"meta"in H&&n(23,b=H.meta),"css"in H&&n(7,y=H.css),"id"in H&&n(8,k=H.id),"describe"in H&&n(9,S=H.describe),"queued"in H&&n(24,A=H.queued),"pickable"in H&&n(25,F=H.pickable),"descRoot"in H&&n(26,M=H.descRoot),"descPos"in H&&n(10,D=H.descPos),"auto"in H&&n(11,R=H.auto),"status"in H&&n(27,E=H.status),"hover"in H&&n(0,L=H.hover),"clickToUse"in H&&n(28,B=H.clickToUse),"shift"in H&&n(29,I=H.shift),"$$scope"in H&&n(30,a=H.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&16400&&n(14,i=i||m>0),t.$$.dirty[0]&138444817&&n(17,s=_?r&&L||m>0||E==-1?_.replace(/(?<!githubusercontent)\.(?!githubusercontent)/,"_grey.").replace(/_q[0-9]/g,""):_:`/data/ui/slotbg/bg.${Gn}?v=8588529`),t.$$.dirty[0]&150996992&&n(16,o=j(R||A,E)),t.$$.dirty[0]&67112960&&W&&M&&M.appendChild(W),t.$$.dirty[0]&8208&&jf(Math.floor(m||0),Ee,40)},[L,c,f,u,m,g,v,y,k,S,D,R,W,Ee,i,r,o,s,O,se,X,ce,_,b,A,F,M,E,B,I,a,l,Fe,_e]}var lg=class extends Me{constructor(e){super(),Ce(this,e,nD,tD,Fn,{data:1,key:2,stacks:3,cd:4,remaining:5,border:6,img:22,meta:23,css:7,id:8,describe:9,queued:24,pickable:25,descRoot:26,descPos:10,auto:11,status:27,hover:0,clickToUse:28,shift:29},null,[-1,-1])}},pl=lg;var $w=(t,e)=>typeof t=="function"?t(e):t;var Jf=Object.keys({onBlock:0,statsStatic:0,statsConvert:0,statsOverride:0,onInterval:0,multiplyIncomingHeal:0,multiplyIncomingDamage:0,addIncomingHeal:0,addIncomingDamage:0,addIncomingCrit:0,afterDamageEnemy:0,afterHealAlly:0,beforeDamageEnemy:0,beforeIncomingDamage:0,afterIncomingDamage:0,movementOverride:0,incapacitated:0,breakOnMove:0,breakOnCast:0,instantCast:0,onCast:0,onEnd:0,immuneAll:0,immuneCC:0,breakAfterPercentDamage:0}),de=class{constructor(e){this.id=e.id,this.intervalHaste=e.intervalHaste!==!1,this.intervalDuration=e.intervalDuration,this.intervalOnApply=e.intervalOnApply||!1,this.maxStacks=e.maxStacks,this.passive=e.passive||!1,this.clearOnDeath=e.clearOnDeath!==!1,this.custom=e.custom,this.unique=e.unique||!1,this.dr=e.dr||0,this.type=e.type||0,this.tags=e.tags||new Set,this.immuneAll=e.immuneAll||!1,this.immuneCC=e.immuneCC||!1,Jf.forEach(n=>{this[n]=e[n]}),this.customIcon=e.customIcon,this.icon=e.icon,this.fx=e.fx||{}}onSet(e,n,i){this.tags.forEach(s=>{i.tags.get(s).add(e)}),Jf.forEach(s=>{this[s]&&(s!=="incapacitated"&&s!=="movementOverride"||i.immuneCC.size<=0)&&i[s].add(e)})}onRemove(e,n,i){this.tags.forEach(s=>{i.tags.get(s).delete(e)}),Jf.forEach(s=>{this[s]&&i[s].delete(e)})}};var Nw=new de({id:77,passive:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(t.level*40)),e.addStat(28,Math.round(t.level*200))}});var jw=new de({id:59,tags:new Set([11]),icon:"ui/skills/2",fx:{stick:15},statsStatic:(t,e)=>{e.addStat(13,300+t.level*40)}});var id=(t,e)=>t*e/65535;var Ww=(t,e)=>{let n=e/65535;return[(t>>>16)*n,(t&65535)*n]};var _i=t=>t/60;var Ha=(t,e)=>{if(t.static||!e.data)return!1;let n=Ww(e.data[0]*2,6400),i=[n[0]-t.pos[0],n[1]-t.pos[2]];return xa(i)>t.size?(t.setSteer(0,1),t.setRot(sl(i)),t.setJump(0),!0):(t.setSteer(0,0),!1)};var Gw=new de({id:87,incapacitated:!0,icon:"ui/skills/33",fx:{stick:74,endSound:65},statsOverride:(t,e)=>{e.stat.set(15,250)},movementOverride:(t,e,n,i,s)=>{Ha(i,s)||i.buffs.removeBuff(s.id,i.id)}});var Hw=new de({id:76,icon:"ui/skills/20",fx:{stick:53},unique:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(t.level*30)),e.addStat(9,Math.round(t.level*22))}});var Yw=new de({id:73,passive:!0,icon:"ui/skills/17",custom:[[t=>93+t*32,"% as additional damage over 10 seconds"]],afterDamageEnemy:{3:(t,e,n)=>{}}});var Xw=new de({id:74,type:1,tags:new Set([1]),maxStacks:3,icon:"ui/skills/18",fx:{stick:38,color:[.7,.1,.1,.5]},intervalDuration:1.5,onInterval:(t,e,n)=>({id:18,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,noDaze:!0,type:1})});var Qw=new de({id:72,icon:"ui/skills/17",fx:{stick:18,color:[.9,.3,.1,.7]},custom:[[t=>t*12,"% increased damage"]]});var Zw=new de({id:121,incapacitated:!0,type:1,tags:new Set([7]),dr:3,breakAfterPercentDamage:.1,icon:"ui/skills/50",fx:{stick:86,incapacitated:!0},statsOverride:(t,e)=>{e.stat.get(15)>100&&e.stat.set(15,100)},movementOverride:(t,e,n,i,s)=>{Ha(i,s)},intervalDuration:1});var Jw=new de({id:61,passive:!0,icon:"ui/skills/8",statsConvert:[[0,.3,10],[0,.3,11],[0,.3,8]]});var Kw=new de({id:89,type:1,tags:new Set([3]),icon:"ui/skills/34",statsStatic:(t,e)=>{e.maxStat(29,10+t.level*10)}});var e5=new de({id:105,maxStacks:3,icon:"ui/skills/temperBoostBuff",fx:{stick:24,color:[.2,.2,.25,.95]},statsStatic:(t,e)=>{e.addStat(15,20)}});var t5=new de({id:104,maxStacks:3,tags:new Set([3,4]),icon:"ui/skills/41",fx:{stick:23,color:[.1,.1,.1,.92]},intervalDuration:.5,onInterval:(t,e,n)=>!0});var n5=new de({id:75,icon:"ui/skills/19",fx:{stick:54},unique:!0,statsStatic:(t,e)=>{e.addStat(10,t.level*3),e.addStat(11,t.level*4),e.addStat(6,t.level*50)}});var i5=new de({id:115,incapacitated:!0,tags:new Set([8]),immuneCC:!0,icon:"ui/skills/46",fx:{anim:34},statsStatic:(t,e)=>{e.maxStat(29,40)},statsOverride:(t,e)=>{e.stat.set(13,0)},intervalDuration:.5,onInterval:(t,e,n)=>!0});var s5=new de({id:91,type:1,tags:new Set([6]),incapacitated:!0,dr:3,icon:"ui/skills/37",fx:{visual:20,stick:88,endSound:69},statsStatic:(t,e)=>{e.maxStat(29,30+t.level*7),e.maxStat(30,20+t.level*5)}});var o5=new de({id:84,icon:"ui/skills/28",fx:{stick:65},unique:!0,statsStatic:(t,e)=>{e.addStat(16,100+t.level*60)}});var r5=new de({id:67,type:1,tags:new Set([3,1]),icon:"ui/skills/12",fx:{apply:50,stick:49,color:[.5,.4,.05,.5]},statsStatic:(t,e)=>{e.maxStat(29,20+t.level*3)},intervalDuration:1.5,onInterval:(t,e,n)=>({id:12,mode:1,caster:t.caster,target:e.id,dmg:1+n.stats.getDamageRoll()*(.1+t.level*.08),type:1,noDaze:!0})});var l5=new de({id:68,icon:"ui/skills/13",fx:{stick:52},intervalDuration:1,custom:[[t=>30+40*t,"MP recovered"]],onInterval:(t,e,n)=>{}});var a5=new de({id:107,maxStacks:5,icon:"ui/skills/43",fx:{stick:20}});var c5=new de({id:106,passive:!0});var f5=new de({id:60,maxStacks:3,icon:"ui/skills/7",fx:{stick:37},intervalDuration:1,multiplyIncomingHeal:{6:t=>1+t.stacks*.3,7:t=>1+(t.stacks-1)*.3},onInterval:(t,e,n)=>({id:7,mode:2,caster:t.caster,target:e.id,heal:6+n.stats.getDamageRoll()*(.028+t.level*.024)})});var u5=new de({id:64,passive:!0,icon:"ui/skills/8",statsConvert:[[4,.4,10],[4,.4,11]]});var m5=new de({id:90,breakOnCast:!0,icon:"ui/skills/36",fx:{visual:26,apply:76,endSound:69},statsStatic:(t,e)=>{e.addStat(15,8+t.level*12)}});var p5=new de({id:119,incapacitated:!0,type:1,tags:new Set([7]),dr:3,breakAfterPercentDamage:.1,icon:"ui/skills/49",fx:{incapacitated:!0,apply:122,stick:124},statsOverride:(t,e)=>{e.stat.get(15)>50&&e.stat.set(15,50)},movementOverride:(t,e,n,i,s)=>{Ha(i,s)}});var d5=new de({id:120,passive:!0});var h5=new de({id:82,passive:!0,statsStatic:(t,e)=>{e.addStat(14,Math.round(t.level*30))}});var g5=new de({id:66,icon:"ui/skills/11",fx:{stick:39,endSound:69},custom:[[t=>t*9,"% increased damage"]]});var v5=new de({id:83,icon:"ui/skills/27",fx:{stick:63},unique:!0,statsStatic:(t,e)=>{e.addStat(15,5+t.level*13)}});var _5=new de({id:85,passive:!0,icon:"ui/skills/29",custom:[[t=>40+t*21,"% per stack as additional damage over 10 seconds"]],afterDamageEnemy:{9:(t,e,n)=>{}}});var b5=new de({id:86,type:1,maxStacks:3,tags:new Set([3,1]),icon:"ui/skills/29",fx:{apply:51,stick:66,color:[.1,1,.3,.3]},statsStatic:(t,e)=>{e.maxStat(29,30)},intervalDuration:1.5,onInterval:(t,e,n)=>({id:29,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,type:1,noDaze:!0})});var y5=new de({id:95,maxStacks:4,icon:"ui/skills/31",instantCast:new Set([31]),beforeDamageEnemy:{31:(t,e,n,i)=>{}}});var k5=new de({id:65,passive:!0,icon:"ui/skills/10",custom:[[t=>2+t*1," Jumps"],[t=>15+t*12.5,"% damage per Jump"]],afterDamageEnemy:{9:(t,e,n)=>{}}});var x5=new de({id:92,icon:"ui/skills/38",fx:{stick:77},statsStatic:(t,e)=>{e.addStat(15,30)},instantCast:new Set([9]),onCast:{9:(t,e)=>{}}});var w5=new de({id:96,passive:!1,incapacitated:!0,icon:"ui/skills/38",statsOverride:(t,e)=>{e.stat.set(15,400)},movementOverride:(t,e,n,i,s)=>{i.setSteer(s.data[0]-1,s.data[1]-1)}});var M5=new de({id:63,passive:!0,icon:"ui/skills/8",statsConvert:[[2,.4,10],[2,.4,11]]});var F5=new de({id:81,icon:"ui/skills/25",fx:{stick:64},unique:!0,statsStatic:(t,e)=>{e.addStat(16,t.level*30)}});var C5=new de({id:118,passive:!0});var S5=new de({id:114,incapacitated:!0,tags:new Set([8]),icon:"ui/skills/45",fx:{anim:33},intervalHaste:!1,intervalDuration:.25,statsStatic:(t,e)=>{e.maxStat(29,15)},onInterval:(t,e,n)=>!0});var A5=new de({id:78,icon:"ui/skills/22",fx:{stick:60},unique:!0,statsStatic:(t,e)=>{e.addStat(14,t.level*30)}});var P5=new de({id:101,type:1,tags:new Set([5]),incapacitated:!0,dr:1,icon:"ui/skills/deepFrozen",fx:{stick:57,color:[.1,.9,.8,.9],frozen:!0},statsStatic:(t,e)=>{e.maxStat(29,100)},multiplyIncomingDamage:{4:t=>1+t.level*.1,15:t=>1+t.level*.1,51:t=>1+t.level*.1}});var T5=new de({id:80,icon:"ui/skills/24",fx:{stick:91},unique:!0,statsStatic:(t,e)=>{e.addStat(10,Math.floor(2+t.level*1.5)),e.addStat(11,Math.floor(3+t.level*3.5))}});var E5=new de({id:108,icon:"ui/skills/extraBolt",fx:{stick:22}});var D5=new de({id:116,incapacitated:!0,tags:new Set([8,10]),breakOnMove:!0,icon:"ui/skills/52",fx:{anim:35},intervalDuration:1,intervalOnApply:1,onInterval:(t,e,n)=>!0});var I5=new de({id:69,type:1,tags:new Set([4]),dr:2,icon:"ui/skills/14",fx:{stick:56,color:[.7,.7,1,.4]},statsStatic:(t,e)=>{e.maxStat(29,100)},addIncomingCrit:{4:t=>10+t.level*30,15:t=>20+t.level*30},intervalDuration:1.5,onInterval:(t,e,n)=>({id:14,mode:1,caster:t.caster,target:e.id,dmg:n.stats.getDamageRoll()*(.09+t.level*.27),type:1,noDaze:!0})});var V5=new de({id:99,type:1,tags:new Set([3]),maxStacks:4,icon:"ui/skills/frozenBuff",fx:{stick:58,color:[.1,.1,.8,.5]},statsStatic:(t,e)=>{e.maxStat(29,20)}});var L5=new de({id:71,icon:"ui/skills/16",fx:{stick:40,endSound:69},statsStatic:(t,e)=>{e.addStat(16,30+t.level*70),e.addStat(27,2+t.level*8)}});var q5=new de({id:117,incapacitated:!0,tags:new Set([9,11,12]),immuneAll:!0,intervalDuration:1,intervalHaste:!1,icon:"ui/skills/53",fx:{stick:120,frozen:!0},statsStatic:(t,e)=>{e.maxStat(29,100)},onInterval:(t,e,n)=>({id:53,mode:2,caster:t.caster,target:n.id,heal:t.level*50,nocrit:!0})});var R5=new de({id:100,passive:!0});var z5=new de({id:79,icon:"ui/skills/23",fx:{stick:17}});var B5=new de({id:70,passive:!0});var U5=new de({id:62,passive:!0,icon:"ui/skills/8",statsConvert:[[3,.4,10],[3,.4,11]]});var O5=new de({id:112,type:0,icon:"ui/skills/charm4",fx:{stick:42,color:[0,0,1,.7]}});var $5=new de({id:113,type:1,tags:new Set([1]),maxStacks:10,icon:"ui/skills/firebuff",fx:{stick:67,color:[2,1,.3,1]}});var N5=new de({id:126,type:1,tags:new Set([1]),maxStacks:5,icon:"ui/skills/firebuff",fx:{stick:132,apply:135,color:[.7,.1,1.5,1]}});var j5=new de({id:94,type:1,tags:new Set([3]),icon:"ui/skills/dazedBuff",fx:{stick:73},statsStatic:(t,e)=>{e.maxStat(29,30)}});var W5=new de({id:110,type:0,icon:"ui/skills/charm2",fx:{stick:21,color:[1,0,0,.8]},statsStatic:(t,e)=>{e.addStat(27,t.level)}});var G5=new de({id:124,passive:!1,icon:"ui/skills/hellspawn"});var H5=new de({id:109,type:0,icon:"ui/skills/charm1",fx:{stick:61,color:[.3,.3,.3,.9]},statsStatic:(t,e)=>{e.addStat(31,50)},beforeIncomingDamage:(t,e,n,i)=>n*(t.level/100)});var Y5=new de({id:123,passive:!0});var X5=new de({id:93,breakOnCast:!0,tags:new Set([12]),icon:"ui/skills/39",customIcon:t=>"items/mount/mount"+tr[t.data[0]].tier+"_q1",fx:{mount:t=>tr[t.data[0]].skin,apply:76,endSound:69},statsStatic:(t,e)=>{e.addStat(15,60)}});var Q5=new de({id:130,clearOnDeath:!1,tags:new Set([12]),icon:"ui/skills/39",customIcon:t=>"items/pet/pet"+tr[t.data[0]].tier+"_q1"});var Z5=new de({id:111,type:0,icon:"ui/skills/charm3",fx:{stick:62,color:[.3,0,.6,.8]},statsStatic:(t,e)=>{e.addStat(15,t.level)}});var J5=new de({id:127,type:0,maxStacks:8,clearOnDeath:!1,icon:"ui/skills/obeliskbuff"});var K5=new de({id:125,maxStacks:25,type:1,icon:"ui/skills/pierce",multiplyIncomingDamage:{0:t=>1+t.stacks*.2,60:t=>1+t.stacks*.2}});var e4=new de({id:103,icon:"ui/skills/postsummon",fx:{stick:80},unique:!0,statsStatic:(t,e)=>{e.addStat(15,20)}});var ag=["potionhp","potionMp"].map((t,e)=>new de({id:[97,98][e],maxStacks:1,icon:"ui/skills/"+t,fx:{stick:[43,83][e]},intervalHaste:!1,intervalDuration:.5,onInterval:(n,i,s)=>({id:100,mode:[2,3][e],caster:n.caster,target:i.id,heal:e==1?void 0:n.level,mprec:e==0?void 0:n.level,nocrit:!0})}));var t4=new de({id:88,type:1,tags:new Set([5]),dr:1,incapacitated:!0,icon:"ui/skills/stunBuff",fx:{stick:86,incapacitated:!0},movementOverride:(t,e,n,i,s)=>{i.setSteer(0,0),i.setJump(0)}});var n4=new de({id:102,maxStacks:99,icon:"ui/skills/suddenDeath",statsStatic:(t,e)=>{e.maxStat(30,t.stacks)}});var i4=new de({id:122,passive:!1,immuneCC:!0,icon:"ui/skills/21",statsStatic:(t,e)=>{e.addStat(6,t.stacks*5e5),t.level>1&&(e.addStat(17,30),e.addStat(16,1e3),e.addStat(15,200),e.addStat(10,500),e.addStat(11,500))},onCast:{0:(t,e,n,i,s)=>{}}});var s4=new de({id:131,passive:!0});var o4=new de({id:132,passive:!0});var r4=new de({id:128,type:0,tags:new Set([12]),icon:"ui/skills/ghost",fx:{color:[.9,1.2,.8,.8],alpha:[.3]}});var l4=new de({id:129,type:0,icon:"ui/skills/moderator",fx:{color:[.3,1.2,.9,.7],alpha:[.3]}});var dl=new Map;[r4,l4,J5,N5,K5,s4,Y5,G5,i4,$5,O5,Z5,W5,H5,e4,n4,ag[0],ag[1],t4,X5,Q5,j5,Zw,i5,e5,t5,Kw,Gw,n5,Hw,Nw,Xw,Yw,Qw,jw,Jw,a5,c5,s5,m5,o5,l5,f5,u5,r5,q5,D5,E5,P5,R5,V5,T5,A5,z5,B5,I5,U5,L5,d5,o4,p5,C5,S5,w5,y5,x5,_5,b5,F5,v5,h5,M5,k5,g5].forEach(t=>{dl.set(t.id,t)});var Ya=class{constructor(e){this.entity=e,this.alive=!0,this.stat=new Map,this.resource=new Map,this.combatTimer=new kt(-1,6)}tick(e,n){this.combatTimer.start>0&&this.combatTimer.done(n)&&this.onCombatEnd(n)}die(){return this.alive?(this.alive=!1,this.entity.skills.onDeath(),this.entity.buffs.onDeath(),!0):!1}getStat(e){return this.stat.get(e)|0}getResource(e){return this.resource.get(e)|0}addStat(e,n){this.stat.set(e,(this.stat.get(e)|0)+n)}maxStat(e,n){this.stat.set(e,Math.max(this.stat.get(e)|0,n))}multiplyStat(e,n){this.stat.set(e,(this.stat.get(e)|0)*n)}setResource(e,n){let i=Math.round(vt(n,0,this.getStat(e)));return this.resource.set(e,i),i}changeResource(e,n){return this.setResource(e,this.getResource(e)+n)}respawn(){this.alive=!0,this.onCombatEnd()}clear(){}refreshCombatTimer(e,n){this.combatTimer.end<e+n&&this.combatTimer.reset(e,n)}onCombatEnd(){this.combatTimer.reset(-1)}getDamageRoll(){return Math.round((this.getStat(10)+this.getStat(11))/2)}};function a4(t,e,n){let i=t.slice();return i[12]=e[n],i}function c4(t,e,n){let i=t.slice();return i[15]=e[n],i}function f4(t,e,n){let i=t.slice();return i[18]=e[n],i}function u4(t,e,n){let i=t.slice();return i[18]=e[n],i}function m4(t,e,n){let i=t.slice();return i[23]=e[n],i}function p4(t,e,n){let i=t.slice();return i[26]=e[n],i}function d4(t,e,n){let i=t.slice();return i[23]=e[n],i}function h4(t,e,n){let i=t.slice();return i[26]=e[n],i}function g4(t,e,n){let i=t.slice();return i[33]=e[n],i}function v4(t,e,n){let i=t.slice();return i[26]=e[n],i}function iD(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v,_,b,y,k,S,A,F,M,D,R=!t[2]&&t[0].parent===void 0&&_4(t),E=t[0].actiontype&&b4(t),L=t[0].auto&&y4(t),B=t[0].costMp&&k4(t),I=t[0].castLen&&x4(t),N=t[0].cd&&w4(t),j=t[0].duration>0&&M4(t),W=t[0].unique&&F4(t),O=t[0].refresh&&C4(t),se=t[0].range&&S4(t),X=t[6][t[0].targetMode]&&A4(t),oe=t[0].maxStacks&&P4(t),ce=t[0].dmg&&T4(t),xe=t[0].heal&&E4(t),pe=me([t[0].multiplyIncomingHeal,t[0].multiplyIncomingDamage]),$e=[];for(let J=0;J<2;J+=1)$e[J]=I4(g4(t,pe,J));let Ee=me([t[0].addIncomingHeal,t[0].addIncomingDamage]),Fe=[];for(let J=0;J<2;J+=1)Fe[J]=L4(d4(t,Ee,J));let _e=me([t[0].addIncomingCrit]),H=[];for(let J=0;J<1;J+=1)H[J]=R4(m4(t,_e,J));let Le=t[0].statsStatic&&z4(t),Oe=t[0].statsConvert&&U4(t),He=t[0].custom&&$4(t),Ye=t[0].aoe&&t[0].aoe.circleRadius&&j4(t),Ze=!t[0].parent&&W4(t),ge=me(t[5]),ae=[];for(let J=0;J<ge.length;J+=1)ae[J]=G4(a4(t,ge,J));let Be=J=>q(ae[J],1,1,()=>{ae[J]=null});return{c(){R&&R.c(),e=h("div"),E&&E.c(),n=ve(),L&&L.c(),i=ve(),B&&B.c(),s=ve(),I&&I.c(),o=ve(),N&&N.c(),r=ve(),j&&j.c(),l=ve(),W&&W.c(),a=ve(),O&&O.c(),c=h("div"),se&&se.c(),f=ve(),X&&X.c(),oe&&oe.c(),u=ve(),ce&&ce.c(),m=ve(),xe&&xe.c(),g=ve();for(let J=0;J<2;J+=1)$e[J].c();v=ve();for(let J=0;J<2;J+=1)Fe[J].c();_=ve();for(let J=0;J<1;J+=1)H[J].c();b=ve(),Le&&Le.c(),y=ve(),Oe&&Oe.c(),k=ve(),He&&He.c(),S=ve(),Ye&&Ye.c(),A=ve(),Ze&&Ze.c(),F=ve();for(let J=0;J<ae.length;J+=1)ae[J].c();M=ve(),p(e,"class","pad textgreen svelte-14w0l4b")},m(J,Q){R&&R.m(J,Q),w(J,e,Q),E&&E.m(e,null),d(e,n),L&&L.m(e,null),d(e,i),B&&B.m(e,null),d(e,s),I&&I.m(e,null),d(e,o),N&&N.m(e,null),d(e,r),j&&j.m(e,null),d(e,l),W&&W.m(e,null),d(e,a),O&&O.m(e,null),d(e,c),se&&se.m(c,null),d(c,f),X&&X.m(c,null),oe&&oe.m(J,Q),w(J,u,Q),ce&&ce.m(J,Q),w(J,m,Q),xe&&xe.m(J,Q),w(J,g,Q);for(let U=0;U<2;U+=1)$e[U]&&$e[U].m(J,Q);w(J,v,Q);for(let U=0;U<2;U+=1)Fe[U]&&Fe[U].m(J,Q);w(J,_,Q);for(let U=0;U<1;U+=1)H[U]&&H[U].m(J,Q);w(J,b,Q),Le&&Le.m(J,Q),w(J,y,Q),Oe&&Oe.m(J,Q),w(J,k,Q),He&&He.m(J,Q),w(J,S,Q),Ye&&Ye.m(J,Q),w(J,A,Q),Ze&&Ze.m(J,Q),w(J,F,Q);for(let U=0;U<ae.length;U+=1)ae[U]&&ae[U].m(J,Q);w(J,M,Q),D=!0},p(J,Q){if(!J[2]&&J[0].parent===void 0?R?R.p(J,Q):(R=_4(J),R.c(),R.m(e.parentNode,e)):R&&(R.d(1),R=null),J[0].actiontype?E?E.p(J,Q):(E=b4(J),E.c(),E.m(e,n)):E&&(E.d(1),E=null),J[0].auto?L||(L=y4(J),L.c(),L.m(e,i)):L&&(L.d(1),L=null),J[0].costMp?B?B.p(J,Q):(B=k4(J),B.c(),B.m(e,s)):B&&(B.d(1),B=null),J[0].castLen?I?I.p(J,Q):(I=x4(J),I.c(),I.m(e,o)):I&&(I.d(1),I=null),J[0].cd?N?N.p(J,Q):(N=w4(J),N.c(),N.m(e,r)):N&&(N.d(1),N=null),J[0].duration>0?j?j.p(J,Q):(j=M4(J),j.c(),j.m(e,l)):j&&(j.d(1),j=null),J[0].unique?W||(W=F4(J),W.c(),W.m(e,a)):W&&(W.d(1),W=null),J[0].refresh?O||(O=C4(J),O.c(),O.m(e,c)):O&&(O.d(1),O=null),J[0].range?se?se.p(J,Q):(se=S4(J),se.c(),se.m(c,f)):se&&(se.d(1),se=null),J[6][J[0].targetMode]?X?X.p(J,Q):(X=A4(J),X.c(),X.m(c,null)):X&&(X.d(1),X=null),J[0].maxStacks?oe?oe.p(J,Q):(oe=P4(J),oe.c(),oe.m(u.parentNode,u)):oe&&(oe.d(1),oe=null),J[0].dmg?ce?ce.p(J,Q):(ce=T4(J),ce.c(),ce.m(m.parentNode,m)):ce&&(ce.d(1),ce=null),J[0].heal?xe?xe.p(J,Q):(xe=E4(J),xe.c(),xe.m(g.parentNode,g)):xe&&(xe.d(1),xe=null),Q[0]&129){pe=me([J[0].multiplyIncomingHeal,J[0].multiplyIncomingDamage]);let U;for(U=0;U<2;U+=1){let fe=g4(J,pe,U);$e[U]?$e[U].p(fe,Q):($e[U]=I4(fe),$e[U].c(),$e[U].m(v.parentNode,v))}for(;U<2;U+=1)$e[U].d(1)}if(Q[0]&129){Ee=me([J[0].addIncomingHeal,J[0].addIncomingDamage]);let U;for(U=0;U<2;U+=1){let fe=d4(J,Ee,U);Fe[U]?Fe[U].p(fe,Q):(Fe[U]=L4(fe),Fe[U].c(),Fe[U].m(_.parentNode,_))}for(;U<2;U+=1)Fe[U].d(1)}if(Q[0]&129){_e=me([J[0].addIncomingCrit]);let U;for(U=0;U<1;U+=1){let fe=m4(J,_e,U);H[U]?H[U].p(fe,Q):(H[U]=R4(fe),H[U].c(),H[U].m(b.parentNode,b))}for(;U<1;U+=1)H[U].d(1)}if(J[0].statsStatic?Le?Le.p(J,Q):(Le=z4(J),Le.c(),Le.m(y.parentNode,y)):Le&&(Le.d(1),Le=null),J[0].statsConvert?Oe?Oe.p(J,Q):(Oe=U4(J),Oe.c(),Oe.m(k.parentNode,k)):Oe&&(Oe.d(1),Oe=null),J[0].custom?He?He.p(J,Q):(He=$4(J),He.c(),He.m(S.parentNode,S)):He&&(He.d(1),He=null),J[0].aoe&&J[0].aoe.circleRadius?Ye?Ye.p(J,Q):(Ye=j4(J),Ye.c(),Ye.m(A.parentNode,A)):Ye&&(Ye.d(1),Ye=null),J[0].parent?Ze&&(Ze.d(1),Ze=null):Ze?Ze.p(J,Q):(Ze=W4(J),Ze.c(),Ze.m(F.parentNode,F)),Q[0]&34){ge=me(J[5]);let U;for(U=0;U<ge.length;U+=1){let fe=a4(J,ge,U);ae[U]?(ae[U].p(fe,Q),P(ae[U],1)):(ae[U]=G4(fe),ae[U].c(),P(ae[U],1),ae[U].m(M.parentNode,M))}for(Pe(),U=ge.length;U<ae.length;U+=1)Be(U);Te()}},i(J){if(!D){for(let Q=0;Q<ge.length;Q+=1)P(ae[Q]);D=!0}},o(J){ae=ae.filter(Boolean);for(let Q=0;Q<ae.length;Q+=1)q(ae[Q]);D=!1},d(J){J&&(x(e),x(u),x(m),x(g),x(v),x(_),x(b),x(y),x(k),x(S),x(A),x(F),x(M)),R&&R.d(J),E&&E.d(),L&&L.d(),B&&B.d(),I&&I.d(),N&&N.d(),j&&j.d(),W&&W.d(),O&&O.d(),se&&se.d(),X&&X.d(),oe&&oe.d(J),ce&&ce.d(J),xe&&xe.d(J),it($e,J),it(Fe,J),it(H,J),Le&&Le.d(J),Oe&&Oe.d(J),He&&He.d(J),Ye&&Ye.d(J),Ze&&Ze.d(J),it(ae,J)}}}function sD(t){let e,n=t[0].item+"",i;return{c(){e=h("div"),i=T(n)},m(s,o){w(s,e,o),d(e,i)},p(s,o){o[0]&1&&n!==(n=s[0].item+"")&&G(i,n)},i:ue,o:ue,d(s){s&&x(e)}}}function _4(t){let e,n,i,s,o=C.items.book[t[0].id].name+"",r,l=t[0].engineOnly?"":" Lv. "+t[1],a;return{c(){e=h("div"),n=h("img"),s=Ne(),r=T(o),a=T(l),p(n,"class","texticon"),lt(n.src,i=Rf(t[0].id))||p(n,"src",i),p(e,"class","slottitle textprimary")},m(c,f){w(c,e,f),d(e,n),d(e,s),d(e,r),d(e,a)},p(c,f){f[0]&1&&!lt(n.src,i=Rf(c[0].id))&&p(n,"src",i),f[0]&1&&o!==(o=C.items.book[c[0].id].name+"")&&G(r,o),f[0]&3&&l!==(l=c[0].engineOnly?"":" Lv. "+c[1])&&G(a,l)},d(c){c&&x(e)}}}function b4(t){let e,n=t[8][t[0].mode]+"",i,s,o=t[0].actiontype+"",r;return{c(){e=h("div"),i=T(n),s=Ne(),r=T(o),p(e,"class","textwhite")},m(l,a){w(l,e,a),d(e,i),d(e,s),d(e,r)},p(l,a){a[0]&1&&n!==(n=l[8][l[0].mode]+"")&&G(i,n),a[0]&1&&o!==(o=l[0].actiontype+"")&&G(r,o)},d(l){l&&x(e)}}}function y4(t){let e;return{c(){e=h("div"),e.textContent="Auto cast"},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function k4(t){let e,n,i=t[0].costMp(t[1])+"",s,o,r=C.ui.stats.array[7]+"",l;return{c(){e=h("div"),n=T("Cost: "),s=T(i),o=Ne(),l=T(r)},m(a,c){w(a,e,c),d(e,n),d(e,s),d(e,o),d(e,l)},p(a,c){c[0]&3&&i!==(i=a[0].costMp(a[1])+"")&&G(s,i)},d(a){a&&x(e)}}}function x4(t){let e,n=t[7](t[0].castLen)+"",i,s;return{c(){e=h("div"),i=T(n),s=T("s Cast time")},m(o,r){w(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].castLen)+"")&&G(i,n)},d(o){o&&x(e)}}}function w4(t){let e,n=t[7](t[0].cd)+"",i,s;return{c(){e=h("div"),i=T(n),s=T("s Cooldown")},m(o,r){w(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].cd)+"")&&G(i,n)},d(o){o&&x(e)}}}function M4(t){let e,n=t[7](t[0].duration)+"",i,s;return{c(){e=h("div"),i=T(n),s=T("s Duration")},m(o,r){w(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].duration)+"")&&G(i,n)},d(o){o&&x(e)}}}function F4(t){let e;return{c(){e=h("div"),e.textContent="Unique"},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function C4(t){let e;return{c(){e=h("div"),e.textContent="Stacks refresh duration"},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function S4(t){let e,n=t[7](t[0].range)+"",i,s;return{c(){e=h("span"),i=T(n),s=T("m range ")},m(o,r){w(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].range)+"")&&G(i,n)},d(o){o&&x(e)}}}function A4(t){let e,n=t[6][t[0].targetMode]+"",i;return{c(){e=h("span"),i=T(n)},m(s,o){w(s,e,o),d(e,i)},p(s,o){o[0]&1&&n!==(n=s[6][s[0].targetMode]+"")&&G(i,n)},d(s){s&&x(e)}}}function P4(t){let e,n,i,s=t[4].stacks+"",o,r,l,a;return{c(){e=h("div"),n=h("u"),i=T("At "),o=T(s),r=T(" stacks"),l=T(":"),a=h("span"),a.textContent="(Press shift to toggle)",p(e,"class","pad textsecondary svelte-14w0l4b"),p(a,"class","textgrey")},m(c,f){w(c,e,f),d(e,n),d(n,i),d(n,o),d(n,r),d(e,l),w(c,a,f)},p(c,f){f[0]&16&&s!==(s=c[4].stacks+"")&&G(o,s)},d(c){c&&(x(e),x(a))}}}function T4(t){let e,n=t[7](t[0].dmg)+"",i,s;return{c(){e=h("div"),i=T(n),s=T(" DMG"),p(e,"class","textgreen")},m(o,r){w(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].dmg)+"")&&G(i,n)},d(o){o&&x(e)}}}function E4(t){let e,n=t[7](t[0].heal)+"",i,s;return{c(){e=h("div"),i=T(n),s=T(" Heal"),p(e,"class","textgreen")},m(o,r){w(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].heal)+"")&&G(i,n)},d(o){o&&x(e)}}}function D4(t){let e,n,i=C.items.book[t[26]].name+"",s,o,r=Math.round(100*t[7](t[33][t[26]](t[0]))-100)+"",l,a;return{c(){e=h("div"),n=T("Empower "),s=T(i),o=T(" by "),l=T(r),a=T("%"),p(e,"class","textcyan")},m(c,f){w(c,e,f),d(e,n),d(e,s),d(e,o),d(e,l),d(e,a)},p(c,f){f[0]&1&&i!==(i=C.items.book[c[26]].name+"")&&G(s,i),f[0]&1&&r!==(r=Math.round(100*c[7](c[33][c[26]](c[0]))-100)+"")&&G(l,r)},d(c){c&&x(e)}}}function I4(t){let e,n=me(Object.keys(t[33]||{})),i=[];for(let s=0;s<n.length;s+=1)i[s]=D4(v4(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ve()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o[0]&129){n=me(Object.keys(s[33]||{}));let r;for(r=0;r<n.length;r+=1){let l=v4(s,n,r);i[r]?i[r].p(l,o):(i[r]=D4(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function V4(t){let e,n,i=C.items.book[t[26]].name+"",s,o,r=t[7](t[23][t[26]](t[0]))+"",l;return{c(){e=h("div"),n=T("Empower "),s=T(i),o=T(" by "),l=T(r),p(e,"class","textcyan")},m(a,c){w(a,e,c),d(e,n),d(e,s),d(e,o),d(e,l)},p(a,c){c[0]&1&&i!==(i=C.items.book[a[26]].name+"")&&G(s,i),c[0]&1&&r!==(r=a[7](a[23][a[26]](a[0]))+"")&&G(l,r)},d(a){a&&x(e)}}}function L4(t){let e,n=me(Object.keys(t[23]||{})),i=[];for(let s=0;s<n.length;s+=1)i[s]=V4(h4(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ve()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o[0]&129){n=me(Object.keys(s[23]||{}));let r;for(r=0;r<n.length;r+=1){let l=h4(s,n,r);i[r]?i[r].p(l,o):(i[r]=V4(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function q4(t){let e,n,i=C.items.book[t[26]].name+"",s,o,r=ii(14,t[7](t[23][t[26]](t[0])))+"",l;return{c(){e=h("div"),n=T("Empower Crit% of "),s=T(i),o=T(" by "),l=T(r),p(e,"class","textcyan")},m(a,c){w(a,e,c),d(e,n),d(e,s),d(e,o),d(e,l)},p(a,c){c[0]&1&&i!==(i=C.items.book[a[26]].name+"")&&G(s,i),c[0]&1&&r!==(r=ii(14,a[7](a[23][a[26]](a[0])))+"")&&G(l,r)},d(a){a&&x(e)}}}function R4(t){let e,n=me(Object.keys(t[23]||{})),i=[];for(let s=0;s<n.length;s+=1)i[s]=q4(p4(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ve()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o[0]&129){n=me(Object.keys(s[23]||{}));let r;for(r=0;r<n.length;r+=1){let l=p4(s,n,r);i[r]?i[r].p(l,o):(i[r]=q4(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function z4(t){let e,n=me(Array.from(t[3].stat)),i=[];for(let s=0;s<n.length;s+=1)i[s]=B4(u4(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ve()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o[0]&8){n=me(Array.from(s[3].stat));let r;for(r=0;r<n.length;r+=1){let l=u4(s,n,r);i[r]?i[r].p(l,o):(i[r]=B4(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function B4(t){let e,n,i=ii(t[18][0],t[18][1])+"",s,o,r=C.ui.stats.array[t[18][0]]+"",l,a;return{c(){e=h("div"),n=T("+"),s=T(i),o=Ne(),l=T(r),a=Ne(),p(e,"class","textcyan")},m(c,f){w(c,e,f),d(e,n),d(e,s),d(e,o),d(e,l),d(e,a)},p(c,f){f[0]&8&&i!==(i=ii(c[18][0],c[18][1])+"")&&G(s,i),f[0]&8&&r!==(r=C.ui.stats.array[c[18][0]]+"")&&G(l,r)},d(c){c&&x(e)}}}function U4(t){let e,n=me(t[0].statsConvert),i=[];for(let s=0;s<n.length;s+=1)i[s]=O4(f4(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ve()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o[0]&1){n=me(s[0].statsConvert);let r;for(r=0;r<n.length;r+=1){let l=f4(s,n,r);i[r]?i[r].p(l,o):(i[r]=O4(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function O4(t){let e,n=C.ui.skilldescription.statincrement[0]+"",i,s,o=C.ui.stats.array[t[18][0]]+"",r,l,a=C.ui.skilldescription.statincrement[1]+"",c,f,u=ii(t[18][0],t[18][1])+"",m,g,v=C.ui.stats.array[t[18][2]]+"",_,b,y=C.ui.skilldescription.statincrement[2]+"",k;return{c(){e=h("div"),i=T(n),s=Ne(),r=T(o),l=Ne(),c=T(a),f=Ne(),m=T(u),g=Ne(),_=T(v),b=Ne(),k=T(y),p(e,"class","textcyan")},m(S,A){w(S,e,A),d(e,i),d(e,s),d(e,r),d(e,l),d(e,c),d(e,f),d(e,m),d(e,g),d(e,_),d(e,b),d(e,k)},p(S,A){A[0]&1&&o!==(o=C.ui.stats.array[S[18][0]]+"")&&G(r,o),A[0]&1&&u!==(u=ii(S[18][0],S[18][1])+"")&&G(m,u),A[0]&1&&v!==(v=C.ui.stats.array[S[18][2]]+"")&&G(_,v)},d(S){S&&x(e)}}}function $4(t){let e,n=me(t[0].custom),i=[];for(let s=0;s<n.length;s+=1)i[s]=N4(c4(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ve()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o[0]&131){n=me(s[0].custom);let r;for(r=0;r<n.length;r+=1){let l=c4(s,n,r);i[r]?i[r].p(l,o):(i[r]=N4(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function N4(t){let e,n=t[7](t[15][0](t[1]))+"",i,s=t[15][1]+"",o;return{c(){e=h("div"),i=T(n),o=T(s),p(e,"class","textcyan")},m(r,l){w(r,e,l),d(e,i),d(e,o)},p(r,l){l[0]&3&&n!==(n=r[7](r[15][0](r[1]))+"")&&G(i,n),l[0]&1&&s!==(s=r[15][1]+"")&&G(o,s)},d(r){r&&x(e)}}}function j4(t){let e,n=t[0].aoe.limit?"Up to "+t[0].aoe.limit:"All",i,s,o=t[0].aoe.faction?"allies":"enemies",r,l,a=t[7](t[0].aoe.circleRadius)+"",c,f;return{c(){e=h("div"),i=T(n),s=Ne(),r=T(o),l=T(" within "),c=T(a),f=T("m"),p(e,"class","textpvp")},m(u,m){w(u,e,m),d(e,i),d(e,s),d(e,r),d(e,l),d(e,c),d(e,f)},p(u,m){m[0]&1&&n!==(n=u[0].aoe.limit?"Up to "+u[0].aoe.limit:"All")&&G(i,n),m[0]&1&&o!==(o=u[0].aoe.faction?"allies":"enemies")&&G(r,o),m[0]&1&&a!==(a=u[7](u[0].aoe.circleRadius)+"")&&G(c,a)},d(u){u&&x(e)}}}function W4(t){let e,n,i,s=C.items.book[t[0].id].description+"",o;return{c(){e=h("div"),n=h("u"),n.textContent="Effect",i=T(": "),o=T(s),p(e,"class","textsecondary pad svelte-14w0l4b")},m(r,l){w(r,e,l),d(e,n),d(e,i),d(e,o)},p(r,l){l[0]&1&&s!==(s=C.items.book[r[0].id].description+"")&&G(o,s)},d(r){r&&x(e)}}}function G4(t){let e,n,i;return n=new sd({props:{level:t[1],skill:t[12]}}),{c(){e=h("div"),ne(n.$$.fragment),p(e,"class","pad svelte-14w0l4b")},m(s,o){w(s,e,o),ee(n,e,null),i=!0},p(s,o){let r={};o[0]&2&&(r.level=s[1]),o[0]&32&&(r.skill=s[12]),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){q(n.$$.fragment,s),i=!1},d(s){s&&x(e),te(n)}}}function oD(t){let e,n,i,s,o=[sD,iD],r=[];function l(a,c){return a[0].item?0:1}return n=l(t,[-1,-1]),i=r[n]=o[n](t),{c(){e=h("div"),i.c(),p(e,"class","container textsecondary svelte-14w0l4b")},m(a,c){w(a,e,c),r[n].m(e,null),s=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(Pe(),q(r[f],1,1,()=>{r[f]=null}),Te(),i=r[n],i?i.p(a,c):(i=r[n]=o[n](a),i.c()),P(i,1),i.m(e,null))},i(a){s||(P(i),s=!0)},o(a){q(i),s=!1},d(a){a&&x(e),r[n].d()}}}function rD(t,e,n){let{skill:i}=e,{level:s}=e,{asItemDescription:o=!1}=e,{shift:r=!1}=e,l={1:"Requires no target",16:"Self cast",256:"on Allies",4096:"on Enemy"},a=(_,b=V&&V.player)=>{if(!b)return"?";let y=$w(_,b);return y%1===0?y:y.toFixed(1)},c={0:"Melee attack",1:"Magic attack",2:"Heal",4:"Buff",5:"Stackable buff",6:"Ranged missile",7:"Ranged effect",9:"Effect"},f=[],u,m={},g=_=>{if(V)return _.onCast&&v("on cast",_.onCast,V.player,s),_.onBlock&&v("on block",_.onBlock,m,V.player),_.onInterval&&v(`every ${_.intervalDuration.toFixed(1)}s`,_.onInterval,m,V.player,V.player),_.onPermanent&&v("permanently",()=>({id:_.onPermanent(V.player),mode:4}),V.player,s),_},v=(_,b,y,k,S)=>{let A=b(y,k,S);if(!A||A===!0)return;let F=Object.assign({},A);if(F.actiontype=_,F.parent||(F.parent=[]),F.parent.push(i),F.mode===4||F.mode===5){let M=dl.get(F.id);f.unshift(g({...F,...M}))}else if(i.id===F.id)i.parent||(F.parent=void 0),n(0,i={...i,...F});else{if(i.parent){let M=i.parent.find(D=>D.id==F.id);if(M){M.parent||(F.parent=void 0),Object.assign(M,F);return}}f.unshift(g(F))}};return t.$$set=_=>{"skill"in _&&n(0,i=_.skill),"level"in _&&n(1,s=_.level),"asItemDescription"in _&&n(2,o=_.asItemDescription),"shift"in _&&n(9,r=_.shift)},t.$$.update=()=>{t.$$.dirty[0]&539&&(n(4,m={stacks:1,level:s}),n(4,m.stacks=i.maxStacks?r?1:i.maxStacks:1,m),n(0,i.stacks=m.stacks,i),n(5,f=[]),i.parent||g(i),i.statsStatic&&(n(3,u=new Ya),i.statsStatic(m,u)))},[i,s,o,u,m,f,l,a,c,r]}var sd=class extends Me{constructor(e){super(),Ce(this,e,rD,oD,Ue,{skill:0,level:1,asItemDescription:2,shift:9},null,[-1,-1])}},hl=sd;function lD(t){let e;return{c(){e=h("span")},m(n,i){w(n,e,i),e.innerHTML=t[0]},p(n,[i]){i&1&&(e.innerHTML=n[0])},i:ue,o:ue,d(n){n&&x(e)}}}function aD(t,e,n){let i,s,o;re(t,Hi,a=>n(4,o=a));let{amount:r}=e,{isPrice:l=!1}=e;return t.$$set=a=>{"amount"in a&&n(1,r=a.amount),"isPrice"in a&&n(2,l=a.isPrice)},t.$$.update=()=>{t.$$.dirty&22&&n(3,i=l&&r>o),t.$$.dirty&10&&n(0,s=D1(r,i))},[s,r,l,i,o]}var cg=class extends Me{constructor(e){super(),Ce(this,e,aD,lD,Fn,{amount:1,isPrice:2})}},kn=cg;function cD(t){let e;return{c(){e=h("span")},m(n,i){w(n,e,i),e.innerHTML=t[0]},p(n,[i]){i&1&&(e.innerHTML=n[0])},i:ue,o:ue,d(n){n&&x(e)}}}function fD(t,e,n){let i,s,o;re(t,ta,a=>n(4,o=a));let{amount:r}=e,{isPrice:l=!1}=e;return t.$$set=a=>{"amount"in a&&n(1,r=a.amount),"isPrice"in a&&n(2,l=a.isPrice)},t.$$.update=()=>{t.$$.dirty&22&&n(3,i=l&&r>o),t.$$.dirty&10&&n(0,s=I1(r,i))},[s,r,l,i,o]}var fg=class extends Me{constructor(e){super(),Ce(this,e,fD,cD,Fn,{amount:1,isPrice:2})}},or=fg;function uD(t){let e,n,i,s,o,r;return{c(){e=h("span"),n=h("img"),s=h("span"),o=T(t[0]),p(n,"class","svgicon texticon"),lt(n.src,i="/data/ui/icons/gem.svg?v=8588529")||p(n,"src",i),p(s,"class",r=!t[1]||t[0]<t[2]?"textprimary":"textred")},m(l,a){w(l,e,a),d(e,n),d(e,s),d(s,o)},p(l,[a]){a&1&&G(o,l[0]),a&7&&r!==(r=!l[1]||l[0]<l[2]?"textprimary":"textred")&&p(s,"class",r)},i:ue,o:ue,d(l){l&&x(e)}}}function mD(t,e,n){let i;re(t,qo,r=>n(2,i=r));let{amount:s}=e,{isPrice:o=!1}=e;return t.$$set=r=>{"amount"in r&&n(0,s=r.amount),"isPrice"in r&&n(1,o=r.isPrice)},[s,o,i]}var ug=class extends Me{constructor(e){super(),Ce(this,e,mD,uD,Fn,{amount:0,isPrice:1})}},rr=ug;function H4(t,e,n){let i=t.slice();return i[8]=e[n],i}function Y4(t,e,n){let i=t.slice();return i[11]=e[n],i}function X4(t,e,n){let i=t.slice();return i[11]=e[n],i}function Q4(t,e,n){let i=t.slice();return i[16]=e[n],i}function Z4(t,e,n){let i=t.slice();return i[8]=e[n],i}function J4(t){let e,n,i=t[0].gs+"",s,o;return{c(){e=h("span"),n=T("GS: "),s=T(i),o=Ne(),p(e,"class","textgreen")},m(r,l){w(r,e,l),d(e,n),d(e,s),w(r,o,l)},p(r,l){l&1&&i!==(i=r[0].gs+"")&&G(s,i)},d(r){r&&(x(e),x(o))}}}function K4(t){let e,n,i=t[0].dbid+"",s;return{c(){e=h("span"),n=T("ID: "),s=T(i),p(e,"class","textgrey")},m(o,r){w(o,e,r),d(e,n),d(e,s)},p(o,r){r&1&&i!==(i=o[0].dbid+"")&&G(s,i)},d(o){o&&x(e)}}}function pD(t){let e,n=t[8][1].type=="bonus"?"+ ":"",i,s=ii(t[8][0],t[8][1].value)+"",o,r,l=C.ui.stats.array[t[8][0]]+"",a,c,f,u=t[8][1].type=="bonus"&&t[2]&&eM(t);return{c(){e=h("div"),i=T(n),o=T(s),r=Ne(),a=T(l),c=Ne(),u&&u.c(),p(e,"class",f="text"+Yt(t[8][1].qual)[0]+" svelte-e3ao5j")},m(m,g){w(m,e,g),d(e,i),d(e,o),d(e,r),d(e,a),d(e,c),u&&u.m(e,null)},p(m,g){m[8][1].type=="bonus"&&m[2]?u?u.p(m,g):(u=eM(m),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},d(m){m&&x(e),u&&u.d()}}}function dD(t){let e,n,i=t[0].stats.get(10).value+"",s,o,r,l,a=t[0].stats.get(11).value+"",c,f,u,m,g=C.ui.stats.misc.damage+"",v,_;return{c(){e=h("div"),n=h("span"),s=T(i),r=T(" - "),l=h("span"),c=T(a),u=Ne(),m=h("span"),v=T(g),p(n,"class",o="text"+Yt(t[0].stats.get(10).qual)[0]+" svelte-e3ao5j"),p(l,"class",f="text"+Yt(t[0].stats.get(11).qual)[0]+" svelte-e3ao5j"),p(m,"class",_="text"+Yt(Math.min(t[0].stats.get(10).qual,t[0].stats.get(11).qual))[0]+" svelte-e3ao5j")},m(b,y){w(b,e,y),d(e,n),d(n,s),d(e,r),d(e,l),d(l,c),d(e,u),d(e,m),d(m,v)},p(b,y){y&1&&i!==(i=b[0].stats.get(10).value+"")&&G(s,i),y&1&&o!==(o="text"+Yt(b[0].stats.get(10).qual)[0]+" svelte-e3ao5j")&&p(n,"class",o),y&1&&a!==(a=b[0].stats.get(11).value+"")&&G(c,a),y&1&&f!==(f="text"+Yt(b[0].stats.get(11).qual)[0]+" svelte-e3ao5j")&&p(l,"class",f),y&1&&_!==(_="text"+Yt(Math.min(b[0].stats.get(10).qual,b[0].stats.get(11).qual))[0]+" svelte-e3ao5j")&&p(m,"class",_)},d(b){b&&x(e)}}}function eM(t){let e;return{c(){e=h("span"),e.textContent=`${Math.round(t[8][1].qual)}%`},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function tM(t){let e,n;function i(r,l){return l&1&&(e=null),e==null&&(e=!!(r[8][0]==10&&r[0].stats.has(11))),e?dD:pD}let s=i(t,-1),o=s(t);return{c(){o.c(),n=ve()},m(r,l){o.m(r,l),w(r,n,l)},p(r,l){s===(s=i(r,l))&&o?o.p(r,l):(o.d(1),o=s(r),o&&(o.c(),o.m(n.parentNode,n)))},d(r){r&&x(n),o.d(r)}}}function nM(t){let e,n=me(t[0].logic.custom),i=[];for(let s=0;s<n.length;s+=1)i[s]=iM(Q4(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ve()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o&1){n=me(s[0].logic.custom);let r;for(r=0;r<n.length;r+=1){let l=Q4(s,n,r);i[r]?i[r].p(l,o):(i[r]=iM(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function iM(t){let e,n=t[16]+"",i;return{c(){e=h("span"),i=T(n),p(e,"class","textgreen")},m(s,o){w(s,e,o),d(e,i)},p(s,o){o&1&&n!==(n=s[16]+"")&&G(i,n)},d(s){s&&x(e)}}}function sM(t){let e,n=t[11][0]+"",i,s;return{c(){e=h("div"),i=T(n),p(e,"class",s=t[11][1]?"textgreen":"textred")},m(o,r){w(o,e,r),d(e,i)},p(o,r){r&1&&n!==(n=o[11][0]+"")&&G(i,n),r&1&&s!==(s=o[11][1]?"textgreen":"textred")&&p(e,"class",s)},d(o){o&&x(e)}}}function hD(t){let e,n,i,s=t[0].logic.bindOnPurchase&&oM(t),o=t[0].logic.bindOnUse&&rM(t),r=t[0].logic.bindOnMerchant&&lM(t);return{c(){s&&s.c(),e=ve(),o&&o.c(),n=ve(),r&&r.c(),i=ve()},m(l,a){s&&s.m(l,a),w(l,e,a),o&&o.m(l,a),w(l,n,a),r&&r.m(l,a),w(l,i,a)},p(l,a){l[0].logic.bindOnPurchase?s?s.p(l,a):(s=oM(l),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null),l[0].logic.bindOnUse?o?o.p(l,a):(o=rM(l),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null),l[0].logic.bindOnMerchant?r?r.p(l,a):(r=lM(l),r.c(),r.m(i.parentNode,i)):r&&(r.d(1),r=null)},d(l){l&&(x(e),x(n),x(i)),s&&s.d(l),o&&o.d(l),r&&r.d(l)}}}function gD(t){let e,n=C.ui.inventory.bindlevel[t[0].bound]+"",i;return{c(){e=h("div"),i=T(n),p(e,"class","textgreen")},m(s,o){w(s,e,o),d(e,i)},p(s,o){o&1&&n!==(n=C.ui.inventory.bindlevel[s[0].bound]+"")&&G(i,n)},d(s){s&&x(e)}}}function oM(t){let e,n=C.ui.inventory.bindlevel[t[0].logic.bindOnPurchase]+"",i,s,o=C.ui.itemdescription.onpurchase+"",r;return{c(){e=h("div"),i=T(n),s=Ne(),r=T(o),p(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,i),d(e,s),d(e,r)},p(l,a){a&1&&n!==(n=C.ui.inventory.bindlevel[l[0].logic.bindOnPurchase]+"")&&G(i,n)},d(l){l&&x(e)}}}function rM(t){let e,n=C.ui.inventory.bindlevel[t[0].logic.bindOnUse]+"",i,s,o=C.ui.itemdescription.onuse+"",r;return{c(){e=h("div"),i=T(n),s=Ne(),r=T(o),p(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,i),d(e,s),d(e,r)},p(l,a){a&1&&n!==(n=C.ui.inventory.bindlevel[l[0].logic.bindOnUse]+"")&&G(i,n)},d(l){l&&x(e)}}}function lM(t){let e,n=C.ui.inventory.bindlevel[t[0].logic.bindOnMerchant]+"",i,s,o=C.ui.itemdescription.onsale+"",r;return{c(){e=h("div"),i=T(n),s=Ne(),r=T(o),p(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,i),d(e,s),d(e,r)},p(l,a){a&1&&n!==(n=C.ui.inventory.bindlevel[l[0].logic.bindOnMerchant]+"")&&G(i,n)},d(l){l&&x(e)}}}function aM(t){let e,n,i=t[0].medalValue()>0&&t[1],s,o=t[0].storeValue()>0&&t[1],r,l=!(t[0].storeValue()>0&&t[1])&&t[0].canBeSold(),a,c=t[1]&&cM(t),f=i&&uM(t),u=o&&mM(t),m=l&&pM(t);return{c(){e=h("div"),c&&c.c(),n=ve(),f&&f.c(),s=ve(),u&&u.c(),r=ve(),m&&m.c(),p(e,"class","panel value pack svelte-e3ao5j")},m(g,v){w(g,e,v),c&&c.m(e,null),d(e,n),f&&f.m(e,null),d(e,s),u&&u.m(e,null),d(e,r),m&&m.m(e,null),a=!0},p(g,v){g[1]?c?c.p(g,v):(c=cM(g),c.c(),c.m(e,n)):c&&(c.d(1),c=null),v&3&&(i=g[0].medalValue()>0&&g[1]),i?f?(f.p(g,v),v&3&&P(f,1)):(f=uM(g),f.c(),P(f,1),f.m(e,s)):f&&(Pe(),q(f,1,1,()=>{f=null}),Te()),v&3&&(o=g[0].storeValue()>0&&g[1]),o?u?(u.p(g,v),v&3&&P(u,1)):(u=mM(g),u.c(),P(u,1),u.m(e,r)):u&&(Pe(),q(u,1,1,()=>{u=null}),Te()),v&3&&(l=!(g[0].storeValue()>0&&g[1])&&g[0].canBeSold()),l?m?(m.p(g,v),v&3&&P(m,1)):(m=pM(g),m.c(),P(m,1),m.m(e,null)):m&&(Pe(),q(m,1,1,()=>{m=null}),Te())},i(g){a||(P(f),P(u),P(m),a=!0)},o(g){q(f),q(u),q(m),a=!1},d(g){g&&x(e),c&&c.d(),f&&f.d(),u&&u.d(),m&&m.d()}}}function cM(t){let e,n=me(t[0].buyReasons(V&&V.player)),i=[];for(let s=0;s<n.length;s+=1)i[s]=fM(Y4(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ve()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o&1){n=me(s[0].buyReasons(V&&V.player));let r;for(r=0;r<n.length;r+=1){let l=Y4(s,n,r);i[r]?i[r].p(l,o):(i[r]=fM(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function fM(t){let e,n=t[11][0]+"",i;return{c(){e=h("div"),p(e,"class",i=t[11][1]?"textgreen":"textred")},m(s,o){w(s,e,o),e.innerHTML=n},p(s,o){o&1&&n!==(n=s[11][0]+"")&&(e.innerHTML=n),o&1&&i!==(i=s[11][1]?"textgreen":"textred")&&p(e,"class",i)},d(s){s&&x(e)}}}function uM(t){let e,n,i;return n=new or({props:{amount:t[0].medalValue(),isPrice:!0}}),{c(){e=h("div"),ne(n.$$.fragment)},m(s,o){w(s,e,o),ee(n,e,null),i=!0},p(s,o){let r={};o&1&&(r.amount=s[0].medalValue()),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){q(n.$$.fragment,s),i=!1},d(s){s&&x(e),te(n)}}}function mM(t){let e,n,i;return n=new rr({props:{amount:t[0].storeValue(),isPrice:!0}}),{c(){e=h("div"),ne(n.$$.fragment)},m(s,o){w(s,e,o),ee(n,e,null),i=!0},p(s,o){let r={};o&1&&(r.amount=s[0].storeValue()),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){q(n.$$.fragment,s),i=!1},d(s){s&&x(e),te(n)}}}function pM(t){let e,n,i;return n=new kn({props:{amount:t[0].goldValue(t[1]),isPrice:t[1]}}),{c(){e=h("div"),ne(n.$$.fragment)},m(s,o){w(s,e,o),ee(n,e,null),i=!0},p(s,o){let r={};o&3&&(r.amount=s[0].goldValue(s[1])),o&2&&(r.isPrice=s[1]),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){q(n.$$.fragment,s),i=!1},d(s){s&&x(e),te(n)}}}function vD(t){let e,n,i,s,o=[yD,bD],r=[];function l(a,c){return a[0].type=="book"?0:1}return e=l(t,-1),n=r[e]=o[e](t),{c(){n.c(),i=ve()},m(a,c){r[e].m(a,c),w(a,i,c),s=!0},p(a,c){let f=e;e=l(a,c),e===f?r[e].p(a,c):(Pe(),q(r[f],1,1,()=>{r[f]=null}),Te(),n=r[e],n?n.p(a,c):(n=r[e]=o[e](a),n.c()),P(n,1),n.m(i.parentNode,i))},i(a){s||(P(n),s=!0)},o(a){q(n),s=!1},d(a){a&&x(i),r[e].d(a)}}}function _D(t){let e,n,i=me(t[4]),s=[];for(let o=0;o<i.length;o+=1)s[o]=dM(H4(t,i,o));return{c(){e=h("div"),n=h("div"),n.textContent=`${C.ui.itemdescription.equipeffect}:`;for(let o=0;o<s.length;o+=1)s[o].c();p(n,"class","textgrey"),p(e,"class","pack svelte-e3ao5j")},m(o,r){w(o,e,r),d(e,n);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null)},p(o,r){if(r&16){i=me(o[4]);let l;for(l=0;l<i.length;l+=1){let a=H4(o,i,l);s[l]?s[l].p(a,r):(s[l]=dM(a),s[l].c(),s[l].m(e,null))}for(;l<s.length;l+=1)s[l].d(1);s.length=i.length}},i:ue,o:ue,d(o){o&&x(e),it(s,o)}}}function bD(t){let e,n=Ih(t[0].type,t[0].tier)+"",i;return{c(){e=h("div"),i=T(n),p(e,"class","pack description svelte-e3ao5j")},m(s,o){w(s,e,o),d(e,i)},p(s,o){o&1&&n!==(n=Ih(s[0].type,s[0].tier)+"")&&G(i,n)},i:ue,o:ue,d(s){s&&x(e)}}}function yD(t){let e,n;return e=new hl({props:{shift:t[2],level:t[0].logic.skilllevel+1,skill:Pt.get(t[0].logic.skillid),asItemDescription:!0}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&4&&(o.shift=i[2]),s&1&&(o.level=i[0].logic.skilllevel+1),s&1&&(o.skill=Pt.get(i[0].logic.skillid)),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function dM(t){let e,n=t[8][1]>0?"+":"",i,s=ii(t[8][0],t[8][1])+"",o,r,l=C.ui.stats.array[t[8][0]]+"",a,c;return{c(){e=h("div"),i=T(n),o=T(s),r=Ne(),a=T(l),p(e,"class",c="text"+(t[8][1]>0?"green":"red"))},m(f,u){w(f,e,u),d(e,i),d(e,o),d(e,r),d(e,a)},p(f,u){u&16&&n!==(n=f[8][1]>0?"+":"")&&G(i,n),u&16&&s!==(s=ii(f[8][0],f[8][1])+"")&&G(o,s),u&16&&l!==(l=C.ui.stats.array[f[8][0]]+"")&&G(a,l),u&16&&c!==(c="text"+(f[8][1]>0?"green":"red"))&&p(e,"class",c)},d(f){f&&x(e)}}}function hM(t){let e,n,i,s;return n=new od({props:{item:t[3],comparison:!0}}),{c(){e=h("div"),ne(n.$$.fragment),p(e,"class",i="slotdescription border "+Yt(t[3].quality)[0]+" comparecontainer svelte-e3ao5j")},m(o,r){w(o,e,r),ee(n,e,null),s=!0},p(o,r){let l={};r&8&&(l.item=o[3]),n.$set(l),(!s||r&8&&i!==(i="slotdescription border "+Yt(o[3].quality)[0]+" comparecontainer svelte-e3ao5j"))&&p(e,"class",i)},i(o){s||(P(n.$$.fragment,o),s=!0)},o(o){q(n.$$.fragment,o),s=!1},d(o){o&&x(e),te(n)}}}function kD(t){let e,n,i,s=t[2]?"T"+(t[0].tier+1)+" ":"",o,r=hn(t[0].type,t[0].tier)+"",l,a,c=t[0].upgrade?" +"+t[0].upgrade:"",f,u,m,g=(t[0].stacks?"":Yt(t[0].quality)[1])+"",v,_,b=t[0].type+"",y,k,S,A=t[0].quality&&!t[0].stacks?t[0].quality+"%":"",F,M,D,R,E,L,B,I,N=t[1]||t[0].canBeSold(),j,W,O,se,X,oe=t[0].gs>0&&J4(t),ce=t[0].dbid&&K4(t),xe=me(t[5]),pe=[];for(let ae=0;ae<xe.length;ae+=1)pe[ae]=tM(Z4(t,xe,ae));let $e=t[0].logic.custom!==void 0&&nM(t),Ee=me(t[0].equipReasons(V&&V.player)),Fe=[];for(let ae=0;ae<Ee.length;ae+=1)Fe[ae]=sM(X4(t,Ee,ae));function _e(ae,Be){return ae[0].bound>0?gD:hD}let H=_e(t,-1),Le=H(t),Oe=N&&aM(t),He=[_D,vD],Ye=[];function Ze(ae,Be){return ae[3]?0:1}W=Ze(t,-1),O=Ye[W]=He[W](t);let ge=t[3]&&hM(t);return{c(){e=h("div"),n=h("div"),i=h("div"),o=T(s),l=T(r),a=h("span"),f=T(c),m=h("div"),v=T(g),_=Ne(),y=T(b),k=Ne(),S=h("span"),F=T(A),M=h("small"),oe&&oe.c(),D=ve(),ce&&ce.c(),R=Ne(),E=h("div");for(let ae=0;ae<pe.length;ae+=1)pe[ae].c();L=ve(),$e&&$e.c(),B=h("div");for(let ae=0;ae<Fe.length;ae+=1)Fe[ae].c();I=ve(),Le.c(),Oe&&Oe.c(),j=ve(),O.c(),ge&&ge.c(),se=ve(),p(a,"class","textprimary"),p(i,"class",u="slottitle text"+Yt(t[0].quality)[0]+" svelte-e3ao5j"),p(m,"class","type textwhite svelte-e3ao5j"),p(n,"class","pack svelte-e3ao5j"),p(E,"class","pack svelte-e3ao5j"),p(B,"class","pack svelte-e3ao5j"),p(e,"class","container svelte-e3ao5j")},m(ae,Be){w(ae,e,Be),d(e,n),d(n,i),d(i,o),d(i,l),d(i,a),d(a,f),d(n,m),d(m,v),d(m,_),d(m,y),d(m,k),d(m,S),d(S,F),d(n,M),oe&&oe.m(M,null),d(M,D),ce&&ce.m(M,null),d(n,R),d(e,E);for(let J=0;J<pe.length;J+=1)pe[J]&&pe[J].m(E,null);d(E,L),$e&&$e.m(E,null),d(e,B);for(let J=0;J<Fe.length;J+=1)Fe[J]&&Fe[J].m(B,null);d(B,I),Le.m(B,null),Oe&&Oe.m(e,null),d(e,j),Ye[W].m(e,null),ge&&ge.m(ae,Be),w(ae,se,Be),X=!0},p(ae,[Be]){if((!X||Be&5)&&s!==(s=ae[2]?"T"+(ae[0].tier+1)+" ":"")&&G(o,s),(!X||Be&1)&&r!==(r=hn(ae[0].type,ae[0].tier)+"")&&G(l,r),(!X||Be&1)&&c!==(c=ae[0].upgrade?" +"+ae[0].upgrade:"")&&G(f,c),(!X||Be&1&&u!==(u="slottitle text"+Yt(ae[0].quality)[0]+" svelte-e3ao5j"))&&p(i,"class",u),(!X||Be&1)&&g!==(g=(ae[0].stacks?"":Yt(ae[0].quality)[1])+"")&&G(v,g),(!X||Be&1)&&b!==(b=ae[0].type+"")&&G(y,b),(!X||Be&1)&&A!==(A=ae[0].quality&&!ae[0].stacks?ae[0].quality+"%":"")&&G(F,A),ae[0].gs>0?oe?oe.p(ae,Be):(oe=J4(ae),oe.c(),oe.m(M,D)):oe&&(oe.d(1),oe=null),ae[0].dbid?ce?ce.p(ae,Be):(ce=K4(ae),ce.c(),ce.m(M,null)):ce&&(ce.d(1),ce=null),Be&37){xe=me(ae[5]);let Q;for(Q=0;Q<xe.length;Q+=1){let U=Z4(ae,xe,Q);pe[Q]?pe[Q].p(U,Be):(pe[Q]=tM(U),pe[Q].c(),pe[Q].m(E,L))}for(;Q<pe.length;Q+=1)pe[Q].d(1);pe.length=xe.length}if(ae[0].logic.custom!==void 0?$e?$e.p(ae,Be):($e=nM(ae),$e.c(),$e.m(E,null)):$e&&($e.d(1),$e=null),Be&1){Ee=me(ae[0].equipReasons(V&&V.player));let Q;for(Q=0;Q<Ee.length;Q+=1){let U=X4(ae,Ee,Q);Fe[Q]?Fe[Q].p(U,Be):(Fe[Q]=sM(U),Fe[Q].c(),Fe[Q].m(B,I))}for(;Q<Fe.length;Q+=1)Fe[Q].d(1);Fe.length=Ee.length}H===(H=_e(ae,Be))&&Le?Le.p(ae,Be):(Le.d(1),Le=H(ae),Le&&(Le.c(),Le.m(B,null))),Be&3&&(N=ae[1]||ae[0].canBeSold()),N?Oe?(Oe.p(ae,Be),Be&3&&P(Oe,1)):(Oe=aM(ae),Oe.c(),P(Oe,1),Oe.m(e,j)):Oe&&(Pe(),q(Oe,1,1,()=>{Oe=null}),Te());let J=W;W=Ze(ae,Be),W===J?Ye[W].p(ae,Be):(Pe(),q(Ye[J],1,1,()=>{Ye[J]=null}),Te(),O=Ye[W],O?O.p(ae,Be):(O=Ye[W]=He[W](ae),O.c()),P(O,1),O.m(e,null)),ae[3]?ge?(ge.p(ae,Be),Be&8&&P(ge,1)):(ge=hM(ae),ge.c(),P(ge,1),ge.m(se.parentNode,se)):ge&&(Pe(),q(ge,1,1,()=>{ge=null}),Te())},i(ae){X||(P(Oe),P(O),P(ge),X=!0)},o(ae){q(Oe),q(O),q(ge),X=!1},d(ae){ae&&(x(e),x(se)),oe&&oe.d(),ce&&ce.d(),it(pe,ae),$e&&$e.d(),it(Fe,ae),Le.d(),Oe&&Oe.d(),Ye[W].d(),ge&&ge.d(ae)}}}function xD(t,e,n){let{item:i}=e,{comparison:s=!1}=e,{isTrader:o=!1}=e,{shift:r=!1}=e,l=i.stats.has(10)?Array.from(i.stats).filter(u=>u[0]!==11):Array.from(i.stats),a,c,f=u=>{let m=new Map;return i.stats.forEach((g,v)=>{m.set(v,g.value)}),u.stats.forEach((g,v)=>{let _=(m.get(v)||0)-g.value;_!==0?m.set(v,_):m.delete(v)}),Array.from(m)};return t.$$set=u=>{"item"in u&&n(0,i=u.item),"comparison"in u&&n(6,s=u.comparison),"isTrader"in u&&n(1,o=u.isTrader),"shift"in u&&n(2,r=u.shift)},t.$$.update=()=>{if(t.$$.dirty&69)if(V&&r&&!s){let u=i.getEquipSlot();if(u!==void 0&&V.player.inventory.slots.has(u)){let m=V.player.inventory.slots.get(u);n(3,a=m.type!==void 0?m:void 0),n(4,c=f(m))}}else n(3,a=void 0),n(4,c=void 0)},[i,o,r,a,c,l,s]}var od=class extends Me{constructor(e){super(),Ce(this,e,xD,kD,Ue,{item:0,comparison:6,isTrader:1,shift:2})}},rd=od;var vg={};Xn(vg,{addMessage:()=>jt,init:()=>FD,onWorldDestroy:()=>SD,postTick:()=>CD,wipeChatData:()=>gg});var mg,pg={},Dt=t=>(mg===void 0&&(mg=getComputedStyle(document.body)),pg[t]!==void 0?pg[t]:pg[t]=mg.getPropertyValue("--"+t));var gM=()=>{Ci.font="bold 18px hordes",Ci.fillText("Hordes",0,0)},lr=(t,e,n=1,i=1,s=1,o=1,r=0,l=0,a=.5,c=.5)=>{Ci.globalAlpha=le.nameplateShowTransparency?n:1;let f=t.width*i,u=t.height*i,m=Math.round(f*s),g=Math.round(u*o);return m===0||g===0||Ci.drawImage(t,0,0,Math.round(t.width*s),Math.round(t.height*o),Math.round(e[0]-f*a+r*i),Math.round(e[1]-u*c+l*i),m,g),m},ar=(t,e,n,i,s,o=0,r=0,l=.5,a=.5)=>lr(Kf(e,n),t,i,s,1,1,o,r,l,a),vM=(t,e,n,i,s=0,o=0,r=.5,l=.5)=>lr(e,t,n,i,1,1,s,o,r,l),gl=(t,e,n=!1)=>(n?(e[0]=t[0],e[1]=t[1]):Mi(e,t,gt.projectionViewMatrix),n||e[2]<1&&e[0]>-1&&e[0]<1?(e[1]=Math.max(-1,Math.min(e[1],1)),e[0]=Math.round((e[0]*.5+.5)*In.width),e[1]=Math.round((e[1]*-.5+.5)*In.height),e[1]=Math.max(30,e[1]),e):!1),_M=(t,e,n)=>{t.font="bold "+e+"px hordes",t.shadowColor="#000",t.shadowOffsetX=1,t.shadowOffsetY=1,t.fillStyle=n},It={name:{fill:Dt("name"),size:17},enemy:{fill:Dt("enemy"),size:17},pvp:{fill:Dt("pvp"),size:17},nameSmall:{fill:Dt("name"),size:13},enemySmall:{fill:Dt("enemy"),size:13},pvpSmall:{fill:Dt("pvp"),size:13},chatGlobal:{fill:Dt("global"),size:13,wrap:150},chatClan:{fill:Dt("clan"),size:13,wrap:150},chatParty:{fill:Dt("party"),size:13,wrap:150},chatWhisper:{fill:Dt("pvp"),size:13,wrap:150},chatYell:{fill:Dt("yell"),size:13,wrap:150},lev0:{fill:"#919191",size:13},lev1:{fill:Dt("name"),size:13},lev2:{fill:"#EEA303",size:13},lev3:{fill:Dt("enemy"),size:13},clan:{fill:Dt("clan"),size:17},faction0:{fill:Dt("f0"),size:17},faction1:{fill:Dt("f1"),size:17},faction0small:{fill:Dt("f0"),size:13},faction1small:{fill:Dt("f1"),size:13},phys:{fill:Dt("name"),size:18},physCrit:{fill:Dt("name"),size:24},spell:{fill:"#FFE404",size:28},spellCrit:{fill:"#FFE404",size:40},heal:{fill:"#12F027",size:28},mana:{fill:Dt("mana"),size:20},exp:{fill:Dt("exp"),size:20},fame:{fill:Dt("fame"),size:20},gold:{fill:"#EEDDA3",size:16},misc:{fill:"#A6EBFA",size:16},book:{fill:"#749DEF",size:20},rune:{fill:"#DC9A4D",size:20},itemgrey:{fill:"#747474",size:16},common:{fill:"#dddddd",size:20},uncommon:{fill:Dt("green"),size:20},rare:{fill:Dt("blue"),size:20},epic:{fill:Dt("purp"),size:20},legendary:{fill:"#EE960B",size:20},mythical:{fill:"#a72929",size:20},pheal:{fill:"#12F027",size:20},pdmg:{fill:Dt("enemy"),size:20}},dg={},Kf=(t,{fill:e,size:n,wrap:i=0})=>{let s=t+e+n;if(dg[s])return dg[s];let o=document.createElement("canvas"),r=o.getContext("2d");return r.font="bold "+n+"px hordes",i>0?wD(o,r,t,0,0,i,n,e):(o.width=Math.max(1,Math.ceil(r.measureText(t).width))+5,o.height=Math.ceil(n*1.2+5),_M(r,n,e),r.fillText(t,0,o.height-6)),dg[s]=o,o},Ti=(t,e,n,i,s,o,r)=>{t||(t=document.createElement("canvas"),t.width=n,t.height=i);let l=t.getContext("2d");return l.fillStyle=e,l.beginPath(),l.moveTo(s+r,o),l.arcTo(s+n,o,s+n,o+i,r),l.arcTo(s+n,o+i,s,o+i,r),l.arcTo(s,o+i,s,o,r),l.arcTo(s,o,s+n,o,r),l.closePath(),l.fill(),t},wD=(t,e,n,i,s,o,r,l)=>{let a=n.split(" "),c=[],f=0,u="";for(let m=0;m<a.length;++m){let g=u+a[m]+" ",v=e.measureText(g);v.width>o?(c.push(u),u=a[m]+" "):(f=Math.max(f,v.width),u=g)}c.push(u),t.width=Math.ceil(f+5),t.height=Math.ceil(c.length*r+10),Ti(t,"#00000099",t.width,t.height,0,0,5),_M(e,r,l);for(let m=0;m<c.length;++m)e.fillText(c[m],i+5,(m+1)*r+3)};var MD=0,bM=new kt(0,10),ld=[],ad=[],FD=()=>{Un(Ft.serverChat.header,t=>{ld.push(t)}),Un(Ft.serverSystemMessage.header,t=>{ad.push(t)})},hg=0,CD=(t,e)=>{ld.forEach(n=>{n=Ft.serverChat.decode(n),n.messages.forEach(i=>{if(i.from==""){let s=i.message.split(" ");C&&C.ui.messages[s[0]]&&(i.message=C.ui.messages[s[0]],s.splice(1).forEach((o,r)=>{i.message=i.message.replace("$"+(r+1),o)})),i.channel="notice"}else if(le.chatbubbles&&hg>5){let s=i.channel=="to"?e.player.name:i.from,o=e.getPlayerByName(s);if(o){let r;switch(i.channel){case"from":case"to":r=It.chatWhisper;break;case"clan":r=It.chatClan;break;case"party":r=It.chatParty;break;case"yell":r=It.chatYell;break;default:case"global":r=It.chatGlobal;break}o.speech(s+": "+i.message,r)}}i.clan==="GM"&&i.channel==="global"&&(i.channel="GM"),jt(i.channel,i.message,i.channel=="system"||i.channel=="notice",i.from,i.faction,i.class,i.level,i.subscribed,i.id)})}),ad.forEach(n=>{n=Ft.serverSystemMessage.decode(n),n.messages.forEach(i=>{jt(i.type,i.message,!0)})}),ld.length=0,ad.length=0,hg++},jt=(t,e,n=!1,i,s,o,r,l,a=0)=>{Dc.update(c=>{c.length>100&&c.shift(),n&&(e=$f(e)),t==="from"&&(bM.done(V.time)&&Mt(97),bM.reset(V.time));let f=new Date;return c.push({channel:t,time:`${String(f.getHours()).padStart(2,"0")}.${String(f.getMinutes()).padStart(2,"0")}`,text:e,key:++MD,sender:i,sub:l,faction:s,cclass:o,level:r,interpolate:n,id:a}),c})},gg=()=>{Dc.set([]),hg=0},SD=()=>{ld.length=0,ad.length=0};function AD(t){let e,n;return e=new hl({props:{level:t[2]||1,skill:{...Pt.get(t[7].id)}}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s[0]&4&&(o.level=i[2]||1),s[0]&128&&(o.skill={...Pt.get(i[7].id)}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function PD(t){let e,n;return e=new rd({props:{item:t[4]}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s[0]&16&&(o.item=i[4]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function TD(t){let e,n,i,s,o=[PD,AD],r=[];function l(a,c){return a[4]?0:a[7].id>=0?1:-1}return~(e=l(t,[-1,-1]))&&(n=r[e]=o[e](t)),{c(){n&&n.c(),i=ve()},m(a,c){~e&&r[e].m(a,c),w(a,i,c),s=!0},p(a,c){let f=e;e=l(a,c),e===f?~e&&r[e].p(a,c):(n&&(Pe(),q(r[f],1,1,()=>{r[f]=null}),Te()),~e?(n=r[e],n?n.p(a,c):(n=r[e]=o[e](a),n.c()),P(n,1),n.m(i.parentNode,i)):n=null)},i(a){s||(P(n),s=!0)},o(a){q(n),s=!1},d(a){a&&x(i),~e&&r[e].d(a)}}}function ED(t){let e,n;return e=new pl({props:{shift:t[1],describe:t[7].id>=0&&!t[7].item||t[4]!==void 0,descPos:"bottom:100%;left:50%;transform:translateX(-50%);",clickToUse:!0,status:t[11]?-1:t[5]!==void 0?t[5].status:0,id:"sk"+t[7].hotkey,data:t[7].id>=0||t[4]!==void 0?t[7]:void 0,auto:t[9],queued:t[10],meta:t[16],css:t[15],stacks:t[3],cd:t[13],img:t[14],remaining:t[12],key:t[7].hotkey,border:t[10]||t[8]?"auto":t[11]||t[9]||t[6]||t[13]?"grey":t[4]?Yt(t[4].quality)[0]:"white",$$slots:{default:[TD]},$$scope:{ctx:t}}}),e.$on("discard",t[25]),e.$on("move",t[26]),e.$on("use",t[17]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s[0]&2&&(o.shift=i[1]),s[0]&144&&(o.describe=i[7].id>=0&&!i[7].item||i[4]!==void 0),s[0]&2080&&(o.status=i[11]?-1:i[5]!==void 0?i[5].status:0),s[0]&128&&(o.id="sk"+i[7].hotkey),s[0]&144&&(o.data=i[7].id>=0||i[4]!==void 0?i[7]:void 0),s[0]&512&&(o.auto=i[9]),s[0]&1024&&(o.queued=i[10]),s[0]&65536&&(o.meta=i[16]),s[0]&32768&&(o.css=i[15]),s[0]&8&&(o.stacks=i[3]),s[0]&8192&&(o.cd=i[13]),s[0]&16384&&(o.img=i[14]),s[0]&4096&&(o.remaining=i[12]),s[0]&128&&(o.key=i[7].hotkey),s[0]&12112&&(o.border=i[10]||i[8]?"auto":i[11]||i[9]||i[6]||i[13]?"grey":i[4]?Yt(i[4].quality)[0]:"white"),s[0]&148|s[1]&8&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function DD(t,e,n){let i,s,o,r,l,a,c,f,u,m,g,v,_,b,y,k,S=ue,A=()=>(S(),S=ls(L,pe=>n(7,k=pe)),L),F,M,D,R,E;re(t,lm,pe=>n(20,F=pe)),re(t,rm,pe=>n(21,M=pe)),re(t,zo,pe=>n(22,D=pe)),re(t,ia,pe=>n(23,R=pe)),re(t,Ro,pe=>n(24,E=pe)),t.$$.on_destroy.push(()=>S());let{skill:L}=e;A();let{skillslot:B}=e,{shift:I=!1}=e,N,j,W,O;Ac(()=>{if(k.hotkey!==N&&(j!==void 0&&oe(),N=k.hotkey,N!==void 0)){O=tt[N],O==null&&(O=tt[N]={});let pe=fn(N,O);j=pe.onPress(se),W=pe.onRelease(X)}});let se=pe=>{if(V.player&&k.id>=0){if(k.item){let Ee=V.player.inventory.findFirstSlotOfType(k.item.type,k.item.tier);if(Ee!==void 0){let Fe=V.player.inventory.slots.get(Ee);if(Fe.bound<Fe.logic.bindOnUse){jt("error","Right-click and use the item in your inventory to bind it before using");return}nt(L,k.info[0]=Ee,k)}else return}let $e=Pt.get(k.id);$e.envCast>0?sr>0?Qf(0,0,0):Qf(k.id,$e.range,$e.envCast):Si(Ft.clientPlayerSkill.packData({id:k.id,info:k.info})),pe.type==="keydown"&&n(8,u=!0),Mt(96)}},X=()=>{n(8,u=!1)},oe=()=>{O&&O.mappings&&(O.mappings=O.mappings.filter(pe=>pe!=N)),O&&O.press&&(O.press=O.press.filter(pe=>pe!=j)),O&&O.release&&(O.release=O.release.filter(pe=>pe!=W)),N=void 0,j=void 0,W=void 0};Tn(oe);function ce(pe){io.call(this,t,pe)}function xe(pe){io.call(this,t,pe)}return t.$$set=pe=>{"skill"in pe&&A(n(0,L=pe.skill)),"skillslot"in pe&&n(18,B=pe.skillslot),"shift"in pe&&n(1,I=pe.shift)},t.$$.update=()=>{t.$$.dirty[0]&262272&&n(16,i={type:"skill",slot:B,skill:k}),t.$$.dirty[0]&128&&n(6,s=k.id<0),t.$$.dirty[0]&128&&n(19,o=k.item),t.$$.dirty[0]&16777408&&n(5,r=s?void 0:E[k.id]),t.$$.dirty[0]&128&&n(15,l=k.item?"slotitem":"slotskill"),t.$$.dirty[0]&8388736&&n(4,a=R&&k.item&&V.player?V.player.inventory.findFirstItemOfType(k.item.type,k.item.tier):void 0),t.$$.dirty[0]&524496&&n(14,c=s?void 0:o?a?qf(a.type,a.tier,a.logic.class,Na(a.quality)):qf(o.type,o.tier,0,0):Rf(k.id)),t.$$.dirty[0]&8912912&&n(3,f=a!==void 0&&a.stacks!==void 0?R[o.type+o.tier]||0:void 0),t.$$.dirty[0]&4194496&&n(2,m=!k.item&&!s&&D.has(k.id)?D.get(k.id):0),t.$$.dirty[0]&32&&n(13,g=r?r.cd:void 0),t.$$.dirty[0]&32&&n(12,v=r?r.remaining:void 0),t.$$.dirty[0]&156&&n(11,_=k.item&&(!a||f===0)||!k.item&&m===0),t.$$.dirty[0]&2097280&&n(10,b=M!==void 0&&M===k.id),t.$$.dirty[0]&1048704&&n(9,y=F!==void 0&&F===k.id)},n(8,u=!1),[L,I,m,f,a,r,s,k,u,y,b,_,v,g,c,l,i,se,B,o,F,M,D,R,E,ce,xe]}var _g=class extends Me{constructor(e){super(),Ce(this,e,DD,ED,Ue,{skill:0,skillslot:18,shift:1},null,[-1,-1])}},yM=_g;function kM(t,e,n){let i=t.slice();return i[10]=e[n],i[12]=n,i}function xM(t){let e,n;return e=new yM({props:{skill:t[10],skillslot:t[12],shift:t[0]}}),e.$on("discard",t[3]),e.$on("move",t[2]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&1&&(o.shift=i[0]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function ID(t){let e,n,i=me(wi),s=[];for(let r=0;r<i.length;r+=1)s[r]=xM(kM(t,i,r));let o=r=>q(s[r],1,1,()=>{s[r]=null});return{c(){e=h("div");for(let r=0;r<s.length;r+=1)s[r].c();p(e,"id","skillbar"),p(e,"class","panel-black bar svelte-1v6qmvo")},m(r,l){w(r,e,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null);n=!0},p(r,[l]){if(l&13){i=me(wi);let a;for(a=0;a<i.length;a+=1){let c=kM(r,i,a);s[a]?(s[a].p(c,l),P(s[a],1)):(s[a]=xM(c),s[a].c(),P(s[a],1),s[a].m(e,null))}for(Pe(),a=i.length;a<s.length;a+=1)o(a);Te()}},i(r){if(!n){for(let l=0;l<i.length;l+=1)P(s[l]);n=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)q(s[l]);n=!1},d(r){r&&x(e),it(s,r)}}}function VD(t,e,n){let i,s,o,r;re(t,En,g=>n(5,i=g)),re(t,po,g=>n(6,s=g)),re(t,Xr,g=>n(7,o=g));let l=tt.shift.store;re(t,l,g=>n(0,r=g));let a=V.player.name,c=s[a];c||(c=nt(po,s[a]=[],s));for(let g=0;g<o;++g)if(s[a][g]===void 0){let v=Cp.get(V.player.class).startSkills[g];s[a].push({id:v!==void 0&&Pt.get(v).autoSkillbar?v:-1,type:0,info:[]}),g===4||g===5?(nt(po,s[a][g].id=100,s),nt(po,s[a][g].item={type:"misc",tier:g-4},s)):g===11&&nt(po,s[a][11].id=40,s)}for(let g=0;g<o;++g)wi[g]===void 0&&wi.push(ie({id:-1,type:0,info:[]}));s[a].forEach((g,v)=>{wi[v]&&(g.hotkey=le["kbSkillbar"+(v+1)],wi[v].set(g))}),wi.forEach((g,v)=>{g.subscribe(_=>{po.update(b=>(b[a][v]=_,b))})});let f=g=>{let{from:v,to:_}=g.detail;v!==_&&(v.type=="item"?wi[_.slot].update(b=>(b.id=v.item.logic.useSkill,b.item={type:v.item.type,tier:v.item.tier},b)):v.type=="skill"&&(wi[_.slot].update(b=>(b.id=v.skill.id,b.item=v.skill.item,b)),v.slot!==void 0&&wi[v.slot].update(u)))},u=g=>(g.id=-1,g.item=void 0,g);return[r,l,f,g=>{wi[i.meta.slot].update(u)}]}var bg=class extends Me{constructor(e){super(),Ce(this,e,VD,ID,Fn,{})}},wM=bg;function MM(t){let e,n;return e=new rd({props:{isTrader:t[6],item:t[10],shift:t[8]}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&64&&(o.isTrader=i[6]),s&1024&&(o.item=i[10]),s&256&&(o.shift=i[8]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function LD(t){let e,n,i=t[10]&&MM(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,o){s[10]?i?(i.p(s,o),o&1024&&P(i,1)):(i=MM(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function qD(t){let e,n;return e=new pl({props:{describe:t[10]!==void 0,shift:t[8],cd:t[11],id:t[7],hover:t[5],descPos:t[4],descRoot:t[3],pickable:t[1],status:t[9]?-1:0,meta:t[14],img:t[15],border:t[13],stacks:t[12],data:t[10],key:t[2],$$slots:{default:[LD]},$$scope:{ctx:t}}}),e.$on("discard",t[21]),e.$on("use",t[22]),e.$on("click",t[23]),e.$on("context",t[24]),e.$on("move",t[25]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,[s]){let o={};s&1024&&(o.describe=i[10]!==void 0),s&256&&(o.shift=i[8]),s&2048&&(o.cd=i[11]),s&128&&(o.id=i[7]),s&32&&(o.hover=i[5]),s&16&&(o.descPos=i[4]),s&8&&(o.descRoot=i[3]),s&2&&(o.pickable=i[1]),s&512&&(o.status=i[9]?-1:0),s&16384&&(o.meta=i[14]),s&32768&&(o.img=i[15]),s&8192&&(o.border=i[13]),s&4096&&(o.stacks=i[12]),s&1024&&(o.data=i[10]),s&4&&(o.key=i[2]),s&134219072&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function RD(t,e,n){let i,s,o,r,l,a,c,f,u=ue,m=()=>(u(),u=ls(v,O=>n(10,f=O)),v),g;re(t,Ro,O=>n(20,g=O)),t.$$.on_destroy.push(()=>u());let{item:v}=e;m();let{filter:_=""}=e,{invslot:b}=e,{pickable:y=!0}=e,{text:k}=e,{descRoot:S}=e,{descPos:A}=e,{hover:F}=e,{isTrader:M=!1}=e,{clearOnMove:D=!1}=e,{id:R=""}=e,{shift:E=!1}=e,L=O=>O===!0||f.moving?!0:!(!O||f.type.includes(O)||f.logic.level>O||C.items[f.type][f.type==="book"?f.logic.skillid:f.tier].name.toLowerCase().includes(O));function B(O){io.call(this,t,O)}function I(O){io.call(this,t,O)}function N(O){io.call(this,t,O)}function j(O){io.call(this,t,O)}function W(O){io.call(this,t,O)}return t.$$set=O=>{"item"in O&&m(n(0,v=O.item)),"filter"in O&&n(16,_=O.filter),"invslot"in O&&n(17,b=O.invslot),"pickable"in O&&n(1,y=O.pickable),"text"in O&&n(2,k=O.text),"descRoot"in O&&n(3,S=O.descRoot),"descPos"in O&&n(4,A=O.descPos),"hover"in O&&n(5,F=O.hover),"isTrader"in O&&n(6,M=O.isTrader),"clearOnMove"in O&&n(18,D=O.clearOnMove),"id"in O&&n(7,R=O.id),"shift"in O&&n(8,E=O.shift)},t.$$.update=()=>{t.$$.dirty&132096&&n(15,i=f?qf(f.type,f.tier,f.logic?f.logic.class:0,Na(f.quality)):b>100?Lk(b):void 0),t.$$.dirty&394241&&n(14,s={type:"item",slot:b,item:f,store:D?v:void 0}),t.$$.dirty&66624&&n(9,o=f&&(M?!1:L(_))),t.$$.dirty&1536&&n(13,r=f?Yt(f.quality)[0]+(o?" grey":""):"grey"),t.$$.dirty&1024&&n(12,l=f&&(f.upgrade?"+"+f.upgrade:f.stacks)),t.$$.dirty&1049600&&n(19,a=f&&f.logic.useSkill?g[f.logic.useSkill]:void 0),t.$$.dirty&524288&&n(11,c=a?a.cd:void 0)},[v,y,k,S,A,F,M,R,E,o,f,c,l,r,s,i,_,b,D,a,g,B,I,N,j,W]}var yg=class extends Me{constructor(e){super(),Ce(this,e,RD,qD,Ue,{item:0,filter:16,invslot:17,pickable:1,text:2,descRoot:3,descPos:4,hover:5,isTrader:6,clearOnMove:18,id:7,shift:8})}},bi=yg;function FM(t,e,n){let i=t.slice();return i[19]=e[n],i[21]=n,i}function CM(t){let e,n;return e=new Nt({props:{title:C.ui.inventory.name,icon:"bag",$$slots:{default:[zD]},$$scope:{ctx:t}}}),e.$on("close",t[14]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&4194555&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function SM(t){let e,n;return e=new bi({props:{id:"bag"+t[21],item:t[19],invslot:t[21],filter:t[0].toLowerCase(),shift:t[4]||t[5]}}),e.$on("use",t[12]),e.$on("context",t[11]),e.$on("move",t[10]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&2&&(o.item=i[19]),s&1&&(o.filter=i[0].toLowerCase()),s&48&&(o.shift=i[4]||i[5]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function zD(t){let e,n,i,s,o,r,l,a,c,f,u=me(t[1].filter(AM)),m=[];for(let v=0;v<u.length;v+=1)m[v]=SM(FM(t,u,v));let g=v=>q(m[v],1,1,()=>{m[v]=null});return o=new kn({props:{amount:t[6]}}),l=new rr({props:{amount:t[7]}}),{c(){e=h("input"),i=h("div");for(let v=0;v<m.length;v+=1)m[v].c();s=h("div"),ne(o.$$.fragment),r=h("a"),ne(l.$$.fragment),p(e,"class","filter svelte-ha50yv"),p(e,"type","text"),p(e,"placeholder",n=C.ui.filter),p(i,"class","slotcontainer svelte-ha50yv"),ze(i,"grid-template-columns","repeat("+t[3]+", auto)"),p(s,"class","panel-black gold svelte-ha50yv"),p(r,"class","panel-black gold svelte-ha50yv"),ze(r,"margin-right","3px"),p(r,"target","_blank"),p(r,"href","/store")},m(v,_){w(v,e,_),Ge(e,t[0]),w(v,i,_);for(let b=0;b<m.length;b+=1)m[b]&&m[b].m(i,null);w(v,s,_),ee(o,s,null),w(v,r,_),ee(l,r,null),a=!0,c||(f=Z(e,"input",t[13]),c=!0)},p(v,_){if(_&1&&e.value!==v[0]&&Ge(e,v[0]),_&7219){u=me(v[1].filter(AM));let k;for(k=0;k<u.length;k+=1){let S=FM(v,u,k);m[k]?(m[k].p(S,_),P(m[k],1)):(m[k]=SM(S),m[k].c(),P(m[k],1),m[k].m(i,null))}for(Pe(),k=u.length;k<m.length;k+=1)g(k);Te()}(!a||_&8)&&ze(i,"grid-template-columns","repeat("+v[3]+", auto)");let b={};_&64&&(b.amount=v[6]),o.$set(b);let y={};_&128&&(y.amount=v[7]),l.$set(y)},i(v){if(!a){for(let _=0;_<u.length;_+=1)P(m[_]);P(o.$$.fragment,v),P(l.$$.fragment,v),a=!0}},o(v){m=m.filter(Boolean);for(let _=0;_<m.length;_+=1)q(m[_]);q(o.$$.fragment,v),q(l.$$.fragment,v),a=!1},d(v){v&&(x(e),x(i),x(s),x(r)),it(m,v),te(o),te(l),c=!1,f()}}}function BD(t){let e,n,i=t[2]&&CM(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[2]?i?(i.p(s,o),o&4&&P(i,1)):(i=CM(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}var AM=(t,e)=>e<101;function UD(t,e,n){let i,s,o,r,l,a,c,f,u,m,g;re(t,Yi,M=>n(15,i=M)),re(t,as,M=>n(16,s=M)),re(t,Vi,M=>n(17,o=M)),re(t,En,M=>n(18,r=M)),re(t,na,M=>n(1,l=M)),re(t,ao,M=>n(2,a=M)),re(t,jr,M=>n(3,c=M)),re(t,Hi,M=>n(6,m=M)),re(t,qo,M=>n(7,g=M));let v="",_=tt.shift.store;re(t,_,M=>n(4,f=M));let b=tt.ctrl.store;re(t,b,M=>n(5,u=M));let y=M=>{let{from:D,to:R}=M.detail;if(D!==R&&D.type=="item"&&D.slot!==void 0&&R.slot!==void 0&&D.slot!==R.slot){if(xt("itemmove",`${D.slot} ${R.slot}`),D.slot>=101)return;D.item.stacks&&(D.item.stacks=""),D.item.moving=!0,R.item?(R.item.stacks&&(R.item.stacks=""),l[D.slot].set(R.item),R.item.moving=!0):l[D.slot]&&l[D.slot].set(void 0),l[R.slot].set(D.item)}},k=M=>{if(!M.detail.item||r)return;let D=[];if(o)D.push(nn.itemstash(M.detail.slot));else{if(M.detail.item.canEquip(V.player)){let R=M.detail.item.getBestEquipslot(V.player.inventory);R!==void 0&&D.push(nn.itemmove(M.detail.slot,R)),M.detail.item.logic.useSkill&&D.push(nn.itemuse(M.detail.slot,M.detail.item.logic.useSkill,M.detail.item.bound,M.detail.item.logic.bindOnUse))}i&&M.detail.item.canBeSold()&&D.push(nn.itemsell(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier)),M.detail.item.stacks>1&&(D.push(nn.itemsplithalf(M.detail.slot)),D.push(nn.itemsplitone(M.detail.slot))),D.push(nn.itemcopyid(M.detail.item.dbid)),M.detail.item.canBeDropped()&&D.push(nn.itemdrop(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier))}bn.set({x:M.detail.e.pageX-M.detail.e.layerX,y:M.detail.e.pageY+(46-M.detail.e.layerY),opts:D})},S=M=>{M.detail.item&&(o?xt("itemstash",`${M.detail.slot}`):s?(cs.set(M.detail.item),M.detail.item.type&&Mt(Ri[M.detail.item.type].sound)):i&&M.detail.item.canBeSold()?Uf(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier):M.detail.item.canBeDropped()&&A1(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier))};function A(){v=this.value,n(0,v)}return[v,l,a,c,f,u,m,g,_,b,y,k,S,A,M=>nt(ao,a=!1,a)]}var kg=class extends Me{constructor(e){super(),Ce(this,e,UD,BD,Ue,{})}},PM=kg;var wg={};Xn(wg,{add:()=>cd,init:()=>TM,onWorldEnter:()=>OD,tick:()=>$D,values:()=>ns});var ns=new Map,xg=new kt(0,.5),TM=()=>{ns.clear(),xg.reset(0)},OD=TM,$D=t=>{if(le.dpsmeterOpen&&xg.done(V.time))if(xg.reset(V.time),ns.forEach((e,n)=>{if(e.ooc){V.time-e.start>5&&ns.delete(n);return}!V.entity(e.id)||V.time-e.last>5?(e.ooc=!0,e.start=V.time):e.dps=Math.ceil(e.amount/Math.max(5,V.time-e.start))}),le.dpsmeterTarget){let e=ns.get(le.dpsmeterTarget);e?Rc.set(Array.from(e.skills).sort((n,i)=>i[1].amount-n[1].amount).map(n=>(n[1].dps=Math.ceil(n[1].amount/Math.max(5,V.time-n[1].start)),n)).slice(0,10)):Hr.set(0)}else Rc.set(Array.from(ns).sort((e,n)=>n[1].amount-e[1].amount).slice(0,10))},cd=(t,e,n)=>{if(t.name===void 0||!le.dpsmeterOpen||t.type!==0||le.dpsmeterParty&&(V.player.party===0&&t!==V.player||t.party!==V.player.party))return;let i;ns.has(t.name)?i=ns.get(t.name):(ns.set(t.name,i={}),i.amount=0,i.start=0,i.class=t.class,i.dps=0,i.id=t.id,i.ooc=!0,i.skills=new Map),i.ooc?(i.start=V.time,i.ooc=!1,i.amount=e):i.amount+=e;let s=C.items.book[n]?C.items.book[n].name:"Unknown";i.skills.has(s)||i.skills.set(s,{id:n,class:t.class,amount:0,start:V.time});let o=i.skills.get(s);o.amount+=e,i.last=V.time};function EM(t,e,n){let i=t.slice();return i[11]=e[n],i[13]=n,i}function DM(t){let e,n;return e=new Nt({props:{origin:"right bottom",title:t[5][t[1]],icon:"trophy",$$slots:{default:[ND]},$$scope:{ctx:t}}}),e.$on("close",t[10]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&2&&(o.title=i[5][i[1]]),s&16414&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function IM(t,e){let n,i,s,o,r;i=new vi({props:{size:"0.9em",fract:Math.round(100*e[11][1].amount/e[2][0][1].amount),barcol:"bgc"+e[11][1].class,left:`${e[13]+1}. ${e[11][0]}`,right:`${ni(e[11][1].amount)} (${ht(e[11][1].dps)})`}});function l(...a){return e[7](e[11],...a)}return{key:t,first:null,c(){n=h("div"),ne(i.$$.fragment),this.first=n},m(a,c){w(a,n,c),ee(i,n,null),s=!0,o||(r=Z(n,"click",l),o=!0)},p(a,c){e=a;let f={};c&4&&(f.fract=Math.round(100*e[11][1].amount/e[2][0][1].amount)),c&4&&(f.barcol="bgc"+e[11][1].class),c&4&&(f.left=`${e[13]+1}. ${e[11][0]}`),c&4&&(f.right=`${ni(e[11][1].amount)} (${ht(e[11][1].dps)})`),i.$set(f)},i(a){s||(P(i.$$.fragment,a),s=!0)},o(a){q(i.$$.fragment,a),s=!1},d(a){a&&x(n),te(i),o=!1,r()}}}function ND(t){let e,n=[],i=new Map,s,o,r=t[5][t[1]]+"",l,a,c,f,u,m,g,v,_=me(t[2]),b=y=>y[11][1].id;for(let y=0;y<_.length;y+=1){let k=EM(t,_,y),S=b(k);i.set(S,n[y]=IM(S,k))}return{c(){e=h("div");for(let y=0;y<n.length;y+=1)n[y].c();s=h("div"),o=h("div"),l=T(r),a=h("div"),c=T("Party"),u=h("div"),u.textContent=`${C.ui.reset}`,p(e,"class","wrapper svelte-hjyujf"),p(o,"class","btn grey"),p(a,"class",f="btn "+(t[4]?"grey active":"black textgrey")),p(u,"class","btn grey"),p(s,"class","grid buttons marg-top svelte-hjyujf"),ze(s,"grid-template-columns","2fr 1fr 1fr")},m(y,k){w(y,e,k);for(let S=0;S<n.length;S+=1)n[S]&&n[S].m(e,null);w(y,s,k),d(s,o),d(o,l),d(s,a),d(a,c),d(s,u),m=!0,g||(v=[Z(o,"click",t[6]),Z(a,"click",t[8]),Z(u,"click",t[9])],g=!0)},p(y,k){k&12&&(_=me(y[2]),Pe(),n=ui(n,k,b,1,y,_,i,e,Ii,IM,null,EM),Te()),(!m||k&2)&&r!==(r=y[5][y[1]]+"")&&G(l,r),(!m||k&16&&f!==(f="btn "+(y[4]?"grey active":"black textgrey")))&&p(a,"class",f)},i(y){if(!m){for(let k=0;k<_.length;k+=1)P(n[k]);m=!0}},o(y){for(let k=0;k<n.length;k+=1)q(n[k]);m=!1},d(y){y&&(x(e),x(s));for(let k=0;k<n.length;k+=1)n[k].d();g=!1,at(v)}}}function jD(t){let e,n,i=t[0]&&DM(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=DM(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function WD(t,e,n){let i,s,o,r,l;re(t,Gr,v=>n(0,i=v)),re(t,Kc,v=>n(1,s=v)),re(t,Rc,v=>n(2,o=v)),re(t,Hr,v=>n(3,r=v)),re(t,Jc,v=>n(4,l=v));let a=[C.ui.stats.misc.damage,C.ui.stats.misc.healing];return[i,s,o,r,l,a,v=>{bn.set({x:v.pageX,y:v.pageY-50,opts:a.map((_,b)=>({name:_,fun:()=>{Kc.set(b),ns.clear()}}))})},(v,_)=>{nt(Hr,r=r?0:v[0],r)},v=>nt(Jc,l=!l,l),v=>ns.clear(),v=>nt(Gr,i=!1,i)]}var Mg=class extends Me{constructor(e){super(),Ce(this,e,WD,jD,Ue,{})}},VM=Mg;function LM(t){let e,n=t[0].area+"",i,s,o,r;return{c(){e=h("p"),i=T(n),o=Ne(),p(e,"class","text location textgreen svelte-dujqu3")},m(l,a){w(l,e,a),d(e,i),w(l,o,a),r=!0},p(l,a){(!r||a&1)&&n!==(n=l[0].area+"")&&G(i,n)},i(l){r||(l&&_n(()=>{r&&(s||(s=hh(e,hm,{},!0)),s.run(1))}),r=!0)},o(l){l&&(s||(s=hh(e,hm,{},!1)),s.run(0)),r=!1},d(l){l&&(x(e),x(o)),l&&s&&s.end()}}}function qM(t){let e,n=t[0].error+"",i,s,o;return{c(){e=h("p"),i=T(n),p(e,"class","text error textred svelte-dujqu3")},m(r,l){w(r,e,l),d(e,i),o=!0},p(r,l){(!o||l&1)&&n!==(n=r[0].error+"")&&G(i,n)},i(r){o||(s&&s.end(1),o=!0)},o(r){r&&(s=e_(e,hm,{})),o=!1},d(r){r&&x(e),r&&s&&s.end()}}}function GD(t){let e,n,i=t[0].area&&LM(t),s=t[0].error&&qM(t);return{c(){e=h("div"),i&&i.c(),n=ve(),s&&s.c(),p(e,"class","l-ui")},m(o,r){w(o,e,r),i&&i.m(e,null),d(e,n),s&&s.m(e,null)},p(o,[r]){o[0].area?i?(i.p(o,r),r&1&&P(i,1)):(i=LM(o),i.c(),P(i,1),i.m(e,n)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te()),o[0].error?s?(s.p(o,r),r&1&&P(s,1)):(s=qM(o),s.c(),P(s,1),s.m(e,null)):s&&(Pe(),q(s,1,1,()=>{s=null}),Te())},i(o){P(i),P(s)},o(o){q(i),q(s)},d(o){o&&x(e),i&&i.d(),s&&s.d()}}}function HD(t,e,n){let i={},s={};return Cr.subscribe(o=>{n(0,i[o.type]=o.text,i),s[o.type]&&clearTimeout(s[o.type]),s[o.type]=setTimeout(()=>{n(0,i[o.type]=void 0,i)},o.time||1e3)}),[i]}var Fg=class extends Me{constructor(e){super(),Ce(this,e,HD,GD,Ue,{})}},RM=Fg;function zM(t,e,n){let i=t.slice();return i[3]=e[n],i}function BM(t){let e,n;return e=new Nt({props:{origin:"center",title:C.ui.headers.request,close:!1,$$slots:{default:[YD]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&65&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function UM(t){let e,n=t[3].text+"",i,s,o=(t[3].unavailable||"")+"",r,l,a=(t[3].additional||"")+"",c,f,u,m;function g(){return t[2](t[3])}return{c(){e=h("div"),i=T(n),s=Ne(),r=T(o),l=Ne(),c=T(a),p(e,"class",f="choice "+(t[3].unavailable?"unavailable textgrey":"")+" svelte-1uywqr8")},m(v,_){w(v,e,_),d(e,i),d(e,s),d(e,r),d(e,l),d(e,c),u||(m=Z(e,"click",g),u=!0)},p(v,_){t=v,_&1&&n!==(n=t[3].text+"")&&G(i,n),_&1&&o!==(o=(t[3].unavailable||"")+"")&&G(r,o),_&1&&a!==(a=(t[3].additional||"")+"")&&G(c,a),_&1&&f!==(f="choice "+(t[3].unavailable?"unavailable textgrey":"")+" svelte-1uywqr8")&&p(e,"class",f)},d(v){v&&x(e),u=!1,m()}}}function YD(t){let e,n,i=t[0][0].title+"",s,o,r=t[0][0].text+"",l=me(t[0][0].choices),a=[];for(let c=0;c<l.length;c+=1)a[c]=UM(zM(t,l,c));return{c(){e=h("div"),n=h("h3"),s=T(i),o=h("p");for(let c=0;c<a.length;c+=1)a[c].c();p(n,"class","textprimary"),p(e,"class","container svelte-1uywqr8")},m(c,f){w(c,e,f),d(e,n),d(n,s),d(e,o),o.innerHTML=r;for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(e,null)},p(c,f){if(f&1&&i!==(i=c[0][0].title+"")&&G(s,i),f&1&&r!==(r=c[0][0].text+"")&&(o.innerHTML=r),f&3){l=me(c[0][0].choices);let u;for(u=0;u<l.length;u+=1){let m=zM(c,l,u);a[u]?a[u].p(m,f):(a[u]=UM(m),a[u].c(),a[u].m(e,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=l.length}},d(c){c&&x(e),it(a,c)}}}function XD(t){let e,n,i=t[0].length&&BM(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[0].length?i?(i.p(s,o),o&1&&P(i,1)):(i=BM(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function QD(t,e,n){let i;re(t,so,r=>n(0,i=r));let s=async r=>{r&&await r(),Hh()};return[i,s,r=>{s(r.fun)}]}var Cg=class extends Me{constructor(e){super(),Ce(this,e,QD,XD,Ue,{})}},OM=Cg;function $M(t){let e,n,i=t[0][0].text+"",s,o,r=t[0][0].icon&&NM(t);return{c(){e=h("div"),r&&r.c(),n=h("div"),p(e,"class","notification panel-black border grey svelte-9nlpzp")},m(l,a){w(l,e,a),r&&r.m(e,null),d(e,n),n.innerHTML=i,s||(o=Z(e,"click",t[2]),s=!0)},p(l,a){l[0][0].icon?r?r.p(l,a):(r=NM(l),r.c(),r.m(e,n)):r&&(r.d(1),r=null),a&1&&i!==(i=l[0][0].text+"")&&(n.innerHTML=i)},d(l){l&&x(e),r&&r.d(),s=!1,o()}}}function NM(t){let e,n,i;return{c(){e=h("img"),p(e,"class",n="icon "+t[0][0].css+" svelte-9nlpzp"),lt(e.src,i="/data/ui/"+t[0][0].icon)||p(e,"src",i)},m(s,o){w(s,e,o)},p(s,o){o&1&&n!==(n="icon "+s[0][0].css+" svelte-9nlpzp")&&p(e,"class",n),o&1&&!lt(e.src,i="/data/ui/"+s[0][0].icon)&&p(e,"src",i)},d(s){s&&x(e)}}}function ZD(t){let e,n=t[0].length&&!t[1]&&$M(t);return{c(){n&&n.c(),e=ve()},m(i,s){n&&n.m(i,s),w(i,e,s)},p(i,[s]){i[0].length&&!i[1]?n?n.p(i,s):(n=$M(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ue,o:ue,d(i){i&&x(e),n&&n.d(i)}}}function JD(t,e,n){let i,s;return re(t,Ec,r=>n(0,i=r)),re(t,xi,r=>n(1,s=r)),[i,s,()=>{Ec.update(r=>(r.shift(),r))}]}var Sg=class extends Me{constructor(e){super(),Ce(this,e,JD,ZD,Ue,{})}},jM=Sg;function WM(t,e,n){let i=t.slice();return i[5]=e[n],i}function GM(t){let e,n;return{c(){e=h("div"),n=T(t[0]),p(e,"class","btn border grey")},m(i,s){w(i,e,s),d(e,n)},p(i,s){s&1&&G(n,i[0])},d(i){i&&x(e)}}}function HM(t){let e,n,i,s,o,r;function l(...c){return t[2](t[5],...c)}function a(...c){return t[4](t[5],...c)}return{c(){e=h("div"),n=h("img"),p(n,"class","svgicon"),lt(n.src,i="/data/ui/icons/"+t[5].img+".svg?v=8588529")||p(n,"src",i),p(e,"id",s="sys"+t[5].img),p(e,"class","btn border black")},m(c,f){w(c,e,f),d(e,n),o||(r=[Z(e,"mouseenter",l),Z(e,"mouseleave",t[3]),Z(e,"click",a)],o=!0)},p(c,f){t=c},d(c){c&&x(e),o=!1,at(r)}}}function KD(t){let e,n,i=t[0]!==""&&GM(t),s=me(t[1]),o=[];for(let r=0;r<s.length;r+=1)o[r]=HM(WM(t,s,r));return{c(){e=h("div"),i&&i.c(),n=ve();for(let r=0;r<o.length;r+=1)o[r].c();p(e,"class","btnbar svelte-133q4bd")},m(r,l){w(r,e,l),i&&i.m(e,null),d(e,n);for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(e,null)},p(r,[l]){if(r[0]!==""?i?i.p(r,l):(i=GM(r),i.c(),i.m(e,n)):i&&(i.d(1),i=null),l&3){s=me(r[1]);let a;for(a=0;a<s.length;a+=1){let c=WM(r,s,a);o[a]?o[a].p(c,l):(o[a]=HM(c),o[a].c(),o[a].m(e,null))}for(;a<o.length;a+=1)o[a].d(1);o.length=s.length}},i:ue,o:ue,d(r){r&&x(e),i&&i.d(),it(o,r)}}}function eI(t,e,n){let i=[{img:"gem",desc:C.ui.elixir.subscription,store:Li},{img:"char",desc:C.ui.headers.character,store:mo},{img:"book",desc:C.ui.headers.skills,store:co},{img:"bag",desc:C.ui.inventory.name,store:ao},{img:"pvp",desc:C.ui.headers.pvp,store:uo},{img:"clan",desc:C.ui.clan.heading,store:fo},{img:"trophy",desc:C.ui.headers.dpsMeter,store:Gr},{img:"cog",desc:C.ui.settings.name,store:Wr},{img:"fullscreen",desc:C.ui.headers.fullscreen,fun:async()=>{"keyboard"in navigator&&"lock"in navigator.keyboard&&await navigator.keyboard.lock(["Escape"]),document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}},{img:"back",desc:C.ui.headers.menuReturn,fun:()=>{document.location.href="/"}}],s="";return[s,i,(a,c)=>n(0,s=a.desc),a=>n(0,s=""),(a,c)=>{a.fun?a.fun():a.store.update(f=>!f)}]}var Ag=class extends Me{constructor(e){super(),Ce(this,e,eI,KD,Ue,{})}},YM=Ag;function tI(t){let e,n,i,s;return{c(){e=h("div"),p(e,"class",n="btn checkbox "+(t[2]?"active":""))},m(o,r){w(o,e,r),i||(s=Z(e,"click",t[3]),i=!0)},p(o,[r]){r&4&&n!==(n="btn checkbox "+(o[2]?"active":""))&&p(e,"class",n)},i:ue,o:ue,d(o){o&&x(e),i=!1,s()}}}function nI(t,e,n){let i,s=ue,o=()=>(s(),s=ls(r,c=>n(2,i=c)),r);t.$$.on_destroy.push(()=>s());let{store:r}=e;o();let{cb:l}=e,a=c=>{nt(r,i=!i,i),l&&l(i)};return t.$$set=c=>{"store"in c&&o(n(0,r=c.store)),"cb"in c&&n(1,l=c.cb)},[r,l,i,a]}var Pg=class extends Me{constructor(e){super(),Ce(this,e,nI,tI,Ue,{store:0,cb:1})}},Bt=Pg;function XM(t,e,n){let i=t.slice();return i[76]=e[n],i[78]=n,i}function QM(t,e,n){let i=t.slice();return i[73]=e[n],i}function ZM(t,e,n){let i=t.slice();return i[70]=e[n],i[71]=e,i[72]=n,i}function JM(t,e,n){let i=t.slice();return i[79]=e[n],i}function KM(t){let e,n;return e=new Nt({props:{title:C.ui.settings.name,origin:"center",icon:"cog",$$slots:{default:[aI]},$$scope:{ctx:t}}}),e.$on("close",t[68]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s[0]&2147483626|s[1]&1|s[2]&1048576&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function e6(t){let e,n=t[79].name+"",i,s,o,r;function l(...a){return t[36](t[79],...a)}return{c(){e=h("div"),i=T(n),p(e,"class",s="choice "+(t[79]==t[1]?"active":""))},m(a,c){w(a,e,c),d(e,i),o||(r=Z(e,"click",l),o=!0)},p(a,c){t=a,c[0]&2&&s!==(s="choice "+(t[79]==t[1]?"active":""))&&p(e,"class",s)},d(a){a&&x(e),o=!1,r()}}}function iI(t){let e,n,i,s,o,r;n=new Bt({props:{store:Hm}});let l=me(C.ui.chat.types),a=[];for(let c=0;c<l.length;c+=1)a[c]=t6(XM(t,l,c));return{c(){e=h("div"),e.textContent=`${C.ui.settings.chatbubbles}`,ne(n.$$.fragment),i=h("div"),i.textContent=`${C.ui.settings.combatlog}`,s=h("div");for(let c=0;c<a.length;c+=1)a[c].c();o=ve(),p(i,"class","textprimary")},m(c,f){w(c,e,f),ee(n,c,f),w(c,i,f),w(c,s,f);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(c,f);w(c,o,f),r=!0},p(c,f){if(f[1]&1){l=me(C.ui.chat.types);let u;for(u=0;u<l.length;u+=1){let m=XM(c,l,u);a[u]?a[u].p(m,f):(a[u]=t6(m),a[u].c(),a[u].m(o.parentNode,o))}for(;u<a.length;u+=1)a[u].d(1);a.length=l.length}},i(c){r||(P(n.$$.fragment,c),r=!0)},o(c){q(n.$$.fragment,c),r=!1},d(c){c&&(x(e),x(i),x(s),x(o)),te(n,c),it(a,c)}}}function sI(t){let e,n=C.ui.settings.language+"",i,s,o,r,l,a,c,f,u,m,g,v,_,b,y,k,S,A,F,M,D,R,E,L,B,I,N,j,W,O,se,X,oe,ce,xe,pe,$e,Ee,Fe,_e,H,Le,Oe=C.ui.settings.qualitymin+"",He,Ye,Ze,ge,ae,Be,J,Q=C.ui.settings.excludedrops+"",U,fe,je,Ie,ye,qe,Re,pt,wt,Qe,Et,be,Je,yt,St,Ae,ft,Ut=C.ui.settings.skillcdtext+"",Ve,Ct,Vt,We,Ke,we,ot,Xe,ut,xn=C.ui.settings.flashinterval+"",Fs,li,Di,dt=t[22].toFixed(1)+"",Lt,Cs,jn,ai,vc=C.ui.settings.flashduration+"",xr,Po,Ss,mn=t[23].toFixed(1)+"",zt,Kt,ci,Eu,As,Du,Ps,Iu,Dl,_c,Z0,Vu,Il,Lu,Vl,qu,Ts,bc,J0,Ru,Ll,zu,ql,yc,K0,Rl,PP=C.ui.settings.protectedquality+"",A2,P2,kc,eh,T2,Es,zl,TP=C.ui.settings.invwidth+"",E2,D2,Bu,th,Ds,xc,nh,Bl,EP=C.ui.settings.stashwidth+"",I2,V2,Uu,ih,Is,Ul,DP=C.ui.settings.stashheight+"",L2,q2,Ou,sh,Vs,wc,oh,$u,Ol,rs,rh,R2,$l=me(t[33]),fi=[];for(let K=0;K<$l.length;K+=1)fi[K]=n6(QM(t,$l,K));return y=new Bt({props:{store:da}}),D=new Bt({props:{store:Lm}}),E=new Bt({props:{store:zm}}),B=new Bt({props:{store:qm}}),N=new Bt({props:{store:Bm}}),W=new Bt({props:{store:Rm}}),se=new Bt({props:{store:Um}}),oe=new Bt({props:{store:$m}}),xe=new Bt({props:{store:jm}}),$e=new Bt({props:{store:Om}}),H=new Bt({props:{store:Zm}}),pt=new Bt({props:{store:Xm}}),Qe=new Bt({props:{store:Ym}}),be=new Bt({props:{store:Qm}}),yt=new Bt({props:{store:Nm}}),We=new Bt({props:{store:Jm,cb:t[34]}}),we=new Bt({props:{store:Km}}),Xe=new Bt({props:{store:np}}),Dl=new Bt({props:{store:ep}}),Il=new Bt({props:{store:tp}}),Vl=new Bt({props:{store:ha}}),Ll=new Bt({props:{store:Wm}}),ql=new Bt({props:{store:Gm}}),Ol=new Bt({props:{store:pa}}),{c(){e=h("div"),i=T(n),s=Ne(),o=h("br"),r=h("small"),r.textContent=`${C.ui.settings.reload}`,l=h("select");for(let K=0;K<fi.length;K+=1)fi[K].c();a=h("div"),a.textContent=`${C.ui.settings.tutorial}`,c=h("div"),f=h("div"),f.textContent=`${C.ui.reset}`,u=h("div"),u.textContent=`${C.ui.settings.resettutorial}`,m=h("div"),m.textContent=`${C.ui.disable}`,g=h("div"),g.textContent=`${C.ui.settings.disabletutorial}`,v=h("div"),v.textContent=`${C.ui.settings.fpsping}`,_=h("div"),b=h("div"),b.textContent=`${C.ui.settings.showfps}`,ne(y.$$.fragment),k=h("div"),k.textContent=`${C.ui.settings.nameplates}`,S=h("div"),A=h("div"),A.textContent=`${C.ui.settings.drawrange}`,F=h("input"),M=h("div"),M.textContent=`${C.ui.settings.monsterbars}`,ne(D.$$.fragment),R=h("div"),R.textContent=`${C.ui.settings.monsternames}`,ne(E.$$.fragment),L=h("div"),L.textContent=`${C.ui.settings.friendlyplayerbars}`,ne(B.$$.fragment),I=h("div"),I.textContent=`${C.ui.settings.friendlyplayernames}`,ne(N.$$.fragment),j=h("div"),j.textContent=`${C.ui.settings.enemyplayerbars}`,ne(W.$$.fragment),O=h("div"),O.textContent=`${C.ui.settings.enemyplayernames}`,ne(se.$$.fragment),X=h("div"),X.textContent=`${C.ui.settings.showlevel}`,ne(oe.$$.fragment),ce=h("div"),ce.textContent=`${C.ui.settings.classcolors}`,ne(xe.$$.fragment),pe=h("div"),pe.textContent=`${C.ui.settings.transparency}`,ne($e.$$.fragment),Ee=h("div"),Ee.textContent=`${C.ui.settings.drops}`,Fe=h("div"),_e=h("div"),_e.textContent=`${C.ui.settings.showquality}`,ne(H.$$.fragment),Le=h("div"),He=T(Oe),Ye=h("br"),Ze=h("small"),ge=T(t[20]),ae=T("%"),Be=h("input"),J=h("div"),U=T(Q),fe=h("br"),je=h("small"),je.textContent=`${C.ui.settings.reload}`,Ie=h("input"),ye=h("div"),ye.textContent=`${C.ui.settings.damagehealing}`,qe=h("div"),Re=h("div"),Re.textContent=`${C.ui.settings.incomingdamage}`,ne(pt.$$.fragment),wt=h("div"),wt.textContent=`${C.ui.settings.incominghealing}`,ne(Qe.$$.fragment),Et=h("div"),Et.textContent=`${C.ui.settings.incomingmana}`,ne(be.$$.fragment),Je=h("div"),Je.textContent=`${C.ui.settings.preventoverlap}`,ne(yt.$$.fragment),St=h("div"),St.textContent=`${C.ui.settings.icons}`,Ae=h("div"),ft=h("div"),Ve=T(Ut),Ct=h("br"),Vt=h("small"),Vt.textContent=`${C.ui.settings.reload}`,ne(We.$$.fragment),Ke=h("div"),Ke.textContent=`${C.ui.settings.buffcdtext}`,ne(we.$$.fragment),ot=h("div"),ot.textContent=`${C.ui.settings.selfbuffsonly}`,ne(Xe.$$.fragment),ut=h("div"),Fs=T(xn),li=h("br"),Di=h("small"),Lt=T(dt),Cs=T("s"),jn=h("input"),ai=h("div"),xr=T(vc),Po=h("br"),Ss=h("small"),zt=T(mn),Kt=T("s"),ci=h("input"),Eu=h("div"),Eu.textContent=`${C.ui.settings.buffmax}`,As=h("input"),Du=h("div"),Du.textContent=`${C.ui.settings.buffmaxparty}`,Ps=h("input"),Iu=h("div"),Iu.textContent=`${C.ui.settings.updateratelimit}`,ne(Dl.$$.fragment),_c=h("div"),_c.textContent=`${C.ui.settings.unitframes}`,Z0=h("div"),Vu=h("div"),Vu.textContent=`${C.ui.settings.showselfparty}`,ne(Il.$$.fragment),Lu=h("div"),Lu.textContent=`${C.ui.settings.partymana}`,ne(Vl.$$.fragment),qu=h("div"),qu.textContent=`${C.ui.settings.partyframewidth}`,Ts=h("input"),bc=h("div"),bc.textContent=`${C.ui.settings.map}`,J0=h("div"),Ru=h("div"),Ru.textContent=`${C.ui.settings.mapshowmonsters}`,ne(Ll.$$.fragment),zu=h("div"),zu.textContent=`${C.ui.settings.maplowqual}`,ne(ql.$$.fragment),yc=h("div"),yc.textContent=`${C.ui.inventory.name}`,K0=h("div"),Rl=h("div"),A2=T(PP),P2=h("br"),kc=h("small"),eh=T(t[27]),T2=T("%"),Es=h("input"),zl=h("div"),E2=T(TP),D2=h("br"),Bu=h("small"),th=T(t[28]),Ds=h("input"),xc=h("div"),xc.textContent=`${C.ui.stash.name}`,nh=h("div"),Bl=h("div"),I2=T(EP),V2=h("br"),Uu=h("small"),ih=T(t[29]),Is=h("input"),Ul=h("div"),L2=T(DP),q2=h("br"),Ou=h("small"),sh=T(t[30]),Vs=h("input"),wc=h("div"),wc.textContent="Social",oh=h("div"),$u=h("div"),$u.textContent="Twitch Streams",ne(Ol.$$.fragment),p(r,"class","textgrey"),t[18]===void 0&&_n(()=>t[52].call(l)),p(a,"class","textprimary"),p(u,"class","btn blue"),p(g,"class","btn orange"),p(v,"class","textprimary"),p(k,"class","textprimary"),p(F,"type","range"),p(Ee,"class","textprimary"),p(Ze,"class","textgrey"),p(Be,"type","range"),p(Be,"min","0"),p(Be,"max","100"),p(je,"class","textgrey"),p(Ie,"type","text"),p(Ie,"placeholder","misc, gold, ..."),p(ye,"class","textprimary"),p(St,"class","textprimary"),p(Vt,"class","textgrey"),p(Di,"class","textgrey"),p(jn,"type","range"),p(jn,"min","0"),p(jn,"max","1"),p(jn,"step","0.1"),p(Ss,"class","textgrey"),p(ci,"type","range"),p(ci,"min","0"),p(ci,"max","5"),p(ci,"step","0.1"),p(As,"placeholder","14"),p(As,"type","number"),p(As,"min","0"),p(Ps,"placeholder","8"),p(Ps,"type","number"),p(Ps,"min","0"),p(_c,"class","textprimary"),p(Ts,"type","range"),p(Ts,"min","50"),p(Ts,"max","400"),p(bc,"class","textprimary"),p(yc,"class","textprimary"),p(kc,"class","textgrey"),p(Es,"type","range"),p(Es,"min","0"),p(Es,"max","110"),p(Bu,"class","textgrey"),p(Ds,"type","range"),p(Ds,"min","4"),p(Ds,"max","10"),p(xc,"class","textprimary"),p(Uu,"class","textgrey"),p(Is,"type","range"),p(Is,"min","6"),p(Is,"max","20"),p(Ou,"class","textgrey"),p(Vs,"type","range"),p(Vs,"min","50"),p(Vs,"max","500"),p(wc,"class","textprimary")},m(K,Se){w(K,e,Se),d(e,i),d(e,s),d(e,o),d(e,r),w(K,l,Se);for(let Wn=0;Wn<fi.length;Wn+=1)fi[Wn]&&fi[Wn].m(l,null);wn(l,t[18],!0),w(K,a,Se),w(K,c,Se),w(K,f,Se),w(K,u,Se),w(K,m,Se),w(K,g,Se),w(K,v,Se),w(K,_,Se),w(K,b,Se),ee(y,K,Se),w(K,k,Se),w(K,S,Se),w(K,A,Se),w(K,F,Se),Ge(F,t[19]),w(K,M,Se),ee(D,K,Se),w(K,R,Se),ee(E,K,Se),w(K,L,Se),ee(B,K,Se),w(K,I,Se),ee(N,K,Se),w(K,j,Se),ee(W,K,Se),w(K,O,Se),ee(se,K,Se),w(K,X,Se),ee(oe,K,Se),w(K,ce,Se),ee(xe,K,Se),w(K,pe,Se),ee($e,K,Se),w(K,Ee,Se),w(K,Fe,Se),w(K,_e,Se),ee(H,K,Se),w(K,Le,Se),d(Le,He),d(Le,Ye),d(Le,Ze),d(Ze,ge),d(Ze,ae),w(K,Be,Se),Ge(Be,t[20]),w(K,J,Se),d(J,U),d(J,fe),d(J,je),w(K,Ie,Se),Ge(Ie,t[21]),w(K,ye,Se),w(K,qe,Se),w(K,Re,Se),ee(pt,K,Se),w(K,wt,Se),ee(Qe,K,Se),w(K,Et,Se),ee(be,K,Se),w(K,Je,Se),ee(yt,K,Se),w(K,St,Se),w(K,Ae,Se),w(K,ft,Se),d(ft,Ve),d(ft,Ct),d(ft,Vt),ee(We,K,Se),w(K,Ke,Se),ee(we,K,Se),w(K,ot,Se),ee(Xe,K,Se),w(K,ut,Se),d(ut,Fs),d(ut,li),d(ut,Di),d(Di,Lt),d(Di,Cs),w(K,jn,Se),Ge(jn,t[22]),w(K,ai,Se),d(ai,xr),d(ai,Po),d(ai,Ss),d(Ss,zt),d(Ss,Kt),w(K,ci,Se),Ge(ci,t[23]),w(K,Eu,Se),w(K,As,Se),Ge(As,t[24]),w(K,Du,Se),w(K,Ps,Se),Ge(Ps,t[25]),w(K,Iu,Se),ee(Dl,K,Se),w(K,_c,Se),w(K,Z0,Se),w(K,Vu,Se),ee(Il,K,Se),w(K,Lu,Se),ee(Vl,K,Se),w(K,qu,Se),w(K,Ts,Se),Ge(Ts,t[26]),w(K,bc,Se),w(K,J0,Se),w(K,Ru,Se),ee(Ll,K,Se),w(K,zu,Se),ee(ql,K,Se),w(K,yc,Se),w(K,K0,Se),w(K,Rl,Se),d(Rl,A2),d(Rl,P2),d(Rl,kc),d(kc,eh),d(kc,T2),w(K,Es,Se),Ge(Es,t[27]),w(K,zl,Se),d(zl,E2),d(zl,D2),d(zl,Bu),d(Bu,th),w(K,Ds,Se),Ge(Ds,t[28]),w(K,xc,Se),w(K,nh,Se),w(K,Bl,Se),d(Bl,I2),d(Bl,V2),d(Bl,Uu),d(Uu,ih),w(K,Is,Se),Ge(Is,t[29]),w(K,Ul,Se),d(Ul,L2),d(Ul,q2),d(Ul,Ou),d(Ou,sh),w(K,Vs,Se),Ge(Vs,t[30]),w(K,wc,Se),w(K,oh,Se),w(K,$u,Se),ee(Ol,K,Se),rs=!0,rh||(R2=[Z(l,"change",t[52]),Z(l,"change",t[34]),Z(u,"click",t[53]),Z(g,"click",t[54]),Z(F,"change",t[55]),Z(F,"input",t[55]),Z(Be,"change",t[56]),Z(Be,"input",t[56]),Z(Be,"change",t[34]),Z(Ie,"input",t[57]),Z(Ie,"change",t[34]),Z(jn,"change",t[58]),Z(jn,"input",t[58]),Z(ci,"change",t[59]),Z(ci,"input",t[59]),Z(As,"input",t[60]),Z(Ps,"input",t[61]),Z(Ts,"change",t[62]),Z(Ts,"input",t[62]),Z(Es,"change",t[63]),Z(Es,"input",t[63]),Z(Ds,"change",t[64]),Z(Ds,"input",t[64]),Z(Is,"change",t[65]),Z(Is,"input",t[65]),Z(Vs,"change",t[66]),Z(Vs,"input",t[66])],rh=!0)},p(K,Se){if(Se[1]&4){$l=me(K[33]);let Wn;for(Wn=0;Wn<$l.length;Wn+=1){let z2=QM(K,$l,Wn);fi[Wn]?fi[Wn].p(z2,Se):(fi[Wn]=n6(z2),fi[Wn].c(),fi[Wn].m(l,null))}for(;Wn<fi.length;Wn+=1)fi[Wn].d(1);fi.length=$l.length}Se[0]&262144|Se[1]&4&&wn(l,K[18]),Se[0]&524288&&Ge(F,K[19]),(!rs||Se[0]&1048576)&&G(ge,K[20]),Se[0]&1048576&&Ge(Be,K[20]),Se[0]&2097152&&Ie.value!==K[21]&&Ge(Ie,K[21]),(!rs||Se[0]&4194304)&&dt!==(dt=K[22].toFixed(1)+"")&&G(Lt,dt),Se[0]&4194304&&Ge(jn,K[22]),(!rs||Se[0]&8388608)&&mn!==(mn=K[23].toFixed(1)+"")&&G(zt,mn),Se[0]&8388608&&Ge(ci,K[23]),Se[0]&16777216&&Wt(As.value)!==K[24]&&Ge(As,K[24]),Se[0]&33554432&&Wt(Ps.value)!==K[25]&&Ge(Ps,K[25]),Se[0]&67108864&&Ge(Ts,K[26]),(!rs||Se[0]&134217728)&&G(eh,K[27]),Se[0]&134217728&&Ge(Es,K[27]),(!rs||Se[0]&268435456)&&G(th,K[28]),Se[0]&268435456&&Ge(Ds,K[28]),(!rs||Se[0]&536870912)&&G(ih,K[29]),Se[0]&536870912&&Ge(Is,K[29]),(!rs||Se[0]&1073741824)&&G(sh,K[30]),Se[0]&1073741824&&Ge(Vs,K[30])},i(K){rs||(P(y.$$.fragment,K),P(D.$$.fragment,K),P(E.$$.fragment,K),P(B.$$.fragment,K),P(N.$$.fragment,K),P(W.$$.fragment,K),P(se.$$.fragment,K),P(oe.$$.fragment,K),P(xe.$$.fragment,K),P($e.$$.fragment,K),P(H.$$.fragment,K),P(pt.$$.fragment,K),P(Qe.$$.fragment,K),P(be.$$.fragment,K),P(yt.$$.fragment,K),P(We.$$.fragment,K),P(we.$$.fragment,K),P(Xe.$$.fragment,K),P(Dl.$$.fragment,K),P(Il.$$.fragment,K),P(Vl.$$.fragment,K),P(Ll.$$.fragment,K),P(ql.$$.fragment,K),P(Ol.$$.fragment,K),rs=!0)},o(K){q(y.$$.fragment,K),q(D.$$.fragment,K),q(E.$$.fragment,K),q(B.$$.fragment,K),q(N.$$.fragment,K),q(W.$$.fragment,K),q(se.$$.fragment,K),q(oe.$$.fragment,K),q(xe.$$.fragment,K),q($e.$$.fragment,K),q(H.$$.fragment,K),q(pt.$$.fragment,K),q(Qe.$$.fragment,K),q(be.$$.fragment,K),q(yt.$$.fragment,K),q(We.$$.fragment,K),q(we.$$.fragment,K),q(Xe.$$.fragment,K),q(Dl.$$.fragment,K),q(Il.$$.fragment,K),q(Vl.$$.fragment,K),q(Ll.$$.fragment,K),q(ql.$$.fragment,K),q(Ol.$$.fragment,K),rs=!1},d(K){K&&(x(e),x(l),x(a),x(c),x(f),x(u),x(m),x(g),x(v),x(_),x(b),x(k),x(S),x(A),x(F),x(M),x(R),x(L),x(I),x(j),x(O),x(X),x(ce),x(pe),x(Ee),x(Fe),x(_e),x(Le),x(Be),x(J),x(Ie),x(ye),x(qe),x(Re),x(wt),x(Et),x(Je),x(St),x(Ae),x(ft),x(Ke),x(ot),x(ut),x(jn),x(ai),x(ci),x(Eu),x(As),x(Du),x(Ps),x(Iu),x(_c),x(Z0),x(Vu),x(Lu),x(qu),x(Ts),x(bc),x(J0),x(Ru),x(zu),x(yc),x(K0),x(Rl),x(Es),x(zl),x(Ds),x(xc),x(nh),x(Bl),x(Is),x(Ul),x(Vs),x(wc),x(oh),x($u)),it(fi,K),te(y,K),te(D,K),te(E,K),te(B,K),te(N,K),te(W,K),te(se,K),te(oe,K),te(xe,K),te($e,K),te(H,K),te(pt,K),te(Qe,K),te(be,K),te(yt,K),te(We,K),te(we,K),te(Xe,K),te(Dl,K),te(Il,K),te(Vl,K),te(Ll,K),te(ql,K),te(Ol,K),rh=!1,at(R2)}}}function oI(t){let e,n,i,s=C.ui.settings.sfxmultiplier+"",o,r,l,a,c,f,u,m,g,v;return{c(){e=h("div"),e.textContent=`${C.ui.settings.sfxvolume}`,n=h("input"),i=h("div"),o=T(s),r=h("br"),l=h("small"),l.textContent=`${C.ui.settings.multiplierdesc}`,a=h("input"),c=h("div"),c.textContent=`${C.ui.settings.musicvolume}`,f=h("input"),u=h("div"),u.textContent=`${C.ui.settings.ambiencevolume}`,m=h("input"),p(n,"type","range"),p(l,"class","textgrey"),p(a,"type","range"),p(f,"type","range"),p(m,"type","range")},m(_,b){w(_,e,b),w(_,n,b),Ge(n,t[14]),w(_,i,b),d(i,o),d(i,r),d(i,l),w(_,a,b),Ge(a,t[15]),w(_,c,b),w(_,f,b),Ge(f,t[16]),w(_,u,b),w(_,m,b),Ge(m,t[17]),g||(v=[Z(n,"change",t[48]),Z(n,"input",t[48]),Z(a,"change",t[49]),Z(a,"input",t[49]),Z(f,"change",t[50]),Z(f,"input",t[50]),Z(m,"change",t[51]),Z(m,"input",t[51])],g=!0)},p(_,b){b[0]&16384&&Ge(n,_[14]),b[0]&32768&&Ge(a,_[15]),b[0]&65536&&Ge(f,_[16]),b[0]&131072&&Ge(m,_[17])},i:ue,o:ue,d(_){_&&(x(e),x(n),x(i),x(a),x(c),x(f),x(u),x(m)),g=!1,at(v)}}}function rI(t){let e,n,i,s=C.ui.settings.mousesensitivity+"",o,r,l,a=t[11].toFixed(2)+"",c,f,u,m,g,v,_,b,y,k,S,A,F,M=C.ui.settings.skillbarslots+"",D,R,E,L,B,I,N,j,W,O,se,X,oe,ce,xe,pe,$e,Ee,Fe,_e,H,Le,Oe,He;m=new Bt({props:{store:ip}}),v=new Bt({props:{store:sp}}),b=new Bt({props:{store:op}}),k=new Bt({props:{store:rp}}),se=new Bt({props:{store:lp}});let Ye=me(t[3]),Ze=[];for(let ge=0;ge<Ye.length;ge+=1)Ze[ge]=i6(ZM(t,Ye,ge));return{c(){e=h("div"),e.textContent=`${C.ui.settings.camera}`,n=h("div"),i=h("div"),o=T(s),r=Ne(),l=h("span"),c=T(a),f=h("input"),u=h("div"),u.textContent=`${C.ui.settings.invertmousex}`,ne(m.$$.fragment),g=h("div"),g.textContent=`${C.ui.settings.invertmousey}`,ne(v.$$.fragment),_=h("div"),_.textContent=`${C.ui.settings.lockedcamera}`,ne(b.$$.fragment),y=h("div"),y.textContent=`${C.ui.settings.pointerlock}`,ne(k.$$.fragment),S=h("div"),S.textContent=`${C.ui.settings.skillbar}`,A=h("div"),F=h("div"),D=T(M),R=Ne(),E=h("span"),L=T(t[12]),B=h("br"),I=h("small"),I.textContent=`${C.ui.settings.reload}`,N=h("input"),j=h("div"),j.textContent="Targeting",W=h("div"),O=h("div"),O.textContent="Target Next Friendly: Allow Non-Partied",ne(se.$$.fragment),X=h("div"),oe=T("Target Next Friendly: Cycle Size "),ce=h("span"),xe=T(t[13]),pe=h("input"),$e=h("div"),$e.textContent=`${C.ui.settings.keybindings}`,Ee=h("div"),Fe=h("small"),Fe.textContent=`${C.ui.settings.reload}`,_e=h("small"),_e.textContent=`${C.ui.settings.bindingreset}`;for(let ge=0;ge<Ze.length;ge+=1)Ze[ge].c();H=ve(),p(e,"class","textprimary"),p(l,"class","textgrey"),p(f,"type","range"),p(f,"step","0.05"),p(f,"min","0.1"),p(f,"max","3"),p(S,"class","textprimary"),p(E,"class","textgrey"),p(I,"class","textgrey"),p(N,"type","range"),p(N,"min","10"),p(N,"max","24"),p(j,"class","textprimary"),p(ce,"class","textgrey"),p(pe,"type","range"),p(pe,"min","1"),p(pe,"max","10"),p($e,"class","textprimary"),p(Fe,"class","textgrey"),p(_e,"class","textprimary")},m(ge,ae){w(ge,e,ae),w(ge,n,ae),w(ge,i,ae),d(i,o),d(i,r),d(i,l),d(l,c),w(ge,f,ae),Ge(f,t[11]),w(ge,u,ae),ee(m,ge,ae),w(ge,g,ae),ee(v,ge,ae),w(ge,_,ae),ee(b,ge,ae),w(ge,y,ae),ee(k,ge,ae),w(ge,S,ae),w(ge,A,ae),w(ge,F,ae),d(F,D),d(F,R),d(F,E),d(E,L),d(F,B),d(F,I),w(ge,N,ae),Ge(N,t[12]),w(ge,j,ae),w(ge,W,ae),w(ge,O,ae),ee(se,ge,ae),w(ge,X,ae),d(X,oe),d(X,ce),d(ce,xe),w(ge,pe,ae),Ge(pe,t[13]),w(ge,$e,ae),w(ge,Ee,ae),w(ge,Fe,ae),w(ge,_e,ae);for(let Be=0;Be<Ze.length;Be+=1)Ze[Be]&&Ze[Be].m(ge,ae);w(ge,H,ae),Le=!0,Oe||(He=[Z(f,"change",t[43]),Z(f,"input",t[43]),Z(N,"change",t[44]),Z(N,"input",t[44]),Z(N,"change",t[34]),Z(pe,"change",t[45]),Z(pe,"input",t[45])],Oe=!0)},p(ge,ae){if((!Le||ae[0]&2048)&&a!==(a=ge[11].toFixed(2)+"")&&G(c,a),ae[0]&2048&&Ge(f,ge[11]),(!Le||ae[0]&4096)&&G(L,ge[12]),ae[0]&4096&&Ge(N,ge[12]),(!Le||ae[0]&8192)&&G(xe,ge[13]),ae[0]&8192&&Ge(pe,ge[13]),ae[0]&8|ae[1]&16){Ye=me(ge[3]);let Be;for(Be=0;Be<Ye.length;Be+=1){let J=ZM(ge,Ye,Be);Ze[Be]?Ze[Be].p(J,ae):(Ze[Be]=i6(J),Ze[Be].c(),Ze[Be].m(H.parentNode,H))}for(;Be<Ze.length;Be+=1)Ze[Be].d(1);Ze.length=Ye.length}},i(ge){Le||(P(m.$$.fragment,ge),P(v.$$.fragment,ge),P(b.$$.fragment,ge),P(k.$$.fragment,ge),P(se.$$.fragment,ge),Le=!0)},o(ge){q(m.$$.fragment,ge),q(v.$$.fragment,ge),q(b.$$.fragment,ge),q(k.$$.fragment,ge),q(se.$$.fragment,ge),Le=!1},d(ge){ge&&(x(e),x(n),x(i),x(f),x(u),x(g),x(_),x(y),x(S),x(A),x(F),x(N),x(j),x(W),x(O),x(X),x(pe),x($e),x(Ee),x(Fe),x(_e),x(H)),te(m,ge),te(v,ge),te(b,ge),te(k,ge),te(se,ge),it(Ze,ge),Oe=!1,at(He)}}}function lI(t){let e,n,i,s,o,r=C.ui.settings.fov+"",l,a,c,f,u,m,g=C.ui.settings.anisotropy+"",v,_,b,y,k,S=C.ui.settings.grass+"",A,F,M,D,R,E,L,B,I,N=C.ui.settings.disableoffscreen+"",j,W,O,se,X,oe,ce,xe,pe,$e,Ee,Fe=C.ui.settings.shadows+"",_e,H,Le,Oe,He,Ye=C.ui.settings.shadowresolution+"",Ze,ge,ae,Be,J,Q,U;return E=new Bt({props:{store:Am}}),B=new Bt({props:{store:Em}}),se=new Bt({props:{store:Pm}}),oe=new Bt({props:{store:Dm}}),xe=new Bt({props:{cb:t[34],store:Im}}),Oe=new Bt({props:{cb:t[34],store:Tm}}),{c(){e=h("div"),e.textContent=`${C.ui.settings.resolution}`,n=h("input"),i=h("div"),i.textContent=`${C.ui.settings.viewrange}`,s=h("input"),o=h("div"),l=T(r),a=Ne(),c=h("span"),f=T(t[7]),u=h("input"),m=h("div"),v=T(g),_=h("br"),b=h("small"),b.textContent=`${C.ui.settings.reload}`,y=h("input"),k=h("div"),A=T(S),F=h("br"),M=h("small"),M.textContent=`${C.ui.settings.reload}`,D=h("input"),R=h("div"),R.textContent=`${C.ui.settings.fxaa}`,ne(E.$$.fragment),L=h("div"),L.textContent=`${C.ui.settings.bloom}`,ne(B.$$.fragment),I=h("div"),j=T(N),W=h("br"),O=h("small"),O.textContent=`${C.ui.settings.offscreendesc}`,ne(se.$$.fragment),X=h("div"),X.textContent=`${C.ui.settings.particles}`,ne(oe.$$.fragment),ce=h("div"),ce.textContent=`${C.ui.settings.fogpattern}`,ne(xe.$$.fragment),pe=h("div"),pe.textContent=`${C.ui.settings.shadows}`,$e=h("div"),Ee=h("div"),_e=T(Fe),H=h("br"),Le=h("small"),Le.textContent=`${C.ui.settings.reload}`,ne(Oe.$$.fragment),He=h("div"),Ze=T(Ye),ge=h("br"),ae=h("small"),ae.textContent=`${C.ui.settings.reload}`,Be=h("input"),p(n,"type","range"),p(n,"min","30"),p(n,"step","10"),p(s,"type","range"),p(s,"min","30"),p(c,"class","textgrey"),p(u,"type","range"),p(u,"min","50"),p(u,"max","100"),p(b,"class","textgrey"),p(y,"type","range"),p(y,"min","0"),p(y,"max","4"),p(M,"class","textgrey"),p(D,"type","range"),p(D,"min","0"),p(D,"max","100"),p(O,"class","textgrey"),p(pe,"class","textprimary"),p(Le,"class","textgrey"),p(ae,"class","textgrey"),p(Be,"type","range"),p(Be,"min","0"),p(Be,"max","3")},m(fe,je){w(fe,e,je),w(fe,n,je),Ge(n,t[5]),w(fe,i,je),w(fe,s,je),Ge(s,t[6]),w(fe,o,je),d(o,l),d(o,a),d(o,c),d(c,f),w(fe,u,je),Ge(u,t[7]),w(fe,m,je),d(m,v),d(m,_),d(m,b),w(fe,y,je),Ge(y,t[8]),w(fe,k,je),d(k,A),d(k,F),d(k,M),w(fe,D,je),Ge(D,t[9]),w(fe,R,je),ee(E,fe,je),w(fe,L,je),ee(B,fe,je),w(fe,I,je),d(I,j),d(I,W),d(I,O),ee(se,fe,je),w(fe,X,je),ee(oe,fe,je),w(fe,ce,je),ee(xe,fe,je),w(fe,pe,je),w(fe,$e,je),w(fe,Ee,je),d(Ee,_e),d(Ee,H),d(Ee,Le),ee(Oe,fe,je),w(fe,He,je),d(He,Ze),d(He,ge),d(He,ae),w(fe,Be,je),Ge(Be,t[10]),J=!0,Q||(U=[Z(n,"change",t[37]),Z(n,"input",t[37]),Z(s,"change",t[38]),Z(s,"input",t[38]),Z(u,"change",t[39]),Z(u,"input",t[39]),Z(y,"change",t[40]),Z(y,"input",t[40]),Z(y,"change",t[34]),Z(D,"change",t[41]),Z(D,"input",t[41]),Z(D,"change",t[34]),Z(Be,"change",t[42]),Z(Be,"input",t[42]),Z(Be,"change",t[34])],Q=!0)},p(fe,je){je[0]&32&&Ge(n,fe[5]),je[0]&64&&Ge(s,fe[6]),(!J||je[0]&128)&&G(f,fe[7]),je[0]&128&&Ge(u,fe[7]),je[0]&256&&Ge(y,fe[8]),je[0]&512&&Ge(D,fe[9]),je[0]&1024&&Ge(Be,fe[10])},i(fe){J||(P(E.$$.fragment,fe),P(B.$$.fragment,fe),P(se.$$.fragment,fe),P(oe.$$.fragment,fe),P(xe.$$.fragment,fe),P(Oe.$$.fragment,fe),J=!0)},o(fe){q(E.$$.fragment,fe),q(B.$$.fragment,fe),q(se.$$.fragment,fe),q(oe.$$.fragment,fe),q(xe.$$.fragment,fe),q(Oe.$$.fragment,fe),J=!1},d(fe){fe&&(x(e),x(n),x(i),x(s),x(o),x(u),x(m),x(y),x(k),x(D),x(R),x(L),x(I),x(X),x(ce),x(pe),x($e),x(Ee),x(He),x(Be)),te(E,fe),te(B,fe),te(se,fe),te(oe,fe),te(xe,fe),te(Oe,fe),Q=!1,at(U)}}}function t6(t){let e,n,i,s,o;function r(...l){return t[67](t[78],...l)}return{c(){e=h("div"),e.textContent=`${t[76]}`,n=h("div"),p(n,"class",i="btn checkbox "+(t[31][t[78]]?"active":""))},m(l,a){w(l,e,a),w(l,n,a),s||(o=Z(n,"click",r),s=!0)},p(l,a){t=l,a[1]&1&&i!==(i="btn checkbox "+(t[31][t[78]]?"active":""))&&p(n,"class",i)},d(l){l&&(x(e),x(n)),s=!1,o()}}}function n6(t){let e,n=t[73].name+"",i,s;return{c(){e=h("option"),i=T(n),e.__value=s=t[73].val,Ge(e,e.__value)},m(o,r){w(o,e,r),d(e,i)},p:ue,d(o){o&&x(e)}}}function i6(t){let e,n=t[70].name+"",i,s,o,r;function l(){t[46].call(s,t[70])}function a(...c){return t[47](t[70],...c)}return{c(){e=h("div"),i=T(n),s=h("input"),p(s,"type","text")},m(c,f){w(c,e,f),d(e,i),w(c,s,f),Ge(s,t[0].current[t[70].kb]),o||(r=[Z(s,"input",l),Z(s,"change",a)],o=!0)},p(c,f){t=c,f[0]&8&&n!==(n=t[70].name+"")&&G(i,n),f[0]&8&&s.value!==t[0].current[t[70].kb]&&Ge(s,t[0].current[t[70].kb])},d(c){c&&(x(e),x(s)),o=!1,at(r)}}}function aI(t){let e,n,i,s,o=t[1].name+"",r,l,a,c,f,u=me(t[32]),m=[];for(let b=0;b<u.length;b+=1)m[b]=e6(JM(t,u,b));let g=[lI,rI,oI,sI,iI],v=[];function _(b,y){return b[1].id=="gfx"?0:b[1].id=="controls"?1:b[1].id=="audio"?2:b[1].id=="ui"?3:b[1].id=="chat"?4:-1}return~(a=_(t,[-1,-1,-1]))&&(c=v[a]=g[a](t)),{c(){e=h("div"),n=h("div");for(let b=0;b<m.length;b+=1)m[b].c();i=h("div"),s=h("h3"),r=T(o),l=h("div"),c&&c.c(),p(s,"class","textprimary"),p(l,"class","settings svelte-13nnce4"),p(i,"class","menu panel-black scrollbar svelte-13nnce4"),p(e,"class","divide svelte-13nnce4")},m(b,y){w(b,e,y),d(e,n);for(let k=0;k<m.length;k+=1)m[k]&&m[k].m(n,null);d(e,i),d(i,s),d(s,r),d(i,l),~a&&v[a].m(l,null),f=!0},p(b,y){if(y[0]&2|y[1]&2){u=me(b[32]);let S;for(S=0;S<u.length;S+=1){let A=JM(b,u,S);m[S]?m[S].p(A,y):(m[S]=e6(A),m[S].c(),m[S].m(n,null))}for(;S<m.length;S+=1)m[S].d(1);m.length=u.length}(!f||y[0]&2)&&o!==(o=b[1].name+"")&&G(r,o);let k=a;a=_(b,y),a===k?~a&&v[a].p(b,y):(c&&(Pe(),q(v[k],1,1,()=>{v[k]=null}),Te()),~a?(c=v[a],c?c.p(b,y):(c=v[a]=g[a](b),c.c()),P(c,1),c.m(l,null)):c=null)},i(b){f||(P(c),f=!0)},o(b){q(c),f=!1},d(b){b&&x(e),it(m,b),~a&&v[a].d()}}}function cI(t){let e,n,i=t[4]&&KM(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,o){s[4]?i?(i.p(s,o),o[0]&16&&P(i,1)):(i=KM(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function fI(t,e,n){let i,s,o,r,l,a,c,f,u,m,g,v,_,b,y,k,S,A,F,M,D,R,E,L,B,I,N,j;re(t,Wr,Ve=>n(4,i=Ve)),re(t,zr,Ve=>n(5,s=Ve)),re(t,qr,Ve=>n(6,o=Ve)),re(t,Rr,Ve=>n(7,r=Ve)),re(t,Hc,Ve=>n(8,l=Ve)),re(t,Wc,Ve=>n(9,a=Ve)),re(t,Gc,Ve=>n(10,c=Ve)),re(t,pf,Ve=>n(11,f=Ve)),re(t,Xr,Ve=>n(12,u=Ve)),re(t,df,Ve=>n(13,m=Ve)),re(t,Br,Ve=>n(14,g=Ve)),re(t,Ur,Ve=>n(15,v=Ve)),re(t,Xc,Ve=>n(16,_=Ve)),re(t,Yc,Ve=>n(17,b=Ve)),re(t,Or,Ve=>n(18,y=Ve)),re(t,tf,Ve=>n(19,k=Ve)),re(t,of,Ve=>n(20,S=Ve)),re(t,sf,Ve=>n(21,A=Ve)),re(t,af,Ve=>n(22,F=Ve)),re(t,cf,Ve=>n(23,M=Ve)),re(t,ff,Ve=>n(24,D=Ve)),re(t,uf,Ve=>n(25,R=Ve)),re(t,Yr,Ve=>n(26,E=Ve)),re(t,rf,Ve=>n(27,L=Ve)),re(t,jr,Ve=>n(28,B=Ve)),re(t,$r,Ve=>n(29,I=Ve)),re(t,Nr,Ve=>n(30,N=Ve)),re(t,ef,Ve=>n(31,j=Ve));let W=[{id:"ui",name:C.ui.settings.interface},{id:"gfx",name:C.ui.settings.graphics},{id:"controls",name:C.ui.settings.controls},{id:"chat",name:C.ui.settings.chat},{id:"audio",name:C.ui.settings.audio}],O=W[0],se=[{val:"en",name:"English"},{val:"de",name:"German"},{val:"ru",name:"Russian"},{val:"zh",name:"Chinese"},{val:"pt",name:"Portugese"},{val:"es",name:"Spanish"},{val:"fr",name:"French"},{val:"ro",name:"Romanian"},{val:"it",name:"Italian"},{val:"nl",name:"Dutch"},{val:"vi",name:"Vietnamese"},{val:"hu",name:"Hungarian"},{val:"ro",name:"Romanian"},{val:"cs",name:"Czech"},{val:"pl",name:"Polish"}],X=!1,oe=()=>{n(2,X=!0)},ce=(Ve,Ct)=>{Ct.set(Ve===""?void 0:Ve),n(2,X=!0)},xe=["Forward","Left","Back","Right","TurnLeft","TurnRight","Map","Skills","Character","Inventory","Clan","Pvp","Party","NextTarget","NextParty","Untarget"],pe=["Forward","Left","Back","Right","Turn Left","Turn Right","Map","Skills","Character","Inventory","Clan","Pvp","Party","Target Next Enemy","Target Next Friendly","Untarget"];for(let Ve=1;Ve<25;++Ve)xe.push("Skillbar"+Ve);xe=xe.map((Ve,Ct)=>({name:pe[Ct]||Ve,kb:"kb"+Ve,setting:Ns["kb"+Ve]}));let $e=(Ve,Ct)=>{n(1,O=Ve)};function Ee(){s=Wt(this.value),zr.set(s)}function Fe(){o=Wt(this.value),qr.set(o)}function _e(){r=Wt(this.value),Rr.set(r)}function H(){l=Wt(this.value),Hc.set(l)}function Le(){a=Wt(this.value),Wc.set(a)}function Oe(){c=Wt(this.value),Gc.set(c)}function He(){f=Wt(this.value),pf.set(f)}function Ye(){u=Wt(this.value),Xr.set(u)}function Ze(){m=Wt(this.value),df.set(m)}function ge(Ve){le[Ve.kb]=this.value,n(0,Ns)}let ae=(Ve,Ct)=>{ce(le[Ve.kb],Ve.setting)};function Be(){g=Wt(this.value),Br.set(g)}function J(){v=Wt(this.value),Ur.set(v)}function Q(){_=Wt(this.value),Xc.set(_)}function U(){b=Wt(this.value),Yc.set(b)}function fe(){y=ki(this),Or.set(y),n(33,se)}let je=Ve=>$s.set(0),Ie=Ve=>$s.set(Pi.length);function ye(){k=Wt(this.value),tf.set(k)}function qe(){S=Wt(this.value),of.set(S)}function Re(){A=this.value,sf.set(A)}function pt(){F=Wt(this.value),af.set(F)}function wt(){M=Wt(this.value),cf.set(M)}function Qe(){D=Wt(this.value),ff.set(D)}function Et(){R=Wt(this.value),uf.set(R)}function be(){E=Wt(this.value),Yr.set(E)}function Je(){L=Wt(this.value),rf.set(L)}function yt(){B=Wt(this.value),jr.set(B)}function St(){I=Wt(this.value),$r.set(I)}function Ae(){N=Wt(this.value),Nr.set(N)}return[Ns,O,X,xe,i,s,o,r,l,a,c,f,u,m,g,v,_,b,y,k,S,A,F,M,D,R,E,L,B,I,N,j,W,se,oe,ce,$e,Ee,Fe,_e,H,Le,Oe,He,Ye,Ze,ge,ae,Be,J,Q,U,fe,je,Ie,ye,qe,Re,pt,wt,Qe,Et,be,Je,yt,St,Ae,(Ve,Ct)=>nt(ef,j[Ve]=j[Ve]?0:1,j),()=>{nt(Wr,i=!1,i),X&&window.location.reload()}]}var Tg=class extends Me{constructor(e){super(),Ce(this,e,fI,cI,Ue,{},null,[-1,-1,-1])}},s6=Tg;var o6=(t,e,n,i,s,o)=>Eg(t,s,o)&&Xa(i,s,o)&&Ig(n,s,o)&&Vg(e,s,o),Eg=(t,e,n)=>rn[e+n]===void 0?(console.log("Error: Item can EQUIP type not found: "+e+n),!1):t>=rn[e+n].level,Xa=(t,e,n)=>rn[e+n].class===void 0||t===rn[e+n].class,uI=(t,e)=>t+Pt.get(e).skillpoints,Dg=t=>t.reduce(uI,0),Ig=(t,e,n)=>e!=="book"||eu(t,rn[e+n].skillid)===rn[e+n].skilllevel;var eu=(t,e)=>t.reduce((n,i)=>n+(i===e),0);var Vg=(t,e,n)=>rn[e+n].requiredSkill===void 0||t.indexOf(rn[e+n].requiredSkill)>0;var r6=(t,e,n)=>rn[e+n].buyElo===void 0||t>=rn[e+n].buyElo;function l6(t,e,n){let i=t.slice();return i[39]=e[n],i}function a6(t,e,n){let i=t.slice();return i[39]=e[n],i}function c6(t,e,n){let i=t.slice();return i[44]=e[n],i[46]=n,i}function f6(t,e,n){let i=t.slice();return i[47]=e[n],i}function u6(t){let e,n;return e=new Nt({props:{origin:"center",title:C.ui.headers.skills,settings:[{name:"Preset Manager",fun:t[31]}],icon:"book",$$slots:{default:[FI]},$$scope:{ctx:t}}}),e.$on("close",t[32]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s[0]&4096&&(o.settings=[{name:"Preset Manager",fun:i[31]}]),s[0]&6143|s[1]&524288&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function m6(t){let e,n;function i(r,l){return r[6]===void 0?pI:mI}let s=i(t,[-1,-1]),o=s(t);return{c(){e=h("div"),o.c(),p(e,"class",n="panel-black "+(t[6]===void 0?"bar-top-config":"bar-top-save")+" svelte-1e0alkc")},m(r,l){w(r,e,l),o.m(e,null)},p(r,l){s===(s=i(r,l))&&o?o.p(r,l):(o.d(1),o=s(r),o&&(o.c(),o.m(e,null))),l[0]&64&&n!==(n="panel-black "+(r[6]===void 0?"bar-top-config":"bar-top-save")+" svelte-1e0alkc")&&p(e,"class",n)},d(r){r&&x(e),o.d()}}}function mI(t){let e,n,i,s,o,r,l;return{c(){e=h("div"),n=h("input"),i=h("div"),i.textContent="Save",s=h("div"),s.textContent="Cancel",o=h("div"),p(n,"placeholder","Enter Preset Name"),p(n,"maxlength","25"),p(i,"class","btn green"),p(s,"class","btn orange")},m(a,c){w(a,e,c),w(a,n,c),Ge(n,t[6]),w(a,i,c),w(a,s,c),w(a,o,c),r||(l=[Z(n,"input",t[25]),Z(i,"click",t[15]),Z(s,"click",t[26])],r=!0)},p(a,c){c[0]&64&&n.value!==a[6]&&Ge(n,a[6])},d(a){a&&(x(e),x(n),x(i),x(s),x(o)),r=!1,at(l)}}}function pI(t){let e,n,i,s,o,r,l,a,c,f,u,m,g=me(t[10].filter(t[21])),v=[];for(let b=0;b<g.length;b+=1)v[b]=p6(f6(t,g,b));let _=t[7]===void 0&&d6(t);return{c(){e=h("span"),e.textContent="Preset:",n=h("select");for(let b=0;b<v.length;b+=1)v[b].c();i=ve(),_&&_.c(),o=h("div"),r=T("Save"),a=h("div"),c=T("Delete"),p(e,"class","btn textprimary"),p(n,"class",s="btn grey "+(t[10].filter(t[22]).length===0?"disabled":"")),t[7]===void 0&&_n(()=>t[23].call(n)),p(o,"class",l="btn grey "+(t[5]?"":"disabled")),p(a,"class",f="btn grey "+(t[7]!==void 0?"":"disabled"))},m(b,y){w(b,e,y),w(b,n,y);for(let k=0;k<v.length;k+=1)v[k]&&v[k].m(n,null);d(n,i),_&&_.m(n,null),wn(n,t[7],!0),w(b,o,y),d(o,r),w(b,a,y),d(a,c),u||(m=[Z(n,"change",t[23]),Z(n,"change",t[16]),Z(o,"click",t[24]),Z(a,"click",t[17])],u=!0)},p(b,y){if(y[0]&1024){g=me(b[10].filter(b[21]));let k;for(k=0;k<g.length;k+=1){let S=f6(b,g,k);v[k]?v[k].p(S,y):(v[k]=p6(S),v[k].c(),v[k].m(n,i))}for(;k<v.length;k+=1)v[k].d(1);v.length=g.length}b[7]===void 0?_?_.p(b,y):(_=d6(b),_.c(),_.m(n,null)):_&&(_.d(1),_=null),y[0]&1024&&s!==(s="btn grey "+(b[10].filter(b[22]).length===0?"disabled":""))&&p(n,"class",s),y[0]&1152&&wn(n,b[7]),y[0]&32&&l!==(l="btn grey "+(b[5]?"":"disabled"))&&p(o,"class",l),y[0]&1152&&f!==(f="btn grey "+(b[7]!==void 0?"":"disabled"))&&p(a,"class",f)},d(b){b&&(x(e),x(n),x(o),x(a)),it(v,b),_&&_.d(),u=!1,at(m)}}}function p6(t){let e,n=t[47].name+"",i,s;return{c(){e=h("option"),i=T(n),e.__value=s=t[47].name,Ge(e,e.__value)},m(o,r){w(o,e,r),d(e,i)},p(o,r){r[0]&1024&&n!==(n=o[47].name+"")&&G(i,n),r[0]&1024&&s!==(s=o[47].name)&&(e.__value=s,Ge(e,e.__value))},d(o){o&&x(e)}}}function d6(t){let e,n;return{c(){e=h("option"),n=T("No Preset"),e.disabled=!0,e.selected=!0,e.__value=void 0,Ge(e,e.__value)},m(i,s){w(i,e,s),d(e,n)},p:ue,d(i){i&&x(e)}}}function dI(t){let e,n;return e=new hl({props:{level:Math.max(1,t[39].level),skill:Pt.get(t[39].id)}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s[0]&8&&(o.level=Math.max(1,i[39].level)),s[0]&8&&(o.skill=Pt.get(i[39].id)),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function hI(t){let e;return{c(){e=h("div"),e.textContent=`${C.ui.default}`,p(e,"class","textgrey")},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function gI(t){let e,n=me(Array(Pt.get(t[39].id).skilllevels)),i=[];for(let s=0;s<n.length;s+=1)i[s]=h6(c6(t,n,s));return{c(){e=h("div");for(let s=0;s<i.length;s+=1)i[s].c();p(e,"class","skillpoints svelte-1e0alkc")},m(s,o){w(s,e,o);for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(e,null)},p(s,o){if(o[0]&24){n=me(Array(Pt.get(s[39].id).skilllevels));let r;for(r=0;r<n.length;r+=1){let l=c6(s,n,r);i[r]?i[r].p(l,o):(i[r]=h6(l),i[r].c(),i[r].m(e,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function vI(t){let e;return{c(){e=h("div"),p(e,"class","border grey")},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function _I(t){let e;return{c(){e=h("div"),p(e,"class","btn incbtn grey svelte-1e0alkc")},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function bI(t){let e,n;return{c(){e=h("div"),p(e,"class",n="btn incbtn "+(t[4]?"green":"white")+" svelte-1e0alkc")},m(i,s){w(i,e,s)},p(i,s){s[0]&16&&n!==(n="btn incbtn "+(i[4]?"green":"white")+" svelte-1e0alkc")&&p(e,"class",n)},d(i){i&&x(e)}}}function h6(t){let e;function n(o,r){return o[46]+1<=o[39].level?bI:o[46]+1<=o[39].learned?_I:vI}let i=n(t,[-1,-1]),s=i(t);return{c(){s.c(),e=ve()},m(o,r){s.m(o,r),w(o,e,r)},p(o,r){i===(i=n(o,r))&&s?s.p(o,r):(s.d(1),s=i(o),s&&(s.c(),s.m(e.parentNode,e)))},d(o){o&&x(e),s.d(o)}}}function yI(t){let e;return{c(){e=h("div"),p(e,"class","name svelte-1e0alkc")},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function kI(t){let e,n,i,s=t[39].level+"",o;return{c(){e=h("div"),n=T("Lv. "),i=h("span"),o=T(s),p(i,"class","bold textwhite"),p(e,"class","name svelte-1e0alkc")},m(r,l){w(r,e,l),d(e,n),d(e,i),d(i,o)},p(r,l){l[0]&8&&s!==(s=r[39].level+"")&&G(o,s)},d(r){r&&x(e)}}}function g6(t){let e,n,i,s,o,r,l;function a(...m){return t[27](t[39],...m)}function c(m,g){return g[0]&520&&(o=null),o==null&&(o=m[9]>=Pt.get(m[39].id).skillpoints&&m[39].level<Pt.get(m[39].id).skilllevels&&m[39].level<m[39].learned),o?wI:xI}let f=c(t,[-1,-1]),u=f(t);return{c(){e=h("div"),n=h("div"),i=T("-"),u.c(),p(n,"class",s="btn incbtn "+(t[39].level>0?"grey":"black disabled")+" svelte-1e0alkc"),p(e,"class","skillpoints svelte-1e0alkc")},m(m,g){w(m,e,g),d(e,n),d(n,i),u.m(e,null),r||(l=Z(n,"click",a),r=!0)},p(m,g){t=m,g[0]&8&&s!==(s="btn incbtn "+(t[39].level>0?"grey":"black disabled")+" svelte-1e0alkc")&&p(n,"class",s),f===(f=c(t,g))&&u?u.p(t,g):(u.d(1),u=f(t),u&&(u.c(),u.m(e,null)))},d(m){m&&x(e),u.d(),r=!1,l()}}}function xI(t){let e;return{c(){e=h("div"),e.textContent="+",p(e,"class","btn incbtn black disabled svelte-1e0alkc")},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function wI(t){let e,n,i;function s(...o){return t[28](t[39],...o)}return{c(){e=h("div"),e.textContent="+",p(e,"id","tutsetskillpoint"),p(e,"class","btn incbtn green svelte-1e0alkc")},m(o,r){w(o,e,r),n||(i=Z(e,"click",s),n=!0)},p(o,r){t=o},d(o){o&&x(e),n=!1,i()}}}function v6(t){let e,n,i,s,o=C.items.book[t[39].id].name+"",r,l,a,c,f;n=new pl({props:{descPos:"left:100%;top:0;",descRoot:t[2],border:"white",data:{},pickable:t[39].pickable,meta:{type:"skill",skill:Pt.get(t[39].id)},css:"slotskill",img:`/data/ui/skills/${t[39].id}.${Gn}?v=8588529`,$$slots:{default:[dI]},$$scope:{ctx:t}}});function u(k,S){return k[39].engineOnly?hI:gI}let m=u(t,[-1,-1]),g=m(t);function v(k,S){return k[39].engineOnly?yI:kI}let _=v(t,[-1,-1]),b=_(t),y=!t[39].engineOnly&&g6(t);return{c(){e=h("div"),ne(n.$$.fragment),i=h("div"),s=h("div"),r=T(o),l=Ne(),g.c(),a=h("div"),b.c(),c=ve(),y&&y.c(),p(s,"class","textprimary name svelte-1e0alkc"),p(e,"class","panel-bright skillbox svelte-1e0alkc")},m(k,S){w(k,e,S),ee(n,e,null),d(e,i),d(i,s),d(s,r),d(i,l),g.m(i,null),d(e,a),b.m(a,null),d(a,c),y&&y.m(a,null),f=!0},p(k,S){let A={};S[0]&4&&(A.descRoot=k[2]),S[0]&8&&(A.pickable=k[39].pickable),S[0]&8&&(A.meta={type:"skill",skill:Pt.get(k[39].id)}),S[0]&8&&(A.img=`/data/ui/skills/${k[39].id}.${Gn}?v=8588529`),S[0]&8|S[1]&524288&&(A.$$scope={dirty:S,ctx:k}),n.$set(A),(!f||S[0]&8)&&o!==(o=C.items.book[k[39].id].name+"")&&G(r,o),m===(m=u(k,S))&&g?g.p(k,S):(g.d(1),g=m(k),g&&(g.c(),g.m(i,null))),_===(_=v(k,S))&&b?b.p(k,S):(b.d(1),b=_(k),b&&(b.c(),b.m(a,c))),k[39].engineOnly?y&&(y.d(1),y=null):y?y.p(k,S):(y=g6(k),y.c(),y.m(a,null))},i(k){f||(P(n.$$.fragment,k),f=!0)},o(k){q(n.$$.fragment,k),f=!1},d(k){k&&x(e),te(n),g.d(),b.d(),y&&y.d()}}}function MI(t){let e,n;return e=new hl({props:{level:1,skill:t[39]}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s[0]&1&&(o.skill=i[39]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function _6(t){let e,n,i,s,o=C.items.book[t[39].id].name+"",r,l,a=C.ui.learnable+"",c,f,u=t[39].minlevel+"",m,g;return n=new pl({props:{descPos:"left:100%;top:0;",descRoot:t[2],border:"grey filtered",data:{},pickable:!1,meta:{type:"skill",skill:t[39]},css:"slotskill",img:`/data/ui/skills/${t[39].id}.${Gn}?v=8588529`,$$slots:{default:[MI]},$$scope:{ctx:t}}}),{c(){e=h("div"),ne(n.$$.fragment),i=h("div"),s=h("div"),r=T(o),l=h("div"),c=T(a),f=Ne(),m=T(u),p(s,"class","name svelte-1e0alkc"),p(i,"class","textgrey"),p(e,"class","panel-bright skillbox svelte-1e0alkc")},m(v,_){w(v,e,_),ee(n,e,null),d(e,i),d(i,s),d(s,r),d(i,l),d(l,c),d(l,f),d(l,m),g=!0},p(v,_){let b={};_[0]&4&&(b.descRoot=v[2]),_[0]&1&&(b.meta={type:"skill",skill:v[39]}),_[0]&1&&(b.img=`/data/ui/skills/${v[39].id}.${Gn}?v=8588529`),_[0]&1|_[1]&524288&&(b.$$scope={dirty:_,ctx:v}),n.$set(b),(!g||_[0]&1)&&o!==(o=C.items.book[v[39].id].name+"")&&G(r,o),(!g||_[0]&1)&&u!==(u=v[39].minlevel+"")&&G(m,u)},i(v){g||(P(n.$$.fragment,v),g=!0)},o(v){q(n.$$.fragment,v),g=!1},d(v){v&&x(e),te(n)}}}function FI(t){let e,n,i,s,o,r=(t[1]?t[1]:`${C.ui.stats.array[23]}: ${t[8]}`)+"",l,a,c,f,u,m,g,v,_,b=t[12]&&m6(t),y=me(t[3]),k=[];for(let D=0;D<y.length;D+=1)k[D]=v6(a6(t,y,D));let S=D=>q(k[D],1,1,()=>{k[D]=null}),A=me(Array.from(Pt.values()).filter(t[29]).sort(b6)),F=[];for(let D=0;D<A.length;D+=1)F[D]=_6(l6(t,A,D));let M=D=>q(F[D],1,1,()=>{F[D]=null});return{c(){e=h("div"),b&&b.c(),n=h("div");for(let D=0;D<k.length;D+=1)k[D].c();i=ve();for(let D=0;D<F.length;D+=1)F[D].c();s=h("div"),o=h("span"),l=T(r),c=h("div"),f=T("Activate Skills"),m=h("span"),p(n,"id","skilllist"),p(n,"class","scrollbar panel-black skilllist svelte-1e0alkc"),p(o,"class",a=t[1]?"textred":t[8]>0?"textprimary":"textgrey"),p(c,"id","tutapplyskills"),p(c,"class",u="btn "+(t[4]?"green":"grey disabled")),p(s,"class","panel-black bar-bot svelte-1e0alkc"),p(e,"class","flexer svelte-1e0alkc")},m(D,R){w(D,e,R),b&&b.m(e,null),d(e,n);for(let E=0;E<k.length;E+=1)k[E]&&k[E].m(n,null);d(n,i);for(let E=0;E<F.length;E+=1)F[E]&&F[E].m(n,null);d(e,s),d(s,o),d(o,l),d(s,c),d(c,f),d(s,m),t[30](e),g=!0,v||(_=Z(c,"click",t[13]),v=!0)},p(D,R){if(D[12]?b?b.p(D,R):(b=m6(D),b.c(),b.m(e,n)):b&&(b.d(1),b=null),R[0]&16924){y=me(D[3]);let E;for(E=0;E<y.length;E+=1){let L=a6(D,y,E);k[E]?(k[E].p(L,R),P(k[E],1)):(k[E]=v6(L),k[E].c(),P(k[E],1),k[E].m(n,i))}for(Pe(),E=y.length;E<k.length;E+=1)S(E);Te()}if(R[0]&5){A=me(Array.from(Pt.values()).filter(D[29]).sort(b6));let E;for(E=0;E<A.length;E+=1){let L=l6(D,A,E);F[E]?(F[E].p(L,R),P(F[E],1)):(F[E]=_6(L),F[E].c(),P(F[E],1),F[E].m(n,null))}for(Pe(),E=A.length;E<F.length;E+=1)M(E);Te()}(!g||R[0]&258)&&r!==(r=(D[1]?D[1]:`${C.ui.stats.array[23]}: ${D[8]}`)+"")&&G(l,r),(!g||R[0]&258&&a!==(a=D[1]?"textred":D[8]>0?"textprimary":"textgrey"))&&p(o,"class",a),(!g||R[0]&16&&u!==(u="btn "+(D[4]?"green":"grey disabled")))&&p(c,"class",u)},i(D){if(!g){for(let R=0;R<y.length;R+=1)P(k[R]);for(let R=0;R<A.length;R+=1)P(F[R]);g=!0}},o(D){k=k.filter(Boolean);for(let R=0;R<k.length;R+=1)q(k[R]);F=F.filter(Boolean);for(let R=0;R<F.length;R+=1)q(F[R]);g=!1},d(D){D&&x(e),b&&b.d(),it(k,D),it(F,D),t[30](null),v=!1,_()}}}function CI(t){let e,n,i=t[11]&&u6(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,o){s[11]?i?(i.p(s,o),o[0]&2048&&P(i,1)):(i=u6(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}var b6=(t,e)=>t.minlevel-e.minlevel;function SI(t,e,n){let i,s,o,r,l,a,c,f,u;re(t,Lc,_e=>n(0,o=_e)),re(t,ga,_e=>n(10,r=_e)),re(t,Oo,_e=>n(19,l=_e)),re(t,qc,_e=>n(1,a=_e)),re(t,zo,_e=>n(20,c=_e)),re(t,co,_e=>n(11,f=_e)),re(t,mf,_e=>n(12,u=_e));let m,g=_e=>{let H=[];return _e.forEach((Le,Oe)=>{for(let He=0;He<Le.level;++He)H.push(Le.id)}),H},v=()=>{let _e=A.filter(H=>!Pt.get(H)?.engineOnly);xt("skillconfig",_e),n(4,b=!1),nt(qc,a=void 0,a),tn(28,100)},_=[],b=!1,y=!1,k=(_e,H)=>{n(3,_=[]),_e.forEach((Le,Oe)=>{let He=Pt.get(Oe);_.push({id:Oe,level:Le,minlevel:He.minlevel,learned:H.get(Oe)||0,engineOnly:He.engineOnly,pickable:He.onCast!==void 0})}),H.forEach((Le,Oe)=>{if(!_e.has(Oe)){let He=Pt.get(Oe);_.push({id:Oe,level:0,minlevel:He.minlevel,learned:Le,engineOnly:He.engineOnly,pickable:He.onCast!==void 0})}}),_.sort((Le,Oe)=>Le.id-Oe.id)},S=()=>{F=g(_);let _e=F.filter(H=>!Pt.get(H)?.engineOnly);n(18,M=Dg(_e))},A=[],F=[],M=0,D=(_e,H)=>{_e.level+=H,n(3,_),tn(27,100),R()},R=()=>{A=g(_);let _e=A.filter(He=>!Pt.get(He)?.engineOnly);n(18,M=Dg(_e));let H=A.sort().join(","),Le=F.sort().join(",");n(4,b=A.length&&H!==Le);let Oe=r.find(He=>H===He.skills.sort().join(","));Oe?(n(7,B=Oe.name),n(5,y=!1)):(n(7,B=void 0),n(5,y=!0))},E,L=()=>{E!==void 0&&(ga.update(_e=>(_e=_e.filter(H=>H.name!==E||H.pclass!==V.player.class),_e.push({name:E,skills:g(_),pclass:V.player.class}),_e)),n(7,B=E),n(6,E=void 0),n(5,y=!1))},B,I=_e=>{let H=r.find(Le=>Le.name===B&&Le.pclass===V.player.class);if(H){let Le=new Map;H.skills.forEach(Oe=>{Le.has(Oe)?Le.set(Oe,Le.get(Oe)+1):Le.set(Oe,1)}),k(Le,o),R(),b&&v()}},N=()=>{ga.update(_e=>_e.filter(H=>H.name!==B)),n(7,B=void 0),n(5,y=!0)},j=_e=>_e.pclass===V.player.class,W=_e=>_e.pclass===V.player.class;function O(){B=ki(this),n(7,B)}let se=_e=>n(6,E="");function X(){E=this.value,n(6,E)}let oe=_e=>n(6,E=void 0),ce=(_e,H)=>D(_e,-1),xe=(_e,H)=>D(_e,1),pe=_e=>_e.class===V.player.class&&!_e.engineOnly&&!o.has(_e.id);function $e(_e){$t[_e?"unshift":"push"](()=>{m=_e,n(2,m)})}let Ee=()=>{nt(mf,u=!u,u)},Fe=()=>{nt(co,f=!1,f)};return t.$$.update=()=>{t.$$.dirty[0]&1048577&&(k(c,o),S(),R()),t.$$.dirty[0]&2&&a&&n(4,b=!0),t.$$.dirty[0]&786432&&n(9,i=l[24]-M),t.$$.dirty[0]&786432&&n(8,s=l[24]-M)},[o,a,m,_,b,y,E,B,s,i,r,f,u,v,D,L,I,N,M,l,c,j,W,O,se,X,oe,ce,xe,pe,$e,Ee,Fe]}var Lg=class extends Me{constructor(e){super(),Ce(this,e,SI,CI,Ue,{},null,[-1,-1])}},y6=Lg;function k6(t,e,n){let i=t.slice();return i[19]=e[n],i[21]=n,i}function x6(t){let e,n,i=me(t[1]),s=[];for(let r=0;r<i.length;r+=1)s[r]=M6(k6(t,i,r));let o=null;return i.length||(o=w6(t)),{c(){e=h("div");for(let r=0;r<s.length;r+=1)s[r].c();n=ve(),o&&o.c(),p(e,"class","divider")},m(r,l){w(r,e,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(r,l);w(r,n,l),o&&o.m(r,l)},p(r,l){if(l&74){i=me(r[1]);let a;for(a=0;a<i.length;a+=1){let c=k6(r,i,a);s[a]?s[a].p(c,l):(s[a]=M6(c),s[a].c(),s[a].m(n.parentNode,n))}for(;a<s.length;a+=1)s[a].d(1);s.length=i.length,!i.length&&o?o.p(r,l):i.length?o&&(o.d(1),o=null):(o=w6(r),o.c(),o.m(n.parentNode,n))}},d(r){r&&(x(e),x(n)),it(s,r),o&&o.d(r)}}}function w6(t){let e;return{c(){e=h("div"),e.textContent="No results",p(e,"class","textgrey result svelte-17jb1r5")},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function M6(t){let e,n,i=t[19].name+"",s,o,r=t[19].type+"",l,a,c,f=(t[19].level||1)+"",u,m,g,v;function _(...b){return t[14](t[21],...b)}return{c(){e=h("div"),n=h("span"),s=T(i),o=h("span"),l=T(r),a=h("span"),c=T("Lv. "),u=T(f),p(o,"class","textgrey infocol svelte-17jb1r5"),p(a,"class","infocol svelte-17jb1r5"),p(e,"class",m="result "+(t[21]===t[3]?"sel":"")+" svelte-17jb1r5")},m(b,y){w(b,e,y),d(e,n),d(n,s),d(e,o),d(o,l),d(e,a),d(a,c),d(a,u),g||(v=Z(e,"mousedown",_),g=!0)},p(b,y){t=b,y&2&&i!==(i=t[19].name+"")&&G(s,i),y&2&&r!==(r=t[19].type+"")&&G(l,r),y&2&&f!==(f=(t[19].level||1)+"")&&G(u,f),y&8&&m!==(m="result "+(t[21]===t[3]?"sel":"")+" svelte-17jb1r5")&&p(e,"class",m)},d(b){b&&x(e),g=!1,v()}}}function AI(t){let e,n,i,s,o,r,l,a=t[2]&&x6(t);return{c(){e=h("div"),n=h("div"),i=h("input"),a&&a.c(),p(i,"placeholder",s=C.ui.merchant.itemSearch),p(i,"type","search"),p(n,"class",o="container input "+(t[2]?"focus":"")),p(e,"class","navbtn finder")},m(c,f){w(c,e,f),d(e,n),d(n,i),t[11](i),Ge(i,t[0]),a&&a.m(n,null),r||(l=[Z(i,"input",t[12]),Z(i,"input",t[5]),Z(i,"focus",t[13]),Z(i,"blur",t[7])],r=!0)},p(c,[f]){f&1&&i.value!==c[0]&&Ge(i,c[0]),c[2]?a?a.p(c,f):(a=x6(c),a.c(),a.m(n,null)):a&&(a.d(1),a=null),f&4&&o!==(o="container input "+(c[2]?"focus":""))&&p(n,"class",o)},i:ue,o:ue,d(c){c&&x(e),t[11](null),a&&a.d(),r=!1,at(l)}}}function PI(t,e,n){let i=Mr(),s=tr.filter(M=>M.level<=45).map(M=>({name:hn(M.type,M.tier),type:M.type,tier:M.tier,level:M.level})),o=()=>{let M=a.toLowerCase();M.length?n(1,f=s.filter(D=>D.type===M||D.name.toLowerCase().includes(M)).slice(0,c)):n(1,f=[]),m>=f.length&&_(f.length-1)},{type:r}=e,{tier:l}=e,{name:a=""}=e,{limit:c=5}=e,f=[],u=!1,m=-1,g,v,_=M=>{n(3,m=M),m>=0?(g=f[m],n(0,a=g.name),n(8,r=g.type),n(9,l=g.tier)):(g=void 0,n(0,a=""),n(8,r="all"),n(9,l="all"))},b=M=>{M.target==v&&((M.keyCode===38||M.keyCode===40)&&f.length?(_(_a(m+(M.keyCode===38?-1:1),f.length)),M.preventDefault()):(M.keyCode==13||M.keyCode==27)&&v.blur())},y=M=>{n(2,u=!1),_(Math.min(Math.max(0,m),f.length-1)),m>=0&&i("finalize")};Pn(()=>{document.addEventListener("keydown",b)}),Tn(()=>{document.removeEventListener("keydown",b),n(4,v=void 0)});function k(M){$t[M?"unshift":"push"](()=>{v=M,n(4,v)})}function S(){a=this.value,n(0,a)}let A=M=>n(2,u=!0),F=(M,D)=>_(M);return t.$$set=M=>{"type"in M&&n(8,r=M.type),"tier"in M&&n(9,l=M.tier),"name"in M&&n(0,a=M.name),"limit"in M&&n(10,c=M.limit)},[a,f,u,m,v,o,_,y,r,l,c,k,S,A,F]}var qg=class extends Me{constructor(e){super(),Ce(this,e,PI,AI,Ue,{type:8,tier:9,name:0,limit:10})}},F6=qg;var C6=t=>9+Math.ceil(t*.001);function S6(t,e,n){let i=t.slice();return i[55]=e[n],i}function A6(t,e,n){let i=t.slice();return i[58]=e[n],i[60]=n,i}function P6(t){let e,n;return e=new Nt({props:{origin:"left top",defaultOffset:[0,100],title:"Merchant",$$slots:{default:[qI]},$$scope:{ctx:t}}}),e.$on("close",t[50]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s[0]&2097135|s[1]&1073741824&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function TI(t){let e,n=t[58]+"",i,s,o,r;function l(...a){return t[44](t[58],...a)}return{c(){e=h("div"),i=T(n),p(e,"class",s="choice "+(t[58]==t[6]?"active":"")+" svelte-35lzg4")},m(a,c){w(a,e,c),d(e,i),o||(r=Z(e,"click",l),o=!0)},p(a,c){t=a,c[0]&64&&s!==(s="choice "+(t[58]==t[6]?"active":"")+" svelte-35lzg4")&&p(e,"class",s)},d(a){a&&x(e),o=!1,r()}}}function EI(t){let e;return{c(){e=h("div"),p(e,"class","divider svelte-35lzg4")},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function T6(t){let e;function n(o,r){return o[58]===null?EI:TI}let s=n(t,[-1,-1])(t);return{c(){s.c(),e=ve()},m(o,r){s.m(o,r),w(o,e,r)},p(o,r){s.p(o,r)},d(o){o&&x(e),s.d(o)}}}function E6(t){let e,n,i,s=hn(t[55].temp.type,t[55].temp.tier)+"",o,r,l,a=(t[55].temp.logic.level||1)+"",c,f,u,m=t[55].temp.owner+"",g,v,_=t[27](t[55].temp.auction.getTime())+"",b,y,k,S=t[13]&&t[55].temp.stacks>0?t[55].temp.stacks+" x ":"",A,F,M,D,R,E;n=new bi({props:{shift:t[20],descPos:"right:0;top:0;",descRoot:t[5],pickable:!1,item:t[55]}}),F=new kn({props:{amount:t[13]&&t[55].temp.stacks>0?Math.ceil(t[55].temp.auctionprice/t[55].temp.stacks):t[55].temp.auctionprice}});function L(...B){return t[47](t[55],...B)}return{c(){e=h("div"),ne(n.$$.fragment),i=h("span"),o=T(s),l=h("span"),c=T(a),u=h("span"),g=T(m),v=h("span"),b=T(_),y=h("div"),k=h("span"),A=T(S),ne(F.$$.fragment),p(i,"class",r="marg text"+Yt(t[55].temp.quality)[0]+" svelte-35lzg4"),ze(i,"margin-left","6px"),p(l,"class",f="marg "+(V.player.level>=t[55].temp.logic.level?"textgreen":"textred")+" svelte-35lzg4"),p(u,"class","marg svelte-35lzg4"),p(v,"class","marg svelte-35lzg4"),p(k,"class","textgreen"),p(y,"class","marg svelte-35lzg4"),ze(y,"text-align","end"),p(e,"class",M="buy "+(t[18]==t[55]?"selected":"")+" item panel-black svelte-35lzg4")},m(B,I){w(B,e,I),ee(n,e,null),d(e,i),d(i,o),d(e,l),d(l,c),d(e,u),d(u,g),d(e,v),d(v,b),d(e,y),d(y,k),d(k,A),ee(F,y,null),D=!0,R||(E=Z(e,"click",L),R=!0)},p(B,I){t=B;let N={};I[0]&1048576&&(N.shift=t[20]),I[0]&32&&(N.descRoot=t[5]),I[0]&131072&&(N.item=t[55]),n.$set(N),(!D||I[0]&131072)&&s!==(s=hn(t[55].temp.type,t[55].temp.tier)+"")&&G(o,s),(!D||I[0]&131072&&r!==(r="marg text"+Yt(t[55].temp.quality)[0]+" svelte-35lzg4"))&&p(i,"class",r),(!D||I[0]&131072)&&a!==(a=(t[55].temp.logic.level||1)+"")&&G(c,a),(!D||I[0]&131072&&f!==(f="marg "+(V.player.level>=t[55].temp.logic.level?"textgreen":"textred")+" svelte-35lzg4"))&&p(l,"class",f),(!D||I[0]&131072)&&m!==(m=t[55].temp.owner+"")&&G(g,m),(!D||I[0]&131072)&&_!==(_=t[27](t[55].temp.auction.getTime())+"")&&G(b,_),(!D||I[0]&139264)&&S!==(S=t[13]&&t[55].temp.stacks>0?t[55].temp.stacks+" x ":"")&&G(A,S);let j={};I[0]&139264&&(j.amount=t[13]&&t[55].temp.stacks>0?Math.ceil(t[55].temp.auctionprice/t[55].temp.stacks):t[55].temp.auctionprice),F.$set(j),(!D||I[0]&393216&&M!==(M="buy "+(t[18]==t[55]?"selected":"")+" item panel-black svelte-35lzg4"))&&p(e,"class",M)},i(B){D||(P(n.$$.fragment,B),P(F.$$.fragment,B),D=!0)},o(B){q(n.$$.fragment,B),q(F.$$.fragment,B),D=!1},d(B){B&&x(e),te(n),te(F),R=!1,E()}}}function DI(t){let e,n,i,s,o=[LI,VI],r=[];function l(a,c){return a[18].temp.owner!==V.player.name?0:1}return n=l(t,[-1,-1]),i=r[n]=o[n](t),{c(){e=h("section"),i.c(),p(e,"class","confirm panel-black svelte-35lzg4")},m(a,c){w(a,e,c),r[n].m(e,null),s=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(Pe(),q(r[f],1,1,()=>{r[f]=null}),Te(),i=r[n],i?i.p(a,c):(i=r[n]=o[n](a),i.c()),P(i,1),i.m(e,null))},i(a){s||(P(i),s=!0)},o(a){q(i),s=!1},d(a){a&&x(e),r[n].d()}}}function II(t){let e,n,i,s=(t[3]?hn(t[3].type,t[3].tier):C.ui.merchant.dragitem)+"",o,r,l,a,c=C.ui.merchant.price+"",f,u,m,g,v,_,b=C.ui.merchant.fee+"",y,k,S,A,F,M,D=C.ui.merchant.post+"",R,E,L,B,I,N;n=new bi({props:{descPos:"left:100%;bottom:100%;",clearOnMove:!0,invslot:void 0,pickable:!0,item:cs}}),n.$on("discard",t[26]),n.$on("move",t[25]),n.$on("click",t[26]),n.$on("context",t[26]),m=new kn({props:{amount:t[1]}}),S=new kn({props:{amount:t[15]}});let j=t[3]&&t[3].stacks>0&&D6(t);return{c(){e=h("section"),ne(n.$$.fragment),i=h("span"),o=T(s),l=h("div"),a=h("span"),f=T(c),u=T(": "),ne(m.$$.fragment),g=Ne(),v=h("br"),_=h("span"),y=T(b),k=T(": "),ne(S.$$.fragment),A=h("input"),j&&j.c(),M=h("div"),R=T(D),p(i,"class",r="marg text"+(t[3]?Yt(t[3].quality)[0]:"grey")+" svelte-35lzg4"),p(a,"class","textwhite"),p(_,"class","textgrey"),p(l,"class","marg svelte-35lzg4"),ze(l,"text-align","end"),p(A,"class","marg svelte-35lzg4"),p(A,"type","number"),p(A,"placeholder",F=C.ui.merchant.setPrice),p(M,"class",E="marg btn formatted secondary "+(t[16]?"":"disabled")+" svelte-35lzg4"),p(e,"class",L="post "+(t[3]&&t[3].stacks>0?"postStacks":"")+" panel-black svelte-35lzg4")},m(W,O){w(W,e,O),ee(n,e,null),d(e,i),d(i,o),d(e,l),d(l,a),d(a,f),d(a,u),ee(m,a,null),d(a,g),d(l,v),d(l,_),d(_,y),d(_,k),ee(S,_,null),d(e,A),Ge(A,t[0]),j&&j.m(e,null),d(e,M),d(M,R),B=!0,I||(N=[Z(A,"input",t[48]),Z(M,"click",t[24])],I=!0)},p(W,O){(!B||O[0]&8)&&s!==(s=(W[3]?hn(W[3].type,W[3].tier):C.ui.merchant.dragitem)+"")&&G(o,s),(!B||O[0]&8&&r!==(r="marg text"+(W[3]?Yt(W[3].quality)[0]:"grey")+" svelte-35lzg4"))&&p(i,"class",r);let se={};O[0]&2&&(se.amount=W[1]),m.$set(se);let X={};O[0]&32768&&(X.amount=W[15]),S.$set(X),O[0]&1&&Wt(A.value)!==W[0]&&Ge(A,W[0]),W[3]&&W[3].stacks>0?j?j.p(W,O):(j=D6(W),j.c(),j.m(e,M)):j&&(j.d(1),j=null),(!B||O[0]&65536&&E!==(E="marg btn formatted secondary "+(W[16]?"":"disabled")+" svelte-35lzg4"))&&p(M,"class",E),(!B||O[0]&8&&L!==(L="post "+(W[3]&&W[3].stacks>0?"postStacks":"")+" panel-black svelte-35lzg4"))&&p(e,"class",L)},i(W){B||(P(n.$$.fragment,W),P(m.$$.fragment,W),P(S.$$.fragment,W),B=!0)},o(W){q(n.$$.fragment,W),q(m.$$.fragment,W),q(S.$$.fragment,W),B=!1},d(W){W&&x(e),te(n),te(m),te(S),j&&j.d(),I=!1,at(N)}}}function VI(t){let e,n,i,s=hn(t[18].temp.type,t[18].temp.tier)+"",o,r,l,a,c,f,u;return{c(){e=h("span"),n=T("Stop "),i=h("span"),o=T(s),l=T(" from being listed?"),a=h("div"),a.textContent=`${C.ui.cancel}`,c=h("div"),c.textContent=`${C.ui.merchant.delist}`,p(i,"class",r="text"+Yt(t[18].temp.quality)[0]+" svelte-35lzg4"),p(e,"class","marg svelte-35lzg4"),p(a,"class","marg btn formatted grey svelte-35lzg4"),p(c,"class","marg btn formatted orange svelte-35lzg4")},m(m,g){w(m,e,g),d(e,n),d(e,i),d(i,o),d(e,l),w(m,a,g),w(m,c,g),f||(u=[Z(a,"click",t[29]),Z(c,"click",t[31])],f=!0)},p(m,g){g[0]&262144&&s!==(s=hn(m[18].temp.type,m[18].temp.tier)+"")&&G(o,s),g[0]&262144&&r!==(r="text"+Yt(m[18].temp.quality)[0]+" svelte-35lzg4")&&p(i,"class",r)},i:ue,o:ue,d(m){m&&(x(e),x(a),x(c)),f=!1,at(u)}}}function LI(t){let e,n=C.ui.merchant.buyItem[0]+"",i,s,o,r=t[18].temp.stacks>0?t[18].temp.stacks+" x ":"",l,a,c=hn(t[18].temp.type,t[18].temp.tier)+"",f,u,m,g=C.ui.merchant.buyItem[1]+"",v,_,b,y,k=C.ui.merchant.buyItem[2]+"",S,A,F,M,D,R;return b=new kn({props:{amount:t[18].temp.auctionprice}}),{c(){e=h("span"),i=T(n),s=Ne(),o=h("span"),l=T(r),a=h("span"),f=T(c),m=Ne(),v=T(g),_=Ne(),ne(b.$$.fragment),y=Ne(),S=T(k),A=h("div"),A.textContent=`${C.ui.cancel}`,F=h("div"),F.textContent=`${C.ui.merchant.buy}`,p(o,"class","textgreen"),p(a,"class",u="text"+Yt(t[18].temp.quality)[0]+" svelte-35lzg4"),p(e,"class","marg svelte-35lzg4"),p(A,"class","marg btn formatted grey svelte-35lzg4"),p(F,"class","marg btn formatted secondary svelte-35lzg4")},m(E,L){w(E,e,L),d(e,i),d(e,s),d(e,o),d(o,l),d(e,a),d(a,f),d(e,m),d(e,v),d(e,_),ee(b,e,null),d(e,y),d(e,S),w(E,A,L),w(E,F,L),M=!0,D||(R=[Z(A,"click",t[29]),Z(F,"click",t[30])],D=!0)},p(E,L){(!M||L[0]&262144)&&r!==(r=E[18].temp.stacks>0?E[18].temp.stacks+" x ":"")&&G(l,r),(!M||L[0]&262144)&&c!==(c=hn(E[18].temp.type,E[18].temp.tier)+"")&&G(f,c),(!M||L[0]&262144&&u!==(u="text"+Yt(E[18].temp.quality)[0]+" svelte-35lzg4"))&&p(a,"class",u);let B={};L[0]&262144&&(B.amount=E[18].temp.auctionprice),b.$set(B)},i(E){M||(P(b.$$.fragment,E),M=!0)},o(E){q(b.$$.fragment,E),M=!1},d(E){E&&(x(e),x(A),x(F)),te(b),D=!1,at(R)}}}function D6(t){let e,n,i,s,o,r,l;return{c(){e=h("select"),n=h("option"),n.textContent="Total",s=h("option"),s.textContent="Per Unit",n.__value=i=!1,Ge(n,n.__value),s.__value=o=!0,Ge(s,s.__value),p(e,"class","marg formatted svelte-35lzg4"),t[2]===void 0&&_n(()=>t[49].call(e))},m(a,c){w(a,e,c),d(e,n),d(e,s),wn(e,t[2],!0),r||(l=Z(e,"change",t[49]),r=!0)},p(a,c){c[0]&4&&wn(e,a[2])},d(a){a&&x(e),r=!1,l()}}}function qI(t){let e,n,i,s,o,r,l,a,c=C.ui.merchant.search+"",f,u,m,g=C.ui.merchant.previous+"",v,_,b,y=C.ui.merchant.next+"",k,S,A,F,M,D,R,E,L,B,I,N=C.ui.merchant.results+"",j,W,O=t[14]+1+"",se,X,oe=Math.ceil(t[19]/50)+"",ce,xe,pe,$e,Ee,Fe=t[32](t[10],"time",t[11])+"",_e,H=C.ui.merchant.time+"",Le,Oe,He,Ye=(t[12]?C.ui.merchant.perUnit:C.ui.merchant.total)+"",Ze,ge,ae,Be=t[32](t[10],"price",t[11])+"",J,Q=C.ui.merchant.price+"",U,fe,je,Ie,ye,qe,Re,pt,wt;function Qe(We){t[37](We)}function Et(We){t[38](We)}function be(We){t[39](We)}let Je={limit:10};t[8]!==void 0&&(Je.name=t[8]),t[7]!==void 0&&(Je.tier=t[7]),t[6]!==void 0&&(Je.type=t[6]),i=new F6({props:Je}),$t.push(()=>Lo(i,"name",Qe)),$t.push(()=>Lo(i,"tier",Et)),$t.push(()=>Lo(i,"type",be)),i.$on("finalize",t[23]);let yt=me(t[22]),St=[];for(let We=0;We<yt.length;We+=1)St[We]=T6(A6(t,yt,We));let Ae=me(t[17]),ft=[];for(let We=0;We<Ae.length;We+=1)ft[We]=E6(S6(t,Ae,We));let Ut=We=>q(ft[We],1,1,()=>{ft[We]=null}),Ve=[II,DI],Ct=[];function Vt(We,Ke){return We[18]?1:0}return ye=Vt(t,[-1,-1]),qe=Ct[ye]=Ve[ye](t),{c(){e=h("div"),n=h("section"),ne(i.$$.fragment),l=h("span"),a=h("div"),f=T(c),m=h("div"),v=T(g),b=h("div"),k=T(y),A=h("section");for(let We=0;We<St.length;We+=1)St[We].c();F=h("section"),M=h("div"),D=h("div"),R=h("div"),E=h("span"),L=h("span"),B=T(t[19]),I=Ne(),j=T(N),W=T(" ("),se=T(O),X=T("/"),ce=T(oe),xe=T(")"),pe=h("span"),pe.textContent="Lv.",$e=h("span"),$e.textContent=`${C.ui.merchant.owner}`,Ee=h("span"),_e=T(Fe),Le=T(H),He=h("span"),Ze=T(Ye),ae=h("span"),J=T(Be),U=T(Q),fe=Ne(),Ie=h("div");for(let We=0;We<ft.length;We+=1)ft[We].c();qe.c(),p(a,"class",u="btn formatted secondary "+(t[9]?"":"disabled")),p(m,"class",_="btn formatted grey "+(t[9]&&t[14]>0?"":"disabled")),p(b,"class",S="btn formatted grey "+(t[9]&&t[17].length==50?"":"disabled")),p(n,"class","search panel-black svelte-35lzg4"),p(A,"class","choices border grey scrollbar svelte-35lzg4"),p(L,"class","btn black disabled textgrey"),p(pe,"class","btn black disabled textgrey"),p($e,"class","btn black disabled textgrey"),p(Ee,"class",Oe="btn grey "+(t[9]?"":"disabled")+" "+(t[10]=="time"?"textprimary active":"")),p(He,"class",ge="btn grey "+(t[9]?"":"disabled")+" "+(t[12]?"textgreen":"")),ze(He,"text-align","end"),p(ae,"class",je="btn grey "+(t[9]?"":"disabled")+" "+(t[10]=="price"?"textprimary active":"")),ze(ae,"text-align","end"),p(R,"class","buytblhead svelte-35lzg4"),p(D,"class","scrollbar scrollbar-fix"),p(Ie,"class","scrollbar scrollbar-fix"),p(M,"class","buytable svelte-35lzg4"),p(F,"class","items border grey svelte-35lzg4"),p(e,"class","layout svelte-35lzg4")},m(We,Ke){w(We,e,Ke),d(e,n),ee(i,n,null),d(n,l),d(n,a),d(a,f),d(n,m),d(m,v),d(n,b),d(b,k),t[43](n),d(e,A);for(let we=0;we<St.length;we+=1)St[we]&&St[we].m(A,null);d(e,F),d(F,M),d(M,D),d(D,R),d(R,E),d(R,L),d(L,B),d(L,I),d(L,j),d(L,W),d(L,se),d(L,X),d(L,ce),d(L,xe),d(R,pe),d(R,$e),d(R,Ee),d(Ee,_e),d(Ee,Le),d(R,He),d(He,Ze),d(R,ae),d(ae,J),d(ae,U),d(ae,fe),d(M,Ie);for(let we=0;we<ft.length;we+=1)ft[we]&&ft[we].m(Ie,null);Ct[ye].m(e,null),Re=!0,pt||(wt=[Z(a,"click",t[40]),Z(m,"click",t[41]),Z(b,"click",t[42]),Z(Ee,"click",t[45]),Z(He,"click",t[34]),Z(ae,"click",t[46])],pt=!0)},p(We,Ke){let we={};if(!s&&Ke[0]&256&&(s=!0,we.name=We[8],Vo(()=>s=!1)),!o&&Ke[0]&128&&(o=!0,we.tier=We[7],Vo(()=>o=!1)),!r&&Ke[0]&64&&(r=!0,we.type=We[6],Vo(()=>r=!1)),i.$set(we),(!Re||Ke[0]&512&&u!==(u="btn formatted secondary "+(We[9]?"":"disabled")))&&p(a,"class",u),(!Re||Ke[0]&16896&&_!==(_="btn formatted grey "+(We[9]&&We[14]>0?"":"disabled")))&&p(m,"class",_),(!Re||Ke[0]&131584&&S!==(S="btn formatted grey "+(We[9]&&We[17].length==50?"":"disabled")))&&p(b,"class",S),Ke[0]&12599744){yt=me(We[22]);let Xe;for(Xe=0;Xe<yt.length;Xe+=1){let ut=A6(We,yt,Xe);St[Xe]?St[Xe].p(ut,Ke):(St[Xe]=T6(ut),St[Xe].c(),St[Xe].m(A,null))}for(;Xe<St.length;Xe+=1)St[Xe].d(1);St.length=yt.length}if((!Re||Ke[0]&524288)&&G(B,We[19]),(!Re||Ke[0]&16384)&&O!==(O=We[14]+1+"")&&G(se,O),(!Re||Ke[0]&524288)&&oe!==(oe=Math.ceil(We[19]/50)+"")&&G(ce,oe),(!Re||Ke[0]&3072)&&Fe!==(Fe=We[32](We[10],"time",We[11])+"")&&G(_e,Fe),(!Re||Ke[0]&1536&&Oe!==(Oe="btn grey "+(We[9]?"":"disabled")+" "+(We[10]=="time"?"textprimary active":"")))&&p(Ee,"class",Oe),(!Re||Ke[0]&4096)&&Ye!==(Ye=(We[12]?C.ui.merchant.perUnit:C.ui.merchant.total)+"")&&G(Ze,Ye),(!Re||Ke[0]&4608&&ge!==(ge="btn grey "+(We[9]?"":"disabled")+" "+(We[12]?"textgreen":"")))&&p(He,"class",ge),(!Re||Ke[0]&3072)&&Be!==(Be=We[32](We[10],"price",We[11])+"")&&G(J,Be),(!Re||Ke[0]&1536&&je!==(je="btn grey "+(We[9]?"":"disabled")+" "+(We[10]=="price"?"textprimary active":"")))&&p(ae,"class",je),Ke[0]&404103200){Ae=me(We[17]);let Xe;for(Xe=0;Xe<Ae.length;Xe+=1){let ut=S6(We,Ae,Xe);ft[Xe]?(ft[Xe].p(ut,Ke),P(ft[Xe],1)):(ft[Xe]=E6(ut),ft[Xe].c(),P(ft[Xe],1),ft[Xe].m(Ie,null))}for(Pe(),Xe=Ae.length;Xe<ft.length;Xe+=1)Ut(Xe);Te()}let ot=ye;ye=Vt(We,Ke),ye===ot?Ct[ye].p(We,Ke):(Pe(),q(Ct[ot],1,1,()=>{Ct[ot]=null}),Te(),qe=Ct[ye],qe?qe.p(We,Ke):(qe=Ct[ye]=Ve[ye](We),qe.c()),P(qe,1),qe.m(e,null))},i(We){if(!Re){P(i.$$.fragment,We);for(let Ke=0;Ke<Ae.length;Ke+=1)P(ft[Ke]);P(qe),Re=!0}},o(We){q(i.$$.fragment,We),ft=ft.filter(Boolean);for(let Ke=0;Ke<ft.length;Ke+=1)q(ft[Ke]);q(qe),Re=!1},d(We){We&&x(e),te(i),t[43](null),it(St,We),it(ft,We),Ct[ye].d(),pt=!1,at(wt)}}}function RI(t){let e,n,i=t[4]&&P6(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,o){s[4]?i?(i.p(s,o),o[0]&16&&P(i,1)):(i=P6(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function zI(t,e,n){let i,s,o,r,l,a;re(t,sa,ye=>n(35,i=ye)),re(t,cs,ye=>n(3,s=ye)),re(t,as,ye=>n(4,o=ye)),re(t,Sr,ye=>n(36,r=ye)),re(t,fm,ye=>n(19,l=ye));let c=tt.shift.store;re(t,c,ye=>n(20,a=ye));let f,u=[C.ui.all,C.ui.merchant.filtermine,null,"bow","hammer","staff","sword",null,"orb","quiver","shield","totem",null,"armlet","armor","boot","glove",null,"amulet","bag","ring",null,"book","rune","misc",null,"mount","pet","box"],m=u[0],g="all",v="",_=[],b=!0,y="price",k=1,S=!1,A=!1,F=0,M=()=>{if(b&&o){n(18,ce=void 0);let ye=u.indexOf(m);xt("itemauctionfind",`${ye} ${ye===1?"all":g} ${y==="time"?0:S?2:1} ${k} ${F}`),n(9,b=!1)}},D,R,E=!1,L,B,I=()=>{B&&xt("itemauctionpost",`${s.dbid} ${R}`)},N=ye=>{let{from:qe,to:Re}=ye.detail;qe!==Re&&qe.type=="item"&&cs.set(qe.item)},j=ye=>{s&&s.type&&Mt(Ri[s.type].sound),cs.set()},W,O=[],se=[],X=()=>{if(W=Date.now(),i.length){let ye=i.map(qe=>qe.dbid);fetch("/api/item/get",{method:"POST",body:JSON.stringify({auction:1,ids:ye})}).then(async qe=>{let Re=await qe.json();Re.fail?console.error(Re):(n(17,se.length=0,se),i.forEach((pt,wt)=>{let Qe=Re.find(Et=>Et.id===pt.dbid);Qe&&(Qe.store=O[wt]||(O[wt]=ie()),Qe.store.temp=pt,pt.hydrate(Qe),se.push(Qe.store))}),n(13,A=S),n(9,b=!0))})}else n(13,A=S),n(9,b=!0),n(17,se.length=0,se)},oe=ye=>{let qe=Math.ceil((ye-W)/6e4);return qe<60?`${qe} m`:`${Math.ceil(qe/60)} h`},ce,xe=ye=>{n(18,ce=ye)},pe=()=>{n(18,ce=void 0)},$e=()=>{xt("itemauctionbuy",ce.temp.dbid+""),pe()},Ee=()=>{xt("itemauctioncancel",ce.temp.dbid+""),pe()},Fe=(ye,qe,Re)=>ye==qe?Re==1?"\u{1F815} ":"\u{1F817} ":"",_e=ye=>{n(14,F=0),ye==y?n(11,k=k==1?0:1):n(10,y=ye),M()},H=()=>{n(12,S=!S),y=="price"?M():n(13,A=S)};cs.subscribe(ye=>{ye!==void 0&&(n(6,m=ye.type),n(7,g=ye.tier),n(11,k=1),n(10,y="price"),n(12,S=!0),n(14,F=0),M())});function Le(ye){v=ye,n(8,v)}function Oe(ye){g=ye,n(7,g)}function He(ye){m=ye,n(6,m)}let Ye=ye=>{n(14,F=0),M()},Ze=ye=>{n(14,F--,F),M()},ge=ye=>{n(14,F++,F),M()};function ae(ye){$t[ye?"unshift":"push"](()=>{f=ye,n(5,f)})}let Be=(ye,qe)=>{n(6,m=ye),n(8,v=""),n(7,g="all"),n(14,F=0),M()},J=ye=>_e("time"),Q=ye=>_e("price"),U=(ye,qe)=>xe(ye);function fe(){D=Wt(this.value),n(0,D),n(3,s),n(2,E),n(1,R),n(4,o)}function je(){E=ki(this),n(2,E)}let Ie=()=>{nt(as,o=void 0,o),n(8,v=""),n(7,g="all")};return t.$$.update=()=>{t.$$.dirty[0]&16|t.$$.dirty[1]&32&&o&&M(),t.$$.dirty[0]&16&&(o?n(18,ce=void 0):nt(cs,s=void 0,s)),t.$$.dirty[0]&15&&(vt(),n(0,D=vt(D,0,2147483646)),n(1,R=s?vt((parseInt(D)||0)*(E&&s.stacks||1),0,2147483646):0),n(15,L=Number.isInteger(R)?C6(R):0),n(16,B=Number.isInteger(R)&&R>0&&s&&s.canBeTraded())),t.$$.dirty[1]&16&&X()},[D,R,E,s,o,f,m,g,v,b,y,k,S,A,F,L,B,se,ce,l,a,c,u,M,I,N,j,oe,xe,pe,$e,Ee,Fe,_e,H,i,r,Le,Oe,He,Ye,Ze,ge,ae,Be,J,Q,U,fe,je,Ie]}var Rg=class extends Me{constructor(e){super(),Ce(this,e,zI,RI,Ue,{},null,[-1,-1])}},I6=Rg;var fd=[{name:"Year",days:365,price:9e3},{name:"Month",days:30,price:900}],$n=[{sub:!1,stash:15,inventory:15,auction:10,auctionHours:12},{sub:!0,stash:100,inventory:25,auction:100,auctionHours:24}];function V6(t,e,n){let i=t.slice();return i[32]=e[n],i}function L6(t){let e,n;return e=new Nt({props:{origin:"left top",defaultOffset:[3,100],title:"Stash",icon:"bag",$$slots:{default:[BI]},$$scope:{ctx:t}}}),e.$on("close",t[25]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s[0]&4095|s[1]&16&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function q6(t){let e;return{c(){e=h("div")},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function R6(t){let e,n;return e=new bi({props:{descPos:"left:100%;top:0;",shift:t[10],descRoot:t[3],pickable:!1,text:t[14](t[32].temp?t[32].temp.getStashTime():0),item:t[32],filter:!t[6]||(t[32].temp?t[32].temp.getStashTime()>t[4]?!0:"":!0)}}),e.$on("click",t[15]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s[0]&1024&&(o.shift=i[10]),s[0]&8&&(o.descRoot=i[3]),s[0]&32&&(o.text=i[14](i[32].temp?i[32].temp.getStashTime():0)),s[0]&32&&(o.item=i[32]),s[0]&112&&(o.filter=!i[6]||(i[32].temp?i[32].temp.getStashTime()>i[4]?!0:"":!0)),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function z6(t){let e,n,i;return{c(){e=h("span"),e.innerHTML='Upgrade <img class="svgicon texticon" src="/data/ui/icons/gem.svg?v=8588529"/>',p(e,"class","btn textwhite")},m(s,o){w(s,e,o),n||(i=Z(e,"click",t[21]),n=!0)},p:ue,d(s){s&&x(e),n=!1,i()}}}function B6(t){let e,n,i=(t[0]===1?C.ui.stash.deposit:C.ui.stash.withdraw)+"",s,o,r,l,a,c,f,u,m=(t[0]===1?C.ui.stash.deposit:C.ui.stash.withdraw)+"",g,v,_,b,y;return r=new kn({props:{amount:t[0]>0?t[1]:0}}),{c(){e=h("div"),n=h("span"),s=T(i),o=Ne(),ne(r.$$.fragment),l=T(" ?"),a=h("div"),c=h("input"),f=h("div"),f.textContent="Max",u=h("div"),g=T(m),ze(c,"width","150px"),p(c,"class","navbtn formatted"),p(c,"type","number"),p(f,"class","btn navbtn cyan formatted"),p(u,"class",v="btn navbtn "+(!t[6]||t[1]<=0?"disabled":"")+" "+(t[0]===1?"blue":"green")+" formatted"),p(a,"class","marg-top formelements svelte-2ka2l3"),p(e,"class","panel-black marg-top"),ze(e,"text-align","right")},m(k,S){w(k,e,S),d(e,n),d(n,s),d(n,o),ee(r,n,null),d(n,l),d(e,a),d(a,c),Ge(c,t[1]),d(a,f),d(a,u),d(u,g),_=!0,b||(y=[Z(c,"input",t[24]),Z(f,"click",t[17]),Z(u,"click",t[16])],b=!0)},p(k,S){(!_||S[0]&1)&&i!==(i=(k[0]===1?C.ui.stash.deposit:C.ui.stash.withdraw)+"")&&G(s,i);let A={};S[0]&3&&(A.amount=k[0]>0?k[1]:0),r.$set(A),S[0]&2&&Wt(c.value)!==k[1]&&Ge(c,k[1]),(!_||S[0]&1)&&m!==(m=(k[0]===1?C.ui.stash.deposit:C.ui.stash.withdraw)+"")&&G(g,m),(!_||S[0]&67&&v!==(v="btn navbtn "+(!k[6]||k[1]<=0?"disabled":"")+" "+(k[0]===1?"blue":"green")+" formatted"))&&p(u,"class",v)},i(k){_||(P(r.$$.fragment,k),_=!0)},o(k){q(r.$$.fragment,k),_=!1},d(k){k&&x(e),te(r),b=!1,at(y)}}}function BI(t){let e,n,i,s,o=t[5].length+"",r,l,a=(t[7].subscribed_until?$n[1].stash:$n[0].stash)+"",c,f,u,m,g,v,_,b,y,k,S,A,F,M,D,R,E=me(t[5]),L=[];for(let W=0;W<E.length;W+=1)L[W]=R6(V6(t,E,W));let B=W=>q(L[W],1,1,()=>{L[W]=null}),I=null;E.length||(I=q6(t));let N=!t[7].subscribed_until&&z6(t);m=new kn({props:{amount:t[2].gold}});let j=t[0]>0&&B6(t);return{c(){e=h("div");for(let W=0;W<L.length;W+=1)L[W].c();I&&I.c(),n=h("div"),i=h("div"),s=h("span"),r=T(o),l=T(" / "),c=T(a),N&&N.c(),u=h("div"),ne(m.$$.fragment),g=h("div"),v=h("img"),y=h("div"),k=h("img"),j&&j.c(),F=ve(),p(e,"class","panel-black slotcontainer scrollbar svelte-2ka2l3"),ze(e,"width",t[5].length?"fit-content":"auto"),ze(e,"grid-template-columns","repeat("+Math.min(t[5].length,t[8])+", auto)"),ze(e,"max-height",t[9]+"px"),p(s,"class",f=t[5].length<(t[7].subscribed_until?$n[1].stash:$n[0].stash)?"textgreen":"textred"),p(i,"class","navbtn panel-black border black gold svelte-2ka2l3"),ze(i,"margin-right","auto"),p(u,"class","navbtn panel-black border black gold svelte-2ka2l3"),p(v,"class","svgicon"),lt(v.src,_="/data/ui/icons/deposit.svg?v=8588529")||p(v,"src",_),p(g,"class",b="navbtn btn grey gold "+(t[0]===1?"active":"")+" svelte-2ka2l3"),p(k,"class","svgicon"),lt(k.src,S="/data/ui/icons/withdraw.svg?v=8588529")||p(k,"src",S),p(y,"class",A="navbtn btn grey gold "+(t[0]===2?"active":"")+" svelte-2ka2l3"),p(n,"class","formelements svelte-2ka2l3")},m(W,O){w(W,e,O);for(let se=0;se<L.length;se+=1)L[se]&&L[se].m(e,null);I&&I.m(e,null),t[20](e),w(W,n,O),d(n,i),d(i,s),d(s,r),d(s,l),d(s,c),N&&N.m(s,null),d(n,u),ee(m,u,null),d(n,g),d(g,v),d(n,y),d(y,k),j&&j.m(W,O),w(W,F,O),M=!0,D||(R=[Z(e,"pointerup",t[13]),Z(g,"click",t[22]),Z(y,"click",t[23])],D=!0)},p(W,O){if(O[0]&50296){E=me(W[5]);let X;for(X=0;X<E.length;X+=1){let oe=V6(W,E,X);L[X]?(L[X].p(oe,O),P(L[X],1)):(L[X]=R6(oe),L[X].c(),P(L[X],1),L[X].m(e,null))}for(Pe(),X=E.length;X<L.length;X+=1)B(X);Te(),!E.length&&I?I.p(W,O):E.length?I&&(I.d(1),I=null):(I=q6(W),I.c(),I.m(e,null))}(!M||O[0]&32)&&ze(e,"width",W[5].length?"fit-content":"auto"),(!M||O[0]&288)&&ze(e,"grid-template-columns","repeat("+Math.min(W[5].length,W[8])+", auto)"),(!M||O[0]&512)&&ze(e,"max-height",W[9]+"px"),(!M||O[0]&32)&&o!==(o=W[5].length+"")&&G(r,o),(!M||O[0]&128)&&a!==(a=(W[7].subscribed_until?$n[1].stash:$n[0].stash)+"")&&G(c,a),W[7].subscribed_until?N&&(N.d(1),N=null):N?N.p(W,O):(N=z6(W),N.c(),N.m(s,null)),(!M||O[0]&160&&f!==(f=W[5].length<(W[7].subscribed_until?$n[1].stash:$n[0].stash)?"textgreen":"textred"))&&p(s,"class",f);let se={};O[0]&4&&(se.amount=W[2].gold),m.$set(se),(!M||O[0]&1&&b!==(b="navbtn btn grey gold "+(W[0]===1?"active":"")+" svelte-2ka2l3"))&&p(g,"class",b),(!M||O[0]&1&&A!==(A="navbtn btn grey gold "+(W[0]===2?"active":"")+" svelte-2ka2l3"))&&p(y,"class",A),W[0]>0?j?(j.p(W,O),O[0]&1&&P(j,1)):(j=B6(W),j.c(),P(j,1),j.m(F.parentNode,F)):j&&(Pe(),q(j,1,1,()=>{j=null}),Te())},i(W){if(!M){for(let O=0;O<E.length;O+=1)P(L[O]);P(m.$$.fragment,W),P(j),M=!0}},o(W){L=L.filter(Boolean);for(let O=0;O<L.length;O+=1)q(L[O]);q(m.$$.fragment,W),q(j),M=!1},d(W){W&&(x(e),x(n),x(F)),it(L,W),I&&I.d(),t[20](null),N&&N.d(),te(m),j&&j.d(W),D=!1,at(R)}}}function UI(t){let e,n,i=t[2]&&t[7]&&L6(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,o){s[2]&&s[7]?i?(i.p(s,o),o[0]&132&&P(i,1)):(i=L6(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function OI(t,e,n){let i,s,o,r,l,a,c,f,u;re(t,Vi,oe=>n(2,i=oe)),re(t,Hi,oe=>n(18,s=oe)),re(t,En,oe=>n(28,o=oe)),re(t,um,oe=>n(19,r=oe)),re(t,ra,oe=>n(7,l=oe)),re(t,$r,oe=>n(8,a=oe)),re(t,Nr,oe=>n(9,c=oe)),re(t,Li,oe=>n(11,u=oe));let m=tt.shift.store;re(t,m,oe=>n(10,f=oe));let g,v,_=[],b=[],y=!1,k,S=async()=>{if(n(4,v=Date.now()),r.length){let ce=await(await fetch("/api/item/get",{method:"POST",body:JSON.stringify({stash:1,ids:r.map(xe=>xe.dbid)})})).json();if(ce.fail)console.error(ce);else{n(5,b.length=0,b);let xe=new Map(r.map(pe=>[pe.dbid,pe]));ce.forEach((pe,$e)=>{pe.store=_[$e]||(_[$e]=ie()),n(5,b[$e]=_[$e],b),xe.has(pe.id)&&(xe.get(pe.id).hydrate(pe),n(5,b[$e].temp=xe.get(pe.id),b))})}}else n(5,b.length=0,b);I()},A=oe=>{o&&(xt("itemstash",`${o.meta.slot}`),nt(En,o=void 0,o))},F=oe=>oe<v?void 0:`${Math.ceil((oe-v)/6e4)}m`,M=oe=>{y&&(oe.detail.item.getStashTime()>Date.now()?jt("system",C.ui.stash.waitunstash):(xt("itemunstash",oe.detail.item.dbid+""),B()))},D=oe=>{y&&(xt("goldstash",E===1?L+"":-L+""),B())},R=()=>{n(1,L=E===1?s:i.gold)},E=2,L=0,B=()=>{n(6,y=!1),k=setTimeout(()=>{n(6,y=!0)},500)},I=()=>{n(6,y=!0),k&&(clearTimeout(k),k=void 0)};function N(oe){$t[oe?"unshift":"push"](()=>{g=oe,n(3,g)})}let j=oe=>nt(Li,u=!0,u),W=oe=>n(0,E=1),O=oe=>n(0,E=2);function se(){L=Wt(this.value),n(1,L),n(2,i),n(0,E),n(18,s)}let X=oe=>nt(Vi,i=!1,i);return t.$$.update=()=>{t.$$.dirty[0]&524288&&S(),t.$$.dirty[0]&262151&&n(1,L=i?Math.min(E===1?s:i.gold,L):0)},[E,L,i,g,v,b,y,l,a,c,f,u,m,A,F,M,D,R,s,r,N,j,W,O,se,X]}var zg=class extends Me{constructor(e){super(),Ce(this,e,OI,UI,Ue,{},null,[-1,-1])}},U6=zg;function $I(t,e,n){let i=t.slice();return i[7]=e[n],i[9]=n,i}function O6(t,e,n){let i=t.slice();return i[10]=e[n],i}function $6(t){let e,n;return e=new Nt({props:{origin:"center",title:C.npcs.trader.name,icon:"bag",$$slots:{default:[YI]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&8195&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function N6(t){let e,n;return e=new bi({props:{id:"trader"+t[10][0].buyid,descPos:"left:100%;top:0;",descRoot:t[0],isTrader:!0,pickable:!1,item:t[10][1]}}),e.$on("click",t[4]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&1&&(o.descRoot=i[0]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function NI(t){let e,n;return e=new bi({props:{isTrader:!0}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p:ue,i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function jI(t){let e;return{c(){e=h("span"),e.textContent=`${C.npcs.trader.select}`,p(e,"class","textgrey")},m(n,i){w(n,e,i)},p:ue,i:ue,o:ue,d(n){n&&x(e)}}}function WI(t){let e,n,i,s,o,r=[HI,GI],l=[];function a(c,f){return f&2&&(e=null),e==null&&(e=!!c[1].data.canBeSold()),e?0:1}return n=a(t,-1),i=l[n]=r[n](t),{c(){i.c(),s=ve()},m(c,f){l[n].m(c,f),w(c,s,f),o=!0},p(c,f){let u=n;n=a(c,f),n===u?l[n].p(c,f):(Pe(),q(l[u],1,1,()=>{l[u]=null}),Te(),i=l[n],i?i.p(c,f):(i=l[n]=r[n](c),i.c()),P(i,1),i.m(s.parentNode,s))},i(c){o||(P(i),o=!0)},o(c){q(i),o=!1},d(c){c&&x(s),l[n].d(c)}}}function GI(t){let e;return{c(){e=h("span"),e.textContent=`${C.npcs.trader.refuse}`,p(e,"class","textred")},m(n,i){w(n,e,i)},p:ue,i:ue,o:ue,d(n){n&&x(e)}}}function HI(t){let e,n;return e=new kn({props:{amount:t[1].data.goldValue()}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&2&&(o.amount=i[1].data.goldValue()),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function YI(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v=me(V.player.getTargetEntity().items),_=[];for(let M=0;M<v.length;M+=1)_[M]=N6(O6(t,v,M));let b=M=>q(_[M],1,1,()=>{_[M]=null}),y=me(Array(24-V.player.getTargetEntity().items.length)),k=[];for(let M=0;M<y.length;M+=1)k[M]=NI($I(t,y,M));let S=[WI,jI],A=[];function F(M,D){return M[1]&&M[1].meta.type==="item"?0:1}return c=F(t,-1),f=A[c]=S[c](t),{c(){e=h("div"),n=h("p"),n.textContent=`${C.npcs.trader.buy}`,i=h("div");for(let M=0;M<_.length;M+=1)_[M].c();s=ve();for(let M=0;M<k.length;M+=1)k[M].c();o=h("div"),r=h("p"),r.textContent=`${C.npcs.trader.info}`,l=h("p"),l.textContent=`${C.npcs.trader.price}`,a=h("span"),f.c(),p(n,"class","textprimary textcenter"),p(i,"class","panel-black slotcontainer svelte-12uytpc"),p(r,"class","textprimary"),p(a,"class","panel-black formatted info svelte-12uytpc"),p(o,"class","textcenter"),p(e,"class","container svelte-12uytpc")},m(M,D){w(M,e,D),d(e,n),d(e,i);for(let R=0;R<_.length;R+=1)_[R]&&_[R].m(i,null);d(i,s);for(let R=0;R<k.length;R+=1)k[R]&&k[R].m(i,null);d(e,o),d(o,r),d(o,l),d(o,a),A[c].m(a,null),t[5](e),u=!0,m||(g=Z(e,"pointerup",t[3]),m=!0)},p(M,D){if(D&17){v=me(V.player.getTargetEntity().items);let E;for(E=0;E<v.length;E+=1){let L=O6(M,v,E);_[E]?(_[E].p(L,D),P(_[E],1)):(_[E]=N6(L),_[E].c(),P(_[E],1),_[E].m(i,s))}for(Pe(),E=v.length;E<_.length;E+=1)b(E);Te()}let R=c;c=F(M,D),c===R?A[c].p(M,D):(Pe(),q(A[R],1,1,()=>{A[R]=null}),Te(),f=A[c],f?f.p(M,D):(f=A[c]=S[c](M),f.c()),P(f,1),f.m(a,null))},i(M){if(!u){for(let D=0;D<v.length;D+=1)P(_[D]);for(let D=0;D<y.length;D+=1)P(k[D]);P(f),u=!0}},o(M){_=_.filter(Boolean);for(let D=0;D<_.length;D+=1)q(_[D]);k=k.filter(Boolean);for(let D=0;D<k.length;D+=1)q(k[D]);q(f),u=!1},d(M){M&&x(e),it(_,M),it(k,M),A[c].d(),t[5](null),m=!1,g()}}}function XI(t){let e,n,i=t[2]&&$6(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[2]?i?(i.p(s,o),o&4&&P(i,1)):(i=$6(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function QI(t,e,n){let i,s;re(t,En,f=>n(1,i=f)),re(t,Yi,f=>n(2,s=f));let o=f=>{i&&i.meta&&i.meta.type==="item"&&i.data.canBeSold()&&Uf(i.data.quality,i.data.upgrade,i.meta.slot,i.data.type,i.data.tier),nt(En,i=void 0,i)},r=f=>{xt("itemtraderbuy",`${f.detail.item.buyid}`)},l;function a(f){$t[f?"unshift":"push"](()=>{l=f,n(0,l)})}return[l,i,s,o,r,a,f=>nt(Yi,s=!1,s)]}var Bg=class extends Me{constructor(e){super(),Ce(this,e,QI,XI,Ue,{})}},j6=Bg;function W6(t,e,n){let i=t.slice();return i[13]=e[n],i[15]=n,i}function G6(t,e,n){let i=t.slice();return i[16]=e[n],i[15]=n,i}function H6(t,e,n){let i=t.slice();return i[18]=e[n],i}function Y6(t){let e,n,i,s=t[16].classcount[t[18]]+"",o,r;return{c(){e=h("div"),n=h("div"),n.innerHTML=`<img class="texticon" src="${Ys(t[18])}"/>`,i=h("b"),o=T(s),p(i,"class",r=t[16].classcount[t[18]]>0?"textprimary":"textgrey")},m(l,a){w(l,e,a),d(e,n),d(e,i),d(i,o)},p(l,a){a&4&&s!==(s=l[16].classcount[l[18]]+"")&&G(o,s),a&4&&r!==(r=l[16].classcount[l[18]]>0?"textprimary":"textgrey")&&p(i,"class",r)},d(l){l&&x(e)}}}function X6(t){let e,n,i,s=t[16].message+"",o,r,l=t[4][t[16].activity]+"",a,c,f,u,m,g=t[16].minlevel+"",v,_,b=t[16].maxlevel+"",y,k,S,A,F,M,D;k=new zi({props:{name:t[16].leadername,level:t[16].leaderlevel,pclass:t[16].leaderclass,faction:t[16].faction}});let R=me([0,1,2,3]),E=[];for(let I=0;I<4;I+=1)E[I]=Y6(H6(t,R,I));function L(...I){return t[10](t[16],...I)}function B(...I){return t[11](t[16],...I)}return{c(){e=h("div"),n=h("div"),i=h("div"),o=T(s),r=h("div"),a=T(l),c=h("div"),f=h("div"),u=T("Lv. "),m=h("span"),v=T(g),_=T(" - "),y=T(b),ne(k.$$.fragment),S=h("div");for(let I=0;I<4;I+=1)E[I].c();p(i,"class","textprimary"),p(r,"class","textgrey textsmall"),ze(n,"text-overflow","ellipsis"),ze(n,"white-space","nowrap"),ze(n,"overflow","hidden"),p(m,"class","textgreen"),p(f,"class","textgrey"),p(c,"class","textcenter"),p(S,"class","grid four textcenter"),p(e,"class",A="panel-black listing marg-bot "+(t[1]===t[16]?"selected":t[5][t[16].applied])+" svelte-12t87hd")},m(I,N){w(I,e,N),d(e,n),d(n,i),d(i,o),d(n,r),d(r,a),d(e,c),d(c,f),d(f,u),d(f,m),d(m,v),d(m,_),d(m,y),ee(k,c,null),d(e,S);for(let j=0;j<4;j+=1)E[j]&&E[j].m(S,null);F=!0,M||(D=[Z(e,"click",L),Z(e,"contextmenu",B)],M=!0)},p(I,N){t=I,(!F||N&4)&&s!==(s=t[16].message+"")&&G(o,s),(!F||N&4)&&l!==(l=t[4][t[16].activity]+"")&&G(a,l),(!F||N&4)&&g!==(g=t[16].minlevel+"")&&G(v,g),(!F||N&4)&&b!==(b=t[16].maxlevel+"")&&G(y,b);let j={};if(N&4&&(j.name=t[16].leadername),N&4&&(j.level=t[16].leaderlevel),N&4&&(j.pclass=t[16].leaderclass),N&4&&(j.faction=t[16].faction),k.$set(j),N&4){R=me([0,1,2,3]);let W;for(W=0;W<4;W+=1){let O=H6(t,R,W);E[W]?E[W].p(O,N):(E[W]=Y6(O),E[W].c(),E[W].m(S,null))}for(;W<4;W+=1)E[W].d(1)}(!F||N&6&&A!==(A="panel-black listing marg-bot "+(t[1]===t[16]?"selected":t[5][t[16].applied])+" svelte-12t87hd"))&&p(e,"class",A)},i(I){F||(P(k.$$.fragment,I),F=!0)},o(I){q(k.$$.fragment,I),F=!1},d(I){I&&x(e),te(k),it(E,I),M=!1,at(D)}}}function Q6(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[13]}`,e.__value=n=t[15],Ge(e,e.__value)},m(i,s){w(i,e,s)},p:ue,d(i){i&&x(e)}}}function ZI(t){let e,n,i,s,o,r,l,a,c;return{c(){e=h("div"),n=h("div"),i=T("\u{1F64B} Apply"),o=h("div"),r=T("\u{1F50E} Refresh"),p(n,"class",s="btn textcenter "+(t[1]&&t[1].applied===0?"green":"disabled")),p(o,"class",l="btn textcenter "+(t[0]?"disabled":"cyan")),p(e,"class","panel-black grid two")},m(f,u){w(f,e,u),d(e,n),d(n,i),d(e,o),d(o,r),a||(c=[Z(n,"click",t[7]),Z(o,"click",t[6])],a=!0)},p(f,u){u&2&&s!==(s="btn textcenter "+(f[1]&&f[1].applied===0?"green":"disabled"))&&p(n,"class",s),u&1&&l!==(l="btn textcenter "+(f[0]?"disabled":"cyan"))&&p(o,"class",l)},d(f){f&&x(e),a=!1,at(c)}}}function JI(t){let e;return{c(){e=h("div"),e.textContent="You are in a party.",p(e,"class","textcenter panel-black textgrey")},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function KI(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v,_,b=me(t[2].parties.filter(t[9])),y=[];for(let R=0;R<b.length;R+=1)y[R]=X6(G6(t,b,R));let k=R=>q(y[R],1,1,()=>{y[R]=null}),S=me(t[4]),A=[];for(let R=0;R<S.length;R+=1)A[R]=Q6(W6(t,S,R));function F(R,E){return R[3].membercount>0?JI:ZI}let M=F(t,-1),D=M(t);return{c(){e=h("div"),n=h("div");for(let R=0;R<y.length;R+=1)y[R].c();i=h("div"),s=h("div"),o=h("small"),o.textContent="Filter Party Listings",r=h("div"),l=h("div"),l.textContent="Activity",a=h("select"),c=h("option"),c.textContent="All";for(let R=0;R<A.length;R+=1)A[R].c();u=h("small"),u.textContent="More filters to come!",m=Ne(),D.c(),p(n,"class","listcontainer scrollbar border grey svelte-12t87hd"),ze(n,"font-size","0.9em"),p(o,"class","textprimary"),c.__value=f=-1,Ge(c,c.__value),p(a,"class","btn grey small"),t[2].filterActivity===void 0&&_n(()=>t[12].call(a)),p(u,"class","textgrey"),p(r,"class","grid two search svelte-12t87hd"),p(s,"class","panel-black"),p(i,"class","grid"),ze(i,"grid-template-rows","1fr auto"),p(e,"class","layout svelte-12t87hd")},m(R,E){w(R,e,E),d(e,n);for(let L=0;L<y.length;L+=1)y[L]&&y[L].m(n,null);d(e,i),d(i,s),d(s,o),d(s,r),d(r,l),d(r,a),d(a,c);for(let L=0;L<A.length;L+=1)A[L]&&A[L].m(a,null);wn(a,t[2].filterActivity,!0),d(r,u),d(i,m),D.m(i,null),g=!0,v||(_=Z(a,"change",t[12]),v=!0)},p(R,[E]){if(E&310){b=me(R[2].parties.filter(R[9]));let L;for(L=0;L<b.length;L+=1){let B=G6(R,b,L);y[L]?(y[L].p(B,E),P(y[L],1)):(y[L]=X6(B),y[L].c(),P(y[L],1),y[L].m(n,null))}for(Pe(),L=b.length;L<y.length;L+=1)k(L);Te()}if(E&16){S=me(R[4]);let L;for(L=0;L<S.length;L+=1){let B=W6(R,S,L);A[L]?A[L].p(B,E):(A[L]=Q6(B),A[L].c(),A[L].m(a,null))}for(;L<A.length;L+=1)A[L].d(1);A.length=S.length}E&4&&wn(a,R[2].filterActivity),M===(M=F(R,E))&&D?D.p(R,E):(D.d(1),D=M(R),D&&(D.c(),D.m(i,null)))},i(R){if(!g){for(let E=0;E<b.length;E+=1)P(y[E]);g=!0}},o(R){y=y.filter(Boolean);for(let E=0;E<y.length;E+=1)q(y[E]);g=!1},d(R){R&&x(e),it(y,R),it(A,R),D.d(),v=!1,_()}}}function eV(t,e,n){let i,s;re(t,nm,b=>n(2,i=b)),re(t,Qn,b=>n(3,s=b));let o=C.ui.party.activities,r=["","applied","denied"],l=!1,a,c=async()=>{n(0,l=!0);let b=await Ot("/api/party/getlistedparties",{},()=>{});nt(nm,i.parties=b,i),a&&n(1,a=b.find(y=>y.party===a.party)),setTimeout(()=>n(0,l=!1),200)};c();let f=()=>{a&&(n(1,a.applied=1,a),Ot("/api/party/makeapplication",{party:a.party,message:""},()=>{}),n(1,a=void 0))},u=(b,y)=>{bn.set({x:b.pageX,y:b.pageY,opts:[{name:y.leadername,css:"disabled"},nn.whisper(y.leadername)]})},m=b=>i.filterActivity===-1||b.activity===i.filterActivity,g=(b,y)=>n(1,a=b),v=(b,y)=>u(y,b);function _(){i.filterActivity=ki(this),nm.set(i)}return[l,a,i,s,o,r,c,f,u,m,g,v,_]}var Ug=class extends Me{constructor(e){super(),Ce(this,e,eV,KI,Ue,{})}},Z6=Ug;var ud=async t=>{let e;try{e=await Ot("/api/party/getpartystate",{},()=>{})}catch{e=void 0}e&&Gi.update(n=>{let i=!1;return e.applications.forEach(s=>{n.applications.find(r=>r.player===s.player)||(i=!0)}),n.applications=e.applications,n.message=e.message||n.message||"",n.activity=e.activity||n.activity||0,n.listed=e.listed,n.flashing=i&&!le.partyOpen,n})};function J6(t,e,n){let i=t.slice();return i[14]=e[n],i[16]=n,i}function K6(t,e,n){let i=t.slice();return i[17]=e[n],i[16]=n,i}function tV(t){let e,n,i,s=me(t[1].applications),o=[];for(let l=0;l<s.length;l+=1)o[l]=eF(K6(t,s,l));let r=l=>q(o[l],1,1,()=>{o[l]=null});return{c(){e=h("table"),n=h("tbody");for(let l=0;l<o.length;l+=1)o[l].c();p(e,"class","dense"),ze(e,"width","100%"),ze(e,"table-layout","fixed")},m(l,a){w(l,e,a),d(e,n);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(n,null);i=!0},p(l,a){if(a&226){s=me(l[1].applications);let c;for(c=0;c<s.length;c+=1){let f=K6(l,s,c);o[c]?(o[c].p(f,a),P(o[c],1)):(o[c]=eF(f),o[c].c(),P(o[c],1),o[c].m(n,null))}for(Pe(),c=s.length;c<o.length;c+=1)r(c);Te()}},i(l){if(!i){for(let a=0;a<s.length;a+=1)P(o[a]);i=!0}},o(l){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)q(o[a]);i=!1},d(l){l&&x(e),it(o,l)}}}function nV(t){let e;function n(o,r){return o[1].listed?sV:iV}let i=n(t,-1),s=i(t);return{c(){e=h("p"),s.c(),p(e,"class","textcenter textgrey")},m(o,r){w(o,e,r),s.m(e,null)},p(o,r){i!==(i=n(o,r))&&(s.d(1),s=i(o),s&&(s.c(),s.m(e,null)))},i:ue,o:ue,d(o){o&&x(e),s.d()}}}function eF(t){let e,n,i,s,o=t[17].gearscore+"",r,l,a,c,f,u,m,g,v,_,b;i=new zi({props:{name:t[17].name,level:t[17].level,pclass:t[17].class,faction:t[17].faction}});function y(...A){return t[8](t[17],...A)}function k(...A){return t[9](t[17],...A)}function S(...A){return t[10](t[17],...A)}return{c(){e=h("tr"),n=h("td"),ne(i.$$.fragment),s=h("td"),r=T(o),l=T(" GS"),a=h("td"),c=T("\u{1F91D}"),u=h("td"),m=T("\u274C"),p(n,"width","50%"),p(s,"width","20%"),p(s,"class","textcenter textcyan"),p(a,"width","15%"),p(a,"class",f="textcenter accept "+(t[17].invited?"active":"")+" svelte-6mz3cb"),p(u,"width","15%"),p(u,"class",g="textcenter deny "+(t[17].denied?"active":"")+" svelte-6mz3cb"),p(e,"class","striped"),ze(e,"cursor","unset")},m(A,F){w(A,e,F),d(e,n),ee(i,n,null),d(e,s),d(s,r),d(s,l),d(e,a),d(a,c),d(e,u),d(u,m),v=!0,_||(b=[Z(a,"click",y),Z(u,"click",k),Z(e,"contextmenu",S)],_=!0)},p(A,F){t=A;let M={};F&2&&(M.name=t[17].name),F&2&&(M.level=t[17].level),F&2&&(M.pclass=t[17].class),F&2&&(M.faction=t[17].faction),i.$set(M),(!v||F&2)&&o!==(o=t[17].gearscore+"")&&G(r,o),(!v||F&2&&f!==(f="textcenter accept "+(t[17].invited?"active":"")+" svelte-6mz3cb"))&&p(a,"class",f),(!v||F&2&&g!==(g="textcenter deny "+(t[17].denied?"active":"")+" svelte-6mz3cb"))&&p(u,"class",g)},i(A){v||(P(i.$$.fragment,A),v=!0)},o(A){q(i.$$.fragment,A),v=!1},d(A){A&&x(e),te(i),_=!1,at(b)}}}function iV(t){let e;return{c(){e=T("List your party to search for players")},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function sV(t){let e;return{c(){e=T("Waiting for players...")},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function tF(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[14]}`,e.__value=n=t[16],Ge(e,e.__value)},m(i,s){w(i,e,s)},p:ue,d(i){i&&x(e)}}}function oV(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v,_,b,y,k=t[1].listed?"\u{1F441}\uFE0F Unlist":"List",S,A,F,M,D,R,E=[nV,tV],L=[];function B(j,W){return j[1].applications.length===0?0:1}i=B(t,-1),s=L[i]=E[i](t);let I=me(t[3]),N=[];for(let j=0;j<I.length;j+=1)N[j]=tF(J6(t,I,j));return{c(){e=h("div"),n=h("div"),s.c(),o=h("div"),r=h("div"),l=h("div"),a=h("small"),a.textContent="Describe your party",c=h("input"),m=h("div"),g=h("small"),g.textContent="Select an activity",v=h("select");for(let j=0;j<N.length;j+=1)N[j].c();b=h("div"),y=h("div"),S=T(k),A=T(" Party"),p(n,"class","listcontainer scrollbar border grey svelte-6mz3cb"),p(a,"class","textprimary"),p(c,"maxlength",f=40),p(c,"class",u="marg-top "+(t[2].role<2||t[1].listed?"disabled":"")),p(c,"type","text"),p(c,"placeholder","Enter Party Message"),p(l,"class","panel-bright"),p(g,"class","textprimary"),p(v,"class",_="btn grey marg-top "+(t[2].role<2||t[1].listed?"disabled":"")),t[1].activity===void 0&&_n(()=>t[12].call(v)),p(m,"class","panel-bright marg-top"),p(r,"class","panel-black "),p(y,"class",F="btn purp textcenter "+(t[2].role<2||t[0]?"disabled":t[1].listed?"active":"")),p(b,"class","panel-black"),p(o,"class","grid"),ze(o,"grid-template-rows","1fr auto"),p(e,"class","layout svelte-6mz3cb")},m(j,W){w(j,e,W),d(e,n),L[i].m(n,null),d(e,o),d(o,r),d(r,l),d(l,a),d(l,c),Ge(c,t[1].message),d(r,m),d(m,g),d(m,v);for(let O=0;O<N.length;O+=1)N[O]&&N[O].m(v,null);wn(v,t[1].activity,!0),d(o,b),d(b,y),d(y,S),d(y,A),M=!0,D||(R=[Z(c,"input",t[11]),Z(v,"change",t[12]),Z(y,"click",t[4])],D=!0)},p(j,[W]){let O=i;if(i=B(j,W),i===O?L[i].p(j,W):(Pe(),q(L[O],1,1,()=>{L[O]=null}),Te(),s=L[i],s?s.p(j,W):(s=L[i]=E[i](j),s.c()),P(s,1),s.m(n,null)),(!M||W&6&&u!==(u="marg-top "+(j[2].role<2||j[1].listed?"disabled":"")))&&p(c,"class",u),W&2&&c.value!==j[1].message&&Ge(c,j[1].message),W&8){I=me(j[3]);let se;for(se=0;se<I.length;se+=1){let X=J6(j,I,se);N[se]?N[se].p(X,W):(N[se]=tF(X),N[se].c(),N[se].m(v,null))}for(;se<N.length;se+=1)N[se].d(1);N.length=I.length}(!M||W&6&&_!==(_="btn grey marg-top "+(j[2].role<2||j[1].listed?"disabled":"")))&&p(v,"class",_),W&2&&wn(v,j[1].activity),(!M||W&2)&&k!==(k=j[1].listed?"\u{1F441}\uFE0F Unlist":"List")&&G(S,k),(!M||W&7&&F!==(F="btn purp textcenter "+(j[2].role<2||j[0]?"disabled":j[1].listed?"active":"")))&&p(y,"class",F)},i(j){M||(P(s),M=!0)},o(j){q(s),M=!1},d(j){j&&x(e),L[i].d(),it(N,j),D=!1,at(R)}}}function rV(t,e,n){let i,s;re(t,Gi,y=>n(1,i=y)),re(t,Qn,y=>n(2,s=y));let o=C.ui.party.activities,r,l=!1;ud();let a=async()=>{n(0,l=!0),i.listed?(nt(Gi,i.listed=!1,i),await Ot("/api/party/unlistparty",{},()=>{})):(nt(Gi,i.listed=!0,i),await Ot("/api/party/listparty",{message:i.message,activity:i.activity},()=>{})),n(0,l=!1)},c=y=>{xt("partyinvite",y.name),y.invited=!0,y.denied=!1,Gi.set(i)},f=y=>{y.denied=!0,y.invited=!1,nt(Gi,i.applications=i.applications.filter(k=>k.player!==y.player),i),Ot("/api/party/denyapplication",{player:y.player},()=>{})},u=(y,k)=>{bn.set({x:y.pageX,y:y.pageY,opts:[{name:k.name,css:"disabled"},nn.whisper(k.name)]})},m=(y,k)=>{c(y)},g=(y,k)=>{f(y)},v=(y,k)=>u(k,y);function _(){i.message=this.value,Gi.set(i)}function b(){i.activity=ki(this),Gi.set(i)}return[l,i,s,o,a,c,f,u,m,g,v,_,b]}var Og=class extends Me{constructor(e){super(),Ce(this,e,rV,oV,Ue,{})}},nF=Og;function iF(t){let e,n;return e=new Nt({props:{origin:"center",title:"\u{1F465} Party",$$slots:{default:[cV]},$$scope:{ctx:t}}}),e.$on("close",t[3]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&67&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function lV(t){let e,n;return e=new nF({}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function aV(t){let e,n;return e=new Z6({}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function cV(t){let e,n,i,s,o,r,l,a,c,f,u,m=[aV,lV],g=[];function v(_,b){return _[1]===0||_[0].membercount===0?0:1}return l=v(t,-1),a=g[l]=m[l](t),{c(){e=h("div"),n=h("div"),i=h("div"),i.textContent="Party List",s=h("div"),o=T("Your Party"),a.c(),p(i,"class","tab"),Do(i,"active",t[1]===0),p(s,"class",r="tab "+(t[0].membercount===0?"disabled":"")),Do(s,"active",t[1]===1),p(n,"class","tab-bar flex"),p(e,"class","container svelte-6dw5x1")},m(_,b){w(_,e,b),d(e,n),d(n,i),d(n,s),d(s,o),g[l].m(e,null),c=!0,f||(u=[Z(i,"click",t[4]),Z(s,"click",t[5])],f=!0)},p(_,b){(!c||b&2)&&Do(i,"active",_[1]===0),(!c||b&1&&r!==(r="tab "+(_[0].membercount===0?"disabled":"")))&&p(s,"class",r),(!c||b&3)&&Do(s,"active",_[1]===1);let y=l;l=v(_,b),l!==y&&(Pe(),q(g[y],1,1,()=>{g[y]=null}),Te(),a=g[l],a||(a=g[l]=m[l](_),a.c()),P(a,1),a.m(e,null))},i(_){c||(P(a),c=!0)},o(_){q(a),c=!1},d(_){_&&x(e),g[l].d(),f=!1,at(u)}}}function fV(t){let e,n,i=t[2]&&iF(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[2]?i?(i.p(s,o),o&4&&P(i,1)):(i=iF(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function uV(t,e,n){let i,s;re(t,Zi,c=>n(2,i=c)),re(t,Qn,c=>n(0,s=c));let o=0,r=c=>nt(Zi,i=!1,i),l=()=>{n(1,o=0)},a=()=>{n(1,o=1)};return t.$$.update=()=>{t.$$.dirty&1&&s.membercount===0&&n(1,o=0)},[s,o,i,r,l,a]}var $g=class extends Me{constructor(e){super(),Ce(this,e,uV,fV,Ue,{})}},sF=$g;var md=t=>t.type==="pet"&&t.upgrade>=1?!1:t.stacks===void 0&&t.rolls.length>0&&!Sn[t.type].noupgrade,oF=t=>t<101,pd=t=>{if(!md(t)||t.type==="pet")return 0;let e=rn[t.type+t.tier];return Math.ceil(((1+e.level*(1+t.upgrade))/Sn[t.type].drop)**(1.2+t.upgrade*.2))+100},rF=t=>{if(md(t)){let e=[];if(t.type==="pet")e.push({type:"box",tier:2});else for(let n=0;n<Math.max(1,t.upgrade);++n)e.push({type:"rune",tier:n,stacks:Math.max(1,Math.min(2,t.upgrade-n))});return e}else return[]};var lF=(t,e,n,i)=>Math.ceil(t.goldValue||(.4*(t.level**1.3+e*.4))**(1.1+e/100)/Sn[t.type].drop)*(n||1)*(i?8:1);var dd=class{constructor(e){this.dbid=e,this.stats=new Map,this.dirty=!0}hydrate(e){if(this.dirty=!1,this.bound=e.bound,this.type=e.type,this.tier=e.tier,this.logic=rn[this.type+this.tier],this.auction=e.auction?new Date(e.auction):void 0,this.auctionprice=e.auctionprice,this.owner=e.name,this.stash=e.stash?new Date(e.stash):void 0,this.logic===void 0)throw"Unknown item "+e.type+e.tier;if(this.upgrade=e.upgrade,this.stats.clear(),e.rolls){if(this.setRolls(e.rolls),this.quality=this.nextRoll(),this.logic.stats){this.logic.stats.forEach((i,s)=>{this.stats.set(s,{type:"base",qual:this.quality,value:Math.floor(i.min+(i.max-i.min)*(this.quality/100)**2+Bf[s]*this.upgrade)})});let n=Math.min(4,Math.round((this.quality/100)**1.5*3.6));for(let i=0;i<n;++i){let s=this.nextRoll(),o=-1;for(;o===-1||this.stats.has(o);)o=parseInt(v1(Nk,s/101)),s=(s+5)%100;let r=(this.nextRoll()+this.quality)/2;this.stats.set(o,{type:"bonus",qual:r,value:Math.ceil(Math.max((zf[o].min+(zf[o].max-zf[o].min)*(r/100)**2)*this.logic.level*Sn[this.type].weight,Bf[o])+Bf[o]*this.upgrade)})}}this.quality=this.logic.quality||this.quality,this.stacks=void 0}else this.stacks=e.stacks,this.quality=this.logic.quality||0;this.gs=0,this.logic.gs?this.gs=this.logic.gs:this.stats.forEach((n,i)=>{if(i===17)return;let s=n.value/Bf[i];this.type=="shield"&&n.type=="base"&&(s*=.5),this.type=="orb"&&n.type=="base"&&(s*=.7),this.gs+=s}),this.gs=Math.round(this.gs)}setRolls(e){this.rolls=e,this.currentRoll=0}nextRoll(){if(this.currentRoll==this.rolls.length)throw"roll maximum reached";return this.rolls[this.currentRoll++]}goldValue(e){if(!this.canBeSold())throw"Item cant have value because it cant be sold";return lF(this.logic,this.quality,this.stacks,e)}storeValue(){return this.logic.storeValue||0}medalValue(){return this.logic.medalValue||0}canEquip(e){return o6(e.level,e.skills.skillIdsActive,e.skills.skillIdsLearned,e.class,this.type,this.tier)}canEquipClass(e){return Xa(e.class,this.type,this.tier)}equipReasons(e){let n=[];return this.logic.level&&n.push(["Lv. "+this.logic.level,!0]),n}canBeDropped(){return!Sn[this.type].undroppable&&!this.bound}canBeTraded(){return!this.bound}canBeSold(){return!this.logic.unsellable}getStashTime(){return this.dirty?0:this.stash!==void 0?this.stash.getTime():0}getEquipSlot(){return Sn[this.type].slot!==void 0?Sn[this.type].slot[0]:void 0}};var Wg={};Xn(Wg,{addExp:()=>jg,addGold:()=>gd,init:()=>tu,onWorldEnter:()=>mV,tick:()=>pV,values:()=>ys});var ys=new Map,Ng=new kt(0,1),hd=0,tu=()=>{ys.set("exp",0),ys.set("gold",0),Ng.reset(0),hd=0},mV=tu,pV=t=>{Ng.done(V.time)&&(++hd,Ng.reset(V.time),mm.set({gold:ys.get("gold"),gph:ys.get("gold")/hd*60*60}),pm.set({exp:ys.get("exp"),exph:ys.get("exp")/hd*60*60}))},jg=t=>{ys.set("exp",(ys.get("exp")||0)+t)},gd=t=>{ys.set("gold",(ys.get("gold")||0)+t)};var aF=(t,e,n)=>{if(t&&t.type)switch(e){case 13:t.rolls&&t.quality>=70&&Mt(t.quality<90?98:99);case 1:le.chat[7]&&jt("inv",C.ui.inventory.pick.replace("$1",hn(t.type,t.tier)),!0),tn(10,100),Mt(Ri[t.type].sound),Pi[12].element="bag"+n,t.type=="book"&&tn(23,100)&&(Pi[24].element="bag"+n);break;case 10:t.rolls&&Uo.update(i=>(oa.set(t.upgrade-i.upgrade),t));break}},cF=(t,e)=>{if(t&&t.type)switch(e){case 7:le.chat[8]&&jt("inv",C.ui.stash.stashed.replace("$1",hn(t.type,t.tier))),Mt(Ri[t.type].sound);break;case 6:cs.set(),Sr.update(n=>!n),le.chat[8]&&jt("inv",C.ui.merchant.auctionpost.replace("$1",hn(t.type,t.tier)));break;case 9:le.chat[8]&&jt("inv",C.ui.inventory.sold.replace("$1",hn(t.type,t.tier))),Mt(Ri[t.type].sound);break;case 2:le.chat[7]&&jt("inv",C.ui.inventory.throw.replace("$1",hn(t.type,t.tier))),Mt(Ri[t.type].sound);break}},nu=(t,e,n,i)=>{n!=0&&Mt(Ri.gold.sound);let s=i+e;switch(n){case 1:le.chat[9]&&jt("inv",C.ui.inventory.pick.replace("$1",s),!0),gd(e);break;case 4:Sr.update(o=>!o),le.chat[10]&&jt("inv",C.ui.merchant.auctionbuy.replace("$1",s),!0);break;case 12:case 3:le.chat[10]&&jt("inv",C.ui.inventory.spend.replace("$1",s),!0);break;case 11:le.chat[10]&&jt("inv",C.ui.inventory.death.replace("$1",s),!0);break;case 9:le.chat[10]&&jt("inv",C.ui.inventory.receive.replace("$1",s),!0),gd(e);break}};var Xs=class extends dd{constructor(e){super(e)}hydrate(e){super.hydrate(e),e.store?e.store.set(this):console.error("no store for item",e),aF(this,this.reason,e.slot)}equipReasons(e){let n=[];if(this.logic.class!==void 0&&n.push(["Class: "+C.classes[this.logic.class].name,Xa(e.class,this.type,this.tier)]),this.logic.level&&n.push(["Requires Lv. "+this.logic.level,Eg(e.level,this.type,this.tier)]),this.logic.requiredSkill&&n.push(["Must know: "+C.items.book[this.logic.requiredSkill].name,Vg(e.skills.skillIdsActive,this.type,this.tier)]),Xa(e.class,this.type,this.tier)&&this.type=="book"){let i=Ig(e.skills.skillIdsLearned,this.type,this.tier),s=eu(e.skills.skillIdsLearned,this.logic.skillid);n.push([i?"Use book to learn skill":s>=this.logic.skilllevel?"You already know this skill":`Must learn book Lv. ${this.logic.skilllevel} first`,i])}return n}buyReasons(e){let n=[];return this.logic.buyElo!==void 0&&n.push([`Min. Rating: ${Of(this.logic.buyElo)}`,r6(e.elo,this.type,this.tier)]),n}getBestEquipslot(e){let n=Sn[this.type].slot;return n===void 0?void 0:n.find(s=>e.slots.get(s)===void 0)||n[0]}};function fF(t,e,n){let i=t.slice();return i[18]=e[n],i}function uF(t){let e,n;return e=new Nt({props:{origin:"center",title:"Blacksmith",icon:"bag",$$slots:{default:[dV]},$$scope:{ctx:t}}}),e.$on("close",t[13]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&2097661&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function mF(t){let e;return{c(){e=h("div")},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function pF(t){let e,n;return e=new bi({props:{pickable:!1,item:t[18],filter:t[18].filter}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&8&&(o.item=i[18]),s&8&&(o.filter=i[18].filter),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function dV(t){let e,n,i,s=(t[7]||"Place an item into the upgrade slot")+"",o,r,l,a,c,f,u,m,g,v,_,b,y,k,S,A;a=new bi({props:{clearOnMove:!0,invslot:t[0]?t[2]:void 0,pickable:!0,item:Uo,filter:t[5]?!0:""}}),a.$on("discard",t[10]),a.$on("move",t[9]);let F=me(t[3]),M=[];for(let E=0;E<F.length;E+=1)M[E]=pF(fF(t,F,E));let D=E=>q(M[E],1,1,()=>{M[E]=null}),R=null;return F.length||(R=mF(t)),v=new kn({props:{isPrice:!0,amount:t[0]?pd(t[0]):0}}),{c(){e=h("div"),n=h("h3"),n.textContent="Upgrade Item",i=h("span"),o=T(s),l=h("div"),ne(a.$$.fragment),f=h("div"),u=h("span"),u.textContent="Cost:",m=h("div");for(let E=0;E<M.length;E+=1)M[E].c();R&&R.c(),g=h("div"),ne(v.$$.fragment),_=h("div"),b=T("Upgrade"),p(n,"class","textwhite"),p(i,"class",r="panel-black upgradetext "+t[8]+" svelte-1u9u6qj"),p(l,"class",c="upgradeslot "+t[6]+" svelte-1u9u6qj"),p(m,"class","panel-black costgrid svelte-1u9u6qj"),ze(m,"grid-template-columns","repeat("+Math.min(3,t[3].length||1)+", 30px)"),p(_,"class",y="btn primary formatted textcenter upgradebutton "+(t[4]?"":"disabled")+" svelte-1u9u6qj"),p(f,"class","upgrade svelte-1u9u6qj"),p(e,"class","container textcenter svelte-1u9u6qj")},m(E,L){w(E,e,L),d(e,n),d(e,i),d(i,o),d(e,l),ee(a,l,null),d(e,f),d(f,u),d(f,m);for(let B=0;B<M.length;B+=1)M[B]&&M[B].m(m,null);R&&R.m(m,null),d(f,g),ee(v,g,null),d(f,_),d(_,b),k=!0,S||(A=Z(_,"click",t[11]),S=!0)},p(E,L){(!k||L&128)&&s!==(s=(E[7]||"Place an item into the upgrade slot")+"")&&G(o,s),(!k||L&256&&r!==(r="panel-black upgradetext "+E[8]+" svelte-1u9u6qj"))&&p(i,"class",r);let B={};if(L&5&&(B.invslot=E[0]?E[2]:void 0),L&32&&(B.filter=E[5]?!0:""),a.$set(B),(!k||L&64&&c!==(c="upgradeslot "+E[6]+" svelte-1u9u6qj"))&&p(l,"class",c),L&8){F=me(E[3]);let N;for(N=0;N<F.length;N+=1){let j=fF(E,F,N);M[N]?(M[N].p(j,L),P(M[N],1)):(M[N]=pF(j),M[N].c(),P(M[N],1),M[N].m(m,null))}for(Pe(),N=F.length;N<M.length;N+=1)D(N);Te(),!F.length&&R?R.p(E,L):F.length?R&&(R.d(1),R=null):(R=mF(E),R.c(),R.m(m,null))}(!k||L&8)&&ze(m,"grid-template-columns","repeat("+Math.min(3,E[3].length||1)+", 30px)");let I={};L&1&&(I.amount=E[0]?pd(E[0]):0),v.$set(I),(!k||L&16&&y!==(y="btn primary formatted textcenter upgradebutton "+(E[4]?"":"disabled")+" svelte-1u9u6qj"))&&p(_,"class",y)},i(E){if(!k){P(a.$$.fragment,E);for(let L=0;L<F.length;L+=1)P(M[L]);P(v.$$.fragment,E),k=!0}},o(E){q(a.$$.fragment,E),M=M.filter(Boolean);for(let L=0;L<M.length;L+=1)q(M[L]);q(v.$$.fragment,E),k=!1},d(E){E&&x(e),te(a),it(M,E),R&&R.d(),te(v),S=!1,A()}}}function hV(t){let e,n,i=t[1]&&uF(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[1]?i?(i.p(s,o),o&2&&P(i,1)):(i=uF(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function gV(t,e,n){let i,s,o,r,l;re(t,oa,F=>n(12,i=F)),re(t,Uo,F=>n(0,s=F)),re(t,ia,F=>n(14,o=F)),re(t,Hi,F=>n(15,r=F)),re(t,Os,F=>n(1,l=F));let a=F=>{let{from:M,to:D}=F.detail;M!==D&&M.type=="item"&&(Uo.set(M.item),n(2,f=M.slot))},c=F=>{Uo.set(),n(2,f=void 0)},f,u=[],m=!1,g=!1,v=()=>{let F=md(s),M=r>=pd(s),D=oF(f);n(4,m=F&&M&&D);let R=rF(s);R.forEach((E,L)=>{let B=u[L]||n(3,u[L]=ie(),u),I=new Xs;I.hydrate({...E,store:B}),I.stacks!==void 0?B.filter=o[I.type+I.tier]>=I.stacks?"":!0:B.filter=o[I.type+I.tier]>=0?"":!0,B.filter&&n(4,m=!1)}),n(3,u=u.slice(0,R.length)),m||n(7,y="You lack the required materials"),F||n(7,y="This item cannot be upgraded"),M||n(7,y="You do not have enough gold"),D||n(7,y="You must un-equip the item first"),m?(n(8,k="textgreen"),n(7,y="Ready to upgrade")):n(8,k="textred")},_=()=>{s&&m&&!g&&(n(5,g=!0),nt(oa,i=void 0,i),n(7,y="Upgrading..."),n(8,k="textprimary"),Mt(100),setTimeout(()=>xt("itemblacksmithupgrade",`${s.dbid}`),1e3))},b,y,k,S=()=>{Mt(i>0?101:102),n(6,b=i>0?"flash_success":"flash_fail"),n(7,y=(i>0?"Success! ":"Fail! ")+(i<0?"-":"+")+i),n(8,k=i>0?"textgreen":"textred")},A=F=>nt(Os,l=!1,l);return t.$$.update=()=>{t.$$.dirty&2&&(l||(nt(Uo,s=void 0,s),nt(oa,i=void 0,i))),t.$$.dirty&1&&(n(4,m=!0),s?v():(n(3,u.length=0,u),n(4,m=!1),n(8,k=void 0),n(7,y=void 0)),n(5,g=!1)),t.$$.dirty&4096&&(i!==void 0?S():(n(6,b=""),n(8,k="")))},[s,l,f,u,m,g,b,y,k,a,c,_,i,A]}var Gg=class extends Me{constructor(e){super(),Ce(this,e,gV,hV,Ue,{})}},dF=Gg;function vV(t){let e;return{c(){e=h("span")},m(n,i){w(n,e,i),e.innerHTML=t[0]},p(n,[i]){i&1&&(e.innerHTML=n[0])},i:ue,o:ue,d(n){n&&x(e)}}}function _V(t,e,n){let i,{amount:s}=e;return t.$$set=o=>{"amount"in o&&n(1,s=o.amount)},t.$$.update=()=>{t.$$.dirty&2&&n(0,i=Of(s))},[i,s]}var Hg=class extends Me{constructor(e){super(),Ce(this,e,_V,vV,Fn,{amount:1})}},vd=Hg;var Yg=Ba({0:{6:2,8:.3},1:{6:4,12:1},2:{14:.5},3:{14:.4,7:.8},4:{16:.3,7:.8},5:{14:.2,18:.3}});var hF=t=>1+t/1e3;function bV(t){let e,n=C.ui.stats.array[t[1]]+"",i,s,o=(t[3]?"+"+ii(t[1],t[0].get(t[2]).get(t[1])):ii(t[1],t[4][t[1]]||0))+"",r,l;return{c(){e=h("span"),i=T(n),s=h("span"),r=T(o),p(s,"class",l="statnumber "+(t[3]?"textgreen":t[0]?"textprimary":"textgreen"))},m(a,c){w(a,e,c),d(e,i),w(a,s,c),d(s,r)},p(a,[c]){c&2&&n!==(n=C.ui.stats.array[a[1]]+"")&&G(i,n),c&31&&o!==(o=(a[3]?"+"+ii(a[1],a[0].get(a[2]).get(a[1])):ii(a[1],a[4][a[1]]||0))+"")&&G(r,o),c&9&&l!==(l="statnumber "+(a[3]?"textgreen":a[0]?"textprimary":"textgreen"))&&p(s,"class",l)},i:ue,o:ue,d(a){a&&(x(e),x(s))}}}function yV(t,e,n){let i,s;re(t,Oo,a=>n(4,s=a));let{relmap:o}=e,{id:r}=e,{relation:l=void 0}=e;return t.$$set=a=>{"relmap"in a&&n(0,o=a.relmap),"id"in a&&n(1,r=a.id),"relation"in a&&n(2,l=a.relation)},t.$$.update=()=>{t.$$.dirty&7&&n(3,i=l!==void 0&&o.get(l).get(r)!==void 0)},[o,r,l,i,s]}var Xg=class extends Me{constructor(e){super(),Ce(this,e,yV,bV,Ue,{relmap:0,id:1,relation:2})}},_d=Xg;var Fo=[4e3,8e3,12e3,16e3,2e4,24e3,28e3,32e3,36e3,4e4,44e3,48e3];var cr=Fo.length,Qa=t=>{for(let e=0;e<cr;++e)if(Fo[e]>t)return e;return Math.max(0,cr)},yd=t=>t===0?0:Fo[t-1],Qg=t=>{for(let e=0;e<cr;++e)if(Fo[e]>t)return Fo[e];return Fo[cr-1]},bd=[1,.8,.63,.479,.342,.23,.146,.085,.045,.024,.01,.003,0],ffe=bd.map(t=>1-t);var iu=t=>t===0?"No Bracket":t===bd.length?bd.length+" (Faction Leader)":`${t} (Top ${(bd[t-1]*100).toFixed(1)}%)`;function gF(t,e,n){let i=t.slice();return i[12]=e[n],i[14]=n,i}function vF(t,e,n){let i=t.slice();return i[15]=e[n],i}function _F(t,e,n){let i=t.slice();return i[18]=e[n],i[20]=n,i}function bF(t,e,n){let i=t.slice();return i[15]=e[n],i}function yF(t){let e,n;return e=new Nt({props:{title:C.ui.headers.character,icon:"char",origin:"left top",defaultOffset:[3,100],$$slots:{default:[kV]},$$scope:{ctx:t}}}),e.$on("close",t[11]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&8388727&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function kF(t){let e,n,i,s,o,r,l;e=new _d({props:{id:t[15]}});function a(...f){return t[8](t[15],...f)}function c(...f){return t[10](t[15],...f)}return{c(){ne(e.$$.fragment),n=h("img"),lt(n.src,i="/data/ui/icons/arrow.svg?v=8588529")||p(n,"src",i),p(n,"class",s="btn "+(t[0][22]>0?"green":"disabled")+" svgicon statbtn svelte-rbq5ku")},m(f,u){ee(e,f,u),w(f,n,u),o=!0,r||(l=[Z(n,"pointerenter",a),Z(n,"pointerleave",t[9]),Z(n,"click",c)],r=!0)},p(f,u){t=f,(!o||u&1&&s!==(s="btn "+(t[0][22]>0?"green":"disabled")+" svgicon statbtn svelte-rbq5ku"))&&p(n,"class",s)},i(f){o||(P(e.$$.fragment,f),o=!0)},o(f){q(e.$$.fragment,f),o=!1},d(f){f&&x(n),te(e,f),r=!1,at(l)}}}function xF(t){let e,n;return e=new bi({props:{descPos:"left:100%;top:0;",item:t[18],invslot:101+t[20]}}),e.$on("use",SF),e.$on("context",SF),e.$on("move",wV),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&64&&(o.item=i[18]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function wF(t){let e,n;return e=new _d({props:{id:t[15],relmap:Jg,relation:t[1]}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&2&&(o.relation=i[1]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function MF(t){let e,n,i=me(t[12]),s=[];for(let r=0;r<i.length;r+=1)s[r]=wF(vF(t,i,r));let o=r=>q(s[r],1,1,()=>{s[r]=null});return{c(){e=h("div");for(let r=0;r<s.length;r+=1)s[r].c();p(e,"class","statcol panel-black svelte-rbq5ku")},m(r,l){w(r,e,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null);n=!0},p(r,l){if(l&2){i=me(r[12]);let a;for(a=0;a<i.length;a+=1){let c=vF(r,i,a);s[a]?(s[a].p(c,l),P(s[a],1)):(s[a]=wF(c),s[a].c(),P(s[a],1),s[a].m(e,null))}for(Pe(),a=i.length;a<s.length;a+=1)o(a);Te()}},i(r){if(!n){for(let l=0;l<i.length;l+=1)P(s[l]);n=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)q(s[l]);n=!1},d(r){r&&x(e),it(s,r)}}}function kV(t){let e,n,i,s,o=t[4].name+"",r,l,a,c=t[4].level+"",f,u,m,g,v,_,b=C.classes[t[4].class].name+"",y,k,S,A,F,M,D,R=C.factions[t[4].faction].name+"",E,L,B,I,N,j,W,O=ht(t[0][20]||0)+"",se,X,oe=t[2]<cr?"/ "+ni(Fo[t[2]]):"",ce,xe,pe=C.ui.charpanel.rank+"",$e,Ee,Fe,_e,H,Le,Oe,He,Ye,Ze,ge,ae,Be,J,Q,U,fe;Ye=new vd({props:{amount:t[0][21]||0}}),ge=new or({props:{amount:t[5],isPrice:!1}});let je=me([0,1,2,3,4,5]),Ie=[];for(let be=0;be<6;be+=1)Ie[be]=kF(bF(t,je,be));let ye=be=>q(Ie[be],1,1,()=>{Ie[be]=null});J=new _d({props:{id:22}});let qe=me(t[6].filter(AF)),Re=[];for(let be=0;be<qe.length;be+=1)Re[be]=xF(_F(t,qe,be));let pt=be=>q(Re[be],1,1,()=>{Re[be]=null}),wt=me(CF),Qe=[];for(let be=0;be<wt.length;be+=1)Qe[be]=MF(gF(t,wt,be));let Et=be=>q(Qe[be],1,1,()=>{Qe[be]=null});return{c(){e=h("div"),n=h("div"),i=h("span"),i.textContent=`${C.ui.charpanel.name}`,s=h("span"),r=T(o),l=h("span"),l.textContent=`${C.ui.charpanel.level}`,a=h("span"),f=T(c),u=h("span"),u.textContent=`${C.ui.charpanel.class}`,m=h("span"),g=h("img"),_=Ne(),y=T(b),S=h("span"),S.textContent=`${C.ui.charpanel.faction}`,A=h("span"),F=h("img"),D=Ne(),E=T(R),B=h("span"),B.textContent=`${C.ui.stats.array[20]}`,I=h("span"),N=h("img"),W=Ne(),se=T(O),X=Ne(),ce=T(oe),xe=T(" ("),$e=T(pe),Ee=Ne(),Fe=T(t[2]),_e=T("/"),H=T(cr),Le=T(")"),Oe=h("span"),Oe.textContent=`${C.ui.charpanel.rating}`,He=h("span"),ne(Ye.$$.fragment),Ze=h("span"),Ze.textContent=`${C.ui.charpanel.medals}`,ne(ge.$$.fragment),ae=h("div");for(let be=0;be<6;be+=1)Ie[be].c();Be=ve(),ne(J.$$.fragment),Q=h("div");for(let be=0;be<Re.length;be+=1)Re[be].c();U=h("div");for(let be=0;be<Qe.length;be+=1)Qe[be].c();p(s,"class","bold textwhite"),p(a,"class","bold textwhite"),p(g,"class","texticon"),lt(g.src,v=Ys(t[4].class))||p(g,"src",v),p(m,"class",k="bold "+("textc"+t[4].class)+" svelte-rbq5ku"),p(F,"class","texticon"),lt(F.src,M=F1(t[4].faction))||p(F,"src",M),p(A,"class",L="bold "+("textf"+t[4].faction)+" svelte-rbq5ku"),p(N,"class","texticon"),lt(N.src,j=za)||p(N,"src",j),p(I,"class","bold textprestige"),p(n,"class","statcol panel-black svelte-rbq5ku"),ze(n,"grid-template-columns","1fr 2fr"),p(ae,"id","statpoints"),p(ae,"class","statcol panel-black svelte-rbq5ku"),ze(ae,"grid-template-columns","1fr auto auto"),p(e,"class","grid"),ze(e,"grid-template-columns","3fr 2fr"),p(Q,"id","equipslots"),p(Q,"class","items svelte-rbq5ku"),p(U,"class","grid three stats2 svelte-rbq5ku")},m(be,Je){w(be,e,Je),d(e,n),d(n,i),d(n,s),d(s,r),d(n,l),d(n,a),d(a,f),d(n,u),d(n,m),d(m,g),d(m,_),d(m,y),d(n,S),d(n,A),d(A,F),d(A,D),d(A,E),d(n,B),d(n,I),d(I,N),d(I,W),d(I,se),d(I,X),d(I,ce),d(I,xe),d(I,$e),d(I,Ee),d(I,Fe),d(I,_e),d(I,H),d(I,Le),d(n,Oe),d(n,He),ee(Ye,He,null),d(n,Ze),ee(ge,n,null),d(e,ae);for(let yt=0;yt<6;yt+=1)Ie[yt]&&Ie[yt].m(ae,null);d(ae,Be),ee(J,ae,null),w(be,Q,Je);for(let yt=0;yt<Re.length;yt+=1)Re[yt]&&Re[yt].m(Q,null);w(be,U,Je);for(let yt=0;yt<Qe.length;yt+=1)Qe[yt]&&Qe[yt].m(U,null);fe=!0},p(be,Je){(!fe||Je&16)&&o!==(o=be[4].name+"")&&G(r,o),(!fe||Je&16)&&c!==(c=be[4].level+"")&&G(f,c),(!fe||Je&16&&!lt(g.src,v=Ys(be[4].class)))&&p(g,"src",v),(!fe||Je&16)&&b!==(b=C.classes[be[4].class].name+"")&&G(y,b),(!fe||Je&16&&k!==(k="bold "+("textc"+be[4].class)+" svelte-rbq5ku"))&&p(m,"class",k),(!fe||Je&16&&!lt(F.src,M=F1(be[4].faction)))&&p(F,"src",M),(!fe||Je&16)&&R!==(R=C.factions[be[4].faction].name+"")&&G(E,R),(!fe||Je&16&&L!==(L="bold "+("textf"+be[4].faction)+" svelte-rbq5ku"))&&p(A,"class",L),(!fe||Je&1)&&O!==(O=ht(be[0][20]||0)+"")&&G(se,O),(!fe||Je&4)&&oe!==(oe=be[2]<cr?"/ "+ni(Fo[be[2]]):"")&&G(ce,oe),(!fe||Je&4)&&G(Fe,be[2]);let yt={};Je&1&&(yt.amount=be[0][21]||0),Ye.$set(yt);let St={};if(Je&32&&(St.amount=be[5]),ge.$set(St),Je&131){je=me([0,1,2,3,4,5]);let Ae;for(Ae=0;Ae<6;Ae+=1){let ft=bF(be,je,Ae);Ie[Ae]?(Ie[Ae].p(ft,Je),P(Ie[Ae],1)):(Ie[Ae]=kF(ft),Ie[Ae].c(),P(Ie[Ae],1),Ie[Ae].m(ae,Be))}for(Pe(),Ae=6;Ae<6;Ae+=1)ye(Ae);Te()}if(Je&64){qe=me(be[6].filter(AF));let Ae;for(Ae=0;Ae<qe.length;Ae+=1){let ft=_F(be,qe,Ae);Re[Ae]?(Re[Ae].p(ft,Je),P(Re[Ae],1)):(Re[Ae]=xF(ft),Re[Ae].c(),P(Re[Ae],1),Re[Ae].m(Q,null))}for(Pe(),Ae=qe.length;Ae<Re.length;Ae+=1)pt(Ae);Te()}if(Je&2){wt=me(CF);let Ae;for(Ae=0;Ae<wt.length;Ae+=1){let ft=gF(be,wt,Ae);Qe[Ae]?(Qe[Ae].p(ft,Je),P(Qe[Ae],1)):(Qe[Ae]=MF(ft),Qe[Ae].c(),P(Qe[Ae],1),Qe[Ae].m(U,null))}for(Pe(),Ae=wt.length;Ae<Qe.length;Ae+=1)Et(Ae);Te()}},i(be){if(!fe){P(Ye.$$.fragment,be),P(ge.$$.fragment,be);for(let Je=0;Je<6;Je+=1)P(Ie[Je]);P(J.$$.fragment,be);for(let Je=0;Je<qe.length;Je+=1)P(Re[Je]);for(let Je=0;Je<wt.length;Je+=1)P(Qe[Je]);fe=!0}},o(be){q(Ye.$$.fragment,be),q(ge.$$.fragment,be),Ie=Ie.filter(Boolean);for(let Je=0;Je<6;Je+=1)q(Ie[Je]);q(J.$$.fragment,be),Re=Re.filter(Boolean);for(let Je=0;Je<Re.length;Je+=1)q(Re[Je]);Qe=Qe.filter(Boolean);for(let Je=0;Je<Qe.length;Je+=1)q(Qe[Je]);fe=!1},d(be){be&&(x(e),x(Q),x(U)),te(Ye),te(ge),it(Ie,be),te(J),it(Re,be),it(Qe,be)}}}function xV(t){let e,n,i=t[3]&&t[4].visible&&yF(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[3]&&s[4].visible?i?(i.p(s,o),o&24&&P(i,1)):(i=yF(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}var FF=!1,Jg=new Map;Yg.forEach((t,e)=>{let n=new Map;t.forEach((i,s)=>{n.set(s,i)}),Jg.set(e,n)});var CF=[[6,8,7,9,12,13],[10,11,17,14,16],[15,19,18,25,26]],wV=t=>{let{from:e,to:n}=t.detail;e!==n&&e.type=="item"&&xt("itemmove",`${e.slot} ${n.slot}`)},SF=t=>{let{item:e}=t.detail;if(e!==void 0){let n=V.player.inventory.getFirstEmptySlot();n>=0&&xt("itemmove",`${t.detail.slot} ${n}`)}},AF=(t,e)=>e>=101;function MV(t,e,n){let i,s,o,r,l,a;re(t,Oo,_=>n(0,s=_)),re(t,mo,_=>n(3,o=_)),re(t,Rs,_=>n(4,r=_)),re(t,ta,_=>n(5,l=_)),re(t,na,_=>n(6,a=_)),V&&V.player&&!FF&&(FF=!0,dl.forEach((_,b)=>{b-61==V.player.class&&_.statsConvert&&_.statsConvert.forEach(y=>{let k=Yg.get(y[0])||new Map;k.set(y[2],(k.get(y[2])||0)+y[1]),Jg.set(y[0],k)})}));let c,f=_=>{s[22]&&(xt("statincrease",_+" "+(tt.shift.down?10:1)),n(1,c=void 0),tn(18,50))},u=(_,b)=>n(1,c=_),m=_=>n(1,c=void 0),g=(_,b)=>f(_),v=()=>{nt(mo,o=!1,o)};return t.$$.update=()=>{t.$$.dirty&1&&n(2,i=Qa(s[20]||0))},[s,c,i,o,r,l,a,f,u,m,g,v]}var Zg=class extends Me{constructor(e){super(),Ce(this,e,MV,xV,Ue,{})}},PF=Zg;function TF(t,e,n){let i=t.slice();return i[16]=e[n],i}function FV(t){let e,n,i=t[4].listed?"\u{1F441}\uFE0F ":"",s,o=t[2].membercount+"",r,l,a,c,f;return{c(){e=h("div"),n=h("span"),s=T(i),r=T(o),l=T("/10"),p(e,"id","partybtn"),p(e,"class",a="btn border black textgreen "+(t[4].flashing?"flashing":"")+" svelte-14vfgvr")},m(u,m){w(u,e,m),d(e,n),d(n,s),d(e,r),d(e,l),c||(f=Z(e,"click",t[11]),c=!0)},p(u,m){m&16&&i!==(i=u[4].listed?"\u{1F441}\uFE0F ":"")&&G(s,i),m&4&&o!==(o=u[2].membercount+"")&&G(r,o),m&16&&a!==(a="btn border black textgreen "+(u[4].flashing?"flashing":"")+" svelte-14vfgvr")&&p(e,"class",a)},d(u){u&&x(e),c=!1,f()}}}function CV(t){let e,n,i;return{c(){e=h("div"),e.textContent=`${C.ui.party.noParty}`,p(e,"id","partybtn"),p(e,"class","btn border black textgrey")},m(s,o){w(s,e,o),n||(i=Z(e,"click",t[10]),n=!0)},p:ue,d(s){s&&x(e),n=!1,i()}}}function SV(t){let e=t[2].exprate+"",n,i,s=t[2].membercount===0?"":"/"+t[2].nearby,o;return{c(){n=T(e),i=T("% EXP"),o=T(s)},m(r,l){w(r,n,l),w(r,i,l),w(r,o,l)},p(r,l){l&4&&e!==(e=r[2].exprate+"")&&G(n,e),l&4&&s!==(s=r[2].membercount===0?"":"/"+r[2].nearby)&&G(o,s)},d(r){r&&(x(n),x(i),x(o))}}}function AV(t){let e=ht(~~t[1].exph)+"",n,i;return{c(){n=T(e),i=T(" EXP / h")},m(s,o){w(s,n,o),w(s,i,o)},p(s,o){o&2&&e!==(e=ht(~~s[1].exph)+"")&&G(n,e)},d(s){s&&(x(n),x(i))}}}function PV(t){let e=t[2].itemfind+"",n,i;return{c(){n=T(e),i=T("% FIND")},m(s,o){w(s,n,o),w(s,i,o)},p(s,o){o&4&&e!==(e=s[2].itemfind+"")&&G(n,e)},i:ue,o:ue,d(s){s&&(x(n),x(i))}}}function TV(t){let e,n,i;return e=new kn({props:{amount:Math.round(t[0].gph)}}),{c(){ne(e.$$.fragment),n=T(" / h")},m(s,o){ee(e,s,o),w(s,n,o),i=!0},p(s,o){let r={};o&1&&(r.amount=Math.round(s[0].gph)),e.$set(r)},i(s){i||(P(e.$$.fragment,s),i=!0)},o(s){q(e.$$.fragment,s),i=!1},d(s){s&&x(n),te(e,s)}}}function EF(t,e){let n,i,s;return i=new Zf({props:{mode:"party",unit:e[16].unitStore,buffs:e[16].buffStore}}),{key:t,first:null,c(){n=ve(),ne(i.$$.fragment),this.first=n},m(o,r){w(o,n,r),ee(i,o,r),s=!0},p(o,r){e=o;let l={};r&256&&(l.unit=e[16].unitStore),r&256&&(l.buffs=e[16].buffStore),i.$set(l)},i(o){s||(P(i.$$.fragment,o),s=!0)},o(o){q(i.$$.fragment,o),s=!1},d(o){o&&x(n),te(i,o)}}}function EV(t){let e,n,i,s,o,r,l,a,c,f=[],u=new Map,m,g,v;function _(L,B){return L[2].membercount===0?CV:FV}let b=_(t,-1),y=b(t);function k(L,B){return L[5]?AV:SV}let S=k(t,-1),A=S(t),F=[TV,PV],M=[];function D(L,B){return L[6]?0:1}r=D(t,-1),l=M[r]=F[r](t);let R=me(t[8]),E=L=>L[16].name;for(let L=0;L<R.length;L+=1){let B=TF(t,R,L),I=E(B);u.set(I,f[L]=EF(I,B))}return{c(){e=h("div"),n=h("div"),i=h("div"),i.textContent=`\u{1F465} ${C.ui.party.name}`,y.c(),s=h("div"),A.c(),o=h("div"),l.c(),a=Ne(),c=h("div");for(let L=0;L<f.length;L+=1)f[L].c();p(i,"class","btn party"),p(s,"class","btn border black textexp"),p(o,"class","btn border black textcyan"),p(n,"class","btnbar"),p(c,"class","partyframes svelte-14vfgvr"),ze(c,"width",t[7]+"px"),p(e,"class","l-corner-ul uiscaled")},m(L,B){w(L,e,B),d(e,n),d(n,i),y.m(n,null),d(n,s),A.m(s,null),d(n,o),M[r].m(o,null),d(e,a),d(e,c);for(let I=0;I<f.length;I+=1)f[I]&&f[I].m(c,null);m=!0,g||(v=[Z(i,"click",t[9]),Z(s,"click",t[12]),Z(s,"contextmenu",tu),Z(o,"click",t[13]),Z(o,"contextmenu",tu)],g=!0)},p(L,[B]){b===(b=_(L,B))&&y?y.p(L,B):(y.d(1),y=b(L),y&&(y.c(),y.m(n,s))),S===(S=k(L,B))&&A?A.p(L,B):(A.d(1),A=S(L),A&&(A.c(),A.m(s,null)));let I=r;r=D(L,B),r===I?M[r].p(L,B):(Pe(),q(M[I],1,1,()=>{M[I]=null}),Te(),l=M[r],l?l.p(L,B):(l=M[r]=F[r](L),l.c()),P(l,1),l.m(o,null)),B&256&&(R=me(L[8]),Pe(),f=ui(f,B,E,1,L,R,u,c,Ii,EF,null,TF),Te()),(!m||B&128)&&ze(c,"width",L[7]+"px")},i(L){if(!m){P(l);for(let B=0;B<R.length;B+=1)P(f[B]);m=!0}},o(L){q(l);for(let B=0;B<f.length;B+=1)q(f[B]);m=!1},d(L){L&&x(e),y.d(),A.d(),M[r].d();for(let B=0;B<f.length;B+=1)f[B].d();g=!1,at(v)}}}function DV(t,e,n){let i,s,o,r,l,a,c,f,u;re(t,mm,S=>n(0,i=S)),re(t,pm,S=>n(1,s=S)),re(t,Qn,S=>n(2,o=S)),re(t,Zi,S=>n(3,r=S)),re(t,Gi,S=>n(4,l=S)),re(t,Zc,S=>n(5,a=S)),re(t,Qc,S=>n(6,c=S)),re(t,Yr,S=>n(7,f=S)),re(t,Kl,S=>n(8,u=S));let m=S=>{let A=[{name:"Party Panel",fun:()=>{nt(Zi,r=!0,r)}},o.membercount?nn.partyleave():nn.partycreate()];bn.set({x:S.pageX,y:S.pageY,opts:A})},g=()=>{console.log(s)},v=()=>{console.log(i)};return[i,s,o,r,l,a,c,f,u,m,S=>nt(Zi,r=!r,r),S=>nt(Zi,r=!r,r),S=>{nt(Zc,a=!a,a)},S=>{nt(Qc,c=!c,c)}]}var Kg=class extends Me{constructor(e){super(),Ce(this,e,DV,EV,Ue,{})}},DF=Kg;function IV(t){let e;return{c(){e=h("div"),p(e,"class","pattern svelte-1m0q37p")},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function VV(t){let e,n,i;return n=new vi({props:{size:"0.8em",fract:t[0],barcol:"bgexp",left:t[1],right:`${t[0]}%`,$$slots:{default:[IV]},$$scope:{ctx:t}}}),{c(){e=h("div"),ne(n.$$.fragment),p(e,"id","expbar"),p(e,"class","container svelte-1m0q37p")},m(s,o){w(s,e,o),ee(n,e,null),i=!0},p(s,[o]){let r={};o&1&&(r.fract=s[0]),o&2&&(r.left=s[1]),o&1&&(r.right=`${s[0]}%`),o&8&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){q(n.$$.fragment,s),i=!1},d(s){s&&x(e),te(n)}}}function LV(t,e,n){let i;re(t,om,r=>n(2,i=r));let s,o;return t.$$.update=()=>{t.$$.dirty&4&&(n(0,s=(100*i.current/i.max).toFixed(2)),n(1,o=`${ht(i.current)} / ${ht(i.max)} EXP`))},[s,o,i]}var ev=class extends Me{constructor(e){super(),Ce(this,e,LV,VV,Ue,{})}},IF=ev;function VF(t){let e,n,i=t[5].msg+"",s,o,r,l=t[5].fixed||t[5].step||t[5].fixed?"Skip":"Next",a,c,f,u,m,g=(t[5].fixed||t[5].step||t[5].fixed)&&LF(t);return{c(){e=h("div"),n=h("div"),g&&g.c(),s=h("div"),o=h("div"),o.textContent="Disable tutorial",r=h("div"),a=T(l),p(n,"class","textprimary msgtext svelte-wv9du9"),p(o,"class","btn grey"),p(r,"class","btn green"),p(s,"class","marg-top"),ze(s,"display","flex"),ze(s,"justify-content","space-between"),p(e,"class",c="msg "+(t[5].complete?"complete":"")+" svelte-wv9du9"),ze(e,"cursor","pointer")},m(v,_){w(v,e,_),d(e,n),n.innerHTML=i,g&&g.m(e,null),d(e,s),d(s,o),d(s,r),d(r,a),f=!0,u||(m=[Z(o,"click",t[6]),Z(e,"click",t[7])],u=!0)},p(v,_){(!f||_&32)&&i!==(i=v[5].msg+"")&&(n.innerHTML=i),v[5].fixed||v[5].step||v[5].fixed?g?(g.p(v,_),_&32&&P(g,1)):(g=LF(v),g.c(),P(g,1),g.m(e,s)):g&&(Pe(),q(g,1,1,()=>{g=null}),Te()),(!f||_&32)&&l!==(l=v[5].fixed||v[5].step||v[5].fixed?"Skip":"Next")&&G(a,l),(!f||_&32&&c!==(c="msg "+(v[5].complete?"complete":"")+" svelte-wv9du9"))&&p(e,"class",c)},i(v){f||(P(g),f=!0)},o(v){q(g),f=!1},d(v){v&&x(e),g&&g.d(),u=!1,at(m)}}}function LF(t){let e,n;return e=new vi({props:{size:"0.8em",fract:t[5].progress,barcol:"bgtut",left:"",right:Math.ceil(t[5].progress)+"%"}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&32&&(o.fract=i[5].progress),s&32&&(o.right=Math.ceil(i[5].progress)+"%"),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function qF(t){let e,n;return{c(){e=h("div"),p(e,"class",n="border skill tut "+(t[5].complete?"complete":"")+" svelte-wv9du9"),ze(e,"top",t[2]+"px"),ze(e,"left",t[1]+"px"),ze(e,"width",t[3]+"px"),ze(e,"height",t[4]+"px")},m(i,s){w(i,e,s)},p(i,s){s&32&&n!==(n="border skill tut "+(i[5].complete?"complete":"")+" svelte-wv9du9")&&p(e,"class",n),s&4&&ze(e,"top",i[2]+"px"),s&2&&ze(e,"left",i[1]+"px"),s&8&&ze(e,"width",i[3]+"px"),s&16&&ze(e,"height",i[4]+"px")},d(i){i&&x(e)}}}function qV(t){let e,n,i,s=t[5]&&t[5].msg&&VF(t),o=t[0]&&qF(t);return{c(){s&&s.c(),e=ve(),o&&o.c(),n=ve()},m(r,l){s&&s.m(r,l),w(r,e,l),o&&o.m(r,l),w(r,n,l),i=!0},p(r,[l]){r[5]&&r[5].msg?s?(s.p(r,l),l&32&&P(s,1)):(s=VF(r),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Pe(),q(s,1,1,()=>{s=null}),Te()),r[0]?o?o.p(r,l):(o=qF(r),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},i(r){i||(P(s),i=!0)},o(r){q(s),i=!1},d(r){r&&(x(e),x(n)),s&&s.d(r),o&&o.d(r)}}}function RV(t,e,n){let i;re(t,Bo,u=>n(5,i=u));let s=!1,o,r,l,a;return Bo.subscribe(u=>{if(u){let m=document.getElementById(u.element);if(m){n(0,s=!0);let g=m.getBoundingClientRect();n(3,l=g.width+10),n(4,a=g.height+10),n(1,o=g.x-5),n(2,r=g.y-5)}else n(0,s=!1)}else n(0,s=!1)}),[s,o,r,l,a,i,u=>$s.set(1e3),u=>{tn(-1,100)}]}var tv=class extends Me{constructor(e){super(),Ce(this,e,RV,qV,Ue,{})}},RF=tv;function zV(t,e,n){let i=t.slice();return i[7]=e[n],i[9]=n,i}function zF(t){let e,n;return e=new Nt({props:{origin:"center",title:"Report a player",$$slots:{default:[$V]},$$scope:{ctx:t}}}),e.$on("close",t[4]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&1031&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function BV(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[7]}`,e.__value=n=t[9],Ge(e,e.__value)},m(i,s){w(i,e,s)},p:ue,d(i){i&&x(e)}}}function BF(t){let e,n=t[2].info+"",i;return{c(){e=h("p"),i=T(n),p(e,"class","textprimary")},m(s,o){w(s,e,o),d(e,i)},p(s,o){o&4&&n!==(n=s[2].info+"")&&G(i,n)},d(s){s&&x(e)}}}function UV(t){let e,n=(t[0].result==="ok"?"Report submitted.":t[0].result)+"",i,s,o,r,l,a;return{c(){e=h("p"),i=T(n),o=h("div"),r=h("div"),r.textContent="Close",p(e,"class",s=t[0].result==="ok"?"textgreen":"textred"),p(r,"class","btn grey navbtn"),p(o,"class","subnav")},m(c,f){w(c,e,f),d(e,i),w(c,o,f),d(o,r),l||(a=Z(r,"click",t[4]),l=!0)},p(c,f){f&1&&n!==(n=(c[0].result==="ok"?"Report submitted.":c[0].result)+"")&&G(i,n),f&1&&s!==(s=c[0].result==="ok"?"textgreen":"textred")&&p(e,"class",s)},d(c){c&&(x(e),x(o)),l=!1,a()}}}function OV(t){let e,n,i,s,o,r,l,a,c;return{c(){e=h("div"),n=h("div"),i=T("Report"),o=h("div"),r=T("Cancel"),p(n,"class",s="btn grey navbtn "+(t[1]?"disabled":"")),p(o,"class",l="btn grey navbtn "+(t[1]?"disabled":"")),p(e,"class","subnav")},m(f,u){w(f,e,u),d(e,n),d(n,i),d(e,o),d(o,r),a||(c=[Z(n,"click",t[3]),Z(o,"click",t[4])],a=!0)},p(f,u){u&2&&s!==(s="btn grey navbtn "+(f[1]?"disabled":""))&&p(n,"class",s),u&2&&l!==(l="btn grey navbtn "+(f[1]?"disabled":""))&&p(o,"class",l)},d(f){f&&x(e),a=!1,at(c)}}}function $V(t){let e,n,i,s,o=t[2].name+"",r,l,a,c,f,u,m,g=C.ui.report.info[t[2].reason]+"",v,_,b,y,k,S,A,F,M=me(C.ui.report.reasons),D=[];for(let I=0;I<M.length;I+=1)D[I]=BV(zV(t,M,I));let R=t[2].info&&BF(t);function E(I,N){return I[0]?UV:OV}let L=E(t,-1),B=L(t);return{c(){e=h("div"),n=h("p"),i=T("Describe what happened with "),s=h("span"),r=T(o),l=T(" as accurately as you can:"),a=h("div"),c=h("select");for(let I=0;I<D.length;I+=1)D[I].c();u=h("p"),m=h("small"),v=T(g),R&&R.c(),_=h("div"),b=h("textarea"),S=h("p"),S.innerHTML='<small>Please do not file false reports. If you are unsure about a players behavior, refer to our <a href="/terms" target="_blank">Conduct Policy</a>.</small>',B.c(),p(s,"class","textprimary"),p(c,"class",f=t[1]?"disabled":""),t[2].reason===void 0&&_n(()=>t[5].call(c)),p(a,"class","subnav"),p(u,"class","textgrey"),p(b,"maxlength",y=300),p(b,"class",k="scrollbar reportdescription "+(t[1]?"disabled":"")+" svelte-jnzoj3"),p(b,"rows","4"),p(b,"placeholder","Provide additional context, a little description of the situation helps our moderators."),p(_,"class","subnav"),p(S,"class","textgrey"),p(e,"class","card container svelte-jnzoj3")},m(I,N){w(I,e,N),d(e,n),d(n,i),d(n,s),d(s,r),d(n,l),d(e,a),d(a,c);for(let j=0;j<D.length;j+=1)D[j]&&D[j].m(c,null);wn(c,t[2].reason,!0),d(e,u),d(u,m),d(m,v),R&&R.m(e,null),d(e,_),d(_,b),Ge(b,t[2].description),d(e,S),B.m(e,null),A||(F=[Z(c,"change",t[5]),Z(b,"input",t[6])],A=!0)},p(I,N){N&4&&o!==(o=I[2].name+"")&&G(r,o),N&2&&f!==(f=I[1]?"disabled":"")&&p(c,"class",f),N&4&&wn(c,I[2].reason),N&4&&g!==(g=C.ui.report.info[I[2].reason]+"")&&G(v,g),I[2].info?R?R.p(I,N):(R=BF(I),R.c(),R.m(e,_)):R&&(R.d(1),R=null),N&2&&k!==(k="scrollbar reportdescription "+(I[1]?"disabled":"")+" svelte-jnzoj3")&&p(b,"class",k),N&4&&Ge(b,I[2].description),L===(L=E(I,N))&&B?B.p(I,N):(B.d(1),B=L(I),B&&(B.c(),B.m(e,null)))},d(I){I&&x(e),it(D,I),R&&R.d(),B.d(),A=!1,at(F)}}}function NV(t){let e,n,i=t[2]!==void 0&&zF(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[2]!==void 0?i?(i.p(s,o),o&4&&P(i,1)):(i=zF(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function jV(t,e,n){let i;re(t,oo,f=>n(2,i=f));let s,o=!1,r=async()=>{n(1,o=!0),n(0,s=await Ot("/api/report/submit",{name:i.name,reason:i.reason,messageId:i.messageId,description:i.description||""}))},l=()=>{nt(oo,i=void 0,i),n(0,s=void 0),n(1,o=void 0)};function a(){i.reason=ki(this),oo.set(i)}function c(){i.description=this.value,oo.set(i)}return[s,o,i,r,l,a,c]}var nv=class extends Me{constructor(e){super(),Ce(this,e,jV,NV,Ue,{})}},UF=nv;var vl=t=>Math.round((10+t*5)**1.85/50)*50,_l=t=>Math.min(100,8+t*2);var OF=(t,e=200)=>{let n;return(i,s)=>{n&&clearTimeout(n),n=setTimeout(o=>t(i),s??e)}};function $F(t,e,n){let i=t.slice();return i[17]=e[n],i[19]=n,i}function NF(t){let e,n,i,s=me(t[1]),o=[];for(let a=0;a<s.length;a+=1)o[a]=WF($F(t,s,a));let r=a=>q(o[a],1,1,()=>{o[a]=null}),l=null;return s.length||(l=jF(t)),{c(){e=h("div");for(let a=0;a<o.length;a+=1)o[a].c();n=ve(),l&&l.c(),p(e,"class","divider")},m(a,c){w(a,e,c);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(a,c);w(a,n,c),l&&l.m(a,c),i=!0},p(a,c){if(c&74){s=me(a[1]);let f;for(f=0;f<s.length;f+=1){let u=$F(a,s,f);o[f]?(o[f].p(u,c),P(o[f],1)):(o[f]=WF(u),o[f].c(),P(o[f],1),o[f].m(n.parentNode,n))}for(Pe(),f=s.length;f<o.length;f+=1)r(f);Te(),!s.length&&l?l.p(a,c):s.length?l&&(l.d(1),l=null):(l=jF(a),l.c(),l.m(n.parentNode,n))}},i(a){if(!i){for(let c=0;c<s.length;c+=1)P(o[c]);i=!0}},o(a){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)q(o[c]);i=!1},d(a){a&&(x(e),x(n)),it(o,a),l&&l.d(a)}}}function jF(t){let e;return{c(){e=h("div"),e.textContent="No results",p(e,"class","textgrey result")},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function WF(t){let e,n,i,s,o,r,l=[t[17]],a={};for(let f=0;f<l.length;f+=1)a=Nl(a,l[f]);n=new zi({props:a});function c(...f){return t[14](t[19],...f)}return{c(){e=h("div"),ne(n.$$.fragment),p(e,"class",i="result "+(t[19]===t[3]?"sel":""))},m(f,u){w(f,e,u),ee(n,e,null),s=!0,o||(r=Z(e,"mousedown",c),o=!0)},p(f,u){t=f;let m=u&2?em(l,[tm(t[17])]):{};n.$set(m),(!s||u&8&&i!==(i="result "+(t[19]===t[3]?"sel":"")))&&p(e,"class",i)},i(f){s||(P(n.$$.fragment,f),s=!0)},o(f){q(n.$$.fragment,f),s=!1},d(f){f&&x(e),te(n),o=!1,r()}}}function WV(t){let e,n,i,s,o,r,l,a=t[2]&&NF(t);return{c(){e=h("div"),n=h("div"),i=h("input"),a&&a.c(),p(i,"placeholder","Name"),p(i,"type","text"),p(n,"class",s="container input "+(t[2]?"focus":"")),p(e,"class","navbtn finder")},m(c,f){w(c,e,f),d(e,n),d(n,i),t[10](i),Ge(i,t[0]),a&&a.m(n,null),o=!0,r||(l=[Z(i,"input",t[11]),Z(i,"input",t[5]),Z(i,"focus",t[12]),Z(i,"blur",t[13])],r=!0)},p(c,[f]){f&1&&i.value!==c[0]&&Ge(i,c[0]),c[2]?a?(a.p(c,f),f&4&&P(a,1)):(a=NF(c),a.c(),P(a,1),a.m(n,null)):a&&(Pe(),q(a,1,1,()=>{a=null}),Te()),(!o||f&4&&s!==(s="container input "+(c[2]?"focus":"")))&&p(n,"class",s)},i(c){o||(P(a),o=!0)},o(c){q(a),o=!1},d(c){c&&x(e),t[10](null),a&&a.d(),r=!1,at(l)}}}function GV(t,e,n){let i=OF(async()=>{n(1,a=await Ot("api/playerinfo/search",{[r]:o,order:"name",limit:l})),g(a.findIndex(A=>A.name.toLowerCase()==o.toLowerCase()))}),{id:s}=e,{name:o=""}=e,{type:r="name"}=e,{limit:l=5}=e,a=[],c=!1,f=-1,u,m,g=A=>{n(3,f=A),f>=0&&(u=a[f],n(0,o=u.name),n(7,s=u.id))},v=A=>{A.target==m&&((A.keyCode===38||A.keyCode===40)&&a.length?(g(_a(f+(A.keyCode===38?-1:1),a.length)),A.preventDefault()):(A.keyCode==13||A.keyCode==27)&&m.blur())};Pn(()=>{document.addEventListener("keydown",v)}),Tn(()=>{document.removeEventListener("keydown",v),n(4,m=void 0)});function _(A){$t[A?"unshift":"push"](()=>{m=A,n(4,m)})}function b(){o=this.value,n(0,o)}let y=A=>n(2,c=!0),k=A=>n(2,c=!1),S=(A,F)=>g(A);return t.$$set=A=>{"id"in A&&n(7,s=A.id),"name"in A&&n(0,o=A.name),"type"in A&&n(8,r=A.type),"limit"in A&&n(9,l=A.limit)},[o,a,c,f,m,i,g,s,r,l,_,b,y,k,S]}var iv=class extends Me{constructor(e){super(),Ce(this,e,GV,WV,Ue,{id:7,name:0,type:8,limit:9})}},kd=iv;function GF(t,e,n){let i=t.slice();return i[24]=e[n],i[23]=n,i}function HF(t,e,n){let i=t.slice();return i[21]=e[n],i[23]=n,i}function YF(t,e,n){let i=t.slice();return i[26]=e[n],i[23]=n,i}function XF(t){let e,n,i,s,o,r,l,a,c=t[0].tag+"",f,u,m=t[0].name+"",g,v,_,b=C.factions[t[0].faction].name+"",y,k,S=C.ui.clan.heading+"",A,F,M,D,R,E,L,B,I=t[0].level+"",N,j,W,O=_l(t[0].level)+"",se,X,oe,ce,xe=_l(t[0].level+1)-_l(t[0].level)+"",pe,$e,Ee=C.ui.clan.capacity+"",Fe,_e,H,Le=t[0].tax+"",Oe,He,Ye,Ze,ge,ae,Be=t[0].members.length+"",J,Q,U,fe=`${t[0].online} (+${t[0].online*60} EXP/h)`,je,Ie,ye,qe,Re,pt,wt=ht(t[0].prestige)+"",Qe,Et,be,Je,yt,St,Ae,ft,Ut,Ve,Ct,Vt,We,Ke;M=new vi({props:{size:"1em",fract:Math.ceil(t[0].exp/vl(t[0].level)*100),barcol:"bgpurp",left:`${ht(t[0].exp)} / ${ht(vl(t[0].level))} EXP`,right:`${Math.ceil(t[0].exp/vl(t[0].level)*100)}% `}}),be=new kn({props:{amount:t[0].gold}});let we=t[0].role>-1&&QF(t),ot=t[0].role>0&&ZF(t),Xe=t[0].eligibleApply.length>0&&JF(t),ut=t[1]&&eC(t),xn=t[0].role>0&&tC(t),Fs=[YV,HV],li=[];function Di(dt,Lt){return dt[6]=="members"?0:dt[6]=="applications"?1:-1}return~(Ve=Di(t,-1))&&(Ct=li[Ve]=Fs[Ve](t)),{c(){e=h("div"),n=h("div"),i=h("div"),s=h("img"),r=h("div"),l=h("div"),a=h("h1"),f=T(c),u=h("h3"),g=T(m),_=h("p"),y=T(b),k=Ne(),A=T(S),F=h("div"),ne(M.$$.fragment),D=h("div"),R=h("div"),E=h("div"),L=h("span"),L.textContent=`${C.ui.clan.level}`,B=h("span"),N=T(I),j=h("span"),j.textContent=`${C.ui.clan.capacity}`,W=h("span"),se=T(O),X=h("span"),X.textContent=`${C.ui.clan.nextlevel}`,oe=h("span"),ce=T("+"),pe=T(xe),$e=Ne(),Fe=T(Ee),_e=h("span"),_e.textContent=`${C.ui.clan.taxrate}`,H=h("span"),Oe=T(Le),He=T("%"),Ye=h("div"),Ze=h("div"),ge=h("span"),ge.textContent=`${C.ui.clan.members}`,ae=h("span"),J=T(Be),Q=h("span"),Q.textContent=`${C.ui.clan.online}`,U=h("span"),je=T(fe),Ie=h("span"),Ie.textContent=`${C.ui.stats.array[20]}`,ye=h("span"),qe=h("img"),pt=Ne(),Qe=T(wt),Et=h("span"),Et.textContent=`${C.ui.clan.treasury}`,ne(be.$$.fragment),we&&we.c(),Je=ve(),ot&&ot.c(),yt=ve(),Xe&&Xe.c(),St=ve(),ut&&ut.c(),Ae=h("div"),ft=h("div"),Ut=h("div"),Ut.textContent=`${C.ui.clan.members}`,xn&&xn.c(),Ct&&Ct.c(),p(s,"class","helmet absCentered svelte-6t8hqd"),lt(s.src,o="/data/ui/factions/"+t[0].faction+".svg?v=8588529")||p(s,"src",o),p(l,"class",v="textf"+t[0].faction+" svelte-6t8hqd"),p(r,"class","textcenter"),p(i,"class","hero svelte-6t8hqd"),p(F,"class","panel-black svelte-6t8hqd"),p(L,"class","textprimary"),p(j,"class","textprimary"),p(X,"class","textprimary"),p(_e,"class","textprimary"),p(E,"class","panel-black grid two svelte-6t8hqd"),p(ge,"class","textprimary"),p(Q,"class","textprimary"),p(Ie,"class","textprimary"),p(qe,"class","svgicon"),lt(qe.src,Re=za)||p(qe,"src",Re),p(ye,"class","textprestige"),p(Et,"class","textprimary"),p(Ze,"class","panel-black grid two svelte-6t8hqd"),p(D,"class","marg-top grid two"),p(n,"class","row slim"),p(e,"class","fold fadeIn"),p(Ut,"class","btn navbtn grey"),p(ft,"class","subnav marg-top"),p(Ae,"class","row slim fadeIn")},m(dt,Lt){w(dt,e,Lt),d(e,n),d(n,i),d(i,s),d(i,r),d(r,l),d(l,a),d(a,f),d(l,u),d(u,g),d(r,_),d(_,y),d(_,k),d(_,A),d(n,F),ee(M,F,null),d(n,D),d(D,R),d(R,E),d(E,L),d(E,B),d(B,N),d(E,j),d(E,W),d(W,se),d(E,X),d(E,oe),d(oe,ce),d(oe,pe),d(oe,$e),d(oe,Fe),d(E,_e),d(E,H),d(H,Oe),d(H,He),d(D,Ye),d(Ye,Ze),d(Ze,ge),d(Ze,ae),d(ae,J),d(Ze,Q),d(Ze,U),d(U,je),d(Ze,Ie),d(Ze,ye),d(ye,qe),d(ye,pt),d(ye,Qe),d(Ze,Et),ee(be,Ze,null),we&&we.m(n,null),d(n,Je),ot&&ot.m(n,null),d(n,yt),Xe&&Xe.m(n,null),d(n,St),ut&&ut.m(n,null),w(dt,Ae,Lt),d(Ae,ft),d(ft,Ut),xn&&xn.m(ft,null),~Ve&&li[Ve].m(Ae,null),Vt=!0,We||(Ke=Z(Ut,"click",t[14]),We=!0)},p(dt,Lt){(!Vt||Lt&1&&!lt(s.src,o="/data/ui/factions/"+dt[0].faction+".svg?v=8588529"))&&p(s,"src",o),(!Vt||Lt&1)&&c!==(c=dt[0].tag+"")&&G(f,c),(!Vt||Lt&1)&&m!==(m=dt[0].name+"")&&G(g,m),(!Vt||Lt&1&&v!==(v="textf"+dt[0].faction+" svelte-6t8hqd"))&&p(l,"class",v),(!Vt||Lt&1)&&b!==(b=C.factions[dt[0].faction].name+"")&&G(y,b);let Cs={};Lt&1&&(Cs.fract=Math.ceil(dt[0].exp/vl(dt[0].level)*100)),Lt&1&&(Cs.left=`${ht(dt[0].exp)} / ${ht(vl(dt[0].level))} EXP`),Lt&1&&(Cs.right=`${Math.ceil(dt[0].exp/vl(dt[0].level)*100)}% `),M.$set(Cs),(!Vt||Lt&1)&&I!==(I=dt[0].level+"")&&G(N,I),(!Vt||Lt&1)&&O!==(O=_l(dt[0].level)+"")&&G(se,O),(!Vt||Lt&1)&&xe!==(xe=_l(dt[0].level+1)-_l(dt[0].level)+"")&&G(pe,xe),(!Vt||Lt&1)&&Le!==(Le=dt[0].tax+"")&&G(Oe,Le),(!Vt||Lt&1)&&Be!==(Be=dt[0].members.length+"")&&G(J,Be),(!Vt||Lt&1)&&fe!==(fe=`${dt[0].online} (+${dt[0].online*60} EXP/h)`)&&G(je,fe),(!Vt||Lt&1)&&wt!==(wt=ht(dt[0].prestige)+"")&&G(Qe,wt);let jn={};Lt&1&&(jn.amount=dt[0].gold),be.$set(jn),dt[0].role>-1?we?we.p(dt,Lt):(we=QF(dt),we.c(),we.m(n,Je)):we&&(we.d(1),we=null),dt[0].role>0?ot?(ot.p(dt,Lt),Lt&1&&P(ot,1)):(ot=ZF(dt),ot.c(),P(ot,1),ot.m(n,yt)):ot&&(Pe(),q(ot,1,1,()=>{ot=null}),Te()),dt[0].eligibleApply.length>0?Xe?Xe.p(dt,Lt):(Xe=JF(dt),Xe.c(),Xe.m(n,St)):Xe&&(Xe.d(1),Xe=null),dt[1]?ut?ut.p(dt,Lt):(ut=eC(dt),ut.c(),ut.m(n,null)):ut&&(ut.d(1),ut=null),dt[0].role>0?xn?xn.p(dt,Lt):(xn=tC(dt),xn.c(),xn.m(ft,null)):xn&&(xn.d(1),xn=null);let ai=Ve;Ve=Di(dt,Lt),Ve===ai?~Ve&&li[Ve].p(dt,Lt):(Ct&&(Pe(),q(li[ai],1,1,()=>{li[ai]=null}),Te()),~Ve?(Ct=li[Ve],Ct?Ct.p(dt,Lt):(Ct=li[Ve]=Fs[Ve](dt),Ct.c()),P(Ct,1),Ct.m(Ae,null)):Ct=null)},i(dt){Vt||(P(M.$$.fragment,dt),P(be.$$.fragment,dt),P(ot),P(Ct),Vt=!0)},o(dt){q(M.$$.fragment,dt),q(be.$$.fragment,dt),q(ot),q(Ct),Vt=!1},d(dt){dt&&(x(e),x(Ae)),te(M),te(be),we&&we.d(),ot&&ot.d(),Xe&&Xe.d(),ut&&ut.d(),xn&&xn.d(),~Ve&&li[Ve].d(),We=!1,Ke()}}}function QF(t){let e,n,i,s=C.ui.clan.roles[t[0].role]+"",o;return{c(){e=h("div"),n=h("span"),n.textContent=`${C.ui.clan.highestrank}: `,i=h("span"),o=T(s),p(n,"class","textprimary"),p(i,"class","textgreen"),p(e,"class","marg-top panel-black svelte-6t8hqd")},m(r,l){w(r,e,l),d(e,n),d(e,i),d(i,o)},p(r,l){l&1&&s!==(s=C.ui.clan.roles[r[0].role]+"")&&G(o,s)},d(r){r&&x(e)}}}function ZF(t){let e,n,i,s,o,r,l=C.ui.clan.inviteplayer+"",a,c,f,u,m;function g(_){t[12](_)}let v={};return t[4]!==void 0&&(v.name=t[4]),s=new kd({props:v}),$t.push(()=>Lo(s,"name",g)),{c(){e=h("div"),n=h("span"),n.textContent=`${C.ui.clan.inviteplayers}`,i=h("div"),ne(s.$$.fragment),r=h("div"),a=T(l),p(n,"class","textgrey"),p(r,"class",c="btn formatted navbtn grey "+(t[3]||!t[4].length?"disabled":"")),p(i,"class","subnav"),p(e,"class","marg-top panel-black svelte-6t8hqd")},m(_,b){w(_,e,b),d(e,n),d(e,i),ee(s,i,null),d(i,r),d(r,a),f=!0,u||(m=Z(r,"click",t[8]),u=!0)},p(_,b){let y={};!o&&b&16&&(o=!0,y.name=_[4],Vo(()=>o=!1)),s.$set(y),(!f||b&24&&c!==(c="btn formatted navbtn grey "+(_[3]||!_[4].length?"disabled":"")))&&p(r,"class",c)},i(_){f||(P(s.$$.fragment,_),f=!0)},o(_){q(s.$$.fragment,_),f=!1},d(_){_&&x(e),te(s),u=!1,m()}}}function JF(t){let e,n,i,s,o,r=C.ui.apply+"",l,a,c,f,u=me(t[0].eligibleApply),m=[];for(let g=0;g<u.length;g+=1)m[g]=KF(YF(t,u,g));return{c(){e=h("div"),n=h("span"),n.textContent=`${C.ui.clan.apply}`,i=h("div"),s=h("select");for(let g=0;g<m.length;g+=1)m[g].c();o=h("div"),l=T(r),p(n,"class","textgrey"),p(s,"class","navbtn"),t[5]===void 0&&_n(()=>t[13].call(s)),p(o,"class",a="btn formatted navbtn grey "+(t[3]||!t[5].length?"disabled":"")),p(i,"class","subnav"),p(e,"class","marg-top panel-black svelte-6t8hqd")},m(g,v){w(g,e,v),d(e,n),d(e,i),d(i,s);for(let _=0;_<m.length;_+=1)m[_]&&m[_].m(s,null);wn(s,t[5],!0),d(i,o),d(o,l),c||(f=[Z(s,"change",t[13]),Z(o,"click",t[9])],c=!0)},p(g,v){if(v&33){u=me(g[0].eligibleApply);let _;for(_=0;_<u.length;_+=1){let b=YF(g,u,_);m[_]?m[_].p(b,v):(m[_]=KF(b),m[_].c(),m[_].m(s,null))}for(;_<m.length;_+=1)m[_].d(1);m.length=u.length}v&33&&wn(s,g[5]),v&41&&a!==(a="btn formatted navbtn grey "+(g[3]||!g[5].length?"disabled":""))&&p(o,"class",a)},d(g){g&&x(e),it(m,g),c=!1,at(f)}}}function KF(t){let e,n=t[26]+"",i,s,o;return{c(){e=h("option"),i=T(n),e.selected=s=t[5]==t[26],e.__value=o=t[26],Ge(e,e.__value)},m(r,l){w(r,e,l),d(e,i)},p(r,l){l&1&&n!==(n=r[26]+"")&&G(i,n),l&33&&s!==(s=r[5]==r[26])&&(e.selected=s),l&1&&o!==(o=r[26])&&(e.__value=o,Ge(e,e.__value))},d(r){r&&x(e)}}}function eC(t){let e,n,i,s,o;return{c(){e=h("div"),n=h("span"),i=T(t[1]),p(n,"class",s="text"+t[2]+" svelte-6t8hqd"),p(e,"class",o="marg-top panel-black border "+t[2]+" svelte-6t8hqd")},m(r,l){w(r,e,l),d(e,n),d(n,i)},p(r,l){l&2&&G(i,r[1]),l&4&&s!==(s="text"+r[2]+" svelte-6t8hqd")&&p(n,"class",s),l&4&&o!==(o="marg-top panel-black border "+r[2]+" svelte-6t8hqd")&&p(e,"class",o)},d(r){r&&x(e)}}}function tC(t){let e,n=C.ui.clan.applications+"",i,s,o=t[0].applications.length+"",r,l,a,c,f;return{c(){e=h("div"),i=T(n),s=T(" ("),r=T(o),l=T(")"),a=Ne(),p(e,"class","btn navbtn grey")},m(u,m){w(u,e,m),d(e,i),d(e,s),d(e,r),d(e,l),w(u,a,m),c||(f=Z(e,"click",t[15]),c=!0)},p(u,m){m&1&&o!==(o=u[0].applications.length+"")&&G(r,o)},d(u){u&&(x(e),x(a)),c=!1,f()}}}function HV(t){let e,n,i,s,o,r,l=[],a=new Map,c,f=me(t[0].applications),u=m=>m[24].name;for(let m=0;m<f.length;m+=1){let g=GF(t,f,m),v=u(g);a.set(v,l[m]=nC(v,g))}return{c(){e=h("div"),e.textContent=`${C.ui.clan.applicationdesc}`,n=h("table"),i=h("thead"),s=h("tr"),o=h("th"),o.textContent=`${C.ui.clan.player}`,r=h("tbody");for(let m=0;m<l.length;m+=1)l[m].c();p(e,"class","marg-top textgrey"),p(o,"width","70%"),p(s,"class","textprimary"),p(n,"class","marg-top panel-black svelte-6t8hqd")},m(m,g){w(m,e,g),w(m,n,g),d(n,i),d(i,s),d(s,o),d(n,r);for(let v=0;v<l.length;v+=1)l[v]&&l[v].m(r,null);c=!0},p(m,g){g&1025&&(f=me(m[0].applications),Pe(),l=ui(l,g,u,1,m,f,a,r,Ii,nC,null,GF),Te())},i(m){if(!c){for(let g=0;g<f.length;g+=1)P(l[g]);c=!0}},o(m){for(let g=0;g<l.length;g+=1)q(l[g]);c=!1},d(m){m&&(x(e),x(n));for(let g=0;g<l.length;g+=1)l[g].d()}}}function YV(t){let e,n,i,s,o,r,l,a=[],c=new Map,f,u=me(t[0].members),m=g=>g[21].name;for(let g=0;g<u.length;g+=1){let v=HF(t,u,g),_=m(v);c.set(_,a[g]=iC(_,v))}return{c(){e=h("div"),e.textContent=`${C.ui.clan.memberdesc}`,n=h("table"),i=h("thead"),s=h("tr"),o=h("th"),o.textContent=`${C.ui.clan.roles[0]}`,r=h("th"),r.textContent=`${C.ui.clan.rank}`,l=h("tbody");for(let g=0;g<a.length;g+=1)a[g].c();p(e,"class","marg-top textgrey"),p(o,"width","70%"),p(s,"class","textprimary"),p(n,"class","marg-top panel-black svelte-6t8hqd")},m(g,v){w(g,e,v),w(g,n,v),d(n,i),d(i,s),d(s,o),d(s,r),d(n,l);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(l,null);f=!0},p(g,v){v&129&&(u=me(g[0].members),Pe(),a=ui(a,v,m,1,g,u,c,l,Ii,iC,null,HF),Te())},i(g){if(!f){for(let v=0;v<u.length;v+=1)P(a[v]);f=!0}},o(g){for(let v=0;v<a.length;v+=1)q(a[v]);f=!1},d(g){g&&(x(e),x(n));for(let v=0;v<a.length;v+=1)a[v].d()}}}function nC(t,e){let n,i,s,o,r,l;s=new zi({props:{name:e[24].name,pclass:e[24].class,level:e[24].level,faction:e[0].faction}});function a(...c){return e[17](e[24],...c)}return{key:t,first:null,c(){n=h("tr"),i=h("td"),ne(s.$$.fragment),p(n,"class","striped"),this.first=n},m(c,f){w(c,n,f),d(n,i),ee(s,i,null),o=!0,r||(l=Z(n,"mousedown",a),r=!0)},p(c,f){e=c;let u={};f&1&&(u.name=e[24].name),f&1&&(u.pclass=e[24].class),f&1&&(u.level=e[24].level),f&1&&(u.faction=e[0].faction),s.$set(u)},i(c){o||(P(s.$$.fragment,c),o=!0)},o(c){q(s.$$.fragment,c),o=!1},d(c){c&&x(n),te(s),r=!1,l()}}}function iC(t,e){let n,i,s,o,r=e[21].online?"\u2B24":"",l,a=e[21].owned?"\u2B50":"",c,f,u=C.ui.clan.roles[e[21].clanrole]+"",m,g,v,_,b;s=new zi({props:{name:e[21].name,pclass:e[21].class,level:e[21].level,faction:e[0].faction}});function y(...k){return e[16](e[21],...k)}return{key:t,first:null,c(){n=h("tr"),i=h("td"),ne(s.$$.fragment),o=h("span"),l=T(r),c=T(a),f=h("td"),m=T(u),p(o,"class","textgreen"),p(n,"class",g="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"),this.first=n},m(k,S){w(k,n,S),d(n,i),ee(s,i,null),d(i,o),d(o,l),d(o,c),d(n,f),d(f,m),v=!0,_||(b=Z(n,"mousedown",y),_=!0)},p(k,S){e=k;let A={};S&1&&(A.name=e[21].name),S&1&&(A.pclass=e[21].class),S&1&&(A.level=e[21].level),S&1&&(A.faction=e[0].faction),s.$set(A),(!v||S&1)&&r!==(r=e[21].online?"\u2B24":"")&&G(l,r),(!v||S&1)&&a!==(a=e[21].owned?"\u2B50":"")&&G(c,a),(!v||S&1)&&u!==(u=C.ui.clan.roles[e[21].clanrole]+"")&&G(m,u),(!v||S&1&&g!==(g="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"))&&p(n,"class",g)},i(k){v||(P(s.$$.fragment,k),v=!0)},o(k){q(s.$$.fragment,k),v=!1},d(k){k&&x(n),te(s),_=!1,b()}}}function XV(t){let e,n,i=t[0]&&XF(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=XF(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function QV(t,e,n){let{tag:i}=e,s,o,r=async()=>{let R=await Ot("/api/claninfo/info",{tag:i});R.name&&(n(0,s=R),s.eligibleApply.length&&n(5,v=s.eligibleApply[0]),n(0,s.online=s.members.filter(E=>E.online).length,s)),o&&(clearTimeout(o),o=setTimeout(r,5e3))};o=!0,r(),Tn(()=>{clearTimeout(o),o=void 0});let l=(R,E)=>{let L=[];E.owned?L.push({name:C.ui.clan.leave,fun:async()=>{u(await Ot("/api/clan/leave",{name:E.name}),C.ui.clan.left)}}):E.clanrole<s.role&&L.push({name:C.ui.clan.kick,fun:async()=>{u(await Ot("/api/clan/kick",{name:E.name}),C.ui.clan.memberkicked)}});for(let B=0;B<(s.role==3?4:s.role);B++)L.push({name:C.ui.clan.setrank+": "+C.ui.clan.roles[B],fun:async()=>{u(await Ot("/api/clan/setrole",{name:E.name,role:B}),C.ui.clan.setrank+": "+C.ui.clan.roles[B])}});bn.set({x:R.pageX,y:R.pageY,opts:L})},a,c,f=!1,u=async(R,E)=>{R.result!=="ok"?(n(1,a=R.result),n(2,c="red")):(n(1,a=E),n(2,c="green")),await r(),n(3,f=!1)},m="",g=async()=>{n(3,f=!0),u(await Ot("/api/clan/invite",{name:m,tag:i}),C.ui.clan.invited[0]+m+C.ui.clan.invited[1]),n(4,m="")},v="",_=async()=>{n(3,f=!0),u(await Ot("/api/clan/apply",{name:v,tag:i}),C.ui.clan.applied),n(5,v="")},b=(R,E)=>{let L=[];s.role>0&&L.push({name:C.ui.clan.applicationaccept,fun:async()=>{u(await Ot("/api/clan/invite",{tag:i,name:E.name}),C.ui.clan.applicationaccepted)}}),s.role>1&&L.push({name:C.ui.clan.applicationdeny,fun:async()=>{u(await Ot("/api/clan/denyapplication",{id:E.id}),C.ui.clan.applicationdenied)}}),bn.set({x:R.pageX,y:R.pageY,opts:L})},y="members";function k(R){m=R,n(4,m)}function S(){v=ki(this),n(5,v),n(0,s)}let A=R=>n(6,y="members"),F=R=>n(6,y="applications"),M=(R,E)=>l(E,R),D=(R,E)=>b(E,R);return t.$$set=R=>{"tag"in R&&n(11,i=R.tag)},[s,a,c,f,m,v,y,l,g,_,b,i,k,S,A,F,M,D]}var sv=class extends Me{constructor(e){super(),Ce(this,e,QV,XV,Ue,{tag:11})}},sC=sv;function ZV(t){let e,n,i,s,o,r,l=C.ui.cost+"",a,c,f,u,m,g,v,_=C.ui.clan.createbutton+"",b,y,k,S,A;return f=new kn({props:{amount:1e5}}),{c(){e=h("h3"),e.textContent=`${C.ui.clan.createheading}`,n=h("label"),n.textContent=`${C.ui.clan.createname}`,i=h("input"),s=h("label"),s.textContent=`${C.ui.clan.createtag}`,o=h("input"),r=h("p"),a=T(l),c=T(": "),ne(f.$$.fragment),m=h("div"),g=T(t[3]),v=h("div"),b=T(_),p(e,"class","textprimary"),p(n,"class","svelte-7uvqsx"),p(i,"type","text"),p(i,"placeholder","Guardians of Guardstone (a-Z)"),p(i,"maxlength","20"),p(s,"class","svelte-7uvqsx"),p(o,"type","text"),p(o,"placeholder","GoG (a-Z !~=#*+-)"),p(o,"maxlength","4"),p(r,"class",u="text"+(t[2]>1e5?"primary":"red")),p(m,"class","textred"),ze(v,"display","inline-block"),p(v,"class",y="btn marg-top formatted "+(t[4]?"blue":"blue disabled"))},m(F,M){w(F,e,M),w(F,n,M),w(F,i,M),Ge(i,t[0]),w(F,s,M),w(F,o,M),Ge(o,t[1]),w(F,r,M),d(r,a),d(r,c),ee(f,r,null),w(F,m,M),d(m,g),w(F,v,M),d(v,b),k=!0,S||(A=[Z(i,"input",t[7]),Z(o,"input",t[8]),Z(v,"click",t[5])],S=!0)},p(F,[M]){M&1&&i.value!==F[0]&&Ge(i,F[0]),M&2&&o.value!==F[1]&&Ge(o,F[1]),(!k||M&4&&u!==(u="text"+(F[2]>1e5?"primary":"red")))&&p(r,"class",u),(!k||M&8)&&G(g,F[3]),(!k||M&16&&y!==(y="btn marg-top formatted "+(F[4]?"blue":"blue disabled")))&&p(v,"class",y)},i(F){k||(P(f.$$.fragment,F),k=!0)},o(F){q(f.$$.fragment,F),k=!1},d(F){F&&(x(e),x(n),x(i),x(s),x(o),x(r),x(m),x(v)),te(f),S=!1,at(A)}}}function JV(t,e,n){let i,s;re(t,Hi,m=>n(2,s=m));let o="",r="",l=!1,a="",c=async()=>{if(l)return;n(6,l=!0);let m=await Ot("/api/clan/create",{name:o,tag:r});m.result!=="ok"&&(n(3,a=m.result),n(6,l=!1))};function f(){o=this.value,n(0,o)}function u(){r=this.value,n(1,r)}return t.$$.update=()=>{t.$$.dirty&71&&n(4,i=!l&&s>=1e5&&o.length<=20&&o.length>=3&&r.length<=4&&r.length>=2)},[o,r,s,a,i,c,l,f,u]}var ov=class extends Me{constructor(e){super(),Ce(this,e,JV,ZV,Ue,{})}},oC=ov;function rC(t,e,n){let i=t.slice();return i[4]=e[n],i[6]=n,i}function KV(t){let e,n,i;function s(...o){return t[2](t[4],...o)}return{c(){e=h("div"),e.textContent=`${C.ui.accept}`,p(e,"class","btn blue")},m(o,r){w(o,e,r),n||(i=Z(e,"click",s),n=!0)},p(o,r){t=o},d(o){o&&x(e),n=!1,i()}}}function eL(t){let e;return{c(){e=h("div"),e.textContent=`${C.ui.clan.application}`},m(n,i){w(n,e,i)},p:ue,d(n){n&&x(e)}}}function lC(t,e){let n,i,s=e[4].tag+"",o,r,l=e[4].name+"",a,c;function f(g,v){return g[4].request?eL:KV}let u=f(e,-1),m=u(e);return{key:t,first:null,c(){n=h("tr"),i=h("td"),o=T(s),r=h("td"),a=T(l),c=h("td"),m.c(),p(c,"class","textcenter"),p(n,"class","striped"),this.first=n},m(g,v){w(g,n,v),d(n,i),d(i,o),d(n,r),d(r,a),d(n,c),m.m(c,null)},p(g,v){e=g,v&1&&s!==(s=e[4].tag+"")&&G(o,s),v&1&&l!==(l=e[4].name+"")&&G(a,l),u===(u=f(e,v))&&m?m.p(e,v):(m.d(1),m=u(e),m&&(m.c(),m.m(c,null)))},d(g){g&&x(n),m.d()}}}function tL(t){let e,n,i,s,o,r,l,a=[],c=new Map,f=me(t[0]),u=m=>m[4].clan;for(let m=0;m<f.length;m+=1){let g=rC(t,f,m),v=u(g);c.set(v,a[m]=lC(v,g))}return{c(){e=h("table"),n=h("thead"),i=h("tr"),s=h("th"),s.textContent=`${C.ui.clan.createtag}`,o=h("th"),o.textContent=`${C.ui.clan.createname}`,r=h("th"),r.textContent=`${C.ui.clan.action}`,l=h("tbody");for(let m=0;m<a.length;m+=1)a[m].c();p(s,"width","20%"),p(o,"width","60%"),p(r,"class","textcenter"),p(i,"class","textprimary"),p(e,"class","marg-top panel-black")},m(m,g){w(m,e,g),d(e,n),d(n,i),d(i,s),d(i,o),d(i,r),d(e,l);for(let v=0;v<a.length;v+=1)a[v]&&a[v].m(l,null)},p(m,[g]){g&3&&(f=me(m[0]),a=ui(a,g,u,1,m,f,c,l,t_,lC,null,rC))},i:ue,o:ue,d(m){m&&x(e);for(let g=0;g<a.length;g+=1)a[g].d()}}}function nL(t,e,n){let i=[];(async()=>{n(0,i=await Ot("/api/clan/invites",{name:V.player.name}))})();let o=async l=>{await Ot("/api/clan/apply",{tag:l,name:V.player.name})};return[i,o,(l,a)=>o(l.tag)]}var rv=class extends Me{constructor(e){super(),Ce(this,e,nL,tL,Ue,{})}},aC=rv;function cC(t){let e,n;return e=new Nt({props:{origin:"center",title:C.ui.clan.heading,icon:"clan",scroll:!0,$$slots:{default:[aL]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&133&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function iL(t){let e,n,i,s,o,r,l;return{c(){e=h("div"),n=h("div"),i=h("h3"),i.textContent=`${C.ui.clan.noclan}`,s=h("div"),s.textContent=`${C.ui.clan.viewinvites}`,o=h("div"),o.textContent=`${C.ui.clan.createheading}`,p(s,"class","btn grey"),p(o,"class","btn grey marg-top"),p(n,"class","panel-black"),p(e,"class","clanInfoBox textcenter svelte-1vwl908")},m(a,c){w(a,e,c),d(e,n),d(n,i),d(n,s),d(n,o),r||(l=[Z(s,"click",t[4]),Z(o,"click",t[5])],r=!0)},p:ue,i:ue,o:ue,d(a){a&&x(e),r=!1,at(l)}}}function sL(t){let e,n,i,s,o,r,l,a=[lL,rL],c=[];function f(u,m){return u[0]=="create"?0:u[0]=="invites"?1:-1}return~(i=f(t,-1))&&(s=c[i]=a[i](t)),{c(){e=h("div"),n=h("div"),n.textContent=`${C.ui.back}`,s&&s.c(),ze(n,"display","inline-block"),p(n,"class","btn formatted grey"),p(e,"class","modemenu svelte-1vwl908")},m(u,m){w(u,e,m),d(e,n),~i&&c[i].m(e,null),o=!0,r||(l=Z(n,"click",t[3]),r=!0)},p(u,m){let g=i;i=f(u,m),i!==g&&(s&&(Pe(),q(c[g],1,1,()=>{c[g]=null}),Te()),~i?(s=c[i],s||(s=c[i]=a[i](u),s.c()),P(s,1),s.m(e,null)):s=null)},i(u){o||(P(s),o=!0)},o(u){q(s),o=!1},d(u){u&&x(e),~i&&c[i].d(),r=!1,l()}}}function oL(t){let e,n,i;return n=new sC({props:{tag:t[2]}}),{c(){e=h("div"),ne(n.$$.fragment),p(e,"class","clanView svelte-1vwl908")},m(s,o){w(s,e,o),ee(n,e,null),i=!0},p(s,o){let r={};o&4&&(r.tag=s[2]),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){q(n.$$.fragment,s),i=!1},d(s){s&&x(e),te(n)}}}function rL(t){let e,n;return e=new aC({}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function lL(t){let e,n;return e=new oC({}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function aL(t){let e,n,i,s,o=[oL,sL,iL],r=[];function l(a,c){return a[2]?0:a[0]?1:2}return n=l(t,-1),i=r[n]=o[n](t),{c(){e=h("div"),i.c(),p(e,"class","container svelte-1vwl908")},m(a,c){w(a,e,c),r[n].m(e,null),s=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(Pe(),q(r[f],1,1,()=>{r[f]=null}),Te(),i=r[n],i?i.p(a,c):(i=r[n]=o[n](a),i.c()),P(i,1),i.m(e,null))},i(a){s||(P(i),s=!0)},o(a){q(i),s=!1},d(a){a&&x(e),r[n].d()}}}function cL(t){let e,n,i=t[1]&&cC(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[1]?i?(i.p(s,o),o&2&&P(i,1)):(i=cC(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function fL(t,e,n){let i,s;re(t,fo,f=>n(1,i=f)),re(t,dm,f=>n(2,s=f));let o=!1;return[o,i,s,f=>n(0,o=!1),f=>n(0,o="invites"),f=>n(0,o="create"),()=>{nt(fo,i=!1,i)}]}var lv=class extends Me{constructor(e){super(),Ce(this,e,fL,cL,Ue,{})}},fC=lv;var av=t=>{let e=~~(t/86400),n=~~(t/(60*60)%24),i=~~(t/60%60),s=~~(t%60);return`${e?e+"d ":""}${n?n+"h ":""}${i?i+"m ":""}${s?s+"s":""}`};var su=t=>~~(1e4+t**1.5*8e3);function uC(t,e,n){let i=t.slice();return i[9]=e[n],i[11]=n,i}function mC(t){let e,n;return e=new Nt({props:{origin:"center",title:C.ui.headers.warstats,icon:"pvp",$$slots:{default:[mL]},$$scope:{ctx:t}}}),e.$on("close",t[8]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&4101&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function uL(t){let e,n=ht(t[2].contrib)+"",i,s,o=ht(su(t[2].level))+"",r,l,a=t[2].level+"",c,f;return{c(){e=h("span"),i=T(n),s=T(" / "),r=T(o),l=T(" (Lv. "),c=T(a),f=T(" War)"),ze(e,"font-size","14px"),p(e,"class","absCentered textprimary")},m(u,m){w(u,e,m),d(e,i),d(e,s),d(e,r),d(e,l),d(e,c),d(e,f)},p(u,m){m&4&&n!==(n=ht(u[2].contrib)+"")&&G(i,n),m&4&&o!==(o=ht(su(u[2].level))+"")&&G(r,o),m&4&&a!==(a=u[2].level+"")&&G(c,a)},d(u){u&&x(e)}}}function pC(t,e){let n,i,s,o,r=ht(e[9].stats[1])+"",l,a,c=ht(e[9].stats[2])+"",f,u,m=e[9].stats[0]+"",g,v,_=ht(e[9].stats[3])+"",b,y,k;return s=new zi({props:{name:e[9].name,pclass:e[9].class,level:e[9].level,faction:e[9].faction}}),{key:t,first:null,c(){n=h("tr"),i=h("td"),ne(s.$$.fragment),o=h("td"),l=T(r),a=h("td"),f=T(c),u=h("td"),g=T(m),v=h("td"),b=T(_),p(o,"class","textcenter"),p(a,"class","textcenter"),p(u,"class","textcenter"),p(v,"class","textcenter textfame"),p(n,"class",y="striped "+(V&&V.player&&V.player.name===e[9].name?"selected":"")),this.first=n},m(S,A){w(S,n,A),d(n,i),ee(s,i,null),d(n,o),d(o,l),d(n,a),d(a,f),d(n,u),d(u,g),d(n,v),d(v,b),k=!0},p(S,A){e=S;let F={};A&5&&(F.name=e[9].name),A&5&&(F.pclass=e[9].class),A&5&&(F.level=e[9].level),A&5&&(F.faction=e[9].faction),s.$set(F),(!k||A&5)&&r!==(r=ht(e[9].stats[1])+"")&&G(l,r),(!k||A&5)&&c!==(c=ht(e[9].stats[2])+"")&&G(f,c),(!k||A&5)&&m!==(m=e[9].stats[0]+"")&&G(g,m),(!k||A&5)&&_!==(_=ht(e[9].stats[3])+"")&&G(b,_),(!k||A&5&&y!==(y="striped "+(V&&V.player&&V.player.name===e[9].name?"selected":"")))&&p(n,"class",y)},i(S){k||(P(s.$$.fragment,S),k=!0)},o(S){q(s.$$.fragment,S),k=!1},d(S){S&&x(n),te(s)}}}function mL(t){let e,n,i,s,o,r,l,a,c,f=t[2].kills[0]+"",u,m,g,v,_,b,y=ht(t[2].reward)+"",k,S,A=C.ui.war.status+"",F,M,D,R=C.ui.war.statustypes[t[2].status]+"",E,L,B,I=C.ui.war.duration+"",N,j,W,O=av(t[2].duration)+"",se,X,oe,ce,xe,pe,$e,Ee,Fe=t[2].kills[1]+"",_e,H,Le,Oe,He,Ye,Ze,ge,ae=C.ui.stats.misc.damage+"",Be,J,Q,U=C.ui.stats.misc.healing+"",fe,je,Ie,ye=C.ui.stats.misc.kills+"",qe,Re,pt,wt,Qe,Et,be=C.ui.stats.misc.fame+"",Je,yt,St,Ae=[],ft=new Map,Ut,Ve,Ct;H=new vi({props:{size:"1.3em",fract:~~(t[2].contrib/su(t[2].level)*100),left:"",right:"",barcol:"bgpurp",$$slots:{default:[uL]},$$scope:{ctx:t}}});let Vt=me(t[2].contributors.sort(t[7])),We=Ke=>Ke[9].name;for(let Ke=0;Ke<Vt.length;Ke+=1){let we=uC(t,Vt,Ke),ot=We(we);ft.set(ot,Ae[Ke]=pC(ot,we))}return{c(){e=h("div"),n=h("div"),i=h("div"),s=h("div"),o=h("span"),o.textContent=`${C.factions[0].name}`,r=h("span"),l=h("img"),c=Ne(),u=T(f),m=h("div"),g=h("span"),v=h("img"),b=Ne(),k=T(y),S=h("span"),F=T(A),M=T(": "),D=h("span"),E=T(R),B=h("span"),N=T(I),j=T(": "),W=h("span"),se=T(O),X=Ne(),oe=h("div"),ce=h("span"),ce.textContent=`${C.factions[1].name}`,xe=h("span"),pe=h("img"),Ee=Ne(),_e=T(Fe),ne(H.$$.fragment),Le=h("div"),Oe=h("table"),He=h("thead"),Ye=h("tr"),Ze=h("th"),Ze.textContent=`${C.ui.war.player}`,ge=h("th"),Be=T(ae),Q=h("th"),fe=T(U),Ie=h("th"),qe=T(ye),pt=h("th"),wt=h("img"),Et=Ne(),Je=T(be),St=h("tbody");for(let Ke=0;Ke<Ae.length;Ke+=1)Ae[Ke].c();p(o,"class","infosmall textf0 svelte-19s383j"),ze(o,"margin-top","30px"),p(l,"class","svgicon"),lt(l.src,a="/data/ui/icons/pvp.svg?v=8588529")||p(l,"src",a),p(r,"class","infobig textprimary svelte-19s383j"),ze(r,"margin-top","10px"),p(v,"class","svgicon"),lt(v.src,_=Ko)||p(v,"src",_),p(g,"class","infobig textfame svelte-19s383j"),ze(g,"margin-top","20px"),p(D,"class",L="text"+["red","orange","green"][t[2].status]+" svelte-19s383j"),p(S,"class","infosmall svelte-19s383j"),ze(S,"margin-top","10px"),p(W,"class","textprimary"),p(B,"class","infosmall svelte-19s383j"),ze(B,"margin-bottom","20px"),p(ce,"class","infosmall textf1 svelte-19s383j"),ze(ce,"margin-top","30px"),p(pe,"class","svgicon"),lt(pe.src,$e="/data/ui/icons/pvp.svg?v=8588529")||p(pe,"src",$e),p(xe,"class","infobig textprimary svelte-19s383j"),ze(xe,"margin-top","10px"),p(i,"class","grid three"),p(n,"class","panel-black border grey"),p(Ze,"width","30%"),p(ge,"class",J="textcenter "+(t[0]==1?"textwhite":"")),p(Q,"class",je="textcenter "+(t[0]==2?"textwhite":"")),p(Ie,"class",Re="textcenter "+(t[0]==0?"textwhite":"")),p(wt,"class","svgicon"),lt(wt.src,Qe=Ko)||p(wt,"src",Qe),p(pt,"class",yt="textcenter "+(t[0]==3?"textwhite":"")),p(Ye,"class","textprimary"),p(Oe,"class","dense panel-black"),p(Le,"class","scrollbar"),p(e,"class","layout svelte-19s383j")},m(Ke,we){w(Ke,e,we),d(e,n),d(n,i),d(i,s),d(s,o),d(s,r),d(r,l),d(r,c),d(r,u),d(i,m),d(m,g),d(g,v),d(g,b),d(g,k),d(m,S),d(S,F),d(S,M),d(S,D),d(D,E),d(m,B),d(B,N),d(B,j),d(B,W),d(W,se),d(m,X),d(i,oe),d(oe,ce),d(oe,xe),d(xe,pe),d(xe,Ee),d(xe,_e),ee(H,n,null),d(e,Le),d(Le,Oe),d(Oe,He),d(He,Ye),d(Ye,Ze),d(Ye,ge),d(ge,Be),d(Ye,Q),d(Q,fe),d(Ye,Ie),d(Ie,qe),d(Ye,pt),d(pt,wt),d(pt,Et),d(pt,Je),d(Oe,St);for(let ot=0;ot<Ae.length;ot+=1)Ae[ot]&&Ae[ot].m(St,null);Ut=!0,Ve||(Ct=[Z(ge,"click",t[3]),Z(Q,"click",t[4]),Z(Ie,"click",t[5]),Z(pt,"click",t[6])],Ve=!0)},p(Ke,we){(!Ut||we&4)&&f!==(f=Ke[2].kills[0]+"")&&G(u,f),(!Ut||we&4)&&y!==(y=ht(Ke[2].reward)+"")&&G(k,y),(!Ut||we&4)&&R!==(R=C.ui.war.statustypes[Ke[2].status]+"")&&G(E,R),(!Ut||we&4&&L!==(L="text"+["red","orange","green"][Ke[2].status]+" svelte-19s383j"))&&p(D,"class",L),(!Ut||we&4)&&O!==(O=av(Ke[2].duration)+"")&&G(se,O),(!Ut||we&4)&&Fe!==(Fe=Ke[2].kills[1]+"")&&G(_e,Fe);let ot={};we&4&&(ot.fract=~~(Ke[2].contrib/su(Ke[2].level)*100)),we&4100&&(ot.$$scope={dirty:we,ctx:Ke}),H.$set(ot),(!Ut||we&1&&J!==(J="textcenter "+(Ke[0]==1?"textwhite":"")))&&p(ge,"class",J),(!Ut||we&1&&je!==(je="textcenter "+(Ke[0]==2?"textwhite":"")))&&p(Q,"class",je),(!Ut||we&1&&Re!==(Re="textcenter "+(Ke[0]==0?"textwhite":"")))&&p(Ie,"class",Re),(!Ut||we&1&&yt!==(yt="textcenter "+(Ke[0]==3?"textwhite":"")))&&p(pt,"class",yt),we&5&&(Vt=me(Ke[2].contributors.sort(Ke[7])),Pe(),Ae=ui(Ae,we,We,1,Ke,Vt,ft,St,Ii,pC,null,uC),Te())},i(Ke){if(!Ut){P(H.$$.fragment,Ke);for(let we=0;we<Vt.length;we+=1)P(Ae[we]);Ut=!0}},o(Ke){q(H.$$.fragment,Ke);for(let we=0;we<Ae.length;we+=1)q(Ae[we]);Ut=!1},d(Ke){Ke&&x(e),te(H);for(let we=0;we<Ae.length;we+=1)Ae[we].d();Ve=!1,at(Ct)}}}function pL(t){let e,n,i=t[1]&&mC(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[1]?i?(i.p(s,o),o&2&&P(i,1)):(i=mC(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function dL(t,e,n){let i,s;re(t,Us,m=>n(1,i=m)),re(t,Bs,m=>n(2,s=m));let o=1;return[o,i,s,()=>n(0,o=1),()=>n(0,o=2),()=>n(0,o=0),()=>n(0,o=3),(m,g)=>g.stats[o]-m.stats[o],()=>{nt(Us,i=!1,i)}]}var cv=class extends Me{constructor(e){super(),Ce(this,e,dL,pL,Ue,{})}},dC=cv;function hC(t,e,n){let i=t.slice();return i[15]=e[n],i}function gC(t,e,n){let i=t.slice();return i[18]=e[n],i[20]=n,i}function vC(t){let e,n;return e=new Nt({props:{origin:"center",title:C.ui.headers.pvp,icon:"pvp",$$slots:{default:[yL]},$$scope:{ctx:t}}}),e.$on("close",t[13]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&2097278&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function _C(t){let e,n,i;function s(){return t[11](t[20])}return{c(){e=h("div"),e.textContent=`${t[18]}`,p(e,"class","tab"),Do(e,"active",t[20]===t[1])},m(o,r){w(o,e,r),n||(i=Z(e,"click",s),n=!0)},p(o,r){t=o,r&2&&Do(e,"active",t[20]===t[1])},d(o){o&&x(e),n=!1,i()}}}function hL(t){let e,n,i,s,o,r,l,a,c=t[5].arena_position+"",f,u,m,g,v=t[5].arena_wins_today+"",_,b,y,k,S=t[5].arena_losses_today+"",A,F,M,D,R,E,L,B,I,N,j,W,O,se,X;s=new vd({props:{amount:t[5].arena_rating}});let oe=me(t[8]),ce=[];for(let Ee=0;Ee<oe.length;Ee+=1)ce[Ee]=bC(hC(t,oe,Ee));R=new or({props:{amount:Math.ceil(Lf(t[5].arena_rating)/5)}});let xe=[_L,vL],pe=[];function $e(Ee,Fe){return Ee[5].arena_wins_today?0:1}return N=$e(t,-1),j=pe[N]=xe[N](t),se=new or({props:{amount:t[5].medals}}),{c(){e=h("div"),n=h("h4"),n.textContent="Current Rating",i=h("h2"),ne(s.$$.fragment),o=h("div");for(let Ee=0;Ee<ce.length;Ee+=1)ce[Ee].c();r=h("div"),l=h("span"),l.textContent="Arena Position",a=h("span"),f=T(c),u=h("span"),u.textContent="Wins / Loss Today",m=h("span"),g=h("span"),_=T(v),y=T(" - "),k=h("span"),A=T(S),M=h("span"),M.textContent="Medals per win",D=h("span"),ne(R.$$.fragment),E=h("span"),L=T("End of day bonus"),I=h("span"),j.c(),W=h("span"),W.textContent="Total Medals",O=h("span"),ne(se.$$.fragment),p(n,"class","textgreen"),p(e,"class","textcenter panel-black"),p(o,"class","panel-black marg-top grid two textcenter"),p(l,"class","textwhite"),p(a,"class","textgreen statnumber"),p(u,"class","textwhite"),p(g,"class",b=t[5].arena_wins_today?"textgreen":"textgrey"),p(k,"class",F=t[5].arena_losses_today?"textred":"textgrey"),p(m,"class","textgrey statnumber"),p(M,"class","textwhite"),p(D,"class","statnumber"),p(E,"class",B=t[5].arena_wins_today?"textgreen":"textgrey"),p(I,"class","statnumber"),p(W,"class","textwhite"),p(O,"class","statnumber"),p(r,"class","stats panel-black marg-top svelte-voya4q")},m(Ee,Fe){w(Ee,e,Fe),d(e,n),d(e,i),ee(s,i,null),w(Ee,o,Fe);for(let _e=0;_e<ce.length;_e+=1)ce[_e]&&ce[_e].m(o,null);w(Ee,r,Fe),d(r,l),d(r,a),d(a,f),d(r,u),d(r,m),d(m,g),d(g,_),d(m,y),d(m,k),d(k,A),d(r,M),d(r,D),ee(R,D,null),d(r,E),d(E,L),d(r,I),pe[N].m(I,null),d(r,W),d(r,O),ee(se,O,null),X=!0},p(Ee,Fe){let _e={};if(Fe&32&&(_e.amount=Ee[5].arena_rating),s.$set(_e),Fe&832){oe=me(Ee[8]);let He;for(He=0;He<oe.length;He+=1){let Ye=hC(Ee,oe,He);ce[He]?ce[He].p(Ye,Fe):(ce[He]=bC(Ye),ce[He].c(),ce[He].m(o,null))}for(;He<ce.length;He+=1)ce[He].d(1);ce.length=oe.length}(!X||Fe&32)&&c!==(c=Ee[5].arena_position+"")&&G(f,c),(!X||Fe&32)&&v!==(v=Ee[5].arena_wins_today+"")&&G(_,v),(!X||Fe&32&&b!==(b=Ee[5].arena_wins_today?"textgreen":"textgrey"))&&p(g,"class",b),(!X||Fe&32)&&S!==(S=Ee[5].arena_losses_today+"")&&G(A,S),(!X||Fe&32&&F!==(F=Ee[5].arena_losses_today?"textred":"textgrey"))&&p(k,"class",F);let H={};Fe&32&&(H.amount=Math.ceil(Lf(Ee[5].arena_rating)/5)),R.$set(H),(!X||Fe&32&&B!==(B=Ee[5].arena_wins_today?"textgreen":"textgrey"))&&p(E,"class",B);let Le=N;N=$e(Ee,Fe),N===Le?pe[N].p(Ee,Fe):(Pe(),q(pe[Le],1,1,()=>{pe[Le]=null}),Te(),j=pe[N],j?j.p(Ee,Fe):(j=pe[N]=xe[N](Ee),j.c()),P(j,1),j.m(I,null));let Oe={};Fe&32&&(Oe.amount=Ee[5].medals),se.$set(Oe)},i(Ee){X||(P(s.$$.fragment,Ee),P(R.$$.fragment,Ee),P(j),P(se.$$.fragment,Ee),X=!0)},o(Ee){q(s.$$.fragment,Ee),q(R.$$.fragment,Ee),q(j),q(se.$$.fragment,Ee),X=!1},d(Ee){Ee&&(x(e),x(o),x(r)),te(s),it(ce,Ee),te(R),pe[N].d(),te(se)}}}function gL(t){let e,n,i,s,o,r,l,a,c=ht(t[5].prestige)+"",f,u,m,g,v=ll(t[3],C.ui.title.name[V.player.faction][t[3]-1])+"",_,b=ht(Qg(t[5].prestige))+"",y,k,S,A,F,M,D,R=ht(t[5].kills_today)+"",E,L,B,I,N,j,W=ht(t[5].fame_today)+"",O,se,X,oe,ce,xe,pe=ht(t[5].kills_this_week)+"",$e,Ee,Fe,_e,H,Le,Oe=ht(t[5].fame)+"",He,Ye,Ze,ge=t[5].fame_position+"",ae,Be,J,Q=iu(t[5].fame_bracket)+"",U,fe,je,Ie,ye,qe,Re=ht(t[5].kills_last_week)+"",pt,wt,Qe,Et,be,Je,yt=ht(t[5].fame_last_week)+"",St,Ae,ft,Ut=t[5].fame_position_last_week+"",Ve,Ct,Vt,We=iu(t[5].fame_bracket_last_week)+"",Ke,we,ot,Xe,ut,xn,Fs=ht(t[5].kills_lifetime)+"",li,Di,dt,Lt,Cs,jn,ai=ht(t[5].fame_lifetime)+"",vc,xr,Po,Ss=(t[5].rank_lifetime>0?ll(t[5].rank_lifetime,C.ui.title.name[V.player.faction][t[5].rank_lifetime-1]):"Unranked")+"",mn;return n=new vi({props:{size:"1.5em",fract:t[4],barcol:"bgpurp",$$slots:{default:[bL]},$$scope:{ctx:t}}}),{c(){e=h("div"),ne(n.$$.fragment),i=h("div"),s=h("span"),s.textContent=`${C.ui.pvpmenu.currentprestige}`,o=h("span"),r=h("img"),a=Ne(),f=T(c),u=h("span"),u.textContent=`${C.ui.pvpmenu.nextrank}`,m=h("span"),g=new Yu(!1),_=T(" ("),y=T(b),k=T(")"),S=h("div"),A=h("small"),A.textContent=`${C.ui.pvpmenu.today}`,F=h("span"),M=h("span"),M.textContent=`${C.ui.stats.misc.kills}`,D=h("span"),E=T(R),L=h("span"),L.textContent=`${C.ui.stats.misc.fame}`,B=h("span"),I=h("img"),j=Ne(),O=T(W),se=h("div"),X=h("small"),X.textContent=`${C.ui.pvpmenu.thisweek}`,oe=h("a"),oe.textContent=`${C.ui.pvpmenu.viewbrackets}`,ce=h("span"),ce.textContent=`${C.ui.stats.misc.kills}`,xe=h("span"),$e=T(pe),Ee=h("span"),Ee.textContent=`${C.ui.stats.misc.fame}`,Fe=h("span"),_e=h("img"),Le=Ne(),He=T(Oe),Ye=h("span"),Ye.textContent=`${C.ui.pvpmenu.fameposition}`,Ze=h("span"),ae=T(ge),Be=h("span"),Be.textContent=`${C.ui.pvpmenu.famebracket}`,J=h("span"),U=T(Q),fe=h("div"),je=h("small"),je.textContent=`${C.ui.pvpmenu.lastweek}`,Ie=h("span"),ye=h("span"),ye.textContent=`${C.ui.stats.misc.kills}`,qe=h("span"),pt=T(Re),wt=h("span"),wt.textContent=`${C.ui.stats.misc.fame}`,Qe=h("span"),Et=h("img"),Je=Ne(),St=T(yt),Ae=h("span"),Ae.textContent=`${C.ui.pvpmenu.fameposition}`,ft=h("span"),Ve=T(Ut),Ct=h("span"),Ct.textContent=`${C.ui.pvpmenu.famebracket}`,Vt=h("span"),Ke=T(We),we=h("div"),ot=h("small"),ot.textContent=`${C.ui.pvpmenu.lifetime}`,Xe=h("span"),ut=h("span"),ut.textContent=`${C.ui.stats.misc.kills}`,xn=h("span"),li=T(Fs),Di=h("span"),Di.textContent=`${C.ui.stats.misc.fame}`,dt=h("span"),Lt=h("img"),jn=Ne(),vc=T(ai),xr=h("span"),xr.textContent=`${C.ui.pvpmenu.highestrank}`,Po=h("span"),p(s,"class","textwhite"),p(r,"class","svgicon"),lt(r.src,l=za)||p(r,"src",l),p(o,"class","textprestige statnumber"),p(u,"class","textwhite"),g.a=_,p(m,"class","textprestige statnumber"),p(i,"class","stats marg-top svelte-voya4q"),p(e,"class","panel-black"),p(A,"class","bold textgreen"),p(M,"class","textwhite"),p(D,"class","textprimary statnumber"),p(L,"class","textwhite"),p(I,"class","svgicon"),lt(I.src,N=Ko)||p(I,"src",N),p(B,"class","textfame statnumber"),p(S,"class","stats panel-black marg-top svelte-voya4q"),p(X,"class","bold textgreen"),p(oe,"class","statnumber"),p(oe,"href","/pvp"),p(oe,"target","_blank"),p(oe,"rel","noopener noreferrer"),p(ce,"class","textwhite"),p(xe,"class","textprimary statnumber"),p(Ee,"class","textwhite"),p(_e,"class","svgicon"),lt(_e.src,H=Ko)||p(_e,"src",H),p(Fe,"class","textfame statnumber"),p(Ye,"class","textwhite"),p(Ze,"class","textgreen statnumber"),p(Be,"class","textwhite"),p(J,"class","textprimary statnumber"),p(se,"class","stats panel-black marg-top svelte-voya4q"),p(je,"class","bold textgreen"),p(ye,"class","textwhite"),p(qe,"class","textprimary statnumber"),p(wt,"class","textwhite"),p(Et,"class","svgicon"),lt(Et.src,be=Ko)||p(Et,"src",be),p(Qe,"class","textfame statnumber"),p(Ae,"class","textwhite"),p(ft,"class","textgreen statnumber"),p(Ct,"class","textwhite"),p(Vt,"class","textprimary statnumber"),p(fe,"class","stats panel-black marg-top svelte-voya4q"),p(ot,"class","bold textgreen"),p(ut,"class","textwhite"),p(xn,"class","textprimary statnumber"),p(Di,"class","textwhite"),p(Lt,"class","svgicon"),lt(Lt.src,Cs=Ko)||p(Lt,"src",Cs),p(dt,"class","textfame statnumber"),p(xr,"class","textwhite"),p(Po,"class","textprestige statnumber"),p(we,"class","stats panel-black marg-top svelte-voya4q")},m(zt,Kt){w(zt,e,Kt),ee(n,e,null),d(e,i),d(i,s),d(i,o),d(o,r),d(o,a),d(o,f),d(i,u),d(i,m),g.m(v,m),d(m,_),d(m,y),d(m,k),w(zt,S,Kt),d(S,A),d(S,F),d(S,M),d(S,D),d(D,E),d(S,L),d(S,B),d(B,I),d(B,j),d(B,O),w(zt,se,Kt),d(se,X),d(se,oe),d(se,ce),d(se,xe),d(xe,$e),d(se,Ee),d(se,Fe),d(Fe,_e),d(Fe,Le),d(Fe,He),d(se,Ye),d(se,Ze),d(Ze,ae),d(se,Be),d(se,J),d(J,U),w(zt,fe,Kt),d(fe,je),d(fe,Ie),d(fe,ye),d(fe,qe),d(qe,pt),d(fe,wt),d(fe,Qe),d(Qe,Et),d(Qe,Je),d(Qe,St),d(fe,Ae),d(fe,ft),d(ft,Ve),d(fe,Ct),d(fe,Vt),d(Vt,Ke),w(zt,we,Kt),d(we,ot),d(we,Xe),d(we,ut),d(we,xn),d(xn,li),d(we,Di),d(we,dt),d(dt,Lt),d(dt,jn),d(dt,vc),d(we,xr),d(we,Po),Po.innerHTML=Ss,mn=!0},p(zt,Kt){let ci={};Kt&16&&(ci.fract=zt[4]),Kt&2097156&&(ci.$$scope={dirty:Kt,ctx:zt}),n.$set(ci),(!mn||Kt&32)&&c!==(c=ht(zt[5].prestige)+"")&&G(f,c),(!mn||Kt&8)&&v!==(v=ll(zt[3],C.ui.title.name[V.player.faction][zt[3]-1])+"")&&g.p(v),(!mn||Kt&32)&&b!==(b=ht(Qg(zt[5].prestige))+"")&&G(y,b),(!mn||Kt&32)&&R!==(R=ht(zt[5].kills_today)+"")&&G(E,R),(!mn||Kt&32)&&W!==(W=ht(zt[5].fame_today)+"")&&G(O,W),(!mn||Kt&32)&&pe!==(pe=ht(zt[5].kills_this_week)+"")&&G($e,pe),(!mn||Kt&32)&&Oe!==(Oe=ht(zt[5].fame)+"")&&G(He,Oe),(!mn||Kt&32)&&ge!==(ge=zt[5].fame_position+"")&&G(ae,ge),(!mn||Kt&32)&&Q!==(Q=iu(zt[5].fame_bracket)+"")&&G(U,Q),(!mn||Kt&32)&&Re!==(Re=ht(zt[5].kills_last_week)+"")&&G(pt,Re),(!mn||Kt&32)&&yt!==(yt=ht(zt[5].fame_last_week)+"")&&G(St,yt),(!mn||Kt&32)&&Ut!==(Ut=zt[5].fame_position_last_week+"")&&G(Ve,Ut),(!mn||Kt&32)&&We!==(We=iu(zt[5].fame_bracket_last_week)+"")&&G(Ke,We),(!mn||Kt&32)&&Fs!==(Fs=ht(zt[5].kills_lifetime)+"")&&G(li,Fs),(!mn||Kt&32)&&ai!==(ai=ht(zt[5].fame_lifetime)+"")&&G(vc,ai),(!mn||Kt&32)&&Ss!==(Ss=(zt[5].rank_lifetime>0?ll(zt[5].rank_lifetime,C.ui.title.name[V.player.faction][zt[5].rank_lifetime-1]):"Unranked")+"")&&(Po.innerHTML=Ss)},i(zt){mn||(P(n.$$.fragment,zt),mn=!0)},o(zt){q(n.$$.fragment,zt),mn=!1},d(zt){zt&&(x(e),x(S),x(se),x(fe),x(we)),te(n)}}}function bC(t){let e,n,i=t[15]+"",s,o,r,l;function a(...c){return t[12](t[15],...c)}return{c(){e=h("div"),n=T("Queue "),s=T(i),p(e,"class",o="btn grey "+(t[6].queues&&t[6].queues.includes("arena"+t[15])?"active":""))},m(c,f){w(c,e,f),d(e,n),d(e,s),r||(l=Z(e,"click",a),r=!0)},p(c,f){t=c,f&64&&o!==(o="btn grey "+(t[6].queues&&t[6].queues.includes("arena"+t[15])?"active":""))&&p(e,"class",o)},d(c){c&&x(e),r=!1,l()}}}function vL(t){let e;return{c(){e=T("-")},m(n,i){w(n,e,i)},p:ue,i:ue,o:ue,d(n){n&&x(e)}}}function _L(t){let e,n;return e=new or({props:{amount:Lf(t[5].arena_rating)}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&32&&(o.amount=Lf(i[5].arena_rating)),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function bL(t){let e,n=(t[2]>0?ll(t[2],C.ui.title.name[V.player.faction][t[2]-1]):"Unranked")+"";return{c(){e=h("span"),p(e,"class","absCentered ranktitle svelte-voya4q")},m(i,s){w(i,e,s),e.innerHTML=n},p(i,s){s&4&&n!==(n=(i[2]>0?ll(i[2],C.ui.title.name[V.player.faction][i[2]-1]):"Unranked")+"")&&(e.innerHTML=n)},d(i){i&&x(e)}}}function yL(t){let e,n,i,s,o,r,l=me(t[7]),a=[];for(let m=0;m<l.length;m+=1)a[m]=_C(gC(t,l,m));let c=[gL,hL],f=[];function u(m,g){return m[1]===0?0:m[1]===1?1:-1}return~(s=u(t,-1))&&(o=f[s]=c[s](t)),{c(){e=h("div"),n=h("div");for(let m=0;m<a.length;m+=1)a[m].c();i=h("div"),o&&o.c(),p(n,"class","tab-bar flex"),p(i,"class","panel-bright"),p(e,"class","container svelte-voya4q")},m(m,g){w(m,e,g),d(e,n);for(let v=0;v<a.length;v+=1)a[v]&&a[v].m(n,null);d(e,i),~s&&f[s].m(i,null),r=!0},p(m,g){if(g&130){l=me(m[7]);let _;for(_=0;_<l.length;_+=1){let b=gC(m,l,_);a[_]?a[_].p(b,g):(a[_]=_C(b),a[_].c(),a[_].m(n,null))}for(;_<a.length;_+=1)a[_].d(1);a.length=l.length}let v=s;s=u(m,g),s===v?~s&&f[s].p(m,g):(o&&(Pe(),q(f[v],1,1,()=>{f[v]=null}),Te()),~s?(o=f[s],o?o.p(m,g):(o=f[s]=c[s](m),o.c()),P(o,1),o.m(i,null)):o=null)},i(m){r||(P(o),r=!0)},o(m){q(o),r=!1},d(m){m&&x(e),it(a,m),~s&&f[s].d()}}}function kL(t){let e,n,i=t[0]&&vC(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=vC(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function xL(t,e,n){let i,s;re(t,Qn,k=>n(6,i=k)),re(t,uo,k=>n(0,s=k));let o=["Prestige","Arena"],r=0,l=0,a=1,c=0,f={},u=async()=>{n(5,f=await Ot("/api/pvp/getplayerpvpinfo",{name:V.player.name})),n(2,l=Qa(f.prestige)),n(3,a=Math.min(l+1,12));let k=yd(a)-yd(l),S=f.prestige-yd(l);n(4,c=~~(S/k*100))},m=0,g=["3v3","5v5"],v=k=>{xt(i.queues.includes(k)?"stopqueue":"startqueue",k)},_=k=>{n(1,r=k)},b=(k,S)=>v("arena"+k),y=()=>{nt(uo,s=!1,s)};return t.$$.update=()=>{t.$$.dirty&1025&&(s&&Date.now()-m>3e4||m===0)&&(u(),n(10,m=Date.now()))},[s,r,l,a,c,f,i,o,g,v,m,_,b,y]}var fv=class extends Me{constructor(e){super(),Ce(this,e,xL,kL,Ue,{})}},yC=fv;function kC(t){let e,n,i=t[1].name+"",s,o,r,l=t[1].level!==void 0?`Lv. ${t[1].level} `:"",a,c,f=(t[1].class!==void 0?C.classes[t[1].class].name:"Item")+"",u,m,g,v=(t[1].faction!==void 0?C.factions[t[1].faction].name:"")+"",_,b;return{c(){e=h("div"),n=h("div"),s=T(i),o=h("div"),r=h("span"),a=T(l),c=h("span"),u=T(f),g=h("span"),_=T(v),p(n,"class","textwhite title svelte-1wip79f"),p(c,"class",m=Eo(t[1].class!==void 0?"textc"+t[1].class:"textyellow")+" svelte-1wip79f"),p(g,"class",b=Eo(t[1].faction!==void 0?"textf"+t[1].faction:"")+" svelte-1wip79f"),p(e,"class","panel-black container svelte-1wip79f"),ze(e,"display",t[0]?"block":"none")},m(y,k){w(y,e,k),d(e,n),d(n,s),d(e,o),d(o,r),d(r,a),d(o,c),d(c,u),d(e,g),d(g,_)},p(y,k){k&2&&i!==(i=y[1].name+"")&&G(s,i),k&2&&l!==(l=y[1].level!==void 0?`Lv. ${y[1].level} `:"")&&G(a,l),k&2&&f!==(f=(y[1].class!==void 0?C.classes[y[1].class].name:"Item")+"")&&G(u,f),k&2&&m!==(m=Eo(y[1].class!==void 0?"textc"+y[1].class:"textyellow")+" svelte-1wip79f")&&p(c,"class",m),k&2&&v!==(v=(y[1].faction!==void 0?C.factions[y[1].faction].name:"")+"")&&G(_,v),k&2&&b!==(b=Eo(y[1].faction!==void 0?"textf"+y[1].faction:"")+" svelte-1wip79f")&&p(g,"class",b),k&1&&ze(e,"display",y[0]?"block":"none")},d(y){y&&x(e)}}}function wL(t){let e,n=t[1]&&kC(t);return{c(){n&&n.c(),e=ve()},m(i,s){n&&n.m(i,s),w(i,e,s)},p(i,[s]){i[1]?n?n.p(i,s):(n=kC(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ue,o:ue,d(i){i&&x(e),n&&n.d(i)}}}function ML(t,e,n){let i;re(t,am,o=>n(0,i=o));let s;return t.$$.update=()=>{t.$$.dirty&1&&i>0&&V.isEntityIdTaken(i)&&n(1,s=V.entity(i))},[i,s]}var uv=class extends Me{constructor(e){super(),Ce(this,e,ML,wL,Ue,{})}},xC=uv;var mv=ra,ou=async t=>{let e=await Ot("/api/account/info");mv.set(e),qo.set(e.storepoints),t&&t(e)};function FL(t){let e,n,i,s,o,r,l,a,c=C.ui.elixir.chatsupport+"",f,u,m,g,v,_=C.ui.elixir.noads+"",b,y,k,S,A,F,M,D,R,E=C.ui.elixir.bagslots+"",L,B,I,N,j,W,O,se,X,oe=C.ui.elixir.stashstorage+"",ce,xe,pe,$e,Ee,Fe,_e,H,Le,Oe=C.ui.elixir.merchantlimit+"",He,Ye,Ze,ge,ae,Be,J,Q,U,fe=C.ui.elixir.merchantduration+"",je,Ie;return{c(){e=h("div"),n=h("div"),n.innerHTML='<img class="artwork svelte-cbx1m" src="/data/ui/elixir.svg?v=8588529"/><div class="sparkle svelte-cbx1m" style="font-size:35px; left:30%; top:30%; animation-delay: -1s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:50px; left:40%; top:60%; animation-delay: -2s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:80px; left:60%; top:20%; animation-delay: -3s;">+</div>',i=h("div"),s=h("h1"),s.innerHTML='Hordes <span class="textsub">Elixir</span>',o=h("div"),r=h("img"),a=Ne(),f=T(c),u=h("div"),m=h("img"),v=Ne(),b=T(_),y=h("div"),k=h("img"),A=Ne(),F=h("span"),F.textContent=`${$n[0].inventory}`,M=Ne(),D=h("span"),D.textContent=`${$n[1].inventory}`,R=Ne(),L=T(E),B=h("div"),I=h("img"),j=Ne(),W=h("span"),W.textContent=`${$n[0].stash}`,O=Ne(),se=h("span"),se.textContent=`${$n[1].stash}`,X=Ne(),ce=T(oe),xe=h("div"),pe=h("img"),Ee=Ne(),Fe=h("span"),Fe.textContent=`${$n[0].auction}`,_e=Ne(),H=h("span"),H.textContent=`${$n[1].auction}`,Le=Ne(),He=T(Oe),Ye=h("div"),Ze=h("img"),ae=Ne(),Be=h("span"),Be.textContent=`${$n[0].auctionHours}h`,J=Ne(),Q=h("span"),Q.textContent=`${$n[1].auctionHours}h`,U=Ne(),je=T(fe),Ie=h("div"),Ie.textContent=`${C.ui.elixir.tba}`,p(n,"class","artcontainer svelte-cbx1m"),p(s,"class","textprimary"),p(r,"class","svgicon"),lt(r.src,l="/data/ui/icons/gem.svg?v=8588529")||p(r,"src",l),p(o,"class","textwhite"),p(m,"class","svgicon"),lt(m.src,g="/data/ui/icons/check.svg?v=8588529")||p(m,"src",g),p(u,"class","textwhite"),p(k,"class","svgicon"),lt(k.src,S="/data/ui/icons/check.svg?v=8588529")||p(k,"src",S),p(F,"class","old svelte-cbx1m"),p(D,"class","textsub"),p(y,"class","textwhite"),p(I,"class","svgicon"),lt(I.src,N="/data/ui/icons/check.svg?v=8588529")||p(I,"src",N),p(W,"class","old svelte-cbx1m"),p(se,"class","textsub"),p(B,"class","textwhite"),p(pe,"class","svgicon"),lt(pe.src,$e="/data/ui/icons/check.svg?v=8588529")||p(pe,"src",$e),p(Fe,"class","old svelte-cbx1m"),p(H,"class","textsub"),p(xe,"class","textwhite"),p(Ze,"class","svgicon"),lt(Ze.src,ge="/data/ui/icons/check.svg?v=8588529")||p(Ze,"src",ge),p(Be,"class","old svelte-cbx1m"),p(Q,"class","textsub"),p(Ye,"class","textwhite"),p(Ie,"class","textgrey"),p(e,"class","split svelte-cbx1m")},m(ye,qe){w(ye,e,qe),d(e,n),d(e,i),d(i,s),d(i,o),d(o,r),d(o,a),d(o,f),d(i,u),d(u,m),d(u,v),d(u,b),d(i,y),d(y,k),d(y,A),d(y,F),d(y,M),d(y,D),d(y,R),d(y,L),d(i,B),d(B,I),d(B,j),d(B,W),d(B,O),d(B,se),d(B,X),d(B,ce),d(i,xe),d(xe,pe),d(xe,Ee),d(xe,Fe),d(xe,_e),d(xe,H),d(xe,Le),d(xe,He),d(i,Ye),d(Ye,Ze),d(Ye,ae),d(Ye,Be),d(Ye,J),d(Ye,Q),d(Ye,U),d(Ye,je),d(i,Ie)},p:ue,i:ue,o:ue,d(ye){ye&&x(e)}}}var pv=class extends Me{constructor(e){super(),Ce(this,e,null,FL,Ue,{})}},wC=pv;var ct={SECONDS_A_MINUTE:60,SECONDS_A_HOUR:3600,SECONDS_A_DAY:86400,SECONDS_A_WEEK:604800,MILLISECONDS_A_SECOND:1e3,MILLISECONDS_A_MINUTE:6e4,MILLISECONDS_A_HOUR:36e5,MILLISECONDS_A_DAY:864e5,MILLISECONDS_A_WEEK:6048e5,MS:"millisecond",S:"second",MIN:"minute",H:"hour",D:"day",W:"week",M:"month",Q:"quarter",Y:"year",DATE:"date",FORMAT_DEFAULT:"YYYY-MM-DDTHH:mm:ssZ",INVALID_DATE_STRING:"Invalid Date",REGEX_PARSE:/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,REGEX_FORMAT:/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g},dv=(t,e,n)=>{let i=String(t);return!i||i.length>=e?t:`${Array(e+1-i.length).join(n)}${t}`},CL=t=>{let e=-t.utcOffset(),n=Math.abs(e),i=Math.floor(n/60),s=n%60;return`${e<=0?"+":"-"}${dv(i,2,"0")}:${dv(s,2,"0")}`},SL=(t,e)=>{let n=(e.year()-t.year())*12+(e.month()-t.month()),i=t.clone().add(n,ct.M),s=e-i<0,o=t.clone().add(n+(s?-1:1),ct.M);return Number(-(n+(e-i)/(s?i-o:o-i))||0)},AL=t=>t<0?Math.ceil(t)||0:Math.floor(t),PL=t=>({M:ct.M,y:ct.Y,w:ct.W,d:ct.D,h:ct.H,m:ct.MIN,s:ct.S,ms:ct.MS,Q:ct.Q})[t]||String(t||"").toLowerCase().replace(/s$/,""),TL=t=>t===void 0,EL={s:dv,z:CL,m:SL,a:AL,p:PL,u:TL},DL={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},xd="en",bl={};bl[xd]=DL;var hv=t=>t instanceof Za,wd=(t,e,n)=>{let i;if(!t)return xd;if(typeof t=="string")bl[t]&&(i=t),e&&(bl[t]=e,i=t);else{let{name:s}=t;bl[s]=t,i=s}return n||(xd=i),i},Hn=(t,e,n)=>{if(hv(t))return t.clone();let i=e?typeof e=="string"?{format:e,pl:n}:e:{};return i.date=t,new Za(i)},IL=(t,e)=>Hn(t,{locale:e.$L,utc:e.$u,$offset:e.$offset}),ln=EL;ln.l=wd;ln.i=hv;ln.w=IL;var VL=t=>{let{date:e,utc:n}=t;if(e===null)return new Date(NaN);if(ln.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){let i=e.match(ct.REGEX_PARSE);if(i)return n?new Date(Date.UTC(i[1],i[2]-1,i[3]||1,i[4]||0,i[5]||0,i[6]||0,i[7]||0)):new Date(i[1],i[2]-1,i[3]||1,i[4]||0,i[5]||0,i[6]||0,i[7]||0)}return new Date(e)},Za=class{constructor(e){this.$L=this.$L||wd(e.locale,null,!0),this.parse(e)}parse(e){this.$d=VL(e),this.init()}init(){let{$d:e}=this;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()}$utils(){return ln}isValid(){return this.$d.toString()!==ct.INVALID_DATE_STRING}isSame(e,n){let i=Hn(e);return this.startOf(n)<=i&&i<=this.endOf(n)}isAfter(e,n){return Hn(e)<this.startOf(n)}isBefore(e,n){return this.endOf(n)<Hn(e)}$g(e,n,i){return ln.u(e)?this[n]:this.set(i,e)}year(e){return this.$g(e,"$y",ct.Y)}month(e){return this.$g(e,"$M",ct.M)}day(e){return this.$g(e,"$W",ct.D)}date(e){return this.$g(e,"$D",ct.DATE)}hour(e){return this.$g(e,"$H",ct.H)}minute(e){return this.$g(e,"$m",ct.MIN)}second(e){return this.$g(e,"$s",ct.S)}millisecond(e){return this.$g(e,"$ms",ct.MS)}unix(){return Math.floor(this.valueOf()/1e3)}valueOf(){return this.$d.getTime()}startOf(e,n){let i=ln.u(n)?!0:n,s=ln.p(e),o=(u,m)=>{let g=ln.w(this.$u?Date.UTC(this.$y,m,u):new Date(this.$y,m,u),this);return i?g:g.endOf(ct.D)},r=(u,m)=>{let g=[0,0,0,0],v=[23,59,59,999];return ln.w(this.toDate()[u].apply(this.toDate(),(i?g:v).slice(m)),this)},{$W:l,$M:a,$D:c}=this,f=`set${this.$u?"UTC":""}`;switch(s){case ct.Y:return i?o(1,0):o(31,11);case ct.M:return i?o(1,a):o(0,a+1);case ct.W:{let u=this.$locale().weekStart||0,m=(l<u?l+7:l)-u;return o(i?c-m:c+(6-m),a)}case ct.D:case ct.DATE:return r(`${f}Hours`,0);case ct.H:return r(`${f}Minutes`,1);case ct.MIN:return r(`${f}Seconds`,2);case ct.S:return r(`${f}Milliseconds`,3);default:return this.clone()}}endOf(e){return this.startOf(e,!1)}$set(e,n){let i=ln.p(e),s=`set${this.$u?"UTC":""}`,o={[ct.D]:`${s}Date`,[ct.DATE]:`${s}Date`,[ct.M]:`${s}Month`,[ct.Y]:`${s}FullYear`,[ct.H]:`${s}Hours`,[ct.MIN]:`${s}Minutes`,[ct.S]:`${s}Seconds`,[ct.MS]:`${s}Milliseconds`}[i],r=i===ct.D?this.$D+(n-this.$W):n;if(i===ct.M||i===ct.Y){let l=this.clone().set(ct.DATE,1);l.$d[o](r),l.init(),this.$d=l.set(ct.DATE,Math.min(this.$D,l.daysInMonth())).toDate()}else o&&this.$d[o](r);return this.init(),this}set(e,n){return this.clone().$set(e,n)}get(e){return this[ln.p(e)]()}add(e,n){e=Number(e);let i=ln.p(n),s=l=>{let a=Hn(this);return ln.w(a.date(a.date()+Math.round(l*e)),this)};if(i===ct.M)return this.set(ct.M,this.$M+e);if(i===ct.Y)return this.set(ct.Y,this.$y+e);if(i===ct.D)return s(1);if(i===ct.W)return s(7);let o={[ct.MIN]:ct.MILLISECONDS_A_MINUTE,[ct.H]:ct.MILLISECONDS_A_HOUR,[ct.S]:ct.MILLISECONDS_A_SECOND}[i]||1,r=this.$d.getTime()+e*o;return ln.w(r,this)}subtract(e,n){return this.add(e*-1,n)}format(e){if(!this.isValid())return ct.INVALID_DATE_STRING;let n=e||ct.FORMAT_DEFAULT,i=ln.z(this),s=this.$locale(),{$H:o,$m:r,$M:l}=this,{weekdays:a,months:c,meridiem:f}=s,u=(_,b,y,k)=>_&&(_[b]||_(this,n))||y[b].substr(0,k),m=_=>ln.s(o%12||12,_,"0"),g=f||((_,b,y)=>{let k=_<12?"AM":"PM";return y?k.toLowerCase():k}),v={YY:String(this.$y).slice(-2),YYYY:this.$y,M:l+1,MM:ln.s(l+1,2,"0"),MMM:u(s.monthsShort,l,c,3),MMMM:c[l]||c(this,n),D:this.$D,DD:ln.s(this.$D,2,"0"),d:String(this.$W),dd:u(s.weekdaysMin,this.$W,a,2),ddd:u(s.weekdaysShort,this.$W,a,3),dddd:a[this.$W],H:String(o),HH:ln.s(o,2,"0"),h:m(1),hh:m(2),a:g(o,r,!0),A:g(o,r,!1),m:String(r),mm:ln.s(r,2,"0"),s:String(this.$s),ss:ln.s(this.$s,2,"0"),SSS:ln.s(this.$ms,3,"0"),Z:i};return n.replace(ct.REGEX_FORMAT,(_,b)=>b||v[_]||i.replace(":",""))}utcOffset(){return-Math.round(this.$d.getTimezoneOffset()/15)*15}diff(e,n,i){let s=ln.p(n),o=Hn(e),r=(o.utcOffset()-this.utcOffset())*ct.MILLISECONDS_A_MINUTE,l=this-o,a=ln.m(this,o);return a={[ct.Y]:a/12,[ct.M]:a,[ct.Q]:a/3,[ct.W]:(l-r)/ct.MILLISECONDS_A_WEEK,[ct.D]:(l-r)/ct.MILLISECONDS_A_DAY,[ct.H]:l/ct.MILLISECONDS_A_HOUR,[ct.MIN]:l/ct.MILLISECONDS_A_MINUTE,[ct.S]:l/ct.MILLISECONDS_A_SECOND}[s]||l,i?a:ln.a(a)}daysInMonth(){return this.endOf(ct.M).$D}$locale(){return bl[this.$L]}locale(e,n){if(!e)return this.$L;let i=this.clone();return i.$L=wd(e,n,!0),i}clone(){return ln.w(this.$d,this)}toDate(){return new Date(this.valueOf())}toJSON(){return this.isValid()?this.toISOString():null}toISOString(){return this.$d.toISOString()}toString(){return this.$d.toUTCString()}};Hn.prototype=Za.prototype;Hn.extend=(t,e)=>(t(e,Za,Hn),Hn);Hn.locale=wd;Hn.isDayjs=hv;Hn.unix=t=>Hn(t*1e3);Hn.en=bl[xd];Hn.Ls=bl;var ru=Hn;function MC(t,e,n){let i=t.slice();return i[13]=e[n],i[15]=n,i}function LL(t){let e=C.ui.elixir.notactive+"",n;return{c(){n=T(e)},m(i,s){w(i,n,s)},p:ue,d(i){i&&x(n)}}}function qL(t){let e,n,i,s=ru(t[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"",o;return{c(){e=h("img"),i=Ne(),o=T(s),p(e,"class","svgicon"),lt(e.src,n="/data/ui/icons/check.svg?v=8588529")||p(e,"src",n)},m(r,l){w(r,e,l),w(r,i,l),w(r,o,l)},p(r,l){l&2&&s!==(s=ru(r[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"")&&G(o,s)},d(r){r&&(x(e),x(i),x(o))}}}function FC(t){let e,n=t[13].name+"",i,s,o,r,l,a,c;o=new rr({props:{amount:t[13].price}});function f(...u){return t[9](t[15],...u)}return{c(){e=h("btn"),i=T(n),s=Ne(),ne(o.$$.fragment),p(e,"class",r="btn black navbtn textwhite "+(t[5]==t[15]?"active":"")+" big")},m(u,m){w(u,e,m),d(e,i),d(e,s),ee(o,e,null),l=!0,a||(c=Z(e,"click",f),a=!0)},p(u,m){t=u,(!l||m&32&&r!==(r="btn black navbtn textwhite "+(t[5]==t[15]?"active":"")+" big"))&&p(e,"class",r)},i(u){l||(P(o.$$.fragment,u),l=!0)},o(u){q(o.$$.fragment,u),l=!1},d(u){u&&x(e),te(o),a=!1,c()}}}function CC(t){let e,n=C.ui.elixir.sendgift+"",i,s,o,r;return{c(){e=h("btn"),i=T(n),p(e,"class",s="btn navbtn "+(t[6]?"active white":"textprimary")+" big")},m(l,a){w(l,e,a),d(e,i),o||(r=Z(e,"click",t[10]),o=!0)},p(l,a){a&64&&s!==(s="btn navbtn "+(l[6]?"active white":"textprimary")+" big")&&p(e,"class",s)},d(l){l&&x(e),o=!1,r()}}}function RL(t){let e;function n(o,r){return o[0]=="addsubscription"?UL:BL}let i=n(t,-1),s=i(t);return{c(){e=h("div"),s.c(),p(e,"class","fadeIn card marg-top")},m(o,r){w(o,e,r),s.m(e,null)},p(o,r){i!==(i=n(o,r))&&(s.d(1),s=i(o),s&&(s.c(),s.m(e,null)))},i:ue,o:ue,d(o){o&&x(e),s.d()}}}function zL(t){let e,n,i=(t[6]?C.ui.elixir.willgift:C.ui.elixir.willadd)+"",s,o,r,l=C.ui.elixir.subduration[t[5]]+"",a,c,f,u,m=C.ui.elixir.willcost+"",g,v,_,b,y,k,S,A,F=(t[6]?C.ui.elixir.send:t[1].subscribed_until?C.ui.elixir.extend:C.ui.elixir.activate)+"",M,D,R,E,L;v=new rr({props:{amount:t[8].price}});let B=[$L,OL],I=[];function N(O,se){return O[6]?1:0}b=N(t,-1),y=I[b]=B[b](t);let j=t[0]=="addsubscription"&&t[2]&&SC(t),W=t[1].storepoints<t[8].price&&AC(t);return{c(){e=h("div"),n=h("div"),s=T(i),o=Ne(),r=h("span"),a=T(l),c=Ne(),f=h("span"),f.textContent=`${C.ui.elixir.subscription}`,u=T("? "),g=T(m),ne(v.$$.fragment),_=T("."),y.c(),k=ve(),j&&j.c(),S=h("div"),A=h("div"),M=T(F),W&&W.c(),p(r,"class","bold textwhite"),p(f,"class","textsub"),p(n,"class","textgrey"),p(A,"class",D="btn grey formatted "+(t[3]=="addsubscription"||t[1].storepoints<t[8].price?"disabled":"")),p(S,"class","subnav"),p(e,"class","fadeIn card marg-top"),ze(e,"padding","18px")},m(O,se){w(O,e,se),d(e,n),d(n,s),d(n,o),d(n,r),d(r,a),d(n,c),d(n,f),d(n,u),d(n,g),ee(v,n,null),d(n,_),I[b].m(e,null),d(e,k),j&&j.m(e,null),d(e,S),d(S,A),d(A,M),W&&W.m(e,null),R=!0,E||(L=Z(A,"click",t[12]),E=!0)},p(O,se){(!R||se&64)&&i!==(i=(O[6]?C.ui.elixir.willgift:C.ui.elixir.willadd)+"")&&G(s,i),(!R||se&32)&&l!==(l=C.ui.elixir.subduration[O[5]]+"")&&G(a,l);let X={};se&256&&(X.amount=O[8].price),v.$set(X);let oe=b;b=N(O,se),b===oe?I[b].p(O,se):(Pe(),q(I[oe],1,1,()=>{I[oe]=null}),Te(),y=I[b],y?y.p(O,se):(y=I[b]=B[b](O),y.c()),P(y,1),y.m(e,k)),O[0]=="addsubscription"&&O[2]?j?j.p(O,se):(j=SC(O),j.c(),j.m(e,S)):j&&(j.d(1),j=null),(!R||se&66)&&F!==(F=(O[6]?C.ui.elixir.send:O[1].subscribed_until?C.ui.elixir.extend:C.ui.elixir.activate)+"")&&G(M,F),(!R||se&266&&D!==(D="btn grey formatted "+(O[3]=="addsubscription"||O[1].storepoints<O[8].price?"disabled":"")))&&p(A,"class",D),O[1].storepoints<O[8].price?W||(W=AC(O),W.c(),W.m(e,null)):W&&(W.d(1),W=null)},i(O){R||(P(v.$$.fragment,O),P(y),R=!0)},o(O){q(v.$$.fragment,O),q(y),R=!1},d(O){O&&x(e),te(v),I[b].d(),j&&j.d(),W&&W.d(),E=!1,L()}}}function BL(t){let e;return{c(){e=h("p"),e.textContent="Please Select an option above!",p(e,"class","fadeIn textgrey")},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function UL(t){let e;return{c(){e=h("p"),e.textContent=`${C.ui.elixir.thankyou}`,p(e,"class","fadeIn textsub")},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function OL(t){let e,n,i,s;function o(l){t[11](l)}let r={};return t[7]!==void 0&&(r.name=t[7]),n=new kd({props:r}),$t.push(()=>Lo(n,"name",o)),{c(){e=h("div"),ne(n.$$.fragment),p(e,"class","subnav")},m(l,a){w(l,e,a),ee(n,e,null),s=!0},p(l,a){let c={};!i&&a&128&&(i=!0,c.name=l[7],Vo(()=>i=!1)),n.$set(c)},i(l){s||(P(n.$$.fragment,l),s=!0)},o(l){q(n.$$.fragment,l),s=!1},d(l){l&&x(e),te(n)}}}function $L(t){let e,n=C.ui.elixir.enable+"",i,s,o,r=ru(t[1].subscribed_until||void 0).add(t[8].days,"day").format("MMM DD, YYYY HH:mm")+"",l,a;return{c(){e=h("p"),i=T(n),s=Ne(),o=h("span"),l=T(r),a=T("."),p(o,"class","textwhite"),p(e,"class","bold textsub")},m(c,f){w(c,e,f),d(e,i),d(e,s),d(e,o),d(o,l),d(e,a)},p(c,f){f&258&&r!==(r=ru(c[1].subscribed_until||void 0).add(c[8].days,"day").format("MMM DD, YYYY HH:mm")+"")&&G(l,r)},i:ue,o:ue,d(c){c&&x(e)}}}function SC(t){let e,n;return{c(){e=h("p"),n=T(t[2]),p(e,"class","fadeIn textred")},m(i,s){w(i,e,s),d(e,n)},p(i,s){s&4&&G(n,i[2])},d(i){i&&x(e)}}}function AC(t){let e,n,i=C.ui.elixir.pointserror+"",s,o,r;return{c(){e=h("p"),n=h("small"),s=T(i),o=Ne(),r=h("a"),r.textContent=`${C.ui.elixir.buypoints} ${C.ui.elixir.currency}`,p(r,"class","textprimary"),p(r,"href","/store")},m(l,a){w(l,e,a),d(e,n),d(n,s),d(n,o),d(n,r)},d(l){l&&x(e)}}}function NL(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v,_,b;n=new wC({});function y(B,I){return B[1].subscribed_until?qL:LL}let k=y(t,-1),S=k(t);a=new rr({props:{amount:t[1].storepoints}});let A=me(fd),F=[];for(let B=0;B<A.length;B+=1)F[B]=FC(MC(t,A,B));let M=B=>q(F[B],1,1,()=>{F[B]=null}),D=t[5]!==void 0&&CC(t),R=[zL,RL],E=[];function L(B,I){return B[5]!==void 0?0:1}return v=L(t,-1),_=E[v]=R[v](t),{c(){e=h("div"),ne(n.$$.fragment),i=h("small"),i.textContent=`${C.ui.elixir.subscription}`,s=h("div"),S.c(),r=h("small"),r.textContent=`${C.ui.elixir.currency}`,l=h("div"),ne(a.$$.fragment),c=Ne(),f=h("a"),f.textContent=`${C.ui.elixir.buypoints} ${C.ui.elixir.currency}`,u=h("p"),u.textContent=`${C.ui.elixir.support}`,m=h("div");for(let B=0;B<F.length;B+=1)F[B].c();g=ve(),D&&D.c(),_.c(),p(i,"class","textgrey"),p(s,"class",o="cardinfo "+(t[1].subscribed_until?"textsub":"textgrey")),p(r,"class","textgrey"),p(f,"class","textwhite"),p(f,"href","/store"),p(l,"class","cardinfo"),p(u,"class","textgrey"),p(m,"class","subnav"),p(e,"class","card")},m(B,I){w(B,e,I),ee(n,e,null),d(e,i),d(e,s),S.m(s,null),d(e,r),d(e,l),ee(a,l,null),d(l,c),d(l,f),d(e,u),d(e,m);for(let N=0;N<F.length;N+=1)F[N]&&F[N].m(m,null);d(m,g),D&&D.m(m,null),E[v].m(e,null),b=!0},p(B,[I]){k===(k=y(B,I))&&S?S.p(B,I):(S.d(1),S=k(B),S&&(S.c(),S.m(s,null))),(!b||I&2&&o!==(o="cardinfo "+(B[1].subscribed_until?"textsub":"textgrey")))&&p(s,"class",o);let N={};if(I&2&&(N.amount=B[1].storepoints),a.$set(N),I&32){A=me(fd);let W;for(W=0;W<A.length;W+=1){let O=MC(B,A,W);F[W]?(F[W].p(O,I),P(F[W],1)):(F[W]=FC(O),F[W].c(),P(F[W],1),F[W].m(m,g))}for(Pe(),W=A.length;W<F.length;W+=1)M(W);Te()}B[5]!==void 0?D?D.p(B,I):(D=CC(B),D.c(),D.m(m,null)):D&&(D.d(1),D=null);let j=v;v=L(B,I),v===j?E[v].p(B,I):(Pe(),q(E[j],1,1,()=>{E[j]=null}),Te(),_=E[v],_?_.p(B,I):(_=E[v]=R[v](B),_.c()),P(_,1),_.m(e,null))},i(B){if(!b){P(n.$$.fragment,B),P(a.$$.fragment,B);for(let I=0;I<A.length;I+=1)P(F[I]);P(_),b=!0}},o(B){q(n.$$.fragment,B),q(a.$$.fragment,B),F=F.filter(Boolean);for(let I=0;I<F.length;I+=1)q(F[I]);q(_),b=!1},d(B){B&&x(e),te(n),S.d(),te(a),it(F,B),D&&D.d(),E[v].d()}}}function jL(t,e,n){let i,s,o=!1,r,{user:l}=e,{flash:a=void 0}=e,{flashmsg:c=void 0}=e,{action:f=void 0}=e,{apiCall:u}=e,m=(b,y)=>n(5,s=b),g=b=>n(6,o=!o);function v(b){r=b,n(7,r)}let _=b=>u("addsubscription","/api/account/addsubscription",{value:s,gift:o?r:void 0},!0,y=>{y.result=="ok"&&(n(5,s=void 0),n(0,a="addsubscription"))});return t.$$set=b=>{"user"in b&&n(1,l=b.user),"flash"in b&&n(0,a=b.flash),"flashmsg"in b&&n(2,c=b.flashmsg),"action"in b&&n(3,f=b.action),"apiCall"in b&&n(4,u=b.apiCall)},t.$$.update=()=>{t.$$.dirty&32&&n(8,i=fd[s])},[a,l,c,f,u,s,o,r,i,m,g,v,_]}var gv=class extends Me{constructor(e){super(),Ce(this,e,jL,NL,Ue,{user:1,flash:0,flashmsg:2,action:3,apiCall:4})}},PC=gv;function TC(t){let e,n;return e=new Nt({props:{origin:"center",title:"Store / Elixir",icon:"gem",$$slots:{default:[WL]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},p(i,s){let o={};s&316&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function WL(t){let e,n,i;return n=new PC({props:{user:t[5],flash:t[2],flashmsg:t[3],action:t[4],apiCall:t[0]}}),{c(){e=h("div"),ne(n.$$.fragment),p(e,"class","container svelte-1lv1z23")},m(s,o){w(s,e,o),ee(n,e,null),i=!0},p(s,o){let r={};o&32&&(r.user=s[5]),o&4&&(r.flash=s[2]),o&8&&(r.flashmsg=s[3]),o&16&&(r.action=s[4]),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){q(n.$$.fragment,s),i=!1},d(s){s&&x(e),te(n)}}}function GL(t){let e,n,i=t[1]&&t[5]&&TC(t);return{c(){i&&i.c(),e=ve()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[1]&&s[5]?i?(i.p(s,o),o&34&&P(i,1)):(i=TC(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Pe(),q(i,1,1,()=>{i=null}),Te())},i(s){n||(P(i),n=!0)},o(s){q(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function HL(t,e,n){let i,s;re(t,Li,u=>n(1,i=u)),re(t,mv,u=>n(5,s=u));let o,r,l,a,c=async(u,m,g,v,_)=>{n(4,a=u);let b=await Ot(m,g);n(4,a=void 0),b.result==="ok"?n(2,r=void 0):(n(2,r=u),n(3,l=b.result)),v&&ou(),_&&_(b)},f=u=>nt(Li,i=!1,i);return t.$$.update=()=>{t.$$.dirty&2&&i&&ou()},[c,i,r,l,a,s,f]}var vv=class extends Me{constructor(e){super(),Ce(this,e,HL,GL,Ue,{apiCall:0})}get apiCall(){return this.$$.ctx[0]}},EC=vv;function DC(t){let e,n;return{c(){e=h("ins"),n=h("script"),n.textContent="(adsbygoogle = window.adsbygoogle || []).push({});",p(e,"class","adsbygoogle"),ze(e,"display","inline-block"),ze(e,"width","728px"),ze(e,"height","90px"),p(e,"data-ad-client","ca-pub-6128207871826113"),p(e,"data-ad-slot","2385450998")},m(i,s){w(i,e,s),w(i,n,s)},d(i){i&&(x(e),x(n))}}}function YL(t){let e,n,i,s,o,r,l,a=t[1]%2==0&&DC(t);return{c(){e=h("div"),n=h("h3"),i=T("Hordes.io is free! Buy "),s=h("span"),s.innerHTML='<span class="textwhite">Hordes</span> <img class="svgicon texticon" src="/data/ui/icons/gem.svg?v=8588529"/>  Elixir',o=T(" to hide this window and support development."),a&&a.c(),p(s,"class","btn textsub"),p(n,"class","textgrey blocktext svelte-svpjti"),p(e,"class","container panel-black svelte-svpjti")},m(c,f){w(c,e,f),d(e,n),d(n,i),d(n,s),d(n,o),a&&a.m(e,null),r||(l=Z(s,"click",t[2]),r=!0)},p(c,[f]){c[1]%2==0?a||(a=DC(c),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:ue,o:ue,d(c){c&&x(e),a&&a.d(),r=!1,l()}}}function XL(t,e,n){let i,s;return re(t,Li,r=>n(0,i=r)),re(t,Ar,r=>n(1,s=r)),[i,s,r=>nt(Li,i=!0,i)]}var _v=class extends Me{constructor(e){super(),Ce(this,e,XL,YL,Ue,{})}},IC=_v;function VC(t,e,n){let i=t.slice();return i[4]=e[n],i}function LC(t){let e,n,i=ni(t[4].viewers)+"",s;return{c(){e=h("div"),n=h("span"),s=T(i),p(n,"class","textgreen"),p(e,"class","bold viewcount textbox svelte-13wcf6i")},m(o,r){w(o,e,r),d(e,n),d(n,s)},p(o,r){r&2&&i!==(i=ni(o[4].viewers)+"")&&G(s,i)},d(o){o&&x(e)}}}function qC(t){let e,n,i,s=t[4].name+"",o,r,l,a,c=t[4].viewers&&LC(t);return{c(){e=h("a"),n=h("div"),c&&c.c(),i=h("div"),o=T(s),p(i,"class","name textbox svelte-13wcf6i"),p(n,"class","border black preview svelte-13wcf6i"),p(n,"style",r=(t[4].preview?"background-image:url("+t[4].preview+");":"")+"); "+(t[0]?"margin-top:2px;":"")),p(e,"class","fadeIn stream svelte-13wcf6i"),p(e,"target","_blank"),p(e,"rel","noopener noreferrer"),p(e,"href",l=t[4].url),p(e,"style",a=t[0]?"":"width:calc(100%/6);")},m(f,u){w(f,e,u),d(e,n),c&&c.m(n,null),d(n,i),d(i,o)},p(f,u){f[4].viewers?c?c.p(f,u):(c=LC(f),c.c(),c.m(n,i)):c&&(c.d(1),c=null),u&2&&s!==(s=f[4].name+"")&&G(o,s),u&3&&r!==(r=(f[4].preview?"background-image:url("+f[4].preview+");":"")+"); "+(f[0]?"margin-top:2px;":""))&&p(n,"style",r),u&2&&l!==(l=f[4].url)&&p(e,"href",l),u&1&&a!==(a=f[0]?"":"width:calc(100%/6);")&&p(e,"style",a)},d(f){f&&x(e),c&&c.d()}}}function QL(t){let e,n,i=me(t[1]),s=[];for(let o=0;o<i.length;o+=1)s[o]=qC(VC(t,i,o));return{c(){e=h("div");for(let o=0;o<s.length;o+=1)s[o].c();p(e,"style",n="pointer-events: all; "+(t[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))},m(o,r){w(o,e,r);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null)},p(o,[r]){if(r&3){i=me(o[1]);let l;for(l=0;l<i.length;l+=1){let a=VC(o,i,l);s[l]?s[l].p(a,r):(s[l]=qC(a),s[l].c(),s[l].m(e,null))}for(;l<s.length;l+=1)s[l].d(1);s.length=i.length}r&1&&n!==(n="pointer-events: all; "+(o[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))&&p(e,"style",n)},i:ue,o:ue,d(o){o&&x(e),it(s,o)}}}function ZL(t,e,n){let{vertical:i=!1}=e,s=[],o,r=async()=>{o=setTimeout(r,2e4),n(1,s=await Ot("/api/twitch/streams",{max:6}))};return Pn(r),Tn(l=>{o&&clearTimeout(o)}),t.$$set=l=>{"vertical"in l&&n(0,i=l.vertical)},[i,s]}var bv=class extends Me{constructor(e){super(),Ce(this,e,ZL,QL,Ue,{vertical:0})}},RC=bv;function zC(t){let e,n,i=t[1][3]+"",s,o,r=t[1][1]+"",l,a,c,f=t[1][0]+"",u,m,g,v=t[1][2]+"",_,b,y,k=t[1][4]+"",S,A;return{c(){e=h("small"),n=h("div"),s=T(i),o=h("div"),l=T(r),a=T(" fps"),c=h("div"),u=T(f),m=T(" ms"),g=h("div"),_=T(v),b=T(" KBs"),y=h("div"),S=T(k),A=T(" BFR"),p(n,"class","textyellow"),p(o,"class","textgreen"),p(c,"class","textcyan"),p(g,"class","textorange"),p(y,"class","textpurp"),p(e,"class","marg-top bar btn black grey svelte-nijy6x")},m(F,M){w(F,e,M),d(e,n),d(n,s),d(e,o),d(o,l),d(o,a),d(e,c),d(c,u),d(c,m),d(e,g),d(g,_),d(g,b),d(e,y),d(y,S),d(y,A)},p(F,M){M&2&&i!==(i=F[1][3]+"")&&G(s,i),M&2&&r!==(r=F[1][1]+"")&&G(l,r),M&2&&f!==(f=F[1][0]+"")&&G(u,f),M&2&&v!==(v=F[1][2]+"")&&G(_,v),M&2&&k!==(k=F[1][4]+"")&&G(S,k)},d(F){F&&x(e)}}}function JL(t){let e,n=t[0]&&zC(t);return{c(){n&&n.c(),e=ve()},m(i,s){n&&n.m(i,s),w(i,e,s)},p(i,[s]){i[0]?n?n.p(i,s):(n=zC(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ue,o:ue,d(i){i&&x(e),n&&n.d(i)}}}function KL(t,e,n){let i,s;return re(t,da,o=>n(0,i=o)),re(t,cm,o=>n(1,s=o)),[i,s]}var yv=class extends Me{constructor(e){super(),Ce(this,e,KL,JL,Ue,{})}},BC=yv;var o2={};Xn(o2,{canvas:()=>yi,changeCanvas:()=>o0,init:()=>rR,onWorldDestroy:()=>fR,onWorldEnter:()=>cR,postTick:()=>lR});var xv=0,is=0,wv=0,Mv=5,lu=10,au=10,$C=0,eq,Fv=0,Cv=0,Sv=0,Av=0,NC=(t,e)=>{t=Math.max(150,Math.min(1500,t)),is=t*.8,wv=Math.min(is,150),xv=20,Fv=is,Av=is**2,Cv=Math.min(is,50),Sv=Math.min(is/32,150/32)**2,gt.far=$C=t,eq=t**2,Uc(gt),au=Math.min(is,100+e*50),lu=Math.min(is,40+e*10),Mv=(au+lu)/2,Nn=Math.ceil(t*2/32),Nn+=Nn%2,ur=Nn/2,ur+=ur%2,tq()},kv=[],fr=[],Md=[],Pv=0,Tv=0,Ev=-1/0,Dv=-1/0,Iv=-1/0,Vv=-1/0,mr=-1/0,cu=-1/0,pr=-1/0,fu=-1/0,Nn=0,ur=0,tq=()=>{let t=ur,e=(Math.min(is*.7,250)/32)**2,n=(Math.max(e,is)/32)**2,i=($C/32)**2;kv.length=0,fr.length=0;for(let s=0;s<Nn;++s)for(let o=0;o<Nn;++o){let r=(t-o)**2+(t-s)**2,l=0;r>i?l=3:r>n?l=2:r>e&&(l=1),kv.push(r),fr.push(l)}Md.length=0;for(let s=0;s<Nn;++s)for(let o=0;o<Nn;++o){let r=o%2,a=s%2*2+r,c=Math.min(fr[o+s*Nn],2);if(c<2){let f=fr[Math.min(Nn-1,o+1)+s*Nn]>c,u=fr[Math.max(0,o-1)+s*Nn]>c,m=fr[o+Math.max(0,s-1)*Nn]>c,g=fr[o+Math.min(Nn-1,s+1)*Nn]>c,v=a*33+c*16+((u?1:0)|(m?2:0)|(f?4:0)|(g?8:0));Md.push(v)}else Md.push(a*33+c*16)}},Lv=(t,e)=>{if(t<mr||t>=cu||e<pr||e>=fu)return 3;let n=t-mr,i=e-pr;return fr[n+i*Nn]},jC=(t,e)=>{if(t<mr||t>=cu||e<pr||e>=fu)return 1/0;let n=t-mr,i=e-pr;return kv[n+i*Nn]},WC=(t,e)=>{if(t<mr||t>=cu||e<pr||e>=fu)return 2*16;let n=t-mr,i=e-pr;return Md[n+i*Nn]},UC=-1/0,OC=-1/0,nq=(t,e)=>(t=Math.floor(t/64)*2,e=Math.floor(e/64)*2,t!==UC||e!==OC?(mr=t-ur,cu=t+ur,pr=e-ur,fu=e+ur,Ev=Math.floor(mr/2),Dv=Math.ceil(cu/2),Iv=Math.floor(pr/2),Vv=Math.ceil(fu/2),Pv=Math.floor(t/2),Tv=Math.floor(e/2),UC=t,OC=e,!0):!1),qv=!0,GC=t=>{qv=nq(Gt.position[0],Gt.position[2])};var iq=0,YC=(t,e,n,i=0,s=!1,o=!1)=>{let r={id:iq++,geometry:Cn({}),program:t,shadowProgram:i,mode:e,uniformData:{},individualFrustums:o,dynamic:s,needsUpdate:!1,lastUpdateCamPos:[0,0,0],drawCount:0,cullFace:1029,instances:[],instancedAttributeNames:[],instancedAttributes:[],instancedData:[]};for(let l=0;l<n.length;++l){let a=n[l];HC(r,a.name,a.size)}return HC(r,"worldMatrix",16),r},HC=(t,e,n)=>{t.instancedAttributes.push({name:e,instanced:!0,bufferMode:t.dynamic?35048:35044,size:n,data:new Float32Array(n)}),t.instancedAttributeNames.push(e),t.instancedData.push([])},Rv=t=>{let e=on();e.geometry=t.geometry,e.data.multi=t,t.instances.push(e);for(let n=0;n<t.instancedAttributes.length;++n){let i=t.instancedAttributes[n],s=t.instancedAttributeNames[n];t.instancedData[n].push(e.data[s]=s==="worldMatrix"?e.worldMatrix:Array(i.size).fill(1))}return t.needsUpdate=!0,e},XC=(t,e,n,i)=>{let s=t.instances.indexOf(e),o=t.instancedAttributeNames.indexOf(n);o>=0&&(t.instancedData[o][s]=i,e.data[n]=i)},ks=(t,e)=>{let n=t.instances.indexOf(e);t.instances.splice(n,1);for(let i=0;i<t.instancedAttributes.length;++i)t.instancedData[i].splice(n,1);t.needsUpdate=!0,us(e)},QC=t=>{for(let e=0;e<t.instances;++e)us(t[e]);for(let e=0;e<t.instancedAttributes.length;++e)t.instancedData[e].length=0;t.instances.length=0,t.needsUpdate=!0},sq=(t,e)=>{t.needsUpdate=t.dynamic;for(let l=0;l<t.instancedAttributes.length;++l){let a=t.instancedAttributes[l];oq(a,a.size,t.instances.length)}let n=t.dynamic,i=t.individualFrustums,s=t.instancedData,o=t.instances,r=0;for(let l=0;l<o.length;++l){let a=o[l];if(a.visible&&(!n||!i||y_(e,a.geometry,a))){for(let f=0;f<t.instancedAttributes.length;++f){let u=t.instancedAttributes[f],m=u.data,g=s[f][l],v=r*u.size,_=v+u.size;for(let b=v,y=0;b<_;++b,++y)m[b]=g[y]}r++}}if(t.drawCount=r,yp(t.geometry,t.drawCount),t.drawCount!==0)for(let l=0;l<t.instancedAttributes.length;++l){let a=t.instancedAttributes[l];bp(t.geometry,a,r)}},Ja=(t,e,n,i)=>{if(n&&t.needsUpdate&&sq(t,i),e.active&&t.drawCount>0){e.cullFace=t.cullFace;for(let s=0;s<e.autoUniforms.length;++s){let o=e.autoUniforms[s];e.uniforms[o].value=t.uniformData[o]}kp(t.uniformData,e),Fa(e,et.currentProgram===e.id),Ma(t.geometry,e,t.mode)}},ZC=(t,e)=>{let n={...e};for(let i=0;i<t.instancedAttributeNames.length;++i)n[t.instancedAttributeNames[i]]=t.instancedAttributes[i];Zh(t.geometry,n)},oq=(t,e,n)=>{t.data=t.data.byteLength>=e*n*4?t.data:new Float32Array(e*(n+5))};var Co=[],JC=(10+1)*6,kl=new Uint32Array(JC);for(let t=0,e=0;t<JC;t+=6,e+=2)kl[t+0]=e,kl[t+1]=e+1,kl[t+2]=e+3,kl[t+3]=e,kl[t+4]=e+3,kl[t+5]=e+2;var Fd=new Map,KC=(t,e,n,i,s,o)=>{let r=i1.get(t),l=Fd.get(r.steps),a;return!l||l.length===0?a=new zv(r):a=l.pop(),a.reset(r,e,n,i,s,o),Co.push(a),a},e8=(t,e)=>{for(let n=0;n<Co.length;n++)if(Co[n].tick(t,e),Co[n].remove){let i=Co.splice(n--,1)[0];t8(i)}},t8=t=>{Fd.has(t.maxSteps)||Fd.set(t.maxSteps,[]),Fd.get(t.maxSteps).push(t),t.onCache()},n8=t=>{Co.forEach(t8),Co.length=0},i8=()=>{for(let t=0;t<Co.length;++t){let e=Co[t];e.mesh.transform.visible&&Ki(e.mesh,mt[e.mesh.program])}},zv=class{constructor(e){this.maxSteps=e.steps,this.stepTimer=new kt(0,1),this.duration=new kt(0,1),this.remove=!1,this.a=[0,0,0],this.b=[0,0,0],this.timeoutSteps=0;let n=this.maxSteps+1;this.uv=new Float32Array(n*4),this.positions=new Float32Array(n*6);for(let i=0,s=0;i<n;++i,s+=4)this.uv[s]=i/this.maxSteps,this.uv[s+2]=i/this.maxSteps,this.uv[s+1]=1,this.uv[s+3]=0;this.geometry=Cn({position:{size:3,data:this.positions},uv:{size:2,data:this.uv},index:{type:$.UNSIGNED_INT,data:kl.subarray(0,6*this.maxSteps)}}),bp(this.geometry,this.geometry.attributes.uv,n),this.mesh=qi(this.geometry,19,$.TRIANGLES),this.mesh.uniformData.offset=[0,0],this.waitingForTexture=!1,this.parent=null}reset(e,n,i,s,o,r){this.stepTimer.reset(0,e.interval),this.duration.reset(r,o),this.currentStep=0,this.a=st(this.a,i),this.b=st(this.b,s),this.mesh.uniformData.offset[1]=1/(this.maxSteps+1),this.remove=!1,this.timeoutSteps=0,this.geometry.drawRangeCount=0,this.mesh.uniformData.colStart=e.colStart,this.mesh.uniformData.colEnd=e.colEnd,e.texture>0?(this.waitingForTexture=!0,this.mesh.program=19,gi(e.texture,l=>{this.mesh.uniformData.diffuse=l,this.waitingForTexture=!1})):(this.waitingForTexture=!1,this.mesh.program=18,this.mesh.uniformData.diffuse=void 0),this.parent=n}tick(e,n){if(this.waitingForTexture){this.mesh.transform.visible=!1;return}if(this.duration.duration>0&&this.duration.done(n)){this.remove=!0;return}if(this.parent!==null){if(this.mesh.transform.visible=this.parent.visible&&(!this.parent.parent||this.parent.parent.visible),!this.mesh.transform.visible)return;this.mesh.transform.visible&&this.timeoutSteps==0&&(this.positions.set(Mi(bt,this.a,this.parent.worldMatrix),0),this.positions.set(Mi(bt,this.b,this.parent.worldMatrix),3))}this.stepTimer.done(n)&&(this.stepTimer.reset(n),this.step()),hi(this.geometry,this.geometry.attributes.position);let i=this.stepTimer.fraction(n);this.mesh.uniformData.offset[0]=(1-i)/this.maxSteps}detach(){this.timeoutSteps=Math.max(1,this.currentStep),this.parent=null}step(){this.currentStep=Math.min(this.maxSteps,this.currentStep+1),this.positions.copyWithin(6,0),this.geometry.drawRangeCount=this.currentStep*6,this.timeoutSteps>0&&(this.timeoutSteps--,this.timeoutSteps==0&&(this.remove=!0))}onCache(){this.mesh.transform.visible=!1,this.parent=null}};var Cd=[],xl=1e3,lq=500,Ka=lq,gr=[],o8=()=>{mq();for(let t=0;t<xl;++t)Cd.push({pos:[-0,-0,-0],vel:[-0,-0,-0],info:Mp.get(1),distance:0,start:0,end:1.01,forced:!1,scaleRota:[0,0,0,0],infoVec:[0,0,0,0],progVec:[0,0]})},Sd=(t,e,n,i)=>{let s=e,o=n,r=!0,l=n;for(;e-n<0;)r?t[l].distance>t[e].distance?(s8(t,l,e),l=e,n--,r=!r):e++:t[l].distance>=t[n].distance?n--:(s8(t,l,n),e++,l=n,r=!r);l-1>s&&Sd(t,s,l-1,i),l+1<o&&Sd(t,l+1,o,i)},s8=(t,e,n)=>{let i=t[e];t[e]=t[n],t[n]=i},aq=(t,e,n)=>{let i=[[],[]],s=0,o=0;for(;s<gr.length;){let r=gr[s];if(r.start<0||r.end>t){if(gr[o]=r,o++,r.pos[0]>-1e3){let l=r.pos,a=r.vel,c=r.info.acc;if(l[0]+=(a[0]+=c[0]*e)*e,l[1]+=(a[1]+=c[1]*e)*e,l[2]+=(a[2]+=c[2]*e)*e,r.info.friction>0){let f=1-r.info.friction;a[0]*=f,a[1]*=f,a[2]*=f}if(r.distance=pn(n.frustum[5],l)+n.frustumConstants[5],r.distance<Cv&&r.distance>0){let f=r.start<0?(Math.sin(t/r.info.duration)+1)*.5:(t-r.start)/r.info.duration;r.progVec[0]=f,r.progVec[1]=ba[r.info.interp](f),i[r.info.blend].push(r)}}}else Ka+=r.forced?1:0,Cd.push(r);++s}return gr.length=o,Sd(i[0],0,i[0].length-1,i[0].length),Sd(i[1],0,i[1].length-1,i[1].length),i},cq=t=>{for(let e=0;e<2;++e)uq(t[e],uu[e]),fq(t[e],uu[e],wl[e])},fq=(t,e,n)=>{t.length>0?(n.transform.visible=!0,E3(e,0,t.length),hi(e,e.attributes.position),hi(e,e.attributes.info),hi(e,e.attributes.progress),hi(e,e.attributes.scaleRota),hi(e,e.attributes.colStart),hi(e,e.attributes.colEnd)):n.transform.visible=!1},uq=(t,e)=>{let n=e.attributes.position.data,i=e.attributes.progress.data,s=e.attributes.info.data,o=e.attributes.scaleRota.data,r=e.attributes.colStart.data,l=e.attributes.colEnd.data;for(let a=0;a<t.length;++a){let c=t[a],f=c.pos,u=c.infoVec,m=c.progVec,g=c.scaleRota,v=c.info.colStart,_=c.info.colEnd,b=a*2,y=a*3,k=a*4;n[y]=f[0],n[y+1]=f[1],n[y+2]=f[2],s[k]=u[0],s[k+1]=u[1],s[k+2]=u[2],s[k+3]=u[3],i[b]=m[0],i[b+1]=m[1],o[k]=g[0],o[k+1]=g[1],o[k+2]=g[2],o[k+3]=g[3],r[k]=v[0],r[k+1]=v[1],r[k+2]=v[2],r[k+3]=v[3],l[k]=_[0],l[k+1]=_[1],l[k+2]=_[2],l[k+3]=_[3]}},r8=t=>{let e=aq(vo,t,gt);cq(e)},hr=[0,0,0],Qs=(t,e,n=0,i=0,s=0,o=0,r=0,l=0,a=!1)=>{if(e?Er(hr,n,i,s,e):Y(hr,n,i,s),a){if(Ka<=0)return}else{if(pn(gt.frustum[0],hr)+gt.frustumConstants[0]<0||pn(gt.frustum[1],hr)+gt.frustumConstants[1]<0)return;let v=pn(gt.frustum[5],hr)+gt.frustumConstants[5];if(v<0||v*10>Cd.length)return}let c=Cd.pop();if(!c){let v=gr.length-1;for(;v>=0&&gr[v].forced;)--v;v>=0&&(c=gr.splice(v,1)[0])}if(!c)return;let f=1;if(e){let v=e[0],_=e[1],b=e[2];f=Math.sqrt(v*v+_*_+b*b),ym(c.vel,o,r,l,e)}else Y(c.vel,o,r,l);c.pos[0]=hr[0],c.pos[1]=hr[1],c.pos[2]=hr[2];let u=Mp.get(t);c.info=u,c.start=a?-1:vo,c.end=c.start+c.info.duration;let m=Math.random()*u.randomRota,g=m+u.rota;return Math.random()<.5&&(m*=-1,g*=-1),ei(c.scaleRota,u.scaleStart*f,u.scaleEnd*f,m,g),ei(c.infoVec,u.idLoop,0,u.idStart,u.idEnd+1),di(c.progVec,0,0),c.forced=a,gr.push(c),a&&Ka--,c},wl=[],uu=[],mq=()=>{for(let t=0;t<2;++t)uu[t]=Cn({position:{size:3,data:new Float32Array(3*xl)},progress:{size:2,data:new Float32Array(2*xl)},info:{size:4,data:new Float32Array(4*xl)},scaleRota:{size:4,data:new Float32Array(4*xl)},colStart:{size:4,data:new Float32Array(4*xl)},colEnd:{size:4,data:new Float32Array(4*xl)}});wl[0]=qi(uu[0],17,$.POINTS),wl[1]=qi(uu[1],16,$.POINTS),gi(1215,t=>{Vn("particleDiffuse",t,0,mt[17]),Vn("particleDiffuse",t,0,mt[16])})};var l8=()=>{let t=mt[17];t.active&&wl[0].transform.visible&&Ki(wl[0],t)},a8=()=>{let t=mt[16];t.active&&wl[1].transform.visible&&Ki(wl[1],t)};var pu=[],Ad,mu,c8,f8=()=>{mu=Ht.pointlights.data.lightCols,Ad=Ht.pointlights.data.lightPos,c8=Ht.pointlights.data.lightCount},u8=t=>{let e=[0,0,0],n=[];for(let s=0,o=pu.length;s<o;++s){let r=pu[s];r.remove?(pu.splice(s,1),--s,--o):r.transform.visible&&(Y(e,r.transform.worldMatrix[12],r.transform.worldMatrix[13],r.transform.worldMatrix[14]),r.distance=Kn(gt.worldPosition,e),r.distance<Av&&n.push(r))}n.sort((s,o)=>s.distance-o.distance);let i=Math.min(n.length,16);for(let s=0;s<i;++s){let o=n[s],r=s*4,l=s*3;Ad[l]=o.transform.worldMatrix[12],Ad[l+1]=o.transform.worldMatrix[13],Ad[l+2]=o.transform.worldMatrix[14],mu[r]=o.value[0],mu[r+1]=o.value[1],mu[r+2]=o.value[2],mu[r+3]=o.value[3]}c8[0]=i,si(Ht.pointlights)},m8=(t,e,n)=>{let i={transform:n,distance:0,remove:!1,value:[...t,e]};return pu.push(i),i},p8=t=>{pu.length=0};var Ml=[Bc(1,1),Bc(1,1)],ec=!1,d8=0,h8=t=>{d8=t},du=t=>{ec=t},g8=t=>{let n=[lu,au],i=[5,20,20];for(let s=0;s<Ml.length;++s){let o=Ml[s],r=n[s],l=[0,0,0];ym(l,1,1,1,o.transform.worldMatrix);let a=[...Gt.position],c=i[s];for(let g=0;g<3;++g)a[g]=Math.floor(a[g]/c)*c;let f=(Math.abs(Math.cos(-1))+Math.abs(Math.sin(-1)))*r,u=r,m=[u,f,f];for(let g=0;g<3;++g){let v=m[g]*2/d8,_=a[g]*l[g];_=_-_%v,_=_/l[g],a[g]=_}d_(o.transform.position,a)||(st(o.transform.position,a),Y(o.transform.rotation,-1,0,0),o.far=f,o.near=-1e3,b_(o,-u,u,-f,f),fa(o,!0),Fm(o),ec=!0)}if(ec){let s=Ht.shadows.data;wo(s.shadowRange,[lu,Mv,au],0),wo(s.shadowPVMatrix,Ml[0].projectionViewMatrix,0),wo(s.shadowPVMatrix,Ml[1].projectionViewMatrix,16),si(Ht.shadows)}return ec?1:0};var Pd=new Map,Td=[],Ed=[],Dd=[],Id=[],Vd=[],Zs=(t,e,n,i)=>{let s=t<<1|e;if(s=s<<1|n,s=s<<1|i,Pd.has(s))return Rv(Pd.get(s));{let o=hq(t,e,n,i);return Pd.set(s,o),Rv(o)}},_8=(t,e,n,i)=>{t?e?Ed.push(i):Dd.push(i):Td.push(i),n===2?(du(!0),Id.push(i)):n===1&&(du(!0),Vd.push(i))},hq=(t,e,n,i)=>{let s=_s.get(t),o=Q1[s.shader],r=mt[o],l=le.shadows&&e?s.texture?1:2:0,a=YC(o,$.TRIANGLES,r.instancedAttributes,l,n,i);a.cullFace=s.cull?$.BACK:$.NONE;let c=!1,f=!1;return s.texture?gi(s.texture,u=>{f=!0,a.uniformData.diffuse=u,c&&_8(r.transparent,r.depthWrite,le.shadows&&e?n?2:1:0,a)}):f=!0,Yo(s.geometry,u=>{ZC(a,u),c=!0,f&&_8(r.transparent,r.depthWrite,le.shadows&&e?n?2:1:0,a)}),a},b8=()=>{Pd.forEach(QC)};var y8=[{fun:(t,e,n)=>{Qs(e[0],t.transform.worldMatrix,e[1],e[2],e[3],e[4],e[5],e[6],!1)}},{fun:(t,e,n)=>{let i=e[1],s=Math.PI*2/i;for(let o=0;o<i;++o){let r=Math.sin(o*s),l=Math.cos(o*s);Qs(e[0],t.transform.worldMatrix,r*e[6]+e[2],e[3],l*e[6]+e[4],r*e[5],0,l*e[5],!1)}}},{fun:(t,e,n)=>{for(let i=0;i<e[1];++i)Qs(e[0],t.transform.worldMatrix,e[2],e[3],e[4],Zt(e[5],e[6]),Zt(e[7],e[8]),Zt(e[9],e[10]),!1)}},{fun:(t,e,n)=>{Hs(e[0],t.transform,t.priority,!1,1)}}];var Uv=[{create:(t,e)=>m8([e[0],e[1],e[2]],e[3],t.transform),tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{n.remove=!0},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,i,s)=>{let o=ba[e[2]](s);n.value[3]=e[0]+o*(e[1]-e[0])}]},{create:(t,e)=>[0,0,0,0],tick:(t,e,n,i,s)=>{n[0]>=e[1]&&(n[0]=0,Qs(e[0],t.transform.worldMatrix,Zt(e[2],e[3])+n[1],Zt(e[4],e[5])+n[2],Zt(e[6],e[7])+n[3],Zt(e[8],e[9]),Zt(e[10],e[11]),Zt(e[12],e[13]),!1)),n[0]+=~~(i*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,i,s)=>{let o=e[1]*s;n[1]=Math.sin(o)*e[0],n[3]=Math.cos(o)*e[0]}]},{create:(t,e)=>{if(Ka>0)return Qs(e[0],t.transform.worldMatrix,0,0,0,0,0,0,!0)},tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{n.start=1,n.end=1},show:(t,e,n)=>{},hide:(t,e,n)=>{n.pos[0]=-1e3},modifiers:[(t,e,n,i,s)=>{let o=e[1]*s;Er(n.pos,Math.sin(o)*e[0],0,Math.cos(o)*e[0],t.transform.worldMatrix)},(t,e,n,i,s)=>{Er(n.pos,e[0],e[1],e[2],t.transform.worldMatrix)}]},{create:(t,e)=>Hs(e[0],t.transform,t.priority,!0,1),tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{n.stop()},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>{let n=Zs(e[0],!1,!0,!0);return Y(n.position,e[1],e[2],e[3]),Y(n.scale,e[4],e[5],e[6]),Y(n.rotation,e[7],e[8],e[9]),Mn(n,t.transform),qt(n,!1),n},tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{ks(n.data.multi,n)},show:(t,e,n)=>{n.visible=!0},hide:(t,e,n)=>{n.visible=!1},modifiers:[(t,e,n,i,s)=>{let o=e[1]*s;n.rotation[1]=e[2]+o,n.position[0]=Math.sin(o)*e[0],n.position[2]=Math.cos(o)*e[0],n.matrixNeedsUpdate=!0,qt(n,!1)},(t,e,n,i,s)=>{let o=n.data.multi.instancedAttributes[e[0]];for(let r=0;r<o.size;++r)n.data[o.name][r]=e[1+r]},(t,e,n,i,s)=>{let o=n.data.multi.instancedAttributes[e[0]];for(let r=0;r<o.size;++r){let l=e[1+r],a=e[5+r];n.data[o.name][r]=l+s*(a-l)}},(t,e,n,i,s)=>{let o=ba[e[6]](s);n.scale[0]=e[0]+o*(e[3]-e[0]),n.scale[1]=e[1]+o*(e[4]-e[1]),n.scale[2]=e[2]+o*(e[5]-e[2]),n.matrixNeedsUpdate=!0},(t,e,n,i,s)=>{let o=ba[e[6]](s);n.rotation[0]=e[0]+o*(e[3]-e[0]),n.rotation[1]=e[1]+o*(e[4]-e[1]),n.rotation[2]=e[2]+o*(e[5]-e[2]),n.matrixNeedsUpdate=!0}]},{create:(t,e)=>KC(e[0],t.transform,[e[1],e[2],e[3]],[e[4],e[5],e[6]],0,0),tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{n.detach()},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,i,s)=>{let o=e[1]*s;n.b[0]=n.a[0]=Math.sin(o)*e[0],n.b[2]=n.a[2]=Math.cos(o)*e[0]}]},{create:(t,e)=>{if(Ka<e[1])return;let n=[];for(let i=0;i<e[1];++i)n.push(Qs(e[0],t.transform.worldMatrix,0,0,0,0,0,0,!0));return n},tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{for(let i=0;i<n.length;++i){let s=n[i];s.start=s.end=1}},show:(t,e,n)=>{},hide:(t,e,n)=>{for(let i=0;i<n.length;++i){let s=n[i];s.pos[0]=-1e3}},modifiers:[(t,e,n,i,s)=>{let o=n.length,r=6.283/o,l=e[0],a=e[1]*s;for(let c=0;c<o;++c){let f=n[c],u=r*c+a;Er(f.pos,Math.sin(u)*l,0,Math.cos(u)*l,t.transform.worldMatrix)}}]},{create:(t,e)=>[0,0],tick:(t,e,n,i,s)=>{if(n[0]>=e[6]){n[0]=0;let o=e[1],r=Math.PI*2/o;for(let l=0;l<o;++l)Qs(e[0],t.transform.worldMatrix,e[2],e[3],e[4],Math.sin(l*r+n[1])*e[5],0,Math.cos(l*r+n[1])*e[5],!1)}n[0]+=~~(i*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,i,s)=>{n[1]=e[0]*s}]},{create:(t,e)=>[0],tick:(t,e,n,i,s)=>{if(n[0]>=e[1]){n[0]=0;let o=on();Y(o.rotation,Zt(e[8],e[9]),Zt(e[10],e[11]),Zt(e[12],e[13])),Bv(e[0],o,t.priority,!0),Er(o.position,Zt(e[2],e[3]),Zt(e[4],e[5]),Zt(e[6],e[7]),t.transform.worldMatrix),ro(o,!1)}n[0]+=~~(i*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>{let n=Math.sin(t.transform.rotation[1])*Math.cos(t.transform.rotation[0])*e[0],i=-Math.sin(t.transform.rotation[0])*e[0],s=Math.cos(t.transform.rotation[1])*Math.cos(t.transform.rotation[0])*e[0],o=t.info.duration,r=o;if(e[1]){let l=V.raycastEnvironmentClosest(t.transform.position[0],t.transform.position[1],t.transform.position[2],n*o,i*o,s*o);l<1&&(r=o*l)}return[n,i,s,r]},tick:(t,e,n,i,s)=>{if(e[1]&&(n[3]-=i,n[3]<=0)){t.done=!0;return}t.transform.position[0]+=n[0]*i,t.transform.position[1]+=n[1]*i,t.transform.position[2]+=n[2]*i,t.transform.matrixNeedsUpdate=!0,qt(t.transform,!1)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>[],tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{let i=on();st(i.position,t.transform.position),st(i.rotation,t.transform.rotation),Bv(e[0],i,t.priority,!0),ro(i,!1)},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]}],Bv,k8=t=>{Bv=t};var Ei=[],Fl=[],Cl=[],hu=[],x8=(t,e)=>{let n=Fv;yq(t,e,n),kq(t,e,n),xq(t,e,n),wq(t,e),Mq(t,e),Fq(t,e);for(let i=0;i<Ei.length;++i){let s=Ei[i],o=s.visible!==s.transform.visible;if(s.visible=s.transform.visible,s.visible)for(let r=0;r<s.info.events.length;++r){let l=s.info.events[r];(s.loops===0||l.fraction>0)&&s.fractionLast<=l.fraction&&s.fractionNow>l.fraction&&y8[l.id].fun(s,l.params,t)}for(let r=0;r<s.info.periods.length;++r){let l=s.info.periods[r],a=Uv[l.id],c=s.periodData[r]!==void 0,f=s.fractionNow>=l.fractionStart&&s.fractionNow<=l.fractionEnd,u=!1;if(s.visible&&f&&!c&&s.fractionLast<=l.fractionStart&&(c=(s.periodData[r]=a.create(s,l.params,t))!==void 0,u=c),f&&c&&(o&&(s.visible?a.show(s,l.params,s.periodData[r]):a.hide(s,l.params,s.periodData[r])),s.visible)){let m=s.periodData[r],g=(s.fractionNow-l.fractionStart)/(l.fractionEnd-l.fractionStart);a.tick(s,l.params,m,t,g);for(let v=0;v<l.modifiers.length;++v){let _=l.modifiers[v];(u||o||_.mode===1)&&a.modifiers[_.id](s,_.params,m,t,g)}}!f&&c&&(a.end(s,l.params,s.periodData[r]),s.periodData[r]=void 0)}s.visible&&s.returnTransform&&s.transform.parent===null&&qt(s.transform,!1)}},Ov=[],$v=(t,e,n,i)=>Ov.length>0?_q(Ov.pop(),t,e,n,i):vq(t,e,n,i),vq=(t,e,n,i)=>({info:t,priority:n,transform:e,returnTransform:i,visible:!0,fractionNow:0,fractionLast:0,timeEnd:0,periodData:[],done:!1,loops:0}),_q=(t,e,n,i,s)=>(t.info=e,t.priority=i,t.transform=n,t.returnTransform=s,t),bq=t=>(t.visible=!0,t.fractionNow=0,t.fractionLast=0,t.timeEnd=0,t.periodData.length=0,t.done=!1,t.loops=0,t),Ld=t=>{Cq(t),t.returnTransform&&us(t.transform),Ov.push(bq(t))},xs=(t,e,n,i)=>{let s=Ff.get(t),o=$v(s,e,n,i);return Ei.push(o),Fl.push(o),o},Bi=(t,e,n,i)=>{let s=Ff.get(t),o=$v(s,e,n,i);return Ei.push(o),Cl.push(o),o},w8=(t,e,n,i)=>{let s=Ff.get(t),o=$v(s,e,n,i);return Ei.push(o),hu.push(o),o},yq=(t,e,n)=>{for(let i=0;i<Fl.length;++i){let s=Fl[i];s.info.duration===0?s.timeEnd===0?(s.timeEnd=e+s.info.duration,s.fractionLast=0,s.fractionNow=.999):(s.fractionLast=0,s.fractionNow=1):(s.timeEnd===0&&(s.timeEnd=e+s.info.duration),s.fractionLast=s.fractionNow,s.fractionNow=vt(1-(s.timeEnd-e)/s.info.duration,0,1))}},kq=t=>{for(let e=0;e<Cl.length;++e){let n=Cl[e];n.fractionLast=n.fractionNow,n.fractionNow=(n.fractionNow+t/n.info.duration)%1,n.fractionLast>n.fractionNow&&(n.fractionLast=0,n.loops++)}},xq=(t,e,n)=>{},wq=(t,e,n)=>{let i=Fl.length;for(;i--;){let s=Fl[i];(s.fractionNow===1||s.done)&&(Fl.splice(i,1),Ei.splice(Ei.indexOf(s),1),Ld(s))}},Mq=(t,e,n)=>{let i=Cl.length;for(;i--;){let s=Cl[i];s.done&&(Cl.splice(i,1),Ei.splice(Ei.indexOf(s),1),Ld(s))}},Fq=(t,e,n)=>{let i=hu.length;for(;i--;){let s=hu[i];s.done&&(hu.splice(i,1),Ei.splice(Ei.indexOf(s),1),Ld(s))}},Cq=t=>{for(let e=0;e<t.info.periods.length;++e){let n=t.info.periods[e],i=Uv[n.id];t.periodData[e]!==void 0&&(i.end(t,n.params,t.periodData[e]),t.periodData[e]=void 0)}},M8=t=>{for(let e=0;e<Ei.length;++e)Ld(Ei[e]);Ei.length=0,Fl.length=0,Cl.length=0,hu.length=0};k8(xs);var tc=[0,2,2.3],nc=[0,0,0];Zn(tc,tc);var an={},zd=["fog","sun","direct","ambient","skytop","skymid","skybot","horizon","water","clouds"],Bd=["bloom"];for(let t=0;t<zd.length;++t)an[zd[t]]=[[.5,.5,.5],[.5,.5,.5],[.5,.5,.5]];for(let t=0;t<Bd.length;++t)an[Bd[t]]=[0,0,0];var F8=(t,e,n,i)=>{Tq(),Iq(t,n,e),Eq(),e>0&&Dq(e,i),si(Ht.sky),si(Ht.environment);let s=Ht.environment.data;$.clearColor(s.fog[0],s.fog[1],s.fog[2],1)},Aq=(t,e,n,i,s,o,r)=>{let l=[0,0,0],a=[0,0,0];ca(l,e,n,o),ca(a,i,s,o),ca(t,l,a,r)},Pq=(t,e,n,i,s,o)=>{let r=vf(s,t,e),l=vf(s,n,i);return vf(o,r,l)},Js=(t,e,n,i,s)=>{let o=[0,0,0],r=[0,0,0];dn(o,n,1-s),dn(r,i,s),t[e]=o[0]+r[0],t[e+1]=o[1]+r[1],t[e+2]=o[2]+r[2]},Tq=()=>{let t=Gt.position[0],e=Gt.position[2],n=t,i=e,s=t+32,o=e+32,r=Ea.get(V.getEnvironmentId(n,i)),l=Ea.get(V.getEnvironmentId(s,i)),a=Ea.get(V.getEnvironmentId(n,o)),c=Ea.get(V.getEnvironmentId(s,o));if(!r||!l||!a||!c)return;let f=t/32%1,u=e/32%1;for(let m=0;m<zd.length;++m){let g=zd[m];for(let v=0;v<3;++v)Aq(an[g][v],r[g][v],l[g][v],a[g][v],c[g][v],f,u)}for(let m=0;m<Bd.length;++m){let g=Bd[m];for(let v=0;v<3;++v)an[g][v]=Pq(r[g][v],l[g][v],a[g][v],c[g][v],f,u)}},Eq=()=>{let t=Ht.environment.data.watercolors;for(let e=0;e<9;++e)t[e]=an.water[Math.floor(e/3)][e%3]},Dq=(t,e)=>{let n=Ht.environment.data.worldlight,i=[0,0,0],s=Math.max(0,1-t/80),o=Math.min(1,1-s);Js(i,0,an.water[1],an.water[2],o);let r=[0,0,0];r[0]=(n[0]+n[3])*i[0]*1.5,r[1]=(n[1]+n[4])*i[1]*1.5,r[2]=(n[2]+n[5])*i[2]*1.5;let l=Ht.sky.data.skycolors,a=Ht.sky.data.suncolor,c=Ht.environment.data.worldlight,f=Ht.environment.data.fog,u=Math.max(.2,.5*s),m=Math.min(.4,Math.max(.1,.5*s)),g=Math.max(.3,.7*s);for(let v=0;v<15;++v)l[v]=u*r[v%3];Y(f,u*r[0],u*r[1],u*r[2]),st(a,f);for(let v=0;v<9;++v)Ht.environment.data.watercolors[v]=m;for(let v=0;v<6;++v)c[v]=g*r[v%3]},qd=0,So=1,Rd=2,Ud=[{from:So,to:qd,start:0,end:0,dur:0},{from:qd,to:qd,start:0,end:0,dur:0},{from:qd,to:So,start:0,end:0,dur:0},{from:So,to:So,start:0,end:0,dur:0},{from:So,to:Rd,start:0,end:0,dur:0},{from:Rd,to:Rd,start:0,end:0,dur:0},{from:Rd,to:So,start:0,end:0,dur:0},{from:So,to:So,start:0,end:0,dur:0}],C8=0;Ud.forEach(t=>{let e=t.from!==t.to,n=!e&&t.from!==So;e?t.dur=.5:n?t.dur=5:t.dur=1.5,C8+=t.dur});var Nv=0;Ud.forEach(t=>{t.start=Nv,Nv=t.end=Nv+1/C8*t.dur});var Iq=(t,e,n)=>{t=vt(t,0,1);let i=.5,s=0,o=0;for(let a=0;a<Ud.length;++a){let c=Ud[a];if(c.end>=t){i=gf(c.start,c.end,t),s=c.from,o=c.to;break}}let r=Ht.sky.data;Js(r.skycolors,0,an.skytop[s],an.skytop[o],i),Js(r.skycolors,3,an.skymid[s],an.skymid[o],i),Js(r.skycolors,6,an.skybot[s],an.skybot[o],i),Js(r.skycolors,9,an.horizon[s],an.horizon[o],i),Js(r.skycolors,12,an.clouds[s],an.clouds[o],i),Js(r.suncolor,0,an.sun[s],an.sun[o],i),st(nc,tc),nc[1]=Math.abs(Math.sin(t*6.282)),Zn(nc,nc);let l=Ht.environment.data;Js(l.worldlight,0,an.direct[s],an.direct[o],i),Js(l.worldlight,3,an.ambient[s],an.ambient[o],i),l.worldlight[6]=tc[0],l.worldlight[7]=tc[1],l.worldlight[8]=tc[2],Js(l.fog,0,an.fog[s],an.fog[o],i),l.fog[3]=n>0?-100:xv,l.fog[4]=n>0?wv:is,l.daycycle[0]=t,l.time[0]=e%3600,mt[31].uniforms.amount.value=vf(i,an.bloom[s],an.bloom[o])};var Vq=[],Lq=[],A8=(t,e)=>{if(gn===void 0||gn.suspended)return;let n=gn.currentTime,i=Cf.get(V.getAreaId(Gt.position[0],Gt.position[2])),o=t>.5?i.ambientnight:i.ambientday,r=5;e>0&&(o=167,r=.5),S8(Vq,n,r,o,!1),S8(Lq,n,5,i.music,!0)},S8=(t,e,n,i,s)=>{let o=!1;for(let r=t.length-1;r>=0;--r){let l=t[r],a=l.sound,c=a.gain.gain;l.id===i&&!a.ended?(o=!0,l.fade!==1&&(l.fade=1,c.setTargetAtTime(1,e,n))):c.value<.02||a.ended?(a.stop(),t.splice(r,1)):l.fade!==0&&(l.fade=0,c.setTargetAtTime(0,e,l.fadeDuration))}if(!o&&i!==0){let r=s?sy(i,3):iy(i,2);r&&(r.gain.gain.setValueAtTime(0,e),t.push({id:i,sound:r,fade:0,fadeDuration:n}))}};var Ao=[0,0,0,0],P8=(t,e,n,i)=>{if(V.player&&V.player.buffs.buffs.has(128))Ao[0]=.2,Ao[1]=.4,Ao[2]=.4,Ao[3]=.7,i.add(33),mt[33].uniforms.warp.value=.1,mt[31].uniforms.amount.value=3;else if(e>0){let s=Ht.environment.data.fog;Ao[0]=s[0],Ao[1]=s[1],Ao[2]=s[2],Ao[3]=.5,i.add(33),mt[33].uniforms.warp.value=.3,mt[31].uniforms.amount.value=Math.min(3,Math.max(.3,e/10))}mt[33].uniforms.tint.value=Ao};var T8=()=>{},Od=0,$d=t=>Od=t,E8=(t,e,n)=>{let i=(e/3600+.9)%1;i<.7?i=gf(0,.7,i)*.4:i=.4+gf(.7,1,i)*.6,F8(i,Od,e,n),P8(i,Od,e,n),A8(i,Od)};var gu=()=>[-0,-0,-0,-0,-0,-0],Ks=gu();var D8=(t,e)=>!(t[3]<e[0]||t[0]>e[3]||t[4]<e[1]||t[1]>e[4]||t[5]<e[2]||t[2]>e[5]),Rq=(t,e,n,i,s)=>(t[0]=e[0],t[3]=e[0]+n,t[1]=e[1],t[4]=e[1]+i,t[2]=e[2],t[5]=e[2]+s,t);var I8=(t,e)=>{t[0]=t[1]=t[2]=1/0,t[3]=t[4]=t[5]=-1/0;for(let n=0;n<e.length;++n){let i=e[n];t[0]=Math.min(t[0],i[0]),t[3]=Math.max(t[3],i[0]),t[1]=Math.min(t[1],i[1]),t[4]=Math.max(t[4],i[1]),t[2]=Math.min(t[2],i[2]),t[5]=Math.max(t[5],i[2])}return t};var Nd=(t,e,n,i,s)=>(Y(bt,e[0]-n/2,e[1]-i/2,e[2]-s/2),Rq(t,bt,n,i,s));var V8=(t,e,n,i,s)=>{let o=(t[0]-e[0])*n[0],r=(t[1]-e[1])*n[1],l=(t[2]-e[2])*n[2],a=(t[3]-e[0])*n[0],c=(t[4]-e[1])*n[1],f=(t[5]-e[2])*n[2],u=Math.max(i,Math.min(o,a),Math.min(r,c),Math.min(l,f)),m=Math.min(s,Math.max(o,a),Math.max(r,c),Math.max(l,f));return!(m<0||u>m)};var L8=(t,e,n)=>{let i=[0,0,0];for(let s=0;s<6;++s){let o=e[s],r=n[s];if(o[0]>0?i[0]=t[3]:i[0]=t[0],o[1]>0?i[1]=t[4]:i[1]=t[1],o[2]>0?i[2]=t[5]:i[2]=t[2],pn(o,i)+r<0)return!1}return!0};var jd=class{constructor(){this.id=0,this.pos=[-0,-0,-0],this.rot=[-0,-0,-0],this.scale=1,this.matrix=void 0,this.loaded=!1}setWorldMatrix(e,n){this.matrix=e,Rn(bt,n,this.pos),pi(yn,this.scale),km(go,this.rot),_m(this.matrix,go,bt,yn)}loadGeometry(e,n){if(!this.loaded){let i=_s.get(this.id);this.loaded=!0,i.geometry===0?this.postGeometryLoad(e,n):Yo(i.geometry,(s,o)=>{let r=!e.finishedLoadingChunks.has(n.id);this.addMesh(e,n),r&&this.addCollider(e,n,s,o),this.postGeometryLoad(e,n)})}}onUpdate(e,n,i){}addMesh(){}postGeometryLoad(e,n){n.loadingProps--}handleColliderGeometry(e,n,i,s){let o=this.matrix,r=i.position,l=i.color,a=i.flags;for(let c=0,f=n.length;c<f;c+=3){let u=n[c],m=n[c+1],g=n[c+2],v=jv(u*3,s,r,o),_=jv(m*3,s,r,o),b=jv(g*3,s,r,o),y=[v,_,b],k=I8(gu(),y);if(a[u]&1&&a[m]&1&&a[g]&1){if(y.push(If([0,0,0],v,_,b)),l.length){let S=[(l[u*4+0]+l[m*4+0]+l[g*4+0])/3,(l[u*4+1]+l[m*4+1]+l[g*4+1])/3,(l[u*4+2]+l[m*4+2]+l[g*4+2])/3,(l[u*4+3]+l[m*4+3]+l[g*4+3])/3];y.push(S)}e.triangleGrid.add(y,k)}}}addCollider(e,n,i,s){let o=new Map;this.handleColliderGeometry(e,s.index,s,o),this.handleColliderGeometry(e,s.indexInvisible,s,o)}onRemove(){}},jv=(t,e,n,i)=>{if(e.has(t))return e.get(t);{let s=[n[t],n[t+1],n[t+2]];return Mi(s,s,i),e.set(t,s),s}};var Wd=class extends jd{constructor(){super(),this.mesh=void 0,this.effects=[],this.isEffectProp=!1,this.effectsCreated=!1}onUpdate(e,n,i){this.mesh!==void 0&&this.updateMesh(n),super.onUpdate(e,n,i)}updateMesh(e){this.setWorldMatrix(this.mesh.worldMatrix,e),Rn(this.mesh.position,e,this.pos),Y(this.mesh.rotation,this.rot[0],this.rot[1],this.rot[2]),pi(this.mesh.scale,this.scale),this.mesh.data.multi&&(this.mesh.data.multi.needsUpdate=!0)}onRemove(e){super.onRemove(e),_s.get(this.id).effects.length&&this.deleteEffects(),this.mesh&&(this.mesh.data.multi?ks(this.mesh.data.multi,this.mesh):us(this.mesh),this.mesh=void 0)}addMesh(e,n){if(this.mesh===void 0){let i=_s.get(this.id);this.mesh=Zs(this.id,i.shadow,!1,!0),this.mesh.visible=!1,this.updateMesh(n.origin),i.effects.length&&(this.isEffectProp=!0)}}onChunkRebuild(e){this.mesh&&this.mesh.data&&this.mesh.data.interiorlight&&V.getInteriorLight(this.mesh.data.interiorlight,Nd(Ks,this.mesh.position,3,3,3))}createEffects(){if(this.isEffectProp=!0,!this.effectsCreated){let e=_s.get(this.id).effects;for(let n=0;n<e.length;++n){let i=e[n],s=on();st(s.position,i.pos),st(s.scale,i.scale),st(s.rotation,i.rot),Mn(s,this.mesh),qt(s,!0);let o=Bi(i.id,s,0,!0);this.effects.push(o)}this.effectsCreated=!0}}deleteEffects(){if(this.effectsCreated){for(let e=0;e<this.effects.length;++e)this.effects[e].done=!0;this.effects.length=0,this.effectsCreated=!1}}setVisible(e){this.mesh.visible!==e&&(this.mesh.visible=!0,this.mesh.data.multi.needsUpdate=!0)}setEffectVisible(e){this.isEffectProp&&this.effectsCreated!==e&&(e?this.createEffects():this.deleteEffects())}};var R8=(t,e,n)=>{e[n]=(t&31)*8,e[n+1]=(t>>5&31)*8,e[n+2]=(t>>10&31)*8},q8=65536/64,zq=2147483647/2e3,Wv=65536/(Math.PI*2),Bq=65536/100;var z8=(t,e)=>(t.id=e.id,Y(t.pos,e.x/q8,e.y/zq,e.z/q8),Y(t.rot,e.rx/Wv,e.ry/Wv,e.rz/Wv),t.scale=Math.max(e.scale,100)/Bq,t);var B8=(t,e,n,i)=>{t.id=e,t.x=n,t.z=i,t.origin[0]=n*64,t.origin[2]=i*64,t.deserialized=!1,t.props.length=0,t.data=void 0,t.loadingProps=0},U8=(t,e)=>{t.data=e,O8(t),Uq(t,!0),t.deserialized=!0},ws=(t,e,n)=>{e/=2.6666666666666665,n/=2.6666666666666665;let i=e%1,s=n%1;if(i===0&&s===0)return t.data.terrain[e+25*n]*.030517578125;{let o=Math.floor(e),r=Math.floor(n),l=i+s<1,a=t.data.terrain[o+25*r+(l?0:1)],c=t.data.terrain[o+25*Math.min(24,r+1)],f=t.data.terrain[o+1+25*(r+(l?0:1))],u=l?-(i-1+s):-(s-1),m=l?s:-(i-1),g=1-u-m;return(u*a+m*c+g*f)*.030517578125}},_u=(t,e,n)=>{if(t.data.holes.length===0)return!1;e/=2.6666666666666665,n/=2.6666666666666665;let i=Math.floor(e)+Math.floor(n)*24;return t.data.holes.indexOf(i)>=0},bu=(t,e,n)=>{if(t.data.water.length===0)return-1;e/=64,n/=64;let i=e%1,s=n%1;if(i===0&&s===0)return t.data.water[e+2*n]*.030517578125;{let o=Math.floor(e),r=Math.floor(n),l=i+s<1,a=t.data.water[o+2*r+(l?0:1)],c=t.data.water[o+2*Math.min(2-1,r+1)],f=t.data.water[o+1+2*(r+(l?0:1))],u=l?-(i-1+s):-(s-1),m=l?s:-(i-1),g=1-u-m;return(u*a+m*c+g*f)*.030517578125}};var Gv=(t,e,n)=>{e/=16,n/=16;let s=Math.floor(e)+Math.floor(n)*4;return t.data.area[s]||0},Hv=(t,e,n)=>{e/=32,n/=32;let s=Math.floor(e)+Math.floor(n)*2;return t.data.environment[s]||0},O8=t=>{let e=[-0,-0,-0];for(let n=0;n<24;++n)for(let i=0;i<24;++i){let s=(i*2+24*n*2)*3,o=i*2.6666666666666665,r=n*2.6666666666666665;Y(ps,o,ws(t,o,r),r),Y(up,o,ws(t,o,r+2.6666666666666665),r+2.6666666666666665),Y(hf,o+2.6666666666666665,ws(t,o+2.6666666666666665,r),r),If(e,ps,up,hf),t.normals[s]=e[0],t.normals[s+1]=e[1],t.normals[s+2]=e[2],Y(ps,o+2.6666666666666665,ws(t,o+2.6666666666666665,r),r),Y(hf,o+2.6666666666666665,ws(t,o+2.6666666666666665,r+2.6666666666666665),r+2.6666666666666665),If(e,ps,up,hf),t.normals[s+3]=e[0],t.normals[s+4]=e[1],t.normals[s+5]=e[2]}};var Uq=(t,e)=>{for(let n=0,i=t.data.props.length;n<i;++n){let s=t.data.props[n],o=z8(new Wd,s);t.props.push(o),e&&t.loadingProps++}for(let n=0;n<t.props.length;++n){let i=t.props[n];i.onUpdate(V,t.origin,V.bounds),i.loadGeometry(V,t)}},Oq=t=>{for(let e=0;e<t.props.length;++e)t.props[e].onRemove(t);t.props.length=0},$8=t=>{Oq(t)},N8=(t,e)=>Math.floor(t%64/32)+Math.floor(e%64/32)*2,j8=(t,e)=>Math.floor(t%32*3)+Math.floor(e%32*3)*96;var yu=1,Gd=t=>{yu=t%2147483647,yu<=0&&(yu+=2147483646),Sl(),Sl()},Sl=()=>yu=yu*16807%2147483647,ku=()=>(Sl()-1)/2147483647,ic=(t,e)=>ku()*(e-t)+t;var Yd,Xd,Qd,Ui=[0,0,0],sc,oc,rc,$q=[21,56,50,44,13,19,7,42],Xv=3758102380,Qv=(t,e)=>t>>e&1,vr=(t,e,n,i)=>$q[Qv(t,i)<<2|Qv(e,i)<<1|Qv(n,i)],Hd=t=>{let e=(Ui[0]+Ui[1]+Ui[2])/6,n=sc-Ui[0]+e,i=oc-Ui[1]+e,s=rc-Ui[2]+e,o=.6-n*n-i*i-s*s,r=Nq(Yd+Ui[0],Xd+Ui[1],Qd+Ui[2]);if(Ui[t]++,o<0)return 0;let l=r>>5&1,a=r>>4&1,c=r>>3&1,f=r>>2&1,u=r&3,m=u===1?n:u===2?i:s,g=u===1?i:u===2?s:n,v=u===1?s:u===2?n:i;return m=l===c?-m:m,g=l===a?-g:g,v=l!==(a^c)?-v:v,o*=o,8*o*o*(m+(u===0?g+v:f===0?g:v))},Nq=(t,e,n)=>vr(t,e,n,0)+vr(e,n,t,1)+vr(n,t,e,2)+vr(t,e,n,3)+vr(e,n,t,4)+vr(n,t,e,5)+vr(t,e,n,6)+vr(e,n,t,7),G8=(t,e,n)=>{let i=t+Xv,s=e+Xv,o=n+Xv,r=(i+s+o)/3;Yd=Math.floor(i+r),Xd=Math.floor(s+r),Qd=Math.floor(o+r),r=(Yd+Xd+Qd)/6,sc=i-Yd+r,oc=s-Xd+r,rc=o-Qd+r,Ui[0]=Ui[1]=Ui[2]=0;let l=sc>=rc?sc>=oc?0:1:oc>=rc?1:2,a=sc<rc?sc<oc?0:1:oc<rc?1:2;return Hd(l)+Hd(3-l-a)+Hd(a)+Hd(0)};var H8=t=>{let e=0,n=0,i=0;for(let u=0;u<t.nodes.length;++u){let m=t.nodes[u],g=m.leafCount,v=m.points.length/2;e+=v*3*g,n+=v*2*g,i+=Math.max(0,(v-2)*3)*g,m.geotype===1&&(i+=3*g*Math.min(1,m.points.length))}let s=new Float32Array(e),o=new Float32Array(n),r=new Uint32Array(i);Gd(t.seed);let l=0,a=0,c=0,f=0;for(let u=0;u<t.nodes.length;++u){let m=t.nodes[u],g=m.start,v=m.end,_=Math.atan2(v[1]-g[1],v[0]-g[0]),{geotype:b,leafCount:y,y:k,radius:S,slant:A,size:F,arc:M,jitter_slant:D,jitter_size:R,jitter_rotation:E,jitter_radius:L,jitter_y:B}=m,I=m.points.length/2,N=Math.PI*2/(y===2?4:y);for(let j=0;j<y;++j){let W=j*N+ic(-E,E),O=A+ic(-D,D),se=F*ic(1-R,1),X=S*ic(1-L,1),oe=k*ic(1-B,1);for(let ce=0;ce<I;++ce){let xe=m.points[ce*2],pe=m.points[ce*2+1],$e=xe-g[0],Ee=pe-g[1],Fe=$e*Math.cos(-_)-Ee*Math.sin(-_),_e=$e*Math.sin(-_)+Ee*Math.cos(-_),H=0,Le=0,Oe=0;if(m.geotype===0){let Ze=O+M*Fe;H=Math.sin(Ze)*Fe,Le=Math.cos(Ze)*Fe,Oe=_e}else H=Fe,Le=M*(Math.abs(Fe)+Math.abs(_e)),Oe=_e;let He=H*Math.cos(W)-Oe*Math.sin(W),Ye=H*Math.sin(W)+Oe*Math.cos(W);s[l]=He*se+Math.cos(W)*X,s[l+1]=oe+Le*se,s[l+2]=Ye*se+Math.sin(W)*X,o[a]=xe,o[a+1]=1-pe,l+=3,a+=2}if(b===0)for(let ce=0;ce<I-2;++ce)r[c]=f+ce,r[c+1]=f+ce+1,r[c+2]=f+ce+2,c+=3;else for(let ce=0;ce<I-1;++ce){let xe=ce===I-2;r[c]=f,r[c+1]=xe?f+I-1:f+ce+1,r[c+2]=xe?f+1:f+ce+2,c+=3}f+=I}}return Cn({position:{size:3,data:s},uv:{size:2,data:o},index:{type:5125,data:r}})};var X8=Math.floor(64**2*(le.foliage/100)),Q8=[],Zd=[],Z8=[];for(let t=0;t<64*64;++t){let e=Math.max(0,G8(Math.floor(t/64)/7,t%64/7,1));Z8.push(e)}for(let t=0;t<8;++t)Q8.push(new Float32Array(7*X8)),Zd.push([]);var J8=(t,e)=>{if(le.foliage===0||!e)return;Gq(t,$),Gd(t.id+1e3);let n=t.geometry.foliage.folIds,i=[],s=t.geometry.foliage.instances,o=[];for(let c=0;c<n.length;++c)i.push(Ta.get(n[c])),o.push(0);let r=le.foliage,l=!1;t.data.holes.length>0&&(l=!0);let a=[-1,-1,-1,-1];for(let c=0;c<4;++c){let f=t.data.textureid[c];for(let u=0;u<4;++u)f[u]===27&&(a[c]=u)}for(let c=0;c<64;++c)for(let f=0;f<64;++f){if(Sl()%100>r)continue;let u=c+t.origin[0],m=f+t.origin[2],g=V.getNormal(u,m);if(g[1]<.6||l&&_u(t,c,f)||bu(t,c,f)>ws(t,c,f)+80)continue;let v=N8(c,f),_=j8(c,f),b=t.data.texture[v][_],y=b&31,k=b>>5&31,S=b>>10&31,A=a[v];A>=0&&(A===0&&y>0?y=255:A===1&&k>0?k=255:A===2&&S>0&&(S=255));let F=Sl()%Math.max(32,y+k+S),M=3;F<y?M=0:F<y+k?M=1:F<y+k+S&&(M=2);let D=t.data.textureid[v][M],R=Pa.get(D).foliage,E=Z8[u%64+m%64*64];for(let L=0;L<R.length;++L){let B=R[L],I=B[1];if(Sl()%255>I||B[2]&&E<=0)continue;let N=B[0],j=n.indexOf(N);if(o[j]>=X8||j<0)continue;let W=s[j].attributes.inst.data,O=o[j]*7,se=Math.max(0,Math.min(64,c-.25+ku()*.5)),X=Math.max(0,Math.min(64,f-.25+ku()*.5)),oe=ws(t,se,X);W[O]=se+t.origin[0],W[O+1]=oe,W[O+2]=X+t.origin[2],W[O+3]=B[2]?.5+Math.min(1.4,E*1.5):.5+ku(),W[O+4]=g[0]+.001,W[O+5]=g[1],W[O+6]=g[2],o[j]++}}for(let c=0;c<n.length;++c){let f=s[c],u=o[c];yp(f,u),hi(f,f.attributes.inst),f.bounds=t.geometry.terrain.bounds}},Jd=new Map,Zv=new Map,Y8=new Set,jq=t=>Zd[t].length<1?Cn({inst:{instanced:!0,size:7,data:Q8[t]}}):Zd[t].pop(),Wq=(t,e)=>{Zd[t].push(e)},Gq=(t,e)=>{if(!t.geometry.foliage){let n=t.geometry.foliage={instances:[],folIds:[]};for(let i=0;i<4;++i){let s=t.data.textureid[i];for(let o=0;o<4;++o){let r=Pa.get(s[o]).foliage;for(let l=0;l<r.length;++l)n.folIds.indexOf(r[l][0])<0&&n.folIds.push(r[l][0])}}n.folIds.length>8&&(n.folIds.length=8);for(let i=0;i<n.folIds.length;++i){let s=n.folIds[i];n.instances.push(jq(i));let o=Ta.get(s);Jd.has(o.id)||Jd.set(o.id,H8(o)),Y8.has(o.texture)||(Y8.add(o.texture),gi(o.texture,r=>{xp(r,16),es(r),Zv.set(o.texture,r)}))}}},K8=t=>{if(t.geometry.foliage){for(let e=0;e<t.geometry.foliage.instances.length;++e)Wq(e,t.geometry.foliage.instances[e]);t.geometry.foliage=void 0}},eS=(t,e)=>{},tS=t=>{if(!le.foliage)return;let e=3,n=2,i=[],s=[],o=[];for(let r=0,l=t.length;r<l;++r){let a=t[r];if(jC(a.x*2,a.z*2)<Sv){let c=a.geometry.foliage;for(let f=0;f<c.folIds.length;++f){let u=c.folIds[f],m=i.indexOf(u);m<0&&(i.push(u),s.push([]),o.push(Ta.get(u).type===0?13:14),m=i.length-1),s[m].push(c.instances[f])}}}for(let r=0;r<i.length;++r){let l=Ta.get(i[r]);if(Jd.has(l.id)&&Zv.has(l.texture)){let a=o[r],c=mt[a];et.currentProgram!==c.id&&($.useProgram(c.program),et.currentProgram=c.id,Sa(c),Ca(c),Kh(c.uniformArray));let f=Jd.get(l.id);wa(f,c),Vn("foliageDiffuse",Zv.get(l.texture),0,c),xf(c);let u=s[r];for(let m=0;m<u.length;++m){let g=u[m];$.bindBuffer($.ARRAY_BUFFER,g.attributes.inst.buffer),$.vertexAttribPointer(e,3,$.FLOAT,!1,7*4,4*4),$.enableVertexAttribArray(e),ua(e,1),$.vertexAttribPointer(n,4,$.FLOAT,!1,7*4,0),$.enableVertexAttribArray(n),ua(n,1),et.boundBuffer=g.attributes.inst.id,$.drawElementsInstanced($.TRIANGLES,f.drawRangeCount,f.attributes.index.type,f.drawRangeStart,g.instancedCount)}}}};var lc=[],ac=[],_r=new Map,nS=(t,e,n,i,s)=>{let o=V.entity(t),r=V.entity(e);if(n.fx.effectMissile&&o!==void 0&&r!==void 0&&(!o.visual.inFog||!r.visual.inFog)){let l={mId:i,targetid:e,timer:s,effect:Bi(n.fx.effectMissile,on(),o===V.playerId?1:0,!0),start:Rn([0,0,0],Dr(bt,[0,0,o.radius],o.rot),o.visualPosition)};l.effect.transform.matrixAutoUpdate=!0,lc.push(l),_r.set(i,l),sS(l,lc.length-1)}},iS=(t,e,n,i,s,o)=>{if(i.fx.effectMissile){let r={mId:s,timer:o,path:e,fractions:n,currentIndex:0,effect:Bi(i.fx.effectMissile,on(),t===V.playerId?1:0,!0)};r.effect.transform.matrixAutoUpdate=!0,ac.push(r),_r.set(s,r),oS(r,ac.length-1)}},sS=(t,e)=>{if(!V.isEntityIdTaken(t.targetid)||t.timer.done(V.smoothtime)){lc.splice(e,1),t.effect.done=!0,_r.delete(t.mId);return}let n=V.entity(t.targetid),i=Xt(t.effect.transform.position,n.visualPosition,t.start);sn(t.effect.transform.position,t.start,i,t.timer.fraction(V.smoothtime));let s=V.getHeight(t.effect.transform.position[0],t.effect.transform.position[2])+.3;s>t.effect.transform.position[1]&&(t.effect.transform.position[1]=s),Vr(t.effect.transform,n.visualPosition,!1,fp),t.timer.passed(V.smoothtime)>.5&&(st(t.start,t.effect.transform.position),t.timer.reset(V.smoothtime,t.timer.end-V.smoothtime)),qt(t.effect.transform,!1)},oS=(t,e)=>{if(t.timer.done(V.smoothtime)){ac.splice(e,1),t.effect.done=!0,_r.delete(t.mId);return}let n=Math.max(0,Math.min(1,t.timer.fraction(V.smoothtime)));t.currentIndex=ay(t.effect.transform.position,t.path,n,t.fractions),qt(t.effect.transform,!1)},rS=()=>{lc.forEach(sS),ac.forEach(oS)},lS=t=>{lc.forEach(e=>{e.effect.done=!0}),ac.forEach(e=>{e.effect.done=!0}),lc.length=0,ac.length=0,_r.clear()};var ss,aS=()=>{ss=qi(void 0,11,$.TRIANGLES),pi(ss.transform.scale,40),ss.transform.visible=!1,ss.transform.matrixAutoUpdate=!0,Yo(1456,t=>{let e=Cn(t);ss.geometry=e;let n=yo(1024,1024,1,!1,$.NONE,$.REPEAT,$.REPEAT);D_(n),Ki(Df,mt[34]);let i=n.colorTexture;Vn("skyDiffuse",i,0,mt[11]),gi(1748,s=>{ss.transform.visible=!0,Vn("cloudDiffuse",s,0,mt[11])})})},cS=()=>{Y(ss.transform.position,gt.transform.worldMatrix[12],gt.transform.worldMatrix[13],gt.transform.worldMatrix[14]),qt(ss.transform,!1)},fS=()=>{ss.transform.visible&&Ki(ss,mt[11])};var Oi,uS=()=>{Oi=qi(void 0,12,$.TRIANGLES),pi(Oi.transform.scale,.1),Mn(Oi.transform,ss.transform),Oi.transform.visible=!1,Yo(1455,t=>{Oi.geometry=Cn(t),Oi.transform.visible=!0})},mS=()=>{st(Oi.transform.position,nc),dn(Oi.transform.position,Oi.transform.position,.45),Vr(Oi.transform,V_,!1,I_),Oi.transform.matrixNeedsUpdate=!0},pS=()=>{Oi.transform.visible&&Ki(Oi,mt[12])};var e0=24,At=e0+1,vS=At**2,Jv=new Map,br=96,dS=96/12,cc=8,xu=new Uint8Array(3*br**2),Kv=new Map,Kd=e0/2,hS=3,gS=[1,2,4,8],Al=[0],Jt=[],Zq=(t,e,n,i)=>{let s=e+n*At,o=e+(n+i)*At,r=e+(n+i)*At+i,l=e+n*At+i;Jt.push(s),Jt.push(o),Jt.push(l),Jt.push(o),Jt.push(r),Jt.push(l)};for(let t=0;t<2;++t)for(let e=0;e<2;++e)for(let n=0;n<hS;++n){let i=gS[n],s=gS[n+1],o=e*Kd,r=(e+1)*Kd,l=t*Kd,a=(t+1)*Kd;for(let c=0;c<(n===hS-1?1:16);++c){let f=1&c,u=2&c,m=4&c,g=8&c,v=o+(f?i:0),_=r-(m?i:0),b=l+(u?i:0),y=a-(g?i:0);for(let k=b;k<y;k+=i)for(let S=v;S<_;S+=i)Zq(Jt,S,k,i);if(f){for(let k=l;k<a;k+=s){let S=o+k*At,A=o+(k+s)*At,F=o+(k+i)*At+i;if(Jt.push(S,A,F),k<a-s){let M=F+i*At,D=M+i*At;Jt.push(F,A,M),Jt.push(M,A,D)}}u||Jt.push(o+l*At,o+(l+i)*At+i,o+l*At+i),g||Jt.push(o+a*At,o+a*At+i,o+(a-i)*At+i)}if(u){for(let k=o;k<r;k+=s){let S=k+l*At,A=k+l*At+s,F=k+(l+i)*At+i;if(Jt.push(S,F,A),k<r-s){let M=F+i;Jt.push(F,M,A),Jt.push(M,M+i,A)}}f||Jt.push(o+l*At,o+(l+i)*At,o+(l+i)*At+i),m||Jt.push(r+l*At,r+(l+i)*At-i,r+(l+i)*At)}if(m){for(let k=l;k<a;k+=s){let S=r+k*At,A=r+(k+s)*At,F=r+(k+i)*At-i;if(Jt.push(S,F,A),k<a-s){let M=F+i*At,D=M+i*At;Jt.push(F,M,A),Jt.push(M,D,A)}}u||Jt.push(r+l*At,r+l*At-i,r+(l+i)*At-i),g||Jt.push(r+a*At,r+(a-i)*At-i,r+a*At-i)}if(g){for(let k=o;k<r;k+=s){let S=k+a*At,A=k+a*At+s,F=k+(a-i)*At+i;if(Jt.push(S,A,F),k<r-s){let M=F+i,D=M+i;Jt.push(F,A,M),Jt.push(M,A,D)}}f||Jt.push(o+a*At,o+(a-i)*At+i,o+(a-i)*At),m||Jt.push(r+a*At,r+(a-i)*At,r+(a-i)*At-i)}Al.push(Jt.length)}}var Jq={type:$.UNSIGNED_INT,data:new Uint32Array(Jt)},e2=new Float32Array(vS*3),Kq=new Float32Array(vS*3);for(let t=0,e=0;t<=e0;++t)for(let n=0;n<=e0;++n,++e)e2[e*3+0]=n*2.6666666666666665,e2[e*3+2]=t*2.6666666666666665;var _S=()=>{},bS=(t,e,n)=>{if(tR(t),e){let i=t.geometry.terrain,s=i.attributes.position.data,o=i.attributes.normal.data;for(let l=0;l<25;++l)for(let a=0;a<25;++a){let c=a+25*l,f=t.data.terrain[c]*.030517578125;s[c*3+1]=f}let r=t.normals;for(let l=0;l<25*25*3;++l)o[l]=0;for(let l=0;l<24;++l)for(let a=0;a<24;++a){let c=(a*2+24*l*2)*3,f=r[c],u=r[c+1],m=r[c+2],g=r[c+3],v=r[c+4],_=r[c+5],b=(a+25*l)*3,y=(a+25*(l+1))*3,k=(a+1+25*l)*3,S=(a+1+25*(l+1))*3;o[b]+=f,o[b+1]+=u,o[b+2]+=m,o[y]+=f+g,o[y+1]+=u+v,o[y+2]+=m+_,o[k]+=f+g,o[k+1]+=u+v,o[k+2]+=m+_,o[S]+=g,o[S+1]+=v,o[S+2]+=_}if(t.z>0){let a=V.getChunk(t.x,t.z-1).normals,c=24-1;for(let f=0;f<24;++f){let u=(f*2+24*c*2)*3,m=a[u],g=a[u+1],v=a[u+2],_=a[u+3],b=a[u+4],y=a[u+5],k=(f+1)*3,S=f*3;o[S]+=m+_,o[S+1]+=g+b,o[S+2]+=v+y,o[k]+=_,o[k+1]+=b,o[k+2]+=y}}if(t.z+1<V.chunkAmount){let a=V.getChunk(t.x,t.z+1).normals,c=0,f=25-1;for(let u=0;u<24;++u){let m=(u*2+24*c*2)*3,g=a[m],v=a[m+1],_=a[m+2],b=a[m+3],y=a[m+4],k=a[m+5],S=(u+25*f)*3,A=(u+1+25*f)*3;o[S]+=g,o[S+1]+=v,o[S+2]+=_,o[A]+=g+b,o[A+1]+=v+y,o[A+2]+=_+k}}if(t.x>0){let a=V.getChunk(t.x-1,t.z).normals,c=24-1;for(let f=0;f<24;++f){let u=(c*2+24*f*2)*3,m=a[u],g=a[u+1],v=a[u+2],_=a[u+3],b=a[u+4],y=a[u+5],k=25*f*3,S=25*(f+1)*3;o[k]+=m+_,o[k+1]+=g+b,o[k+2]+=v+y,o[S]+=_,o[S+1]+=b,o[S+2]+=y}}if(t.x+1<V.chunkAmount){let a=V.getChunk(t.x+1,t.z).normals,c=0,f=25-1;for(let u=0;u<24;++u){let m=(c*2+24*u*2)*3,g=a[m],v=a[m+1],_=a[m+2],b=a[m+3],y=a[m+4],k=a[m+5],S=(f+25*u)*3,A=(f+25*(u+1))*3;o[A]+=g+b,o[A+1]+=v+y,o[A+2]+=_+k,o[S]+=g,o[S+1]+=v,o[S+2]+=_}}for(let l=0;l<25;++l)for(let a=0;a<25;++a){let c=(a+25*l)*3,f=o[c],u=o[c+1],m=o[c+2],g=1/Math.sqrt(f*f+u*u+m*m);o[c]=f*g,o[c+1]=u*g,o[c+2]=m*g}hi(i,i.attributes.position),hi(i,i.attributes.normal)}if(n){let i=t.x*2%cc*2+t.z*2%cc*cc;t.meshes.atlas=nR(t),t.meshes.texSet=t.data.textureid.map(iR);let s=t.data.holes.length>0;for(let o=0;o<2;++o)for(let r=0;r<2;++r){let l=r*2+o,a=t.data.texture[l];for(let f=0;f<br;++f)for(let u=0;u<br;++u){let m=f*br+u,g=m*3;if(R8(a[m],xu,g),s){let v=o*12+Math.floor(u/dS)+(Math.floor(f/dS)+r*12)*24;t.data.holes.indexOf(v)>=0&&(xu[g+0]=255,xu[g+1]=255,xu[g+2]=255)}}O3(t.meshes.atlas,i+l,br,br,xu);let c=t.meshes.quadrantUbos[l];c.data.quadrant[0]=i+l,c.data.terrainInfo=t.meshes.texSet[l].info,zp(c),si(c)}}},eR={min:[0,0,0],max:[64,64,64],center:[32,32,32],scale:[64,64,64],radius:60,initiated:!0},tR=t=>{if(t.geometry.terrain||(t.geometry.terrain=Cn({position:{size:3,data:e2},normal:{size:3,data:Kq},index:Jq}),Object.assign(t.geometry.terrain.bounds,eR)),!t.meshes.terrain){let e=qi(t.geometry.terrain,8,$.TRIANGLES);t.meshes.terrain=e,t.meshes.quadrantUbos=[];for(let n=0;n<4;++n){let i=Ua(Yf.meshterrain);i.data.modelMatrix=e.transform.matrix,t.meshes.quadrantUbos.push(i)}}st(t.meshes.terrain.transform.position,t.origin),t.meshes.terrain.transform.matrixNeedsUpdate=!0,qt(t.meshes.terrain.transform,!1),t.state=Math.max(t.state,5)},nR=t=>{let e=Math.floor(t.x*2/cc),n=Math.floor(t.z*2/cc),i=e+1e3*n;if(!Jv.has(i)){let s=Ho({width:br,height:br,target:$.TEXTURE_2D_ARRAY,format:$.RGB,internalFormat:$.RGB565,depth:cc**2,flipY:!1,generateMipmaps:!1});xp(s,4),es(s),Jv.set(i,s)}return Jv.get(i)},iR=t=>{let e=t.join(",");if(!Kv.has(e)){let n={info:[],diffuse:[],loaded:0};t.forEach((i,s)=>{let o=Pa.get(i);n.info[s*4+0]=o.scale/127,n.info[s*4+1]=o.darkest/255*3,n.info[s*4+2]=o.brightest/255*3,n.info[s*4+3]=o.spec/255,gi(o.texture,r=>{n.diffuse[s]=r,n.loaded++})}),Kv.set(e,n)}return Kv.get(e)},yS=t=>{},kS=(t,e)=>{},xS=()=>{},wS=t=>{let e=mt[8];if(!e.active)return;$.useProgram(e.program),et.currentProgram=e.id,Sa(e),Ca(e);let n,i,s=1;for(let r=0;r<t.length;++r){let l=t[r],a=l.meshes.terrain,c=a.geometry;n!==l.meshes.atlas&&(Vn("atlas",l.meshes.atlas,0,e),n=l.meshes.atlas),wa(c,e);for(let f=0;f<4;++f)if(l.quadrantlod[f]<=s){let u=l.meshes.texSet[f];if(u.loaded<4)continue;let m=l.meshes.quadrantUbos[f];if(al(m),i!==u){for(let b=0;b<4;++b)Vn("diffuse",u.diffuse[b],b,e);i=u}xf(e);let g=l.quadrantmask[f],v=Al[g]*4,_=Al[g+1]-Al[g];$.drawElements(a.mode,_,c.attributes.index.type,v)}}let o=mt[9];if(o.active){$.useProgram(o.program),et.currentProgram=o.id,Sa(o),Ca(e);for(let r=0;r<t.length;++r){let l=t[r],a=l.meshes.terrain,c=a.geometry,f=l.meshes.quadrantUbos[0];al(f),wa(c,o);for(let u=0;u<4;++u)if(l.quadrantlod[u]>s){let m=l.quadrantmask[u],g=Al[m]*4,v=Al[m+1]-Al[m];$.drawElements(a.mode,v,c.attributes.index.type,g)}}}};var MS,FS=()=>{MS=Cn({position:{size:3,data:new Float32Array([0,0,0,64,0,0,0,0,64,64,0,64])},index:{type:$.UNSIGNED_INT,data:new Uint32Array([0,2,1,2,3,1])}}),gi(1748,t=>Vn("waterNoise",t,0,mt[20])),gi(1243,t=>Vn("waterLines",t,0,mt[20])),Vn("bufferPongColor",Mo.colorTexture,0,mt[20]),Vn("bufferPongDepth",Mo.depthTexture,0,mt[20])},CS=(t,e)=>{if(!e||t.data.water.length===0)return;t.meshes.waterubo||(t.meshes.waterubo=Ua(Yf.water));let n=t.origin[0],i=t.origin[2],s=t.meshes.waterubo.data.verts;for(let o=0;o<4;++o){let r=t.data.water[o]*.030517578125;s[o*3]=n+o%2*64,s[o*3+1]=r,s[o*3+2]=i+Math.floor(o/2)*64}zp(t.meshes.waterubo),si(t.meshes.waterubo)},SS=t=>{},AS=t=>{let e=mt[20];Fa(e,et.currentProgram===e.id);for(let n=0,i=t.length;n<i;++n){let s=t[n];s.data.water.length!==0&&(al(s.meshes.waterubo),Ma(MS,e,$.TRIANGLES))}};var PS=t=>{j3(),Mw(),h8(t),T8(),FS(),o8(),f8(),aS(),uS(),xS()},TS=(t,e,n)=>{E8(t,e,n),_S(),g8(e),rS(),x8(t,e),r8(t),u8(t),e8(t,e),cS(),mS(),Q3(t)},ES=(t,e)=>{ty(t,e),kS(t,e),eS(t,e)},DS=t=>{lS(t),M8(t),p8(t),n8(t),ny(t)},fc=[],IS=t=>{fc.push(t)},t2=t=>{fc.splice(fc.indexOf(t),1)},VS=t=>{wS(t),l8(),fS(),tS(t)},LS=t=>{pS()},qS=t=>{AS(t),a8(),i8()},RS=(t,e,n,i,s,o,r)=>{if(t.state!==8&&(bS(t,e,n),J8(t,i),CS(t,o),s))for(let l=0;l<t.props.length;++l)t.props[l].onChunkRebuild(t)},zS=t=>{yS(t),K8(t),SS(t)};var uc={neticons:[],npcs:[]},yr=.6,n0=!1,Pl=200,Tl=200,s2=!1,i0=0,s0=0,yi=document.createElement("canvas");yi.className="border black minimap";var Ms=yi.getContext("2d"),n2=new Map,Mu=new Map;yi.addEventListener("wheel",t=>{yr=vt(yr+(t.deltaY<0?.07:-.07),.25,1.5)},{passive:!0});yi.addEventListener("mousedown",t=>{s2=!0});yi.addEventListener("mouseup",t=>{s2=!1});yi.addEventListener("mousemove",t=>{if(s2){let e=t.movementX,n=t.movementY;i0-=e/yr,s0-=n/yr}});var wu={player:"#fff",monster:"#D53434",pvp:Dt("pvp"),friendly:Dt("health"),party:Dt("party"),black:Dt("black")},rR=()=>{tt.map.onPress(()=>{o0(n0=!n0)}),Un(Ft.serverMapUpdate.header,t=>{uc.neticons=Ft.serverMapUpdate.decode(t).icons})},o0=t=>{i0=s0=0,t?(document.body.appendChild(yi),Pl=~~Math.min(Math.max(200,window.innerWidth*.7),1e3),Tl=~~Math.min(Math.max(200,window.innerHeight*.7),800),Pl%2!==0&&(Pl+=1),Tl%2!==0&&(Tl+=1),yi.width=Pl,yi.height=Tl,yi.className="border black minimap enlarged"):(document.getElementById("minimapcontainer").appendChild(yi),yi.className="border black minimap",Pl=yi.width=200,Tl=yi.height=200)},$S=function(){this.loaded=!0},US=0,lR=t=>{US++;let e=V.player;if(!e||le.mapLowQuality&&US%10!==0)return;let n=Ms;n.globalAlpha=1,n.clearRect(0,0,Pl,Tl);let i=e,s=i.pos[0]+i0,o=i.pos[2]+s0,r=yr<.4?16:4,l=r*64,a=V.chunkAmount,c=Math.round(l*yr),f=Pl,u=Tl,m=f*(l/c),g=u*(l/c),v=Math.ceil(m/l),_=Math.ceil(g/l),b=s-m/2,y=o-g/2,k=Math.floor(b/l),S=Math.floor(y/l),A=k+v,F=S+_;(A*l-b)*(c/l)<f&&A++,(F*l-y)*(c/l)<u&&F++,k=Math.max(0,k),S=Math.max(0,S),A=Math.min(a/r,A),F=Math.min(a/r,F);for(let O=k;O<A;++O)for(let se=S;se<F;++se){let X=O*r+se*a*r,oe=r+"-"+X;if(Mu.has(oe)){let ce=Mu.get(oe);if(ce.loaded){let xe=(O*l-b)*(c/l),pe=(se*l-y)*(c/l);n.drawImage(ce,xe,pe,c,c)}}else{let ce=new Image;ce.src=qk(V.file,r,X),ce.onload=$S,Mu.set(oe,ce)}}let M=!1;if(uc.neticons.forEach(O=>{M=M||O.blink;let se=t0(O.pos[0],O.pos[1],s,o,c,l,f,u);i2(se,O.id,O.blink)}),M&&(n.globalAlpha=1),uc.npcs.forEach(O=>{let se=aR(O.pos[0],O.pos[1],s,o,c,l,f,u);se[0]>0&&se[1]>0&&se[0]<f&&se[1]<u&&i2(se,O.img,!1)}),V.entities.array.forEach(O=>{if(!O.stats||!O.stats.alive||O===e)return;let se=t0(O.pos[0],O.pos[2],s,o,c,l,f,u);OS(se,O.type,e.hostility(O),O.party>0&&O.party===e.party)}),en.forEach(O=>{if(O.local&&O.pos!==void 0&&!V.isEntityIdTaken(O.id)){let se=t0(O.pos[0],O.pos[1],s,o,c,l,f,u);OS(se,0,0,e.party)}}),e.buffs.buffs.has(128)){let O=e.buffs.buffs.get(128).get(e.id);if(O.data){let se=t0(O.data[0],O.data[1],s,o,c,l,f,u);i2(se,2100,!1)}}n.globalAlpha=n0&&V.smoothtime%1<.5?.5:1;let D=V.player.visual.transform.rotation[1],R=Math.sin(D)*6,E=Math.cos(D)*6,L=Math.sin(D+2.4)*6,B=Math.cos(D+2.4)*6,I=Math.sin(D-2.4)*6,N=Math.cos(D-2.4)*6,j=f/2-i0*yr,W=u/2-s0*yr;n.fillStyle="#C1DAE2",n.strokeStyle="#1A293A",n.lineWidth=1,n.beginPath(),n.moveTo(j+R,W+E),n.lineTo(j+L,W+B),n.lineTo(j+I,W+N),n.closePath(),n.fill(),n.stroke()},i2=(t,e,n)=>{if(n2.has(e)){let i=n2.get(e);if(i.loaded===!0){!n||V.smoothtime%1<.5?Ms.globalAlpha=n?.6:.8:Ms.globalAlpha=1;let s=i.width,o=i.height;Ms.drawImage(i,t[0]-s/2,t[1]-o/2,~~s,~~o)}}else{let i=document.createElement("img");i.src="data/assets/"+Sp(e)+"?v=8588529",i.onload=$S,n2.set(e,i)}},OS=(t,e,n,i)=>{if(!(!le.mapShowMonsters&&e===1))if(e===0){if(n0&&i&&V.smoothtime%1>.5)return;n===0?Ms.fillStyle=i?wu.party:wu.friendly:Ms.fillStyle=wu.pvp,Ms.fillRect(...t,6,6),Ms.strokeRect(...t,6,6)}else Ms.fillStyle=n>0?wu.monster:wu.friendly,Ms.fillRect(...t,4,4),Ms.strokeRect(...t,4,4)},aR=(t,e,n,i,s,o,r,l)=>{let a=t-n,c=e-i,f=a/o*s,u=c/o*s,m=r/2+f,g=l/2+u;return[m,g]},t0=(t,e,n,i,s,o,r,l)=>{let a=t-n,c=e-i,f=a/o*s,u=c/o*s,m=Math.min(r-3,Math.max(0,r/2+f)),g=Math.min(l-3,Math.max(0,l/2+u));return[m,g]},cR=t=>{Mu.clear();for(let e=0;e<Pf.length;++e)Pf[e].world===t.idInt&&uc.npcs.push(Pf[e])},fR=t=>{Mu.clear(),uc.neticons.length=0,uc.npcs.length=0};function NS(t){let e,n,i,s;return{c(){e=h("img"),p(e,"class","btn border black bgblack round warIcon svelte-1khf45q"),lt(e.src,n="/data/ui/icons/war0."+On+"?v=8588529")||p(e,"src",n)},m(o,r){w(o,e,r),i||(s=Z(e,"click",t[2]),i=!0)},p:ue,d(o){o&&x(e),i=!1,s()}}}function uR(t){let e,n=t[0]!==void 0&&NS(t);return{c(){e=h("div"),n&&n.c(),p(e,"id","minimapcontainer"),p(e,"class","marg-top minimapcontainer svelte-1khf45q")},m(i,s){w(i,e,s),n&&n.m(e,null)},p(i,[s]){i[0]!==void 0?n?n.p(i,s):(n=NS(i),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},i:ue,o:ue,d(i){i&&x(e),n&&n.d()}}}function mR(t,e,n){let i,s;return re(t,Bs,r=>n(0,i=r)),re(t,Us,r=>n(1,s=r)),Pn(()=>{o0(!1)}),[i,s,r=>nt(Us,s=!s,s)]}var r2=class extends Me{constructor(e){super(),Ce(this,e,mR,uR,Ue,{})}},jS=r2;function WS(t){let e,n;return e=new IC({}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function GS(t){let e,n;return e=new RC({props:{vertical:!0}}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function pR(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v,_,b,y,k,S,A,F,M,D,R,E,L,B,I,N,j,W,O,se,X,oe,ce,xe,pe,$e,Ee;e=new RM({}),i=new R_({});let Fe=t[0]&&!t[0].subscribed_until&&(t[1]||t[2]||t[3]||t[4]||t[5])&&WS(t);r=new RF({}),l=new UF({}),a=new Lb({}),c=new sF({}),f=new OM({}),u=new hx({}),g=new DF({}),v=new rx({}),_=new PM({}),b=new VM({}),y=new jM({}),k=new s6({}),S=new PF({}),A=new y6({}),F=new I6({}),M=new U6({}),D=new j6({}),R=new dF({}),E=new dC({}),L=new yC({}),B=new fC({}),I=new EC({}),j=new YM({}),W=new jS({}),O=new BC({});let _e=t[6]&&GS(t);return ce=new qw({}),xe=new wM({}),pe=new xC({}),$e=new IF({}),{c(){ne(e.$$.fragment),n=h("div"),ne(i.$$.fragment),s=h("div"),Fe&&Fe.c(),o=ve(),ne(r.$$.fragment),ne(l.$$.fragment),ne(a.$$.fragment),ne(c.$$.fragment),ne(f.$$.fragment),ne(u.$$.fragment),m=Ne(),ne(g.$$.fragment),ne(v.$$.fragment),ne(_.$$.fragment),ne(b.$$.fragment),ne(y.$$.fragment),ne(k.$$.fragment),ne(S.$$.fragment),ne(A.$$.fragment),ne(F.$$.fragment),ne(M.$$.fragment),ne(D.$$.fragment),ne(R.$$.fragment),ne(E.$$.fragment),ne(L.$$.fragment),ne(B.$$.fragment),ne(I.$$.fragment),N=h("div"),ne(j.$$.fragment),ne(W.$$.fragment),ne(O.$$.fragment),_e&&_e.c(),se=h("div"),X=h("div"),oe=h("div"),ne(ce.$$.fragment),ne(xe.$$.fragment),ne(pe.$$.fragment),ne($e.$$.fragment),p(N,"class","l-corner-ur uiscaled"),p(s,"class","container svelte-k3qmu8"),p(oe,"class","actionbarcontainer svelte-k3qmu8"),p(X,"class","uiscaled"),p(se,"class","container svelte-k3qmu8"),p(n,"class","l-ui layout svelte-k3qmu8")},m(H,Le){ee(e,H,Le),w(H,n,Le),ee(i,n,null),d(n,s),Fe&&Fe.m(s,null),d(s,o),ee(r,s,null),ee(l,s,null),ee(a,s,null),ee(c,s,null),ee(f,s,null),ee(u,s,null),d(s,m),ee(g,s,null),ee(v,s,null),ee(_,s,null),ee(b,s,null),ee(y,s,null),ee(k,s,null),ee(S,s,null),ee(A,s,null),ee(F,s,null),ee(M,s,null),ee(D,s,null),ee(R,s,null),ee(E,s,null),ee(L,s,null),ee(B,s,null),ee(I,s,null),d(s,N),ee(j,N,null),ee(W,N,null),ee(O,N,null),_e&&_e.m(N,null),d(n,se),d(se,X),d(X,oe),ee(ce,oe,null),ee(xe,oe,null),ee(pe,se,null),ee($e,n,null),Ee=!0},p(H,[Le]){H[0]&&!H[0].subscribed_until&&(H[1]||H[2]||H[3]||H[4]||H[5])?Fe?Le&63&&P(Fe,1):(Fe=WS(H),Fe.c(),P(Fe,1),Fe.m(s,o)):Fe&&(Pe(),q(Fe,1,1,()=>{Fe=null}),Te()),H[6]?_e?Le&64&&P(_e,1):(_e=GS(H),_e.c(),P(_e,1),_e.m(N,null)):_e&&(Pe(),q(_e,1,1,()=>{_e=null}),Te())},i(H){Ee||(P(e.$$.fragment,H),P(i.$$.fragment,H),P(Fe),P(r.$$.fragment,H),P(l.$$.fragment,H),P(a.$$.fragment,H),P(c.$$.fragment,H),P(f.$$.fragment,H),P(u.$$.fragment,H),P(g.$$.fragment,H),P(v.$$.fragment,H),P(_.$$.fragment,H),P(b.$$.fragment,H),P(y.$$.fragment,H),P(k.$$.fragment,H),P(S.$$.fragment,H),P(A.$$.fragment,H),P(F.$$.fragment,H),P(M.$$.fragment,H),P(D.$$.fragment,H),P(R.$$.fragment,H),P(E.$$.fragment,H),P(L.$$.fragment,H),P(B.$$.fragment,H),P(I.$$.fragment,H),P(j.$$.fragment,H),P(W.$$.fragment,H),P(O.$$.fragment,H),P(_e),P(ce.$$.fragment,H),P(xe.$$.fragment,H),P(pe.$$.fragment,H),P($e.$$.fragment,H),Ee=!0)},o(H){q(e.$$.fragment,H),q(i.$$.fragment,H),q(Fe),q(r.$$.fragment,H),q(l.$$.fragment,H),q(a.$$.fragment,H),q(c.$$.fragment,H),q(f.$$.fragment,H),q(u.$$.fragment,H),q(g.$$.fragment,H),q(v.$$.fragment,H),q(_.$$.fragment,H),q(b.$$.fragment,H),q(y.$$.fragment,H),q(k.$$.fragment,H),q(S.$$.fragment,H),q(A.$$.fragment,H),q(F.$$.fragment,H),q(M.$$.fragment,H),q(D.$$.fragment,H),q(R.$$.fragment,H),q(E.$$.fragment,H),q(L.$$.fragment,H),q(B.$$.fragment,H),q(I.$$.fragment,H),q(j.$$.fragment,H),q(W.$$.fragment,H),q(O.$$.fragment,H),q(_e),q(ce.$$.fragment,H),q(xe.$$.fragment,H),q(pe.$$.fragment,H),q($e.$$.fragment,H),Ee=!1},d(H){H&&x(n),te(e,H),te(i),Fe&&Fe.d(),te(r),te(l),te(a),te(c),te(f),te(u),te(g),te(v),te(_),te(b),te(y),te(k),te(S),te(A),te(F),te(M),te(D),te(R),te(E),te(L),te(B),te(I),te(j),te(W),te(O),_e&&_e.d(),te(ce),te(xe),te(pe),te($e)}}}function dR(t,e,n){let i,s,o,r,l,a,c;return re(t,ra,f=>n(0,i=f)),re(t,Ar,f=>n(1,s=f)),re(t,as,f=>n(2,o=f)),re(t,Os,f=>n(3,r=f)),re(t,Yi,f=>n(4,l=f)),re(t,Vi,f=>n(5,a=f)),re(t,pa,f=>n(6,c=f)),ou(),[i,s,o,r,l,a,c]}var l2=class extends Me{constructor(e){super(),Ce(this,e,dR,pR,Ue,{})}},HS=l2;function YS(t){let e,n;return e=new HS({}),{c(){ne(e.$$.fragment)},m(i,s){ee(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){q(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function hR(t){let e,n,i,s;e=new l_({props:{active:t[0]}});let o=t[1]&&!t[0]&&t[2]&&YS(t);return i=new L_({}),{c(){ne(e.$$.fragment),o&&o.c(),n=ve(),ne(i.$$.fragment)},m(r,l){ee(e,r,l),o&&o.m(r,l),w(r,n,l),ee(i,r,l),s=!0},p(r,[l]){let a={};l&1&&(a.active=r[0]),e.$set(a),r[1]&&!r[0]&&r[2]?o?l&7&&P(o,1):(o=YS(r),o.c(),P(o,1),o.m(n.parentNode,n)):o&&(Pe(),q(o,1,1,()=>{o=null}),Te())},i(r){s||(P(e.$$.fragment,r),P(o),P(i.$$.fragment,r),s=!0)},o(r){q(e.$$.fragment,r),q(o),q(i.$$.fragment,r),s=!1},d(r){r&&x(n),te(e,r),o&&o.d(r),te(i,r)}}}function gR(t,e,n){let i,s,o;return re(t,xi,r=>n(0,i=r)),re(t,im,r=>n(1,s=r)),re(t,Vc,r=>n(2,o=r)),[i,s,o]}var a2=class extends Me{constructor(e){super(),Ce(this,e,gR,hR,Ue,{})}},XS=a2;var ZS=[],Fu=0,r0=0,QS=()=>{let t=ZS.shift();t[0](...t[1]),r0--},JS=(t,e,n)=>{if(n)for(;Fu>0;)Fu--,r0++,QS();else Fu>0&&r0<5&&(Fu--,r0++,requestIdleCallback(QS,{timeout:5e3}))},c2=(t,e,n)=>{ZS.push([t,e]),Fu++};var KS=()=>({id:0,x:0,z:0,origin:[0,0,0],deserialized:!1,props:[],normals:new Float32Array(3456),data:void 0,loadingProps:0,center2d:[0,0],geometry:{},meshes:{},state:0,neighbors:[],quadrantlod:[0,0,0,0],quadrantmask:[0,49,98,147],inRange:!1,isMeshVisible:!1,isEffectsVisible:!1}),f2=(t,e,n,i,s)=>{B8(t,e,n,i),t.center2d[0]=t.origin[0]+64/2,t.center2d[1]=t.origin[2]+64/2,t.neighbors.length=0;for(let o=Math.max(0,n-1);o<=Math.min(s-1,n+1);o++)for(let r=Math.max(0,i-1);r<=Math.min(s-1,i+1);r++){let l=o+r*s;l!==t.id&&t.neighbors.push(l)}t.state=0},eA=t=>t.state>=2?!1:(t.state=2,vR(t),!0),vR=async t=>{try{let n=await(await fetch(`data/world/${V.file}/${t.id}?v=8588529`,{cache:"default"})).arrayBuffer();c2(_R,[new Uint8Array(n),t])}catch{console.log(`failed to load chunk ${t.id}, retrying`),t.state=2-1,eA(t)}},_R=(t,e)=>{e.state=3,U8(e,va.chunk.decode(t)),u2(e)},u2=t=>{if(t.inRange=Lv(t.x*2,t.z*2)<3,t.inRange)for(let e=0;e<2;++e)for(let n=0;n<2;++n){let i=n*2+e,s=Math.min(2,Lv(t.x*2+e,t.z*2+n)),o=WC(t.x*2+e,t.z*2+n);t.quadrantlod[i]=s,t.quadrantmask[i]=o}},tA=(t,e)=>{let n=t.state;if(n===0||n===3){if(t.inRange){n===0&&(t.state=1);let i=t.loadingProps===0;for(let s=0;s<t.neighbors.length;++s){let o=e.chunksMap.get(t.neighbors[s]);o?o.state<3&&(o.state===0&&(o.state=1),i=!1):i=!1}n===3&&i&&(t.state=4,bR(t,!0,!0,!0,!0,!0,!0))}}else n>=5?t.inRange&&t.state<7?(IS(t),t.state=7):!t.inRange&&t.state===7&&(t2(t),Cu(t,!1,!1),t.state=6):n===1&&eA(t)&&(t.state=2)},Cu=(t,e,n)=>{if(t.isMeshVisible!==e){t.isMeshVisible=e;for(let i=0;i<t.props.length;++i)t.props[i].setVisible(e)}if(!n&&t.isEffectsVisible!==e){t.isEffectsVisible=e;for(let i=0;i<t.props.length;++i)t.props[i].setEffectVisible(e)}},bR=(t,e,n,i,s,o,r)=>{c2(RS,[t,e,n,i,s,o])},m2=t=>{$8(t),t.state===7&&(t2(t),Cu(t,!1,!1),t.state=6),zS(t),t.state=8};var iA=(t,e,n)=>{let i=[];for(let s=0;s<t.length;++s){let o=t[s];L8(o.data.aabb,e.frustum,e.frustumConstants)?(i.push(o),Cu(o,!0,n)):Cu(o,!1,n)}return i},yR=()=>{let t=fc;if($.enable($.POLYGON_OFFSET_FILL),$.polygonOffset(1.3,3),ec){for(let e=1;e>=0;--e){let n=Oa[e],i=Ml[e];Jp(i,!0),Su(n),Ah(n),t=iA(t,i,!0);for(let s=0,o=Vd.length;s<o;++s){let r=Vd[s];Ja(r,mt[r.shadowProgram],!0,i)}}du(!1)}Jp(Ml[0],!0),l0(Oa[0],$a,$.DEPTH_BUFFER_BIT),Su($a);for(let e=0,n=Id.length;e<n;++e){let i=Id[e];Ja(i,mt[i.shadowProgram],!1,gt)}$.disable($.POLYGON_OFFSET_FILL)},kR=t=>{Jp(gt,!0),Su(bs),Ah(bs);for(let e=0,n=Td.length;e<n;++e){let i=Td[e];Ja(i,mt[i.program],!0,gt)}VS(t)},xR=t=>{LS(t);for(let e=0,n=Ed.length;e<n;++e){let i=Ed[e];Ja(i,mt[i.program],!0,gt)}l0(bs,Mo,$.DEPTH_BUFFER_BIT),l0(bs,Mo,$.COLOR_BUFFER_BIT),Su(bs),qS(t);for(let e=0,n=Dd.length;e<n;++e){let i=Dd[e];Ja(i,mt[i.program],!0,gt)}},mc=(t,e,n,i,s)=>{let o=mt[t];n&&Vn("inputA",n.colorTexture,0,o),i&&Vn("inputB",i.colorTexture,0,o);for(let r=0;r<s.length;++r){let l=o.uniforms[s[r][0]];l.value=s[r][1]}Su(e),Ki(Df,o)},wR=t=>{let e=Mo,n=bs;if(t.has(32)&&(t.delete(32),mc(32,e,n,null,[]),[e,n]=[n,e]),t.has(33)&&(t.delete(33),mc(33,e,n,null,[]),[e,n]=[n,e]),t.has(30)){t.delete(30);let i=.5/fl.width,s=.5/fl.height;mc(30,ul,n,null,[["offset",[-i,-s,i,-s,i,s,-i,s]],["amount",[.25,.25,.25,.25]]]);let o=["amount",[.125,.375,.375,.125]];i*=2,s*=2,mc(30,fl,ul,null,[["offset",[-i*2,0,-i,0,i,0,i*2,0]],o]),mc(30,ul,fl,null,[["offset",[0,-s*2,0,-s,0,s,0,s*2]],o]),mc(31,null,n,ul,[])}else l0(n,null,$.COLOR_BUFFER_BIT)},l0=(t,e,n,i=$.NEAREST)=>{let s=t.width,o=t.height,r=e!==null?e.width:bs.width,l=e!==null?e.height:bs.height;$.bindFramebuffer($.READ_FRAMEBUFFER,t.buffer),$.bindFramebuffer($.DRAW_FRAMEBUFFER,e!==null?e.buffer:null),$.blitFramebuffer(0,0,s,o,0,0,r,l,n,i)},Su=t=>{t?($.bindFramebuffer($.FRAMEBUFFER,t.buffer),Oc(t.width,t.height)):($.bindFramebuffer($.FRAMEBUFFER,null),Oc(et.width,et.height))},sA=t=>{wx(t)},oA=t=>{yR();let e=iA(fc,gt,!1);kR(e),xR(e),wR(t)};var pc=le.resolution/100,lA=!1,rA=[256,512,1024,2048][le.shadowmapResolution]||1024,aA=()=>{$||(alert("WebGL2 problem found."),window.location.href="/technical"),cA(),sA(rA),PS(rA),uA(et.width,et.height),In.className="l-canvas",Fi.className="l-canvas",Fi.style.pointerEvents="all",window.addEventListener("resize",fA,!1)};qr.subscribe(t=>{NC(t**2/10,le.shadowmapResolution)});Rr.subscribe(t=>{gt.fov=t,Uc(gt)});xi.subscribe(t=>{lA=!t});var cA=()=>{let t=window.innerWidth*pc,e=window.innerHeight*pc;C_(t,e)},fA=()=>{let t=window.innerWidth*pc,e=window.innerHeight*pc;cA(),Mx(t,e),uA(t,e)},uA=(t,e)=>{gt.aspect=t/e,Uc(gt),Fw(t,e)};zr.subscribe(t=>{let e=t/100,n=pc!==e;pc=e,le.resolutionScale=e,n&&fA()});var mA=(t,e)=>{Fm(gt);let n=new Set;le.fxaa&&n.add(32),le.bloom&&n.add(30),lA&&(TS(t,e.smoothtime,n),oA(n))},pA=(t,e)=>{ES(t,e)},dA=t=>{DS(t),b8()};_o.report.fun=t=>{t.length>=3?oo.set({name:t,reason:0,reasonfixed:!1}):jt("error","Enter a player name to report",!0)};var v2={};Xn(v2,{init:()=>ER,postTick:()=>DR});var Au=[],eo=0,hA=t=>{eo+=t;let e=[];for(let i=0;i<Au.length;i++){let s=Au[i];if(s.timer.done(eo))CR(s),Au.splice(i--,1);else if(eo>=s.timer.start){let o=s.timer.fraction(eo);st(s.screenPos,s.pos);let r=gl(s.screenPos,s.screenPos,s.flat);if(r){let l=s.timer.remaining(eo);if(s.alpha=l<.3?l/.3:1,s.crit){let a=Math.min(1,o*6);s.scale=1+(a>.5?2-a*2:a*2)*1.6}else r[1]-=50-(1-o)**2*50,s.scale=1;e.push(s)}}}if(e.sort((i,s)=>s.timer.start-i.timer.start),le.combatTextPush){let i=0,s=!0,o=[0,0],r=[0,0];for(;i<10&&s;){++i,s=!1;for(let l=0;l<e.length;++l){let a=e[l],c=a.width*a.scale,f=a.height*a.scale;o[0]=a.screenPos[0]+a.screenOffset[0],o[1]=a.screenPos[1]+a.screenOffset[1];for(let u=0;u<e.length;++u){if(u===l)continue;let m=e[u],g=m.width*m.scale;if(m.flat!==a.flat||g<c||g===c&&l<u)continue;let v=m.height*m.scale;r[0]=m.screenPos[0]+m.screenOffset[0],r[1]=m.screenPos[1]+m.screenOffset[1];let _=r[0]-o[0],b=r[1]-o[1],y=g/2+c/2,k=v/2+f/2;if(Math.abs(_)<y&&Math.abs(b)<k){let S=_<0?_+y:_-y,A=b<0?b+k:b-k;Math.abs(S)<Math.abs(A)*1.2?a.screenOffset[0]+=S:a.screenOffset[1]+=A,s=!0,o[0]=a.screenPos[0]+a.screenOffset[0],o[1]=a.screenPos[1]+a.screenOffset[1]}}}}}let n=[0,0];for(let i=0;i<e.length;++i){let s=e[i];s.screenOffset[0]*=Math.max(0,1-t*3),s.screenOffset[1]*=Math.max(0,1-t*3),n[0]=s.screenPos[0]+s.screenOffset[0],n[1]=s.screenPos[1]+s.screenOffset[1],vM(n,s.img,s.alpha,s.scale)}},d2=(t,e,n,i,s=!1,o)=>{let r=n===3;Pu(t,s,r,s||!r,n===0?"Miss":ht(e)+(n===1?"\u{1F6E1}\uFE0F":""),s?It.pdmg:i===1?r?It.spellCrit:It.spell:r?It.physCrit:It.phys,o,eo,r?1.2:.9)},h2=(t,e,n,i=!1,s)=>{Pu(t,i,n===3,i||n!==3,ht(e),i?It.pheal:It.heal,s,eo,1.3)},gA=(t,e,n)=>{Pu(t,n,!1,!0,"Immune",n?It.mana:It.spell,e,eo,2)},vA=(t,e,n,i=!1)=>{Pu(t,i,n===3,i||n!==3,e,It.mana,0,eo,1.3)};var _A=(t,e)=>{Pu(t,!1,!1,!0,`+${e} Fame`,It.fame,5.5,eo,1.5)},Pu=(t,e=!1,n=!1,i=!1,s,o,r,l,a)=>{let c=FR();st(c.pos,t),c.pos[1]+=r||0,c.side=Math.sin(Au.length*2.3),c.flat=e,c.crit=n,c.float=i,c.timer.reset(l,a),Y(c.screenPos,0,0,0),di(c.screenOffset,0,0,0),c.scale=0,c.alpha=0,c.img=Kf(s,o),c.width=c.img.width,c.height=c.img.height,Au.push(c)},p2=[],FR=()=>p2.length?p2.pop():{pos:[0,0,0],flat:!0,crit:!0,float:!0,yoffset:0,timer:new kt(0,1),screenPos:[0,0,0],screenOffset:[0,0],scale:0,alpha:0,img:void 0,width:0,height:0},CR=t=>{p2.push(t)};var g2=le.itemTypeFilter.toLowerCase().replace(/\s/g,"").split(","),dc=new Set,SR=(t,e,n)=>{for(let i=n.length-1;i>=0;i--){let s=n[i];(s==e||Kn(e.pos,s.pos)<5**2)&&(t.push(s),Rn(t.pos,t.pos,s.pos),n.splice(i,1))}},bA=(t,e)=>{st(t.hudPos,t.visualPosition||t.pos),gl(t.hudPos,t.hudPos)&&t.hudPos[2]<.997&&e.push(t)},yA=t=>{let e=[];V.entities.array.forEach(s=>{s.type!==3||!s.visual.transform.visible||s.quality<le.itemQualityFilter||g2.includes(s.droptype)||bA(s,e)}),dc.forEach(s=>{s.uiTimeout<V.time?dc.delete(s):bA(s,e)}),e=e.sort((s,o)=>o.id-s.id);let n=new Set;for(;e.length;){let s=e[0],o=[];o.pos=[0,0,0],SR(o,s,e),dn(o.pos,o.pos,1/o.length),Y(o.pos,Math.round(o.pos[0]),Math.round(o.pos[1]),Math.round(o.pos[2])),gl(o.pos,o.pos)?n.add(o.sort((r,l)=>r.hudPos[2]-l.hudPos[2])):n.delete(o)}let i=0;Array.from(n).sort((s,o)=>o.pos[2]-s.pos[2]).forEach(s=>{let o=s.length/5*100,r=0,l=0;s.forEach((a,c)=>{a.hudTextImg||(a.hudTextImg=Kf(a.name,It[a.color]));let f=a.hudTextImg.width,u=Math.round(s.pos[0]+l-o*.5)-2,m=Math.round(s.pos[1]-r*20)-8;if(a.uiTimeout===0){let g=a.canBePickedUpBy(V.player),v=a.partyTimeoutCheck(V.player);g&&!(La[0]>u+f||La[1]>m+20||La[0]<u||La[1]<m)?(i=a.id,Ci.globalAlpha=1):Ci.globalAlpha=g?.4:.1,Ci.fillStyle="#000000",Ci.beginPath(),Ci.rect(u,m,f,20),Ci.fill(),ar(di(Bn,u+2,m+8),a.name,v?It[a.color]:It.itemgrey,g?1:.8,1,0,0,0)}l+=f+3,l>o&&(r++,l=0)})}),i!==vn&&Xf(i)};var Yn=[],kA,xA,$i=2,wA=()=>{let n=Math.ceil(100),i=Math.max(7,Math.ceil(9*1)),s=Math.max(1,Math.ceil($i*1)),o=n-$i*2,r=i-$i*2;Yn.push(Ti(null,Dt("panel"),n,i,0,0,s)),Ti(Yn[0],Dt("grey"),o,r,$i,$i,1),Yn.push(Ti(null,Dt("health"),o,r,0,0,1)),Yn.push(Ti(null,"#ffbc00",o,r,0,0,1)),Yn.push(Ti(null,Dt("enemy"),o,r,0,0,1)),Yn.push(Ti(null,Dt("party"),o,r,0,0,1)),Yn.push(Ti(null,Dt("pvp"),o,r,0,0,1)),Yn.push(Ti(null,"#555555",o,r,0,0,1)),Yn.push(Ti(null,Dt("spell"),o,r,0,0,1));for(let l=0;l<=3;++l)Yn.push(Ti(null,Dt("c"+l),o,r,0,0,1));kA=Ti(null,"#ffffff",100+$i*2,9+$i*2,0,0,3),xA=Ti(null,"#ffffff",100+$i*2,16+$i*2,0,0,3)},AR=()=>{let t=[];return V.entities.array.forEach((e,n)=>{!e.visual||!e.visual.transform.visible||e.stats&&!e.stats.alive||e.id!==qn&&e.visual.cDist&&e.visual.cDist>60||e.type===3&&e.id!==vn||(st(e.hudPos,e.visualPosition||e.pos),e.type!==3&&(e.hudPos[1]+=e.visual.getTopAbsolute(),e.mount!==void 0&&(e.hudPos[1]+=1)),gl(e.hudPos,e.hudPos)&&(e.id===V.playerId&&(e.hudPos[0]=Math.round(.5*In.width),e.hudPos[1]=Math.round(.5*In.height)),t.push(e)))}),t.sort((e,n)=>n.hudPos[2]-e.hudPos[2])},PR=(t,e,n)=>e?4:n===0?le.classColorBars&&t.type===0?8+t.class:1:V.player.canCombatInteract(t)?n===2?le.classColorBars?8+t.class:5:t.type===1&&t.aggroMode===0?2:3:6,TR=(t,e)=>{let n=t.visual&&t.visual.cDist;if(n>le.nameplateViewRange)return;n?n/=70:n=0;let i=t.party>0&&t.party===V.player.party,s=t.faction!==void 0?V.player.hostility(t):0,o=V.player.clan,r=V.player.level,l=t.id===qn,a=t.id===V.playerId,c=t.id===vn;if(t.type!==3&&t.stats&&t.stats.alive){t.namePlateScale=vt(t.namePlateScale+((l?1:0)-t.namePlateScale)*.25,.5,1);let m=l?1:Math.max(.1,Math.min(1,1-n))*.7,g=l||i?1:Math.min(.8,c?.9:m*.75+.2),v=t.skills.timedSkill!==void 0;!a&&l&&lr(v?xA:kA,t.hudPos,1,t.namePlateScale,1,v?2:1,0,v?4:0);let _=l||s===0&&le.nameplateShowFriendlyPlayers||s===1&&le.nameplateShowMonsters||s===2&&le.nameplateShowEnemyPlayers;if(v&&_){let b=Yn[0].height-$i,y=vt(t.skills.timedCast.fraction(V.smoothtime),0,1);lr(Yn[0],t.hudPos,g,t.namePlateScale,1,1,0,b),y>0&&lr(Yn[7],t.hudPos,g,t.namePlateScale,y,1,0,b)}if(!a&&_&&(lr(Yn[0],t.hudPos,g,t.namePlateScale,1,v?2:1),lr(Yn[PR(t,i,s)],t.hudPos,g,t.namePlateScale,t.stats.getResource(6)/t.stats.getStat(6),1),t.clan&&ar(di(Bn,t.hudPos[0]-(Yn[0].width/2+$i)*t.namePlateScale,t.hudPos[1]),t.clan,t.clan==o?It.clan:t.faction===0?It.faction0small:It.faction1small,g,1,2,0,1),t.level&&(le.alwaysShowLevel||l))){let b=It.lev1;s!==0&&(t.level-r>4?b=It.lev3:t.level-r>1?b=It.lev2:t.level-r<-5&&(b=It.lev0)),ar(di(Bn,t.hudPos[0]+(Yn[0].width/2+$i)*t.namePlateScale,t.hudPos[1]),t.level,b,g,1,0,0,0)}}let f,u=!1;if(t.type===3?(f=t.partyTimeoutCheck(V.player)?It[t.color]:It.itemgrey,u=!0):s===0?(f=l?It.name:It.nameSmall,u=le.nameShowFriendlyPlayers):s===1?(f=l?It.enemy:It.enemySmall,u=le.nameShowMonsters):s===2&&(f=l?It.pvp:It.pvpSmall,u=le.nameShowEnemyPlayers),l||u){let m=t.type===3&&c&&!t.canBePickedUpBy(V.player)?.5:l||t.type===3?1:c?.9:Math.max(.1,Math.min(1,1-n))*.7,g=l?-16:-9,v=a&&t.clan?t.clan.length*5:0,_=ar(t.hudPos,t.name,f,m,1,v,g);t.clan&&a&&ar(di(Bn,t.hudPos[0]-_/2+$i,t.hudPos[1]),t.clan,t.faction===0?l?It.faction0:It.faction0small:l?It.faction1:It.faction1small,m,1,t.clan.length*5,g,1)}t.speechText&&ar(t.hudPos,t.speechText,t.speechStyle,1,1,0,l?-30:-20,.5,1)},MA=t=>{dc.clear();let e=AR();ig(e),e=e.sort((n,i)=>n.id===qn||n.id===vn?1:i.id===qn||i.id===vn?-1:i.hudPos[2]-n.hudPos[2]),ei(go,0,0,0,0),e.forEach(TR)};var ER=()=>{gM(),wA()},DR=t=>{Ci.clearRect(0,0,In.width,In.height),tt.shift.down?yA(t):MA(t),hA(t)};var _2={};Xn(_2,{onWorldEnter:()=>IR});var IR=()=>{xt("petlootsettings",g2.join(",")+" "+le.itemQualityFilter)};var b2={};Xn(b2,{init:()=>VR});var VR=()=>{Un(Ft.serverWarUpdate.header,t=>{let e=Ft.serverWarUpdate.decode(t);Bs.update(n=>(n===void 0||e.contributors.length===0&&(e.contributors=n.contributors),e))})};var hc=[v2,sg,wg,Wg,o2,S1,Nh,q1,Yh,_2,vg,gp,b2],y2=!1,FA=()=>{hc.forEach(t=>{t.init&&t.init()})},CA=t=>{hc.forEach(e=>{e.preTick&&e.preTick(t)})},SA=t=>{hc.forEach(e=>{e.tick&&e.tick(t)})},AA=(t,e)=>{hc.forEach(n=>{n.postTick&&n.postTick(t,e)})},PA=t=>{hc.forEach(e=>{e.onWorldEnter&&e.onWorldEnter(t)}),y2=!0},TA=t=>{y2&&hc.forEach(e=>{e.onWorldDestroy&&e.onWorldDestroy(t)}),y2=!1};var DA=async t=>{let n=await(await fetch("api/user/join",{method:"POST",body:JSON.stringify({id:t})})).json();if(n.world)Lr.set(n.world),jc.set(t);else throw Lr.set(void 0),jc.set(void 0),n.result||"Unknown Error";return!0};var IA=0,a0=!1,VA=new kt(0,2e4),LA=2,qA=t=>{VA.done(t)&&(t>1e5&&!a0&&t-IA>60*1e3*3?(a0=!0,IA=t,Ar.set(LA),LA++):a0&&(a0=!1,Ar.set(0)),VA.reset(t))};var k2={arena3v3:{port:5006},arena5v5:{port:5007},main:{port:5009},dev2:{port:5010},dev_default:{port:5010},dev_pathfind:{port:5011},arena_big_swamp:{port:5012},arena_cage:{port:5013},arena_cove:{port:5014},arena_lava:{port:5015},arena_ruins:{port:5016},arena_small_swamp:{port:5017}};var x2=t=>{k2[le.activeWorld]===void 0?window.location.href="/":(console.log("Connecting to "+le.activeWorld),t&&xi.set("Connecting"),b3(k2[le.activeWorld].port))},RA=t=>{V.load(t.world,t.file,t.playerId),V.setTimeFromTickId(t.tickId),Tu=0},Tu=0,zA=async t=>{if(t===4002)xi.set("Connecting"),V.destroy();else try{if(Tu<10?xi.set("Connecting"):xi.set(`Connecting (${t})`),t===1006&&(Tu++,Tu>=20)||t>=4008)throw!0;V.destroy();let e=Tu>1?g1(500,1e3):g1(1200,1600);for(await new Promise(n=>setTimeout(n,e));document.visibilityState==="hidden";)xi.set("Browser is idle"),await new Promise(n=>setTimeout(n,e));await DA(le.lastConnectedChar)}catch{return window.location.href="/",!1}x2(!1)},BA=(t,e)=>{m3(e),JS(t,e,V.state<=2),qA(e),V&&V.player?(uy(t),CA(t),V.tick(t),SA(t),mA(t,V),AA(t,V)):V&&V.tick(t)};var c0=class{constructor(){this.nodes=new Map,this.width=-0,this.height=-0,this.depth=-0,this.yd=-0,this.zd=-0,this.xm=-0,this.ym=-0,this.zm=-0,this.xs=-0,this.ys=-0,this.zs=-0,this.dirty=!1}setDimensions(e,n,i,s,o,r){this.clear(),this.dirty=!0;let l=Math.floor(e/s),a=Math.floor(n/o),c=Math.floor(i/r);this.width=e,this.height=n,this.depth=i,this.yd=a,this.zd=c,this.xm=l-1,this.ym=a-1,this.zm=c-1,this.xs=e/l,this.ys=n/a,this.zs=i/c}clear(){this.nodes.clear()}add(e,n){let i=Math.max(0,Math.min(this.xm,~~(n[0]/this.xs))),s=Math.max(0,Math.min(this.ym,~~(n[1]/this.ys))),o=Math.max(0,Math.min(this.zm,~~(n[2]/this.zs))),r=Math.max(0,Math.min(this.xm,~~(n[3]/this.xs))),l=Math.max(0,Math.min(this.ym,~~(n[4]/this.ys))),a=Math.max(0,Math.min(this.zm,~~(n[5]/this.zs)));for(let c=i;c<=r;++c)for(let f=s;f<=l;++f)for(let u=o;u<=a;++u){let m=c*this.yd*this.zd+f*this.zd+u;this.nodes.has(m)||this.nodes.set(m,{aabbs:[],content:[],count:0});let g=this.nodes.get(m);g.content.push(e),g.aabbs.push(n),g.count++}}queryAABB(e){let n=Math.max(0,Math.min(this.xm,~~(e[0]/this.xs))),i=Math.max(0,Math.min(this.ym,~~(e[1]/this.ys))),s=Math.max(0,Math.min(this.zm,~~(e[2]/this.zs))),o=Math.max(0,Math.min(this.xm,~~(e[3]/this.xs))),r=Math.max(0,Math.min(this.ym,~~(e[4]/this.ys))),l=Math.max(0,Math.min(this.zm,~~(e[5]/this.zs))),a=[];for(let c=n;c<=o;++c)for(let f=i;f<=r;++f)for(let u=s;u<=l;++u){let m=c*this.yd*this.zd+f*this.zd+u;if(this.nodes.has(m)){let g=this.nodes.get(m);for(let v=0;v<g.count;++v){let _=g.content[v];D8(g.aabbs[v],e)&&!a.includes(_)&&a.push(_)}}}return a}queryRay(e,n,i){let s=e[0]+n[0],o=e[1]+n[1],r=e[2]+n[2],l=Math.max(0,Math.min(this.xm,~~(Math.min(e[0],s)/this.xs))),a=Math.max(0,Math.min(this.ym,~~(Math.min(e[1],o)/this.ys))),c=Math.max(0,Math.min(this.zm,~~(Math.min(e[2],r)/this.zs))),f=Math.max(0,Math.min(this.xm,~~(Math.max(e[0],s)/this.xs))),u=Math.max(0,Math.min(this.ym,~~(Math.max(e[1],o)/this.ys))),m=Math.max(0,Math.min(this.zm,~~(Math.max(e[2],r)/this.zs))),g=[];for(let v=l;v<=f;++v)for(let _=a;_<=u;++_)for(let b=c;b<=m;++b){let y=v*this.yd*this.zd+_*this.zd+b;if(this.nodes.has(y)){let k=this.nodes.get(y);for(let S=0;S<k.count;++S){let A=k.content[S];V8(k.aabbs[S],e,i,0,1)&&!g.includes(A)&&g.push(A)}}}return g}queryNodeContents(e,n,i){e=Math.max(0,Math.min(this.xm,~~(e/this.xs))),n=Math.max(0,Math.min(this.ym,~~(n/this.ys))),i=Math.max(0,Math.min(this.zm,~~(i/this.zs)));let s=e*this.yd*this.zd+n*this.zd+i;return this.nodes.has(s)?this.nodes.get(s).content:[]}};var oi={origin:[0,0,0],dir:[0,-1,0],invDir:[0,0,0]},f0=(t,e,n,i,s,o,r)=>{Y(t.origin,e,n,i),Y(t.dir,s,o,r),bm(t.invDir,t.dir)};var u0=class{constructor(e){this.entity=e,this.buffs=new Map,this.casters=new Map,Jf.forEach(n=>{this[n]=new Set}),this.tags=new Map;for(let n=0;n<13;++n)this.tags.set(n,new Set)}tick(e,n,i){}setBuff(e,n,i,s,o,r){i<=0&&console.error("buff with zero or less stacks");let l=this.buffs.get(e)||this.buffs.set(e,new Map).get(e),a=l.get(n)||{};if(a.caster=n,a.id=e,a.level=r,a.stacks=i,a.logic=dl.get(e),a.timer=new kt(s,o),a.active=!0,a.uniqueInstances=0,a.remove=!1,a.logic.intervalDuration!==void 0){let f=s;a.interval&&(f=a.interval.start);let u=V.entity(n);a.interval=new kt(f,a.logic.intervalHaste&&u!==void 0?a.logic.intervalDuration/hF(u.stats.getStat(16)):a.logic.intervalDuration)}else a.interval=new kt(0,0);return l.set(n,a),a.logic.onSet(a,n,this),(this.casters.get(n)||this.casters.set(n,new Map).get(n)).set(e,a),a.logic.unique&&this.updateUniqueState(e),a}removeBuff(e,n){let i=this.buffs.get(e);if(i){let s=i.get(n);if(s){s.logic.onRemove(s,n,this),i.delete(n),i.size===0&&this.buffs.delete(e);let o=this.casters.get(n);return o.delete(e),o.size===0&&this.casters.delete(n),s.logic.unique&&this.updateUniqueState(e),s}}}updateUniqueState(e){let n=this.buffs.get(e);if(n){let i;n.forEach((s,o)=>{(!i||s.level>i.level)&&(i=s),s.active=!1,s.uniqueInstances=n.size}),i.active=!0}}clear(e,n=!1){this.buffs.forEach((i,s)=>{i.forEach((o,r)=>{(!n||r!==this.entity.id)&&o.logic.passive==e&&o.logic.clearOnDeath&&this.removeBuff(s,r)})})}clearTempBuffs(){this.clear(!1)}clearPassiveBuffs(){this.clear(!0)}onDeath(){this.clearTempBuffs()}hasAnyWithTag(e){return this.tags.get(e).size>0}};var ji=[5,4,0,2,3,8,9],Wi=(t,e,n,i)=>{let s=t.entity.mount!==void 0;t.walking=!s&&t.walking,zR(t,s),BR(t,s),RR(t,s),qR(t,e,n,i,s),LR(t,e,n,i,s)},LR=(t,e,n,i)=>{if(t.body[0].visible&&t.entity.buffs.visualIncapacitate>0){Jn(t.body[0].rotation,(Math.sin(n*2.2)+Math.sin(n*2.1)*.3)*.3+1,(Math.sin(n*2.1)+Math.sin(n*2)*.6)*.3,(Math.sin(n*.8)+Math.sin(n*2.3)*.5)*.3);for(let s=2;s<=3;++s)t.body[s].position[1]-=.2}},qR=(t,e,n,i,s)=>{let o=t.body[2];if(o.visible&&(t.body[6]!==void 0&&(t.sheathed||(s?Ni(t,!0):t.entity.target&&!t.walking&&!t.falling?(o.rotation[0]+=1,o.rotation[2]+=.6,o.position[2]-=.3,o.position[1]-=.2,o.position[0]-=.1,t.body[4].position[0]-=.05,t.body[5].position[0]+=.05,t.body[4].position[2]-=.2,t.body[0].position[1]+=-.05+Math.sin(n*3)*.05,t.body[0].rotation[1]-=Math.cos(n*3)*.05):(o.rotation[0]+=.5,o.position[1]-=.2,o.position[0]-=.1))),t.currentAnim&&t.currentAnim.info.movement!==13)){let l=Qt.easeInOutCubic(t.currentAnim.fract),a=-Math.sin(l*7.5-1.5),c=-Math.sin(l*6.28),f=-Math.sin(l*3.14),u=Qt.easeOutExpo(-f);switch(dn(o.rotation,o.rotation,1-u),t.currentAnim.info.movement){case 0:if(t.body[6]!==void 0)Ni(t,!1),Jn(o.rotation,f*1.7,u*1.5,a*u+u*.5),o.position[2]-=f-l*u,o.position[1]+=Math.sin(l*13+3)*u*.5,o.position[0]+=(-.5+l*1.5)*u,t.body[0].rotation[1]+=c*1.5;else{let m=Math.cos(l*6.28);t.body[0].position[2]+=(.3+Math.sin(l*6.28-3.14)*.2)*u,t.body[0].rotation[0]+=Math.sin(l*3.28)*.5*u;for(let g=0;g<=1;++g){let v=t.body[2+g];v.visible&&(dn(v.position,v.position,1-u),v.position[2]+=(1-m*.5)*u,v.position[1]+=Math.sin(l*6.28)*(l>.5?.7:1),v.position[0]+=(g?.5+f*.2:-.5-f*.2)*u,Y(v.rotation,0,1.5,0))}}break;case 1:Ni(t,!1),o.rotation[0]-=f*1.7,o.rotation[1]+=u*1.5-u,o.rotation[2]+=a*u+u*.5,o.position[2]+=u,o.position[0]-=u*.5,t.body[0].rotation[1]-=c*1.5-u*.5;break;case 12:Ni(t,!1),o.rotation[0]=1.7,o.rotation[1]=0,o.rotation[2]=.5,o.position[2]=1.3,o.position[1]=.2,o.position[0]=-.5;break;case 4:Ni(t,!1),o.rotation[0]+=f*1.7,o.rotation[1]-=f*1.5,o.position[0]-=u*.5,t.body[0].rotation[1]=l*2*Math.PI+u*3;break;case 3:{Ni(t,!0),Y(t.body[0].rotation,f,0,0),Y(o.position,-.3,0,.7);break}case 11:{Ni(t,!1),Y(t.body[0].rotation,f*.4,0,f*.3),o.rotation[0]-=f*.8,o.rotation[1]+=f*.4;break}case 9:{Ni(t,!1),Y(o.rotation,0,0,0);break}case 5:{Ni(t,!0);break}}}let r=t.body[3];t.body[7]!==void 0&&r.visible&&(t.entity.target&&!t.walking&&!t.falling?(r.rotation[2]-=.2,r.rotation[1]-=1,r.position[1]+=.1,r.position[2]+=.4):(r.rotation[2]-=.1,r.position[1]+=.1))},RR=(t,e)=>{for(let n=0;n<=1;++n){let i=t.body[4+n];if(i.visible)if(e)Y(i.rotation,-.9,n?.2:-.2,n?.4:-.4),Y(i.position,n?.6:-.6,-.4,.5);else{let s=sl(t.entity.steer);if(t.currentAnim&&t.currentAnim.info.movement===10){Y(i.position,0,0,0);continue}if(t.falling)if(t.flip==0){let o=Math.max(-1,Math.min(0,t.entity.vel[1]*.2))*.1,r=n?t.cycle(0)*.3-o:t.cycle(.5)*.3+o;Y(bt,n?.3-o:-.3+o,-.65,r),Dr(i.position,bt,0),Y(i.rotation,-r,s,0)}else Y(i.position,n?.3:-.3,-.3,0),Y(i.rotation,0,0,0);else if(t.entity.inWater>t.entity.radius)t.walking?(Y(i.rotation,1.3,n?.1:-.1,0),Y(i.position,n?.3:-.3,Math.cos(t.cycleRad+n*Math.PI)*.4,-1.1)):(Y(i.rotation,1,n?.1:-.1,0),Y(i.position,n?.3:-.3,-.7,Math.cos(t.cycleRad+n*Math.PI)*.4));else{if(t.walking){let o=t.entity.steer[1]<0?.4:.6,r=t.cycle(0)*o*1.3;Y(bt,n?.3:-.3,Math.max(0,Math.cos(t.cycleRad+(n?0:Math.PI))*.6)-.55,t.cycle(n?0:.5)*o),Dr(i.position,bt,s),Y(i.rotation,n?-r:r,s,0)}else Y(i.rotation,0,n?.1:-.1,0),Y(i.position,n?.45:-.45,-.65,0);t.currentAnim&&!t.walking&&(t.currentAnim.info.movement==5||t.currentAnim.info.movement==13||t.currentAnim.info.movement==6||t.currentAnim.info.movement==9)&&Y(i.position,n?.4:-.55,-.65,n?.2:-.3)}}}},zR=(t,e)=>{let n=t.body[0],i=n.position,s=n.rotation;if(n.visible){if(!t.falling||e?(t.walking?t.entity.inWater>t.entity.radius?Y(i,0,-.1,0):Y(i,0,Math.cos(t.cycleRad*2)*.1+.4,0):t.entity.inWater>t.entity.radius?Y(i,0,.3,0):Y(i,0,e?.5:t.cycle(0)*.1+.4,0),t.transform.rotation[0]!==0&&(t.transform.rotation[0]=0)):(t.transform.rotation[0]=t.cycleRad*t.flip,Y(i,0,t.flip!=0?.3:.5,0)),t.entity.inWater>t.entity.radius)t.walking?Y(s,1.2,0,Math.sin(t.cycleRad)*.1):Y(s,Math.sin(t.cycleRad)*.1-.1,0,Math.cos(t.cycleRad)*.05);else{Y(s,-t.pushBack[1]*5+t.movementPushback[2],0,t.pushBack[0]*5-t.movementPushback[0]),Ip(i,i,t.pushBackOffset),sn(i,i,t.movementPushback,1);let o=-t.movementPushback[1]*.5;Y(n.scale,1+o,1-o,1+o)}if(t.currentAnim!==void 0){let o=t.currentAnim.info.movement;if((o==5||o==6)&&(s[1]-=.3+.05*t.cycle(.2),s[0]+=.3+.02*t.cycle(.4),i[1]-=.1+.05*t.cycle(.6),i[0]-=.05),o==6)s[1]*=1-t.currentAnim.fract;else if(o==10)Y(i,0,.2+Math.sin(t.currentAnim.fract*Math.PI)*.5,0),s[0]+=t.currentAnim.fract*il,s[1]+=sl(t.entity.steer);else if(o==9){let r=Qt.easeOutQuad(vt(t.currentAnim.fract*2,0,1));i[1]+=Math.sin(3+r*5)*.2,s[0]+=.5-r*.5}else o==12?s[1]=t.currentAnim.fract*Math.PI*2:o==13&&(i[2]-=.2+t.cycle(.4)*.05,s[0]=-.2+t.cycle(.8)*.12,s[1]=-.2,s[2]=.2+t.cycle(.15)*.05)}}},BR=(t,e)=>{for(let n=0;n<=1;++n){let i=t.body[2+n];if(i.visible){if(!t.falling||e)if(t.entity.inWater>t.entity.radius)if(t.walking){let s=t.cycle(0),o=t.entity.steer[1]<0?.3:.5,r=Math.sin(t.cycleRad*2+5);Y(i.rotation,0,s*o*1.3+(n?Math.PI:0),0),Y(i.position,(n?.7:-.7)+r*(n?-.2:.2),.2+s*o*(n?-1.5:1.5),-.2+s*(n?-.3:.3))}else{let s=Math.cos(t.cycleRad+n*2);Y(i.rotation,0,(n?-.43+Math.PI:.43)+s*.15*(n?1:-1),.3),Y(i.position,n?.7:-.7,s*.05-.2,.6-s*.2)}else if(t.walking){let s=t.cycle(0),o=t.entity.steer[1]<0?.3:.5,r=Math.sin(t.cycleRad*2+5);Y(i.rotation,0,s*o*1.3+(n?Math.PI:0),0),Y(i.position,(n?.7:-.7)+r*(n?-.2:.2),-.2+s*(n?.3:-.3),.2+s*o*(n?-1.5:1.5)),i.position[0]=n?Math.max(.5,i.position[0]):Math.min(-.5,i.position[0])}else if(e)Y(i.rotation,0,n?-1.3+Math.PI:1.3,.3),Y(i.position,n?.3:-.3,-.5,.7);else{let s=t.cycle(0);Y(i.rotation,0,(n?-.43+Math.PI:.43)+s*.15*(n?1:-1),.3),Y(i.position,n?.7:-.7,-.3+s*.08,.15-s*.1)}else Y(i.position,n?.6:-.6,-vt(t.entity.vel[1],-5,5)/20,0),i.position[0]+=(n?1:-1)*Math.sin(i.position[1]*3.1+.8)*.3,Y(i.rotation,0,n?Math.PI:0,-.3-i.position[1]);if(t.currentAnim){let s=t.currentAnim.info.movement;if(s==5||s==6)n==0?(i.position[0]-=.2,i.position[1]-=.2,s==6&&(dn(i.position,i.position,1-t.currentAnim.fract),i.position[0]+=-t.currentAnim.fract*.3,i.position[2]+=Math.sin(Math.min(.5,t.currentAnim.fract)*7+4)*.8+.4)):(i.position[0]-=.4,i.position[2]+=.5-t.cycle(.3)*.2,i.rotation[1]+=.6+t.cycle(.4)*.2,i.rotation[0]-=.8,s==6&&(dn(i.position,i.position,1-t.currentAnim.fract),i.position[0]+=t.currentAnim.fract*.3,i.position[2]+=Math.sin(Math.min(.5,t.currentAnim.fract)*7+4)*.7+.3));else if(s===9){let o=Qt.easeInOutCubic(vt(t.currentAnim.fract*2,0,1));Y(i.rotation,1-o,0,0);let r=Math.sin(o*3);n==0?Y(i.position,-.12-r*.35,-.1+o*1.2,.3+r):Y(i.position,.12+r*.35,o*1.2,.3+r)}else if(s===11){let o=Math.sin(Qt.easeInOutCubic(t.currentAnim.fract)*3);i.position[0]+=o*(n?.3:0),i.position[1]=o*(n?-.2:1)-.3,i.position[2]=o*(n?-.3:1)}else s===13&&(i.position[0]=n?.6:0,i.position[1]=n?.7:1,i.position[2]=.8,i.rotation[0]=n?t.cycle(.4)*.2:t.cycle(.2)*.2,i.rotation[1]=n?2:1,i.rotation[2]=n?2:1)}if(t.body[8+n]){let s=t.body[8+n];s.visible&&(Vr(s,i.position,!1,fp),dn(s.rotation,s.rotation,.5),s.rotation[1]-=n?.8:-.8,s.rotation[2]-=n?.5:-.5)}}}},Ni=(t,e)=>{t.sheathed!==e&&(t.sheathed=e,t.body[6]!==void 0&&(Mn(t.body[6],e?t.body[0]:t.body[2]),t.sheathed?st(t.body[6].position,t.skin.sheathedPos):st(t.body[6].position,t.skin.unsheathedPos),t.body[6].matrixNeedsUpdate=!0),t.body[7]!==void 0&&(Mn(t.body[7],e?t.body[0]:t.body[3]),t.sheathed?(Y(t.body[7].position,0,-.2,-.65),Y(t.body[7].rotation,0,-1.57,0)):(Y(t.body[7].position,-.2,0,0),Y(t.body[7].rotation,0,0,0)),t.body[7].matrixNeedsUpdate=!0))};var w2=[5,4,0,2,3],M2=(t,e,n,i)=>{let s=t.body[3];if(s.visible&&(Y(s.rotation,.2,1.7+t.cycleSin*.15,.4),Y(s.position,.1+t.cycleSin*.2,-.3,.9),t.entity.target>0&&(s.position[0]=.2,s.position[1]+=.15,s.position[2]+=.1,s.rotation[0]+=.2,s.rotation[1]=1.8,s.rotation[2]-=.2),t.currentAnim))switch(t.currentAnim.info.movement){case 5:{Ni(t,!1);let o=Qt.easeOutQuad(vt(t.currentAnim.fract*2,0,1));Y(s.rotation,1.2,2,.3),Y(s.position,.2,0,.8+o*.8),Y(t.body[2].position,-.1-Math.sin(o*2)*.6,o*.1,.8-o*.8),Y(t.body[0].position,0,.6-o*.2,0),Y(t.body[0].rotation,.2-o*.2,-.4+o*.3,0);break}case 7:{Ni(t,!1);let o=Qt.easeOutFlick(vt((t.currentAnim.fract-.5)*2,0,1));Y(s.rotation,1.2,2,.3+o*.1),Y(s.position,.2,o*.3,1.6),Y(t.body[2].position,-.7,.1,-o*.7),Y(t.body[0].position,0,.4,0),Y(t.body[0].rotation,0,-.1,0);break}case 8:{Ni(t,!1);let o=Qt.easeOutQuad(vt(t.currentAnim.fract*2,0,1));Y(t.body[2].position,-.5-o*.3,-.3+o*.3,Math.sin(o*6.28)*.6),Y(s.rotation,.2+.5*o,2,.3),Y(s.position,.2,-.4+o*.3,.8+o*.8),t.body[0].rotation[1]=0,t.body[0].rotation[0]=-.2+o*.2}break}!t.walking&&t.body[4].visible&&(t.body[4].position[2]-=.3,t.body[5].position[2]+=.1)};var UA=[2],OA=(t,e,n,i)=>{let s=t.body[2];Jn(s.rotation,.9,-.4,0),s.position[2]-=.1};var $A=[0,16,17],NA=(t,e,n,i)=>{let s=t.cycle(.5);if(Y(t.body[0].scale,s*.1+1,1+t.cycleSin*.1,s*.1+1),Y(t.body[0].position,0,-.2+t.cycleSin*.1,0),Y(t.body[0].rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5),Ip(t.body[0].position,t.body[0].position,t.pushBackOffset),t.currentAnim){let o=Qt.easeOutExpo(t.currentAnim.fract**3);switch(t.currentAnim.info.movement){case 0:t.body[0].position[2]+=Math.sin(o*6.28-3.14);break}}for(let o=0;o<2;++o){let r=t.body[16+o];if(r.visible=t.transform.visible,!r.visible)continue;for(let c=0;c<r.children.length;++c)r.children[c].visible=!0;let l=o==0?t.transform:t.body[16+o-1];Xt(bt,l.position,r.position),Y(Qr,0,0,-l.scale[0]*.7),Dr(yn,Qr,l.rotation[1]),Rn(bt,bt,yn);let a=mi(bt);a>30*t.entity.size?st(r.position,t.entity.pos):sn(r.position,r.position,bt,Math.max(0,Math.min(.5,20*e*(a-r.scale[1]*.7)))),Y(r.rotation,0,Ep(Xt(bt,l.position,r.position)),0),pi(r.scale,(3-o)*.3*(.8+t.cycle(o*.3)*.1)*t.transform.scale[0]),r.position[1]=Math.max(t.entity.pos[1]+r.scale[1]*.5,r.position[1]-e*2.5),qt(r,!1)}};var jA=[2,3],WA=(t,e,n,i)=>{if(!t.currentAnim)for(let s=0;s<2;++s){let o=t.body[2+s];if(!o.visible)continue;let r=t.cycle(1.3);Y(o.rotation,.78,0,s?r*.2:-r*.2),Y(o.position,s?.2:-.2,-.4,.6)}};var GA=[0,4,5],HA=(t,e,n,i)=>{let s=t.body[0],o=t.body[4],r=t.body[5];if(t.walking&&!t.falling){t.speed=t.entity.speed*(t.entity.steer[1]===-1?-1.2:1)*.04/(.6+t.entity.size*.6);let l=Math.cos(t.cycleRad);Y(o.rotation,0,t.cycleSin*.2,t.cycleSin*.2),Y(o.position,0,Math.abs(l)*.3+.2,0),Y(r.rotation,0,Math.PI+l*.2,l*.2),Y(r.position,0,Math.abs(t.cycleSin)*.3,0),Y(s.position,t.cycle(.3)*.01,t.cycleSin*.02,0),Y(s.rotation,0,t.cycleSin*.01,Math.sin(t.cycleRad*2)*.01),t.entity.target>0&&Math.random()<.3&&t.fraction(.1,e)&&t.playSound(t.stepset[0],!1)}else{if(t.speed=.5,t.currentAnim){let l=Qt.easeOutExpo(t.currentAnim.fract**3);switch(t.currentAnim.info.movement){case 0:{let a=Math.sin(l*6.28-3.14);Y(s.position,0,Math.max(0,-a),a*.5);for(let c=0;c<2;++c){let f=c==0?o:r,u=c==0?1:-1,m=c==1?Math.PI:0;Y(f.rotation,u*Math.min(a,0),m+a*.1*u,0),Y(f.position,0,Math.max(0,-a),a*.5)}break}}}else{let l=t.cycle(-.1)*.05;Y(s.position,0,t.cycle(-.1)*.1,0);for(let a=0;a<2;++a){let c=a==0?o:r;Y(c.rotation,0,a==1?Math.PI:0,t.falling?.4:l*.5),Y(c.position,0,0,0)}}Y(s.rotation,0,0,0)}Jn(s.rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5)};var YA=[],XA=(t,e,n,i)=>{Y(t.transform.rotation,-t.pushBack[1]*2,t.entity.rot,t.pushBack[0]*2)};var QA=[0,2,3,16],ZA=(t,e,n,i)=>{let s=t.body[0],o=t.body[2],r=t.body[3],l=25/o.scale[0],a=n+t.entity.id;if(Y(s.rotation,Math.sin(a*l/8)*.15,0,Math.sin(a*l/10)*.07),Jn(s.rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5),Y(s.position,0,1+Math.sin(a*18)*.1,0),t.body[16]!==void 0){let f=t.body[16];f.position[1]=f.data.skin.pos[1]+Math.sin(a*18+2.75)*.1}let c=Math.sin(a*l)*.7;for(let f=0;f<2;++f){let u=f==0,m=u?o:r;m.rotation[2]=m.data.skin.rot[2]+(u?Math.PI-c:c)}if(t.currentAnim&&t.currentAnim.info.movement===0){let f=t.currentAnim.fract,u=Math.sin(Go(f,.2,-.4)*3.14)*1.5;if(s.position[2]+=u,s.rotation[0]+=u*.4,f>.65){let m=Qt.easeOutQuad(ds(f,.65,1,0,1));s.rotation[0]-=m*Math.PI*2,s.position[1]+=Math.sin(m*Math.PI)*1.5}}};var JA=[0,2,3],KA=(t,e,n,i)=>{for(let s=0;s<2;++s){let o=t.body[2+s];o.position[1]*=.8,o.position[2]*=.8,o.position[1]+=.5;let r=t.body[4+s];r.position[1]-=0,r.position[0]+=s?.4:-.4}Y(t.body[0].scale,1.8,2,1.8),t.body[0].position[1]+=1};var eP=[2],tP=(t,e,n,i)=>{Y(t.body[2].position,-.8,-.2,.7),Y(t.body[2].rotation,1.8+t.cycleSin*.1,0,0)};var nP=[17,0,16,21,2,3,4,5],iP=(t,e,n,i)=>{let s=t.body[4].scale[1];t.currentAnim&&t.currentAnim.info.movement===0?KR(t,s):QR(t,s)},QR=(t,e)=>{let n=ds(t.entity.speed/20/(.2+t.entity.size*.8),3,10,0,1),i=ds(n,0,1,.6,.4),s=ds(n,0,1,.5,.2);t.speedMultiplier=ds(n,0,1,1,.5),ZR(t,s,i,e),JR(t,s,i,e)},ZR=(t,e,n,i)=>{let s=0,o=0,r=0,l=0,a=0,c=0,f=0,u=ds(e,.2,.5,.5,1);t.walking?(s=Math.sin(t.cycleRad*2-1)*.07,r=Math.sin(t.cycleRad*2)*.07,o=-t.cycle(0)*.1*u,a=Math.sin(t.cycleRad*2+n)*.05,l=-t.cycle(n)*.07*u,c=t.cycle(n+.2)*.3,f=0):(s=t.cycle(.3)*.03,r=t.cycle(.35)*.02,a=t.cycle(0)*.02-.05,c=Math.sin(t.cycleRad*2)*.07,f=t.cycle(.3)*.1);let m=t.body[17];Y(m.position,0,i*.8+s-.15,1.2),Y(m.rotation,.1,f,0);let g=t.body[0];Y(g.position,0,i*.7+r-.15,.5),Y(g.rotation,-.06,o*1.3,o);let v=t.body[16];Y(v.position,0,i*.75+a-.15,-.35),Y(v.rotation,.04,l*1.3,l);let _=t.body[21];Y(_.position,-c*.35,-.18+s*.5,-.67),Y(_.rotation,.6,c,0)},JR=(t,e,n,i)=>{let s=[2,3,4,5];for(let o=0;o<4;++o){let r=s[o],l=t.body[r],a=o%2==0,c=o<2,f=-.75+i*.5,u=c?.8:-.6,m=c?.35:.26,g=t.entity.steer[1]<0?-.5:1;if(t.walking){let v=(a?0:e)+(c?0:n),_=t.cycleScaled(v,g),b=Math.max(0,t.cycleScaled(v-Math.PI,g)*.3);u-=_*.4,Y(l.rotation,_,0,0),Y(l.position,a?-m:m,f+b,u)}else Y(l.rotation,0,a?-.2:.2,0),Y(l.position,a?-m:m,f,u)}},KR=(t,e)=>{let n=t.currentAnim.fract,i=Math.sin(Go(n,.2,-.4)*3.14)*1.5,s=[2,3,4,5];for(let f=0;f<4;++f){let u=s[f],m=t.body[u],g=f%2==0,v=f<2,_=-.75+e*.5,b=(v?.8:-.6)+i*.2,y=v?.35:.26;Y(m.rotation,i*.5,0,0),Y(m.position,g?-y:y,_,b)}let o=t.body[17];Y(o.position,0,.8*e-.15,1.2+i*.4),Y(o.rotation,i*.4,0,Math.sin(i*3)*.5);let r=t.body[0];Y(r.position,0,.7*e-.15,.5+i*.4),Y(r.rotation,-.06,0,0);let l=t.body[16];Y(l.position,0,.75*e-.15,-.35+i*.4),Y(l.rotation,.04,0,0);let a=t.body[21],c=Math.max(i,0);Y(a.position,0,-.18*.5+c*.3,-.67),Y(a.rotation,.6+c,0,0)};var sP=[2,3,4,5],oP=[[-.6,-.5,.5],[.6,-.5,.5],[-.6,-.5,-.5],[.6,-.5,-.5]],rP=[2,3,4,5,0,16,21,17,19,20],lP=(t,e,n,i)=>{let s=t.body[4].scale[1];t.currentAnim&&t.currentAnim.info.movement===0?tz(t,s):nz(t,s)},tz=(t,e)=>{rz(t,e),lz(t,e),az(t,e)},nz=(t,e)=>{t.speedMultiplier=.8,iz(t,e),sz(t,e),oz(t,e)},iz=(t,e)=>{let n=t.body[0],i=t.body[16],s=t.body[21],o=e-.9+n.scale[1]*.5;if(t.walking){let r=t.cycle(0)*.2;n.position[1]=o+Math.sin(t.cycleRad*2)*.05,i.position[1]=o+Math.sin(t.cycleRad*2+.5)*.05,Y(n.rotation,0,r,0),Y(i.rotation,0,-r,0),s&&(s.position[1]=s.data.skin.pos[1]+o+Math.sin(t.cycleRad*2)*.05)}else n.position[1]=o,i.position[1]=o,Y(n.rotation,0,0,0),Y(i.rotation,0,0,0),s&&(s.position[1]=s.data.skin.pos[1]+o+Math.sin(t.cycleRad)*.05);n.matrixNeedsUpdate=!0,i.matrixNeedsUpdate=!0,ro(n),ro(i)},sz=(t,e)=>{let n=t.walking?.2:.08,i=t.body[17];i!==void 0&&Y(i.rotation,0,t.cycle(.4)*n,0);let s=t.body[19];s!==void 0&&Y(s.rotation,0,t.cycle(.2)*n,0);let o=t.body[20];o!==void 0&&Y(o.rotation,0,t.cycle(t.walking?.1:.9)*n,0)},oz=(t,e)=>{let n=t.walking,i=n?t.cycle(0)*.5:0,s=n?t.cycle(.25)*.5:0,o=n?t.cycle(.75)*.5:0,r=t.entity.steer[1]<0?-.5:1;for(let l=0;l<4;++l){let a=sP[l],c=t.body[a],f=l%2==0,u=l<2,m=t.body[u?0:16],g=oP[l];Mi(c.position,g,m.matrix);let v=0,_=0;f&&u||!u&&!f?(v=s,_=i):(v=o,_=-i),c.position[1]+=Math.max(0,v*.5),c.position[2]+=_*r*.4,c.rotation[0]=-_*r}},rz=(t,e)=>{let n=t.currentAnim.fract,i=Math.sin(Go(n,.2,-.4)*3.14)*1.5,s=t.body[0],o=t.body[16],r=t.body[21],l=e-1+s.scale[1]*.5;Y(s.position,0,l,s.data.skin.pos[2]+i*.4),Y(s.rotation,0,i*.2,0),Y(o.position,0,l,o.data.skin.pos[2]+i*.4),Y(o.rotation,0,-i*.2,0),r!==void 0&&(Y(r.position,0,r.data.skin.pos[1]+l,r.data.skin.pos[2]+i*.4),Y(r.rotation,0,0,0)),s.matrixNeedsUpdate=!0,o.matrixNeedsUpdate=!0,ro(s),ro(o)},lz=(t,e)=>{let n=t.currentAnim.fract,i=Math.sin(Go(n,.2,-.4)*3.14)*1.5,s=t.body[17];s!==void 0&&Y(s.rotation,i*.4,0,Math.sin(i*3)*.5);let o=t.body[19];o!==void 0&&Y(o.rotation,0,i*.5,0);let r=t.body[20];r!==void 0&&Y(r.rotation,0,i*.5,0)},az=(t,e)=>{let n=t.currentAnim.fract,i=Math.sin(Go(n,.2,-.4)*3.14)*1.5;for(let s=0;s<4;++s){let o=sP[s],r=t.body[o],l=s<2,a=t.body[l?0:16],c=oP[s];Mi(r.position,c,a.matrix),Y(r.rotation,i*.5,0,0)}};var aP=[18,3],cP=(t,e,n,i)=>{Y(t.body[18].rotation,0,0,n*.3),Y(t.body[3].position,.8,-.2,.7),Y(t.body[3].rotation,1.8,0,0)};var m0=[5,4,0,2,3],p0=(t,e,n,i)=>{Jn(t.body[0].rotation,(Math.sin(n*1.8)*Math.cos(n*12)*.3+Math.sin(n*1.4)*.3)*.1-.2,(Math.sin(n*1.3)+Math.sin(n*2.4)*.6)*.15,(Math.sin(n*.2)+Math.sin(n*1.9)*.5)*.2);for(let s=0;s<=1;++s){let o=t.body[2+s];o.visible&&Jn(o.rotation,(Math.sin(n*2)*Math.cos(n*9)+Math.sin(n*1.3))*.2,(Math.sin(n*2-2)*Math.cos(n*7)+Math.sin(n*.8))*.3,0);let r=t.body[4+s];r.visible&&(r.rotation[1]+=Math.sin(n*.2-s)*.3,r.position[0]+=s?.15:-.15)}};var fP=[2],uP=(t,e,n,i)=>{t.body[2].position[2]+=.6,Jn(t.body[2].rotation,-2.1,-4.1,-.2)};var mP=[2,3,0],pP=(t,e,n,i)=>{if(t.currentAnim===void 0||t.currentAnim.info.movement===0)for(let s=0;s<2;++s){let o=t.body[2+s],r=Math.sin(n*4+s);Y(o.position,s?.5:-.5,r*.2,1),Y(o.rotation,0,1.5,-r*.2)}Jn(t.body[0].rotation,(Math.sin(n*1.8)*Math.cos(n*2)*.3+Math.sin(n*1.4)*.3)*.1+.2,(Math.sin(n*1.3)+Math.sin(n*2.4)*.6)*.1,(Math.sin(n*.4)+Math.sin(n*1.9)*.5)*.1)};var dP=[[Wi,M2],[Wi,OA],[NA],[Wi,WA],[HA],[XA],[Wi,KA],[Wi],[],[Wi,tP],[Wi,cP],[Wi,p0],[Wi,M2,p0],[Wi,p0],[Wi,uP],[Wi,pP],[iP],[lP],[ZA]],hP=[new Set([...ji,...w2]),new Set([...ji,...UA]),new Set([...$A]),new Set([...ji,...jA]),new Set([...GA]),new Set([...YA]),new Set([...ji,...JA]),new Set([...ji]),new Set,new Set([...ji,...eP]),new Set([...ji,...aP]),new Set([...ji,...m0]),new Set([...ji,...w2,...m0]),new Set([...ji,...m0]),new Set([...ji,...fP]),new Set([...ji,...mP]),new Set([...nP]),new Set([...rP]),new Set([...QA])];var gc=class{constructor(e){this.transform=on(),this.transform.matrixAutoUpdate=!0,this.soundPrio=e.radius>3?1:0,this.doesYell=e.type!==0,this.entity=e,this.cycleOne=0,this.cycleRad=Zt(0,1),this.cycleSin=0,this.speed=1,this.speedMultiplier=1,this.lastFlags=0,this.deathTimer=new kt(0,0),this.hurtSoundTimer=new kt(0,5),this.pushBack=[0,0],this.pushBackVel=[0,0],this.pushBackOffset=[0,0],this.movementPushback=[0,0,0],this.movementPushbackVel=[0,0,0],this.groundNormal=[0,0,0],this.cDist=1/0,this.cDistLast=1/0,this.inFog=!0,this.animQueue=[],this.currentAnim=void 0,this.eyesBlink=0,this.capeoffset=0,this.walking=!0,this.falling=!1,this.hasDied=!1,this.flip=0,this.hasJustJumped=!1,this.hasJustLanded=!0,this.sheathed=!1,this.interiorlight=[0,0,0,0],this.needsColorUpdate=!1,this.colors=new Set,this.alphas=new Set,this.currentAlpha=0,this.goalAlpha=1,this.body=[],this.meshes=[],this.effects=[],this.skin=void 0,this.soundset=void 0,this.stepset=void 0,this.skeleton=void 0,this.animset=void 0,this.colPrim=void 0,this.colSec=void 0}setSkin(e,n,i){this.skin!==void 0&&(this.removeSkin(),this.cDistLast=0,this.hasDied=!1,this.deathTimer.reset(0,0),this.removeColor(Ln.death)),this.skin=s1.get(e);let s=t1.get(this.skin.soundset);this.soundset=s.sounds,this.stepset=n1.get(s.steps).steps,this.skeleton=o1.get(this.skin.skeleton),this.animset=dP[this.skin.animset],this.colPrim=n||this.skin.colPrim,this.colSec=i||this.skin.colSec;let o=hP[this.skin.animset];for(let r=0;r<this.skin.body.length;++r){let l=this.skin.body[r],a=l.col;l.colMode===1?a=this.colPrim:l.colMode===2&&(a=this.colSec);let c=this.mesh(l.bid,l.pid,o.has(l.bid),l.mid,l.lod,a,l.ts===1);c&&(st(c.position,l.pos),st(c.scale,l.scl),st(c.rotation,l.rot),c.data.skin=l)}for(let r=0;r<this.skin.effects.length;++r){let l=this.skin.effects[r];this.effects.push(Bi(l.id,this.body[l.bid],0,!1))}}removeSkin(){this.clearAnims(),this.clearMeshes(),this.clearEffects()}cycle(e){return e==0?this.cycleSin:Math.sin(this.cycleRad+2*e*Math.PI)}cycleScaled(e,n){return Math.sin(this.cycleRad*Math.sign(n)+2*e*Math.PI)*n}checkCycleReset(){let e=this.falling<<1|(!this.falling&&this.walking)<<2;e!=this.lastFlags&&(this.cycleOne=0,this.lastFlags=e)}addPushBack(e,n,i){this.cDist<50&&(this.pushBackVel[0]-=e*i/this.entity.size,this.pushBackVel[1]-=n*i/this.entity.size)}addRandomPushback(e){this.cDist<50&&(this.pushBackVel[0]-=Zt(-1,1)*e/this.entity.size,this.pushBackVel[1]-=Zt(-1,1)*e/this.entity.size)}tickPushBack(e,n,i){this.cDist<50&&(Qh(this.pushBackVel,this.pushBackVel,this.pushBack,-e*1500/this.entity.size),kf(this.pushBackVel,this.pushBackVel,1-e*30),Qh(this.pushBack,this.pushBack,this.pushBackVel,e),S3(this.pushBackOffset,this.pushBack,-this.entity.rot)),this.cDist<25&&(sn(this.movementPushback,this.movementPushback,this.movementPushbackVel,e*60),sn(this.movementPushbackVel,this.movementPushbackVel,this.movementPushbackVel,-(e*20)),sn(this.movementPushbackVel,this.movementPushbackVel,this.movementPushback,-(e*10)),this.movementPushbackVel[2]+=this.entity.steer[1]*.01,this.movementPushbackVel[0]-=this.entity.steer[0]*.01)}disableVis(e){for(let n=0,i=e.children.length;n<i;++n){let s=e.children[n];s.visible=!1,this.disableVis(s)}}checkVis(e,n,i){for(let s=0,o=e.children.length;s<o;++s){let r=e.children[s];this.meshes.indexOf(r)<0||(r.visible=r.data.lod*n/this.cDist>i,r.visible?this.checkVis(r,n,i):this.disableVis(r))}}updateVisibility(){let e=this.entity.mount!==void 0?1/0:Math.max(60,Math.min(150,gt.far*.7));return this.cDist=Tr(this.transform.position,gt.worldPosition),this.inFog=this.cDist>e,!this.inFog&&(!le.disableoffscreen||Fh(gt,this.entity.visualPosition,this.transform.scale[1]))?(!this.hasDied&&Math.abs(this.cDistLast-this.cDist)>1&&(this.cDistLast=this.cDist,this.checkVis(this.transform,Math.max(1,this.transform.scale[1]),1.5/(45+e))),this.transform.visible=!0,!0):(this.cDistLast=0,this.transform.visible&&(this.transform.visible=!1,this.meshes.forEach(n=>n.visible=!1),this.clearAnims()),!1)}tick(e,n,i){this.updateVisibility()?(this.needsColorUpdate&&this.colorUpdate(),this.alphaUpdate(e),this.entity.stats===void 0||this.entity.stats.alive?this.entity.buffs.visualFreeze===0&&(this.cycleOne=(this.cycleOne+this.speed*e)%1,this.cycleRad=this.cycleOne*Math.PI*2,this.cycleSin=Math.sin(this.cycleRad),this.tickAnimations(e),this.falling=this.entity.inWater<this.entity.radius&&(this.falling&&!this.entity.onGround||!this.falling&&!this.entity.onGround&&Math.abs(this.entity.vel[1])>6),this.walking=this.entity.steer[0]!=0||this.entity.steer[1]!=0,this.tickVisuals(e,n,i)):this.tickDeath(e,n,i),qt(this.transform,!1)):this.alphaUpdate(100)}tickVisuals(e,n,i){this.checkCycleReset(),this.calculateCycleSpeed(),this.body[1]!==void 0&&this.tickEyes(e,this.body[1]),this.body[10]!==void 0&&this.tickCape(e,this.body[10]),this.tickWalking(e),this.tickLanding();for(let s=0;s<this.animset.length;++s)this.animset[s](this,e,n,i);if(this.skeleton.groundNormal||this.entity.mount&&this.entity.mount.skeleton.groundNormal){let s=Math.min(1,e*10);this.groundNormal[0]+=(this.entity.groundNormal[0]-this.groundNormal[0])*s,this.groundNormal[2]+=(this.entity.groundNormal[2]-this.groundNormal[2])*s,Tp(this.transform.rotation,this.groundNormal)}else this.flip||(this.transform.rotation[0]=this.transform.rotation[2]=0)}tickFixed(e,n,i){this.hasDied||this.tickPushBack(e,n,i)}tickAnimations(e){let n=this.currentAnim=this.animQueue[0];if(n){let i=n.info,s=n.fract;if(this.animQueue.length>1&&i.priority===0?n.fract>.6?n.time+=e*5:n.time=n.info.duration:n.time+=e,n.fract=n.time/i.duration,n.time>i.duration)if(n.loop)n.fract%=1,n.time=0;else{n.fract=1,this.onAnimEnd(n),this.animQueue.shift();return}for(let o=0;o<i.sounds.length;++o){let r=i.sounds[o];r.end>0?n.fract>=r.start&&n.fract<=r.end?n.activeSounds[o]===void 0&&(n.activeSounds[o]=Hs(r.id,this.transform,this.soundPrio,!0,1)):n.activeSounds[o]!==void 0&&(n.activeSounds[o].stop(),n.activeSounds[o]=void 0):n.fract>=r.start&&(s<r.start||r.start===0&&s===0)&&(n.id===4&&r.id===50?Hs(this.soundset[4],this.transform,this.soundPrio,!1,1):Hs(r.id,this.transform,this.soundPrio,!1,1))}for(let o=0;o<i.effects.length;++o){let r=i.effects[o];if(r.type===0&&n.fract>r.start&&s<=r.start){let l,a=!1;if(r.body===99){let c=V.entity(n.dirImpactTarget);c&&c.visual&&(l=on(),wm(l,c.visual.transform,this.transform,c.radius),qt(l,!1),c.visual.addPushBack(this.transform.position[0]-c.visual.transform.position[0],this.transform.position[2]-c.visual.transform.position[2],2)),a=!0}else r.body===101?(l=on(),st(l.position,this.transform.position),st(l.scale,this.transform.scale),st(l.rotation,this.transform.rotation),qt(l,!1),a=!0):l=r.body===100?this.transform:this.body[r.body];if(l===void 0)continue;xs(r.id,l,this.soundPrio,a)}else if(r.type>0)if(n.fract>=r.start&&n.fract<=r.end)if(n.activeEffects[o]===void 0){let l=r.body===100?this.transform:this.body[r.body];l&&(n.activeEffects[o]=r.type===1?Bi(r.id,l,this.soundPrio,!1):w8(r.id,l,this.soundPrio,!1))}else{let l=n.activeEffects[o];r.type===1||(l.fractionLast=l.fractionNow,l.fractionNow=Math.min(1,Math.max(0,1-(r.end-n.fract)/(r.end-r.start))))}else n.activeEffects[o]!==void 0&&(n.activeEffects[o].done=!0,n.activeEffects[o]=void 0)}}}tickEyes(e,n){if(n.visible){let i=0;this.eyesBlink>0?i=this.eyesBlink-e:Math.random()<.006?i=.1:i=this.eyesBlink,(this.eyesBlink>0&&i<0||i>0&&this.eyesBlink<0)&&(n.scale[1]=i>0?.1:n.scale[0],n.matrixNeedsUpdate=!0),this.eyesBlink=i}}tickCape(e,n){n.visible&&this.skin.capeswing&&((this.entity.steer[1]>0||this.falling)&&(this.capeoffset+=mi(this.entity.vel)*.5*e),this.capeoffset=Math.max(0,Math.min(2,this.capeoffset*(1-e*3))),Y(n.rotation,this.capeoffset,0,0))}tickLanding(){this.entity.inWater>this.entity.radius||(this.hasJustJumped&&this.entity.onGround&&(this.cDist<20&&this.entity.vel[1]<-4&&(this.soundPrio===1&&this.playSound(56,!0),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.15,this.eyesBlink=.3),this.hasJustLanded=!0,this.hasJustJumped=!1,this.flip=0),this.hasJustLanded&&!this.entity.onGround&&(this.entity.vel[1]>5&&(this.soundPrio===1&&this.playSound(57,!0),Math.random()<.5&&(this.flip=this.entity.steer[1]),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.1,this.eyesBlink=.3),this.hasJustJumped=!0,this.hasJustLanded=!1))}tickWalking(e){if((this.cDist<20||this.transform.scale[1]>2)&&!this.falling){let n=this.transform.scale[1]>2||this.body[0].scale[1]>2,i=this.fraction(.2,e),s=this.fraction(.7,e);if(this.entity.inWater>0){if(this.entity.inWater<this.entity.radius*2)this.walking?this.entity.inWater<this.entity.radius?(i||s)&&(this.playSound(n?55:this.entity.inWater>this.entity.radius/2?127:128,!1),this.watersplash(92)):(i||s)&&(i&&this.playSound(129,!1),this.watersplash(93)):(i||s)&&this.watersplash(93);else if(this.entity.inWater>3&&(i||s)&&Math.random()<.5){let o=this.transform.position;Qs(153,void 0,o[0],o[1],o[2],0,0,0,!1)}}else this.walking&&(n||this.soundPrio===1)&&(i||s)&&this.playSound(n?55:this.stepset[0],!n)}}calculateCycleSpeed(){this.falling?this.speed=1.5:this.walking?this.entity.inWater<this.entity.radius?this.speed=this.entity.speed/20*(this.entity.steer[1]===-1?1.3:1)*.45/(.4+this.entity.size*.6):this.speed=this.entity.speed/20*.2:this.speed=.5,this.speed*=this.speedMultiplier}fraction(e,n,i=this.cycleOne){return i>=e&&i-this.speed*n<e}mesh(e,n,i,s,o,r,l=!1){let a=Zs(s,l,!0,!1);if(a.data.lod=o,XC(a.data.multi,a,"interiorlight",this.interiorlight),a.visible=!1,a.matrixAutoUpdate=i,r!==void 0&&this.changeMeshBaseColor(a,r),a.data.basealpha=1,a.data.alpha[0]=this.currentAlpha,n>=0){if(!this.body[n])return;Mn(a,this.body[n]),a.parent.data.lod=Math.max(o,a.parent.data.lod||1)}else n===-1&&Mn(a,this.transform);return this.meshes.push(a),this.body[e]=a,a}removeMesh(e){let n=this.body[e];n!==void 0&&(ks(n.data.multi,n),this.meshes.splice(this.meshes.indexOf(n),1),this.body[e]=void 0)}clearMeshes(){for(let e=0;e<this.meshes.length;++e){let n=this.meshes[e];ks(n.data.multi,n)}this.meshes.length=0,this.body.length=0}clearEffects(){for(let e=0;e<this.effects.length;++e){let n=this.effects[e];n.done=!0}this.effects.length=0}onRemove(){this.removeSkin(),us(this.transform)}anim(e,n,i){if(this.transform.visible&&this.animQueue.length<=2){let s=Sf.get(e),o={id:e,info:s,loop:n,dirImpactTarget:i,activeSounds:[],activeEffects:[],time:0,fract:0};this.animQueue.push(o)}}clearAnims(){for(let e=0;e<this.animQueue.length;++e)this.onAnimEnd(this.animQueue[e]);this.animQueue.length=0}onAnimEnd(e){for(let n=0;n<e.activeEffects.length;++n){let i=e.activeEffects[n];i&&(i.done=!0)}e.activeEffects.length=0;for(let n=0;n<e.activeSounds.length;++n){let i=e.activeSounds[n];i&&i.stop()}e.activeSounds.length=0}playSound(e,n){return e===0||this.inFog?!1:(Hs(e,this.transform,this.soundPrio,!1,n?this.getAudioPitch():1),!0)}onHurt(e){(e>.2||this.hurtSoundTimer.done(V.time))&&this.playSound(this.soundset[1],!0)&&this.hurtSoundTimer.reset(V.time)}onYell(){this.doesYell&&Zt(0,1)<.3&&this.playSound(this.soundset[0],!0)}onAggro(){this.playSound(this.soundset[3],!0)}onDeath(){this.hasDied=!0,this.playSound(this.soundset[2],!0),this.body[1]&&this.removeMesh(1),this.addColor(Ln.death),this.deathTimer.reset(V.time,3);let e=this.meshes.length;for(;e--;){let n=this.meshes[e];n.data.deathSize=(n.geometry.bounds.initiated?n.geometry.bounds.radius:1)*(n.scale[0]+n.scale[1]+n.scale[2])/3,Mn(n,null),aa(n.position,n.worldMatrix),c_(n.scale,n.worldMatrix),vm(n.quaternion,n.worldMatrix),n.data.deathVel=[Zt(-.5,.5),1,Zt(-.5,.5)],n.matrixAutoUpdate=!0}}tickDeath(e,n,i){this.deathTimer.done(n)?(this.clearMeshes(),this.clearEffects()):this.meshes.forEach(s=>{if(!s.visible||s.data.deathVel===void 0)return;let o=s.data.deathVel,r=s.data.deathSize;sn(s.position,s.position,o,e),dn(o,o,1-e*3);let l=i.getHeight(s.position[0],s.position[2])+r*.5;o[1]<0&&s.position[1]<l?o[1]<-1?(o[1]=Math.abs(o[1])*.7,o[0]+=Zt(-1,1)/r,o[2]+=Zt(-1,1)/r):o[1]=-.5:o[1]-=e*50,Xi(bt,o,[0,1,0]),sn(s.rotation,s.rotation,bt,-e*5),qt(s,!1)})}mountPosition(e){Mi(e,this.skin.mountPos,this.body[this.skin.mountPart].worldMatrix)}getAudioPitch(){return Math.max(.6,Math.min(1,.5/this.entity.radius))}getTopAbsolute(){return this.entity.radius*this.skeleton.height}addColor(e){this.colors.add(e),this.needsColorUpdate=!0}removeColor(e){this.colors.delete(e),this.needsColorUpdate=!0}colorUpdate(){this.needsColorUpdate=!1;for(let e=0;e<this.meshes.length;++e)this.updateMeshColor(this.meshes[e])}changeMeshBaseColor(e,n){e.data.basecolor=n,this.updateMeshColor(e)}updateMeshColor(e){let n=e.data.color;Ir(n,e.data.basecolor),this.colors.forEach(i=>{let s=i[3],o=1-s;n[0]=n[0]*o+i[0]*s,n[1]=n[1]*o+i[1]*s,n[2]=n[2]*o+i[2]*s})}addAlpha(e){this.alphas.add(e),this.updateGoalAlpha()}removeAlpha(e){this.alphas.delete(e),this.updateGoalAlpha()}updateGoalAlpha(){this.goalAlpha=1,this.alphas.forEach(e=>{this.goalAlpha=Math.min(this.goalAlpha,e)})}alphaUpdate(e){if(this.currentAlpha!==this.goalAlpha){Math.abs(this.goalAlpha-this.currentAlpha)<.1?this.currentAlpha=this.goalAlpha:(e=Math.min(e,2),this.currentAlpha<this.goalAlpha?this.currentAlpha=Math.min(this.goalAlpha,this.currentAlpha+e*.5):this.currentAlpha=Math.max(this.goalAlpha,this.currentAlpha-e*.5));for(let n=0;n<this.meshes.length;++n){let i=this.meshes[n];i.data.alpha[0]=i.data.basealpha*this.currentAlpha}}}changeMeshBaseAlpha(e,n){e.data.basealpha=n}setShoulders(e,n=1,i=!1){if(!(this.hasDied||!this.skeleton.shoulders)){if(e===!1){for(let s=8;s<=9;++s)this.removeMesh(s);for(let s=14;s<=15;++s)this.body[s]&&this.removeMesh(s)}else for(let s=0;s<=1;++s)if(!this.body[8+s]){let o=this.mesh(8+s,0,!0,1,.6);Y(o.position,s?.5:-.5,-.4+n*.4,-.05),Y(o.scale,.8*n,.5*n,.5*n),this.changeMeshBaseColor(o,e)}if(i!==!1)for(let s=0;s<=1;++s){this.body[14+s]||this.mesh(14+s,8+s,!1,7,.3);let o=this.body[14+s];Y(o.rotation,0,3.14,0),Y(o.position,s?.2:-.2,0,-.5),Y(o.scale,.35,.55,.2),this.changeMeshBaseColor(o,i)}else for(let s=14;s<=15;++s)this.body[s]&&this.removeMesh(s)}}setCape(e,n){if(!(this.hasDied||!this.skeleton.cape))if(e===!1)this.body[10]!==void 0&&this.removeMesh(10);else{if(this.body[10]===void 0){let i=this.mesh(10,0,!0,8,.7);Y(i.position,0,.2,-.55)}Y(this.body[10].scale,n,n,n),this.changeMeshBaseColor(this.body[10],e)}}setHeadgear(e){this.hasDied||!this.skeleton.helmet||(e===!1?this.body[11]!==void 0&&this.removeMesh(11):(this.body[11]===void 0&&this.mesh(11,0,!1,9,.5),this.changeMeshBaseColor(this.body[11],e)))}setGem(e,n=1){if(!(this.hasDied||!this.skeleton.helmet))if(e===!1)this.body[12]!==void 0&&this.removeMesh(12);else{if(this.body[12]===void 0){let i=this.mesh(12,0,!1,7,.5);Y(i.position,0,.4,.54),Y(i.scale,.3*n,.3*n,.08*n)}this.changeMeshBaseColor(this.body[12],e)}}setCrown(e){this.hasDied||!this.skeleton.helmet||(e===!1?this.body[13]!==void 0&&this.removeMesh(13):(this.body[13]===void 0&&(this.mesh(13,0,!1,10,.8),this.body[13].position[1]=.8),this.changeMeshBaseColor(this.body[13],e)))}watersplash(e){let n=on();st(n.position,this.entity.pos),n.position[1]=this.entity.pos[1]+this.entity.inWater+.05,qt(n),xs(e,n,this.soundPrio,!0)}};var d0=class extends u0{constructor(e){super(e),this.stickEffects=new Map,this.effects=new Set,this.visualFreeze=0,this.visualIncapacitate=0}addEffectBuff(e,n,i){if(n.logic.fx.stick&&(!(n.logic.incapacitated||n.logic.tags.has(4))||this.immuneCC.size<=0)&&!this.stickEffects.has(e)){let s=Bi(n.logic.fx.stick,this.entity.visual.transform,this.entity.id===V.playerId||n.caster===V.playerId?1:0,!1);this.stickEffects.set(e,s)}if(!this.effects.has(e))n.logic.fx.visual&&this.entity.visual.skin.id!==n.logic.fx.visual&&this.changeEntityVisual(n.logic.fx.visual),n.logic.fx.mount&&this.changeEntityMount(n.logic.fx.mount(n)),n.logic.fx.color&&this.entity.visual.addColor(n.logic.fx.color),n.logic.fx.alpha&&this.entity.visual.addAlpha(n.logic.fx.alpha),n.logic.fx.anim&&(this.entity.visual.clearAnims(),this.entity.visual.anim(n.logic.fx.anim,!0,0)),this.visualFreeze+=n.visualFreeze,this.visualIncapacitate+=n.visualIncapacitate,this.effects.add(e);else if(i&&this.stickEffects.has(e)){let s=this.stickEffects.get(e);s.loops=0,s.fractionNow=0}n.logic.fx.apply&&i&&xs(n.logic.fx.apply,this.entity.visual.transform,this.entity.id===V.playerId||n.caster===V.playerId?1:0,!1)}removeEffectBuff(e,n,i){if(this.stickEffects.has(e)){let s=this.stickEffects.get(e);this.buffs.has(e)||(s.done=!0,this.stickEffects.delete(e))}this.effects.has(e)&&(n.fx.visual&&this.entity.visual.skin.id===n.fx.visual&&this.changeEntityVisual(),n.fx.mount&&this.changeEntityMount(),n.fx.color&&this.entity.visual.removeColor(n.fx.color),n.fx.alpha&&this.entity.visual.removeAlpha(n.fx.alpha),n.fx.anim&&this.entity.visual.clearAnims(),this.visualFreeze-=i.visualFreeze,this.visualIncapacitate-=i.visualIncapacitate,this.effects.delete(e))}setBuff(e,n,i,s,o,r,l,a){let c=super.setBuff(e,n,i,s,o,r);c.data=a,c.visualFreeze=c.visualIncapacitate=0,this.immuneCC.size===0&&(c.logic.fx.frozen&&c.visualFreeze++,c.logic.fx.incapacitated&&c.visualIncapacitate++),this.entity.buffDisplayDirty=!0,this.entity.visual&&this.addEffectBuff(e,c,l)}removeBuff(e,n){let i=super.removeBuff(e,n);i&&(this.entity.buffDisplayDirty=!0,this.removeEffectBuff(e,i.logic,i),i.logic.fx.endSound!==void 0&&V.player!==void 0&&Hs(i.logic.fx.endSound,this.entity.visual.transform,this.entity.id===V.playerId||n===V.playerId?1:0,0,1))}changeEntityVisual(e){this.entity.remakeTransform(e),this.stickEffects.forEach((n,i)=>{let s=Bi(n.info.id,this.entity.visual.transform,n.priority,!1);s.loops=1,n.done=!0,this.stickEffects.set(i,s)})}changeEntityMount(e){this.entity.mount&&(this.entity.mount.onRemove(),this.entity.mount=void 0,this.entity.updateVisualPosition(0,V.time,V,!0)),e&&(this.entity.mount=new gc(this.entity),this.entity.mount.setSkin(e),this.entity.updateTransformScale(),this.entity.updateVisualPosition(0,V.time,V,!0),this.entity.updateTransformRotation(.016),this.entity.updateMountRotation(.016))}};var h0=class{constructor(e){this.id=e.id||0,this.type=e.type,this.pos=[0,0,0],this.vel=[0,0,0],this.rot=0,this.radius=0,this.size=0,this.name=e.name,this.setSize(e.size||1)}async init(e){this.name=e.name||""}preFixed(e,n,i){}tickFixed(e,n,i){}postFixed(e,n,i){}preDelta(e,n,i){}tickDelta(e,n,i){}postDelta(e,n,i){}onRemove(){}setPos(e){this.pos[0]=e[0],this.pos[1]=e[1],this.pos[2]=e[2]}setRot(e){this.rot=Da(e)}onTarget(e){return!0}setName(e){this.name=e}setSize(e){this.size=e,this.radius=e/2}hSquaredDistanceV3(e){let n=e[0]-this.pos[0],i=e[2]-this.pos[2];return n*n+i*i}distanceV2(e){return ka(Bn,e,Ia(Ws,this.pos)),xa(Bn)}distanceV3(e){return Xt(bt,e,this.pos),mi(bt)}squaredDistanceV2(e){return ka(Bn,e,Ia(Ws,this.pos)),C3(Bn)}squaredDistance(e){return Xt(bt,e,this.pos),zc(bt)}rotationToV2(e){return ka(Bn,e,Ia(Ws,this.pos)),vp(Bn,Bn),sl(Bn)}rotationToV3(e){return Xt(bt,e,this.pos),Zn(bt,bt),Ep(bt)}};var kr=class extends h0{constructor(e){super(e),this.hudPos=[0,0,0],this.netDeletion=new kt(0,0)}handleMovementData(e,n){st(this.pos,e.pos),st(this.vel,e.vel)}onRemove(){this.visual&&this.visual.onRemove()}};var g0=class{constructor(e){this.entity=e,this.skills=new Map,this.skillIdsLearned=[],this.skillIdsActive=[],this.timedCast=new kt,this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0,this.gcdEnd=0}add(e,n=0,i=0,s){let o=this.skills.get(e);return o=Object.assign(o||{},{level:s!==void 0?s:o?o.level+1:1,logic:Pt.get(e),cd:new kt(n,i-n),preGcdEnd:0}),this.skills.set(e,o),o}updateSkillsLearned(e){this.skillIdsLearned.length=0,this.skillIdsLearned.push(...e)}remove(e){this.skills.delete(e)}compileActiveSkillIds(){this.skillIdsActive.length=0,this.skills.forEach((e,n)=>{if(!e.logic.engineOnly)for(let i=0;i<e.level;++i)this.skillIdsActive.push(n)})}globalCd(e,n){this.skills.forEach(i=>{!i.logic.auto&&!i.logic.ignoreGcd&&(i.cd.end<e&&(i.cd.start=e),i.cd.end<n&&(i.preGcdEnd=i.cd.end,i.cd.end=n),i.cd.duration=i.cd.end-i.cd.start)}),this.gcdEnd=n}clearGlobalCd(){this.skills.forEach(e=>{!e.logic.auto&&!e.logic.ignoreGcd&&e.cd.end===this.gcdEnd&&(e.cd.end=e.preGcdEnd,e.cd.duration=e.preGcdEnd-e.cd.start)})}startTimedCast(e,n,i,s){this.timedCast.reset(n,s),this.timedSkill=e,this.timedTarget=i,this.entity.steer[0]=0,this.entity.steer[1]=0,this.pvpBoundModifier=Pt.get(e.id).pvpBoundsAdd}interruptTimedCast(e,n){this.timedCast.reset(0,0),this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0,n&&this.clearGlobalCd()}finishTimedCast(e){return this.interruptTimedCast(!1,!1)}onDeath(){this.interruptTimedCast(!0,!1)}clear(){}hasInstantCast(e){return this.entity.buffs.instantCast.size>0&&Array.from(this.entity.buffs.instantCast).some(n=>n.logic.instantCast.has(e))}};var gP=new Map,v0=class extends g0{constructor(e){super(e)}tick(e,n,i){if(this.isPlayer){let s=this.entity.buffs.incapacitated.size>0;this.skills.forEach((o,r)=>{let l=gP.get(r)||gP.set(r,new Map).get(r),a=new Map,c=0;if(s&&!o.logic.ignoreIncapacitated?c=9:(c=o.logic.can(this.entity,o.level,this.entity.target,!0),(c===3||c===4)&&(c=o.logic.can(this.entity,o.level,this.entity.id,!0))),c!==o.status&&(o.status=c,l.get("status")!==c&&a.set("status",c)),o.cd.done(i.smoothtime))o.cd.icondone||(o.cd.icondone=!0,l.get("cd")!==void 0&&a.set("cd",void 0),l.get("remaining")!==void 0&&a.set("remaining",void 0));else{o.cd.icondone=!1;let f=Math.round(100-o.cd.fraction(i.smoothtime)*100),u;o.cd.duration>1.5&&(u=o.cd.remaining(i.smoothtime),u<=3?u=Math.ceil(u*10)/10:u=Math.ceil(u)),l.get("cd")!==f&&a.set("cd",f),l.get("remaining")!==u&&a.set("remaining",u)}a.size>0&&Ro.update(f=>(a.forEach((u,m)=>{l.set(m,u),f[o.logic.id][m]=u}),f))})}if(this.timedSkill&&this.entity.visual){let s=this.timedSkill.fx;if(s){let o=this.entity.visual.animQueue[0],r=this.timedCast.remaining(n);if(s.animCast){let l=Sf.get(s.animCast);r-=Math.min(.3,l.duration/2)}r>0?s.animChannel&&(!o||s.animChannel!==o.id)&&(this.entity.visual.clearAnims(),this.entity.visual.anim(s.animChannel,!0,0)):s.animCast&&(!o||s.animCast!==o.id)&&(this.entity.visual.clearAnims(),this.entity.visual.anim(s.animCast,!1,0))}}}add(e,n=0,i=0,s){super.add(e,n,i,s),this.isPlayer&&(this.compileActiveSkillIds(),Ro.update(r=>(r[e]={},r)),this.skills.get(e).logic.id<100&&zo.update(r=>(r.set(e,s),r)))}remove(e){this.isPlayer&&(this.compileActiveSkillIds(),Ro.update(i=>(i[e]=void 0,i)),this.skills.get(e)&&zo.update(i=>(i.delete(e),i))),super.remove(e)}updateSkillsLearned(e){super.updateSkillsLearned(e),Lc.update(n=>{n.clear();for(let i=0;i<e.length;++i){let s=e[i];n.has(s)||n.set(s,eu(e,s))}return n})}cd(e,n,i){this.skills.get(e).cd.set(n,i)}clearSkillInfo(){zo.update(e=>(e.clear(),e)),Lc.update(e=>(e.clear(),e))}startTimedCast(e,n,i,s){super.startTimedCast(e,n,i,s),this.entity.uiFrameDirty=!0}interruptTimedCast(e,n){super.interruptTimedCast(e,n),this.entity.uiFrameDirty=!0,e&&this.entity.visual&&this.entity.visual.clearAnims()}};var _0=class extends Ya{constructor(e){super(e)}setStat(e,n){this.stat.set(e,n),this.entity.statsDirty=!0,e==20?this.entity.setPrestige(n):e==21?this.entity.setElo(n):e==6||e==7?this.entity.uiFrameDirty=!0:e==19&&this.entity.inventory&&this.entity.inventory.setSize(n)}setResource(e,n){super.setResource(e,n),this.entity.uiFrameDirty=!0}die(){super.die(),this.entity.uiFrameDirty=!0,this.entity.visual&&this.entity.visual.onDeath()}respawn(){super.respawn(),this.entity.uiFrameDirty=!0,this.entity.visual&&this.entity.remakeTransform()}refreshCombatTimer(e,n){super.refreshCombatTimer(e,n),this.entity.uiFrameDirty=!0}onCombatEnd(){super.onCombatEnd(),this.entity.uiFrameDirty=!0}};var b0=class extends kr{constructor(e){e.creature&&(e.skin=e.creature.skin,e.name=e.creature.name),super(e),this.creatureId=e.creature?e.creature.id:-1,this.stats=new _0(this),this.buffs=new d0(this),this.skills=new v0(this),this.steer=[0,0],this.speed=1,this.static=!1,this.jump=0,this.onGround=!0,this.belowGround=!1,this.inWater=0,this.groundNormal=[0,0,0],this.target=0,this.level=0,this.faction=0,this.posLock=[0,0],this.posLockRadius=0,this.aabb=gu()}setAABB(){Nd(this.aabb,this.pos,this.size,this.size,this.size)}preFixed(e,n,i){super.preFixed(e,n,i),this.buffs.tick(e,n,i),this.stats.tick(e,n),this.skills.tick(e,n,i),this.setSize((this.stats.getStat(31)||100)/100)}getStatBasedMoveSpeed(){return Math.max(Math.min(65534,this.stats.getStat(15)))}postFixed(e,n,i){this.handlePosLock()}handlePosLock(){if(this.posLockRadius>0){ka(Ws,Ia(Bn,this.pos),this.posLock);let e=xa(Ws);if(e>this.posLockRadius){let n=F3(Ws,this.posLock,kf(Ws,Ws,this.posLockRadius/e));Y(this.pos,n[0],this.pos[1],n[1])}}}hasMovementOverride(){return this.buffs.movementOverride.size>0}buffMovementOverride(e,n,i){this.hasMovementOverride()&&this.buffs.movementOverride.forEach(s=>{s.logic.movementOverride(e,n,i,this,s)})}combatRangeCheck(e,n){let i=this.pos[0]-e.pos[0],s=Math.max(0,Math.abs(this.pos[1]-e.pos[1])-this.size),o=this.pos[2]-e.pos[2];return i*i+s*s+o*o<(n+(e.size+this.size))**2}combatCylinderCheck(e,n,i){return!(this.aabb[1]>e[1]+n||this.aabb[4]<e[1]-n||Math.sqrt((e[0]-this.pos[0])**2+(e[2]-this.pos[2])**2)>i+this.radius)}tickHoles(e){let n=V.getHole(this.pos[0],this.pos[2]),i=this.pos[1]-V.getHeight(this.pos[0],this.pos[2]);return this.belowGround=n&&i<=0,n}horizontalSteer(e,n,i){if(this.stats.alive){this.rot=i;let s=vp(Bn,n);n[1]<0&&(s[1]*=.5),kf(s,s,e/20),h_(this.vel,s,i)}else this.vel[0]=0,this.vel[2]=0}setSteer(e,n){this.steer[0]=e,this.steer[1]=n}setJump(e){this.jump=e}setRot(e){super.setRot(e)}setSpeed(e){this.speed=e}setTarget(e){let n=e>0&&this.canTarget(V.getEntityById(e));return n!==!1&&n!==void 0?n.onTarget(this.id):this.target!==(this.target=0)}onTarget(e){let n=V.getEntityById(e);return n.target=this.id,super.onTarget(e)}getTargetEntity(){return V.getEntityById(this.target)}canTarget(e){return e}setFaction(e){this.faction=e}setLevel(e){this.level=e}setClass(e){this.class=e}onRemove(){this.stats.clear(),this.buffs.clearTempBuffs(),this.buffs.clearPassiveBuffs(),this.skills.clear(),super.onRemove()}hostility(e){return e.faction!==this.faction?1:0}canCombatInteract(e){return!0}canSupportInteract(e){return!0}die(e,n,i){}setPosLock(e,n,i){this.posLock[0]=~~e,this.posLock[1]=~~n,this.posLockRadius=~~i}tickWaterCollisions(e){let n=this.inWater;return this.inWater=Math.max(0,e.getWaterHeight(this.pos[0],this.pos[2])-this.pos[1]),!n&&this.inWater>0&&this.vel[1]<-3&&this.onEnterWater(),this.inWater>0}onEnterWater(){}};var os=class extends b0{constructor(e){super(e),this.uiFrameDirty=!0,this.uiRange=!0,this.buffDisplayDirty=!0,this.visualPosition=[0,0,0],this.speechTimer=new kt(0,5),this.mount=void 0,this.mountRotAdd=0,this.namePlateScale=.5,e.creature&&(e.creature.col1[0]!==0&&(e.colPrim=e.creature.col1),e.creature.col2[0]!==0&&(e.colSec=e.creature.col2)),this.skin=e.skin,this.colPrim=e.colPrim,this.colSec=e.colSec,this.interiorlightTarget=[0,0,0,0],this.interiorlightTimer=new kt(0,.5),this.conciliator=[0,0,0],this.visual=new gc(this),this.skin>0&&this.remakeTransform()}handleMovementData(e,n){let i=Rn([0,0,0],this.pos,this.conciliator),s=Xt([0,0,0],i,e.pos);zc(s)>1?(Y(this.conciliator,0,0,0),st(this.pos,e.pos)):Rn(this.conciliator,this.conciliator,s),st(this.vel,e.vel)}makeVisual(e,n,i){this.visual.setSkin(e||this.skin,n||this.colPrim,i||this.colSec)}remakeTransform(e,n,i){this.makeVisual(e,n,i),this.updateTransformScale(),this.updateTransformRotation(1),this.updateVisualPosition(0,0,V,!0)}onRemove(){super.onRemove(),this.mount!==void 0&&this.mount.onRemove()}updateVisualPosition(e,n,i,s=!1){e>0&&(sn(this.pos,this.pos,this.conciliator,-e*10),dn(this.conciliator,this.conciliator,1-e*10));let o=Kn(this.pos,this.visualPosition);(s||o>1e-5)&&(st(this.visualPosition,this.pos),this.visualPosition[1]+=this.radius,this.mount===void 0?st(this.visual.transform.position,this.visualPosition):(st(this.mount.transform.position,this.visualPosition),this.mount.transform.position[1]+=this.mount.skin.size*.5-this.radius)),this.interiorlightTimer.done(n)&&(this.interiorlightTimer.reset(n),i.getInteriorLight(this.interiorlightTarget,this.aabb));let r=Math.min(1,e),l=this.interiorlightTarget,a=this.visual.interiorlight;a[0]+=Math.sign(l[0]-a[0])*r,a[1]+=Math.sign(l[1]-a[1])*r,a[2]+=Math.sign(l[2]-a[2])*r,a[3]+=Math.sign(l[3]-a[3])*r}updateTransformScale(){pi(this.visual.transform.scale,this.size*.7),this.mount!==void 0&&pi(this.mount.transform.scale,this.mount.skin.size*.7)}updateTransformRotation(e){if(this.stats.alive&&this.buffs.visualFreeze===0){this.updateMountRotation(e);let n=ol(this.rot+this.mountRotAdd,this.visual.transform.rotation[1]);Math.abs(n)>.01&&(this.visual.transform.rotation[1]=_a(this.visual.transform.rotation[1]-n*Math.min(1,e*20),Math.PI*2))}}updateMountRotation(e){if(this.mount!==void 0){if((this.onGround||this.inWater>0)&&(this.steer[0]!==0||this.steer[1]!==0)){let n=this.steer[0]*1.5;this.steer[1]!=0&&(n*=.5*this.steer[1]),this.mountRotAdd-=(this.mountRotAdd-n)*Math.min(1,e*10)}this.mount.transform.rotation[1]=this.visual.transform.rotation[1]}else this.mountRotAdd=0}postFixed(e,n,i){super.postFixed(e,n,i),this.visual.tickFixed(e,n,i),this.mount!==void 0&&this.mount.tickFixed(e,n,i)}postDelta(e,n,i){super.postDelta(e,n,i),this.updateVisuals(e,n,i),this.updateUiParts(n)}updateVisuals(e,n,i){this.updateTransformRotation(e),this.updateTransformScale(),this.updateVisualPosition(e,n,i),this.mount!==void 0&&(this.mount.tick(e,n,i),this.mount.mountPosition(this.visual.transform.position)),this.visual.tick(e,n,i)}updateUiParts(e){let n=this.id===V.playerId,i=qn===this.id,s=en.has(this.name);if(i||s){let o=this.squaredDistance(V.player.pos)<900;o!=this.uiRange&&(this.uiFrameDirty=!0),this.uiRange=o}(this.uiFrameDirty||this.skills.timedSkill!==void 0)&&(i&&this.hydrateUnitStore(zs),n?this.hydrateUnitStore(Rs):s&&this.hydrateUnitStore(en.get(this.name).unitStore)),(this.buffDisplayDirty||n||i)&&(i&&this.hydrateBuffStore(n,Ic,le.buffcountUnitframes),n?this.hydrateBuffStore(n,ea,le.buffcountUnitframes):(this.buffDisplayDirty||i)&&s&&this.hydrateBuffStore(n,en.get(this.name).buffStore,le.buffcountParty)),this.speechText!==void 0&&this.speechTimer.done(e)&&(this.speechText=void 0)}setTarget(e){let n=this.target,i=super.setTarget(e);if(n!=this.target&&this==V.player&&i){let s=V.getEntityById(e);s?(s.hydrateUnitStore(zs,le.buffcountUnitframes),s.hydrateBuffStore(!1,Ic,le.buffcountUnitframes)):zs.update(o=>(o.visible=!1,o))}return i}hydrateUnitStore(e){e.update(n=>(n.visible=!0,n.name=this.name,n.alive=this.stats.alive,n.hp=this.stats.getResource(6),n.hpMax=this.stats.getStat(6),n.mp=this.stats.getResource(7),n.mpMax=this.stats.getStat(7),n.level=this.level,n.class=this.class,n.id=this.id,n.clan=this.clan,n.faction=this.faction,n.party=this.party,n.role=this.partyrole,n.type=this.type,n.combat=!this.stats.combatTimer.done(V.time),n.range=this.uiRange,n.rarity=this.faction===2&&(this.rarity||!1),n.timedSkill=this.skills.timedSkill,n.timedCast=this.skills.timedCast,n)),this.uiFrameDirty=!1}hydrateBuffStore(e,n,i){n.update(s=>dz(s,this.buffs,i,e)),this.buffDisplayDirty=!1}speech(e,n){this.speechText=e,this.speechStyle=n,this.speechTimer.reset(V.time)}},dz=(t,e,n,i)=>{let s=[];e.buffs.forEach((r,l)=>{r.forEach((a,c)=>{!a.logic.passive&&a.logic.icon!==void 0&&(!le.buffsHideIrrelevant||c===V.playerId||c===e.entity.id&&e.entity.faction===2||e.entity===V.player&&a.logic.type==1)&&(!a.logic.unique||s.reduce((f,u)=>f+(u.id===a.id?1:0),0)===0)&&s.push(a)})});let o=s.sort((r,l)=>l.time-r.time).sort((r,l)=>r.type-l.type).slice(0,n);if(t.length<o.length)for(;t.length<o.length;)t.push(gz());else if(t.length>o.length)for(;t.length>o.length;)vz(t.pop());return o.forEach((r,l)=>{_z(V.smoothtime,r,t[l],i)}),t},hz=0,vP=[],gz=()=>vP.pop()||{id:hz++,icon:"",type:1,time:0,duration:10,stacks:0,cancel:-1},vz=t=>{vP.push(t)},_z=(t,e,n,i)=>{e.logic.customIcon===void 0?n.icon=`/data/${e.logic.icon}.${Gn}?v=8588529`:n.icon=`/data/${e.logic.customIcon(e)}.${Gn}?v=8588529`,n.cancel=i&&e.logic.tags.has(12)?e.logic.id:-1,n.type=e.logic.type,n.time=Math.min(e.timer.duration,e.timer.passed(t)),n.duration=e.timer.duration,n.stacks=e.uniqueInstances>1?e.uniqueInstances:e.stacks};var ri=class extends os{constructor(e){super(e),this.static=!0,this.interactions=e.interactions,this.interactions.length&&this.setDialogue(this.interactions[0].text,this.interactions[0].choices)}interact(e){this.createInteraction()}createInteraction(){qs.set({title:this.name,text:this.text,choices:this.choices})}setDialogue(e,n){this.text=e,this.choices=n}};var y0=class extends ri{constructor(e){super({type:6,...e})}};var k0=class extends y0{constructor(e){super({...e,...C.npcs.blacksmith})}};var x0=class extends ri{constructor(e){super({type:2,...e})}};var to=(t,e)=>{let n=t.length-e,i="",s=e+n;for(;e<s;){let o=t[e++];if(o<128)i+=String.fromCharCode(o);else if(o>191&&o<224){let r=t[e++];i+=String.fromCharCode((o&31)<<6|r&63)}else if(o>239&&o<365){let r=t[e++],l=t[e++],a=t[e++],c=((o&7)<<18|(r&63)<<12|(l&63)<<6|a&63)-65536;i+=String.fromCharCode(55296+(c>>10)),i+=String.fromCharCode(56320+(c&1023))}else{let r=t[e++],l=t[e++];i+=String.fromCharCode((o&15)<<12|(r&63)<<6|l&63)}}return i};var w0=class extends x0{constructor(e){super({...e,...C.npcs.conjurer})}interact(e){let n=to(e,1).split("#");n[0]!==""?this.setDialogue(this.interactions[0].text,Array.from(n,i=>{let s=i.split("~");return this.interactions[0].choices[0].replace("$1",s[0])+(s[1]>0?` (Lv. ${s[1]}+)`:"")})):this.setDialogue(this.interactions[0].text,[]),super.interact(e)}};var M0=class extends kr{constructor(e){super({type:3,...e}),this.partytimeout=0,this.party=0,this.droptype="",this.tier=0,this.quality=0}partyTimeoutCheck(e){return this.party===0||e.id===this.party||e.party===this.party||V.time>this.partytimeout}canBePickedUpBy(e,n=30){return this.partyTimeoutCheck(e)&&e.stats.alive&&!e.buffs.buffs.has(128,e.id)&&e.squaredDistance(this.pos)<n}};var F0=class extends M0{constructor(e){super(e),this.visual={transform:Zs(1561,!1,!1,!0)},this.visual.transform.data.multi.needsUpdate=!1,this.setSize(.2),this.visual.transform.visible=!1,this.uiTimeout=0,this.dirty=!1,this.hasInfo=!1,this.hasPos=!1,this.hasRot=!1,this.color="misc"}postDelta(e,n,i){if(this.visual.transform.visible&&this.dirty){let s=i.getChunkFromWorld(this.pos[0],this.pos[2]);s!==void 0&&s.deserialized&&(this.pos[1]=i.getHeight(this.pos[0],this.pos[2])+Math.random()*.1+.1,this.visual.transform.rotation[1]=Math.random()*Math.PI*2,Tp(this.visual.transform.rotation,i.getNormal(this.pos[0],this.pos[2])),st(this.visual.transform.position,this.pos),this.visual.transform.data.multi.needsUpdate=!0,qt(this.visual.transform,!1),this.dirty=!1)}}setDropInfo(e,n,i,s,o){this.hasInfo=!0,this.party=s,this.partytimeout=o,this.droptype=$k[e],this.tier=n,this.quality=i,this.lootquality=i;let r,l;this.droptype=="gold"?(this.name=this.tier+"c",this.setSize(.1),r="gold",this.color="gold",this.quality=100):(r=this.droptype+this.tier,l=rn[r],l&&(this.name=hn(this.droptype,this.tier)),this.droptype!=="misc"&&this.droptype!=="rune"&&this.droptype!=="book"?(this.color=Yt(i)[1],le.itemQualityPercent&&(this.name+=` ${this.quality}%`)):(this.color=this.droptype,this.quality=100,this.droptype==="rune"&&(this.lootquality=90)));let a=l&&l.art||r;Ir(this.visual.transform.data.uvshift,ko[a]),Y(this.visual.transform.scale,ko[a][0]*20,1,ko[a][1]*20),this.visual.transform.data.shine[0]=Math.random()*6.1,this.dirty=!0,this.visual.transform.visible=!0}onRemove(){ks(this.visual.transform.data.multi,this.visual.transform),tt.shift.down&&(dc.add(this),this.uiTimeout=Math.round(V.time/5)*5+10)}};var C0=class extends os{constructor(e){super({type:7,...e}),this.static=!0,this.class=5}};var S0=class extends C0{};var A0=class extends ri{constructor(e){super({type:12,...e})}};var P0=class extends A0{constructor(e){super({...e,interactions:[]})}};var T0=class extends ri{constructor(e){super({type:4,...e})}};var E0=class extends T0{constructor(e){super({...e,...C.npcs.merchant})}};var D0=class extends os{constructor(e){super({type:1,...e}),this.groundHeight=0;let n=l1.get(e.creature.id);this.aggroMode=n.aggroMode,this.rarity=n.rarity}tickFixed(e,n,i){this.horizontalSteer(this.speed,this.steer,this.rot),super.tickFixed(e,n,i),this.tickHoles(e),this.stats.alive&&(sn(this.pos,this.pos,this.vel,e),this.groundHeight=i.raycastEnvironmentHeight(this.pos[0],this.pos[2],this.pos[1]+1,this.pos[1]-1,this.groundNormal),this.belowGround||(this.groundHeight=Math.max(this.groundHeight,i.getHeight(this.pos[0],this.pos[2])))),this.setAABB(),this.tickWaterCollisions(i),this.inWater>this.radius||(this.pos[1]-=10*e),this.pos[1]=Math.max(this.groundHeight,this.pos[1])}};var I0=class extends D0{};var V0=class extends kr{constructor(e){super({type:11,...e})}};var L0=class extends V0{constructor(e){super(e),this.meshId=0,this.scale=0,this.effects=[],this.dirty=!1,this.rot=Math.random()*3.14}postDelta(e,n,i){if(this.dirty){st(this.mesh.position,this.pos),this.mesh.rotation[1]=this.rot,pi(this.mesh.scale,this.scale),this.mesh.matrixNeedsUpdate=!0,qt(this.mesh,!0);for(let s=0;s<this.effects.length;++s){let o=this.effects[s];qt(o.transform,!0)}this.mesh.data.multi&&(this.mesh.data.multi.needsUpdate=!0),this.dirty=!1}}setNodeInfo(e,n){e!==this.meshId&&(this.meshId>0&&this.removeMesh(),this.meshId=e,this.makeMesh(),this.dirty=!0),this.scale!==n&&(this.scale=n,this.dirty=!0)}makeMesh(){let e=_s.get(this.meshId);e.geometry>0?(this.mesh=Zs(this.meshId,!0,!1,!0),ei(this.mesh.data.interiorlight,0,0,0,0)):this.mesh=on();for(let n=0;n<e.effects.length;++n){let i=e.effects[n],s=on();st(s.position,i.pos),st(s.scale,i.scale),st(s.rotation,i.rot),Mn(s,this.mesh);let o=Bi(i.id,s,0,!0);this.effects.push(o)}}removeMesh(){this.mesh!==void 0&&(this.mesh.data.multi?ks(this.mesh.data.multi,this.mesh):us(this.mesh)),this.mesh=void 0;for(let e=0;e<this.effects.length;++e)this.effects[e].done=!0;this.effects.length=0}onRemove(){this.removeMesh()}};var q0=class extends os{constructor(e){super({type:10,...e}),this.groundHeight=0}tickFixed(e,n,i){this.horizontalSteer(this.speed,this.steer,this.rot),super.tickFixed(e,n,i),this.tickHoles(e),this.stats.alive&&(sn(this.pos,this.pos,this.vel,e),this.groundHeight=i.raycastEnvironmentHeight(this.pos[0],this.pos[2],this.pos[1]+1,this.pos[1]-1,this.groundNormal)),this.setAABB(),this.tickWaterCollisions(i),this.inWater>this.radius||(this.pos[1]-=10*e),this.pos[1]=Math.max(this.groundHeight,this.pos[1])}};var R0=class extends q0{};var z0=class extends os{constructor(e){super({type:0,size:.9,...e}),this.exp=0,this.party=0,this.partyrole=0,this.prestige=0,this.prestigeRank=0,this.elo=0,this.eloRank=0,this.clan=void 0,this.clanRole=0,this.jumpLast=0}tickVelocity(e,n,i,s,o){this.inWater>this.radius?(this.onGround&&(this.vel[1]=Math.max(0,this.vel[1])),this.inWater<this.radius+.1&&(this.jump>0||this.vel[1]===0)?this.vel[1]=this.jumpLast===0&&s>0?7:0:(this.vel[1]+=s?e*8:e*-4,this.vel[1]=Math.max(Math.min(this.vel[1],4),-3)),this.horizontalSteer(o*.5,n,i)):this.onGround?(this.stats.alive&&s>0&&o>0&&(this.vel[1]=9,this.onGround=!1),this.horizontalSteer(o,n,i)):(this.vel[1]=Math.max(-60,this.vel[1]-25*e),this.stats.alive&&this.vel[0]===0&&this.vel[2]===0&&this.horizontalSteer(o*.5,n,i)),this.jumpLast=this.vel[1]<0?this.jumpLast:this.jump}tickMovement(e,n,i,s,o){this.tickVelocity(e,n,i,s,o);let r=this.tickHoles(e);this.setWorldCollAABB(this.vel[0]*e,this.vel[1]*e,this.vel[2]*e);let l=V.triangleGrid.queryAABB(this.aabb),a=[],c=[],f=[];for(let v=0;v<l.length;++v){let _=l[v],b=_[3][1];b>.6?c.push(_):b<-.6?f.push(_):a.push(_)}let u=mi(this.vel)*e,m=Math.floor(Math.max(1,u/.1)),g=e/m;for(let v=0;v<m;++v)this.tickCollisions(g,a,c,f,r);this.setAABB(),this.tickWaterCollisions(V),V.clampV3(this.pos)}setWorldCollAABB(e,n,i){let s=this.aabb,o=this.radius+.5;s[0]=this.pos[0]-Math.min(0,e)-o,s[3]=this.pos[0]+Math.max(0,e)+o,s[1]=this.pos[1]-Math.min(0,n)-o,s[4]=this.pos[1]+Math.max(0,n)+o*2,s[2]=this.pos[2]-Math.min(0,i)-o,s[5]=this.pos[2]+Math.max(0,i)+o}tickCollisions(e,n,i,s,o){let r=[...this.pos];sn(this.pos,this.pos,this.vel,e);let l=this.belowGround||o?0:V.getHeight(this.pos[0],this.pos[2]),a=V.getNormal(this.pos[0],this.pos[2]);this.tickWallCollisions(n,l,a),l=this.belowGround||o?0:V.getHeight(this.pos[0],this.pos[2]),a=V.getNormal(this.pos[0],this.pos[2]),this.tickFloorCollisions(i,l,a),this.tickCeilCollisions(s,r),this.belowGround||(this.pos[1]=Math.max(this.pos[1],V.getHeight(this.pos[0],this.pos[2])))}tickWallCollisions(e,n,i){if(i[1]<.6&&this.pos[1]<n){let c=-(ry(...this.pos,this.pos[0],n,this.pos[2],...i)+.05);this.pos[0]-=i[0]*c,this.pos[2]-=i[2]*c}let s=this.radius,o=this.radius*1.5,r=this.pos[0],l=this.pos[1]+o,a=this.pos[2];for(let c=0;c<e.length;++c){let f=e[c];if(Pp(f[0],f[1],f[2],r,l,a)){let u=oy(r,l,a,...f[0],...f[3]);if(u<s&&u>-.5){let m=u-s;this.pos[0]-=f[3][0]*m,this.pos[2]-=f[3][2]*m}}}}tickFloorCollisions(e,n,i){let o=this.vel[1]>0||this.inWater>this.radius?0:.1,r=this.radius*1.5,l=1/0,a=!1;for(let f=0;f<e.length;++f){let u=e[f];if(Pp(u[0],u[1],u[2],...this.pos)){let m=y1(...this.pos,...u[0],...u[3]);m<l&&m<o&&m>-r&&(l=m,a=!0,st(this.groundNormal,u[3]))}}let c=-(n-this.pos[1]);i[1]>.6&&this.pos[1]<n+o&&c<l&&c<o&&c>-r&&(l=c,a=!0,st(this.groundNormal,i)),a?(this.pos[1]-=l,this.onGround||(this.onGround=!0,this.onFallLanding(-this.vel[1]),this.vel[1]=Math.max(0,this.vel[1]))):(this.onGround=!1,Y(this.groundNormal,0,1,0))}tickCeilCollisions(e,n){let i=this.radius*1.5;for(let s=0;s<e.length;++s){let o=e[s],r=this.pos[0],l=this.pos[1],a=this.pos[2];if(Pp(o[0],o[1],o[2],r,l,a)){let c=y1(...this.pos,...o[0],...o[3]);c<0&&c>-i&&(this.pos[1]>=n[1]&&(this.pos[0]=n[0],this.pos[2]=n[2]),this.vel[1]=Math.min(0,this.vel[1]),this.vel[0]=0,this.vel[2]=0)}}}setExp(e){this.exp=e}setParty(e,n){this.party=e,this.partyrole=n}setPrestige(e){return e!==this.prestige?(this.prestige=e,this.prestigeRank=Qa(e),!0):!1}setElo(e){return e!==this.elo?(this.elo=e,this.eloRank=Ra(e),!0):!1}setClan(e,n=0){this.clan=e,this.clanRole=n}getNearbyPartyMembers(e){let n=[];return this.stats.alive&&n.push(this),this.party>0&&V.entities.type[0].forEach(i=>{i.party==this.party&&i!=this&&i.stats.alive&&Kn(e,i.pos)<1e3&&n.push(i)}),n}hostility(e){return(V.mode.partyBasedHostility===!0?e.party!==this.party:e.faction!==this.faction)?e.type===0?e.stats.stat.get(26)===0&&this.stats.stat.get(26)===0?0:2:1:0}canCombatInteract(e){return e.type===0?e.buffs.buffs.has(128,e.id)?!1:!V.mode.pvpprotect||this.hostility(e)<2?!0:!(this.stats.stat.get(26)===0||e.stats.stat.get(26)===0)&&Math.abs(this.stats.stat.get(26)-e.stats.stat.get(26))<=5+Math.max(this.skills.pvpBoundModifier,e.skills.pvpBoundModifier):e.type===1||e.type===10||e.type===12?e.stats.stat.get(26)>0:!0}canSupportInteract(e){return this.hostility(e)===0&&(!V.mode.pvpprotect||(e.type===0?Math.abs(this.stats.stat.get(26)-e.stats.stat.get(26))<=5:!0))}onFallLanding(e){}};var bz=[1,2,3,4],El=class extends z0{constructor(e){e.skin=0,super(e)}tickFixed(e,n,i){super.tickFixed(e,n,i),this.tickMovement(e,this.steer,this.rot,this.jump,this.speed)}setClass(e){e!==this.class&&(super.setClass(e),this.skin=bz[this.class],this.remakeTransform())}makeVisual(e,n){super.makeVisual(e,n),this.prestige>0&&this.setPrestige(this.prestige,!0),this.level>=10&&this.setLevel(this.level),this.elo>1500&&this.setElo(this.elo,!0)}setPrestige(e,n){if(super.setPrestige(e)||n){let i=Math.min(this.prestigeRank,10),s=this.prestigeRank-11;i<1?(this.visual.setCrown(!1),this.visual.setHeadgear(!1)):(this.visual.setHeadgear(s<0?Z1[Math.min(4,i-1)]:Ln.darkgold),i>5?this.visual.setCrown(Z1[i-6]):this.visual.setCrown(!1)),s<0?this.visual.setGem(!1):this.visual.setGem(Cw[s],s>0?1:.8)}}setElo(e,n){if(super.setElo(e)||n){let i=Ra(e);this.visual.setShoulders(J1[Math.min(i,1)],.65+i*.08,i>0&&J1[i])}}setLevel(e){super.setLevel(e),e>=15?this.visual.setCape(this.faction===0?Ln.vanguard:Ln.bloodlust,e>=25?1:.5):this.visual.setCape(!1)}setParty(e,n){this.uiFrameDirty=!0,this.buffDisplayDirty=!0,super.setParty(e,n)}onEnterWater(){this.visual.playSound(130,!1),this.visual.watersplash(94)}};var B0=class extends ri{constructor(e){super({type:9,...e})}};var U0=class extends B0{constructor(e){super({...e,...C.npcs.sage})}interact(e){this.interactions[0].choices[0]=this.interactions[0].choices[0].replace("$1",V.player.level*10),super.interact(e)}};var O0=class extends ri{constructor(e){super({type:5,...e})}};var $0=class extends O0{constructor(e){super({...e,...C.npcs.stash})}};var N0=class extends ri{constructor(e){super({type:8,...e})}};var j0=class extends N0{constructor(e){super({...e,...C.npcs.trader});let n=a1.get(e.creature.id);this.items=[],Af.forEach(i=>{if(i.shop===n.shop){let s=new Xs,o=ie();s.hydrate({type:i.type,tier:i.tier,stacks:i.stacks===0?void 0:i.stacks,upgrade:i.upgrade,store:o}),s.buyid=i.id,this.items.push([s,o])}})}};var W0=class{constructor(e){this.entity=e,this.slots=new Map,this.gold=0,this.medals=0,this.size=0,this.firstEmptySlot=0,this.firstEmptySlotDirty=!0,this.setSize(0)}tickFixed(e,n,i){}setSize(e){this.size=Math.min(100,e)}setGold(e){this.gold=e}setMedals(e){this.medals=e}setItem(e,n){let i=new Xs(n);return this.slots.set(e,i),e===this.firstEmptySlot&&(this.firstEmptySlotDirty=!0),i}removeItem(e){let n=this.slots.get(e);return this.slots.delete(e),(e<this.firstEmptySlot||this.firstEmptySlot===-1)&&(this.firstEmptySlot=e),n}async hydrateItems(e=!1){let n=[],i=[];if(this.slots.forEach((s,o)=>{s.dirty&&(s.dirty=!1,n.push(s.dbid),i.push(o))}),n.length){let s=await this.fetchData(n);this.compareData(s,i,0),this.postHydrate(i,e)}else e&&this.postHydrate(i,e)}hydrate(e){this.slots.has(e.slot)?this.slots.get(e.slot).hydrate(e):console.error("received hydration of unknown item")}postHydrate(e){}compareData(e,n,i){e.forEach(s=>{s.slot!==null&&(this.hydrate(s),n=n.filter(o=>o!==s.slot))}),n.forEach(s=>this.removeItem(s,i))}findFirstItemOfType(e,n){for(let i of this.slots)if(i[1].type==e&&i[1].tier==n)return i[1]}findFirstSlotOfType(e,n){let i=-1,s=0;for(let o of this.slots){let r=o[0],l=o[1];l.type==e&&l.tier==n&&r>i&&l.bound>=s&&(i=r,s=l.bound)}return i>=0?i:void 0}getFirstEmptySlot(){if(this.firstEmptySlotDirty){this.firstEmptySlotDirty=!1;for(let e=0;e<this.size;++e)if(!this.slots.has(e))return this.firstEmptySlot=e;this.firstEmptySlot=-1}return this.firstEmptySlot}findFirstUnmaxedStackableOfType(e,n){for(let i of this.slots)if(i[1].type==e&&i[1].tier==n&&i[1].stacks<50)return i[1];return-1}};var G0,H0=class extends W0{constructor(e){super(e),this.dirty=!1}tickFixed(e,n,i){super.tickFixed(e,n,i),this.dirty&&(this.hydrateItems(),this.dirty=!1)}setGold(e,n,i){super.setGold(e),nu(e,n,i,"$g"),Hi.set(e)}setMedals(e,n,i){super.setMedals(e),nu(e,n,i,"$m"),ta.set(e)}setItem(e,n,i){let s=super.setItem(e,n);s.reason=i,this.dirty=!0}removeItem(e,n){cF(super.removeItem(e),n),G0[e]!==void 0&&(G0[e].set(void 0),this.dirty=!0,this.updateInventoryCounts())}hydrate(e){e.store=G0[e.slot],super.hydrate(e)}postHydrate(e){super.postHydrate(e),this.updateInventoryCounts()}updateInventoryCounts(){let e={};this.slots.forEach(n=>{let i=n.type+n.tier;e[i]=(e[i]||0)+(n.stacks?n.stacks:1)}),ia.set(e)}async fetchData(e){let i=await(await fetch("/api/item/get",{method:"POST",body:JSON.stringify({ids:e})})).json();if(i.fail)console.error(i);else return i}setSize(e){super.setSize(e),na.update(n=>{for(let i=111;i>=0;--i)i>=101?n[i]||(n[i]=ie(void 0)):i>=this.size?n[i]&&delete n[i]:n[i]||(n[i]=ie(void 0));return G0=n,n})}};var Y0=class extends El{constructor(e){super(e),V.setPlayer(this),this.skills.isPlayer=!0,this.skills.clearSkillInfo(),this.inventory=new H0(this),this.partyInfoUpdateTimer=new kt(0,1),this.heartBeatTimer=new kt(0,1),this.secondlyUpdates=new kt(0,1),this.lastNetRot=this.rot,this.inputTicksPassed=0,this.inputTicksSinceLastPosUpdate=0,this.inputTicksSinceLastRotUpdate=0,ti[1]=.7,this.smoothZoom=0,this.areaid=-1}makeVisual(e,n){super.makeVisual(e,n),this.visual.soundPrio=1}tickFixed(e,n,i){super.tickFixed(e,n,i),this.inventory.tickFixed(e,n,i)}preFixed(e,n,i){super.preFixed(e,n,i),(tt.turnright.down||tt.turnleft.down)&&(ti[0]=Da(ti[0]+le.mouseSensitivity*3*e*((tt.turnleft.down?1:0)-(tt.turnright.down?1:0)))),this.handleInput(e,n,i)}postFixed(e,n,i){super.postFixed(e,n,i)}handleInput(e,n,i){this.inputTicksPassed++;let s=!1,o=!1,r=!1,l=!1,a=!1,c=!1,f=this.steer[0],u=this.steer[1],m=this.jump,g=this.rot,v=f,_=u,b=m,y=g;this.hasMovementOverride()?(this.buffMovementOverride(e,n,i),f=this.steer[0],u=this.steer[1],m=this.jump,g=this.rot):(f=(tt.left.down?1:0)+(tt.right.down?-1:0),u=(tt.fwd.down||tt.lmb.down&&tt.rmb.down?1:0)+(tt.back.down?-1:0),m=tt.jump.down?1:0,g=le.lockedcamera&&tt.lmb.down||tt.rmb.down||tt.turnleft.down||tt.turnright.down?ti[0]:this.rot),(f!==v||u!==_)&&(o=f!==v,r=u!==_,this.setSteer(f,u)),m!==b&&(this.setJump(m),a=!0);let k=ol(g,this.lastNetRot);this.inputTicksSinceLastRotUpdate++,g!==y&&this.setRot(g),g!==this.lastNetRot&&((this.steer[0]!==0||this.steer[1]!==0)&&Math.abs(k)>.1||this.inputTicksSinceLastRotUpdate>10||r||o||Math.abs(k)>.2)&&(this.lastNetRot=y,s=!0);let S=this.getStatBasedMoveSpeed();S!=this.speed&&(this.setSpeed(S),l=!0),this.inputTicksSinceLastPosUpdate++,this.inputTicksSinceLastPosUpdate>600?c=!0:this.inputTicksSinceLastPosUpdate>40?(this.steer[0]!==0||this.steer[1]!==0)&&(c=!0):this.inputTicksSinceLastPosUpdate>20&&(this.steer[0]!==0||this.steer[1]!==0)&&(s||o||r)&&(c=!0),(s||o||r||l||a||c)&&this.sendInput(s,o,r,l,a,c)}sendInput(e,n,i,s,o,r){let l={uint8s:[],int8s:[],uint16s:[],doubles:[]};l.uint8s.push(Math.min(254,this.inputTicksPassed)),o&&l.uint8s.push(this.jump),n&&!i?l.int8s.push(this.steer[0]):(n||i)&&l.int8s.push(this.steer[0],this.steer[1]),e&&(this.inputTicksSinceLastRotUpdate=0,l.doubles.push(this.rot)),r&&(this.inputTicksSinceLastPosUpdate=0,l.doubles.push(this.pos[0],this.pos[1],this.pos[2])),s&&l.uint16s.push(this.speed),Si(Ft.clientPlayerInput.packData(l)),this.inputTicksPassed=0}updateCharPanel(){(le.charpanelOpen||le.skillmenuOpen)&&this.statsDirty&&(this.statsDirty=!1,Oo.update(e=>(Array.from(this.stats.stat).forEach(i=>e[i[0]]=i[1]),e)))}updatePartyInfo(e){if(this.partyInfoUpdateTimer.done(e)){this.partyInfoUpdateTimer.reset(e);let n=this.getNearbyPartyMembers(this.pos),i=x1(n.length);Qn.update(s=>(s.role=this.partyrole,s.nearby=n.length,s.exprate=Math.round(i*100),s.itemfind=Math.min(10*100,Math.round(i*100+hy(n)*100)),s))}}handleCamera(e){if(st(Gt.position,this.mount?this.mount.transform.position:this.visual.transform.position),Gt.position[1]+=1.25,Gt.rotation[0]=ti[1],!tt.lmb.down&&!tt.rmb.down&&(this.steer[0]!==0||this.steer[1]!==0)){let u=ol(this.rot,ti[0])*Math.min(1,e*2);u!==0&&(Math.abs(u)>.03*e?(u=u>0?Math.max(u,Math.min(1,.6*e)):Math.min(u,Math.max(1,-.6*e)),ti[0]-=u):ti[0]=this.rot)}Gt.rotation[1]=ti[0],qt(Gt,!1);let n=le.cameraZoom;Y(gt.transform.position,0,0,-n),fa(gt,!1);let i=[0,0,0],s=[0,0,0],o=[0,0,0];lo(gt,o,[0,0]),Xt(i,o,Gt.position),bm(s,i);let r=mi(i),l=[0,0,0],a=[0,0,0],c=[[-1,1],[1,1],[-1,-1],[1,-1]];for(let u=0;u<c.length;++u){let m=c[u];lo(gt,l,m),Xt(a,l,o),Rn(l,Gt.position,a);let g=V.triangleGrid.queryRay(l,i,s),v=1;for(let _=0;_<g.length;++_){let b=g[_];v=Math.min(v,Va(b[0],b[1],b[2],l,i,!0))}v<1&&(n=Math.min(r*v,n))}if(this.smoothZoom=Math.max(0,Math.min(this.smoothZoom+e*20,n)),Y(gt.transform.position,0,0,-this.smoothZoom),Mh(gt),!this.belowGround){lo(gt,l,[0,-1]);let u=V.getHeight(l[0],l[2]);u>l[1]&&(Gt.position[1]+=u-l[1])}qt(Gt,!1),fa(gt,!1),lo(gt,l,[0,-1]);let f=V.getWaterHeight(l[0],l[2]);if(f>l[1]){let u=f-l[1];$d(u);let m=l[1]-f;if(lo(gt,l,[0,1]),f<l[1]){let g=l[1]-f;Math.abs(g)>Math.abs(m)?(Gt.position[1]-=m,$d(0)):Gt.position[1]-=g,qt(Gt,!1),fa(gt,!1)}}else $d(0)}handleAreaCheck(e){let n=e.getAreaId(this.pos[0],this.pos[2]);if(n!==this.areaid){this.areaid=n;let i=Cf.get(n);i!==void 0&&Cr.set({type:"area",text:i.name,time:5e3})}}handleHeartBeat(e){let n=this.stats.getResource(6)/(this.stats.getStat(6)*.5);n>0&&n<1&&(n=(Math.max(0,Math.min(1,n))+.5)/1.5,Mt(103),this.heartBeatTimer.reset(e,n))}postDelta(e,n,i){this.updateCharPanel(),this.updatePartyInfo(n),super.postDelta(e,n,i),this.handleCamera(e),this.secondlyUpdates.done(n)&&this.handleAreaCheck(i),this.heartBeatTimer.done(n)&&this.handleHeartBeat(n)}updateTransformRotation(e){this.stats.alive&&this.buffs.visualFreeze===0&&(this.updateMountRotation(e),this.buffs.movementOverride.size||!tt.rmb.down&&!(le.lockedcamera&&tt.lmb.down)?this.visual.transform.rotation[1]=this.rot:this.visual.transform.rotation[1]=ti[0],this.visual.transform.rotation[1]+=this.mountRotAdd)}setLevel(e){super.setLevel(e),this.uiFrameDirty=!0}onRemove(){super.onRemove(),V.removePlayer(this)}setExp(e){super.setExp(e),om.update(n=>(n.current=e,n.max=Jo(this.level),n))}setClan(e,n=0){super.setClan(e,n),dm.set(e)}setRot(e,n=!1){super.setRot(e),n&&(ti[0]=e)}};var F2=new Map([[6,k0],[2,w0],[7,S0],[4,E0],[0,El],[9,U0],[12,P0],[5,$0],[8,j0],[3,F0],[1,I0],[10,R0],[11,L0]]),_P=(t,e)=>t==0?e==V.playerId?Y0:El:F2.get(t);var C2=[-0,-1,-0],X0=class{constructor(){this.id="",this.idInt=0,this.file="",this.bounds=0,this.chunkAmount=0,this.entities={array:[],map:new Map,type:{}},F2.forEach((e,n)=>this.entities.type[n]=[]),this.mode=dp.normal,this.chunksMap=new Map,this.chunksArray=[],this.finishedLoadingChunks=new Set,this.time=this.accum=-0,this.timestep=1/60,this.tickId=0,this.data=void 0,this.triangleGrid=new c0}load(e,n){this.id=e,this.file=n,c1.forEach(i=>{i.name===n&&(this.data=i,this.idInt=i.id)}),this.parse(!1)}tickIdToTimestamp(e){return e*this.timestep}setTimeFromTickId(e){return this.tickId=e,this.time=this.tickIdToTimestamp(e),this.tickId}createEntity(e,n,i){return i=i||{},i.id=n,new(_P(e,n))(i)}addEntity(e){if(e===void 0||e.type===void 0){console.log("Error: tried adding an entity of unknown type to the world");return}if(this.entities.array.length>=32766){console.log("Error: tried addint entity but we already are at the maximum");return}if(this.isEntityInWorld(e)||this.isEntityIdTaken(e.id)){console.log("Error: Entity in world or entity id taken"),console.log(e),console.log(this.getEntityById(e.id));return}return this.entities.array.push(e),this.entities.map.set(e.id,e),this.entities.type[e.type].push(e),e}removeEntity(e){if(e===void 0)return!1;this.entities.map.delete(e.id);let n=this.entities.array.indexOf(e);return n>-1&&this.entities.array.splice(n,1),n=this.entities.type[e.type].indexOf(e),n>-1&&this.entities.type[e.type].splice(n,1),e.onRemove(),e}isEntityIdTaken(e){return this.entities.map.has(e)}isEntityIdAllowed(e){return!0}isEntityInWorld(e){return this.entities.array.indexOf(e)>=0}entity(e){return this.entities.map.get(e)}getEntityById(e){return this.entities.map.get(e)}getPlayerByName(e){let n=e.toLowerCase();return this.entities.type[0].find(i=>i.name&&i.name.toLowerCase()===n)}getMonsterByName(e){let n=e.toLowerCase();return this.entities.array.find(i=>i.name&&i.name.toLowerCase()===n)}setMode(){this.mode=dp[this.id]||dp.normal}getHeight(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-0:ws(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getHole(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-0:_u(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getWaterHeight(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-1:bu(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getAreaId(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-0:Gv(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getEnvironmentId(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-0:Hv(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getNormal(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);if(!i||!i.deserialized)Y(C2,0,0,0);else{e=e>=this.bounds?63:e%64,n=n>=this.bounds?63:n%64,e/=2.6666666666666665,n/=2.6666666666666665;let s=Math.floor(e)*2+24*Math.floor(n)*2;e%1+n%1>1&&s++,s*=3,Y(C2,i.normals[s],i.normals[s+1],i.normals[s+2])}return C2}clampV3(e){return e[0]=vt(e[0],0,this.bounds),e[1]=vt(e[1],0,2e3),e[2]=vt(e[2],0,this.bounds),e}getChunkFromWorld(e,n){return e=vt(e,0,this.bounds),n=vt(n,0,this.bounds),e=Math.min(Math.floor(e/64),this.chunkAmount-1),n=Math.min(Math.floor(n/64),this.chunkAmount-1),this.chunksMap.get(e+n*this.chunkAmount)}getChunk(e,n){if(!(e<0||n<0||e>=this.chunkAmount||n>=this.chunkAmount))return this.chunksMap.get(e+n*this.chunkAmount)}parse(e){this.setMode(),e||(this.chunkAmount=this.data.chunkAmount,this.bounds=64*this.chunkAmount,this.setGrids(),this.finishedLoadingChunks.clear(),this.createChunks())}setGrids(){this.triangleGrid.setDimensions(this.bounds,this.bounds,this.bounds,15,15,15)}rebuildTriangleOctree(){this.triangleGrid.clear(),this.chunksMap.forEach(e=>{for(let n=0;n<e.props.length;++n){let i=e.props[n];i.loaded=!1,i.loadGeometry(this,e)}})}triangleRaycastClosest(e,n,i,s,o,r){f0(oi,e,n,i,s,o,r);let l=1,a=this.triangleGrid.queryRay(oi.origin,oi.dir,oi.invDir);for(let c=0;c<a.length;++c){let f=a[c];l=Math.min(l,Va(f[0],f[1],f[2],oi.origin,oi.dir,!1))}return l}triangleRaycastAny(e,n,i,s,o,r,l){f0(oi,e,n,i,s,o,r);let a=this.triangleGrid.queryRay(oi.origin,oi.dir,oi.invDir);for(let c=0;c<a.length;++c){let f=a[c];if(Va(f[0],f[1],f[2],oi.origin,oi.dir,l)<1)return!0}return!1}raycastEnvironmentClosest(e,n,i,s,o,r){let l=this.getHeight(e,i)>n,a=this.triangleRaycastClosest(e,n,i,s,o,r);a<1&&(s*=a,o*=a,r*=a);let c=0,f=0,u=.1;if(l)f=1;else for(;c<100&&f<1;){let m=f+u,g=e+s*m,v=n+o*m,_=i+r*m,b=this.getHole(e,i)?0:this.getHeight(g,_),y=v-b;y<0?y>-.05?(f+=u,c=100):u*=.5:f+=u,c++}return Math.min(f,a,1)}raycastEnvironmentAny(e,n,i,s,o,r,l){let a=Math.sqrt(s*s+o*o+r*r),c=3/a,f=s*c,u=o*c,m=r*c,g=e,v=n+l,_=i,b=Math.floor(a/3),y=0;for(;y<b;)if(++y,g+=f,v+=u,_+=m,this.getHeight(g,_)>v)return!0;return this.triangleRaycastAny(e,n,i,s,o,r,!0)}raycastEnvironmentHeight(e,n,i,s,o){let l=this.getHole(e,n)?0:this.getHeight(e,n),a=0;i>l&&(o!==void 0&&st(o,this.getNormal(e,n)),a=l);let c=i-s;Ks[0]=Ks[3]=e,Ks[5]=Ks[2]=n,Ks[4]=i,Ks[1]=s;let f=this.triangleGrid.queryAABB(Ks);if(f.length>0){let u=1/0;f0(oi,e,i,n,0,-c,0);for(let m=0;m<f.length;++m){let g=f[m],v=Va(g[0],g[1],g[2],oi.origin,oi.dir,!1);if(v<u){u=v;let _=i-v*c;_>a&&(a=_,o!==void 0&&st(o,g[3]))}}}return a}addChunk(e){this.chunksMap.set(e.id,e),this.chunksArray.push(e)}removeChunk(e){this.chunksMap.delete(e.id),this.chunksArray.splice(this.chunksArray.indexOf(e),1)}};var bP=(t,e,n="")=>{Ec.update(i=>(i.push({text:t,icon:e,css:n}),i))};var yz={2:"On cooldown.",3:"Can only be cast on enemy.",4:"Can only be cast on ally.",5:"Not enough mana.",6:"Out of range.",10:"Target is dead.",7:"Can't do that during movement.",8:"Can't cast while busy.",9:"You are incapacitated.",11:"Can't do that in combat.",12:"Can't cast this right now.",13:"Level difference is too big.",14:"Target is not in line of sight."},kP=new Map;kP.set(16,t=>{if(jt("system",`You have learned ${C.items.book[t[0]].name} Lv. ${t[1]}`,!0),Mt(89),tn(24,100),t[1]===0&&Pt.get(t[0]).autoSkillbar){let e=le.skillbarsettings[V.player.name].findIndex(n=>n.id===-1);e>=0&&wi[e].update(n=>(n.id=t[0],n))}}).set(15,t=>{V.player.skills.add(t[0],_i(t[2]),_i(t[3]),t[1])}).set(17,t=>{V.player.skills.remove(t[0])}).set(18,t=>{V.player.skills.updateSkillsLearned(t)}).set(19,t=>{qc.set(to(t,0))}).set(1,t=>{Cr.set({type:"error",text:yz[t[0]]})}).set(20,t=>{V.player.setExp(t[1]),le.chat[0]&&jt("exp",`Gained ${t[0]} experience. ${V.player.exp}/${Jo(V.player.level)}`,!0),jg(t[0])}).set(21,t=>{V.player.setExp(t[1]),jt("error",`Lost ${t[0]} experience. ${V.player.exp}/${Jo(V.player.level)}`,!0)}).set(22,t=>{V.player.setExp(t[0])}).set(45,t=>{let e=V.entity(t[1]);Mt(104),e&&_A(st([0,0,0],e.visualPosition),t[0]),le.chat[11]&&jt("fame",`Gained $fm${t[0]} fame ${e?"from "+e.name:""}`,!0)}).set(46,t=>{le.chat[11]&&jt("fame",`Lost $fm${t[0]} fame.`,!0)}).set(47,t=>{Mt(104),le.chat[11]&&jt("fame",`Gained $fm${t[0]} salary from the war.`,!0)}).set(48,t=>{Mt(105),le.chat[11]&&jt("fame",`War: Gained $fm${t[0]} spoils of war (Fight ${t[1]>0?"Victory!":"Loss!"}).`,!0)}).set(49,t=>{Mt(105),le.chat[11]&&jt("fame",`Obelisk: Captured obelisk for $fm${t[0]} and $m${t[2]}.`,!0),V.player.inventory.setMedals(t[1],t[2],1)}).set(50,t=>{Bs.set(),Us.set(!1),t[0]===1&&jt("system","War: You have left the war due to inactivity.",!0)}).set(23,t=>{let e=V.getEntityById(t[0]);e&&e.interact(t)}).set(24,t=>{qs.set(void 0)}).set(25,t=>{jt("system",to(t,0),!0)}).set(26,t=>{jt("error",to(t,0),!0)}).set(52,t=>{let e=to(t,1);ya(C.ui.party.summon,C.ui.party.onSummon.replace("$1",e),[{text:C.ui.accept,nocombat:!0,remaining:20,fun:()=>{xt("summonaccept",e)}},{text:C.ui.decline,fun:()=>{}}])}).set(27,t=>{let e=to(t,1);ya(C.ui.party.invite,C.ui.party.onInvite.replace("$1",e),[{text:C.ui.accept,fun:()=>{xt("partyaccept",t[0]+"")}},{text:C.ui.decline,fun:()=>{xt("partydecline",t[0]+"")}}])}).set(29,t=>{V.player.inventory.setItem(t[0],t[1],t[2])}).set(30,t=>{V.player.inventory.removeItem(t[0],t[1])}).set(31,t=>{V.player.inventory.setGold(t[0],t[1],t[2])}).set(32,t=>{V.player.inventory.setMedals(t[0],t[1],t[2])}).set(33,t=>{qo.set(t[0]),nu(t[0],t[1],12,"$sp")}).set(34,t=>{rm.set(t[0]==0?void 0:t[0]-1)}).set(51,t=>{lm.set(t[0]==0?void 0:t[0]-1)}).set(35,t=>{as.set(t[0]),t[0]&&Mt(106)}).set(36,t=>{fm.set(t.pop()),yP(t,sa)}).set(37,t=>{Sr.update(e=>!e),jt("inv",C.ui.merchant.auctioncancel,!0)}).set(38,t=>{yP(t.slice(2),um),t[0]&&Mt(107),Vi.set({gold:t[1]})}).set(39,t=>{Vi.set({gold:t[0]})}).set(40,t=>{Vi.set(!1)}).set(41,t=>{Yi.set(!0),Mt(108),tn(22,100)}).set(42,t=>{Yi.set(!1)}).set(43,t=>{Os.set(!0)}).set(44,t=>{Os.set(!1)}).set(54,t=>{let e=V.entity(t[0]);e!==void 0&&(e.party=1)}).set(55,t=>{window.open("/leaderboards?mode=1&kill="+t[0],"_blank")}).set(56,t=>{ud()}).set(53,t=>{let e=t[0];e<1e3&&e>0&&Cr.set({type:"error",timer:500,text:e}),e<=5&&e>0?Mt(109):e===0?Mt(110):e===1e3?Mt(111):e===2e3&&Mt(112)});var yP=(t,e)=>{e.update(n=>(n.length=0,t.forEach(i=>{n.push(new Xs(i))}),n))},xP=(t,e)=>{V.player&&kP.get(t)(e)},wP=new Map;wP.set(0,(t,e,n)=>{}).set(1,(t,e,n)=>{V.removeEntity(t)}).set(2,(t,e,n)=>{e[1]>0&&e[1]!==t.target&&t.visual&&t.type!==0&&t.visual.onAggro(),t===V.player&&ng(e[1])}).set(3,(t,e,n)=>{for(let i=1;i<e.length;i+=2)t.stats.setResource(e[i],e[i+1])}).set(6,(t,e,n)=>{for(let i=1;i<e.length;i+=2)t.stats.setResource(e[i],e[i+1])}).set(4,(t,e,n)=>{for(let i=1;i<e.length;i+=2)t.stats.setStat(e[i],e[i+1])}).set(5,(t,e,n)=>{if(t==V.player&&(tn(6,100),t.skills.cd(e[1],V.time,_i(e[2])),e[5]>0&&t.skills.globalCd(_i(e[4]),_i(e[5]))),!n&&t.visual&&!t.visual.inFog){let s=Pt.get(e[1]);(!s.castLen||!t.visual.currentAnim)&&s.fx.animCast&&t.visual.anim(s.fx.animCast),t.visual.onYell()}}).set(22,(t,e,n)=>{t.skills.startTimedCast(Pt.get(e[1]),_i(e[2]),e[3],_i(e[4])),e[5]>0&&t.skills.globalCd(_i(e[2]),_i(e[5]))}).set(23,(t,e,n)=>{t.skills.interruptTimedCast(!0,e[1]===1)}).set(24,(t,e,n)=>{t.skills.finishTimedCast(_i(e[1]))}).set(7,(t,e,n)=>{let i=e[1],s=e[2],o=V.getEntityById(e[3]),r=e[4],l=e[5],a=e[6],c=e[7];o!==void 0&&le.dpsmeterMode===0&&cd(o,i,s);let f=t===V.player,u=o===V.player;f?le.showIncomingDamage&&d2([-.3,-.3,.5],i,l,a,!0,0):u&&d2(t.visualPosition,i,l,a,!1,2),l>0&&t.stats.changeResource(6,-i),c>0&&(t.stats.refreshCombatTimer(V.time,c),o&&o.stats.refreshCombatTimer(V.time,c));let m=Pt.get(s);if(!n&&l>0&&t.visual&&!t.visual.inFog){let g=r>0&&_r.has(r)?_r.get(r).effect.transform:o&&o.visual&&o.visual.transform,v=t.visual.transform;o&&o.visual&&m.fx.animImpact&&o.visual.anim(m.fx.animImpact,!1,t.id),l!==1?(t.visual.onHurt(i/t.stats.getStat(6),l),g&&S2(m,g,v,t.radius,u?1:0)):g&&(m.fx.effectDirImpact||m.fx.animImpact)&&FP(13,g,v,t.radius,u?1:0)}}).set(8,(t,e,n)=>{let i=V.getEntityById(e[3]);i!==void 0&&le.dpsmeterMode===1&&cd(i,e[1],e[2]),i&&e[5]>0&&i.stats.refreshCombatTimer(V.time,e[5]);let s=t===V.player,o=i===V.player;s?le.showIncomingHeal&&h2([.3,-.3,.5],e[1],e[4],!0,0):o&&h2(t.visualPosition,e[1],e[4],!1,2),t.stats.changeResource(6,e[1]);let r=Pt.get(e[2]);!n&&i&&i.visual&&t.visual&&!t.visual.inFog&&S2(r,i.visual.transform,t.visual.transform,t.radius,s||o?1:0)}).set(9,(t,e,n)=>{t.stats.changeResource(7,e[1]);let i=V.getEntityById(e[3]),s=t===V.player;s&&le.showIncomingHeal&&vA([.35,-.2,.5],e[1],e[4],!0,0);let o=Pt.get(e[2]);!n&&i&&i.visual&&t.visual&&!t.visual.inFog&&!i.visual.inFog&&S2(o,i.visual.transform,t.visual.transform,t.radius,s?1:0)}).set(10,(t,e,n)=>{e[1]==0?t.stats.alive&&(t.stats.die(),t==V.player?ya(C.ui.death.death,C.ui.death.deathmsg,[{text:C.ui.death.respawn,blockedTime:Math.max(0,Math.ceil(e[2]-V.time)+1),fun:()=>{xt("respawn","")}}]):V.player&&t.id==qn&&tn(7,100)):t.stats.alive||t.stats.respawn()}).set(11,(t,e,n)=>{t.setFaction(e[1])}).set(14,(t,e,n)=>{t.setLevel(e[1])}).set(16,(t,e,n)=>{t.setClass(e[1])}).set(12,(t,e,n)=>{t.setName(to(e,1))}).set(13,(t,e,n)=>{t.setClan(e.length>2?to(e,2):void 0,e[1])}).set(15,(t,e,n)=>{if(t.setLevel(e[1]),le.chat[6]){let i=`${t==V.player?"You":kz(e[0])} leveled up to ${e[1]}!`;jt("lvlup",i),t==V.player&&(tn(16,100),Pt.forEach(s=>{s.class===V.player.class&&s.minlevel===e[1]&&(tn(19,100),bP(`<span class=textprimary><b class=textgreen>${C.items.book[s.id].name}</b><br>Skill book available at the Trader!</span>`,`skills/${s.id}.${Gn}`,"border primary"))}))}t.visual&&!t.visual.inFog&&xs(26,t.visual.transform,t==V.player?1:0,!1)}).set(17,(t,e,n)=>{t.buffs.setBuff(e[1],e[2],e[3],_i(e[4]),_i(e[5]),e[6],e[7],e.length>8?e.slice(8):void 0)}).set(19,(t,e,n)=>{e[2]===V.playerId&&gA(t.visualPosition,2,!1)}).set(18,(t,e,n)=>{t.buffs.removeBuff(e[1],e[2])}).set(20,(t,e,n)=>{let i=Pt.get(e[1]),s=new kt(V.time,_i(e[4])-V.time+.2);nS(e[0],e[2],i,e[3],s)}).set(21,(t,e,n)=>{let i=Pt.get(e[1]),s=e[2],o=_i(e[3])-V.time,r=new kt(V.time,o),l=4,a=e.length-l,c=a>6?2+(a-6)/4:2,f=[],u=[];for(let m=l;m<l+c*3;m+=3)f.push([id(e[m],6400),id(e[m+1],6400),id(e[m+2],6400)]);if(c>2)for(let m=l+c*3;m<e.length;++m)u.push(e[m]/65535);iS(t.id,f,u,i,s,r)}).set(25,(t,e,n)=>{t.setParty(e[1],e[2])}).set(26,(t,e,n)=>{t.hasInfo===!1&&t.setDropInfo(e[1],e[2],e[3],e[4],e[5])}).set(27,(t,e,n)=>{t.setNodeInfo(e[1],e[2],e[3])}).set(28,(t,e,n)=>{t.setPosLock(e[1],e[2],e[3])});var MP=(t,e,n)=>{let i=V.getEntityById(e[0]);i===void 0||wP.get(t)(i,e,n)},kz=t=>{let e=V.getEntityById(t);return`${t>0?e?e.name:"unknown":"nobody"}`},FP=(t,e,n,i,s)=>{let o=xs(t,on(),s,!0);wm(o.transform,n,e,i),qt(o.transform,!1)},S2=(t,e,n,i,s)=>{if(t.fx.effectDirImpact&&FP(t.fx.effectDirImpact,e,n,i,s),t.fx.effectImpact){let o=xs(t.fx.effectImpact,on(),s,!0);st(o.transform.position,n.position),qt(o.transform,!1)}t.fx.effectTarget&&xs(t.fx.effectTarget,n,s,!1)};var xz=[qs,as,Vi,Os,Yi],wz=[Kl,sa,so],Mz=[Rs,zs],CP=()=>{Mz.forEach(t=>t.update(e=>(e.visible=!1,e))),Qn.update(t=>(t.membercount=0,t.role=0,le.partyinfo=t,t)),xz.forEach(t=>t.set()),wz.forEach(t=>t.set([]))};var Q0=class extends X0{constructor(){super(),this.smoothtime=0,this.state=0,this.playerId=0,this.removePlayer(),this.netTimeoutTimer=new kt,this.chunkCache=[],Un("close",()=>{this.onDisconnect()}),this.netData=[],Un(Ft.serverEntityDelta.header,e=>{this.netData.push(Ft.serverEntityDelta.decode(e))}),Un(Ft.ping.header,e=>{k3(Ft.ping.decode(e))}),Un(Ft.serverChangeWorld.header,e=>{Lr.set(Ft.serverChangeWorld.decode(e).world)}),Un(Ft.serverQueue.header,e=>{this.setState(1,"Queue Position: "+Ft.serverQueue.decode(e).pos)})}setState(e,n=""){this.state===2&&e===4&&PA(this),this.state=e,xi.set(e!==4?n:!1)}handleEntityCreation(e){for(let n=0,i=e.log.length;n<i;++n){let s=e.log[n];s.type===0&&(this.isEntityIdTaken(s.data[0])||this.addEntity(this.createEntity(s.data[1],s.data[0],{creature:r1.get(s.data[2])})))}}handleEntityInput(e){for(let n=0;n<e.inputs.length;++n){let i=e.inputs[n],s=this.entity(i.id);s!==void 0&&(M3(s.steer,i.steer),s.setRot(i.rot,!0),s.setJump(i.jump),s.setSpeed(i.speed))}}handleEntityMovements(e){for(let n=0;n<e.movements.length;++n){let i=e.movements[n],s=this.entity(i.id);if(s!==void 0){let o=e.inputs[n];s.handleMovementData(i,o)}}}handleEntityLog(e){for(let i=0,s=e.log.length;i<s;++i)MP(e.log[i].type,e.log[i].data,!1)}handlePersonalLog(e){for(let n=0,i=e.logPersonal.length;n<i;++n)xP(e.logPersonal[n].type,e.logPersonal[n].data)}pollNetData(e){let n=this.netData[0];if(n!==void 0)return Math.abs(n.tickId-e)>1&&(e=this.setTimeFromTickId(n.tickId)),n.tickId<=e?(this.netData.shift(),n):void 0}tickDelta(e,n){let i=this.time+n;for(let s=this.entities.array.length-1;s>=0;--s){let o=this.entities.array[s];o.preDelta(e,i,this),o.tickDelta(e,i,this),o.postDelta(e,i,this)}}tickFixed(e,n){let i=this.pollNetData(n);if(i!==void 0&&(this.handleEntityCreation(i),this.handleEntityInput(i),this.handleEntityLog(i),this.handlePersonalLog(i),this.handleEntityMovements(i)),this.state>2)for(let s=this.entities.array.length-1;s>=0;--s){let o=this.entities.array[s],r=this.getChunkFromWorld(o.pos[0],o.pos[2]);r!==void 0&&r.state>=5&&(o.preFixed(e,this.time,this,1),o.tickFixed(e,this.time,this,1),o.postFixed(e,this.time,this,1))}this.handleNetTimeouts()}tick(e){for(this.netData.length>5&&(this.accum+=(this.netData.length-5)*this.timestep),e=Math.min(e,1),this.accum+=e;this.accum>this.timestep;)this.accum-=this.timestep,this.setTimeFromTickId(this.tickId+1),this.tickFixed(this.timestep,this.tickId);this.setSmoothTime(e),this.state>2?(this.tickDelta(e,this.accum),y3()):this.player&&st(Gt.position,this.player.pos),this.player&&this.manageChunks(e)}handleNetTimeouts(){if(this.player&&(this.netTimeoutTimer.done(this.time)||this.time<this.netTimeoutTimer.start)){this.netTimeoutTimer.reset(this.time-.5,1);for(let e=this.entities.array.length-1;e>=0;e--){let n=this.entities.array[e];n!==this.player&&(Kn(n.pos,this.player.pos)<14400?n.netDeletion.reset(this.time,2):n.netDeletion.end>0&&n.netDeletion.done(this.time)&&(this.removeEntity(n),n.id===this.player.target&&this.player.setTarget(0)))}}}removeEntity(e){let n=super.removeEntity(e);return n&&this.state>2&&Xh(e),n}load(e,n,i){this.destroy(),super.load(e,n),this.playerId=i,this.setState(2,"Loading World")}parse(e){super.parse(e),pA(this,!e)}onDisconnect(){gg(),this.netData.length=0,this.setState(0,"Loading World")}destroy(){this.setState(0,"Loading World");for(let e=0;e<this.chunksArray.length;e++){let n=this.chunksArray[e];this.returnCachedChunk(n),m2(n)}this.chunksMap.clear(),this.chunksArray.length=0;for(let e=this.entities.array.length-1;e>=0;e--)this.removeEntity(this.entities.array[e]);this.data=void 0,this.bounds=1,this.triangleGrid.clear(),dA(this),TA(this)}setPlayer(e){this.player=e,Vc.set(!0),CP()}removePlayer(e){this.player===e&&(this.player=void 0,this.playerId=0,Vc.set(!1),Bs.set(),Us.set(!1))}setSmoothTime(e){let n=this.smoothtime-this.time;Math.abs(n)>1?this.smoothtime=this.time:n>.05?this.smoothtime+=e*.5:n<-.05?this.smoothtime+=e*2:this.smoothtime+=e}getInteriorLight(e,n){let i=this.triangleGrid.queryAABB(n);for(let s=0;s<i.length;++s)if(i[s].length>4){Ir(e,i[s][4]);return}ei(e,0,0,0,0)}createChunks(){}createCachedChunk(e,n,i){if(this.chunkCache.length){let s=this.chunkCache.pop();return f2(s,e,n,i,this.chunkAmount),s}else{let s=KS();return f2(s,e,n,i,this.chunkAmount),s}}returnCachedChunk(e){this.chunkCache.push(e)}manageChunks(e){GC(e);let n=Math.min(Math.max(0,Ev),this.chunkAmount-1),i=Math.min(Math.max(0,Dv),this.chunkAmount-1),s=Math.min(Math.max(0,Iv),this.chunkAmount-1),o=Math.min(Math.max(0,Vv),this.chunkAmount-1),r=[];for(let u=n;u<=i;++u)for(let m=s;m<=o;++m){let g=this.chunkAmount*m+u,v=(u-Pv)**2+(m-Tv)**2;r.push({x:u,z:m,id:g,priority:v})}r.sort((u,m)=>u.priority-m.priority);let l=0,a=!1,c=0;for(;l<r.length;){let u=r[l];if(c>10)break;if(this.chunksMap.has(u.id))this.chunksMap.get(u.id).state<3&&(u.priority<9&&(a=!0),c++);else{let m=this.createCachedChunk(u.id,u.x,u.z);this.addChunk(m),m.state=1,u.priority<9&&(a=!0),c++}++l}let f=[];for(let u=0;u<this.chunksArray.length;++u){let m=this.chunksArray[u];qv&&(m.x+5<n||m.z+5<s||m.x-5>i||m.z-5>o?f.push(m):u2(m)),tA(m,this)}for(let u=f.length-1;u>=0;u--){let m=f[u];this.returnCachedChunk(m),this.removeChunk(m),m2(m)}a!==(this.state!==4)&&this.setState(a?3:4,"Loading World")}};window.onload=async()=>{console.log("Hordes 0.50.8588 Live"),await u1();let t=await fetch("data/game/game.bin?v=8588529");e1(va.gamedata.decode(new Uint8Array(await t.arrayBuffer()))),fy(),aA(),FA(),new XS({target:document.querySelector("body")}),_3(RA,zA),u3(new Q0({})),x2(!0),AP()};var SP=0,AP=()=>{let t=_f(),e=(t-(SP||1e3/60))/1e3;SP=t,BA(e,t),requestAnimationFrame(AP)};})();
