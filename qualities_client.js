(()=>{var vT=Object.defineProperty;var Kn=(t,e)=>{for(var n in e)vT(t,n,{get:e[n],enumerable:!0})};function ae(){}var Er=t=>t;function Ql(t,e){for(let n in e)t[n]=e[n];return t}function w1(t){return t()}function sm(){return Object.create(null)}function rt(t){t.forEach(w1)}function Oo(t){return typeof t=="function"}function Be(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}var nm;function at(t,e){return t===e?!0:(nm||(nm=document.createElement("a")),nm.href=e,t===nm.href)}function yn(t,e){return t!=t?e==e:t!==e}function l_(t){return Object.keys(t).length===0}function fo(t,...e){if(t==null){for(let s of e)s(void 0);return ae}let n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function ie(t,e,n){t.$$.on_destroy.push(fo(e,n))}function Zl(t,e,n,s){if(t){let o=a_(t,e,n,s);return t[0](o)}}function a_(t,e,n,s){return t[1]&&s?Ql(n.ctx.slice(),t[1](s(e))):n.ctx}function Jl(t,e,n,s){if(t[2]&&s){let o=t[2](s(n));if(e.dirty===void 0)return o;if(typeof o=="object"){let i=[],r=Math.max(e.dirty.length,o.length);for(let l=0;l<r;l+=1)i[l]=e.dirty[l]|o[l];return i}return e.dirty|o}return e.dirty}function Kl(t,e,n,s,o,i){if(o){let r=a_(e,n,s,i);t.p(r,o)}}function ea(t){if(t.ctx.length>32){let e=[],n=t.ctx.length/32;for(let s=0;s<n;s++)e[s]=-1;return e}return-1}function zi(t){return t??""}function Xe(t,e,n){return t.set(n),e}var c_=typeof window<"u",om=c_?()=>window.performance.now():()=>Date.now(),Vc=c_?t=>requestAnimationFrame(t):ae;var ta=new Set;function f_(t){ta.forEach(e=>{e.c(t)||(ta.delete(e),e.f())}),ta.size!==0&&Vc(f_)}function im(t){let e;return ta.size===0&&Vc(f_),{promise:new Promise(n=>{ta.add(e={c:t,f:n})}),abort(){ta.delete(e)}}}var Lc=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var rm=class t{_listeners="WeakMap"in Lc?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,n){return this._listeners.set(e,n),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(e=>{for(let n of e)t.entries.set(n.target,n),this._listeners.get(n.target)?.(n)}))}};rm.entries="WeakMap"in Lc?new WeakMap:void 0;var u_=!1;function m_(){u_=!0}function p_(){u_=!1}function d(t,e){t.appendChild(e)}function M1(t){if(!t)return document;let e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function d_(t){let e=h("style");return e.textContent="/* empty */",bT(M1(t),e),e.sheet}function bT(t,e){return d(t.head||t,e),e.sheet}function w(t,e,n){t.insertBefore(e,n||null)}function x(t){t.parentNode&&t.parentNode.removeChild(t)}function st(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function yT(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function T(t){return document.createTextNode(t)}function Ne(){return T(" ")}function de(){return T("")}function H(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function h_(t){return function(e){e.target===this&&t.call(this,e)}}function p(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Gt(t){return t===""?null:+t}function g_(t){return Array.from(t.childNodes)}function G(t,e){e=""+e,t.data!==e&&(t.data=e)}function je(t,e){t.value=e??""}function Le(t,e,n,s){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,s?"important":"")}function Mn(t,e,n){for(let s=0;s<t.options.length;s+=1){let o=t.options[s];if(o.__value===e){o.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Fs(t){let e=t.querySelector(":checked");return e&&e.__value}function Bi(t,e,n){t.classList.toggle(e,!!n)}function qc(t,e,{bubbles:n=!1,cancelable:s=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:s})}var lm=class{is_svg=!1;e=void 0;n=void 0;t=void 0;a=void 0;constructor(e=!1){this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,n,s=null){this.e||(this.is_svg?this.e=yT(n.nodeName):this.e=h(n.nodeType===11?"TEMPLATE":n.nodeName),this.t=n.tagName!=="TEMPLATE"?n:n.content,this.c(e)),this.i(s)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)w(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(x)}};function v_(t){let e={};return t.childNodes.forEach(n=>{e[n.slot||"default"]=!0}),e}var am=new Map,cm=0;function kT(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function xT(t,e){let n={stylesheet:d_(e),rules:{}};return am.set(t,n),n}function Rc(t,e,n,s,o,i,r,l=0){let a=16.666/s,c=`{
`;for(let b=0;b<=1;b+=a){let k=e+(n-e)*i(b);c+=b*100+`%{${r(k,1-k)}}
`}let f=c+`100% {${r(n,1-n)}}
}`,u=`__svelte_${kT(f)}_${l}`,m=M1(t),{stylesheet:g,rules:v}=am.get(m)||xT(m,t);v[u]||(v[u]=!0,g.insertRule(`@keyframes ${u} ${f}`,g.cssRules.length));let _=t.style.animation||"";return t.style.animation=`${_?`${_}, `:""}${u} ${s}ms linear ${o}ms 1 both`,cm+=1,u}function fm(t,e){let n=(t.style.animation||"").split(", "),s=n.filter(e?i=>i.indexOf(e)<0:i=>i.indexOf("__svelte")===-1),o=n.length-s.length;o&&(t.style.animation=s.join(", "),cm-=o,cm||wT())}function wT(){Vc(()=>{cm||(am.forEach(t=>{let{ownerNode:e}=t.stylesheet;e&&x(e)}),am.clear())})}var $i;function ai(t){$i=t}function na(){if(!$i)throw new Error("Function called outside component initialization");return $i}function F1(t){na().$$.before_update.push(t)}function Fn(t){na().$$.on_mount.push(t)}function zc(t){na().$$.after_update.push(t)}function Tn(t){na().$$.on_destroy.push(t)}function ci(){let t=na();return(e,n,{cancelable:s=!1}={})=>{let o=t.$$.callbacks[e];if(o){let i=qc(e,n,{cancelable:s});return o.slice().forEach(r=>{r.call(t,i)}),!i.defaultPrevented}return!0}}function fi(t,e){let n=t.$$.callbacks[e.type];n&&n.slice().forEach(s=>s.call(this,e))}var Ir=[];var qt=[],oa=[],S1=[],__=Promise.resolve(),P1=!1;function A1(){P1||(P1=!0,__.then(um))}function T1(){return A1(),__}function bn(t){oa.push(t)}function uo(t){S1.push(t)}var C1=new Set,sa=0;function um(){if(sa!==0)return;let t=$i;do{try{for(;sa<Ir.length;){let e=Ir[sa];sa++,ai(e),MT(e.$$)}}catch(e){throw Ir.length=0,sa=0,e}for(ai(null),Ir.length=0,sa=0;qt.length;)qt.pop()();for(let e=0;e<oa.length;e+=1){let n=oa[e];C1.has(n)||(C1.add(n),n())}oa.length=0}while(Ir.length);for(;S1.length;)S1.pop()();P1=!1,C1.clear(),ai(t)}function MT(t){if(t.fragment!==null){t.update(),rt(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(bn)}}function b_(t){let e=[],n=[];oa.forEach(s=>t.indexOf(s)===-1?e.push(s):n.push(s)),n.forEach(s=>s()),oa=e}var Bc;function y_(){return Bc||(Bc=Promise.resolve(),Bc.then(()=>{Bc=null})),Bc}function $c(t,e,n){t.dispatchEvent(qc(`${e?"intro":"outro"}${n}`))}var mm=new Set,No;function Me(){No={r:0,c:[],p:No}}function Fe(){No.r||rt(No.c),No=No.p}function S(t,e){t&&t.i&&(mm.delete(t),t.i(e))}function E(t,e,n,s){if(t&&t.o){if(mm.has(t))return;mm.add(t),No.c.push(()=>{mm.delete(t),s&&(n&&t.d(1),s())}),t.o(e)}else s&&s()}var k_={duration:0};function x_(t,e,n){let s={direction:"out"},o=e(t,n,s),i=!0,r,l=No;l.r+=1;let a;function c(){let{delay:f=0,duration:u=300,easing:m=Er,tick:g=ae,css:v}=o||k_;v&&(r=Rc(t,1,0,u,f,m,v));let _=om()+f,b=_+u;bn(()=>$c(t,!1,"start")),"inert"in t&&(a=t.inert,t.inert=!0),im(k=>{if(i){if(k>=b)return g(0,1),$c(t,!1,"end"),--l.r||rt(l.c),!1;if(k>=_){let y=m((k-_)/u);g(1-y,y)}}return i})}return Oo(o)?y_().then(()=>{o=o(s),c()}):c(),{end(f){f&&"inert"in t&&(t.inert=a),f&&o.tick&&o.tick(1,0),i&&(r&&fm(t,r),i=!1)}}}function E1(t,e,n,s){let i=e(t,n,{direction:"both"}),r=s?0:1,l=null,a=null,c=null,f;function u(){c&&fm(t,c)}function m(v,_){let b=v.b-r;return _*=Math.abs(b),{a:r,b:v.b,d:b,duration:_,start:v.start,end:v.start+_,group:v.group}}function g(v){let{delay:_=0,duration:b=300,easing:k=Er,tick:y=ae,css:F}=i||k_,A={start:om()+_,b:v};v||(A.group=No,No.r+=1),"inert"in t&&(v?f!==void 0&&(t.inert=f):(f=t.inert,t.inert=!0)),l||a?a=A:(F&&(u(),c=Rc(t,r,v,b,_,k,F)),v&&y(0,1),l=m(A,b),bn(()=>$c(t,v,"start")),im(C=>{if(a&&C>a.start&&(l=m(a,b),a=null,$c(t,l.b,"start"),F&&(u(),c=Rc(t,r,l.b,l.duration,0,k,i.css))),l){if(C>=l.end)y(r=l.b,1-r),$c(t,l.b,"end"),a||(l.b?u():--l.group.r||rt(l.group.c)),l=null;else if(C>=l.start){let M=C-l.start;r=l.a+l.d*k(M/l.duration),y(r,1-r)}}return!!(l||a)}))}return{run(v){Oo(i)?y_().then(()=>{i=i({direction:v?"in":"out"}),g(v)}):g(v)},end(){u(),l=a=null}}}function me(t){return t?.length!==void 0?t:Array.from(t)}function w_(t,e){t.d(1),e.delete(t.key)}function Hn(t,e){E(t,1,1,()=>{e.delete(t.key)})}function En(t,e,n,s,o,i,r,l,a,c,f,u){let m=t.length,g=i.length,v=m,_={};for(;v--;)_[t[v].key]=v;let b=[],k=new Map,y=new Map,F=[];for(v=g;v--;){let V=u(o,i,v),$=n(V),D=r.get($);D?s&&F.push(()=>D.p(V,e)):(D=c($,V),D.c()),k.set($,b[v]=D),$ in _&&y.set($,Math.abs(v-_[$]))}let A=new Set,C=new Set;function M(V){S(V,1),V.m(l,f),r.set(V.key,V),f=V.first,g--}for(;m&&g;){let V=b[g-1],$=t[m-1],D=V.key,z=$.key;V===$?(f=V.first,m--,g--):k.has(z)?!r.has(D)||A.has(D)?M(V):C.has(z)?m--:y.get(D)>y.get(z)?(C.add(D),M(V)):(A.add(z),m--):(a($,r),m--)}for(;m--;){let V=t[m];k.has(V.key)||a(V,r)}for(;g;)M(b[g-1]);return rt(F),b}function pm(t,e){let n={},s={},o={$$scope:1},i=t.length;for(;i--;){let r=t[i],l=e[i];if(l){for(let a in r)a in l||(s[a]=1);for(let a in l)o[a]||(n[a]=l[a],o[a]=1);t[i]=l}else for(let a in r)o[a]=1}for(let r in s)r in n||(n[r]=void 0);return n}function dm(t){return typeof t=="object"&&t!==null?t:{}}var FT=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],CT=new Set([...FT]);function mo(t,e,n){let s=t.$$.props[e];s!==void 0&&(t.$$.bound[s]=n,n(t.$$.ctx[s]))}function J(t){t&&t.c()}function X(t,e,n){let{fragment:s,after_update:o}=t.$$;s&&s.m(e,n),bn(()=>{let i=t.$$.on_mount.map(w1).filter(Oo);t.$$.on_destroy?t.$$.on_destroy.push(...i):rt(i),t.$$.on_mount=[]}),o.forEach(bn)}function Q(t,e){let n=t.$$;n.fragment!==null&&(b_(n.after_update),rt(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function PT(t,e){t.$$.dirty[0]===-1&&(Ir.push(t),A1(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Pe(t,e,n,s,o,i,r=null,l=[-1]){let a=$i;ai(t);let c=t.$$={fragment:null,ctx:[],props:i,update:ae,not_equal:o,bound:sm(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:sm(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};r&&r(c.root);let f=!1;if(c.ctx=n?n(t,e.props||{},(u,m,...g)=>{let v=g.length?g[0]:m;return c.ctx&&o(c.ctx[u],c.ctx[u]=v)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](v),f&&PT(t,u)),m}):[],c.update(),f=!0,rt(c.before_update),c.fragment=s?s(c.ctx):!1,e.target){if(e.hydrate){m_();let u=g_(e.target);c.fragment&&c.fragment.l(u),u.forEach(x)}else c.fragment&&c.fragment.c();e.intro&&S(t.$$.fragment),X(t,e.target,e.anchor),p_(),um()}ai(a)}var AT;typeof HTMLElement=="function"&&(AT=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(t,e,n){super(),this.$$ctor=t,this.$$s=e,n&&this.attachShadow({mode:"open"})}addEventListener(t,e,n){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let s=this.$$c.$on(t,e);this.$$l_u.set(e,s)}super.addEventListener(t,e,n)}removeEventListener(t,e,n){if(super.removeEventListener(t,e,n),this.$$c){let s=this.$$l_u.get(e);s&&(s(),this.$$l_u.delete(e))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(o){return()=>{let i;return{c:function(){i=h("slot"),o!=="default"&&p(i,"name",o)},m:function(a,c){w(a,i,c)},d:function(a){a&&x(i)}}}};if(await Promise.resolve(),!this.$$cn)return;let e={},n=v_(this);for(let o of this.$$s)o in n&&(e[o]=[t(o)]);for(let o of this.attributes){let i=this.$$g_p(o.name);i in this.$$d||(this.$$d[i]=I1(i,o.value,this.$$p_d,"toProp"))}for(let o in this.$$p_d)!(o in this.$$d)&&this[o]!==void 0&&(this.$$d[o]=this[o],delete this[o]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});let s=()=>{this.$$r=!0;for(let o in this.$$p_d)if(this.$$d[o]=this.$$c.$$.ctx[this.$$c.$$.props[o]],this.$$p_d[o].reflect){let i=I1(o,this.$$d[o],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[o].attribute||o):this.setAttribute(this.$$p_d[o].attribute||o,i)}this.$$r=!1};this.$$c.$$.after_update.push(s),s();for(let o in this.$$l)for(let i of this.$$l[o]){let r=this.$$c.$on(o,i);this.$$l_u.set(i,r)}this.$$l={}}}attributeChangedCallback(t,e,n){this.$$r||(t=this.$$g_p(t),this.$$d[t]=I1(t,n,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{this.$$cn||(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function I1(t,e,n,s){let o=n[t]?.type;if(e=o==="Boolean"&&typeof e!="boolean"?e!=null:e,!s||!n[t])return e;if(s==="toAttribute")switch(o){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(o){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var Ce=class{$$=void 0;$$set=void 0;$destroy(){Q(this,1),this.$destroy=ae}$on(e,n){if(!Oo(n))return ae;let s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{let o=s.indexOf(n);o!==-1&&s.splice(o,1)}}$set(e){this.$$set&&!l_(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var M_="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(M_);var ia=[];function te(t,e=ae){let n,s=new Set;function o(l){if(Be(t,l)&&(t=l,n)){let a=!ia.length;for(let c of s)c[1](),ia.push(c,t);if(a){for(let c=0;c<ia.length;c+=2)ia[c][0](ia[c+1]);ia.length=0}}}function i(l){o(l(t))}function r(l,a=ae){let c=[l,a];return s.add(c),s.size===1&&(n=e(o,i)||ae),l(t),()=>{s.delete(c),s.size===0&&n&&(n(),n=null)}}return{set:o,update:i,subscribe:r}}var Uc=te([]),es=te({role:0,nearby:0,exprate:1,itemfind:1,queues:[],membercount:0}),ra=te({parties:[],filterActivity:-1,showFull:!0,showAuto:!0}),Xs=te({flashing:!1,message:"",activity:0,listed:!1,applications:[]}),la=te([]),dn=te(),ui=te([]),Dr=te({}),jo=te(),hm=te(!1),F_=te(),C_=te(!1),Cs=te("Loading World"),Oc=te([]),qs=te(""),Wo=te({}),Go=te({}),Nc=te([]),aa=te([]),In=te(),gm=te("auto"),Qs=te(0),ca=te(0),Ui=te(0),fa=te([]),ua=te({}),Oi=te({}),vm=te({current:0,max:1}),_m=te(),bm=te(),jc=te(!1),ym=te(0),km=te([0,0]),mi=te(),Ho=te(),Yo=te(!1),Wc=te(new Map),Ni=te(new Map),Gc=te(),ji=te(),po=te(),ma=te([]),ho=te(),xm=te(0),Vr=te(!1),Hc=te(!1),Rs=te(),wm=te({self:[],other:[],nonOrAcc:[],all:[]}),Zs=te(),Xo=te(),Wi=te(),pa=te(),Gi=te({}),Yc=te({}),Mm=te({}),Fm=te({}),Cm=te(),da=te(),Ss=[],Lr=te(),pi=te(!1);function TT(t){let e;return{c(){e=h("div"),e.innerHTML='<div class="bounce1 svelte-twvoek"></div><div class="bounce2 svelte-twvoek"></div><div class="bounce3 svelte-twvoek"></div>',p(e,"class","spinner svelte-twvoek")},m(n,s){w(n,e,s)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}var D1=class extends Ce{constructor(e){super(),Pe(this,e,null,TT,yn,{})}},S_=D1;function Sm(t,{delay:e=0,duration:n=400,easing:s=Er}={}){let o=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:s,css:i=>`opacity: ${i*o}`}}function P_(t){let e,n,s,o,i,r;return n=new S_({}),{c(){e=h("div"),J(n.$$.fragment),s=h("h2"),o=T(t[0]),i=h("small"),i.innerHTML='<img alt="Hordes.io" class="svgicon" src="/data/ui/icon.svg?v=8685122"/> 0.51.8685 Live',Le(s,"margin-top","100px"),p(i,"class","version textgrey textcenter svelte-aoht7k"),p(e,"class","l-ui container svelte-aoht7k")},m(l,a){w(l,e,a),X(n,e,null),d(e,s),d(s,o),d(e,i),r=!0},p(l,a){(!r||a&1)&&G(o,l[0])},i(l){r||(S(n.$$.fragment,l),r=!0)},o(l){E(n.$$.fragment,l),r=!1},d(l){l&&x(e),Q(n)}}}function ET(t){let e,n,s=t[0]&&P_(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[0]?s?(s.p(o,i),i&1&&S(s,1)):(s=P_(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function IT(t,e,n){let{active:s}=e;return t.$$set=o=>{"active"in o&&n(0,s=o.active)},[s]}var V1=class extends Ce{constructor(e){super(),Pe(this,e,IT,ET,Be,{active:0})}},A_=V1;function go(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function T_(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function L1(t,e){let n=e[0],s=e[1],o=e[2],i=e[3],r=e[4],l=e[5],a=e[6],c=e[7],f=e[8],u=e[9],m=e[10],g=e[11],v=e[12],_=e[13],b=e[14],k=e[15],y=n*l-s*r,F=n*a-o*r,A=n*c-i*r,C=s*a-o*l,M=s*c-i*l,V=o*c-i*a,$=f*_-u*v,D=f*b-m*v,z=f*k-g*v,q=u*b-m*_,L=u*k-g*_,O=m*k-g*b,j=y*O-F*L+A*q+C*z-M*D+V*$;return j?(j=1/j,t[0]=(l*O-a*L+c*q)*j,t[1]=(o*L-s*O-i*q)*j,t[2]=(_*V-b*M+k*C)*j,t[3]=(m*M-u*V-g*C)*j,t[4]=(a*z-r*O-c*D)*j,t[5]=(n*O-o*z+i*D)*j,t[6]=(b*A-v*V-k*F)*j,t[7]=(f*V-m*A+g*F)*j,t[8]=(r*L-l*z+c*$)*j,t[9]=(s*z-n*L-i*$)*j,t[10]=(v*M-_*A+k*y)*j,t[11]=(u*A-f*M-g*y)*j,t[12]=(l*D-r*q-a*$)*j,t[13]=(n*q-s*D+o*$)*j,t[14]=(_*F-v*C-b*y)*j,t[15]=(f*C-u*F+m*y)*j,t):null}function Pm(t,e,n){let s=e[0],o=e[1],i=e[2],r=e[3],l=e[4],a=e[5],c=e[6],f=e[7],u=e[8],m=e[9],g=e[10],v=e[11],_=e[12],b=e[13],k=e[14],y=e[15],F=n[0],A=n[1],C=n[2],M=n[3];return t[0]=F*s+A*l+C*u+M*_,t[1]=F*o+A*a+C*m+M*b,t[2]=F*i+A*c+C*g+M*k,t[3]=F*r+A*f+C*v+M*y,F=n[4],A=n[5],C=n[6],M=n[7],t[4]=F*s+A*l+C*u+M*_,t[5]=F*o+A*a+C*m+M*b,t[6]=F*i+A*c+C*g+M*k,t[7]=F*r+A*f+C*v+M*y,F=n[8],A=n[9],C=n[10],M=n[11],t[8]=F*s+A*l+C*u+M*_,t[9]=F*o+A*a+C*m+M*b,t[10]=F*i+A*c+C*g+M*k,t[11]=F*r+A*f+C*v+M*y,F=n[12],A=n[13],C=n[14],M=n[15],t[12]=F*s+A*l+C*u+M*_,t[13]=F*o+A*a+C*m+M*b,t[14]=F*i+A*c+C*g+M*k,t[15]=F*r+A*f+C*v+M*y,t}function ga(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function E_(t,e){let n=e[0],s=e[1],o=e[2],i=e[4],r=e[5],l=e[6],a=e[8],c=e[9],f=e[10];return t[0]=Math.sqrt(n*n+s*s+o*o),t[1]=Math.sqrt(i*i+r*r+l*l),t[2]=Math.sqrt(a*a+c*c+f*f),t}function I_(t){let e=t[0],n=t[1],s=t[2],o=t[4],i=t[5],r=t[6],l=t[8],a=t[9],c=t[10],f=e*e+n*n+s*s,u=o*o+i*i+r*r,m=l*l+a*a+c*c;return Math.sqrt(Math.max(f,u,m))}function Am(t,e){let n=e[0]+e[5]+e[10],s=0;return n>0?(s=Math.sqrt(n+1)*2,t[3]=.25*s,t[0]=(e[6]-e[9])/s,t[1]=(e[8]-e[2])/s,t[2]=(e[1]-e[4])/s):e[0]>e[5]&&e[0]>e[10]?(s=Math.sqrt(1+e[0]-e[5]-e[10])*2,t[3]=(e[6]-e[9])/s,t[0]=.25*s,t[1]=(e[1]+e[4])/s,t[2]=(e[8]+e[2])/s):e[5]>e[10]?(s=Math.sqrt(1+e[5]-e[0]-e[10])*2,t[3]=(e[8]-e[2])/s,t[0]=(e[1]+e[4])/s,t[1]=.25*s,t[2]=(e[6]+e[9])/s):(s=Math.sqrt(1+e[10]-e[0]-e[5])*2,t[3]=(e[1]-e[4])/s,t[0]=(e[8]+e[2])/s,t[1]=(e[6]+e[9])/s,t[2]=.25*s),t}function Tm(t,e,n,s){let o=e[0],i=e[1],r=e[2],l=e[3],a=o+o,c=i+i,f=r+r,u=o*a,m=o*c,g=o*f,v=i*c,_=i*f,b=r*f,k=l*a,y=l*c,F=l*f,A=s[0],C=s[1],M=s[2];return t[0]=(1-(v+b))*A,t[1]=(m+F)*A,t[2]=(g-y)*A,t[3]=0,t[4]=(m-F)*C,t[5]=(1-(u+b))*C,t[6]=(_+k)*C,t[7]=0,t[8]=(g+y)*M,t[9]=(_-k)*M,t[10]=(1-(u+v))*M,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function D_(t,e,n,s,o){let i=1/Math.tan(e/2),r=1/(s-o);return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(o+s)*r,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*s*r,t[15]=0,t}function V_(t,e,n,s,o,i,r){let l=1/(e-n),a=1/(s-o),c=1/(i-r);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*l,t[13]=(o+s)*a,t[14]=(r+i)*c,t[15]=1,t}function q1(t,e,n,s){let o=e[0],i=e[1],r=e[2],l=s[0],a=s[1],c=s[2],f=o-n[0],u=i-n[1],m=r-n[2],g=f*f+u*u+m*m;g>0&&(g=1/Math.sqrt(g),f*=g,u*=g,m*=g);let v=a*m-c*u,_=c*f-l*m,b=l*u-a*f;return g=v*v+_*_+b*b,g>0&&(g=1/Math.sqrt(g),v*=g,_*=g,b*=g),t[0]=v,t[1]=_,t[2]=b,t[3]=0,t[4]=u*b-m*_,t[5]=m*v-f*b,t[6]=f*_-u*v,t[7]=0,t[8]=f,t[9]=u,t[10]=m,t[11]=0,t[12]=o,t[13]=i,t[14]=r,t[15]=1,t}function L_(t,e){return t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0),t}function ds(t){let e=t[0],n=t[1],s=t[2];return Math.sqrt(e*e+n*n+s*s)}function ot(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Y(t,e,n,s){return t[0]=e,t[1]=n,t[2]=s,t}function hs(t,e){return t[0]=e,t[1]=e,t[2]=e,t}function Bn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function ns(t,e,n,s){return t[0]+=e,t[1]+=n,t[2]+=s,t}function Zt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function gn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function sn(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t}function Rr(t,e){let n=e[0]-t[0],s=e[1]-t[1],o=e[2]-t[2];return Math.sqrt(n*n+s*s+o*o)}function ss(t,e){let n=e[0]-t[0],s=e[1]-t[1],o=e[2]-t[2];return n*n+s*s+o*o}function Xc(t){let e=t[0],n=t[1],s=t[2];return e*e+n*n+s*s}function Em(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function ts(t,e){let n=e[0],s=e[1],o=e[2],i=n*n+s*s+o*o;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function hn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Js(t,e,n){let s=e[0],o=e[1],i=e[2],r=n[0],l=n[1],a=n[2];return t[0]=o*a-i*l,t[1]=i*r-s*a,t[2]=s*l-o*r,t}function va(t,e,n,s){let o=e[0],i=e[1],r=e[2];return t[0]=o+s*(n[0]-o),t[1]=i+s*(n[1]-i),t[2]=r+s*(n[2]-r),t}function Ps(t,e,n){let s=e[0],o=e[1],i=e[2],r=n[3]*s+n[7]*o+n[11]*i+n[15];return r=r||1,t[0]=(n[0]*s+n[4]*o+n[8]*i+n[12])/r,t[1]=(n[1]*s+n[5]*o+n[9]*i+n[13])/r,t[2]=(n[2]*s+n[6]*o+n[10]*i+n[14])/r,t}function zr(t,e,n,s,o){return t[0]=o[0]*e+o[4]*n+o[8]*s+o[12],t[1]=o[1]*e+o[5]*n+o[9]*s+o[13],t[2]=o[2]*e+o[6]*n+o[10]*s+o[14],t}function Im(t,e,n,s,o){return t[0]=o[0]*e+o[4]*n+o[8]*s,t[1]=o[1]*e+o[5]*n+o[9]*s,t[2]=o[2]*e+o[6]*n+o[10]*s,t}function R1(t,e,n){let s=e[0],o=e[1],i=e[2],r=n[0],l=n[1],a=n[2],c=n[3],f=l*i-a*o,u=a*s-r*i,m=r*o-l*s,g=l*m-a*u,v=a*f-r*m,_=r*u-l*f,b=c*2;return f*=b,u*=b,m*=b,g*=2,v*=2,_*=2,t[0]=s+f+g,t[1]=o+u+v,t[2]=i+m+_,t}var HU=function(){let t=[0,0,0],e=[0,0,0];return function(n,s){ot(t,n),ot(e,s),ts(t,t),ts(e,e);let o=hn(t,e);return o>1?0:o<-1?Math.PI:Math.acos(o)}}();function q_(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Br(t,e,n){let s=Math.sin(n),o=Math.cos(n);return t[0]=e[2]*s+e[0]*o,t[1]=e[1],t[2]=e[2]*o-e[0]*s,t}function R_(t,e,n){let s=Math.sin(n),o=Math.cos(n);return t[0]=e[1]*s+e[0]*o,t[2]=e[1]*o-e[0]*s,t}function $r(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function os(t,e,n,s,o){return t[0]=e,t[1]=n,t[2]=s,t[3]=o,t}function z_(t,e){let n=e[0],s=e[1],o=e[2],i=e[3],r=n*n+s*s+o*o+i*i;return r>0&&(r=1/Math.sqrt(r)),t[0]=n*r,t[1]=s*r,t[2]=o*r,t[3]=i*r,t}function VT(t,e,n){n=n*.5;let s=Math.sin(n);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(n),t}function z1(t,e,n,s){let o=e[0],i=e[1],r=e[2],l=e[3],a=n[0],c=n[1],f=n[2],u=n[3],m,g,v,_,b;return g=o*a+i*c+r*f+l*u,g<0&&(g=-g,a=-a,c=-c,f=-f,u=-u),1-g>1e-6?(m=Math.acos(g),v=Math.sin(m),_=Math.sin((1-s)*m)/v,b=Math.sin(s*m)/v):(_=1-s,b=s),t[0]=_*o+b*a,t[1]=_*i+b*c,t[2]=_*r+b*f,t[3]=_*l+b*u,t}function LT(t,e){let n=e[0]+e[4]+e[8],s;if(n>0)s=Math.sqrt(n+1),t[3]=.5*s,s=.5/s,t[0]=(e[5]-e[7])*s,t[1]=(e[6]-e[2])*s,t[2]=(e[1]-e[3])*s;else{let o=0;e[4]>e[0]&&(o=1),e[8]>e[o*3+o]&&(o=2);let i=(o+1)%3,r=(o+2)%3;s=Math.sqrt(e[o*3+o]-e[i*3+i]-e[r*3+r]+1),t[o]=.5*s,s=.5/s,t[3]=(e[i*3+r]-e[r*3+i])*s,t[i]=(e[i*3+o]+e[o*3+i])*s,t[r]=(e[r*3+o]+e[o*3+r])*s}return t}function Dm(t,e){let n=Math.sin(e[0]*.5),s=Math.cos(e[0]*.5),o=Math.sin(e[1]*.5),i=Math.cos(e[1]*.5),r=Math.sin(e[2]*.5),l=Math.cos(e[2]*.5);return t[0]=n*i*l+s*o*r,t[1]=s*o*l-n*i*r,t[2]=s*i*r-n*o*l,t[3]=s*i*l+n*o*r,t}var B_=z_;var nO=function(){let t=[0,0,0],e=[1,0,0],n=[0,1,0];return function(s,o,i){let r=hn(o,i);return r<-.999999?(Js(t,e,o),ds(t)<1e-6&&Js(t,n,o),ts(t,t),VT(s,t,Math.PI),s):r>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(Js(t,o,i),s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=1+r,B_(s,s))}}(),sO=function(){let t=[0,0,0,1],e=[0,0,0,1];return function(n,s,o,i,r,l){return z1(t,s,r,l),z1(e,o,i,l),z1(n,t,e,2*l*(1-l)),n}}(),oO=function(){let t=[1,0,0,0,1,0,0,0,1];return function(e,n,s,o){return t[0]=s[0],t[3]=s[1],t[6]=s[2],t[1]=o[0],t[4]=o[1],t[7]=o[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],B_(e,LT(e,t))}}();var B1=go(),qT=()=>({parent:null,children:[],visible:!0,geometry:void 0,matrix:go(),worldMatrix:go(),position:[0,0,0],scale:[1,1,1],quaternion:[-0,-0,-0,1],rotation:[-0,-0,-0],matrixAutoUpdate:!1,matrixNeedsUpdate:!0,data:{}}),Cn=(t,e,n=!0)=>{n&&t.parent!==null&&e!==t.parent&&zT(t.parent,t,!1),t.parent=e,t.matrixNeedsUpdate=!0,n&&e&&RT(e,t,!1)},RT=(t,e,n=!0)=>{~t.children.indexOf(e)||t.children.push(e),n&&Cn(e,t,!1)},zT=(t,e,n=!0)=>{~t.children.indexOf(e)&&t.children.splice(t.children.indexOf(e),1),n&&Cn(e,null,!1)},Bt=(t,e)=>{if(!t.visible)return;let n=di(t),s=BT(t,e,n);t.children.forEach(o=>{o.visible&&Bt(o,s)})},di=t=>!t.matrixAutoUpdate&&!t.matrixNeedsUpdate?!1:(t.matrixNeedsUpdate=!1,Dm(t.quaternion,t.rotation),Tm(t.matrix,t.quaternion,t.position,t.scale),!0),BT=(t,e,n)=>t.parent!==null?e||n?(Pm(t.worldMatrix,t.parent.worldMatrix,t.matrix),!0):!1:n?(T_(t.worldMatrix,t.matrix),!0):!1,Lm=(t,e,n,s)=>{let o=Zt([0,0,0],n.position,e.position);ts(o,o),sn(t.position,e.position,o,s),t.rotation[0]=0,t.rotation[1]=Math.atan2(o[0],o[2])+1.5,t.rotation[2]=Math.sin(-o[1])+1.5,Bt(t,!1)},Ur=(t,e,n=!1,s)=>{n?q1(B1,t.position,e,s):q1(B1,e,t.position,s),L_(t.rotation,B1)},Vm=[],on=()=>Vm.length>0?Vm.pop():qT(),vo=t=>{$T(t),Vm.indexOf(t)<0?Vm.push(t):console.log("tried returning transform that is already known")},$T=t=>{t.data={},t.geometry=void 0,t.visible=!0,t.matrixAutoUpdate=!1,Y(t.position,0,0,0),Y(t.scale,1,1,1),Y(t.rotation,0,0,0),Cn(t,null,!0);for(let e=0;e<t.children.length;++e)Cn(t.children[e],null);t.children.length=0};var qm=[0,0,0],Qc=(t=.1,e=100,n=45,s=1)=>{let o={near:t,far:e,fov:n,aspect:s,transform:on(),projectionMatrix:go(),viewMatrix:go(),unprojectionViewMatrix:go(),projectionViewMatrix:go(),worldPosition:[0,0,0],frustum:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],frustumConstants:[0,0,0,0,0,0]};return o.transform.matrixAutoUpdate=!0,o},Zc=t=>{D_(t.projectionMatrix,t.fov*(Math.PI/180),t.aspect,t.near,t.far)},U_=(t,e,n,s,o)=>{V_(t.projectionMatrix,e,n,s,o,t.near,t.far)},$1=t=>{ga(t.worldPosition,t.transform.worldMatrix)},_a=(t,e)=>{Bt(t.transform,e),L1(t.viewMatrix,t.transform.worldMatrix),Pm(t.projectionViewMatrix,t.projectionMatrix,t.viewMatrix),L1(t.unprojectionViewMatrix,t.projectionViewMatrix),$1(t)};var hi=(t,e,n)=>{let s=t.unprojectionViewMatrix,o=n[0],i=n[1],r=s[3]*o+s[7]*i+s[11]*-1+s[15];return e[0]=(s[0]*o+s[4]*i+s[8]*-1+s[12])/r,e[1]=(s[1]*o+s[5]*i+s[9]*-1+s[13])/r,e[2]=(s[2]*o+s[6]*i+s[10]*-1+s[14])/r,e},Rm=t=>{let e=t.projectionViewMatrix;Y(t.frustum[0],e[3]-e[0],e[7]-e[4],e[11]-e[8]),Y(t.frustum[1],e[3]+e[0],e[7]+e[4],e[11]+e[8]),Y(t.frustum[2],e[3]+e[1],e[7]+e[5],e[11]+e[9]),Y(t.frustum[3],e[3]-e[1],e[7]-e[5],e[11]-e[9]),Y(t.frustum[4],e[3]-e[2],e[7]-e[6],e[11]-e[10]),Y(t.frustum[5],e[3]+e[2],e[7]+e[6],e[11]+e[10]),t.frustumConstants[0]=e[15]-e[12],t.frustumConstants[1]=e[15]+e[12],t.frustumConstants[2]=e[15]+e[13],t.frustumConstants[3]=e[15]-e[13],t.frustumConstants[4]=e[15]-e[14],t.frustumConstants[5]=e[15]+e[14];for(let n=0;n<6;n++){let s=t.frustum[n],o=1/ds(s);gn(s,s,o),t.frustumConstants[n]*=o}},O_=(t,e,n)=>{ot(qm,e.bounds.center),Ps(qm,qm,n.worldMatrix);let s=e.bounds.radius*I_(n.worldMatrix);return U1(t,qm,s)},U1=(t,e,n)=>{for(let s=0;s<6;s++)if(hn(t.frustum[s],e)+t.frustumConstants[s]<-n)return!1;return!0};var As=document.createElement("canvas"),W=As.getContext("webgl2",{depth:!0,stencil:!1,premultipliedAlpha:!1,alpha:!1,antialias:!1,powerPreference:"high-performance",preserveDrawingBuffer:!0}),Vn=document.createElement("canvas"),Ts=Vn.getContext("2d",{alpha:!0}),ba=W.vertexAttribDivisor.bind(W),j_=W.drawArraysInstanced.bind(W),W_=W.drawElementsInstanced.bind(W),G_=W.createVertexArray.bind(W),zm=W.bindVertexArray.bind(W),UT=W.deleteVertexArray.bind(W),O1=W.getExtension("EXT_texture_filter_anisotropic"),H_=W.getExtension("WEBGL_compressed_texture_s3tc"),tt={maxTextureUnits:W.getParameter(W.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxAnisotropy:W.getParameter(O1.MAX_TEXTURE_MAX_ANISOTROPY_EXT),blendFunc:{src:W.ONE,dst:W.ZERO,srcAlpha:0,dstAlpha:0},blendEquation:{modeRGB:W.FUNC_ADD,modeAlpha:0},frontFace:W.CCW,depthFunc:W.LESS,cullFace:null,depthMask:!0,flipY:!1,framebuffer:null,viewport:{width:-1,height:-1},textureUnits:[],activeTextureUnit:0,width:0,height:0,currentGeometry:-1,currentProgram:-1},Y_=(t,e)=>{tt.width=t,tt.height=e,As.width=t,As.height=e,Vn.width=t,Vn.height=e},Jc=(t,e)=>{tt.viewport.width===t&&tt.viewport.height===e||(tt.viewport.width=t,tt.viewport.height=e,W.viewport(0,0,t,e))},Kc=t=>{tt[t]!==!0&&(W.enable(t),tt[t]=!0)},Bm=t=>{tt[t]!==!1&&(W.disable(t),tt[t]=!1)},X_=(t,e,n,s)=>{tt.blendFunc.src===t&&tt.blendFunc.dst===e&&tt.blendFunc.srcAlpha===n&&tt.blendFunc.dstAlpha===s||(tt.blendFunc.src=t,tt.blendFunc.dst=e,tt.blendFunc.srcAlpha=n,tt.blendFunc.dstAlpha=s,n!==void 0?W.blendFuncSeparate(t,e,n,s):W.blendFunc(t,e))},Q_=(t,e)=>{tt.blendEquation.modeRGB===t&&tt.blendEquation.modeAlpha===e||(tt.blendEquation.modeRGB=t,tt.blendEquation.modeAlpha=e,e!==void 0?W.blendEquationSeparate(t,e):W.blendEquation(t))},Z_=t=>{tt.cullFace!==t&&(tt.cullFace=t,W.cullFace(t))},J_=t=>{tt.frontFace!==t&&(tt.frontFace=t,W.frontFace(t))},N1=t=>{tt.depthMask!==t&&(tt.depthMask=t,W.depthMask(t))},K_=t=>{tt.depthFunc!==t&&(tt.depthFunc=t,W.depthFunc(t))},ef=t=>{tt.activeTextureUnit!==t&&(tt.activeTextureUnit=t,W.activeTexture(W.TEXTURE0+t))},N_=({target:t=W.FRAMEBUFFER,buffer:e=null}={})=>{tt.framebuffer!==e&&(tt.framebuffer=e,W.bindFramebuffer(t,e))},eb=t=>{t?(N_(t),Jc(t.width,t.height)):(N_(),Jc(tt.width,tt.height))},j1=t=>{(!t||!t.depth)&&(Kc(W.DEPTH_TEST),N1(!0)),W.clear(W.COLOR_BUFFER_BIT|W.DEPTH_BUFFER_BIT)};var ya=`#version 300 es
in vec2 uv;
in vec2 position;
out vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = vec4(position, 0.0, 1.0);
}`;var tb=[0,1,0],nb=[0,0,0],ht=Qc(.3,500,70),Yt=on();Cn(ht.transform,Yt);Y(ht.transform.position,0,0,-1);ht.transform.rotation[1]=Math.PI;Yt.matrixAutoUpdate=!0;function OT(t){let e;return{c(){e=h("div"),Le(e,"cursor",t[1])},m(n,s){w(n,e,s),t[2](e)},p(n,[s]){s&2&&Le(e,"cursor",n[1])},i:ae,o:ae,d(n){n&&x(e),t[2](null)}}}function NT(t,e,n){let s;ie(t,gm,r=>n(1,s=r));let o;Fn(()=>{o.appendChild(As),o.appendChild(Vn)});function i(r){qt[r?"unshift":"push"](()=>{o=r,n(0,o)})}return[o,s,i]}var W1=class extends Ce{constructor(e){super(),Pe(this,e,NT,OT,Be,{})}},sb=W1;function ob(t){let e,n,s,o,i;return{c(){e=h("div"),n=h("img"),p(n,"class",s=zi(t[2].css)+" svelte-fc7xg3"),at(n.src,o=t[2].img)||p(n,"src",o),p(e,"class",i="container border "+t[2].border+" svelte-fc7xg3"),Le(e,"top",t[1]+"px"),Le(e,"left",t[0]+"px")},m(r,l){w(r,e,l),d(e,n)},p(r,l){l&4&&s!==(s=zi(r[2].css)+" svelte-fc7xg3")&&p(n,"class",s),l&4&&!at(n.src,o=r[2].img)&&p(n,"src",o),l&4&&i!==(i="container border "+r[2].border+" svelte-fc7xg3")&&p(e,"class",i),l&2&&Le(e,"top",r[1]+"px"),l&1&&Le(e,"left",r[0]+"px")},d(r){r&&x(e)}}}function jT(t){let e,n=t[2]&&t[0]&&t[1]&&ob(t);return{c(){n&&n.c(),e=de()},m(s,o){n&&n.m(s,o),w(s,e,o)},p(s,[o]){s[2]&&s[0]&&s[1]?n?n.p(s,o):(n=ob(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(s){s&&x(e),n&&n.d(s)}}}function WT(t,e,n){let s;ie(t,In,l=>n(2,s=l));let o,i,r=l=>{(s||o||i)&&(s?(n(0,o=l.clientX-10),n(1,i=l.clientY-10)):(n(0,o=0),n(1,i=0)))};return Fn(()=>{document.addEventListener("mousemove",r,!1)}),Tn(()=>{document.removeEventListener("mousemove",r)}),[o,i,s]}var G1=class extends Ce{constructor(e){super(),Pe(this,e,WT,jT,Be,{})}},ib=G1;var rb=(t,e,n)=>n.items[t][t=="book"?Math.floor(e/5):e],lb=(t,e,n)=>rb(t,e,n).name+(t=="book"?" Lv. "+(e%5+1):""),ab=(t,e,n)=>rb(t,e,n).description;var Zo={};Kn(Zo,{activeWorld:()=>Or,alwaysShowLevel:()=>ep,ambienceVolume:()=>rf,anisotropy:()=>of,audioVolume:()=>Gr,audioVolumeLowered:()=>Hr,bloom:()=>Nm,buffCdFlashingDuration:()=>yf,buffCdFlashingInterval:()=>bf,buffcountParty:()=>xf,buffcountUnitframes:()=>kf,buffsHideIrrelevant:()=>xp,cameraZoom:()=>Gm,cdTextBuffs:()=>_p,cdTextSkills:()=>vp,charpanelOpen:()=>ki,chatbubbles:()=>ip,clanOpen:()=>_i,classColorBars:()=>np,combatTextPush:()=>tp,command:()=>Qo,current:()=>fe,disableoffscreen:()=>Um,dpsmeterMode:()=>mf,dpsmeterOpen:()=>Zr,dpsmeterParty:()=>uf,dpsmeterTarget:()=>Jr,expmeterOpen:()=>ff,filteredChannels:()=>df,fogpattern:()=>Wm,foliage:()=>nf,fov:()=>jr,fxaa:()=>$m,inventoryCols:()=>Xr,inventoryOpen:()=>gi,invertMouseX:()=>wp,invertMouseY:()=>Mp,itemProtectQuality:()=>vf,itemQualityFilter:()=>gf,itemQualityPercent:()=>cp,itemTypeFilter:()=>hf,itemmeterOpen:()=>cf,kbAltBack:()=>pb,kbAltForward:()=>mb,kbBack:()=>hb,kbCharacter:()=>xb,kbClan:()=>Mb,kbForward:()=>cb,kbInventory:()=>wb,kbLeft:()=>db,kbMap:()=>yb,kbNextParty:()=>_b,kbNextTarget:()=>vb,kbParty:()=>Cb,kbPvp:()=>Fb,kbRight:()=>gb,kbSkillbar1:()=>Pb,kbSkillbar10:()=>Rb,kbSkillbar11:()=>zb,kbSkillbar12:()=>Bb,kbSkillbar13:()=>$b,kbSkillbar14:()=>Ub,kbSkillbar15:()=>Ob,kbSkillbar16:()=>Nb,kbSkillbar17:()=>jb,kbSkillbar18:()=>Wb,kbSkillbar19:()=>Gb,kbSkillbar2:()=>Ab,kbSkillbar20:()=>Hb,kbSkillbar21:()=>Yb,kbSkillbar22:()=>Xb,kbSkillbar23:()=>Qb,kbSkillbar24:()=>Zb,kbSkillbar3:()=>Tb,kbSkillbar4:()=>Eb,kbSkillbar5:()=>Ib,kbSkillbar6:()=>Db,kbSkillbar7:()=>Vb,kbSkillbar8:()=>Lb,kbSkillbar9:()=>qb,kbSkills:()=>kb,kbSocial:()=>Sb,kbTurnLeft:()=>fb,kbTurnRight:()=>ub,kbUntarget:()=>bb,lang:()=>Yr,lastConnectedChar:()=>tf,leaveEmptyParty:()=>kp,lockedcamera:()=>Fp,mapLowQuality:()=>op,mapShowMonsters:()=>sp,mouseSensitivity:()=>Mf,msgExpGain:()=>fp,msgFame:()=>up,msgFriendOnlineStatus:()=>gp,msgGoldPickUp:()=>hp,msgItemPartyPickUp:()=>dp,msgItemPartyRoll:()=>pp,msgItemPickup:()=>mp,musicVolume:()=>lf,nameShowEnemyPlayers:()=>Jm,nameShowFriendlyPlayers:()=>Zm,nameShowMonsters:()=>Qm,nameplateShowEnemyPlayers:()=>Xm,nameplateShowFriendlyPlayers:()=>Ym,nameplateShowMonsters:()=>Hm,nameplateShowTransparency:()=>Km,nameplateViewRange:()=>pf,nextFriendlyTargetAllowNonParty:()=>Sp,nextFriendlyTargetCycle:()=>Ff,particles:()=>jm,partyBuffLimitUpdateRate:()=>bp,partyOpen:()=>Ks,partyWidth:()=>Kr,pointerlock:()=>Cp,pvpOpen:()=>yi,registerSetting:()=>Jb,resolution:()=>Wr,settingsOpen:()=>Qr,shadowmapResolution:()=>sf,shadows:()=>Om,showFpsPing:()=>wa,showIncomingDamage:()=>lp,showIncomingHeal:()=>rp,showIncomingMana:()=>ap,showPartyMana:()=>Ma,showSelfInParty:()=>yp,skillConfigs:()=>Fa,skillPresetVisible:()=>wf,skillbarAmount:()=>el,skillbarsettings:()=>xi,skillmenuOpen:()=>vi,socialOpen:()=>bi,stashCols:()=>Xi,stashHeight:()=>Qi,stashShowGroups:()=>ka,stashShowSettings:()=>af,subscriptionOpen:()=>zs,tutprogress:()=>wi,twitchOpen:()=>xa,viewRange:()=>Nr,windowSettings:()=>_f});var H1={};Kn(H1,{activeWorld:()=>Or,alwaysShowLevel:()=>ep,ambienceVolume:()=>rf,anisotropy:()=>of,audioVolume:()=>Gr,audioVolumeLowered:()=>Hr,bloom:()=>Nm,buffCdFlashingDuration:()=>yf,buffCdFlashingInterval:()=>bf,buffcountParty:()=>xf,buffcountUnitframes:()=>kf,buffsHideIrrelevant:()=>xp,cameraZoom:()=>Gm,cdTextBuffs:()=>_p,cdTextSkills:()=>vp,charpanelOpen:()=>ki,chatbubbles:()=>ip,clanOpen:()=>_i,classColorBars:()=>np,combatTextPush:()=>tp,command:()=>Qo,disableoffscreen:()=>Um,dpsmeterMode:()=>mf,dpsmeterOpen:()=>Zr,dpsmeterParty:()=>uf,dpsmeterTarget:()=>Jr,expmeterOpen:()=>ff,filteredChannels:()=>df,fogpattern:()=>Wm,foliage:()=>nf,fov:()=>jr,fxaa:()=>$m,inventoryCols:()=>Xr,inventoryOpen:()=>gi,invertMouseX:()=>wp,invertMouseY:()=>Mp,itemProtectQuality:()=>vf,itemQualityFilter:()=>gf,itemQualityPercent:()=>cp,itemTypeFilter:()=>hf,itemmeterOpen:()=>cf,kbAltBack:()=>pb,kbAltForward:()=>mb,kbBack:()=>hb,kbCharacter:()=>xb,kbClan:()=>Mb,kbForward:()=>cb,kbInventory:()=>wb,kbLeft:()=>db,kbMap:()=>yb,kbNextParty:()=>_b,kbNextTarget:()=>vb,kbParty:()=>Cb,kbPvp:()=>Fb,kbRight:()=>gb,kbSkillbar1:()=>Pb,kbSkillbar10:()=>Rb,kbSkillbar11:()=>zb,kbSkillbar12:()=>Bb,kbSkillbar13:()=>$b,kbSkillbar14:()=>Ub,kbSkillbar15:()=>Ob,kbSkillbar16:()=>Nb,kbSkillbar17:()=>jb,kbSkillbar18:()=>Wb,kbSkillbar19:()=>Gb,kbSkillbar2:()=>Ab,kbSkillbar20:()=>Hb,kbSkillbar21:()=>Yb,kbSkillbar22:()=>Xb,kbSkillbar23:()=>Qb,kbSkillbar24:()=>Zb,kbSkillbar3:()=>Tb,kbSkillbar4:()=>Eb,kbSkillbar5:()=>Ib,kbSkillbar6:()=>Db,kbSkillbar7:()=>Vb,kbSkillbar8:()=>Lb,kbSkillbar9:()=>qb,kbSkills:()=>kb,kbSocial:()=>Sb,kbTurnLeft:()=>fb,kbTurnRight:()=>ub,kbUntarget:()=>bb,lang:()=>Yr,lastConnectedChar:()=>tf,leaveEmptyParty:()=>kp,lockedcamera:()=>Fp,mapLowQuality:()=>op,mapShowMonsters:()=>sp,mouseSensitivity:()=>Mf,msgExpGain:()=>fp,msgFame:()=>up,msgFriendOnlineStatus:()=>gp,msgGoldPickUp:()=>hp,msgItemPartyPickUp:()=>dp,msgItemPartyRoll:()=>pp,msgItemPickup:()=>mp,musicVolume:()=>lf,nameShowEnemyPlayers:()=>Jm,nameShowFriendlyPlayers:()=>Zm,nameShowMonsters:()=>Qm,nameplateShowEnemyPlayers:()=>Xm,nameplateShowFriendlyPlayers:()=>Ym,nameplateShowMonsters:()=>Hm,nameplateShowTransparency:()=>Km,nameplateViewRange:()=>pf,nextFriendlyTargetAllowNonParty:()=>Sp,nextFriendlyTargetCycle:()=>Ff,particles:()=>jm,partyBuffLimitUpdateRate:()=>bp,partyOpen:()=>Ks,partyWidth:()=>Kr,pointerlock:()=>Cp,pvpOpen:()=>yi,resolution:()=>Wr,settingsOpen:()=>Qr,shadowmapResolution:()=>sf,shadows:()=>Om,showFpsPing:()=>wa,showIncomingDamage:()=>lp,showIncomingHeal:()=>rp,showIncomingMana:()=>ap,showPartyMana:()=>Ma,showSelfInParty:()=>yp,skillConfigs:()=>Fa,skillPresetVisible:()=>wf,skillbarAmount:()=>el,skillbarsettings:()=>xi,skillmenuOpen:()=>vi,socialOpen:()=>bi,stashCols:()=>Xi,stashHeight:()=>Qi,stashShowGroups:()=>ka,stashShowSettings:()=>af,subscriptionOpen:()=>zs,tutprogress:()=>wi,twitchOpen:()=>xa,viewRange:()=>Nr,windowSettings:()=>_f});var Or=te(""),tf=te(0),Nr=te(60),jr=te(70),Wr=te(100),nf=te(100),sf=te(2),$m=te(!0),Um=te(!0),Om=te(!0),Nm=te(!0),jm=te(!0),of=te(4),Wm=te(!0),rf=te(40),Gr=te(70),Hr=te(80),lf=te(30),Yr=te("en"),Qo=te("faction"),Xi=te(8),Qi=te(300),ka=te(2),af=te(!1),Xr=te(5),gi=te(!1),Qr=te(!1),vi=te(!1),Zr=te(!1),cf=te(!0),ff=te(!0),xa=te(!0),zs=te(!1),Ks=te(!1),_i=te(!1),bi=te(!1),yi=te(!1),uf=te(!0),mf=te(0),Jr=te(0),ki=te(!1),xi=te({}),Gm=te(7),pf=te(100),Hm=te(!0),Ym=te(!0),Xm=te(!0),Qm=te(!0),Zm=te(!0),Jm=te(!0),Km=te(!0),ep=te(!1),tp=te(!0),np=te(!1),sp=te(!0),op=te(!1),wi=te(0),ip=te(!0),rp=te(!0),lp=te(!0),ap=te(!0),df=te([]),hf=te(""),gf=te(0),cp=te(!1),wa=te(!1),vf=te(70),_f=te([]),fp=te(!1),up=te(!0),mp=te(!0),pp=te(!0),dp=te(!0),hp=te(!0),gp=te(!0),vp=te(!0),_p=te(!0),bf=te(.5),yf=te(3),bp=te(!0),Kr=te(200),yp=te(!0),kp=te(!0),Ma=te(!1),kf=te(14),xf=te(8),xp=te(!1),Fa=te([]),wf=te(!1),Mf=te(1),wp=te(!1),Mp=te(!1),Fp=te(!0),Cp=te(!0),Sp=te(!0),Ff=te(10),cb=te("w"),fb=te("arrowleft"),ub=te("arrowright"),mb=te("arrowup"),pb=te("arrowdown"),db=te("a"),hb=te("s"),gb=te("d"),vb=te("tab"),_b=te("x"),bb=te("escape"),yb=te("m"),kb=te("k"),xb=te("c"),wb=te("b"),Mb=te("g"),Fb=te("v"),Cb=te("p"),Sb=te("i"),Pb=te("1"),Ab=te("2"),Tb=te("3"),Eb=te("4"),Ib=te("5"),Db=te("6"),Vb=te("7"),Lb=te("8"),qb=te("9"),Rb=te("0"),zb=te(""),Bb=te(""),$b=te(""),Ub=te(""),Ob=te(""),Nb=te(""),jb=te(""),Wb=te(""),Gb=te(""),Hb=te(""),Yb=te(""),Xb=te(""),Qb=te(""),Zb=te(""),el=te(12);var Y1;Y1={...H1};var Jb=(t,e)=>{{let n=localStorage.getItem(t),s=JSON.parse(n=="undefined"?null:n);s!==null&&e.set(s)}e.subscribe(n=>{fe[t]=n,localStorage.setItem(t,JSON.stringify(n))})},fe={};for(let t in Y1)Jb(t,Y1[t]);var P;Yr.subscribe(async t=>{await fetch(`/data/loc/${t}.json?v=8685122`).then(async e=>{P=await e.json(),hm.set(!0)})});var nn=(t,e)=>lb(t,e,P),X1=(t,e)=>ab(t,e,P);function Kb(t,e,n){let s=t.slice();return s[8]=e[n],s}function e3(t){let e,n=me(t[1].opts),s=[];for(let i=0;i<n.length;i+=1)s[i]=s3(Kb(t,n,i));let o=null;return n.length||(o=t3(t)),{c(){e=h("div");for(let i=0;i<s.length;i+=1)s[i].c();o&&o.c(),p(e,"class","panel context border grey"),Le(e,"left",t[1].x+(t[4]&&t[1].xFlip||0)+"px"),Le(e,"top",t[1].y-(t[3]&&t[1].yFlip||0)+"px"),Le(e,"transform","translate("+(t[4]?"-100%":"0%")+","+(t[3]?"-100%":"0%")+")")},m(i,r){w(i,e,r);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null);o&&o.m(e,null),t[6](e)},p(i,r){if(r&3){n=me(i[1].opts);let l;for(l=0;l<n.length;l+=1){let a=Kb(i,n,l);s[l]?s[l].p(a,r):(s[l]=s3(a),s[l].c(),s[l].m(e,null))}for(;l<s.length;l+=1)s[l].d(1);s.length=n.length,!n.length&&o?o.p(i,r):n.length?o&&(o.d(1),o=null):(o=t3(i),o.c(),o.m(e,null))}r&18&&Le(e,"left",i[1].x+(i[4]&&i[1].xFlip||0)+"px"),r&10&&Le(e,"top",i[1].y-(i[3]&&i[1].yFlip||0)+"px"),r&24&&Le(e,"transform","translate("+(i[4]?"-100%":"0%")+","+(i[3]?"-100%":"0%")+")")},d(i){i&&x(e),st(s,i),o&&o.d(),t[6](null)}}}function t3(t){let e;return{c(){e=h("div"),e.textContent=`${P.ui.noOptions}`,p(e,"class","choice disabled")},m(n,s){w(n,e,s)},p:ae,d(n){n&&x(e)}}}function n3(t){let e,n;return{c(){e=h("img"),p(e,"class","svgicon"),at(e.src,n="/data/ui/icons/"+t[8].icon+".svg?v=8685122")||p(e,"src",n)},m(s,o){w(s,e,o)},p(s,o){o&2&&!at(e.src,n="/data/ui/icons/"+s[8].icon+".svg?v=8685122")&&p(e,"src",n)},d(s){s&&x(e)}}}function s3(t){let e,n=t[8].name+"",s,o,i,r,l=t[8].icon&&n3(t);function a(...c){return t[5](t[8],...c)}return{c(){e=h("div"),l&&l.c(),s=T(n),p(e,"class",o="choice "+(t[8].css||""))},m(c,f){w(c,e,f),l&&l.m(e,null),d(e,s),i||(r=H(e,"mouseup",a),i=!0)},p(c,f){t=c,t[8].icon?l?l.p(t,f):(l=n3(t),l.c(),l.m(e,s)):l&&(l.d(1),l=null),f&2&&n!==(n=t[8].name+"")&&G(s,n),f&2&&o!==(o="choice "+(t[8].css||""))&&p(e,"class",o)},d(c){c&&x(e),l&&l.d(),i=!1,r()}}}function GT(t){let e,n=t[1]&&e3(t);return{c(){n&&n.c(),e=de()},m(s,o){n&&n.m(s,o),w(s,e,o)},p(s,[o]){s[1]?n?n.p(s,o):(n=e3(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(s){s&&x(e),n&&n.d(s)}}}function HT(t,e,n){let s,o,i;ie(t,dn,u=>n(1,i=u));let r,l=u=>{u.target!=r&&u.target.parentNode!=r&&i&&dn.set(void 0)},a=(u,m)=>{m.fun(u),dn.set(void 0)};Fn(()=>{document.addEventListener("pointerdown",l,!1)}),Tn(()=>{document.removeEventListener("pointerdown",l)});let c=(u,m)=>a(m,u);function f(u){qt[u?"unshift":"push"](()=>{r=u,n(2,r)})}return t.$$.update=()=>{t.$$.dirty&2&&n(4,s=i&&i.x>window.innerWidth-100),t.$$.dirty&2&&n(3,o=i&&i.y>window.innerHeight-130)},[a,i,r,o,s,c,f]}var Q1=class extends Ce{constructor(e){super(),Pe(this,e,HT,GT,Be,{opt:0})}get opt(){return this.$$.ctx[0]}},o3=Q1;var B=0,i3={string:t=>{let e=f3(t);return eo(e)+e},varuint:t=>eo(t),varint:t=>YT(t),buffer8:t=>{let e=t.length;return eo(e)+e},buffer16:(t,e)=>{let n=t.length*2,s=eo(n);return(e+s)%2==1&&s++,s+n}};var ke=t=>{let e=0,n=0,s=0;do s=t[B++],e|=(s&127)<<7*n,n++;while(s&128);return e};var Zi=(t,e)=>{for(;e>127;)t[B++]=e&127|128,e>>=7;t[B++]=e&127},eo=t=>t<=0?1:Math.floor(Math.log(t)/Math.log(128))+1,YT=t=>eo(t<<1^t>>31),_o=t=>t[B]&128?(255-t[B]+1)*-1:t[B],XT=(t,e)=>{e<0&&(e=255+e+1),t[B]=e&255,B+=1},qe=t=>t[B],Jo=(t,e)=>{t[B]=e,B+=1},Pp=t=>{let e=t[B]|t[B+1]<<8;return e&32768?e|4294901760:e},Z1=(t,e)=>{t[B]=e&255,t[B+1]=e>>>8,B+=2},Ot=t=>t[B]|t[B+1]<<8;var gs=t=>(t[B]|t[B+1]<<8|t[B+2]<<16)+t[B+3]*16777216,J1=(t,e)=>{t[B]=e&255,t[B+1]=e>>>8,t[B+2]=e>>>16,t[B+3]=e>>>24,B+=4},K1=new ArrayBuffer(8),Ji=new Uint8Array(K1),a3=new Float32Array(K1),LO=new Float64Array(K1),lt=t=>(Ji[0]=t[B],Ji[1]=t[B+1],Ji[2]=t[B+2],Ji[3]=t[B+3],a3[0]),c3=(t,e)=>{a3[0]=e,t[B]=Ji[0],t[B+1]=Ji[1],t[B+2]=Ji[2],t[B+3]=Ji[3],B+=4};var r3=t=>{let e=ke(t);B%2==1&&B++;let n=new Uint16Array(t.buffer,B,e/2);return B+=e,n},f3=t=>{let e=t.length;for(let n=t.length-1;n>=0;n--){let s=t.charCodeAt(n);s>127&&s<=2047?e++:s>2047&&s<=65535&&(e+=2),s>=56320&&s<=57343&&n--}return e},l3=(t,e)=>{let n=f3(e);Zi(t,n);for(let s=0;s<e.length;s++){let o=e.charCodeAt(s);o<128?t[B++]=o:o<2048?(t[B++]=o>>6|192,t[B++]=o&63|128):(o&64512)==55296&&s+1<e.length&&(e.charCodeAt(s+1)&64512)==56320?(o=65536+((o&1023)<<10)+(e.charCodeAt(++s)&1023),t[B++]=o>>18|240,t[B++]=o>>12&63|128,t[B++]=o>>6&63|128,t[B++]=o&63|128):(t[B++]=o>>12|224,t[B++]=o>>6&63|128,t[B++]=o&63|128)}},Ln=t=>{let e=ke(t),n="",s=B+e;for(;B<s;){let o=t[B++];if(o<128)n+=String.fromCharCode(o);else if(o>191&&o<224){let i=t[B++];n+=String.fromCharCode((o&31)<<6|i&63)}else if(o>239&&o<365){let i=t[B++],r=t[B++],l=t[B++],a=((o&7)<<18|(i&63)<<12|(r&63)<<6|l&63)-65536;n+=String.fromCharCode(55296+(a>>10)),n+=String.fromCharCode(56320+(a&1023))}else{let i=t[B++],r=t[B++];n+=String.fromCharCode((o&15)<<12|(i&63)<<6|r&63)}}return n},u3={encode:t=>{let e=t,n=e.doubles,s=e.int8s,o=e.uint16s,i=e.uint8s,r=0;r+=1,r+=eo(n.length);for(let a=0;a<n.length;a++)r+=4;r+=eo(s.length);for(let a=0;a<s.length;a++)r+=1;r+=eo(o.length);for(let a=0;a<o.length;a++)r+=2;r+=eo(i.length);for(let a=0;a<i.length;a++)r+=1;let l=new Uint8Array(r);B=0,Jo(l,e._header),Zi(l,n.length);for(let a=0;a<n.length;a++)c3(l,n[a]);Zi(l,s.length);for(let a=0;a<s.length;a++)XT(l,s[a]);Zi(l,o.length);for(let a=0;a<o.length;a++)Z1(l,o[a]);Zi(l,i.length);for(let a=0;a<i.length;a++)Jo(l,i[a]);return l}},m3={encode:t=>{let e=t,n=0;n+=1,n+=4;let s=new Uint8Array(n);return B=0,Jo(s,e._header),J1(s,e.target),s}},p3={encode:t=>{let e=t,n=e.info,s=0;s+=1,s+=2,s+=eo(n.length);for(let i=0;i<n.length;i++)s+=4;let o=new Uint8Array(s);B=0,Jo(o,e._header),Z1(o,e.id),Zi(o,n.length);for(let i=0;i<n.length;i++)J1(o,n[i]);return o}},d3={encode:t=>{let e=t,n=e.info,s=e.pos,o=0;o+=1,o+=2,o+=eo(n.length);for(let r=0;r<n.length;r++)o+=4;o+=eo(s.length);for(let r=0;r<s.length;r++)o+=4;let i=new Uint8Array(o);B=0,Jo(i,e._header),Z1(i,e.id),Zi(i,n.length);for(let r=0;r<n.length;r++)J1(i,n[r]);Zi(i,s.length);for(let r=0;r<s.length;r++)c3(i,s[r]);return i}},h3={encode:t=>{let e=t,n=0;n+=1,n+=1;let s=new Uint8Array(n);return B=0,Jo(s,e._header),Jo(s,e.id),s}},g3={encode:t=>{let e=t,n=0;n+=1,n+=i3.string(e.command,n),n+=i3.string(e.string,n);let s=new Uint8Array(n);return B=0,Jo(s,e._header),l3(s,e.command),l3(s,e.string),s}},v3={decode:t=>{let e=t,n={};B=0,n._header=qe(e),B+=1;let s=[];n.inputs=s;let o=ke(e);for(let u=0;u<o;u++){let m={};s[u]=m,m.id=gs(e),B+=4,m.jump=qe(e),B+=1,m.rot=lt(e),B+=4,m.speed=Ot(e),B+=2;let g=[];m.steer=g,g[0]=_o(e),B+=1;let v=ke(e);for(let _=1;_<v;_++)g[_]=_o(e),B+=1}let i=[];n.log=i;let r=ke(e);for(let u=0;u<r;u++){let m={};i[u]=m;let g=[];m.data=g;let v=ke(e);for(let _=0;_<v;_++)g[_]=ke(e);m.type=qe(e),B+=1}let l=[];n.logPersonal=l;let a=ke(e);for(let u=0;u<a;u++){let m={};l[u]=m;let g=[];m.data=g;let v=ke(e);for(let _=0;_<v;_++)g[_]=ke(e);m.type=qe(e),B+=1}let c=[];n.movements=c;let f=ke(e);for(let u=0;u<f;u++){let m={};c[u]=m,m.id=gs(e),B+=4;let g=[];m.pos=g,g[0]=lt(e),B+=4,g[1]=lt(e),B+=4;let v=ke(e);for(let k=2;k<v;k++)g[k]=lt(e),B+=4;let _=[];m.vel=_,_[0]=lt(e),B+=4,_[1]=lt(e),B+=4;let b=ke(e);for(let k=2;k<b;k++)_[k]=lt(e),B+=4}return n.tickId=gs(e),B+=4,n}},_3={decode:t=>{let e=t,n={};B=0,n._header=qe(e),B+=1;let s=[];n.members=s;let o=ke(e);for(let l=0;l<o;l++){let a={};s[l]=a,a.class=qe(e),B+=1,a.entityid=gs(e),B+=4,a.level=qe(e),B+=1,a.name=Ln(e),a.role=Ot(e),B+=2,a.world=Ln(e)}let i=[];n.queues=i;let r=ke(e);for(let l=0;l<r;l++)i[l]=Ln(e);return n}},b3={decode:t=>{let e=t,n={};B=0,n._header=qe(e),B+=1,n.contrib=ke(e);let s=[];n.contributors=s;let o=ke(e);for(let l=0;l<o;l++){let a={};s[l]=a,a.class=qe(e),B+=1,a.faction=qe(e),B+=1,a.level=qe(e),B+=1,a.name=Ln(e);let c=[];a.stats=c;let f=ke(e);for(let u=0;u<f;u++)c[u]=ke(e)}n.duration=ke(e);let i=[];n.kills=i,i[0]=ke(e);let r=ke(e);for(let l=1;l<r;l++)i[l]=ke(e);return n.level=ke(e),n.reward=ke(e),n.status=qe(e),B+=1,n}},y3={decode:t=>{let e=t,n={};B=0,n._header=qe(e),B+=1;let s=[];n.members=s;let o=ke(e);for(let i=0;i<o;i++){let r={};s[i]=r,r.entityid=gs(e),B+=4;let l=[];r.pos=l;let a=ke(e);for(let c=0;c<a;c++)l[c]=Ot(e),B+=2}return n}},k3={decode:t=>{let e=t,n={};B=0,n._header=qe(e),B+=1;let s=[];n.icons=s;let o=ke(e);for(let i=0;i<o;i++){let r={};s[i]=r,r.blink=!!_o(e),B+=1,r.id=Ot(e),B+=2;let l=[];r.pos=l,l[0]=Ot(e),B+=2;let a=ke(e);for(let c=1;c<a;c++)l[c]=Ot(e),B+=2}return n}},x3={decode:t=>{let e=t,n={};B=0,n._header=qe(e),B+=1,n.channel=Ln(e),n.clan=Ln(e),n.class=qe(e),B+=1,n.faction=qe(e),B+=1,n.from=Ln(e),n.id=gs(e),B+=4;let s=[];n.items=s;let o=ke(e);for(let i=0;i<o;i++){let r={};s[i]=r,r.id=gs(e),B+=4,r.index=Ot(e),B+=2;let l=[];r.rolls=l;let a=ke(e);for(let c=0;c<a;c++)l[c]=Ot(e),B+=2;r.stacks=qe(e),B+=1,r.tier=Ot(e),B+=2,r.type=Ln(e),r.upgrade=Ot(e),B+=2}return n.level=qe(e),B+=1,n.message=Ln(e),n.subscribed=qe(e),B+=1,n}},w3={decode:t=>{let e=t,n={};return B=0,n._header=qe(e),B+=1,n.world=Ln(e),n}},M3={decode:t=>{let e=t,n={};B=0,n._header=qe(e),B+=1;let s=[];n.messages=s;let o=ke(e);for(let i=0;i<o;i++){let r={};s[i]=r,r.message=Ln(e),r.type=Ln(e)}return n}},F3={decode:t=>{let e=t,n={};return B=0,n._header=qe(e),B+=1,n.file=Ln(e),n.playerId=gs(e),B+=4,n.tickId=gs(e),B+=4,n.world=Ln(e),n}},C3={decode:t=>{let e=t,n={};return B=0,n._header=qe(e),B+=1,n.pos=Ot(e),B+=2,n}},S3={decode:t=>{let e=t,n={};return B=0,n._header=qe(e),B+=1,n.id=qe(e),B+=1,n},encode:t=>{let e=t,n=0;n+=1,n+=1;let s=new Uint8Array(n);return B=0,Jo(s,e._header),Jo(s,e.id),s}};var P3={decode:t=>{let e=t,n={};B=0;let s=[];n.aabb=s;let o=ke(e);for(let C=0;C<o;C++)s[C]=lt(e),B+=4;let i=[];n.area=i;let r=ke(e);for(let C=0;C<r;C++)i[C]=Ot(e),B+=2;let l=[];n.environment=l;let a=ke(e);for(let C=0;C<a;C++)l[C]=Ot(e),B+=2;let c=[];n.holes=c;let f=ke(e);for(let C=0;C<f;C++)c[C]=Ot(e),B+=2;let u=[];n.props=u;let m=ke(e);for(let C=0;C<m;C++){let M={};u[C]=M,M.id=gs(e),B+=4,M.rx=Pp(e),B+=2,M.ry=Pp(e),B+=2,M.rz=Pp(e),B+=2,M.scale=Ot(e),B+=2,M.x=Ot(e),B+=2,M.y=gs(e),B+=4,M.z=Ot(e),B+=2}let g=[];n.shore=g;let v=ke(e);for(let C=0;C<v;C++)g[C]=Ot(e),B+=2;n.terrain=r3(e);let _=[];n.texture=_;let b=ke(e);for(let C=0;C<b;C++)_[C]=r3(e);let k=[];n.textureid=k;let y=ke(e);for(let C=0;C<y;C++){let M=[];k[C]=M;let V=ke(e);for(let $=0;$<V;$++)M[$]=Ot(e),B+=2}let F=[];n.water=F;let A=ke(e);for(let C=0;C<A;C++)F[C]=Ot(e),B+=2;return n}},A3={decode:t=>{let e=t,n={};B=0;let s=[];n.color=s;let o=ke(e);for(let k=0;k<o;k++)s[k]=qe(e),B+=1;let i=[];n.flags=i;let r=ke(e);for(let k=0;k<r;k++)i[k]=qe(e),B+=1;let l=[];n.index=l;let a=ke(e);for(let k=0;k<a;k++)l[k]=ke(e);let c=[];n.indexInvisible=c;let f=ke(e);for(let k=0;k<f;k++)c[k]=ke(e);let u=[];n.normal=u;let m=ke(e);for(let k=0;k<m;k++)u[k]=_o(e),B+=1;let g=[];n.position=g;let v=ke(e);for(let k=0;k<v;k++)g[k]=Pp(e),B+=2;n.sx=gs(e),B+=4,n.sy=gs(e),B+=4,n.sz=gs(e),B+=4;let _=[];n.uv=_;let b=ke(e);for(let k=0;k<b;k++)_[k]=Ot(e),B+=2;return n}},T3={decode:t=>{let e=t,n={};B=0;let s=[];n.animations=s;let o=ke(e);for(let ee=0;ee<o;ee++){let N={};s[ee]=N,N.duration=lt(e),B+=4;let ue=[];N.effects=ue;let We=ke(e);for(let $e=0;$e<We;$e++){let Ue={};ue[$e]=Ue,Ue.body=qe(e),B+=1,Ue.end=lt(e),B+=4,Ue.id=qe(e),B+=1,Ue.priority=qe(e),B+=1,Ue.start=lt(e),B+=4,Ue.type=qe(e),B+=1}N.id=qe(e),B+=1,N.movement=qe(e),B+=1,N.priority=qe(e),B+=1;let ze=[];N.sounds=ze;let Ae=ke(e);for(let $e=0;$e<Ae;$e++){let Ue={};ze[$e]=Ue,Ue.end=qe(e),B+=1,Ue.id=qe(e),B+=1,Ue.start=lt(e),B+=4}}let i=[];n.areas=i;let r=ke(e);for(let ee=0;ee<r;ee++){let N={};i[ee]=N,N.ambientday=qe(e),B+=1,N.ambientnight=qe(e),B+=1,N.id=qe(e),B+=1,N.music=qe(e),B+=1,N.name=Ln(e)}let l=[];n.arenas=l;let a=ke(e);for(let ee=0;ee<a;ee++){let N={};l[ee]=N,N.group=qe(e),B+=1,N.id=qe(e),B+=1;let ue=[];N.pos=ue;let We=ke(e);for(let ze=0;ze<We;ze++)ue[ze]=lt(e),B+=4;N.radius=qe(e),B+=1,N.rot=lt(e),B+=4,N.type=qe(e),B+=1,N.world=qe(e),B+=1}let c=[];n.classes=c;let f=ke(e);for(let ee=0;ee<f;ee++){let N={};c[ee]=N;let ue=[];N.baseStats=ue;let We=ke(e);for(let Je=0;Je<We;Je++){let Et=[];ue[Je]=Et;let xe=ke(e);for(let Ke=0;Ke<xe;Ke++)Et[Ke]=qe(e),B+=1}let ze=[];N.engineSkills=ze;let Ae=ke(e);for(let Je=0;Je<Ae;Je++)ze[Je]=qe(e),B+=1;N.id=qe(e),B+=1;let $e=[];N.startSkills=$e;let Ue=ke(e);for(let Je=0;Je<Ue;Je++)$e[Je]=qe(e),B+=1;let mt=[];N.statPerLevel=mt;let wt=ke(e);for(let Je=0;Je<wt;Je++){let Et=[];mt[Je]=Et;let xe=ke(e);for(let Ke=0;Ke<xe;Ke++)Et[Ke]=qe(e),B+=1}}let u=[];n.creatures=u;let m=ke(e);for(let ee=0;ee<m;ee++){let N={};u[ee]=N;let ue=[];N.col1=ue;let We=ke(e);for(let $e=0;$e<We;$e++)ue[$e]=lt(e),B+=4;let ze=[];N.col2=ze;let Ae=ke(e);for(let $e=0;$e<Ae;$e++)ze[$e]=lt(e),B+=4;N.drProtection=!!_o(e),B+=1,N.faction=qe(e),B+=1,N.id=Ot(e),B+=2,N.level=qe(e),B+=1,N.name=Ln(e),N.skin=qe(e),B+=1,N.type=qe(e),B+=1}let g=[];n.creaturesConjurer=g;let v=ke(e);for(let ee=0;ee<v;ee++){let N={};g[ee]=N,N.id=Ot(e),B+=2,N.war=!!_o(e),B+=1}let _=[];n.creaturesMonster=_;let b=ke(e);for(let ee=0;ee<b;ee++){let N={};_[ee]=N,N.aggroMode=qe(e),B+=1,N.id=Ot(e),B+=2,N.rarity=qe(e),B+=1}let k=[];n.creaturesTrader=k;let y=ke(e);for(let ee=0;ee<y;ee++){let N={};k[ee]=N,N.id=Ot(e),B+=2,N.shop=qe(e),B+=1}let F=[];n.effects=F;let A=ke(e);for(let ee=0;ee<A;ee++){let N={};F[ee]=N,N.duration=lt(e),B+=4;let ue=[];N.events=ue;let We=ke(e);for(let $e=0;$e<We;$e++){let Ue={};ue[$e]=Ue,Ue.fraction=lt(e),B+=4,Ue.id=qe(e),B+=1;let mt=[];Ue.params=mt;let wt=ke(e);for(let Je=0;Je<wt;Je++)mt[Je]=lt(e),B+=4}N.id=qe(e),B+=1;let ze=[];N.periods=ze;let Ae=ke(e);for(let $e=0;$e<Ae;$e++){let Ue={};ze[$e]=Ue,Ue.fractionEnd=lt(e),B+=4,Ue.fractionStart=lt(e),B+=4,Ue.id=qe(e),B+=1;let mt=[];Ue.modifiers=mt;let wt=ke(e);for(let xe=0;xe<wt;xe++){let Ke={};mt[xe]=Ke,Ke.id=qe(e),B+=1,Ke.mode=qe(e),B+=1;let bt=[];Ke.params=bt;let Ct=ke(e);for(let Ve=0;Ve<Ct;Ve++)bt[Ve]=lt(e),B+=4}let Je=[];Ue.params=Je;let Et=ke(e);for(let xe=0;xe<Et;xe++)Je[xe]=lt(e),B+=4}}let C=[];n.environments=C;let M=ke(e);for(let ee=0;ee<M;ee++){let N={};C[ee]=N;let ue=[];N.ambient=ue;let We=ke(e);for(let Te=0;Te<We;Te++){let it=[];ue[Te]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let ze=[];N.bloom=ze;let Ae=ke(e);for(let Te=0;Te<Ae;Te++)ze[Te]=lt(e),B+=4;let $e=[];N.clouds=$e;let Ue=ke(e);for(let Te=0;Te<Ue;Te++){let it=[];$e[Te]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let mt=[];N.direct=mt;let wt=ke(e);for(let Te=0;Te<wt;Te++){let it=[];mt[Te]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let Je=[];N.fog=Je;let Et=ke(e);for(let Te=0;Te<Et;Te++){let it=[];Je[Te]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let xe=[];N.horizon=xe;let Ke=ke(e);for(let Te=0;Te<Ke;Te++){let it=[];xe[Te]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}N.id=qe(e),B+=1;let bt=[];N.skybot=bt;let Ct=ke(e);for(let Te=0;Te<Ct;Te++){let it=[];bt[Te]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let Ve=[];N.skymid=Ve;let be=ke(e);for(let Te=0;Te<be;Te++){let it=[];Ve[Te]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let Vt=[];N.skytop=Vt;let Ht=ke(e);for(let Te=0;Te<Ht;Te++){let it=[];Vt[Te]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let Lt=[];N.sun=Lt;let Rt=ke(e);for(let Te=0;Te<Rt;Te++){let it=[];Lt[Te]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let He=[];N.water=He;let et=ke(e);for(let Te=0;Te<et;Te++){let it=[];He[Te]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}}let V=[];n.files=V;let $=ke(e);for(let ee=0;ee<$;ee++){let N={};V[ee]=N,N.ext=qe(e),B+=1,N.id=Ot(e),B+=2,N.type=qe(e),B+=1}let D=[];n.filesExt=D;let z=ke(e);for(let ee=0;ee<z;ee++)D[ee]=Ln(e);let q=[];n.foliages=q;let L=ke(e);for(let ee=0;ee<L;ee++){let N={};q[ee]=N,N.id=qe(e),B+=1;let ue=[];N.nodes=ue;let We=ke(e);for(let ze=0;ze<We;ze++){let Ae={};ue[ze]=Ae,Ae.arc=lt(e),B+=4;let $e=[];Ae.end=$e;let Ue=ke(e);for(let xe=0;xe<Ue;xe++)$e[xe]=lt(e),B+=4;Ae.geotype=qe(e),B+=1,Ae.jitter_radius=lt(e),B+=4,Ae.jitter_rotation=lt(e),B+=4,Ae.jitter_size=lt(e),B+=4,Ae.jitter_slant=lt(e),B+=4,Ae.jitter_y=lt(e),B+=4,Ae.leafCount=qe(e),B+=1;let mt=[];Ae.points=mt;let wt=ke(e);for(let xe=0;xe<wt;xe++)mt[xe]=lt(e),B+=4;Ae.radius=lt(e),B+=4,Ae.size=lt(e),B+=4,Ae.slant=lt(e),B+=4;let Je=[];Ae.start=Je;let Et=ke(e);for(let xe=0;xe<Et;xe++)Je[xe]=lt(e),B+=4;Ae.y=lt(e),B+=4}N.seed=gs(e),B+=4,N.texture=Ot(e),B+=2,N.type=qe(e),B+=1}let O=[];n.meshes=O;let j=ke(e);for(let ee=0;ee<j;ee++){let N={};O[ee]=N,N.cull=qe(e),B+=1;let ue=[];N.effects=ue;let We=ke(e);for(let ze=0;ze<We;ze++){let Ae={};ue[ze]=Ae,Ae.id=qe(e),B+=1;let $e=[];Ae.pos=$e;let Ue=ke(e);for(let xe=0;xe<Ue;xe++)$e[xe]=lt(e),B+=4;let mt=[];Ae.rot=mt;let wt=ke(e);for(let xe=0;xe<wt;xe++)mt[xe]=lt(e),B+=4;let Je=[];Ae.scale=Je;let Et=ke(e);for(let xe=0;xe<Et;xe++)Je[xe]=lt(e),B+=4}N.geometry=Ot(e),B+=2,N.id=Ot(e),B+=2,N.shader=qe(e),B+=1,N.shadow=qe(e),B+=1,N.texture=Ot(e),B+=2}let R=[];n.minimap=R;let U=ke(e);for(let ee=0;ee<U;ee++){let N={};R[ee]=N,N.img=Ot(e),B+=2;let ue=[];N.pos=ue;let We=ke(e);for(let ze=0;ze<We;ze++)ue[ze]=Ot(e),B+=2;N.world=qe(e),B+=1}let Z=[];n.particles=Z;let ye=ke(e);for(let ee=0;ee<ye;ee++){let N={};Z[ee]=N;let ue=[];N.acc=ue;let We=ke(e);for(let mt=0;mt<We;mt++)ue[mt]=lt(e),B+=4;N.blend=qe(e),B+=1;let ze=[];N.colEnd=ze;let Ae=ke(e);for(let mt=0;mt<Ae;mt++)ze[mt]=lt(e),B+=4;let $e=[];N.colStart=$e;let Ue=ke(e);for(let mt=0;mt<Ue;mt++)$e[mt]=lt(e),B+=4;N.duration=lt(e),B+=4,N.friction=lt(e),B+=4,N.id=qe(e),B+=1,N.idEnd=qe(e),B+=1,N.idLoop=qe(e),B+=1,N.idStart=qe(e),B+=1,N.interp=qe(e),B+=1,N.randomRota=lt(e),B+=4,N.rota=lt(e),B+=4,N.rotaEnd=lt(e),B+=4,N.scaleEnd=lt(e),B+=4,N.scaleStart=lt(e),B+=4}let we=[];n.ribbons=we;let he=ke(e);for(let ee=0;ee<he;ee++){let N={};we[ee]=N;let ue=[];N.colEnd=ue;let We=ke(e);for(let $e=0;$e<We;$e++)ue[$e]=lt(e),B+=4;let ze=[];N.colStart=ze;let Ae=ke(e);for(let $e=0;$e<Ae;$e++)ze[$e]=lt(e),B+=4;N.id=qe(e),B+=1,N.interval=lt(e),B+=4,N.steps=qe(e),B+=1,N.texture=Ot(e),B+=2}let re=[];n.skeletons=re;let le=ke(e);for(let ee=0;ee<le;ee++){let N={};re[ee]=N,N.cape=!!_o(e),B+=1,N.groundNormal=!!_o(e),B+=1,N.height=lt(e),B+=4,N.helmet=!!_o(e),B+=1,N.id=qe(e),B+=1,N.shoulders=!!_o(e),B+=1}let ve=[];n.skins=ve;let _e=ke(e);for(let ee=0;ee<_e;ee++){let N={};ve[ee]=N,N.animset=qe(e),B+=1;let ue=[];N.body=ue;let We=ke(e);for(let Ve=0;Ve<We;Ve++){let be={};ue[Ve]=be,be.bid=qe(e),B+=1;let Vt=[];be.col=Vt;let Ht=ke(e);for(let Ze=0;Ze<Ht;Ze++)Vt[Ze]=lt(e),B+=4;be.colMode=qe(e),B+=1,be.lod=qe(e),B+=1,be.mid=Ot(e),B+=2,be.pid=_o(e),B+=1;let Lt=[];be.pos=Lt;let Rt=ke(e);for(let Ze=0;Ze<Rt;Ze++)Lt[Ze]=lt(e),B+=4;let He=[];be.rot=He;let et=ke(e);for(let Ze=0;Ze<et;Ze++)He[Ze]=lt(e),B+=4;let Te=[];be.scl=Te;let it=ke(e);for(let Ze=0;Ze<it;Ze++)Te[Ze]=lt(e),B+=4;be.ts=qe(e),B+=1}N.capeswing=qe(e),B+=1;let ze=[];N.colPrim=ze;let Ae=ke(e);for(let Ve=0;Ve<Ae;Ve++)ze[Ve]=lt(e),B+=4;let $e=[];N.colSec=$e;let Ue=ke(e);for(let Ve=0;Ve<Ue;Ve++)$e[Ve]=lt(e),B+=4;let mt=[];N.effects=mt;let wt=ke(e);for(let Ve=0;Ve<wt;Ve++){let be={};mt[Ve]=be,be.bid=qe(e),B+=1,be.id=qe(e),B+=1}N.id=qe(e),B+=1,N.mountPart=qe(e),B+=1;let Je=[];N.mountPos=Je;let Et=ke(e);for(let Ve=0;Ve<Et;Ve++)Je[Ve]=lt(e),B+=4;let xe=[];N.sheathedPos=xe;let Ke=ke(e);for(let Ve=0;Ve<Ke;Ve++)xe[Ve]=lt(e),B+=4;N.size=lt(e),B+=4,N.skeleton=qe(e),B+=1,N.soundset=qe(e),B+=1;let bt=[];N.unsheathedPos=bt;let Ct=ke(e);for(let Ve=0;Ve<Ct;Ve++)bt[Ve]=lt(e),B+=4}let Ie=[];n.sounds=Ie;let oe=ke(e);for(let ee=0;ee<oe;ee++){let N={};Ie[ee]=N,N.distance=lt(e),B+=4;let ue=[];N.files=ue;let We=ke(e);for(let ze=0;ze<We;ze++)ue[ze]=Ot(e),B+=2;N.id=qe(e),B+=1}let Ee=[];n.soundsetSteps=Ee;let K=ke(e);for(let ee=0;ee<K;ee++){let N={};Ee[ee]=N,N.id=qe(e),B+=1;let ue=[];N.steps=ue;let We=ke(e);for(let ze=0;ze<We;ze++)ue[ze]=qe(e),B+=1}let Re=[];n.soundsets=Re;let Ge=ke(e);for(let ee=0;ee<Ge;ee++){let N={};Re[ee]=N,N.id=qe(e),B+=1;let ue=[];N.sounds=ue;let We=ke(e);for(let ze=0;ze<We;ze++)ue[ze]=qe(e),B+=1;N.steps=qe(e),B+=1}let Qe=[];n.terrains=Qe;let Ye=ke(e);for(let ee=0;ee<Ye;ee++){let N={};Qe[ee]=N,N.brightest=qe(e),B+=1,N.darkest=qe(e),B+=1;let ue=[];N.foliage=ue;let We=ke(e);for(let ze=0;ze<We;ze++){let Ae=[];ue[ze]=Ae;let $e=ke(e);for(let Ue=0;Ue<$e;Ue++)Ae[Ue]=qe(e),B+=1}N.id=qe(e),B+=1,N.scale=qe(e),B+=1,N.spec=qe(e),B+=1,N.texture=Ot(e),B+=2}let pe=[];n.traderShopItems=pe;let ce=ke(e);for(let ee=0;ee<ce;ee++){let N={};pe[ee]=N,N.bind=qe(e),B+=1,N.id=qe(e),B+=1,N.shop=qe(e),B+=1,N.stacks=qe(e),B+=1,N.tier=Ot(e),B+=2,N.type=Ln(e),N.upgrade=qe(e),B+=1}let Oe=[];n.worlds=Oe;let se=ke(e);for(let ee=0;ee<se;ee++){let N={};Oe[ee]=N,N.chunkAmount=qe(e),B+=1,N.id=qe(e),B+=1,N.minlevel=qe(e),B+=1,N.music=qe(e),B+=1,N.name=Ln(e)}return n}};var Mt={clientPlayerInput:u3,clientPlayerChangeTarget:m3,clientPlayerSkill:p3,clientPlayerEnvSkill:d3,clientPlayerInteract:h3,clientCommand:g3,serverOnClientConnect:F3,serverEntityDelta:v3,serverPartyUpdate:_3,serverWarUpdate:b3,serverPartyPositions:y3,serverChangeWorld:w3,serverMapUpdate:k3,serverChat:x3,serverSystemMessage:M3,serverQueue:C3,ping:S3},Ca={chunk:P3,gamedata:T3,modelformat:A3},E3=[],ZT=0;for(let t in Mt)Mt[t]&&(Mt[t].header=ZT++,Mt[t].packData=function(e){return e._header=this.header,this.encode(e)},E3.push(Mt[t]));var I3=t=>{if(t.length===0)return;let e=E3[t[0]];if(!(e&&e.maxSize<t.length))return e};var I,Ap=[0,1,0];var _t=[0,0,0],kn=[0,0,0],tl=[0,0,0],bo=[0,0,0],Tp=[0,0,0],Cf=[0,0,0];var Mi=[0,0,0,0];var $n=[0,0],Ko=[0,0];var RO=go(),D3=t=>{I=t},Fi=0,V3=t=>Fi=t;var lh={};Kn(lh,{onWorldEnter:()=>KT,parseBandwidth:()=>ih,parseFrameDelta:()=>L3,parseLatency:()=>rh,tick:()=>JT});var gt=(t,e,n)=>Math.min(Math.max(t,e),n),Sa=(t,e)=>(t%e+e)%e,Sf=(t,e,n)=>{let s=gt((n-t)/(e-t),0,1);return s*s*(3-2*s)},yo=(t,e,n,s,o)=>s+(gt(t,e,n)-e)/(n-e)*(o-s),Pf=(t,e,n)=>e+gt(t,0,1)*(n-e),Jt={linear:t=>t,easeInQuad:t=>t*t,easeInQuart:t=>t**4,easeOutQuad:t=>t*(2-t),easeOutExpo:t=>-Math.pow(2,-10*t)+1,easeOutFlick:t=>1-Math.pow(1-t,10),sin:t=>Math.sin(t*3.14),sinReverse:t=>1-Math.sin(t*3.14),easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeBounce:t=>t<.36363636363636365?7.5625*t*t:t<.7272727272727273?7.5625*(t-=.5454545454545454)*t+.75:t<.9090909090909091?7.5625*(t-=.8181818181818182)*t+.9375:7.5625*(t-=.9545454545454546)*t+.984375,anticipate:t=>-1/(1+Math.exp((t-.5)*50))+Math.sin((t-.5)*6.2)*1.4*(1-t*.5)+1,flicker:t=>Math.sin(t*3.14)*(1+Math.sin(t*38)*.3)},Ki=(t,e,n)=>t<e?yo(t,0,e,0,n):yo(Jt.easeInOutCubic(yo(t,e,1,0,1)),0,1,n,1),Pa=[Jt.linear,Jt.easeInQuad,Jt.easeInQuart,Jt.easeOutQuad,Jt.easeOutExpo,Jt.easeOutFlick,Jt.sin,Jt.sinReverse,Jt.easeInOutCubic,Jt.easeInOutQuint,Jt.easeBounce,Jt.anticipate,Jt.flicker];var kt=class{constructor(e=0,n=0){this.start=e,this.end=e+n,this.duration=n}done(e){return e>this.end}fraction(e){return gt(1-(this.end-e)/this.duration,0,1)}remaining(e){return this.end-e}passed(e){return e-this.start}reset(e,n=this.duration){return this.start=e,this.end=e+n,this.duration=n,!0}set(e,n){return this.start=e,this.end=n,this.duration=this.end-this.start,!0}};var nh=.016,L3=t=>{nh=(nh*10+t)/11},q3=0,eh=0,ih=t=>{q3=t},sh=0,rh=t=>{sh=(sh*2+t)/3},th=0,oh=new kt(0,.05),JT=t=>{L3(t),fe.showFpsPing&&oh.done(I.time)&&(eh=(eh*10+q3)/11,th=(th*5+I.netData.length)/6,oh.reset(I.time),km.update(e=>(e[0]=gt(sh>>0,1,999),e[1]=(1/nh).toFixed(1),e[2]=(eh/1e3).toFixed(1),e[3]=I.player?`${~~I.player.pos[0]} ${~~I.player.pos[1]} ${~~I.player.pos[2]}`:"-",e[4]=th.toFixed(1),e)))},KT=t=>{oh.reset(t.time)};var e7=performance,Af=()=>e7.now();var ko,ch=0,R3=0,$3=(t,e)=>{Un(Mt.serverOnClientConnect.header,n=>{t(Mt.serverOnClientConnect.decode(n))}),Un("close",n=>{e(n.code)})},nl={open:[],close:[]};for(let t in Mt)nl[Mt[t].header]=[];var t7=t=>{},n7=t=>{console.log("Connected"),ch=1;for(let e=0,n=nl.open.length;e<n;++e)nl.open[e](t)},s7=t=>{console.log("Connection closed:",t.reason,t.code),ch=0,ko.close(),ko=void 0;for(let e=0,n=nl.close.length;e<n;++e)nl.close[e](t)},o7=t=>{i7(t.data.byteLength),t=new Uint8Array(t.data);let e=I3(t),n=e&&nl[e.header];if(n)for(let s=0,o=n.length;s<o;++s)n[s](t)},Un=(t,e)=>{nl[t].push(e)},Es=t=>{ko===void 0||ch!==1||ko.send(t)},U3=t=>{if(ko!==void 0)return;let e="game1.hordes.io";ko=new WebSocket(`wss://${e}:`+t+"/play"),ko.binaryType="arraybuffer",ko.onerror=t7,ko.onopen=n7,ko.onclose=s7,ko.onmessage=o7};var z3=0,ah=0,i7=t=>{ah+=t,Fi-z3>1e3/4&&(R3=ah*4,ah=0,z3=Fi,ih(R3))},O3=()=>{fe.showFpsPing&&Fi-B3>(Ef.length<10?100:2e3)&&(B3=Fi,r7())},N3=t=>{if(Ef[t.id]){let e=Af();if(Ef[t.id]<=e){let n=e-Ef[t.id];rh(n)}}},Tf=0,B3=0,Ef=[],r7=()=>{Tf>254&&(Tf=0),Ef[Tf]=Af(),Es(Mt.ping.packData({id:Tf})),Tf++};var yt=(t,e="")=>{Es(Mt.clientCommand.packData({command:t,string:e+""}))};var ol={report:{client:!0},partyleave:{},partyinvite:{a:1},partycreate:{},time:{},bosslog:{},party:{a:1,chat:!0},clan:{a:1,chat:!0},faction:{a:1,chat:!0}},Ci={itemmove:{a:2},itemdrop:{a:1},itemauctionpost:{a:2},itemauctionfind:{a:5},itemauctionbuy:{a:1},itemauctioncancel:{a:1},itemstash:{a:1},itemunstash:{a:1},itemsplithalf:{a:1},itemsplitone:{a:1},goldstash:{a:1},itemtradersell:{a:1},itemtraderbuy:{a:1},itemblacksmithupgrade:{a:1},tutstep:{a:2},petlootsettings:{a:2},statincrease:{a:2},skillconfig:{a:1},cancelbuff:{a:1},respawn:{},startqueue:{a:1},stopqueue:{a:1},partyaccept:{a:1},partydecline:{a:1},partykick:{a:1},partysetrole:{a:2},summonaccept:{a:1},whisper:{a:2,chat:!0},global:{a:1},...ol};var j3=t=>{navigator.clipboard.writeText(t)};var mh={};Kn(mh,{addRequest:()=>Aa,confirmationBasedCallback:()=>Ip,onWorldDestroy:()=>c7,onWorldEnter:()=>a7,postTick:()=>l7,removeTopRequest:()=>uh});var fh=new kt(0,1),ei=[],l7=(t,e)=>{fh.done(e.time)&&(fh.reset(e.time),ei.length&&(ei.forEach(n=>{W3(n,1)}),ui.set(ei)))},a7=t=>{fh.reset(0)},c7=t=>{ei.length=0,ui.set(ei)},Aa=(t,e,n)=>{let s={title:t,text:e,choices:n};ei.push(s),W3(s,0),ui.set(ei)},W3=(t,e)=>{for(let n=0;n<t.choices.length;++n){let s=t.choices[n];if(s.blockedTime!==void 0)s.blockedTime>1?(s.blockedTime-=e,s.unavailable=`(${s.blockedTime} s)`):s.unavailable=void 0;else if(s.nocombat&&I&&I.player&&I.player.stats){let o=~~I.player.stats.combatTimer.remaining(I.time);o>0?s.unavailable=`(Combat - ${o}s)`:s.unavailable=void 0}s.remaining!==void 0&&(s.remaining>1?(s.remaining-=e,s.additional=`(${~~s.remaining}s remaining)`):(s.additional=void 0,s.unavailable="(Timed out)"))}},uh=()=>{ei.length&&(ei.shift(),ui.set(ei))},Ep=!0,Ip=(t,e,n,s)=>{t?Ep&&(Aa(n,s,[{text:n,fun:()=>{Ep=!0,e()}},{text:P.ui.decline,fun:()=>{Ep=!0}}]),Ep=!1):e()};var Vp={};Kn(Vp,{init:()=>u7,onRemoveEntity:()=>dh,onWorldDestroy:()=>p7,party:()=>Xt,postTick:()=>m7,setListed:()=>ph});var Dp,f7=0,If=0,G3=!1,ph=t=>{G3=t},Xt=new Map,u7=()=>{Un(Mt.serverPartyUpdate.header,t=>{Dp=t}),Un(Mt.serverPartyPositions.header,t=>{t=Mt.serverPartyPositions.decode(t).members,Xt.forEach(e=>{let n=t.find(s=>s.entityid===e.id);n&&(e.pos[0]=n.pos[0],e.pos[1]=n.pos[1])})})},m7=(t,e)=>{if(e.player!==void 0){if(Dp){Xt.forEach(s=>{s.found=!1});let n=Mt.serverPartyUpdate.decode(Dp);n.members.forEach(s=>{if(!Xt.has(s.name))Xt.set(s.name,{id:s.entityid,found:!0,pos:[0,0],local:s.world===e.id,name:s.name,buffStore:s.entityid===e.playerId?aa:te([]),unitStore:s.entityid===e.playerId?Wo:te({id:s.entityid,name:s.name,level:s.level,class:s.class,world:s.world,role:s.role,party:e.player.party,faction:e.player.faction,type:0,visible:!0,alive:!0,rarity:!1,range:!1})});else{let o=Xt.get(s.name);s.entityid!==e.playerId&&(o.local=s.world===e.id,o.unitStore.update(i=>(i.id=s.entityid,i.name=s.name,i.level=s.level,i.class=s.class,i.world=s.world,i.party=e.player.party,i.faction=e.player.faction,i.role=s.role,i))),o.id=s.entityid,o.found=!0}}),Xt.forEach((s,o)=>{s.found||Xt.delete(o)}),la.set(Array.from(Xt.values()).filter(s=>fe.showSelfInParty||s.id!==e.playerId)),es.update(s=>(s.membercount=n.members.length,s.queues=n.queues,fe.partyinfo=s,s)),Dp=void 0}if(e.player.party>0)if(!fe.partyBuffLimitUpdateRate)e.entities.type[0].forEach(n=>{n.party===e.player.party&&(n.buffDisplayDirty=!0)});else{let n=Array.from(Xt.values())[f7++%Xt.size];if(n){let s=e.entity(n.id);s!==void 0&&s.id!==e.playerId&&(s.buffDisplayDirty=!0)}}}fe.leaveEmptyParty&&(Xt.size!==1||G3?If=0:(If+=t,If>35&&(yt("partyleave"),If=0)))},dh=t=>{if(Xt.has(t.name)){let e=Xt.get(t.name);e.unitStore.update(n=>(n.timedSkill=void 0,n.timedCast=void 0,n.alive=!0,n.range=!1,n.mp=n.hp=n.hpMax=n.mpMax=0,n)),e.buffStore.set([])}},p7=()=>{Xt.clear(),If=0};var Gh={};Kn(Gh,{onWorldEnter:()=>$9,postTick:()=>U9,steps:()=>ys,tut:()=>an});function H3(t,e){return t[0]=e[0],t[1]=e[1],t}function vs(t,e,n){return t[0]=e,t[1]=n,t}function Y3(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function Ta(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Df(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function hh(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t}function Ea(t){let e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function X3(t){let e=t[0],n=t[1];return e*e+n*n}function Lp(t,e){let n=e[0],s=e[1],o=n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Q3(t,e,n){let s=Math.sin(n),o=Math.cos(n);return t[0]=e[1]*s+e[0]*o,t[1]=e[1]*o-e[0]*s,t}var qp=[0,0,0],Z3=(t,e,n,s,o)=>{if(t.length>0){Y(e,1/0,1/0,1/0),Y(n,-1/0,-1/0,-1/0);for(let i=0,r=t.length;i<r;i+=3){let l=t[i],a=t[i+1],c=t[i+2];e[0]=Math.min(l,e[0]),e[1]=Math.min(a,e[1]),e[2]=Math.min(c,e[2]),n[0]=Math.max(l,n[0]),n[1]=Math.max(a,n[1]),n[2]=Math.max(c,n[2])}}else Y(e,0,0,0),Y(n,-0,-0,-0);Zt(o,n,e),gn(s,Bn(s,e,n),.5)},d7=t=>{Z3(t.attributes.position.data,t.bounds.min,t.bounds.max,t.bounds.center,t.bounds.scale),t.bounds.initiated=!0},h7=t=>{let e=0;for(let n=0,s=t.attributes.position.data.length;n<s;n+=3)qp[0]=t.attributes.position.data[n],qp[1]=t.attributes.position.data[n+1],qp[2]=t.attributes.position.data[n+2],e=Math.max(e,ss(t.bounds.center,qp));t.bounds.radius=Math.sqrt(e)},J3=t=>{t.bounds.initiated||d7(t),h7(t)};var g7=1,v7=1,Sn=t=>{let e={id:g7++,vao:G_(),vaoNeedsUpdate:!0,attributes:t,drawRangeStart:0,drawRangeCount:0,attrRange:0,instancedCount:0,isInstanced:!1,bounds:{min:[0,0,0],max:[0,0,0],center:[0,0,0],scale:[0,0,0],radius:1/0,initiated:!1}};return gh(e,e.attributes),e},_s=(t,e)=>{tt.boundBuffer!==e.id&&(W.bindBuffer(e.target,e.buffer),tt.boundBuffer=e.id),e.bufferLen<e.data.length?(e.bufferLen=e.data.length,W.bufferData(e.target,e.data,e.bufferMode,0,e.data.length)):W.bufferSubData(e.target,0,e.data,0,e.data.length)},Rp=(t,e,n)=>{tt.boundBuffer!==e.id&&(W.bindBuffer(e.target,e.buffer),tt.boundBuffer=e.id);let s=n*e.size;e.bufferLen<s?(e.bufferLen=s,W.bufferData(e.target,e.data,e.bufferMode,0,s)):W.bufferSubData(e.target,0,e.data,0,s)},_7=(t,e,n)=>{n.id=v7++,n.size=n.size||1,n.type=n.type||(n.data.constructor===Float32Array?W.FLOAT:n.data.constructor===Uint16Array?W.UNSIGNED_SHORT:W.UNSIGNED_INT),n.target=e==="index"?W.ELEMENT_ARRAY_BUFFER:W.ARRAY_BUFFER,n.normalize=n.normalize||!1,n.count=n.data.length/n.size,n.divisor=n.instanced?typeof n.instanced=="number"?n.instanced:1:0,n.bufferMode=n.bufferMode||W.STATIC_DRAW,n.bufferLen=0,n.buffer||(n.buffer=W.createBuffer()),_s(t,n)},b7=(t,e,n)=>{if(t.attributes[e]=n,n.divisor){if(t.isInstanced=!0,t.instancedCount&&t.instancedCount!==n.count*n.divisor)return t.instancedCount=Math.min(t.instancedCount,n.count*n.divisor);t.instancedCount=n.count*n.divisor}else e==="index"?t.drawRangeCount=n.count:t.attributes.index||(t.drawRangeCount=Math.max(t.drawRangeCount,n.count))},gh=(t,e)=>{zm(null),tt.currentGeometry=-1;for(let n in e)e[n].id===void 0&&_7(t,n,e[n]),b7(t,n,e[n]);t.attributes.position&&J3(t)},ey=(t,e,n)=>{t.attrRange=n,t.drawRangeStart=e,t.drawRangeCount=n},zp=(t,e)=>{t.instancedCount=e},y7=(t,e)=>{zm(t.vao);for(let n=0;n<e.attributeLocations.length;++n){let s=e.attributeLocations[n];if(!t.attributes[s])continue;let o=t.attributes[s];if(W.bindBuffer(W.ARRAY_BUFFER,o.buffer),tt.boundBuffer=o.id,o.size>4){let i=o.size/4,r=i*4,l=r*4;for(let a=0;a<i;++a)W.vertexAttribPointer(n+a,i,W.FLOAT,!1,l,r*a),W.enableVertexAttribArray(n+a),ba(n+a,1)}else W.vertexAttribPointer(n,o.size,o.type,o.normalize,0,0),W.enableVertexAttribArray(n),ba(n,o.divisor)}t.attributes.index&&W.bindBuffer(W.ELEMENT_ARRAY_BUFFER,t.attributes.index.buffer),t.vaoNeedsUpdate=!1},Ia=(t,e)=>{tt.currentGeometry!==t.id&&(t.vaoNeedsUpdate&&y7(t,e),zm(t.vao),tt.currentGeometry=t.id)},Da=(t,e,n)=>{Ia(t,e),t.isInstanced?t.attributes.index?W_(n,t.drawRangeCount,t.attributes.index.type,t.drawRangeStart,t.instancedCount):j_(n,t.drawRangeStart,t.drawRangeCount,t.instancedCount):t.attributes.index?W.drawElements(n,t.drawRangeCount,t.attributes.index.type,t.drawRangeStart):W.drawArrays(n,t.drawRangeStart,t.drawRangeCount)};var k7=1,un=({vertex:t,fragment:e,uniforms:n={},instanced:s=[],active:o=!0,transparent:i=!1,cullFace:r=W.BACK,frontFace:l=W.CCW,depthTest:a=!0,depthWrite:c=!0,depthFunc:f=W.LESS,globalUniforms:u={},attributeLocations:m})=>{let g={id:k7++,program:W.createProgram(),active:o,transparent:i,cullFace:r,frontFace:l,depthTest:a,depthWrite:c,depthFunc:f,blendFunc:{},blendEquation:{},uniforms:n,autoUniforms:[],uniformArray:[],samplerNames:[],samplerTexUnits:[],samplerTexArray:[],samplerTextures:[],globalUniforms:u,instancedAttributes:s,attributeLocations:m};g.transparent&&!g.blendFunc.src&&Lf(g,W.SRC_ALPHA,W.ONE_MINUS_SRC_ALPHA);let v=ty(t,W.VERTEX_SHADER),_=ty(e,W.FRAGMENT_SHADER);for(let b=0;b<m.length;++b)W.bindAttribLocation(g.program,b,m[b]);return W.attachShader(g.program,v),W.attachShader(g.program,_),W.linkProgram(g.program),W.deleteShader(v),W.deleteShader(_),g},ny=(t,e)=>{W.useProgram(t.program),tt.currentProgram=t.id;let n=W.getProgramParameter(t.program,W.ACTIVE_UNIFORMS),s=0,o=2;for(let i=0;i<n;i++){let r=W.getActiveUniform(t.program,i),l=W.getUniformLocation(t.program,r.name);if(l===null)continue;let a=r.name.match(/(\w+)/g)[0],c=r.type,f=c===35678||c===35682||c===36289,u=c===35682;if(f){let m=r.size,g=[];for(let v=0;v<m;++v){let _=u?s++:o++;g.push(_),t.samplerNames.push(a),t.samplerTexUnits.push(_),t.samplerTexArray.push(m===1?-1:v)}m===1?W.uniform1i(l,g[0]):W.uniform1iv(l,g)}else{e[a]?t.uniforms[a]||(t.uniforms[a]=e[a]):t.uniforms[a]||(M7.has(a)||t.autoUniforms.push(a),t.uniforms[a]={value:void 0});let m={name:a,location:l,type:c,data:t.uniforms[a],fun:w7(c,t.uniforms[a].value)};t.uniformArray.push(m)}}},sy=(t,e)=>{for(let n=0;n<e.length;++n){let s=e[n],o=W.getUniformBlockIndex(t.program,s.name);o!==W.INVALID_INDEX&&s.index>=0&&W.uniformBlockBinding(t.program,o,s.index)}},Va=(t,e)=>{e||(W.useProgram(t.program),tt.currentProgram=t.id),La(t),_h(t.uniformArray),Vf(t),qa(t)},qn=(t,e,n,s)=>{let o=s.samplerNames.indexOf(t);o>=0?s.samplerTextures[o+n]=e:console.log("unknown texture type",t,s)},La=t=>{for(let e=0;e<t.samplerNames.length;++e){let n=t.samplerNames[e],s=t.samplerTexArray[e];t.globalUniforms[n]&&t.globalUniforms[n].value&&(s<0?t.samplerTextures[e]=t.globalUniforms[n].value:t.samplerTextures[e]=t.globalUniforms[n].value[s])}},Bp=(t,e)=>{for(let n=0;n<e.samplerNames.length;++n){let s=e.samplerNames[n],o=e.samplerTexArray[n];t[s]&&(o<0?e.samplerTextures[n]=t[s]:e.samplerTextures[n]=t[s][o])}},Vf=t=>{for(let e=0;e<t.samplerTexUnits.length;++e){let n=t.samplerTexUnits[e],s=t.samplerTextures[e];s&&tt.textureUnits[n]!==s.id&&(ef(n),W.bindTexture(s.target,s.texture),tt.textureUnits[n]=s.id)}},Lf=(t,e,n,s,o)=>{t.blendFunc.src=e,t.blendFunc.dst=n,t.blendFunc.srcAlpha=s,t.blendFunc.dstAlpha=o,e&&(t.transparent=!0)},vh={},ty=(t,e)=>{if(vh[t]!==void 0)return vh[t];let n=vh[t]=W.createShader(e);return W.shaderSource(n,t),W.compileShader(n),n},qa=t=>{t.depthTest?Kc(W.DEPTH_TEST):Bm(W.DEPTH_TEST),t.cullFace?Kc(W.CULL_FACE):Bm(W.CULL_FACE),t.blendFunc.src?Kc(W.BLEND):Bm(W.BLEND),t.cullFace&&Z_(t.cullFace),J_(t.frontFace),N1(t.depthWrite),K_(t.depthFunc),t.blendFunc.src&&X_(t.blendFunc.src,t.blendFunc.dst,t.blendFunc.srcAlpha,t.blendFunc.dstAlpha),t.blendEquation.modeRGB&&Q_(t.blendEquation.modeRGB,t.blendEquation.modeAlpha)},_h=t=>{for(let e=0;e<t.length;++e){let n=t[e];x7(W,n.fun,n.location,n.data.value)}};var x7=(t,e,n,s)=>{switch(e){case 12:return t.uniformMatrix4fv(n,!1,s);case 9:return t.uniform4fv(n,s);case 8:return t.uniform3fv(n,s);case 5:return t.uniform1f(n,s);case 0:return t.uniform1i(n,s);case 1:return t.uniform1iv(n,s);case 2:return t.uniform2iv(n,s);case 3:return t.uniform3iv(n,s);case 4:return t.uniform4iv(n,s);case 6:return t.uniform1fv(n,s);case 7:return t.uniform2fv(n,s);case 10:return t.uniformMatrix2fv(n,!1,s);case 11:return t.uniformMatrix3fv(n,!1,s)}},w7=(t,e)=>{switch(t){case 5126:return Array.isArray(e)?6:5;case 35664:return 7;case 35665:return 8;case 35666:return 9;case 35670:case 5124:case 35678:case 35682:case 36289:case 35680:return Array.isArray(e)?1:0;case 35671:case 35667:return 2;case 35672:case 35668:return 3;case 35673:case 35669:return 4;case 35674:return 10;case 35675:return 11;case 35676:return 12}};var M7=new Set(["projectionViewMatrix","shadowPVMatrix","modelMatrix","viewMatrix","projectionMatrix","cameraPosition"]);var F7=0,Bs=(t,e,n,s=on(),o=0)=>({id:F7++,uniformData:{},transform:s,geometry:t,program:e,shadowProgram:o,mode:n}),to=(t,e)=>{e.uniforms.modelMatrix&&(e.uniforms.modelMatrix.value=t.transform.worldMatrix);for(let n=0;n<e.autoUniforms.length;++n){let s=e.autoUniforms[n];e.uniforms[s].value=t.uniformData[s]}Bp(t.uniformData,e),Va(e,tt.currentProgram===e.id),Da(t.geometry,e,t.mode)};function oy(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function iy(t,e,n){switch(t){case ry:return(e+3>>2)*(n+3>>2)*8;case ly:return(e+3>>2)*(n+3>>2)*16;default:return 0}}var ry=33777,ly=33778,C7=131072,S7=31,P7=1,A7=2,T7=3,E7=4,I7=7,D7=21,V7=oy("DXT1"),L7=oy("DXT3");function ay(t){let e=new Int32Array(t,0,S7),n=e[D7],s;switch(n){case V7:s=ry;break;case L7:s=ly;break;default:console.error("Unsupported texture"+n)}let o=1;e[A7]&C7&&(o=Math.max(1,e[I7]));let i=e[E7],r=e[T7],l=e[P7]+4;return{data:new Uint8Array(t,l),width:i,height:r,levels:o,internalFormat:s}}var R7=1,er=function({image:t,buffer:e,target:n=W.TEXTURE_2D,type:s=W.UNSIGNED_BYTE,format:o=W.RGBA,internalFormat:i=o,wrapS:r=W.CLAMP_TO_EDGE,wrapT:l=W.CLAMP_TO_EDGE,generateMipmaps:a=!0,minFilter:c=a?W.LINEAR_MIPMAP_LINEAR:W.LINEAR,magFilter:f=W.LINEAR,flipY:u=!0,width:m,depth:g=0,height:v=m,compareMode:_=W.NONE,compareFunc:b=W.LEQUAL,anisotropy:k=1}){return{id:R7++,image:t,buffer:e,target:n,type:s,format:o,internalFormat:i,minFilter:c,magFilter:f,wrapS:r,wrapT:l,generateMipmaps:a,flipY:u,width:m,height:v,depth:g,compareMode:_,texture:W.createTexture(),anisotropy:Math.min(Math.max(1,k),tt.maxAnisotropy),needsUpdate:!0,state:{flipY:!1,minFilter:W.NEAREST_MIPMAP_LINEAR,magFilter:W.LINEAR,wrapS:W.REPEAT,wrapT:W.REPEAT,compareMode:W.NONE,anisotropy:1,image:void 0}}},cy=t=>{tt.textureUnits[tt.activeTextureUnit]!==t.id&&(W.bindTexture(t.target,t.texture),tt.textureUnits[tt.activeTextureUnit]=t.id)},no=(t,e=0)=>{let n=!(t.image===t.state.image&&!t.needsUpdate);if((n||tt.textureUnits[e]!==t.id)&&(ef(e),cy(t)),!!n){if(t.needsUpdate=!1,t.flipY!==tt.flipY&&(W.pixelStorei(W.UNPACK_FLIP_Y_WEBGL,t.flipY),tt.flipY=t.flipY),t.minFilter!==t.state.minFilter&&(W.texParameteri(t.target,W.TEXTURE_MIN_FILTER,t.minFilter),t.state.minFilter=t.minFilter),t.magFilter!==t.state.magFilter&&(W.texParameteri(t.target,W.TEXTURE_MAG_FILTER,t.magFilter),t.state.magFilter=t.magFilter),t.wrapS!==t.state.wrapS&&(W.texParameteri(t.target,W.TEXTURE_WRAP_S,t.wrapS),t.state.wrapS=t.wrapS),t.wrapT!==t.state.wrapT&&(W.texParameteri(t.target,W.TEXTURE_WRAP_T,t.wrapT),t.state.wrapT=t.wrapT),t.anisotropy!==t.state.anisotropy&&(W.texParameterf(t.target,O1.TEXTURE_MAX_ANISOTROPY_EXT,t.anisotropy),t.state.anisotropy=t.anisotropy),t.compareMode!==t.state.compareMode&&(W.texParameteri(t.target,W.TEXTURE_COMPARE_MODE,t.compareMode),t.state.compareMode=t.compareMode),t.image)t.image.width&&(t.width=t.image.width,t.height=t.image.height),W.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.type,t.image),t.generateMipmaps&&W.generateMipmap(t.target);else if(t.buffer){let s=0,o=t.height,i=t.width,r=t.buffer.data;for(let l=0;l<t.buffer.levels;++l){let a=iy(t.internalFormat,o,o),c=new Uint8Array(r.buffer,r.byteOffset+s,a);W.compressedTexImage2D(t.target,l,t.internalFormat,i,o,0,c),i=i>>1,o=o>>1,s+=a}}else t.target!==W.TEXTURE_2D_ARRAY?W.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.type,null):W.texImage3D(t.target,0,t.internalFormat,t.width,t.height,t.depth,0,t.format,t.type,null);t.state.image=t.image}},$p=(t,e)=>{t.anisotropy=Math.min(Math.max(1,e),tt.maxAnisotropy),t.needsUpdate=!0};var fy=(t,e,n,s,o)=>{ef(0),cy(t),t.flipY!==tt.flipY&&(W.pixelStorei(W.UNPACK_FLIP_Y_WEBGL,t.flipY),tt.flipY=t.flipY),W.texSubImage3D(t.target,0,0,0,e,n,s,1,t.format,t.type,o),t.generateMipmaps&&W.generateMipmap(t.target)};var Pi=(t=W.canvas.width,e=W.canvas.height,n=1,s=!1,o=W.NONE,i=W.CLAMP_TO_EDGE,r=W.CLAMP_TO_EDGE)=>{let l=W.LINEAR,a=W.LINEAR,c={width:t,height:e,target:W.FRAMEBUFFER,buffer:W.createFramebuffer()};if(W.bindFramebuffer(c.target,c.buffer),n&&(c.colorTexture=er({width:t,height:e,wrapS:i,wrapT:r,minFilter:l,magFilter:a,flipY:!1,generateMipmaps:!1,internalFormat:W.RGBA8}),no(c.colorTexture),W.framebufferTexture2D(c.target,W.COLOR_ATTACHMENT0,W.TEXTURE_2D,c.colorTexture.texture,0)),s){let f=o===W.COMPARE_REF_TO_TEXTURE?W.LINEAR:W.NEAREST;c.depthTexture=er({width:t,height:e,wrapS:i,wrapT:r,minFilter:f,magFilter:f,flipY:!1,format:W.DEPTH_COMPONENT,internalFormat:W.DEPTH_COMPONENT24,type:W.UNSIGNED_INT,generateMipmaps:!1,compareMode:o}),no(c.depthTexture),W.framebufferTexture2D(c.target,W.DEPTH_ATTACHMENT,W.TEXTURE_2D,c.depthTexture.texture,0)}return W.bindFramebuffer(c.target,null),c},qf=(t,e,n)=>{t.colorTexture.width=e,t.colorTexture.height=n,t.colorTexture.needsUpdate=!0,no(t.colorTexture),t.depthTexture&&(t.depthTexture.width=e,t.depthTexture.height=n,t.depthTexture.needsUpdate=!0,no(t.depthTexture)),t.width=e,t.height=n};var Ft=async(t,e,n)=>{let s=await fetch(t,{method:e!==void 0?"POST":"GET",body:e?JSON.stringify(e):void 0});return s.status===500?n(await s.text()):await s.json()};var Op=new Map,Rf=new Map,Np=new Map,yh=new Map,kh=new Map,Ra=new Map,Mo=new Map,xh=new Map,za=new Map,Ba=new Map,zf=new Map,$a=new Map,Bf=new Map,wh=new Map,Mh=new Map,Fh=new Map,Ch=new Map,z7=new Map,Sh=new Map,$f=new Map,Uf=[],Of=[],Ph=new Map,jp=new Map;var bh=t=>{t.classes.forEach(e=>jp.set(e.id,e)),t.files.forEach(e=>Ra.set(e.id,e)),t.particles.forEach(e=>Op.set(e.id,e)),t.effects.forEach(e=>Rf.set(e.id,e)),t.sounds.forEach(e=>Np.set(e.id,e)),t.soundsets.forEach(e=>yh.set(e.id,e)),t.soundsetSteps.forEach(e=>kh.set(e.id,e)),t.meshes.forEach(e=>Mo.set(e.id,e)),t.ribbons.forEach(e=>xh.set(e.id,e)),t.areas.forEach(e=>zf.set(e.id,e)),t.terrains.forEach(e=>za.set(e.id,e)),t.foliages.forEach(e=>Ba.set(e.id,e)),t.environments.forEach(e=>$a.set(e.id,e)),t.animations.forEach(e=>Bf.set(e.id,e)),t.skins.forEach(e=>wh.set(e.id,e)),t.skeletons.forEach(e=>Mh.set(e.id,e)),t.creatures.forEach(e=>Fh.set(e.id,e)),t.creaturesMonster.forEach(e=>Ch.set(e.id,e)),t.creaturesConjurer.forEach(e=>z7.set(e.id,e)),t.creaturesTrader.forEach(e=>Sh.set(e.id,e)),t.traderShopItems.forEach(e=>$f.set(e.id,e)),t.worlds.forEach(e=>{Ph.set(e.id,e)});for(let e=0;e<t.filesExt.length;++e)Of.push(t.filesExt[e]);for(let e=0;e<t.minimap.length;++e)Uf.push(t.minimap[e])};var Wp=(t,e)=>{if(!Ra.has(t))return console.log("unknown file id: "+t),"";let n=Ra.get(t);return`${t}.${e||Of[n.ext]}`};var On="webp",Yn="webp",Ah="webp",Th=()=>new Promise((t,e)=>{let n=new Image;n.onerror=()=>{e()},n.onload=()=>{On=Yn=Ah="avif",t(!0)},n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="}).catch(()=>{console.log("Avif not supported",navigator.userAgent)});Th();var B7=127,$7=254,Eh=2**15-1,U7=2**16-1,Ih=2**32-1;var my=t=>{let e=Ca.modelformat.decode(t),n=Eh/(Ih/e.sx),s=Eh/(Ih/e.sy),o=Eh/(Ih/e.sz);for(let i=0;i<e.position.length;i+=3)e.position[i+0]=e.position[i+0]/n,e.position[i+1]=e.position[i+1]/s,e.position[i+2]=e.position[i+2]/o;for(let i=0;i<e.uv.length;++i)e.uv[i]/=U7;for(let i=0;i<e.color.length;++i)e.color[i]/=$7;for(let i=0,r=e.normal.length;i<r;i++)e.normal[i]=e.normal[i]/B7;return e};var Dh=async(t,e,n,s,o,i=3)=>{switch(e.split(".").pop()){case"jpg":case"png":case"avif":case"webp":{let r=new Image;r.onload=()=>{n[e]=s(r),o(n[e],t+e),r.onload=void 0},r.src=t+e+"?v=8685122";break}default:{fetch(t+e+"?v=8685122").then(r=>{if(!r.ok)throw new Error;r.arrayBuffer().then(async l=>{n[e]=await s(l),o(n[e],t+e)})}).catch(r=>{console.log(e+" fetch failed"),i>1&&Dh(t,e,n,s,o,--i)});break}}};var rl={},N7=(t,e)=>{for(let n=0,s=rl[e].length;n<s;++n)rl[e][n](...t);rl[e]=void 0},Nf=async(t,e,n,s,o)=>{n[e]?o(...n[e]):rl[t+e]?rl[t+e].push(o):(rl[t+e]=[],rl[t+e].push(o),Dh(t,e,n,s,N7))},j7=t=>{let e=my(new Uint8Array(t));return[{index:{type:5125,data:new Uint32Array(e.index)},position:{size:3,data:new Float32Array(e.position)},normal:{size:3,data:new Float32Array(e.normal)},uv:{size:2,data:new Float32Array(e.uv)},color:{size:4,data:new Float32Array(e.color)}},e]},W7={},tr=(t,e)=>{Nf("data/assets/",Wp(t),W7,j7,e)};var jf,Ai,py=()=>{jf=Bs(Sn({position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),0,W.TRIANGLES),fetch("/data/items/atlas.json?v=8685122").then(async t=>{Ai=await t.json();for(let e in Ai)e!="s"&&(Ai[e]=Ai[e].map(n=>n/Ai.s))})},G7=t=>{let e=er({image:t,wrapS:W.REPEAT,wrapT:W.REPEAT,minFilter:W.LINEAR_MIPMAP_LINEAR,anisotropy:2**fe.anisotropy});return no(e),[e]},H7=t=>{let e=ay(t),n=er({buffer:e,minFilter:W.LINEAR_MIPMAP_LINEAR,wrapS:W.REPEAT,wrapT:W.REPEAT,width:e.width,height:e.height,anisotropy:2**fe.anisotropy,format:e.internalFormat,internalFormat:e.internalFormat});return no(n),[n]},Vh={},bs=(t,e)=>{Ra.has(t)||console.log("unknown file id: "+t);let n=Ra.get(t);n.ext===3&&H_?Nf("data/assets/",`${t}.${Of[n.ext]}`,Vh,H7,e):Nf("data/assets/",`${t}.${Ah||Of[n.ext]}`,Vh,G7,e)},dy,hy=(t,e,n)=>{dy=e,Nf("data/assets/",t+".ogg",Vh,Y7,n)},Y7=async t=>[await dy.decodeAudioData(t)];var Kt=(t,e)=>t+Math.random()*(e-t),Lh=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;var gy=t=>qh(t,Math.random()),qh=(t,e)=>t[Math.floor(e*t.length)];var vn,sr=[],nr=new Map,Ti=new Map,Gp=new Set,by=t=>{vn&&(X7(),Q7(t),Gp.clear())},X7=()=>{yy(vn.listener,ht.transform.worldMatrix),Am(Mi,Yt.worldMatrix),Y(_t,0,0,1),R1(_t,_t,Mi),Y(kn,0,1,0),R1(kn,kn,Mi),vn.listener.setOrientation(_t[0],_t[1],_t[2],kn[0],kn[1],kn[2])},Q7=t=>{let e=0,n=0;for(;n<sr.length;){let s=sr[n];s.ended?Z7(s.id):(sr[e]=s,e++),++n}sr.length=e},yy=(t,e)=>{t.setPosition(e[12],e[13],e[14])},ky=function(){this.ended=!0},Z7=t=>{Ti.set(t,Math.max(0,Ti.get(t)-1))},vy=(t,e)=>{if(!Ti.has(t))Ti.set(t,1);else{if(Ti.get(t)>=e)return!1;Ti.set(t,Ti.get(t)+1)}return!0},Rh={},xy=(t,e)=>{let n=gy(t);Rh[n]!==void 0?e.buffer=Rh[n]:hy(n,vn,s=>{Rh[n]=s,e.buffer=s})},ti=(t,e,n,s,o)=>{if(vn===void 0||vn.state=="suspended"||Gp.has(t))return;if(n===0){if(sr.length>35||(Y(_t,e.worldMatrix[12],e.worldMatrix[13],e.worldMatrix[14]),1/((Ti.get(t)||0)+10+Rr(Yt.position,_t))*1e3/(sr.length+20)**1.2<.4)||!vy(t,2))return}else if(n===1&&!vy(t,5))return;let i=Np.get(t);if(!i){console.log("unknown sound id:"+t);return}Gp.add(t);let r=vn.createBufferSource();r.id=t,r.loop=s,r.playbackRate.value=o,xy(i.files,r);let l=nr.get(n).in;return r.panner=vn.createPanner(),r.panner.distanceModel="exponential",r.panner.refDistance=i.distance,r.panner.rolloffFactor=1,yy(r.panner,e.worldMatrix),r.connect(r.panner),r.panner.connect(l),r.start(0,0),r.onended=ky,sr.push(r),r},wy=t=>{vn=new(window.AudioContext||window.webkitAudioContext),["ambience","music"].forEach((i,r)=>{let l=vn.createGain();l.connect(vn.destination),nr.set(2+r,{gain:l,in:l}),Zo[i+"Volume"].subscribe(a=>{nr.get(2+r).gain.gain.value=(a/100)**2})});let e=vn.createDynamicsCompressor(),n=vn.createGain();e.threshold.value=0,e.knee.value=0,e.ratio.value=15,e.attack.value=.005,e.release.value=.05,e.connect(n),n.connect(vn.destination);let s=vn.createGain();s.gain.value=2,s.connect(e);let o=vn.createGain();o.gain.value=.4,o.connect(e),nr.set(1,{gain:n,in:s}),nr.set(0,{gain:n,in:o}),Gr.subscribe(i=>{nr.get(1).gain.gain.value=(i/150)**2}),Hr.subscribe(i=>{nr.get(0).in.gain.value=i/100}),C_.set(!0),document.removeEventListener("click",wy)},_y=!1,My=(t,e)=>{_y||(_y=!0,document.addEventListener("click",wy))},Fy=t=>{sr.length=0,Ti.clear(),Gp.clear()},zh=(t,e,n,s)=>{if(vn===void 0||vn.state=="suspended")return;let o=Np.get(t);if(!o)return;let i=vn.createBufferSource();i.id=t,i.loop=n,xy(o.files,i);let r=nr.get(e).in;return s&&(i.gain=vn.createGain(),i.gain.connect(r),r=i.gain),i.connect(r),i.start(0,n?Kt(0,1):0),i.onended=ky,i},xt=(t,e)=>{let n=zh(t,1,!1,e!==void 0);e!==void 0&&n&&(n.gain.gain.value=e)},Cy=(t,e)=>zh(t,e,!0,!0),Sy=(t,e)=>zh(t,e,!1,!0);var al=Math.PI*2,K7=Math.PI*3,Ua=t=>t<0||t>al?(t%al+al)%al:t,Wf=(t,e,n,s)=>(Zt(kn,s,n),Zt(_t,e,n),Js(kn,kn,_t),ts(t,kn));var Hp=(t,e,n,s,o,i)=>{let r=[n[0]-t[0],n[1]-t[1],n[2]-t[2]],l=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],a=[s-t[0],o-t[1],i-t[2]],c=hn(r,r),f=hn(r,l),u=hn(r,a),m=hn(l,l),g=hn(l,a),v=1/(c*m-f*f),_=(m*u-f*g)*v,b=(c*g-f*u)*v;return _>=0&&b>=0&&_+b<=1},Yp=(t,e)=>{let n=Math.sin(t[1]),s=Math.cos(t[1]);t[0]=e[2]*s+e[0]*n,t[2]=e[2]*n-e[0]*s},cl=t=>{let e=Math.atan2(t[0],t[1]);return e<0&&(e+=2*Math.PI),e},Xp=t=>{let e=Math.atan2(t[0],t[2]);return e<0&&(e+=2*Math.PI),e},fl=(t,e)=>(e-t+K7)%al-Math.PI;var Qp=(t,e,n)=>{Zt(_t,n,t);let s=hn(_t,e);return sn(_t,t,e,s)},Py=(t,e,n,s,o,i,r,l,a)=>{let c=-(r*s+l*o+a*i);return r*t+l*e+a*n+c},Bh=(t,e,n,s,o,i,r,l,a)=>{let c=-(r*s+l*o+a*i);return e+(r*t+a*n+c)/l},Ay=(t,e,n,s,o,i,r,l,a)=>{let c=(r*(s-t)+l*(o-e)+a*(i-n))/(r*r+l*l+a*a),f=t+c*r,u=n+c*a;return Math.sqrt(Math.pow(f-t,2)+Math.pow(u-n,2))};var Oa=(t,e)=>(t[0]=e[0],t[1]=e[2],t);var Zp=(t,e,n)=>(t[0]=e[0]+n[0],t[2]=e[2]+n[1],t);var Ty=(t,e,n,s,o)=>{Zt(_t,e,s);let i=2*hn(n,_t),r=hn(_t,_t)-o*o,l=i*i-4*r;l>0?(t[0]=(-i-Math.sqrt(l))/2,t[1]=(-i+Math.sqrt(l))/2):t[0]=t[1]=-1},Na=(t,e,n,s,o,i)=>{Zt(_t,e,t),Zt(kn,n,t),Js(tl,_t,kn);let r=hn(o,tl),l;if(r>0){if(!i)return 1/0;l=1}else if(r<0)l=-1,r=-r;else return 1/0;Zt(bo,s,t);let a=l*hn(o,Js(kn,bo,kn));if(a<0)return 1/0;let c=l*hn(o,Js(_t,_t,bo));if(c<0||a+c>r)return 1/0;let f=-l*hn(bo,tl);return f<0?1/0:f/r};var Ey=(t,e,n,s)=>{let o=0,i=0,r=1;e.length>2&&(o=s.findIndex(f=>f>=n),o<0&&(o=s.length),i=o>0?s[o-1]:0,r=o>=s.length?1:s[o]);let l=e[o],a=e[o+1],c=(n-i)/(r-i);return va(t,l,a,c),o};var Jp=[0,0],ja=[0,0],is=[0,0],nt={},Iy={},e9=function(t){return this.press.push(t),t},t9=function(t){return this.release.push(t),t},rn=(t,e)=>(e.press||(e.down=!1,e.onPress=e9,e.onRelease=t9,e.press=[],e.release=[],e.mappings=[],e.store||(e.store=te(!1))),t=Array.isArray(t)?t:[t],t.forEach(n=>{Iy[n]=e,e.mappings.push(n)}),F_.set(nt),e),Dy=()=>{rn(fe.kbForward,nt.fwd={}),rn(fe.kbLeft,nt.left={}),rn(fe.kbBack,nt.back={}),rn(fe.kbRight,nt.right={}),rn(fe.kbNextTarget,nt.nextTarget={}),rn(fe.kbNextParty,nt.nextParty={}),rn(fe.kbUntarget,nt.untarget={}),rn(" ",nt.jump={}),rn(fe.kbAltForward,nt.fwd),rn(fe.kbAltBack,nt.back),rn(fe.kbTurnRight,nt.turnright={}),rn(fe.kbTurnLeft,nt.turnleft={}),rn("shift",nt.shift={}),rn("m0",nt.lmb={}),rn("m2",nt.rmb={}),rn("control",nt.ctrl={}),rn("alt",nt.alt={}),rn(fe.kbMap,nt.map={}),rn(fe.kbSkills,nt.skills={}).onPress(()=>{vi.update(t=>!t),xt(89)}),rn(fe.kbCharacter,nt.char={}).onPress(()=>{ki.update(t=>!t),xt(89)}),rn(fe.kbInventory,nt.inventory={}).onPress(()=>{gi.update(t=>!t),xt(90)}),rn(fe.kbClan,nt.clan={}).onPress(()=>{_i.update(t=>!t),xt(90)}),rn(fe.kbSocial,nt.clan={}).onPress(()=>{bi.update(t=>!t),xt(90)}),rn(fe.kbPvp,nt.pvp={}).onPress(()=>{yi.update(t=>!t),xt(90)}),rn(fe.kbParty,nt.party={}).onPress(()=>{Ks.update(t=>!t),xt(90)}),document.addEventListener("wheel",i9,{passive:!0}),document.addEventListener("keydown",l9,!1),document.addEventListener("keyup",a9,!1),document.addEventListener("contextmenu",r9,!1),document.addEventListener("mousedown",s9,!1),document.addEventListener("mouseup",o9,!1),document.addEventListener("mousemove",n9,!1)},Vy=t=>{$h&&($h=!1,fe.pointerlock&&!(nt.lmb.down||nt.rmb.down)&&(document.exitPointerLock(),Kp=!1))},Gf=0,n9=t=>{if(vs(Jp,2*(t.x*fe.resolutionScale/As.width)-1,2*(1-t.y*fe.resolutionScale/As.height)-1),vs(ja,~~(t.x*fe.resolutionScale),~~(t.y*fe.resolutionScale)),nt.rmb.down||nt.lmb.down){let e=gt(t.movementX,-100,100),n=gt(t.movementY,-100,100);is[1]=gt(is[1]+n*.0028*(fe.invertMouseY?-fe.mouseSensitivity:fe.mouseSensitivity),-Math.PI/2,Math.PI/2),is[0]=Ua(is[0]-e*.005*(fe.invertMouseX?-fe.mouseSensitivity:fe.mouseSensitivity)),Gf+=Math.abs(n)+Math.abs(e)}},Ly=!1;In.subscribe(t=>{Ly=t!==void 0});var Kp=!1,$h=!1,s9=t=>{(t.target==As||t.target.id=="chat")&&(fe.pointerlock&&(Kp=!0,As.requestPointerLock()),or("m"+t.button,!0),Ly&&In.update(e=>{e&&e.discard&&e.discard()}))},o9=t=>{or("m"+t.button,!1),Gf=0,$h=!0},i9=t=>{t.target==As&&Gm.update(e=>gt(e+(t.deltaY>0?1:-1),2,18))},r9=t=>{t.preventDefault()},or=(t,e,n)=>{let s=Iy[t];return s!==void 0?(s.down!=e&&(s.down=e,s[e?"press":"release"].forEach(o=>{o(n)}),s.store.set(s.down)),n&&n.preventDefault(),!0):!1},l9=t=>{if(!qy(t))return;let e=t.key.toLowerCase();t.ctrlKey&&or("ctrl+"+e,!0,t)||t.shiftKey&&or("shift+"+e,!0,t)||or(e,!0,t)},a9=t=>{if(!qy(t))return;let e=t.key.toLowerCase();or("ctrl+"+e,!1),or("shift+"+e,!1),or(e,!1)},qy=t=>{let e=t.target.tagName.toLowerCase();return e!=="input"&&e!=="textarea"};var Uh=t=>1+(t-1)*.23,Ry=t=>{let e=0;return t.forEach(n=>{e+=n.stats.getStat(18)}),f9(e,t.length)},f9=(t,e)=>t/Math.max(1,e)/100;var u9=[300,600,1e3,1600,2400,3300,4300,5300,6400,7600,9e3,10300,11700,13200,14800,16600,18900,21300,23800,26500,29300,32200,35300,38700,42200,46e3,49800,53800,58e3,62800,67800,73e3,78400,84500,90900,97400,104200,111800,119600,128300,137400,146600,156200,166e3,176100],ir=t=>u9[gt(t,1,45)-1];var ed=class{constructor(e){this.id=e.id,this.cd=e.cd!==void 0?e.cd:0,this.costMp=e.costMp,this.targetMode=e.targetMode||0,this.onCast=e.onCast,this.onPermanent=e.onPermanent,this.range=e.range||0,this.graceRange=this.range+Math.min(this.range*.2,10),this.auto=e.auto||!1,this.engineOnly=e.engineOnly||!1,this.minlevel=e.minlevel||0,this.castLen=e.castLen||0,this.gcd=e.gcd!==void 0?e.gcd:1.5,this.custom=e.custom,this.skilllevels=Math.min(5,e.skilllevels||5),this.goldValue=e.goldValue||0,this.noReward=e.noReward||!1,this.outOfCombat=e.outOfCombat||!1,this.pvpBoundsAdd=e.pvpBoundsAdd||0,this.ignoreGcd=e.ignoreGcd||!1,this.ignoreIncapacitated=e.ignoreIncapacitated||!1,this.disablingBuffs=e.disablingBuffs||[],this.hasteAffected=e.hasteAffected!==void 0?e.hasteAffected:!0,this.skillpoints=e.skillpoints!==void 0?e.skillpoints:1,this.envCast=e.envCast||0}can(e,n,s=0,o){if(this.outOfCombat&&!e.stats.combatTimer.done(I.time))return 11;if(this.costMp!==void 0&&e.stats.getResource(7)<this.costMp(n))return 5;if(this.targetMode!==1){let i=I.getEntityById(s),r=i===void 0||i.stats.alive,l=i===void 0?-1:e.hostility(i);if(this.targetMode===4096){if((l===-1||l===0)&&r)return 3;if(!e.canCombatInteract(i))return 13}else if(this.targetMode===256){if((l===-1||l!==0)&&r)return 4}else if(this.targetMode===16)i=e;else if(this.targetMode===17&&(i===void 0||i===e))return 3;if(i!==void 0&&!i.stats.alive)return 10;if(i&&s!==e.id&&i!==e&&this.range>0&&!e.combatRangeCheck(i,o?this.range:this.graceRange))return 6}return this.disablingBuffs.some(i=>e.buffs.hasAnyWithTag(i))?12:0}};var Se=class extends ed{constructor(e){super(e),this.fx=e.fx||{},this.autoSkillbar=e.autoSkillBar!==!1}};var Wa=(t,e,n,s)=>({id:t,minlevel:n,engineOnly:!1,cd:0,custom:s,autoSkillBar:!1,onPermanent:()=>e}),Is=(t,e,n,s,o,i,r,l)=>({id:t,targetMode:16,minlevel:n,cd:o,costMp:r,fx:l,onCast:(a,c,f)=>({id:e,mode:4,stacks:1,duration:s,caster:a.id,target:a.id,aoe:{faction:!0,limit:i,circleRadius:30,circleHeight:20},level:c})}),td=(t,e,n,s,o,i,r,l=5,a)=>({id:t,targetMode:256,range:30,minlevel:n,cd:o,castLen:s,costMp:r,fx:a,onCast:(c,f,u)=>({id:e,mode:l,stacks:1,caster:c.id,target:u,refresh:!0,duration:i,level:f})}),ul=(t,e,n=0,s=!0,o,i=!1,r=!1,l)=>({id:t,targetMode:16,cd:e,gcd:0,hasteAffected:!1,ignoreIncapacitated:i,ignoreGcd:!0,castLen:n,engineOnly:!0,outOfCombat:o,fx:l});var zy=new Se(Wa(21,77,1));var By=new Se({id:2,targetMode:16,minlevel:5,cd:30,gcd:0,costMp:t=>3+t*5,fx:{animCast:6},custom:[[t=>7+t*12," heal on block"]],onCast:(t,e,n)=>({id:59,mode:4,stacks:1,duration:9,caster:t.id,target:t.id,level:e})});var $y=t=>.7+t*.2,m9=t=>$y(t)+30/(250/20),Uy=new Se({id:33,targetMode:17,skilllevels:1,minlevel:11,cd:15,range:30,disablingBuffs:[4],costMp:t=>12,custom:[[$y,"s stunned at min range"],[m9,"s stunned at max range"]],onCast:(t,e,n)=>{}});var Oy=new Se(Is(20,76,15,300,150,20,t=>t*8,{animCast:6}));var Ny=new Se({id:18,cd:0,minlevel:8,autoSkillBar:!1,fx:{},onPermanent:()=>73});var jy=new Se({id:3,targetMode:1,minlevel:3,cd:6,costMp:t=>2+t*2,fx:{animCast:5,effectDirImpact:9},onCast:(t,e,n)=>({id:3,mode:0,caster:t.id,dmg:t.stats.getDamageRoll()*(1+e*.18),type:1,aoe:{faction:!1,circleRadius:2+5*t.size}})});var Wy=new Se({id:17,targetMode:16,minlevel:13,cd:50,gcd:0,costMp:t=>t*8,fx:{animCast:6},onCast:(t,e,n)=>({id:72,mode:4,stacks:1,duration:17,caster:t.id,target:t.id,level:e})});var Gy=new Se({id:50,targetMode:1,minlevel:7,cd:30,costMp:t=>t*4,fx:{animCast:40},custom:[[t=>20+t*5," % missing + 100 HP recovered"]],onCast:(t,e,n)=>({id:121,mode:4,stacks:1,caster:t.id,buffdata:[0],sendBuffData:!0,duration:1+e,level:e,aoe:{faction:!1,circleRadius:8}})});var p9=t=>t*8,Hy=new Se({id:1,targetMode:4096,minlevel:1,cd:1,range:2,custom:[[p9,"% chance to daze target for 3 seconds"]],costMp:t=>1+t,fx:{animImpact:3},onCast:(t,e,n)=>{let s=5+t.stats.getDamageRoll()*(.38+e*.39);return{id:1,mode:0,caster:t.id,target:n,dmg:s,type:1}}});var Yy=t=>1e4+t*1e4,d9=(t,e)=>{if(e.type===1){let n=0;e.aggroValues.forEach((s,o)=>{s>n&&(n=s)}),e.aggroValues.set(t.caster,n+Yy(t.level)),e.buffs.buffs.has(122)&&add({id:125,mode:5,stacks:t.level,caster:e.id,target:t.caster,refresh:!0,duration:60,level:1})}},Xy=new Se({id:34,targetMode:1,minlevel:6,cd:15,costMp:t=>t*4,fx:{animCast:7},custom:[[Yy," aggro generation"]],onCast:(t,e,n)=>({custom:d9,id:89,mode:4,stacks:1,caster:t.id,duration:2+e,level:e,aoe:{faction:!1,circleRadius:10}})});var Qy=new Se({id:41,targetMode:16,minlevel:25,cd:30,skilllevels:1,gcd:0,costMp:t=>3+t*5,onCast:(t,e,n)=>{}});var Zy=new Se(Is(19,75,18,300,150,20,t=>t*8,{animCast:6}));var Jy=new Se({id:46,targetMode:1,range:30,minlevel:4,cd:30,castLen:0,costMp:t=>10+t*3,fx:{effectTarget:106},onCast:(t,e,n)=>{}});var Ky=new Se(Is(22,78,17,300,120,20,t=>5+t*10,{animCast:6}));var ek=new Se(td(24,80,15,1.5,0,300,t=>2+t*3,4,{animCast:9,animChannel:18}));var tk=new Se({id:52,targetMode:1,minlevel:7,envCast:7,cd:6,range:25,costMp:t=>t*2,fx:{effectMissile:107,effectTarget:111},onCast:(t,e,n,s,o,i)=>{}});var nk=new Se({id:14,targetMode:1,minlevel:3,cd:25,costMp:t=>t*4,fx:{animCast:31},onCast:(t,e,n)=>({id:69,mode:4,stacks:1,caster:t.id,duration:5.5+e*.5,level:e,aoe:{faction:!1,circleRadius:8}})});var sk=new Se({id:16,targetMode:16,minlevel:13,cd:45,gcd:0,fx:{animCast:6},onCast:(t,e,n)=>({id:71,mode:4,stacks:1,duration:12,caster:t.id,target:t.id,level:e})});var ok=new Se({id:53,targetMode:16,minlevel:9,cd:80,gcd:0,ignoreIncapacitated:!0,ignoreGcd:!0,costMp:t=>t*5,onCast:(t,e,n)=>({id:117,mode:4,duration:5,stacks:1,caster:t.id,target:t.id,level:e})});var ik=new Se({id:4,targetMode:4096,range:30,minlevel:1,cd:0,castLen:1.5,custom:[[t=>100+t*10,"% frozen buff multiplier"]],costMp:t=>1+t*2,fx:{animCast:29,effectDirImpact:30,animChannel:30,effectMissile:27},onCast:(t,e,n)=>({id:4,mode:6,speed:25,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.3+e*.32),type:1}),onPermanent:()=>100});var rk=t=>2+t*2,lk=new Se({id:23,targetMode:16,minlevel:5,cd:60,gcd:0,costMp:t=>t*5,custom:[[rk," attacks blocked"]],fx:{animCast:6},onCast:(t,e,n)=>({id:79,mode:4,stacks:rk(e),duration:60,caster:t.id,target:t.id,level:e})});var ak=new Se({id:15,targetMode:1,range:30,minlevel:8,cd:8,castLen:1.5,costMp:t=>5+t*5,fx:{animCast:29,animChannel:30,effectDirImpact:31,effectMissile:28},onCast:(t,e,n)=>({id:15,mode:6,speed:10,timeout:2.5,caster:t.id,rot:t.rot,dmg:10+t.stats.getDamageRoll()*(.56+e*.6),type:1,aoe:{circleRadius:4+e*.5,faction:!1,onlyOnce:[]}})});var ck=new Se({id:51,targetMode:4096,range:30,minlevel:4,cd:10,castLen:2.8,costMp:t=>1+t*2,fx:{animCast:37,effectDirImpact:119,animChannel:30,effectMissile:118},onCast:(t,e,n)=>({id:51,mode:6,speed:20,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(1.25+e*1.33),type:1,noBlock:!0})});var h9=()=>12,fk=new Se({id:32,targetMode:1,skilllevels:1,minlevel:5,gcd:.7,cd:12,disablingBuffs:[4],costMp:t=>t*4,fx:{animCast:32},custom:[[h9,"m distance"]],onCast:(t,e,n)=>{}});var uk=new Se({id:37,targetMode:4096,range:30,minlevel:15,cd:40,castLen:2.3,costMp:t=>5+t*5,fx:{animCast:9,effectImpact:50,animChannel:16},onCast:(t,e,n)=>({id:91,mode:4,stacks:1,caster:t.id,target:n,duration:2.4+e*1,level:e})});var mk=new Se(Is(28,84,12,15,60,15,t=>1+t*3,{animCast:6}));var pk=new Se({id:12,targetMode:4096,range:30-5,minlevel:1,castLen:0,cd:3,costMp:t=>Math.round(1+t*4.5),fx:{animCast:10,effectMissile:48},onCast:(t,e,n)=>({id:12,mode:6,dmg:5+t.stats.getDamageRoll()*(.03+e*.13),type:1,speed:15,caster:t.id,target:n,level:e})});var dk=new Se({id:30,targetMode:1,range:30,minlevel:18,cd:60,castLen:2.3,costMp:t=>10+t*8,fx:{effectImpact:70,animCast:14,animChannel:15,effectMissile:69},onCast:(t,e,n)=>({id:30,mode:6,speed:0,timeout:30,caster:t.id,rot:t.rot,interval:new kt(0,2),heal:t.stats.getDamageRoll()*(.08+e*.05),type:1,aoe:{circleRadius:30,circleHeight:30,faction:!0,limit:15}})});var hk=new Se(Is(13,68,6,15,90,15,void 0,{animCast:22}));var gk=new Se({id:6,targetMode:256,range:30,minlevel:8,cd:0,castLen:1.7,costMp:t=>4+t*4,fx:{animCast:11,effectImpact:36,animChannel:12},onCast:(t,e,n)=>({id:6,mode:2,caster:t.id,target:n,heal:15+t.stats.getDamageRoll()*(.2+e*.18)})});var vk=new Se({id:47,targetMode:256,range:30,minlevel:14,cd:12,castLen:0,costMp:t=>4+t*4,fx:{animCast:9,effectTarget:112},custom:[[t=>t," effects removed"]],onCast:(t,e,n)=>{let s=0;return{id:47,mode:2,caster:t.id,target:n,heal:(1+s)*(15+t.stats.getDamageRoll()*.25)}}});var g9=t=>1+t*2,v9=t=>1+t*2,_k=new Se(Wa(43,106,3,[[g9,"% haste per stack"],[v9," jumps"]]));var bk=new Se(td(7,60,3,0,0,12,t=>2+t*2,5,{animCast:9}));var _9=t=>Math.round(t*1.3),b9=t=>t*2,yk=new Se({id:42,targetMode:1,minlevel:8,cd:8,castLen:0,range:30-5,custom:[[_9," mana gained per soul"],[b9," extended Decay duration"]],costMp:t=>1+t*3,fx:{animCast:13,effectImpact:46},onCast:(t,e,n)=>({id:42,mode:1,caster:t.id,target:0,type:1,dmg:4+t.stats.getDamageRoll()*(.25+e*.4),level:e})});var kk=new Se({id:105,engineOnly:!0,cd:0,fx:{effectImpact:47,effectMissile:45}});var xk=new Se({id:36,targetMode:16,minlevel:10,cd:30,gcd:0,costMp:t=>8+t*2,onCast:(t,e,n)=>({id:90,mode:4,stacks:1,duration:5+e*5,caster:t.id,target:t.id,level:e})});var wk=new Se({id:35,targetMode:1,skilllevels:1,minlevel:5,cd:120,skillpoints:0,castLen:5,outOfCombat:!0,hasteAffected:!1,pvpBoundsAdd:5,costMp:t=>20+t*5,fx:{animCast:20,animChannel:21},onCast:(t,e,n)=>{}});var Mk=new Se({id:49,targetMode:4096,range:30,minlevel:13,cd:25,costMp:t=>1+t*1,fx:{animCast:38,effectMissile:123,animChannel:28},onCast:(t,e,n)=>({id:49,buffid:119,mode:7,speed:60,caster:t.id,level:e,stacks:1,duration:1+e*2,refresh:!0,target:n})});var Fk=new Se({id:54,targetMode:4096,range:30,minlevel:8,cd:10,castLen:2.8,costMp:t=>8+t*3,fx:{animCast:39,effectDirImpact:121,animChannel:25,effectMissile:114},onCast:(t,e,n)=>({id:54,mode:6,speed:60,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(1.25+e*1.33),type:1,noBlock:!0})});var Ck=new Se(Wa(26,82,15));var y9=t=>3+t*5,Sk=new Se({id:11,targetMode:16,minlevel:7,cd:50,gcd:0,fx:{animCast:6},custom:[[y9,"% of max mp recovered"]],onCast:(t,e,n)=>({id:66,mode:4,stacks:1,duration:17,caster:t.id,target:t.id,level:e})});var Pk=new Se(Is(27,83,12,10,80,20,t=>5+t*7,{animCast:6}));var Ak=new Se({id:29,cd:0,minlevel:9,autoSkillBar:!1,onPermanent:()=>85});var Tk=new Se({id:9,targetMode:4096,range:30,minlevel:3,cd:6,castLen:1.7,costMp:t=>2+t*3,fx:{animCast:24,effectDirImpact:85,animChannel:25,effectMissile:33},onCast:(t,e,n)=>({id:9,mode:6,speed:120,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.53+e*.45),type:1})});var Ek=new Se({id:10,targetMode:16,minlevel:5,cd:0,autoSkillBar:!1,skillpoints:0,onPermanent:()=>65});var Ik=new Se({id:38,targetMode:16,minlevel:5,skilllevels:1,cd:10,gcd:0,disablingBuffs:[4],costMp:t=>6,fx:{animCast:23},onCast:(t,e,n)=>!0});var Dk=new Se({id:31,targetMode:4096,range:30,minlevel:1,cd:0,castLen:1.5,costMp:t=>1+t*1,fx:{animCast:27,effectDirImpact:84,effectMissile:34,animChannel:28},onCast:(t,e,n)=>({id:31,mode:6,speed:60,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.24+e*.25),type:1})});var Vk=new Se(Is(25,81,18,300,120,20,t=>5+t*5,{animCast:6}));var Lk=new Se({id:48,targetMode:4096,range:30,minlevel:6,cd:20,ignoreGcd:!0,costMp:t=>1+t*1,fx:{animCast:36,effectDirImpact:115,effectMissile:113,animChannel:28},custom:[[t=>t*120," HP recovered"]],onCast:(t,e,n)=>({id:48,mode:6,speed:80,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.28+e*.28),type:1})});var qk=new Se({id:106,engineOnly:!0,cd:0,fx:{effectMissile:116,effectImpact:117}});var Rk=new Se({id:45,targetMode:1,range:30,minlevel:4,cd:25,castLen:0,costMp:t=>18+t*3,fx:{effectDirImpact:11,effectMissile:103},onCast:(t,e,n)=>{}});var k9={medalValue:1e3,goldValue:5e4,buyElo:1600,quality:90,level:45,gs:30,uniqueEquipped:!0},Oh=[{id:0,custom:["Use: Removes all movement limiting effects."],useCd:60,incap:!0,animCast:45},{id:1,custom:["Use: Protects you against 30% of incoming damage for 10 seconds."],useCd:60,animCast:6,incap:!1},{id:2,custom:["Use: Increases your damage by 20% for 10 seconds."],useCd:80,incap:!1,animCast:6},{id:3,custom:["Use: Speeds up your movement by 45 for 8 seconds."],useCd:50,incap:!1,animCast:6},{id:4,custom:["Use: Attacks made against you grant 20 MP (up to 200) for 20 seconds."],useCd:60,incap:!1,animCast:6}],zk=t=>{Oh.forEach((e,n)=>{t["charm"+e.id]={...k9,...e,type:"charm",tier:e.id,useSkill:107+n}})};var Bk=new Se(ul(100,30,0,!0,!0,!1,!1,{animCast:17})),$k=new Se(ul(101,1.5,0,!0,!1,!1,!1)),Uk=new Se(ul(104,1.5,0,!1,!1,!1,!1,{animCast:6})),Ok=new Se(ul(103,1.5,3,!0,!1,!1,!1,{animCast:19,animChannel:18})),Nk=new Se(ul(102,1.5,1.5,!1,!0,!1,!1,{animCast:9,animChannel:18})),jk=Oh.map((t,e)=>new Se(ul(107+e,t.useCd,0,!1,!1,t.incap,!0,{animCast:t.animCast}))).reduce((t,e)=>({...t,["charm"+e.id]:e}),{});var Wk=new Se({id:5,targetMode:4096,range:30,engineOnly:!0,auto:!0,cd:t=>100/t.stats.getStat(17),fx:{animCast:26,effectDirImpact:11,effectMissile:32},onCast:(t,e,n)=>({id:5,mode:6,speed:15*3,caster:t.id,target:n,dmg:t.stats.getDamageRoll(),type:0})});var Gk=new Se({id:56,targetMode:1,range:50,cd:10,engineOnly:!0,castLen:2,fx:{animCast:41,animChannel:42}});var Hk=new Se({id:44,targetMode:1,range:50,minlevel:3,cd:5,engineOnly:!0,castLen:1.5,costMp:t=>t*4});var Yk=new Se({id:55,targetMode:1,range:50,minlevel:3,cd:20,engineOnly:!0,castLen:2,fx:{effectMissile:131,animCast:43,animChannel:42}});var Xk=new Se({id:58,targetMode:1,range:10,cd:2,engineOnly:!0,hasteAffected:!1,castLen:30,fx:{animCast:9,animChannel:44}});var Qk=new Se({id:57,targetMode:4096,engineOnly:!0,fx:{effectMissile:153,effectDirImpact:154}});var Zk=new Se({id:0,targetMode:4096,engineOnly:!0,auto:!0,range:2,cd:t=>100/t.stats.getStat(17),fx:{animImpact:4},onCast:(t,e,n)=>({id:0,mode:0,caster:t.id,target:n,dmg:t.stats.getDamageRoll(),type:0})});var Jk=new Se({id:39,engineOnly:!1,skilllevels:1,minlevel:30,cd:0,goldValue:25e3,skillpoints:0,noReward:!0,autoSkillBar:!1});var Kk=new Se({id:40,targetMode:1,engineOnly:!0,cd:300,castLen:5,outOfCombat:!0,hasteAffected:!1,costMp:t=>20+t*5,fx:{animCast:9,animChannel:8},onCast:(t,e,n)=>{}});var ex=new Se({id:8,engineOnly:!0,cd:0,onPermanent:t=>t.class+61});var x9={...jk,hellspawn_missile:Qk,conjurer_obeliskport:Xk,boss_bigaoe:Gk,boss_puddledot:Yk,recall:Kk,arrow:Wk,melee:Zk,potion:Bk,book:$k,specialization:ex,mount:Jk,activatemount:Nk,container:Ok,boss_flamepits:Hk,useGeneric:Uk},w9={relentlessCry:Gy,whirlwind:Jy,temper:Qy,taunt:Xy,charge:Uy,warcry:Zy,courage:Oy,armorreinforcement:zy,enrage:Wy,slash:Hy,blockBuff:By,crescentStrike:jy,crescentBleed:Ny},M9={frostcall:tk,iceblock:ok,shatterfrost:ck,teleport:fk,enchantment:ek,arcticaura:Ky,iceshield:lk,hypothermic:sk,frostnova:nk,icebolt:ik,icicle:ak},F9={vampiricarrowReturn:qk,boneshot:Fk,blindingshot:Mk,vampiricarrow:Lk,volley:Rk,snipe:Ik,poisonarrows:Ak,temporaldilation:Vk,pathfinding:Pk,preciseShot:Tk,serpentArrows:Ek,invigorate:Sk,swiftshot:Dk,cranialpunctures:Ck},C9={mimirscleanse:vk,soulharvestReturn:kk,plaguespreader:_k,soulharvest:yk,agonize:uk,caninehowl:mk,mana:hk,mend:gk,revitalize:bk,decay:pk,healingtotem:dk,summon:wk,spiritanimal:xk},At=new Map;[w9,M9,F9,C9,x9].forEach((t,e)=>{for(let n in t)e<=3&&(t[n].class=e),At.set(t[n].id,t[n])});At.set(60,new Se({id:60,engineOnly:!0}));var nx=[1600,1800,2e3,2200],tx=nx.length,Ga=t=>{for(let e=0;e<tx;++e)if(nx[e]>t)return e;return Math.max(0,tx)},S9=10,P9=30,A9=240,T9=-.0015,E9=930,I9=100,Hf=t=>S9+Math.round(Math.max(t/P9,A9*(1-Math.exp(T9*(t-E9)))-I9));var D9=[0,0,1,1,2,3],Nh=(t,e)=>"book"+(e!==void 0?e:"")+D9[t%5],Yf=(t,e,n,s)=>`https://raw.githubusercontent.com/2f147f0487a9fe5b/cb2e2197348007b8/main/${t}/${t=="book"?Nh(e,n):t+e}_q${s}.webp?v=8685122`,Xf=t=>`/data/ui/skills/${t}.${Yn}?v=8685122`,sx=t=>`/data/ui/slotbg/${t}.${On}?v=8685122`,ox=(t,e,n)=>`/data/world/${t}/map/${e}/${n}.${Yn}?v=8685122`,ni=t=>`/data/ui/classes/${t}.${On}?v=8685122`,jh=t=>`/data/ui/factions/${t}.${On}?v=8685122`,ix=t=>`/data/ui/elo/${Ga(t)}.svg?v=8685122`,rx="/data/ui/currency/medal.svg?v=8685122",Ha="/data/ui/currency/prestige.svg?v=8685122",rr="/data/ui/currency/fame.svg?v=8685122",lx=t=>`/data/ui/rank/rank${t}.svg?v=8685122`;var ax=t=>{At.forEach(e=>{if(!e.engineOnly)for(let n=0;n<e.skilllevels;++n){let s=e.id*5+n;t[`book${s}`]={type:"book",tier:s,level:e.minlevel+n*8,skillid:e.id,skilllevel:n,class:e.class,noReward:e.noReward||!1,goldValue:e.goldValue||(e.minlevel+n*5<5?4:0),quality:Math.round(Math.min(99,30+70*(n/5))),art:Nh(s,e.class),useSkill:101}}})};var V9=[{id:0,storeValue:300,quality:90,level:1,custom:["Contains random mount (account bound) of rare or epic quality"],bindOnPurchase:1,useSkill:103},{id:1,storeValue:900,quality:90,level:1,custom:["Adds one month of Elixir to your account"],bindOnMerchant:1,useSkill:103},{id:2,storeValue:700,quality:90,level:1,bindOnMerchant:1,custom:["Used to upgrade rare pets, allowing them to pick up items."]}],cx=t=>{V9.forEach(e=>{t["box"+e.id]={...e,type:"box",tier:e.id,unsellable:!0}})};var $s={hammer:{sound:119,rot:1},bow:{sound:120,rot:1},staff:{sound:120,rot:1},sword:{sound:119,rot:1},armlet:{sound:121},armor:{sound:122},bag:{sound:121},boot:{sound:121},glove:{sound:121},ring:{sound:123},amulet:{sound:123},quiver:{sound:121,rot:1},shield:{sound:122},totem:{sound:122,rot:1},orb:{sound:122},rune:{sound:123,rot:0},misc:{sound:124,rot:1},book:{sound:121},mount:{sound:121,rot:0},pet:{sound:121,rot:0},box:{sound:125,rot:0},gold:{sound:126},charm:{sound:123}},Pn={hammer:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:3,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:15,min:.05,max:.1}},stackable:!1},bow:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:2,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}},stackable:!1},staff:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:1,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}},stackable:!1},sword:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:0,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:20,min:.05,max:.1}},stackable:!1},armlet:{baselvl:1,slot:[102],tiers:13,drop:1,weight:.3,stats:{6:{base:10,min:.5,max:.9},12:{base:7,min:.5,max:.8}},stackable:!1},armor:{baselvl:2,slot:[103],tiers:11,drop:1,weight:1,stats:{12:{base:10,min:1.4,max:2.8},6:{base:20,min:1,max:2}},stackable:!1},bag:{baselvl:5,slot:[104],tiers:5,drop:1,weight:.1,stats:{19:{base:1,min:.1,max:.3}},stackable:!1},boot:{baselvl:2,slot:[105],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.6,max:1.1},15:{base:3,min:.03,max:.1}},stackable:!1},glove:{baselvl:2,slot:[106],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.7,max:1.1},14:{base:1,min:.1,max:1.5}},stackable:!1},ring:{baselvl:5,slot:[107],tiers:12,drop:.8,weight:.2,stats:{6:{base:10,min:.5,max:.9},7:{base:5,min:.6,max:1}},stackable:!1},amulet:{baselvl:7,slot:[108],tiers:12,drop:.8,weight:.3,stats:{7:{base:10,min:1,max:1.8},9:{base:1,min:.2,max:.3}},stackable:!1},quiver:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:2,stats:{14:{base:5,min:.1,max:.9},9:{base:1,min:.1,max:.3}},stackable:!1},shield:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:0,stats:{12:{base:20,min:.8,max:1.4},13:{base:4,min:1,max:2.8}},stackable:!1},totem:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:3,stats:{12:{base:10,min:.4,max:.9},9:{base:1,min:.1,max:.4}},stackable:!1},orb:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:1,stats:{3:{base:10,min:.3,max:.7},9:{base:1,min:.1,max:.3}},stackable:!1},rune:{baselvl:1,tiers:11,drop:.8,quality:70,stackable:!0},misc:{drop:8,weight:.1,stackable:!0},book:{drop:1.6,weight:.5,stackable:!0},charm:{slot:[110,111],noupgrade:!0,undroppable:!0,drop:0,stackable:!1},mount:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},box:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},pet:{undroppable:!0,drop:0,stackable:!1},gold:{drop:24}},fx=Object.keys(Pn),Qf={6:{min:.2,max:.8,round:!0},7:{min:.2,max:.5,round:!0},8:{min:.1,max:1},9:{min:.1,max:.5},10:{min:.03,max:.13,round:!0},11:{min:.1,max:.2,round:!0},12:{min:.1,max:.8,round:!0},13:{min:.1,max:.4},14:{min:.1,max:.5},16:{min:.1,max:.4},2:{min:.08,max:.45,round:!0},0:{min:.08,max:.45,round:!0},3:{min:.08,max:.45,round:!0},4:{min:.08,max:.45,round:!0},1:{min:.08,max:.45,round:!0},5:{min:.08,max:.45,round:!0},18:{min:.01,max:.15,round:!0}},ux=Object.keys(Qf),Zf={6:4,7:3,8:5,9:4,10:1,11:1,12:5,13:5,14:5,15:.3,16:5,17:0,2:2,0:2,3:2,4:2,1:2,5:2,19:1,18:2};var mx=t=>{for(let e in Pn)if(Pn[e].tiers){let n=Pn[e];for(let s=0;s<n.tiers;++s)q9({type:e,tier:s,stats:n.stats,level:L9(e,s),class:n.class,quality:n.quality},t)}},L9=(t,e)=>Pn[t].baselvl+Math.floor(e/Pn[t].tiers*100),q9=(t,e)=>{let n={level:t.level,type:t.type,tier:t.tier,stats:t.stats?new Map:void 0,class:t.class,quality:t.quality};t.stats&&Object.keys(t.stats).sort((s,o)=>s-o).forEach(s=>{let o=t.stats[s];n.stats.set(parseInt(s),{min:o.base+t.level*o.min,max:o.base+(t.level+10)*o.max})}),e[t.type+t.tier]=n};var R9=[250,100,500,200,1e3,300],px=t=>{for(let e=0;e<6;++e){let n=Math.floor(e/2),s=e%2==0;t["misc"+e]={type:"misc",tier:e,level:1+n*20,goldvalue:5**n,quality:15,custom:[""+R9[e]+(s?" HP recovered":" MP recovered")],useSkill:100}}};var z9=[{lvl:30,g:1e4,qual:50,store:0,skin:6},{lvl:30,g:2e4,qual:50,store:0,skin:21},{lvl:30,g:5e4,qual:80,store:300,skin:51},{lvl:30,g:5e4,qual:80,store:300,skin:52},{lvl:30,g:5e4,qual:95,store:1200,skin:22},{lvl:30,g:5e4,qual:90,store:600,skin:23},{lvl:30,g:5e4,qual:80,store:300,skin:24},{lvl:30,g:5e4,qual:90,store:600,skin:25},{lvl:30,g:5e4,qual:95,store:1200,skin:27},{lvl:30,g:5e4,qual:95,store:1200,skin:28},{lvl:30,g:5e4,qual:80,store:300,skin:30},{lvl:30,g:5e4,qual:95,store:1200,skin:31},{lvl:30,g:5e4,qual:95,store:1200,skin:32},{lvl:30,g:5e4,qual:85,store:400,skin:29},{lvl:30,g:5e4,qual:95,store:1200,skin:33},{lvl:30,g:5e4,qual:95,store:0,skin:94},{lvl:30,g:5e4,qual:95,store:0,skin:95},{lvl:30,g:5e4,qual:95,store:0,skin:96},{lvl:30,g:5e4,qual:95,store:0,skin:97},{lvl:30,g:5e4,qual:95,store:0,skin:98},{lvl:30,g:5e4,qual:95,store:0,skin:100},{lvl:30,g:5e4,qual:95,store:0,skin:101},{lvl:30,g:5e4,qual:95,store:0,skin:93},{lvl:30,g:5e4,qual:95,store:0,skin:91},{lvl:30,g:5e4,qual:95,store:0,skin:99},{lvl:30,g:5e4,qual:95,store:0,skin:92}].map(t=>({level:t.lvl,goldValue:t.g,storeValue:t.store,bindOnUse:1,bindOnMerchant:t.store>0?1:0,quality:t.qual,skin:t.skin})),dx=t=>{z9.forEach((e,n)=>{t["mount"+n]={...e,type:"mount",tier:n,requiredSkill:39,useSkill:102}})};var B9=[1919,1920,1944,1945,1946,1947,1948,1960,1968,1969,1970,1971,1972,1973,1974,1975],hx=t=>{B9.forEach((e,n)=>{t["pet"+n]={level:10,unsellable:!0,storeValue:e>1920?0:900,quality:90,bindOnUse:1,bindOnMerchant:e>=1968?0:1,type:"pet",tier:n,useSkill:104,skin:e}})};var ln={};mx(ln);px(ln);ax(ln);dx(ln);zk(ln);hx(ln);cx(ln);var ar=Object.values(ln);ar.forEach((t,e)=>t.id=e);var ys=[{step:10,fun:()=>nt.fwd.down||nt.left.down||nt.right.down},{step:10,fun:()=>nt.lmb.down||nt.rmb.down},{element:"uftarget"},{element:"sk1"},{click:!0},{click:!0},{element:"expbar",click:!0},{},{element:"sysbag",fun:()=>fe.inventoryOpen},{element:"bag2",click:!0},{click:!0},{element:"syschar",fun:()=>fe.charpanelOpen},{element:"equipslots",click:!0},{fixed:()=>I.player.level>1&&I.player.stats.getStat(22)>0?100:Math.round(I.player.exp/ir(I.player.level)*100)},{element:"syschar",fun:()=>fe.charpanelOpen},{element:"statpoints"},{step:100,fixed:()=>Math.round(I.player.exp/ir(I.player.level)*100),fun:()=>I.player.level>3},{click:!0},{fixed:()=>Math.round(I.player.inventory.gold/32*100)},{fun:()=>fe.traderWindow},{element:()=>{let t=0;return $f.forEach(e=>{let n=ln[e.type+e.tier];n.type==="book"&&n.level===3&&n.class===I.player.class&&(t=e.id)}),"trader"+t}},{element:"bag0",click:!0},{element:"sysbook",fun:()=>fe.skillmenuOpen},{element:"skilllist",click:!0},{element:"tutsetskillpoint",click:!0},{element:"tutapplyskills",click:!0},{element:"skillbar",click:!0},{click:!0},{element:"partybtn",fun:()=>fe.partyOpen},{element:"partyapply"},{click:!0,gate:()=>I.player.party>0},{click:!0,gate:()=>I.player.level>=9},{click:!0,gate:()=>I.player.level>=11},{click:!0,gate:()=>I.player.level>=12},{click:!0,gate:()=>I.player.level>=13},{click:!0,gate:()=>I.player.level>=15},{click:!0,gate:()=>I.player.level>=16},{click:!0,element:"chat",gate:()=>I.player.level>=17},{click:!0,gate:()=>I.player.level>=18},{click:!0,gate:()=>I.player.level>=18},{click:!0,gate:()=>I.player.level>=20},{click:!0,gate:()=>I.player.level>=25},{click:!0,gate:()=>I.player.level>=26},{click:!0,gate:()=>I.player.level>=29},{click:!0,gate:()=>I.player.level>=30},{click:!0,gate:()=>I.player.level>=34},{click:!0,gate:()=>I.player.level>=36},{click:!0,gate:()=>I.player.level>=41},{click:!0,gate:()=>I.player.level>=45}],gx=!1,$9=()=>{Wh.reset(I.smoothtime),gx||(gx=!0,wi.subscribe(t=>{let e=ys[t];e&&(e.gate===void 0||e.gate())?ji.set(vx(t)):ji.set()}))},vx=t=>(xt(91),{...ys[t],msg:P.ui.tutorial.msg[t],progress:0}),Wh=new kt(0,.2),U9=()=>{let t=ys[fe.tutprogress];t&&Wh.done(I.smoothtime)&&(Wh.reset(I.smoothtime),!t.closing&&(t.gate===void 0||t.gate())&&(t.gate&&t.gate()&&an(fe.tutprogress,void 0,1),t.fun&&t.fun()&&an(fe.tutprogress,t.step||100),t.fixed&&an(fe.tutprogress,void 0,t.fixed())))},an=(t,e,n)=>{if(t===1e3){wi.set(1e3),yt("tutstep",`${t} ${e===1e4?1:0}`);return}return(n||e>0)&&(t===-1||fe.tutprogress===t)?(ji.update(s=>s?(s.progress=Math.min(100,n||s.progress+e),s.complete=s.progress>=100,s.complete&&!s.closing&&(s.closing=!0,ys[fe.tutprogress].closing=!0,xt(92),setTimeout(()=>{ji.set(),setTimeout(()=>{wi.update(o=>(yt("tutstep",`${o} ${e===1e4?1:0}`),ys[o+1]&&ys[o+1].element&&typeof ys[o+1].element!="string"&&(ys[o+1].element=ys[o+1].element()),o+1))},100)},200)),s):vx(t)),!0):!1};var Wt={friendrequest:t=>({name:"Friend request",fun:()=>{Ft("/api/social/friendRequest",{name:t})}}),blockplayer:t=>({name:"Block",fun:()=>{Ft("/api/social/blockPlayer",{name:t})}}),partyleave:t=>({name:P.ui.party.leave,fun:()=>{yt("partyleave")}}),partyinvite:t=>({name:P.ui.party.invite,fun:()=>{yt("partyinvite",t)}}),partykick:t=>({name:P.ui.party.kick,fun:()=>{yt("partykick",t)}}),partygiveassistant:t=>({name:P.ui.party.giveAssistant,fun:()=>{yt("partysetrole",t+" 1")}}),partygiveleader:t=>({name:P.ui.party.giveLeader,fun:()=>{yt("partysetrole",t+" 2")}}),partyremoveassistant:t=>({name:P.ui.party.removeAssistant,fun:()=>{yt("partysetrole",t+" 0")}}),partycreate:t=>({name:P.ui.party.create,fun:()=>{yt("partycreate")}}),whisper:t=>({name:P.ui.chat.whisper,fun:()=>{qs.set(`/${t} `)}}),itemdrop:(...t)=>({name:P.ui.inventory.drop,fun:()=>Hh(...t)}),itemsell:(...t)=>({name:P.ui.inventory.sell,fun:()=>Jf(...t)}),itemstash:t=>({name:P.ui.stash.stash,fun:()=>{yt("itemstash",t)}}),itemmove:(t,e)=>({name:P.ui.inventory.equip,fun:()=>{an(10,100),yt("itemmove",`${t} ${e}`)}}),itemsplithalf:t=>({name:P.ui.inventory.splithalf,fun:()=>{yt("itemsplithalf",t)}}),itemsplitone:t=>({name:P.ui.inventory.splitone,fun:()=>{yt("itemsplitone",t)}}),itemuse:(t,e,n,s)=>({name:P.ui.inventory.use,fun:()=>{Ip(n<s,()=>Es(Mt.clientPlayerSkill.packData({id:e,info:[t]})),"Bind Item","Using this item will bind it to you. Continue?")}}),itemcopyid:t=>({name:P.ui.inventory.copyitemid,fun:()=>{j3(t)}}),report:(t,e,n)=>({name:"Report",fun:s=>{mi.set({name:t,reason:0,messageId:e,info:n})}})},_x=(t,e)=>{let n=[{name:e.name,css:"disabled"}];e.type===0&&(e.id==I.playerId?fe.partyinfo.membercount>0?n.push(Wt.partyleave()):n.push(Wt.partycreate()):(e.faction===I.player.faction&&(Xt.has(e.name)?fe.partyinfo.role>e.role&&(fe.partyinfo.role==2&&n.push(Wt.partykick(e.name)),e.role==0?n.push(Wt.partygiveassistant(e.name)):e.role==1&&n.push(Wt.partyremoveassistant(e.name)),fe.partyinfo.role>1&&n.push(Wt.partygiveleader(e.name))):n.push(Wt.partyinvite(e.name))),n.push(Wt.friendrequest(e.name)),n.push(Wt.blockplayer(e.name)),n.push(Wt.report(e.name)),n.push(Wt.whisper(e.name)))),dn.set({x:t.pageX,y:t.pageY,opts:n})},bx=(t,e,n,s,o,i,r,l)=>{Ip(e>=fe.itemProtectQuality||n>0,()=>{yt(t,`${s}`)},r,`${l} ${nn(o,i)}?`)},Jf=(t,e,n,s,o)=>{bx("itemtradersell",t,e,n,s,o,"Sell item","Really sell")},Hh=(t,e,n,s,o)=>{bx("itemdrop",t,e,n,s,o,"Drop item","Really drop")};function yx(t){let e,n;return{c(){e=h("img"),p(e,"class","icon svelte-erbdzy"),at(e.src,n="/data/ui/icons/gem.svg?v=8685122")||p(e,"src",n)},m(s,o){w(s,e,o)},d(s){s&&x(e)}}}function O9(t){let e,n,s,o,i,r,l,a,c=t[4]&&yx(t);return{c(){e=h("span"),c&&c.c(),n=h("img"),o=T(t[1]),i=Ne(),r=h("span"),l=T(t[0]),p(n,"class","icon svelte-erbdzy"),at(n.src,s=ni(t[2]))||p(n,"src",s),p(e,"class","textwhite"),p(r,"class",a="name textf"+t[3]+" svelte-erbdzy")},m(f,u){w(f,e,u),c&&c.m(e,null),d(e,n),d(e,o),d(e,i),w(f,r,u),d(r,l)},p(f,[u]){f[4]?c||(c=yx(f),c.c(),c.m(e,n)):c&&(c.d(1),c=null),u&4&&!at(n.src,s=ni(f[2]))&&p(n,"src",s),u&2&&G(o,f[1]),u&1&&G(l,f[0]),u&8&&a!==(a="name textf"+f[3]+" svelte-erbdzy")&&p(r,"class",a)},i:ae,o:ae,d(f){f&&(x(e),x(r)),c&&c.d()}}}function N9(t,e,n){let{name:s}=e,{level:o}=e,{pclass:i}=e,{faction:r}=e,{sub:l=!1}=e;return t.$$set=a=>{"name"in a&&n(0,s=a.name),"level"in a&&n(1,o=a.level),"pclass"in a&&n(2,i=a.pclass),"faction"in a&&n(3,r=a.faction),"sub"in a&&n(4,l=a.sub)},[s,o,i,r,l]}var Yh=class extends Ce{constructor(e){super(),Pe(this,e,N9,O9,Be,{name:0,level:1,pclass:2,faction:3,sub:4})}},Xn=Yh;var rg={};Kn(rg,{addMessage:()=>Nt,hydratorItem:()=>so,init:()=>oE,onWorldDestroy:()=>lE,postTick:()=>iE,wipeChatData:()=>ig});var kx=t=>{let e=(t||0).toString().split(""),n=e.splice(-2).join(""),s=e.splice(-2).join(""),o=e.join("");return{c:n,s,g:o}};var Ya=(t,e=!0)=>{let n=Object.entries(t);return n.forEach(s=>{s[0]=parseInt(s[0]),e&&typeof s[1]=="object"&&(s[1]=Ya(s[1]))}),new Map(n)};var rs=t=>t>=1e4?(t/1e3).toFixed(1)+"k":dt(t);var dt=t=>t<1e3?t+"":dt(~~(t/1e3))+","+("00"+~~(t%1e3)).substr(-3,3),wx=(t,e)=>t.length>e?`${t.slice(0,e-2)}...`:t,xx=Ya({14:.1,13:.1,9:.1,8:.1,16:.1}),j9=Ya({14:"%",13:"%",16:"%",18:"%"}),Qn=(t,e)=>(xx.has(t)&&(e*=xx.get(t),e=e.toFixed(e>=.1?1:2)),e+(j9.get(t)||""));var W9=t=>t.replace(/\$c(\d)/g,(e,n)=>`<img class=texticon src='${ni(n)}'>`),G9=t=>t.replace(/\$l(\d+)/g,(e,n)=>`<span class=textwhite>${n}</span>`),H9=t=>t.replace(/\$f(\d)(\w*)/g,(e,n,s)=>`<span class=textf${n}>${s}</span>`),Y9=t=>t.replace(/\$gt/g,(e,n)=>'<img class="svgicon" src="/data/ui/icons/check.svg?v=8685122">'),X9=t=>t.replace(/\$e(\d+)/g,(e,n)=>Kf(n,!1)),Q9=t=>t.replace(/\$g(\d+)/g,(e,n)=>Xh(n,!1)),Z9=t=>t.replace(/\$m(\d+)/g,(e,n)=>Qh(n,!1)),J9=t=>t.replace(/\$sp(\d+)/g,(e,n)=>"<img class=texticon src=/data/ui/icons/gem.svg?v=8685122/>"+n),K9=t=>t.replace(/\$fm(\d+)/g,(e,n)=>`<span class=textfame><img class=svgicon src='/data/ui/currency/fame.svg?v=8685122'> ${n}</span>`),Xh=(t,e=!1)=>{let{c:n,s,g:o}=kx(t),i="<span/>";return o!=""&&(i+=`<span class=${e?"textred":"textgold"}>${o}</span> <img class=texticon src='/data/ui/currency/gold.${On}?v=8685122'/>`),s!=""&&(i+=`<span class=${e?"textred":"textsilver"}>${s}</span> <img class=texticon src='/data/ui/currency/silver.${On}?v=8685122'/>`),n!=""&&(i+=`<span class=${e?"textred":"textcopper"}>${n}</span> <img class=texticon src='/data/ui/currency/copper.${On}?v=8685122'/>`),i+"</span>"};var Qh=(t,e=!1)=>`<span class='${e?"textred":"textgold"}'><img class='svgicon' src='${rx}'> ${dt(t)}</span>`,Kf=t=>`<span class='bold textpvp'><img class='svgicon' src='${ix(t)}'> ${dt(t)}</span>`,ml=(t,e)=>`<span class='bold textprimary'><img class='svgicon' src='${lx(t)}'> ${e}</span>`,eE=[W9,G9,H9,Q9,K9,Y9,J9,Z9,X9],eu=t=>eE.reduce((e,n)=>n(e),t);var Zh,Jh={},It=t=>(Zh===void 0&&(Zh=getComputedStyle(document.body)),Jh[t]!==void 0?Jh[t]:Jh[t]=Zh.getPropertyValue("--"+t));var Mx=()=>{Ts.font="bold 18px hordes",Ts.fillText("Hordes",0,0)},cr=(t,e,n=1,s=1,o=1,i=1,r=0,l=0,a=.5,c=.5)=>{Ts.globalAlpha=fe.nameplateShowTransparency?n:1;let f=t.width*s,u=t.height*s,m=Math.round(f*o),g=Math.round(u*i);return m===0||g===0||Ts.drawImage(t,0,0,Math.round(t.width*o),Math.round(t.height*i),Math.round(e[0]-f*a+r*s),Math.round(e[1]-u*c+l*s),m,g),m},fr=(t,e,n,s,o,i=0,r=0,l=.5,a=.5)=>cr(tu(e,n),t,s,o,1,1,i,r,l,a),Fx=(t,e,n,s,o=0,i=0,r=.5,l=.5)=>cr(e,t,n,s,1,1,o,i,r,l),pl=(t,e,n=!1)=>(n?(e[0]=t[0],e[1]=t[1]):Ps(e,t,ht.projectionViewMatrix),n||e[2]<1&&e[0]>-1&&e[0]<1?(e[1]=Math.max(-1,Math.min(e[1],1)),e[0]=Math.round((e[0]*.5+.5)*Vn.width),e[1]=Math.round((e[1]*-.5+.5)*Vn.height),e[1]=Math.max(30,e[1]),e):!1),Cx=(t,e,n)=>{t.font="bold "+e+"px hordes",t.shadowColor="#000",t.shadowOffsetX=1,t.shadowOffsetY=1,t.fillStyle=n},Dt={name:{fill:It("name"),size:17},enemy:{fill:It("enemy"),size:17},pvp:{fill:It("pvp"),size:17},nameSmall:{fill:It("name"),size:13},enemySmall:{fill:It("enemy"),size:13},pvpSmall:{fill:It("pvp"),size:13},chatGlobal:{fill:It("global"),size:13,wrap:150},chatClan:{fill:It("clan"),size:13,wrap:150},chatParty:{fill:It("party"),size:13,wrap:150},chatWhisper:{fill:It("pvp"),size:13,wrap:150},chatYell:{fill:It("yell"),size:13,wrap:150},lev0:{fill:"#919191",size:13},lev1:{fill:It("name"),size:13},lev2:{fill:"#EEA303",size:13},lev3:{fill:It("enemy"),size:13},clan:{fill:It("clan"),size:17},faction0:{fill:It("f0"),size:17},faction1:{fill:It("f1"),size:17},faction0small:{fill:It("f0"),size:13},faction1small:{fill:It("f1"),size:13},phys:{fill:It("name"),size:18},physCrit:{fill:It("name"),size:24},spell:{fill:"#FFE404",size:28},spellCrit:{fill:"#FFE404",size:40},heal:{fill:"#12F027",size:28},mana:{fill:It("mana"),size:20},exp:{fill:It("exp"),size:20},fame:{fill:It("fame"),size:20},gold:{fill:"#EEDDA3",size:16},misc:{fill:"#A6EBFA",size:16},book:{fill:"#749DEF",size:20},rune:{fill:"#DC9A4D",size:20},itemgrey:{fill:"#747474",size:16},common:{fill:"#dddddd",size:20},uncommon:{fill:It("green"),size:20},rare:{fill:It("blue"),size:20},epic:{fill:It("purp"),size:20},legendary:{fill:"#EE960B",size:20},mythical:{fill:"#a72929",size:20},pheal:{fill:"#12F027",size:20},pdmg:{fill:It("enemy"),size:20}},Kh={},tu=(t,{fill:e,size:n,wrap:s=0})=>{let o=t+e+n;if(Kh[o])return Kh[o];let i=document.createElement("canvas"),r=i.getContext("2d");return r.font="bold "+n+"px hordes",s>0?tE(i,r,t,0,0,s,n,e):(i.width=Math.max(1,Math.ceil(r.measureText(t).width))+5,i.height=Math.ceil(n*1.2+5),Cx(r,n,e),r.fillText(t,0,i.height-6)),Kh[o]=i,i},Ds=(t,e,n,s,o,i,r)=>{t||(t=document.createElement("canvas"),t.width=n,t.height=s);let l=t.getContext("2d");return l.fillStyle=e,l.beginPath(),l.moveTo(o+r,i),l.arcTo(o+n,i,o+n,i+s,r),l.arcTo(o+n,i+s,o,i+s,r),l.arcTo(o,i+s,o,i,r),l.arcTo(o,i,o+n,i,r),l.closePath(),l.fill(),t},tE=(t,e,n,s,o,i,r,l)=>{let a=n.split(" "),c=[],f=0,u="";for(let m=0;m<a.length;++m){let g=u+a[m]+" ",v=e.measureText(g);v.width>i?(c.push(u),u=a[m]+" "):(f=Math.max(f,v.width),u=g)}c.push(u),t.width=Math.ceil(f+5),t.height=Math.ceil(c.length*r+10),Ds(t,"#00000099",t.width,t.height,0,0,5),Cx(e,r,l);for(let m=0;m<c.length;++m)e.fillText(c[m],s+5,(m+1)*r+3)};var Sx=(t,e,n,s,o,i)=>eg(t,o,i)&&Xa(s,o,i)&&ng(n,o,i)&&sg(e,o,i),eg=(t,e,n)=>ln[e+n]===void 0?(console.log("Error: Item can EQUIP type not found: "+e+n),console.trace(),!1):t>=ln[e+n].level,Xa=(t,e,n)=>ln[e+n].class===void 0||t===ln[e+n].class,nE=(t,e)=>t+At.get(e).skillpoints,tg=t=>t.reduce(nE,0),ng=(t,e,n)=>e!=="book"||nu(t,ln[e+n].skillid)===ln[e+n].skilllevel;var nu=(t,e)=>t.reduce((n,s)=>n+(s===e),0);var sg=(t,e,n)=>ln[e+n].requiredSkill===void 0||t.indexOf(ln[e+n].requiredSkill)>0;var Px=(t,e,n)=>ln[e+n].buyElo===void 0||t>=ln[e+n].buyElo;var Ax=(t,e,n,s)=>Math.ceil(t.goldValue||(.4*(t.level**1.3+e*.4))**(1.1+e/100)/Pn[t.type].drop)*(n||1)*(s?8:1);var ur=class{constructor(e){this.dbid=e,this.stats=new Map,this.dirty=!0}hydrate(e){if(this.dirty=!1,this.bound=e.bound,this.type=e.type,this.tier=e.tier,this.logic=ln[this.type+this.tier],this.auction=e.auction?new Date(e.auction):void 0,this.auctionprice=e.auctionprice,this.owner=e.name,this.stash=e.stash?new Date(e.stash):void 0,this.logic===void 0)throw"Unknown item "+e.type+e.tier;if(this.upgrade=e.upgrade,this.stats.clear(),e.rolls){if(this.setRolls(e.rolls),this.quality=this.nextRoll(),this.logic.stats){this.logic.stats.forEach((s,o)=>{this.stats.set(o,{type:"base",qual:this.quality,value:Math.floor(s.min+(s.max-s.min)*(this.quality/100)**2+Zf[o]*this.upgrade)})});let n=Math.min(4,Math.round((this.quality/100)**1.5*3.6));for(let s=0;s<n;++s){let o=this.nextRoll(),i=-1;for(;i===-1||this.stats.has(i);)i=parseInt(qh(ux,o/101)),o=(o+5)%100;let r=(this.nextRoll()+this.quality)/2;this.stats.set(i,{type:"bonus",qual:r,value:Math.ceil(Math.max((Qf[i].min+(Qf[i].max-Qf[i].min)*(r/100)**2)*this.logic.level*Pn[this.type].weight,Zf[i])+Zf[i]*this.upgrade)})}}this.quality=this.logic.quality||this.quality,this.stacks=void 0}else this.stacks=e.stacks,this.quality=this.logic.quality||0,this.setRolls();this.gs=0,this.logic.gs?this.gs=this.logic.gs:this.stats.forEach((n,s)=>{if(s===17)return;let o=n.value/Zf[s];this.type=="shield"&&n.type=="base"&&(o*=.5),this.type=="orb"&&n.type=="base"&&(o*=.7),this.gs+=o}),this.gs=Math.round(this.gs)}setRolls(e){this.rolls=e,this.currentRoll=0}nextRoll(){if(this.currentRoll==this.rolls.length)throw"roll maximum reached";return this.rolls[this.currentRoll++]}goldValue(e){if(!this.canBeSold())throw"Item cant have value because it cant be sold";return Ax(this.logic,this.quality,this.stacks,e)}storeValue(){return this.logic.storeValue||0}medalValue(){return this.logic.medalValue||0}canEquip(e){return Sx(e.level,e.skills.skillIdsActive,e.skills.skillIdsLearned,e.class,this.type,this.tier)}canEquipClass(e){return Xa(e.class,this.type,this.tier)}equipReasons(e){let n=[];return this.logic.level&&n.push(["Lv. "+this.logic.level,!0]),n}canBeDropped(){return!Pn[this.type].undroppable&&!this.bound}canBeTraded(){return!this.bound}canBeSold(){return!this.logic.unsellable}getStashTime(){return this.dirty?0:this.stash!==void 0?this.stash.getTime():0}getEquipSlot(){return Pn[this.type].slot!==void 0?Pn[this.type].slot[0]:void 0}};var so=new ur,sE=0,Tx=new kt(0,10),nd=[],sd=[],oE=()=>{Un(Mt.serverChat.header,t=>{nd.push(t)}),Un(Mt.serverSystemMessage.header,t=>{sd.push(t)})},og=0,iE=(t,e)=>{nd.forEach(n=>{let s=Mt.serverChat.decode(n);for(let o=0;o<s.items.length;++o){let i=s.items[o];i.rolls.length>0?i.stacks=null:i.rolls=void 0}if(s.from==""){let o=s.message.split(" "),i=o[0];if(i==="partyLootQueueResolve"&&!fe.msgItemPartyPickUp)return;P&&P.ui.messages[i]&&(s.message=P.ui.messages[i],o.splice(1).forEach((r,l)=>{s.message=s.message.replace("$"+(l+1),r)})),s.channel="notice"}else if(fe.chatbubbles&&og>5){let o=s.channel=="to"?e.player.name:s.from,i=e.getPlayerByName(o);if(i){let r;switch(s.channel){case"from":case"to":r=Dt.chatWhisper;break;case"clan":r=Dt.chatClan;break;case"party":r=Dt.chatParty;break;case"yell":r=Dt.chatYell;break;default:case"global":r=Dt.chatGlobal;break}let l="",a=0;for(let c=0;c<s.items.length;++c){let f=s.items[c];l+=s.message.slice(a,f.index)+nn(f.type,f.tier),a=f.index}l+=s.message.slice(a),i.speech(o+": "+l,r)}}s.clan==="GM"&&s.channel==="global"&&(s.channel="GM"),Nt(s.channel,s.message,s.channel=="system"||s.channel=="notice",s.from,s.faction,s.class,s.level,s.subscribed,s.id,s.items)}),sd.forEach(n=>{n=Mt.serverSystemMessage.decode(n),n.messages.forEach(s=>{Nt(s.type,s.message,!0)})}),nd.length=0,sd.length=0,og++},rE=["faction","GM","clan","party","yell","to","from","global","pvp"],Nt=(t,e,n=!1,s,o,i,r,l,a=0,c)=>{Oc.update(f=>{f.length>100&&f.shift(),n&&(e=eu(e)),t==="from"&&(Tx.done(I.time)&&xt(97),Tx.reset(I.time));let u=rE.includes(t),m=new Date;return f.push({channel:t,time:`${String(m.getHours()).padStart(2,"0")}.${String(m.getMinutes()).padStart(2,"0")}`,text:e,key:++sE,sender:s,sub:l,faction:o,cclass:i,level:r,interpolate:n,id:a,items:c,showChannel:u}),f})},ig=()=>{Oc.set([]),og=0},lE=()=>{nd.length=0,sd.length=0};var aE=[["white","common","grey"],["green","uncommon","green-l"],["blue","rare","blue-l"],["purp","epic","purp-l"],["orange", "legendary","orange-l"],["red", "mythical","red-l"]],Qa=t=>t>=110?5:t>=99?4:t>=90?3:t>=70?2:t>=50?1:0,jt=t=>aE[Qa(t)];function Ex(t){let e,n=t[0].channel+"",s,o;return{c(){e=h("span"),s=T(n),o=Ne(),p(e,"class","capitalize channel")},m(i,r){w(i,e,r),d(e,s),w(i,o,r)},p(i,r){r&1&&n!==(n=i[0].channel+"")&&G(s,n)},d(i){i&&(x(e),x(o))}}}function Ix(t){let e,n,s,o,i;return n=new Xn({props:{name:t[0].sender,pclass:t[0].cclass,level:t[0].level,faction:t[0].faction,sub:t[0].sub}}),{c(){e=h("span"),J(n.$$.fragment),p(e,"class","sender svelte-7c1tlw")},m(r,l){w(r,e,l),X(n,e,null),s=!0,o||(i=[H(e,"contextmenu",t[3]),H(e,"dblclick",t[4])],o=!0)},p(r,l){let a={};l&1&&(a.name=r[0].sender),l&1&&(a.pclass=r[0].cclass),l&1&&(a.level=r[0].level),l&1&&(a.faction=r[0].faction),l&1&&(a.sub=r[0].sub),n.$set(a)},i(r){s||(S(n.$$.fragment,r),s=!0)},o(r){E(n.$$.fragment,r),s=!1},d(r){r&&x(e),Q(n),o=!1,rt(i)}}}function cE(t){let e,n,s,o=t[0].time+"",i,r,l,a,c,f,u,m=t[0].showChannel&&Ex(t),g=t[0].sender&&Ix(t);return{c(){e=h("article"),n=h("div"),s=h("span"),i=T(o),r=h("span"),m&&m.c(),l=de(),g&&g.c(),c=h("span"),p(s,"class","time svelte-7c1tlw"),p(r,"class",a="text"+t[0].channel+" content svelte-7c1tlw"),p(c,"class",f="text"+t[0].channel+" svelte-7c1tlw"),p(n,"class","linewrap svelte-7c1tlw"),p(e,"class","line svelte-7c1tlw")},m(v,_){w(v,e,_),d(e,n),d(n,s),d(s,i),d(n,r),m&&m.m(r,null),d(r,l),g&&g.m(r,null),d(n,c),t[5](c),u=!0},p(v,[_]){(!u||_&1)&&o!==(o=v[0].time+"")&&G(i,o),v[0].showChannel?m?m.p(v,_):(m=Ex(v),m.c(),m.m(r,l)):m&&(m.d(1),m=null),v[0].sender?g?(g.p(v,_),_&1&&S(g,1)):(g=Ix(v),g.c(),S(g,1),g.m(r,null)):g&&(Me(),E(g,1,1,()=>{g=null}),Fe()),(!u||_&1&&a!==(a="text"+v[0].channel+" content svelte-7c1tlw"))&&p(r,"class",a),(!u||_&1&&f!==(f="text"+v[0].channel+" svelte-7c1tlw"))&&p(c,"class",f)},i(v){u||(S(g),u=!0)},o(v){E(g),u=!1},d(v){v&&x(e),m&&m.d(),g&&g.d(),t[5](null)}}}function fE(t,e,n){let s;ie(t,Lr,u=>n(6,s=u));let{line:o=void 0}=e,i,r=ci(),l=u=>{let m=[{name:o.sender,css:"disabled"}];I.player.name!==o.sender&&(o.faction==I.player.faction&&!Xt.has(o.sender)&&m.push(Wt.partyinvite(o.sender)),m.push(Wt.friendrequest(o.sender)),m.push(Wt.blockplayer(o.sender)),o.channel!=="to"&&m.push(Wt.report(o.sender,o.id,`Message: \u201C${o.text.length>40?o.text.substring(0,37)+"...":o.text}\u201D`)),m.push(Wt.whisper(o.sender))),dn.set({x:u.pageX,y:u.pageY,opts:m}),u.preventDefault()},a=u=>{if(u.altKey)qs.update(m=>m+`>${u.currentTarget.item.id}`);else{let m=s?s.dbid:void 0;if(Xe(Lr,s=void 0,s),m!==u.currentTarget.item.id){let g=new ur(u.currentTarget.item.id);g.hydrate(u.currentTarget.item),Xe(Lr,s=g,s)}}};Fn(()=>{if(o.interpolate){let u=document.createElement("span");u.innerHTML=o.text,i.appendChild(u)}else{let u=document.createDocumentFragment(),m=0;o.items&&o.items.forEach(g=>{let v=o.text.substring(m,g.index);v.length>0&&u.appendChild(document.createTextNode(v)),m=g.index,so.hydrate(g);let _=document.createElement("span"),b=jt(so.quality);_.classList.add("chatItem","text"+b[0]),_.textContent=nn(so.type,so.tier);let k=_.innerHTML;so.logic.stats&&(k+=`<span class=text${b[2]}> ${so.quality}%</span>`),so.upgrade&&(k+=`<span class=textprimary> +${so.upgrade}</span>`),so.stacks&&(k=`<span class=textsecondary>${so.stacks}</span><span class='textgrey'>\xD7</span>${k}`),_.innerHTML="["+k+"]",_.item=g,_.addEventListener("click",a),u.appendChild(_)}),m<o.text.length&&u.appendChild(document.createTextNode(o.text.substring(m))),i.appendChild(u)}});let c=u=>{r("focuschat",o.sender)};function f(u){qt[u?"unshift":"push"](()=>{i=u,n(1,i)})}return t.$$set=u=>{"line"in u&&n(0,o=u.line)},[o,i,r,l,c,f]}var lg=class extends Ce{constructor(e){super(),Pe(this,e,fE,cE,yn,{line:0})}},Dx=lg;var{Map:uE}=Lc;function Vx(t,e,n){let s=t.slice();return s[28]=e[n],s}function Lx(t,e,n){let s=t.slice();return s[31]=e[n],s}function qx(t,e,n){let s=t.slice();return s[34]=e[n],s}function Rx(t,e){let n,s,o;return s=new Dx({props:{line:e[34]}}),s.$on("focuschat",e[8]),{key:t,first:null,c(){n=de(),J(s.$$.fragment),this.first=n},m(i,r){w(i,n,r),X(s,i,r),o=!0},p(i,r){e=i;let l={};r[0]&64&&(l.line=e[34]),s.$set(l)},i(i){o||(S(s.$$.fragment,i),o=!0)},o(i){E(s.$$.fragment,i),o=!1},d(i){i&&x(n),Q(s,i)}}}function zx(t){let e,n,s=t[31]+"",o,i,r,l;function a(...c){return t[14](t[31],...c)}return{c(){e=h("div"),n=T("/"),o=T(s),p(e,"class",i="choice textsystem text"+t[31]+" svelte-c6ga6k")},m(c,f){w(c,e,f),d(e,n),d(e,o),r||(l=H(e,"click",a),r=!0)},p(c,f){t=c},d(c){c&&x(e),r=!1,l()}}}function Bx(t){let e,n=t[28]+"",s,o,i,r;function l(...a){return t[18](t[28],...a)}return{c(){e=h("small"),s=T(n),p(e,"class",o="btn border black text"+(t[0].indexOf(t[28])<0?t[28]:"grey")+" svelte-c6ga6k")},m(a,c){w(a,e,c),d(e,s),i||(r=H(e,"click",l),i=!0)},p(a,c){t=a,c[0]&1&&o!==(o="btn border black text"+(t[0].indexOf(t[28])<0?t[28]:"grey")+" svelte-c6ga6k")&&p(e,"class",o)},d(a){a&&x(e),i=!1,r()}}}function mE(t){let e,n,s=[],o=new uE,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A=me(t[6]),C=z=>z[34].key;for(let z=0;z<A.length;z+=1){let q=qx(t,A,z),L=C(q);o.set(L,s[z]=Rx(L,q))}let M=me(Object.keys(ol)),V=[];for(let z=0;z<M.length;z+=1)V[z]=zx(Lx(t,M,z));let $=me(t[11]),D=[];for(let z=0;z<$.length;z+=1)D[z]=Bx(Vx(t,$,z));return{c(){e=h("div"),n=h("section");for(let z=0;z<s.length;z+=1)s[z].c();i=h("div"),r=h("section"),l=h("div"),a=h("div");for(let z=0;z<V.length;z+=1)V[z].c();c=h("div"),c.textContent="/[playername]",f=h("div"),u=T(t[7]),g=h("input"),_=h("div");for(let z=0;z<D.length;z+=1)D[z].c();p(n,"id","chat"),p(n,"class","panel frame scrollbar svelte-c6ga6k"),p(c,"class","choice textwhisper"),p(a,"class","panel context commandlist textsystem svelte-c6ga6k"),Le(a,"display",t[5]?"block":"none"),p(f,"class",m="command btn black text"+(Ci[t[7]]?Ci[t[7]].chat?t[7]:"system":"whisper")+" svelte-c6ga6k"),p(g,"id","chatinputelement"),p(g,"maxlength","480"),p(g,"type","text"),p(g,"autocomplete","off"),p(g,"class","svelte-c6ga6k"),p(l,"id","chatinput"),p(l,"class","inputcontainer panel-black border black svelte-c6ga6k"),p(r,"class",v="chatsection "+(t[4]?"":"hidden")+" svelte-c6ga6k"),p(_,"class",b="channelselect "+(t[4]?"hidden":"")+" svelte-c6ga6k"),p(i,"class","lowercontainer svelte-c6ga6k"),p(e,"class","l-corner-ll container uiscaled svelte-c6ga6k")},m(z,q){w(z,e,q),d(e,n);for(let L=0;L<s.length;L+=1)s[L]&&s[L].m(n,null);t[13](n),d(e,i),d(i,r),d(r,l),d(l,a);for(let L=0;L<V.length;L+=1)V[L]&&V[L].m(a,null);d(a,c),d(l,f),d(f,u),d(l,g),je(g,t[1]),t[17](g),d(i,_);for(let L=0;L<D.length;L+=1)D[L]&&D[L].m(_,null);k=!0,y||(F=[H(f,"click",t[15]),H(g,"input",t[16])],y=!0)},p(z,q){if(q[0]&320&&(A=me(z[6]),Me(),s=En(s,q,C,1,z,A,o,n,Hn,Rx,null,qx),Fe()),q[0]&512){M=me(Object.keys(ol));let L;for(L=0;L<M.length;L+=1){let O=Lx(z,M,L);V[L]?V[L].p(O,q):(V[L]=zx(O),V[L].c(),V[L].m(a,c))}for(;L<V.length;L+=1)V[L].d(1);V.length=M.length}if((!k||q[0]&32)&&Le(a,"display",z[5]?"block":"none"),(!k||q[0]&128)&&G(u,z[7]),(!k||q[0]&128&&m!==(m="command btn black text"+(Ci[z[7]]?Ci[z[7]].chat?z[7]:"system":"whisper")+" svelte-c6ga6k"))&&p(f,"class",m),q[0]&2&&g.value!==z[1]&&je(g,z[1]),(!k||q[0]&16&&v!==(v="chatsection "+(z[4]?"":"hidden")+" svelte-c6ga6k"))&&p(r,"class",v),q[0]&3073){$=me(z[11]);let L;for(L=0;L<$.length;L+=1){let O=Vx(z,$,L);D[L]?D[L].p(O,q):(D[L]=Bx(O),D[L].c(),D[L].m(_,null))}for(;L<D.length;L+=1)D[L].d(1);D.length=$.length}(!k||q[0]&16&&b!==(b="channelselect "+(z[4]?"hidden":"")+" svelte-c6ga6k"))&&p(_,"class",b)},i(z){if(!k){for(let q=0;q<A.length;q+=1)S(s[q]);k=!0}},o(z){for(let q=0;q<s.length;q+=1)E(s[q]);k=!1},d(z){z&&x(e);for(let q=0;q<s.length;q+=1)s[q].d();t[13](null),st(V,z),t[17](null),st(D,z),y=!1,rt(F)}}}function pE(t,e,n){let s,o,i,r,l;ie(t,df,R=>n(0,o=R)),ie(t,Oc,R=>n(12,i=R)),ie(t,Qo,R=>n(7,r=R)),ie(t,qs,R=>n(1,l=R));let a,c=!0;F1(()=>{c=a&&(a.offsetHeight+a.scrollTop>a.scrollHeight-20||a.scrollTop==0)}),zc(()=>{c!==!1&&a.scrollTo(0,a.scrollHeight)});let f,u=!1,m=[],g=0,v=!1,_="faction",b=new Map([["c","clan"],["p","party"],["f","faction"]]),k=R=>Ci[R]&&Ci[R].chat,y=R=>{let U=l;if(R.keyCode===13)if(R.target===f){if(R.target.value!=""){let we=R.target.value.match(/^\/[a-zA-Z0-9]+/g);we&&(Xe(Qo,r=we[0].substring(1),r),U=""),ol[r]!==void 0&&ol[r].client?ol[r].fun(U):yt(r,U),U="",f.blur(),n(4,u=!1)}else k(r)||yt(r,U),f.blur(),n(4,u=!1);let Z=`/${r} `,ye=m.indexOf(Z);ye>=0&&m.splice(ye,1),m.length>10&&m.splice(0,1),m.push(Z),k(r)?_=r:(Xe(Qo,r=_,r),g=m.length)}else document.activeElement==document.body&&A();else(R.keyCode===38||R.keyCode===40)&&m.length?R.target===f&&(g+=R.keyCode===38?-1:1,g=gt(g,0,m.length-1),U=m[g],R.preventDefault()):R.keyCode===27&&(f.blur(),n(4,u=!1));Xe(qs,l=U,l)},F=R=>{f.focus()},A=R=>{R&&Xe(Qo,r=R.detail,r),n(4,u=!0),T1().then(F)},C=R=>{Xe(Qo,r=R,r),n(5,v=!1),f.focus()};Fn(()=>{document.addEventListener("keydown",y)}),Tn(()=>{document.removeEventListener("keydown",y)});let M=R=>{let U=o.indexOf(R);df.update(Z=>(U>=0?Z.splice(U,1):Z.push(R),Z))},V=["faction","party","clan","pvp","inv","yell"],$;function D(R){qt[R?"unshift":"push"](()=>{a=R,n(2,a)})}let z=(R,U)=>C(R),q=R=>n(5,v=!v);function L(){l=this.value,qs.set(l)}function O(R){qt[R?"unshift":"push"](()=>{f=R,n(3,f)})}let j=(R,U)=>M(R);return t.$$.update=()=>{if(t.$$.dirty[0]&4098){let R=l,U=R.match(/^\/[a-zA-Z0-9]+ /g);if(U){let Z=U[0].substring(1,U[0].length-1);if(Z==="r"||Z==="w")for(let ye=i.length-1;ye>0;--ye){let we=i[ye];we.channel=="from"&&(Xe(Qo,r=we.sender,r),ye=0)}else Xe(Qo,r=b.has(Z)?b.get(Z):Z,r);Xe(qs,l=R.substring(U[0].length),l),A()}R.length>0&&A()}t.$$.dirty[0]&4097&&n(6,s=i.filter(R=>o.indexOf(R.channel)<0))},[o,l,a,f,u,v,s,r,A,C,M,V,i,D,z,q,L,O,j]}var ag=class extends Ce{constructor(e){super(),Pe(this,e,pE,mE,Be,{},null,[-1,-1])}},$x=ag;function Ux(t){let e,n;return{c(){e=h("img"),at(e.src,n="/data/ui/icons/"+t[1]+".svg?v=8685122")||p(e,"src",n),p(e,"class","titleicon svgicon svelte-1f1v3u3")},m(s,o){w(s,e,o)},p(s,o){o[0]&2&&!at(e.src,n="/data/ui/icons/"+s[1]+".svg?v=8685122")&&p(e,"src",n)},d(s){s&&x(e)}}}function Ox(t){let e,n,s,o;return{c(){e=h("img"),at(e.src,n="/data/ui/icons/cog.svg?v=8685122")||p(e,"src",n),p(e,"class","btn black svgicon")},m(i,r){w(i,e,r),s||(o=H(e,"click",t[13]),s=!0)},p:ae,d(i){i&&x(e),s=!1,o()}}}function Nx(t){let e,n,s,o;return{c(){e=h("img"),at(e.src,n="/data/ui/icons/cross.svg?v=8685122")||p(e,"src",n),p(e,"class","btn black svgicon")},m(i,r){w(i,e,r),s||(o=H(e,"click",t[20]),s=!0)},p:ae,d(i){i&&x(e),s=!1,o()}}}function dE(t){let e,n,s,o,i,r,l,a,c,f,u,m,g,v,_=t[1]&&Ux(t),b=t[3]&&Ox(t),k=t[2]&&Nx(t),y=t[19].default,F=Zl(y,t,t[18],null);return{c(){e=h("div"),n=h("div"),s=h("div"),_&&_.c(),o=h("div"),i=h("div"),r=T(t[0]),b&&b.c(),l=de(),k&&k.c(),c=h("div"),F&&F.c(),p(o,"class","textprimary title svelte-1f1v3u3"),p(s,"class","titleframe svelte-1f1v3u3"),p(s,"style",a=t[7]?"":"cursor: pointer;"),p(c,"class",f="slot "+(t[4]?"scrollbar":"")+" svelte-1f1v3u3"),p(n,"class","window panel-black svelte-1f1v3u3"),p(e,"class","window-pos"),p(e,"style",u="z-index: "+t[5]+"; position: absolute; "+t[10]+": "+Math.round(t[8][0])+"px; "+t[11]+": "+Math.round(t[8][1])+"px;")},m(A,C){w(A,e,C),d(e,n),d(n,s),_&&_.m(s,null),d(s,o),d(o,i),d(i,r),b&&b.m(s,null),d(s,l),k&&k.m(s,null),d(n,c),F&&F.m(c,null),t[21](n),m=!0,g||(v=H(s,"mousedown",h_(t[12])),g=!0)},p(A,C){A[1]?_?_.p(A,C):(_=Ux(A),_.c(),_.m(s,o)):_&&(_.d(1),_=null),(!m||C[0]&1)&&G(r,A[0]),A[3]?b?b.p(A,C):(b=Ox(A),b.c(),b.m(s,l)):b&&(b.d(1),b=null),A[2]?k?k.p(A,C):(k=Nx(A),k.c(),k.m(s,null)):k&&(k.d(1),k=null),(!m||C[0]&128&&a!==(a=A[7]?"":"cursor: pointer;"))&&p(s,"style",a),F&&F.p&&(!m||C[0]&262144)&&Kl(F,y,A,A[18],m?Jl(y,A[18],C,null):ea(A[18]),null),(!m||C[0]&16&&f!==(f="slot "+(A[4]?"scrollbar":"")+" svelte-1f1v3u3"))&&p(c,"class",f),(!m||C[0]&288&&u!==(u="z-index: "+A[5]+"; position: absolute; "+A[10]+": "+Math.round(A[8][0])+"px; "+A[11]+": "+Math.round(A[8][1])+"px;"))&&p(e,"style",u)},i(A){m||(S(F,A),m=!0)},o(A){E(F,A),m=!1},d(A){A&&x(e),_&&_.d(),b&&b.d(),k&&k.d(),F&&F.d(A),t[21](null),g=!1,v()}}}function hE(t,e,n){let s;ie(t,_f,re=>n(26,s=re));let{$$slots:o={},$$scope:i}=e,r=ci(),{title:l="Title"}=e,{icon:a=void 0}=e,{close:c=!0}=e,{cog:f=!0}=e,{scroll:u=!1}=e,{permanent:m=!0}=e,{settings:g=[]}=e,{origin:v="right bottom"}=e,{defaultOffset:_=[3,3]}=e,{zindex:b=9}=e,k,y,F=v==="center"?"left":v.split(" ")[0],A=v==="center"?"top":v.split(" ")[1],C=F==="right"?1:-1,M=A==="bottom"?1:-1,V=0,$=0,D=!1,z=[..._],q=[0,0],L=re=>{re.button!==0||D||(q=[re.clientX,re.clientY],document.addEventListener("mousemove",O),document.addEventListener("mouseup",j))},O=re=>{n(8,z=[z[0]-(re.clientX-q[0])*C,z[1]-(re.clientY-q[1])*M]),q=[re.clientX,re.clientY],R()},j=()=>{document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",j)},R=()=>{let[re,le,ve]=[k.offsetWidth,k.offsetHeight,30];n(8,z[0]=Math.max(-re+ve,Math.min(z[0],V-ve)),z),n(8,z[1]=A==="bottom"?Math.max(-le+ve,Math.min(z[1],$-le)):Math.max(0,Math.min(z[1],$-ve)),z),U()};Fn(()=>{let re=k.parentElement.parentElement;V=re.clientWidth,$=re.clientHeight;let le=s.find(ve=>ve.id===l);le?(n(8,z=le.offset),n(7,D=le.locked)):Z(),y=new ResizeObserver(ve=>{let{width:_e,height:Ie}=ve[0].contentRect;v==="center"&&(n(8,z[0]+=(_e-V)/2,z),n(8,z[1]+=(Ie-$)/2,z)),V=_e,$=Ie,R()}),y.observe(k.parentElement.parentElement)}),Tn(()=>{document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",j),y.disconnect(),n(6,k=y=void 0)});let U=()=>{m&&_f.update(re=>{let le=re.find(ve=>ve.id===l);return le||(le={id:l},re.push(le)),le.offset=z,le.locked=D,re})},Z=()=>{if(v==="center"){let[re,le]=[k.offsetWidth,k.offsetHeight];n(8,z=[V/2-re/2,$/2-le/2])}else n(8,z=[..._])},ye=re=>{let le=[{name:l,css:"disabled"},{name:(D?"Unlock":"Lock")+" Window",fun:()=>{n(7,D=!D),U()}},{name:"Reset Window",fun:()=>{Z(),U()}},...g];dn.set({x:re.pageX,y:re.pageY,right:!0,opts:le})},we=()=>r("close");function he(re){qt[re?"unshift":"push"](()=>{k=re,n(6,k)})}return t.$$set=re=>{"title"in re&&n(0,l=re.title),"icon"in re&&n(1,a=re.icon),"close"in re&&n(2,c=re.close),"cog"in re&&n(3,f=re.cog),"scroll"in re&&n(4,u=re.scroll),"permanent"in re&&n(14,m=re.permanent),"settings"in re&&n(15,g=re.settings),"origin"in re&&n(16,v=re.origin),"defaultOffset"in re&&n(17,_=re.defaultOffset),"zindex"in re&&n(5,b=re.zindex),"$$scope"in re&&n(18,i=re.$$scope)},[l,a,c,f,u,b,k,D,z,r,F,A,L,ye,m,g,v,_,i,o,we,he]}var cg=class extends Ce{constructor(e){super(),Pe(this,e,hE,dE,Be,{title:0,icon:1,close:2,cog:3,scroll:4,permanent:14,settings:15,origin:16,defaultOffset:17,zindex:5},null,[-1,-1])}},$t=cg;function jx(t,e,n){let s=t.slice();return s[4]=e[n],s[6]=n,s}function Wx(t){let e,n;return e=new $t({props:{zindex:5,origin:"center",title:P.ui.headers.interaction,$$slots:{default:[gE]},$$scope:{ctx:t}}}),e.$on("close",t[3]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&129&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function Gx(t){let e,n,s=eu(t[4])+"",o,i,r;function l(...a){return t[2](t[6],...a)}return{c(){e=h("div"),n=h("span"),p(e,"class","btn border black textgreen"),p(e,"value",o=t[6])},m(a,c){w(a,e,c),d(e,n),n.innerHTML=s,i||(r=H(e,"click",l),i=!0)},p(a,c){t=a,c&1&&s!==(s=eu(t[4])+"")&&(n.innerHTML=s)},d(a){a&&x(e),i=!1,r()}}}function gE(t){let e,n,s=t[0].title+"",o,i,r=t[0].text+"",l,a=me(t[0].choices),c=[];for(let f=0;f<a.length;f+=1)c[f]=Gx(jx(t,a,f));return{c(){e=h("div"),n=h("h3"),o=T(s),i=h("p"),l=T(r);for(let f=0;f<c.length;f+=1)c[f].c();p(n,"class","textprimary name svelte-k1vie9"),p(e,"class","container svelte-k1vie9")},m(f,u){w(f,e,u),d(e,n),d(n,o),d(e,i),d(i,l);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(e,null)},p(f,u){if(u&1&&s!==(s=f[0].title+"")&&G(o,s),u&1&&r!==(r=f[0].text+"")&&G(l,r),u&3){a=me(f[0].choices);let m;for(m=0;m<a.length;m+=1){let g=jx(f,a,m);c[m]?c[m].p(g,u):(c[m]=Gx(g),c[m].c(),c[m].m(e,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=a.length}},d(f){f&&x(e),st(c,f)}}}function vE(t){let e,n,s=t[0]&&Wx(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[0]?s?(s.p(o,i),i&1&&S(s,1)):(s=Wx(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function _E(t,e,n){let s;ie(t,jo,l=>n(0,s=l));function o(l){Es(Mt.clientPlayerInteract.packData({id:l})),Xe(jo,s=void 0,s)}return[s,o,(l,a)=>o(l),()=>{Xe(jo,s=void 0,s)}]}var fg=class extends Ce{constructor(e){super(),Pe(this,e,_E,vE,Be,{})}},Hx=fg;function bE(t){let e,n,s,o,i,r,l,a,c,f=t[7].default,u=Zl(f,t,t[6],null);return{c(){e=h("div"),n=h("div"),s=h("span"),o=T(t[0]),i=h("span"),r=T(t[1]),u&&u.c(),p(s,"class","left svelte-i7i7g5"),p(i,"class","right svelte-i7i7g5"),p(n,"class",l="progressBar "+t[3]+" svelte-i7i7g5"),Le(n,"width",t[2]+"%"),Le(n,"font-size",t[4]),p(e,"class",a="bar "+(t[5]?"dark":"")+" svelte-i7i7g5"),Le(e,"z-index",t[3]=="hp"?"1":"0")},m(m,g){w(m,e,g),d(e,n),d(n,s),d(s,o),d(n,i),d(i,r),u&&u.m(e,null),c=!0},p(m,[g]){(!c||g&1)&&G(o,m[0]),(!c||g&2)&&G(r,m[1]),(!c||g&8&&l!==(l="progressBar "+m[3]+" svelte-i7i7g5"))&&p(n,"class",l),(!c||g&4)&&Le(n,"width",m[2]+"%"),(!c||g&16)&&Le(n,"font-size",m[4]),u&&u.p&&(!c||g&64)&&Kl(u,f,m,m[6],c?Jl(f,m[6],g,null):ea(m[6]),null),(!c||g&32&&a!==(a="bar "+(m[5]?"dark":"")+" svelte-i7i7g5"))&&p(e,"class",a),(!c||g&8)&&Le(e,"z-index",m[3]=="hp"?"1":"0")},i(m){c||(S(u,m),c=!0)},o(m){E(u,m),c=!1},d(m){m&&x(e),u&&u.d(m)}}}function yE(t,e,n){let{$$slots:s={},$$scope:o}=e,{left:i=""}=e,{right:r=""}=e,{fract:l}=e,{barcol:a}=e,{size:c}=e,{darken:f}=e;return t.$$set=u=>{"left"in u&&n(0,i=u.left),"right"in u&&n(1,r=u.right),"fract"in u&&n(2,l=u.fract),"barcol"in u&&n(3,a=u.barcol),"size"in u&&n(4,c=u.size),"darken"in u&&n(5,f=u.darken),"$$scope"in u&&n(6,o=u.$$scope)},[i,r,l,a,c,f,o,s]}var ug=class extends Ce{constructor(e){super(),Pe(this,e,yE,bE,yn,{left:0,right:1,fract:2,barcol:3,size:4,darken:5})}},ks=ug;var mg={};Kn(mg,{init:()=>kE,updateCd:()=>ou});var su=new Map,Yx=!1,kE=()=>{fetch("/data/ui/circlecooldowns/circlecooldowns.txt?v=8685122").then(async t=>{let e=(await t.text()).split(`
`);for(let n=0;n<3;++n){let s=[];for(let o=0;o<101;++o){let i=new Image;i.src=e.shift(),s.push([i])}su.set([40,31,23][n],s)}Yx=!0})},ou=(t,e,n)=>{Yx&&e&&t!==e.step&&(e.cdimg!==void 0&&(su.get(n)[e.step].push(e.removeChild(e.cdimg)),e.cdimg=void 0),(e.step=t)>0&&(su.get(n)[e.step].length===1?e.cdimg=su.get(n)[e.step][0].cloneNode():e.cdimg=su.get(n)[e.step].pop(),e.appendChild(e.cdimg)))};function Xx(t){let e,n;return{c(){e=h("div"),n=T(t[0]),p(e,"class","stacks slottext svelte-1nn7wcb")},m(s,o){w(s,e,o),d(e,n)},p(s,o){o&1&&G(n,s[0])},d(s){s&&x(e)}}}function Qx(t){let e,n=(t[5]>99?Math.round(t[5]/60)+"'":Math.ceil(t[5]))+"",s;return{c(){e=h("div"),s=T(n),p(e,"class","time absCentered slottext svelte-1nn7wcb")},m(o,i){w(o,e,i),d(e,s)},p(o,i){i&32&&n!==(n=(o[5]>99?Math.round(o[5]/60)+"'":Math.ceil(o[5]))+"")&&G(s,n)},d(o){o&&x(e)}}}function xE(t){let e,n,s,o,i,r,l,a,c,f,u=t[0]>1&&Xx(t),m=t[3]>30&&fe.cdTextBuffs&&t[5]>0&&Qx(t);return{c(){e=h("div"),n=h("div"),s=h("img"),i=h("div"),u&&u.c(),r=de(),m&&m.c(),p(s,"class","icon svelte-1nn7wcb"),at(s.src,o=t[1])||p(s,"src",o),Le(s,"max-width",t[3]+"px"),p(i,"class","overlay svelte-1nn7wcb"),p(n,"class",l="slot border "+(t[2]===1?"negative":"positive")+" svelte-1nn7wcb"),p(e,"class",a="container "+(t[5]<fe.buffCdFlashingDuration&&t[5]%fe.buffCdFlashingInterval*2>fe.buffCdFlashingInterval?"soon":"")+" svelte-1nn7wcb")},m(g,v){w(g,e,v),d(e,n),d(n,s),d(n,i),t[10](i),u&&u.m(n,null),d(n,r),m&&m.m(n,null),c||(f=H(e,"contextmenu",t[6]),c=!0)},p(g,[v]){v&2&&!at(s.src,o=g[1])&&p(s,"src",o),v&8&&Le(s,"max-width",g[3]+"px"),g[0]>1?u?u.p(g,v):(u=Xx(g),u.c(),u.m(n,r)):u&&(u.d(1),u=null),g[3]>30&&fe.cdTextBuffs&&g[5]>0?m?m.p(g,v):(m=Qx(g),m.c(),m.m(n,null)):m&&(m.d(1),m=null),v&4&&l!==(l="slot border "+(g[2]===1?"negative":"positive")+" svelte-1nn7wcb")&&p(n,"class",l),v&32&&a!==(a="container "+(g[5]<fe.buffCdFlashingDuration&&g[5]%fe.buffCdFlashingInterval*2>fe.buffCdFlashingInterval?"soon":"")+" svelte-1nn7wcb")&&p(e,"class",a)},i:ae,o:ae,d(g){g&&x(e),t[10](null),u&&u.d(),m&&m.d(),c=!1,f()}}}function wE(t,e,n){let{stacks:s}=e,{duration:o}=e,{time:i}=e,{icon:r}=e,{type:l}=e,{size:a}=e,{cancel:c}=e,f=1,u=0,m,g=()=>{c>=0&&yt("cancelbuff",c)};function v(_){qt[_?"unshift":"push"](()=>{m=_,n(4,m)})}return t.$$set=_=>{"stacks"in _&&n(0,s=_.stacks),"duration"in _&&n(7,o=_.duration),"time"in _&&n(8,i=_.time),"icon"in _&&n(1,r=_.icon),"type"in _&&n(2,l=_.type),"size"in _&&n(3,a=_.size),"cancel"in _&&n(9,c=_.cancel)},t.$$.update=()=>{t.$$.dirty&408&&(n(5,u=o-i),ou(Math.round(i/o*100),m,a))},[s,r,l,a,m,u,g,o,i,c,v]}var pg=class extends Ce{constructor(e){super(),Pe(this,e,wE,xE,yn,{stacks:0,duration:7,time:8,icon:1,type:2,size:3,cancel:9})}},Zx=pg;var Vg={};Kn(Vg,{envSkillId:()=>dr,findEnvironmentTarget:()=>i4,hoverinteractive:()=>xd,hovertarget:()=>_n,init:()=>EI,onWorldDestroy:()=>zI,parseHudTargets:()=>Dg,playertarget:()=>zn,preTick:()=>LI,ray:()=>mr,setEnvCast:()=>fu,setHoverTarget:()=>cu,setTarget:()=>pr,targetSwitchConciliate:()=>Ig,targetSwitchNetTimer:()=>_l,tick:()=>qI});var Kx=(t,e,n)=>{let s=W.getUniformBlockIndex(t,e),o=W.getActiveUniformBlockParameter(t,s,W.UNIFORM_BLOCK_DATA_SIZE),i={name:e,size:o,uniforms:[],index:n},r=W.getActiveUniformBlockParameter(t,s,W.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES),l=W.getActiveUniforms(t,r,W.UNIFORM_OFFSET);for(let a=0;a<r.length;++a){let c=r[a],f=W.getActiveUniform(t,c),u=l[a],m=f.size,g=0,v=0,_=!1;f.type===W.FLOAT_VEC3?(g=3,v=m>1?4:3):f.type===W.FLOAT_VEC2?(g=2,v=m>1?4:2):f.type===W.FLOAT_VEC4?(g=4,v=4):f.type===W.FLOAT_MAT4?(g=16,v=16):f.type===W.FLOAT?(g=1,v=1):f.type===W.INT&&(g=1,v=1,_=!0),m*=g;let b={name:f.name.replace("[0]",""),size:m,offset:u,divisor:v,elements:g,isInt:_};i.uniforms.push(b)}return i.uniforms.sort((a,c)=>a.offset-c.offset),i},Za=t=>{let e={layout:t,buffer:W.createBuffer(),data:{},dataArray:[]};W.bindBuffer(W.UNIFORM_BUFFER,e.buffer),W.bufferData(W.UNIFORM_BUFFER,t.size,W.DYNAMIC_DRAW),W.bindBuffer(W.UNIFORM_BUFFER,null);for(let n=0;n<t.uniforms.length;++n){let s=t.uniforms[n],o=[];for(let i=0;i<s.size;++i)o.push(0);e.data[s.name]=o,e.dataArray.push(o)}return e},dl=t=>{W.bindBufferBase(W.UNIFORM_BUFFER,t.layout.index,t.buffer)},Ei=(t,e,n,s=0)=>{s===0&&(s=e.length);for(let o=0;o<s;++o)t[o+n]=e[o]},ew=new ArrayBuffer(1e3),ME=new Int32Array(ew),Jx=new Float32Array(ew),od=t=>{for(let e=0;e<t.layout.uniforms.length;++e){let n=t.layout.uniforms[e];t.data[n.name]!==t.dataArray[e]&&(t.dataArray[e]=t.data[n.name])}},ls=t=>{let e=0;for(let n=0;n<t.layout.uniforms.length;++n){let s=t.layout.uniforms[n],o=t.dataArray[n],i=s.isInt?ME:Jx,r=0;for(;r<o.length;)for(let l=0;l<s.divisor;++l)l<s.elements&&(i[e]=o[r],r++),e++}W.bindBuffer(W.UNIFORM_BUFFER,t.buffer),W.bufferSubData(W.UNIFORM_BUFFER,0,Jx,0,t.layout.size/4),W.bindBuffer(W.UNIFORM_BUFFER,null)};var Ja=[],Ka,Fo,Ii,gl,vl,tw=t=>{let e=tt.width,n=tt.height;for(let s=0;s<2;++s)Ja.push(Pi(t,t,0,!0,W.COMPARE_REF_TO_TEXTURE));Ka=Pi(t,t,0,!0,W.COMPARE_REF_TO_TEXTURE),Fo=Pi(e,n,1,!0),Ii=Pi(e,n,1,!0),gl=Pi(Math.ceil(e/4),Math.ceil(n/4)),vl=Pi(Math.ceil(e/4),Math.ceil(n/4))},nw=(t,e)=>{qf(Fo,t,e),qf(Ii,t,e),qf(gl,Math.ceil(t/4),Math.ceil(e/4)),qf(vl,Math.ceil(t/4),Math.ceil(e/4))};var vd={};Kn(vd,{bloom:()=>vg,bloomMerge:()=>_g,drop:()=>id,foliagePlant:()=>rd,foliageStatic:()=>ld,fxaa:()=>bg,multimeshEffect:()=>ad,multimeshFlat:()=>cd,multimeshSimple:()=>fd,multimeshTextured:()=>iu,multimeshTexturedVcol:()=>ud,multimeshTree:()=>dg,particles:()=>md,particles_additive:()=>hg,particles_normal:()=>gg,ribbon:()=>ru,ribbonTextured:()=>kg,shadowInstanced:()=>lu,shadowInstancedAlpha:()=>xg,simple:()=>pd,simpleTextured:()=>xI,simpleVcol:()=>wI,sky:()=>wg,skyStarTex:()=>Mg,sun:()=>Fg,terrain:()=>dd,terrainEditorAreas:()=>MI,terrainEditorGrid:()=>FI,terrainEditorHeights:()=>CI,terrainEditorTiles:()=>SI,terrainFog:()=>hd,tint:()=>yg,water:()=>gd,waterEditorGrid:()=>PI});var ow=`#version 300 es
precision highp float;precision highp int;out vec4 fragColor;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D diffuse;in vec2 vUv;in float vShine;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 a=texture(diffuse,vUv);if(a.a<0.5)discard;a.rgb=mix(a.rgb*worldlight[1],a.rgb*1.1,smoothstep(-0.7,0.7,sin(time*6.0+vShine)));float b=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);a.rgb=mix(fog[0],a.rgb,b);fragColor=a;}`;var iw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in mat4 worldMatrix;in vec4 uvshift;in float shine;out float vShine;out vec2 vUv;void main(){vShine=shine;vWorldPos=worldMatrix*vec4(position,1.0);vUv=uvshift.zw-uv*uvshift.xy;vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);}`;var rw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform sampler2D foliageDiffuse;in vec3 vLight;in vec3 vLightAmb;in vec3 vLightDir;in vec2 vUv;out vec4 fragColor;void main(){vec4 b=texture(foliageDiffuse,vUv);float c=0.1;b.a=b.a*smoothstep(1.0,0.0,(vCameraDistance-110.0)/20.0);if(b.a<c){discard;};float d=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float e=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 f=shadowPVMatrix[1]*(vWorldPos);vec3 g=(f.xyz/f.w)*0.5+0.5;d=texture(shadowMaps[1],g);}else{vec4 f=shadowPVMatrix[0]*(vWorldPos);vec3 g=(f.xyz/f.w)*0.5+0.5;d=texture(shadowMaps[0],g);}d=d;d=max(d,e);}b.rgb=b.rgb*(vLight+vLightAmb+vLightDir*d);float h=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,h);fragColor=b;}`;var lw=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec4 instPos;in vec3 instNorm;in vec3 position;in vec2 uv;out vec3 vLightAmb;out vec3 vLightDir;out vec2 vUv;void main(){vUv=uv;vec3 b=vec3(0.0);for(int c=0;c<lightCount;++c){vec3 d=lightPos[c]-instPos.xyz;float e=lightCols[c].w-dot(d,d);if(e>0.0){e/=(lightCols[c].w);e=e*e;b+=0.3*lightCols[c].rgb*e;;}};vLight=b;vLightAmb=worldlight[1];vLightDir=worldlight[0]*max(0.0,dot(instNorm.xyz,worldlight[2]));vec3 f=position;float e=sin(time+instPos.x+f.x)*0.1*f.y;f.xz+=e;mat3 g;g[1]=instNorm.xyz;g[2]=normalize(cross(vec3(sin(instPos.x*100.0),0.0,cos(instPos.z*100.0)),g[1]));g[0]=normalize(cross(g[1],g[2]));vec3 h=g*f;vWorldPos=vec4(h*instPos.w+instPos.xyz,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var aw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform sampler2D foliageDiffuse;in vec3 vLightAmb;in vec3 vLightDir;in vec3 vLight;in vec2 vUv;out vec4 fragColor;void main(){vec4 b=texture(foliageDiffuse,vUv);b.a=b.a*smoothstep(1.0,0.0,(vCameraDistance-110.0)/20.0);if(b.a<0.5){discard;};float c=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float d=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 e=shadowPVMatrix[1]*(vWorldPos);vec3 f=(e.xyz/e.w)*0.5+0.5;c=texture(shadowMaps[1],f);}else{vec4 e=shadowPVMatrix[0]*(vWorldPos);vec3 f=(e.xyz/e.w)*0.5+0.5;c=texture(shadowMaps[0],f);}c=c;c=max(c,d);}b.rgb=b.rgb*(vLight+vLightAmb+vLightDir*c);float g=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,g);fragColor=b;}`;var cw=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec4 instPos;in vec3 instNorm;in vec3 position;in vec2 uv;out vec2 vUv;out vec3 vLightAmb;out vec3 vLightDir;void main(){vUv=uv;vec3 b=vec3(0.0);for(int c=0;c<lightCount;++c){vec3 d=lightPos[c]-instPos.xyz;float e=lightCols[c].w-dot(d,d);if(e>0.0){e/=(lightCols[c].w);e=e*e;b+=0.3*lightCols[c].rgb*e;;}}vLight=b;vLightAmb=worldlight[1];vLightDir+=worldlight[0]*max(0.0,dot(instNorm.xyz,worldlight[2]));vec3 f=position;mat3 g;g[1]=instNorm.xyz;g[2]=normalize(cross(vec3(sin(instPos.x*100.0),0.0,cos(instPos.z*100.0)),g[1]));g[0]=normalize(cross(g[1],g[2]));vec3 h=g*f;vWorldPos=vec4(h*instPos.w+instPos.xyz,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var fw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vCol;in vec2 vYcutoff;in vec4 vUvshift;out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec2 a=vec2((vUv.x+vUvshift.x)*vUvshift.z,(vUv.y+vUvshift.y)*vUvshift.w);vec4 b=vec4(1.0,1.0,1.0,texture(diffuse,a).r)*vCol;b.a*=min(1.0,max(0.0,vUv.y/vYcutoff[0]));b.a*=min(1.0,max(0.0,(vYcutoff[1]-vUv.y)/(1.0-vYcutoff[1])));if(b.a<0.01){discard;}float c=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,c);fragColor=b;fragColor.rgb*=fragColor.a;}`;var uw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in mat4 worldMatrix;in vec4 uvshift;in vec2 ycutoff;in vec4 color;out vec3 vNormal;out vec2 vUv;out vec4 vCol;out vec2 vYcutoff;out vec4 vUvshift;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vUvshift=uvshift;vCol=color;vYcutoff=ycutoff;vWorldPos=worldMatrix*vec4(position,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var mw=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 vLight;in vec4 vColor;in vec3 vNormal;in vec4 vInteriorlight;in float vAlpha;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}float o=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float p=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 q=shadowPVMatrix[1]*(vWorldPos);vec3 r=(q.xyz/q.w)*0.5+0.5;o=texture(shadowMaps[1],r);}else{vec4 q=shadowPVMatrix[0]*(vWorldPos);vec3 r=(q.xyz/q.w)*0.5+0.5;o=texture(shadowMaps[0],r);}o=o;o=max(o,p);}vec3 s=worldlight[1];vec3 t=worldlight[0];s=mix(s,vInteriorlight.rgb*0.5,vInteriorlight.a);t=mix(t,vInteriorlight.rgb,vInteriorlight.a);float u=max(0.0,min(1.0,vColor[3]*0.2));vec4 v=vec4(b(s,t,vColor.rgb,vNormal,o,vLight,u),vAlpha);float w=max(0.0,min(1.0,-vColor[3]));v.rgb=mix(v.rgb,vColor.rgb,w);float x=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);v.rgb=mix(fog[0],v.rgb,x);fragColor=v;}`;var pw=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 position;in vec3 normal;in vec4 color;in vec4 interiorlight;in float alpha;in mat4 worldMatrix;out vec4 vColor;out vec3 vNormal;out vec4 vInteriorlight;out float vAlpha;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vWorldPos=worldMatrix*vec4(position,1.0);vColor=color;vAlpha=alpha;vInteriorlight=interiorlight;vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var dw=`#version 300 es
precision highp float;precision highp int;in vec4 vColor;out vec4 fragColor;void main(){fragColor=vColor;fragColor.a=1.0;}`;var hw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 position;in vec4 color;in mat4 worldMatrix;out vec4 vColor;void main(){vColor=color;gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);;}`;var gw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Circle{vec4 circlePos;vec4 circleInfo;};in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vInteriorlight;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 o=texture(diffuse,vUv);if(o.a<0.5)discard;float p=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float q=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 r=shadowPVMatrix[1]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[1],s);}else{vec4 r=shadowPVMatrix[0]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[0],s);}p=p;p=max(p,q);}vec3 t=worldlight[1];vec3 u=worldlight[0];t=mix(t,vInteriorlight.rgb*0.5,vInteriorlight.a);u=mix(u,vInteriorlight.rgb,vInteriorlight.a);o.rgb=b(t,u,o.rgb,vNormal,p,vLight,0.0);o.rgb/=o.a;float v=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,v);float w=distance(vWorldPos.xz,circlePos.xz);float x=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(w<circlePos.w+0.1&&x>0.0){o.rgb=mix(o.rgb,circleInfo.rgb,x*circleInfo.a*((w<circlePos.w?w/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-w))/0.1)));}fragColor=o;}`;var vw=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in vec4 interiorlight;in mat4 worldMatrix;out vec3 vNormal;out vec2 vUv;out vec4 vInteriorlight;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vWorldPos=worldMatrix*vec4(position,1.0);vInteriorlight=interiorlight;vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var _w=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Circle{vec4 circlePos;vec4 circleInfo;};in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vCol;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 o=texture(diffuse,vUv);if(o.a<0.5)discard;float p=(float(gl_FrontFacing)*2.0-1.0);float q=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float r=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 s=shadowPVMatrix[1]*(vWorldPos);vec3 t=(s.xyz/s.w)*0.5+0.5;q=texture(shadowMaps[1],t);}else{vec4 s=shadowPVMatrix[0]*(vWorldPos);vec3 t=(s.xyz/s.w)*0.5+0.5;q=texture(shadowMaps[0],t);}q=q;q=max(q,r);}vec3 u=mix(worldlight[1],vCol.rgb,vCol.a);vec3 v=worldlight[0]*(1.0-vCol.a);o.rgb=b(u,v,o.rgb,vNormal,q,vLight,0.0);float w=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,w);float x=distance(vWorldPos.xz,circlePos.xz);float y=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(x<circlePos.w+0.1&&y>0.0){o.rgb=mix(o.rgb,circleInfo.rgb,y*circleInfo.a*((x<circlePos.w?x/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-x))/0.1)));}fragColor=o;}`;var bw=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in vec4 color;in mat4 worldMatrix;out vec3 vNormal;out vec2 vUv;out vec4 vCol;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vCol=color;vWorldPos=worldMatrix*vec4(position,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var yw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){vec4 o=texture(diffuse,vUv);if(o.a<0.7)discard;if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}float p=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float q=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 r=shadowPVMatrix[1]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[1],s);}else{vec4 r=shadowPVMatrix[0]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[0],s);}p=p;p=max(p,q);}o.rgb=b(worldlight[1],worldlight[0],o.rgb,vNormal,p,vLight,0.0);o.rgb/=o.a;float t=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,t);fragColor=o;}`;var kw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec3 position;in vec4 info;in vec2 progress;in vec4 scaleRota;in vec4 colStart;in vec4 colEnd;out vec4 vCol;out float vRotationCos;out float vRotationSin;out vec2 vOffset;void main(){float a=min(info[3]-1.0,floor(mix(info[2],info[3],mod(info[0]*progress[0],1.0))));vOffset=vec2(fract(a*0.125),-floor(a/8.0)*0.125);vCol=mix(colStart,colEnd,progress[1]);float b=mix(scaleRota[2],scaleRota[3],progress[0]);vRotationCos=cos(b);vRotationSin=sin(b);float c=mix(scaleRota[0],scaleRota[1],progress[1])*(abs(vRotationSin)+abs(vRotationCos));vec4 d=viewMatrix*vec4(position,1.0);gl_PointSize=c*resolution[1]*projectionMatrix[1][1]/length(d.xyz);gl_Position=projectionMatrix*d;}`;var xw=`#version 300 es
precision highp float;precision highp int;uniform sampler2D particleDiffuse;in vec4 vCol;in vec2 vOffset;in float vRotationCos;in float vRotationSin;out vec4 fragColor;const float a=1.0/(1024.0/8.0);void main(){float b=0.5;float c=abs(vRotationSin)+abs(vRotationCos);vec2 d=vec2(gl_PointCoord.x-b,gl_PointCoord.y-b)*c;vec2 e=d*vRotationCos;vec2 f=d*vRotationSin;d=vec2(e.x+f.y+b,e.y-f.x+b);if(d.x<a||d.x>1.0-a||d.y>1.0-a||d.y<a){discard;}d.x*=0.125;d.y=1.0-d.y*0.125;vec4 g=vec4(1.0,1.0,1.0,texture(particleDiffuse,d+vOffset).r);g*=vCol;if(g.a<0.01){discard;}fragColor=g;fragColor.rgb*=fragColor.a;fragColor.a*=0.33;}`;var ww=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D particleDiffuse;in vec4 vCol;in vec2 vOffset;in float vRotationCos;in float vRotationSin;out vec4 fragColor;const float a=1.0/(1024.0/8.0);void main(){float b=0.5;float c=abs(vRotationSin)+abs(vRotationCos);vec2 d=vec2(gl_PointCoord.x-b,gl_PointCoord.y-b)*c;vec2 e=d*vRotationCos;vec2 f=d*vRotationSin;d=vec2(e.x+f.y+b,e.y-f.x+b);if(d.x<a||d.x>1.0-a||d.y>1.0-a||d.y<a){discard;}d.x*=0.125;d.y=1.0-d.y*0.125;vec3 g=texture(particleDiffuse,d+vOffset).rgb;if((g.r+g.g+g.b)<0.1){discard;}fragColor=vec4(g.rgb,1.0);}`;var Mw=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;uniform vec2 offset[4];uniform vec4 amount;in vec2 vUv;out vec4 fragColor;void main(){vec3 a=texture(inputA,vUv+offset[0]).rgb*amount[0];a+=texture(inputA,vUv+offset[1]).rgb*amount[1];a+=texture(inputA,vUv+offset[2]).rgb*amount[2];a+=texture(inputA,vUv+offset[3]).rgb*amount[3];fragColor=vec4(a,1.0);}`;var Fw=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;uniform sampler2D inputB;uniform float amount;in vec2 vUv;out vec4 fragColor;void main(){vec4 a=texture(inputA,vUv);vec3 b=texture(inputB,vUv).rgb;b=b*b;fragColor.w=a.w;fragColor.xyz=b*amount+a.xyz;}`;var Cw=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;in vec2 vUv;out vec4 fragColor;
#define a  4.0
#define b (1.0/a)
#define c (1.0/128.0)
#define d (1.0/8.0)
vec3 e(vec4 f,sampler2D g,vec2 h){vec3 i=textureLod(g,f.zw,0.0).xyz;vec3 j=textureLod(g,f.zw+vec2(1,0)*h.xy,0.0).xyz;vec3 k=textureLod(g,f.zw+vec2(0,1)*h.xy,0.0).xyz;vec3 l=textureLod(g,f.zw+vec2(1,1)*h.xy,0.0).xyz;vec3 m=textureLod(g,f.xy,0.0).xyz;vec3 n=vec3(0.299,0.587,0.114);float o=dot(i,n);float p=dot(j,n);float q=dot(k,n);float r=dot(l,n);float s=dot(m,n);float t=min(s,min(min(o,p),min(q,r)));float u=max(s,max(max(o,p),max(q,r)));vec2 v;v.x=-((o+p)-(q+r));v.y=((o+q)-(p+r));float w=max((o+p+q+r)*(0.25*b),c);float x=1.0/(min(abs(v.x),abs(v.y))+w);v=min(vec2(a,a),max(vec2(-a,-a),v*x))*h.xy;vec3 y=(1.0/2.0)*(textureLod(g,f.xy+v*(1.0/3.0-0.5),0.0).xyz+textureLod(g,f.xy+v*(2.0/3.0-0.5),0.0).xyz);vec3 az=y*(1.0/2.0)+(1.0/4.0)*(textureLod(g,f.xy+v*(0.0/3.0-0.5),0.0).xyz+textureLod(g,f.xy+v*(3.0/3.0-0.5),0.0).xyz);float aa=dot(az,n);if((aa<t)||(aa>u))return y;return az;}void main(){vec2 h=1.0/resolution;vec4 f=vec4(vUv,vUv-(h*(0.5+d)));vec3 ab=e(f,inputA,1.0/resolution);fragColor=vec4(ab,1.);}`;var Sw=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D inputA;uniform vec4 tint;uniform float warp;in vec2 vUv;out vec4 fragColor;void main(){float a=0.01;float b=5.0;vec2 c;c.x=sin(vUv.y*10.0+time)*a;c.y=cos(vUv.x*10.0+time)*a;vec4 d=texture(inputA,vUv);vec4 e=texture(inputA,vUv+c);vec4 f=mix(d,e,warp);f.rgb=mix(f.rgb,tint.rgb*0.2+0.8*tint.rgb*length(f.rgb),tint.a);fragColor=f;}`;var Pw=`#version 300 es
precision highp float;precision highp int;uniform vec4 colStart;uniform vec4 colEnd;uniform vec2 offset;in vec2 vUv;out vec4 fragColor;void main(){fragColor=mix(colStart,colEnd,vUv.x);if(fragColor.a<0.01){discard;}fragColor.rgb*=fragColor.a;fragColor.a*=0.5;}`;var Aw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform vec2 offset;in vec3 position;in vec2 uv;out vec2 vUv;void main(){vUv=vec2(uv.x-min(uv.x/offset.y,1.0)*offset.x,uv.y);gl_Position=projectionViewMatrix*vec4(position,1.0);}`;var Tw=`#version 300 es
precision highp float;precision highp int;uniform vec4 colStart;uniform vec4 colEnd;uniform vec2 offset;uniform sampler2D diffuse;in vec2 vUv;out vec4 fragColor;void main(){fragColor=texture(diffuse,vUv);fragColor*=mix(colStart,colEnd,vUv.x);if(fragColor.a<0.01){discard;}}`;var Ew=`#version 300 es
precision highp float;precision highp int;void main(){}`;var Iw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in mat4 worldMatrix;in vec3 position;in vec2 uv;out vec2 vUv;void main(){vUv=uv;gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);}`;var Dw=`#version 300 es
precision highp float;precision highp int;in vec2 vUv;uniform sampler2D diffuse;void main(){if(texture(diffuse,vUv).a<0.7)discard;}`;var Vw=`#version 300 es
precision highp float;precision highp int;uniform vec4 color;out vec4 fragColor;void main(){fragColor=color;}`;var Lw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 position;in vec2 uv;in vec3 normal;out vec2 vUv;out vec3 vNormal;out vec3 vPos;void main(){vUv=uv;vNormal=normal;vPos=position;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var qw=`#version 300 es
precision highp float;precision highp int;uniform sampler2D diffuse;in vec2 vUv;out vec4 fragColor;void main(){vec4 a=texture(diffuse,vUv);vec3 b=normalize(vec3(1.0,1.0,0.3));fragColor=a;if(fragColor.a<0.2)discard;}`;var Rw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec2 uv;in vec3 position;in vec3 normal;out vec2 vUv;out vec3 vNormal;void main(){vUv=uv;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var zw=`#version 300 es
precision highp float;precision highp int;in vec4 vColor;out vec4 fragColor;void main(){fragColor=vColor;}`;var Bw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 position;in vec4 color;out vec4 vColor;void main(){vColor=color;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var $w=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Sky{vec3 skycolors[5];vec3 suncolor;};uniform sampler2D skyDiffuse;uniform sampler2D cloudDiffuse;in vec2 vUv;in vec3 vPos;out vec4 fragColor;void main(){gl_FragDepth=0.999999;vec3 a=vec3(0.0);float b=vPos.y/0.5;if(b>0.4){a=mix(skycolors[1],skycolors[0],smoothstep(0.4,1.0,b));}else if(b>0.25){a=mix(skycolors[2],skycolors[1],smoothstep(0.25,0.4,b));}else if(b>0.06){a=mix(skycolors[3],skycolors[2],smoothstep(0.06,0.25,b));}else{a=mix(fog[0],skycolors[3],smoothstep(0.0,0.06,b));}float c=1.0-sin(daycycle*6.28)+0.02;float d=smoothstep(0.1,0.5,b)*smoothstep(0.9,0.6,b);a+=texture(skyDiffuse,vUv*vec2(4.0,1.0)).rgb*c*d;float e=texture(cloudDiffuse,vec2(vUv.x+time/80.0,vUv.y*0.6+time/120.0)).r*texture(cloudDiffuse,vec2(vUv.x*2.0+time/300.0,vUv.y*0.6)).r;e=e*smoothstep(0.0,0.1,b)*smoothstep(0.9,0.6,b);e=smoothstep(0.25,0.7,e);a=mix(a,skycolors[4],e);fragColor=vec4(a,1.0);}`;var Uw=`#version 300 es
precision highp float;precision highp int;in vec2 vUv;uniform float seed;float a(in vec2 uv,float scale){uv*=scale;vec2 b=floor(uv),f=fract(uv),p;float c=3.,d;p=.5+.35*sin(11.*fract(sin((b+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);c=min(d,c);return smoothstep(0.,c,sin(f.x+f.y)*0.003);}vec2 d(vec2 e){e=vec2(dot(e,vec2(127.1,311.7)),dot(e,vec2(269.5,183.3)));return-1.0+2.0*fract(sin(e)*43758.5453123);}float f(in vec2 e){const float g=0.366025404;const float h=0.211324865;vec2 i=floor(e+(e.x+e.y)*g);vec2 j=e-i+(i.x+i.y)*h;vec2 l=(j.x>j.y)?vec2(1.0,0.0):vec2(0.0,1.0);vec2 m=j-l+h;vec2 n=j-1.0+2.0*h;vec3 q=max(0.5-vec3(dot(j,j),dot(m,m),dot(n,n)),0.0);vec3 r=q*q*q*vec3(dot(j,d(i+0.0)),dot(m,d(i+l)),dot(n,d(i+1.0)));float t=dot(r,vec3(70.0));return smoothstep(-1.0,1.0,t);}out vec4 fragColor;void main(){vec2 u=vec2(vUv.x+seed,vUv.y);float r=a(vUv,10.0);r+=a(vUv,20.0)*0.5;r+=a(vUv,30.0)*0.2;r*=f(vUv*20.0);fragColor.rgb+=r*4.0;}`;var Ow=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Sky{vec3 skycolors[5];vec3 suncolor;};in vec2 vUv;in vec3 vPos;out vec4 fragColor;void main(){gl_FragDepth=0.999998;float a=length(vec2(0.5,0.5)-vUv);float b=smoothstep(0.3,0.2,a)*2.0;b+=smoothstep(0.5,0.1,a);b*=smoothstep(0.08,0.15,(vPos.y+0.2)*0.2+abs(sin(daycycle*6.282)));fragColor.rgba=vec4(suncolor,b);}`;var Nw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;vec3 f(vec3 g,vec3 h,vec3 i,vec3 j,float k,vec3 l,float m){float n=clamp(dot(j,worldlight[2]),0.0,k);vec3 o=g*mix(0.7,1.1,0.5+(0.5*n));vec3 p=normalize(worldlight[2]+vViewDir);vec3 q=h*pow(max(0.0,dot(p,j)),20.0)*m*max(k*0.7+0.2,0.2)*20.0;vec3 r=o+h*n+l;return r*i+q;}void s(vec4 t,float u,vec4 v){float w=t.x+t.y+t.z;e+=v[3]*smoothstep(v[1],v[2],w)*u;t.a=u;t.rgb*=u;d+=t;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 x=texture(atlas,vUvChannel);x[3]=max(0.0,min(1.0,1.0-(x.r+x.g+x.b)));if(x[0]==1.0&&x[1]==1.0&&x[2]==1.0)discard;s(texture(diffuse[0],vUvTexture[0]),x[0],terrainInfo[0]);s(texture(diffuse[1],vUvTexture[1]),x[1],terrainInfo[1]);s(texture(diffuse[2],vUvTexture[2]),x[2],terrainInfo[2]);s(texture(diffuse[3],vUvTexture[3]),x[3],terrainInfo[3]);d.rgb/=d.a;e/=d.a;d.a=1.0;float y=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float az=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 aa=shadowPVMatrix[1]*(vWorldPos);vec3 ab=(aa.xyz/aa.w)*0.5+0.5;y=texture(shadowMaps[1],ab);}else{vec4 aa=shadowPVMatrix[0]*(vWorldPos);vec3 ab=(aa.xyz/aa.w)*0.5+0.5;y=texture(shadowMaps[0],ab);}y=y;y=max(y,az);}d.rgb=f(worldlight[1],worldlight[0],d.rgb,vNormal,y,vLight,e);float ac=distance(vWorldPos.xz,circlePos.xz);float ad=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(ac<circlePos.w+0.1&&ad>0.0){d.rgb=mix(d.rgb,circleInfo.rgb,ad*circleInfo.a*((ac<circlePos.w?ac/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-ac))/0.1)));}float ae=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,ae);fragColor=d;}`;var jw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float a=256.0;const float b=4.0;in vec3 position;in vec3 normal;out vec3 vNormal;out vec3 vUvChannel;out vec2 vUvTexture[4];out vec3 vViewDir;void main(){vNormal=normal;vWorldPos=modelMatrix*vec4(position,1.0);vUvChannel=vec3(position[0],position[2],0.0)/32.0;int c=quadrant%2;int d=int(quadrant%4);if(c==1)vUvChannel.x-=1.0;if(d>1)vUvChannel.y-=1.0;vUvChannel.z=float(quadrant);vec2 e=vec2(-vWorldPos[0],vWorldPos[2])/4.0;vUvTexture[0]=e*terrainInfo[0][0];vUvTexture[1]=e*terrainInfo[1][0];vUvTexture[2]=e*terrainInfo[2][0];vUvTexture[3]=e*terrainInfo[3][0];for(int f=0;f<lightCount;++f){vec3 g=lightPos[f]-vWorldPos.xyz;float h=lightCols[f].w-dot(g,g);if(h>0.0){h/=(lightCols[f].w);h=h*h;vLight+=0.2*lightCols[f].rgb*h;}}vViewDir=-normalize(vWorldPos.xyz-cameraPosition);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var Ww=`#version 300 es
precision highp float;precision highp int;in vec4 vWorldPos;out vec4 fragColor;uniform vec4 colors[576];uniform int divider;void main(){float a=64.0/float(divider);int b=int(floor(mod(vWorldPos.x,64.0)/a)+floor(mod(vWorldPos.z,64.0)/a)*float(divider));fragColor.rgba=colors[b];}`;var Gw=`#version 300 es
precision highp float;precision highp int;in vec3 vPos;in vec3 vNormal;out vec4 fragColor;void main(){float a=0.0;if(vNormal.y<0.93){a=1.0;}fragColor=vec4(0.0,0.0,a,0.4+a*0.6);if(abs(vPos.x-0.0)<0.001||abs(vPos.x-64.0)<0.001||abs(vPos.z-0.0)<0.001||abs(vPos.z-64.0)<0.001)fragColor=vec4(1.0,1.0,0.0,1.0);if((abs(vPos.x-32.0)<0.001&&mod(vPos.z,1.0)<0.5)||(abs(vPos.z-32.0)<0.001&&mod(vPos.x,1.0)<0.5))fragColor=vec4(1.0,1.0,0.0,1.0);}`;var Hw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 normal;in vec3 position;out vec3 vPos;out vec3 vNormal;void main(){vNormal=normal;vPos=position;gl_Position=projectionViewMatrix*modelMatrix*vec4(position[0],position[1]+0.05,position[2],1.0);}`;var Yw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;void f(vec4 g,float h,vec4 i){float j=g.x+g.y+g.z;e+=i[3]*smoothstep(i[1],i[2],j)*h;g.a=h;g.rgb*=h;d+=g;}out vec4 fragColor;void main(){vec4 k=texture(atlas,vUvChannel);k[3]=max(0.0,min(1.0,1.0-(k.r+k.g+k.b)));if(k[0]==1.0&&k[1]==1.0&&k[2]==1.0)discard;f(texture(diffuse[0],vUvTexture[0]),k[0],terrainInfo[0]);f(texture(diffuse[1],vUvTexture[1]),k[1],terrainInfo[1]);f(texture(diffuse[2],vUvTexture[2]),k[2],terrainInfo[2]);f(texture(diffuse[3],vUvTexture[3]),k[3],terrainInfo[3]);d.rgb/=d.a;e/=d.a;d.a=1.0;if(mod(vWorldPos.y,2.0)<0.2){d.rgb=mix(d.rgb,vec3(0.8),0.5);}else{d.rgb=mix(d.rgb,vec3(0.2),0.5);}vec3 l=worldlight[2];l.y*=0.5;l=normalize(l);d.rgb*=max(0.3,min(1.0,dot(l,vNormal)*0.5+0.5));float m=distance(vWorldPos.xz,circlePos.xz);if(m<circlePos.w+0.1){d.rgb=mix(d.rgb,circleInfo.rgb,circleInfo.a*(max(0.,(0.3-abs(circlePos.w-m))/0.3)));}float n=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,n);fragColor=d;}`;var Xw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;void f(vec4 g,float h,vec4 i){float j=g.x+g.y+g.z;e+=i[3]*smoothstep(i[1],i[2],j)*h;g.a=h;g.rgb*=h;d+=g;}out vec4 fragColor;void main(){vec4 k=texture(atlas,vUvChannel);k[3]=max(0.0,min(1.0,1.0-(k.r+k.g+k.b)));if(k[0]==1.0&&k[1]==1.0&&k[2]==1.0)discard;d.rgb=texture(diffuse[0],vUvTexture[0]).rgb;float l=64.0/12.0;float m=l/2.0;bool n=mod(vWorldPos.z,l)>m;if(mod(vWorldPos.x,l)<m){if(n){d.rgb=vec3(0.45);}else{d.rgb=vec3(0.55);}}else{if(n){d.rgb=vec3(0.55);}else{d.rgb=vec3(0.45);}}vec3 o=worldlight[2];o.y*=0.5;o=normalize(o);d.rgb*=max(0.3,min(1.0,dot(o,vNormal)*0.5+0.5));float p=distance(vWorldPos.xz,circlePos.xz);if(p<circlePos.w+0.1){d.rgb=mix(d.rgb,circleInfo.rgb,circleInfo.a*(max(0.,(0.3-abs(circlePos.w-p))/0.3)));}float q=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,q);fragColor=d;}`;var Qw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;out vec4 fragColor;void main(){fragColor.rgb=fog[0];}`;var Zw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};in vec3 position;void main(){vec4 a=modelMatrix*vec4(position,1.0);gl_Position=projectionViewMatrix*a;}`;var Jw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};uniform sampler2D waterLines;uniform sampler2D waterNoise;uniform sampler2D bufferPongColor;uniform sampler2D bufferPongDepth;in vec2 vUv;out vec4 fragColor;void main(){float a=length(cameraPosition-vWorldPos.xyz);float b=(texture(waterNoise,vUv.yx/4.0+time*0.1).r-0.5);float c=gl_FragCoord.z;c=c*2.0-1.0;c=projectionMatrix[3][2]/(c+projectionMatrix[2][2]);if(a>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec2 d=gl_FragCoord.xy/resolution;float e=texture(bufferPongDepth,d.xy).r;e=e*2.0-1.0;e=projectionMatrix[3][2]/(e+projectionMatrix[2][2]);float f=e-c;vec2 g=vec2(b*0.05,0.0);float h=f;float i=1.0-clamp(h/0.1,0.0,1.0);float j=1.0-clamp(h/0.6,0.0,1.0);float k=1.0-clamp(h/2.0,0.0,1.0);float l=1.0-clamp(h/10.0,0.0,1.0);float m=1.0-clamp(h/100.0+0.5,0.0,1.0);float n=texture(waterLines,vUv.yx+b*0.15).r;vec3 o=mix(watercolors[2],watercolors[1],l);vec3 p=texture(bufferPongColor,d.xy+g).rgb;vec3 q=(worldlight[0]+worldlight[1]);vec3 r=mix(o,p*o,m)+n*watercolors[0]*(0.05+k*0.3);r=mix(r,watercolors[0],j)*q;vec4 s=vec4(r,1.0-i);float t=min(1.0,max(0.0,(n*(b+0.3)*0.5)));s.rgb+=t*worldlight[0];float u=clamp((fog[1][1]-a)/(fog[1][1]-fog[1][0]),0.0,1.0);s.rgb=mix(fog[0],s.rgb,u);fragColor=s;}`;var Kw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Water{vec3 verts[4];};in vec3 position;in vec3 color;in vec3 colorFoam;in vec3 colorShallow;out vec2 vUv;void main(){vWorldPos.xyz=verts[gl_VertexID];vWorldPos.w=1.0;vUv=vWorldPos.xz/2.0;gl_Position=projectionViewMatrix*vWorldPos;}`;var e4=`#version 300 es
precision highp float;precision highp int;in vec4 vWorldPos;out vec4 fragColor;void main(){fragColor.rgba=vec4(1.0,mod(vWorldPos.y+0.001,1.0),0.0,0.5);}`;var id={frag:ow,vert:iw},rd={frag:rw,vert:lw},ld={frag:aw,vert:cw},ad={frag:fw,vert:uw},cd={frag:mw,vert:pw},fd={frag:dw,vert:hw},iu={frag:gw,vert:vw},ud={frag:_w,vert:bw},dg={frag:yw},md={vert:kw},hg={frag:xw},gg={frag:ww},vg={frag:Mw},_g={frag:Fw},bg={frag:Cw},yg={frag:Sw},ru={frag:Pw,vert:Aw},kg={frag:Tw},lu={frag:Ew,vert:Iw},xg={frag:Dw},pd={frag:Vw,vert:Lw},xI={frag:qw,vert:Rw},wI={frag:zw,vert:Bw},wg={frag:$w},Mg={frag:Uw},Fg={frag:Ow},dd={frag:Nw,vert:jw},MI={frag:Ww},FI={frag:Gw,vert:Hw},CI={frag:Yw},SI={frag:Xw},hd={frag:Qw,vert:Zw},gd={frag:Jw,vert:Kw},PI={frag:e4};var ut=[],Cg=[],mn={},Qt={},au={},n4=()=>{mn={shadowMaps:{value:[Ka.depthTexture,Ja[1].depthTexture]}};for(let e in vd){let n=vd[e];n.vert&&(n.vert=n.vert.replace("#SHADOWS",fe.shadows?1:0)),n.frag&&(n.frag=n.frag.replace("#SHADOWS",fe.shadows?1:0))}let t={mesh:["position","uv","normal","color","interiorlight","alpha","worldMatrix"],effect:["position","uv","normal","color","uvshift","ycutoff","worldMatrix"],drop:["position","shine","uv","uvshift","worldMatrix"],particle:["position","info","progress","scaleRota","colStart","colEnd"],ribbon:["position","uv"],foliage:["position","uv","instPos","instNorm"],post:["position","uv"]};ut[13]=un({vertex:rd.vert,fragment:rd.frag,cullFace:null,instanced:[{name:"instPos",size:4},{name:"instNorm",size:3}],globalUniforms:mn,transparent:!0,attributeLocations:t.foliage}),ut[14]=un({vertex:ld.vert,fragment:ld.frag,cullFace:null,instanced:[{name:"instPos",size:4},{name:"instNorm",size:3}],globalUniforms:mn,transparent:!0,attributeLocations:t.foliage}),ut[3]=un({vertex:cd.vert,fragment:cd.frag,instanced:[{name:"color",size:4},{name:"alpha",size:1},{name:"interiorlight",size:4}],globalUniforms:mn,attributeLocations:t.mesh,transparent:!0}),ut[4]=un({vertex:iu.vert,fragment:iu.frag,instanced:[{name:"interiorlight",size:4}],globalUniforms:mn,attributeLocations:t.mesh}),ut[5]=un({vertex:ud.vert,fragment:ud.frag,globalUniforms:mn,attributeLocations:t.mesh}),ut[15]=un({vertex:ad.vert,fragment:ad.frag,globalUniforms:mn,transparent:!0,depthWrite:!1,instanced:[{name:"color",size:4},{name:"uvshift",size:4},{name:"ycutoff",size:2}],attributeLocations:t.effect}),ut[6]=un({vertex:iu.vert,fragment:dg.frag,globalUniforms:mn,instanced:[{name:"interiorlight",size:4}],attributeLocations:t.mesh}),ut[7]=un({vertex:fd.vert,fragment:fd.frag,instanced:[{name:"color",size:4}],globalUniforms:mn,attributeLocations:t.mesh}),ut[10]=un({vertex:id.vert,fragment:id.frag,instanced:[{name:"uvshift",size:4},{name:"shine",size:1}],globalUniforms:mn,attributeLocations:t.drop}),ut[8]=un({vertex:dd.vert,fragment:dd.frag,globalUniforms:mn,attributeLocations:t.mesh}),ut[9]=un({vertex:hd.vert,fragment:hd.frag,globalUniforms:mn,attributeLocations:t.mesh}),ut[12]=un({vertex:pd.vert,fragment:Fg.frag,transparent:!0,globalUniforms:mn,attributeLocations:t.mesh}),ut[20]=un({vertex:gd.vert,fragment:gd.frag,transparent:!0,cullFace:!1,globalUniforms:mn,attributeLocations:t.mesh}),ut[11]=un({vertex:pd.vert,fragment:wg.frag,cullFace:null,depthTest:!0,globalUniforms:mn,attributeLocations:t.mesh}),ut[1]=un({cullFace:null,vertex:lu.vert,fragment:xg.frag,globalUniforms:mn,attributeLocations:t.mesh}),ut[2]=un({vertex:lu.vert,fragment:lu.frag,globalUniforms:mn,attributeLocations:t.mesh}),ut[16]=un({vertex:md.vert,fragment:hg.frag,transparent:!0,depthWrite:!1,globalUniforms:mn,attributeLocations:t.particle}),ut[17]=un({vertex:md.vert,fragment:gg.frag,transparent:!1,globalUniforms:mn,attributeLocations:t.particle}),ut[18]=un({vertex:ru.vert,fragment:ru.frag,transparent:!0,cullFace:null,depthWrite:!1,globalUniforms:mn,attributeLocations:t.ribbon}),ut[19]=un({vertex:ru.vert,fragment:kg.frag,transparent:!0,cullFace:null,depthWrite:!1,globalUniforms:mn,attributeLocations:t.ribbon}),ut[32]=un({vertex:ya,fragment:bg.frag,depthWrite:!1,depthTest:!1,globalUniforms:mn,uniforms:{inputA:{value:null}},attributeLocations:t.post}),ut[30]=un({vertex:ya,fragment:vg.frag,depthWrite:!1,depthTest:!1,uniforms:{inputA:{value:null},offset:{value:[0,0,0,0,0,0,0,0]},amount:{value:[0,0,0,0]}},globalUniforms:mn,attributeLocations:t.post}),ut[31]=un({vertex:ya,fragment:_g.frag,depthWrite:!1,depthTest:!1,uniforms:{inputA:{value:null},inputB:{value:null},amount:{value:1}},globalUniforms:mn,attributeLocations:t.post}),ut[33]=un({vertex:ya,fragment:yg.frag,depthWrite:!1,depthTest:!1,globalUniforms:mn,uniforms:{inputA:{value:null},tint:{value:[0,0,0,0]},warp:{value:.5}},attributeLocations:t.post}),ut[34]=un({vertex:ya,fragment:Mg.frag,uniforms:{seed:{value:Date.now()%1e3}},attributeLocations:["position","uv"]}),AI(ut,mn),Lf(ut[18],W.ONE,W.ONE_MINUS_SRC_ALPHA),Lf(ut[16],W.ONE,W.ONE_MINUS_SRC_ALPHA),Lf(ut[15],W.ONE,W.ONE_MINUS_SRC_ALPHA),Cg.push(3,4,6,7,10,15,5)},AI=(t,e)=>{let n=t[4].program,s=["Environment","Camera","Pointlights","Shadows","Circle","Screen","Sky","MeshTerrain","Water"],o=[n,n,n,n,n,t[32].program,t[11].program,t[8].program,t[20].program],i=[!0,!0,!0,!0,!0,!0,!0,!1,!1],r=[];for(let l=0;l<s.length;++l){let a=s[l],c=Kx(o[l],a,l),f=a.toLowerCase();if(au[f]=c,r.push(c),i[l]){let u=Za(c);dl(u),Qt[f]=u}}for(let l=0;l<t.length;++l){let a=t[l];a&&(ny(a,e),sy(a,r))}},t4,_d=(t,e)=>{if(t!==t4||e){let n=Qt.camera.data;t4=t,Ei(n.cameraPosition,t.worldPosition,0),Ei(n.viewMatrix,t.viewMatrix,0),Ei(n.projectionMatrix,t.projectionMatrix,0),Ei(n.projectionViewMatrix,t.projectionViewMatrix,0),ls(Qt.camera)}},s4=(t,e)=>{vs(Qt.screen.data.resolution,t,e),ls(Qt.screen)};var Tt=(t,e)=>{let n=t>>16&255,s=t>>8&255,o=t&255,i=[n/255,s/255,o/255];return e!==void 0&&i.push(e),i};var Rn={black:Tt(0,0),white:Tt(16777215,0),deadgrey:Tt(3355443,0),teal:Tt(3384995,0),magicblue:Tt(3362252,0),paleskin:Tt(14267315,0),darkskin:Tt(8411481,0),slimegreen:Tt(2542694,0),mushgreen:Tt(2077529,0),linen:Tt(13408614,0),woodbrown:Tt(4859433,0),woodbrown2:Tt(10250315,0),tealsteel:Tt(3358797,.5),darksteel:Tt(3355443,.5),greysteel:Tt(5066061,.5),blacksteel:Tt(988178,.5),leather:Tt(4337198,0),emerald:Tt(22866,-.1),gold:Tt(16751616,.9),darkgold:Tt(16747008,.9),paper:Tt(15129011,0),richpurple:Tt(7484623,0),fireorange:Tt(14715686,-.7),archergreen:Tt(10471258,0),warbrown:Tt(15172191,0),bronze:Tt(9258571,.5),silver:Tt(11583679,.6),shamanblue:Tt(3687924,0),mageblue:Tt(6607340,0),bone:Tt(14535066,.2),bone2:Tt(11836267,.2),ice:Tt(14610164,-.2),vanguard:Tt(2848511,0),bloodlust:Tt(14289947,0),pink:Tt(16711935,0),warden:Tt(14755623,0),evilred:Tt(13239043,0),ruby:Tt(15733030,1),moss:Tt(2925637,.2),rock:Tt(5006687,.4),death:Tt(3750201,.8),diamond:Tt(3076559,.9)},Sg=[Rn.woodbrown,Rn.bronze,Rn.greysteel,Rn.silver,Rn.gold],o4=[Rn.diamond,Rn.ruby],Pg=[Rn.leather,Rn.greysteel,Rn.silver,Rn.gold,Rn.diamond];var mr=[0,0,0],bd={enemy:[1,0,0],friendly:[0,1,0],dead:[.6,.6,.6]},pr=t=>{if(I&&I.player){let e=Mt.clientPlayerChangeTarget.packData({target:t});if(t!==zn)if(t>0){let n=I.entity(t);n!==void 0&&(n.type===3?n.canBePickedUpBy(I.player)&&xt(95):(xt(93),n.faction===2&&an(2,100)))}else t===0&&xt(94);nc=zn,_l.reset(I.time),I.player.setTarget(t),Es(e)}zn=t},zn=0,_n=0,xd=!1,_l=new kt(0,1),nc=0,Ig=t=>{nc!==t&&(nc=t,_l.done(I.time)?(I.player.setTarget(t),zn=t):_l.reset(I.time,gt(_l.passed(I.time)+.5,.5,2)))},Tg=0,EI=()=>{nt.lmb.onPress(t=>{Tg=I.time}),nt.lmb.onRelease(t=>{dr>0?RI():_n>0&&Gf<20&&I.time-Tg<.3&&pr(_n)}),nt.nextTarget.onPress(t=>{tc=t.shiftKey?2:1}),nt.nextParty.onPress(t=>{tc=2}),nt.untarget.onPress(t=>{pr(0)})},cu=(t,e=!0)=>{_n=t,xd=e&&_n>0,gm.set(xd?"pointer":"auto"),ym.set(_n)},II=(t,e,n,s)=>{let o=[0,0,0];for(let i=0,r=s.length;i<r;++i){let l=s[i],[a,c,f]=l.hudPos;if(a>0&&a<e&&c>0&&c<n&&f<1){ot(o,l.pos),o[1]+=l.size*.3;let u=ss(o,Qp(ht.worldPosition,mr,o));u<t&&u<(l.size+.7)**2&&l.stats.alive&&(t=u,_n=l.id)}}return t},DI=(t,e,n,s)=>{let o=!1;for(let i=0,r=s.length;i<r;++i){let l=s[i];if(l.hudPos[2]<1){let a=ss(l.pos,Qp(ht.worldPosition,mr,l.pos));a<t&&(t=a,_n=l.id,o=!0)}}return o},VI=()=>{hi(ht,mr,Jp),Zt(mr,mr,ht.worldPosition),ts(mr,mr);let t=Vn.width,e=Vn.height,n=_n,s=20,o=!1;_n=0;for(let i=0;i<=12;++i)i!==3&&i!==11&&(s=II(s,t,e,I.entities.type[i]));o=_n!==0,DI(Math.min(s,.7),t,e,I.entities.type[3])&&(o=I.entity(_n).canBePickedUpBy(I.player)),(n!=_n||o!==xd)&&cu(_n,o)},i4=t=>{let e=[0,0,0];ga(An,ht.transform.worldMatrix),hi(ht,e,Jp),Zt(e,e,An),ts(e,e);let n=[0,0];Ty(n,An,e,I.player.pos,kd);let s=999;if(t)if(s=n[1]-Math.max(0,n[0]),s<5||n[0]===-1&&n[0]===-1){let i=Qp(An,e,I.player.pos),r=i[0]-I.player.pos[0],l=i[2]-I.player.pos[2],a=1/Math.sqrt(r*r+l*l);ot(An,I.player.pos),An[0]+=r*a*kd,An[1]+=10,An[2]+=l*a*kd,Y(e,0,-1,0),s=20}else n[0]>0&&sn(An,An,e,n[0]);gn(e,e,s);let o=I.raycastEnvironmentClosest(An[0],An[1],An[2],e[0],e[1],e[2]);return sn(An,An,e,o),o===1&&(An[1]=I.getHeight(An[0],An[2])),An},LI=t=>{if(_l.done(I.time)&&zn!==nc&&I.player.setTarget(nc),!nt.shift.down){if(Kp){_n>0&&(Gf>=20||I.time-Tg>.3)&&cu(0,!1);return}VI()}},oo,Eg=0,ec=0,Ag=[1,1,1,.3],qI=t=>{let e=zn,n=_n>0?I.getEntityById(_n):void 0;n!==void 0?n!==oo&&(oo!==void 0&&oo.visual!==void 0&&oo.type!==3&&oo.visual.removeColor(Ag),n.visual!==void 0&&n.type!==3&&n.visual.addColor(Ag),oo=n):oo!==void 0&&oo.visual!==void 0&&(oo.type!==3&&oo.visual.removeColor(Ag),oo=void 0);let s=Qt.circle.data;if(dr>0){let o=i4(!0);os(s.circleInfo,...bd.friendly,1),os(s.circlePos,o[0],o[1],o[2],r4)}else if(e!==Eg?(Eg=e,ec=1):ec=Math.max(ec*(1-t*10),0),e>0){let o=I.getEntityById(e);if(o!==void 0){os(s.circlePos,o.pos[0],o.pos[1]-o.radius,o.pos[2],o.size+ec);let i=o.stats&&o.stats.alive?I.player.hostility(o)>0?bd.enemy:bd.friendly:bd.dead;os(s.circleInfo,...i,1-ec)}}else os(s.circlePos,0,0,0,0);ls(Qt.circle)},yd=[],tc=0,Dg=t=>{if(I.player){if(tc===1){let e=0,n=0;t=t.filter(o=>o.visual!==void 0&&o.stats!==void 0&&o.stats.alive&&o!==I.player&&I.player.hostility(o)>0&&I.player.canCombatInteract(o)&&Math.abs(fl(I.player.rot,I.player.rotationToV3(o.pos)))<.7);let s=zn===0;for(let o=t.length-1;o>=0;--o){let i=t[o];s&&(e=i.id),zn===i.id&&(s=!0),n||(n=i.id),e!==0&&(o=0)}e===0&&n!==0&&(e=n),pr(e),tc=0}else if(tc===2){let e=I.entities.type[0].filter(o=>!fe.nextFriendlyTargetAllowNonParty&&!Xt.has(o.name)?!1:o.stats&&o.stats.alive&&o.faction===I.player.faction&&Rr(o.pos,I.player.pos)<30).sort((o,i)=>{let r=Xt.has(o.name),l=Xt.has(i.name);return r&&!l?-1:!r&&l?1:0}),n=e.length;if(e=e.filter(o=>yd.indexOf(o.id)<0),e.length===0)pr(I.playerId);else{let o=e[0];pr(o.id)}yd.push(zn);let s=Math.min(10,fe.nextFriendlyTargetCycle||10,n);for(;s>0&&yd.length>=s;)yd.shift();tc=0}}},dr=0,kd=0,r4=0,An=[0,0,0],fu=(t,e,n)=>{dr=t,kd=e,r4=n},RI=()=>{dr!==0&&(Es(Mt.clientPlayerEnvSkill.packData({id:dr,info:[],pos:An})),fu(0,0,0))},zI=()=>{nc=0,_l.reset(0),oo=void 0,Eg=0,ec=0};function l4(t,e,n){let s=t.slice();return s[26]=e[n],s}function a4(t){let e,n,s,o,i,r,l,a,c,f,u,m=[],g=new Map,v,_,b,k,y,F,A=t[2]=="default"&&c4(t);a=new ks({props:{size:"1.3em",fract:t[8],barcol:t[13],left:t[10],right:t[6],darken:!1,$$slots:{default:[BI]},$$scope:{ctx:t}}});let C=(t[2]=="default"||t[18])&&u4(t);function M(L,O){return L[5].role>=1?OI:UI}let V=M(t,-1),$=V(t),D=t[2]=="default"&&t[5].combat&&t[5].alive&&m4(t),z=me(t[19]),q=L=>L[26].id;for(let L=0;L<z.length;L+=1){let O=l4(t,z,L),j=q(O);g.set(j,m[L]=p4(j,O))}return{c(){e=h("div"),n=h("div"),A&&A.c(),s=h("img"),r=h("div"),l=h("div"),J(a.$$.fragment),C&&C.c(),$.c(),f=de(),D&&D.c(),u=h("div");for(let L=0;L<m.length;L+=1)m[L].c();p(s,"class",o="pclass icon border black bgc"+t[5].class+" svelte-g292qg"),at(s.src,i=(t[5].rarity!==!1?"/data/ui/mobpower/"+t[5].rarity:"/data/ui/classes/"+t[5].class)+"."+On+"?v=8685122")||p(s,"src",i),p(n,"class","iconcontainer svelte-g292qg"),p(l,"class",c="panel-black barsInner "+(t[5].id&&t[5].range?"targetable":"")+" svelte-g292qg"),p(u,"class",v="buffarray "+t[2]+" svelte-g292qg"),p(r,"class",_="bars "+(t[17]&&t[5].id==t[17].id&&t[2]=="party"?"target":"")+" svelte-g292qg"),p(e,"id",t[4]),p(e,"class",b="grid "+(t[3]?"right":"left")+" svelte-g292qg"),Le(e,"font-size",t[15]+"%"),Le(e,"opacity",t[5].range?"":.6)},m(L,O){w(L,e,O),d(e,n),A&&A.m(n,null),d(n,s),d(e,r),d(r,l),X(a,l,null),C&&C.m(l,null),$.m(r,null),d(r,f),D&&D.m(r,null),d(r,u);for(let j=0;j<m.length;j+=1)m[j]&&m[j].m(u,null);k=!0,y||(F=[H(l,"click",t[20]),H(l,"contextmenu",t[25])],y=!0)},p(L,O){L[2]=="default"?A||(A=c4(L),A.c(),A.m(n,s)):A&&(A.d(1),A=null),(!k||O&32&&o!==(o="pclass icon border black bgc"+L[5].class+" svelte-g292qg"))&&p(s,"class",o),(!k||O&32&&!at(s.src,i=(L[5].rarity!==!1?"/data/ui/mobpower/"+L[5].rarity:"/data/ui/classes/"+L[5].class)+"."+On+"?v=8685122"))&&p(s,"src",i);let j={};O&256&&(j.fract=L[8]),O&8192&&(j.barcol=L[13]),O&1024&&(j.left=L[10]),O&64&&(j.right=L[6]),O&536895748&&(j.$$scope={dirty:O,ctx:L}),a.$set(j),L[2]=="default"||L[18]?C?(C.p(L,O),O&262148&&S(C,1)):(C=u4(L),C.c(),S(C,1),C.m(l,null)):C&&(Me(),E(C,1,1,()=>{C=null}),Fe()),(!k||O&32&&c!==(c="panel-black barsInner "+(L[5].id&&L[5].range?"targetable":"")+" svelte-g292qg"))&&p(l,"class",c),V===(V=M(L,O))&&$?$.p(L,O):($.d(1),$=V(L),$&&($.c(),$.m(r,f))),L[2]=="default"&&L[5].combat&&L[5].alive?D||(D=m4(L),D.c(),D.m(r,u)):D&&(D.d(1),D=null),O&524292&&(z=me(L[19]),Me(),m=En(m,O,q,1,L,z,g,u,Hn,p4,null,l4),Fe()),(!k||O&4&&v!==(v="buffarray "+L[2]+" svelte-g292qg"))&&p(u,"class",v),(!k||O&131108&&_!==(_="bars "+(L[17]&&L[5].id==L[17].id&&L[2]=="party"?"target":"")+" svelte-g292qg"))&&p(r,"class",_),(!k||O&16)&&p(e,"id",L[4]),(!k||O&8&&b!==(b="grid "+(L[3]?"right":"left")+" svelte-g292qg"))&&p(e,"class",b),(!k||O&32768)&&Le(e,"font-size",L[15]+"%"),(!k||O&32)&&Le(e,"opacity",L[5].range?"":.6)},i(L){if(!k){S(a.$$.fragment,L),S(C);for(let O=0;O<z.length;O+=1)S(m[O]);k=!0}},o(L){E(a.$$.fragment,L),E(C);for(let O=0;O<m.length;O+=1)E(m[O]);k=!1},d(L){L&&x(e),A&&A.d(),Q(a),C&&C.d(),$.d(),D&&D.d();for(let O=0;O<m.length;O+=1)m[O].d();y=!1,rt(F)}}}function c4(t){let e;return{c(){e=h("div"),p(e,"class","deco svelte-g292qg")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function f4(t){let e,n,s;return{c(){e=h("div"),p(e,"class",n="progressBar "+t[13]+" hpdelta svelte-g292qg"),p(e,"style",s=(t[14]?"transition:none;":"")+"width:"+t[8]+"%;")},m(o,i){w(o,e,i)},p(o,i){i&8192&&n!==(n="progressBar "+o[13]+" hpdelta svelte-g292qg")&&p(e,"class",n),i&16640&&s!==(s=(o[14]?"transition:none;":"")+"width:"+o[8]+"%;")&&p(e,"style",s)},d(o){o&&x(e)}}}function BI(t){let e,n=t[2]=="default"&&f4(t);return{c(){n&&n.c(),e=de()},m(s,o){n&&n.m(s,o),w(s,e,o)},p(s,o){s[2]=="default"?n?n.p(s,o):(n=f4(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(s){s&&x(e),n&&n.d(s)}}}function u4(t){let e,n;return e=new ks({props:{size:"0.7em",fract:t[9],barcol:t[16],left:t[11],right:t[7],darken:!0,$$slots:{default:[$I]},$$scope:{ctx:t}}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&512&&(i.fract=s[9]),o&65536&&(i.barcol=s[16]),o&2048&&(i.left=s[11]),o&128&&(i.right=s[7]),o&536875008&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function $I(t){let e;return{c(){e=h("div"),p(e,"class","progressBar bgspell castbar svelte-g292qg"),Le(e,"width",t[12]+"%"),Le(e,"display",t[12]>0?"inherit":"none")},m(n,s){w(n,e,s)},p(n,s){s&4096&&Le(e,"width",n[12]+"%"),s&4096&&Le(e,"display",n[12]>0?"inherit":"none")},d(n){n&&x(e)}}}function UI(t){let e,n,s;return{c(){e=h("img"),p(e,"class",n="tag icon border black bgf"+t[5].faction+" round svelte-g292qg"),at(e.src,s="/data/ui/factions/"+t[5].faction+"."+On+"?v=8685122")||p(e,"src",s)},m(o,i){w(o,e,i)},p(o,i){i&32&&n!==(n="tag icon border black bgf"+o[5].faction+" round svelte-g292qg")&&p(e,"class",n),i&32&&!at(e.src,s="/data/ui/factions/"+o[5].faction+"."+On+"?v=8685122")&&p(e,"src",s)},d(o){o&&x(e)}}}function OI(t){let e,n;return{c(){e=h("img"),p(e,"class","tag icon border black bgblack round svelte-g292qg"),at(e.src,n="/data/ui/icons/"+(t[5].role==2?"star":"starsilver")+"."+On+"?v=8685122")||p(e,"src",n)},m(s,o){w(s,e,o)},p(s,o){o&32&&!at(e.src,n="/data/ui/icons/"+(s[5].role==2?"star":"starsilver")+"."+On+"?v=8685122")&&p(e,"src",n)},d(s){s&&x(e)}}}function m4(t){let e;return{c(){e=h("div"),p(e,"class","tag icon border black round combat svelte-g292qg")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function p4(t,e){let n,s,o,i=[e[26],{size:e[2]=="default"?31:23}],r={};for(let l=0;l<i.length;l+=1)r=Ql(r,i[l]);return s=new Zx({props:r}),{key:t,first:null,c(){n=de(),J(s.$$.fragment),this.first=n},m(l,a){w(l,n,a),X(s,l,a),o=!0},p(l,a){e=l;let c=a&524292?pm(i,[a&524288&&dm(e[26]),a&4&&{size:e[2]=="default"?31:23}]):{};s.$set(c)},i(l){o||(S(s.$$.fragment,l),o=!0)},o(l){E(s.$$.fragment,l),o=!1},d(l){l&&x(n),Q(s,l)}}}function NI(t){let e,n,s=t[5].visible&&a4(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[5].visible?s?(s.p(o,i),i&32&&S(s,1)):(s=a4(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function jI(t,e,n){let s,o,i,r,l=ae,a=()=>(l(),l=fo(v,Z=>n(5,r=Z)),v),c,f,u,m=ae,g=()=>(m(),m=fo(_,Z=>n(19,u=Z)),_);ie(t,Go,Z=>n(17,c=Z)),ie(t,Ma,Z=>n(18,f=Z)),t.$$.on_destroy.push(()=>l()),t.$$.on_destroy.push(()=>m());let{unit:v}=e;a();let{buffs:_}=e;g();let{mode:b="default"}=e,{order:k=0}=e,{id:y=""}=e,F,A,C,M,V,$,D,z,q,L,O=!1,j=0,R=Z=>{r.id&&pr(r.id)},U=Z=>_x(Z,r);return t.$$set=Z=>{"unit"in Z&&a(n(0,v=Z.unit)),"buffs"in Z&&g(n(1,_=Z.buffs)),"mode"in Z&&n(2,b=Z.mode),"order"in Z&&n(3,k=Z.order),"id"in Z&&n(4,y=Z.id)},t.$$.update=()=>{t.$$.dirty&32&&n(24,s=r.world==I.id?r.alive?!1:"Dead":r.world),t.$$.dirty&18874404&&(n(21,F=r.hpMax?b=="default"?rs(r.hp)+"/"+rs(r.hpMax):rs(r.hp):"?"),n(6,C=s||F),n(8,V=s!="offline"?~~(r.hpMax?r.hp/r.hpMax*100:100):0),n(13,L=s?"bggrey":(I.mode.partyBasedHostility?r.party===I.player.party:r.faction===I.player.faction)?"bghealth":"bgenemy")),t.$$.dirty&36&&n(22,A=r.mpMax?b=="default"?rs(r.mp)+"/"+rs(r.mpMax):rs(r.mp):"?"),t.$$.dirty&32&&n(10,D=r.name?wx(r.name,10):""),t.$$.dirty&32&&n(11,z=r.timedSkill?(P.ui.hiddenskills[r.timedSkill.id]||P.items.book[r.timedSkill.id]).name:`Lv. ${r.level}`),t.$$.dirty&20971552&&n(7,M=s||(r.timedSkill?r.timedCast.remaining(I.smoothtime).toFixed(1):A)),t.$$.dirty&16777248&&n(9,$=s!="offline"?~~(r.mpMax?r.mp/r.mpMax*100:100):0),t.$$.dirty&16777248&&n(12,q=s!="offline"&&r.timedSkill?r.timedCast.fraction(I.smoothtime)*100:0),t.$$.dirty&16777216&&n(16,o=s?"bggrey":"bgmana"),t.$$.dirty&4&&n(15,i=Math.round(b=="default"?100:85)),t.$$.dirty&8388640&&(n(14,O=j!=r.id),n(23,j=r.id))},[v,_,b,k,y,r,C,M,V,$,D,z,q,L,O,i,o,c,f,u,R,F,A,j,s,U]}var Lg=class extends Ce{constructor(e){super(),Pe(this,e,jI,NI,Be,{unit:0,buffs:1,mode:2,order:3,id:4})}},uu=Lg;function WI(t){let e,n,s,o;return n=new uu({props:{id:"ufplayer",order:0,unit:Wo,buffs:aa}}),s=new uu({props:{id:"uftarget",order:1,unit:Go,buffs:Nc}}),{c(){e=h("div"),J(n.$$.fragment),J(s.$$.fragment),p(e,"class","targetframes svelte-17up9g6")},m(i,r){w(i,e,r),X(n,e,null),X(s,e,null),o=!0},p:ae,i(i){o||(S(n.$$.fragment,i),S(s.$$.fragment,i),o=!0)},o(i){E(n.$$.fragment,i),E(s.$$.fragment,i),o=!1},d(i){i&&x(e),Q(n),Q(s)}}}var qg=class extends Ce{constructor(e){super(),Pe(this,e,null,WI,yn,{})}},d4=qg;function h4(t){let e,n;return{c(){e=h("span"),n=T(t[1]),p(e,"class","slottext key svelte-17ebtat")},m(s,o){w(s,e,o),d(e,n)},p(s,o){o[0]&2&&G(n,s[1])},d(s){s&&x(e)}}}function g4(t){let e,n;return{c(){e=h("span"),n=T(t[2]),p(e,"class","slottext stacks svelte-17ebtat")},m(s,o){w(s,e,o),d(e,n)},p(s,o){o[0]&4&&G(n,s[2])},d(s){s&&x(e)}}}function v4(t){let e,n=(t[4]>99?Math.round(t[4]/60)+"'":t[4]<=3?t[4].toFixed(1):Math.ceil(t[4]))+"",s;return{c(){e=h("div"),s=T(n),p(e,"class","time absCentered slottext svelte-17ebtat")},m(o,i){w(o,e,i),d(e,s)},p(o,i){i[0]&16&&n!==(n=(o[4]>99?Math.round(o[4]/60)+"'":o[4]<=3?o[4].toFixed(1):Math.ceil(o[4]))+"")&&G(s,n)},d(o){o&&x(e)}}}function _4(t){let e;return{c(){e=h("div"),p(e,"class","autocast svelte-17ebtat")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function b4(t){let e,n,s,o=t[31].default,i=Zl(o,t,t[30],null);return{c(){e=h("div"),i&&i.c(),p(e,"class",n="border "+t[5]+" slotdescription svelte-17ebtat"),p(e,"style",t[9])},m(r,l){w(r,e,l),i&&i.m(e,null),t[33](e),s=!0},p(r,l){i&&i.p&&(!s||l[0]&1073741824)&&Kl(i,o,r,r[30],s?Jl(o,r[30],l,null):ea(r[30]),null),(!s||l[0]&32&&n!==(n="border "+r[5]+" slotdescription svelte-17ebtat"))&&p(e,"class",n),(!s||l[0]&512)&&p(e,"style",r[9])},i(r){s||(S(i,r),s=!0)},o(r){E(i,r),s=!1},d(r){r&&x(e),i&&i.d(r),t[33](null)}}}function GI(t){let e,n,s,o,i,r,l,a,c,f,u,m,g=t[1]!==void 0&&h4(t),v=t[2]!==void 0&&g4(t),_=fe.cdTextSkills&&t[4]!==void 0&&v4(t),b=t[10]&&_4(t),k=t[8]&&t[11]&&!t[15]&&b4(t);return{c(){e=h("div"),g&&g.c(),n=de(),v&&v.c(),s=de(),_&&_.c(),o=h("div"),b&&b.c(),r=h("img"),k&&k.c(),p(o,"class",i="overlay "+t[16]+" "+(!t[14]||t[3]>0&&t[3]<10?"":"offCd")+" svelte-17ebtat"),p(r,"class",l="icon "+t[6]+" svelte-17ebtat"),at(r.src,a=t[17])||p(r,"src",a),p(e,"id",t[7]),p(e,"class",c="border "+t[5]+" "+(t[15]&&t[15].data==t[0]?"grey":"")+" slot "+(t[11]?"hover":"")+" "+(t[0]!==void 0||t[15]?"filled":"")+" svelte-17ebtat")},m(y,F){w(y,e,F),g&&g.m(e,null),d(e,n),v&&v.m(e,null),d(e,s),_&&_.m(e,null),d(e,o),t[32](o),b&&b.m(e,null),d(e,r),k&&k.m(e,null),f=!0,u||(m=[H(e,"pointerenter",t[20]),H(e,"pointerleave",t[21]),H(e,"pointerdown",t[18]),H(e,"pointerup",t[19])],u=!0)},p(y,F){y[1]!==void 0?g?g.p(y,F):(g=h4(y),g.c(),g.m(e,n)):g&&(g.d(1),g=null),y[2]!==void 0?v?v.p(y,F):(v=g4(y),v.c(),v.m(e,s)):v&&(v.d(1),v=null),fe.cdTextSkills&&y[4]!==void 0?_?_.p(y,F):(_=v4(y),_.c(),_.m(e,o)):_&&(_.d(1),_=null),(!f||F[0]&81928&&i!==(i="overlay "+y[16]+" "+(!y[14]||y[3]>0&&y[3]<10?"":"offCd")+" svelte-17ebtat"))&&p(o,"class",i),y[10]?b||(b=_4(y),b.c(),b.m(e,r)):b&&(b.d(1),b=null),(!f||F[0]&64&&l!==(l="icon "+y[6]+" svelte-17ebtat"))&&p(r,"class",l),(!f||F[0]&131072&&!at(r.src,a=y[17]))&&p(r,"src",a),y[8]&&y[11]&&!y[15]?k?(k.p(y,F),F[0]&35072&&S(k,1)):(k=b4(y),k.c(),S(k,1),k.m(e,null)):k&&(Me(),E(k,1,1,()=>{k=null}),Fe()),(!f||F[0]&128)&&p(e,"id",y[7]),(!f||F[0]&34849&&c!==(c="border "+y[5]+" "+(y[15]&&y[15].data==y[0]?"grey":"")+" slot "+(y[11]?"hover":"")+" "+(y[0]!==void 0||y[15]?"filled":"")+" svelte-17ebtat"))&&p(e,"class",c)},i(y){f||(S(k),f=!0)},o(y){E(k),f=!1},d(y){y&&x(e),g&&g.d(),v&&v.d(),_&&_.d(),t[32](null),b&&b.d(),k&&k.d(),u=!1,rt(m)}}}function HI(t,e,n){let s,o,i,r;ie(t,In,oe=>n(15,r=oe));let{$$slots:l={},$$scope:a}=e,{data:c=void 0}=e,{key:f}=e,{stacks:u}=e,{cd:m}=e,{remaining:g}=e,{border:v="grey"}=e,{img:_}=e,{meta:b}=e,{css:k=""}=e,{id:y=""}=e,{describe:F=!0}=e,{queued:A=!1}=e,{pickable:C=!0}=e,{descRoot:M}=e,{descPos:V="bottom: 100%; right: 100%;"}=e,{auto:$=!1}=e,{status:D=0}=e,{clickToUse:z=!1}=e,{shift:q=!1}=e,L=!1,O=!1,j=(oe,Ee)=>oe?"queued":Ee==5?"oom":Ee==6?"range":Ee==11||Ee==9?"combat":"",R,U=oe=>{oe.altKey||(z&&!q?le("use",{e:oe,...b}):(O=!0,n(11,L=!1),le("click",b)))},Z=oe=>{oe.button==2?q?le("use",{e:oe,...b}):le("context",{e:oe,...b}):r?(r.data.type&&xt($s[r.data.type].sound),le("move",{from:r.meta,to:b}),r.meta&&r.meta.store&&r.meta.store.set(),Xe(In,r=void 0,r)):z?q&&re():oe.altKey?b.item&&b.item.dbid&&qs.update(Ee=>Ee+`>${b.item.dbid}`):re(),O=!1},ye=oe=>{n(11,L=!0)},we=()=>{le("discard")},he=oe=>{n(11,L=!1),c&&O&&(O=!1,re())},re=()=>{!c||C===!1||(c.moving||Xe(In,r={data:c,img:_,meta:b,border:v,css:k,discard:we},r),c.type&&xt($s[c.type].sound))},le=ci(),ve;function _e(oe){qt[oe?"unshift":"push"](()=>{ve=oe,n(13,ve)})}function Ie(oe){qt[oe?"unshift":"push"](()=>{R=oe,n(12,R)})}return t.$$set=oe=>{"data"in oe&&n(0,c=oe.data),"key"in oe&&n(1,f=oe.key),"stacks"in oe&&n(2,u=oe.stacks),"cd"in oe&&n(3,m=oe.cd),"remaining"in oe&&n(4,g=oe.remaining),"border"in oe&&n(5,v=oe.border),"img"in oe&&n(22,_=oe.img),"meta"in oe&&n(23,b=oe.meta),"css"in oe&&n(6,k=oe.css),"id"in oe&&n(7,y=oe.id),"describe"in oe&&n(8,F=oe.describe),"queued"in oe&&n(24,A=oe.queued),"pickable"in oe&&n(25,C=oe.pickable),"descRoot"in oe&&n(26,M=oe.descRoot),"descPos"in oe&&n(9,V=oe.descPos),"auto"in oe&&n(10,$=oe.auto),"status"in oe&&n(27,D=oe.status),"clickToUse"in oe&&n(28,z=oe.clickToUse),"shift"in oe&&n(29,q=oe.shift),"$$scope"in oe&&n(30,a=oe.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&16392&&n(14,s=s||m>0),t.$$.dirty[0]&138446856&&n(17,o=_?r&&L||m>0||D==-1?_.replace(/(?<!githubusercontent)\.(?!githubusercontent)/,"_grey.").replace(/_q[0-9]/g,""):_:`/data/ui/slotbg/bg.${Yn}?v=8685122`),t.$$.dirty[0]&150995968&&n(16,i=j($||A,D)),t.$$.dirty[0]&67112960&&R&&M&&M.appendChild(R),t.$$.dirty[0]&8200&&ou(Math.floor(m||0),ve,40)},[c,f,u,m,g,v,k,y,F,V,$,L,R,ve,s,r,i,o,U,Z,ye,he,_,b,A,C,M,D,z,q,a,l,_e,Ie]}var Rg=class extends Ce{constructor(e){super(),Pe(this,e,HI,GI,yn,{data:0,key:1,stacks:2,cd:3,remaining:4,border:5,img:22,meta:23,css:6,id:7,describe:8,queued:24,pickable:25,descRoot:26,descPos:9,auto:10,status:27,clickToUse:28,shift:29},null,[-1,-1])}},bl=Rg;var y4=(t,e)=>typeof t=="function"?t(e):t;var mu=Object.keys({onBlock:0,statsStatic:0,statsConvert:0,statsOverride:0,onInterval:0,multiplyIncomingHeal:0,multiplyIncomingDamage:0,addIncomingHeal:0,addIncomingDamage:0,addIncomingCrit:0,afterDamageEnemy:0,afterHealAlly:0,beforeDamageEnemy:0,beforeIncomingDamage:0,afterIncomingDamage:0,movementOverride:0,incapacitated:0,breakOnMove:0,breakOnCast:0,instantCast:0,onCast:0,onEnd:0,immuneAll:0,immuneCC:0,breakAfterPercentDamage:0}),ge=class{constructor(e){this.id=e.id,this.intervalHaste=e.intervalHaste!==!1,this.intervalDuration=e.intervalDuration,this.intervalOnApply=e.intervalOnApply||!1,this.maxStacks=e.maxStacks,this.passive=e.passive||!1,this.clearOnDeath=e.clearOnDeath!==!1,this.custom=e.custom,this.unique=e.unique||!1,this.dr=e.dr||0,this.type=e.type||0,this.tags=e.tags||new Set,this.immuneAll=e.immuneAll||!1,this.immuneCC=e.immuneCC||!1,mu.forEach(n=>{this[n]=e[n]}),this.customIcon=e.customIcon,this.icon=e.icon,this.fx=e.fx||{}}onSet(e,n,s){this.tags.forEach(o=>{s.tags.get(o).add(e)}),mu.forEach(o=>{this[o]&&(o!=="incapacitated"&&o!=="movementOverride"||s.immuneCC.size<=0)&&s[o].add(e)})}onRemove(e,n,s){this.tags.forEach(o=>{s.tags.get(o).delete(e)}),mu.forEach(o=>{this[o]&&s[o].delete(e)})}};var k4=new ge({id:77,passive:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(t.level*40)),e.addStat(28,Math.round(t.level*200))}});var x4=new ge({id:59,tags:new Set([11]),icon:"ui/skills/2",fx:{stick:15},statsStatic:(t,e)=>{e.addStat(13,300+t.level*40)}});var wd=(t,e)=>t*e/65535;var w4=(t,e)=>{let n=e/65535;return[(t>>>16)*n,(t&65535)*n]};var xs=t=>t/60;var sc=(t,e)=>{if(t.static||!e.data)return!1;let n=w4(e.data[0]*2,6400),s=[n[0]-t.pos[0],n[1]-t.pos[2]];return Ea(s)>t.size?(t.setSteer(0,1),t.setRot(cl(s)),t.setJump(0),!0):(t.setSteer(0,0),!1)};var M4=new ge({id:87,incapacitated:!0,icon:"ui/skills/33",fx:{stick:74,endSound:65},statsOverride:(t,e)=>{e.stat.set(15,250)},movementOverride:(t,e,n,s,o)=>{sc(s,o)||s.buffs.removeBuff(o.id,s.id)}});var F4=new ge({id:76,icon:"ui/skills/20",fx:{stick:53},unique:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(t.level*30)),e.addStat(9,Math.round(t.level*22))}});var C4=new ge({id:73,passive:!0,icon:"ui/skills/17",custom:[[t=>93+t*32,"% as additional damage over 10 seconds"]],afterDamageEnemy:{3:(t,e,n)=>{}}});var S4=new ge({id:74,type:1,tags:new Set([1]),maxStacks:3,icon:"ui/skills/18",fx:{stick:38,color:[.7,.1,.1,.5]},intervalDuration:1.5,onInterval:(t,e,n)=>({id:18,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,noDaze:!0,type:1})});var P4=new ge({id:72,icon:"ui/skills/17",fx:{stick:18,color:[.9,.3,.1,.7]},custom:[[t=>t*12,"% increased damage"]]});var A4=new ge({id:121,incapacitated:!0,type:1,tags:new Set([7]),dr:3,breakAfterPercentDamage:.1,icon:"ui/skills/50",fx:{stick:86,incapacitated:!0},statsOverride:(t,e)=>{e.stat.get(15)>100&&e.stat.set(15,100)},movementOverride:(t,e,n,s,o)=>{sc(s,o)},intervalDuration:1});var T4=new ge({id:61,passive:!0,icon:"ui/skills/8",statsConvert:[[0,.3,10],[0,.3,11],[0,.3,8]]});var E4=new ge({id:89,type:1,tags:new Set([3]),icon:"ui/skills/34",statsStatic:(t,e)=>{e.maxStat(29,10+t.level*10)}});var I4=new ge({id:105,maxStacks:3,icon:"ui/skills/temperBoostBuff",fx:{stick:24,color:[.2,.2,.25,.95]},statsStatic:(t,e)=>{e.addStat(15,20)}});var D4=new ge({id:104,maxStacks:3,tags:new Set([3,4]),icon:"ui/skills/41",fx:{stick:23,color:[.1,.1,.1,.92]},intervalDuration:.5,onInterval:(t,e,n)=>!0});var V4=new ge({id:75,icon:"ui/skills/19",fx:{stick:54},unique:!0,statsStatic:(t,e)=>{e.addStat(10,t.level*3),e.addStat(11,t.level*4),e.addStat(6,t.level*50)}});var L4=new ge({id:115,incapacitated:!0,tags:new Set([8]),immuneCC:!0,icon:"ui/skills/46",fx:{anim:34},statsStatic:(t,e)=>{e.maxStat(29,40)},statsOverride:(t,e)=>{e.stat.set(13,0)},intervalDuration:.5,onInterval:(t,e,n)=>!0});var q4=new ge({id:91,type:1,tags:new Set([6]),incapacitated:!0,dr:3,icon:"ui/skills/37",fx:{visual:20,stick:88,endSound:69},statsStatic:(t,e)=>{e.maxStat(29,30+t.level*7),e.maxStat(30,20+t.level*5)}});var R4=new ge({id:84,icon:"ui/skills/28",fx:{stick:65},unique:!0,statsStatic:(t,e)=>{e.addStat(16,100+t.level*60)}});var z4=new ge({id:67,type:1,tags:new Set([3,1]),icon:"ui/skills/12",fx:{apply:50,stick:49,color:[.5,.4,.05,.5]},statsStatic:(t,e)=>{e.maxStat(29,20+t.level*3)},intervalDuration:1.5,onInterval:(t,e,n)=>({id:12,mode:1,caster:t.caster,target:e.id,dmg:1+n.stats.getDamageRoll()*(.1+t.level*.08),type:1,noDaze:!0})});var B4=new ge({id:68,icon:"ui/skills/13",fx:{stick:52},intervalDuration:1,custom:[[t=>30+40*t,"MP recovered"]],onInterval:(t,e,n)=>{}});var $4=new ge({id:107,maxStacks:5,icon:"ui/skills/43",fx:{stick:20}});var U4=new ge({id:106,passive:!0});var O4=new ge({id:60,maxStacks:3,icon:"ui/skills/7",fx:{stick:37},intervalDuration:1,multiplyIncomingHeal:{6:t=>1+t.stacks*.3,7:t=>1+(t.stacks-1)*.3},onInterval:(t,e,n)=>({id:7,mode:2,caster:t.caster,target:e.id,heal:6+n.stats.getDamageRoll()*(.028+t.level*.024)})});var N4=new ge({id:64,passive:!0,icon:"ui/skills/8",statsConvert:[[4,.4,10],[4,.4,11]]});var j4=new ge({id:90,breakOnCast:!0,icon:"ui/skills/36",fx:{visual:26,apply:76,endSound:69},statsStatic:(t,e)=>{e.addStat(15,8+t.level*12)}});var W4=new ge({id:119,incapacitated:!0,type:1,tags:new Set([7]),dr:3,breakAfterPercentDamage:.1,icon:"ui/skills/49",fx:{incapacitated:!0,apply:122,stick:124},statsOverride:(t,e)=>{e.stat.get(15)>50&&e.stat.set(15,50)},movementOverride:(t,e,n,s,o)=>{sc(s,o)}});var G4=new ge({id:120,passive:!0});var H4=new ge({id:82,passive:!0,statsStatic:(t,e)=>{e.addStat(14,Math.round(t.level*30))}});var Y4=new ge({id:66,icon:"ui/skills/11",fx:{stick:39,endSound:69},custom:[[t=>t*9,"% increased damage"]]});var X4=new ge({id:83,icon:"ui/skills/27",fx:{stick:63},unique:!0,statsStatic:(t,e)=>{e.addStat(15,5+t.level*13)}});var Q4=new ge({id:85,passive:!0,icon:"ui/skills/29",custom:[[t=>40+t*21,"% per stack as additional damage over 10 seconds"]],afterDamageEnemy:{9:(t,e,n)=>{}}});var Z4=new ge({id:86,type:1,maxStacks:3,tags:new Set([3,1]),icon:"ui/skills/29",fx:{apply:51,stick:66,color:[.1,1,.3,.3]},statsStatic:(t,e)=>{e.maxStat(29,30)},intervalDuration:1.5,onInterval:(t,e,n)=>({id:29,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,type:1,noDaze:!0})});var J4=new ge({id:95,maxStacks:4,icon:"ui/skills/31",instantCast:new Set([31]),beforeDamageEnemy:{31:(t,e,n,s)=>{}}});var K4=new ge({id:65,passive:!0,icon:"ui/skills/10",custom:[[t=>2+t*1," Jumps"],[t=>15+t*12.5,"% damage per Jump"]],afterDamageEnemy:{9:(t,e,n)=>{}}});var e5=new ge({id:92,icon:"ui/skills/38",fx:{stick:77},statsStatic:(t,e)=>{e.addStat(15,30)},instantCast:new Set([9]),onCast:{9:(t,e)=>{}}});var t5=new ge({id:96,passive:!1,incapacitated:!0,icon:"ui/skills/38",statsOverride:(t,e)=>{e.stat.set(15,400)},movementOverride:(t,e,n,s,o)=>{s.setSteer(o.data[0]-1,o.data[1]-1)}});var n5=new ge({id:63,passive:!0,icon:"ui/skills/8",statsConvert:[[2,.4,10],[2,.4,11]]});var s5=new ge({id:81,icon:"ui/skills/25",fx:{stick:64},unique:!0,statsStatic:(t,e)=>{e.addStat(16,t.level*30)}});var o5=new ge({id:118,passive:!0});var i5=new ge({id:114,incapacitated:!0,tags:new Set([8]),icon:"ui/skills/45",fx:{anim:33},intervalHaste:!1,intervalDuration:.25,statsStatic:(t,e)=>{e.maxStat(29,15)},onInterval:(t,e,n)=>!0});var r5=new ge({id:78,icon:"ui/skills/22",fx:{stick:60},unique:!0,statsStatic:(t,e)=>{e.addStat(14,t.level*30)}});var l5=new ge({id:101,type:1,tags:new Set([5]),incapacitated:!0,dr:1,icon:"ui/skills/deepFrozen",fx:{stick:57,color:[.1,.9,.8,.9],frozen:!0},statsStatic:(t,e)=>{e.maxStat(29,100)},multiplyIncomingDamage:{4:t=>1+t.level*.1,15:t=>1+t.level*.1,51:t=>1+t.level*.1}});var a5=new ge({id:80,icon:"ui/skills/24",fx:{stick:91},unique:!0,statsStatic:(t,e)=>{e.addStat(10,Math.floor(2+t.level*1.5)),e.addStat(11,Math.floor(3+t.level*3.5))}});var c5=new ge({id:108,icon:"ui/skills/extraBolt",fx:{stick:22}});var f5=new ge({id:116,incapacitated:!0,tags:new Set([8,10]),breakOnMove:!0,icon:"ui/skills/52",fx:{anim:35},intervalDuration:1,intervalOnApply:1,onInterval:(t,e,n)=>!0});var u5=new ge({id:69,type:1,tags:new Set([4]),dr:2,icon:"ui/skills/14",fx:{stick:56,color:[.7,.7,1,.4]},statsStatic:(t,e)=>{e.maxStat(29,100)},addIncomingCrit:{4:t=>10+t.level*30,15:t=>20+t.level*30},intervalDuration:1.5,onInterval:(t,e,n)=>({id:14,mode:1,caster:t.caster,target:e.id,dmg:n.stats.getDamageRoll()*(.09+t.level*.27),type:1,noDaze:!0})});var m5=new ge({id:99,type:1,tags:new Set([3]),maxStacks:4,icon:"ui/skills/frozenBuff",fx:{stick:58,color:[.1,.1,.8,.5]},statsStatic:(t,e)=>{e.maxStat(29,20)}});var p5=new ge({id:71,icon:"ui/skills/16",fx:{stick:40,endSound:69},statsStatic:(t,e)=>{e.addStat(16,30+t.level*70),e.addStat(27,2+t.level*8)}});var d5=new ge({id:117,incapacitated:!0,tags:new Set([9,11,12]),immuneAll:!0,intervalDuration:1,intervalHaste:!1,icon:"ui/skills/53",fx:{stick:120,frozen:!0},statsStatic:(t,e)=>{e.maxStat(29,100)},onInterval:(t,e,n)=>({id:53,mode:2,caster:t.caster,target:n.id,heal:t.level*50,nocrit:!0})});var h5=new ge({id:100,passive:!0});var g5=new ge({id:79,icon:"ui/skills/23",fx:{stick:17}});var v5=new ge({id:70,passive:!0});var _5=new ge({id:62,passive:!0,icon:"ui/skills/8",statsConvert:[[3,.4,10],[3,.4,11]]});var b5=new ge({id:112,type:0,icon:"ui/skills/charm4",fx:{stick:42,color:[0,0,1,.7]}});var y5=new ge({id:113,type:1,tags:new Set([1]),maxStacks:10,icon:"ui/skills/firebuff",fx:{stick:67,color:[2,1,.3,1]}});var k5=new ge({id:126,type:1,tags:new Set([1]),maxStacks:5,icon:"ui/skills/firebuff",fx:{stick:132,apply:135,color:[.7,.1,1.5,1]}});var x5=new ge({id:94,type:1,tags:new Set([3]),icon:"ui/skills/dazedBuff",fx:{stick:73},statsStatic:(t,e)=>{e.maxStat(29,30)}});var w5=new ge({id:110,type:0,icon:"ui/skills/charm2",fx:{stick:21,color:[1,0,0,.8]},statsStatic:(t,e)=>{e.addStat(27,t.level)}});var M5=new ge({id:124,passive:!1,icon:"ui/skills/hellspawn"});var F5=new ge({id:109,type:0,icon:"ui/skills/charm1",fx:{stick:61,color:[.3,.3,.3,.9]},statsStatic:(t,e)=>{e.addStat(31,50)},beforeIncomingDamage:(t,e,n,s)=>n*(t.level/100)});var C5=new ge({id:123,passive:!0});var S5=new ge({id:93,breakOnCast:!0,tags:new Set([12]),icon:"ui/skills/39",customIcon:t=>"items/mount/mount"+ar[t.data[0]].tier+"_q1",fx:{mount:t=>ar[t.data[0]].skin,apply:76,endSound:69},statsStatic:(t,e)=>{e.addStat(15,60)}});var P5=new ge({id:130,clearOnDeath:!1,tags:new Set([12]),icon:"ui/skills/39",customIcon:t=>"items/pet/pet"+ar[t.data[0]].tier+"_q1"});var A5=new ge({id:111,type:0,icon:"ui/skills/charm3",fx:{stick:62,color:[.3,0,.6,.8]},statsStatic:(t,e)=>{e.addStat(15,t.level)}});var T5=new ge({id:127,type:0,maxStacks:8,clearOnDeath:!1,icon:"ui/skills/obeliskbuff"});var E5=new ge({id:125,maxStacks:25,type:1,icon:"ui/skills/pierce",multiplyIncomingDamage:{0:t=>1+t.stacks*.2,60:t=>1+t.stacks*.2}});var I5=new ge({id:103,icon:"ui/skills/postsummon",fx:{stick:80},unique:!0,statsStatic:(t,e)=>{e.addStat(15,20)}});var zg=["potionhp","potionMp"].map((t,e)=>new ge({id:[97,98][e],maxStacks:1,icon:"ui/skills/"+t,fx:{stick:[43,83][e]},intervalHaste:!1,intervalDuration:.5,onInterval:(n,s,o)=>({id:100,mode:[2,3][e],caster:n.caster,target:s.id,heal:e==1?void 0:n.level,mprec:e==0?void 0:n.level,nocrit:!0})}));var D5=new ge({id:88,type:1,tags:new Set([5]),dr:1,incapacitated:!0,icon:"ui/skills/stunBuff",fx:{stick:86,incapacitated:!0},movementOverride:(t,e,n,s,o)=>{s.setSteer(0,0),s.setJump(0)}});var V5=new ge({id:102,maxStacks:99,icon:"ui/skills/suddenDeath",statsStatic:(t,e)=>{e.maxStat(30,t.stacks)}});var L5=new ge({id:122,passive:!1,immuneCC:!0,icon:"ui/skills/21",statsStatic:(t,e)=>{e.addStat(6,t.stacks*5e5),t.level>1&&(e.addStat(17,30),e.addStat(16,1e3),e.addStat(15,200),e.addStat(10,500),e.addStat(11,500))},onCast:{0:(t,e,n,s,o)=>{}}});var q5=new ge({id:131,passive:!0});var R5=new ge({id:132,passive:!0});var z5=new ge({id:128,type:0,tags:new Set([12]),icon:"ui/skills/ghost",fx:{color:[.9,1.2,.8,.8],alpha:[.3]}});var B5=new ge({id:129,type:0,icon:"ui/skills/moderator",fx:{color:[.3,1.2,.9,.7],alpha:[.3]}});var yl=new Map;[z5,B5,T5,k5,E5,q5,C5,M5,L5,y5,b5,A5,w5,F5,I5,V5,zg[0],zg[1],D5,S5,P5,x5,A4,L4,I4,D4,E4,M4,V4,F4,k4,S4,C4,P4,x4,T4,$4,U4,q4,j4,R4,B4,O4,N4,z4,d5,f5,c5,l5,h5,m5,a5,r5,g5,v5,u5,_5,p5,G4,R5,W4,o5,i5,t5,J4,e5,Q4,Z4,s5,X4,H4,n5,K4,Y4].forEach(t=>{yl.set(t.id,t)});var oc=class{constructor(e){this.entity=e,this.alive=!0,this.stat=new Map,this.resource=new Map,this.combatTimer=new kt(-1,6)}tick(e,n){this.combatTimer.start>0&&this.combatTimer.done(n)&&this.onCombatEnd(n)}die(){return this.alive?(this.alive=!1,this.entity.skills.onDeath(),this.entity.buffs.onDeath(),!0):!1}getStat(e){return this.stat.get(e)|0}getResource(e){return this.resource.get(e)|0}addStat(e,n){this.stat.set(e,(this.stat.get(e)|0)+n)}maxStat(e,n){this.stat.set(e,Math.max(this.stat.get(e)|0,n))}multiplyStat(e,n){this.stat.set(e,(this.stat.get(e)|0)*n)}setResource(e,n){let s=Math.round(gt(n,0,this.getStat(e)));return this.resource.set(e,s),s}changeResource(e,n){return this.setResource(e,this.getResource(e)+n)}respawn(){this.alive=!0,this.onCombatEnd()}clear(){}refreshCombatTimer(e,n){this.combatTimer.end<e+n&&this.combatTimer.reset(e,n)}onCombatEnd(){this.combatTimer.reset(-1)}getDamageRoll(){return Math.round((this.getStat(10)+this.getStat(11))/2)}};function $5(t,e,n){let s=t.slice();return s[12]=e[n],s}function U5(t,e,n){let s=t.slice();return s[15]=e[n],s}function O5(t,e,n){let s=t.slice();return s[18]=e[n],s}function N5(t,e,n){let s=t.slice();return s[18]=e[n],s}function j5(t,e,n){let s=t.slice();return s[23]=e[n],s}function W5(t,e,n){let s=t.slice();return s[26]=e[n],s}function G5(t,e,n){let s=t.slice();return s[23]=e[n],s}function H5(t,e,n){let s=t.slice();return s[26]=e[n],s}function Y5(t,e,n){let s=t.slice();return s[33]=e[n],s}function X5(t,e,n){let s=t.slice();return s[26]=e[n],s}function YI(t){let e,n,s,o,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A,C,M,V,$=!t[2]&&t[0].parent===void 0&&Q5(t),D=t[0].actiontype&&Z5(t),z=t[0].auto&&J5(t),q=t[0].costMp&&K5(t),L=t[0].castLen&&eM(t),O=t[0].cd&&tM(t),j=t[0].duration>0&&nM(t),R=t[0].unique&&sM(t),U=t[0].refresh&&oM(t),Z=t[0].range&&iM(t),ye=t[6][t[0].targetMode]&&rM(t),we=t[0].maxStacks&&lM(t),he=t[0].dmg&&aM(t),re=t[0].heal&&cM(t),le=me([t[0].multiplyIncomingHeal,t[0].multiplyIncomingDamage]),ve=[];for(let se=0;se<2;se+=1)ve[se]=uM(Y5(t,le,se));let _e=me([t[0].addIncomingHeal,t[0].addIncomingDamage]),Ie=[];for(let se=0;se<2;se+=1)Ie[se]=pM(G5(t,_e,se));let oe=me([t[0].addIncomingCrit]),Ee=[];for(let se=0;se<1;se+=1)Ee[se]=hM(j5(t,oe,se));let K=t[0].statsStatic&&gM(t),Re=t[0].statsConvert&&_M(t),Ge=t[0].custom&&yM(t),Qe=t[0].aoe&&t[0].aoe.circleRadius&&xM(t),Ye=!t[0].parent&&wM(t),pe=me(t[5]),ce=[];for(let se=0;se<pe.length;se+=1)ce[se]=MM($5(t,pe,se));let Oe=se=>E(ce[se],1,1,()=>{ce[se]=null});return{c(){$&&$.c(),e=h("div"),D&&D.c(),n=de(),z&&z.c(),s=de(),q&&q.c(),o=de(),L&&L.c(),i=de(),O&&O.c(),r=de(),j&&j.c(),l=de(),R&&R.c(),a=de(),U&&U.c(),c=h("div"),Z&&Z.c(),f=de(),ye&&ye.c(),we&&we.c(),u=de(),he&&he.c(),m=de(),re&&re.c(),g=de();for(let se=0;se<2;se+=1)ve[se].c();v=de();for(let se=0;se<2;se+=1)Ie[se].c();_=de();for(let se=0;se<1;se+=1)Ee[se].c();b=de(),K&&K.c(),k=de(),Re&&Re.c(),y=de(),Ge&&Ge.c(),F=de(),Qe&&Qe.c(),A=de(),Ye&&Ye.c(),C=de();for(let se=0;se<ce.length;se+=1)ce[se].c();M=de(),p(e,"class","pad textgreen svelte-14w0l4b")},m(se,ee){$&&$.m(se,ee),w(se,e,ee),D&&D.m(e,null),d(e,n),z&&z.m(e,null),d(e,s),q&&q.m(e,null),d(e,o),L&&L.m(e,null),d(e,i),O&&O.m(e,null),d(e,r),j&&j.m(e,null),d(e,l),R&&R.m(e,null),d(e,a),U&&U.m(e,null),d(e,c),Z&&Z.m(c,null),d(c,f),ye&&ye.m(c,null),we&&we.m(se,ee),w(se,u,ee),he&&he.m(se,ee),w(se,m,ee),re&&re.m(se,ee),w(se,g,ee);for(let N=0;N<2;N+=1)ve[N]&&ve[N].m(se,ee);w(se,v,ee);for(let N=0;N<2;N+=1)Ie[N]&&Ie[N].m(se,ee);w(se,_,ee);for(let N=0;N<1;N+=1)Ee[N]&&Ee[N].m(se,ee);w(se,b,ee),K&&K.m(se,ee),w(se,k,ee),Re&&Re.m(se,ee),w(se,y,ee),Ge&&Ge.m(se,ee),w(se,F,ee),Qe&&Qe.m(se,ee),w(se,A,ee),Ye&&Ye.m(se,ee),w(se,C,ee);for(let N=0;N<ce.length;N+=1)ce[N]&&ce[N].m(se,ee);w(se,M,ee),V=!0},p(se,ee){if(!se[2]&&se[0].parent===void 0?$?$.p(se,ee):($=Q5(se),$.c(),$.m(e.parentNode,e)):$&&($.d(1),$=null),se[0].actiontype?D?D.p(se,ee):(D=Z5(se),D.c(),D.m(e,n)):D&&(D.d(1),D=null),se[0].auto?z||(z=J5(se),z.c(),z.m(e,s)):z&&(z.d(1),z=null),se[0].costMp?q?q.p(se,ee):(q=K5(se),q.c(),q.m(e,o)):q&&(q.d(1),q=null),se[0].castLen?L?L.p(se,ee):(L=eM(se),L.c(),L.m(e,i)):L&&(L.d(1),L=null),se[0].cd?O?O.p(se,ee):(O=tM(se),O.c(),O.m(e,r)):O&&(O.d(1),O=null),se[0].duration>0?j?j.p(se,ee):(j=nM(se),j.c(),j.m(e,l)):j&&(j.d(1),j=null),se[0].unique?R||(R=sM(se),R.c(),R.m(e,a)):R&&(R.d(1),R=null),se[0].refresh?U||(U=oM(se),U.c(),U.m(e,c)):U&&(U.d(1),U=null),se[0].range?Z?Z.p(se,ee):(Z=iM(se),Z.c(),Z.m(c,f)):Z&&(Z.d(1),Z=null),se[6][se[0].targetMode]?ye?ye.p(se,ee):(ye=rM(se),ye.c(),ye.m(c,null)):ye&&(ye.d(1),ye=null),se[0].maxStacks?we?we.p(se,ee):(we=lM(se),we.c(),we.m(u.parentNode,u)):we&&(we.d(1),we=null),se[0].dmg?he?he.p(se,ee):(he=aM(se),he.c(),he.m(m.parentNode,m)):he&&(he.d(1),he=null),se[0].heal?re?re.p(se,ee):(re=cM(se),re.c(),re.m(g.parentNode,g)):re&&(re.d(1),re=null),ee[0]&129){le=me([se[0].multiplyIncomingHeal,se[0].multiplyIncomingDamage]);let N;for(N=0;N<2;N+=1){let ue=Y5(se,le,N);ve[N]?ve[N].p(ue,ee):(ve[N]=uM(ue),ve[N].c(),ve[N].m(v.parentNode,v))}for(;N<2;N+=1)ve[N].d(1)}if(ee[0]&129){_e=me([se[0].addIncomingHeal,se[0].addIncomingDamage]);let N;for(N=0;N<2;N+=1){let ue=G5(se,_e,N);Ie[N]?Ie[N].p(ue,ee):(Ie[N]=pM(ue),Ie[N].c(),Ie[N].m(_.parentNode,_))}for(;N<2;N+=1)Ie[N].d(1)}if(ee[0]&129){oe=me([se[0].addIncomingCrit]);let N;for(N=0;N<1;N+=1){let ue=j5(se,oe,N);Ee[N]?Ee[N].p(ue,ee):(Ee[N]=hM(ue),Ee[N].c(),Ee[N].m(b.parentNode,b))}for(;N<1;N+=1)Ee[N].d(1)}if(se[0].statsStatic?K?K.p(se,ee):(K=gM(se),K.c(),K.m(k.parentNode,k)):K&&(K.d(1),K=null),se[0].statsConvert?Re?Re.p(se,ee):(Re=_M(se),Re.c(),Re.m(y.parentNode,y)):Re&&(Re.d(1),Re=null),se[0].custom?Ge?Ge.p(se,ee):(Ge=yM(se),Ge.c(),Ge.m(F.parentNode,F)):Ge&&(Ge.d(1),Ge=null),se[0].aoe&&se[0].aoe.circleRadius?Qe?Qe.p(se,ee):(Qe=xM(se),Qe.c(),Qe.m(A.parentNode,A)):Qe&&(Qe.d(1),Qe=null),se[0].parent?Ye&&(Ye.d(1),Ye=null):Ye?Ye.p(se,ee):(Ye=wM(se),Ye.c(),Ye.m(C.parentNode,C)),ee[0]&34){pe=me(se[5]);let N;for(N=0;N<pe.length;N+=1){let ue=$5(se,pe,N);ce[N]?(ce[N].p(ue,ee),S(ce[N],1)):(ce[N]=MM(ue),ce[N].c(),S(ce[N],1),ce[N].m(M.parentNode,M))}for(Me(),N=pe.length;N<ce.length;N+=1)Oe(N);Fe()}},i(se){if(!V){for(let ee=0;ee<pe.length;ee+=1)S(ce[ee]);V=!0}},o(se){ce=ce.filter(Boolean);for(let ee=0;ee<ce.length;ee+=1)E(ce[ee]);V=!1},d(se){se&&(x(e),x(u),x(m),x(g),x(v),x(_),x(b),x(k),x(y),x(F),x(A),x(C),x(M)),$&&$.d(se),D&&D.d(),z&&z.d(),q&&q.d(),L&&L.d(),O&&O.d(),j&&j.d(),R&&R.d(),U&&U.d(),Z&&Z.d(),ye&&ye.d(),we&&we.d(se),he&&he.d(se),re&&re.d(se),st(ve,se),st(Ie,se),st(Ee,se),K&&K.d(se),Re&&Re.d(se),Ge&&Ge.d(se),Qe&&Qe.d(se),Ye&&Ye.d(se),st(ce,se)}}}function XI(t){let e,n=t[0].item+"",s;return{c(){e=h("div"),s=T(n)},m(o,i){w(o,e,i),d(e,s)},p(o,i){i[0]&1&&n!==(n=o[0].item+"")&&G(s,n)},i:ae,o:ae,d(o){o&&x(e)}}}function Q5(t){let e,n,s,o,i=P.items.book[t[0].id].name+"",r,l=t[0].engineOnly?"":" Lv. "+t[1],a;return{c(){e=h("div"),n=h("img"),o=Ne(),r=T(i),a=T(l),p(n,"class","texticon"),at(n.src,s=Xf(t[0].id))||p(n,"src",s),p(e,"class","slottitle textprimary")},m(c,f){w(c,e,f),d(e,n),d(e,o),d(e,r),d(e,a)},p(c,f){f[0]&1&&!at(n.src,s=Xf(c[0].id))&&p(n,"src",s),f[0]&1&&i!==(i=P.items.book[c[0].id].name+"")&&G(r,i),f[0]&3&&l!==(l=c[0].engineOnly?"":" Lv. "+c[1])&&G(a,l)},d(c){c&&x(e)}}}function Z5(t){let e,n=t[8][t[0].mode]+"",s,o,i=t[0].actiontype+"",r;return{c(){e=h("div"),s=T(n),o=Ne(),r=T(i),p(e,"class","textwhite")},m(l,a){w(l,e,a),d(e,s),d(e,o),d(e,r)},p(l,a){a[0]&1&&n!==(n=l[8][l[0].mode]+"")&&G(s,n),a[0]&1&&i!==(i=l[0].actiontype+"")&&G(r,i)},d(l){l&&x(e)}}}function J5(t){let e;return{c(){e=h("div"),e.textContent="Auto cast"},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function K5(t){let e,n,s=t[0].costMp(t[1])+"",o,i,r=P.ui.stats.array[7]+"",l;return{c(){e=h("div"),n=T("Cost: "),o=T(s),i=Ne(),l=T(r)},m(a,c){w(a,e,c),d(e,n),d(e,o),d(e,i),d(e,l)},p(a,c){c[0]&3&&s!==(s=a[0].costMp(a[1])+"")&&G(o,s)},d(a){a&&x(e)}}}function eM(t){let e,n=t[7](t[0].castLen)+"",s,o;return{c(){e=h("div"),s=T(n),o=T("s Cast time")},m(i,r){w(i,e,r),d(e,s),d(e,o)},p(i,r){r[0]&1&&n!==(n=i[7](i[0].castLen)+"")&&G(s,n)},d(i){i&&x(e)}}}function tM(t){let e,n=t[7](t[0].cd)+"",s,o;return{c(){e=h("div"),s=T(n),o=T("s Cooldown")},m(i,r){w(i,e,r),d(e,s),d(e,o)},p(i,r){r[0]&1&&n!==(n=i[7](i[0].cd)+"")&&G(s,n)},d(i){i&&x(e)}}}function nM(t){let e,n=t[7](t[0].duration)+"",s,o;return{c(){e=h("div"),s=T(n),o=T("s Duration")},m(i,r){w(i,e,r),d(e,s),d(e,o)},p(i,r){r[0]&1&&n!==(n=i[7](i[0].duration)+"")&&G(s,n)},d(i){i&&x(e)}}}function sM(t){let e;return{c(){e=h("div"),e.textContent="Unique"},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function oM(t){let e;return{c(){e=h("div"),e.textContent="Stacks refresh duration"},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function iM(t){let e,n=t[7](t[0].range)+"",s,o;return{c(){e=h("span"),s=T(n),o=T("m range ")},m(i,r){w(i,e,r),d(e,s),d(e,o)},p(i,r){r[0]&1&&n!==(n=i[7](i[0].range)+"")&&G(s,n)},d(i){i&&x(e)}}}function rM(t){let e,n=t[6][t[0].targetMode]+"",s;return{c(){e=h("span"),s=T(n)},m(o,i){w(o,e,i),d(e,s)},p(o,i){i[0]&1&&n!==(n=o[6][o[0].targetMode]+"")&&G(s,n)},d(o){o&&x(e)}}}function lM(t){let e,n,s,o=t[4].stacks+"",i,r,l,a;return{c(){e=h("div"),n=h("u"),s=T("At "),i=T(o),r=T(" stacks"),l=T(":"),a=h("span"),a.textContent="(Press shift to toggle)",p(e,"class","pad textsecondary svelte-14w0l4b"),p(a,"class","textgrey")},m(c,f){w(c,e,f),d(e,n),d(n,s),d(n,i),d(n,r),d(e,l),w(c,a,f)},p(c,f){f[0]&16&&o!==(o=c[4].stacks+"")&&G(i,o)},d(c){c&&(x(e),x(a))}}}function aM(t){let e,n=t[7](t[0].dmg)+"",s,o;return{c(){e=h("div"),s=T(n),o=T(" DMG"),p(e,"class","textgreen")},m(i,r){w(i,e,r),d(e,s),d(e,o)},p(i,r){r[0]&1&&n!==(n=i[7](i[0].dmg)+"")&&G(s,n)},d(i){i&&x(e)}}}function cM(t){let e,n=t[7](t[0].heal)+"",s,o;return{c(){e=h("div"),s=T(n),o=T(" Heal"),p(e,"class","textgreen")},m(i,r){w(i,e,r),d(e,s),d(e,o)},p(i,r){r[0]&1&&n!==(n=i[7](i[0].heal)+"")&&G(s,n)},d(i){i&&x(e)}}}function fM(t){let e,n,s=P.items.book[t[26]].name+"",o,i,r=Math.round(100*t[7](t[33][t[26]](t[0]))-100)+"",l,a;return{c(){e=h("div"),n=T("Empower "),o=T(s),i=T(" by "),l=T(r),a=T("%"),p(e,"class","textcyan")},m(c,f){w(c,e,f),d(e,n),d(e,o),d(e,i),d(e,l),d(e,a)},p(c,f){f[0]&1&&s!==(s=P.items.book[c[26]].name+"")&&G(o,s),f[0]&1&&r!==(r=Math.round(100*c[7](c[33][c[26]](c[0]))-100)+"")&&G(l,r)},d(c){c&&x(e)}}}function uM(t){let e,n=me(Object.keys(t[33]||{})),s=[];for(let o=0;o<n.length;o+=1)s[o]=fM(X5(t,n,o));return{c(){for(let o=0;o<s.length;o+=1)s[o].c();e=de()},m(o,i){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(o,i);w(o,e,i)},p(o,i){if(i[0]&129){n=me(Object.keys(o[33]||{}));let r;for(r=0;r<n.length;r+=1){let l=X5(o,n,r);s[r]?s[r].p(l,i):(s[r]=fM(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(o){o&&x(e),st(s,o)}}}function mM(t){let e,n,s=P.items.book[t[26]].name+"",o,i,r=t[7](t[23][t[26]](t[0]))+"",l;return{c(){e=h("div"),n=T("Empower "),o=T(s),i=T(" by "),l=T(r),p(e,"class","textcyan")},m(a,c){w(a,e,c),d(e,n),d(e,o),d(e,i),d(e,l)},p(a,c){c[0]&1&&s!==(s=P.items.book[a[26]].name+"")&&G(o,s),c[0]&1&&r!==(r=a[7](a[23][a[26]](a[0]))+"")&&G(l,r)},d(a){a&&x(e)}}}function pM(t){let e,n=me(Object.keys(t[23]||{})),s=[];for(let o=0;o<n.length;o+=1)s[o]=mM(H5(t,n,o));return{c(){for(let o=0;o<s.length;o+=1)s[o].c();e=de()},m(o,i){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(o,i);w(o,e,i)},p(o,i){if(i[0]&129){n=me(Object.keys(o[23]||{}));let r;for(r=0;r<n.length;r+=1){let l=H5(o,n,r);s[r]?s[r].p(l,i):(s[r]=mM(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(o){o&&x(e),st(s,o)}}}function dM(t){let e,n,s=P.items.book[t[26]].name+"",o,i,r=Qn(14,t[7](t[23][t[26]](t[0])))+"",l;return{c(){e=h("div"),n=T("Empower Crit% of "),o=T(s),i=T(" by "),l=T(r),p(e,"class","textcyan")},m(a,c){w(a,e,c),d(e,n),d(e,o),d(e,i),d(e,l)},p(a,c){c[0]&1&&s!==(s=P.items.book[a[26]].name+"")&&G(o,s),c[0]&1&&r!==(r=Qn(14,a[7](a[23][a[26]](a[0])))+"")&&G(l,r)},d(a){a&&x(e)}}}function hM(t){let e,n=me(Object.keys(t[23]||{})),s=[];for(let o=0;o<n.length;o+=1)s[o]=dM(W5(t,n,o));return{c(){for(let o=0;o<s.length;o+=1)s[o].c();e=de()},m(o,i){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(o,i);w(o,e,i)},p(o,i){if(i[0]&129){n=me(Object.keys(o[23]||{}));let r;for(r=0;r<n.length;r+=1){let l=W5(o,n,r);s[r]?s[r].p(l,i):(s[r]=dM(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(o){o&&x(e),st(s,o)}}}function gM(t){let e,n=me(Array.from(t[3].stat)),s=[];for(let o=0;o<n.length;o+=1)s[o]=vM(N5(t,n,o));return{c(){for(let o=0;o<s.length;o+=1)s[o].c();e=de()},m(o,i){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(o,i);w(o,e,i)},p(o,i){if(i[0]&8){n=me(Array.from(o[3].stat));let r;for(r=0;r<n.length;r+=1){let l=N5(o,n,r);s[r]?s[r].p(l,i):(s[r]=vM(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(o){o&&x(e),st(s,o)}}}function vM(t){let e,n,s=Qn(t[18][0],t[18][1])+"",o,i,r=P.ui.stats.array[t[18][0]]+"",l,a;return{c(){e=h("div"),n=T("+"),o=T(s),i=Ne(),l=T(r),a=Ne(),p(e,"class","textcyan")},m(c,f){w(c,e,f),d(e,n),d(e,o),d(e,i),d(e,l),d(e,a)},p(c,f){f[0]&8&&s!==(s=Qn(c[18][0],c[18][1])+"")&&G(o,s),f[0]&8&&r!==(r=P.ui.stats.array[c[18][0]]+"")&&G(l,r)},d(c){c&&x(e)}}}function _M(t){let e,n=me(t[0].statsConvert),s=[];for(let o=0;o<n.length;o+=1)s[o]=bM(O5(t,n,o));return{c(){for(let o=0;o<s.length;o+=1)s[o].c();e=de()},m(o,i){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(o,i);w(o,e,i)},p(o,i){if(i[0]&1){n=me(o[0].statsConvert);let r;for(r=0;r<n.length;r+=1){let l=O5(o,n,r);s[r]?s[r].p(l,i):(s[r]=bM(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(o){o&&x(e),st(s,o)}}}function bM(t){let e,n=P.ui.skilldescription.statincrement[0]+"",s,o,i=P.ui.stats.array[t[18][0]]+"",r,l,a=P.ui.skilldescription.statincrement[1]+"",c,f,u=Qn(t[18][0],t[18][1])+"",m,g,v=P.ui.stats.array[t[18][2]]+"",_,b,k=P.ui.skilldescription.statincrement[2]+"",y;return{c(){e=h("div"),s=T(n),o=Ne(),r=T(i),l=Ne(),c=T(a),f=Ne(),m=T(u),g=Ne(),_=T(v),b=Ne(),y=T(k),p(e,"class","textcyan")},m(F,A){w(F,e,A),d(e,s),d(e,o),d(e,r),d(e,l),d(e,c),d(e,f),d(e,m),d(e,g),d(e,_),d(e,b),d(e,y)},p(F,A){A[0]&1&&i!==(i=P.ui.stats.array[F[18][0]]+"")&&G(r,i),A[0]&1&&u!==(u=Qn(F[18][0],F[18][1])+"")&&G(m,u),A[0]&1&&v!==(v=P.ui.stats.array[F[18][2]]+"")&&G(_,v)},d(F){F&&x(e)}}}function yM(t){let e,n=me(t[0].custom),s=[];for(let o=0;o<n.length;o+=1)s[o]=kM(U5(t,n,o));return{c(){for(let o=0;o<s.length;o+=1)s[o].c();e=de()},m(o,i){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(o,i);w(o,e,i)},p(o,i){if(i[0]&131){n=me(o[0].custom);let r;for(r=0;r<n.length;r+=1){let l=U5(o,n,r);s[r]?s[r].p(l,i):(s[r]=kM(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(o){o&&x(e),st(s,o)}}}function kM(t){let e,n=t[7](t[15][0](t[1]))+"",s,o=t[15][1]+"",i;return{c(){e=h("div"),s=T(n),i=T(o),p(e,"class","textcyan")},m(r,l){w(r,e,l),d(e,s),d(e,i)},p(r,l){l[0]&3&&n!==(n=r[7](r[15][0](r[1]))+"")&&G(s,n),l[0]&1&&o!==(o=r[15][1]+"")&&G(i,o)},d(r){r&&x(e)}}}function xM(t){let e,n=t[0].aoe.limit?"Up to "+t[0].aoe.limit:"All",s,o,i=t[0].aoe.faction?"allies":"enemies",r,l,a=t[7](t[0].aoe.circleRadius)+"",c,f;return{c(){e=h("div"),s=T(n),o=Ne(),r=T(i),l=T(" within "),c=T(a),f=T("m"),p(e,"class","textpvp")},m(u,m){w(u,e,m),d(e,s),d(e,o),d(e,r),d(e,l),d(e,c),d(e,f)},p(u,m){m[0]&1&&n!==(n=u[0].aoe.limit?"Up to "+u[0].aoe.limit:"All")&&G(s,n),m[0]&1&&i!==(i=u[0].aoe.faction?"allies":"enemies")&&G(r,i),m[0]&1&&a!==(a=u[7](u[0].aoe.circleRadius)+"")&&G(c,a)},d(u){u&&x(e)}}}function wM(t){let e,n,s,o=P.items.book[t[0].id].description+"",i;return{c(){e=h("div"),n=h("u"),n.textContent="Effect",s=T(": "),i=T(o),p(e,"class","textsecondary pad svelte-14w0l4b")},m(r,l){w(r,e,l),d(e,n),d(e,s),d(e,i)},p(r,l){l[0]&1&&o!==(o=P.items.book[r[0].id].description+"")&&G(i,o)},d(r){r&&x(e)}}}function MM(t){let e,n,s;return n=new Md({props:{level:t[1],skill:t[12]}}),{c(){e=h("div"),J(n.$$.fragment),p(e,"class","pad svelte-14w0l4b")},m(o,i){w(o,e,i),X(n,e,null),s=!0},p(o,i){let r={};i[0]&2&&(r.level=o[1]),i[0]&32&&(r.skill=o[12]),n.$set(r)},i(o){s||(S(n.$$.fragment,o),s=!0)},o(o){E(n.$$.fragment,o),s=!1},d(o){o&&x(e),Q(n)}}}function QI(t){let e,n,s,o,i=[XI,YI],r=[];function l(a,c){return a[0].item?0:1}return n=l(t,[-1,-1]),s=r[n]=i[n](t),{c(){e=h("div"),s.c(),p(e,"class","container textsecondary svelte-14w0l4b")},m(a,c){w(a,e,c),r[n].m(e,null),o=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(Me(),E(r[f],1,1,()=>{r[f]=null}),Fe(),s=r[n],s?s.p(a,c):(s=r[n]=i[n](a),s.c()),S(s,1),s.m(e,null))},i(a){o||(S(s),o=!0)},o(a){E(s),o=!1},d(a){a&&x(e),r[n].d()}}}function ZI(t,e,n){let{skill:s}=e,{level:o}=e,{asItemDescription:i=!1}=e,{shift:r=!1}=e,l={1:"Requires no target",16:"Self cast",256:"on Allies",4096:"on Enemy"},a=(_,b=I&&I.player)=>{if(!b)return"?";let k=y4(_,b);return k%1===0?k:k.toFixed(1)},c={0:"Melee attack",1:"Magic attack",2:"Heal",4:"Buff",5:"Stackable buff",6:"Ranged missile",7:"Ranged effect",9:"Effect"},f=[],u,m={},g=_=>{if(I)return _.onCast&&v("on cast",_.onCast,I.player,o),_.onBlock&&v("on block",_.onBlock,m,I.player),_.onInterval&&v(`every ${_.intervalDuration.toFixed(1)}s`,_.onInterval,m,I.player,I.player),_.onPermanent&&v("permanently",()=>({id:_.onPermanent(I.player),mode:4}),I.player,o),_},v=(_,b,k,y,F)=>{let A=b(k,y,F);if(!A||A===!0)return;let C=Object.assign({},A);if(C.actiontype=_,C.parent||(C.parent=[]),C.parent.push(s),C.mode===4||C.mode===5){let M=yl.get(C.id);f.unshift(g({...C,...M}))}else if(s.id===C.id)s.parent||(C.parent=void 0),n(0,s={...s,...C});else{if(s.parent){let M=s.parent.find(V=>V.id==C.id);if(M){M.parent||(C.parent=void 0),Object.assign(M,C);return}}f.unshift(g(C))}};return t.$$set=_=>{"skill"in _&&n(0,s=_.skill),"level"in _&&n(1,o=_.level),"asItemDescription"in _&&n(2,i=_.asItemDescription),"shift"in _&&n(9,r=_.shift)},t.$$.update=()=>{t.$$.dirty[0]&539&&(n(4,m={stacks:1,level:o}),n(4,m.stacks=s.maxStacks?r?1:s.maxStacks:1,m),n(0,s.stacks=m.stacks,s),n(5,f=[]),s.parent||g(s),s.statsStatic&&(n(3,u=new oc),s.statsStatic(m,u)))},[s,o,i,u,m,f,l,a,c,r]}var Md=class extends Ce{constructor(e){super(),Pe(this,e,ZI,QI,Be,{skill:0,level:1,asItemDescription:2,shift:9},null,[-1,-1])}},kl=Md;function JI(t){let e;return{c(){e=h("span")},m(n,s){w(n,e,s),e.innerHTML=t[0]},p(n,[s]){s&1&&(e.innerHTML=n[0])},i:ae,o:ae,d(n){n&&x(e)}}}function KI(t,e,n){let s,o,i;ie(t,Qs,a=>n(4,i=a));let{amount:r}=e,{isPrice:l=!1}=e;return t.$$set=a=>{"amount"in a&&n(1,r=a.amount),"isPrice"in a&&n(2,l=a.isPrice)},t.$$.update=()=>{t.$$.dirty&22&&n(3,s=l&&r>i),t.$$.dirty&10&&n(0,o=Xh(r,s))},[o,r,l,s,i]}var Bg=class extends Ce{constructor(e){super(),Pe(this,e,KI,JI,yn,{amount:1,isPrice:2})}},xn=Bg;function eD(t){let e;return{c(){e=h("span")},m(n,s){w(n,e,s),e.innerHTML=t[0]},p(n,[s]){s&1&&(e.innerHTML=n[0])},i:ae,o:ae,d(n){n&&x(e)}}}function tD(t,e,n){let s,o,i;ie(t,ca,a=>n(4,i=a));let{amount:r}=e,{isPrice:l=!1}=e;return t.$$set=a=>{"amount"in a&&n(1,r=a.amount),"isPrice"in a&&n(2,l=a.isPrice)},t.$$.update=()=>{t.$$.dirty&22&&n(3,s=l&&r>i),t.$$.dirty&10&&n(0,o=Qh(r,s))},[o,r,l,s,i]}var $g=class extends Ce{constructor(e){super(),Pe(this,e,tD,eD,yn,{amount:1,isPrice:2})}},hr=$g;function nD(t){let e,n,s,o,i,r;return{c(){e=h("span"),n=h("img"),o=h("span"),i=T(t[0]),p(n,"class","svgicon texticon"),at(n.src,s="/data/ui/icons/gem.svg?v=8685122")||p(n,"src",s),p(o,"class",r=!t[1]||t[0]<t[2]?"textprimary":"textred")},m(l,a){w(l,e,a),d(e,n),d(e,o),d(o,i)},p(l,[a]){a&1&&G(i,l[0]),a&7&&r!==(r=!l[1]||l[0]<l[2]?"textprimary":"textred")&&p(o,"class",r)},i:ae,o:ae,d(l){l&&x(e)}}}function sD(t,e,n){let s;ie(t,Ui,r=>n(2,s=r));let{amount:o}=e,{isPrice:i=!1}=e;return t.$$set=r=>{"amount"in r&&n(0,o=r.amount),"isPrice"in r&&n(1,i=r.isPrice)},[o,i,s]}var Ug=class extends Ce{constructor(e){super(),Pe(this,e,sD,nD,yn,{amount:0,isPrice:1})}},gr=Ug;function FM(t,e,n){let s=t.slice();return s[11]=e[n],s}function CM(t,e,n){let s=t.slice();return s[14]=e[n],s}function SM(t,e,n){let s=t.slice();return s[14]=e[n],s}function PM(t,e,n){let s=t.slice();return s[19]=e[n],s}function AM(t,e,n){let s=t.slice();return s[11]=e[n],s}function TM(t){let e,n,s=t[0].gs+"",o,i;return{c(){e=h("span"),n=T("GS: "),o=T(s),i=Ne(),p(e,"class","textgreen")},m(r,l){w(r,e,l),d(e,n),d(e,o),w(r,i,l)},p(r,l){l&1&&s!==(s=r[0].gs+"")&&G(o,s)},d(r){r&&(x(e),x(i))}}}function EM(t){let e,n,s=t[0].dbid+"",o;return{c(){e=h("span"),n=T("ID: "),o=T(s),p(e,"class","textgrey")},m(i,r){w(i,e,r),d(e,n),d(e,o)},p(i,r){r&1&&s!==(s=i[0].dbid+"")&&G(o,s)},d(i){i&&x(e)}}}function oD(t){let e,n=t[11][1].type=="bonus"?"+ ":"",s,o=Qn(t[11][0],t[11][1].value)+"",i,r,l=P.ui.stats.array[t[11][0]]+"",a,c,f,u=t[11][1].type=="bonus"&&t[3]&&IM(t);return{c(){e=h("div"),s=T(n),i=T(o),r=Ne(),a=T(l),c=Ne(),u&&u.c(),p(e,"class",f="text"+jt(t[11][1].qual)[0]+" svelte-e3ao5j")},m(m,g){w(m,e,g),d(e,s),d(e,i),d(e,r),d(e,a),d(e,c),u&&u.m(e,null)},p(m,g){g&256&&n!==(n=m[11][1].type=="bonus"?"+ ":"")&&G(s,n),g&256&&o!==(o=Qn(m[11][0],m[11][1].value)+"")&&G(i,o),g&256&&l!==(l=P.ui.stats.array[m[11][0]]+"")&&G(a,l),m[11][1].type=="bonus"&&m[3]?u?u.p(m,g):(u=IM(m),u.c(),u.m(e,null)):u&&(u.d(1),u=null),g&256&&f!==(f="text"+jt(m[11][1].qual)[0]+" svelte-e3ao5j")&&p(e,"class",f)},d(m){m&&x(e),u&&u.d()}}}function iD(t){let e,n,s=t[0].stats.get(10).value+"",o,i,r,l,a=t[0].stats.get(11).value+"",c,f,u,m,g=P.ui.stats.misc.damage+"",v,_;return{c(){e=h("div"),n=h("span"),o=T(s),r=T(" - "),l=h("span"),c=T(a),u=Ne(),m=h("span"),v=T(g),p(n,"class",i="text"+jt(t[0].stats.get(10).qual)[0]+" svelte-e3ao5j"),p(l,"class",f="text"+jt(t[0].stats.get(11).qual)[0]+" svelte-e3ao5j"),p(m,"class",_="text"+jt(Math.min(t[0].stats.get(10).qual,t[0].stats.get(11).qual))[0]+" svelte-e3ao5j")},m(b,k){w(b,e,k),d(e,n),d(n,o),d(e,r),d(e,l),d(l,c),d(e,u),d(e,m),d(m,v)},p(b,k){k&1&&s!==(s=b[0].stats.get(10).value+"")&&G(o,s),k&1&&i!==(i="text"+jt(b[0].stats.get(10).qual)[0]+" svelte-e3ao5j")&&p(n,"class",i),k&1&&a!==(a=b[0].stats.get(11).value+"")&&G(c,a),k&1&&f!==(f="text"+jt(b[0].stats.get(11).qual)[0]+" svelte-e3ao5j")&&p(l,"class",f),k&1&&_!==(_="text"+jt(Math.min(b[0].stats.get(10).qual,b[0].stats.get(11).qual))[0]+" svelte-e3ao5j")&&p(m,"class",_)},d(b){b&&x(e)}}}function IM(t){let e,n=Math.round(t[11][1].qual)+"",s,o;return{c(){e=h("span"),s=T(n),o=T("%")},m(i,r){w(i,e,r),d(e,s),d(e,o)},p(i,r){r&256&&n!==(n=Math.round(i[11][1].qual)+"")&&G(s,n)},d(i){i&&x(e)}}}function DM(t){let e,n;function s(r,l){return l&257&&(e=null),e==null&&(e=!!(r[11][0]==10&&r[0].stats.has(11))),e?iD:oD}let o=s(t,-1),i=o(t);return{c(){i.c(),n=de()},m(r,l){i.m(r,l),w(r,n,l)},p(r,l){o===(o=s(r,l))&&i?i.p(r,l):(i.d(1),i=o(r),i&&(i.c(),i.m(n.parentNode,n)))},d(r){r&&x(n),i.d(r)}}}function VM(t){let e,n=me(t[0].logic.custom),s=[];for(let o=0;o<n.length;o+=1)s[o]=LM(PM(t,n,o));return{c(){for(let o=0;o<s.length;o+=1)s[o].c();e=de()},m(o,i){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(o,i);w(o,e,i)},p(o,i){if(i&1){n=me(o[0].logic.custom);let r;for(r=0;r<n.length;r+=1){let l=PM(o,n,r);s[r]?s[r].p(l,i):(s[r]=LM(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(o){o&&x(e),st(s,o)}}}function LM(t){let e,n=t[19]+"",s;return{c(){e=h("span"),s=T(n),p(e,"class","textgreen")},m(o,i){w(o,e,i),d(e,s)},p(o,i){i&1&&n!==(n=o[19]+"")&&G(s,n)},d(o){o&&x(e)}}}function qM(t){let e,n=t[14][0]+"",s,o;return{c(){e=h("div"),s=T(n),p(e,"class",o=t[14][1]?"textgreen":"textred")},m(i,r){w(i,e,r),d(e,s)},p(i,r){r&1&&n!==(n=i[14][0]+"")&&G(s,n),r&1&&o!==(o=i[14][1]?"textgreen":"textred")&&p(e,"class",o)},d(i){i&&x(e)}}}function rD(t){let e,n,s,o=t[0].logic.bindOnPurchase&&RM(t),i=t[0].logic.bindOnUse&&zM(t),r=t[0].logic.bindOnMerchant&&BM(t);return{c(){o&&o.c(),e=de(),i&&i.c(),n=de(),r&&r.c(),s=de()},m(l,a){o&&o.m(l,a),w(l,e,a),i&&i.m(l,a),w(l,n,a),r&&r.m(l,a),w(l,s,a)},p(l,a){l[0].logic.bindOnPurchase?o?o.p(l,a):(o=RM(l),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null),l[0].logic.bindOnUse?i?i.p(l,a):(i=zM(l),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null),l[0].logic.bindOnMerchant?r?r.p(l,a):(r=BM(l),r.c(),r.m(s.parentNode,s)):r&&(r.d(1),r=null)},d(l){l&&(x(e),x(n),x(s)),o&&o.d(l),i&&i.d(l),r&&r.d(l)}}}function lD(t){let e,n=P.ui.inventory.bindlevel[t[0].bound]+"",s;return{c(){e=h("div"),s=T(n),p(e,"class","textgreen")},m(o,i){w(o,e,i),d(e,s)},p(o,i){i&1&&n!==(n=P.ui.inventory.bindlevel[o[0].bound]+"")&&G(s,n)},d(o){o&&x(e)}}}function RM(t){let e,n=P.ui.inventory.bindlevel[t[0].logic.bindOnPurchase]+"",s,o,i=P.ui.itemdescription.onpurchase+"",r;return{c(){e=h("div"),s=T(n),o=Ne(),r=T(i),p(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,s),d(e,o),d(e,r)},p(l,a){a&1&&n!==(n=P.ui.inventory.bindlevel[l[0].logic.bindOnPurchase]+"")&&G(s,n)},d(l){l&&x(e)}}}function zM(t){let e,n=P.ui.inventory.bindlevel[t[0].logic.bindOnUse]+"",s,o,i=P.ui.itemdescription.onuse+"",r;return{c(){e=h("div"),s=T(n),o=Ne(),r=T(i),p(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,s),d(e,o),d(e,r)},p(l,a){a&1&&n!==(n=P.ui.inventory.bindlevel[l[0].logic.bindOnUse]+"")&&G(s,n)},d(l){l&&x(e)}}}function BM(t){let e,n=P.ui.inventory.bindlevel[t[0].logic.bindOnMerchant]+"",s,o,i=P.ui.itemdescription.onsale+"",r;return{c(){e=h("div"),s=T(n),o=Ne(),r=T(i),p(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,s),d(e,o),d(e,r)},p(l,a){a&1&&n!==(n=P.ui.inventory.bindlevel[l[0].logic.bindOnMerchant]+"")&&G(s,n)},d(l){l&&x(e)}}}function $M(t){let e,n,s=t[0].medalValue()>0&&t[1],o,i=t[0].storeValue()>0&&t[1],r,l=!(t[0].storeValue()>0&&t[1])&&t[0].canBeSold(),a,c=t[1]&&UM(t),f=s&&NM(t),u=i&&jM(t),m=l&&WM(t);return{c(){e=h("div"),c&&c.c(),n=de(),f&&f.c(),o=de(),u&&u.c(),r=de(),m&&m.c(),p(e,"class","panel value pack svelte-e3ao5j")},m(g,v){w(g,e,v),c&&c.m(e,null),d(e,n),f&&f.m(e,null),d(e,o),u&&u.m(e,null),d(e,r),m&&m.m(e,null),a=!0},p(g,v){g[1]?c?c.p(g,v):(c=UM(g),c.c(),c.m(e,n)):c&&(c.d(1),c=null),v&3&&(s=g[0].medalValue()>0&&g[1]),s?f?(f.p(g,v),v&3&&S(f,1)):(f=NM(g),f.c(),S(f,1),f.m(e,o)):f&&(Me(),E(f,1,1,()=>{f=null}),Fe()),v&3&&(i=g[0].storeValue()>0&&g[1]),i?u?(u.p(g,v),v&3&&S(u,1)):(u=jM(g),u.c(),S(u,1),u.m(e,r)):u&&(Me(),E(u,1,1,()=>{u=null}),Fe()),v&3&&(l=!(g[0].storeValue()>0&&g[1])&&g[0].canBeSold()),l?m?(m.p(g,v),v&3&&S(m,1)):(m=WM(g),m.c(),S(m,1),m.m(e,null)):m&&(Me(),E(m,1,1,()=>{m=null}),Fe())},i(g){a||(S(f),S(u),S(m),a=!0)},o(g){E(f),E(u),E(m),a=!1},d(g){g&&x(e),c&&c.d(),f&&f.d(),u&&u.d(),m&&m.d()}}}function UM(t){let e,n=me(t[0].buyReasons(I&&I.player)),s=[];for(let o=0;o<n.length;o+=1)s[o]=OM(CM(t,n,o));return{c(){for(let o=0;o<s.length;o+=1)s[o].c();e=de()},m(o,i){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(o,i);w(o,e,i)},p(o,i){if(i&1){n=me(o[0].buyReasons(I&&I.player));let r;for(r=0;r<n.length;r+=1){let l=CM(o,n,r);s[r]?s[r].p(l,i):(s[r]=OM(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(o){o&&x(e),st(s,o)}}}function OM(t){let e,n=t[14][0]+"",s;return{c(){e=h("div"),p(e,"class",s=t[14][1]?"textgreen":"textred")},m(o,i){w(o,e,i),e.innerHTML=n},p(o,i){i&1&&n!==(n=o[14][0]+"")&&(e.innerHTML=n),i&1&&s!==(s=o[14][1]?"textgreen":"textred")&&p(e,"class",s)},d(o){o&&x(e)}}}function NM(t){let e,n,s;return n=new hr({props:{amount:t[0].medalValue(),isPrice:!0}}),{c(){e=h("div"),J(n.$$.fragment)},m(o,i){w(o,e,i),X(n,e,null),s=!0},p(o,i){let r={};i&1&&(r.amount=o[0].medalValue()),n.$set(r)},i(o){s||(S(n.$$.fragment,o),s=!0)},o(o){E(n.$$.fragment,o),s=!1},d(o){o&&x(e),Q(n)}}}function jM(t){let e,n,s;return n=new gr({props:{amount:t[0].storeValue(),isPrice:!0}}),{c(){e=h("div"),J(n.$$.fragment)},m(o,i){w(o,e,i),X(n,e,null),s=!0},p(o,i){let r={};i&1&&(r.amount=o[0].storeValue()),n.$set(r)},i(o){s||(S(n.$$.fragment,o),s=!0)},o(o){E(n.$$.fragment,o),s=!1},d(o){o&&x(e),Q(n)}}}function WM(t){let e,n,s;return n=new xn({props:{amount:t[0].goldValue(t[1]),isPrice:t[1]}}),{c(){e=h("div"),J(n.$$.fragment)},m(o,i){w(o,e,i),X(n,e,null),s=!0},p(o,i){let r={};i&3&&(r.amount=o[0].goldValue(o[1])),i&2&&(r.isPrice=o[1]),n.$set(r)},i(o){s||(S(n.$$.fragment,o),s=!0)},o(o){E(n.$$.fragment,o),s=!1},d(o){o&&x(e),Q(n)}}}function aD(t){let e,n,s,o,i=[uD,fD],r=[];function l(a,c){return a[0].type=="book"?0:a[5]?1:-1}return~(e=l(t,-1))&&(n=r[e]=i[e](t)),{c(){n&&n.c(),s=de()},m(a,c){~e&&r[e].m(a,c),w(a,s,c),o=!0},p(a,c){let f=e;e=l(a,c),e===f?~e&&r[e].p(a,c):(n&&(Me(),E(r[f],1,1,()=>{r[f]=null}),Fe()),~e?(n=r[e],n?n.p(a,c):(n=r[e]=i[e](a),n.c()),S(n,1),n.m(s.parentNode,s)):n=null)},i(a){o||(S(n),o=!0)},o(a){E(n),o=!1},d(a){a&&x(s),~e&&r[e].d(a)}}}function cD(t){let e,n,s=me(t[7]),o=[];for(let i=0;i<s.length;i+=1)o[i]=GM(FM(t,s,i));return{c(){e=h("div"),n=h("div"),n.textContent=`${P.ui.itemdescription.equipeffect}:`;for(let i=0;i<o.length;i+=1)o[i].c();p(n,"class","textgrey"),p(e,"class","pack svelte-e3ao5j")},m(i,r){w(i,e,r),d(e,n);for(let l=0;l<o.length;l+=1)o[l]&&o[l].m(e,null)},p(i,r){if(r&128){s=me(i[7]);let l;for(l=0;l<s.length;l+=1){let a=FM(i,s,l);o[l]?o[l].p(a,r):(o[l]=GM(a),o[l].c(),o[l].m(e,null))}for(;l<o.length;l+=1)o[l].d(1);o.length=s.length}},i:ae,o:ae,d(i){i&&x(e),st(o,i)}}}function fD(t){let e,n=X1(t[0].type,t[0].tier)+"",s;return{c(){e=h("div"),s=T(n),p(e,"class","pack description svelte-e3ao5j")},m(o,i){w(o,e,i),d(e,s)},p(o,i){i&1&&n!==(n=X1(o[0].type,o[0].tier)+"")&&G(s,n)},i:ae,o:ae,d(o){o&&x(e)}}}function uD(t){let e,n;return e=new kl({props:{shift:t[2],level:t[0].logic.skilllevel+1,skill:At.get(t[0].logic.skillid),asItemDescription:!0}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&4&&(i.shift=s[2]),o&1&&(i.level=s[0].logic.skilllevel+1),o&1&&(i.skill=At.get(s[0].logic.skillid)),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function GM(t){let e,n=t[11][1]>0?"+":"",s,o=Qn(t[11][0],t[11][1])+"",i,r,l=P.ui.stats.array[t[11][0]]+"",a,c;return{c(){e=h("div"),s=T(n),i=T(o),r=Ne(),a=T(l),p(e,"class",c="text"+(t[11][1]>0?"green":"red"))},m(f,u){w(f,e,u),d(e,s),d(e,i),d(e,r),d(e,a)},p(f,u){u&128&&n!==(n=f[11][1]>0?"+":"")&&G(s,n),u&128&&o!==(o=Qn(f[11][0],f[11][1])+"")&&G(i,o),u&128&&l!==(l=P.ui.stats.array[f[11][0]]+"")&&G(a,l),u&128&&c!==(c="text"+(f[11][1]>0?"green":"red"))&&p(e,"class",c)},d(f){f&&x(e)}}}function HM(t){let e,n,s,o;return n=new Fd({props:{item:t[6],comparison:!0,percentages:!0}}),{c(){e=h("div"),J(n.$$.fragment),p(e,"class",s="slotdescription border "+jt(t[6].quality)[0]+" comparecontainer svelte-e3ao5j")},m(i,r){w(i,e,r),X(n,e,null),o=!0},p(i,r){let l={};r&64&&(l.item=i[6]),n.$set(l),(!o||r&64&&s!==(s="slotdescription border "+jt(i[6].quality)[0]+" comparecontainer svelte-e3ao5j"))&&p(e,"class",s)},i(i){o||(S(n.$$.fragment,i),o=!0)},o(i){E(n.$$.fragment,i),o=!1},d(i){i&&x(e),Q(n)}}}function mD(t){let e,n,s,o=t[2]?"T"+(t[0].tier+1)+" ":"",i,r=nn(t[0].type,t[0].tier)+"",l,a,c=t[0].upgrade?" +"+t[0].upgrade:"",f,u,m,g=(t[0].stacks?"":jt(t[0].quality)[1])+"",v,_,b=t[0].type+"",k,y,F,A=t[0].quality&&!t[0].stacks?t[0].quality+"%":"",C,M,V,$,D,z,q,L,O=t[4]&&(t[1]||t[0].canBeSold()),j,R,U,Z,ye,we=t[0].gs>0&&TM(t),he=t[0].dbid&&EM(t),re=me(t[8]),le=[];for(let ce=0;ce<re.length;ce+=1)le[ce]=DM(AM(t,re,ce));let ve=t[0].logic.custom!==void 0&&VM(t),_e=me(t[0].equipReasons(I&&I.player)),Ie=[];for(let ce=0;ce<_e.length;ce+=1)Ie[ce]=qM(SM(t,_e,ce));function oe(ce,Oe){return ce[0].bound>0?lD:rD}let Ee=oe(t,-1),K=Ee(t),Re=O&&$M(t),Ge=[cD,aD],Qe=[];function Ye(ce,Oe){return ce[6]?0:1}R=Ye(t,-1),U=Qe[R]=Ge[R](t);let pe=t[6]&&HM(t);return{c(){e=h("div"),n=h("div"),s=h("div"),i=T(o),l=T(r),a=h("span"),f=T(c),m=h("div"),v=T(g),_=Ne(),k=T(b),y=Ne(),F=h("span"),C=T(A),M=h("small"),we&&we.c(),V=de(),he&&he.c(),$=Ne(),D=h("div");for(let ce=0;ce<le.length;ce+=1)le[ce].c();z=de(),ve&&ve.c(),q=h("div");for(let ce=0;ce<Ie.length;ce+=1)Ie[ce].c();L=de(),K.c(),Re&&Re.c(),j=de(),U.c(),pe&&pe.c(),Z=de(),p(a,"class","textprimary"),p(s,"class",u="slottitle text"+jt(t[0].quality)[0]+" svelte-e3ao5j"),p(m,"class","type textwhite svelte-e3ao5j"),p(n,"class","pack svelte-e3ao5j"),p(D,"class","pack svelte-e3ao5j"),p(q,"class","pack svelte-e3ao5j"),p(e,"class","container svelte-e3ao5j")},m(ce,Oe){w(ce,e,Oe),d(e,n),d(n,s),d(s,i),d(s,l),d(s,a),d(a,f),d(n,m),d(m,v),d(m,_),d(m,k),d(m,y),d(m,F),d(F,C),d(n,M),we&&we.m(M,null),d(M,V),he&&he.m(M,null),d(n,$),d(e,D);for(let se=0;se<le.length;se+=1)le[se]&&le[se].m(D,null);d(D,z),ve&&ve.m(D,null),d(e,q);for(let se=0;se<Ie.length;se+=1)Ie[se]&&Ie[se].m(q,null);d(q,L),K.m(q,null),Re&&Re.m(e,null),d(e,j),Qe[R].m(e,null),pe&&pe.m(ce,Oe),w(ce,Z,Oe),ye=!0},p(ce,[Oe]){if((!ye||Oe&5)&&o!==(o=ce[2]?"T"+(ce[0].tier+1)+" ":"")&&G(i,o),(!ye||Oe&1)&&r!==(r=nn(ce[0].type,ce[0].tier)+"")&&G(l,r),(!ye||Oe&1)&&c!==(c=ce[0].upgrade?" +"+ce[0].upgrade:"")&&G(f,c),(!ye||Oe&1&&u!==(u="slottitle text"+jt(ce[0].quality)[0]+" svelte-e3ao5j"))&&p(s,"class",u),(!ye||Oe&1)&&g!==(g=(ce[0].stacks?"":jt(ce[0].quality)[1])+"")&&G(v,g),(!ye||Oe&1)&&b!==(b=ce[0].type+"")&&G(k,b),(!ye||Oe&1)&&A!==(A=ce[0].quality&&!ce[0].stacks?ce[0].quality+"%":"")&&G(C,A),ce[0].gs>0?we?we.p(ce,Oe):(we=TM(ce),we.c(),we.m(M,V)):we&&(we.d(1),we=null),ce[0].dbid?he?he.p(ce,Oe):(he=EM(ce),he.c(),he.m(M,null)):he&&(he.d(1),he=null),Oe&265){re=me(ce[8]);let ee;for(ee=0;ee<re.length;ee+=1){let N=AM(ce,re,ee);le[ee]?le[ee].p(N,Oe):(le[ee]=DM(N),le[ee].c(),le[ee].m(D,z))}for(;ee<le.length;ee+=1)le[ee].d(1);le.length=re.length}if(ce[0].logic.custom!==void 0?ve?ve.p(ce,Oe):(ve=VM(ce),ve.c(),ve.m(D,null)):ve&&(ve.d(1),ve=null),Oe&1){_e=me(ce[0].equipReasons(I&&I.player));let ee;for(ee=0;ee<_e.length;ee+=1){let N=SM(ce,_e,ee);Ie[ee]?Ie[ee].p(N,Oe):(Ie[ee]=qM(N),Ie[ee].c(),Ie[ee].m(q,L))}for(;ee<Ie.length;ee+=1)Ie[ee].d(1);Ie.length=_e.length}Ee===(Ee=oe(ce,Oe))&&K?K.p(ce,Oe):(K.d(1),K=Ee(ce),K&&(K.c(),K.m(q,null))),Oe&19&&(O=ce[4]&&(ce[1]||ce[0].canBeSold())),O?Re?(Re.p(ce,Oe),Oe&19&&S(Re,1)):(Re=$M(ce),Re.c(),S(Re,1),Re.m(e,j)):Re&&(Me(),E(Re,1,1,()=>{Re=null}),Fe());let se=R;R=Ye(ce,Oe),R===se?Qe[R].p(ce,Oe):(Me(),E(Qe[se],1,1,()=>{Qe[se]=null}),Fe(),U=Qe[R],U?U.p(ce,Oe):(U=Qe[R]=Ge[R](ce),U.c()),S(U,1),U.m(e,null)),ce[6]?pe?(pe.p(ce,Oe),Oe&64&&S(pe,1)):(pe=HM(ce),pe.c(),S(pe,1),pe.m(Z.parentNode,Z)):pe&&(Me(),E(pe,1,1,()=>{pe=null}),Fe())},i(ce){ye||(S(Re),S(U),S(pe),ye=!0)},o(ce){E(Re),E(U),E(pe),ye=!1},d(ce){ce&&(x(e),x(Z)),we&&we.d(),he&&he.d(),st(le,ce),ve&&ve.d(),st(Ie,ce),K.d(),Re&&Re.d(),Qe[R].d(),pe&&pe.d(ce)}}}function pD(t,e,n){let s,{item:o}=e,{comparison:i=!1}=e,{isTrader:r=!1}=e,{shift:l=!1}=e,{percentages:a=!1}=e,{showTradeInfo:c=!0}=e,{showLore:f=!0}=e,u,m,g=v=>{let _=new Map;return o.stats.forEach((b,k)=>{_.set(k,b.value)}),v.stats.forEach((b,k)=>{let y=(_.get(k)||0)-b.value;y!==0?_.set(k,y):_.delete(k)}),Array.from(_)};return t.$$set=v=>{"item"in v&&n(0,o=v.item),"comparison"in v&&n(9,i=v.comparison),"isTrader"in v&&n(1,r=v.isTrader),"shift"in v&&n(2,l=v.shift),"percentages"in v&&n(3,a=v.percentages),"showTradeInfo"in v&&n(4,c=v.showTradeInfo),"showLore"in v&&n(5,f=v.showLore)},t.$$.update=()=>{if(t.$$.dirty&1&&n(8,s=o.stats.has(10)?Array.from(o.stats).filter(v=>v[0]!==11):Array.from(o.stats)),t.$$.dirty&517)if(I&&l&&!i){let v=o.getEquipSlot();if(v!==void 0&&I.player.inventory.slots.has(v)){let _=I.player.inventory.slots.get(v);n(6,u=_.type!==void 0?_:void 0),n(7,m=g(_))}}else n(6,u=void 0),n(7,m=void 0)},[o,r,l,a,c,f,u,m,s,i]}var Fd=class extends Ce{constructor(e){super(),Pe(this,e,pD,mD,Be,{item:0,comparison:9,isTrader:1,shift:2,percentages:3,showTradeInfo:4,showLore:5})}},ic=Fd;function dD(t){let e,n;return e=new kl({props:{level:t[2]||1,skill:{...At.get(t[7].id)}}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o[0]&4&&(i.level=s[2]||1),o[0]&128&&(i.skill={...At.get(s[7].id)}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function hD(t){let e,n;return e=new ic({props:{item:t[4]}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o[0]&16&&(i.item=s[4]),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function gD(t){let e,n,s,o,i=[hD,dD],r=[];function l(a,c){return a[4]?0:a[7].id>=0?1:-1}return~(e=l(t,[-1,-1]))&&(n=r[e]=i[e](t)),{c(){n&&n.c(),s=de()},m(a,c){~e&&r[e].m(a,c),w(a,s,c),o=!0},p(a,c){let f=e;e=l(a,c),e===f?~e&&r[e].p(a,c):(n&&(Me(),E(r[f],1,1,()=>{r[f]=null}),Fe()),~e?(n=r[e],n?n.p(a,c):(n=r[e]=i[e](a),n.c()),S(n,1),n.m(s.parentNode,s)):n=null)},i(a){o||(S(n),o=!0)},o(a){E(n),o=!1},d(a){a&&x(s),~e&&r[e].d(a)}}}function vD(t){let e,n;return e=new bl({props:{shift:t[1],describe:t[7].id>=0&&!t[7].item||t[4]!==void 0,descPos:"bottom:100%;left:50%;transform:translateX(-50%);",clickToUse:!0,status:t[11]?-1:t[5]!==void 0?t[5].status:0,id:"sk"+t[7].hotkey,data:t[7].id>=0||t[4]!==void 0?t[7]:void 0,auto:t[9],queued:t[10],meta:t[16],css:t[15],stacks:t[3],cd:t[13],img:t[14],remaining:t[12],key:t[7].hotkey,border:t[10]||t[8]?"auto":t[11]||t[9]||t[6]||t[13]?"grey":t[4]?jt(t[4].quality)[0]:"white",$$slots:{default:[gD]},$$scope:{ctx:t}}}),e.$on("discard",t[25]),e.$on("move",t[26]),e.$on("use",t[17]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o[0]&2&&(i.shift=s[1]),o[0]&144&&(i.describe=s[7].id>=0&&!s[7].item||s[4]!==void 0),o[0]&2080&&(i.status=s[11]?-1:s[5]!==void 0?s[5].status:0),o[0]&128&&(i.id="sk"+s[7].hotkey),o[0]&144&&(i.data=s[7].id>=0||s[4]!==void 0?s[7]:void 0),o[0]&512&&(i.auto=s[9]),o[0]&1024&&(i.queued=s[10]),o[0]&65536&&(i.meta=s[16]),o[0]&32768&&(i.css=s[15]),o[0]&8&&(i.stacks=s[3]),o[0]&8192&&(i.cd=s[13]),o[0]&16384&&(i.img=s[14]),o[0]&4096&&(i.remaining=s[12]),o[0]&128&&(i.key=s[7].hotkey),o[0]&12112&&(i.border=s[10]||s[8]?"auto":s[11]||s[9]||s[6]||s[13]?"grey":s[4]?jt(s[4].quality)[0]:"white"),o[0]&148|o[1]&8&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function _D(t,e,n){let s,o,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F=ae,A=()=>(F(),F=fo(z,le=>n(7,y=le)),z),C,M,V,$,D;ie(t,bm,le=>n(20,C=le)),ie(t,_m,le=>n(21,M=le)),ie(t,Ni,le=>n(22,V=le)),ie(t,ua,le=>n(23,$=le)),ie(t,Oi,le=>n(24,D=le)),t.$$.on_destroy.push(()=>F());let{skill:z}=e;A();let{skillslot:q}=e,{shift:L=!1}=e,O,j,R,U;zc(()=>{if(y.hotkey!==O&&(j!==void 0&&we(),O=y.hotkey,O!==void 0)){U=nt[O],U==null&&(U=nt[O]={});let le=rn(O,U);j=le.onPress(Z),R=le.onRelease(ye)}});let Z=le=>{if(I.player&&y.id>=0){if(y.item){let _e=I.player.inventory.findFirstSlotOfType(y.item.type,y.item.tier);if(_e!==void 0){let Ie=I.player.inventory.slots.get(_e);if(Ie.bound<Ie.logic.bindOnUse){Nt("error","Right-click and use the item in your inventory to bind it before using");return}Xe(z,y.info[0]=_e,y)}else return}let ve=At.get(y.id);ve.envCast>0?dr>0?fu(0,0,0):fu(y.id,ve.range,ve.envCast):Es(Mt.clientPlayerSkill.packData({id:y.id,info:y.info})),le.type==="keydown"&&n(8,u=!0),xt(96)}},ye=()=>{n(8,u=!1)},we=()=>{U&&U.mappings&&(U.mappings=U.mappings.filter(le=>le!=O)),U&&U.press&&(U.press=U.press.filter(le=>le!=j)),U&&U.release&&(U.release=U.release.filter(le=>le!=R)),O=void 0,j=void 0,R=void 0};Tn(we);function he(le){fi.call(this,t,le)}function re(le){fi.call(this,t,le)}return t.$$set=le=>{"skill"in le&&A(n(0,z=le.skill)),"skillslot"in le&&n(18,q=le.skillslot),"shift"in le&&n(1,L=le.shift)},t.$$.update=()=>{t.$$.dirty[0]&262272&&n(16,s={type:"skill",slot:q,skill:y}),t.$$.dirty[0]&128&&n(6,o=y.id<0),t.$$.dirty[0]&128&&n(19,i=y.item),t.$$.dirty[0]&16777408&&n(5,r=o?void 0:D[y.id]),t.$$.dirty[0]&128&&n(15,l=y.item?"slotitem":"slotskill"),t.$$.dirty[0]&8388736&&n(4,a=$&&y.item&&I.player?I.player.inventory.findFirstItemOfType(y.item.type,y.item.tier):void 0),t.$$.dirty[0]&524496&&n(14,c=o?void 0:i?a?Yf(a.type,a.tier,a.logic.class,Qa(a.quality)):Yf(i.type,i.tier,0,0):Xf(y.id)),t.$$.dirty[0]&8912912&&n(3,f=a!==void 0&&a.stacks!==void 0?$[i.type+i.tier]||0:void 0),t.$$.dirty[0]&4194496&&n(2,m=!y.item&&!o&&V.has(y.id)?V.get(y.id):0),t.$$.dirty[0]&32&&n(13,g=r?r.cd:void 0),t.$$.dirty[0]&32&&n(12,v=r?r.remaining:void 0),t.$$.dirty[0]&156&&n(11,_=y.item&&(!a||f===0)||!y.item&&m===0),t.$$.dirty[0]&2097280&&n(10,b=M!==void 0&&M===y.id),t.$$.dirty[0]&1048704&&n(9,k=C!==void 0&&C===y.id)},n(8,u=!1),[z,L,m,f,a,r,o,y,u,k,b,_,v,g,c,l,s,Z,q,i,C,M,V,$,D,he,re]}var Og=class extends Ce{constructor(e){super(),Pe(this,e,_D,vD,Be,{skill:0,skillslot:18,shift:1},null,[-1,-1])}},YM=Og;function XM(t,e,n){let s=t.slice();return s[10]=e[n],s[12]=n,s}function QM(t){let e,n;return e=new YM({props:{skill:t[10],skillslot:t[12],shift:t[0]}}),e.$on("discard",t[3]),e.$on("move",t[2]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&1&&(i.shift=s[0]),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function bD(t){let e,n,s=me(Ss),o=[];for(let r=0;r<s.length;r+=1)o[r]=QM(XM(t,s,r));let i=r=>E(o[r],1,1,()=>{o[r]=null});return{c(){e=h("div");for(let r=0;r<o.length;r+=1)o[r].c();p(e,"id","skillbar"),p(e,"class","panel-black bar svelte-1v6qmvo")},m(r,l){w(r,e,l);for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(e,null);n=!0},p(r,[l]){if(l&13){s=me(Ss);let a;for(a=0;a<s.length;a+=1){let c=XM(r,s,a);o[a]?(o[a].p(c,l),S(o[a],1)):(o[a]=QM(c),o[a].c(),S(o[a],1),o[a].m(e,null))}for(Me(),a=s.length;a<o.length;a+=1)i(a);Fe()}},i(r){if(!n){for(let l=0;l<s.length;l+=1)S(o[l]);n=!0}},o(r){o=o.filter(Boolean);for(let l=0;l<o.length;l+=1)E(o[l]);n=!1},d(r){r&&x(e),st(o,r)}}}function yD(t,e,n){let s,o,i,r;ie(t,In,g=>n(5,s=g)),ie(t,xi,g=>n(6,o=g)),ie(t,el,g=>n(7,i=g));let l=nt.shift.store;ie(t,l,g=>n(0,r=g));let a=I.player.name,c=o[a];c||(c=Xe(xi,o[a]=[],o));for(let g=0;g<i;++g)if(o[a][g]===void 0){let v=jp.get(I.player.class).startSkills[g];o[a].push({id:v!==void 0&&At.get(v).autoSkillbar?v:-1,type:0,info:[]}),g===4||g===5?(Xe(xi,o[a][g].id=100,o),Xe(xi,o[a][g].item={type:"misc",tier:g-4},o)):g===11&&Xe(xi,o[a][11].id=40,o)}for(let g=0;g<i;++g)Ss[g]===void 0&&Ss.push(te({id:-1,type:0,info:[]}));o[a].forEach((g,v)=>{Ss[v]&&(g.hotkey=fe["kbSkillbar"+(v+1)],Ss[v].set(g))}),Ss.forEach((g,v)=>{g.subscribe(_=>{xi.update(b=>(b[a][v]=_,b))})});let f=g=>{let{from:v,to:_}=g.detail;v!==_&&(v.type=="item"?Ss[_.slot].update(b=>(b.id=v.item.logic.useSkill,b.item={type:v.item.type,tier:v.item.tier},b)):v.type=="skill"&&(Ss[_.slot].update(b=>(b.id=v.skill.id,b.item=v.skill.item,b)),v.slot!==void 0&&Ss[v.slot].update(u)))},u=g=>(g.id=-1,g.item=void 0,g);return[r,l,f,g=>{Ss[s.meta.slot].update(u)}]}var Ng=class extends Ce{constructor(e){super(),Pe(this,e,yD,bD,yn,{})}},ZM=Ng;function JM(t){let e,n;return e=new ic({props:{isTrader:t[6],item:t[10],shift:t[8],percentages:t[8]}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&64&&(i.isTrader=s[6]),o&1024&&(i.item=s[10]),o&256&&(i.shift=s[8]),o&256&&(i.percentages=s[8]),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function kD(t){let e,n,s=t[10]&&JM(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,i){o[10]?s?(s.p(o,i),i&1024&&S(s,1)):(s=JM(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function xD(t){let e,n;return e=new bl({props:{describe:t[10]!==void 0,shift:t[8],cd:t[11],id:t[7],hover:t[5],descPos:t[4],descRoot:t[3],pickable:t[1],status:t[9]?-1:0,meta:t[14],img:t[15],border:t[13],stacks:t[12],data:t[10],key:t[2],$$slots:{default:[kD]},$$scope:{ctx:t}}}),e.$on("discard",t[21]),e.$on("use",t[22]),e.$on("click",t[23]),e.$on("context",t[24]),e.$on("move",t[25]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,[o]){let i={};o&1024&&(i.describe=s[10]!==void 0),o&256&&(i.shift=s[8]),o&2048&&(i.cd=s[11]),o&128&&(i.id=s[7]),o&32&&(i.hover=s[5]),o&16&&(i.descPos=s[4]),o&8&&(i.descRoot=s[3]),o&2&&(i.pickable=s[1]),o&512&&(i.status=s[9]?-1:0),o&16384&&(i.meta=s[14]),o&32768&&(i.img=s[15]),o&8192&&(i.border=s[13]),o&4096&&(i.stacks=s[12]),o&1024&&(i.data=s[10]),o&4&&(i.key=s[2]),o&134219072&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function wD(t,e,n){let s,o,i,r,l,a,c,f,u=ae,m=()=>(u(),u=fo(v,U=>n(10,f=U)),v),g;ie(t,Oi,U=>n(20,g=U)),t.$$.on_destroy.push(()=>u());let{item:v}=e;m();let{filter:_=""}=e,{invslot:b}=e,{pickable:k=!0}=e,{text:y}=e,{descRoot:F}=e,{descPos:A}=e,{hover:C}=e,{isTrader:M=!1}=e,{clearOnMove:V=!1}=e,{id:$=""}=e,{shift:D=!1}=e,z=U=>U===!0||f.moving?!0:!(!U||f.type.includes(U)||f.logic.level>U||P.items[f.type][f.type==="book"?f.logic.skillid:f.tier].name.toLowerCase().includes(U));function q(U){fi.call(this,t,U)}function L(U){fi.call(this,t,U)}function O(U){fi.call(this,t,U)}function j(U){fi.call(this,t,U)}function R(U){fi.call(this,t,U)}return t.$$set=U=>{"item"in U&&m(n(0,v=U.item)),"filter"in U&&n(16,_=U.filter),"invslot"in U&&n(17,b=U.invslot),"pickable"in U&&n(1,k=U.pickable),"text"in U&&n(2,y=U.text),"descRoot"in U&&n(3,F=U.descRoot),"descPos"in U&&n(4,A=U.descPos),"hover"in U&&n(5,C=U.hover),"isTrader"in U&&n(6,M=U.isTrader),"clearOnMove"in U&&n(18,V=U.clearOnMove),"id"in U&&n(7,$=U.id),"shift"in U&&n(8,D=U.shift)},t.$$.update=()=>{t.$$.dirty&132096&&n(15,s=f?Yf(f.type,f.tier,f.logic?f.logic.class:0,Qa(f.quality)):b>100?sx(b):void 0),t.$$.dirty&394241&&n(14,o={type:"item",slot:b,item:f,store:V?v:void 0}),t.$$.dirty&66624&&n(9,i=f&&(M?!1:z(_))),t.$$.dirty&1536&&n(13,r=f?jt(f.quality)[0]+(i?" grey":""):"grey"),t.$$.dirty&1024&&n(12,l=f&&(f.upgrade?"+"+f.upgrade:f.stacks)),t.$$.dirty&1049600&&n(19,a=f&&f.logic.useSkill?g[f.logic.useSkill]:void 0),t.$$.dirty&524288&&n(11,c=a?a.cd:void 0)},[v,k,y,F,A,C,M,$,D,i,f,c,l,r,o,s,_,b,V,a,g,q,L,O,j,R]}var jg=class extends Ce{constructor(e){super(),Pe(this,e,wD,xD,Be,{item:0,filter:16,invslot:17,pickable:1,text:2,descRoot:3,descPos:4,hover:5,isTrader:6,clearOnMove:18,id:7,shift:8})}},ws=jg;function KM(t,e,n){let s=t.slice();return s[19]=e[n],s[21]=n,s}function e6(t){let e,n;return e=new $t({props:{zindex:7,title:P.ui.inventory.name,icon:"bag",$$slots:{default:[MD]},$$scope:{ctx:t}}}),e.$on("close",t[14]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&4194555&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function t6(t){let e,n;return e=new ws({props:{id:"bag"+t[21],item:t[19],invslot:t[21],filter:t[0].toLowerCase(),shift:t[4]||t[5]}}),e.$on("use",t[12]),e.$on("context",t[11]),e.$on("move",t[10]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&2&&(i.item=s[19]),o&1&&(i.filter=s[0].toLowerCase()),o&48&&(i.shift=s[4]||s[5]),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function MD(t){let e,n,s,o,i,r,l,a,c,f,u=me(t[1].filter(n6)),m=[];for(let v=0;v<u.length;v+=1)m[v]=t6(KM(t,u,v));let g=v=>E(m[v],1,1,()=>{m[v]=null});return i=new xn({props:{amount:t[6]}}),l=new gr({props:{amount:t[7]}}),{c(){e=h("input"),s=h("div");for(let v=0;v<m.length;v+=1)m[v].c();o=h("div"),J(i.$$.fragment),r=h("a"),J(l.$$.fragment),p(e,"class","filter svelte-ha50yv"),p(e,"type","text"),p(e,"placeholder",n=P.ui.filter),p(s,"class","slotcontainer svelte-ha50yv"),Le(s,"grid-template-columns","repeat("+t[3]+", auto)"),p(o,"class","panel-black gold svelte-ha50yv"),p(r,"class","panel-black gold svelte-ha50yv"),Le(r,"margin-right","3px"),p(r,"target","_blank"),p(r,"href","/store")},m(v,_){w(v,e,_),je(e,t[0]),w(v,s,_);for(let b=0;b<m.length;b+=1)m[b]&&m[b].m(s,null);w(v,o,_),X(i,o,null),w(v,r,_),X(l,r,null),a=!0,c||(f=H(e,"input",t[13]),c=!0)},p(v,_){if(_&1&&e.value!==v[0]&&je(e,v[0]),_&7219){u=me(v[1].filter(n6));let y;for(y=0;y<u.length;y+=1){let F=KM(v,u,y);m[y]?(m[y].p(F,_),S(m[y],1)):(m[y]=t6(F),m[y].c(),S(m[y],1),m[y].m(s,null))}for(Me(),y=u.length;y<m.length;y+=1)g(y);Fe()}(!a||_&8)&&Le(s,"grid-template-columns","repeat("+v[3]+", auto)");let b={};_&64&&(b.amount=v[6]),i.$set(b);let k={};_&128&&(k.amount=v[7]),l.$set(k)},i(v){if(!a){for(let _=0;_<u.length;_+=1)S(m[_]);S(i.$$.fragment,v),S(l.$$.fragment,v),a=!0}},o(v){m=m.filter(Boolean);for(let _=0;_<m.length;_+=1)E(m[_]);E(i.$$.fragment,v),E(l.$$.fragment,v),a=!1},d(v){v&&(x(e),x(s),x(o),x(r)),st(m,v),Q(i),Q(l),c=!1,f()}}}function FD(t){let e,n,s=t[2]&&e6(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[2]?s?(s.p(o,i),i&4&&S(s,1)):(s=e6(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}var n6=(t,e)=>e<101;function CD(t,e,n){let s,o,i,r,l,a,c,f,u,m,g;ie(t,Zs,M=>n(15,s=M)),ie(t,po,M=>n(16,o=M)),ie(t,Rs,M=>n(17,i=M)),ie(t,In,M=>n(18,r=M)),ie(t,fa,M=>n(1,l=M)),ie(t,gi,M=>n(2,a=M)),ie(t,Xr,M=>n(3,c=M)),ie(t,Qs,M=>n(6,m=M)),ie(t,Ui,M=>n(7,g=M));let v="",_=nt.shift.store;ie(t,_,M=>n(4,f=M));let b=nt.ctrl.store;ie(t,b,M=>n(5,u=M));let k=M=>{let{from:V,to:$}=M.detail;if(V!==$&&V.type=="item"&&V.slot!==void 0&&$.slot!==void 0&&V.slot!==$.slot){if(yt("itemmove",`${V.slot} ${$.slot}`),V.slot>=101)return;V.item.stacks&&(V.item.stacks=""),V.item.moving=!0,$.item?($.item.stacks&&($.item.stacks=""),l[V.slot].set($.item),$.item.moving=!0):l[V.slot]&&l[V.slot].set(void 0),l[$.slot].set(V.item)}},y=M=>{if(!M.detail.item||r)return;let V=[];if(i&&V.push(Wt.itemstash(M.detail.slot)),M.detail.item.canEquip(I.player)){let $=M.detail.item.getBestEquipslot(I.player.inventory);$!==void 0&&V.push(Wt.itemmove(M.detail.slot,$)),M.detail.item.logic.useSkill&&V.push(Wt.itemuse(M.detail.slot,M.detail.item.logic.useSkill,M.detail.item.bound,M.detail.item.logic.bindOnUse))}s&&M.detail.item.canBeSold()&&V.push(Wt.itemsell(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier)),M.detail.item.stacks>1&&(V.push(Wt.itemsplithalf(M.detail.slot)),V.push(Wt.itemsplitone(M.detail.slot))),V.push(Wt.itemcopyid(M.detail.item.dbid)),V.push({name:"Link in chat",fun:$=>qs.update(D=>D+`>${M.detail.item.dbid}`)}),M.detail.item.canBeDropped()&&V.push(Wt.itemdrop(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier)),dn.set({x:M.detail.e.pageX-M.detail.e.layerX,y:M.detail.e.pageY+(46-M.detail.e.layerY),xFlip:46,yFlip:46,opts:V})},F=M=>{M.detail.item&&(i?yt("itemstash",`${M.detail.slot}`):o?(ho.set(M.detail.item),M.detail.item.type&&xt($s[M.detail.item.type].sound)):s&&M.detail.item.canBeSold()?Jf(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier):M.detail.item.canBeDropped()&&Hh(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier))};function A(){v=this.value,n(0,v)}return[v,l,a,c,f,u,m,g,_,b,k,y,F,A,M=>Xe(gi,a=!1,a)]}var Wg=class extends Ce{constructor(e){super(),Pe(this,e,CD,FD,Be,{})}},s6=Wg;var Hg={};Kn(Hg,{add:()=>Cd,init:()=>o6,onWorldEnter:()=>SD,tick:()=>PD,values:()=>io});var io=new Map,Gg=new kt(0,.5),o6=()=>{io.clear(),Gg.reset(0)},SD=o6,PD=t=>{if(fe.dpsmeterOpen&&Gg.done(I.time))if(Gg.reset(I.time),io.forEach((e,n)=>{if(e.ooc){I.time-e.start>5&&io.delete(n);return}!I.entity(e.id)||I.time-e.last>5?(e.ooc=!0,e.start=I.time):e.dps=Math.ceil(e.amount/Math.max(5,I.time-e.start))}),fe.dpsmeterTarget){let e=io.get(fe.dpsmeterTarget);e?Yc.set(Array.from(e.skills).sort((n,s)=>s[1].amount-n[1].amount).map(n=>(n[1].dps=Math.ceil(n[1].amount/Math.max(5,I.time-n[1].start)),n)).slice(0,10)):Jr.set(0)}else Yc.set(Array.from(io).sort((e,n)=>n[1].amount-e[1].amount).slice(0,10))},Cd=(t,e,n)=>{if(t.name===void 0||!fe.dpsmeterOpen||t.type!==0||fe.dpsmeterParty&&(I.player.party===0&&t!==I.player||t.party!==I.player.party))return;let s;io.has(t.name)?s=io.get(t.name):(io.set(t.name,s={}),s.amount=0,s.start=0,s.class=t.class,s.dps=0,s.id=t.id,s.ooc=!0,s.skills=new Map),s.ooc?(s.start=I.time,s.ooc=!1,s.amount=e):s.amount+=e;let o=P.items.book[n]?P.items.book[n].name:"Unknown";s.skills.has(o)||s.skills.set(o,{id:n,class:t.class,amount:0,start:I.time});let i=s.skills.get(o);i.amount+=e,s.last=I.time};function i6(t,e,n){let s=t.slice();return s[11]=e[n],s[13]=n,s}function r6(t){let e,n;return e=new $t({props:{origin:"right bottom",title:t[5][t[1]],icon:"trophy",$$slots:{default:[AD]},$$scope:{ctx:t}}}),e.$on("close",t[10]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&2&&(i.title=s[5][s[1]]),o&16414&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function l6(t,e){let n,s,o,i,r;s=new ks({props:{size:"0.9em",fract:Math.round(100*e[11][1].amount/e[2][0][1].amount),barcol:"bgc"+e[11][1].class,left:`${e[13]+1}. ${e[11][0]}`,right:`${rs(e[11][1].amount)} (${dt(e[11][1].dps)})`}});function l(...a){return e[7](e[11],...a)}return{key:t,first:null,c(){n=h("div"),J(s.$$.fragment),this.first=n},m(a,c){w(a,n,c),X(s,n,null),o=!0,i||(r=H(n,"click",l),i=!0)},p(a,c){e=a;let f={};c&4&&(f.fract=Math.round(100*e[11][1].amount/e[2][0][1].amount)),c&4&&(f.barcol="bgc"+e[11][1].class),c&4&&(f.left=`${e[13]+1}. ${e[11][0]}`),c&4&&(f.right=`${rs(e[11][1].amount)} (${dt(e[11][1].dps)})`),s.$set(f)},i(a){o||(S(s.$$.fragment,a),o=!0)},o(a){E(s.$$.fragment,a),o=!1},d(a){a&&x(n),Q(s),i=!1,r()}}}function AD(t){let e,n=[],s=new Map,o,i,r=t[5][t[1]]+"",l,a,c,f,u,m,g,v,_=me(t[2]),b=k=>k[11][1].id;for(let k=0;k<_.length;k+=1){let y=i6(t,_,k),F=b(y);s.set(F,n[k]=l6(F,y))}return{c(){e=h("div");for(let k=0;k<n.length;k+=1)n[k].c();o=h("div"),i=h("div"),l=T(r),a=h("div"),c=T("Party"),u=h("div"),u.textContent=`${P.ui.reset}`,p(e,"class","wrapper svelte-hjyujf"),p(i,"class","btn grey"),p(a,"class",f="btn "+(t[4]?"grey active":"black textgrey")),p(u,"class","btn grey"),p(o,"class","grid buttons marg-top svelte-hjyujf"),Le(o,"grid-template-columns","2fr 1fr 1fr")},m(k,y){w(k,e,y);for(let F=0;F<n.length;F+=1)n[F]&&n[F].m(e,null);w(k,o,y),d(o,i),d(i,l),d(o,a),d(a,c),d(o,u),m=!0,g||(v=[H(i,"click",t[6]),H(a,"click",t[8]),H(u,"click",t[9])],g=!0)},p(k,y){y&12&&(_=me(k[2]),Me(),n=En(n,y,b,1,k,_,s,e,Hn,l6,null,i6),Fe()),(!m||y&2)&&r!==(r=k[5][k[1]]+"")&&G(l,r),(!m||y&16&&f!==(f="btn "+(k[4]?"grey active":"black textgrey")))&&p(a,"class",f)},i(k){if(!m){for(let y=0;y<_.length;y+=1)S(n[y]);m=!0}},o(k){for(let y=0;y<n.length;y+=1)E(n[y]);m=!1},d(k){k&&(x(e),x(o));for(let y=0;y<n.length;y+=1)n[y].d();g=!1,rt(v)}}}function TD(t){let e,n,s=t[0]&&r6(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[0]?s?(s.p(o,i),i&1&&S(s,1)):(s=r6(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function ED(t,e,n){let s,o,i,r,l;ie(t,Zr,v=>n(0,s=v)),ie(t,mf,v=>n(1,o=v)),ie(t,Yc,v=>n(2,i=v)),ie(t,Jr,v=>n(3,r=v)),ie(t,uf,v=>n(4,l=v));let a=[P.ui.stats.misc.damage,P.ui.stats.misc.healing];return[s,o,i,r,l,a,v=>{dn.set({x:v.pageX,y:v.pageY-50,opts:a.map((_,b)=>({name:_,fun:()=>{mf.set(b),io.clear()}}))})},(v,_)=>{Xe(Jr,r=r?0:v[0],r)},v=>Xe(uf,l=!l,l),v=>io.clear(),v=>Xe(Zr,s=!1,s)]}var Yg=class extends Ce{constructor(e){super(),Pe(this,e,ED,TD,Be,{})}},a6=Yg;function c6(t){let e,n=t[0].area+"",s,o,i,r;return{c(){e=h("p"),s=T(n),i=Ne(),p(e,"class","text location textgreen svelte-dujqu3")},m(l,a){w(l,e,a),d(e,s),w(l,i,a),r=!0},p(l,a){(!r||a&1)&&n!==(n=l[0].area+"")&&G(s,n)},i(l){r||(l&&bn(()=>{r&&(o||(o=E1(e,Sm,{},!0)),o.run(1))}),r=!0)},o(l){l&&(o||(o=E1(e,Sm,{},!1)),o.run(0)),r=!1},d(l){l&&(x(e),x(i)),l&&o&&o.end()}}}function f6(t){let e,n=t[0].error+"",s,o,i;return{c(){e=h("p"),s=T(n),p(e,"class","text error textred svelte-dujqu3")},m(r,l){w(r,e,l),d(e,s),i=!0},p(r,l){(!i||l&1)&&n!==(n=r[0].error+"")&&G(s,n)},i(r){i||(o&&o.end(1),i=!0)},o(r){r&&(o=x_(e,Sm,{})),i=!1},d(r){r&&x(e),r&&o&&o.end()}}}function ID(t){let e,n,s=t[0].area&&c6(t),o=t[0].error&&f6(t);return{c(){e=h("div"),s&&s.c(),n=de(),o&&o.c(),p(e,"class","l-ui")},m(i,r){w(i,e,r),s&&s.m(e,null),d(e,n),o&&o.m(e,null)},p(i,[r]){i[0].area?s?(s.p(i,r),r&1&&S(s,1)):(s=c6(i),s.c(),S(s,1),s.m(e,n)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe()),i[0].error?o?(o.p(i,r),r&1&&S(o,1)):(o=f6(i),o.c(),S(o,1),o.m(e,null)):o&&(Me(),E(o,1,1,()=>{o=null}),Fe())},i(i){S(s),S(o)},o(i){E(s),E(o)},d(i){i&&x(e),s&&s.d(),o&&o.d()}}}function DD(t,e,n){let s={},o={};return Dr.subscribe(i=>{n(0,s[i.type]=i.text,s),o[i.type]&&clearTimeout(o[i.type]),o[i.type]=setTimeout(()=>{n(0,s[i.type]=void 0,s)},i.time||1e3)}),[s]}var Xg=class extends Ce{constructor(e){super(),Pe(this,e,DD,ID,Be,{})}},u6=Xg;function m6(t,e,n){let s=t.slice();return s[3]=e[n],s}function p6(t){let e,n;return e=new $t({props:{origin:"center",zindex:10,title:P.ui.headers.request,close:!1,$$slots:{default:[VD]},$$scope:{ctx:t}}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&65&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function d6(t){let e,n=t[3].text+"",s,o,i=(t[3].unavailable||"")+"",r,l,a=(t[3].additional||"")+"",c,f,u,m;function g(){return t[2](t[3])}return{c(){e=h("div"),s=T(n),o=Ne(),r=T(i),l=Ne(),c=T(a),p(e,"class",f="choice "+(t[3].unavailable?"unavailable textgrey":"")+" svelte-1uywqr8")},m(v,_){w(v,e,_),d(e,s),d(e,o),d(e,r),d(e,l),d(e,c),u||(m=H(e,"click",g),u=!0)},p(v,_){t=v,_&1&&n!==(n=t[3].text+"")&&G(s,n),_&1&&i!==(i=(t[3].unavailable||"")+"")&&G(r,i),_&1&&a!==(a=(t[3].additional||"")+"")&&G(c,a),_&1&&f!==(f="choice "+(t[3].unavailable?"unavailable textgrey":"")+" svelte-1uywqr8")&&p(e,"class",f)},d(v){v&&x(e),u=!1,m()}}}function VD(t){let e,n,s=t[0][0].title+"",o,i,r=t[0][0].text+"",l=me(t[0][0].choices),a=[];for(let c=0;c<l.length;c+=1)a[c]=d6(m6(t,l,c));return{c(){e=h("div"),n=h("h3"),o=T(s),i=h("p");for(let c=0;c<a.length;c+=1)a[c].c();p(n,"class","textprimary"),p(e,"class","container svelte-1uywqr8")},m(c,f){w(c,e,f),d(e,n),d(n,o),d(e,i),i.innerHTML=r;for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(e,null)},p(c,f){if(f&1&&s!==(s=c[0][0].title+"")&&G(o,s),f&1&&r!==(r=c[0][0].text+"")&&(i.innerHTML=r),f&3){l=me(c[0][0].choices);let u;for(u=0;u<l.length;u+=1){let m=m6(c,l,u);a[u]?a[u].p(m,f):(a[u]=d6(m),a[u].c(),a[u].m(e,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=l.length}},d(c){c&&x(e),st(a,c)}}}function LD(t){let e,n,s=t[0].length&&p6(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[0].length?s?(s.p(o,i),i&1&&S(s,1)):(s=p6(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function qD(t,e,n){let s;ie(t,ui,r=>n(0,s=r));let o=async r=>{r&&await r(),uh()};return[s,o,r=>{o(r.fun)}]}var Qg=class extends Ce{constructor(e){super(),Pe(this,e,qD,LD,Be,{})}},h6=Qg;function g6(t){let e,n,s=t[0][0].text+"",o,i,r=t[0][0].icon&&v6(t);return{c(){e=h("div"),r&&r.c(),n=h("div"),p(e,"class","notification panel-black border grey svelte-9nlpzp")},m(l,a){w(l,e,a),r&&r.m(e,null),d(e,n),n.innerHTML=s,o||(i=H(e,"click",t[2]),o=!0)},p(l,a){l[0][0].icon?r?r.p(l,a):(r=v6(l),r.c(),r.m(e,n)):r&&(r.d(1),r=null),a&1&&s!==(s=l[0][0].text+"")&&(n.innerHTML=s)},d(l){l&&x(e),r&&r.d(),o=!1,i()}}}function v6(t){let e,n,s;return{c(){e=h("img"),p(e,"class",n="icon "+t[0][0].css+" svelte-9nlpzp"),at(e.src,s="/data/ui/"+t[0][0].icon)||p(e,"src",s)},m(o,i){w(o,e,i)},p(o,i){i&1&&n!==(n="icon "+o[0][0].css+" svelte-9nlpzp")&&p(e,"class",n),i&1&&!at(e.src,s="/data/ui/"+o[0][0].icon)&&p(e,"src",s)},d(o){o&&x(e)}}}function RD(t){let e,n=t[0].length&&!t[1]&&g6(t);return{c(){n&&n.c(),e=de()},m(s,o){n&&n.m(s,o),w(s,e,o)},p(s,[o]){s[0].length&&!s[1]?n?n.p(s,o):(n=g6(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(s){s&&x(e),n&&n.d(s)}}}function zD(t,e,n){let s,o;return ie(t,Uc,r=>n(0,s=r)),ie(t,Cs,r=>n(1,o=r)),[s,o,()=>{Uc.update(r=>(r.shift(),r))}]}var Zg=class extends Ce{constructor(e){super(),Pe(this,e,zD,RD,Be,{})}},_6=Zg;function b6(t,e,n){let s=t.slice();return s[5]=e[n],s}function y6(t){let e,n;return{c(){e=h("div"),n=T(t[0]),p(e,"class","btn border grey")},m(s,o){w(s,e,o),d(e,n)},p(s,o){o&1&&G(n,s[0])},d(s){s&&x(e)}}}function k6(t){let e,n,s,o,i,r;function l(...c){return t[2](t[5],...c)}function a(...c){return t[4](t[5],...c)}return{c(){e=h("div"),n=h("img"),p(n,"class","svgicon"),at(n.src,s="/data/ui/icons/"+t[5].img+".svg?v=8685122")||p(n,"src",s),p(e,"id",o="sys"+t[5].img),p(e,"class","btn border black")},m(c,f){w(c,e,f),d(e,n),i||(r=[H(e,"mouseenter",l),H(e,"mouseleave",t[3]),H(e,"click",a)],i=!0)},p(c,f){t=c},d(c){c&&x(e),i=!1,rt(r)}}}function BD(t){let e,n,s=t[0]!==""&&y6(t),o=me(t[1]),i=[];for(let r=0;r<o.length;r+=1)i[r]=k6(b6(t,o,r));return{c(){e=h("div"),s&&s.c(),n=de();for(let r=0;r<i.length;r+=1)i[r].c();p(e,"class","btnbar svelte-133q4bd")},m(r,l){w(r,e,l),s&&s.m(e,null),d(e,n);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(e,null)},p(r,[l]){if(r[0]!==""?s?s.p(r,l):(s=y6(r),s.c(),s.m(e,n)):s&&(s.d(1),s=null),l&3){o=me(r[1]);let a;for(a=0;a<o.length;a+=1){let c=b6(r,o,a);i[a]?i[a].p(c,l):(i[a]=k6(c),i[a].c(),i[a].m(e,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=o.length}},i:ae,o:ae,d(r){r&&x(e),s&&s.d(),st(i,r)}}}function $D(t,e,n){let s=[{img:"gem",desc:P.ui.elixir.subscription,store:zs},{img:"char",desc:P.ui.headers.character,store:ki},{img:"book",desc:P.ui.headers.skills,store:vi},{img:"bag",desc:P.ui.inventory.name,store:gi},{img:"pvp",desc:P.ui.headers.pvp,store:yi},{img:"clan",desc:P.ui.clan.heading,store:_i},{img:"trophy",desc:P.ui.headers.dpsMeter,store:Zr},{img:"social",desc:"Social",store:bi},{img:"cog",desc:P.ui.settings.name,store:Qr},{img:"fullscreen",desc:P.ui.headers.fullscreen,fun:async()=>{"keyboard"in navigator&&"lock"in navigator.keyboard&&await navigator.keyboard.lock(["Escape"]),document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}},{img:"back",desc:P.ui.headers.menuReturn,fun:()=>{document.location.href="/"}}],o="";return[o,s,(a,c)=>n(0,o=a.desc),a=>n(0,o=""),(a,c)=>{a.fun?a.fun():a.store.update(f=>!f)}]}var Jg=class extends Ce{constructor(e){super(),Pe(this,e,$D,BD,Be,{})}},x6=Jg;function UD(t){let e,n,s,o;return{c(){e=h("div"),p(e,"class",n="btn checkbox "+(t[2]?"active":""))},m(i,r){w(i,e,r),s||(o=H(e,"click",t[3]),s=!0)},p(i,[r]){r&4&&n!==(n="btn checkbox "+(i[2]?"active":""))&&p(e,"class",n)},i:ae,o:ae,d(i){i&&x(e),s=!1,o()}}}function OD(t,e,n){let s,o=ae,i=()=>(o(),o=fo(r,c=>n(2,s=c)),r);t.$$.on_destroy.push(()=>o());let{store:r}=e;i();let{cb:l}=e,a=c=>{Xe(r,s=!s,s),l&&l(s)};return t.$$set=c=>{"store"in c&&i(n(0,r=c.store)),"cb"in c&&n(1,l=c.cb)},[r,l,s,a]}var Kg=class extends Ce{constructor(e){super(),Pe(this,e,OD,UD,Be,{store:0,cb:1})}},St=Kg;function w6(t,e,n){let s=t.slice();return s[71]=e[n],s}function M6(t,e,n){let s=t.slice();return s[68]=e[n],s[69]=e,s[70]=n,s}function F6(t,e,n){let s=t.slice();return s[74]=e[n],s}function C6(t){let e,n;return e=new $t({props:{zindex:9,title:P.ui.settings.name,origin:"center",icon:"cog",$$slots:{default:[YD]},$$scope:{ctx:t}}}),e.$on("close",t[66]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o[0]&2147483626|o[2]&32768&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function S6(t){let e,n=t[74].name+"",s,o,i,r;function l(...a){return t[35](t[74],...a)}return{c(){e=h("div"),s=T(n),p(e,"class",o="choice "+(t[74]==t[1]?"active":""))},m(a,c){w(a,e,c),d(e,s),i||(r=H(e,"click",l),i=!0)},p(a,c){t=a,c[0]&2&&o!==(o="choice "+(t[74]==t[1]?"active":""))&&p(e,"class",o)},d(a){a&&x(e),i=!1,r()}}}function ND(t){let e,n,s,o,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A,C;return n=new St({props:{store:ip}}),l=new St({props:{store:fp}}),c=new St({props:{store:up}}),u=new St({props:{store:hp}}),v=new St({props:{store:mp}}),b=new St({props:{store:pp}}),y=new St({props:{store:dp}}),A=new St({props:{store:gp}}),{c(){e=h("div"),e.textContent=`${P.ui.settings.chatbubbles}`,J(n.$$.fragment),s=h("div"),s.textContent=`${P.ui.settings.combatlog}`,o=h("div"),i=Ne(),r=h("div"),r.textContent="Exp Gain",J(l.$$.fragment),a=h("div"),a.textContent="Fame Loss / Gain",J(c.$$.fragment),f=h("div"),f.textContent="Gold Pick Up",J(u.$$.fragment),m=Ne(),g=h("div"),g.textContent="Item Pick Up",J(v.$$.fragment),_=h("div"),_.textContent="Item Party Roll",J(b.$$.fragment),k=h("div"),k.textContent="Item Party Pick Up",J(y.$$.fragment),F=h("div"),F.textContent="Friend Online Status",J(A.$$.fragment),p(s,"class","textprimary")},m(M,V){w(M,e,V),X(n,M,V),w(M,s,V),w(M,o,V),w(M,i,V),w(M,r,V),X(l,M,V),w(M,a,V),X(c,M,V),w(M,f,V),X(u,M,V),w(M,m,V),w(M,g,V),X(v,M,V),w(M,_,V),X(b,M,V),w(M,k,V),X(y,M,V),w(M,F,V),X(A,M,V),C=!0},p:ae,i(M){C||(S(n.$$.fragment,M),S(l.$$.fragment,M),S(c.$$.fragment,M),S(u.$$.fragment,M),S(v.$$.fragment,M),S(b.$$.fragment,M),S(y.$$.fragment,M),S(A.$$.fragment,M),C=!0)},o(M){E(n.$$.fragment,M),E(l.$$.fragment,M),E(c.$$.fragment,M),E(u.$$.fragment,M),E(v.$$.fragment,M),E(b.$$.fragment,M),E(y.$$.fragment,M),E(A.$$.fragment,M),C=!1},d(M){M&&(x(e),x(s),x(o),x(i),x(r),x(a),x(f),x(m),x(g),x(_),x(k),x(F)),Q(n,M),Q(l,M),Q(c,M),Q(u,M),Q(v,M),Q(b,M),Q(y,M),Q(A,M)}}}function jD(t){let e,n=P.ui.settings.language+"",s,o,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A,C,M,V,$,D,z,q,L,O,j,R,U,Z,ye,we,he,re,le,ve,_e,Ie,oe,Ee,K,Re=P.ui.settings.qualitymin+"",Ge,Qe,Ye,pe,ce,Oe,se,ee=P.ui.settings.excludedrops+"",N,ue,We,ze,Ae,$e,Ue,mt,wt,Je,Et,xe,Ke,bt,Ct,Ve,be,Vt=P.ui.settings.skillcdtext+"",Ht,Lt,Rt,He,et,Te,it,Ze,ft,wn=P.ui.settings.flashinterval+"",Io,fs,Ls,pt=t[22].toFixed(1)+"",zt,Do,Wn,us,Sc=P.ui.settings.flashduration+"",Tr,Ri,Vo,pn=t[23].toFixed(1)+"",Ut,tn,ms,Nu,Lo,ju,qo,Wu,zl,Pc,p1,Gu,Bl,Hu,$l,Yu,Ul,Xu,Ro,Ac,d1,Qu,Ol,Zu,Nl,Tc,h1,jl,pT=P.ui.settings.protectedquality+"",Q2,Z2,Ec,g1,J2,zo,Wl,dT=P.ui.settings.invwidth+"",K2,e_,Ju,v1,Bo,Ic,_1,Gl,hT=P.ui.settings.stashwidth+"",t_,n_,Ku,b1,$o,Hl,gT=P.ui.settings.stashheight+"",s_,o_,em,y1,Uo,Dc,k1,tm,Yl,co,x1,i_,Xl=me(t[32]),ps=[];for(let ne=0;ne<Xl.length;ne+=1)ps[ne]=P6(w6(t,Xl,ne));return k=new St({props:{store:wa}}),V=new St({props:{store:Hm}}),D=new St({props:{store:Qm}}),q=new St({props:{store:Ym}}),O=new St({props:{store:Zm}}),R=new St({props:{store:Xm}}),Z=new St({props:{store:Jm}}),we=new St({props:{store:ep}}),re=new St({props:{store:np}}),ve=new St({props:{store:Km}}),Ee=new St({props:{store:cp}}),mt=new St({props:{store:lp}}),Je=new St({props:{store:rp}}),xe=new St({props:{store:ap}}),bt=new St({props:{store:tp}}),He=new St({props:{store:vp,cb:t[33]}}),Te=new St({props:{store:_p}}),Ze=new St({props:{store:xp}}),zl=new St({props:{store:bp}}),Bl=new St({props:{store:kp}}),$l=new St({props:{store:yp}}),Ul=new St({props:{store:Ma}}),Ol=new St({props:{store:sp}}),Nl=new St({props:{store:op}}),Yl=new St({props:{store:xa}}),{c(){e=h("div"),s=T(n),o=Ne(),i=h("br"),r=h("small"),r.textContent=`${P.ui.settings.reload}`,l=h("select");for(let ne=0;ne<ps.length;ne+=1)ps[ne].c();a=h("div"),a.textContent=`${P.ui.settings.tutorial}`,c=h("div"),f=h("div"),f.textContent=`${P.ui.reset}`,u=h("div"),u.textContent=`${P.ui.settings.resettutorial}`,m=h("div"),m.textContent=`${P.ui.disable}`,g=h("div"),g.textContent=`${P.ui.settings.disabletutorial}`,v=h("div"),v.textContent=`${P.ui.settings.fpsping}`,_=h("div"),b=h("div"),b.textContent=`${P.ui.settings.showfps}`,J(k.$$.fragment),y=h("div"),y.textContent=`${P.ui.settings.nameplates}`,F=h("div"),A=h("div"),A.textContent=`${P.ui.settings.drawrange}`,C=h("input"),M=h("div"),M.textContent=`${P.ui.settings.monsterbars}`,J(V.$$.fragment),$=h("div"),$.textContent=`${P.ui.settings.monsternames}`,J(D.$$.fragment),z=h("div"),z.textContent=`${P.ui.settings.friendlyplayerbars}`,J(q.$$.fragment),L=h("div"),L.textContent=`${P.ui.settings.friendlyplayernames}`,J(O.$$.fragment),j=h("div"),j.textContent=`${P.ui.settings.enemyplayerbars}`,J(R.$$.fragment),U=h("div"),U.textContent=`${P.ui.settings.enemyplayernames}`,J(Z.$$.fragment),ye=h("div"),ye.textContent=`${P.ui.settings.showlevel}`,J(we.$$.fragment),he=h("div"),he.textContent=`${P.ui.settings.classcolors}`,J(re.$$.fragment),le=h("div"),le.textContent=`${P.ui.settings.transparency}`,J(ve.$$.fragment),_e=h("div"),_e.textContent=`${P.ui.settings.drops}`,Ie=h("div"),oe=h("div"),oe.textContent=`${P.ui.settings.showquality}`,J(Ee.$$.fragment),K=h("div"),Ge=T(Re),Qe=h("br"),Ye=h("small"),pe=T(t[20]),ce=T("%"),Oe=h("input"),se=h("div"),N=T(ee),ue=h("br"),We=h("small"),We.textContent=`${P.ui.settings.reload}`,ze=h("input"),Ae=h("div"),Ae.textContent=`${P.ui.settings.damagehealing}`,$e=h("div"),Ue=h("div"),Ue.textContent=`${P.ui.settings.incomingdamage}`,J(mt.$$.fragment),wt=h("div"),wt.textContent=`${P.ui.settings.incominghealing}`,J(Je.$$.fragment),Et=h("div"),Et.textContent=`${P.ui.settings.incomingmana}`,J(xe.$$.fragment),Ke=h("div"),Ke.textContent=`${P.ui.settings.preventoverlap}`,J(bt.$$.fragment),Ct=h("div"),Ct.textContent=`${P.ui.settings.icons}`,Ve=h("div"),be=h("div"),Ht=T(Vt),Lt=h("br"),Rt=h("small"),Rt.textContent=`${P.ui.settings.reload}`,J(He.$$.fragment),et=h("div"),et.textContent=`${P.ui.settings.buffcdtext}`,J(Te.$$.fragment),it=h("div"),it.textContent=`${P.ui.settings.selfbuffsonly}`,J(Ze.$$.fragment),ft=h("div"),Io=T(wn),fs=h("br"),Ls=h("small"),zt=T(pt),Do=T("s"),Wn=h("input"),us=h("div"),Tr=T(Sc),Ri=h("br"),Vo=h("small"),Ut=T(pn),tn=T("s"),ms=h("input"),Nu=h("div"),Nu.textContent=`${P.ui.settings.buffmax}`,Lo=h("input"),ju=h("div"),ju.textContent=`${P.ui.settings.buffmaxparty}`,qo=h("input"),Wu=h("div"),Wu.textContent=`${P.ui.settings.updateratelimit}`,J(zl.$$.fragment),Pc=h("div"),Pc.textContent="Party",p1=h("div"),Gu=h("div"),Gu.textContent="Leave party if empty",J(Bl.$$.fragment),Hu=h("div"),Hu.textContent=`${P.ui.settings.showselfparty}`,J($l.$$.fragment),Yu=h("div"),Yu.textContent=`${P.ui.settings.partymana}`,J(Ul.$$.fragment),Xu=h("div"),Xu.textContent=`${P.ui.settings.partyframewidth}`,Ro=h("input"),Ac=h("div"),Ac.textContent=`${P.ui.settings.map}`,d1=h("div"),Qu=h("div"),Qu.textContent=`${P.ui.settings.mapshowmonsters}`,J(Ol.$$.fragment),Zu=h("div"),Zu.textContent=`${P.ui.settings.maplowqual}`,J(Nl.$$.fragment),Tc=h("div"),Tc.textContent=`${P.ui.inventory.name}`,h1=h("div"),jl=h("div"),Q2=T(pT),Z2=h("br"),Ec=h("small"),g1=T(t[27]),J2=T("%"),zo=h("input"),Wl=h("div"),K2=T(dT),e_=h("br"),Ju=h("small"),v1=T(t[28]),Bo=h("input"),Ic=h("div"),Ic.textContent=`${P.ui.stash.name}`,_1=h("div"),Gl=h("div"),t_=T(hT),n_=h("br"),Ku=h("small"),b1=T(t[29]),$o=h("input"),Hl=h("div"),s_=T(gT),o_=h("br"),em=h("small"),y1=T(t[30]),Uo=h("input"),Dc=h("div"),Dc.textContent="Social",k1=h("div"),tm=h("div"),tm.textContent="Twitch Streams",J(Yl.$$.fragment),p(r,"class","textgrey"),t[18]===void 0&&bn(()=>t[51].call(l)),p(a,"class","textprimary"),p(u,"class","btn blue"),p(g,"class","btn orange"),p(v,"class","textprimary"),p(y,"class","textprimary"),p(C,"type","range"),p(_e,"class","textprimary"),p(Ye,"class","textgrey"),p(Oe,"type","range"),p(Oe,"min","0"),p(Oe,"max","100"),p(We,"class","textgrey"),p(ze,"type","text"),p(ze,"placeholder","misc, gold, ..."),p(Ae,"class","textprimary"),p(Ct,"class","textprimary"),p(Rt,"class","textgrey"),p(Ls,"class","textgrey"),p(Wn,"type","range"),p(Wn,"min","0"),p(Wn,"max","1"),p(Wn,"step","0.1"),p(Vo,"class","textgrey"),p(ms,"type","range"),p(ms,"min","0"),p(ms,"max","5"),p(ms,"step","0.1"),p(Lo,"placeholder","14"),p(Lo,"type","number"),p(Lo,"min","0"),p(qo,"placeholder","8"),p(qo,"type","number"),p(qo,"min","0"),p(Pc,"class","textprimary"),p(Ro,"type","range"),p(Ro,"min","50"),p(Ro,"max","400"),p(Ac,"class","textprimary"),p(Tc,"class","textprimary"),p(Ec,"class","textgrey"),p(zo,"type","range"),p(zo,"min","0"),p(zo,"max","110"),p(Ju,"class","textgrey"),p(Bo,"type","range"),p(Bo,"min","4"),p(Bo,"max","10"),p(Ic,"class","textprimary"),p(Ku,"class","textgrey"),p($o,"type","range"),p($o,"min","7"),p($o,"max","20"),p(em,"class","textgrey"),p(Uo,"type","range"),p(Uo,"min","50"),p(Uo,"max","500"),p(Dc,"class","textprimary")},m(ne,De){w(ne,e,De),d(e,s),d(e,o),d(e,i),d(e,r),w(ne,l,De);for(let Gn=0;Gn<ps.length;Gn+=1)ps[Gn]&&ps[Gn].m(l,null);Mn(l,t[18],!0),w(ne,a,De),w(ne,c,De),w(ne,f,De),w(ne,u,De),w(ne,m,De),w(ne,g,De),w(ne,v,De),w(ne,_,De),w(ne,b,De),X(k,ne,De),w(ne,y,De),w(ne,F,De),w(ne,A,De),w(ne,C,De),je(C,t[19]),w(ne,M,De),X(V,ne,De),w(ne,$,De),X(D,ne,De),w(ne,z,De),X(q,ne,De),w(ne,L,De),X(O,ne,De),w(ne,j,De),X(R,ne,De),w(ne,U,De),X(Z,ne,De),w(ne,ye,De),X(we,ne,De),w(ne,he,De),X(re,ne,De),w(ne,le,De),X(ve,ne,De),w(ne,_e,De),w(ne,Ie,De),w(ne,oe,De),X(Ee,ne,De),w(ne,K,De),d(K,Ge),d(K,Qe),d(K,Ye),d(Ye,pe),d(Ye,ce),w(ne,Oe,De),je(Oe,t[20]),w(ne,se,De),d(se,N),d(se,ue),d(se,We),w(ne,ze,De),je(ze,t[21]),w(ne,Ae,De),w(ne,$e,De),w(ne,Ue,De),X(mt,ne,De),w(ne,wt,De),X(Je,ne,De),w(ne,Et,De),X(xe,ne,De),w(ne,Ke,De),X(bt,ne,De),w(ne,Ct,De),w(ne,Ve,De),w(ne,be,De),d(be,Ht),d(be,Lt),d(be,Rt),X(He,ne,De),w(ne,et,De),X(Te,ne,De),w(ne,it,De),X(Ze,ne,De),w(ne,ft,De),d(ft,Io),d(ft,fs),d(ft,Ls),d(Ls,zt),d(Ls,Do),w(ne,Wn,De),je(Wn,t[22]),w(ne,us,De),d(us,Tr),d(us,Ri),d(us,Vo),d(Vo,Ut),d(Vo,tn),w(ne,ms,De),je(ms,t[23]),w(ne,Nu,De),w(ne,Lo,De),je(Lo,t[24]),w(ne,ju,De),w(ne,qo,De),je(qo,t[25]),w(ne,Wu,De),X(zl,ne,De),w(ne,Pc,De),w(ne,p1,De),w(ne,Gu,De),X(Bl,ne,De),w(ne,Hu,De),X($l,ne,De),w(ne,Yu,De),X(Ul,ne,De),w(ne,Xu,De),w(ne,Ro,De),je(Ro,t[26]),w(ne,Ac,De),w(ne,d1,De),w(ne,Qu,De),X(Ol,ne,De),w(ne,Zu,De),X(Nl,ne,De),w(ne,Tc,De),w(ne,h1,De),w(ne,jl,De),d(jl,Q2),d(jl,Z2),d(jl,Ec),d(Ec,g1),d(Ec,J2),w(ne,zo,De),je(zo,t[27]),w(ne,Wl,De),d(Wl,K2),d(Wl,e_),d(Wl,Ju),d(Ju,v1),w(ne,Bo,De),je(Bo,t[28]),w(ne,Ic,De),w(ne,_1,De),w(ne,Gl,De),d(Gl,t_),d(Gl,n_),d(Gl,Ku),d(Ku,b1),w(ne,$o,De),je($o,t[29]),w(ne,Hl,De),d(Hl,s_),d(Hl,o_),d(Hl,em),d(em,y1),w(ne,Uo,De),je(Uo,t[30]),w(ne,Dc,De),w(ne,k1,De),w(ne,tm,De),X(Yl,ne,De),co=!0,x1||(i_=[H(l,"change",t[51]),H(l,"change",t[33]),H(u,"click",t[52]),H(g,"click",t[53]),H(C,"change",t[54]),H(C,"input",t[54]),H(Oe,"change",t[55]),H(Oe,"input",t[55]),H(Oe,"change",t[33]),H(ze,"input",t[56]),H(ze,"change",t[33]),H(Wn,"change",t[57]),H(Wn,"input",t[57]),H(ms,"change",t[58]),H(ms,"input",t[58]),H(Lo,"input",t[59]),H(qo,"input",t[60]),H(Ro,"change",t[61]),H(Ro,"input",t[61]),H(zo,"change",t[62]),H(zo,"input",t[62]),H(Bo,"change",t[63]),H(Bo,"input",t[63]),H($o,"change",t[64]),H($o,"input",t[64]),H(Uo,"change",t[65]),H(Uo,"input",t[65])],x1=!0)},p(ne,De){if(De[1]&2){Xl=me(ne[32]);let Gn;for(Gn=0;Gn<Xl.length;Gn+=1){let r_=w6(ne,Xl,Gn);ps[Gn]?ps[Gn].p(r_,De):(ps[Gn]=P6(r_),ps[Gn].c(),ps[Gn].m(l,null))}for(;Gn<ps.length;Gn+=1)ps[Gn].d(1);ps.length=Xl.length}De[0]&262144|De[1]&2&&Mn(l,ne[18]),De[0]&524288&&je(C,ne[19]),(!co||De[0]&1048576)&&G(pe,ne[20]),De[0]&1048576&&je(Oe,ne[20]),De[0]&2097152&&ze.value!==ne[21]&&je(ze,ne[21]),(!co||De[0]&4194304)&&pt!==(pt=ne[22].toFixed(1)+"")&&G(zt,pt),De[0]&4194304&&je(Wn,ne[22]),(!co||De[0]&8388608)&&pn!==(pn=ne[23].toFixed(1)+"")&&G(Ut,pn),De[0]&8388608&&je(ms,ne[23]),De[0]&16777216&&Gt(Lo.value)!==ne[24]&&je(Lo,ne[24]),De[0]&33554432&&Gt(qo.value)!==ne[25]&&je(qo,ne[25]),De[0]&67108864&&je(Ro,ne[26]),(!co||De[0]&134217728)&&G(g1,ne[27]),De[0]&134217728&&je(zo,ne[27]),(!co||De[0]&268435456)&&G(v1,ne[28]),De[0]&268435456&&je(Bo,ne[28]),(!co||De[0]&536870912)&&G(b1,ne[29]),De[0]&536870912&&je($o,ne[29]),(!co||De[0]&1073741824)&&G(y1,ne[30]),De[0]&1073741824&&je(Uo,ne[30])},i(ne){co||(S(k.$$.fragment,ne),S(V.$$.fragment,ne),S(D.$$.fragment,ne),S(q.$$.fragment,ne),S(O.$$.fragment,ne),S(R.$$.fragment,ne),S(Z.$$.fragment,ne),S(we.$$.fragment,ne),S(re.$$.fragment,ne),S(ve.$$.fragment,ne),S(Ee.$$.fragment,ne),S(mt.$$.fragment,ne),S(Je.$$.fragment,ne),S(xe.$$.fragment,ne),S(bt.$$.fragment,ne),S(He.$$.fragment,ne),S(Te.$$.fragment,ne),S(Ze.$$.fragment,ne),S(zl.$$.fragment,ne),S(Bl.$$.fragment,ne),S($l.$$.fragment,ne),S(Ul.$$.fragment,ne),S(Ol.$$.fragment,ne),S(Nl.$$.fragment,ne),S(Yl.$$.fragment,ne),co=!0)},o(ne){E(k.$$.fragment,ne),E(V.$$.fragment,ne),E(D.$$.fragment,ne),E(q.$$.fragment,ne),E(O.$$.fragment,ne),E(R.$$.fragment,ne),E(Z.$$.fragment,ne),E(we.$$.fragment,ne),E(re.$$.fragment,ne),E(ve.$$.fragment,ne),E(Ee.$$.fragment,ne),E(mt.$$.fragment,ne),E(Je.$$.fragment,ne),E(xe.$$.fragment,ne),E(bt.$$.fragment,ne),E(He.$$.fragment,ne),E(Te.$$.fragment,ne),E(Ze.$$.fragment,ne),E(zl.$$.fragment,ne),E(Bl.$$.fragment,ne),E($l.$$.fragment,ne),E(Ul.$$.fragment,ne),E(Ol.$$.fragment,ne),E(Nl.$$.fragment,ne),E(Yl.$$.fragment,ne),co=!1},d(ne){ne&&(x(e),x(l),x(a),x(c),x(f),x(u),x(m),x(g),x(v),x(_),x(b),x(y),x(F),x(A),x(C),x(M),x($),x(z),x(L),x(j),x(U),x(ye),x(he),x(le),x(_e),x(Ie),x(oe),x(K),x(Oe),x(se),x(ze),x(Ae),x($e),x(Ue),x(wt),x(Et),x(Ke),x(Ct),x(Ve),x(be),x(et),x(it),x(ft),x(Wn),x(us),x(ms),x(Nu),x(Lo),x(ju),x(qo),x(Wu),x(Pc),x(p1),x(Gu),x(Hu),x(Yu),x(Xu),x(Ro),x(Ac),x(d1),x(Qu),x(Zu),x(Tc),x(h1),x(jl),x(zo),x(Wl),x(Bo),x(Ic),x(_1),x(Gl),x($o),x(Hl),x(Uo),x(Dc),x(k1),x(tm)),st(ps,ne),Q(k,ne),Q(V,ne),Q(D,ne),Q(q,ne),Q(O,ne),Q(R,ne),Q(Z,ne),Q(we,ne),Q(re,ne),Q(ve,ne),Q(Ee,ne),Q(mt,ne),Q(Je,ne),Q(xe,ne),Q(bt,ne),Q(He,ne),Q(Te,ne),Q(Ze,ne),Q(zl,ne),Q(Bl,ne),Q($l,ne),Q(Ul,ne),Q(Ol,ne),Q(Nl,ne),Q(Yl,ne),x1=!1,rt(i_)}}}function WD(t){let e,n,s,o=P.ui.settings.sfxmultiplier+"",i,r,l,a,c,f,u,m,g,v;return{c(){e=h("div"),e.textContent=`${P.ui.settings.sfxvolume}`,n=h("input"),s=h("div"),i=T(o),r=h("br"),l=h("small"),l.textContent=`${P.ui.settings.multiplierdesc}`,a=h("input"),c=h("div"),c.textContent=`${P.ui.settings.musicvolume}`,f=h("input"),u=h("div"),u.textContent=`${P.ui.settings.ambiencevolume}`,m=h("input"),p(n,"type","range"),p(l,"class","textgrey"),p(a,"type","range"),p(f,"type","range"),p(m,"type","range")},m(_,b){w(_,e,b),w(_,n,b),je(n,t[14]),w(_,s,b),d(s,i),d(s,r),d(s,l),w(_,a,b),je(a,t[15]),w(_,c,b),w(_,f,b),je(f,t[16]),w(_,u,b),w(_,m,b),je(m,t[17]),g||(v=[H(n,"change",t[47]),H(n,"input",t[47]),H(a,"change",t[48]),H(a,"input",t[48]),H(f,"change",t[49]),H(f,"input",t[49]),H(m,"change",t[50]),H(m,"input",t[50])],g=!0)},p(_,b){b[0]&16384&&je(n,_[14]),b[0]&32768&&je(a,_[15]),b[0]&65536&&je(f,_[16]),b[0]&131072&&je(m,_[17])},i:ae,o:ae,d(_){_&&(x(e),x(n),x(s),x(a),x(c),x(f),x(u),x(m)),g=!1,rt(v)}}}function GD(t){let e,n,s,o=P.ui.settings.mousesensitivity+"",i,r,l,a=t[11].toFixed(2)+"",c,f,u,m,g,v,_,b,k,y,F,A,C,M=P.ui.settings.skillbarslots+"",V,$,D,z,q,L,O,j,R,U,Z,ye,we,he,re,le,ve,_e,Ie,oe,Ee,K,Re,Ge;m=new St({props:{store:wp}}),v=new St({props:{store:Mp}}),b=new St({props:{store:Fp}}),y=new St({props:{store:Cp}}),Z=new St({props:{store:Sp}});let Qe=me(t[3]),Ye=[];for(let pe=0;pe<Qe.length;pe+=1)Ye[pe]=A6(M6(t,Qe,pe));return{c(){e=h("div"),e.textContent=`${P.ui.settings.camera}`,n=h("div"),s=h("div"),i=T(o),r=Ne(),l=h("span"),c=T(a),f=h("input"),u=h("div"),u.textContent=`${P.ui.settings.invertmousex}`,J(m.$$.fragment),g=h("div"),g.textContent=`${P.ui.settings.invertmousey}`,J(v.$$.fragment),_=h("div"),_.textContent=`${P.ui.settings.lockedcamera}`,J(b.$$.fragment),k=h("div"),k.textContent=`${P.ui.settings.pointerlock}`,J(y.$$.fragment),F=h("div"),F.textContent=`${P.ui.settings.skillbar}`,A=h("div"),C=h("div"),V=T(M),$=Ne(),D=h("span"),z=T(t[12]),q=h("br"),L=h("small"),L.textContent=`${P.ui.settings.reload}`,O=h("input"),j=h("div"),j.textContent="Targeting",R=h("div"),U=h("div"),U.textContent="Target Next Friendly: Allow Non-Partied",J(Z.$$.fragment),ye=h("div"),we=T("Target Next Friendly: Cycle Size "),he=h("span"),re=T(t[13]),le=h("input"),ve=h("div"),ve.textContent=`${P.ui.settings.keybindings}`,_e=h("div"),Ie=h("small"),Ie.textContent=`${P.ui.settings.reload}`,oe=h("small"),oe.textContent=`${P.ui.settings.bindingreset}`;for(let pe=0;pe<Ye.length;pe+=1)Ye[pe].c();Ee=de(),p(e,"class","textprimary"),p(l,"class","textgrey"),p(f,"type","range"),p(f,"step","0.05"),p(f,"min","0.1"),p(f,"max","3"),p(F,"class","textprimary"),p(D,"class","textgrey"),p(L,"class","textgrey"),p(O,"type","range"),p(O,"min","10"),p(O,"max","24"),p(j,"class","textprimary"),p(he,"class","textgrey"),p(le,"type","range"),p(le,"min","1"),p(le,"max","10"),p(ve,"class","textprimary"),p(Ie,"class","textgrey"),p(oe,"class","textprimary")},m(pe,ce){w(pe,e,ce),w(pe,n,ce),w(pe,s,ce),d(s,i),d(s,r),d(s,l),d(l,c),w(pe,f,ce),je(f,t[11]),w(pe,u,ce),X(m,pe,ce),w(pe,g,ce),X(v,pe,ce),w(pe,_,ce),X(b,pe,ce),w(pe,k,ce),X(y,pe,ce),w(pe,F,ce),w(pe,A,ce),w(pe,C,ce),d(C,V),d(C,$),d(C,D),d(D,z),d(C,q),d(C,L),w(pe,O,ce),je(O,t[12]),w(pe,j,ce),w(pe,R,ce),w(pe,U,ce),X(Z,pe,ce),w(pe,ye,ce),d(ye,we),d(ye,he),d(he,re),w(pe,le,ce),je(le,t[13]),w(pe,ve,ce),w(pe,_e,ce),w(pe,Ie,ce),w(pe,oe,ce);for(let Oe=0;Oe<Ye.length;Oe+=1)Ye[Oe]&&Ye[Oe].m(pe,ce);w(pe,Ee,ce),K=!0,Re||(Ge=[H(f,"change",t[42]),H(f,"input",t[42]),H(O,"change",t[43]),H(O,"input",t[43]),H(O,"change",t[33]),H(le,"change",t[44]),H(le,"input",t[44])],Re=!0)},p(pe,ce){if((!K||ce[0]&2048)&&a!==(a=pe[11].toFixed(2)+"")&&G(c,a),ce[0]&2048&&je(f,pe[11]),(!K||ce[0]&4096)&&G(z,pe[12]),ce[0]&4096&&je(O,pe[12]),(!K||ce[0]&8192)&&G(re,pe[13]),ce[0]&8192&&je(le,pe[13]),ce[0]&8|ce[1]&8){Qe=me(pe[3]);let Oe;for(Oe=0;Oe<Qe.length;Oe+=1){let se=M6(pe,Qe,Oe);Ye[Oe]?Ye[Oe].p(se,ce):(Ye[Oe]=A6(se),Ye[Oe].c(),Ye[Oe].m(Ee.parentNode,Ee))}for(;Oe<Ye.length;Oe+=1)Ye[Oe].d(1);Ye.length=Qe.length}},i(pe){K||(S(m.$$.fragment,pe),S(v.$$.fragment,pe),S(b.$$.fragment,pe),S(y.$$.fragment,pe),S(Z.$$.fragment,pe),K=!0)},o(pe){E(m.$$.fragment,pe),E(v.$$.fragment,pe),E(b.$$.fragment,pe),E(y.$$.fragment,pe),E(Z.$$.fragment,pe),K=!1},d(pe){pe&&(x(e),x(n),x(s),x(f),x(u),x(g),x(_),x(k),x(F),x(A),x(C),x(O),x(j),x(R),x(U),x(ye),x(le),x(ve),x(_e),x(Ie),x(oe),x(Ee)),Q(m,pe),Q(v,pe),Q(b,pe),Q(y,pe),Q(Z,pe),st(Ye,pe),Re=!1,rt(Ge)}}}function HD(t){let e,n,s,o,i,r=P.ui.settings.fov+"",l,a,c,f,u,m,g=P.ui.settings.anisotropy+"",v,_,b,k,y,F=P.ui.settings.grass+"",A,C,M,V,$,D,z,q,L,O=P.ui.settings.disableoffscreen+"",j,R,U,Z,ye,we,he,re,le,ve,_e,Ie=P.ui.settings.shadows+"",oe,Ee,K,Re,Ge,Qe=P.ui.settings.shadowresolution+"",Ye,pe,ce,Oe,se,ee,N;return D=new St({props:{store:$m}}),q=new St({props:{store:Nm}}),Z=new St({props:{store:Um}}),we=new St({props:{store:jm}}),re=new St({props:{cb:t[33],store:Wm}}),Re=new St({props:{cb:t[33],store:Om}}),{c(){e=h("div"),e.textContent=`${P.ui.settings.resolution}`,n=h("input"),s=h("div"),s.textContent=`${P.ui.settings.viewrange}`,o=h("input"),i=h("div"),l=T(r),a=Ne(),c=h("span"),f=T(t[7]),u=h("input"),m=h("div"),v=T(g),_=h("br"),b=h("small"),b.textContent=`${P.ui.settings.reload}`,k=h("input"),y=h("div"),A=T(F),C=h("br"),M=h("small"),M.textContent=`${P.ui.settings.reload}`,V=h("input"),$=h("div"),$.textContent=`${P.ui.settings.fxaa}`,J(D.$$.fragment),z=h("div"),z.textContent=`${P.ui.settings.bloom}`,J(q.$$.fragment),L=h("div"),j=T(O),R=h("br"),U=h("small"),U.textContent=`${P.ui.settings.offscreendesc}`,J(Z.$$.fragment),ye=h("div"),ye.textContent=`${P.ui.settings.particles}`,J(we.$$.fragment),he=h("div"),he.textContent=`${P.ui.settings.fogpattern}`,J(re.$$.fragment),le=h("div"),le.textContent=`${P.ui.settings.shadows}`,ve=h("div"),_e=h("div"),oe=T(Ie),Ee=h("br"),K=h("small"),K.textContent=`${P.ui.settings.reload}`,J(Re.$$.fragment),Ge=h("div"),Ye=T(Qe),pe=h("br"),ce=h("small"),ce.textContent=`${P.ui.settings.reload}`,Oe=h("input"),p(n,"type","range"),p(n,"min","30"),p(n,"step","10"),p(o,"type","range"),p(o,"min","30"),p(c,"class","textgrey"),p(u,"type","range"),p(u,"min","50"),p(u,"max","100"),p(b,"class","textgrey"),p(k,"type","range"),p(k,"min","0"),p(k,"max","4"),p(M,"class","textgrey"),p(V,"type","range"),p(V,"min","0"),p(V,"max","100"),p(U,"class","textgrey"),p(le,"class","textprimary"),p(K,"class","textgrey"),p(ce,"class","textgrey"),p(Oe,"type","range"),p(Oe,"min","0"),p(Oe,"max","3")},m(ue,We){w(ue,e,We),w(ue,n,We),je(n,t[5]),w(ue,s,We),w(ue,o,We),je(o,t[6]),w(ue,i,We),d(i,l),d(i,a),d(i,c),d(c,f),w(ue,u,We),je(u,t[7]),w(ue,m,We),d(m,v),d(m,_),d(m,b),w(ue,k,We),je(k,t[8]),w(ue,y,We),d(y,A),d(y,C),d(y,M),w(ue,V,We),je(V,t[9]),w(ue,$,We),X(D,ue,We),w(ue,z,We),X(q,ue,We),w(ue,L,We),d(L,j),d(L,R),d(L,U),X(Z,ue,We),w(ue,ye,We),X(we,ue,We),w(ue,he,We),X(re,ue,We),w(ue,le,We),w(ue,ve,We),w(ue,_e,We),d(_e,oe),d(_e,Ee),d(_e,K),X(Re,ue,We),w(ue,Ge,We),d(Ge,Ye),d(Ge,pe),d(Ge,ce),w(ue,Oe,We),je(Oe,t[10]),se=!0,ee||(N=[H(n,"change",t[36]),H(n,"input",t[36]),H(o,"change",t[37]),H(o,"input",t[37]),H(u,"change",t[38]),H(u,"input",t[38]),H(k,"change",t[39]),H(k,"input",t[39]),H(k,"change",t[33]),H(V,"change",t[40]),H(V,"input",t[40]),H(V,"change",t[33]),H(Oe,"change",t[41]),H(Oe,"input",t[41]),H(Oe,"change",t[33])],ee=!0)},p(ue,We){We[0]&32&&je(n,ue[5]),We[0]&64&&je(o,ue[6]),(!se||We[0]&128)&&G(f,ue[7]),We[0]&128&&je(u,ue[7]),We[0]&256&&je(k,ue[8]),We[0]&512&&je(V,ue[9]),We[0]&1024&&je(Oe,ue[10])},i(ue){se||(S(D.$$.fragment,ue),S(q.$$.fragment,ue),S(Z.$$.fragment,ue),S(we.$$.fragment,ue),S(re.$$.fragment,ue),S(Re.$$.fragment,ue),se=!0)},o(ue){E(D.$$.fragment,ue),E(q.$$.fragment,ue),E(Z.$$.fragment,ue),E(we.$$.fragment,ue),E(re.$$.fragment,ue),E(Re.$$.fragment,ue),se=!1},d(ue){ue&&(x(e),x(n),x(s),x(o),x(i),x(u),x(m),x(k),x(y),x(V),x($),x(z),x(L),x(ye),x(he),x(le),x(ve),x(_e),x(Ge),x(Oe)),Q(D,ue),Q(q,ue),Q(Z,ue),Q(we,ue),Q(re,ue),Q(Re,ue),ee=!1,rt(N)}}}function P6(t){let e,n=t[71].name+"",s,o;return{c(){e=h("option"),s=T(n),e.__value=o=t[71].val,je(e,e.__value)},m(i,r){w(i,e,r),d(e,s)},p:ae,d(i){i&&x(e)}}}function A6(t){let e,n=t[68].name+"",s,o,i,r;function l(){t[45].call(o,t[68])}function a(...c){return t[46](t[68],...c)}return{c(){e=h("div"),s=T(n),o=h("input"),p(o,"type","text")},m(c,f){w(c,e,f),d(e,s),w(c,o,f),je(o,t[0].current[t[68].kb]),i||(r=[H(o,"input",l),H(o,"change",a)],i=!0)},p(c,f){t=c,f[0]&8&&n!==(n=t[68].name+"")&&G(s,n),f[0]&8&&o.value!==t[0].current[t[68].kb]&&je(o,t[0].current[t[68].kb])},d(c){c&&(x(e),x(o)),i=!1,rt(r)}}}function YD(t){let e,n,s,o,i=t[1].name+"",r,l,a,c,f,u=me(t[31]),m=[];for(let b=0;b<u.length;b+=1)m[b]=S6(F6(t,u,b));let g=[HD,GD,WD,jD,ND],v=[];function _(b,k){return b[1].id=="gfx"?0:b[1].id=="controls"?1:b[1].id=="audio"?2:b[1].id=="ui"?3:b[1].id=="chat"?4:-1}return~(a=_(t,[-1,-1,-1]))&&(c=v[a]=g[a](t)),{c(){e=h("div"),n=h("div");for(let b=0;b<m.length;b+=1)m[b].c();s=h("div"),o=h("h3"),r=T(i),l=h("div"),c&&c.c(),p(o,"class","textprimary"),p(l,"class","settings svelte-13nnce4"),p(s,"class","menu panel-black scrollbar svelte-13nnce4"),p(e,"class","divide svelte-13nnce4")},m(b,k){w(b,e,k),d(e,n);for(let y=0;y<m.length;y+=1)m[y]&&m[y].m(n,null);d(e,s),d(s,o),d(o,r),d(s,l),~a&&v[a].m(l,null),f=!0},p(b,k){if(k[0]&2|k[1]&1){u=me(b[31]);let F;for(F=0;F<u.length;F+=1){let A=F6(b,u,F);m[F]?m[F].p(A,k):(m[F]=S6(A),m[F].c(),m[F].m(n,null))}for(;F<m.length;F+=1)m[F].d(1);m.length=u.length}(!f||k[0]&2)&&i!==(i=b[1].name+"")&&G(r,i);let y=a;a=_(b,k),a===y?~a&&v[a].p(b,k):(c&&(Me(),E(v[y],1,1,()=>{v[y]=null}),Fe()),~a?(c=v[a],c?c.p(b,k):(c=v[a]=g[a](b),c.c()),S(c,1),c.m(l,null)):c=null)},i(b){f||(S(c),f=!0)},o(b){E(c),f=!1},d(b){b&&x(e),st(m,b),~a&&v[a].d()}}}function XD(t){let e,n,s=t[4]&&C6(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,i){o[4]?s?(s.p(o,i),i[0]&16&&S(s,1)):(s=C6(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function QD(t,e,n){let s,o,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A,C,M,V,$,D,z,q,L,O;ie(t,Qr,be=>n(4,s=be)),ie(t,Wr,be=>n(5,o=be)),ie(t,Nr,be=>n(6,i=be)),ie(t,jr,be=>n(7,r=be)),ie(t,of,be=>n(8,l=be)),ie(t,nf,be=>n(9,a=be)),ie(t,sf,be=>n(10,c=be)),ie(t,Mf,be=>n(11,f=be)),ie(t,el,be=>n(12,u=be)),ie(t,Ff,be=>n(13,m=be)),ie(t,Gr,be=>n(14,g=be)),ie(t,Hr,be=>n(15,v=be)),ie(t,lf,be=>n(16,_=be)),ie(t,rf,be=>n(17,b=be)),ie(t,Yr,be=>n(18,k=be)),ie(t,pf,be=>n(19,y=be)),ie(t,gf,be=>n(20,F=be)),ie(t,hf,be=>n(21,A=be)),ie(t,bf,be=>n(22,C=be)),ie(t,yf,be=>n(23,M=be)),ie(t,kf,be=>n(24,V=be)),ie(t,xf,be=>n(25,$=be)),ie(t,Kr,be=>n(26,D=be)),ie(t,vf,be=>n(27,z=be)),ie(t,Xr,be=>n(28,q=be)),ie(t,Xi,be=>n(29,L=be)),ie(t,Qi,be=>n(30,O=be));let j=[{id:"ui",name:P.ui.settings.interface},{id:"gfx",name:P.ui.settings.graphics},{id:"controls",name:P.ui.settings.controls},{id:"chat",name:P.ui.settings.chat},{id:"audio",name:P.ui.settings.audio}],R=j[0],U=[{val:"en",name:"English"},{val:"de",name:"German"},{val:"ru",name:"Russian"},{val:"zh",name:"Chinese"},{val:"pt",name:"Portugese"},{val:"es",name:"Spanish"},{val:"fr",name:"French"},{val:"ro",name:"Romanian"},{val:"it",name:"Italian"},{val:"nl",name:"Dutch"},{val:"vi",name:"Vietnamese"},{val:"hu",name:"Hungarian"},{val:"ro",name:"Romanian"},{val:"cs",name:"Czech"},{val:"pl",name:"Polish"}],Z=!1,ye=()=>{n(2,Z=!0)},we=(be,Vt)=>{Vt.set(be===""?void 0:be),n(2,Z=!0)},he=["Forward","Left","Back","Right","TurnLeft","TurnRight","Map","Skills","Character","Inventory","Clan","Pvp","Party","Social","NextTarget","NextParty","Untarget"],re=["Forward","Left","Back","Right","Turn Left","Turn Right","Map","Skills","Character","Inventory","Clan","Pvp","Party","Social","Target Next Enemy","Target Next Friendly","Untarget"];for(let be=1;be<25;++be)he.push("Skillbar"+be);he=he.map((be,Vt)=>({name:re[Vt]||be,kb:"kb"+be,setting:Zo["kb"+be]}));let le=(be,Vt)=>{n(1,R=be)};function ve(){o=Gt(this.value),Wr.set(o)}function _e(){i=Gt(this.value),Nr.set(i)}function Ie(){r=Gt(this.value),jr.set(r)}function oe(){l=Gt(this.value),of.set(l)}function Ee(){a=Gt(this.value),nf.set(a)}function K(){c=Gt(this.value),sf.set(c)}function Re(){f=Gt(this.value),Mf.set(f)}function Ge(){u=Gt(this.value),el.set(u)}function Qe(){m=Gt(this.value),Ff.set(m)}function Ye(be){fe[be.kb]=this.value,n(0,Zo)}let pe=(be,Vt)=>{we(fe[be.kb],be.setting)};function ce(){g=Gt(this.value),Gr.set(g)}function Oe(){v=Gt(this.value),Hr.set(v)}function se(){_=Gt(this.value),lf.set(_)}function ee(){b=Gt(this.value),rf.set(b)}function N(){k=Fs(this),Yr.set(k),n(32,U)}let ue=be=>wi.set(0),We=be=>wi.set(ys.length);function ze(){y=Gt(this.value),pf.set(y)}function Ae(){F=Gt(this.value),gf.set(F)}function $e(){A=this.value,hf.set(A)}function Ue(){C=Gt(this.value),bf.set(C)}function mt(){M=Gt(this.value),yf.set(M)}function wt(){V=Gt(this.value),kf.set(V)}function Je(){$=Gt(this.value),xf.set($)}function Et(){D=Gt(this.value),Kr.set(D)}function xe(){z=Gt(this.value),vf.set(z)}function Ke(){q=Gt(this.value),Xr.set(q)}function bt(){L=Gt(this.value),Xi.set(L)}function Ct(){O=Gt(this.value),Qi.set(O)}return[Zo,R,Z,he,s,o,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A,C,M,V,$,D,z,q,L,O,j,U,ye,we,le,ve,_e,Ie,oe,Ee,K,Re,Ge,Qe,Ye,pe,ce,Oe,se,ee,N,ue,We,ze,Ae,$e,Ue,mt,wt,Je,Et,xe,Ke,bt,Ct,()=>{Xe(Qr,s=!1,s),Z&&window.location.reload()}]}var ev=class extends Ce{constructor(e){super(),Pe(this,e,QD,XD,Be,{},null,[-1,-1,-1])}},T6=ev;function E6(t,e,n){let s=t.slice();return s[39]=e[n],s}function I6(t,e,n){let s=t.slice();return s[39]=e[n],s}function D6(t,e,n){let s=t.slice();return s[44]=e[n],s[46]=n,s}function V6(t,e,n){let s=t.slice();return s[47]=e[n],s}function L6(t){let e,n;return e=new $t({props:{origin:"center",title:P.ui.headers.skills,settings:[{name:"Preset Manager",fun:t[31]}],icon:"book",$$slots:{default:[fV]},$$scope:{ctx:t}}}),e.$on("close",t[32]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o[0]&4096&&(i.settings=[{name:"Preset Manager",fun:s[31]}]),o[0]&6143|o[1]&524288&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function q6(t){let e,n;function s(r,l){return r[6]===void 0?JD:ZD}let o=s(t,[-1,-1]),i=o(t);return{c(){e=h("div"),i.c(),p(e,"class",n="panel-black "+(t[6]===void 0?"bar-top-config":"bar-top-save")+" svelte-1e0alkc")},m(r,l){w(r,e,l),i.m(e,null)},p(r,l){o===(o=s(r,l))&&i?i.p(r,l):(i.d(1),i=o(r),i&&(i.c(),i.m(e,null))),l[0]&64&&n!==(n="panel-black "+(r[6]===void 0?"bar-top-config":"bar-top-save")+" svelte-1e0alkc")&&p(e,"class",n)},d(r){r&&x(e),i.d()}}}function ZD(t){let e,n,s,o,i,r,l;return{c(){e=h("div"),n=h("input"),s=h("div"),s.textContent="Save",o=h("div"),o.textContent="Cancel",i=h("div"),p(n,"placeholder","Enter Preset Name"),p(n,"maxlength","25"),p(s,"class","btn green"),p(o,"class","btn orange")},m(a,c){w(a,e,c),w(a,n,c),je(n,t[6]),w(a,s,c),w(a,o,c),w(a,i,c),r||(l=[H(n,"input",t[25]),H(s,"click",t[15]),H(o,"click",t[26])],r=!0)},p(a,c){c[0]&64&&n.value!==a[6]&&je(n,a[6])},d(a){a&&(x(e),x(n),x(s),x(o),x(i)),r=!1,rt(l)}}}function JD(t){let e,n,s,o,i,r,l,a,c,f,u,m,g=me(t[10].filter(t[21])),v=[];for(let b=0;b<g.length;b+=1)v[b]=R6(V6(t,g,b));let _=t[7]===void 0&&z6(t);return{c(){e=h("span"),e.textContent="Preset:",n=h("select");for(let b=0;b<v.length;b+=1)v[b].c();s=de(),_&&_.c(),i=h("div"),r=T("Save"),a=h("div"),c=T("Delete"),p(e,"class","btn textprimary"),p(n,"class",o="btn grey "+(t[10].filter(t[22]).length===0?"disabled":"")),t[7]===void 0&&bn(()=>t[23].call(n)),p(i,"class",l="btn grey "+(t[5]?"":"disabled")),p(a,"class",f="btn grey "+(t[7]!==void 0?"":"disabled"))},m(b,k){w(b,e,k),w(b,n,k);for(let y=0;y<v.length;y+=1)v[y]&&v[y].m(n,null);d(n,s),_&&_.m(n,null),Mn(n,t[7],!0),w(b,i,k),d(i,r),w(b,a,k),d(a,c),u||(m=[H(n,"change",t[23]),H(n,"change",t[16]),H(i,"click",t[24]),H(a,"click",t[17])],u=!0)},p(b,k){if(k[0]&1024){g=me(b[10].filter(b[21]));let y;for(y=0;y<g.length;y+=1){let F=V6(b,g,y);v[y]?v[y].p(F,k):(v[y]=R6(F),v[y].c(),v[y].m(n,s))}for(;y<v.length;y+=1)v[y].d(1);v.length=g.length}b[7]===void 0?_?_.p(b,k):(_=z6(b),_.c(),_.m(n,null)):_&&(_.d(1),_=null),k[0]&1024&&o!==(o="btn grey "+(b[10].filter(b[22]).length===0?"disabled":""))&&p(n,"class",o),k[0]&1152&&Mn(n,b[7]),k[0]&32&&l!==(l="btn grey "+(b[5]?"":"disabled"))&&p(i,"class",l),k[0]&1152&&f!==(f="btn grey "+(b[7]!==void 0?"":"disabled"))&&p(a,"class",f)},d(b){b&&(x(e),x(n),x(i),x(a)),st(v,b),_&&_.d(),u=!1,rt(m)}}}function R6(t){let e,n=t[47].name+"",s,o;return{c(){e=h("option"),s=T(n),e.__value=o=t[47].name,je(e,e.__value)},m(i,r){w(i,e,r),d(e,s)},p(i,r){r[0]&1024&&n!==(n=i[47].name+"")&&G(s,n),r[0]&1024&&o!==(o=i[47].name)&&(e.__value=o,je(e,e.__value))},d(i){i&&x(e)}}}function z6(t){let e,n;return{c(){e=h("option"),n=T("No Preset"),e.disabled=!0,e.selected=!0,e.__value=void 0,je(e,e.__value)},m(s,o){w(s,e,o),d(e,n)},p:ae,d(s){s&&x(e)}}}function KD(t){let e,n;return e=new kl({props:{level:Math.max(1,t[39].level),skill:At.get(t[39].id)}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o[0]&8&&(i.level=Math.max(1,s[39].level)),o[0]&8&&(i.skill=At.get(s[39].id)),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function eV(t){let e;return{c(){e=h("div"),e.textContent=`${P.ui.default}`,p(e,"class","textgrey")},m(n,s){w(n,e,s)},p:ae,d(n){n&&x(e)}}}function tV(t){let e,n=me(Array(At.get(t[39].id).skilllevels)),s=[];for(let o=0;o<n.length;o+=1)s[o]=B6(D6(t,n,o));return{c(){e=h("div");for(let o=0;o<s.length;o+=1)s[o].c();p(e,"class","skillpoints svelte-1e0alkc")},m(o,i){w(o,e,i);for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(e,null)},p(o,i){if(i[0]&24){n=me(Array(At.get(o[39].id).skilllevels));let r;for(r=0;r<n.length;r+=1){let l=D6(o,n,r);s[r]?s[r].p(l,i):(s[r]=B6(l),s[r].c(),s[r].m(e,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(o){o&&x(e),st(s,o)}}}function nV(t){let e;return{c(){e=h("div"),p(e,"class","border grey")},m(n,s){w(n,e,s)},p:ae,d(n){n&&x(e)}}}function sV(t){let e;return{c(){e=h("div"),p(e,"class","btn incbtn grey svelte-1e0alkc")},m(n,s){w(n,e,s)},p:ae,d(n){n&&x(e)}}}function oV(t){let e,n;return{c(){e=h("div"),p(e,"class",n="btn incbtn "+(t[4]?"green":"white")+" svelte-1e0alkc")},m(s,o){w(s,e,o)},p(s,o){o[0]&16&&n!==(n="btn incbtn "+(s[4]?"green":"white")+" svelte-1e0alkc")&&p(e,"class",n)},d(s){s&&x(e)}}}function B6(t){let e;function n(i,r){return i[46]+1<=i[39].level?oV:i[46]+1<=i[39].learned?sV:nV}let s=n(t,[-1,-1]),o=s(t);return{c(){o.c(),e=de()},m(i,r){o.m(i,r),w(i,e,r)},p(i,r){s===(s=n(i,r))&&o?o.p(i,r):(o.d(1),o=s(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){i&&x(e),o.d(i)}}}function iV(t){let e;return{c(){e=h("div"),p(e,"class","name svelte-1e0alkc")},m(n,s){w(n,e,s)},p:ae,d(n){n&&x(e)}}}function rV(t){let e,n,s,o=t[39].level+"",i;return{c(){e=h("div"),n=T("Lv. "),s=h("span"),i=T(o),p(s,"class","bold textwhite"),p(e,"class","name svelte-1e0alkc")},m(r,l){w(r,e,l),d(e,n),d(e,s),d(s,i)},p(r,l){l[0]&8&&o!==(o=r[39].level+"")&&G(i,o)},d(r){r&&x(e)}}}function $6(t){let e,n,s,o,i,r,l;function a(...m){return t[27](t[39],...m)}function c(m,g){return g[0]&520&&(i=null),i==null&&(i=m[9]>=At.get(m[39].id).skillpoints&&m[39].level<At.get(m[39].id).skilllevels&&m[39].level<m[39].learned),i?aV:lV}let f=c(t,[-1,-1]),u=f(t);return{c(){e=h("div"),n=h("div"),s=T("-"),u.c(),p(n,"class",o="btn incbtn "+(t[39].level>0?"grey":"black disabled")+" svelte-1e0alkc"),p(e,"class","skillpoints svelte-1e0alkc")},m(m,g){w(m,e,g),d(e,n),d(n,s),u.m(e,null),r||(l=H(n,"click",a),r=!0)},p(m,g){t=m,g[0]&8&&o!==(o="btn incbtn "+(t[39].level>0?"grey":"black disabled")+" svelte-1e0alkc")&&p(n,"class",o),f===(f=c(t,g))&&u?u.p(t,g):(u.d(1),u=f(t),u&&(u.c(),u.m(e,null)))},d(m){m&&x(e),u.d(),r=!1,l()}}}function lV(t){let e;return{c(){e=h("div"),e.textContent="+",p(e,"class","btn incbtn black disabled svelte-1e0alkc")},m(n,s){w(n,e,s)},p:ae,d(n){n&&x(e)}}}function aV(t){let e,n,s;function o(...i){return t[28](t[39],...i)}return{c(){e=h("div"),e.textContent="+",p(e,"id","tutsetskillpoint"),p(e,"class","btn incbtn green svelte-1e0alkc")},m(i,r){w(i,e,r),n||(s=H(e,"click",o),n=!0)},p(i,r){t=i},d(i){i&&x(e),n=!1,s()}}}function U6(t){let e,n,s,o,i=P.items.book[t[39].id].name+"",r,l,a,c,f;n=new bl({props:{descPos:"left:100%;top:0;",descRoot:t[2],border:"white",data:{},pickable:t[39].pickable,meta:{type:"skill",skill:At.get(t[39].id)},css:"slotskill",img:`/data/ui/skills/${t[39].id}.${Yn}?v=8685122`,$$slots:{default:[KD]},$$scope:{ctx:t}}});function u(y,F){return y[39].engineOnly?eV:tV}let m=u(t,[-1,-1]),g=m(t);function v(y,F){return y[39].engineOnly?iV:rV}let _=v(t,[-1,-1]),b=_(t),k=!t[39].engineOnly&&$6(t);return{c(){e=h("div"),J(n.$$.fragment),s=h("div"),o=h("div"),r=T(i),l=Ne(),g.c(),a=h("div"),b.c(),c=de(),k&&k.c(),p(o,"class","textprimary name svelte-1e0alkc"),p(e,"class","panel-bright skillbox svelte-1e0alkc")},m(y,F){w(y,e,F),X(n,e,null),d(e,s),d(s,o),d(o,r),d(s,l),g.m(s,null),d(e,a),b.m(a,null),d(a,c),k&&k.m(a,null),f=!0},p(y,F){let A={};F[0]&4&&(A.descRoot=y[2]),F[0]&8&&(A.pickable=y[39].pickable),F[0]&8&&(A.meta={type:"skill",skill:At.get(y[39].id)}),F[0]&8&&(A.img=`/data/ui/skills/${y[39].id}.${Yn}?v=8685122`),F[0]&8|F[1]&524288&&(A.$$scope={dirty:F,ctx:y}),n.$set(A),(!f||F[0]&8)&&i!==(i=P.items.book[y[39].id].name+"")&&G(r,i),m===(m=u(y,F))&&g?g.p(y,F):(g.d(1),g=m(y),g&&(g.c(),g.m(s,null))),_===(_=v(y,F))&&b?b.p(y,F):(b.d(1),b=_(y),b&&(b.c(),b.m(a,c))),y[39].engineOnly?k&&(k.d(1),k=null):k?k.p(y,F):(k=$6(y),k.c(),k.m(a,null))},i(y){f||(S(n.$$.fragment,y),f=!0)},o(y){E(n.$$.fragment,y),f=!1},d(y){y&&x(e),Q(n),g.d(),b.d(),k&&k.d()}}}function cV(t){let e,n;return e=new kl({props:{level:1,skill:t[39]}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o[0]&1&&(i.skill=s[39]),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function O6(t){let e,n,s,o,i=P.items.book[t[39].id].name+"",r,l,a=P.ui.learnable+"",c,f,u=t[39].minlevel+"",m,g;return n=new bl({props:{descPos:"left:100%;top:0;",descRoot:t[2],border:"grey filtered",data:{},pickable:!1,meta:{type:"skill",skill:t[39]},css:"slotskill",img:`/data/ui/skills/${t[39].id}.${Yn}?v=8685122`,$$slots:{default:[cV]},$$scope:{ctx:t}}}),{c(){e=h("div"),J(n.$$.fragment),s=h("div"),o=h("div"),r=T(i),l=h("div"),c=T(a),f=Ne(),m=T(u),p(o,"class","name svelte-1e0alkc"),p(s,"class","textgrey"),p(e,"class","panel-bright skillbox svelte-1e0alkc")},m(v,_){w(v,e,_),X(n,e,null),d(e,s),d(s,o),d(o,r),d(s,l),d(l,c),d(l,f),d(l,m),g=!0},p(v,_){let b={};_[0]&4&&(b.descRoot=v[2]),_[0]&1&&(b.meta={type:"skill",skill:v[39]}),_[0]&1&&(b.img=`/data/ui/skills/${v[39].id}.${Yn}?v=8685122`),_[0]&1|_[1]&524288&&(b.$$scope={dirty:_,ctx:v}),n.$set(b),(!g||_[0]&1)&&i!==(i=P.items.book[v[39].id].name+"")&&G(r,i),(!g||_[0]&1)&&u!==(u=v[39].minlevel+"")&&G(m,u)},i(v){g||(S(n.$$.fragment,v),g=!0)},o(v){E(n.$$.fragment,v),g=!1},d(v){v&&x(e),Q(n)}}}function fV(t){let e,n,s,o,i,r=(t[1]?t[1]:`${P.ui.stats.array[23]}: ${t[8]}`)+"",l,a,c,f,u,m,g,v,_,b=t[12]&&q6(t),k=me(t[3]),y=[];for(let V=0;V<k.length;V+=1)y[V]=U6(I6(t,k,V));let F=V=>E(y[V],1,1,()=>{y[V]=null}),A=me(Array.from(At.values()).filter(t[29]).sort(N6)),C=[];for(let V=0;V<A.length;V+=1)C[V]=O6(E6(t,A,V));let M=V=>E(C[V],1,1,()=>{C[V]=null});return{c(){e=h("div"),b&&b.c(),n=h("div");for(let V=0;V<y.length;V+=1)y[V].c();s=de();for(let V=0;V<C.length;V+=1)C[V].c();o=h("div"),i=h("span"),l=T(r),c=h("div"),f=T("Activate Skills"),m=h("span"),p(n,"id","skilllist"),p(n,"class","scrollbar panel-black skilllist svelte-1e0alkc"),p(i,"class",a=t[1]?"textred":t[8]>0?"textprimary":"textgrey"),p(c,"id","tutapplyskills"),p(c,"class",u="btn "+(t[4]?"green":"grey disabled")),p(o,"class","panel-black bar-bot svelte-1e0alkc"),p(e,"class","flexer svelte-1e0alkc")},m(V,$){w(V,e,$),b&&b.m(e,null),d(e,n);for(let D=0;D<y.length;D+=1)y[D]&&y[D].m(n,null);d(n,s);for(let D=0;D<C.length;D+=1)C[D]&&C[D].m(n,null);d(e,o),d(o,i),d(i,l),d(o,c),d(c,f),d(o,m),t[30](e),g=!0,v||(_=H(c,"click",t[13]),v=!0)},p(V,$){if(V[12]?b?b.p(V,$):(b=q6(V),b.c(),b.m(e,n)):b&&(b.d(1),b=null),$[0]&16924){k=me(V[3]);let D;for(D=0;D<k.length;D+=1){let z=I6(V,k,D);y[D]?(y[D].p(z,$),S(y[D],1)):(y[D]=U6(z),y[D].c(),S(y[D],1),y[D].m(n,s))}for(Me(),D=k.length;D<y.length;D+=1)F(D);Fe()}if($[0]&5){A=me(Array.from(At.values()).filter(V[29]).sort(N6));let D;for(D=0;D<A.length;D+=1){let z=E6(V,A,D);C[D]?(C[D].p(z,$),S(C[D],1)):(C[D]=O6(z),C[D].c(),S(C[D],1),C[D].m(n,null))}for(Me(),D=A.length;D<C.length;D+=1)M(D);Fe()}(!g||$[0]&258)&&r!==(r=(V[1]?V[1]:`${P.ui.stats.array[23]}: ${V[8]}`)+"")&&G(l,r),(!g||$[0]&258&&a!==(a=V[1]?"textred":V[8]>0?"textprimary":"textgrey"))&&p(i,"class",a),(!g||$[0]&16&&u!==(u="btn "+(V[4]?"green":"grey disabled")))&&p(c,"class",u)},i(V){if(!g){for(let $=0;$<k.length;$+=1)S(y[$]);for(let $=0;$<A.length;$+=1)S(C[$]);g=!0}},o(V){y=y.filter(Boolean);for(let $=0;$<y.length;$+=1)E(y[$]);C=C.filter(Boolean);for(let $=0;$<C.length;$+=1)E(C[$]);g=!1},d(V){V&&x(e),b&&b.d(),st(y,V),st(C,V),t[30](null),v=!1,_()}}}function uV(t){let e,n,s=t[11]&&L6(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,i){o[11]?s?(s.p(o,i),i[0]&2048&&S(s,1)):(s=L6(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}var N6=(t,e)=>t.minlevel-e.minlevel;function mV(t,e,n){let s,o,i,r,l,a,c,f,u;ie(t,Wc,oe=>n(0,i=oe)),ie(t,Fa,oe=>n(10,r=oe)),ie(t,Gi,oe=>n(19,l=oe)),ie(t,Gc,oe=>n(1,a=oe)),ie(t,Ni,oe=>n(20,c=oe)),ie(t,vi,oe=>n(11,f=oe)),ie(t,wf,oe=>n(12,u=oe));let m,g=oe=>{let Ee=[];return oe.forEach((K,Re)=>{for(let Ge=0;Ge<K.level;++Ge)Ee.push(K.id)}),Ee},v=()=>{let oe=A.filter(Ee=>!At.get(Ee)?.engineOnly);yt("skillconfig",oe),n(4,b=!1),Xe(Gc,a=void 0,a),an(25,100)},_=[],b=!1,k=!1,y=(oe,Ee)=>{n(3,_=[]),oe.forEach((K,Re)=>{let Ge=At.get(Re);_.push({id:Re,level:K,minlevel:Ge.minlevel,learned:Ee.get(Re)||0,engineOnly:Ge.engineOnly,pickable:Ge.onCast!==void 0})}),Ee.forEach((K,Re)=>{if(!oe.has(Re)){let Ge=At.get(Re);_.push({id:Re,level:0,minlevel:Ge.minlevel,learned:K,engineOnly:Ge.engineOnly,pickable:Ge.onCast!==void 0})}}),_.sort((K,Re)=>K.id-Re.id)},F=()=>{C=g(_);let oe=C.filter(Ee=>!At.get(Ee)?.engineOnly);n(18,M=tg(oe))},A=[],C=[],M=0,V=(oe,Ee)=>{oe.level+=Ee,n(3,_),an(24,100),$()},$=()=>{A=g(_);let oe=A.filter(Ge=>!At.get(Ge)?.engineOnly);n(18,M=tg(oe));let Ee=A.sort().join(","),K=C.sort().join(",");n(4,b=A.length&&Ee!==K);let Re=r.find(Ge=>Ee===Ge.skills.sort().join(","));Re?(n(7,q=Re.name),n(5,k=!1)):(n(7,q=void 0),n(5,k=!0))},D,z=()=>{D!==void 0&&(Fa.update(oe=>(oe=oe.filter(Ee=>Ee.name!==D||Ee.pclass!==I.player.class),oe.push({name:D,skills:g(_),pclass:I.player.class}),oe)),n(7,q=D),n(6,D=void 0),n(5,k=!1))},q,L=oe=>{let Ee=r.find(K=>K.name===q&&K.pclass===I.player.class);if(Ee){let K=new Map;Ee.skills.forEach(Re=>{K.has(Re)?K.set(Re,K.get(Re)+1):K.set(Re,1)}),y(K,i),$(),b&&v()}},O=()=>{Fa.update(oe=>oe.filter(Ee=>Ee.name!==q)),n(7,q=void 0),n(5,k=!0)},j=oe=>oe.pclass===I.player.class,R=oe=>oe.pclass===I.player.class;function U(){q=Fs(this),n(7,q)}let Z=oe=>n(6,D="");function ye(){D=this.value,n(6,D)}let we=oe=>n(6,D=void 0),he=(oe,Ee)=>V(oe,-1),re=(oe,Ee)=>V(oe,1),le=oe=>oe.class===I.player.class&&!oe.engineOnly&&!i.has(oe.id);function ve(oe){qt[oe?"unshift":"push"](()=>{m=oe,n(2,m)})}let _e=()=>{Xe(wf,u=!u,u)},Ie=()=>{Xe(vi,f=!1,f)};return t.$$.update=()=>{t.$$.dirty[0]&1048577&&(y(c,i),F(),$()),t.$$.dirty[0]&2&&a&&n(4,b=!0),t.$$.dirty[0]&786432&&n(9,s=l[24]-M),t.$$.dirty[0]&786432&&n(8,o=l[24]-M)},[i,a,m,_,b,k,D,q,o,s,r,f,u,v,V,z,L,O,M,l,c,j,R,U,Z,ye,we,he,re,le,ve,_e,Ie]}var tv=class extends Ce{constructor(e){super(),Pe(this,e,mV,uV,Be,{},null,[-1,-1])}},j6=tv;function W6(t,e,n){let s=t.slice();return s[19]=e[n],s[21]=n,s}function G6(t){let e,n,s=me(t[1]),o=[];for(let r=0;r<s.length;r+=1)o[r]=Y6(W6(t,s,r));let i=null;return s.length||(i=H6(t)),{c(){e=h("div");for(let r=0;r<o.length;r+=1)o[r].c();n=de(),i&&i.c(),p(e,"class","divider")},m(r,l){w(r,e,l);for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,l);w(r,n,l),i&&i.m(r,l)},p(r,l){if(l&74){s=me(r[1]);let a;for(a=0;a<s.length;a+=1){let c=W6(r,s,a);o[a]?o[a].p(c,l):(o[a]=Y6(c),o[a].c(),o[a].m(n.parentNode,n))}for(;a<o.length;a+=1)o[a].d(1);o.length=s.length,!s.length&&i?i.p(r,l):s.length?i&&(i.d(1),i=null):(i=H6(r),i.c(),i.m(n.parentNode,n))}},d(r){r&&(x(e),x(n)),st(o,r),i&&i.d(r)}}}function H6(t){let e;return{c(){e=h("div"),e.textContent="No results",p(e,"class","textgrey result svelte-17jb1r5")},m(n,s){w(n,e,s)},p:ae,d(n){n&&x(e)}}}function Y6(t){let e,n,s=t[19].name+"",o,i,r=t[19].type+"",l,a,c,f=(t[19].level||1)+"",u,m,g,v;function _(...b){return t[14](t[21],...b)}return{c(){e=h("div"),n=h("span"),o=T(s),i=h("span"),l=T(r),a=h("span"),c=T("Lv. "),u=T(f),p(i,"class","textgrey infocol svelte-17jb1r5"),p(a,"class","infocol svelte-17jb1r5"),p(e,"class",m="result "+(t[21]===t[3]?"sel":"")+" svelte-17jb1r5")},m(b,k){w(b,e,k),d(e,n),d(n,o),d(e,i),d(i,l),d(e,a),d(a,c),d(a,u),g||(v=H(e,"mousedown",_),g=!0)},p(b,k){t=b,k&2&&s!==(s=t[19].name+"")&&G(o,s),k&2&&r!==(r=t[19].type+"")&&G(l,r),k&2&&f!==(f=(t[19].level||1)+"")&&G(u,f),k&8&&m!==(m="result "+(t[21]===t[3]?"sel":"")+" svelte-17jb1r5")&&p(e,"class",m)},d(b){b&&x(e),g=!1,v()}}}function pV(t){let e,n,s,o,i,r,l,a=t[2]&&G6(t);return{c(){e=h("div"),n=h("div"),s=h("input"),a&&a.c(),p(s,"placeholder",o=P.ui.merchant.itemSearch),p(s,"type","search"),p(n,"class",i="container input "+(t[2]?"focus":"")),p(e,"class","navbtn finder")},m(c,f){w(c,e,f),d(e,n),d(n,s),t[11](s),je(s,t[0]),a&&a.m(n,null),r||(l=[H(s,"input",t[12]),H(s,"input",t[5]),H(s,"focus",t[13]),H(s,"blur",t[7])],r=!0)},p(c,[f]){f&1&&s.value!==c[0]&&je(s,c[0]),c[2]?a?a.p(c,f):(a=G6(c),a.c(),a.m(n,null)):a&&(a.d(1),a=null),f&4&&i!==(i="container input "+(c[2]?"focus":""))&&p(n,"class",i)},i:ae,o:ae,d(c){c&&x(e),t[11](null),a&&a.d(),r=!1,rt(l)}}}function dV(t,e,n){let s=ci(),o=ar.filter(M=>M.level<=45||M.type==="rune"&&M.tier===5).map(M=>({name:nn(M.type,M.tier),type:M.type,tier:M.tier,level:M.level})),i=()=>{let M=a.toLowerCase();M.length?n(1,f=o.filter(V=>V.type===M||V.name.toLowerCase().includes(M)).slice(0,c)):n(1,f=[]),m>=f.length&&_(f.length-1)},{type:r}=e,{tier:l}=e,{name:a=""}=e,{limit:c=5}=e,f=[],u=!1,m=-1,g,v,_=M=>{n(3,m=M),m>=0?(g=f[m],n(0,a=g.name),n(8,r=g.type),n(9,l=g.tier)):(g=void 0,n(0,a=""),n(8,r="all"),n(9,l="all"))},b=M=>{M.target==v&&((M.keyCode===38||M.keyCode===40)&&f.length?(_(Sa(m+(M.keyCode===38?-1:1),f.length)),M.preventDefault()):(M.keyCode==13||M.keyCode==27)&&v.blur())},k=M=>{n(2,u=!1),_(Math.min(Math.max(0,m),f.length-1)),m>=0&&s("finalize")};Fn(()=>{document.addEventListener("keydown",b)}),Tn(()=>{document.removeEventListener("keydown",b),n(4,v=void 0)});function y(M){qt[M?"unshift":"push"](()=>{v=M,n(4,v)})}function F(){a=this.value,n(0,a)}let A=M=>n(2,u=!0),C=(M,V)=>_(M);return t.$$set=M=>{"type"in M&&n(8,r=M.type),"tier"in M&&n(9,l=M.tier),"name"in M&&n(0,a=M.name),"limit"in M&&n(10,c=M.limit)},[a,f,u,m,v,i,_,k,r,l,c,y,F,A,C]}var nv=class extends Ce{constructor(e){super(),Pe(this,e,dV,pV,Be,{type:8,tier:9,name:0,limit:10})}},X6=nv;var Q6=t=>9+Math.ceil(t*.001);function Z6(t,e,n){let s=t.slice();return s[55]=e[n],s}function J6(t,e,n){let s=t.slice();return s[58]=e[n],s[60]=n,s}function K6(t){let e,n;return e=new $t({props:{origin:"left top",defaultOffset:[0,100],title:"Merchant",$$slots:{default:[kV]},$$scope:{ctx:t}}}),e.$on("close",t[50]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o[0]&2097135|o[1]&1073741824&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function hV(t){let e,n=t[58]+"",s,o,i,r;function l(...a){return t[44](t[58],...a)}return{c(){e=h("div"),s=T(n),p(e,"class",o="choice "+(t[58]==t[6]?"active":"")+" svelte-35lzg4")},m(a,c){w(a,e,c),d(e,s),i||(r=H(e,"click",l),i=!0)},p(a,c){t=a,c[0]&64&&o!==(o="choice "+(t[58]==t[6]?"active":"")+" svelte-35lzg4")&&p(e,"class",o)},d(a){a&&x(e),i=!1,r()}}}function gV(t){let e;return{c(){e=h("div"),p(e,"class","divider svelte-35lzg4")},m(n,s){w(n,e,s)},p:ae,d(n){n&&x(e)}}}function eF(t){let e;function n(i,r){return i[58]===null?gV:hV}let o=n(t,[-1,-1])(t);return{c(){o.c(),e=de()},m(i,r){o.m(i,r),w(i,e,r)},p(i,r){o.p(i,r)},d(i){i&&x(e),o.d(i)}}}function tF(t){let e,n,s,o=nn(t[55].temp.type,t[55].temp.tier)+"",i,r,l,a=(t[55].temp.logic.level||1)+"",c,f,u,m=t[55].temp.owner+"",g,v,_=t[27](t[55].temp.auction.getTime())+"",b,k,y,F=t[13]&&t[55].temp.stacks>0?t[55].temp.stacks+" x ":"",A,C,M,V,$,D;n=new ws({props:{shift:t[20],descPos:"right:0;top:0;",descRoot:t[5],pickable:!1,item:t[55]}}),C=new xn({props:{amount:t[13]&&t[55].temp.stacks>0?Math.ceil(t[55].temp.auctionprice/t[55].temp.stacks):t[55].temp.auctionprice}});function z(...q){return t[47](t[55],...q)}return{c(){e=h("div"),J(n.$$.fragment),s=h("span"),i=T(o),l=h("span"),c=T(a),u=h("span"),g=T(m),v=h("span"),b=T(_),k=h("div"),y=h("span"),A=T(F),J(C.$$.fragment),p(s,"class",r="marg text"+jt(t[55].temp.quality)[0]+" svelte-35lzg4"),Le(s,"margin-left","6px"),p(l,"class",f="marg "+(I.player.level>=t[55].temp.logic.level?"textgreen":"textred")+" svelte-35lzg4"),p(u,"class","marg svelte-35lzg4"),p(v,"class","marg svelte-35lzg4"),p(y,"class","textgreen"),p(k,"class","marg svelte-35lzg4"),Le(k,"text-align","end"),p(e,"class",M="buy "+(t[18]==t[55]?"selected":"")+" item panel-black svelte-35lzg4")},m(q,L){w(q,e,L),X(n,e,null),d(e,s),d(s,i),d(e,l),d(l,c),d(e,u),d(u,g),d(e,v),d(v,b),d(e,k),d(k,y),d(y,A),X(C,k,null),V=!0,$||(D=H(e,"click",z),$=!0)},p(q,L){t=q;let O={};L[0]&1048576&&(O.shift=t[20]),L[0]&32&&(O.descRoot=t[5]),L[0]&131072&&(O.item=t[55]),n.$set(O),(!V||L[0]&131072)&&o!==(o=nn(t[55].temp.type,t[55].temp.tier)+"")&&G(i,o),(!V||L[0]&131072&&r!==(r="marg text"+jt(t[55].temp.quality)[0]+" svelte-35lzg4"))&&p(s,"class",r),(!V||L[0]&131072)&&a!==(a=(t[55].temp.logic.level||1)+"")&&G(c,a),(!V||L[0]&131072&&f!==(f="marg "+(I.player.level>=t[55].temp.logic.level?"textgreen":"textred")+" svelte-35lzg4"))&&p(l,"class",f),(!V||L[0]&131072)&&m!==(m=t[55].temp.owner+"")&&G(g,m),(!V||L[0]&131072)&&_!==(_=t[27](t[55].temp.auction.getTime())+"")&&G(b,_),(!V||L[0]&139264)&&F!==(F=t[13]&&t[55].temp.stacks>0?t[55].temp.stacks+" x ":"")&&G(A,F);let j={};L[0]&139264&&(j.amount=t[13]&&t[55].temp.stacks>0?Math.ceil(t[55].temp.auctionprice/t[55].temp.stacks):t[55].temp.auctionprice),C.$set(j),(!V||L[0]&393216&&M!==(M="buy "+(t[18]==t[55]?"selected":"")+" item panel-black svelte-35lzg4"))&&p(e,"class",M)},i(q){V||(S(n.$$.fragment,q),S(C.$$.fragment,q),V=!0)},o(q){E(n.$$.fragment,q),E(C.$$.fragment,q),V=!1},d(q){q&&x(e),Q(n),Q(C),$=!1,D()}}}function vV(t){let e,n,s,o,i=[yV,bV],r=[];function l(a,c){return a[18].temp.owner!==I.player.name?0:1}return n=l(t,[-1,-1]),s=r[n]=i[n](t),{c(){e=h("section"),s.c(),p(e,"class","confirm panel-black svelte-35lzg4")},m(a,c){w(a,e,c),r[n].m(e,null),o=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(Me(),E(r[f],1,1,()=>{r[f]=null}),Fe(),s=r[n],s?s.p(a,c):(s=r[n]=i[n](a),s.c()),S(s,1),s.m(e,null))},i(a){o||(S(s),o=!0)},o(a){E(s),o=!1},d(a){a&&x(e),r[n].d()}}}function _V(t){let e,n,s,o=(t[3]?nn(t[3].type,t[3].tier):P.ui.merchant.dragitem)+"",i,r,l,a,c=P.ui.merchant.price+"",f,u,m,g,v,_,b=P.ui.merchant.fee+"",k,y,F,A,C,M,V=P.ui.merchant.post+"",$,D,z,q,L,O;n=new ws({props:{descPos:"left:100%;bottom:100%;",clearOnMove:!0,invslot:void 0,pickable:!0,item:ho}}),n.$on("discard",t[26]),n.$on("move",t[25]),n.$on("click",t[26]),n.$on("context",t[26]),m=new xn({props:{amount:t[1]}}),F=new xn({props:{amount:t[15]}});let j=t[3]&&t[3].stacks>0&&nF(t);return{c(){e=h("section"),J(n.$$.fragment),s=h("span"),i=T(o),l=h("div"),a=h("span"),f=T(c),u=T(": "),J(m.$$.fragment),g=Ne(),v=h("br"),_=h("span"),k=T(b),y=T(": "),J(F.$$.fragment),A=h("input"),j&&j.c(),M=h("div"),$=T(V),p(s,"class",r="marg text"+(t[3]?jt(t[3].quality)[0]:"grey")+" svelte-35lzg4"),p(a,"class","textwhite"),p(_,"class","textgrey"),p(l,"class","marg svelte-35lzg4"),Le(l,"text-align","end"),p(A,"class","marg svelte-35lzg4"),p(A,"type","number"),p(A,"placeholder",C=P.ui.merchant.setPrice),p(M,"class",D="marg btn formatted secondary "+(t[16]?"":"disabled")+" svelte-35lzg4"),p(e,"class",z="post "+(t[3]&&t[3].stacks>0?"postStacks":"")+" panel-black svelte-35lzg4")},m(R,U){w(R,e,U),X(n,e,null),d(e,s),d(s,i),d(e,l),d(l,a),d(a,f),d(a,u),X(m,a,null),d(a,g),d(l,v),d(l,_),d(_,k),d(_,y),X(F,_,null),d(e,A),je(A,t[0]),j&&j.m(e,null),d(e,M),d(M,$),q=!0,L||(O=[H(A,"input",t[48]),H(M,"click",t[24])],L=!0)},p(R,U){(!q||U[0]&8)&&o!==(o=(R[3]?nn(R[3].type,R[3].tier):P.ui.merchant.dragitem)+"")&&G(i,o),(!q||U[0]&8&&r!==(r="marg text"+(R[3]?jt(R[3].quality)[0]:"grey")+" svelte-35lzg4"))&&p(s,"class",r);let Z={};U[0]&2&&(Z.amount=R[1]),m.$set(Z);let ye={};U[0]&32768&&(ye.amount=R[15]),F.$set(ye),U[0]&1&&Gt(A.value)!==R[0]&&je(A,R[0]),R[3]&&R[3].stacks>0?j?j.p(R,U):(j=nF(R),j.c(),j.m(e,M)):j&&(j.d(1),j=null),(!q||U[0]&65536&&D!==(D="marg btn formatted secondary "+(R[16]?"":"disabled")+" svelte-35lzg4"))&&p(M,"class",D),(!q||U[0]&8&&z!==(z="post "+(R[3]&&R[3].stacks>0?"postStacks":"")+" panel-black svelte-35lzg4"))&&p(e,"class",z)},i(R){q||(S(n.$$.fragment,R),S(m.$$.fragment,R),S(F.$$.fragment,R),q=!0)},o(R){E(n.$$.fragment,R),E(m.$$.fragment,R),E(F.$$.fragment,R),q=!1},d(R){R&&x(e),Q(n),Q(m),Q(F),j&&j.d(),L=!1,rt(O)}}}function bV(t){let e,n,s,o=nn(t[18].temp.type,t[18].temp.tier)+"",i,r,l,a,c,f,u;return{c(){e=h("span"),n=T("Stop "),s=h("span"),i=T(o),l=T(" from being listed?"),a=h("div"),a.textContent=`${P.ui.cancel}`,c=h("div"),c.textContent=`${P.ui.merchant.delist}`,p(s,"class",r="text"+jt(t[18].temp.quality)[0]+" svelte-35lzg4"),p(e,"class","marg svelte-35lzg4"),p(a,"class","marg btn formatted grey svelte-35lzg4"),p(c,"class","marg btn formatted orange svelte-35lzg4")},m(m,g){w(m,e,g),d(e,n),d(e,s),d(s,i),d(e,l),w(m,a,g),w(m,c,g),f||(u=[H(a,"click",t[29]),H(c,"click",t[31])],f=!0)},p(m,g){g[0]&262144&&o!==(o=nn(m[18].temp.type,m[18].temp.tier)+"")&&G(i,o),g[0]&262144&&r!==(r="text"+jt(m[18].temp.quality)[0]+" svelte-35lzg4")&&p(s,"class",r)},i:ae,o:ae,d(m){m&&(x(e),x(a),x(c)),f=!1,rt(u)}}}function yV(t){let e,n=P.ui.merchant.buyItem[0]+"",s,o,i,r=t[18].temp.stacks>0?t[18].temp.stacks+" x ":"",l,a,c=nn(t[18].temp.type,t[18].temp.tier)+"",f,u,m,g=P.ui.merchant.buyItem[1]+"",v,_,b,k,y=P.ui.merchant.buyItem[2]+"",F,A,C,M,V,$;return b=new xn({props:{amount:t[18].temp.auctionprice}}),{c(){e=h("span"),s=T(n),o=Ne(),i=h("span"),l=T(r),a=h("span"),f=T(c),m=Ne(),v=T(g),_=Ne(),J(b.$$.fragment),k=Ne(),F=T(y),A=h("div"),A.textContent=`${P.ui.cancel}`,C=h("div"),C.textContent=`${P.ui.merchant.buy}`,p(i,"class","textgreen"),p(a,"class",u="text"+jt(t[18].temp.quality)[0]+" svelte-35lzg4"),p(e,"class","marg svelte-35lzg4"),p(A,"class","marg btn formatted grey svelte-35lzg4"),p(C,"class","marg btn formatted secondary svelte-35lzg4")},m(D,z){w(D,e,z),d(e,s),d(e,o),d(e,i),d(i,l),d(e,a),d(a,f),d(e,m),d(e,v),d(e,_),X(b,e,null),d(e,k),d(e,F),w(D,A,z),w(D,C,z),M=!0,V||($=[H(A,"click",t[29]),H(C,"click",t[30])],V=!0)},p(D,z){(!M||z[0]&262144)&&r!==(r=D[18].temp.stacks>0?D[18].temp.stacks+" x ":"")&&G(l,r),(!M||z[0]&262144)&&c!==(c=nn(D[18].temp.type,D[18].temp.tier)+"")&&G(f,c),(!M||z[0]&262144&&u!==(u="text"+jt(D[18].temp.quality)[0]+" svelte-35lzg4"))&&p(a,"class",u);let q={};z[0]&262144&&(q.amount=D[18].temp.auctionprice),b.$set(q)},i(D){M||(S(b.$$.fragment,D),M=!0)},o(D){E(b.$$.fragment,D),M=!1},d(D){D&&(x(e),x(A),x(C)),Q(b),V=!1,rt($)}}}function nF(t){let e,n,s,o,i,r,l;return{c(){e=h("select"),n=h("option"),n.textContent="Total",o=h("option"),o.textContent="Per Unit",n.__value=s=!1,je(n,n.__value),o.__value=i=!0,je(o,o.__value),p(e,"class","marg formatted svelte-35lzg4"),t[2]===void 0&&bn(()=>t[49].call(e))},m(a,c){w(a,e,c),d(e,n),d(e,o),Mn(e,t[2],!0),r||(l=H(e,"change",t[49]),r=!0)},p(a,c){c[0]&4&&Mn(e,a[2])},d(a){a&&x(e),r=!1,l()}}}function kV(t){let e,n,s,o,i,r,l,a,c=P.ui.merchant.search+"",f,u,m,g=P.ui.merchant.previous+"",v,_,b,k=P.ui.merchant.next+"",y,F,A,C,M,V,$,D,z,q,L,O=P.ui.merchant.results+"",j,R,U=t[14]+1+"",Z,ye,we=Math.ceil(t[19]/50)+"",he,re,le,ve,_e,Ie=t[32](t[10],"time",t[11])+"",oe,Ee=P.ui.merchant.time+"",K,Re,Ge,Qe=(t[12]?P.ui.merchant.perUnit:P.ui.merchant.total)+"",Ye,pe,ce,Oe=t[32](t[10],"price",t[11])+"",se,ee=P.ui.merchant.price+"",N,ue,We,ze,Ae,$e,Ue,mt,wt;function Je(He){t[37](He)}function Et(He){t[38](He)}function xe(He){t[39](He)}let Ke={limit:10};t[8]!==void 0&&(Ke.name=t[8]),t[7]!==void 0&&(Ke.tier=t[7]),t[6]!==void 0&&(Ke.type=t[6]),s=new X6({props:Ke}),qt.push(()=>mo(s,"name",Je)),qt.push(()=>mo(s,"tier",Et)),qt.push(()=>mo(s,"type",xe)),s.$on("finalize",t[23]);let bt=me(t[22]),Ct=[];for(let He=0;He<bt.length;He+=1)Ct[He]=eF(J6(t,bt,He));let Ve=me(t[17]),be=[];for(let He=0;He<Ve.length;He+=1)be[He]=tF(Z6(t,Ve,He));let Vt=He=>E(be[He],1,1,()=>{be[He]=null}),Ht=[_V,vV],Lt=[];function Rt(He,et){return He[18]?1:0}return Ae=Rt(t,[-1,-1]),$e=Lt[Ae]=Ht[Ae](t),{c(){e=h("div"),n=h("section"),J(s.$$.fragment),l=h("span"),a=h("div"),f=T(c),m=h("div"),v=T(g),b=h("div"),y=T(k),A=h("section");for(let He=0;He<Ct.length;He+=1)Ct[He].c();C=h("section"),M=h("div"),V=h("div"),$=h("div"),D=h("span"),z=h("span"),q=T(t[19]),L=Ne(),j=T(O),R=T(" ("),Z=T(U),ye=T("/"),he=T(we),re=T(")"),le=h("span"),le.textContent="Lv.",ve=h("span"),ve.textContent=`${P.ui.merchant.owner}`,_e=h("span"),oe=T(Ie),K=T(Ee),Ge=h("span"),Ye=T(Qe),ce=h("span"),se=T(Oe),N=T(ee),ue=Ne(),ze=h("div");for(let He=0;He<be.length;He+=1)be[He].c();$e.c(),p(a,"class",u="btn formatted secondary "+(t[9]?"":"disabled")),p(m,"class",_="btn formatted grey "+(t[9]&&t[14]>0?"":"disabled")),p(b,"class",F="btn formatted grey "+(t[9]&&t[17].length==50?"":"disabled")),p(n,"class","search panel-black svelte-35lzg4"),p(A,"class","choices border grey scrollbar svelte-35lzg4"),p(z,"class","btn black disabled textgrey"),p(le,"class","btn black disabled textgrey"),p(ve,"class","btn black disabled textgrey"),p(_e,"class",Re="btn grey "+(t[9]?"":"disabled")+" "+(t[10]=="time"?"textprimary active":"")),p(Ge,"class",pe="btn grey "+(t[9]?"":"disabled")+" "+(t[12]?"textgreen":"")),Le(Ge,"text-align","end"),p(ce,"class",We="btn grey "+(t[9]?"":"disabled")+" "+(t[10]=="price"?"textprimary active":"")),Le(ce,"text-align","end"),p($,"class","buytblhead svelte-35lzg4"),p(V,"class","scrollbar scrollbar-fix"),p(ze,"class","scrollbar scrollbar-fix"),p(M,"class","buytable svelte-35lzg4"),p(C,"class","items border grey svelte-35lzg4"),p(e,"class","layout svelte-35lzg4")},m(He,et){w(He,e,et),d(e,n),X(s,n,null),d(n,l),d(n,a),d(a,f),d(n,m),d(m,v),d(n,b),d(b,y),t[43](n),d(e,A);for(let Te=0;Te<Ct.length;Te+=1)Ct[Te]&&Ct[Te].m(A,null);d(e,C),d(C,M),d(M,V),d(V,$),d($,D),d($,z),d(z,q),d(z,L),d(z,j),d(z,R),d(z,Z),d(z,ye),d(z,he),d(z,re),d($,le),d($,ve),d($,_e),d(_e,oe),d(_e,K),d($,Ge),d(Ge,Ye),d($,ce),d(ce,se),d(ce,N),d(ce,ue),d(M,ze);for(let Te=0;Te<be.length;Te+=1)be[Te]&&be[Te].m(ze,null);Lt[Ae].m(e,null),Ue=!0,mt||(wt=[H(a,"click",t[40]),H(m,"click",t[41]),H(b,"click",t[42]),H(_e,"click",t[45]),H(Ge,"click",t[34]),H(ce,"click",t[46])],mt=!0)},p(He,et){let Te={};if(!o&&et[0]&256&&(o=!0,Te.name=He[8],uo(()=>o=!1)),!i&&et[0]&128&&(i=!0,Te.tier=He[7],uo(()=>i=!1)),!r&&et[0]&64&&(r=!0,Te.type=He[6],uo(()=>r=!1)),s.$set(Te),(!Ue||et[0]&512&&u!==(u="btn formatted secondary "+(He[9]?"":"disabled")))&&p(a,"class",u),(!Ue||et[0]&16896&&_!==(_="btn formatted grey "+(He[9]&&He[14]>0?"":"disabled")))&&p(m,"class",_),(!Ue||et[0]&131584&&F!==(F="btn formatted grey "+(He[9]&&He[17].length==50?"":"disabled")))&&p(b,"class",F),et[0]&12599744){bt=me(He[22]);let Ze;for(Ze=0;Ze<bt.length;Ze+=1){let ft=J6(He,bt,Ze);Ct[Ze]?Ct[Ze].p(ft,et):(Ct[Ze]=eF(ft),Ct[Ze].c(),Ct[Ze].m(A,null))}for(;Ze<Ct.length;Ze+=1)Ct[Ze].d(1);Ct.length=bt.length}if((!Ue||et[0]&524288)&&G(q,He[19]),(!Ue||et[0]&16384)&&U!==(U=He[14]+1+"")&&G(Z,U),(!Ue||et[0]&524288)&&we!==(we=Math.ceil(He[19]/50)+"")&&G(he,we),(!Ue||et[0]&3072)&&Ie!==(Ie=He[32](He[10],"time",He[11])+"")&&G(oe,Ie),(!Ue||et[0]&1536&&Re!==(Re="btn grey "+(He[9]?"":"disabled")+" "+(He[10]=="time"?"textprimary active":"")))&&p(_e,"class",Re),(!Ue||et[0]&4096)&&Qe!==(Qe=(He[12]?P.ui.merchant.perUnit:P.ui.merchant.total)+"")&&G(Ye,Qe),(!Ue||et[0]&4608&&pe!==(pe="btn grey "+(He[9]?"":"disabled")+" "+(He[12]?"textgreen":"")))&&p(Ge,"class",pe),(!Ue||et[0]&3072)&&Oe!==(Oe=He[32](He[10],"price",He[11])+"")&&G(se,Oe),(!Ue||et[0]&1536&&We!==(We="btn grey "+(He[9]?"":"disabled")+" "+(He[10]=="price"?"textprimary active":"")))&&p(ce,"class",We),et[0]&404103200){Ve=me(He[17]);let Ze;for(Ze=0;Ze<Ve.length;Ze+=1){let ft=Z6(He,Ve,Ze);be[Ze]?(be[Ze].p(ft,et),S(be[Ze],1)):(be[Ze]=tF(ft),be[Ze].c(),S(be[Ze],1),be[Ze].m(ze,null))}for(Me(),Ze=Ve.length;Ze<be.length;Ze+=1)Vt(Ze);Fe()}let it=Ae;Ae=Rt(He,et),Ae===it?Lt[Ae].p(He,et):(Me(),E(Lt[it],1,1,()=>{Lt[it]=null}),Fe(),$e=Lt[Ae],$e?$e.p(He,et):($e=Lt[Ae]=Ht[Ae](He),$e.c()),S($e,1),$e.m(e,null))},i(He){if(!Ue){S(s.$$.fragment,He);for(let et=0;et<Ve.length;et+=1)S(be[et]);S($e),Ue=!0}},o(He){E(s.$$.fragment,He),be=be.filter(Boolean);for(let et=0;et<be.length;et+=1)E(be[et]);E($e),Ue=!1},d(He){He&&x(e),Q(s),t[43](null),st(Ct,He),st(be,He),Lt[Ae].d(),mt=!1,rt(wt)}}}function xV(t){let e,n,s=t[4]&&K6(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,i){o[4]?s?(s.p(o,i),i[0]&16&&S(s,1)):(s=K6(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function wV(t,e,n){let s,o,i,r,l,a;ie(t,ma,Ae=>n(35,s=Ae)),ie(t,ho,Ae=>n(3,o=Ae)),ie(t,po,Ae=>n(4,i=Ae)),ie(t,Vr,Ae=>n(36,r=Ae)),ie(t,xm,Ae=>n(19,l=Ae));let c=nt.shift.store;ie(t,c,Ae=>n(20,a=Ae));let f,u=[P.ui.all,P.ui.merchant.filtermine,null,"bow","hammer","staff","sword",null,"orb","quiver","shield","totem",null,"armlet","armor","boot","glove",null,"amulet","bag","ring",null,"book","rune","misc",null,"mount","pet","box"],m=u[0],g="all",v="",_=[],b=!0,k="price",y=1,F=!1,A=!1,C=0,M=()=>{if(b&&i){n(18,he=void 0);let Ae=u.indexOf(m);yt("itemauctionfind",`${Ae} ${Ae===1?"all":g} ${k==="time"?0:F?2:1} ${y} ${C}`),n(9,b=!1)}},V,$,D=!1,z,q,L=()=>{q&&yt("itemauctionpost",`${o.dbid} ${$}`)},O=Ae=>{let{from:$e,to:Ue}=Ae.detail;$e!==Ue&&$e.type=="item"&&ho.set($e.item)},j=Ae=>{o&&o.type&&xt($s[o.type].sound),ho.set()},R,U=[],Z=[],ye=()=>{if(R=Date.now(),s.length){let Ae=s.map($e=>$e.dbid);fetch("/api/item/getAuction",{method:"POST",body:JSON.stringify({ids:Ae})}).then(async $e=>{let Ue=await $e.json();Ue==="error"||$e.ok===!1?console.error(Ue):(n(17,Z.length=0,Z),s.forEach((mt,wt)=>{let Je=Ue.find(Et=>Et.id===mt.dbid);Je&&(Je.store=U[wt]||(U[wt]=te()),Je.store.temp=mt,mt.hydrate(Je),Z.push(Je.store))}),n(13,A=F),n(9,b=!0))})}else n(13,A=F),n(9,b=!0),n(17,Z.length=0,Z)},we=Ae=>{let $e=Math.ceil((Ae-R)/6e4);return $e<60?`${$e} m`:`${Math.ceil($e/60)} h`},he,re=Ae=>{n(18,he=Ae)},le=()=>{n(18,he=void 0)},ve=()=>{yt("itemauctionbuy",he.temp.dbid+""),le()},_e=()=>{yt("itemauctioncancel",he.temp.dbid+""),le()},Ie=(Ae,$e,Ue)=>Ae==$e?Ue==1?"\u{1F815} ":"\u{1F817} ":"",oe=Ae=>{n(14,C=0),Ae==k?n(11,y=y==1?0:1):n(10,k=Ae),M()},Ee=()=>{n(12,F=!F),k=="price"?M():n(13,A=F)};ho.subscribe(Ae=>{Ae!==void 0&&(n(6,m=Ae.type),n(7,g=Ae.tier),n(11,y=1),n(10,k="price"),n(12,F=!0),n(14,C=0),M())});function K(Ae){v=Ae,n(8,v)}function Re(Ae){g=Ae,n(7,g)}function Ge(Ae){m=Ae,n(6,m)}let Qe=Ae=>{n(14,C=0),M()},Ye=Ae=>{n(14,C--,C),M()},pe=Ae=>{n(14,C++,C),M()};function ce(Ae){qt[Ae?"unshift":"push"](()=>{f=Ae,n(5,f)})}let Oe=(Ae,$e)=>{n(6,m=Ae),n(8,v=""),n(7,g="all"),n(14,C=0),M()},se=Ae=>oe("time"),ee=Ae=>oe("price"),N=(Ae,$e)=>!$e.altKey&&re(Ae);function ue(){V=Gt(this.value),n(0,V),n(3,o),n(2,D),n(1,$),n(4,i)}function We(){D=Fs(this),n(2,D)}let ze=()=>{Xe(po,i=void 0,i),n(8,v=""),n(7,g="all")};return t.$$.update=()=>{t.$$.dirty[0]&16|t.$$.dirty[1]&32&&i&&M(),t.$$.dirty[0]&16&&(i?n(18,he=void 0):Xe(ho,o=void 0,o)),t.$$.dirty[0]&15&&(gt(),n(0,V=gt(V,0,2147483646)),n(1,$=o?gt((parseInt(V)||0)*(D&&o.stacks||1),0,2147483646):0),n(15,z=Number.isInteger($)?Q6($):0),n(16,q=Number.isInteger($)&&$>0&&o&&o.canBeTraded())),t.$$.dirty[1]&16&&ye()},[V,$,D,o,i,f,m,g,v,b,k,y,F,A,C,z,q,Z,he,l,a,c,u,M,L,O,j,we,re,le,ve,_e,Ie,oe,Ee,s,r,K,Re,Ge,Qe,Ye,pe,ce,Oe,se,ee,N,ue,We,ze]}var sv=class extends Ce{constructor(e){super(),Pe(this,e,wV,xV,Be,{},null,[-1,-1])}},sF=sv;var Sd=[{name:"Year",days:365,price:9e3},{name:"Month",days:30,price:900}],Nn=[{sub:!1,stash:15,inventory:15,auction:10,auctionHours:12},{sub:!0,stash:100,inventory:25,auction:100,auctionHours:24}];function oF(t,e,n){let s=t.slice();return s[41]=e[n],s}function iF(t,e,n){let s=t.slice();return s[44]=e[n],s}function rF(t){let e,n;return e=new $t({props:{origin:"left top",defaultOffset:[3,100],title:"Stash",settings:[{name:"Stash Settings",fun:t[33]}],icon:"bag",$$slots:{default:[MV]},$$scope:{ctx:t}}}),e.$on("close",t[34]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o[0]&2048&&(i.settings=[{name:"Stash Settings",fun:s[33]}]),o[0]&131071|o[1]&65536&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function lF(t){let e,n,s,o,i,r,l,a=["Ungrouped","Grouped","Groups + Titles"][t[14]]+"",c,f,u,m;return{c(){e=h("div"),n=h("small"),n.textContent="Width",s=h("input"),o=h("small"),o.textContent="Height",i=h("input"),r=h("div"),l=h("small"),c=T(a),p(n,"class","btn textsecondary"),p(s,"type","range"),p(s,"min","7"),p(s,"max","20"),p(o,"class","btn textsecondary"),p(i,"type","range"),p(i,"min","50"),p(i,"max","500"),p(l,"class",f="btn grey text"+["white","green","cyan"][t[14]]+" svelte-gou6xs"),p(e,"class","panel-black bar-top-config svelte-gou6xs")},m(g,v){w(g,e,v),d(e,n),d(e,s),je(s,t[12]),d(e,o),d(e,i),je(i,t[13]),d(e,r),d(e,l),d(l,c),u||(m=[H(s,"change",t[25]),H(s,"input",t[25]),H(i,"change",t[26]),H(i,"input",t[26]),H(l,"click",t[27])],u=!0)},p(g,v){v[0]&4096&&je(s,g[12]),v[0]&8192&&je(i,g[13]),v[0]&16384&&a!==(a=["Ungrouped","Grouped","Groups + Titles"][g[14]]+"")&&G(c,a),v[0]&16384&&f!==(f="btn grey text"+["white","green","cyan"][g[14]]+" svelte-gou6xs")&&p(l,"class",f)},d(g){g&&x(e),u=!1,rt(m)}}}function aF(t){let e,n=t[41].name+"",s;return{c(){e=h("small"),s=T(n),p(e,"class","textprimary"),Le(e,"display","block"),Le(e,"font-size","10px"),Le(e,"text-transform","uppercase"),Le(e,"letter-spacing","0.1em")},m(o,i){w(o,e,i),d(e,s)},p(o,i){i[0]&16864&&n!==(n=o[41].name+"")&&G(s,n)},d(o){o&&x(e)}}}function cF(t){let e,n;return e=new ws({props:{descPos:"left:100%;top:0;",shift:t[15],descRoot:t[3],pickable:!1,text:t[19](t[44].temp?t[44].temp.getStashTime():0),item:t[44],filter:!t[9]||(!t[44].temp||t[44].temp.getStashTime()>t[4]||"")||t[6].includes(t[44])?!0:""}}),e.$on("click",function(){Oo(t[6].includes(t[44])?void 0:t[20])&&(t[6].includes(t[44])?void 0:t[20]).apply(this,arguments)}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){t=s;let i={};o[0]&32768&&(i.shift=t[15]),o[0]&8&&(i.descRoot=t[3]),o[0]&16864&&(i.text=t[19](t[44].temp?t[44].temp.getStashTime():0)),o[0]&16864&&(i.item=t[44]),o[0]&17392&&(i.filter=!t[9]||(!t[44].temp||t[44].temp.getStashTime()>t[4]||"")||t[6].includes(t[44])?!0:""),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function fF(t){let e,n,s=t[14]===2&&t[41].stores.length>0&&aF(t),o=me(t[41].stores),i=[];for(let l=0;l<o.length;l+=1)i[l]=cF(iF(t,o,l));let r=l=>E(i[l],1,1,()=>{i[l]=null});return{c(){s&&s.c(),e=h("div");for(let l=0;l<i.length;l+=1)i[l].c();p(e,"class","slotcontainer svelte-gou6xs"),Le(e,"width",t[8].length?"fit-content":"auto"),Le(e,"grid-template-columns","repeat("+Math.min(t[8].length,t[12])+", auto)")},m(l,a){s&&s.m(l,a),w(l,e,a);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null);n=!0},p(l,a){if(l[14]===2&&l[41].stores.length>0?s?s.p(l,a):(s=aF(l),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null),a[0]&1623032){o=me(l[41].stores);let c;for(c=0;c<o.length;c+=1){let f=iF(l,o,c);i[c]?(i[c].p(f,a),S(i[c],1)):(i[c]=cF(f),i[c].c(),S(i[c],1),i[c].m(e,null))}for(Me(),c=o.length;c<i.length;c+=1)r(c);Fe()}(!n||a[0]&256)&&Le(e,"width",l[8].length?"fit-content":"auto"),(!n||a[0]&4352)&&Le(e,"grid-template-columns","repeat("+Math.min(l[8].length,l[12])+", auto)")},i(l){if(!n){for(let a=0;a<o.length;a+=1)S(i[a]);n=!0}},o(l){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)E(i[a]);n=!1},d(l){l&&x(e),s&&s.d(l),st(i,l)}}}function uF(t){let e,n,s;return{c(){e=h("span"),e.innerHTML='Upgrade <img class="svgicon texticon" src="/data/ui/icons/gem.svg?v=8685122"/>',p(e,"class","btn textwhite")},m(o,i){w(o,e,i),n||(s=H(e,"click",t[29]),n=!0)},p:ae,d(o){o&&x(e),n=!1,s()}}}function mF(t){let e,n,s=(t[0]===1?P.ui.stash.deposit:P.ui.stash.withdraw)+"",o,i,r,l,a,c,f,u,m=(t[0]===1?P.ui.stash.deposit:P.ui.stash.withdraw)+"",g,v,_,b,k;return r=new xn({props:{amount:t[0]>0?t[1]:0}}),{c(){e=h("div"),n=h("span"),o=T(s),i=Ne(),J(r.$$.fragment),l=T(" ?"),a=h("div"),c=h("input"),f=h("div"),f.textContent="Max",u=h("div"),g=T(m),Le(c,"width","150px"),p(c,"class","navbtn formatted"),p(c,"type","number"),p(f,"class","btn navbtn cyan formatted"),p(u,"class",v="btn navbtn "+(!t[9]||t[1]<=0?"disabled":"")+" "+(t[0]===1?"blue":"green")+" formatted"),p(a,"class","marg-top formelements svelte-gou6xs"),p(e,"class","panel-black marg-top"),Le(e,"text-align","right")},m(y,F){w(y,e,F),d(e,n),d(n,o),d(n,i),X(r,n,null),d(n,l),d(e,a),d(a,c),je(c,t[1]),d(a,f),d(a,u),d(u,g),_=!0,b||(k=[H(c,"input",t[32]),H(f,"click",t[22]),H(u,"click",t[21])],b=!0)},p(y,F){(!_||F[0]&1)&&s!==(s=(y[0]===1?P.ui.stash.deposit:P.ui.stash.withdraw)+"")&&G(o,s);let A={};F[0]&3&&(A.amount=y[0]>0?y[1]:0),r.$set(A),F[0]&2&&Gt(c.value)!==y[1]&&je(c,y[1]),(!_||F[0]&1)&&m!==(m=(y[0]===1?P.ui.stash.deposit:P.ui.stash.withdraw)+"")&&G(g,m),(!_||F[0]&515&&v!==(v="btn navbtn "+(!y[9]||y[1]<=0?"disabled":"")+" "+(y[0]===1?"blue":"green")+" formatted"))&&p(u,"class",v)},i(y){_||(S(r.$$.fragment,y),_=!0)},o(y){E(r.$$.fragment,y),_=!1},d(y){y&&x(e),Q(r),b=!1,rt(k)}}}function MV(t){let e,n,s,o,i=t[8].length+"",r,l,a=(t[10].subscribed_until?Nn[1].stash:Nn[0].stash)+"",c,f,u,m,g,v,_,b,k,y,F,A,C,M,V,$,D=t[11]&&lF(t),z=me(t[14]<1?[{stores:t[8],name:""}]:[{stores:t[5],name:I.player.name},{stores:t[7],name:"Account Wide"},{stores:t[6],name:"Other characters"}]),q=[];for(let R=0;R<z.length;R+=1)q[R]=fF(oF(t,z,R));let L=R=>E(q[R],1,1,()=>{q[R]=null}),O=!t[10].subscribed_until&&uF(t);m=new xn({props:{amount:t[2].gold}});let j=t[0]>0&&mF(t);return{c(){D&&D.c(),e=h("div");for(let R=0;R<q.length;R+=1)q[R].c();n=h("div"),s=h("div"),o=h("span"),r=T(i),l=T(" / "),c=T(a),O&&O.c(),u=h("div"),J(m.$$.fragment),g=h("div"),v=h("img"),k=h("div"),y=h("img"),j&&j.c(),C=de(),p(e,"class","panel-black scrollbar marg-top marg-bot slotparent svelte-gou6xs"),Le(e,"max-height",t[13]+"px"),p(o,"class",f=t[8].length<(t[10].subscribed_until?Nn[1].stash:Nn[0].stash)?"textgreen":"textred"),p(s,"class","navbtn panel-black border black gold svelte-gou6xs"),Le(s,"margin-right","auto"),p(u,"class","navbtn panel-black border black gold svelte-gou6xs"),p(v,"class","svgicon"),at(v.src,_="/data/ui/icons/deposit.svg?v=8685122")||p(v,"src",_),p(g,"class",b="navbtn btn grey gold "+(t[0]===1?"active":"")+" svelte-gou6xs"),p(y,"class","svgicon"),at(y.src,F="/data/ui/icons/withdraw.svg?v=8685122")||p(y,"src",F),p(k,"class",A="navbtn btn grey gold "+(t[0]===2?"active":"")+" svelte-gou6xs"),p(n,"class","formelements svelte-gou6xs")},m(R,U){D&&D.m(R,U),w(R,e,U);for(let Z=0;Z<q.length;Z+=1)q[Z]&&q[Z].m(e,null);t[28](e),w(R,n,U),d(n,s),d(s,o),d(o,r),d(o,l),d(o,c),O&&O.m(o,null),d(n,u),X(m,u,null),d(n,g),d(g,v),d(n,k),d(k,y),j&&j.m(R,U),w(R,C,U),M=!0,V||($=[H(e,"pointerup",t[18]),H(g,"click",t[30]),H(k,"click",t[31])],V=!0)},p(R,U){if(R[11]?D?D.p(R,U):(D=lF(R),D.c(),D.m(e.parentNode,e)):D&&(D.d(1),D=null),U[0]&1627128){z=me(R[14]<1?[{stores:R[8],name:""}]:[{stores:R[5],name:I.player.name},{stores:R[7],name:"Account Wide"},{stores:R[6],name:"Other characters"}]);let ye;for(ye=0;ye<z.length;ye+=1){let we=oF(R,z,ye);q[ye]?(q[ye].p(we,U),S(q[ye],1)):(q[ye]=fF(we),q[ye].c(),S(q[ye],1),q[ye].m(e,null))}for(Me(),ye=z.length;ye<q.length;ye+=1)L(ye);Fe()}(!M||U[0]&8192)&&Le(e,"max-height",R[13]+"px"),(!M||U[0]&256)&&i!==(i=R[8].length+"")&&G(r,i),(!M||U[0]&1024)&&a!==(a=(R[10].subscribed_until?Nn[1].stash:Nn[0].stash)+"")&&G(c,a),R[10].subscribed_until?O&&(O.d(1),O=null):O?O.p(R,U):(O=uF(R),O.c(),O.m(o,null)),(!M||U[0]&1280&&f!==(f=R[8].length<(R[10].subscribed_until?Nn[1].stash:Nn[0].stash)?"textgreen":"textred"))&&p(o,"class",f);let Z={};U[0]&4&&(Z.amount=R[2].gold),m.$set(Z),(!M||U[0]&1&&b!==(b="navbtn btn grey gold "+(R[0]===1?"active":"")+" svelte-gou6xs"))&&p(g,"class",b),(!M||U[0]&1&&A!==(A="navbtn btn grey gold "+(R[0]===2?"active":"")+" svelte-gou6xs"))&&p(k,"class",A),R[0]>0?j?(j.p(R,U),U[0]&1&&S(j,1)):(j=mF(R),j.c(),S(j,1),j.m(C.parentNode,C)):j&&(Me(),E(j,1,1,()=>{j=null}),Fe())},i(R){if(!M){for(let U=0;U<z.length;U+=1)S(q[U]);S(m.$$.fragment,R),S(j),M=!0}},o(R){q=q.filter(Boolean);for(let U=0;U<q.length;U+=1)E(q[U]);E(m.$$.fragment,R),E(j),M=!1},d(R){R&&(x(e),x(n),x(C)),D&&D.d(R),st(q,R),t[28](null),O&&O.d(),Q(m),j&&j.d(R),V=!1,rt($)}}}function FV(t){let e,n,s=t[2]&&t[10]&&rF(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,i){o[2]&&o[10]?s?(s.p(o,i),i[0]&1028&&S(s,1)):(s=rF(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function CV(t,e,n){let s,o,i,r,l,a,c,f,u,m,g;ie(t,Rs,K=>n(2,s=K)),ie(t,Qs,K=>n(23,o=K)),ie(t,In,K=>n(37,i=K)),ie(t,wm,K=>n(24,r=K)),ie(t,da,K=>n(10,l=K)),ie(t,af,K=>n(11,a=K)),ie(t,Xi,K=>n(12,c=K)),ie(t,Qi,K=>n(13,f=K)),ie(t,ka,K=>n(14,u=K)),ie(t,zs,K=>n(16,g=K));let v=nt.shift.store;ie(t,v,K=>n(15,m=K));let _,b,k={},y=[],F=[],A=[],C=[],M=!1,V,$=async()=>{if(n(4,b=Date.now()),r.all.length){let K=await fetch("/api/item/getStash",{method:"POST",body:JSON.stringify({ids:r.all.map(Ge=>Ge.dbid)})}),Re=await K.json();if(Re==="error"||K.ok===!1)console.error(Re);else{n(8,C.length=n(5,y.length=n(6,F.length=0,F),y),C),n(7,A.length=0,A);let Ge=new Map(r.all.map(Ye=>[Ye.dbid,Ye])),Qe=new Map(Re.map(Ye=>[Ye.id,Ye]));r.all.forEach(Ye=>{let pe=Qe.get(Ye.dbid);pe&&(pe.store=k[pe.id]||(k[pe.id]=te()),r.other.find(ce=>ce.dbid===pe.id)?F.push(pe.store):r.self.find(ce=>ce.dbid===pe.id)?y.push(pe.store):A.push(pe.store),C.push(pe.store),Ge.has(pe.id)&&(Ge.get(pe.id).hydrate(pe),pe.store.temp=Ge.get(pe.id)))})}}else n(8,C.length=n(5,y.length=n(6,F.length=0,F),y),C),n(7,A.length=0,A);Z()},D=K=>{i&&(yt("itemstash",`${i.meta.slot}`),Xe(In,i=void 0,i))},z=K=>K<b?void 0:`${Math.ceil((K-b)/6e4)}m`,q=K=>{M&&(K.detail.item.getStashTime()>Date.now()?Nt("system",P.ui.stash.waitunstash):(yt("itemunstash",K.detail.item.dbid+""),U()))},L=K=>{M&&(yt("goldstash",j===1?R+"":-R+""),U())},O=()=>{n(1,R=j===1?o:s.gold)},j=2,R=0,U=()=>{n(9,M=!1),V=setTimeout(()=>{n(9,M=!0)},500)},Z=()=>{n(9,M=!0),V&&(clearTimeout(V),V=void 0)};function ye(){c=Gt(this.value),Xi.set(c)}function we(){f=Gt(this.value),Qi.set(f)}let he=K=>Xe(ka,u=Xe(ka,++u,u)%3,u);function re(K){qt[K?"unshift":"push"](()=>{_=K,n(3,_)})}let le=K=>Xe(zs,g=!0,g),ve=K=>n(0,j=1),_e=K=>n(0,j=2);function Ie(){R=Gt(this.value),n(1,R),n(2,s),n(0,j),n(23,o)}let oe=()=>{Xe(af,a=!a,a)},Ee=K=>Xe(Rs,s=!1,s);return t.$$.update=()=>{t.$$.dirty[0]&16777216&&$(),t.$$.dirty[0]&8388615&&n(1,R=s?Math.min(j===1?o:s.gold,R):0)},[j,R,s,_,b,y,F,A,C,M,l,a,c,f,u,m,g,v,D,z,q,L,O,o,r,ye,we,he,re,le,ve,_e,Ie,oe,Ee]}var ov=class extends Ce{constructor(e){super(),Pe(this,e,CV,FV,Be,{},null,[-1,-1])}},pF=ov;function SV(t,e,n){let s=t.slice();return s[7]=e[n],s[9]=n,s}function dF(t,e,n){let s=t.slice();return s[10]=e[n],s}function hF(t){let e,n;return e=new $t({props:{origin:"center",title:P.npcs.trader.name,icon:"bag",$$slots:{default:[DV]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&8195&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function gF(t){let e,n;return e=new ws({props:{id:"trader"+t[10][0].buyid,descPos:"left:100%;top:0;",descRoot:t[0],isTrader:!0,pickable:!1,item:t[10][1]}}),e.$on("click",t[4]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&1&&(i.descRoot=s[0]),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function PV(t){let e,n;return e=new ws({props:{isTrader:!0}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p:ae,i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function AV(t){let e;return{c(){e=h("span"),e.textContent=`${P.npcs.trader.select}`,p(e,"class","textgrey")},m(n,s){w(n,e,s)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function TV(t){let e,n,s,o,i,r=[IV,EV],l=[];function a(c,f){return f&2&&(e=null),e==null&&(e=!!c[1].data.canBeSold()),e?0:1}return n=a(t,-1),s=l[n]=r[n](t),{c(){s.c(),o=de()},m(c,f){l[n].m(c,f),w(c,o,f),i=!0},p(c,f){let u=n;n=a(c,f),n===u?l[n].p(c,f):(Me(),E(l[u],1,1,()=>{l[u]=null}),Fe(),s=l[n],s?s.p(c,f):(s=l[n]=r[n](c),s.c()),S(s,1),s.m(o.parentNode,o))},i(c){i||(S(s),i=!0)},o(c){E(s),i=!1},d(c){c&&x(o),l[n].d(c)}}}function EV(t){let e;return{c(){e=h("span"),e.textContent=`${P.npcs.trader.refuse}`,p(e,"class","textred")},m(n,s){w(n,e,s)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function IV(t){let e,n;return e=new xn({props:{amount:t[1].data.goldValue()}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&2&&(i.amount=s[1].data.goldValue()),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function DV(t){let e,n,s,o,i,r,l,a,c,f,u,m,g,v=me(I.player.getTargetEntity().items),_=[];for(let M=0;M<v.length;M+=1)_[M]=gF(dF(t,v,M));let b=M=>E(_[M],1,1,()=>{_[M]=null}),k=me(Array(24-I.player.getTargetEntity().items.length)),y=[];for(let M=0;M<k.length;M+=1)y[M]=PV(SV(t,k,M));let F=[TV,AV],A=[];function C(M,V){return M[1]&&M[1].meta.type==="item"?0:1}return c=C(t,-1),f=A[c]=F[c](t),{c(){e=h("div"),n=h("p"),n.textContent=`${P.npcs.trader.buy}`,s=h("div");for(let M=0;M<_.length;M+=1)_[M].c();o=de();for(let M=0;M<y.length;M+=1)y[M].c();i=h("div"),r=h("p"),r.textContent=`${P.npcs.trader.info}`,l=h("p"),l.textContent=`${P.npcs.trader.price}`,a=h("span"),f.c(),p(n,"class","textprimary textcenter"),p(s,"class","panel-black slotcontainer svelte-12uytpc"),p(r,"class","textprimary"),p(a,"class","panel-black formatted info svelte-12uytpc"),p(i,"class","textcenter"),p(e,"class","container svelte-12uytpc")},m(M,V){w(M,e,V),d(e,n),d(e,s);for(let $=0;$<_.length;$+=1)_[$]&&_[$].m(s,null);d(s,o);for(let $=0;$<y.length;$+=1)y[$]&&y[$].m(s,null);d(e,i),d(i,r),d(i,l),d(i,a),A[c].m(a,null),t[5](e),u=!0,m||(g=H(e,"pointerup",t[3]),m=!0)},p(M,V){if(V&17){v=me(I.player.getTargetEntity().items);let D;for(D=0;D<v.length;D+=1){let z=dF(M,v,D);_[D]?(_[D].p(z,V),S(_[D],1)):(_[D]=gF(z),_[D].c(),S(_[D],1),_[D].m(s,o))}for(Me(),D=v.length;D<_.length;D+=1)b(D);Fe()}let $=c;c=C(M,V),c===$?A[c].p(M,V):(Me(),E(A[$],1,1,()=>{A[$]=null}),Fe(),f=A[c],f?f.p(M,V):(f=A[c]=F[c](M),f.c()),S(f,1),f.m(a,null))},i(M){if(!u){for(let V=0;V<v.length;V+=1)S(_[V]);for(let V=0;V<k.length;V+=1)S(y[V]);S(f),u=!0}},o(M){_=_.filter(Boolean);for(let V=0;V<_.length;V+=1)E(_[V]);y=y.filter(Boolean);for(let V=0;V<y.length;V+=1)E(y[V]);E(f),u=!1},d(M){M&&x(e),st(_,M),st(y,M),A[c].d(),t[5](null),m=!1,g()}}}function VV(t){let e,n,s=t[2]&&hF(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[2]?s?(s.p(o,i),i&4&&S(s,1)):(s=hF(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function LV(t,e,n){let s,o;ie(t,In,f=>n(1,s=f)),ie(t,Zs,f=>n(2,o=f));let i=f=>{s&&s.meta&&s.meta.type==="item"&&s.data.canBeSold()&&Jf(s.data.quality,s.data.upgrade,s.meta.slot,s.data.type,s.data.tier),Xe(In,s=void 0,s)},r=f=>{yt("itemtraderbuy",`${f.detail.item.buyid}`)},l;function a(f){qt[f?"unshift":"push"](()=>{l=f,n(0,l)})}return[l,s,o,i,r,a,f=>Xe(Zs,o=!1,o)]}var iv=class extends Ce{constructor(e){super(),Pe(this,e,LV,VV,Be,{})}},vF=iv;function _F(t,e,n){let s=t.slice();return s[15]=e[n],s[17]=n,s}function bF(t,e,n){let s=t.slice();return s[18]=e[n],s[17]=n,s}function yF(t,e,n){let s=t.slice();return s[20]=e[n],s}function qV(t){let e,n,s;return{c(){e=h("div"),n=T("Auto Invite"),p(e,"class",s=t[18].lvldiff?"textgrey":"textcyan")},m(o,i){w(o,e,i),d(e,n)},p(o,i){i&4&&s!==(s=o[18].lvldiff?"textgrey":"textcyan")&&p(e,"class",s)},i:ae,o:ae,d(o){o&&x(e)}}}function RV(t){let e,n;return e=new Xn({props:{name:t[18].leadername,level:t[18].leaderlevel,pclass:t[18].leaderclass,faction:t[18].faction}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&4&&(i.name=s[18].leadername),o&4&&(i.level=s[18].leaderlevel),o&4&&(i.pclass=s[18].leaderclass),o&4&&(i.faction=s[18].faction),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function kF(t){let e,n,s,o=t[18].classcount[t[20]]+"",i,r;return{c(){e=h("div"),n=h("div"),n.innerHTML=`<img class="texticon" src="${ni(t[20])}"/>`,s=h("b"),i=T(o),p(s,"class",r=t[18].classcount[t[20]]>0?"textprimary":"textgrey")},m(l,a){w(l,e,a),d(e,n),d(e,s),d(s,i)},p(l,a){a&4&&o!==(o=l[18].classcount[l[20]]+"")&&G(i,o),a&4&&r!==(r=l[18].classcount[l[20]]>0?"textprimary":"textgrey")&&p(s,"class",r)},d(l){l&&x(e)}}}function xF(t){let e,n,s,o=t[18].message+"",i,r,l=t[4][t[18].activity]+"",a,c,f,u,m,g=t[18].minlevel+"",v,_,b=t[18].maxlevel+"",k,y,F,A,C,M,V=t[18].totalcount+"",$,D,z,q,L,O,j,R,U=[RV,qV],Z=[];function ye(ve,_e){return ve[18].auto?1:0}F=ye(t,-1),A=Z[F]=U[F](t);let we=me([0,1,2,3]),he=[];for(let ve=0;ve<4;ve+=1)he[ve]=kF(yF(t,we,ve));function re(...ve){return t[10](t[18],...ve)}function le(...ve){return t[11](t[18],...ve)}return{c(){e=h("div"),n=h("div"),s=h("div"),i=T(o),r=h("div"),a=T(l),c=h("div"),f=h("div"),u=T("Lv. "),m=h("span"),v=T(g),_=T(" - "),k=T(b),A.c(),C=h("div"),M=h("b"),$=T(V),D=T(" / 10"),q=h("div");for(let ve=0;ve<4;ve+=1)he[ve].c();p(s,"class","textprimary"),p(r,"class","textgrey textsmall"),Le(n,"text-overflow","ellipsis"),Le(n,"white-space","nowrap"),Le(n,"overflow","hidden"),p(m,"class",y=t[18].auto&&t[18].lvldiff?"textgrey":"textgreen"),p(f,"class","textgrey"),p(c,"class","textcenter"),p(M,"class",z=t[18].totalcount>=10?"textred":"textgreen"),p(C,"class","textcenter"),p(q,"class","grid four textcenter"),p(e,"class",L="panel-black listing marg-bot "+(t[1]===t[18]?"selected":t[5][t[18].applied])+" svelte-3fcblv")},m(ve,_e){w(ve,e,_e),d(e,n),d(n,s),d(s,i),d(n,r),d(r,a),d(e,c),d(c,f),d(f,u),d(f,m),d(m,v),d(m,_),d(m,k),Z[F].m(c,null),d(e,C),d(C,M),d(M,$),d(M,D),d(e,q);for(let Ie=0;Ie<4;Ie+=1)he[Ie]&&he[Ie].m(q,null);O=!0,j||(R=[H(e,"click",re),H(e,"contextmenu",le)],j=!0)},p(ve,_e){t=ve,(!O||_e&4)&&o!==(o=t[18].message+"")&&G(i,o),(!O||_e&4)&&l!==(l=t[4][t[18].activity]+"")&&G(a,l),(!O||_e&4)&&g!==(g=t[18].minlevel+"")&&G(v,g),(!O||_e&4)&&b!==(b=t[18].maxlevel+"")&&G(k,b),(!O||_e&4&&y!==(y=t[18].auto&&t[18].lvldiff?"textgrey":"textgreen"))&&p(m,"class",y);let Ie=F;if(F=ye(t,_e),F===Ie?Z[F].p(t,_e):(Me(),E(Z[Ie],1,1,()=>{Z[Ie]=null}),Fe(),A=Z[F],A?A.p(t,_e):(A=Z[F]=U[F](t),A.c()),S(A,1),A.m(c,null)),(!O||_e&4)&&V!==(V=t[18].totalcount+"")&&G($,V),(!O||_e&4&&z!==(z=t[18].totalcount>=10?"textred":"textgreen"))&&p(M,"class",z),_e&4){we=me([0,1,2,3]);let oe;for(oe=0;oe<4;oe+=1){let Ee=yF(t,we,oe);he[oe]?he[oe].p(Ee,_e):(he[oe]=kF(Ee),he[oe].c(),he[oe].m(q,null))}for(;oe<4;oe+=1)he[oe].d(1)}(!O||_e&6&&L!==(L="panel-black listing marg-bot "+(t[1]===t[18]?"selected":t[5][t[18].applied])+" svelte-3fcblv"))&&p(e,"class",L)},i(ve){O||(S(A),O=!0)},o(ve){E(A),O=!1},d(ve){ve&&x(e),Z[F].d(),st(he,ve),j=!1,rt(R)}}}function wF(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[15]}`,e.__value=n=t[17],je(e,e.__value)},m(s,o){w(s,e,o)},p:ae,d(s){s&&x(e)}}}function zV(t){let e,n,s,o,i,r,l,a,c;return{c(){e=h("div"),n=h("div"),s=T("\u{1F64B} Apply"),i=h("div"),r=T("\u{1F50E} Refresh"),p(n,"id","partyapply"),p(n,"class",o="btn textcenter "+(t[1]&&t[1].applied===0?"green":"disabled")),p(i,"class",l="btn textcenter "+(t[0]?"disabled":"cyan")),p(e,"class","panel-black grid two")},m(f,u){w(f,e,u),d(e,n),d(n,s),d(e,i),d(i,r),a||(c=[H(n,"click",t[7]),H(i,"click",t[6])],a=!0)},p(f,u){u&2&&o!==(o="btn textcenter "+(f[1]&&f[1].applied===0?"green":"disabled"))&&p(n,"class",o),u&1&&l!==(l="btn textcenter "+(f[0]?"disabled":"cyan"))&&p(i,"class",l)},d(f){f&&x(e),a=!1,rt(c)}}}function BV(t){let e;return{c(){e=h("div"),e.textContent="You are in a party.",p(e,"class","textcenter panel-black textgrey")},m(n,s){w(n,e,s)},p:ae,d(n){n&&x(e)}}}function $V(t){let e,n,s,o,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A,C=me(t[2].parties.filter(t[9])),M=[];for(let O=0;O<C.length;O+=1)M[O]=xF(bF(t,C,O));let V=O=>E(M[O],1,1,()=>{M[O]=null}),$=me(t[4]),D=[];for(let O=0;O<$.length;O+=1)D[O]=wF(_F(t,$,O));function z(O,j){return O[3].membercount>0?BV:zV}let q=z(t,-1),L=q(t);return{c(){e=h("div"),n=h("div");for(let O=0;O<M.length;O+=1)M[O].c();s=h("div"),o=h("div"),i=h("small"),i.textContent="Filter Party Listings",r=h("div"),l=h("small"),l.textContent="Activity",a=h("select"),c=h("option"),c.textContent="All";for(let O=0;O<D.length;O+=1)D[O].c();u=h("small"),u.textContent="Show Full",m=h("small"),v=h("small"),v.textContent="Show Auto Inv.",_=h("small"),k=Ne(),L.c(),p(n,"class","listcontainer scrollbar border grey svelte-3fcblv"),Le(n,"font-size","0.9em"),p(i,"class","textprimary"),c.__value=f=-1,je(c,c.__value),p(a,"class","btn grey small"),t[2].filterActivity===void 0&&bn(()=>t[12].call(a)),p(m,"class",g="btn checkbox "+(t[2].showFull?"active":"")),p(_,"class",b="btn checkbox "+(t[2].showAuto?"active":"")),p(r,"class","grid two search svelte-3fcblv"),p(o,"class","panel-black"),p(s,"class","grid"),Le(s,"grid-template-rows","1fr auto"),p(e,"class","layout svelte-3fcblv")},m(O,j){w(O,e,j),d(e,n);for(let R=0;R<M.length;R+=1)M[R]&&M[R].m(n,null);d(e,s),d(s,o),d(o,i),d(o,r),d(r,l),d(r,a),d(a,c);for(let R=0;R<D.length;R+=1)D[R]&&D[R].m(a,null);Mn(a,t[2].filterActivity,!0),d(r,u),d(r,m),d(r,v),d(r,_),d(s,k),L.m(s,null),y=!0,F||(A=[H(a,"change",t[12]),H(m,"click",t[13]),H(_,"click",t[14])],F=!0)},p(O,[j]){if(j&310){C=me(O[2].parties.filter(O[9]));let R;for(R=0;R<C.length;R+=1){let U=bF(O,C,R);M[R]?(M[R].p(U,j),S(M[R],1)):(M[R]=xF(U),M[R].c(),S(M[R],1),M[R].m(n,null))}for(Me(),R=C.length;R<M.length;R+=1)V(R);Fe()}if(j&16){$=me(O[4]);let R;for(R=0;R<$.length;R+=1){let U=_F(O,$,R);D[R]?D[R].p(U,j):(D[R]=wF(U),D[R].c(),D[R].m(a,null))}for(;R<D.length;R+=1)D[R].d(1);D.length=$.length}j&4&&Mn(a,O[2].filterActivity),(!y||j&4&&g!==(g="btn checkbox "+(O[2].showFull?"active":"")))&&p(m,"class",g),(!y||j&4&&b!==(b="btn checkbox "+(O[2].showAuto?"active":"")))&&p(_,"class",b),q===(q=z(O,j))&&L?L.p(O,j):(L.d(1),L=q(O),L&&(L.c(),L.m(s,null)))},i(O){if(!y){for(let j=0;j<C.length;j+=1)S(M[j]);y=!0}},o(O){M=M.filter(Boolean);for(let j=0;j<M.length;j+=1)E(M[j]);y=!1},d(O){O&&x(e),st(M,O),st(D,O),L.d(),F=!1,rt(A)}}}function UV(t,e,n){let s,o;ie(t,ra,y=>n(2,s=y)),ie(t,es,y=>n(3,o=y));let i=P.ui.party.activities,r=["","applied","denied"],l=!1,a,c=async()=>{n(0,l=!0);let y=await Ft("/api/party/getlistedparties",{},()=>{});y.forEach(F=>{F.totalcount=F.classcount.reduce((A,C)=>A+C,0),F.auto=F.leadername===null,F.lvldiff=F.auto?I.player.level<F.minlevel||I.player.level>F.maxlevel:!1}),Xe(ra,s.parties=y,s),a&&n(1,a=y.find(F=>F.party===a.party)),setTimeout(()=>n(0,l=!1),200)};c();let f=()=>{a&&(n(1,a.applied=1,a),Ft("/api/party/makeapplication",{party:a.party,message:""},()=>{}),n(1,a=void 0),an(29,100))},u=(y,F)=>{F.leadername!==null&&dn.set({x:y.pageX,y:y.pageY,opts:[{name:F.leadername,css:"disabled"},Wt.whisper(F.leadername)]})},m=y=>(s.filterActivity===-1||y.activity===s.filterActivity)&&(s.showAuto||!y.auto)&&(s.showFull||y.totalcount<10),g=(y,F)=>n(1,a=y),v=(y,F)=>u(F,y);function _(){s.filterActivity=Fs(this),ra.set(s)}return[l,a,s,o,i,r,c,f,u,m,g,v,_,y=>Xe(ra,s.showFull=!s.showFull,s),y=>Xe(ra,s.showAuto=!s.showAuto,s)]}var rv=class extends Ce{constructor(e){super(),Pe(this,e,UV,$V,Be,{})}},MF=rv;var Pd=async t=>{let e;try{e=await Ft("/api/party/getpartystate",{},()=>{})}catch{e=void 0}e&&Xs.update(n=>{let s=!1;return e.applications.forEach(o=>{n.applications.find(r=>r.player===o.player)||(s=!0)}),n.applications=e.applications,n.message=e.message||n.message||"",n.activity=e.activity||n.activity||0,n.listed=e.listed,ph(n.listed),n.flashing=s&&!fe.partyOpen,n})};function FF(t,e,n){let s=t.slice();return s[14]=e[n],s[16]=n,s}function CF(t,e,n){let s=t.slice();return s[17]=e[n],s[16]=n,s}function OV(t){let e,n,s,o=me(t[1].applications),i=[];for(let l=0;l<o.length;l+=1)i[l]=SF(CF(t,o,l));let r=l=>E(i[l],1,1,()=>{i[l]=null});return{c(){e=h("table"),n=h("tbody");for(let l=0;l<i.length;l+=1)i[l].c();p(e,"class","dense"),Le(e,"width","100%"),Le(e,"table-layout","fixed")},m(l,a){w(l,e,a),d(e,n);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(n,null);s=!0},p(l,a){if(a&226){o=me(l[1].applications);let c;for(c=0;c<o.length;c+=1){let f=CF(l,o,c);i[c]?(i[c].p(f,a),S(i[c],1)):(i[c]=SF(f),i[c].c(),S(i[c],1),i[c].m(n,null))}for(Me(),c=o.length;c<i.length;c+=1)r(c);Fe()}},i(l){if(!s){for(let a=0;a<o.length;a+=1)S(i[a]);s=!0}},o(l){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)E(i[a]);s=!1},d(l){l&&x(e),st(i,l)}}}function NV(t){let e;function n(i,r){return i[1].listed?WV:jV}let s=n(t,-1),o=s(t);return{c(){e=h("p"),o.c(),p(e,"class","textcenter textgrey")},m(i,r){w(i,e,r),o.m(e,null)},p(i,r){s!==(s=n(i,r))&&(o.d(1),o=s(i),o&&(o.c(),o.m(e,null)))},i:ae,o:ae,d(i){i&&x(e),o.d()}}}function SF(t){let e,n,s,o,i=t[17].gearscore+"",r,l,a,c,f,u,m,g,v,_,b;s=new Xn({props:{name:t[17].name,level:t[17].level,pclass:t[17].class,faction:t[17].faction}});function k(...A){return t[8](t[17],...A)}function y(...A){return t[9](t[17],...A)}function F(...A){return t[10](t[17],...A)}return{c(){e=h("tr"),n=h("td"),J(s.$$.fragment),o=h("td"),r=T(i),l=T(" GS"),a=h("td"),c=T("\u{1F91D}"),u=h("td"),m=T("\u274C"),p(n,"width","50%"),p(o,"width","20%"),p(o,"class","textcenter textcyan"),p(a,"width","15%"),p(a,"class",f="textcenter accept "+(t[17].invited?"active":"")+" svelte-6mz3cb"),p(u,"width","15%"),p(u,"class",g="textcenter deny "+(t[17].denied?"active":"")+" svelte-6mz3cb"),p(e,"class","striped"),Le(e,"cursor","unset")},m(A,C){w(A,e,C),d(e,n),X(s,n,null),d(e,o),d(o,r),d(o,l),d(e,a),d(a,c),d(e,u),d(u,m),v=!0,_||(b=[H(a,"click",k),H(u,"click",y),H(e,"contextmenu",F)],_=!0)},p(A,C){t=A;let M={};C&2&&(M.name=t[17].name),C&2&&(M.level=t[17].level),C&2&&(M.pclass=t[17].class),C&2&&(M.faction=t[17].faction),s.$set(M),(!v||C&2)&&i!==(i=t[17].gearscore+"")&&G(r,i),(!v||C&2&&f!==(f="textcenter accept "+(t[17].invited?"active":"")+" svelte-6mz3cb"))&&p(a,"class",f),(!v||C&2&&g!==(g="textcenter deny "+(t[17].denied?"active":"")+" svelte-6mz3cb"))&&p(u,"class",g)},i(A){v||(S(s.$$.fragment,A),v=!0)},o(A){E(s.$$.fragment,A),v=!1},d(A){A&&x(e),Q(s),_=!1,rt(b)}}}function jV(t){let e;return{c(){e=T("List your party to search for players")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function WV(t){let e;return{c(){e=T("Waiting for players...")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function PF(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[14]}`,e.__value=n=t[16],je(e,e.__value)},m(s,o){w(s,e,o)},p:ae,d(s){s&&x(e)}}}function GV(t){let e,n,s,o,i,r,l,a,c,f,u,m,g,v,_,b,k,y=t[1].listed?"\u{1F441}\uFE0F Unlist":"List",F,A,C,M,V,$,D=[NV,OV],z=[];function q(j,R){return j[1].applications.length===0?0:1}s=q(t,-1),o=z[s]=D[s](t);let L=me(t[3]),O=[];for(let j=0;j<L.length;j+=1)O[j]=PF(FF(t,L,j));return{c(){e=h("div"),n=h("div"),o.c(),i=h("div"),r=h("div"),l=h("div"),a=h("small"),a.textContent="Describe your party",c=h("input"),m=h("div"),g=h("small"),g.textContent="Select an activity",v=h("select");for(let j=0;j<O.length;j+=1)O[j].c();b=h("div"),k=h("div"),F=T(y),A=T(" Party"),p(n,"class","listcontainer scrollbar border grey svelte-6mz3cb"),p(a,"class","textprimary"),p(c,"maxlength",f=40),p(c,"class",u="marg-top "+(t[2].role<2||t[1].listed?"disabled":"")),p(c,"type","text"),p(c,"placeholder","Enter Party Message"),p(l,"class","panel-bright"),p(g,"class","textprimary"),p(v,"class",_="btn grey marg-top "+(t[2].role<2||t[1].listed?"disabled":"")),t[1].activity===void 0&&bn(()=>t[12].call(v)),p(m,"class","panel-bright marg-top"),p(r,"class","panel-black "),p(k,"class",C="btn purp textcenter "+(t[2].role<2||t[0]?"disabled":t[1].listed?"active":"")),p(b,"class","panel-black"),p(i,"class","grid"),Le(i,"grid-template-rows","1fr auto"),p(e,"class","layout svelte-6mz3cb")},m(j,R){w(j,e,R),d(e,n),z[s].m(n,null),d(e,i),d(i,r),d(r,l),d(l,a),d(l,c),je(c,t[1].message),d(r,m),d(m,g),d(m,v);for(let U=0;U<O.length;U+=1)O[U]&&O[U].m(v,null);Mn(v,t[1].activity,!0),d(i,b),d(b,k),d(k,F),d(k,A),M=!0,V||($=[H(c,"input",t[11]),H(v,"change",t[12]),H(k,"click",t[4])],V=!0)},p(j,[R]){let U=s;if(s=q(j,R),s===U?z[s].p(j,R):(Me(),E(z[U],1,1,()=>{z[U]=null}),Fe(),o=z[s],o?o.p(j,R):(o=z[s]=D[s](j),o.c()),S(o,1),o.m(n,null)),(!M||R&6&&u!==(u="marg-top "+(j[2].role<2||j[1].listed?"disabled":"")))&&p(c,"class",u),R&2&&c.value!==j[1].message&&je(c,j[1].message),R&8){L=me(j[3]);let Z;for(Z=0;Z<L.length;Z+=1){let ye=FF(j,L,Z);O[Z]?O[Z].p(ye,R):(O[Z]=PF(ye),O[Z].c(),O[Z].m(v,null))}for(;Z<O.length;Z+=1)O[Z].d(1);O.length=L.length}(!M||R&6&&_!==(_="btn grey marg-top "+(j[2].role<2||j[1].listed?"disabled":"")))&&p(v,"class",_),R&2&&Mn(v,j[1].activity),(!M||R&2)&&y!==(y=j[1].listed?"\u{1F441}\uFE0F Unlist":"List")&&G(F,y),(!M||R&7&&C!==(C="btn purp textcenter "+(j[2].role<2||j[0]?"disabled":j[1].listed?"active":"")))&&p(k,"class",C)},i(j){M||(S(o),M=!0)},o(j){E(o),M=!1},d(j){j&&x(e),z[s].d(),st(O,j),V=!1,rt($)}}}function HV(t,e,n){let s,o;ie(t,Xs,k=>n(1,s=k)),ie(t,es,k=>n(2,o=k));let i=P.ui.party.activities,r,l=!1;Pd();let a=async()=>{n(0,l=!0),s.listed?(Xe(Xs,s.listed=!1,s),await Ft("/api/party/unlistparty",{},()=>{})):(Xe(Xs,s.listed=!0,s),await Ft("/api/party/listparty",{message:s.message,activity:s.activity},()=>{})),n(0,l=!1)},c=k=>{yt("partyinvite",k.name),k.invited=!0,k.denied=!1,Xs.set(s)},f=k=>{k.denied=!0,k.invited=!1,Xe(Xs,s.applications=s.applications.filter(y=>y.player!==k.player),s),Ft("/api/party/denyapplication",{player:k.player},()=>{})},u=(k,y)=>{dn.set({x:k.pageX,y:k.pageY,opts:[{name:y.name,css:"disabled"},Wt.whisper(y.name)]})},m=(k,y)=>{c(k)},g=(k,y)=>{f(k)},v=(k,y)=>u(y,k);function _(){s.message=this.value,Xs.set(s)}function b(){s.activity=Fs(this),Xs.set(s)}return[l,s,o,i,a,c,f,u,m,g,v,_,b]}var lv=class extends Ce{constructor(e){super(),Pe(this,e,HV,GV,Be,{})}},AF=lv;function TF(t){let e,n;return e=new $t({props:{origin:"center",title:"\u{1F465} Party",$$slots:{default:[QV]},$$scope:{ctx:t}}}),e.$on("close",t[3]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&67&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function YV(t){let e,n;return e=new AF({}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function XV(t){let e,n;return e=new MF({}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function QV(t){let e,n,s,o,i,r,l,a,c,f,u,m=[XV,YV],g=[];function v(_,b){return _[1]===0||_[0].membercount===0?0:1}return l=v(t,-1),a=g[l]=m[l](t),{c(){e=h("div"),n=h("div"),s=h("div"),s.textContent="Party List",o=h("div"),i=T("Your Party"),a.c(),p(s,"class","tab"),Bi(s,"active",t[1]===0),p(o,"class",r="tab "+(t[0].membercount===0?"disabled":"")),Bi(o,"active",t[1]===1),p(n,"class","tab-bar flex"),p(e,"class","container svelte-6dw5x1")},m(_,b){w(_,e,b),d(e,n),d(n,s),d(n,o),d(o,i),g[l].m(e,null),c=!0,f||(u=[H(s,"click",t[4]),H(o,"click",t[5])],f=!0)},p(_,b){(!c||b&2)&&Bi(s,"active",_[1]===0),(!c||b&1&&r!==(r="tab "+(_[0].membercount===0?"disabled":"")))&&p(o,"class",r),(!c||b&3)&&Bi(o,"active",_[1]===1);let k=l;l=v(_,b),l!==k&&(Me(),E(g[k],1,1,()=>{g[k]=null}),Fe(),a=g[l],a||(a=g[l]=m[l](_),a.c()),S(a,1),a.m(e,null))},i(_){c||(S(a),c=!0)},o(_){E(a),c=!1},d(_){_&&x(e),g[l].d(),f=!1,rt(u)}}}function ZV(t){let e,n,s=t[2]&&TF(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[2]?s?(s.p(o,i),i&4&&S(s,1)):(s=TF(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function JV(t,e,n){let s,o;ie(t,Ks,c=>n(2,s=c)),ie(t,es,c=>n(0,o=c));let i=0,r=c=>Xe(Ks,s=!1,s),l=()=>{n(1,i=0)},a=()=>{n(1,i=1)};return t.$$.update=()=>{t.$$.dirty&1&&o.membercount===0&&n(1,i=0)},[o,i,s,r,l,a]}var av=class extends Ce{constructor(e){super(),Pe(this,e,JV,ZV,Be,{})}},EF=av;var Ad=t=>t.type==="pet"&&t.upgrade>=1?!1:t.stacks===void 0&&t.rolls.length>0&&!Pn[t.type].noupgrade,IF=t=>t<101,Td=t=>{if(!Ad(t)||t.type==="pet")return 0;let e=ln[t.type+t.tier];return Math.ceil(((1+e.level*(1+t.upgrade))/Pn[t.type].drop)**(1.2+t.upgrade*.2))+100},DF=t=>{if(Ad(t)){let e=[];if(t.type==="pet")e.push({type:"box",tier:2});else for(let n=0;n<Math.max(1,t.upgrade);++n)e.push({type:"rune",tier:n,stacks:Math.max(1,Math.min(2,t.upgrade-n))});return e}else return[]};var uv={};Kn(uv,{addExp:()=>fv,addGold:()=>Id,init:()=>pu,onWorldEnter:()=>KV,tick:()=>eL,values:()=>Co});var Co=new Map,cv=new kt(0,1),Ed=0,pu=()=>{Co.set("exp",0),Co.set("gold",0),cv.reset(0),Ed=0},KV=pu,eL=t=>{cv.done(I.time)&&(++Ed,cv.reset(I.time),Mm.set({gold:Co.get("gold"),gph:Co.get("gold")/Ed*60*60}),Fm.set({exp:Co.get("exp"),exph:Co.get("exp")/Ed*60*60}))},fv=t=>{Co.set("exp",(Co.get("exp")||0)+t)},Id=t=>{Co.set("gold",(Co.get("gold")||0)+t)};var VF=(t,e,n)=>{if(t&&t.type)switch(e){case 13:t.rolls&&t.quality>=70&&xt(t.quality<90?98:99);case 1:fe.msgItemPickup&&Nt("inv",P.ui.inventory.pick.replace("$1",nn(t.type,t.tier)),!0),an(7,100),xt($s[t.type].sound),ys[9].element="bag"+n,t.type=="book"&&an(20,100)&&(ys[21].element="bag"+n);break;case 10:t.rolls&&Wi.update(s=>(pa.set(t.upgrade-s.upgrade),t));break}},LF=(t,e)=>{if(t&&t.type)switch(e){case 7:Nt("inv",P.ui.stash.stashed.replace("$1",nn(t.type,t.tier))),xt($s[t.type].sound);break;case 6:ho.set(),Vr.update(n=>!n),Nt("inv",P.ui.merchant.auctionpost.replace("$1",nn(t.type,t.tier)));break;case 9:Nt("inv",P.ui.inventory.sold.replace("$1",nn(t.type,t.tier))),xt($s[t.type].sound);break;case 2:Nt("inv",P.ui.inventory.throw.replace("$1",nn(t.type,t.tier))),xt($s[t.type].sound);break}},du=(t,e,n,s)=>{n!=0&&xt($s.gold.sound);let o=s+e;switch(n){case 1:fe.msgGoldPickUp&&Nt("inv",P.ui.inventory.pick.replace("$1",o),!0),Id(e);break;case 4:Vr.update(i=>!i),Nt("inv",P.ui.merchant.auctionbuy.replace("$1",o),!0);break;case 12:case 3:Nt("inv",P.ui.inventory.spend.replace("$1",o),!0);break;case 11:Nt("inv",P.ui.inventory.death.replace("$1",o),!0);break;case 9:Nt("inv",P.ui.inventory.receive.replace("$1",o),!0),Id(e);break}};var So=class extends ur{constructor(e){super(e)}hydrate(e){super.hydrate(e),e.store?e.store.set(this):console.error("no store for item",e),VF(this,this.reason,e.slot)}equipReasons(e){let n=[];if(this.logic.class!==void 0&&n.push(["Class: "+P.classes[this.logic.class].name,Xa(e.class,this.type,this.tier)]),this.logic.level&&n.push(["Requires Lv. "+this.logic.level,eg(e.level,this.type,this.tier)]),this.logic.requiredSkill&&n.push(["Must know: "+P.items.book[this.logic.requiredSkill].name,sg(e.skills.skillIdsActive,this.type,this.tier)]),Xa(e.class,this.type,this.tier)&&this.type=="book"){let s=ng(e.skills.skillIdsLearned,this.type,this.tier),o=nu(e.skills.skillIdsLearned,this.logic.skillid);n.push([s?"Use book to learn skill":o>=this.logic.skilllevel?"You already know this skill":`Must learn book Lv. ${this.logic.skilllevel} first`,s])}return n}buyReasons(e){let n=[];return this.logic.buyElo!==void 0&&n.push([`Min. Rating: ${Kf(this.logic.buyElo)}`,Px(e.elo,this.type,this.tier)]),n}getBestEquipslot(e){let n=Pn[this.type].slot;return n===void 0?void 0:n.find(o=>e.slots.get(o)===void 0)||n[0]}};function qF(t,e,n){let s=t.slice();return s[18]=e[n],s}function RF(t){let e,n;return e=new $t({props:{origin:"center",title:"Blacksmith",icon:"bag",$$slots:{default:[tL]},$$scope:{ctx:t}}}),e.$on("close",t[13]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&2097661&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function zF(t){let e;return{c(){e=h("div")},m(n,s){w(n,e,s)},p:ae,d(n){n&&x(e)}}}function BF(t){let e,n;return e=new ws({props:{pickable:!1,item:t[18],filter:t[18].filter}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&8&&(i.item=s[18]),o&8&&(i.filter=s[18].filter),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function tL(t){let e,n,s,o=(t[7]||"Place an item into the upgrade slot")+"",i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A;a=new ws({props:{clearOnMove:!0,invslot:t[0]?t[2]:void 0,pickable:!0,item:Wi,filter:t[5]?!0:""}}),a.$on("discard",t[10]),a.$on("move",t[9]);let C=me(t[3]),M=[];for(let D=0;D<C.length;D+=1)M[D]=BF(qF(t,C,D));let V=D=>E(M[D],1,1,()=>{M[D]=null}),$=null;return C.length||($=zF(t)),v=new xn({props:{isPrice:!0,amount:t[0]?Td(t[0]):0}}),{c(){e=h("div"),n=h("h3"),n.textContent="Upgrade Item",s=h("span"),i=T(o),l=h("div"),J(a.$$.fragment),f=h("div"),u=h("span"),u.textContent="Cost:",m=h("div");for(let D=0;D<M.length;D+=1)M[D].c();$&&$.c(),g=h("div"),J(v.$$.fragment),_=h("div"),b=T("Upgrade"),p(n,"class","textwhite"),p(s,"class",r="panel-black upgradetext "+t[8]+" svelte-1u9u6qj"),p(l,"class",c="upgradeslot "+t[6]+" svelte-1u9u6qj"),p(m,"class","panel-black costgrid svelte-1u9u6qj"),Le(m,"grid-template-columns","repeat("+Math.min(3,t[3].length||1)+", 30px)"),p(_,"class",k="btn primary formatted textcenter upgradebutton "+(t[4]?"":"disabled")+" svelte-1u9u6qj"),p(f,"class","upgrade svelte-1u9u6qj"),p(e,"class","container textcenter svelte-1u9u6qj")},m(D,z){w(D,e,z),d(e,n),d(e,s),d(s,i),d(e,l),X(a,l,null),d(e,f),d(f,u),d(f,m);for(let q=0;q<M.length;q+=1)M[q]&&M[q].m(m,null);$&&$.m(m,null),d(f,g),X(v,g,null),d(f,_),d(_,b),y=!0,F||(A=H(_,"click",t[11]),F=!0)},p(D,z){(!y||z&128)&&o!==(o=(D[7]||"Place an item into the upgrade slot")+"")&&G(i,o),(!y||z&256&&r!==(r="panel-black upgradetext "+D[8]+" svelte-1u9u6qj"))&&p(s,"class",r);let q={};if(z&5&&(q.invslot=D[0]?D[2]:void 0),z&32&&(q.filter=D[5]?!0:""),a.$set(q),(!y||z&64&&c!==(c="upgradeslot "+D[6]+" svelte-1u9u6qj"))&&p(l,"class",c),z&8){C=me(D[3]);let O;for(O=0;O<C.length;O+=1){let j=qF(D,C,O);M[O]?(M[O].p(j,z),S(M[O],1)):(M[O]=BF(j),M[O].c(),S(M[O],1),M[O].m(m,null))}for(Me(),O=C.length;O<M.length;O+=1)V(O);Fe(),!C.length&&$?$.p(D,z):C.length?$&&($.d(1),$=null):($=zF(D),$.c(),$.m(m,null))}(!y||z&8)&&Le(m,"grid-template-columns","repeat("+Math.min(3,D[3].length||1)+", 30px)");let L={};z&1&&(L.amount=D[0]?Td(D[0]):0),v.$set(L),(!y||z&16&&k!==(k="btn primary formatted textcenter upgradebutton "+(D[4]?"":"disabled")+" svelte-1u9u6qj"))&&p(_,"class",k)},i(D){if(!y){S(a.$$.fragment,D);for(let z=0;z<C.length;z+=1)S(M[z]);S(v.$$.fragment,D),y=!0}},o(D){E(a.$$.fragment,D),M=M.filter(Boolean);for(let z=0;z<M.length;z+=1)E(M[z]);E(v.$$.fragment,D),y=!1},d(D){D&&x(e),Q(a),st(M,D),$&&$.d(),Q(v),F=!1,A()}}}function nL(t){let e,n,s=t[1]&&RF(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[1]?s?(s.p(o,i),i&2&&S(s,1)):(s=RF(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function sL(t,e,n){let s,o,i,r,l;ie(t,pa,C=>n(12,s=C)),ie(t,Wi,C=>n(0,o=C)),ie(t,ua,C=>n(14,i=C)),ie(t,Qs,C=>n(15,r=C)),ie(t,Xo,C=>n(1,l=C));let a=C=>{let{from:M,to:V}=C.detail;M!==V&&M.type=="item"&&(Wi.set(M.item),n(2,f=M.slot))},c=C=>{Wi.set(),n(2,f=void 0)},f,u=[],m=!1,g=!1,v=()=>{let C=Ad(o),M=r>=Td(o),V=IF(f);n(4,m=C&&M&&V);let $=DF(o);$.forEach((D,z)=>{let q=u[z]||n(3,u[z]=te(),u),L=new So;L.hydrate({...D,store:q}),L.stacks!==void 0?q.filter=i[L.type+L.tier]>=L.stacks?"":!0:q.filter=i[L.type+L.tier]>=0?"":!0,q.filter&&n(4,m=!1)}),n(3,u=u.slice(0,$.length)),m||n(7,k="You lack the required materials"),C||n(7,k="This item cannot be upgraded"),M||n(7,k="You do not have enough gold"),V||n(7,k="You must un-equip the item first"),m?(n(8,y="textgreen"),n(7,k="Ready to upgrade")):n(8,y="textred")},_=()=>{o&&m&&!g&&(n(5,g=!0),Xe(pa,s=void 0,s),n(7,k="Upgrading..."),n(8,y="textprimary"),xt(100),setTimeout(()=>yt("itemblacksmithupgrade",`${o.dbid}`),1e3))},b,k,y,F=()=>{xt(s>0?101:102),n(6,b=s>0?"flash_success":"flash_fail"),n(7,k=(s>0?"Success! ":"Fail! ")+(s<0?"-":"+")+s),n(8,y=s>0?"textgreen":"textred")},A=C=>Xe(Xo,l=!1,l);return t.$$.update=()=>{t.$$.dirty&2&&(l||(Xe(Wi,o=void 0,o),Xe(pa,s=void 0,s))),t.$$.dirty&1&&(n(4,m=!0),o?v():(n(3,u.length=0,u),n(4,m=!1),n(8,y=void 0),n(7,k=void 0)),n(5,g=!1)),t.$$.dirty&4096&&(s!==void 0?F():(n(6,b=""),n(8,y="")))},[o,l,f,u,m,g,b,k,y,a,c,_,s,A]}var mv=class extends Ce{constructor(e){super(),Pe(this,e,sL,nL,Be,{})}},$F=mv;function oL(t){let e;return{c(){e=h("span")},m(n,s){w(n,e,s),e.innerHTML=t[0]},p(n,[s]){s&1&&(e.innerHTML=n[0])},i:ae,o:ae,d(n){n&&x(e)}}}function iL(t,e,n){let s,{amount:o}=e;return t.$$set=i=>{"amount"in i&&n(1,o=i.amount)},t.$$.update=()=>{t.$$.dirty&2&&n(0,s=Kf(o))},[s,o]}var pv=class extends Ce{constructor(e){super(),Pe(this,e,iL,oL,yn,{amount:1})}},Dd=pv;var dv=Ya({0:{6:2,8:.3},1:{6:4,12:1},2:{14:.5},3:{14:.4,7:.8},4:{16:.3,7:.8},5:{14:.2,18:.3}});var UF=t=>1+t/1e3;function rL(t){let e,n=P.ui.stats.array[t[1]]+"",s,o,i=(t[3]?"+"+Qn(t[1],t[0].get(t[2]).get(t[1])):Qn(t[1],t[4][t[1]]||0))+"",r,l;return{c(){e=h("span"),s=T(n),o=h("span"),r=T(i),p(o,"class",l="statnumber "+(t[3]?"textgreen":t[0]?"textprimary":"textgreen"))},m(a,c){w(a,e,c),d(e,s),w(a,o,c),d(o,r)},p(a,[c]){c&2&&n!==(n=P.ui.stats.array[a[1]]+"")&&G(s,n),c&31&&i!==(i=(a[3]?"+"+Qn(a[1],a[0].get(a[2]).get(a[1])):Qn(a[1],a[4][a[1]]||0))+"")&&G(r,i),c&9&&l!==(l="statnumber "+(a[3]?"textgreen":a[0]?"textprimary":"textgreen"))&&p(o,"class",l)},i:ae,o:ae,d(a){a&&(x(e),x(o))}}}function lL(t,e,n){let s,o;ie(t,Gi,a=>n(4,o=a));let{relmap:i}=e,{id:r}=e,{relation:l=void 0}=e;return t.$$set=a=>{"relmap"in a&&n(0,i=a.relmap),"id"in a&&n(1,r=a.id),"relation"in a&&n(2,l=a.relation)},t.$$.update=()=>{t.$$.dirty&7&&n(3,s=l!==void 0&&i.get(l).get(r)!==void 0)},[i,r,l,s,o]}var hv=class extends Ce{constructor(e){super(),Pe(this,e,lL,rL,Be,{relmap:0,id:1,relation:2})}},Vd=hv;var Di=[4e3,8e3,12e3,16e3,2e4,24e3,28e3,32e3,36e3,4e4,44e3,48e3];var vr=Di.length,rc=t=>{for(let e=0;e<vr;++e)if(Di[e]>t)return e;return Math.max(0,vr)},qd=t=>t===0?0:Di[t-1],gv=t=>{for(let e=0;e<vr;++e)if(Di[e]>t)return Di[e];return Di[vr-1]},Ld=[1,.8,.63,.479,.342,.23,.146,.085,.045,.024,.01,.003,0],Cue=Ld.map(t=>1-t);var hu=t=>t===0?"No Bracket":t===Ld.length?Ld.length+" (Faction Leader)":`${t} (Top ${(Ld[t-1]*100).toFixed(1)}%)`;function OF(t,e,n){let s=t.slice();return s[12]=e[n],s[14]=n,s}function NF(t,e,n){let s=t.slice();return s[15]=e[n],s}function jF(t,e,n){let s=t.slice();return s[18]=e[n],s[20]=n,s}function WF(t,e,n){let s=t.slice();return s[15]=e[n],s}function GF(t){let e,n;return e=new $t({props:{title:P.ui.headers.character,icon:"char",origin:"left top",defaultOffset:[3,100],$$slots:{default:[aL]},$$scope:{ctx:t}}}),e.$on("close",t[11]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&8388727&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function HF(t){let e,n,s,o,i,r,l;e=new Vd({props:{id:t[15]}});function a(...f){return t[8](t[15],...f)}function c(...f){return t[10](t[15],...f)}return{c(){J(e.$$.fragment),n=h("img"),at(n.src,s="/data/ui/icons/arrow.svg?v=8685122")||p(n,"src",s),p(n,"class",o="btn "+(t[0][22]>0?"green":"disabled")+" svgicon statbtn svelte-rbq5ku")},m(f,u){X(e,f,u),w(f,n,u),i=!0,r||(l=[H(n,"pointerenter",a),H(n,"pointerleave",t[9]),H(n,"click",c)],r=!0)},p(f,u){t=f,(!i||u&1&&o!==(o="btn "+(t[0][22]>0?"green":"disabled")+" svgicon statbtn svelte-rbq5ku"))&&p(n,"class",o)},i(f){i||(S(e.$$.fragment,f),i=!0)},o(f){E(e.$$.fragment,f),i=!1},d(f){f&&x(n),Q(e,f),r=!1,rt(l)}}}function YF(t){let e,n;return e=new ws({props:{descPos:"left:100%;top:0;",item:t[18],invslot:101+t[20]}}),e.$on("use",KF),e.$on("context",KF),e.$on("move",fL),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&64&&(i.item=s[18]),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function XF(t){let e,n;return e=new Vd({props:{id:t[15],relmap:_v,relation:t[1]}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&2&&(i.relation=s[1]),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function QF(t){let e,n,s=me(t[12]),o=[];for(let r=0;r<s.length;r+=1)o[r]=XF(NF(t,s,r));let i=r=>E(o[r],1,1,()=>{o[r]=null});return{c(){e=h("div");for(let r=0;r<o.length;r+=1)o[r].c();p(e,"class","statcol panel-black svelte-rbq5ku")},m(r,l){w(r,e,l);for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(e,null);n=!0},p(r,l){if(l&2){s=me(r[12]);let a;for(a=0;a<s.length;a+=1){let c=NF(r,s,a);o[a]?(o[a].p(c,l),S(o[a],1)):(o[a]=XF(c),o[a].c(),S(o[a],1),o[a].m(e,null))}for(Me(),a=s.length;a<o.length;a+=1)i(a);Fe()}},i(r){if(!n){for(let l=0;l<s.length;l+=1)S(o[l]);n=!0}},o(r){o=o.filter(Boolean);for(let l=0;l<o.length;l+=1)E(o[l]);n=!1},d(r){r&&x(e),st(o,r)}}}function aL(t){let e,n,s,o,i=t[4].name+"",r,l,a,c=t[4].level+"",f,u,m,g,v,_,b=P.classes[t[4].class].name+"",k,y,F,A,C,M,V,$=P.factions[t[4].faction].name+"",D,z,q,L,O,j,R,U=dt(t[0][20]||0)+"",Z,ye,we=t[2]<vr?"/ "+rs(Di[t[2]]):"",he,re,le=P.ui.charpanel.rank+"",ve,_e,Ie,oe,Ee,K,Re,Ge,Qe,Ye,pe,ce,Oe,se,ee,N,ue;Qe=new Dd({props:{amount:t[0][21]||0}}),pe=new hr({props:{amount:t[5],isPrice:!1}});let We=me([0,1,2,3,4,5]),ze=[];for(let xe=0;xe<6;xe+=1)ze[xe]=HF(WF(t,We,xe));let Ae=xe=>E(ze[xe],1,1,()=>{ze[xe]=null});se=new Vd({props:{id:22}});let $e=me(t[6].filter(eC)),Ue=[];for(let xe=0;xe<$e.length;xe+=1)Ue[xe]=YF(jF(t,$e,xe));let mt=xe=>E(Ue[xe],1,1,()=>{Ue[xe]=null}),wt=me(JF),Je=[];for(let xe=0;xe<wt.length;xe+=1)Je[xe]=QF(OF(t,wt,xe));let Et=xe=>E(Je[xe],1,1,()=>{Je[xe]=null});return{c(){e=h("div"),n=h("div"),s=h("span"),s.textContent=`${P.ui.charpanel.name}`,o=h("span"),r=T(i),l=h("span"),l.textContent=`${P.ui.charpanel.level}`,a=h("span"),f=T(c),u=h("span"),u.textContent=`${P.ui.charpanel.class}`,m=h("span"),g=h("img"),_=Ne(),k=T(b),F=h("span"),F.textContent=`${P.ui.charpanel.faction}`,A=h("span"),C=h("img"),V=Ne(),D=T($),q=h("span"),q.textContent=`${P.ui.stats.array[20]}`,L=h("span"),O=h("img"),R=Ne(),Z=T(U),ye=Ne(),he=T(we),re=T(" ("),ve=T(le),_e=Ne(),Ie=T(t[2]),oe=T("/"),Ee=T(vr),K=T(")"),Re=h("span"),Re.textContent=`${P.ui.charpanel.rating}`,Ge=h("span"),J(Qe.$$.fragment),Ye=h("span"),Ye.textContent=`${P.ui.charpanel.medals}`,J(pe.$$.fragment),ce=h("div");for(let xe=0;xe<6;xe+=1)ze[xe].c();Oe=de(),J(se.$$.fragment),ee=h("div");for(let xe=0;xe<Ue.length;xe+=1)Ue[xe].c();N=h("div");for(let xe=0;xe<Je.length;xe+=1)Je[xe].c();p(o,"class","bold textwhite"),p(a,"class","bold textwhite"),p(g,"class","texticon"),at(g.src,v=ni(t[4].class))||p(g,"src",v),p(m,"class",y="bold "+("textc"+t[4].class)+" svelte-rbq5ku"),p(C,"class","texticon"),at(C.src,M=jh(t[4].faction))||p(C,"src",M),p(A,"class",z="bold "+("textf"+t[4].faction)+" svelte-rbq5ku"),p(O,"class","texticon"),at(O.src,j=Ha)||p(O,"src",j),p(L,"class","bold textprestige"),p(n,"class","statcol panel-black svelte-rbq5ku"),Le(n,"grid-template-columns","1fr 2fr"),p(ce,"id","statpoints"),p(ce,"class","statcol panel-black svelte-rbq5ku"),Le(ce,"grid-template-columns","1fr auto auto"),p(e,"class","grid"),Le(e,"grid-template-columns","3fr 2fr"),p(ee,"id","equipslots"),p(ee,"class","items svelte-rbq5ku"),p(N,"class","grid three stats2 svelte-rbq5ku")},m(xe,Ke){w(xe,e,Ke),d(e,n),d(n,s),d(n,o),d(o,r),d(n,l),d(n,a),d(a,f),d(n,u),d(n,m),d(m,g),d(m,_),d(m,k),d(n,F),d(n,A),d(A,C),d(A,V),d(A,D),d(n,q),d(n,L),d(L,O),d(L,R),d(L,Z),d(L,ye),d(L,he),d(L,re),d(L,ve),d(L,_e),d(L,Ie),d(L,oe),d(L,Ee),d(L,K),d(n,Re),d(n,Ge),X(Qe,Ge,null),d(n,Ye),X(pe,n,null),d(e,ce);for(let bt=0;bt<6;bt+=1)ze[bt]&&ze[bt].m(ce,null);d(ce,Oe),X(se,ce,null),w(xe,ee,Ke);for(let bt=0;bt<Ue.length;bt+=1)Ue[bt]&&Ue[bt].m(ee,null);w(xe,N,Ke);for(let bt=0;bt<Je.length;bt+=1)Je[bt]&&Je[bt].m(N,null);ue=!0},p(xe,Ke){(!ue||Ke&16)&&i!==(i=xe[4].name+"")&&G(r,i),(!ue||Ke&16)&&c!==(c=xe[4].level+"")&&G(f,c),(!ue||Ke&16&&!at(g.src,v=ni(xe[4].class)))&&p(g,"src",v),(!ue||Ke&16)&&b!==(b=P.classes[xe[4].class].name+"")&&G(k,b),(!ue||Ke&16&&y!==(y="bold "+("textc"+xe[4].class)+" svelte-rbq5ku"))&&p(m,"class",y),(!ue||Ke&16&&!at(C.src,M=jh(xe[4].faction)))&&p(C,"src",M),(!ue||Ke&16)&&$!==($=P.factions[xe[4].faction].name+"")&&G(D,$),(!ue||Ke&16&&z!==(z="bold "+("textf"+xe[4].faction)+" svelte-rbq5ku"))&&p(A,"class",z),(!ue||Ke&1)&&U!==(U=dt(xe[0][20]||0)+"")&&G(Z,U),(!ue||Ke&4)&&we!==(we=xe[2]<vr?"/ "+rs(Di[xe[2]]):"")&&G(he,we),(!ue||Ke&4)&&G(Ie,xe[2]);let bt={};Ke&1&&(bt.amount=xe[0][21]||0),Qe.$set(bt);let Ct={};if(Ke&32&&(Ct.amount=xe[5]),pe.$set(Ct),Ke&131){We=me([0,1,2,3,4,5]);let Ve;for(Ve=0;Ve<6;Ve+=1){let be=WF(xe,We,Ve);ze[Ve]?(ze[Ve].p(be,Ke),S(ze[Ve],1)):(ze[Ve]=HF(be),ze[Ve].c(),S(ze[Ve],1),ze[Ve].m(ce,Oe))}for(Me(),Ve=6;Ve<6;Ve+=1)Ae(Ve);Fe()}if(Ke&64){$e=me(xe[6].filter(eC));let Ve;for(Ve=0;Ve<$e.length;Ve+=1){let be=jF(xe,$e,Ve);Ue[Ve]?(Ue[Ve].p(be,Ke),S(Ue[Ve],1)):(Ue[Ve]=YF(be),Ue[Ve].c(),S(Ue[Ve],1),Ue[Ve].m(ee,null))}for(Me(),Ve=$e.length;Ve<Ue.length;Ve+=1)mt(Ve);Fe()}if(Ke&2){wt=me(JF);let Ve;for(Ve=0;Ve<wt.length;Ve+=1){let be=OF(xe,wt,Ve);Je[Ve]?(Je[Ve].p(be,Ke),S(Je[Ve],1)):(Je[Ve]=QF(be),Je[Ve].c(),S(Je[Ve],1),Je[Ve].m(N,null))}for(Me(),Ve=wt.length;Ve<Je.length;Ve+=1)Et(Ve);Fe()}},i(xe){if(!ue){S(Qe.$$.fragment,xe),S(pe.$$.fragment,xe);for(let Ke=0;Ke<6;Ke+=1)S(ze[Ke]);S(se.$$.fragment,xe);for(let Ke=0;Ke<$e.length;Ke+=1)S(Ue[Ke]);for(let Ke=0;Ke<wt.length;Ke+=1)S(Je[Ke]);ue=!0}},o(xe){E(Qe.$$.fragment,xe),E(pe.$$.fragment,xe),ze=ze.filter(Boolean);for(let Ke=0;Ke<6;Ke+=1)E(ze[Ke]);E(se.$$.fragment,xe),Ue=Ue.filter(Boolean);for(let Ke=0;Ke<Ue.length;Ke+=1)E(Ue[Ke]);Je=Je.filter(Boolean);for(let Ke=0;Ke<Je.length;Ke+=1)E(Je[Ke]);ue=!1},d(xe){xe&&(x(e),x(ee),x(N)),Q(Qe),Q(pe),st(ze,xe),Q(se),st(Ue,xe),st(Je,xe)}}}function cL(t){let e,n,s=t[3]&&t[4].visible&&GF(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[3]&&o[4].visible?s?(s.p(o,i),i&24&&S(s,1)):(s=GF(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}var ZF=!1,_v=new Map;dv.forEach((t,e)=>{let n=new Map;t.forEach((s,o)=>{n.set(o,s)}),_v.set(e,n)});var JF=[[6,8,7,9,12,13],[10,11,17,14,16],[15,19,18,25,26]],fL=t=>{let{from:e,to:n}=t.detail;e!==n&&e.type=="item"&&yt("itemmove",`${e.slot} ${n.slot}`)},KF=t=>{let{item:e}=t.detail;if(e!==void 0){let n=I.player.inventory.getFirstEmptySlot();n>=0&&yt("itemmove",`${t.detail.slot} ${n}`)}},eC=(t,e)=>e>=101;function uL(t,e,n){let s,o,i,r,l,a;ie(t,Gi,_=>n(0,o=_)),ie(t,ki,_=>n(3,i=_)),ie(t,Wo,_=>n(4,r=_)),ie(t,ca,_=>n(5,l=_)),ie(t,fa,_=>n(6,a=_)),I&&I.player&&!ZF&&(ZF=!0,yl.forEach((_,b)=>{b-61==I.player.class&&_.statsConvert&&_.statsConvert.forEach(k=>{let y=dv.get(k[0])||new Map;y.set(k[2],(y.get(k[2])||0)+k[1]),_v.set(k[0],y)})}));let c,f=_=>{o[22]&&(yt("statincrease",_+" "+(nt.shift.down?10:1)),n(1,c=void 0),an(15,50))},u=(_,b)=>n(1,c=_),m=_=>n(1,c=void 0),g=(_,b)=>f(_),v=()=>{Xe(ki,i=!1,i)};return t.$$.update=()=>{t.$$.dirty&1&&n(2,s=rc(o[20]||0))},[o,c,s,i,r,l,a,f,u,m,g,v]}var vv=class extends Ce{constructor(e){super(),Pe(this,e,uL,cL,Be,{})}},tC=vv;var Rd={normal:{partyBasedHostility:!1,pvpprotect:!0,instanced:!1},arena3v3:{name:"Arena 3v3",queue:!0,instanced:!0,groupsize:3,groupcount:2,partyBasedHostility:!0,pvpprotect:!1,startTimer:30},arena5v5:{name:"Arena 5v5",startTimer:30,groupsize:5,groupcount:2,queue:!0,instanced:!0,partyBasedHostility:!0,pvpprotect:!1}};function nC(t,e,n){let s=t.slice();return s[16]=e[n],s}function mL(t){let e,n,s=t[4].listed?"\u{1F441}\uFE0F ":"",o,i=t[2].membercount+"",r,l,a,c,f;return{c(){e=h("div"),n=h("span"),o=T(s),r=T(i),l=T("/10"),p(e,"id","partybtn"),p(e,"class",a="btn border black textgreen "+(t[4].flashing?"flashing-border":""))},m(u,m){w(u,e,m),d(e,n),d(n,o),d(e,r),d(e,l),c||(f=H(e,"click",t[11]),c=!0)},p(u,m){m&16&&s!==(s=u[4].listed?"\u{1F441}\uFE0F ":"")&&G(o,s),m&4&&i!==(i=u[2].membercount+"")&&G(r,i),m&16&&a!==(a="btn border black textgreen "+(u[4].flashing?"flashing-border":""))&&p(e,"class",a)},d(u){u&&x(e),c=!1,f()}}}function pL(t){let e,n,s;return{c(){e=h("div"),e.textContent=`${P.ui.party.noParty}`,p(e,"id","partybtn"),p(e,"class","btn border black textgrey")},m(o,i){w(o,e,i),n||(s=H(e,"click",t[10]),n=!0)},p:ae,d(o){o&&x(e),n=!1,s()}}}function dL(t){let e=t[2].exprate+"",n,s,o=t[2].membercount===0?"":"/"+t[2].nearby,i;return{c(){n=T(e),s=T("% EXP"),i=T(o)},m(r,l){w(r,n,l),w(r,s,l),w(r,i,l)},p(r,l){l&4&&e!==(e=r[2].exprate+"")&&G(n,e),l&4&&o!==(o=r[2].membercount===0?"":"/"+r[2].nearby)&&G(i,o)},d(r){r&&(x(n),x(s),x(i))}}}function hL(t){let e=dt(~~t[1].exph)+"",n,s;return{c(){n=T(e),s=T(" EXP / h")},m(o,i){w(o,n,i),w(o,s,i)},p(o,i){i&2&&e!==(e=dt(~~o[1].exph)+"")&&G(n,e)},d(o){o&&(x(n),x(s))}}}function gL(t){let e=t[2].itemfind+"",n,s;return{c(){n=T(e),s=T("% FIND")},m(o,i){w(o,n,i),w(o,s,i)},p(o,i){i&4&&e!==(e=o[2].itemfind+"")&&G(n,e)},i:ae,o:ae,d(o){o&&(x(n),x(s))}}}function vL(t){let e,n,s;return e=new xn({props:{amount:Math.round(t[0].gph)}}),{c(){J(e.$$.fragment),n=T(" / h")},m(o,i){X(e,o,i),w(o,n,i),s=!0},p(o,i){let r={};i&1&&(r.amount=Math.round(o[0].gph)),e.$set(r)},i(o){s||(S(e.$$.fragment,o),s=!0)},o(o){E(e.$$.fragment,o),s=!1},d(o){o&&x(n),Q(e,o)}}}function sC(t,e){let n,s,o;return s=new uu({props:{mode:"party",unit:e[16].unitStore,buffs:e[16].buffStore}}),{key:t,first:null,c(){n=de(),J(s.$$.fragment),this.first=n},m(i,r){w(i,n,r),X(s,i,r),o=!0},p(i,r){e=i;let l={};r&256&&(l.unit=e[16].unitStore),r&256&&(l.buffs=e[16].buffStore),s.$set(l)},i(i){o||(S(s.$$.fragment,i),o=!0)},o(i){E(s.$$.fragment,i),o=!1},d(i){i&&x(n),Q(s,i)}}}function _L(t){let e,n,s,o,i,r,l,a,c,f=[],u=new Map,m,g,v;function _(z,q){return z[2].membercount===0?pL:mL}let b=_(t,-1),k=b(t);function y(z,q){return z[5]?hL:dL}let F=y(t,-1),A=F(t),C=[vL,gL],M=[];function V(z,q){return z[6]?0:1}r=V(t,-1),l=M[r]=C[r](t);let $=me(t[8]),D=z=>z[16].name;for(let z=0;z<$.length;z+=1){let q=nC(t,$,z),L=D(q);u.set(L,f[z]=sC(L,q))}return{c(){e=h("div"),n=h("div"),s=h("div"),s.textContent=`\u{1F465} ${P.ui.party.name}`,k.c(),o=h("div"),A.c(),i=h("div"),l.c(),a=Ne(),c=h("div");for(let z=0;z<f.length;z+=1)f[z].c();p(s,"class","btn party"),p(o,"class","btn border black textexp"),p(i,"class","btn border black textcyan"),p(n,"class","btnbar"),p(c,"class","partyframes svelte-1xmlhk"),Le(c,"width",t[7]+"px"),p(e,"class","l-corner-ul uiscaled")},m(z,q){w(z,e,q),d(e,n),d(n,s),k.m(n,null),d(n,o),A.m(o,null),d(n,i),M[r].m(i,null),d(e,a),d(e,c);for(let L=0;L<f.length;L+=1)f[L]&&f[L].m(c,null);m=!0,g||(v=[H(s,"click",t[9]),H(o,"click",t[12]),H(o,"contextmenu",pu),H(i,"click",t[13]),H(i,"contextmenu",pu)],g=!0)},p(z,[q]){b===(b=_(z,q))&&k?k.p(z,q):(k.d(1),k=b(z),k&&(k.c(),k.m(n,o))),F===(F=y(z,q))&&A?A.p(z,q):(A.d(1),A=F(z),A&&(A.c(),A.m(o,null)));let L=r;r=V(z,q),r===L?M[r].p(z,q):(Me(),E(M[L],1,1,()=>{M[L]=null}),Fe(),l=M[r],l?l.p(z,q):(l=M[r]=C[r](z),l.c()),S(l,1),l.m(i,null)),q&256&&($=me(z[8]),Me(),f=En(f,q,D,1,z,$,u,c,Hn,sC,null,nC),Fe()),(!m||q&128)&&Le(c,"width",z[7]+"px")},i(z){if(!m){S(l);for(let q=0;q<$.length;q+=1)S(f[q]);m=!0}},o(z){E(l);for(let q=0;q<f.length;q+=1)E(f[q]);m=!1},d(z){z&&x(e),k.d(),A.d(),M[r].d();for(let q=0;q<f.length;q+=1)f[q].d();g=!1,rt(v)}}}function bL(t,e,n){let s,o,i,r,l,a,c,f,u;ie(t,Mm,F=>n(0,s=F)),ie(t,Fm,F=>n(1,o=F)),ie(t,es,F=>n(2,i=F)),ie(t,Ks,F=>n(3,r=F)),ie(t,Xs,F=>n(4,l=F)),ie(t,ff,F=>n(5,a=F)),ie(t,cf,F=>n(6,c=F)),ie(t,Kr,F=>n(7,f=F)),ie(t,la,F=>n(8,u=F));let m=F=>{let A=[{name:"Party Panel",fun:()=>{Xe(Ks,r=!0,r)}},i.membercount?Wt.partyleave():Wt.partycreate()];dn.set({x:F.pageX,y:F.pageY,opts:A})},g=()=>{console.log(o)},v=()=>{console.log(s)};return[s,o,i,r,l,a,c,f,u,m,F=>Xe(Ks,r=!r,r),F=>Xe(Ks,r=!r,r),F=>{Xe(ff,a=!a,a)},F=>{Xe(cf,c=!c,c)}]}var bv=class extends Ce{constructor(e){super(),Pe(this,e,bL,_L,Be,{})}},oC=bv;function yL(t){let e;return{c(){e=h("div"),p(e,"class","pattern svelte-1m0q37p")},m(n,s){w(n,e,s)},p:ae,d(n){n&&x(e)}}}function kL(t){let e,n,s;return n=new ks({props:{size:"0.8em",fract:t[0],barcol:"bgexp",left:t[1],right:`${t[0]}%`,$$slots:{default:[yL]},$$scope:{ctx:t}}}),{c(){e=h("div"),J(n.$$.fragment),p(e,"id","expbar"),p(e,"class","container svelte-1m0q37p")},m(o,i){w(o,e,i),X(n,e,null),s=!0},p(o,[i]){let r={};i&1&&(r.fract=o[0]),i&2&&(r.left=o[1]),i&1&&(r.right=`${o[0]}%`),i&8&&(r.$$scope={dirty:i,ctx:o}),n.$set(r)},i(o){s||(S(n.$$.fragment,o),s=!0)},o(o){E(n.$$.fragment,o),s=!1},d(o){o&&x(e),Q(n)}}}function xL(t,e,n){let s;ie(t,vm,r=>n(2,s=r));let o,i;return t.$$.update=()=>{t.$$.dirty&4&&(n(0,o=(100*s.current/s.max).toFixed(2)),n(1,i=`${dt(s.current)} / ${dt(s.max)} EXP`))},[o,i,s]}var yv=class extends Ce{constructor(e){super(),Pe(this,e,xL,kL,Be,{})}},iC=yv;function rC(t){let e,n,s=t[5].msg+"",o,i,r,l=(t[5].fixed||t[5].step)&&lC(t),a=t[5].click&&aC(t);return{c(){e=h("div"),n=h("div"),l&&l.c(),o=de(),a&&a.c(),p(n,"class","textprimary msgtext svelte-ocy2wa"),p(e,"class",i="msg "+(t[5].complete?"complete":"")+" svelte-ocy2wa")},m(c,f){w(c,e,f),d(e,n),n.innerHTML=s,l&&l.m(e,null),d(e,o),a&&a.m(e,null),r=!0},p(c,f){(!r||f&32)&&s!==(s=c[5].msg+"")&&(n.innerHTML=s),c[5].fixed||c[5].step?l?(l.p(c,f),f&32&&S(l,1)):(l=lC(c),l.c(),S(l,1),l.m(e,o)):l&&(Me(),E(l,1,1,()=>{l=null}),Fe()),c[5].click?a||(a=aC(c),a.c(),a.m(e,null)):a&&(a.d(1),a=null),(!r||f&32&&i!==(i="msg "+(c[5].complete?"complete":"")+" svelte-ocy2wa"))&&p(e,"class",i)},i(c){r||(S(l),r=!0)},o(c){E(l),r=!1},d(c){c&&x(e),l&&l.d(),a&&a.d()}}}function lC(t){let e,n;return e=new ks({props:{size:"0.8em",fract:t[5].progress,barcol:"bgtut",left:"",right:Math.ceil(t[5].progress)+"%"}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&32&&(i.fract=s[5].progress),o&32&&(i.right=Math.ceil(s[5].progress)+"%"),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function aC(t){let e,n,s,o;return{c(){e=h("div"),n=h("div"),n.textContent="Okay",p(n,"class","btn green"),p(e,"class","marg-top"),Le(e,"display","flex"),Le(e,"flex-direction","row-reverse")},m(i,r){w(i,e,r),d(e,n),s||(o=H(n,"click",t[6]),s=!0)},d(i){i&&x(e),s=!1,o()}}}function cC(t){let e,n;return{c(){e=h("div"),p(e,"class",n="border skill tut "+(t[5].complete?"complete":"")+" svelte-ocy2wa"),Le(e,"top",t[2]+"px"),Le(e,"left",t[1]+"px"),Le(e,"width",t[3]+"px"),Le(e,"height",t[4]+"px")},m(s,o){w(s,e,o)},p(s,o){o&32&&n!==(n="border skill tut "+(s[5].complete?"complete":"")+" svelte-ocy2wa")&&p(e,"class",n),o&4&&Le(e,"top",s[2]+"px"),o&2&&Le(e,"left",s[1]+"px"),o&8&&Le(e,"width",s[3]+"px"),o&16&&Le(e,"height",s[4]+"px")},d(s){s&&x(e)}}}function wL(t){let e,n,s,o=t[5]&&t[5].msg&&rC(t),i=t[0]&&cC(t);return{c(){o&&o.c(),e=de(),i&&i.c(),n=de()},m(r,l){o&&o.m(r,l),w(r,e,l),i&&i.m(r,l),w(r,n,l),s=!0},p(r,[l]){r[5]&&r[5].msg?o?(o.p(r,l),l&32&&S(o,1)):(o=rC(r),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(Me(),E(o,1,1,()=>{o=null}),Fe()),r[0]?i?i.p(r,l):(i=cC(r),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},i(r){s||(S(o),s=!0)},o(r){E(o),s=!1},d(r){r&&(x(e),x(n)),o&&o.d(r),i&&i.d(r)}}}function ML(t,e,n){let s;ie(t,ji,f=>n(5,s=f));let o=!1,i,r,l,a;return ji.subscribe(f=>{if(f){let u=document.getElementById(f.element);if(u){n(0,o=!0);let m=u.getBoundingClientRect();n(3,l=m.width+10),n(4,a=m.height+10),n(1,i=m.x-5),n(2,r=m.y-5)}else n(0,o=!1)}else n(0,o=!1)}),[o,i,r,l,a,s,f=>{an(-1,1e4)}]}var kv=class extends Ce{constructor(e){super(),Pe(this,e,ML,wL,Be,{})}},fC=kv;function FL(t,e,n){let s=t.slice();return s[7]=e[n],s[9]=n,s}function uC(t){let e,n;return e=new $t({props:{zindex:8,origin:"center",title:"Report a player",$$slots:{default:[AL]},$$scope:{ctx:t}}}),e.$on("close",t[4]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&1031&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function CL(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[7]}`,e.__value=n=t[9],je(e,e.__value)},m(s,o){w(s,e,o)},p:ae,d(s){s&&x(e)}}}function mC(t){let e,n=t[2].info+"",s;return{c(){e=h("p"),s=T(n),p(e,"class","textprimary")},m(o,i){w(o,e,i),d(e,s)},p(o,i){i&4&&n!==(n=o[2].info+"")&&G(s,n)},d(o){o&&x(e)}}}function SL(t){let e,n=(t[0].result==="ok"?"Report submitted.":t[0].result)+"",s,o,i,r,l,a;return{c(){e=h("p"),s=T(n),i=h("div"),r=h("div"),r.textContent="Close",p(e,"class",o=t[0].result==="ok"?"textgreen":"textred"),p(r,"class","btn grey navbtn"),p(i,"class","subnav")},m(c,f){w(c,e,f),d(e,s),w(c,i,f),d(i,r),l||(a=H(r,"click",t[4]),l=!0)},p(c,f){f&1&&n!==(n=(c[0].result==="ok"?"Report submitted.":c[0].result)+"")&&G(s,n),f&1&&o!==(o=c[0].result==="ok"?"textgreen":"textred")&&p(e,"class",o)},d(c){c&&(x(e),x(i)),l=!1,a()}}}function PL(t){let e,n,s,o,i,r,l,a,c;return{c(){e=h("div"),n=h("div"),s=T("Report"),i=h("div"),r=T("Cancel"),p(n,"class",o="btn grey navbtn "+(t[1]?"disabled":"")),p(i,"class",l="btn grey navbtn "+(t[1]?"disabled":"")),p(e,"class","subnav")},m(f,u){w(f,e,u),d(e,n),d(n,s),d(e,i),d(i,r),a||(c=[H(n,"click",t[3]),H(i,"click",t[4])],a=!0)},p(f,u){u&2&&o!==(o="btn grey navbtn "+(f[1]?"disabled":""))&&p(n,"class",o),u&2&&l!==(l="btn grey navbtn "+(f[1]?"disabled":""))&&p(i,"class",l)},d(f){f&&x(e),a=!1,rt(c)}}}function AL(t){let e,n,s,o,i=t[2].name+"",r,l,a,c,f,u,m,g=P.ui.report.info[t[2].reason]+"",v,_,b,k,y,F,A,C,M=me(P.ui.report.reasons),V=[];for(let L=0;L<M.length;L+=1)V[L]=CL(FL(t,M,L));let $=t[2].info&&mC(t);function D(L,O){return L[0]?SL:PL}let z=D(t,-1),q=z(t);return{c(){e=h("div"),n=h("p"),s=T("Describe what happened with "),o=h("span"),r=T(i),l=T(" as accurately as you can:"),a=h("div"),c=h("select");for(let L=0;L<V.length;L+=1)V[L].c();u=h("p"),m=h("small"),v=T(g),$&&$.c(),_=h("div"),b=h("textarea"),F=h("p"),F.innerHTML='<small>Please do not file false reports. If you are unsure about a players behavior, refer to our <a href="/terms" target="_blank">Conduct Policy</a>.</small>',q.c(),p(o,"class","textprimary"),p(c,"class",f=t[1]?"disabled":""),t[2].reason===void 0&&bn(()=>t[5].call(c)),p(a,"class","subnav"),p(u,"class","textgrey"),p(b,"maxlength",k=300),p(b,"class",y="scrollbar reportdescription "+(t[1]?"disabled":"")+" svelte-jnzoj3"),p(b,"rows","4"),p(b,"placeholder","Provide additional context, a little description of the situation helps our moderators."),p(_,"class","subnav"),p(F,"class","textgrey"),p(e,"class","card container svelte-jnzoj3")},m(L,O){w(L,e,O),d(e,n),d(n,s),d(n,o),d(o,r),d(n,l),d(e,a),d(a,c);for(let j=0;j<V.length;j+=1)V[j]&&V[j].m(c,null);Mn(c,t[2].reason,!0),d(e,u),d(u,m),d(m,v),$&&$.m(e,null),d(e,_),d(_,b),je(b,t[2].description),d(e,F),q.m(e,null),A||(C=[H(c,"change",t[5]),H(b,"input",t[6])],A=!0)},p(L,O){O&4&&i!==(i=L[2].name+"")&&G(r,i),O&2&&f!==(f=L[1]?"disabled":"")&&p(c,"class",f),O&4&&Mn(c,L[2].reason),O&4&&g!==(g=P.ui.report.info[L[2].reason]+"")&&G(v,g),L[2].info?$?$.p(L,O):($=mC(L),$.c(),$.m(e,_)):$&&($.d(1),$=null),O&2&&y!==(y="scrollbar reportdescription "+(L[1]?"disabled":"")+" svelte-jnzoj3")&&p(b,"class",y),O&4&&je(b,L[2].description),z===(z=D(L,O))&&q?q.p(L,O):(q.d(1),q=z(L),q&&(q.c(),q.m(e,null)))},d(L){L&&x(e),st(V,L),$&&$.d(),q.d(),A=!1,rt(C)}}}function TL(t){let e,n,s=t[2]!==void 0&&uC(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[2]!==void 0?s?(s.p(o,i),i&4&&S(s,1)):(s=uC(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function EL(t,e,n){let s;ie(t,mi,f=>n(2,s=f));let o,i=!1,r=async()=>{n(1,i=!0),n(0,o=await Ft("/api/report/submit",{name:s.name,reason:s.reason,messageId:s.messageId,description:s.description||""}))},l=()=>{Xe(mi,s=void 0,s),n(0,o=void 0),n(1,i=void 0)};function a(){s.reason=Fs(this),mi.set(s)}function c(){s.description=this.value,mi.set(s)}return[o,i,s,r,l,a,c]}var xv=class extends Ce{constructor(e){super(),Pe(this,e,EL,TL,Be,{})}},pC=xv;var xl=t=>Math.round((10+t*5)**1.85/50)*50,wl=t=>Math.min(100,8+t*2);var dC=(t,e=200)=>{let n;return(s,o)=>{n&&clearTimeout(n),n=setTimeout(i=>t(s),o??e)}};function hC(t,e,n){let s=t.slice();return s[17]=e[n],s[19]=n,s}function gC(t){let e,n,s,o=me(t[1]),i=[];for(let a=0;a<o.length;a+=1)i[a]=_C(hC(t,o,a));let r=a=>E(i[a],1,1,()=>{i[a]=null}),l=null;return o.length||(l=vC(t)),{c(){e=h("div");for(let a=0;a<i.length;a+=1)i[a].c();n=de(),l&&l.c(),p(e,"class","divider")},m(a,c){w(a,e,c);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(a,c);w(a,n,c),l&&l.m(a,c),s=!0},p(a,c){if(c&74){o=me(a[1]);let f;for(f=0;f<o.length;f+=1){let u=hC(a,o,f);i[f]?(i[f].p(u,c),S(i[f],1)):(i[f]=_C(u),i[f].c(),S(i[f],1),i[f].m(n.parentNode,n))}for(Me(),f=o.length;f<i.length;f+=1)r(f);Fe(),!o.length&&l?l.p(a,c):o.length?l&&(l.d(1),l=null):(l=vC(a),l.c(),l.m(n.parentNode,n))}},i(a){if(!s){for(let c=0;c<o.length;c+=1)S(i[c]);s=!0}},o(a){i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)E(i[c]);s=!1},d(a){a&&(x(e),x(n)),st(i,a),l&&l.d(a)}}}function vC(t){let e;return{c(){e=h("div"),e.textContent="No results",p(e,"class","textgrey result")},m(n,s){w(n,e,s)},p:ae,d(n){n&&x(e)}}}function _C(t){let e,n,s,o,i,r,l=[t[17]],a={};for(let f=0;f<l.length;f+=1)a=Ql(a,l[f]);n=new Xn({props:a});function c(...f){return t[14](t[19],...f)}return{c(){e=h("div"),J(n.$$.fragment),p(e,"class",s="result "+(t[19]===t[3]?"sel":""))},m(f,u){w(f,e,u),X(n,e,null),o=!0,i||(r=H(e,"mousedown",c),i=!0)},p(f,u){t=f;let m=u&2?pm(l,[dm(t[17])]):{};n.$set(m),(!o||u&8&&s!==(s="result "+(t[19]===t[3]?"sel":"")))&&p(e,"class",s)},i(f){o||(S(n.$$.fragment,f),o=!0)},o(f){E(n.$$.fragment,f),o=!1},d(f){f&&x(e),Q(n),i=!1,r()}}}function IL(t){let e,n,s,o,i,r,l,a=t[2]&&gC(t);return{c(){e=h("div"),n=h("div"),s=h("input"),a&&a.c(),p(s,"placeholder","Name"),p(s,"type","text"),p(n,"class",o="container input "+(t[2]?"focus":"")),p(e,"class","finder")},m(c,f){w(c,e,f),d(e,n),d(n,s),t[10](s),je(s,t[0]),a&&a.m(n,null),i=!0,r||(l=[H(s,"input",t[11]),H(s,"input",t[5]),H(s,"focus",t[12]),H(s,"blur",t[13])],r=!0)},p(c,[f]){f&1&&s.value!==c[0]&&je(s,c[0]),c[2]?a?(a.p(c,f),f&4&&S(a,1)):(a=gC(c),a.c(),S(a,1),a.m(n,null)):a&&(Me(),E(a,1,1,()=>{a=null}),Fe()),(!i||f&4&&o!==(o="container input "+(c[2]?"focus":"")))&&p(n,"class",o)},i(c){i||(S(a),i=!0)},o(c){E(a),i=!1},d(c){c&&x(e),t[10](null),a&&a.d(),r=!1,rt(l)}}}function DL(t,e,n){let s=dC(async()=>{n(1,a=await Ft("api/playerinfo/search",{[r]:i,order:"name",limit:l})),g(a.findIndex(A=>A.name.toLowerCase()==i.toLowerCase()))}),{id:o}=e,{name:i=""}=e,{type:r="name"}=e,{limit:l=5}=e,a=[],c=!1,f=-1,u,m,g=A=>{n(3,f=A),f>=0&&(u=a[f],n(0,i=u.name),n(7,o=u.id))},v=A=>{A.target==m&&((A.keyCode===38||A.keyCode===40)&&a.length?(g(Sa(f+(A.keyCode===38?-1:1),a.length)),A.preventDefault()):(A.keyCode==13||A.keyCode==27)&&m.blur())};Fn(()=>{document.addEventListener("keydown",v)}),Tn(()=>{document.removeEventListener("keydown",v),n(4,m=void 0)});function _(A){qt[A?"unshift":"push"](()=>{m=A,n(4,m)})}function b(){i=this.value,n(0,i)}let k=A=>n(2,c=!0),y=A=>n(2,c=!1),F=(A,C)=>g(A);return t.$$set=A=>{"id"in A&&n(7,o=A.id),"name"in A&&n(0,i=A.name),"type"in A&&n(8,r=A.type),"limit"in A&&n(9,l=A.limit)},[i,a,c,f,m,s,g,o,r,l,_,b,k,y,F]}var wv=class extends Ce{constructor(e){super(),Pe(this,e,DL,IL,Be,{id:7,name:0,type:8,limit:9})}},Ml=wv;function bC(t,e,n){let s=t.slice();return s[24]=e[n],s[23]=n,s}function yC(t,e,n){let s=t.slice();return s[21]=e[n],s[23]=n,s}function kC(t,e,n){let s=t.slice();return s[26]=e[n],s[23]=n,s}function xC(t){let e,n,s,o,i,r,l,a,c=t[0].tag+"",f,u,m=t[0].name+"",g,v,_,b=P.factions[t[0].faction].name+"",k,y,F=P.ui.clan.heading+"",A,C,M,V,$,D,z,q,L=t[0].level+"",O,j,R,U=wl(t[0].level)+"",Z,ye,we,he,re=wl(t[0].level+1)-wl(t[0].level)+"",le,ve,_e=P.ui.clan.capacity+"",Ie,oe,Ee,K=t[0].tax+"",Re,Ge,Qe,Ye,pe,ce,Oe=t[0].members.length+"",se,ee,N,ue=`${t[0].online} (+${t[0].online*60} EXP/h)`,We,ze,Ae,$e,Ue,mt,wt=dt(t[0].prestige)+"",Je,Et,xe,Ke,bt,Ct,Ve,be,Vt,Ht,Lt,Rt,He,et;M=new ks({props:{size:"1em",fract:Math.ceil(t[0].exp/xl(t[0].level)*100),barcol:"bgpurp",left:`${dt(t[0].exp)} / ${dt(xl(t[0].level))} EXP`,right:`${Math.ceil(t[0].exp/xl(t[0].level)*100)}% `}}),xe=new xn({props:{amount:t[0].gold}});let Te=t[0].role>-1&&wC(t),it=t[0].role>0&&MC(t),Ze=t[0].eligibleApply.length>0&&FC(t),ft=t[1]&&SC(t),wn=t[0].role>0&&PC(t),Io=[LL,VL],fs=[];function Ls(pt,zt){return pt[6]=="members"?0:pt[6]=="applications"?1:-1}return~(Ht=Ls(t,-1))&&(Lt=fs[Ht]=Io[Ht](t)),{c(){e=h("div"),n=h("div"),s=h("div"),o=h("img"),r=h("div"),l=h("div"),a=h("h1"),f=T(c),u=h("h3"),g=T(m),_=h("p"),k=T(b),y=Ne(),A=T(F),C=h("div"),J(M.$$.fragment),V=h("div"),$=h("div"),D=h("div"),z=h("span"),z.textContent=`${P.ui.clan.level}`,q=h("span"),O=T(L),j=h("span"),j.textContent=`${P.ui.clan.capacity}`,R=h("span"),Z=T(U),ye=h("span"),ye.textContent=`${P.ui.clan.nextlevel}`,we=h("span"),he=T("+"),le=T(re),ve=Ne(),Ie=T(_e),oe=h("span"),oe.textContent=`${P.ui.clan.taxrate}`,Ee=h("span"),Re=T(K),Ge=T("%"),Qe=h("div"),Ye=h("div"),pe=h("span"),pe.textContent=`${P.ui.clan.members}`,ce=h("span"),se=T(Oe),ee=h("span"),ee.textContent=`${P.ui.clan.online}`,N=h("span"),We=T(ue),ze=h("span"),ze.textContent=`${P.ui.stats.array[20]}`,Ae=h("span"),$e=h("img"),mt=Ne(),Je=T(wt),Et=h("span"),Et.textContent=`${P.ui.clan.treasury}`,J(xe.$$.fragment),Te&&Te.c(),Ke=de(),it&&it.c(),bt=de(),Ze&&Ze.c(),Ct=de(),ft&&ft.c(),Ve=h("div"),be=h("div"),Vt=h("div"),Vt.textContent=`${P.ui.clan.members}`,wn&&wn.c(),Lt&&Lt.c(),p(o,"class","helmet absCentered svelte-6t8hqd"),at(o.src,i="/data/ui/factions/"+t[0].faction+".svg?v=8685122")||p(o,"src",i),p(l,"class",v="textf"+t[0].faction+" svelte-6t8hqd"),p(r,"class","textcenter"),p(s,"class","hero svelte-6t8hqd"),p(C,"class","panel-black svelte-6t8hqd"),p(z,"class","textprimary"),p(j,"class","textprimary"),p(ye,"class","textprimary"),p(oe,"class","textprimary"),p(D,"class","panel-black grid two svelte-6t8hqd"),p(pe,"class","textprimary"),p(ee,"class","textprimary"),p(ze,"class","textprimary"),p($e,"class","svgicon"),at($e.src,Ue=Ha)||p($e,"src",Ue),p(Ae,"class","textprestige"),p(Et,"class","textprimary"),p(Ye,"class","panel-black grid two svelte-6t8hqd"),p(V,"class","marg-top grid two"),p(n,"class","row slim"),p(e,"class","fold fadeIn"),p(Vt,"class","btn navbtn grey"),p(be,"class","subnav marg-top"),p(Ve,"class","row slim fadeIn")},m(pt,zt){w(pt,e,zt),d(e,n),d(n,s),d(s,o),d(s,r),d(r,l),d(l,a),d(a,f),d(l,u),d(u,g),d(r,_),d(_,k),d(_,y),d(_,A),d(n,C),X(M,C,null),d(n,V),d(V,$),d($,D),d(D,z),d(D,q),d(q,O),d(D,j),d(D,R),d(R,Z),d(D,ye),d(D,we),d(we,he),d(we,le),d(we,ve),d(we,Ie),d(D,oe),d(D,Ee),d(Ee,Re),d(Ee,Ge),d(V,Qe),d(Qe,Ye),d(Ye,pe),d(Ye,ce),d(ce,se),d(Ye,ee),d(Ye,N),d(N,We),d(Ye,ze),d(Ye,Ae),d(Ae,$e),d(Ae,mt),d(Ae,Je),d(Ye,Et),X(xe,Ye,null),Te&&Te.m(n,null),d(n,Ke),it&&it.m(n,null),d(n,bt),Ze&&Ze.m(n,null),d(n,Ct),ft&&ft.m(n,null),w(pt,Ve,zt),d(Ve,be),d(be,Vt),wn&&wn.m(be,null),~Ht&&fs[Ht].m(Ve,null),Rt=!0,He||(et=H(Vt,"click",t[14]),He=!0)},p(pt,zt){(!Rt||zt&1&&!at(o.src,i="/data/ui/factions/"+pt[0].faction+".svg?v=8685122"))&&p(o,"src",i),(!Rt||zt&1)&&c!==(c=pt[0].tag+"")&&G(f,c),(!Rt||zt&1)&&m!==(m=pt[0].name+"")&&G(g,m),(!Rt||zt&1&&v!==(v="textf"+pt[0].faction+" svelte-6t8hqd"))&&p(l,"class",v),(!Rt||zt&1)&&b!==(b=P.factions[pt[0].faction].name+"")&&G(k,b);let Do={};zt&1&&(Do.fract=Math.ceil(pt[0].exp/xl(pt[0].level)*100)),zt&1&&(Do.left=`${dt(pt[0].exp)} / ${dt(xl(pt[0].level))} EXP`),zt&1&&(Do.right=`${Math.ceil(pt[0].exp/xl(pt[0].level)*100)}% `),M.$set(Do),(!Rt||zt&1)&&L!==(L=pt[0].level+"")&&G(O,L),(!Rt||zt&1)&&U!==(U=wl(pt[0].level)+"")&&G(Z,U),(!Rt||zt&1)&&re!==(re=wl(pt[0].level+1)-wl(pt[0].level)+"")&&G(le,re),(!Rt||zt&1)&&K!==(K=pt[0].tax+"")&&G(Re,K),(!Rt||zt&1)&&Oe!==(Oe=pt[0].members.length+"")&&G(se,Oe),(!Rt||zt&1)&&ue!==(ue=`${pt[0].online} (+${pt[0].online*60} EXP/h)`)&&G(We,ue),(!Rt||zt&1)&&wt!==(wt=dt(pt[0].prestige)+"")&&G(Je,wt);let Wn={};zt&1&&(Wn.amount=pt[0].gold),xe.$set(Wn),pt[0].role>-1?Te?Te.p(pt,zt):(Te=wC(pt),Te.c(),Te.m(n,Ke)):Te&&(Te.d(1),Te=null),pt[0].role>0?it?(it.p(pt,zt),zt&1&&S(it,1)):(it=MC(pt),it.c(),S(it,1),it.m(n,bt)):it&&(Me(),E(it,1,1,()=>{it=null}),Fe()),pt[0].eligibleApply.length>0?Ze?Ze.p(pt,zt):(Ze=FC(pt),Ze.c(),Ze.m(n,Ct)):Ze&&(Ze.d(1),Ze=null),pt[1]?ft?ft.p(pt,zt):(ft=SC(pt),ft.c(),ft.m(n,null)):ft&&(ft.d(1),ft=null),pt[0].role>0?wn?wn.p(pt,zt):(wn=PC(pt),wn.c(),wn.m(be,null)):wn&&(wn.d(1),wn=null);let us=Ht;Ht=Ls(pt,zt),Ht===us?~Ht&&fs[Ht].p(pt,zt):(Lt&&(Me(),E(fs[us],1,1,()=>{fs[us]=null}),Fe()),~Ht?(Lt=fs[Ht],Lt?Lt.p(pt,zt):(Lt=fs[Ht]=Io[Ht](pt),Lt.c()),S(Lt,1),Lt.m(Ve,null)):Lt=null)},i(pt){Rt||(S(M.$$.fragment,pt),S(xe.$$.fragment,pt),S(it),S(Lt),Rt=!0)},o(pt){E(M.$$.fragment,pt),E(xe.$$.fragment,pt),E(it),E(Lt),Rt=!1},d(pt){pt&&(x(e),x(Ve)),Q(M),Q(xe),Te&&Te.d(),it&&it.d(),Ze&&Ze.d(),ft&&ft.d(),wn&&wn.d(),~Ht&&fs[Ht].d(),He=!1,et()}}}function wC(t){let e,n,s,o=P.ui.clan.roles[t[0].role]+"",i;return{c(){e=h("div"),n=h("span"),n.textContent=`${P.ui.clan.highestrank}: `,s=h("span"),i=T(o),p(n,"class","textprimary"),p(s,"class","textgreen"),p(e,"class","marg-top panel-black svelte-6t8hqd")},m(r,l){w(r,e,l),d(e,n),d(e,s),d(s,i)},p(r,l){l&1&&o!==(o=P.ui.clan.roles[r[0].role]+"")&&G(i,o)},d(r){r&&x(e)}}}function MC(t){let e,n,s,o,i,r,l=P.ui.clan.inviteplayer+"",a,c,f,u,m;function g(_){t[12](_)}let v={};return t[4]!==void 0&&(v.name=t[4]),o=new Ml({props:v}),qt.push(()=>mo(o,"name",g)),{c(){e=h("div"),n=h("span"),n.textContent=`${P.ui.clan.inviteplayers}`,s=h("div"),J(o.$$.fragment),r=h("div"),a=T(l),p(n,"class","textgrey"),p(r,"class",c="btn formatted navbtn grey "+(t[3]||!t[4].length?"disabled":"")),p(s,"class","subnav"),p(e,"class","marg-top panel-black svelte-6t8hqd")},m(_,b){w(_,e,b),d(e,n),d(e,s),X(o,s,null),d(s,r),d(r,a),f=!0,u||(m=H(r,"click",t[8]),u=!0)},p(_,b){let k={};!i&&b&16&&(i=!0,k.name=_[4],uo(()=>i=!1)),o.$set(k),(!f||b&24&&c!==(c="btn formatted navbtn grey "+(_[3]||!_[4].length?"disabled":"")))&&p(r,"class",c)},i(_){f||(S(o.$$.fragment,_),f=!0)},o(_){E(o.$$.fragment,_),f=!1},d(_){_&&x(e),Q(o),u=!1,m()}}}function FC(t){let e,n,s,o,i,r=P.ui.apply+"",l,a,c,f,u=me(t[0].eligibleApply),m=[];for(let g=0;g<u.length;g+=1)m[g]=CC(kC(t,u,g));return{c(){e=h("div"),n=h("span"),n.textContent=`${P.ui.clan.apply}`,s=h("div"),o=h("select");for(let g=0;g<m.length;g+=1)m[g].c();i=h("div"),l=T(r),p(n,"class","textgrey"),p(o,"class","navbtn"),t[5]===void 0&&bn(()=>t[13].call(o)),p(i,"class",a="btn formatted navbtn grey "+(t[3]||!t[5].length?"disabled":"")),p(s,"class","subnav"),p(e,"class","marg-top panel-black svelte-6t8hqd")},m(g,v){w(g,e,v),d(e,n),d(e,s),d(s,o);for(let _=0;_<m.length;_+=1)m[_]&&m[_].m(o,null);Mn(o,t[5],!0),d(s,i),d(i,l),c||(f=[H(o,"change",t[13]),H(i,"click",t[9])],c=!0)},p(g,v){if(v&33){u=me(g[0].eligibleApply);let _;for(_=0;_<u.length;_+=1){let b=kC(g,u,_);m[_]?m[_].p(b,v):(m[_]=CC(b),m[_].c(),m[_].m(o,null))}for(;_<m.length;_+=1)m[_].d(1);m.length=u.length}v&33&&Mn(o,g[5]),v&41&&a!==(a="btn formatted navbtn grey "+(g[3]||!g[5].length?"disabled":""))&&p(i,"class",a)},d(g){g&&x(e),st(m,g),c=!1,rt(f)}}}function CC(t){let e,n=t[26]+"",s,o,i;return{c(){e=h("option"),s=T(n),e.selected=o=t[5]==t[26],e.__value=i=t[26],je(e,e.__value)},m(r,l){w(r,e,l),d(e,s)},p(r,l){l&1&&n!==(n=r[26]+"")&&G(s,n),l&33&&o!==(o=r[5]==r[26])&&(e.selected=o),l&1&&i!==(i=r[26])&&(e.__value=i,je(e,e.__value))},d(r){r&&x(e)}}}function SC(t){let e,n,s,o,i;return{c(){e=h("div"),n=h("span"),s=T(t[1]),p(n,"class",o="text"+t[2]+" svelte-6t8hqd"),p(e,"class",i="marg-top panel-black border "+t[2]+" svelte-6t8hqd")},m(r,l){w(r,e,l),d(e,n),d(n,s)},p(r,l){l&2&&G(s,r[1]),l&4&&o!==(o="text"+r[2]+" svelte-6t8hqd")&&p(n,"class",o),l&4&&i!==(i="marg-top panel-black border "+r[2]+" svelte-6t8hqd")&&p(e,"class",i)},d(r){r&&x(e)}}}function PC(t){let e,n=P.ui.clan.applications+"",s,o,i=t[0].applications.length+"",r,l,a,c,f;return{c(){e=h("div"),s=T(n),o=T(" ("),r=T(i),l=T(")"),a=Ne(),p(e,"class","btn navbtn grey")},m(u,m){w(u,e,m),d(e,s),d(e,o),d(e,r),d(e,l),w(u,a,m),c||(f=H(e,"click",t[15]),c=!0)},p(u,m){m&1&&i!==(i=u[0].applications.length+"")&&G(r,i)},d(u){u&&(x(e),x(a)),c=!1,f()}}}function VL(t){let e,n,s,o,i,r,l=[],a=new Map,c,f=me(t[0].applications),u=m=>m[24].name;for(let m=0;m<f.length;m+=1){let g=bC(t,f,m),v=u(g);a.set(v,l[m]=AC(v,g))}return{c(){e=h("div"),e.textContent=`${P.ui.clan.applicationdesc}`,n=h("table"),s=h("thead"),o=h("tr"),i=h("th"),i.textContent=`${P.ui.clan.player}`,r=h("tbody");for(let m=0;m<l.length;m+=1)l[m].c();p(e,"class","marg-top textgrey"),p(i,"width","70%"),p(o,"class","textprimary"),p(n,"class","marg-top panel-black svelte-6t8hqd")},m(m,g){w(m,e,g),w(m,n,g),d(n,s),d(s,o),d(o,i),d(n,r);for(let v=0;v<l.length;v+=1)l[v]&&l[v].m(r,null);c=!0},p(m,g){g&1025&&(f=me(m[0].applications),Me(),l=En(l,g,u,1,m,f,a,r,Hn,AC,null,bC),Fe())},i(m){if(!c){for(let g=0;g<f.length;g+=1)S(l[g]);c=!0}},o(m){for(let g=0;g<l.length;g+=1)E(l[g]);c=!1},d(m){m&&(x(e),x(n));for(let g=0;g<l.length;g+=1)l[g].d()}}}function LL(t){let e,n,s,o,i,r,l,a=[],c=new Map,f,u=me(t[0].members),m=g=>g[21].name;for(let g=0;g<u.length;g+=1){let v=yC(t,u,g),_=m(v);c.set(_,a[g]=TC(_,v))}return{c(){e=h("div"),e.textContent=`${P.ui.clan.memberdesc}`,n=h("table"),s=h("thead"),o=h("tr"),i=h("th"),i.textContent=`${P.ui.clan.roles[0]}`,r=h("th"),r.textContent=`${P.ui.clan.rank}`,l=h("tbody");for(let g=0;g<a.length;g+=1)a[g].c();p(e,"class","marg-top textgrey"),p(i,"width","70%"),p(o,"class","textprimary"),p(n,"class","marg-top panel-black svelte-6t8hqd")},m(g,v){w(g,e,v),w(g,n,v),d(n,s),d(s,o),d(o,i),d(o,r),d(n,l);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(l,null);f=!0},p(g,v){v&129&&(u=me(g[0].members),Me(),a=En(a,v,m,1,g,u,c,l,Hn,TC,null,yC),Fe())},i(g){if(!f){for(let v=0;v<u.length;v+=1)S(a[v]);f=!0}},o(g){for(let v=0;v<a.length;v+=1)E(a[v]);f=!1},d(g){g&&(x(e),x(n));for(let v=0;v<a.length;v+=1)a[v].d()}}}function AC(t,e){let n,s,o,i,r,l;o=new Xn({props:{name:e[24].name,pclass:e[24].class,level:e[24].level,faction:e[0].faction}});function a(...c){return e[17](e[24],...c)}return{key:t,first:null,c(){n=h("tr"),s=h("td"),J(o.$$.fragment),p(n,"class","striped"),this.first=n},m(c,f){w(c,n,f),d(n,s),X(o,s,null),i=!0,r||(l=H(n,"mousedown",a),r=!0)},p(c,f){e=c;let u={};f&1&&(u.name=e[24].name),f&1&&(u.pclass=e[24].class),f&1&&(u.level=e[24].level),f&1&&(u.faction=e[0].faction),o.$set(u)},i(c){i||(S(o.$$.fragment,c),i=!0)},o(c){E(o.$$.fragment,c),i=!1},d(c){c&&x(n),Q(o),r=!1,l()}}}function TC(t,e){let n,s,o,i,r=e[21].online?"\u2B24":"",l,a=e[21].owned?"\u2B50":"",c,f,u=P.ui.clan.roles[e[21].clanrole]+"",m,g,v,_,b;o=new Xn({props:{name:e[21].name,pclass:e[21].class,level:e[21].level,faction:e[0].faction}});function k(...y){return e[16](e[21],...y)}return{key:t,first:null,c(){n=h("tr"),s=h("td"),J(o.$$.fragment),i=h("span"),l=T(r),c=T(a),f=h("td"),m=T(u),p(i,"class","textgreen"),p(n,"class",g="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"),this.first=n},m(y,F){w(y,n,F),d(n,s),X(o,s,null),d(s,i),d(i,l),d(i,c),d(n,f),d(f,m),v=!0,_||(b=H(n,"mousedown",k),_=!0)},p(y,F){e=y;let A={};F&1&&(A.name=e[21].name),F&1&&(A.pclass=e[21].class),F&1&&(A.level=e[21].level),F&1&&(A.faction=e[0].faction),o.$set(A),(!v||F&1)&&r!==(r=e[21].online?"\u2B24":"")&&G(l,r),(!v||F&1)&&a!==(a=e[21].owned?"\u2B50":"")&&G(c,a),(!v||F&1)&&u!==(u=P.ui.clan.roles[e[21].clanrole]+"")&&G(m,u),(!v||F&1&&g!==(g="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"))&&p(n,"class",g)},i(y){v||(S(o.$$.fragment,y),v=!0)},o(y){E(o.$$.fragment,y),v=!1},d(y){y&&x(n),Q(o),_=!1,b()}}}function qL(t){let e,n,s=t[0]&&xC(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[0]?s?(s.p(o,i),i&1&&S(s,1)):(s=xC(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function RL(t,e,n){let{tag:s}=e,o,i,r=async()=>{let $=await Ft("/api/claninfo/info",{tag:s});$.name&&(n(0,o=$),o.eligibleApply.length&&n(5,v=o.eligibleApply[0]),n(0,o.online=o.members.filter(D=>D.online).length,o)),i&&(clearTimeout(i),i=setTimeout(r,5e3))};i=!0,r(),Tn(()=>{clearTimeout(i),i=void 0});let l=($,D)=>{let z=[];D.owned?z.push({name:P.ui.clan.leave,fun:async()=>{u(await Ft("/api/clan/leave",{name:D.name}),P.ui.clan.left)}}):D.clanrole<o.role&&z.push({name:P.ui.clan.kick,fun:async()=>{u(await Ft("/api/clan/kick",{name:D.name}),P.ui.clan.memberkicked)}});for(let q=0;q<(o.role==3?4:o.role);q++)z.push({name:P.ui.clan.setrank+": "+P.ui.clan.roles[q],fun:async()=>{u(await Ft("/api/clan/setrole",{name:D.name,role:q}),P.ui.clan.setrank+": "+P.ui.clan.roles[q])}});dn.set({x:$.pageX,y:$.pageY,opts:z})},a,c,f=!1,u=async($,D)=>{$.result!=="ok"?(n(1,a=$.result),n(2,c="red")):(n(1,a=D),n(2,c="green")),await r(),n(3,f=!1)},m="",g=async()=>{n(3,f=!0),u(await Ft("/api/clan/invite",{name:m,tag:s}),P.ui.clan.invited[0]+m+P.ui.clan.invited[1]),n(4,m="")},v="",_=async()=>{n(3,f=!0),u(await Ft("/api/clan/apply",{name:v,tag:s}),P.ui.clan.applied),n(5,v="")},b=($,D)=>{let z=[];o.role>0&&z.push({name:P.ui.clan.applicationaccept,fun:async()=>{u(await Ft("/api/clan/invite",{tag:s,name:D.name}),P.ui.clan.applicationaccepted)}}),o.role>1&&z.push({name:P.ui.clan.applicationdeny,fun:async()=>{u(await Ft("/api/clan/denyapplication",{id:D.id}),P.ui.clan.applicationdenied)}}),dn.set({x:$.pageX,y:$.pageY,opts:z})},k="members";function y($){m=$,n(4,m)}function F(){v=Fs(this),n(5,v),n(0,o)}let A=$=>n(6,k="members"),C=$=>n(6,k="applications"),M=($,D)=>l(D,$),V=($,D)=>b(D,$);return t.$$set=$=>{"tag"in $&&n(11,s=$.tag)},[o,a,c,f,m,v,k,l,g,_,b,s,y,F,A,C,M,V]}var Mv=class extends Ce{constructor(e){super(),Pe(this,e,RL,qL,Be,{tag:11})}},EC=Mv;function zL(t){let e,n,s,o,i,r,l=P.ui.cost+"",a,c,f,u,m,g,v,_=P.ui.clan.createbutton+"",b,k,y,F,A;return f=new xn({props:{amount:1e5}}),{c(){e=h("h3"),e.textContent=`${P.ui.clan.createheading}`,n=h("label"),n.textContent=`${P.ui.clan.createname}`,s=h("input"),o=h("label"),o.textContent=`${P.ui.clan.createtag}`,i=h("input"),r=h("p"),a=T(l),c=T(": "),J(f.$$.fragment),m=h("div"),g=T(t[3]),v=h("div"),b=T(_),p(e,"class","textprimary"),p(n,"class","svelte-7uvqsx"),p(s,"type","text"),p(s,"placeholder","Guardians of Guardstone (a-Z)"),p(s,"maxlength","20"),p(o,"class","svelte-7uvqsx"),p(i,"type","text"),p(i,"placeholder","GoG (a-Z !~=#*+-)"),p(i,"maxlength","4"),p(r,"class",u="text"+(t[2]>1e5?"primary":"red")),p(m,"class","textred"),Le(v,"display","inline-block"),p(v,"class",k="btn marg-top formatted "+(t[4]?"blue":"blue disabled"))},m(C,M){w(C,e,M),w(C,n,M),w(C,s,M),je(s,t[0]),w(C,o,M),w(C,i,M),je(i,t[1]),w(C,r,M),d(r,a),d(r,c),X(f,r,null),w(C,m,M),d(m,g),w(C,v,M),d(v,b),y=!0,F||(A=[H(s,"input",t[7]),H(i,"input",t[8]),H(v,"click",t[5])],F=!0)},p(C,[M]){M&1&&s.value!==C[0]&&je(s,C[0]),M&2&&i.value!==C[1]&&je(i,C[1]),(!y||M&4&&u!==(u="text"+(C[2]>1e5?"primary":"red")))&&p(r,"class",u),(!y||M&8)&&G(g,C[3]),(!y||M&16&&k!==(k="btn marg-top formatted "+(C[4]?"blue":"blue disabled")))&&p(v,"class",k)},i(C){y||(S(f.$$.fragment,C),y=!0)},o(C){E(f.$$.fragment,C),y=!1},d(C){C&&(x(e),x(n),x(s),x(o),x(i),x(r),x(m),x(v)),Q(f),F=!1,rt(A)}}}function BL(t,e,n){let s,o;ie(t,Qs,m=>n(2,o=m));let i="",r="",l=!1,a="",c=async()=>{if(l)return;n(6,l=!0);let m=await Ft("/api/clan/create",{name:i,tag:r});m.result!=="ok"&&(n(3,a=m.result),n(6,l=!1))};function f(){i=this.value,n(0,i)}function u(){r=this.value,n(1,r)}return t.$$.update=()=>{t.$$.dirty&71&&n(4,s=!l&&o>=1e5&&i.length<=20&&i.length>=3&&r.length<=4&&r.length>=2)},[i,r,o,a,s,c,l,f,u]}var Fv=class extends Ce{constructor(e){super(),Pe(this,e,BL,zL,Be,{})}},IC=Fv;function DC(t,e,n){let s=t.slice();return s[4]=e[n],s[6]=n,s}function $L(t){let e,n,s;function o(...i){return t[2](t[4],...i)}return{c(){e=h("div"),e.textContent=`${P.ui.accept}`,p(e,"class","btn blue")},m(i,r){w(i,e,r),n||(s=H(e,"click",o),n=!0)},p(i,r){t=i},d(i){i&&x(e),n=!1,s()}}}function UL(t){let e;return{c(){e=h("div"),e.textContent=`${P.ui.clan.application}`},m(n,s){w(n,e,s)},p:ae,d(n){n&&x(e)}}}function VC(t,e){let n,s,o=e[4].tag+"",i,r,l=e[4].name+"",a,c;function f(g,v){return g[4].request?UL:$L}let u=f(e,-1),m=u(e);return{key:t,first:null,c(){n=h("tr"),s=h("td"),i=T(o),r=h("td"),a=T(l),c=h("td"),m.c(),p(c,"class","textcenter"),p(n,"class","striped"),this.first=n},m(g,v){w(g,n,v),d(n,s),d(s,i),d(n,r),d(r,a),d(n,c),m.m(c,null)},p(g,v){e=g,v&1&&o!==(o=e[4].tag+"")&&G(i,o),v&1&&l!==(l=e[4].name+"")&&G(a,l),u===(u=f(e,v))&&m?m.p(e,v):(m.d(1),m=u(e),m&&(m.c(),m.m(c,null)))},d(g){g&&x(n),m.d()}}}function OL(t){let e,n,s,o,i,r,l,a=[],c=new Map,f=me(t[0]),u=m=>m[4].clan;for(let m=0;m<f.length;m+=1){let g=DC(t,f,m),v=u(g);c.set(v,a[m]=VC(v,g))}return{c(){e=h("table"),n=h("thead"),s=h("tr"),o=h("th"),o.textContent=`${P.ui.clan.createtag}`,i=h("th"),i.textContent=`${P.ui.clan.createname}`,r=h("th"),r.textContent=`${P.ui.clan.action}`,l=h("tbody");for(let m=0;m<a.length;m+=1)a[m].c();p(o,"width","20%"),p(i,"width","60%"),p(r,"class","textcenter"),p(s,"class","textprimary"),p(e,"class","marg-top panel-black")},m(m,g){w(m,e,g),d(e,n),d(n,s),d(s,o),d(s,i),d(s,r),d(e,l);for(let v=0;v<a.length;v+=1)a[v]&&a[v].m(l,null)},p(m,[g]){g&3&&(f=me(m[0]),a=En(a,g,u,1,m,f,c,l,w_,VC,null,DC))},i:ae,o:ae,d(m){m&&x(e);for(let g=0;g<a.length;g+=1)a[g].d()}}}function NL(t,e,n){let s=[];(async()=>{n(0,s=await Ft("/api/clan/invites",{name:I.player.name}))})();let i=async l=>{await Ft("/api/clan/apply",{tag:l,name:I.player.name})};return[s,i,(l,a)=>i(l.tag)]}var Cv=class extends Ce{constructor(e){super(),Pe(this,e,NL,OL,Be,{})}},LC=Cv;function qC(t){let e,n;return e=new $t({props:{origin:"center",title:P.ui.clan.heading,icon:"clan",scroll:!0,$$slots:{default:[XL]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&133&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function jL(t){let e,n,s,o,i,r,l;return{c(){e=h("div"),n=h("div"),s=h("h3"),s.textContent=`${P.ui.clan.noclan}`,o=h("div"),o.textContent=`${P.ui.clan.viewinvites}`,i=h("div"),i.textContent=`${P.ui.clan.createheading}`,p(o,"class","btn grey"),p(i,"class","btn grey marg-top"),p(n,"class","panel-black"),p(e,"class","clanInfoBox textcenter svelte-1vwl908")},m(a,c){w(a,e,c),d(e,n),d(n,s),d(n,o),d(n,i),r||(l=[H(o,"click",t[4]),H(i,"click",t[5])],r=!0)},p:ae,i:ae,o:ae,d(a){a&&x(e),r=!1,rt(l)}}}function WL(t){let e,n,s,o,i,r,l,a=[YL,HL],c=[];function f(u,m){return u[0]=="create"?0:u[0]=="invites"?1:-1}return~(s=f(t,-1))&&(o=c[s]=a[s](t)),{c(){e=h("div"),n=h("div"),n.textContent=`${P.ui.back}`,o&&o.c(),Le(n,"display","inline-block"),p(n,"class","btn formatted grey"),p(e,"class","modemenu svelte-1vwl908")},m(u,m){w(u,e,m),d(e,n),~s&&c[s].m(e,null),i=!0,r||(l=H(n,"click",t[3]),r=!0)},p(u,m){let g=s;s=f(u,m),s!==g&&(o&&(Me(),E(c[g],1,1,()=>{c[g]=null}),Fe()),~s?(o=c[s],o||(o=c[s]=a[s](u),o.c()),S(o,1),o.m(e,null)):o=null)},i(u){i||(S(o),i=!0)},o(u){E(o),i=!1},d(u){u&&x(e),~s&&c[s].d(),r=!1,l()}}}function GL(t){let e,n,s;return n=new EC({props:{tag:t[2]}}),{c(){e=h("div"),J(n.$$.fragment),p(e,"class","clanView svelte-1vwl908")},m(o,i){w(o,e,i),X(n,e,null),s=!0},p(o,i){let r={};i&4&&(r.tag=o[2]),n.$set(r)},i(o){s||(S(n.$$.fragment,o),s=!0)},o(o){E(n.$$.fragment,o),s=!1},d(o){o&&x(e),Q(n)}}}function HL(t){let e,n;return e=new LC({}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function YL(t){let e,n;return e=new IC({}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function XL(t){let e,n,s,o,i=[GL,WL,jL],r=[];function l(a,c){return a[2]?0:a[0]?1:2}return n=l(t,-1),s=r[n]=i[n](t),{c(){e=h("div"),s.c(),p(e,"class","container svelte-1vwl908")},m(a,c){w(a,e,c),r[n].m(e,null),o=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(Me(),E(r[f],1,1,()=>{r[f]=null}),Fe(),s=r[n],s?s.p(a,c):(s=r[n]=i[n](a),s.c()),S(s,1),s.m(e,null))},i(a){o||(S(s),o=!0)},o(a){E(s),o=!1},d(a){a&&x(e),r[n].d()}}}function QL(t){let e,n,s=t[1]&&qC(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[1]?s?(s.p(o,i),i&2&&S(s,1)):(s=qC(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function ZL(t,e,n){let s,o;ie(t,_i,f=>n(1,s=f)),ie(t,Cm,f=>n(2,o=f));let i=!1;return[i,s,o,f=>n(0,i=!1),f=>n(0,i="invites"),f=>n(0,i="create"),()=>{Xe(_i,s=!1,s)}]}var Sv=class extends Ce{constructor(e){super(),Pe(this,e,ZL,QL,Be,{})}},RC=Sv;function zC(t,e,n){let s=t.slice();return s[40]=e[n],s}function BC(t,e,n){let s=t.slice();return s[34]=e[n],s[35]=e,s[36]=n,s}function $C(t,e,n){let s=t.slice();return s[37]=e[n],s[38]=e,s[39]=n,s}function UC(t){let e,n;return e=new $t({props:{title:"Social",icon:"social",origin:"left top",defaultOffset:[3,100],$$slots:{default:[mq]},$$scope:{ctx:t}}}),e.$on("close",t[30]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o[0]&2045|o[1]&4096&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function JL(t){let e,n=[],s=new Map,o,i,r,l,a=me(t[7]),c=g=>g[40].id;for(let g=0;g<a.length;g+=1){let v=zC(t,a,g),_=c(v);s.set(_,n[g]=OC(_,v))}let f=[nq,tq,eq],u=[];function m(g,v){return g[10]==="ok"?0:g[10]==="error"?1:2}return o=m(t,[-1,-1]),i=u[o]=f[o](t),{c(){e=h("div");for(let g=0;g<n.length;g+=1)n[g].c();i.c(),r=de(),p(e,"class","userlist scrollbar svelte-100hcdi")},m(g,v){w(g,e,v);for(let _=0;_<n.length;_+=1)n[_]&&n[_].m(e,null);u[o].m(g,v),w(g,r,v),l=!0},p(g,v){v[0]&32896&&(a=me(g[7]),Me(),n=En(n,v,c,1,g,a,s,e,Hn,OC,null,zC),Fe());let _=o;o=m(g,v),o===_?u[o].p(g,v):(Me(),E(u[_],1,1,()=>{u[_]=null}),Fe(),i=u[o],i?i.p(g,v):(i=u[o]=f[o](g),i.c()),S(i,1),i.m(r.parentNode,r))},i(g){if(!l){for(let v=0;v<a.length;v+=1)S(n[v]);S(i),l=!0}},o(g){for(let v=0;v<n.length;v+=1)E(n[v]);E(i),l=!1},d(g){g&&(x(e),x(r));for(let v=0;v<n.length;v+=1)n[v].d();u[o].d(g)}}}function KL(t){let e,n,s,o,i,r,l,a,c=t[6].length>0&&NC(t),f=[rq,iq],u=[];function m(b,k){return b[2].length>0?0:1}s=m(t,[-1,-1]),o=u[s]=f[s](t);let g=[uq,fq,cq],v=[];function _(b,k){return b[5]==="ok"?0:b[5]==="error"?1:2}return i=_(t,[-1,-1]),r=v[i]=g[i](t),{c(){e=h("div"),c&&c.c(),n=de(),o.c(),r.c(),l=de(),p(e,"class","userlist scrollbar svelte-100hcdi")},m(b,k){w(b,e,k),c&&c.m(e,null),d(e,n),u[s].m(e,null),v[i].m(b,k),w(b,l,k),a=!0},p(b,k){b[6].length>0?c?(c.p(b,k),k[0]&64&&S(c,1)):(c=NC(b),c.c(),S(c,1),c.m(e,n)):c&&(Me(),E(c,1,1,()=>{c=null}),Fe());let y=s;s=m(b,k),s===y?u[s].p(b,k):(Me(),E(u[y],1,1,()=>{u[y]=null}),Fe(),o=u[s],o?o.p(b,k):(o=u[s]=f[s](b),o.c()),S(o,1),o.m(e,null));let F=i;i=_(b,k),i===F?v[i].p(b,k):(Me(),E(v[F],1,1,()=>{v[F]=null}),Fe(),r=v[i],r?r.p(b,k):(r=v[i]=g[i](b),r.c()),S(r,1),r.m(l.parentNode,l))},i(b){a||(S(c),S(o),S(r),a=!0)},o(b){E(c),E(o),E(r),a=!1},d(b){b&&(x(e),x(l)),c&&c.d(),u[s].d(),v[i].d(b)}}}function OC(t,e){let n,s,o,i,r,l,a;o=new Xn({props:{name:e[40].name,pclass:e[40].class,level:e[40].level,faction:e[40].faction}});function c(...f){return e[28](e[40],...f)}return{key:t,first:null,c(){n=h("div"),s=h("div"),J(o.$$.fragment),i=h("div"),i.textContent="\u274C",p(s,"class","btn small textgrey"),p(i,"class","btn grey small"),p(n,"class","user-row panel-friend block svelte-100hcdi"),this.first=n},m(f,u){w(f,n,u),d(n,s),X(o,s,null),d(n,i),r=!0,l||(a=H(i,"click",c),l=!0)},p(f,u){e=f;let m={};u[0]&128&&(m.name=e[40].name),u[0]&128&&(m.pclass=e[40].class),u[0]&128&&(m.level=e[40].level),u[0]&128&&(m.faction=e[40].faction),o.$set(m)},i(f){r||(S(o.$$.fragment,f),r=!0)},o(f){E(o.$$.fragment,f),r=!1},d(f){f&&x(n),Q(o),l=!1,a()}}}function eq(t){let e,n,s,o,i,r,l,a,c;function f(m){t[29](m)}let u={};return t[8]!==void 0&&(u.name=t[8]),n=new Ml({props:u}),qt.push(()=>mo(n,"name",f)),{c(){e=h("div"),J(n.$$.fragment),o=h("div"),i=T("Block"),p(o,"class",r="btn navbtn formatted "+(t[9]&&t[8].length>0?"grey":"grey disabled")),p(e,"class","bar-top svelte-100hcdi")},m(m,g){w(m,e,g),X(n,e,null),d(e,o),d(o,i),l=!0,a||(c=H(o,"click",t[14]),a=!0)},p(m,g){let v={};!s&&g[0]&256&&(s=!0,v.name=m[8],uo(()=>s=!1)),n.$set(v),(!l||g[0]&768&&r!==(r="btn navbtn formatted "+(m[9]&&m[8].length>0?"grey":"grey disabled")))&&p(o,"class",r)},i(m){l||(S(n.$$.fragment,m),l=!0)},o(m){E(n.$$.fragment,m),l=!1},d(m){m&&x(e),Q(n),a=!1,c()}}}function tq(t){let e;return{c(){e=h("div"),e.textContent="Player not found.",p(e,"class","btn navbtn panel-black formatted textcenter textred fadeIn")},m(n,s){w(n,e,s)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function nq(t){let e;return{c(){e=h("div"),e.textContent="Player blocked!",p(e,"class","btn navbtn panel-black formatted textcenter textgreen fadeIn")},m(n,s){w(n,e,s)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function NC(t){let e,n=[],s=new Map,o,i,r=me(t[6]),l=a=>a[37].id;for(let a=0;a<r.length;a+=1){let c=$C(t,r,a),f=l(c);s.set(f,n[a]=jC(f,c))}return{c(){e=h("small"),e.textContent="Incoming Requests";for(let a=0;a<n.length;a+=1)n[a].c();o=de(),p(e,"class","textgrey")},m(a,c){w(a,e,c);for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(a,c);w(a,o,c),i=!0},p(a,c){c[0]&8256&&(r=me(a[6]),Me(),n=En(n,c,l,1,a,r,s,o.parentNode,Hn,jC,o,$C),Fe())},i(a){if(!i){for(let c=0;c<r.length;c+=1)S(n[c]);i=!0}},o(a){for(let c=0;c<n.length;c+=1)E(n[c]);i=!1},d(a){a&&(x(e),x(o));for(let c=0;c<n.length;c+=1)n[c].d(a)}}}function sq(t){let e,n;return e=new Xn({props:{name:t[37].name,pclass:t[37].class,level:t[37].level,faction:t[37].faction}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o[0]&64&&(i.name=s[37].name),o[0]&64&&(i.pclass=s[37].class),o[0]&64&&(i.level=s[37].level),o[0]&64&&(i.faction=s[37].faction),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function oq(t){let e,n,s=t[37].to_name+"",o;return{c(){e=h("span"),n=T("Via "),o=T(s),p(e,"class","textgrey")},m(i,r){w(i,e,r),d(e,n),d(e,o)},p(i,r){r[0]&64&&s!==(s=i[37].to_name+"")&&G(o,s)},i:ae,o:ae,d(i){i&&x(e)}}}function jC(t,e){let n,s,o,i,r,l,a,c,f,u=[oq,sq],m=[];function g(y,F){return y[37].hover?0:1}o=g(e,[-1,-1]),i=m[o]=u[o](e);function v(...y){return e[20](e[37],...y)}function _(...y){return e[21](e[37],...y)}function b(...y){return e[22](e[37],e[38],e[39],...y)}function k(...y){return e[23](e[37],e[38],e[39],...y)}return{key:t,first:null,c(){n=h("div"),s=h("div"),i.c(),r=h("div"),r.textContent="\u{1F91D}",l=h("div"),l.textContent="\u274C",p(s,"class","btn nocursor small textnooverflow svelte-100hcdi"),p(r,"class","btn grey small green"),p(l,"class","btn grey small"),p(n,"class","user-row panel-friend request flashing-border svelte-100hcdi"),this.first=n},m(y,F){w(y,n,F),d(n,s),m[o].m(s,null),d(n,r),d(n,l),a=!0,c||(f=[H(r,"click",v),H(l,"click",_),H(n,"mouseenter",b),H(n,"mouseleave",k)],c=!0)},p(y,F){e=y;let A=o;o=g(e,F),o===A?m[o].p(e,F):(Me(),E(m[A],1,1,()=>{m[A]=null}),Fe(),i=m[o],i?i.p(e,F):(i=m[o]=u[o](e),i.c()),S(i,1),i.m(s,null))},i(y){a||(S(i),a=!0)},o(y){E(i),a=!1},d(y){y&&x(n),m[o].d(),c=!1,rt(f)}}}function iq(t){let e;return{c(){e=h("small"),e.textContent="Add someone to your friends list!",p(e,"class","textgrey textcenter"),Le(e,"padding","50px")},m(n,s){w(n,e,s)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function rq(t){let e,n=[],s=new Map,o,i,r=t[6].length>0&&WC(t),l=me(t[2]),a=c=>c[34].id;for(let c=0;c<l.length;c+=1){let f=BC(t,l,c),u=a(f);s.set(u,n[c]=HC(u,f))}return{c(){r&&r.c(),e=de();for(let c=0;c<n.length;c+=1)n[c].c();o=de()},m(c,f){r&&r.m(c,f),w(c,e,f);for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(c,f);w(c,o,f),i=!0},p(c,f){c[6].length>0?r||(r=WC(c),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),f[0]&4100&&(l=me(c[2]),Me(),n=En(n,f,a,1,c,l,s,o.parentNode,Hn,HC,o,BC),Fe())},i(c){if(!i){for(let f=0;f<l.length;f+=1)S(n[f]);i=!0}},o(c){for(let f=0;f<n.length;f+=1)E(n[f]);i=!1},d(c){c&&(x(e),x(o)),r&&r.d(c);for(let f=0;f<n.length;f+=1)n[f].d(c)}}}function WC(t){let e;return{c(){e=h("small"),e.textContent="Friends",p(e,"class","textgrey")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function lq(t){let e,n=t[34].customname+"",s,o;return{c(){e=h("span"),s=T(n),p(e,"class",o="btn nocursor small textnooverflow "+(t[34].online?"textprimary":"textgrey")+" textnooverflow svelte-100hcdi")},m(i,r){w(i,e,r),d(e,s)},p(i,r){r[0]&4&&n!==(n=i[34].customname+"")&&G(s,n),r[0]&4&&o!==(o="btn nocursor small textnooverflow "+(i[34].online?"textprimary":"textgrey")+" textnooverflow svelte-100hcdi")&&p(e,"class",o)},i:ae,o:ae,d(i){i&&x(e)}}}function aq(t){let e,n,s;e=new Xn({props:{name:t[34].name,pclass:t[34].class,level:t[34].level,faction:t[34].faction}});let o=t[34].name!==t[34].customname&&GC(t);return{c(){J(e.$$.fragment),o&&o.c(),n=de()},m(i,r){X(e,i,r),o&&o.m(i,r),w(i,n,r),s=!0},p(i,r){let l={};r[0]&4&&(l.name=i[34].name),r[0]&4&&(l.pclass=i[34].class),r[0]&4&&(l.level=i[34].level),r[0]&4&&(l.faction=i[34].faction),e.$set(l),i[34].name!==i[34].customname?o?o.p(i,r):(o=GC(i),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},i(i){s||(S(e.$$.fragment,i),s=!0)},o(i){E(e.$$.fragment,i),s=!1},d(i){i&&x(n),Q(e,i),o&&o.d(i)}}}function GC(t){let e,n=t[34].customname+"",s;return{c(){e=h("span"),s=T(n),p(e,"class","btn nocursor small textnooverflow textprimary textnooverflow svelte-100hcdi")},m(o,i){w(o,e,i),d(e,s)},p(o,i){i[0]&4&&n!==(n=o[34].customname+"")&&G(s,n)},d(o){o&&x(e)}}}function HC(t,e){let n,s,o,i,r=e[34].online?"\u2B24":"\u25CB",l,a,c,f,u,m,g,v,_=[aq,lq],b=[];function k(C,M){return C[34].online&&C[34].name!==null?0:1}f=k(e,[-1,-1]),u=b[f]=_[f](e);function y(...C){return e[24](e[34],...C)}function F(...C){return e[25](e[34],e[35],e[36],...C)}function A(...C){return e[26](e[34],e[35],e[36],...C)}return{key:t,first:null,c(){n=h("div"),s=h("div"),o=h("div"),i=h("small"),l=T(r),a=Ne(),u.c(),p(i,"class",c=e[34].online?"textgreen":"textgrey"),p(o,"class","btn small textnooverflow svelte-100hcdi"),p(s,"class","friend svelte-100hcdi"),p(n,"class","user-row panel-friend svelte-100hcdi"),this.first=n},m(C,M){w(C,n,M),d(n,s),d(s,o),d(o,i),d(i,l),d(i,a),b[f].m(o,null),m=!0,g||(v=[H(o,"contextmenu",y),H(n,"mouseenter",F),H(n,"mouseleave",A)],g=!0)},p(C,M){e=C,(!m||M[0]&4)&&r!==(r=e[34].online?"\u2B24":"\u25CB")&&G(l,r),(!m||M[0]&4&&c!==(c=e[34].online?"textgreen":"textgrey"))&&p(i,"class",c);let V=f;f=k(e,M),f===V?b[f].p(e,M):(Me(),E(b[V],1,1,()=>{b[V]=null}),Fe(),u=b[f],u?u.p(e,M):(u=b[f]=_[f](e),u.c()),S(u,1),u.m(o,null))},i(C){m||(S(u),m=!0)},o(C){E(u),m=!1},d(C){C&&x(n),b[f].d(),g=!1,rt(v)}}}function cq(t){let e,n,s,o,i,r,l,a,c;function f(m){t[27](m)}let u={};return t[3]!==void 0&&(u.name=t[3]),n=new Ml({props:u}),qt.push(()=>mo(n,"name",f)),{c(){e=h("div"),J(n.$$.fragment),o=h("div"),i=T("Add"),p(o,"class",r="btn navbtn formatted "+(t[4]&&t[3].length>0?"green":"grey disabled")),p(e,"class","bar-top svelte-100hcdi")},m(m,g){w(m,e,g),X(n,e,null),d(e,o),d(o,i),l=!0,a||(c=H(o,"click",t[11]),a=!0)},p(m,g){let v={};!s&&g[0]&8&&(s=!0,v.name=m[3],uo(()=>s=!1)),n.$set(v),(!l||g[0]&24&&r!==(r="btn navbtn formatted "+(m[4]&&m[3].length>0?"green":"grey disabled")))&&p(o,"class",r)},i(m){l||(S(n.$$.fragment,m),l=!0)},o(m){E(n.$$.fragment,m),l=!1},d(m){m&&x(e),Q(n),a=!1,c()}}}function fq(t){let e;return{c(){e=h("div"),e.textContent="Player not found.",p(e,"class","btn navbtn panel-black formatted textcenter textred fadeIn")},m(n,s){w(n,e,s)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function uq(t){let e;return{c(){e=h("div"),e.textContent="Friend request sent!",p(e,"class","btn navbtn panel-black formatted textcenter textgreen fadeIn")},m(n,s){w(n,e,s)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function mq(t){let e,n,s,o,i,r,l,a,c,f,u,m,g,v=[KL,JL],_=[];function b(k,y){return k[0]==="friends"?0:k[0]==="blocked"?1:-1}return~(c=b(t,[-1,-1]))&&(f=_[c]=v[c](t)),{c(){e=h("div"),n=h("div"),s=T("Friends"),i=h("div"),r=T("Blocked"),a=h("div"),f&&f.c(),p(n,"class",o="textcenter tab equal small "+(t[0]==="friends"?"active":"")),p(i,"class",l="textcenter tab equal small "+(t[0]==="blocked"?"active":"")),p(e,"class","tab-bar flex"),p(a,"class","container panel-bright svelte-100hcdi")},m(k,y){w(k,e,y),d(e,n),d(n,s),d(e,i),d(i,r),w(k,a,y),~c&&_[c].m(a,null),u=!0,m||(g=[H(n,"click",t[18]),H(i,"click",t[19])],m=!0)},p(k,y){(!u||y[0]&1&&o!==(o="textcenter tab equal small "+(k[0]==="friends"?"active":"")))&&p(n,"class",o),(!u||y[0]&1&&l!==(l="textcenter tab equal small "+(k[0]==="blocked"?"active":"")))&&p(i,"class",l);let F=c;c=b(k,y),c===F?~c&&_[c].p(k,y):(f&&(Me(),E(_[F],1,1,()=>{_[F]=null}),Fe()),~c?(f=_[c],f?f.p(k,y):(f=_[c]=v[c](k),f.c()),S(f,1),f.m(a,null)):f=null)},i(k){u||(S(f),u=!0)},o(k){E(f),u=!1},d(k){k&&(x(e),x(a)),~c&&_[c].d(),m=!1,rt(g)}}}function pq(t){let e,n,s=t[1]&&UC(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,i){o[1]?s?(s.p(o,i),i[0]&2&&S(s,1)):(s=UC(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function dq(t,e,n){let s,o;ie(t,pi,re=>n(17,s=re)),ie(t,bi,re=>n(1,o=re));let i="friends";Xe(pi,s=!0,s);let r=async()=>{n(2,{friends:a,requests:_}=await Ft("/api/social/getFriends",{}),a,n(6,_))},l=async()=>{n(7,{blocks:y}=await Ft("/api/social/getBlocks",{}),y)},a=[],c=0,f="",u=!0,m,g=async()=>{try{n(4,u=!1);let re=await Ft("/api/social/friendRequest",{name:f});n(5,m="ok")}catch{n(5,m="error")}setTimeout(()=>{n(5,m=void 0)},2e3),n(4,u=!0)},v=(re,le)=>{let ve=[{name:le.customname,css:"disabled"}];ve.push({name:"Remove friend",css:"",fun:()=>{Ft("/api/social/removeFriend",{id:le.id}),n(2,a=a.filter(_e=>_e.id!==le.id))}}),le.online&&(le.faction===I.player.faction&&(Xt.has(le.name)||ve.push(Wt.partyinvite(le.name))),ve.push(Wt.whisper(le.name))),dn.set({x:re.pageX,y:re.pageY,opts:ve})},_=[],b=async(re,le)=>{n(6,_=_.filter(ve=>ve.id!==re)),await Ft("/api/social/friendRequest"+(le?"Accept":"Deny"),{id:re,action:le}),le&&r()},k=!0,y=[],F="",A=!0,C,M=async()=>{try{n(9,A=!1);let re=await Ft("/api/social/blockPlayer",{name:F});n(10,C="ok")}catch{n(10,C="error")}setTimeout(()=>{n(10,C=void 0)},2e3),n(9,A=!0),l()},V=async re=>{n(7,y=y.filter(le=>le.id!==re)),await Ft("/api/social/unblockPlayer",{id:re})},$=re=>n(0,i="friends"),D=re=>n(0,i="blocked"),z=(re,le)=>b(re.id,!0),q=(re,le)=>b(re.id,!1),L=(re,le,ve,_e)=>n(6,le[ve].hover=!0,_),O=(re,le,ve,_e)=>n(6,le[ve].hover=!1,_),j=(re,le)=>v(le,re),R=(re,le,ve,_e)=>n(2,le[ve].hover=!0,a),U=(re,le,ve,_e)=>n(2,le[ve].hover=!1,a);function Z(re){f=re,n(3,f)}let ye=(re,le)=>V(re.id);function we(re){F=re,n(8,F)}let he=()=>{Xe(bi,o=!1,o)};return t.$$.update=()=>{t.$$.dirty[0]&196611&&(s&&o&&i==="friends"?(r(),Xe(pi,s=!1,s)):k&&o&&i==="blocked"&&(l(),n(16,k=!1)))},[i,o,a,f,u,m,_,y,F,A,C,g,v,b,M,V,k,s,$,D,z,q,L,O,j,R,U,Z,ye,we,he]}var Pv=class extends Ce{constructor(e){super(),Pe(this,e,dq,pq,Be,{},null,[-1,-1])}},YC=Pv;var Av=t=>{let e=~~(t/86400),n=~~(t/(60*60)%24),s=~~(t/60%60),o=~~(t%60);return`${e?e+"d ":""}${n?n+"h ":""}${s?s+"m ":""}${o?o+"s":""}`};var gu=t=>~~(1e4+t**1.5*8e3);function XC(t,e,n){let s=t.slice();return s[9]=e[n],s[11]=n,s}function QC(t){let e,n;return e=new $t({props:{origin:"center",title:P.ui.headers.warstats,icon:"pvp",$$slots:{default:[gq]},$$scope:{ctx:t}}}),e.$on("close",t[8]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&4101&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function hq(t){let e,n=dt(t[2].contrib)+"",s,o,i=dt(gu(t[2].level))+"",r,l,a=t[2].level+"",c,f;return{c(){e=h("span"),s=T(n),o=T(" / "),r=T(i),l=T(" (Lv. "),c=T(a),f=T(" War)"),Le(e,"font-size","14px"),p(e,"class","absCentered textprimary")},m(u,m){w(u,e,m),d(e,s),d(e,o),d(e,r),d(e,l),d(e,c),d(e,f)},p(u,m){m&4&&n!==(n=dt(u[2].contrib)+"")&&G(s,n),m&4&&i!==(i=dt(gu(u[2].level))+"")&&G(r,i),m&4&&a!==(a=u[2].level+"")&&G(c,a)},d(u){u&&x(e)}}}function ZC(t,e){let n,s,o,i,r=dt(e[9].stats[1])+"",l,a,c=dt(e[9].stats[2])+"",f,u,m=e[9].stats[0]+"",g,v,_=dt(e[9].stats[3])+"",b,k,y;return o=new Xn({props:{name:e[9].name,pclass:e[9].class,level:e[9].level,faction:e[9].faction}}),{key:t,first:null,c(){n=h("tr"),s=h("td"),J(o.$$.fragment),i=h("td"),l=T(r),a=h("td"),f=T(c),u=h("td"),g=T(m),v=h("td"),b=T(_),p(i,"class","textcenter"),p(a,"class","textcenter"),p(u,"class","textcenter"),p(v,"class","textcenter textfame"),p(n,"class",k="striped "+(I&&I.player&&I.player.name===e[9].name?"selected":"")),this.first=n},m(F,A){w(F,n,A),d(n,s),X(o,s,null),d(n,i),d(i,l),d(n,a),d(a,f),d(n,u),d(u,g),d(n,v),d(v,b),y=!0},p(F,A){e=F;let C={};A&5&&(C.name=e[9].name),A&5&&(C.pclass=e[9].class),A&5&&(C.level=e[9].level),A&5&&(C.faction=e[9].faction),o.$set(C),(!y||A&5)&&r!==(r=dt(e[9].stats[1])+"")&&G(l,r),(!y||A&5)&&c!==(c=dt(e[9].stats[2])+"")&&G(f,c),(!y||A&5)&&m!==(m=e[9].stats[0]+"")&&G(g,m),(!y||A&5)&&_!==(_=dt(e[9].stats[3])+"")&&G(b,_),(!y||A&5&&k!==(k="striped "+(I&&I.player&&I.player.name===e[9].name?"selected":"")))&&p(n,"class",k)},i(F){y||(S(o.$$.fragment,F),y=!0)},o(F){E(o.$$.fragment,F),y=!1},d(F){F&&x(n),Q(o)}}}function gq(t){let e,n,s,o,i,r,l,a,c,f=t[2].kills[0]+"",u,m,g,v,_,b,k=dt(t[2].reward)+"",y,F,A=P.ui.war.status+"",C,M,V,$=P.ui.war.statustypes[t[2].status]+"",D,z,q,L=P.ui.war.duration+"",O,j,R,U=Av(t[2].duration)+"",Z,ye,we,he,re,le,ve,_e,Ie=t[2].kills[1]+"",oe,Ee,K,Re,Ge,Qe,Ye,pe,ce=P.ui.stats.misc.damage+"",Oe,se,ee,N=P.ui.stats.misc.healing+"",ue,We,ze,Ae=P.ui.stats.misc.kills+"",$e,Ue,mt,wt,Je,Et,xe=P.ui.stats.misc.fame+"",Ke,bt,Ct,Ve=[],be=new Map,Vt,Ht,Lt;Ee=new ks({props:{size:"1.3em",fract:~~(t[2].contrib/gu(t[2].level)*100),left:"",right:"",barcol:"bgpurp",$$slots:{default:[hq]},$$scope:{ctx:t}}});let Rt=me(t[2].contributors.sort(t[7])),He=et=>et[9].name;for(let et=0;et<Rt.length;et+=1){let Te=XC(t,Rt,et),it=He(Te);be.set(it,Ve[et]=ZC(it,Te))}return{c(){e=h("div"),n=h("div"),s=h("div"),o=h("div"),i=h("span"),i.textContent=`${P.factions[0].name}`,r=h("span"),l=h("img"),c=Ne(),u=T(f),m=h("div"),g=h("span"),v=h("img"),b=Ne(),y=T(k),F=h("span"),C=T(A),M=T(": "),V=h("span"),D=T($),q=h("span"),O=T(L),j=T(": "),R=h("span"),Z=T(U),ye=Ne(),we=h("div"),he=h("span"),he.textContent=`${P.factions[1].name}`,re=h("span"),le=h("img"),_e=Ne(),oe=T(Ie),J(Ee.$$.fragment),K=h("div"),Re=h("table"),Ge=h("thead"),Qe=h("tr"),Ye=h("th"),Ye.textContent=`${P.ui.war.player}`,pe=h("th"),Oe=T(ce),ee=h("th"),ue=T(N),ze=h("th"),$e=T(Ae),mt=h("th"),wt=h("img"),Et=Ne(),Ke=T(xe),Ct=h("tbody");for(let et=0;et<Ve.length;et+=1)Ve[et].c();p(i,"class","infosmall textf0 svelte-19s383j"),Le(i,"margin-top","30px"),p(l,"class","svgicon"),at(l.src,a="/data/ui/icons/pvp.svg?v=8685122")||p(l,"src",a),p(r,"class","infobig textprimary svelte-19s383j"),Le(r,"margin-top","10px"),p(v,"class","svgicon"),at(v.src,_=rr)||p(v,"src",_),p(g,"class","infobig textfame svelte-19s383j"),Le(g,"margin-top","20px"),p(V,"class",z="text"+["red","orange","green"][t[2].status]+" svelte-19s383j"),p(F,"class","infosmall svelte-19s383j"),Le(F,"margin-top","10px"),p(R,"class","textprimary"),p(q,"class","infosmall svelte-19s383j"),Le(q,"margin-bottom","20px"),p(he,"class","infosmall textf1 svelte-19s383j"),Le(he,"margin-top","30px"),p(le,"class","svgicon"),at(le.src,ve="/data/ui/icons/pvp.svg?v=8685122")||p(le,"src",ve),p(re,"class","infobig textprimary svelte-19s383j"),Le(re,"margin-top","10px"),p(s,"class","grid three"),p(n,"class","panel-black border grey"),p(Ye,"width","30%"),p(pe,"class",se="textcenter "+(t[0]==1?"textwhite":"")),p(ee,"class",We="textcenter "+(t[0]==2?"textwhite":"")),p(ze,"class",Ue="textcenter "+(t[0]==0?"textwhite":"")),p(wt,"class","svgicon"),at(wt.src,Je=rr)||p(wt,"src",Je),p(mt,"class",bt="textcenter "+(t[0]==3?"textwhite":"")),p(Qe,"class","textprimary"),p(Re,"class","dense panel-black"),p(K,"class","scrollbar"),p(e,"class","layout svelte-19s383j")},m(et,Te){w(et,e,Te),d(e,n),d(n,s),d(s,o),d(o,i),d(o,r),d(r,l),d(r,c),d(r,u),d(s,m),d(m,g),d(g,v),d(g,b),d(g,y),d(m,F),d(F,C),d(F,M),d(F,V),d(V,D),d(m,q),d(q,O),d(q,j),d(q,R),d(R,Z),d(m,ye),d(s,we),d(we,he),d(we,re),d(re,le),d(re,_e),d(re,oe),X(Ee,n,null),d(e,K),d(K,Re),d(Re,Ge),d(Ge,Qe),d(Qe,Ye),d(Qe,pe),d(pe,Oe),d(Qe,ee),d(ee,ue),d(Qe,ze),d(ze,$e),d(Qe,mt),d(mt,wt),d(mt,Et),d(mt,Ke),d(Re,Ct);for(let it=0;it<Ve.length;it+=1)Ve[it]&&Ve[it].m(Ct,null);Vt=!0,Ht||(Lt=[H(pe,"click",t[3]),H(ee,"click",t[4]),H(ze,"click",t[5]),H(mt,"click",t[6])],Ht=!0)},p(et,Te){(!Vt||Te&4)&&f!==(f=et[2].kills[0]+"")&&G(u,f),(!Vt||Te&4)&&k!==(k=dt(et[2].reward)+"")&&G(y,k),(!Vt||Te&4)&&$!==($=P.ui.war.statustypes[et[2].status]+"")&&G(D,$),(!Vt||Te&4&&z!==(z="text"+["red","orange","green"][et[2].status]+" svelte-19s383j"))&&p(V,"class",z),(!Vt||Te&4)&&U!==(U=Av(et[2].duration)+"")&&G(Z,U),(!Vt||Te&4)&&Ie!==(Ie=et[2].kills[1]+"")&&G(oe,Ie);let it={};Te&4&&(it.fract=~~(et[2].contrib/gu(et[2].level)*100)),Te&4100&&(it.$$scope={dirty:Te,ctx:et}),Ee.$set(it),(!Vt||Te&1&&se!==(se="textcenter "+(et[0]==1?"textwhite":"")))&&p(pe,"class",se),(!Vt||Te&1&&We!==(We="textcenter "+(et[0]==2?"textwhite":"")))&&p(ee,"class",We),(!Vt||Te&1&&Ue!==(Ue="textcenter "+(et[0]==0?"textwhite":"")))&&p(ze,"class",Ue),(!Vt||Te&1&&bt!==(bt="textcenter "+(et[0]==3?"textwhite":"")))&&p(mt,"class",bt),Te&5&&(Rt=me(et[2].contributors.sort(et[7])),Me(),Ve=En(Ve,Te,He,1,et,Rt,be,Ct,Hn,ZC,null,XC),Fe())},i(et){if(!Vt){S(Ee.$$.fragment,et);for(let Te=0;Te<Rt.length;Te+=1)S(Ve[Te]);Vt=!0}},o(et){E(Ee.$$.fragment,et);for(let Te=0;Te<Ve.length;Te+=1)E(Ve[Te]);Vt=!1},d(et){et&&x(e),Q(Ee);for(let Te=0;Te<Ve.length;Te+=1)Ve[Te].d();Ht=!1,rt(Lt)}}}function vq(t){let e,n,s=t[1]&&QC(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[1]?s?(s.p(o,i),i&2&&S(s,1)):(s=QC(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function _q(t,e,n){let s,o;ie(t,Yo,m=>n(1,s=m)),ie(t,Ho,m=>n(2,o=m));let i=1;return[i,s,o,()=>n(0,i=1),()=>n(0,i=2),()=>n(0,i=0),()=>n(0,i=3),(m,g)=>g.stats[i]-m.stats[i],()=>{Xe(Yo,s=!1,s)}]}var Tv=class extends Ce{constructor(e){super(),Pe(this,e,_q,vq,Be,{})}},JC=Tv;function KC(t,e,n){let s=t.slice();return s[15]=e[n],s}function eS(t,e,n){let s=t.slice();return s[18]=e[n],s[20]=n,s}function tS(t){let e,n;return e=new $t({props:{origin:"center",title:P.ui.headers.pvp,icon:"pvp",$$slots:{default:[Mq]},$$scope:{ctx:t}}}),e.$on("close",t[13]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&2097278&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function nS(t){let e,n,s;function o(){return t[11](t[20])}return{c(){e=h("div"),e.textContent=`${t[18]}`,p(e,"class","tab"),Bi(e,"active",t[20]===t[1])},m(i,r){w(i,e,r),n||(s=H(e,"click",o),n=!0)},p(i,r){t=i,r&2&&Bi(e,"active",t[20]===t[1])},d(i){i&&x(e),n=!1,s()}}}function bq(t){let e,n,s,o,i,r,l,a,c=t[5].arena_position+"",f,u,m,g,v=t[5].arena_wins_today+"",_,b,k,y,F=t[5].arena_losses_today+"",A,C,M,V,$,D,z,q,L,O,j,R,U,Z,ye;o=new Dd({props:{amount:t[5].arena_rating}});let we=me(t[8]),he=[];for(let _e=0;_e<we.length;_e+=1)he[_e]=sS(KC(t,we,_e));$=new hr({props:{amount:Math.ceil(Hf(t[5].arena_rating)/5)}});let re=[xq,kq],le=[];function ve(_e,Ie){return _e[5].arena_wins_today?0:1}return O=ve(t,-1),j=le[O]=re[O](t),Z=new hr({props:{amount:t[5].medals}}),{c(){e=h("div"),n=h("h4"),n.textContent="Current Rating",s=h("h2"),J(o.$$.fragment),i=h("div");for(let _e=0;_e<he.length;_e+=1)he[_e].c();r=h("div"),l=h("span"),l.textContent="Arena Position",a=h("span"),f=T(c),u=h("span"),u.textContent="Wins / Loss Today",m=h("span"),g=h("span"),_=T(v),k=T(" - "),y=h("span"),A=T(F),M=h("span"),M.textContent="Medals per win",V=h("span"),J($.$$.fragment),D=h("span"),z=T("End of day bonus"),L=h("span"),j.c(),R=h("span"),R.textContent="Total Medals",U=h("span"),J(Z.$$.fragment),p(n,"class","textgreen"),p(e,"class","textcenter panel-black"),p(i,"class","panel-black marg-top grid two textcenter"),p(l,"class","textwhite"),p(a,"class","textgreen statnumber"),p(u,"class","textwhite"),p(g,"class",b=t[5].arena_wins_today?"textgreen":"textgrey"),p(y,"class",C=t[5].arena_losses_today?"textred":"textgrey"),p(m,"class","textgrey statnumber"),p(M,"class","textwhite"),p(V,"class","statnumber"),p(D,"class",q=t[5].arena_wins_today?"textgreen":"textgrey"),p(L,"class","statnumber"),p(R,"class","textwhite"),p(U,"class","statnumber"),p(r,"class","stats panel-black marg-top svelte-voya4q")},m(_e,Ie){w(_e,e,Ie),d(e,n),d(e,s),X(o,s,null),w(_e,i,Ie);for(let oe=0;oe<he.length;oe+=1)he[oe]&&he[oe].m(i,null);w(_e,r,Ie),d(r,l),d(r,a),d(a,f),d(r,u),d(r,m),d(m,g),d(g,_),d(m,k),d(m,y),d(y,A),d(r,M),d(r,V),X($,V,null),d(r,D),d(D,z),d(r,L),le[O].m(L,null),d(r,R),d(r,U),X(Z,U,null),ye=!0},p(_e,Ie){let oe={};if(Ie&32&&(oe.amount=_e[5].arena_rating),o.$set(oe),Ie&832){we=me(_e[8]);let Ge;for(Ge=0;Ge<we.length;Ge+=1){let Qe=KC(_e,we,Ge);he[Ge]?he[Ge].p(Qe,Ie):(he[Ge]=sS(Qe),he[Ge].c(),he[Ge].m(i,null))}for(;Ge<he.length;Ge+=1)he[Ge].d(1);he.length=we.length}(!ye||Ie&32)&&c!==(c=_e[5].arena_position+"")&&G(f,c),(!ye||Ie&32)&&v!==(v=_e[5].arena_wins_today+"")&&G(_,v),(!ye||Ie&32&&b!==(b=_e[5].arena_wins_today?"textgreen":"textgrey"))&&p(g,"class",b),(!ye||Ie&32)&&F!==(F=_e[5].arena_losses_today+"")&&G(A,F),(!ye||Ie&32&&C!==(C=_e[5].arena_losses_today?"textred":"textgrey"))&&p(y,"class",C);let Ee={};Ie&32&&(Ee.amount=Math.ceil(Hf(_e[5].arena_rating)/5)),$.$set(Ee),(!ye||Ie&32&&q!==(q=_e[5].arena_wins_today?"textgreen":"textgrey"))&&p(D,"class",q);let K=O;O=ve(_e,Ie),O===K?le[O].p(_e,Ie):(Me(),E(le[K],1,1,()=>{le[K]=null}),Fe(),j=le[O],j?j.p(_e,Ie):(j=le[O]=re[O](_e),j.c()),S(j,1),j.m(L,null));let Re={};Ie&32&&(Re.amount=_e[5].medals),Z.$set(Re)},i(_e){ye||(S(o.$$.fragment,_e),S($.$$.fragment,_e),S(j),S(Z.$$.fragment,_e),ye=!0)},o(_e){E(o.$$.fragment,_e),E($.$$.fragment,_e),E(j),E(Z.$$.fragment,_e),ye=!1},d(_e){_e&&(x(e),x(i),x(r)),Q(o),st(he,_e),Q($),le[O].d(),Q(Z)}}}function yq(t){let e,n,s,o,i,r,l,a,c=dt(t[5].prestige)+"",f,u,m,g,v=ml(t[3],P.ui.title.name[I.player.faction][t[3]-1])+"",_,b=dt(gv(t[5].prestige))+"",k,y,F,A,C,M,V,$=dt(t[5].kills_today)+"",D,z,q,L,O,j,R=dt(t[5].fame_today)+"",U,Z,ye,we,he,re,le=dt(t[5].kills_this_week)+"",ve,_e,Ie,oe,Ee,K,Re=dt(t[5].fame)+"",Ge,Qe,Ye,pe=t[5].fame_position+"",ce,Oe,se,ee=hu(t[5].fame_bracket)+"",N,ue,We,ze,Ae,$e,Ue=dt(t[5].kills_last_week)+"",mt,wt,Je,Et,xe,Ke,bt=dt(t[5].fame_last_week)+"",Ct,Ve,be,Vt=t[5].fame_position_last_week+"",Ht,Lt,Rt,He=hu(t[5].fame_bracket_last_week)+"",et,Te,it,Ze,ft,wn,Io=dt(t[5].kills_lifetime)+"",fs,Ls,pt,zt,Do,Wn,us=dt(t[5].fame_lifetime)+"",Sc,Tr,Ri,Vo=(t[5].rank_lifetime>0?ml(t[5].rank_lifetime,P.ui.title.name[I.player.faction][t[5].rank_lifetime-1]):"Unranked")+"",pn;return n=new ks({props:{size:"1.5em",fract:t[4],barcol:"bgpurp",$$slots:{default:[wq]},$$scope:{ctx:t}}}),{c(){e=h("div"),J(n.$$.fragment),s=h("div"),o=h("span"),o.textContent=`${P.ui.pvpmenu.currentprestige}`,i=h("span"),r=h("img"),a=Ne(),f=T(c),u=h("span"),u.textContent=`${P.ui.pvpmenu.nextrank}`,m=h("span"),g=new lm(!1),_=T(" ("),k=T(b),y=T(")"),F=h("div"),A=h("small"),A.textContent=`${P.ui.pvpmenu.today}`,C=h("span"),M=h("span"),M.textContent=`${P.ui.stats.misc.kills}`,V=h("span"),D=T($),z=h("span"),z.textContent=`${P.ui.stats.misc.fame}`,q=h("span"),L=h("img"),j=Ne(),U=T(R),Z=h("div"),ye=h("small"),ye.textContent=`${P.ui.pvpmenu.thisweek}`,we=h("a"),we.textContent=`${P.ui.pvpmenu.viewbrackets}`,he=h("span"),he.textContent=`${P.ui.stats.misc.kills}`,re=h("span"),ve=T(le),_e=h("span"),_e.textContent=`${P.ui.stats.misc.fame}`,Ie=h("span"),oe=h("img"),K=Ne(),Ge=T(Re),Qe=h("span"),Qe.textContent=`${P.ui.pvpmenu.fameposition}`,Ye=h("span"),ce=T(pe),Oe=h("span"),Oe.textContent=`${P.ui.pvpmenu.famebracket}`,se=h("span"),N=T(ee),ue=h("div"),We=h("small"),We.textContent=`${P.ui.pvpmenu.lastweek}`,ze=h("span"),Ae=h("span"),Ae.textContent=`${P.ui.stats.misc.kills}`,$e=h("span"),mt=T(Ue),wt=h("span"),wt.textContent=`${P.ui.stats.misc.fame}`,Je=h("span"),Et=h("img"),Ke=Ne(),Ct=T(bt),Ve=h("span"),Ve.textContent=`${P.ui.pvpmenu.fameposition}`,be=h("span"),Ht=T(Vt),Lt=h("span"),Lt.textContent=`${P.ui.pvpmenu.famebracket}`,Rt=h("span"),et=T(He),Te=h("div"),it=h("small"),it.textContent=`${P.ui.pvpmenu.lifetime}`,Ze=h("span"),ft=h("span"),ft.textContent=`${P.ui.stats.misc.kills}`,wn=h("span"),fs=T(Io),Ls=h("span"),Ls.textContent=`${P.ui.stats.misc.fame}`,pt=h("span"),zt=h("img"),Wn=Ne(),Sc=T(us),Tr=h("span"),Tr.textContent=`${P.ui.pvpmenu.highestrank}`,Ri=h("span"),p(o,"class","textwhite"),p(r,"class","svgicon"),at(r.src,l=Ha)||p(r,"src",l),p(i,"class","textprestige statnumber"),p(u,"class","textwhite"),g.a=_,p(m,"class","textprestige statnumber"),p(s,"class","stats marg-top svelte-voya4q"),p(e,"class","panel-black"),p(A,"class","bold textgreen"),p(M,"class","textwhite"),p(V,"class","textprimary statnumber"),p(z,"class","textwhite"),p(L,"class","svgicon"),at(L.src,O=rr)||p(L,"src",O),p(q,"class","textfame statnumber"),p(F,"class","stats panel-black marg-top svelte-voya4q"),p(ye,"class","bold textgreen"),p(we,"class","statnumber"),p(we,"href","/pvp"),p(we,"target","_blank"),p(we,"rel","noopener noreferrer"),p(he,"class","textwhite"),p(re,"class","textprimary statnumber"),p(_e,"class","textwhite"),p(oe,"class","svgicon"),at(oe.src,Ee=rr)||p(oe,"src",Ee),p(Ie,"class","textfame statnumber"),p(Qe,"class","textwhite"),p(Ye,"class","textgreen statnumber"),p(Oe,"class","textwhite"),p(se,"class","textprimary statnumber"),p(Z,"class","stats panel-black marg-top svelte-voya4q"),p(We,"class","bold textgreen"),p(Ae,"class","textwhite"),p($e,"class","textprimary statnumber"),p(wt,"class","textwhite"),p(Et,"class","svgicon"),at(Et.src,xe=rr)||p(Et,"src",xe),p(Je,"class","textfame statnumber"),p(Ve,"class","textwhite"),p(be,"class","textgreen statnumber"),p(Lt,"class","textwhite"),p(Rt,"class","textprimary statnumber"),p(ue,"class","stats panel-black marg-top svelte-voya4q"),p(it,"class","bold textgreen"),p(ft,"class","textwhite"),p(wn,"class","textprimary statnumber"),p(Ls,"class","textwhite"),p(zt,"class","svgicon"),at(zt.src,Do=rr)||p(zt,"src",Do),p(pt,"class","textfame statnumber"),p(Tr,"class","textwhite"),p(Ri,"class","textprestige statnumber"),p(Te,"class","stats panel-black marg-top svelte-voya4q")},m(Ut,tn){w(Ut,e,tn),X(n,e,null),d(e,s),d(s,o),d(s,i),d(i,r),d(i,a),d(i,f),d(s,u),d(s,m),g.m(v,m),d(m,_),d(m,k),d(m,y),w(Ut,F,tn),d(F,A),d(F,C),d(F,M),d(F,V),d(V,D),d(F,z),d(F,q),d(q,L),d(q,j),d(q,U),w(Ut,Z,tn),d(Z,ye),d(Z,we),d(Z,he),d(Z,re),d(re,ve),d(Z,_e),d(Z,Ie),d(Ie,oe),d(Ie,K),d(Ie,Ge),d(Z,Qe),d(Z,Ye),d(Ye,ce),d(Z,Oe),d(Z,se),d(se,N),w(Ut,ue,tn),d(ue,We),d(ue,ze),d(ue,Ae),d(ue,$e),d($e,mt),d(ue,wt),d(ue,Je),d(Je,Et),d(Je,Ke),d(Je,Ct),d(ue,Ve),d(ue,be),d(be,Ht),d(ue,Lt),d(ue,Rt),d(Rt,et),w(Ut,Te,tn),d(Te,it),d(Te,Ze),d(Te,ft),d(Te,wn),d(wn,fs),d(Te,Ls),d(Te,pt),d(pt,zt),d(pt,Wn),d(pt,Sc),d(Te,Tr),d(Te,Ri),Ri.innerHTML=Vo,pn=!0},p(Ut,tn){let ms={};tn&16&&(ms.fract=Ut[4]),tn&2097156&&(ms.$$scope={dirty:tn,ctx:Ut}),n.$set(ms),(!pn||tn&32)&&c!==(c=dt(Ut[5].prestige)+"")&&G(f,c),(!pn||tn&8)&&v!==(v=ml(Ut[3],P.ui.title.name[I.player.faction][Ut[3]-1])+"")&&g.p(v),(!pn||tn&32)&&b!==(b=dt(gv(Ut[5].prestige))+"")&&G(k,b),(!pn||tn&32)&&$!==($=dt(Ut[5].kills_today)+"")&&G(D,$),(!pn||tn&32)&&R!==(R=dt(Ut[5].fame_today)+"")&&G(U,R),(!pn||tn&32)&&le!==(le=dt(Ut[5].kills_this_week)+"")&&G(ve,le),(!pn||tn&32)&&Re!==(Re=dt(Ut[5].fame)+"")&&G(Ge,Re),(!pn||tn&32)&&pe!==(pe=Ut[5].fame_position+"")&&G(ce,pe),(!pn||tn&32)&&ee!==(ee=hu(Ut[5].fame_bracket)+"")&&G(N,ee),(!pn||tn&32)&&Ue!==(Ue=dt(Ut[5].kills_last_week)+"")&&G(mt,Ue),(!pn||tn&32)&&bt!==(bt=dt(Ut[5].fame_last_week)+"")&&G(Ct,bt),(!pn||tn&32)&&Vt!==(Vt=Ut[5].fame_position_last_week+"")&&G(Ht,Vt),(!pn||tn&32)&&He!==(He=hu(Ut[5].fame_bracket_last_week)+"")&&G(et,He),(!pn||tn&32)&&Io!==(Io=dt(Ut[5].kills_lifetime)+"")&&G(fs,Io),(!pn||tn&32)&&us!==(us=dt(Ut[5].fame_lifetime)+"")&&G(Sc,us),(!pn||tn&32)&&Vo!==(Vo=(Ut[5].rank_lifetime>0?ml(Ut[5].rank_lifetime,P.ui.title.name[I.player.faction][Ut[5].rank_lifetime-1]):"Unranked")+"")&&(Ri.innerHTML=Vo)},i(Ut){pn||(S(n.$$.fragment,Ut),pn=!0)},o(Ut){E(n.$$.fragment,Ut),pn=!1},d(Ut){Ut&&(x(e),x(F),x(Z),x(ue),x(Te)),Q(n)}}}function sS(t){let e,n,s=t[15]+"",o,i,r,l;function a(...c){return t[12](t[15],...c)}return{c(){e=h("div"),n=T("Queue "),o=T(s),p(e,"class",i="btn grey "+(t[6].queues&&t[6].queues.includes("arena"+t[15])?"active":""))},m(c,f){w(c,e,f),d(e,n),d(e,o),r||(l=H(e,"click",a),r=!0)},p(c,f){t=c,f&64&&i!==(i="btn grey "+(t[6].queues&&t[6].queues.includes("arena"+t[15])?"active":""))&&p(e,"class",i)},d(c){c&&x(e),r=!1,l()}}}function kq(t){let e;return{c(){e=T("-")},m(n,s){w(n,e,s)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function xq(t){let e,n;return e=new hr({props:{amount:Hf(t[5].arena_rating)}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&32&&(i.amount=Hf(s[5].arena_rating)),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function wq(t){let e,n=(t[2]>0?ml(t[2],P.ui.title.name[I.player.faction][t[2]-1]):"Unranked")+"";return{c(){e=h("span"),p(e,"class","absCentered ranktitle svelte-voya4q")},m(s,o){w(s,e,o),e.innerHTML=n},p(s,o){o&4&&n!==(n=(s[2]>0?ml(s[2],P.ui.title.name[I.player.faction][s[2]-1]):"Unranked")+"")&&(e.innerHTML=n)},d(s){s&&x(e)}}}function Mq(t){let e,n,s,o,i,r,l=me(t[7]),a=[];for(let m=0;m<l.length;m+=1)a[m]=nS(eS(t,l,m));let c=[yq,bq],f=[];function u(m,g){return m[1]===0?0:m[1]===1?1:-1}return~(o=u(t,-1))&&(i=f[o]=c[o](t)),{c(){e=h("div"),n=h("div");for(let m=0;m<a.length;m+=1)a[m].c();s=h("div"),i&&i.c(),p(n,"class","tab-bar flex"),p(s,"class","panel-bright"),p(e,"class","container svelte-voya4q")},m(m,g){w(m,e,g),d(e,n);for(let v=0;v<a.length;v+=1)a[v]&&a[v].m(n,null);d(e,s),~o&&f[o].m(s,null),r=!0},p(m,g){if(g&130){l=me(m[7]);let _;for(_=0;_<l.length;_+=1){let b=eS(m,l,_);a[_]?a[_].p(b,g):(a[_]=nS(b),a[_].c(),a[_].m(n,null))}for(;_<a.length;_+=1)a[_].d(1);a.length=l.length}let v=o;o=u(m,g),o===v?~o&&f[o].p(m,g):(i&&(Me(),E(f[v],1,1,()=>{f[v]=null}),Fe()),~o?(i=f[o],i?i.p(m,g):(i=f[o]=c[o](m),i.c()),S(i,1),i.m(s,null)):i=null)},i(m){r||(S(i),r=!0)},o(m){E(i),r=!1},d(m){m&&x(e),st(a,m),~o&&f[o].d()}}}function Fq(t){let e,n,s=t[0]&&tS(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[0]?s?(s.p(o,i),i&1&&S(s,1)):(s=tS(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function Cq(t,e,n){let s,o;ie(t,es,y=>n(6,s=y)),ie(t,yi,y=>n(0,o=y));let i=["Prestige","Arena"],r=0,l=0,a=1,c=0,f={},u=async()=>{n(5,f=await Ft("/api/pvp/getplayerpvpinfo",{name:I.player.name})),n(2,l=rc(f.prestige)),n(3,a=Math.min(l+1,12));let y=qd(a)-qd(l),F=f.prestige-qd(l);n(4,c=~~(F/y*100))},m=0,g=["3v3","5v5"],v=y=>{yt(s.queues.includes(y)?"stopqueue":"startqueue",y)},_=y=>{n(1,r=y)},b=(y,F)=>v("arena"+y),k=()=>{Xe(yi,o=!1,o)};return t.$$.update=()=>{t.$$.dirty&1025&&(o&&Date.now()-m>3e4||m===0)&&(u(),n(10,m=Date.now()))},[o,r,l,a,c,f,s,i,g,v,m,_,b,k]}var Ev=class extends Ce{constructor(e){super(),Pe(this,e,Cq,Fq,Be,{})}},oS=Ev;function iS(t){let e,n,s=t[1].name+"",o,i,r,l=t[1].level!==void 0?`Lv. ${t[1].level} `:"",a,c,f=(t[1].class!==void 0?P.classes[t[1].class].name:"Item")+"",u,m,g,v=(t[1].faction!==void 0?P.factions[t[1].faction].name:"")+"",_,b;return{c(){e=h("div"),n=h("div"),o=T(s),i=h("div"),r=h("span"),a=T(l),c=h("span"),u=T(f),g=h("span"),_=T(v),p(n,"class","textwhite title svelte-1wip79f"),p(c,"class",m=zi(t[1].class!==void 0?"textc"+t[1].class:"textyellow")+" svelte-1wip79f"),p(g,"class",b=zi(t[1].faction!==void 0?"textf"+t[1].faction:"")+" svelte-1wip79f"),p(e,"class","panel-black container svelte-1wip79f"),Le(e,"display",t[0]?"block":"none")},m(k,y){w(k,e,y),d(e,n),d(n,o),d(e,i),d(i,r),d(r,a),d(i,c),d(c,u),d(e,g),d(g,_)},p(k,y){y&2&&s!==(s=k[1].name+"")&&G(o,s),y&2&&l!==(l=k[1].level!==void 0?`Lv. ${k[1].level} `:"")&&G(a,l),y&2&&f!==(f=(k[1].class!==void 0?P.classes[k[1].class].name:"Item")+"")&&G(u,f),y&2&&m!==(m=zi(k[1].class!==void 0?"textc"+k[1].class:"textyellow")+" svelte-1wip79f")&&p(c,"class",m),y&2&&v!==(v=(k[1].faction!==void 0?P.factions[k[1].faction].name:"")+"")&&G(_,v),y&2&&b!==(b=zi(k[1].faction!==void 0?"textf"+k[1].faction:"")+" svelte-1wip79f")&&p(g,"class",b),y&1&&Le(e,"display",k[0]?"block":"none")},d(k){k&&x(e)}}}function Sq(t){let e,n=t[1]&&iS(t);return{c(){n&&n.c(),e=de()},m(s,o){n&&n.m(s,o),w(s,e,o)},p(s,[o]){s[1]?n?n.p(s,o):(n=iS(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(s){s&&x(e),n&&n.d(s)}}}function Pq(t,e,n){let s;ie(t,ym,i=>n(0,s=i));let o;return t.$$.update=()=>{t.$$.dirty&1&&s>0&&I.isEntityIdTaken(s)&&n(1,o=I.entity(s))},[s,o]}var Iv=class extends Ce{constructor(e){super(),Pe(this,e,Pq,Sq,Be,{})}},rS=Iv;var Dv=da,vu=async t=>{let e=await Ft("/api/account/info");Dv.set(e),Ui.set(e.storepoints),t&&t(e)};function Aq(t){let e,n,s,o,i,r,l,a,c=P.ui.elixir.chatsupport+"",f,u,m,g,v,_=P.ui.elixir.noads+"",b,k,y,F,A,C,M,V,$,D=P.ui.elixir.bagslots+"",z,q,L,O,j,R,U,Z,ye,we=P.ui.elixir.stashstorage+"",he,re,le,ve,_e,Ie,oe,Ee,K,Re=P.ui.elixir.merchantlimit+"",Ge,Qe,Ye,pe,ce,Oe,se,ee,N,ue=P.ui.elixir.merchantduration+"",We;return{c(){e=h("div"),n=h("div"),n.innerHTML='<img class="artwork svelte-cbx1m" src="/data/ui/elixir.svg?v=8685122"/><div class="sparkle svelte-cbx1m" style="font-size:35px; left:30%; top:30%; animation-delay: -1s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:50px; left:40%; top:60%; animation-delay: -2s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:80px; left:60%; top:20%; animation-delay: -3s;">+</div>',s=h("div"),o=h("h1"),o.innerHTML='Hordes <span class="textsub">Elixir</span>',i=h("div"),r=h("img"),a=Ne(),f=T(c),u=h("div"),m=h("img"),v=Ne(),b=T(_),k=h("div"),y=h("img"),A=Ne(),C=h("span"),C.textContent=`${Nn[0].inventory}`,M=Ne(),V=h("span"),V.textContent=`${Nn[1].inventory}`,$=Ne(),z=T(D),q=h("div"),L=h("img"),j=Ne(),R=h("span"),R.textContent=`${Nn[0].stash}`,U=Ne(),Z=h("span"),Z.textContent=`${Nn[1].stash}`,ye=Ne(),he=T(we),re=h("div"),le=h("img"),_e=Ne(),Ie=h("span"),Ie.textContent=`${Nn[0].auction}`,oe=Ne(),Ee=h("span"),Ee.textContent=`${Nn[1].auction}`,K=Ne(),Ge=T(Re),Qe=h("div"),Ye=h("img"),ce=Ne(),Oe=h("span"),Oe.textContent=`${Nn[0].auctionHours}h`,se=Ne(),ee=h("span"),ee.textContent=`${Nn[1].auctionHours}h`,N=Ne(),We=T(ue),p(n,"class","artcontainer svelte-cbx1m"),p(o,"class","textprimary"),p(r,"class","svgicon"),at(r.src,l="/data/ui/icons/gem.svg?v=8685122")||p(r,"src",l),p(i,"class","textwhite"),p(m,"class","svgicon"),at(m.src,g="/data/ui/icons/check.svg?v=8685122")||p(m,"src",g),p(u,"class","textwhite"),p(y,"class","svgicon"),at(y.src,F="/data/ui/icons/check.svg?v=8685122")||p(y,"src",F),p(C,"class","old svelte-cbx1m"),p(V,"class","textsub"),p(k,"class","textwhite"),p(L,"class","svgicon"),at(L.src,O="/data/ui/icons/check.svg?v=8685122")||p(L,"src",O),p(R,"class","old svelte-cbx1m"),p(Z,"class","textsub"),p(q,"class","textwhite"),p(le,"class","svgicon"),at(le.src,ve="/data/ui/icons/check.svg?v=8685122")||p(le,"src",ve),p(Ie,"class","old svelte-cbx1m"),p(Ee,"class","textsub"),p(re,"class","textwhite"),p(Ye,"class","svgicon"),at(Ye.src,pe="/data/ui/icons/check.svg?v=8685122")||p(Ye,"src",pe),p(Oe,"class","old svelte-cbx1m"),p(ee,"class","textsub"),p(Qe,"class","textwhite"),p(e,"class","split svelte-cbx1m")},m(ze,Ae){w(ze,e,Ae),d(e,n),d(e,s),d(s,o),d(s,i),d(i,r),d(i,a),d(i,f),d(s,u),d(u,m),d(u,v),d(u,b),d(s,k),d(k,y),d(k,A),d(k,C),d(k,M),d(k,V),d(k,$),d(k,z),d(s,q),d(q,L),d(q,j),d(q,R),d(q,U),d(q,Z),d(q,ye),d(q,he),d(s,re),d(re,le),d(re,_e),d(re,Ie),d(re,oe),d(re,Ee),d(re,K),d(re,Ge),d(s,Qe),d(Qe,Ye),d(Qe,ce),d(Qe,Oe),d(Qe,se),d(Qe,ee),d(Qe,N),d(Qe,We)},p:ae,i:ae,o:ae,d(ze){ze&&x(e)}}}var Vv=class extends Ce{constructor(e){super(),Pe(this,e,null,Aq,Be,{})}},lS=Vv;var ct={SECONDS_A_MINUTE:60,SECONDS_A_HOUR:3600,SECONDS_A_DAY:86400,SECONDS_A_WEEK:604800,MILLISECONDS_A_SECOND:1e3,MILLISECONDS_A_MINUTE:6e4,MILLISECONDS_A_HOUR:36e5,MILLISECONDS_A_DAY:864e5,MILLISECONDS_A_WEEK:6048e5,MS:"millisecond",S:"second",MIN:"minute",H:"hour",D:"day",W:"week",M:"month",Q:"quarter",Y:"year",DATE:"date",FORMAT_DEFAULT:"YYYY-MM-DDTHH:mm:ssZ",INVALID_DATE_STRING:"Invalid Date",REGEX_PARSE:/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,REGEX_FORMAT:/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g},Lv=(t,e,n)=>{let s=String(t);return!s||s.length>=e?t:`${Array(e+1-s.length).join(n)}${t}`},Tq=t=>{let e=-t.utcOffset(),n=Math.abs(e),s=Math.floor(n/60),o=n%60;return`${e<=0?"+":"-"}${Lv(s,2,"0")}:${Lv(o,2,"0")}`},Eq=(t,e)=>{let n=(e.year()-t.year())*12+(e.month()-t.month()),s=t.clone().add(n,ct.M),o=e-s<0,i=t.clone().add(n+(o?-1:1),ct.M);return Number(-(n+(e-s)/(o?s-i:i-s))||0)},Iq=t=>t<0?Math.ceil(t)||0:Math.floor(t),Dq=t=>({M:ct.M,y:ct.Y,w:ct.W,d:ct.D,h:ct.H,m:ct.MIN,s:ct.S,ms:ct.MS,Q:ct.Q})[t]||String(t||"").toLowerCase().replace(/s$/,""),Vq=t=>t===void 0,Lq={s:Lv,z:Tq,m:Eq,a:Iq,p:Dq,u:Vq},qq={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},zd="en",Fl={};Fl[zd]=qq;var qv=t=>t instanceof lc,Bd=(t,e,n)=>{let s;if(!t)return zd;if(typeof t=="string")Fl[t]&&(s=t),e&&(Fl[t]=e,s=t);else{let{name:o}=t;Fl[o]=t,s=o}return n||(zd=s),s},Zn=(t,e,n)=>{if(qv(t))return t.clone();let s=e?typeof e=="string"?{format:e,pl:n}:e:{};return s.date=t,new lc(s)},Rq=(t,e)=>Zn(t,{locale:e.$L,utc:e.$u,$offset:e.$offset}),cn=Lq;cn.l=Bd;cn.i=qv;cn.w=Rq;var zq=t=>{let{date:e,utc:n}=t;if(e===null)return new Date(NaN);if(cn.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){let s=e.match(ct.REGEX_PARSE);if(s)return n?new Date(Date.UTC(s[1],s[2]-1,s[3]||1,s[4]||0,s[5]||0,s[6]||0,s[7]||0)):new Date(s[1],s[2]-1,s[3]||1,s[4]||0,s[5]||0,s[6]||0,s[7]||0)}return new Date(e)},lc=class{constructor(e){this.$L=this.$L||Bd(e.locale,null,!0),this.parse(e)}parse(e){this.$d=zq(e),this.init()}init(){let{$d:e}=this;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()}$utils(){return cn}isValid(){return this.$d.toString()!==ct.INVALID_DATE_STRING}isSame(e,n){let s=Zn(e);return this.startOf(n)<=s&&s<=this.endOf(n)}isAfter(e,n){return Zn(e)<this.startOf(n)}isBefore(e,n){return this.endOf(n)<Zn(e)}$g(e,n,s){return cn.u(e)?this[n]:this.set(s,e)}year(e){return this.$g(e,"$y",ct.Y)}month(e){return this.$g(e,"$M",ct.M)}day(e){return this.$g(e,"$W",ct.D)}date(e){return this.$g(e,"$D",ct.DATE)}hour(e){return this.$g(e,"$H",ct.H)}minute(e){return this.$g(e,"$m",ct.MIN)}second(e){return this.$g(e,"$s",ct.S)}millisecond(e){return this.$g(e,"$ms",ct.MS)}unix(){return Math.floor(this.valueOf()/1e3)}valueOf(){return this.$d.getTime()}startOf(e,n){let s=cn.u(n)?!0:n,o=cn.p(e),i=(u,m)=>{let g=cn.w(this.$u?Date.UTC(this.$y,m,u):new Date(this.$y,m,u),this);return s?g:g.endOf(ct.D)},r=(u,m)=>{let g=[0,0,0,0],v=[23,59,59,999];return cn.w(this.toDate()[u].apply(this.toDate(),(s?g:v).slice(m)),this)},{$W:l,$M:a,$D:c}=this,f=`set${this.$u?"UTC":""}`;switch(o){case ct.Y:return s?i(1,0):i(31,11);case ct.M:return s?i(1,a):i(0,a+1);case ct.W:{let u=this.$locale().weekStart||0,m=(l<u?l+7:l)-u;return i(s?c-m:c+(6-m),a)}case ct.D:case ct.DATE:return r(`${f}Hours`,0);case ct.H:return r(`${f}Minutes`,1);case ct.MIN:return r(`${f}Seconds`,2);case ct.S:return r(`${f}Milliseconds`,3);default:return this.clone()}}endOf(e){return this.startOf(e,!1)}$set(e,n){let s=cn.p(e),o=`set${this.$u?"UTC":""}`,i={[ct.D]:`${o}Date`,[ct.DATE]:`${o}Date`,[ct.M]:`${o}Month`,[ct.Y]:`${o}FullYear`,[ct.H]:`${o}Hours`,[ct.MIN]:`${o}Minutes`,[ct.S]:`${o}Seconds`,[ct.MS]:`${o}Milliseconds`}[s],r=s===ct.D?this.$D+(n-this.$W):n;if(s===ct.M||s===ct.Y){let l=this.clone().set(ct.DATE,1);l.$d[i](r),l.init(),this.$d=l.set(ct.DATE,Math.min(this.$D,l.daysInMonth())).toDate()}else i&&this.$d[i](r);return this.init(),this}set(e,n){return this.clone().$set(e,n)}get(e){return this[cn.p(e)]()}add(e,n){e=Number(e);let s=cn.p(n),o=l=>{let a=Zn(this);return cn.w(a.date(a.date()+Math.round(l*e)),this)};if(s===ct.M)return this.set(ct.M,this.$M+e);if(s===ct.Y)return this.set(ct.Y,this.$y+e);if(s===ct.D)return o(1);if(s===ct.W)return o(7);let i={[ct.MIN]:ct.MILLISECONDS_A_MINUTE,[ct.H]:ct.MILLISECONDS_A_HOUR,[ct.S]:ct.MILLISECONDS_A_SECOND}[s]||1,r=this.$d.getTime()+e*i;return cn.w(r,this)}subtract(e,n){return this.add(e*-1,n)}format(e){if(!this.isValid())return ct.INVALID_DATE_STRING;let n=e||ct.FORMAT_DEFAULT,s=cn.z(this),o=this.$locale(),{$H:i,$m:r,$M:l}=this,{weekdays:a,months:c,meridiem:f}=o,u=(_,b,k,y)=>_&&(_[b]||_(this,n))||k[b].substr(0,y),m=_=>cn.s(i%12||12,_,"0"),g=f||((_,b,k)=>{let y=_<12?"AM":"PM";return k?y.toLowerCase():y}),v={YY:String(this.$y).slice(-2),YYYY:this.$y,M:l+1,MM:cn.s(l+1,2,"0"),MMM:u(o.monthsShort,l,c,3),MMMM:c[l]||c(this,n),D:this.$D,DD:cn.s(this.$D,2,"0"),d:String(this.$W),dd:u(o.weekdaysMin,this.$W,a,2),ddd:u(o.weekdaysShort,this.$W,a,3),dddd:a[this.$W],H:String(i),HH:cn.s(i,2,"0"),h:m(1),hh:m(2),a:g(i,r,!0),A:g(i,r,!1),m:String(r),mm:cn.s(r,2,"0"),s:String(this.$s),ss:cn.s(this.$s,2,"0"),SSS:cn.s(this.$ms,3,"0"),Z:s};return n.replace(ct.REGEX_FORMAT,(_,b)=>b||v[_]||s.replace(":",""))}utcOffset(){return-Math.round(this.$d.getTimezoneOffset()/15)*15}diff(e,n,s){let o=cn.p(n),i=Zn(e),r=(i.utcOffset()-this.utcOffset())*ct.MILLISECONDS_A_MINUTE,l=this-i,a=cn.m(this,i);return a={[ct.Y]:a/12,[ct.M]:a,[ct.Q]:a/3,[ct.W]:(l-r)/ct.MILLISECONDS_A_WEEK,[ct.D]:(l-r)/ct.MILLISECONDS_A_DAY,[ct.H]:l/ct.MILLISECONDS_A_HOUR,[ct.MIN]:l/ct.MILLISECONDS_A_MINUTE,[ct.S]:l/ct.MILLISECONDS_A_SECOND}[o]||l,s?a:cn.a(a)}daysInMonth(){return this.endOf(ct.M).$D}$locale(){return Fl[this.$L]}locale(e,n){if(!e)return this.$L;let s=this.clone();return s.$L=Bd(e,n,!0),s}clone(){return cn.w(this.$d,this)}toDate(){return new Date(this.valueOf())}toJSON(){return this.isValid()?this.toISOString():null}toISOString(){return this.$d.toISOString()}toString(){return this.$d.toUTCString()}};Zn.prototype=lc.prototype;Zn.extend=(t,e)=>(t(e,lc,Zn),Zn);Zn.locale=Bd;Zn.isDayjs=qv;Zn.unix=t=>Zn(t*1e3);Zn.en=Fl[zd];Zn.Ls=Fl;var _u=Zn;function aS(t,e,n){let s=t.slice();return s[13]=e[n],s[15]=n,s}function Bq(t){let e=P.ui.elixir.notactive+"",n;return{c(){n=T(e)},m(s,o){w(s,n,o)},p:ae,d(s){s&&x(n)}}}function $q(t){let e,n,s,o=_u(t[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"",i;return{c(){e=h("img"),s=Ne(),i=T(o),p(e,"class","svgicon"),at(e.src,n="/data/ui/icons/check.svg?v=8685122")||p(e,"src",n)},m(r,l){w(r,e,l),w(r,s,l),w(r,i,l)},p(r,l){l&2&&o!==(o=_u(r[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"")&&G(i,o)},d(r){r&&(x(e),x(s),x(i))}}}function cS(t){let e,n=t[13].name+"",s,o,i,r,l,a,c;i=new gr({props:{amount:t[13].price}});function f(...u){return t[9](t[15],...u)}return{c(){e=h("btn"),s=T(n),o=Ne(),J(i.$$.fragment),p(e,"class",r="btn black navbtn textwhite "+(t[5]==t[15]?"active":"")+" big")},m(u,m){w(u,e,m),d(e,s),d(e,o),X(i,e,null),l=!0,a||(c=H(e,"click",f),a=!0)},p(u,m){t=u,(!l||m&32&&r!==(r="btn black navbtn textwhite "+(t[5]==t[15]?"active":"")+" big"))&&p(e,"class",r)},i(u){l||(S(i.$$.fragment,u),l=!0)},o(u){E(i.$$.fragment,u),l=!1},d(u){u&&x(e),Q(i),a=!1,c()}}}function fS(t){let e,n=P.ui.elixir.sendgift+"",s,o,i,r;return{c(){e=h("btn"),s=T(n),p(e,"class",o="btn navbtn "+(t[6]?"active white":"textprimary")+" big")},m(l,a){w(l,e,a),d(e,s),i||(r=H(e,"click",t[10]),i=!0)},p(l,a){a&64&&o!==(o="btn navbtn "+(l[6]?"active white":"textprimary")+" big")&&p(e,"class",o)},d(l){l&&x(e),i=!1,r()}}}function Uq(t){let e;function n(i,r){return i[0]=="addsubscription"?jq:Nq}let s=n(t,-1),o=s(t);return{c(){e=h("div"),o.c(),p(e,"class","fadeIn card marg-top")},m(i,r){w(i,e,r),o.m(e,null)},p(i,r){s!==(s=n(i,r))&&(o.d(1),o=s(i),o&&(o.c(),o.m(e,null)))},i:ae,o:ae,d(i){i&&x(e),o.d()}}}function Oq(t){let e,n,s=(t[6]?P.ui.elixir.willgift:P.ui.elixir.willadd)+"",o,i,r,l=P.ui.elixir.subduration[t[5]]+"",a,c,f,u,m=P.ui.elixir.willcost+"",g,v,_,b,k,y,F,A,C=(t[6]?P.ui.elixir.send:t[1].subscribed_until?P.ui.elixir.extend:P.ui.elixir.activate)+"",M,V,$,D,z;v=new gr({props:{amount:t[8].price}});let q=[Gq,Wq],L=[];function O(U,Z){return U[6]?1:0}b=O(t,-1),k=L[b]=q[b](t);let j=t[0]=="addsubscription"&&t[2]&&uS(t),R=t[1].storepoints<t[8].price&&mS(t);return{c(){e=h("div"),n=h("div"),o=T(s),i=Ne(),r=h("span"),a=T(l),c=Ne(),f=h("span"),f.textContent=`${P.ui.elixir.subscription}`,u=T("? "),g=T(m),J(v.$$.fragment),_=T("."),k.c(),y=de(),j&&j.c(),F=h("div"),A=h("div"),M=T(C),R&&R.c(),p(r,"class","bold textwhite"),p(f,"class","textsub"),p(n,"class","textgrey"),p(A,"class",V="btn grey formatted "+(t[3]=="addsubscription"||t[1].storepoints<t[8].price?"disabled":"")),p(F,"class","subnav"),p(e,"class","fadeIn card marg-top"),Le(e,"padding","18px")},m(U,Z){w(U,e,Z),d(e,n),d(n,o),d(n,i),d(n,r),d(r,a),d(n,c),d(n,f),d(n,u),d(n,g),X(v,n,null),d(n,_),L[b].m(e,null),d(e,y),j&&j.m(e,null),d(e,F),d(F,A),d(A,M),R&&R.m(e,null),$=!0,D||(z=H(A,"click",t[12]),D=!0)},p(U,Z){(!$||Z&64)&&s!==(s=(U[6]?P.ui.elixir.willgift:P.ui.elixir.willadd)+"")&&G(o,s),(!$||Z&32)&&l!==(l=P.ui.elixir.subduration[U[5]]+"")&&G(a,l);let ye={};Z&256&&(ye.amount=U[8].price),v.$set(ye);let we=b;b=O(U,Z),b===we?L[b].p(U,Z):(Me(),E(L[we],1,1,()=>{L[we]=null}),Fe(),k=L[b],k?k.p(U,Z):(k=L[b]=q[b](U),k.c()),S(k,1),k.m(e,y)),U[0]=="addsubscription"&&U[2]?j?j.p(U,Z):(j=uS(U),j.c(),j.m(e,F)):j&&(j.d(1),j=null),(!$||Z&66)&&C!==(C=(U[6]?P.ui.elixir.send:U[1].subscribed_until?P.ui.elixir.extend:P.ui.elixir.activate)+"")&&G(M,C),(!$||Z&266&&V!==(V="btn grey formatted "+(U[3]=="addsubscription"||U[1].storepoints<U[8].price?"disabled":"")))&&p(A,"class",V),U[1].storepoints<U[8].price?R||(R=mS(U),R.c(),R.m(e,null)):R&&(R.d(1),R=null)},i(U){$||(S(v.$$.fragment,U),S(k),$=!0)},o(U){E(v.$$.fragment,U),E(k),$=!1},d(U){U&&x(e),Q(v),L[b].d(),j&&j.d(),R&&R.d(),D=!1,z()}}}function Nq(t){let e;return{c(){e=h("p"),e.textContent="Please Select an option above!",p(e,"class","fadeIn textgrey")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function jq(t){let e;return{c(){e=h("p"),e.textContent=`${P.ui.elixir.thankyou}`,p(e,"class","fadeIn textsub")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function Wq(t){let e,n,s,o;function i(l){t[11](l)}let r={};return t[7]!==void 0&&(r.name=t[7]),n=new Ml({props:r}),qt.push(()=>mo(n,"name",i)),{c(){e=h("div"),J(n.$$.fragment),p(e,"class","subnav")},m(l,a){w(l,e,a),X(n,e,null),o=!0},p(l,a){let c={};!s&&a&128&&(s=!0,c.name=l[7],uo(()=>s=!1)),n.$set(c)},i(l){o||(S(n.$$.fragment,l),o=!0)},o(l){E(n.$$.fragment,l),o=!1},d(l){l&&x(e),Q(n)}}}function Gq(t){let e,n=P.ui.elixir.enable+"",s,o,i,r=_u(t[1].subscribed_until||void 0).add(t[8].days,"day").format("MMM DD, YYYY HH:mm")+"",l,a;return{c(){e=h("p"),s=T(n),o=Ne(),i=h("span"),l=T(r),a=T("."),p(i,"class","textwhite"),p(e,"class","bold textsub")},m(c,f){w(c,e,f),d(e,s),d(e,o),d(e,i),d(i,l),d(e,a)},p(c,f){f&258&&r!==(r=_u(c[1].subscribed_until||void 0).add(c[8].days,"day").format("MMM DD, YYYY HH:mm")+"")&&G(l,r)},i:ae,o:ae,d(c){c&&x(e)}}}function uS(t){let e,n;return{c(){e=h("p"),n=T(t[2]),p(e,"class","fadeIn textred")},m(s,o){w(s,e,o),d(e,n)},p(s,o){o&4&&G(n,s[2])},d(s){s&&x(e)}}}function mS(t){let e,n,s=P.ui.elixir.pointserror+"",o,i,r;return{c(){e=h("p"),n=h("small"),o=T(s),i=Ne(),r=h("a"),r.textContent=`${P.ui.elixir.buypoints} ${P.ui.elixir.currency}`,p(r,"class","textprimary"),p(r,"href","/store")},m(l,a){w(l,e,a),d(e,n),d(n,o),d(n,i),d(n,r)},d(l){l&&x(e)}}}function Hq(t){let e,n,s,o,i,r,l,a,c,f,u,m,g,v,_,b;n=new lS({});function k(q,L){return q[1].subscribed_until?$q:Bq}let y=k(t,-1),F=y(t);a=new gr({props:{amount:t[1].storepoints}});let A=me(Sd),C=[];for(let q=0;q<A.length;q+=1)C[q]=cS(aS(t,A,q));let M=q=>E(C[q],1,1,()=>{C[q]=null}),V=t[5]!==void 0&&fS(t),$=[Oq,Uq],D=[];function z(q,L){return q[5]!==void 0?0:1}return v=z(t,-1),_=D[v]=$[v](t),{c(){e=h("div"),J(n.$$.fragment),s=h("small"),s.textContent=`${P.ui.elixir.subscription}`,o=h("div"),F.c(),r=h("small"),r.textContent=`${P.ui.elixir.currency}`,l=h("div"),J(a.$$.fragment),c=Ne(),f=h("a"),f.textContent=`${P.ui.elixir.buypoints} ${P.ui.elixir.currency}`,u=h("p"),u.textContent=`${P.ui.elixir.support}`,m=h("div");for(let q=0;q<C.length;q+=1)C[q].c();g=de(),V&&V.c(),_.c(),p(s,"class","textgrey"),p(o,"class",i="cardinfo "+(t[1].subscribed_until?"textsub":"textgrey")),p(r,"class","textgrey"),p(f,"class","textwhite"),p(f,"href","/store"),p(l,"class","cardinfo"),p(u,"class","textgrey"),p(m,"class","subnav"),p(e,"class","card")},m(q,L){w(q,e,L),X(n,e,null),d(e,s),d(e,o),F.m(o,null),d(e,r),d(e,l),X(a,l,null),d(l,c),d(l,f),d(e,u),d(e,m);for(let O=0;O<C.length;O+=1)C[O]&&C[O].m(m,null);d(m,g),V&&V.m(m,null),D[v].m(e,null),b=!0},p(q,[L]){y===(y=k(q,L))&&F?F.p(q,L):(F.d(1),F=y(q),F&&(F.c(),F.m(o,null))),(!b||L&2&&i!==(i="cardinfo "+(q[1].subscribed_until?"textsub":"textgrey")))&&p(o,"class",i);let O={};if(L&2&&(O.amount=q[1].storepoints),a.$set(O),L&32){A=me(Sd);let R;for(R=0;R<A.length;R+=1){let U=aS(q,A,R);C[R]?(C[R].p(U,L),S(C[R],1)):(C[R]=cS(U),C[R].c(),S(C[R],1),C[R].m(m,g))}for(Me(),R=A.length;R<C.length;R+=1)M(R);Fe()}q[5]!==void 0?V?V.p(q,L):(V=fS(q),V.c(),V.m(m,null)):V&&(V.d(1),V=null);let j=v;v=z(q,L),v===j?D[v].p(q,L):(Me(),E(D[j],1,1,()=>{D[j]=null}),Fe(),_=D[v],_?_.p(q,L):(_=D[v]=$[v](q),_.c()),S(_,1),_.m(e,null))},i(q){if(!b){S(n.$$.fragment,q),S(a.$$.fragment,q);for(let L=0;L<A.length;L+=1)S(C[L]);S(_),b=!0}},o(q){E(n.$$.fragment,q),E(a.$$.fragment,q),C=C.filter(Boolean);for(let L=0;L<C.length;L+=1)E(C[L]);E(_),b=!1},d(q){q&&x(e),Q(n),F.d(),Q(a),st(C,q),V&&V.d(),D[v].d()}}}function Yq(t,e,n){let s,o,i=!1,r,{user:l}=e,{flash:a=void 0}=e,{flashmsg:c=void 0}=e,{action:f=void 0}=e,{apiCall:u}=e,m=(b,k)=>n(5,o=b),g=b=>n(6,i=!i);function v(b){r=b,n(7,r)}let _=b=>u("addsubscription","/api/account/addsubscription",{value:o,gift:i?r:void 0},!0,k=>{k.result=="ok"&&(n(5,o=void 0),n(0,a="addsubscription"))});return t.$$set=b=>{"user"in b&&n(1,l=b.user),"flash"in b&&n(0,a=b.flash),"flashmsg"in b&&n(2,c=b.flashmsg),"action"in b&&n(3,f=b.action),"apiCall"in b&&n(4,u=b.apiCall)},t.$$.update=()=>{t.$$.dirty&32&&n(8,s=Sd[o])},[a,l,c,f,u,o,i,r,s,m,g,v,_]}var Rv=class extends Ce{constructor(e){super(),Pe(this,e,Yq,Hq,Be,{user:1,flash:0,flashmsg:2,action:3,apiCall:4})}},pS=Rv;function dS(t){let e,n;return e=new $t({props:{origin:"center",title:"Store / Elixir",icon:"gem",$$slots:{default:[Xq]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&316&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function Xq(t){let e,n,s;return n=new pS({props:{user:t[5],flash:t[2],flashmsg:t[3],action:t[4],apiCall:t[0]}}),{c(){e=h("div"),J(n.$$.fragment),p(e,"class","container svelte-1lv1z23")},m(o,i){w(o,e,i),X(n,e,null),s=!0},p(o,i){let r={};i&32&&(r.user=o[5]),i&4&&(r.flash=o[2]),i&8&&(r.flashmsg=o[3]),i&16&&(r.action=o[4]),n.$set(r)},i(o){s||(S(n.$$.fragment,o),s=!0)},o(o){E(n.$$.fragment,o),s=!1},d(o){o&&x(e),Q(n)}}}function Qq(t){let e,n,s=t[1]&&t[5]&&dS(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[1]&&o[5]?s?(s.p(o,i),i&34&&S(s,1)):(s=dS(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function Zq(t,e,n){let s,o;ie(t,zs,u=>n(1,s=u)),ie(t,Dv,u=>n(5,o=u));let i,r,l,a,c=async(u,m,g,v,_)=>{n(4,a=u);let b=await Ft(m,g);n(4,a=void 0),b.result==="ok"?n(2,r=void 0):(n(2,r=u),n(3,l=b.result)),v&&vu(),_&&_(b)},f=u=>Xe(zs,s=!1,s);return t.$$.update=()=>{t.$$.dirty&2&&s&&vu()},[c,s,r,l,a,o,f]}var zv=class extends Ce{constructor(e){super(),Pe(this,e,Zq,Qq,Be,{apiCall:0})}get apiCall(){return this.$$.ctx[0]}},hS=zv;function Jq(t){let e,n,s,o,i,r,l,a,c;return{c(){e=h("div"),n=h("h3"),s=T("Hordes.io is free!"),o=h("br"),i=T(`
    Buy `),r=h("span"),r.innerHTML='<span class="textwhite">Hordes</span> <img class="svgicon texticon" src="/data/ui/icons/gem.svg?v=8685122"/>  Elixir',l=T(`
     to hide ads & unlock extra features!`),p(r,"class","btn black textsub"),p(n,"class","textgrey textcenter"),p(e,"class","container panel-black svelte-um60d1")},m(f,u){w(f,e,u),d(e,n),d(n,s),d(n,o),d(n,i),d(n,r),d(n,l),a||(c=H(r,"click",t[1]),a=!0)},p:ae,i:ae,o:ae,d(f){f&&x(e),a=!1,c()}}}function Kq(t,e,n){let s;return ie(t,zs,i=>n(0,s=i)),[s,i=>Xe(zs,s=!0,s)]}var Bv=class extends Ce{constructor(e){super(),Pe(this,e,Kq,Jq,Be,{})}},gS=Bv;function vS(t,e,n){let s=t.slice();return s[4]=e[n],s}function _S(t){let e,n,s=rs(t[4].viewers)+"",o;return{c(){e=h("div"),n=h("span"),o=T(s),p(n,"class","textgreen"),p(e,"class","bold viewcount textbox svelte-13wcf6i")},m(i,r){w(i,e,r),d(e,n),d(n,o)},p(i,r){r&2&&s!==(s=rs(i[4].viewers)+"")&&G(o,s)},d(i){i&&x(e)}}}function bS(t){let e,n,s,o=t[4].name+"",i,r,l,a,c=t[4].viewers&&_S(t);return{c(){e=h("a"),n=h("div"),c&&c.c(),s=h("div"),i=T(o),p(s,"class","name textbox svelte-13wcf6i"),p(n,"class","border black preview svelte-13wcf6i"),p(n,"style",r=(t[4].preview?"background-image:url("+t[4].preview+");":"")+"); "+(t[0]?"margin-top:2px;":"")),p(e,"class","fadeIn stream svelte-13wcf6i"),p(e,"target","_blank"),p(e,"rel","noopener noreferrer"),p(e,"href",l=t[4].url),p(e,"style",a=t[0]?"":"width:calc(100%/6);")},m(f,u){w(f,e,u),d(e,n),c&&c.m(n,null),d(n,s),d(s,i)},p(f,u){f[4].viewers?c?c.p(f,u):(c=_S(f),c.c(),c.m(n,s)):c&&(c.d(1),c=null),u&2&&o!==(o=f[4].name+"")&&G(i,o),u&3&&r!==(r=(f[4].preview?"background-image:url("+f[4].preview+");":"")+"); "+(f[0]?"margin-top:2px;":""))&&p(n,"style",r),u&2&&l!==(l=f[4].url)&&p(e,"href",l),u&1&&a!==(a=f[0]?"":"width:calc(100%/6);")&&p(e,"style",a)},d(f){f&&x(e),c&&c.d()}}}function eR(t){let e,n,s=me(t[1]),o=[];for(let i=0;i<s.length;i+=1)o[i]=bS(vS(t,s,i));return{c(){e=h("div");for(let i=0;i<o.length;i+=1)o[i].c();p(e,"style",n="pointer-events: all; "+(t[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))},m(i,r){w(i,e,r);for(let l=0;l<o.length;l+=1)o[l]&&o[l].m(e,null)},p(i,[r]){if(r&3){s=me(i[1]);let l;for(l=0;l<s.length;l+=1){let a=vS(i,s,l);o[l]?o[l].p(a,r):(o[l]=bS(a),o[l].c(),o[l].m(e,null))}for(;l<o.length;l+=1)o[l].d(1);o.length=s.length}r&1&&n!==(n="pointer-events: all; "+(i[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))&&p(e,"style",n)},i:ae,o:ae,d(i){i&&x(e),st(o,i)}}}function tR(t,e,n){let{vertical:s=!1}=e,o=[],i,r=async()=>{i=setTimeout(r,2e4),n(1,o=await Ft("/api/twitch/streams",{max:6}))};return Fn(r),Tn(l=>{i&&clearTimeout(i)}),t.$$set=l=>{"vertical"in l&&n(0,s=l.vertical)},[s,o]}var $v=class extends Ce{constructor(e){super(),Pe(this,e,tR,eR,Be,{vertical:0})}},yS=$v;function kS(t){let e,n,s=t[1][3]+"",o,i,r=t[1][1]+"",l,a,c,f=t[1][0]+"",u,m,g,v=t[1][2]+"",_,b,k,y=t[1][4]+"",F,A;return{c(){e=h("small"),n=h("div"),o=T(s),i=h("div"),l=T(r),a=T(" fps"),c=h("div"),u=T(f),m=T(" ms"),g=h("div"),_=T(v),b=T(" KBs"),k=h("div"),F=T(y),A=T(" BFR"),p(n,"class","textyellow"),p(i,"class","textgreen"),p(c,"class","textcyan"),p(g,"class","textorange"),p(k,"class","textpurp"),p(e,"class","marg-top bar btn black grey svelte-nijy6x")},m(C,M){w(C,e,M),d(e,n),d(n,o),d(e,i),d(i,l),d(i,a),d(e,c),d(c,u),d(c,m),d(e,g),d(g,_),d(g,b),d(e,k),d(k,F),d(k,A)},p(C,M){M&2&&s!==(s=C[1][3]+"")&&G(o,s),M&2&&r!==(r=C[1][1]+"")&&G(l,r),M&2&&f!==(f=C[1][0]+"")&&G(u,f),M&2&&v!==(v=C[1][2]+"")&&G(_,v),M&2&&y!==(y=C[1][4]+"")&&G(F,y)},d(C){C&&x(e)}}}function nR(t){let e,n=t[0]&&kS(t);return{c(){n&&n.c(),e=de()},m(s,o){n&&n.m(s,o),w(s,e,o)},p(s,[o]){s[0]?n?n.p(s,o):(n=kS(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(s){s&&x(e),n&&n.d(s)}}}function sR(t,e,n){let s,o;return ie(t,wa,i=>n(0,s=i)),ie(t,km,i=>n(1,o=i)),[s,o]}var Uv=class extends Ce{constructor(e){super(),Pe(this,e,sR,nR,Be,{})}},xS=Uv;function wS(t){let e,n;return e=new $t({props:{title:"Item",icon:"char",origin:"center",cog:!1,$$slots:{default:[oR]},$$scope:{ctx:t}}}),e.$on("close",t[1]),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},p(s,o){let i={};o&5&&(i.$$scope={dirty:o,ctx:s}),e.$set(i)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function oR(t){let e,n,s,o;return n=new ic({props:{item:t[0],showTradeInfo:!1,showLore:!1,percentages:!0}}),{c(){e=h("div"),J(n.$$.fragment),p(e,"class",s="panel-black border "+jt(t[0].quality)[0])},m(i,r){w(i,e,r),X(n,e,null),o=!0},p(i,r){let l={};r&1&&(l.item=i[0]),n.$set(l),(!o||r&1&&s!==(s="panel-black border "+jt(i[0].quality)[0]))&&p(e,"class",s)},i(i){o||(S(n.$$.fragment,i),o=!0)},o(i){E(n.$$.fragment,i),o=!1},d(i){i&&x(e),Q(n)}}}function iR(t){let e,n,s=t[0]&&wS(t);return{c(){s&&s.c(),e=de()},m(o,i){s&&s.m(o,i),w(o,e,i),n=!0},p(o,[i]){o[0]?s?(s.p(o,i),i&1&&S(s,1)):(s=wS(o),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(Me(),E(s,1,1,()=>{s=null}),Fe())},i(o){n||(S(s),n=!0)},o(o){E(s),n=!1},d(o){o&&x(e),s&&s.d(o)}}}function rR(t,e,n){let s;return ie(t,Lr,i=>n(0,s=i)),[s,()=>{Xe(Lr,s=void 0,s)}]}var Ov=class extends Ce{constructor(e){super(),Pe(this,e,rR,iR,Be,{})}},MS=Ov;var S2={};Kn(S2,{canvas:()=>Ms,changeCanvas:()=>k0,init:()=>pz,onWorldDestroy:()=>vz,onWorldEnter:()=>gz,postTick:()=>dz});var jv=0,ro=0,Wv=0,Gv=5,bu=10,yu=10,SS=0,lR,Hv=0,Yv=0,Xv=0,Qv=0,PS=(t,e)=>{t=Math.max(150,Math.min(1500,t)),ro=t*.8,Wv=Math.min(ro,150),jv=20,Hv=ro,Qv=ro**2,Yv=Math.min(ro,50),Xv=Math.min(ro/32,150/32)**2,ht.far=SS=t,lR=t**2,Zc(ht),yu=Math.min(ro,100+e*50),bu=Math.min(ro,40+e*10),Gv=(yu+bu)/2,jn=Math.ceil(t*2/32),jn+=jn%2,br=jn/2,br+=br%2,aR()},Nv=[],_r=[],$d=[],Zv=0,Jv=0,Kv=-1/0,e2=-1/0,t2=-1/0,n2=-1/0,yr=-1/0,ku=-1/0,kr=-1/0,xu=-1/0,jn=0,br=0,aR=()=>{let t=br,e=(Math.min(ro*.7,250)/32)**2,n=(Math.max(e,ro)/32)**2,s=(SS/32)**2;Nv.length=0,_r.length=0;for(let o=0;o<jn;++o)for(let i=0;i<jn;++i){let r=(t-i)**2+(t-o)**2,l=0;r>s?l=3:r>n?l=2:r>e&&(l=1),Nv.push(r),_r.push(l)}$d.length=0;for(let o=0;o<jn;++o)for(let i=0;i<jn;++i){let r=i%2,a=o%2*2+r,c=Math.min(_r[i+o*jn],2);if(c<2){let f=_r[Math.min(jn-1,i+1)+o*jn]>c,u=_r[Math.max(0,i-1)+o*jn]>c,m=_r[i+Math.max(0,o-1)*jn]>c,g=_r[i+Math.min(jn-1,o+1)*jn]>c,v=a*33+c*16+((u?1:0)|(m?2:0)|(f?4:0)|(g?8:0));$d.push(v)}else $d.push(a*33+c*16)}},s2=(t,e)=>{if(t<yr||t>=ku||e<kr||e>=xu)return 3;let n=t-yr,s=e-kr;return _r[n+s*jn]},AS=(t,e)=>{if(t<yr||t>=ku||e<kr||e>=xu)return 1/0;let n=t-yr,s=e-kr;return Nv[n+s*jn]},TS=(t,e)=>{if(t<yr||t>=ku||e<kr||e>=xu)return 2*16;let n=t-yr,s=e-kr;return $d[n+s*jn]},FS=-1/0,CS=-1/0,cR=(t,e)=>(t=Math.floor(t/64)*2,e=Math.floor(e/64)*2,t!==FS||e!==CS?(yr=t-br,ku=t+br,kr=e-br,xu=e+br,Kv=Math.floor(yr/2),e2=Math.ceil(ku/2),t2=Math.floor(kr/2),n2=Math.ceil(xu/2),Zv=Math.floor(t/2),Jv=Math.floor(e/2),FS=t,CS=e,!0):!1),o2=!0,ES=t=>{o2=cR(Yt.position[0],Yt.position[2])};var fR=0,DS=(t,e,n,s=0,o=!1,i=!1)=>{let r={id:fR++,geometry:Sn({}),program:t,shadowProgram:s,mode:e,uniformData:{},individualFrustums:i,dynamic:o,needsUpdate:!1,lastUpdateCamPos:[0,0,0],drawCount:0,cullFace:1029,instances:[],instancedAttributeNames:[],instancedAttributes:[],instancedData:[]};for(let l=0;l<n.length;++l){let a=n[l];IS(r,a.name,a.size)}return IS(r,"worldMatrix",16),r},IS=(t,e,n)=>{t.instancedAttributes.push({name:e,instanced:!0,bufferMode:t.dynamic?35048:35044,size:n,data:new Float32Array(n)}),t.instancedAttributeNames.push(e),t.instancedData.push([])},i2=t=>{let e=on();e.geometry=t.geometry,e.data.multi=t,t.instances.push(e);for(let n=0;n<t.instancedAttributes.length;++n){let s=t.instancedAttributes[n],o=t.instancedAttributeNames[n];t.instancedData[n].push(e.data[o]=o==="worldMatrix"?e.worldMatrix:Array(s.size).fill(1))}return t.needsUpdate=!0,e},VS=(t,e,n,s)=>{let o=t.instances.indexOf(e),i=t.instancedAttributeNames.indexOf(n);i>=0&&(t.instancedData[i][o]=s,e.data[n]=s)},Po=(t,e)=>{let n=t.instances.indexOf(e);t.instances.splice(n,1);for(let s=0;s<t.instancedAttributes.length;++s)t.instancedData[s].splice(n,1);t.needsUpdate=!0,vo(e)},LS=t=>{for(let e=0;e<t.instances;++e)vo(t[e]);for(let e=0;e<t.instancedAttributes.length;++e)t.instancedData[e].length=0;t.instances.length=0,t.needsUpdate=!0},uR=(t,e)=>{t.needsUpdate=t.dynamic;for(let l=0;l<t.instancedAttributes.length;++l){let a=t.instancedAttributes[l];mR(a,a.size,t.instances.length)}let n=t.dynamic,s=t.individualFrustums,o=t.instancedData,i=t.instances,r=0;for(let l=0;l<i.length;++l){let a=i[l];if(a.visible&&(!n||!s||O_(e,a.geometry,a))){for(let f=0;f<t.instancedAttributes.length;++f){let u=t.instancedAttributes[f],m=u.data,g=o[f][l],v=r*u.size,_=v+u.size;for(let b=v,k=0;b<_;++b,++k)m[b]=g[k]}r++}}if(t.drawCount=r,zp(t.geometry,t.drawCount),t.drawCount!==0)for(let l=0;l<t.instancedAttributes.length;++l){let a=t.instancedAttributes[l];Rp(t.geometry,a,r)}},ac=(t,e,n,s)=>{if(n&&t.needsUpdate&&uR(t,s),e.active&&t.drawCount>0){e.cullFace=t.cullFace;for(let o=0;o<e.autoUniforms.length;++o){let i=e.autoUniforms[o];e.uniforms[i].value=t.uniformData[i]}Bp(t.uniformData,e),Va(e,tt.currentProgram===e.id),Da(t.geometry,e,t.mode)}},qS=(t,e)=>{let n={...e};for(let s=0;s<t.instancedAttributeNames.length;++s)n[t.instancedAttributeNames[s]]=t.instancedAttributes[s];gh(t.geometry,n)},mR=(t,e,n)=>{t.data=t.data.byteLength>=e*n*4?t.data:new Float32Array(e*(n+5))};var Vi=[],RS=(10+1)*6,Sl=new Uint32Array(RS);for(let t=0,e=0;t<RS;t+=6,e+=2)Sl[t+0]=e,Sl[t+1]=e+1,Sl[t+2]=e+3,Sl[t+3]=e,Sl[t+4]=e+3,Sl[t+5]=e+2;var Ud=new Map,zS=(t,e,n,s,o,i)=>{let r=xh.get(t),l=Ud.get(r.steps),a;return!l||l.length===0?a=new r2(r):a=l.pop(),a.reset(r,e,n,s,o,i),Vi.push(a),a},BS=(t,e)=>{for(let n=0;n<Vi.length;n++)if(Vi[n].tick(t,e),Vi[n].remove){let s=Vi.splice(n--,1)[0];$S(s)}},$S=t=>{Ud.has(t.maxSteps)||Ud.set(t.maxSteps,[]),Ud.get(t.maxSteps).push(t),t.onCache()},US=t=>{Vi.forEach($S),Vi.length=0},OS=()=>{for(let t=0;t<Vi.length;++t){let e=Vi[t];e.mesh.transform.visible&&to(e.mesh,ut[e.mesh.program])}},r2=class{constructor(e){this.maxSteps=e.steps,this.stepTimer=new kt(0,1),this.duration=new kt(0,1),this.remove=!1,this.a=[0,0,0],this.b=[0,0,0],this.timeoutSteps=0;let n=this.maxSteps+1;this.uv=new Float32Array(n*4),this.positions=new Float32Array(n*6);for(let s=0,o=0;s<n;++s,o+=4)this.uv[o]=s/this.maxSteps,this.uv[o+2]=s/this.maxSteps,this.uv[o+1]=1,this.uv[o+3]=0;this.geometry=Sn({position:{size:3,data:this.positions},uv:{size:2,data:this.uv},index:{type:W.UNSIGNED_INT,data:Sl.subarray(0,6*this.maxSteps)}}),Rp(this.geometry,this.geometry.attributes.uv,n),this.mesh=Bs(this.geometry,19,W.TRIANGLES),this.mesh.uniformData.offset=[0,0],this.waitingForTexture=!1,this.parent=null}reset(e,n,s,o,i,r){this.stepTimer.reset(0,e.interval),this.duration.reset(r,i),this.currentStep=0,this.a=ot(this.a,s),this.b=ot(this.b,o),this.mesh.uniformData.offset[1]=1/(this.maxSteps+1),this.remove=!1,this.timeoutSteps=0,this.geometry.drawRangeCount=0,this.mesh.uniformData.colStart=e.colStart,this.mesh.uniformData.colEnd=e.colEnd,e.texture>0?(this.waitingForTexture=!0,this.mesh.program=19,bs(e.texture,l=>{this.mesh.uniformData.diffuse=l,this.waitingForTexture=!1})):(this.waitingForTexture=!1,this.mesh.program=18,this.mesh.uniformData.diffuse=void 0),this.parent=n}tick(e,n){if(this.waitingForTexture){this.mesh.transform.visible=!1;return}if(this.duration.duration>0&&this.duration.done(n)){this.remove=!0;return}if(this.parent!==null){if(this.mesh.transform.visible=this.parent.visible&&(!this.parent.parent||this.parent.parent.visible),!this.mesh.transform.visible)return;this.mesh.transform.visible&&this.timeoutSteps==0&&(this.positions.set(Ps(_t,this.a,this.parent.worldMatrix),0),this.positions.set(Ps(_t,this.b,this.parent.worldMatrix),3))}this.stepTimer.done(n)&&(this.stepTimer.reset(n),this.step()),_s(this.geometry,this.geometry.attributes.position);let s=this.stepTimer.fraction(n);this.mesh.uniformData.offset[0]=(1-s)/this.maxSteps}detach(){this.timeoutSteps=Math.max(1,this.currentStep),this.parent=null}step(){this.currentStep=Math.min(this.maxSteps,this.currentStep+1),this.positions.copyWithin(6,0),this.geometry.drawRangeCount=this.currentStep*6,this.timeoutSteps>0&&(this.timeoutSteps--,this.timeoutSteps==0&&(this.remove=!0))}onCache(){this.mesh.transform.visible=!1,this.parent=null}};var Od=[],Pl=1e3,dR=500,cc=dR,Mr=[],jS=()=>{bR();for(let t=0;t<Pl;++t)Od.push({pos:[-0,-0,-0],vel:[-0,-0,-0],info:Op.get(1),distance:0,start:0,end:1.01,forced:!1,scaleRota:[0,0,0,0],infoVec:[0,0,0,0],progVec:[0,0]})},Nd=(t,e,n,s)=>{let o=e,i=n,r=!0,l=n;for(;e-n<0;)r?t[l].distance>t[e].distance?(NS(t,l,e),l=e,n--,r=!r):e++:t[l].distance>=t[n].distance?n--:(NS(t,l,n),e++,l=n,r=!r);l-1>o&&Nd(t,o,l-1,s),l+1<i&&Nd(t,l+1,i,s)},NS=(t,e,n)=>{let s=t[e];t[e]=t[n],t[n]=s},hR=(t,e,n)=>{let s=[[],[]],o=0,i=0;for(;o<Mr.length;){let r=Mr[o];if(r.start<0||r.end>t){if(Mr[i]=r,i++,r.pos[0]>-1e3){let l=r.pos,a=r.vel,c=r.info.acc;if(l[0]+=(a[0]+=c[0]*e)*e,l[1]+=(a[1]+=c[1]*e)*e,l[2]+=(a[2]+=c[2]*e)*e,r.info.friction>0){let f=1-r.info.friction;a[0]*=f,a[1]*=f,a[2]*=f}if(r.distance=hn(n.frustum[5],l)+n.frustumConstants[5],r.distance<Yv&&r.distance>0){let f=r.start<0?(Math.sin(t/r.info.duration)+1)*.5:(t-r.start)/r.info.duration;r.progVec[0]=f,r.progVec[1]=Pa[r.info.interp](f),s[r.info.blend].push(r)}}}else cc+=r.forced?1:0,Od.push(r);++o}return Mr.length=i,Nd(s[0],0,s[0].length-1,s[0].length),Nd(s[1],0,s[1].length-1,s[1].length),s},gR=t=>{for(let e=0;e<2;++e)_R(t[e],wu[e]),vR(t[e],wu[e],Al[e])},vR=(t,e,n)=>{t.length>0?(n.transform.visible=!0,ey(e,0,t.length),_s(e,e.attributes.position),_s(e,e.attributes.info),_s(e,e.attributes.progress),_s(e,e.attributes.scaleRota),_s(e,e.attributes.colStart),_s(e,e.attributes.colEnd)):n.transform.visible=!1},_R=(t,e)=>{let n=e.attributes.position.data,s=e.attributes.progress.data,o=e.attributes.info.data,i=e.attributes.scaleRota.data,r=e.attributes.colStart.data,l=e.attributes.colEnd.data;for(let a=0;a<t.length;++a){let c=t[a],f=c.pos,u=c.infoVec,m=c.progVec,g=c.scaleRota,v=c.info.colStart,_=c.info.colEnd,b=a*2,k=a*3,y=a*4;n[k]=f[0],n[k+1]=f[1],n[k+2]=f[2],o[y]=u[0],o[y+1]=u[1],o[y+2]=u[2],o[y+3]=u[3],s[b]=m[0],s[b+1]=m[1],i[y]=g[0],i[y+1]=g[1],i[y+2]=g[2],i[y+3]=g[3],r[y]=v[0],r[y+1]=v[1],r[y+2]=v[2],r[y+3]=v[3],l[y]=_[0],l[y+1]=_[1],l[y+2]=_[2],l[y+3]=_[3]}},WS=t=>{let e=hR(Fi,t,ht);gR(e)},wr=[0,0,0],si=(t,e,n=0,s=0,o=0,i=0,r=0,l=0,a=!1)=>{if(e?zr(wr,n,s,o,e):Y(wr,n,s,o),a){if(cc<=0)return}else{if(hn(ht.frustum[0],wr)+ht.frustumConstants[0]<0||hn(ht.frustum[1],wr)+ht.frustumConstants[1]<0)return;let v=hn(ht.frustum[5],wr)+ht.frustumConstants[5];if(v<0||v*10>Od.length)return}let c=Od.pop();if(!c){let v=Mr.length-1;for(;v>=0&&Mr[v].forced;)--v;v>=0&&(c=Mr.splice(v,1)[0])}if(!c)return;let f=1;if(e){let v=e[0],_=e[1],b=e[2];f=Math.sqrt(v*v+_*_+b*b),Im(c.vel,i,r,l,e)}else Y(c.vel,i,r,l);c.pos[0]=wr[0],c.pos[1]=wr[1],c.pos[2]=wr[2];let u=Op.get(t);c.info=u,c.start=a?-1:Fi,c.end=c.start+c.info.duration;let m=Math.random()*u.randomRota,g=m+u.rota;return Math.random()<.5&&(m*=-1,g*=-1),os(c.scaleRota,u.scaleStart*f,u.scaleEnd*f,m,g),os(c.infoVec,u.idLoop,0,u.idStart,u.idEnd+1),vs(c.progVec,0,0),c.forced=a,Mr.push(c),a&&cc--,c},Al=[],wu=[],bR=()=>{for(let t=0;t<2;++t)wu[t]=Sn({position:{size:3,data:new Float32Array(3*Pl)},progress:{size:2,data:new Float32Array(2*Pl)},info:{size:4,data:new Float32Array(4*Pl)},scaleRota:{size:4,data:new Float32Array(4*Pl)},colStart:{size:4,data:new Float32Array(4*Pl)},colEnd:{size:4,data:new Float32Array(4*Pl)}});Al[0]=Bs(wu[0],17,W.POINTS),Al[1]=Bs(wu[1],16,W.POINTS),bs(1215,t=>{qn("particleDiffuse",t,0,ut[17]),qn("particleDiffuse",t,0,ut[16])})};var GS=()=>{let t=ut[17];t.active&&Al[0].transform.visible&&to(Al[0],t)},HS=()=>{let t=ut[16];t.active&&Al[1].transform.visible&&to(Al[1],t)};var Fu=[],jd,Mu,YS,XS=()=>{Mu=Qt.pointlights.data.lightCols,jd=Qt.pointlights.data.lightPos,YS=Qt.pointlights.data.lightCount},QS=t=>{let e=[0,0,0],n=[];for(let o=0,i=Fu.length;o<i;++o){let r=Fu[o];r.remove?(Fu.splice(o,1),--o,--i):r.transform.visible&&(Y(e,r.transform.worldMatrix[12],r.transform.worldMatrix[13],r.transform.worldMatrix[14]),r.distance=ss(ht.worldPosition,e),r.distance<Qv&&n.push(r))}n.sort((o,i)=>o.distance-i.distance);let s=Math.min(n.length,16);for(let o=0;o<s;++o){let i=n[o],r=o*4,l=o*3;jd[l]=i.transform.worldMatrix[12],jd[l+1]=i.transform.worldMatrix[13],jd[l+2]=i.transform.worldMatrix[14],Mu[r]=i.value[0],Mu[r+1]=i.value[1],Mu[r+2]=i.value[2],Mu[r+3]=i.value[3]}YS[0]=s,ls(Qt.pointlights)},ZS=(t,e,n)=>{let s={transform:n,distance:0,remove:!1,value:[...t,e]};return Fu.push(s),s},JS=t=>{Fu.length=0};var Tl=[Qc(1,1),Qc(1,1)],fc=!1,KS=0,e8=t=>{KS=t},Cu=t=>{fc=t},t8=t=>{let n=[bu,yu],s=[5,20,20];for(let o=0;o<Tl.length;++o){let i=Tl[o],r=n[o],l=[0,0,0];Im(l,1,1,1,i.transform.worldMatrix);let a=[...Yt.position],c=s[o];for(let g=0;g<3;++g)a[g]=Math.floor(a[g]/c)*c;let f=(Math.abs(Math.cos(-1))+Math.abs(Math.sin(-1)))*r,u=r,m=[u,f,f];for(let g=0;g<3;++g){let v=m[g]*2/KS,_=a[g]*l[g];_=_-_%v,_=_/l[g],a[g]=_}q_(i.transform.position,a)||(ot(i.transform.position,a),Y(i.transform.rotation,-1,0,0),i.far=f,i.near=-1e3,U_(i,-u,u,-f,f),_a(i,!0),Rm(i),fc=!0)}if(fc){let o=Qt.shadows.data;Ei(o.shadowRange,[bu,Gv,yu],0),Ei(o.shadowPVMatrix,Tl[0].projectionViewMatrix,0),Ei(o.shadowPVMatrix,Tl[1].projectionViewMatrix,16),ls(Qt.shadows)}return fc?1:0};var Wd=new Map,Gd=[],Hd=[],Yd=[],Xd=[],Qd=[],oi=(t,e,n,s)=>{let o=t<<1|e;if(o=o<<1|n,o=o<<1|s,Wd.has(o))return i2(Wd.get(o));{let i=xR(t,e,n,s);return Wd.set(o,i),i2(i)}},s8=(t,e,n,s)=>{t?e?Hd.push(s):Yd.push(s):Gd.push(s),n===2?(Cu(!0),Xd.push(s)):n===1&&(Cu(!0),Qd.push(s))},xR=(t,e,n,s)=>{let o=Mo.get(t),i=Cg[o.shader],r=ut[i],l=fe.shadows&&e?o.texture?1:2:0,a=DS(i,W.TRIANGLES,r.instancedAttributes,l,n,s);a.cullFace=o.cull?W.BACK:W.NONE;let c=!1,f=!1;return o.texture?bs(o.texture,u=>{f=!0,a.uniformData.diffuse=u,c&&s8(r.transparent,r.depthWrite,fe.shadows&&e?n?2:1:0,a)}):f=!0,tr(o.geometry,u=>{qS(a,u),c=!0,f&&s8(r.transparent,r.depthWrite,fe.shadows&&e?n?2:1:0,a)}),a},o8=()=>{Wd.forEach(LS)};var i8=[{fun:(t,e,n)=>{si(e[0],t.transform.worldMatrix,e[1],e[2],e[3],e[4],e[5],e[6],!1)}},{fun:(t,e,n)=>{let s=e[1],o=Math.PI*2/s;for(let i=0;i<s;++i){let r=Math.sin(i*o),l=Math.cos(i*o);si(e[0],t.transform.worldMatrix,r*e[6]+e[2],e[3],l*e[6]+e[4],r*e[5],0,l*e[5],!1)}}},{fun:(t,e,n)=>{for(let s=0;s<e[1];++s)si(e[0],t.transform.worldMatrix,e[2],e[3],e[4],Kt(e[5],e[6]),Kt(e[7],e[8]),Kt(e[9],e[10]),!1)}},{fun:(t,e,n)=>{ti(e[0],t.transform,t.priority,!1,1)}}];var a2=[{create:(t,e)=>ZS([e[0],e[1],e[2]],e[3],t.transform),tick:(t,e,n,s,o)=>{},end:(t,e,n)=>{n.remove=!0},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,s,o)=>{let i=Pa[e[2]](o);n.value[3]=e[0]+i*(e[1]-e[0])}]},{create:(t,e)=>[0,0,0,0],tick:(t,e,n,s,o)=>{n[0]>=e[1]&&(n[0]=0,si(e[0],t.transform.worldMatrix,Kt(e[2],e[3])+n[1],Kt(e[4],e[5])+n[2],Kt(e[6],e[7])+n[3],Kt(e[8],e[9]),Kt(e[10],e[11]),Kt(e[12],e[13]),!1)),n[0]+=~~(s*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,s,o)=>{let i=e[1]*o;n[1]=Math.sin(i)*e[0],n[3]=Math.cos(i)*e[0]}]},{create:(t,e)=>{if(cc>0)return si(e[0],t.transform.worldMatrix,0,0,0,0,0,0,!0)},tick:(t,e,n,s,o)=>{},end:(t,e,n)=>{n.start=1,n.end=1},show:(t,e,n)=>{},hide:(t,e,n)=>{n.pos[0]=-1e3},modifiers:[(t,e,n,s,o)=>{let i=e[1]*o;zr(n.pos,Math.sin(i)*e[0],0,Math.cos(i)*e[0],t.transform.worldMatrix)},(t,e,n,s,o)=>{zr(n.pos,e[0],e[1],e[2],t.transform.worldMatrix)}]},{create:(t,e)=>ti(e[0],t.transform,t.priority,!0,1),tick:(t,e,n,s,o)=>{},end:(t,e,n)=>{n.stop()},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>{let n=oi(e[0],!1,!0,!0);return Y(n.position,e[1],e[2],e[3]),Y(n.scale,e[4],e[5],e[6]),Y(n.rotation,e[7],e[8],e[9]),Cn(n,t.transform),Bt(n,!1),n},tick:(t,e,n,s,o)=>{},end:(t,e,n)=>{Po(n.data.multi,n)},show:(t,e,n)=>{n.visible=!0},hide:(t,e,n)=>{n.visible=!1},modifiers:[(t,e,n,s,o)=>{let i=e[1]*o;n.rotation[1]=e[2]+i,n.position[0]=Math.sin(i)*e[0],n.position[2]=Math.cos(i)*e[0],n.matrixNeedsUpdate=!0,Bt(n,!1)},(t,e,n,s,o)=>{let i=n.data.multi.instancedAttributes[e[0]];for(let r=0;r<i.size;++r)n.data[i.name][r]=e[1+r]},(t,e,n,s,o)=>{let i=n.data.multi.instancedAttributes[e[0]];for(let r=0;r<i.size;++r){let l=e[1+r],a=e[5+r];n.data[i.name][r]=l+o*(a-l)}},(t,e,n,s,o)=>{let i=Pa[e[6]](o);n.scale[0]=e[0]+i*(e[3]-e[0]),n.scale[1]=e[1]+i*(e[4]-e[1]),n.scale[2]=e[2]+i*(e[5]-e[2]),n.matrixNeedsUpdate=!0},(t,e,n,s,o)=>{let i=Pa[e[6]](o);n.rotation[0]=e[0]+i*(e[3]-e[0]),n.rotation[1]=e[1]+i*(e[4]-e[1]),n.rotation[2]=e[2]+i*(e[5]-e[2]),n.matrixNeedsUpdate=!0}]},{create:(t,e)=>zS(e[0],t.transform,[e[1],e[2],e[3]],[e[4],e[5],e[6]],0,0),tick:(t,e,n,s,o)=>{},end:(t,e,n)=>{n.detach()},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,s,o)=>{let i=e[1]*o;n.b[0]=n.a[0]=Math.sin(i)*e[0],n.b[2]=n.a[2]=Math.cos(i)*e[0]}]},{create:(t,e)=>{if(cc<e[1])return;let n=[];for(let s=0;s<e[1];++s)n.push(si(e[0],t.transform.worldMatrix,0,0,0,0,0,0,!0));return n},tick:(t,e,n,s,o)=>{},end:(t,e,n)=>{for(let s=0;s<n.length;++s){let o=n[s];o.start=o.end=1}},show:(t,e,n)=>{},hide:(t,e,n)=>{for(let s=0;s<n.length;++s){let o=n[s];o.pos[0]=-1e3}},modifiers:[(t,e,n,s,o)=>{let i=n.length,r=6.283/i,l=e[0],a=e[1]*o;for(let c=0;c<i;++c){let f=n[c],u=r*c+a;zr(f.pos,Math.sin(u)*l,0,Math.cos(u)*l,t.transform.worldMatrix)}}]},{create:(t,e)=>[0,0],tick:(t,e,n,s,o)=>{if(n[0]>=e[6]){n[0]=0;let i=e[1],r=Math.PI*2/i;for(let l=0;l<i;++l)si(e[0],t.transform.worldMatrix,e[2],e[3],e[4],Math.sin(l*r+n[1])*e[5],0,Math.cos(l*r+n[1])*e[5],!1)}n[0]+=~~(s*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,s,o)=>{n[1]=e[0]*o}]},{create:(t,e)=>[0],tick:(t,e,n,s,o)=>{if(n[0]>=e[1]){n[0]=0;let i=on();Y(i.rotation,Kt(e[8],e[9]),Kt(e[10],e[11]),Kt(e[12],e[13])),l2(e[0],i,t.priority,!0),zr(i.position,Kt(e[2],e[3]),Kt(e[4],e[5]),Kt(e[6],e[7]),t.transform.worldMatrix),di(i,!1)}n[0]+=~~(s*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>{let n=Math.sin(t.transform.rotation[1])*Math.cos(t.transform.rotation[0])*e[0],s=-Math.sin(t.transform.rotation[0])*e[0],o=Math.cos(t.transform.rotation[1])*Math.cos(t.transform.rotation[0])*e[0],i=t.info.duration,r=i;if(e[1]){let l=I.raycastEnvironmentClosest(t.transform.position[0],t.transform.position[1],t.transform.position[2],n*i,s*i,o*i);l<1&&(r=i*l)}return[n,s,o,r]},tick:(t,e,n,s,o)=>{if(e[1]&&(n[3]-=s,n[3]<=0)){t.done=!0;return}t.transform.position[0]+=n[0]*s,t.transform.position[1]+=n[1]*s,t.transform.position[2]+=n[2]*s,t.transform.matrixNeedsUpdate=!0,Bt(t.transform,!1)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>[],tick:(t,e,n,s,o)=>{},end:(t,e,n)=>{let s=on();ot(s.position,t.transform.position),ot(s.rotation,t.transform.rotation),l2(e[0],s,t.priority,!0),di(s,!1)},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]}],l2,r8=t=>{l2=t};var Vs=[],El=[],Il=[],Su=[],l8=(t,e)=>{let n=Hv;SR(t,e,n),PR(t,e,n),AR(t,e,n),TR(t,e),ER(t,e),IR(t,e);for(let s=0;s<Vs.length;++s){let o=Vs[s],i=o.visible!==o.transform.visible;if(o.visible=o.transform.visible,o.visible)for(let r=0;r<o.info.events.length;++r){let l=o.info.events[r];(o.loops===0||l.fraction>0)&&o.fractionLast<=l.fraction&&o.fractionNow>l.fraction&&i8[l.id].fun(o,l.params,t)}for(let r=0;r<o.info.periods.length;++r){let l=o.info.periods[r],a=a2[l.id],c=o.periodData[r]!==void 0,f=o.fractionNow>=l.fractionStart&&o.fractionNow<=l.fractionEnd,u=!1;if(o.visible&&f&&!c&&o.fractionLast<=l.fractionStart&&(c=(o.periodData[r]=a.create(o,l.params,t))!==void 0,u=c),f&&c&&(i&&(o.visible?a.show(o,l.params,o.periodData[r]):a.hide(o,l.params,o.periodData[r])),o.visible)){let m=o.periodData[r],g=(o.fractionNow-l.fractionStart)/(l.fractionEnd-l.fractionStart);a.tick(o,l.params,m,t,g);for(let v=0;v<l.modifiers.length;++v){let _=l.modifiers[v];(u||i||_.mode===1)&&a.modifiers[_.id](o,_.params,m,t,g)}}!f&&c&&(a.end(o,l.params,o.periodData[r]),o.periodData[r]=void 0)}o.visible&&o.returnTransform&&o.transform.parent===null&&Bt(o.transform,!1)}},c2=[],f2=(t,e,n,s)=>c2.length>0?FR(c2.pop(),t,e,n,s):MR(t,e,n,s),MR=(t,e,n,s)=>({info:t,priority:n,transform:e,returnTransform:s,visible:!0,fractionNow:0,fractionLast:0,timeEnd:0,periodData:[],done:!1,loops:0}),FR=(t,e,n,s,o)=>(t.info=e,t.priority=s,t.transform=n,t.returnTransform=o,t),CR=t=>(t.visible=!0,t.fractionNow=0,t.fractionLast=0,t.timeEnd=0,t.periodData.length=0,t.done=!1,t.loops=0,t),Zd=t=>{DR(t),t.returnTransform&&vo(t.transform),c2.push(CR(t))},Ao=(t,e,n,s)=>{let o=Rf.get(t),i=f2(o,e,n,s);return Vs.push(i),El.push(i),i},Us=(t,e,n,s)=>{let o=Rf.get(t),i=f2(o,e,n,s);return Vs.push(i),Il.push(i),i},a8=(t,e,n,s)=>{let o=Rf.get(t),i=f2(o,e,n,s);return Vs.push(i),Su.push(i),i},SR=(t,e,n)=>{for(let s=0;s<El.length;++s){let o=El[s];o.info.duration===0?o.timeEnd===0?(o.timeEnd=e+o.info.duration,o.fractionLast=0,o.fractionNow=.999):(o.fractionLast=0,o.fractionNow=1):(o.timeEnd===0&&(o.timeEnd=e+o.info.duration),o.fractionLast=o.fractionNow,o.fractionNow=gt(1-(o.timeEnd-e)/o.info.duration,0,1))}},PR=t=>{for(let e=0;e<Il.length;++e){let n=Il[e];n.fractionLast=n.fractionNow,n.fractionNow=(n.fractionNow+t/n.info.duration)%1,n.fractionLast>n.fractionNow&&(n.fractionLast=0,n.loops++)}},AR=(t,e,n)=>{},TR=(t,e,n)=>{let s=El.length;for(;s--;){let o=El[s];(o.fractionNow===1||o.done)&&(El.splice(s,1),Vs.splice(Vs.indexOf(o),1),Zd(o))}},ER=(t,e,n)=>{let s=Il.length;for(;s--;){let o=Il[s];o.done&&(Il.splice(s,1),Vs.splice(Vs.indexOf(o),1),Zd(o))}},IR=(t,e,n)=>{let s=Su.length;for(;s--;){let o=Su[s];o.done&&(Su.splice(s,1),Vs.splice(Vs.indexOf(o),1),Zd(o))}},DR=t=>{for(let e=0;e<t.info.periods.length;++e){let n=t.info.periods[e],s=a2[n.id];t.periodData[e]!==void 0&&(s.end(t,n.params,t.periodData[e]),t.periodData[e]=void 0)}},c8=t=>{for(let e=0;e<Vs.length;++e)Zd(Vs[e]);Vs.length=0,El.length=0,Il.length=0,Su.length=0};r8(Ao);var uc=[0,2,2.3],mc=[0,0,0];ts(uc,uc);var fn={},e0=["fog","sun","direct","ambient","skytop","skymid","skybot","horizon","water","clouds"],t0=["bloom"];for(let t=0;t<e0.length;++t)fn[e0[t]]=[[.5,.5,.5],[.5,.5,.5],[.5,.5,.5]];for(let t=0;t<t0.length;++t)fn[t0[t]]=[0,0,0];var f8=(t,e,n,s)=>{RR(),$R(t,n,e),zR(),e>0&&BR(e,s),ls(Qt.sky),ls(Qt.environment);let o=Qt.environment.data;W.clearColor(o.fog[0],o.fog[1],o.fog[2],1)},LR=(t,e,n,s,o,i,r)=>{let l=[0,0,0],a=[0,0,0];va(l,e,n,i),va(a,s,o,i),va(t,l,a,r)},qR=(t,e,n,s,o,i)=>{let r=Pf(o,t,e),l=Pf(o,n,s);return Pf(i,r,l)},ii=(t,e,n,s,o)=>{let i=[0,0,0],r=[0,0,0];gn(i,n,1-o),gn(r,s,o),t[e]=i[0]+r[0],t[e+1]=i[1]+r[1],t[e+2]=i[2]+r[2]},RR=()=>{let t=Yt.position[0],e=Yt.position[2],n=t,s=e,o=t+32,i=e+32,r=$a.get(I.getEnvironmentId(n,s)),l=$a.get(I.getEnvironmentId(o,s)),a=$a.get(I.getEnvironmentId(n,i)),c=$a.get(I.getEnvironmentId(o,i));if(!r||!l||!a||!c)return;let f=t/32%1,u=e/32%1;for(let m=0;m<e0.length;++m){let g=e0[m];for(let v=0;v<3;++v)LR(fn[g][v],r[g][v],l[g][v],a[g][v],c[g][v],f,u)}for(let m=0;m<t0.length;++m){let g=t0[m];for(let v=0;v<3;++v)fn[g][v]=qR(r[g][v],l[g][v],a[g][v],c[g][v],f,u)}},zR=()=>{let t=Qt.environment.data.watercolors;for(let e=0;e<9;++e)t[e]=fn.water[Math.floor(e/3)][e%3]},BR=(t,e)=>{let n=Qt.environment.data.worldlight,s=[0,0,0],o=Math.max(0,1-t/80),i=Math.min(1,1-o);ii(s,0,fn.water[1],fn.water[2],i);let r=[0,0,0];r[0]=(n[0]+n[3])*s[0]*1.5,r[1]=(n[1]+n[4])*s[1]*1.5,r[2]=(n[2]+n[5])*s[2]*1.5;let l=Qt.sky.data.skycolors,a=Qt.sky.data.suncolor,c=Qt.environment.data.worldlight,f=Qt.environment.data.fog,u=Math.max(.2,.5*o),m=Math.min(.4,Math.max(.1,.5*o)),g=Math.max(.3,.7*o);for(let v=0;v<15;++v)l[v]=u*r[v%3];Y(f,u*r[0],u*r[1],u*r[2]),ot(a,f);for(let v=0;v<9;++v)Qt.environment.data.watercolors[v]=m;for(let v=0;v<6;++v)c[v]=g*r[v%3]},Jd=0,Li=1,Kd=2,n0=[{from:Li,to:Jd,start:0,end:0,dur:0},{from:Jd,to:Jd,start:0,end:0,dur:0},{from:Jd,to:Li,start:0,end:0,dur:0},{from:Li,to:Li,start:0,end:0,dur:0},{from:Li,to:Kd,start:0,end:0,dur:0},{from:Kd,to:Kd,start:0,end:0,dur:0},{from:Kd,to:Li,start:0,end:0,dur:0},{from:Li,to:Li,start:0,end:0,dur:0}],u8=0;n0.forEach(t=>{let e=t.from!==t.to,n=!e&&t.from!==Li;e?t.dur=.5:n?t.dur=5:t.dur=1.5,u8+=t.dur});var u2=0;n0.forEach(t=>{t.start=u2,u2=t.end=u2+1/u8*t.dur});var $R=(t,e,n)=>{t=gt(t,0,1);let s=.5,o=0,i=0;for(let a=0;a<n0.length;++a){let c=n0[a];if(c.end>=t){s=Sf(c.start,c.end,t),o=c.from,i=c.to;break}}let r=Qt.sky.data;ii(r.skycolors,0,fn.skytop[o],fn.skytop[i],s),ii(r.skycolors,3,fn.skymid[o],fn.skymid[i],s),ii(r.skycolors,6,fn.skybot[o],fn.skybot[i],s),ii(r.skycolors,9,fn.horizon[o],fn.horizon[i],s),ii(r.skycolors,12,fn.clouds[o],fn.clouds[i],s),ii(r.suncolor,0,fn.sun[o],fn.sun[i],s),ot(mc,uc),mc[1]=Math.abs(Math.sin(t*6.282)),ts(mc,mc);let l=Qt.environment.data;ii(l.worldlight,0,fn.direct[o],fn.direct[i],s),ii(l.worldlight,3,fn.ambient[o],fn.ambient[i],s),l.worldlight[6]=uc[0],l.worldlight[7]=uc[1],l.worldlight[8]=uc[2],ii(l.fog,0,fn.fog[o],fn.fog[i],s),l.fog[3]=n>0?-100:jv,l.fog[4]=n>0?Wv:ro,l.daycycle[0]=t,l.time[0]=e%3600,ut[31].uniforms.amount.value=Pf(s,fn.bloom[o],fn.bloom[i])};var UR=[],OR=[],p8=(t,e)=>{if(vn===void 0||vn.suspended)return;let n=vn.currentTime,s=zf.get(I.getAreaId(Yt.position[0],Yt.position[2])),i=t>.5?s.ambientnight:s.ambientday,r=5;e>0&&(i=167,r=.5),m8(UR,n,r,i,!1),m8(OR,n,5,s.music,!0)},m8=(t,e,n,s,o)=>{let i=!1;for(let r=t.length-1;r>=0;--r){let l=t[r],a=l.sound,c=a.gain.gain;l.id===s&&!a.ended?(i=!0,l.fade!==1&&(l.fade=1,c.setTargetAtTime(1,e,n))):c.value<.02||a.ended?(a.stop(),t.splice(r,1)):l.fade!==0&&(l.fade=0,c.setTargetAtTime(0,e,l.fadeDuration))}if(!i&&s!==0){let r=o?Sy(s,3):Cy(s,2);r&&(r.gain.gain.setValueAtTime(0,e),t.push({id:s,sound:r,fade:0,fadeDuration:n}))}};var qi=[0,0,0,0],d8=(t,e,n,s)=>{if(I.player&&I.player.buffs.buffs.has(128))qi[0]=.2,qi[1]=.4,qi[2]=.4,qi[3]=.7,s.add(33),ut[33].uniforms.warp.value=.1,ut[31].uniforms.amount.value=3;else if(e>0){let o=Qt.environment.data.fog;qi[0]=o[0],qi[1]=o[1],qi[2]=o[2],qi[3]=.5,s.add(33),ut[33].uniforms.warp.value=.3,ut[31].uniforms.amount.value=Math.min(3,Math.max(.3,e/10))}ut[33].uniforms.tint.value=qi};var h8=()=>{},s0=0,o0=t=>s0=t,g8=(t,e,n)=>{let s=(e/3600+.9)%1;s<.7?s=Sf(0,.7,s)*.4:s=.4+Sf(.7,1,s)*.6,f8(s,s0,e,n),d8(s,s0,e,n),p8(s,s0)};var Pu=()=>[-0,-0,-0,-0,-0,-0],ri=Pu();var v8=(t,e)=>!(t[3]<e[0]||t[0]>e[3]||t[4]<e[1]||t[1]>e[4]||t[5]<e[2]||t[2]>e[5]),jR=(t,e,n,s,o)=>(t[0]=e[0],t[3]=e[0]+n,t[1]=e[1],t[4]=e[1]+s,t[2]=e[2],t[5]=e[2]+o,t);var _8=(t,e)=>{t[0]=t[1]=t[2]=1/0,t[3]=t[4]=t[5]=-1/0;for(let n=0;n<e.length;++n){let s=e[n];t[0]=Math.min(t[0],s[0]),t[3]=Math.max(t[3],s[0]),t[1]=Math.min(t[1],s[1]),t[4]=Math.max(t[4],s[1]),t[2]=Math.min(t[2],s[2]),t[5]=Math.max(t[5],s[2])}return t};var i0=(t,e,n,s,o)=>(Y(_t,e[0]-n/2,e[1]-s/2,e[2]-o/2),jR(t,_t,n,s,o));var b8=(t,e,n,s,o)=>{let i=(t[0]-e[0])*n[0],r=(t[1]-e[1])*n[1],l=(t[2]-e[2])*n[2],a=(t[3]-e[0])*n[0],c=(t[4]-e[1])*n[1],f=(t[5]-e[2])*n[2],u=Math.max(s,Math.min(i,a),Math.min(r,c),Math.min(l,f)),m=Math.min(o,Math.max(i,a),Math.max(r,c),Math.max(l,f));return!(m<0||u>m)};var y8=(t,e,n)=>{let s=[0,0,0];for(let o=0;o<6;++o){let i=e[o],r=n[o];if(i[0]>0?s[0]=t[3]:s[0]=t[0],i[1]>0?s[1]=t[4]:s[1]=t[1],i[2]>0?s[2]=t[5]:s[2]=t[2],hn(i,s)+r<0)return!1}return!0};var r0=class{constructor(){this.id=0,this.pos=[-0,-0,-0],this.rot=[-0,-0,-0],this.scale=1,this.matrix=void 0,this.loaded=!1}setWorldMatrix(e,n){this.matrix=e,Bn(_t,n,this.pos),hs(kn,this.scale),Dm(Mi,this.rot),Tm(this.matrix,Mi,_t,kn)}loadGeometry(e,n){if(!this.loaded){let s=Mo.get(this.id);this.loaded=!0,s.geometry===0?this.postGeometryLoad(e,n):tr(s.geometry,(o,i)=>{let r=!e.finishedLoadingChunks.has(n.id);this.addMesh(e,n),r&&this.addCollider(e,n,o,i),this.postGeometryLoad(e,n)})}}onUpdate(e,n,s){}addMesh(){}postGeometryLoad(e,n){n.loadingProps--}handleColliderGeometry(e,n,s,o){let i=this.matrix,r=s.position,l=s.color,a=s.flags;for(let c=0,f=n.length;c<f;c+=3){let u=n[c],m=n[c+1],g=n[c+2],v=m2(u*3,o,r,i),_=m2(m*3,o,r,i),b=m2(g*3,o,r,i),k=[v,_,b],y=_8(Pu(),k);if(a[u]&1&&a[m]&1&&a[g]&1){if(k.push(Wf([0,0,0],v,_,b)),l.length){let F=[(l[u*4+0]+l[m*4+0]+l[g*4+0])/3,(l[u*4+1]+l[m*4+1]+l[g*4+1])/3,(l[u*4+2]+l[m*4+2]+l[g*4+2])/3,(l[u*4+3]+l[m*4+3]+l[g*4+3])/3];k.push(F)}e.triangleGrid.add(k,y)}}}addCollider(e,n,s,o){let i=new Map;this.handleColliderGeometry(e,o.index,o,i),this.handleColliderGeometry(e,o.indexInvisible,o,i)}onRemove(){}},m2=(t,e,n,s)=>{if(e.has(t))return e.get(t);{let o=[n[t],n[t+1],n[t+2]];return Ps(o,o,s),e.set(t,o),o}};var l0=class extends r0{constructor(){super(),this.mesh=void 0,this.effects=[],this.isEffectProp=!1,this.effectsCreated=!1}onUpdate(e,n,s){this.mesh!==void 0&&this.updateMesh(n),super.onUpdate(e,n,s)}updateMesh(e){this.setWorldMatrix(this.mesh.worldMatrix,e),Bn(this.mesh.position,e,this.pos),Y(this.mesh.rotation,this.rot[0],this.rot[1],this.rot[2]),hs(this.mesh.scale,this.scale),this.mesh.data.multi&&(this.mesh.data.multi.needsUpdate=!0)}onRemove(e){super.onRemove(e),Mo.get(this.id).effects.length&&this.deleteEffects(),this.mesh&&(this.mesh.data.multi?Po(this.mesh.data.multi,this.mesh):vo(this.mesh),this.mesh=void 0)}addMesh(e,n){if(this.mesh===void 0){let s=Mo.get(this.id);this.mesh=oi(this.id,s.shadow,!1,!0),this.mesh.visible=!1,this.updateMesh(n.origin),s.effects.length&&(this.isEffectProp=!0)}}onChunkRebuild(e){this.mesh&&this.mesh.data&&this.mesh.data.interiorlight&&I.getInteriorLight(this.mesh.data.interiorlight,i0(ri,this.mesh.position,3,3,3))}createEffects(){if(this.isEffectProp=!0,!this.effectsCreated){let e=Mo.get(this.id).effects;for(let n=0;n<e.length;++n){let s=e[n],o=on();ot(o.position,s.pos),ot(o.scale,s.scale),ot(o.rotation,s.rot),Cn(o,this.mesh),Bt(o,!0);let i=Us(s.id,o,0,!0);this.effects.push(i)}this.effectsCreated=!0}}deleteEffects(){if(this.effectsCreated){for(let e=0;e<this.effects.length;++e)this.effects[e].done=!0;this.effects.length=0,this.effectsCreated=!1}}setVisible(e){this.mesh.visible!==e&&(this.mesh.visible=!0,this.mesh.data.multi.needsUpdate=!0)}setEffectVisible(e){this.isEffectProp&&this.effectsCreated!==e&&(e?this.createEffects():this.deleteEffects())}};var x8=(t,e,n)=>{e[n]=(t&31)*8,e[n+1]=(t>>5&31)*8,e[n+2]=(t>>10&31)*8},k8=65536/64,WR=2147483647/2e3,p2=65536/(Math.PI*2),GR=65536/100;var w8=(t,e)=>(t.id=e.id,Y(t.pos,e.x/k8,e.y/WR,e.z/k8),Y(t.rot,e.rx/p2,e.ry/p2,e.rz/p2),t.scale=Math.max(e.scale,100)/GR,t);var M8=(t,e,n,s)=>{t.id=e,t.x=n,t.z=s,t.origin[0]=n*64,t.origin[2]=s*64,t.deserialized=!1,t.props.length=0,t.data=void 0,t.loadingProps=0},F8=(t,e)=>{t.data=e,C8(t),HR(t,!0),t.deserialized=!0},To=(t,e,n)=>{e/=2.6666666666666665,n/=2.6666666666666665;let s=e%1,o=n%1;if(s===0&&o===0)return t.data.terrain[e+25*n]*.030517578125;{let i=Math.floor(e),r=Math.floor(n),l=s+o<1,a=t.data.terrain[i+25*r+(l?0:1)],c=t.data.terrain[i+25*Math.min(24,r+1)],f=t.data.terrain[i+1+25*(r+(l?0:1))],u=l?-(s-1+o):-(o-1),m=l?o:-(s-1),g=1-u-m;return(u*a+m*c+g*f)*.030517578125}},Tu=(t,e,n)=>{if(t.data.holes.length===0)return!1;e/=2.6666666666666665,n/=2.6666666666666665;let s=Math.floor(e)+Math.floor(n)*24;return t.data.holes.indexOf(s)>=0},Eu=(t,e,n)=>{if(t.data.water.length===0)return-1;e/=64,n/=64;let s=e%1,o=n%1;if(s===0&&o===0)return t.data.water[e+2*n]*.030517578125;{let i=Math.floor(e),r=Math.floor(n),l=s+o<1,a=t.data.water[i+2*r+(l?0:1)],c=t.data.water[i+2*Math.min(2-1,r+1)],f=t.data.water[i+1+2*(r+(l?0:1))],u=l?-(s-1+o):-(o-1),m=l?o:-(s-1),g=1-u-m;return(u*a+m*c+g*f)*.030517578125}};var d2=(t,e,n)=>{e/=16,n/=16;let o=Math.floor(e)+Math.floor(n)*4;return t.data.area[o]||0},h2=(t,e,n)=>{e/=32,n/=32;let o=Math.floor(e)+Math.floor(n)*2;return t.data.environment[o]||0},C8=t=>{let e=[-0,-0,-0];for(let n=0;n<24;++n)for(let s=0;s<24;++s){let o=(s*2+24*n*2)*3,i=s*2.6666666666666665,r=n*2.6666666666666665;Y(bo,i,To(t,i,r),r),Y(Tp,i,To(t,i,r+2.6666666666666665),r+2.6666666666666665),Y(Cf,i+2.6666666666666665,To(t,i+2.6666666666666665,r),r),Wf(e,bo,Tp,Cf),t.normals[o]=e[0],t.normals[o+1]=e[1],t.normals[o+2]=e[2],Y(bo,i+2.6666666666666665,To(t,i+2.6666666666666665,r),r),Y(Cf,i+2.6666666666666665,To(t,i+2.6666666666666665,r+2.6666666666666665),r+2.6666666666666665),Wf(e,bo,Tp,Cf),t.normals[o+3]=e[0],t.normals[o+4]=e[1],t.normals[o+5]=e[2]}};var HR=(t,e)=>{for(let n=0,s=t.data.props.length;n<s;++n){let o=t.data.props[n],i=w8(new l0,o);t.props.push(i),e&&t.loadingProps++}for(let n=0;n<t.props.length;++n){let s=t.props[n];s.onUpdate(I,t.origin,I.bounds),s.loadGeometry(I,t)}},YR=t=>{for(let e=0;e<t.props.length;++e)t.props[e].onRemove(t);t.props.length=0},S8=t=>{YR(t)},P8=(t,e)=>Math.floor(t%64/32)+Math.floor(e%64/32)*2,A8=(t,e)=>Math.floor(t%32*3)+Math.floor(e%32*3)*96;var Iu=1,a0=t=>{Iu=t%2147483647,Iu<=0&&(Iu+=2147483646),Dl(),Dl()},Dl=()=>Iu=Iu*16807%2147483647,Du=()=>(Dl()-1)/2147483647,pc=(t,e)=>Du()*(e-t)+t;var f0,u0,m0,Os=[0,0,0],dc,hc,gc,XR=[21,56,50,44,13,19,7,42],v2=3758102380,_2=(t,e)=>t>>e&1,Fr=(t,e,n,s)=>XR[_2(t,s)<<2|_2(e,s)<<1|_2(n,s)],c0=t=>{let e=(Os[0]+Os[1]+Os[2])/6,n=dc-Os[0]+e,s=hc-Os[1]+e,o=gc-Os[2]+e,i=.6-n*n-s*s-o*o,r=QR(f0+Os[0],u0+Os[1],m0+Os[2]);if(Os[t]++,i<0)return 0;let l=r>>5&1,a=r>>4&1,c=r>>3&1,f=r>>2&1,u=r&3,m=u===1?n:u===2?s:o,g=u===1?s:u===2?o:n,v=u===1?o:u===2?n:s;return m=l===c?-m:m,g=l===a?-g:g,v=l!==(a^c)?-v:v,i*=i,8*i*i*(m+(u===0?g+v:f===0?g:v))},QR=(t,e,n)=>Fr(t,e,n,0)+Fr(e,n,t,1)+Fr(n,t,e,2)+Fr(t,e,n,3)+Fr(e,n,t,4)+Fr(n,t,e,5)+Fr(t,e,n,6)+Fr(e,n,t,7),E8=(t,e,n)=>{let s=t+v2,o=e+v2,i=n+v2,r=(s+o+i)/3;f0=Math.floor(s+r),u0=Math.floor(o+r),m0=Math.floor(i+r),r=(f0+u0+m0)/6,dc=s-f0+r,hc=o-u0+r,gc=i-m0+r,Os[0]=Os[1]=Os[2]=0;let l=dc>=gc?dc>=hc?0:1:hc>=gc?1:2,a=dc<gc?dc<hc?0:1:hc<gc?1:2;return c0(l)+c0(3-l-a)+c0(a)+c0(0)};var I8=t=>{let e=0,n=0,s=0;for(let u=0;u<t.nodes.length;++u){let m=t.nodes[u],g=m.leafCount,v=m.points.length/2;e+=v*3*g,n+=v*2*g,s+=Math.max(0,(v-2)*3)*g,m.geotype===1&&(s+=3*g*Math.min(1,m.points.length))}let o=new Float32Array(e),i=new Float32Array(n),r=new Uint32Array(s);a0(t.seed);let l=0,a=0,c=0,f=0;for(let u=0;u<t.nodes.length;++u){let m=t.nodes[u],g=m.start,v=m.end,_=Math.atan2(v[1]-g[1],v[0]-g[0]),{geotype:b,leafCount:k,y,radius:F,slant:A,size:C,arc:M,jitter_slant:V,jitter_size:$,jitter_rotation:D,jitter_radius:z,jitter_y:q}=m,L=m.points.length/2,O=Math.PI*2/(k===2?4:k);for(let j=0;j<k;++j){let R=j*O+pc(-D,D),U=A+pc(-V,V),Z=C*pc(1-$,1),ye=F*pc(1-z,1),we=y*pc(1-q,1);for(let he=0;he<L;++he){let re=m.points[he*2],le=m.points[he*2+1],ve=re-g[0],_e=le-g[1],Ie=ve*Math.cos(-_)-_e*Math.sin(-_),oe=ve*Math.sin(-_)+_e*Math.cos(-_),Ee=0,K=0,Re=0;if(m.geotype===0){let Ye=U+M*Ie;Ee=Math.sin(Ye)*Ie,K=Math.cos(Ye)*Ie,Re=oe}else Ee=Ie,K=M*(Math.abs(Ie)+Math.abs(oe)),Re=oe;let Ge=Ee*Math.cos(R)-Re*Math.sin(R),Qe=Ee*Math.sin(R)+Re*Math.cos(R);o[l]=Ge*Z+Math.cos(R)*ye,o[l+1]=we+K*Z,o[l+2]=Qe*Z+Math.sin(R)*ye,i[a]=re,i[a+1]=1-le,l+=3,a+=2}if(b===0)for(let he=0;he<L-2;++he)r[c]=f+he,r[c+1]=f+he+1,r[c+2]=f+he+2,c+=3;else for(let he=0;he<L-1;++he){let re=he===L-2;r[c]=f,r[c+1]=re?f+L-1:f+he+1,r[c+2]=re?f+1:f+he+2,c+=3}f+=L}}return Sn({position:{size:3,data:o},uv:{size:2,data:i},index:{type:5125,data:r}})};var V8=Math.floor(64**2*(fe.foliage/100)),L8=[],p0=[],q8=[];for(let t=0;t<64*64;++t){let e=Math.max(0,E8(Math.floor(t/64)/7,t%64/7,1));q8.push(e)}for(let t=0;t<8;++t)L8.push(new Float32Array(7*V8)),p0.push([]);var R8=(t,e)=>{if(fe.foliage===0||!e)return;KR(t,W),a0(t.id+1e3);let n=t.geometry.foliage.folIds,s=[],o=t.geometry.foliage.instances,i=[];for(let c=0;c<n.length;++c)s.push(Ba.get(n[c])),i.push(0);let r=fe.foliage,l=!1;t.data.holes.length>0&&(l=!0);let a=[-1,-1,-1,-1];for(let c=0;c<4;++c){let f=t.data.textureid[c];for(let u=0;u<4;++u)f[u]===27&&(a[c]=u)}for(let c=0;c<64;++c)for(let f=0;f<64;++f){if(Dl()%100>r)continue;let u=c+t.origin[0],m=f+t.origin[2],g=I.getNormal(u,m);if(g[1]<.6||l&&Tu(t,c,f)||Eu(t,c,f)>To(t,c,f)+80)continue;let v=P8(c,f),_=A8(c,f),b=t.data.texture[v][_],k=b&31,y=b>>5&31,F=b>>10&31,A=a[v];A>=0&&(A===0&&k>0?k=255:A===1&&y>0?y=255:A===2&&F>0&&(F=255));let C=Dl()%Math.max(32,k+y+F),M=3;C<k?M=0:C<k+y?M=1:C<k+y+F&&(M=2);let V=t.data.textureid[v][M],$=za.get(V).foliage,D=q8[u%64+m%64*64];for(let z=0;z<$.length;++z){let q=$[z],L=q[1];if(Dl()%255>L||q[2]&&D<=0)continue;let O=q[0],j=n.indexOf(O);if(i[j]>=V8||j<0)continue;let R=o[j].attributes.inst.data,U=i[j]*7,Z=Math.max(0,Math.min(64,c-.25+Du()*.5)),ye=Math.max(0,Math.min(64,f-.25+Du()*.5)),we=To(t,Z,ye);R[U]=Z+t.origin[0],R[U+1]=we,R[U+2]=ye+t.origin[2],R[U+3]=q[2]?.5+Math.min(1.4,D*1.5):.5+Du(),R[U+4]=g[0]+.001,R[U+5]=g[1],R[U+6]=g[2],i[j]++}}for(let c=0;c<n.length;++c){let f=o[c],u=i[c];zp(f,u),_s(f,f.attributes.inst),f.bounds=t.geometry.terrain.bounds}},d0=new Map,b2=new Map,D8=new Set,ZR=t=>p0[t].length<1?Sn({inst:{instanced:!0,size:7,data:L8[t]}}):p0[t].pop(),JR=(t,e)=>{p0[t].push(e)},KR=(t,e)=>{if(!t.geometry.foliage){let n=t.geometry.foliage={instances:[],folIds:[]};for(let s=0;s<4;++s){let o=t.data.textureid[s];for(let i=0;i<4;++i){let r=za.get(o[i]).foliage;for(let l=0;l<r.length;++l)n.folIds.indexOf(r[l][0])<0&&n.folIds.push(r[l][0])}}n.folIds.length>8&&(n.folIds.length=8);for(let s=0;s<n.folIds.length;++s){let o=n.folIds[s];n.instances.push(ZR(s));let i=Ba.get(o);d0.has(i.id)||d0.set(i.id,I8(i)),D8.has(i.texture)||(D8.add(i.texture),bs(i.texture,r=>{$p(r,16),no(r),b2.set(i.texture,r)}))}}},z8=t=>{if(t.geometry.foliage){for(let e=0;e<t.geometry.foliage.instances.length;++e)JR(e,t.geometry.foliage.instances[e]);t.geometry.foliage=void 0}},B8=(t,e)=>{},$8=t=>{if(!fe.foliage)return;let e=3,n=2,s=[],o=[],i=[];for(let r=0,l=t.length;r<l;++r){let a=t[r];if(AS(a.x*2,a.z*2)<Xv){let c=a.geometry.foliage;for(let f=0;f<c.folIds.length;++f){let u=c.folIds[f],m=s.indexOf(u);m<0&&(s.push(u),o.push([]),i.push(Ba.get(u).type===0?13:14),m=s.length-1),o[m].push(c.instances[f])}}}for(let r=0;r<s.length;++r){let l=Ba.get(s[r]);if(d0.has(l.id)&&b2.has(l.texture)){let a=i[r],c=ut[a];tt.currentProgram!==c.id&&(W.useProgram(c.program),tt.currentProgram=c.id,qa(c),La(c),_h(c.uniformArray));let f=d0.get(l.id);Ia(f,c),qn("foliageDiffuse",b2.get(l.texture),0,c),Vf(c);let u=o[r];for(let m=0;m<u.length;++m){let g=u[m];W.bindBuffer(W.ARRAY_BUFFER,g.attributes.inst.buffer),W.vertexAttribPointer(e,3,W.FLOAT,!1,7*4,4*4),W.enableVertexAttribArray(e),ba(e,1),W.vertexAttribPointer(n,4,W.FLOAT,!1,7*4,0),W.enableVertexAttribArray(n),ba(n,1),tt.boundBuffer=g.attributes.inst.id,W.drawElementsInstanced(W.TRIANGLES,f.drawRangeCount,f.attributes.index.type,f.drawRangeStart,g.instancedCount)}}}};var vc=[],_c=[],Cr=new Map,U8=(t,e,n,s,o)=>{let i=I.entity(t),r=I.entity(e);if(n.fx.effectMissile&&i!==void 0&&r!==void 0&&(!i.visual.inFog||!r.visual.inFog)){let l={mId:s,targetid:e,timer:o,effect:Us(n.fx.effectMissile,on(),i===I.playerId?1:0,!0),start:Bn([0,0,0],Br(_t,[0,0,i.radius],i.rot),i.visualPosition)};l.effect.transform.matrixAutoUpdate=!0,vc.push(l),Cr.set(s,l),N8(l,vc.length-1)}},O8=(t,e,n,s,o,i)=>{if(s.fx.effectMissile){let r={mId:o,timer:i,path:e,fractions:n,currentIndex:0,effect:Us(s.fx.effectMissile,on(),t===I.playerId?1:0,!0)};r.effect.transform.matrixAutoUpdate=!0,_c.push(r),Cr.set(o,r),j8(r,_c.length-1)}},N8=(t,e)=>{if(!I.isEntityIdTaken(t.targetid)||t.timer.done(I.smoothtime)){vc.splice(e,1),t.effect.done=!0,Cr.delete(t.mId);return}let n=I.entity(t.targetid),s=Zt(t.effect.transform.position,n.visualPosition,t.start);sn(t.effect.transform.position,t.start,s,t.timer.fraction(I.smoothtime));let o=I.getHeight(t.effect.transform.position[0],t.effect.transform.position[2])+.3;o>t.effect.transform.position[1]&&(t.effect.transform.position[1]=o),Ur(t.effect.transform,n.visualPosition,!1,Ap),t.timer.passed(I.smoothtime)>.5&&(ot(t.start,t.effect.transform.position),t.timer.reset(I.smoothtime,t.timer.end-I.smoothtime)),Bt(t.effect.transform,!1)},j8=(t,e)=>{if(t.timer.done(I.smoothtime)){_c.splice(e,1),t.effect.done=!0,Cr.delete(t.mId);return}let n=Math.max(0,Math.min(1,t.timer.fraction(I.smoothtime)));t.currentIndex=Ey(t.effect.transform.position,t.path,n,t.fractions),Bt(t.effect.transform,!1)},W8=()=>{vc.forEach(N8),_c.forEach(j8)},G8=t=>{vc.forEach(e=>{e.effect.done=!0}),_c.forEach(e=>{e.effect.done=!0}),vc.length=0,_c.length=0,Cr.clear()};var lo,H8=()=>{lo=Bs(void 0,11,W.TRIANGLES),hs(lo.transform.scale,40),lo.transform.visible=!1,lo.transform.matrixAutoUpdate=!0,tr(1456,t=>{let e=Sn(t);lo.geometry=e;let n=Pi(1024,1024,1,!1,W.NONE,W.REPEAT,W.REPEAT);eb(n),to(jf,ut[34]);let s=n.colorTexture;qn("skyDiffuse",s,0,ut[11]),bs(1748,o=>{lo.transform.visible=!0,qn("cloudDiffuse",o,0,ut[11])})})},Y8=()=>{Y(lo.transform.position,ht.transform.worldMatrix[12],ht.transform.worldMatrix[13],ht.transform.worldMatrix[14]),Bt(lo.transform,!1)},X8=()=>{lo.transform.visible&&to(lo,ut[11])};var Ns,Q8=()=>{Ns=Bs(void 0,12,W.TRIANGLES),hs(Ns.transform.scale,.1),Cn(Ns.transform,lo.transform),Ns.transform.visible=!1,tr(1455,t=>{Ns.geometry=Sn(t),Ns.transform.visible=!0})},Z8=()=>{ot(Ns.transform.position,mc),gn(Ns.transform.position,Ns.transform.position,.45),Ur(Ns.transform,nb,!1,tb),Ns.transform.matrixNeedsUpdate=!0},J8=()=>{Ns.transform.visible&&to(Ns,ut[12])};var g0=24,Pt=g0+1,nP=Pt**2,y2=new Map,Sr=96,K8=96/12,bc=8,Vu=new Uint8Array(3*Sr**2),k2=new Map,h0=g0/2,eP=3,tP=[1,2,4,8],Vl=[0],en=[],oz=(t,e,n,s)=>{let o=e+n*Pt,i=e+(n+s)*Pt,r=e+(n+s)*Pt+s,l=e+n*Pt+s;en.push(o),en.push(i),en.push(l),en.push(i),en.push(r),en.push(l)};for(let t=0;t<2;++t)for(let e=0;e<2;++e)for(let n=0;n<eP;++n){let s=tP[n],o=tP[n+1],i=e*h0,r=(e+1)*h0,l=t*h0,a=(t+1)*h0;for(let c=0;c<(n===eP-1?1:16);++c){let f=1&c,u=2&c,m=4&c,g=8&c,v=i+(f?s:0),_=r-(m?s:0),b=l+(u?s:0),k=a-(g?s:0);for(let y=b;y<k;y+=s)for(let F=v;F<_;F+=s)oz(en,F,y,s);if(f){for(let y=l;y<a;y+=o){let F=i+y*Pt,A=i+(y+o)*Pt,C=i+(y+s)*Pt+s;if(en.push(F,A,C),y<a-o){let M=C+s*Pt,V=M+s*Pt;en.push(C,A,M),en.push(M,A,V)}}u||en.push(i+l*Pt,i+(l+s)*Pt+s,i+l*Pt+s),g||en.push(i+a*Pt,i+a*Pt+s,i+(a-s)*Pt+s)}if(u){for(let y=i;y<r;y+=o){let F=y+l*Pt,A=y+l*Pt+o,C=y+(l+s)*Pt+s;if(en.push(F,C,A),y<r-o){let M=C+s;en.push(C,M,A),en.push(M,M+s,A)}}f||en.push(i+l*Pt,i+(l+s)*Pt,i+(l+s)*Pt+s),m||en.push(r+l*Pt,r+(l+s)*Pt-s,r+(l+s)*Pt)}if(m){for(let y=l;y<a;y+=o){let F=r+y*Pt,A=r+(y+o)*Pt,C=r+(y+s)*Pt-s;if(en.push(F,C,A),y<a-o){let M=C+s*Pt,V=M+s*Pt;en.push(C,M,A),en.push(M,V,A)}}u||en.push(r+l*Pt,r+l*Pt-s,r+(l+s)*Pt-s),g||en.push(r+a*Pt,r+(a-s)*Pt-s,r+a*Pt-s)}if(g){for(let y=i;y<r;y+=o){let F=y+a*Pt,A=y+a*Pt+o,C=y+(a-s)*Pt+s;if(en.push(F,A,C),y<r-o){let M=C+s,V=M+s;en.push(C,A,M),en.push(M,A,V)}}f||en.push(i+a*Pt,i+(a-s)*Pt+s,i+(a-s)*Pt),m||en.push(r+a*Pt,r+(a-s)*Pt,r+(a-s)*Pt-s)}Vl.push(en.length)}}var iz={type:W.UNSIGNED_INT,data:new Uint32Array(en)},x2=new Float32Array(nP*3),rz=new Float32Array(nP*3);for(let t=0,e=0;t<=g0;++t)for(let n=0;n<=g0;++n,++e)x2[e*3+0]=n*2.6666666666666665,x2[e*3+2]=t*2.6666666666666665;var sP=()=>{},oP=(t,e,n)=>{if(az(t),e){let s=t.geometry.terrain,o=s.attributes.position.data,i=s.attributes.normal.data;for(let l=0;l<25;++l)for(let a=0;a<25;++a){let c=a+25*l,f=t.data.terrain[c]*.030517578125;o[c*3+1]=f}let r=t.normals;for(let l=0;l<25*25*3;++l)i[l]=0;for(let l=0;l<24;++l)for(let a=0;a<24;++a){let c=(a*2+24*l*2)*3,f=r[c],u=r[c+1],m=r[c+2],g=r[c+3],v=r[c+4],_=r[c+5],b=(a+25*l)*3,k=(a+25*(l+1))*3,y=(a+1+25*l)*3,F=(a+1+25*(l+1))*3;i[b]+=f,i[b+1]+=u,i[b+2]+=m,i[k]+=f+g,i[k+1]+=u+v,i[k+2]+=m+_,i[y]+=f+g,i[y+1]+=u+v,i[y+2]+=m+_,i[F]+=g,i[F+1]+=v,i[F+2]+=_}if(t.z>0){let a=I.getChunk(t.x,t.z-1).normals,c=24-1;for(let f=0;f<24;++f){let u=(f*2+24*c*2)*3,m=a[u],g=a[u+1],v=a[u+2],_=a[u+3],b=a[u+4],k=a[u+5],y=(f+1)*3,F=f*3;i[F]+=m+_,i[F+1]+=g+b,i[F+2]+=v+k,i[y]+=_,i[y+1]+=b,i[y+2]+=k}}if(t.z+1<I.chunkAmount){let a=I.getChunk(t.x,t.z+1).normals,c=0,f=25-1;for(let u=0;u<24;++u){let m=(u*2+24*c*2)*3,g=a[m],v=a[m+1],_=a[m+2],b=a[m+3],k=a[m+4],y=a[m+5],F=(u+25*f)*3,A=(u+1+25*f)*3;i[F]+=g,i[F+1]+=v,i[F+2]+=_,i[A]+=g+b,i[A+1]+=v+k,i[A+2]+=_+y}}if(t.x>0){let a=I.getChunk(t.x-1,t.z).normals,c=24-1;for(let f=0;f<24;++f){let u=(c*2+24*f*2)*3,m=a[u],g=a[u+1],v=a[u+2],_=a[u+3],b=a[u+4],k=a[u+5],y=25*f*3,F=25*(f+1)*3;i[y]+=m+_,i[y+1]+=g+b,i[y+2]+=v+k,i[F]+=_,i[F+1]+=b,i[F+2]+=k}}if(t.x+1<I.chunkAmount){let a=I.getChunk(t.x+1,t.z).normals,c=0,f=25-1;for(let u=0;u<24;++u){let m=(c*2+24*u*2)*3,g=a[m],v=a[m+1],_=a[m+2],b=a[m+3],k=a[m+4],y=a[m+5],F=(f+25*u)*3,A=(f+25*(u+1))*3;i[A]+=g+b,i[A+1]+=v+k,i[A+2]+=_+y,i[F]+=g,i[F+1]+=v,i[F+2]+=_}}for(let l=0;l<25;++l)for(let a=0;a<25;++a){let c=(a+25*l)*3,f=i[c],u=i[c+1],m=i[c+2],g=1/Math.sqrt(f*f+u*u+m*m);i[c]=f*g,i[c+1]=u*g,i[c+2]=m*g}_s(s,s.attributes.position),_s(s,s.attributes.normal)}if(n){let s=t.x*2%bc*2+t.z*2%bc*bc;t.meshes.atlas=cz(t),t.meshes.texSet=t.data.textureid.map(fz);let o=t.data.holes.length>0;for(let i=0;i<2;++i)for(let r=0;r<2;++r){let l=r*2+i,a=t.data.texture[l];for(let f=0;f<Sr;++f)for(let u=0;u<Sr;++u){let m=f*Sr+u,g=m*3;if(x8(a[m],Vu,g),o){let v=i*12+Math.floor(u/K8)+(Math.floor(f/K8)+r*12)*24;t.data.holes.indexOf(v)>=0&&(Vu[g+0]=255,Vu[g+1]=255,Vu[g+2]=255)}}fy(t.meshes.atlas,s+l,Sr,Sr,Vu);let c=t.meshes.quadrantUbos[l];c.data.quadrant[0]=s+l,c.data.terrainInfo=t.meshes.texSet[l].info,od(c),ls(c)}}},lz={min:[0,0,0],max:[64,64,64],center:[32,32,32],scale:[64,64,64],radius:60,initiated:!0},az=t=>{if(t.geometry.terrain||(t.geometry.terrain=Sn({position:{size:3,data:x2},normal:{size:3,data:rz},index:iz}),Object.assign(t.geometry.terrain.bounds,lz)),!t.meshes.terrain){let e=Bs(t.geometry.terrain,8,W.TRIANGLES);t.meshes.terrain=e,t.meshes.quadrantUbos=[];for(let n=0;n<4;++n){let s=Za(au.meshterrain);s.data.modelMatrix=e.transform.matrix,t.meshes.quadrantUbos.push(s)}}ot(t.meshes.terrain.transform.position,t.origin),t.meshes.terrain.transform.matrixNeedsUpdate=!0,Bt(t.meshes.terrain.transform,!1),t.state=Math.max(t.state,5)},cz=t=>{let e=Math.floor(t.x*2/bc),n=Math.floor(t.z*2/bc),s=e+1e3*n;if(!y2.has(s)){let o=er({width:Sr,height:Sr,target:W.TEXTURE_2D_ARRAY,format:W.RGB,internalFormat:W.RGB565,depth:bc**2,flipY:!1,generateMipmaps:!1});$p(o,4),no(o),y2.set(s,o)}return y2.get(s)},fz=t=>{let e=t.join(",");if(!k2.has(e)){let n={info:[],diffuse:[],loaded:0};t.forEach((s,o)=>{let i=za.get(s);n.info[o*4+0]=i.scale/127,n.info[o*4+1]=i.darkest/255*3,n.info[o*4+2]=i.brightest/255*3,n.info[o*4+3]=i.spec/255,bs(i.texture,r=>{n.diffuse[o]=r,n.loaded++})}),k2.set(e,n)}return k2.get(e)},iP=t=>{},rP=(t,e)=>{},lP=()=>{},aP=t=>{let e=ut[8];if(!e.active)return;W.useProgram(e.program),tt.currentProgram=e.id,qa(e),La(e);let n,s,o=1;for(let r=0;r<t.length;++r){let l=t[r],a=l.meshes.terrain,c=a.geometry;n!==l.meshes.atlas&&(qn("atlas",l.meshes.atlas,0,e),n=l.meshes.atlas),Ia(c,e);for(let f=0;f<4;++f)if(l.quadrantlod[f]<=o){let u=l.meshes.texSet[f];if(u.loaded<4)continue;let m=l.meshes.quadrantUbos[f];if(dl(m),s!==u){for(let b=0;b<4;++b)qn("diffuse",u.diffuse[b],b,e);s=u}Vf(e);let g=l.quadrantmask[f],v=Vl[g]*4,_=Vl[g+1]-Vl[g];W.drawElements(a.mode,_,c.attributes.index.type,v)}}let i=ut[9];if(i.active){W.useProgram(i.program),tt.currentProgram=i.id,qa(i),La(e);for(let r=0;r<t.length;++r){let l=t[r],a=l.meshes.terrain,c=a.geometry,f=l.meshes.quadrantUbos[0];dl(f),Ia(c,i);for(let u=0;u<4;++u)if(l.quadrantlod[u]>o){let m=l.quadrantmask[u],g=Vl[m]*4,v=Vl[m+1]-Vl[m];W.drawElements(a.mode,v,c.attributes.index.type,g)}}}};var cP,fP=()=>{cP=Sn({position:{size:3,data:new Float32Array([0,0,0,64,0,0,0,0,64,64,0,64])},index:{type:W.UNSIGNED_INT,data:new Uint32Array([0,2,1,2,3,1])}}),bs(1748,t=>qn("waterNoise",t,0,ut[20])),bs(1243,t=>qn("waterLines",t,0,ut[20])),qn("bufferPongColor",Ii.colorTexture,0,ut[20]),qn("bufferPongDepth",Ii.depthTexture,0,ut[20])},uP=(t,e)=>{if(!e||t.data.water.length===0)return;t.meshes.waterubo||(t.meshes.waterubo=Za(au.water));let n=t.origin[0],s=t.origin[2],o=t.meshes.waterubo.data.verts;for(let i=0;i<4;++i){let r=t.data.water[i]*.030517578125;o[i*3]=n+i%2*64,o[i*3+1]=r,o[i*3+2]=s+Math.floor(i/2)*64}od(t.meshes.waterubo),ls(t.meshes.waterubo)},mP=t=>{},pP=t=>{let e=ut[20];Va(e,tt.currentProgram===e.id);for(let n=0,s=t.length;n<s;++n){let o=t[n];o.data.water.length!==0&&(dl(o.meshes.waterubo),Da(cP,e,W.TRIANGLES))}};var dP=t=>{py(),n4(),e8(t),h8(),fP(),jS(),XS(),H8(),Q8(),lP()},hP=(t,e,n)=>{g8(t,e,n),sP(),t8(e),W8(),l8(t,e),WS(t),QS(t),BS(t,e),Y8(),Z8(),by(t)},gP=(t,e)=>{My(t,e),rP(t,e),B8(t,e)},vP=t=>{G8(t),c8(t),JS(t),US(t),Fy(t)},yc=[],_P=t=>{yc.push(t)},w2=t=>{yc.splice(yc.indexOf(t),1)},bP=t=>{aP(t),GS(),X8(),$8(t)},yP=t=>{J8()},kP=t=>{pP(t),HS(),OS()},xP=(t,e,n,s,o,i,r)=>{if(t.state!==8&&(oP(t,e,n),R8(t,s),uP(t,i),o))for(let l=0;l<t.props.length;++l)t.props[l].onChunkRebuild(t)},wP=t=>{iP(t),z8(t),mP(t)};var kc={neticons:[],npcs:[]},Pr=.6,_0=!1,Ll=200,ql=200,C2=!1,b0=0,y0=0,Ms=document.createElement("canvas");Ms.className="border black minimap";var Eo=Ms.getContext("2d"),M2=new Map,qu=new Map;Ms.addEventListener("wheel",t=>{Pr=gt(Pr+(t.deltaY<0?.07:-.07),.25,1.5)},{passive:!0});Ms.addEventListener("mousedown",t=>{C2=!0});Ms.addEventListener("mouseup",t=>{C2=!1});Ms.addEventListener("mousemove",t=>{if(C2){let e=t.movementX,n=t.movementY;b0-=e/Pr,y0-=n/Pr}});var Lu={player:"#fff",monster:"#D53434",pvp:It("pvp"),friendly:It("health"),party:It("party"),black:It("black")},pz=()=>{nt.map.onPress(()=>{k0(_0=!_0)}),Un(Mt.serverMapUpdate.header,t=>{kc.neticons=Mt.serverMapUpdate.decode(t).icons})},k0=t=>{b0=y0=0,t?(document.body.appendChild(Ms),Ll=~~Math.min(Math.max(200,window.innerWidth*.7),1e3),ql=~~Math.min(Math.max(200,window.innerHeight*.7),800),Ll%2!==0&&(Ll+=1),ql%2!==0&&(ql+=1),Ms.width=Ll,Ms.height=ql,Ms.className="border black minimap enlarged"):(document.getElementById("minimapcontainer").appendChild(Ms),Ms.className="border black minimap",Ll=Ms.width=200,ql=Ms.height=200)},SP=function(){this.loaded=!0},FP=0,dz=t=>{FP++;let e=I.player;if(!e||fe.mapLowQuality&&FP%10!==0)return;let n=Eo;n.globalAlpha=1,n.clearRect(0,0,Ll,ql);let s=e,o=s.pos[0]+b0,i=s.pos[2]+y0,r=Pr<.4?16:4,l=r*64,a=I.chunkAmount,c=Math.round(l*Pr),f=Ll,u=ql,m=f*(l/c),g=u*(l/c),v=Math.ceil(m/l),_=Math.ceil(g/l),b=o-m/2,k=i-g/2,y=Math.floor(b/l),F=Math.floor(k/l),A=y+v,C=F+_;(A*l-b)*(c/l)<f&&A++,(C*l-k)*(c/l)<u&&C++,y=Math.max(0,y),F=Math.max(0,F),A=Math.min(a/r,A),C=Math.min(a/r,C);for(let U=y;U<A;++U)for(let Z=F;Z<C;++Z){let ye=U*r+Z*a*r,we=r+"-"+ye;if(qu.has(we)){let he=qu.get(we);if(he.loaded){let re=(U*l-b)*(c/l),le=(Z*l-k)*(c/l);n.drawImage(he,re,le,c,c)}}else{let he=new Image;he.src=ox(I.file,r,ye),he.onload=SP,qu.set(we,he)}}let M=!1;if(kc.neticons.forEach(U=>{M=M||U.blink;let Z=v0(U.pos[0],U.pos[1],o,i,c,l,f,u);F2(Z,U.id,U.blink)}),M&&(n.globalAlpha=1),kc.npcs.forEach(U=>{let Z=hz(U.pos[0],U.pos[1],o,i,c,l,f,u);Z[0]>0&&Z[1]>0&&Z[0]<f&&Z[1]<u&&F2(Z,U.img,!1)}),I.entities.array.forEach(U=>{if(!U.stats||!U.stats.alive||U===e)return;let Z=v0(U.pos[0],U.pos[2],o,i,c,l,f,u);CP(Z,U.type,e.hostility(U),U.party>0&&U.party===e.party)}),Xt.forEach(U=>{if(U.local&&U.pos!==void 0&&!I.isEntityIdTaken(U.id)){let Z=v0(U.pos[0],U.pos[1],o,i,c,l,f,u);CP(Z,0,0,e.party)}}),e.buffs.buffs.has(128)){let U=e.buffs.buffs.get(128).get(e.id);if(U.data){let Z=v0(U.data[0],U.data[1],o,i,c,l,f,u);F2(Z,2100,!1)}}n.globalAlpha=_0&&I.smoothtime%1<.5?.5:1;let V=I.player.visual.transform.rotation[1],$=Math.sin(V)*6,D=Math.cos(V)*6,z=Math.sin(V+2.4)*6,q=Math.cos(V+2.4)*6,L=Math.sin(V-2.4)*6,O=Math.cos(V-2.4)*6,j=f/2-b0*Pr,R=u/2-y0*Pr;n.fillStyle="#C1DAE2",n.strokeStyle="#1A293A",n.lineWidth=1,n.beginPath(),n.moveTo(j+$,R+D),n.lineTo(j+z,R+q),n.lineTo(j+L,R+O),n.closePath(),n.fill(),n.stroke()},F2=(t,e,n)=>{if(M2.has(e)){let s=M2.get(e);if(s.loaded===!0){!n||I.smoothtime%1<.5?Eo.globalAlpha=n?.6:.8:Eo.globalAlpha=1;let o=s.width,i=s.height;Eo.drawImage(s,t[0]-o/2,t[1]-i/2,~~o,~~i)}}else{let s=document.createElement("img");s.src="data/assets/"+Wp(e)+"?v=8685122",s.onload=SP,M2.set(e,s)}},CP=(t,e,n,s)=>{if(!(!fe.mapShowMonsters&&e===1))if(e===0){if(_0&&s&&I.smoothtime%1>.5)return;n===0?Eo.fillStyle=s?Lu.party:Lu.friendly:Eo.fillStyle=Lu.pvp,Eo.fillRect(...t,6,6),Eo.strokeRect(...t,6,6)}else Eo.fillStyle=n>0?Lu.monster:Lu.friendly,Eo.fillRect(...t,4,4),Eo.strokeRect(...t,4,4)},hz=(t,e,n,s,o,i,r,l)=>{let a=t-n,c=e-s,f=a/i*o,u=c/i*o,m=r/2+f,g=l/2+u;return[m,g]},v0=(t,e,n,s,o,i,r,l)=>{let a=t-n,c=e-s,f=a/i*o,u=c/i*o,m=Math.min(r-3,Math.max(0,r/2+f)),g=Math.min(l-3,Math.max(0,l/2+u));return[m,g]},gz=t=>{qu.clear();for(let e=0;e<Uf.length;++e)Uf[e].world===t.idInt&&kc.npcs.push(Uf[e])},vz=t=>{qu.clear(),kc.neticons.length=0,kc.npcs.length=0};function PP(t){let e,n,s,o;return{c(){e=h("img"),p(e,"class","btn border black bgblack round warIcon svelte-1khf45q"),at(e.src,n="/data/ui/icons/war0."+On+"?v=8685122")||p(e,"src",n)},m(i,r){w(i,e,r),s||(o=H(e,"click",t[2]),s=!0)},p:ae,d(i){i&&x(e),s=!1,o()}}}function _z(t){let e,n=t[0]!==void 0&&PP(t);return{c(){e=h("div"),n&&n.c(),p(e,"id","minimapcontainer"),p(e,"class","marg-top minimapcontainer svelte-1khf45q")},m(s,o){w(s,e,o),n&&n.m(e,null)},p(s,[o]){s[0]!==void 0?n?n.p(s,o):(n=PP(s),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},i:ae,o:ae,d(s){s&&x(e),n&&n.d()}}}function bz(t,e,n){let s,o;return ie(t,Ho,r=>n(0,s=r)),ie(t,Yo,r=>n(1,o=r)),Fn(()=>{k0(!1)}),[s,o,r=>Xe(Yo,o=!o,o)]}var P2=class extends Ce{constructor(e){super(),Pe(this,e,bz,_z,Be,{})}},AP=P2;function TP(t){let e,n;return e=new gS({}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function EP(t){let e,n;return e=new yS({props:{vertical:!0}}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function yz(t){let e,n,s,o,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A,C,M,V,$,D,z,q,L,O,j,R,U,Z,ye,we,he,re,le,ve,_e,Ie;e=new u6({}),s=new ib({});let oe=t[0]&&!t[0].subscribed_until&&(t[1]||t[2]||t[3]||t[4]||t[5])&&TP(t);r=new fC({}),l=new pC({}),a=new o3({}),c=new EF({}),f=new h6({}),u=new Hx({}),m=new oC({}),g=new $x({}),v=new s6({}),_=new a6({}),b=new _6({}),k=new T6({}),y=new tC({}),F=new j6({}),A=new sF({}),C=new pF({}),M=new vF({}),V=new $F({}),$=new JC({}),D=new oS({}),z=new RC({}),q=new YC({}),L=new hS({}),O=new MS({}),R=new x6({}),U=new AP({}),Z=new xS({});let Ee=t[6]&&EP(t);return re=new d4({}),le=new ZM({}),ve=new rS({}),_e=new iC({}),{c(){J(e.$$.fragment),n=h("div"),J(s.$$.fragment),o=h("div"),oe&&oe.c(),i=de(),J(r.$$.fragment),J(l.$$.fragment),J(a.$$.fragment),J(c.$$.fragment),J(f.$$.fragment),J(u.$$.fragment),J(m.$$.fragment),J(g.$$.fragment),J(v.$$.fragment),J(_.$$.fragment),J(b.$$.fragment),J(k.$$.fragment),J(y.$$.fragment),J(F.$$.fragment),J(A.$$.fragment),J(C.$$.fragment),J(M.$$.fragment),J(V.$$.fragment),J($.$$.fragment),J(D.$$.fragment),J(z.$$.fragment),J(q.$$.fragment),J(L.$$.fragment),J(O.$$.fragment),j=h("div"),J(R.$$.fragment),J(U.$$.fragment),J(Z.$$.fragment),Ee&&Ee.c(),ye=h("div"),we=h("div"),he=h("div"),J(re.$$.fragment),J(le.$$.fragment),J(ve.$$.fragment),J(_e.$$.fragment),p(j,"class","l-corner-ur uiscaled"),p(o,"class","container svelte-k3qmu8"),p(he,"class","actionbarcontainer svelte-k3qmu8"),p(we,"class","uiscaled"),p(ye,"class","container svelte-k3qmu8"),p(n,"class","l-ui layout svelte-k3qmu8")},m(K,Re){X(e,K,Re),w(K,n,Re),X(s,n,null),d(n,o),oe&&oe.m(o,null),d(o,i),X(r,o,null),X(l,o,null),X(a,o,null),X(c,o,null),X(f,o,null),X(u,o,null),X(m,o,null),X(g,o,null),X(v,o,null),X(_,o,null),X(b,o,null),X(k,o,null),X(y,o,null),X(F,o,null),X(A,o,null),X(C,o,null),X(M,o,null),X(V,o,null),X($,o,null),X(D,o,null),X(z,o,null),X(q,o,null),X(L,o,null),X(O,o,null),d(o,j),X(R,j,null),X(U,j,null),X(Z,j,null),Ee&&Ee.m(j,null),d(n,ye),d(ye,we),d(we,he),X(re,he,null),X(le,he,null),X(ve,ye,null),X(_e,n,null),Ie=!0},p(K,[Re]){K[0]&&!K[0].subscribed_until&&(K[1]||K[2]||K[3]||K[4]||K[5])?oe?Re&63&&S(oe,1):(oe=TP(K),oe.c(),S(oe,1),oe.m(o,i)):oe&&(Me(),E(oe,1,1,()=>{oe=null}),Fe()),K[6]?Ee?Re&64&&S(Ee,1):(Ee=EP(K),Ee.c(),S(Ee,1),Ee.m(j,null)):Ee&&(Me(),E(Ee,1,1,()=>{Ee=null}),Fe())},i(K){Ie||(S(e.$$.fragment,K),S(s.$$.fragment,K),S(oe),S(r.$$.fragment,K),S(l.$$.fragment,K),S(a.$$.fragment,K),S(c.$$.fragment,K),S(f.$$.fragment,K),S(u.$$.fragment,K),S(m.$$.fragment,K),S(g.$$.fragment,K),S(v.$$.fragment,K),S(_.$$.fragment,K),S(b.$$.fragment,K),S(k.$$.fragment,K),S(y.$$.fragment,K),S(F.$$.fragment,K),S(A.$$.fragment,K),S(C.$$.fragment,K),S(M.$$.fragment,K),S(V.$$.fragment,K),S($.$$.fragment,K),S(D.$$.fragment,K),S(z.$$.fragment,K),S(q.$$.fragment,K),S(L.$$.fragment,K),S(O.$$.fragment,K),S(R.$$.fragment,K),S(U.$$.fragment,K),S(Z.$$.fragment,K),S(Ee),S(re.$$.fragment,K),S(le.$$.fragment,K),S(ve.$$.fragment,K),S(_e.$$.fragment,K),Ie=!0)},o(K){E(e.$$.fragment,K),E(s.$$.fragment,K),E(oe),E(r.$$.fragment,K),E(l.$$.fragment,K),E(a.$$.fragment,K),E(c.$$.fragment,K),E(f.$$.fragment,K),E(u.$$.fragment,K),E(m.$$.fragment,K),E(g.$$.fragment,K),E(v.$$.fragment,K),E(_.$$.fragment,K),E(b.$$.fragment,K),E(k.$$.fragment,K),E(y.$$.fragment,K),E(F.$$.fragment,K),E(A.$$.fragment,K),E(C.$$.fragment,K),E(M.$$.fragment,K),E(V.$$.fragment,K),E($.$$.fragment,K),E(D.$$.fragment,K),E(z.$$.fragment,K),E(q.$$.fragment,K),E(L.$$.fragment,K),E(O.$$.fragment,K),E(R.$$.fragment,K),E(U.$$.fragment,K),E(Z.$$.fragment,K),E(Ee),E(re.$$.fragment,K),E(le.$$.fragment,K),E(ve.$$.fragment,K),E(_e.$$.fragment,K),Ie=!1},d(K){K&&x(n),Q(e,K),Q(s),oe&&oe.d(),Q(r),Q(l),Q(a),Q(c),Q(f),Q(u),Q(m),Q(g),Q(v),Q(_),Q(b),Q(k),Q(y),Q(F),Q(A),Q(C),Q(M),Q(V),Q($),Q(D),Q(z),Q(q),Q(L),Q(O),Q(R),Q(U),Q(Z),Ee&&Ee.d(),Q(re),Q(le),Q(ve),Q(_e)}}}function kz(t,e,n){let s,o,i,r,l,a,c;return ie(t,da,f=>n(0,s=f)),ie(t,Hc,f=>n(1,o=f)),ie(t,po,f=>n(2,i=f)),ie(t,Xo,f=>n(3,r=f)),ie(t,Zs,f=>n(4,l=f)),ie(t,Rs,f=>n(5,a=f)),ie(t,xa,f=>n(6,c=f)),vu(),[s,o,i,r,l,a,c]}var A2=class extends Ce{constructor(e){super(),Pe(this,e,kz,yz,Be,{})}},IP=A2;function DP(t){let e,n;return e=new IP({}),{c(){J(e.$$.fragment)},m(s,o){X(e,s,o),n=!0},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function xz(t){let e,n,s,o;e=new A_({props:{active:t[0]}});let i=t[1]&&!t[0]&&t[2]&&DP(t);return s=new sb({}),{c(){J(e.$$.fragment),i&&i.c(),n=de(),J(s.$$.fragment)},m(r,l){X(e,r,l),i&&i.m(r,l),w(r,n,l),X(s,r,l),o=!0},p(r,[l]){let a={};l&1&&(a.active=r[0]),e.$set(a),r[1]&&!r[0]&&r[2]?i?l&7&&S(i,1):(i=DP(r),i.c(),S(i,1),i.m(n.parentNode,n)):i&&(Me(),E(i,1,1,()=>{i=null}),Fe())},i(r){o||(S(e.$$.fragment,r),S(i),S(s.$$.fragment,r),o=!0)},o(r){E(e.$$.fragment,r),E(i),E(s.$$.fragment,r),o=!1},d(r){r&&x(n),Q(e,r),i&&i.d(r),Q(s,r)}}}function wz(t,e,n){let s,o,i;return ie(t,Cs,r=>n(0,s=r)),ie(t,hm,r=>n(1,o=r)),ie(t,jc,r=>n(2,i=r)),[s,o,i]}var T2=class extends Ce{constructor(e){super(),Pe(this,e,wz,xz,Be,{})}},VP=T2;var qP=[],Ru=0,x0=0,LP=()=>{let t=qP.shift();t[0](...t[1]),x0--},RP=(t,e,n)=>{if(n)for(;Ru>0;)Ru--,x0++,LP();else Ru>0&&x0<5&&(Ru--,x0++,requestIdleCallback(LP,{timeout:5e3}))},E2=(t,e,n)=>{qP.push([t,e]),Ru++};var zP=()=>({id:0,x:0,z:0,origin:[0,0,0],deserialized:!1,props:[],normals:new Float32Array(3456),data:void 0,loadingProps:0,center2d:[0,0],geometry:{},meshes:{},state:0,neighbors:[],quadrantlod:[0,0,0,0],quadrantmask:[0,49,98,147],inRange:!1,isMeshVisible:!1,isEffectsVisible:!1,reloadAttempts:0}),I2=(t,e,n,s,o)=>{M8(t,e,n,s),t.reloadAttempts=0,t.center2d[0]=t.origin[0]+64/2,t.center2d[1]=t.origin[2]+64/2,t.neighbors.length=0;for(let i=Math.max(0,n-1);i<=Math.min(o-1,n+1);i++)for(let r=Math.max(0,s-1);r<=Math.min(o-1,s+1);r++){let l=i+r*o;l!==t.id&&t.neighbors.push(l)}t.state=0},BP=t=>t.state>=2?!1:(t.state=2,Mz(t),!0),Mz=async t=>{try{let n=await(await fetch(`data/world/${I.file}/${t.id}?v=8685122`,{cache:"default"})).arrayBuffer();E2(Fz,[new Uint8Array(n),t]),t.reloadAttempts=0}catch(e){t.reloadAttempts++<5?(t.state=2-1,BP(t)):console.log(`failed to load chunk ${t.id}, giving up`,e)}},Fz=(t,e)=>{e.state=3,F8(e,Ca.chunk.decode(t)),D2(e)},D2=t=>{if(t.inRange=s2(t.x*2,t.z*2)<3,t.inRange)for(let e=0;e<2;++e)for(let n=0;n<2;++n){let s=n*2+e,o=Math.min(2,s2(t.x*2+e,t.z*2+n)),i=TS(t.x*2+e,t.z*2+n);t.quadrantlod[s]=o,t.quadrantmask[s]=i}},$P=(t,e)=>{let n=t.state;if(n===0||n===3){if(t.inRange){n===0&&(t.state=1);let s=t.loadingProps===0;for(let o=0;o<t.neighbors.length;++o){let i=e.chunksMap.get(t.neighbors[o]);i?i.state<3&&(i.state===0&&(i.state=1),s=!1):s=!1}n===3&&s&&(t.state=4,Cz(t,!0,!0,!0,!0,!0,!0))}}else n>=5?t.inRange&&t.state<7?(_P(t),t.state=7):!t.inRange&&t.state===7&&(w2(t),zu(t,!1,!1),t.state=6):n===1&&BP(t)&&(t.state=2)},zu=(t,e,n)=>{if(t.isMeshVisible!==e){t.isMeshVisible=e;for(let s=0;s<t.props.length;++s)t.props[s].setVisible(e)}if(!n&&t.isEffectsVisible!==e){t.isEffectsVisible=e;for(let s=0;s<t.props.length;++s)t.props[s].setEffectVisible(e)}},Cz=(t,e,n,s,o,i,r)=>{E2(xP,[t,e,n,s,o,i])},V2=t=>{S8(t),t.state===7&&(w2(t),zu(t,!1,!1),t.state=6),wP(t),t.state=8};var OP=(t,e,n)=>{let s=[];for(let o=0;o<t.length;++o){let i=t[o];y8(i.data.aabb,e.frustum,e.frustumConstants)?(s.push(i),zu(i,!0,n)):zu(i,!1,n)}return s},Sz=()=>{let t=yc;if(W.enable(W.POLYGON_OFFSET_FILL),W.polygonOffset(1.3,3),fc){for(let e=1;e>=0;--e){let n=Ja[e],s=Tl[e];_d(s,!0),Bu(n),j1(n),t=OP(t,s,!0);for(let o=0,i=Qd.length;o<i;++o){let r=Qd[o];ac(r,ut[r.shadowProgram],!0,s)}}Cu(!1)}_d(Tl[0],!0),w0(Ja[0],Ka,W.DEPTH_BUFFER_BIT),Bu(Ka);for(let e=0,n=Xd.length;e<n;++e){let s=Xd[e];ac(s,ut[s.shadowProgram],!1,ht)}W.disable(W.POLYGON_OFFSET_FILL)},Pz=t=>{_d(ht,!0),Bu(Fo),j1(Fo);for(let e=0,n=Gd.length;e<n;++e){let s=Gd[e];ac(s,ut[s.program],!0,ht)}bP(t)},Az=t=>{yP(t);for(let e=0,n=Hd.length;e<n;++e){let s=Hd[e];ac(s,ut[s.program],!0,ht)}w0(Fo,Ii,W.DEPTH_BUFFER_BIT),w0(Fo,Ii,W.COLOR_BUFFER_BIT),Bu(Fo),kP(t);for(let e=0,n=Yd.length;e<n;++e){let s=Yd[e];ac(s,ut[s.program],!0,ht)}},xc=(t,e,n,s,o)=>{let i=ut[t];n&&qn("inputA",n.colorTexture,0,i),s&&qn("inputB",s.colorTexture,0,i);for(let r=0;r<o.length;++r){let l=i.uniforms[o[r][0]];l.value=o[r][1]}Bu(e),to(jf,i)},Tz=t=>{let e=Ii,n=Fo;if(t.has(32)&&(t.delete(32),xc(32,e,n,null,[]),[e,n]=[n,e]),t.has(33)&&(t.delete(33),xc(33,e,n,null,[]),[e,n]=[n,e]),t.has(30)){t.delete(30);let s=.5/gl.width,o=.5/gl.height;xc(30,vl,n,null,[["offset",[-s,-o,s,-o,s,o,-s,o]],["amount",[.25,.25,.25,.25]]]);let i=["amount",[.125,.375,.375,.125]];s*=2,o*=2,xc(30,gl,vl,null,[["offset",[-s*2,0,-s,0,s,0,s*2,0]],i]),xc(30,vl,gl,null,[["offset",[0,-o*2,0,-o,0,o,0,o*2]],i]),xc(31,null,n,vl,[])}else w0(n,null,W.COLOR_BUFFER_BIT)},w0=(t,e,n,s=W.NEAREST)=>{let o=t.width,i=t.height,r=e!==null?e.width:Fo.width,l=e!==null?e.height:Fo.height;W.bindFramebuffer(W.READ_FRAMEBUFFER,t.buffer),W.bindFramebuffer(W.DRAW_FRAMEBUFFER,e!==null?e.buffer:null),W.blitFramebuffer(0,0,o,i,0,0,r,l,n,s)},Bu=t=>{t?(W.bindFramebuffer(W.FRAMEBUFFER,t.buffer),Jc(t.width,t.height)):(W.bindFramebuffer(W.FRAMEBUFFER,null),Jc(tt.width,tt.height))},NP=t=>{tw(t)},jP=t=>{Sz();let e=OP(yc,ht,!1);Pz(e),Az(e),Tz(t)};var wc=fe.resolution/100,GP=!1,WP=[256,512,1024,2048][fe.shadowmapResolution]||1024,HP=()=>{W||(alert("WebGL2 problem found."),window.location.href="/technical"),YP(),NP(WP),dP(WP),QP(tt.width,tt.height),Vn.className="l-canvas",As.className="l-canvas",As.style.pointerEvents="all",window.addEventListener("resize",XP,!1)};Nr.subscribe(t=>{PS(t**2/10,fe.shadowmapResolution)});jr.subscribe(t=>{ht.fov=t,Zc(ht)});Cs.subscribe(t=>{GP=!t});var YP=()=>{let t=window.innerWidth*wc,e=window.innerHeight*wc;Y_(t,e)},XP=()=>{let t=window.innerWidth*wc,e=window.innerHeight*wc;YP(),nw(t,e),QP(t,e)},QP=(t,e)=>{ht.aspect=t/e,Zc(ht),s4(t,e)};Wr.subscribe(t=>{let e=t/100,n=wc!==e;wc=e,fe.resolutionScale=e,n&&XP()});var ZP=(t,e)=>{Rm(ht);let n=new Set;fe.fxaa&&n.add(32),fe.bloom&&n.add(30),GP&&(hP(t,e.smoothtime,n),jP(n))},JP=(t,e)=>{gP(t,e)},KP=t=>{vP(t),o8()};Ci.report.fun=t=>{t.length>=3?mi.set({name:t,reason:0,reasonfixed:!1}):Nt("error","Enter a player name to report",!0)};var B2={};Kn(B2,{init:()=>zz,postTick:()=>$z,preTick:()=>Bz});var $u=[],li=0,eA=t=>{li+=t;let e=[];for(let s=0;s<$u.length;s++){let o=$u[s];if(o.timer.done(li))Dz(o),$u.splice(s--,1);else if(li>=o.timer.start){let i=o.timer.fraction(li);ot(o.screenPos,o.pos);let r=pl(o.screenPos,o.screenPos,o.flat);if(r){let l=o.timer.remaining(li);if(o.alpha=l<.3?l/.3:1,o.crit){let a=Math.min(1,i*6);o.scale=1+(a>.5?2-a*2:a*2)*1.6}else r[1]-=50-(1-i)**2*50,o.scale=1;e.push(o)}}}if(e.sort((s,o)=>o.timer.start-s.timer.start),fe.combatTextPush){let s=0,o=!0,i=[0,0],r=[0,0];for(;s<10&&o;){++s,o=!1;for(let l=0;l<e.length;++l){let a=e[l],c=a.width*a.scale,f=a.height*a.scale;i[0]=a.screenPos[0]+a.screenOffset[0],i[1]=a.screenPos[1]+a.screenOffset[1];for(let u=0;u<e.length;++u){if(u===l)continue;let m=e[u],g=m.width*m.scale;if(m.flat!==a.flat||g<c||g===c&&l<u)continue;let v=m.height*m.scale;r[0]=m.screenPos[0]+m.screenOffset[0],r[1]=m.screenPos[1]+m.screenOffset[1];let _=r[0]-i[0],b=r[1]-i[1],k=g/2+c/2,y=v/2+f/2;if(Math.abs(_)<k&&Math.abs(b)<y){let F=_<0?_+k:_-k,A=b<0?b+y:b-y;Math.abs(F)<Math.abs(A)*1.2?a.screenOffset[0]+=F:a.screenOffset[1]+=A,o=!0,i[0]=a.screenPos[0]+a.screenOffset[0],i[1]=a.screenPos[1]+a.screenOffset[1]}}}}}let n=[0,0];for(let s=0;s<e.length;++s){let o=e[s];o.screenOffset[0]*=Math.max(0,1-t*3),o.screenOffset[1]*=Math.max(0,1-t*3),n[0]=o.screenPos[0]+o.screenOffset[0],n[1]=o.screenPos[1]+o.screenOffset[1],Fx(n,o.img,o.alpha,o.scale)}},q2=(t,e,n,s,o=!1,i)=>{let r=n===3;Uu(t,o,r,o||!r,n===0?"Miss":dt(e)+(n===1?"\u{1F6E1}\uFE0F":""),o?Dt.pdmg:s===1?r?Dt.spellCrit:Dt.spell:r?Dt.physCrit:Dt.phys,i,li,r?1.2:.9)},R2=(t,e,n,s=!1,o)=>{Uu(t,s,n===3,s||n!==3,dt(e),s?Dt.pheal:Dt.heal,o,li,1.3)},tA=(t,e,n)=>{Uu(t,n,!1,!0,"Immune",n?Dt.mana:Dt.spell,e,li,2)},nA=(t,e,n,s=!1)=>{Uu(t,s,n===3,s||n!==3,e,Dt.mana,0,li,1.3)};var sA=(t,e)=>{Uu(t,!1,!1,!0,`+${e} Fame`,Dt.fame,5.5,li,1.5)},Uu=(t,e=!1,n=!1,s=!1,o,i,r,l,a)=>{let c=Iz();ot(c.pos,t),c.pos[1]+=r||0,c.side=Math.sin($u.length*2.3),c.flat=e,c.crit=n,c.float=s,c.timer.reset(l,a),Y(c.screenPos,0,0,0),vs(c.screenOffset,0,0,0),c.scale=0,c.alpha=0,c.img=tu(o,i),c.width=c.img.width,c.height=c.img.height,$u.push(c)},L2=[],Iz=()=>L2.length?L2.pop():{pos:[0,0,0],flat:!0,crit:!0,float:!0,yoffset:0,timer:new kt(0,1),screenPos:[0,0,0],screenOffset:[0,0],scale:0,alpha:0,img:void 0,width:0,height:0},Dz=t=>{L2.push(t)};var z2=fe.itemTypeFilter.toLowerCase().replace(/\s/g,"").split(","),Mc=new Set,Vz=(t,e,n)=>{for(let s=n.length-1;s>=0;s--){let o=n[s];(o==e||ss(e.pos,o.pos)<5**2)&&(t.push(o),Bn(t.pos,t.pos,o.pos),n.splice(s,1))}},oA=(t,e)=>{ot(t.hudPos,t.visualPosition||t.pos),pl(t.hudPos,t.hudPos)&&t.hudPos[2]<.997&&e.push(t)},iA=t=>{let e=[];I.entities.array.forEach(o=>{o.type!==3||!o.visual.transform.visible||o.quality<fe.itemQualityFilter||z2.includes(o.droptype)||oA(o,e)}),Mc.forEach(o=>{o.uiTimeout<I.time?Mc.delete(o):oA(o,e)}),e=e.sort((o,i)=>i.id-o.id);let n=new Set;for(;e.length;){let o=e[0],i=[];i.pos=[0,0,0],Vz(i,o,e),gn(i.pos,i.pos,1/i.length),Y(i.pos,Math.round(i.pos[0]),Math.round(i.pos[1]),Math.round(i.pos[2])),pl(i.pos,i.pos)?n.add(i.sort((r,l)=>r.hudPos[2]-l.hudPos[2])):n.delete(i)}let s=0;Array.from(n).sort((o,i)=>i.pos[2]-o.pos[2]).forEach(o=>{let i=o.length/5*100,r=0,l=0;o.forEach((a,c)=>{a.hudTextImg||(a.hudTextImg=tu(a.name,Dt[a.color]));let f=a.hudTextImg.width,u=Math.round(o.pos[0]+l-i*.5)-2,m=Math.round(o.pos[1]-r*20)-8;if(a.uiTimeout===0){let g=a.canBePickedUpBy(I.player),v=a.partyTimeoutCheck(I.player);g&&!(ja[0]>u+f||ja[1]>m+20||ja[0]<u||ja[1]<m)?(s=a.id,Ts.globalAlpha=1):Ts.globalAlpha=g?.4:.1,Ts.fillStyle="#000000",Ts.beginPath(),Ts.rect(u,m,f,20),Ts.fill(),fr(vs($n,u+2,m+8),a.name,v?Dt[a.color]:Dt.itemgrey,g?1:.8,1,0,0,0)}l+=f+3,l>i&&(r++,l=0)})}),s!==_n&&cu(s)};var Jn=[],rA,lA,js=2,aA=()=>{let n=Math.ceil(100),s=Math.max(7,Math.ceil(9*1)),o=Math.max(1,Math.ceil(js*1)),i=n-js*2,r=s-js*2;Jn.push(Ds(null,It("panel"),n,s,0,0,o)),Ds(Jn[0],It("grey"),i,r,js,js,1),Jn.push(Ds(null,It("health"),i,r,0,0,1)),Jn.push(Ds(null,"#ffbc00",i,r,0,0,1)),Jn.push(Ds(null,It("enemy"),i,r,0,0,1)),Jn.push(Ds(null,It("party"),i,r,0,0,1)),Jn.push(Ds(null,It("pvp"),i,r,0,0,1)),Jn.push(Ds(null,"#555555",i,r,0,0,1)),Jn.push(Ds(null,It("spell"),i,r,0,0,1));for(let l=0;l<=3;++l)Jn.push(Ds(null,It("c"+l),i,r,0,0,1));rA=Ds(null,"#ffffff",100+js*2,9+js*2,0,0,3),lA=Ds(null,"#ffffff",100+js*2,16+js*2,0,0,3)},Lz=()=>{let t=[];return I.entities.array.forEach((e,n)=>{!e.visual||!e.visual.transform.visible||e.stats&&!e.stats.alive||e.id!==zn&&e.visual.cDist&&e.visual.cDist>60||e.type===3&&e.id!==_n||(ot(e.hudPos,e.visualPosition||e.pos),e.type!==3&&(e.hudPos[1]+=e.visual.getTopAbsolute(),e.mount!==void 0&&(e.hudPos[1]+=1)),pl(e.hudPos,e.hudPos)&&(e.id===I.playerId&&(e.hudPos[0]=Math.round(.5*Vn.width),e.hudPos[1]=Math.round(.5*Vn.height)),t.push(e)))}),t.sort((e,n)=>n.hudPos[2]-e.hudPos[2])},qz=(t,e,n)=>e?4:n===0?fe.classColorBars&&t.type===0?8+t.class:1:I.player.canCombatInteract(t)?n===2?fe.classColorBars?8+t.class:5:t.type===1&&t.aggroMode===0?2:3:6,Rz=(t,e)=>{let n=t.visual&&t.visual.cDist;if(n>fe.nameplateViewRange)return;n?n/=70:n=0;let s=t.party>0&&t.party===I.player.party,o=t.faction!==void 0?I.player.hostility(t):0,i=I.player.clan,r=I.player.level,l=t.id===zn,a=t.id===I.playerId,c=t.id===_n;if(t.type!==3&&t.stats&&t.stats.alive){t.namePlateScale=gt(t.namePlateScale+((l?1:0)-t.namePlateScale)*.25,.5,1);let m=l?1:Math.max(.1,Math.min(1,1-n))*.7,g=l||s?1:Math.min(.8,c?.9:m*.75+.2),v=t.skills.timedSkill!==void 0;!a&&l&&cr(v?lA:rA,t.hudPos,1,t.namePlateScale,1,v?2:1,0,v?4:0);let _=l||o===0&&fe.nameplateShowFriendlyPlayers||o===1&&fe.nameplateShowMonsters||o===2&&fe.nameplateShowEnemyPlayers;if(v&&_){let b=Jn[0].height-js,k=gt(t.skills.timedCast.fraction(I.smoothtime),0,1);cr(Jn[0],t.hudPos,g,t.namePlateScale,1,1,0,b),k>0&&cr(Jn[7],t.hudPos,g,t.namePlateScale,k,1,0,b)}if(!a&&_&&(cr(Jn[0],t.hudPos,g,t.namePlateScale,1,v?2:1),cr(Jn[qz(t,s,o)],t.hudPos,g,t.namePlateScale,t.stats.getResource(6)/t.stats.getStat(6),1),t.clan&&fr(vs($n,t.hudPos[0]-(Jn[0].width/2+js)*t.namePlateScale,t.hudPos[1]),t.clan,t.clan==i?Dt.clan:t.faction===0?Dt.faction0small:Dt.faction1small,g,1,2,0,1),t.level&&(fe.alwaysShowLevel||l))){let b=Dt.lev1;o!==0&&(t.level-r>4?b=Dt.lev3:t.level-r>1?b=Dt.lev2:t.level-r<-5&&(b=Dt.lev0)),fr(vs($n,t.hudPos[0]+(Jn[0].width/2+js)*t.namePlateScale,t.hudPos[1]),t.level,b,g,1,0,0,0)}}let f,u=!1;if(t.type===3?(f=t.partyTimeoutCheck(I.player)?Dt[t.color]:Dt.itemgrey,u=!0):o===0?(f=l?Dt.name:Dt.nameSmall,u=fe.nameShowFriendlyPlayers):o===1?(f=l?Dt.enemy:Dt.enemySmall,u=fe.nameShowMonsters):o===2&&(f=l?Dt.pvp:Dt.pvpSmall,u=fe.nameShowEnemyPlayers),l||u){let m=t.type===3&&c&&!t.canBePickedUpBy(I.player)?.5:l||t.type===3?1:c?.9:Math.max(.1,Math.min(1,1-n))*.7,g=l?-16:-9,v=a&&t.clan?t.clan.length*5:0,_=fr(t.hudPos,t.name,f,m,1,v,g);t.clan&&a&&fr(vs($n,t.hudPos[0]-_/2+js,t.hudPos[1]),t.clan,t.faction===0?l?Dt.faction0:Dt.faction0small:l?Dt.faction1:Dt.faction1small,m,1,t.clan.length*5,g,1)}t.speechText&&fr(t.hudPos,t.speechText,t.speechStyle,1,1,0,l?-30:-20,.5,1)},cA=t=>{Mc.clear();let e=Lz();Dg(e),e=e.sort((n,s)=>n.id===zn||n.id===_n?1:s.id===zn||s.id===_n?-1:s.hudPos[2]-n.hudPos[2]),os(Mi,0,0,0,0),e.forEach(Rz)};var zz=()=>{Mx(),aA()},Bz=()=>{Ts.clearRect(0,0,Vn.width,Vn.height)},$z=t=>{nt.shift.down?iA(t):cA(t),eA(t)};var $2={};Kn($2,{onWorldEnter:()=>Uz});var Uz=()=>{yt("petlootsettings",z2.join(",")+" "+fe.itemQualityFilter)};var U2={};Kn(U2,{init:()=>Oz});var Oz=()=>{Un(Mt.serverWarUpdate.header,t=>{let e=Mt.serverWarUpdate.decode(t);Ho.update(n=>(n===void 0||e.contributors.length===0&&(e.contributors=n.contributors),e))})};var Fc=[B2,Vg,Hg,uv,S2,Gh,lh,mg,mh,$2,rg,Vp,U2],O2=!1,fA=()=>{Fc.forEach(t=>{t.init&&t.init()})},uA=t=>{Fc.forEach(e=>{e.preTick&&e.preTick(t)})},mA=t=>{Fc.forEach(e=>{e.tick&&e.tick(t)})},pA=(t,e)=>{Fc.forEach(n=>{n.postTick&&n.postTick(t,e)})},dA=t=>{Fc.forEach(e=>{e.onWorldEnter&&e.onWorldEnter(t)}),O2=!0},hA=t=>{O2&&Fc.forEach(e=>{e.onWorldDestroy&&e.onWorldDestroy(t)}),O2=!1};var vA=async t=>{let n=await(await fetch("api/user/join",{method:"POST",body:JSON.stringify({id:t})})).json();if(n.world)Or.set(n.world),tf.set(t);else throw Or.set(void 0),tf.set(void 0),n.result||"Unknown Error";return!0};var _A=0,M0=!1,bA=new kt(0,2e4),yA=2,kA=t=>{bA.done(t)&&(t>1e5&&!M0&&t-_A>60*1e3*3?(M0=!0,_A=t,Hc.set(yA),yA++):M0&&(M0=!1,Hc.set(0)),bA.reset(t))};var N2={arena3v3:{port:5006},arena5v5:{port:5007},main:{port:5009},dev2:{port:5010},dev_default:{port:5010},dev_pathfind:{port:5011},arena_big_swamp:{port:5012},arena_cage:{port:5013},arena_cove:{port:5014},arena_lava:{port:5015},arena_ruins:{port:5016},arena_small_swamp:{port:5017}};var j2=t=>{N2[fe.activeWorld]===void 0?window.location.href="/":(console.log("Connecting to "+fe.activeWorld),t&&Cs.set("Connecting"),U3(N2[fe.activeWorld].port))},xA=t=>{I.load(t.world,t.file,t.playerId),I.setTimeFromTickId(t.tickId),Ou=0},Ou=0,wA=async t=>{if(t===4002)Cs.set("Connecting"),I.destroy();else try{if(Ou<10?Cs.set("Connecting"):Cs.set(`Connecting (${t})`),t===1006&&(Ou++,Ou>=20)||t>=4008)throw!0;I.destroy();let e=Ou>1?Lh(500,1e3):Lh(1200,1600);for(await new Promise(n=>setTimeout(n,e));document.visibilityState==="hidden";)Cs.set("Browser is idle"),await new Promise(n=>setTimeout(n,e));await vA(fe.lastConnectedChar)}catch{return window.location.href="/",!1}j2(!1)},MA=(t,e)=>{V3(e),RP(t,e,I.state<=2),kA(e),I&&I.player?(Vy(t),uA(t),I.tick(t),mA(t),ZP(t,I),pA(t,I)):I&&I.tick(t)};var F0=class{constructor(){this.nodes=new Map,this.width=-0,this.height=-0,this.depth=-0,this.yd=-0,this.zd=-0,this.xm=-0,this.ym=-0,this.zm=-0,this.xs=-0,this.ys=-0,this.zs=-0,this.dirty=!1}setDimensions(e,n,s,o,i,r){this.clear(),this.dirty=!0;let l=Math.floor(e/o),a=Math.floor(n/i),c=Math.floor(s/r);this.width=e,this.height=n,this.depth=s,this.yd=a,this.zd=c,this.xm=l-1,this.ym=a-1,this.zm=c-1,this.xs=e/l,this.ys=n/a,this.zs=s/c}clear(){this.nodes.clear()}add(e,n){let s=Math.max(0,Math.min(this.xm,~~(n[0]/this.xs))),o=Math.max(0,Math.min(this.ym,~~(n[1]/this.ys))),i=Math.max(0,Math.min(this.zm,~~(n[2]/this.zs))),r=Math.max(0,Math.min(this.xm,~~(n[3]/this.xs))),l=Math.max(0,Math.min(this.ym,~~(n[4]/this.ys))),a=Math.max(0,Math.min(this.zm,~~(n[5]/this.zs)));for(let c=s;c<=r;++c)for(let f=o;f<=l;++f)for(let u=i;u<=a;++u){let m=c*this.yd*this.zd+f*this.zd+u;this.nodes.has(m)||this.nodes.set(m,{aabbs:[],content:[],count:0});let g=this.nodes.get(m);g.content.push(e),g.aabbs.push(n),g.count++}}queryAABB(e){let n=Math.max(0,Math.min(this.xm,~~(e[0]/this.xs))),s=Math.max(0,Math.min(this.ym,~~(e[1]/this.ys))),o=Math.max(0,Math.min(this.zm,~~(e[2]/this.zs))),i=Math.max(0,Math.min(this.xm,~~(e[3]/this.xs))),r=Math.max(0,Math.min(this.ym,~~(e[4]/this.ys))),l=Math.max(0,Math.min(this.zm,~~(e[5]/this.zs))),a=[];for(let c=n;c<=i;++c)for(let f=s;f<=r;++f)for(let u=o;u<=l;++u){let m=c*this.yd*this.zd+f*this.zd+u;if(this.nodes.has(m)){let g=this.nodes.get(m);for(let v=0;v<g.count;++v){let _=g.content[v];v8(g.aabbs[v],e)&&!a.includes(_)&&a.push(_)}}}return a}queryRay(e,n,s){let o=e[0]+n[0],i=e[1]+n[1],r=e[2]+n[2],l=Math.max(0,Math.min(this.xm,~~(Math.min(e[0],o)/this.xs))),a=Math.max(0,Math.min(this.ym,~~(Math.min(e[1],i)/this.ys))),c=Math.max(0,Math.min(this.zm,~~(Math.min(e[2],r)/this.zs))),f=Math.max(0,Math.min(this.xm,~~(Math.max(e[0],o)/this.xs))),u=Math.max(0,Math.min(this.ym,~~(Math.max(e[1],i)/this.ys))),m=Math.max(0,Math.min(this.zm,~~(Math.max(e[2],r)/this.zs))),g=[];for(let v=l;v<=f;++v)for(let _=a;_<=u;++_)for(let b=c;b<=m;++b){let k=v*this.yd*this.zd+_*this.zd+b;if(this.nodes.has(k)){let y=this.nodes.get(k);for(let F=0;F<y.count;++F){let A=y.content[F];b8(y.aabbs[F],e,s,0,1)&&!g.includes(A)&&g.push(A)}}}return g}queryNodeContents(e,n,s){e=Math.max(0,Math.min(this.xm,~~(e/this.xs))),n=Math.max(0,Math.min(this.ym,~~(n/this.ys))),s=Math.max(0,Math.min(this.zm,~~(s/this.zs)));let o=e*this.yd*this.zd+n*this.zd+s;return this.nodes.has(o)?this.nodes.get(o).content:[]}};var as={origin:[0,0,0],dir:[0,-1,0],invDir:[0,0,0]},C0=(t,e,n,s,o,i,r)=>{Y(t.origin,e,n,s),Y(t.dir,o,i,r),Em(t.invDir,t.dir)};var S0=class{constructor(e){this.entity=e,this.buffs=new Map,this.casters=new Map,mu.forEach(n=>{this[n]=new Set}),this.tags=new Map;for(let n=0;n<13;++n)this.tags.set(n,new Set)}tick(e,n,s){}setBuff(e,n,s,o,i,r){s<=0&&console.error("buff with zero or less stacks");let l=this.buffs.get(e)||this.buffs.set(e,new Map).get(e),a=l.get(n)||{};if(a.caster=n,a.id=e,a.level=r,a.stacks=s,a.logic=yl.get(e),a.timer=new kt(o,i),a.active=!0,a.uniqueInstances=0,a.remove=!1,a.logic.intervalDuration!==void 0){let f=o;a.interval&&(f=a.interval.start);let u=I.entity(n);a.interval=new kt(f,a.logic.intervalHaste&&u!==void 0?a.logic.intervalDuration/UF(u.stats.getStat(16)):a.logic.intervalDuration)}else a.interval=new kt(0,0);return l.set(n,a),a.logic.onSet(a,n,this),(this.casters.get(n)||this.casters.set(n,new Map).get(n)).set(e,a),a.logic.unique&&this.updateUniqueState(e),a}removeBuff(e,n){let s=this.buffs.get(e);if(s){let o=s.get(n);if(o){o.logic.onRemove(o,n,this),s.delete(n),s.size===0&&this.buffs.delete(e);let i=this.casters.get(n);return i.delete(e),i.size===0&&this.casters.delete(n),o.logic.unique&&this.updateUniqueState(e),o}}}updateUniqueState(e){let n=this.buffs.get(e);if(n){let s;n.forEach((o,i)=>{(!s||o.level>s.level)&&(s=o),o.active=!1,o.uniqueInstances=n.size}),s.active=!0}}clear(e,n=!1){this.buffs.forEach((s,o)=>{s.forEach((i,r)=>{(!n||r!==this.entity.id)&&i.logic.passive==e&&i.logic.clearOnDeath&&this.removeBuff(o,r)})})}clearTempBuffs(){this.clear(!1)}clearPassiveBuffs(){this.clear(!0)}onDeath(){this.clearTempBuffs()}hasAnyWithTag(e){return this.tags.get(e).size>0}};var Gs=[5,4,0,2,3,8,9],Hs=(t,e,n,s)=>{let o=t.entity.mount!==void 0;t.walking=!o&&t.walking,Gz(t,o),Hz(t,o),Wz(t,o),jz(t,e,n,s,o),Nz(t,e,n,s,o)},Nz=(t,e,n,s)=>{if(t.body[0].visible&&t.entity.buffs.visualIncapacitate>0){ns(t.body[0].rotation,(Math.sin(n*2.2)+Math.sin(n*2.1)*.3)*.3+1,(Math.sin(n*2.1)+Math.sin(n*2)*.6)*.3,(Math.sin(n*.8)+Math.sin(n*2.3)*.5)*.3);for(let o=2;o<=3;++o)t.body[o].position[1]-=.2}},jz=(t,e,n,s,o)=>{let i=t.body[2];if(i.visible&&(t.body[6]!==void 0&&(t.sheathed||(o?Ws(t,!0):t.entity.target&&!t.walking&&!t.falling?(i.rotation[0]+=1,i.rotation[2]+=.6,i.position[2]-=.3,i.position[1]-=.2,i.position[0]-=.1,t.body[4].position[0]-=.05,t.body[5].position[0]+=.05,t.body[4].position[2]-=.2,t.body[0].position[1]+=-.05+Math.sin(n*3)*.05,t.body[0].rotation[1]-=Math.cos(n*3)*.05):(i.rotation[0]+=.5,i.position[1]-=.2,i.position[0]-=.1))),t.currentAnim&&t.currentAnim.info.movement!==13)){let l=Jt.easeInOutCubic(t.currentAnim.fract),a=-Math.sin(l*7.5-1.5),c=-Math.sin(l*6.28),f=-Math.sin(l*3.14),u=Jt.easeOutExpo(-f);switch(gn(i.rotation,i.rotation,1-u),t.currentAnim.info.movement){case 0:if(t.body[6]!==void 0)Ws(t,!1),ns(i.rotation,f*1.7,u*1.5,a*u+u*.5),i.position[2]-=f-l*u,i.position[1]+=Math.sin(l*13+3)*u*.5,i.position[0]+=(-.5+l*1.5)*u,t.body[0].rotation[1]+=c*1.5;else{let m=Math.cos(l*6.28);t.body[0].position[2]+=(.3+Math.sin(l*6.28-3.14)*.2)*u,t.body[0].rotation[0]+=Math.sin(l*3.28)*.5*u;for(let g=0;g<=1;++g){let v=t.body[2+g];v.visible&&(gn(v.position,v.position,1-u),v.position[2]+=(1-m*.5)*u,v.position[1]+=Math.sin(l*6.28)*(l>.5?.7:1),v.position[0]+=(g?.5+f*.2:-.5-f*.2)*u,Y(v.rotation,0,1.5,0))}}break;case 1:Ws(t,!1),i.rotation[0]-=f*1.7,i.rotation[1]+=u*1.5-u,i.rotation[2]+=a*u+u*.5,i.position[2]+=u,i.position[0]-=u*.5,t.body[0].rotation[1]-=c*1.5-u*.5;break;case 12:Ws(t,!1),i.rotation[0]=1.7,i.rotation[1]=0,i.rotation[2]=.5,i.position[2]=1.3,i.position[1]=.2,i.position[0]=-.5;break;case 4:Ws(t,!1),i.rotation[0]+=f*1.7,i.rotation[1]-=f*1.5,i.position[0]-=u*.5,t.body[0].rotation[1]=l*2*Math.PI+u*3;break;case 3:{Ws(t,!0),Y(t.body[0].rotation,f,0,0),Y(i.position,-.3,0,.7);break}case 11:{Ws(t,!1),Y(t.body[0].rotation,f*.4,0,f*.3),i.rotation[0]-=f*.8,i.rotation[1]+=f*.4;break}case 9:{Ws(t,!1),Y(i.rotation,0,0,0);break}case 5:{Ws(t,!0);break}}}let r=t.body[3];t.body[7]!==void 0&&r.visible&&(t.entity.target&&!t.walking&&!t.falling?(r.rotation[2]-=.2,r.rotation[1]-=1,r.position[1]+=.1,r.position[2]+=.4):(r.rotation[2]-=.1,r.position[1]+=.1))},Wz=(t,e)=>{for(let n=0;n<=1;++n){let s=t.body[4+n];if(s.visible)if(e)Y(s.rotation,-.9,n?.2:-.2,n?.4:-.4),Y(s.position,n?.6:-.6,-.4,.5);else{let o=cl(t.entity.steer);if(t.currentAnim&&t.currentAnim.info.movement===10){Y(s.position,0,0,0);continue}if(t.falling)if(t.flip==0){let i=Math.max(-1,Math.min(0,t.entity.vel[1]*.2))*.1,r=n?t.cycle(0)*.3-i:t.cycle(.5)*.3+i;Y(_t,n?.3-i:-.3+i,-.65,r),Br(s.position,_t,0),Y(s.rotation,-r,o,0)}else Y(s.position,n?.3:-.3,-.3,0),Y(s.rotation,0,0,0);else if(t.entity.inWater>t.entity.radius)t.walking?(Y(s.rotation,1.3,n?.1:-.1,0),Y(s.position,n?.3:-.3,Math.cos(t.cycleRad+n*Math.PI)*.4,-1.1)):(Y(s.rotation,1,n?.1:-.1,0),Y(s.position,n?.3:-.3,-.7,Math.cos(t.cycleRad+n*Math.PI)*.4));else{if(t.walking){let i=t.entity.steer[1]<0?.4:.6,r=t.cycle(0)*i*1.3;Y(_t,n?.3:-.3,Math.max(0,Math.cos(t.cycleRad+(n?0:Math.PI))*.6)-.55,t.cycle(n?0:.5)*i),Br(s.position,_t,o),Y(s.rotation,n?-r:r,o,0)}else Y(s.rotation,0,n?.1:-.1,0),Y(s.position,n?.45:-.45,-.65,0);t.currentAnim&&!t.walking&&(t.currentAnim.info.movement==5||t.currentAnim.info.movement==13||t.currentAnim.info.movement==6||t.currentAnim.info.movement==9)&&Y(s.position,n?.4:-.55,-.65,n?.2:-.3)}}}},Gz=(t,e)=>{let n=t.body[0],s=n.position,o=n.rotation;if(n.visible){if(!t.falling||e?(t.walking?t.entity.inWater>t.entity.radius?Y(s,0,-.1,0):Y(s,0,Math.cos(t.cycleRad*2)*.1+.4,0):t.entity.inWater>t.entity.radius?Y(s,0,.3,0):Y(s,0,e?.5:t.cycle(0)*.1+.4,0),t.transform.rotation[0]!==0&&(t.transform.rotation[0]=0)):(t.transform.rotation[0]=t.cycleRad*t.flip,Y(s,0,t.flip!=0?.3:.5,0)),t.entity.inWater>t.entity.radius)t.walking?Y(o,1.2,0,Math.sin(t.cycleRad)*.1):Y(o,Math.sin(t.cycleRad)*.1-.1,0,Math.cos(t.cycleRad)*.05);else{Y(o,-t.pushBack[1]*5+t.movementPushback[2],0,t.pushBack[0]*5-t.movementPushback[0]),Zp(s,s,t.pushBackOffset),sn(s,s,t.movementPushback,1);let i=-t.movementPushback[1]*.5;Y(n.scale,1+i,1-i,1+i)}if(t.currentAnim!==void 0){let i=t.currentAnim.info.movement;if((i==5||i==6)&&(o[1]-=.3+.05*t.cycle(.2),o[0]+=.3+.02*t.cycle(.4),s[1]-=.1+.05*t.cycle(.6),s[0]-=.05),i==6)o[1]*=1-t.currentAnim.fract;else if(i==10)Y(s,0,.2+Math.sin(t.currentAnim.fract*Math.PI)*.5,0),o[0]+=t.currentAnim.fract*al,o[1]+=cl(t.entity.steer);else if(i==9){let r=Jt.easeOutQuad(gt(t.currentAnim.fract*2,0,1));s[1]+=Math.sin(3+r*5)*.2,o[0]+=.5-r*.5}else i==12?o[1]=t.currentAnim.fract*Math.PI*2:i==13&&(s[2]-=.2+t.cycle(.4)*.05,o[0]=-.2+t.cycle(.8)*.12,o[1]=-.2,o[2]=.2+t.cycle(.15)*.05)}}},Hz=(t,e)=>{for(let n=0;n<=1;++n){let s=t.body[2+n];if(s.visible){if(!t.falling||e)if(t.entity.inWater>t.entity.radius)if(t.walking){let o=t.cycle(0),i=t.entity.steer[1]<0?.3:.5,r=Math.sin(t.cycleRad*2+5);Y(s.rotation,0,o*i*1.3+(n?Math.PI:0),0),Y(s.position,(n?.7:-.7)+r*(n?-.2:.2),.2+o*i*(n?-1.5:1.5),-.2+o*(n?-.3:.3))}else{let o=Math.cos(t.cycleRad+n*2);Y(s.rotation,0,(n?-.43+Math.PI:.43)+o*.15*(n?1:-1),.3),Y(s.position,n?.7:-.7,o*.05-.2,.6-o*.2)}else if(t.walking){let o=t.cycle(0),i=t.entity.steer[1]<0?.3:.5,r=Math.sin(t.cycleRad*2+5);Y(s.rotation,0,o*i*1.3+(n?Math.PI:0),0),Y(s.position,(n?.7:-.7)+r*(n?-.2:.2),-.2+o*(n?.3:-.3),.2+o*i*(n?-1.5:1.5)),s.position[0]=n?Math.max(.5,s.position[0]):Math.min(-.5,s.position[0])}else if(e)Y(s.rotation,0,n?-1.3+Math.PI:1.3,.3),Y(s.position,n?.3:-.3,-.5,.7);else{let o=t.cycle(0);Y(s.rotation,0,(n?-.43+Math.PI:.43)+o*.15*(n?1:-1),.3),Y(s.position,n?.7:-.7,-.3+o*.08,.15-o*.1)}else Y(s.position,n?.6:-.6,-gt(t.entity.vel[1],-5,5)/20,0),s.position[0]+=(n?1:-1)*Math.sin(s.position[1]*3.1+.8)*.3,Y(s.rotation,0,n?Math.PI:0,-.3-s.position[1]);if(t.currentAnim){let o=t.currentAnim.info.movement;if(o==5||o==6)n==0?(s.position[0]-=.2,s.position[1]-=.2,o==6&&(gn(s.position,s.position,1-t.currentAnim.fract),s.position[0]+=-t.currentAnim.fract*.3,s.position[2]+=Math.sin(Math.min(.5,t.currentAnim.fract)*7+4)*.8+.4)):(s.position[0]-=.4,s.position[2]+=.5-t.cycle(.3)*.2,s.rotation[1]+=.6+t.cycle(.4)*.2,s.rotation[0]-=.8,o==6&&(gn(s.position,s.position,1-t.currentAnim.fract),s.position[0]+=t.currentAnim.fract*.3,s.position[2]+=Math.sin(Math.min(.5,t.currentAnim.fract)*7+4)*.7+.3));else if(o===9){let i=Jt.easeInOutCubic(gt(t.currentAnim.fract*2,0,1));Y(s.rotation,1-i,0,0);let r=Math.sin(i*3);n==0?Y(s.position,-.12-r*.35,-.1+i*1.2,.3+r):Y(s.position,.12+r*.35,i*1.2,.3+r)}else if(o===11){let i=Math.sin(Jt.easeInOutCubic(t.currentAnim.fract)*3);s.position[0]+=i*(n?.3:0),s.position[1]=i*(n?-.2:1)-.3,s.position[2]=i*(n?-.3:1)}else o===13&&(s.position[0]=n?.6:0,s.position[1]=n?.7:1,s.position[2]=.8,s.rotation[0]=n?t.cycle(.4)*.2:t.cycle(.2)*.2,s.rotation[1]=n?2:1,s.rotation[2]=n?2:1)}if(t.body[8+n]){let o=t.body[8+n];o.visible&&(Ur(o,s.position,!1,Ap),gn(o.rotation,o.rotation,.5),o.rotation[1]-=n?.8:-.8,o.rotation[2]-=n?.5:-.5)}}}},Ws=(t,e)=>{t.sheathed!==e&&(t.sheathed=e,t.body[6]!==void 0&&(Cn(t.body[6],e?t.body[0]:t.body[2]),t.sheathed?ot(t.body[6].position,t.skin.sheathedPos):ot(t.body[6].position,t.skin.unsheathedPos),t.body[6].matrixNeedsUpdate=!0),t.body[7]!==void 0&&(Cn(t.body[7],e?t.body[0]:t.body[3]),t.sheathed?(Y(t.body[7].position,0,-.2,-.65),Y(t.body[7].rotation,0,-1.57,0)):(Y(t.body[7].position,-.2,0,0),Y(t.body[7].rotation,0,0,0)),t.body[7].matrixNeedsUpdate=!0))};var W2=[5,4,0,2,3],G2=(t,e,n,s)=>{let o=t.body[3];if(o.visible&&(Y(o.rotation,.2,1.7+t.cycleSin*.15,.4),Y(o.position,.1+t.cycleSin*.2,-.3,.9),t.entity.target>0&&(o.position[0]=.2,o.position[1]+=.15,o.position[2]+=.1,o.rotation[0]+=.2,o.rotation[1]=1.8,o.rotation[2]-=.2),t.currentAnim))switch(t.currentAnim.info.movement){case 5:{Ws(t,!1);let i=Jt.easeOutQuad(gt(t.currentAnim.fract*2,0,1));Y(o.rotation,1.2,2,.3),Y(o.position,.2,0,.8+i*.8),Y(t.body[2].position,-.1-Math.sin(i*2)*.6,i*.1,.8-i*.8),Y(t.body[0].position,0,.6-i*.2,0),Y(t.body[0].rotation,.2-i*.2,-.4+i*.3,0);break}case 7:{Ws(t,!1);let i=Jt.easeOutFlick(gt((t.currentAnim.fract-.5)*2,0,1));Y(o.rotation,1.2,2,.3+i*.1),Y(o.position,.2,i*.3,1.6),Y(t.body[2].position,-.7,.1,-i*.7),Y(t.body[0].position,0,.4,0),Y(t.body[0].rotation,0,-.1,0);break}case 8:{Ws(t,!1);let i=Jt.easeOutQuad(gt(t.currentAnim.fract*2,0,1));Y(t.body[2].position,-.5-i*.3,-.3+i*.3,Math.sin(i*6.28)*.6),Y(o.rotation,.2+.5*i,2,.3),Y(o.position,.2,-.4+i*.3,.8+i*.8),t.body[0].rotation[1]=0,t.body[0].rotation[0]=-.2+i*.2}break}!t.walking&&t.body[4].visible&&(t.body[4].position[2]-=.3,t.body[5].position[2]+=.1)};var FA=[2],CA=(t,e,n,s)=>{let o=t.body[2];ns(o.rotation,.9,-.4,0),o.position[2]-=.1};var SA=[0,16,17],PA=(t,e,n,s)=>{let o=t.cycle(.5);if(Y(t.body[0].scale,o*.1+1,1+t.cycleSin*.1,o*.1+1),Y(t.body[0].position,0,-.2+t.cycleSin*.1,0),Y(t.body[0].rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5),Zp(t.body[0].position,t.body[0].position,t.pushBackOffset),t.currentAnim){let i=Jt.easeOutExpo(t.currentAnim.fract**3);switch(t.currentAnim.info.movement){case 0:t.body[0].position[2]+=Math.sin(i*6.28-3.14);break}}for(let i=0;i<2;++i){let r=t.body[16+i];if(r.visible=t.transform.visible,!r.visible)continue;for(let c=0;c<r.children.length;++c)r.children[c].visible=!0;let l=i==0?t.transform:t.body[16+i-1];Zt(_t,l.position,r.position),Y(tl,0,0,-l.scale[0]*.7),Br(kn,tl,l.rotation[1]),Bn(_t,_t,kn);let a=ds(_t);a>30*t.entity.size?ot(r.position,t.entity.pos):sn(r.position,r.position,_t,Math.max(0,Math.min(.5,20*e*(a-r.scale[1]*.7)))),Y(r.rotation,0,Xp(Zt(_t,l.position,r.position)),0),hs(r.scale,(3-i)*.3*(.8+t.cycle(i*.3)*.1)*t.transform.scale[0]),r.position[1]=Math.max(t.entity.pos[1]+r.scale[1]*.5,r.position[1]-e*2.5),Bt(r,!1)}};var AA=[2,3],TA=(t,e,n,s)=>{if(!t.currentAnim)for(let o=0;o<2;++o){let i=t.body[2+o];if(!i.visible)continue;let r=t.cycle(1.3);Y(i.rotation,.78,0,o?r*.2:-r*.2),Y(i.position,o?.2:-.2,-.4,.6)}};var EA=[0,4,5],IA=(t,e,n,s)=>{let o=t.body[0],i=t.body[4],r=t.body[5];if(t.walking&&!t.falling){t.speed=t.entity.speed*(t.entity.steer[1]===-1?-1.2:1)*.04/(.6+t.entity.size*.6);let l=Math.cos(t.cycleRad);Y(i.rotation,0,t.cycleSin*.2,t.cycleSin*.2),Y(i.position,0,Math.abs(l)*.3+.2,0),Y(r.rotation,0,Math.PI+l*.2,l*.2),Y(r.position,0,Math.abs(t.cycleSin)*.3,0),Y(o.position,t.cycle(.3)*.01,t.cycleSin*.02,0),Y(o.rotation,0,t.cycleSin*.01,Math.sin(t.cycleRad*2)*.01),t.entity.target>0&&Math.random()<.3&&t.fraction(.1,e)&&t.playSound(t.stepset[0],!1)}else{if(t.speed=.5,t.currentAnim){let l=Jt.easeOutExpo(t.currentAnim.fract**3);switch(t.currentAnim.info.movement){case 0:{let a=Math.sin(l*6.28-3.14);Y(o.position,0,Math.max(0,-a),a*.5);for(let c=0;c<2;++c){let f=c==0?i:r,u=c==0?1:-1,m=c==1?Math.PI:0;Y(f.rotation,u*Math.min(a,0),m+a*.1*u,0),Y(f.position,0,Math.max(0,-a),a*.5)}break}}}else{let l=t.cycle(-.1)*.05;Y(o.position,0,t.cycle(-.1)*.1,0);for(let a=0;a<2;++a){let c=a==0?i:r;Y(c.rotation,0,a==1?Math.PI:0,t.falling?.4:l*.5),Y(c.position,0,0,0)}}Y(o.rotation,0,0,0)}ns(o.rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5)};var DA=[],VA=(t,e,n,s)=>{Y(t.transform.rotation,-t.pushBack[1]*2,t.entity.rot,t.pushBack[0]*2)};var LA=[0,2,3,16],qA=(t,e,n,s)=>{let o=t.body[0],i=t.body[2],r=t.body[3],l=25/i.scale[0],a=n+t.entity.id;if(Y(o.rotation,Math.sin(a*l/8)*.15,0,Math.sin(a*l/10)*.07),ns(o.rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5),Y(o.position,0,1+Math.sin(a*18)*.1,0),t.body[16]!==void 0){let f=t.body[16];f.position[1]=f.data.skin.pos[1]+Math.sin(a*18+2.75)*.1}let c=Math.sin(a*l)*.7;for(let f=0;f<2;++f){let u=f==0,m=u?i:r;m.rotation[2]=m.data.skin.rot[2]+(u?Math.PI-c:c)}if(t.currentAnim&&t.currentAnim.info.movement===0){let f=t.currentAnim.fract,u=Math.sin(Ki(f,.2,-.4)*3.14)*1.5;if(o.position[2]+=u,o.rotation[0]+=u*.4,f>.65){let m=Jt.easeOutQuad(yo(f,.65,1,0,1));o.rotation[0]-=m*Math.PI*2,o.position[1]+=Math.sin(m*Math.PI)*1.5}}};var RA=[0,2,3],zA=(t,e,n,s)=>{for(let o=0;o<2;++o){let i=t.body[2+o];i.position[1]*=.8,i.position[2]*=.8,i.position[1]+=.5;let r=t.body[4+o];r.position[1]-=0,r.position[0]+=o?.4:-.4}Y(t.body[0].scale,1.8,2,1.8),t.body[0].position[1]+=1};var BA=[2],$A=(t,e,n,s)=>{Y(t.body[2].position,-.8,-.2,.7),Y(t.body[2].rotation,1.8+t.cycleSin*.1,0,0)};var UA=[17,0,16,21,2,3,4,5],OA=(t,e,n,s)=>{let o=t.body[4].scale[1];t.currentAnim&&t.currentAnim.info.movement===0?lB(t,o):oB(t,o)},oB=(t,e)=>{let n=yo(t.entity.speed/20/(.2+t.entity.size*.8),3,10,0,1),s=yo(n,0,1,.6,.4),o=yo(n,0,1,.5,.2);t.speedMultiplier=yo(n,0,1,1,.5),iB(t,o,s,e),rB(t,o,s,e)},iB=(t,e,n,s)=>{let o=0,i=0,r=0,l=0,a=0,c=0,f=0,u=yo(e,.2,.5,.5,1);t.walking?(o=Math.sin(t.cycleRad*2-1)*.07,r=Math.sin(t.cycleRad*2)*.07,i=-t.cycle(0)*.1*u,a=Math.sin(t.cycleRad*2+n)*.05,l=-t.cycle(n)*.07*u,c=t.cycle(n+.2)*.3,f=0):(o=t.cycle(.3)*.03,r=t.cycle(.35)*.02,a=t.cycle(0)*.02-.05,c=Math.sin(t.cycleRad*2)*.07,f=t.cycle(.3)*.1);let m=t.body[17];Y(m.position,0,s*.8+o-.15,1.2),Y(m.rotation,.1,f,0);let g=t.body[0];Y(g.position,0,s*.7+r-.15,.5),Y(g.rotation,-.06,i*1.3,i);let v=t.body[16];Y(v.position,0,s*.75+a-.15,-.35),Y(v.rotation,.04,l*1.3,l);let _=t.body[21];Y(_.position,-c*.35,-.18+o*.5,-.67),Y(_.rotation,.6,c,0)},rB=(t,e,n,s)=>{let o=[2,3,4,5];for(let i=0;i<4;++i){let r=o[i],l=t.body[r],a=i%2==0,c=i<2,f=-.75+s*.5,u=c?.8:-.6,m=c?.35:.26,g=t.entity.steer[1]<0?-.5:1;if(t.walking){let v=(a?0:e)+(c?0:n),_=t.cycleScaled(v,g),b=Math.max(0,t.cycleScaled(v-Math.PI,g)*.3);u-=_*.4,Y(l.rotation,_,0,0),Y(l.position,a?-m:m,f+b,u)}else Y(l.rotation,0,a?-.2:.2,0),Y(l.position,a?-m:m,f,u)}},lB=(t,e)=>{let n=t.currentAnim.fract,s=Math.sin(Ki(n,.2,-.4)*3.14)*1.5,o=[2,3,4,5];for(let f=0;f<4;++f){let u=o[f],m=t.body[u],g=f%2==0,v=f<2,_=-.75+e*.5,b=(v?.8:-.6)+s*.2,k=v?.35:.26;Y(m.rotation,s*.5,0,0),Y(m.position,g?-k:k,_,b)}let i=t.body[17];Y(i.position,0,.8*e-.15,1.2+s*.4),Y(i.rotation,s*.4,0,Math.sin(s*3)*.5);let r=t.body[0];Y(r.position,0,.7*e-.15,.5+s*.4),Y(r.rotation,-.06,0,0);let l=t.body[16];Y(l.position,0,.75*e-.15,-.35+s*.4),Y(l.rotation,.04,0,0);let a=t.body[21],c=Math.max(s,0);Y(a.position,0,-.18*.5+c*.3,-.67),Y(a.rotation,.6+c,0,0)};var NA=[2,3,4,5],jA=[[-.6,-.5,.5],[.6,-.5,.5],[-.6,-.5,-.5],[.6,-.5,-.5]],WA=[2,3,4,5,0,16,21,17,19,20],GA=(t,e,n,s)=>{let o=t.body[4].scale[1];t.currentAnim&&t.currentAnim.info.movement===0?cB(t,o):fB(t,o)},cB=(t,e)=>{dB(t,e),hB(t,e),gB(t,e)},fB=(t,e)=>{t.speedMultiplier=.8,uB(t,e),mB(t,e),pB(t,e)},uB=(t,e)=>{let n=t.body[0],s=t.body[16],o=t.body[21],i=e-.9+n.scale[1]*.5;if(t.walking){let r=t.cycle(0)*.2;n.position[1]=i+Math.sin(t.cycleRad*2)*.05,s.position[1]=i+Math.sin(t.cycleRad*2+.5)*.05,Y(n.rotation,0,r,0),Y(s.rotation,0,-r,0),o&&(o.position[1]=o.data.skin.pos[1]+i+Math.sin(t.cycleRad*2)*.05)}else n.position[1]=i,s.position[1]=i,Y(n.rotation,0,0,0),Y(s.rotation,0,0,0),o&&(o.position[1]=o.data.skin.pos[1]+i+Math.sin(t.cycleRad)*.05);n.matrixNeedsUpdate=!0,s.matrixNeedsUpdate=!0,di(n),di(s)},mB=(t,e)=>{let n=t.walking?.2:.08,s=t.body[17];s!==void 0&&Y(s.rotation,0,t.cycle(.4)*n,0);let o=t.body[19];o!==void 0&&Y(o.rotation,0,t.cycle(.2)*n,0);let i=t.body[20];i!==void 0&&Y(i.rotation,0,t.cycle(t.walking?.1:.9)*n,0)},pB=(t,e)=>{let n=t.walking,s=n?t.cycle(0)*.5:0,o=n?t.cycle(.25)*.5:0,i=n?t.cycle(.75)*.5:0,r=t.entity.steer[1]<0?-.5:1;for(let l=0;l<4;++l){let a=NA[l],c=t.body[a],f=l%2==0,u=l<2,m=t.body[u?0:16],g=jA[l];Ps(c.position,g,m.matrix);let v=0,_=0;f&&u||!u&&!f?(v=o,_=s):(v=i,_=-s),c.position[1]+=Math.max(0,v*.5),c.position[2]+=_*r*.4,c.rotation[0]=-_*r}},dB=(t,e)=>{let n=t.currentAnim.fract,s=Math.sin(Ki(n,.2,-.4)*3.14)*1.5,o=t.body[0],i=t.body[16],r=t.body[21],l=e-1+o.scale[1]*.5;Y(o.position,0,l,o.data.skin.pos[2]+s*.4),Y(o.rotation,0,s*.2,0),Y(i.position,0,l,i.data.skin.pos[2]+s*.4),Y(i.rotation,0,-s*.2,0),r!==void 0&&(Y(r.position,0,r.data.skin.pos[1]+l,r.data.skin.pos[2]+s*.4),Y(r.rotation,0,0,0)),o.matrixNeedsUpdate=!0,i.matrixNeedsUpdate=!0,di(o),di(i)},hB=(t,e)=>{let n=t.currentAnim.fract,s=Math.sin(Ki(n,.2,-.4)*3.14)*1.5,o=t.body[17];o!==void 0&&Y(o.rotation,s*.4,0,Math.sin(s*3)*.5);let i=t.body[19];i!==void 0&&Y(i.rotation,0,s*.5,0);let r=t.body[20];r!==void 0&&Y(r.rotation,0,s*.5,0)},gB=(t,e)=>{let n=t.currentAnim.fract,s=Math.sin(Ki(n,.2,-.4)*3.14)*1.5;for(let o=0;o<4;++o){let i=NA[o],r=t.body[i],l=o<2,a=t.body[l?0:16],c=jA[o];Ps(r.position,c,a.matrix),Y(r.rotation,s*.5,0,0)}};var HA=[18,3],YA=(t,e,n,s)=>{Y(t.body[18].rotation,0,0,n*.3),Y(t.body[3].position,.8,-.2,.7),Y(t.body[3].rotation,1.8,0,0)};var P0=[5,4,0,2,3],A0=(t,e,n,s)=>{ns(t.body[0].rotation,(Math.sin(n*1.8)*Math.cos(n*12)*.3+Math.sin(n*1.4)*.3)*.1-.2,(Math.sin(n*1.3)+Math.sin(n*2.4)*.6)*.15,(Math.sin(n*.2)+Math.sin(n*1.9)*.5)*.2);for(let o=0;o<=1;++o){let i=t.body[2+o];i.visible&&ns(i.rotation,(Math.sin(n*2)*Math.cos(n*9)+Math.sin(n*1.3))*.2,(Math.sin(n*2-2)*Math.cos(n*7)+Math.sin(n*.8))*.3,0);let r=t.body[4+o];r.visible&&(r.rotation[1]+=Math.sin(n*.2-o)*.3,r.position[0]+=o?.15:-.15)}};var XA=[2],QA=(t,e,n,s)=>{t.body[2].position[2]+=.6,ns(t.body[2].rotation,-2.1,-4.1,-.2)};var ZA=[2,3,0],JA=(t,e,n,s)=>{if(t.currentAnim===void 0||t.currentAnim.info.movement===0)for(let o=0;o<2;++o){let i=t.body[2+o],r=Math.sin(n*4+o);Y(i.position,o?.5:-.5,r*.2,1),Y(i.rotation,0,1.5,-r*.2)}ns(t.body[0].rotation,(Math.sin(n*1.8)*Math.cos(n*2)*.3+Math.sin(n*1.4)*.3)*.1+.2,(Math.sin(n*1.3)+Math.sin(n*2.4)*.6)*.1,(Math.sin(n*.4)+Math.sin(n*1.9)*.5)*.1)};var KA=[[Hs,G2],[Hs,CA],[PA],[Hs,TA],[IA],[VA],[Hs,zA],[Hs],[],[Hs,$A],[Hs,YA],[Hs,A0],[Hs,G2,A0],[Hs,A0],[Hs,QA],[Hs,JA],[OA],[GA],[qA]],eT=[new Set([...Gs,...W2]),new Set([...Gs,...FA]),new Set([...SA]),new Set([...Gs,...AA]),new Set([...EA]),new Set([...DA]),new Set([...Gs,...RA]),new Set([...Gs]),new Set,new Set([...Gs,...BA]),new Set([...Gs,...HA]),new Set([...Gs,...P0]),new Set([...Gs,...W2,...P0]),new Set([...Gs,...P0]),new Set([...Gs,...XA]),new Set([...Gs,...ZA]),new Set([...UA]),new Set([...WA]),new Set([...LA])];var Cc=class{constructor(e){this.transform=on(),this.transform.matrixAutoUpdate=!0,this.soundPrio=e.radius>3?1:0,this.doesYell=e.type!==0,this.entity=e,this.cycleOne=0,this.cycleRad=Kt(0,1),this.cycleSin=0,this.speed=1,this.speedMultiplier=1,this.lastFlags=0,this.deathTimer=new kt(0,0),this.hurtSoundTimer=new kt(0,5),this.pushBack=[0,0],this.pushBackVel=[0,0],this.pushBackOffset=[0,0],this.movementPushback=[0,0,0],this.movementPushbackVel=[0,0,0],this.groundNormal=[0,0,0],this.cDist=1/0,this.cDistLast=1/0,this.inFog=!0,this.animQueue=[],this.currentAnim=void 0,this.eyesBlink=0,this.capeoffset=0,this.walking=!0,this.falling=!1,this.hasDied=!1,this.flip=0,this.hasJustJumped=!1,this.hasJustLanded=!0,this.sheathed=!1,this.interiorlight=[0,0,0,0],this.needsColorUpdate=!1,this.colors=new Set,this.alphas=new Set,this.currentAlpha=0,this.goalAlpha=1,this.body=[],this.meshes=[],this.effects=[],this.skin=void 0,this.soundset=void 0,this.stepset=void 0,this.skeleton=void 0,this.animset=void 0,this.colPrim=void 0,this.colSec=void 0}setSkin(e,n,s){this.skin!==void 0&&(this.removeSkin(),this.cDistLast=0,this.hasDied=!1,this.deathTimer.reset(0,0),this.removeColor(Rn.death)),this.skin=wh.get(e);let o=yh.get(this.skin.soundset);this.soundset=o.sounds,this.stepset=kh.get(o.steps).steps,this.skeleton=Mh.get(this.skin.skeleton),this.animset=KA[this.skin.animset],this.colPrim=n||this.skin.colPrim,this.colSec=s||this.skin.colSec;let i=eT[this.skin.animset];for(let r=0;r<this.skin.body.length;++r){let l=this.skin.body[r],a=l.col;l.colMode===1?a=this.colPrim:l.colMode===2&&(a=this.colSec);let c=this.mesh(l.bid,l.pid,i.has(l.bid),l.mid,l.lod,a,l.ts===1);c&&(ot(c.position,l.pos),ot(c.scale,l.scl),ot(c.rotation,l.rot),c.data.skin=l)}for(let r=0;r<this.skin.effects.length;++r){let l=this.skin.effects[r];this.effects.push(Us(l.id,this.body[l.bid],0,!1))}}removeSkin(){this.clearAnims(),this.clearMeshes(),this.clearEffects()}cycle(e){return e==0?this.cycleSin:Math.sin(this.cycleRad+2*e*Math.PI)}cycleScaled(e,n){return Math.sin(this.cycleRad*Math.sign(n)+2*e*Math.PI)*n}checkCycleReset(){let e=this.falling<<1|(!this.falling&&this.walking)<<2;e!=this.lastFlags&&(this.cycleOne=0,this.lastFlags=e)}addPushBack(e,n,s){this.cDist<50&&(this.pushBackVel[0]-=e*s/this.entity.size,this.pushBackVel[1]-=n*s/this.entity.size)}addRandomPushback(e){this.cDist<50&&(this.pushBackVel[0]-=Kt(-1,1)*e/this.entity.size,this.pushBackVel[1]-=Kt(-1,1)*e/this.entity.size)}tickPushBack(e,n,s){this.cDist<50&&(hh(this.pushBackVel,this.pushBackVel,this.pushBack,-e*1500/this.entity.size),Df(this.pushBackVel,this.pushBackVel,1-e*30),hh(this.pushBack,this.pushBack,this.pushBackVel,e),Q3(this.pushBackOffset,this.pushBack,-this.entity.rot)),this.cDist<25&&(sn(this.movementPushback,this.movementPushback,this.movementPushbackVel,e*60),sn(this.movementPushbackVel,this.movementPushbackVel,this.movementPushbackVel,-(e*20)),sn(this.movementPushbackVel,this.movementPushbackVel,this.movementPushback,-(e*10)),this.movementPushbackVel[2]+=this.entity.steer[1]*.01,this.movementPushbackVel[0]-=this.entity.steer[0]*.01)}disableVis(e){for(let n=0,s=e.children.length;n<s;++n){let o=e.children[n];o.visible=!1,this.disableVis(o)}}checkVis(e,n,s){for(let o=0,i=e.children.length;o<i;++o){let r=e.children[o];this.meshes.indexOf(r)<0||(r.visible=r.data.lod*n/this.cDist>s,r.visible?this.checkVis(r,n,s):this.disableVis(r))}}updateVisibility(){let e=this.entity.mount!==void 0?1/0:Math.max(60,Math.min(150,ht.far*.7));return this.cDist=Rr(this.transform.position,ht.worldPosition),this.inFog=this.cDist>e,!this.inFog&&(!fe.disableoffscreen||U1(ht,this.entity.visualPosition,this.transform.scale[1]))?(!this.hasDied&&Math.abs(this.cDistLast-this.cDist)>1&&(this.cDistLast=this.cDist,this.checkVis(this.transform,Math.max(1,this.transform.scale[1]),1.5/(45+e))),this.transform.visible=!0,!0):(this.cDistLast=0,this.transform.visible&&(this.transform.visible=!1,this.meshes.forEach(n=>n.visible=!1),this.clearAnims()),!1)}tick(e,n,s){this.updateVisibility()?(this.needsColorUpdate&&this.colorUpdate(),this.alphaUpdate(e),this.entity.stats===void 0||this.entity.stats.alive?this.entity.buffs.visualFreeze===0&&(this.cycleOne=(this.cycleOne+this.speed*e)%1,this.cycleRad=this.cycleOne*Math.PI*2,this.cycleSin=Math.sin(this.cycleRad),this.tickAnimations(e),this.falling=this.entity.inWater<this.entity.radius&&(this.falling&&!this.entity.onGround||!this.falling&&!this.entity.onGround&&Math.abs(this.entity.vel[1])>6),this.walking=this.entity.steer[0]!=0||this.entity.steer[1]!=0,this.tickVisuals(e,n,s)):this.tickDeath(e,n,s),Bt(this.transform,!1)):this.alphaUpdate(100)}tickVisuals(e,n,s){this.checkCycleReset(),this.calculateCycleSpeed(),this.body[1]!==void 0&&this.tickEyes(e,this.body[1]),this.body[10]!==void 0&&this.tickCape(e,this.body[10]),this.tickWalking(e),this.tickLanding();for(let o=0;o<this.animset.length;++o)this.animset[o](this,e,n,s);if(this.skeleton.groundNormal||this.entity.mount&&this.entity.mount.skeleton.groundNormal){let o=Math.min(1,e*10);this.groundNormal[0]+=(this.entity.groundNormal[0]-this.groundNormal[0])*o,this.groundNormal[2]+=(this.entity.groundNormal[2]-this.groundNormal[2])*o,Yp(this.transform.rotation,this.groundNormal)}else this.flip||(this.transform.rotation[0]=this.transform.rotation[2]=0)}tickFixed(e,n,s){this.hasDied||this.tickPushBack(e,n,s)}tickAnimations(e){let n=this.currentAnim=this.animQueue[0];if(n){let s=n.info,o=n.fract;if(this.animQueue.length>1&&s.priority===0?n.fract>.6?n.time+=e*5:n.time=n.info.duration:n.time+=e,n.fract=n.time/s.duration,n.time>s.duration)if(n.loop)n.fract%=1,n.time=0;else{n.fract=1,this.onAnimEnd(n),this.animQueue.shift();return}for(let i=0;i<s.sounds.length;++i){let r=s.sounds[i];r.end>0?n.fract>=r.start&&n.fract<=r.end?n.activeSounds[i]===void 0&&(n.activeSounds[i]=ti(r.id,this.transform,this.soundPrio,!0,1)):n.activeSounds[i]!==void 0&&(n.activeSounds[i].stop(),n.activeSounds[i]=void 0):n.fract>=r.start&&(o<r.start||r.start===0&&o===0)&&(n.id===4&&r.id===50?ti(this.soundset[4],this.transform,this.soundPrio,!1,1):ti(r.id,this.transform,this.soundPrio,!1,1))}for(let i=0;i<s.effects.length;++i){let r=s.effects[i];if(r.type===0&&n.fract>r.start&&o<=r.start){let l,a=!1;if(r.body===99){let c=I.entity(n.dirImpactTarget);c&&c.visual&&(l=on(),Lm(l,c.visual.transform,this.transform,c.radius),Bt(l,!1),c.visual.addPushBack(this.transform.position[0]-c.visual.transform.position[0],this.transform.position[2]-c.visual.transform.position[2],2)),a=!0}else r.body===101?(l=on(),ot(l.position,this.transform.position),ot(l.scale,this.transform.scale),ot(l.rotation,this.transform.rotation),Bt(l,!1),a=!0):l=r.body===100?this.transform:this.body[r.body];if(l===void 0)continue;Ao(r.id,l,this.soundPrio,a)}else if(r.type>0)if(n.fract>=r.start&&n.fract<=r.end)if(n.activeEffects[i]===void 0){let l=r.body===100?this.transform:this.body[r.body];l&&(n.activeEffects[i]=r.type===1?Us(r.id,l,this.soundPrio,!1):a8(r.id,l,this.soundPrio,!1))}else{let l=n.activeEffects[i];r.type===1||(l.fractionLast=l.fractionNow,l.fractionNow=Math.min(1,Math.max(0,1-(r.end-n.fract)/(r.end-r.start))))}else n.activeEffects[i]!==void 0&&(n.activeEffects[i].done=!0,n.activeEffects[i]=void 0)}}}tickEyes(e,n){if(n.visible){let s=0;this.eyesBlink>0?s=this.eyesBlink-e:Math.random()<.006?s=.1:s=this.eyesBlink,(this.eyesBlink>0&&s<0||s>0&&this.eyesBlink<0)&&(n.scale[1]=s>0?.1:n.scale[0],n.matrixNeedsUpdate=!0),this.eyesBlink=s}}tickCape(e,n){n.visible&&this.skin.capeswing&&((this.entity.steer[1]>0||this.falling)&&(this.capeoffset+=ds(this.entity.vel)*.5*e),this.capeoffset=Math.max(0,Math.min(2,this.capeoffset*(1-e*3))),Y(n.rotation,this.capeoffset,0,0))}tickLanding(){this.entity.inWater>this.entity.radius||(this.hasJustJumped&&this.entity.onGround&&(this.cDist<20&&this.entity.vel[1]<-4&&(this.soundPrio===1&&this.playSound(56,!0),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.15,this.eyesBlink=.3),this.hasJustLanded=!0,this.hasJustJumped=!1,this.flip=0),this.hasJustLanded&&!this.entity.onGround&&(this.entity.vel[1]>5&&(this.soundPrio===1&&this.playSound(57,!0),Math.random()<.5&&(this.flip=this.entity.steer[1]),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.1,this.eyesBlink=.3),this.hasJustJumped=!0,this.hasJustLanded=!1))}tickWalking(e){if((this.cDist<20||this.transform.scale[1]>2)&&!this.falling){let n=this.transform.scale[1]>2||this.body[0].scale[1]>2,s=this.fraction(.2,e),o=this.fraction(.7,e);if(this.entity.inWater>0){if(this.entity.inWater<this.entity.radius*2)this.walking?this.entity.inWater<this.entity.radius?(s||o)&&(this.playSound(n?55:this.entity.inWater>this.entity.radius/2?127:128,!1),this.watersplash(92)):(s||o)&&(s&&this.playSound(129,!1),this.watersplash(93)):(s||o)&&this.watersplash(93);else if(this.entity.inWater>3&&(s||o)&&Math.random()<.5){let i=this.transform.position;si(153,void 0,i[0],i[1],i[2],0,0,0,!1)}}else this.walking&&(n||this.soundPrio===1)&&(s||o)&&this.playSound(n?55:this.stepset[0],!n)}}calculateCycleSpeed(){this.falling?this.speed=1.5:this.walking?this.entity.inWater<this.entity.radius?this.speed=this.entity.speed/20*(this.entity.steer[1]===-1?1.3:1)*.45/(.4+this.entity.size*.6):this.speed=this.entity.speed/20*.2:this.speed=.5,this.speed*=this.speedMultiplier}fraction(e,n,s=this.cycleOne){return s>=e&&s-this.speed*n<e}mesh(e,n,s,o,i,r,l=!1){let a=oi(o,l,!0,!1);if(a.data.lod=i,VS(a.data.multi,a,"interiorlight",this.interiorlight),a.visible=!1,a.matrixAutoUpdate=s,r!==void 0&&this.changeMeshBaseColor(a,r),a.data.basealpha=1,a.data.alpha[0]=this.currentAlpha,n>=0){if(!this.body[n])return;Cn(a,this.body[n]),a.parent.data.lod=Math.max(i,a.parent.data.lod||1)}else n===-1&&Cn(a,this.transform);return this.meshes.push(a),this.body[e]=a,a}removeMesh(e){let n=this.body[e];n!==void 0&&(Po(n.data.multi,n),this.meshes.splice(this.meshes.indexOf(n),1),this.body[e]=void 0)}clearMeshes(){for(let e=0;e<this.meshes.length;++e){let n=this.meshes[e];Po(n.data.multi,n)}this.meshes.length=0,this.body.length=0}clearEffects(){for(let e=0;e<this.effects.length;++e){let n=this.effects[e];n.done=!0}this.effects.length=0}onRemove(){this.removeSkin(),vo(this.transform)}anim(e,n,s){if(this.transform.visible&&this.animQueue.length<=2){let o=Bf.get(e),i={id:e,info:o,loop:n,dirImpactTarget:s,activeSounds:[],activeEffects:[],time:0,fract:0};this.animQueue.push(i)}}clearAnims(){for(let e=0;e<this.animQueue.length;++e)this.onAnimEnd(this.animQueue[e]);this.animQueue.length=0}onAnimEnd(e){for(let n=0;n<e.activeEffects.length;++n){let s=e.activeEffects[n];s&&(s.done=!0)}e.activeEffects.length=0;for(let n=0;n<e.activeSounds.length;++n){let s=e.activeSounds[n];s&&s.stop()}e.activeSounds.length=0}playSound(e,n){return e===0||this.inFog?!1:(ti(e,this.transform,this.soundPrio,!1,n?this.getAudioPitch():1),!0)}onHurt(e){(e>.2||this.hurtSoundTimer.done(I.time))&&this.playSound(this.soundset[1],!0)&&this.hurtSoundTimer.reset(I.time)}onYell(){this.doesYell&&Kt(0,1)<.3&&this.playSound(this.soundset[0],!0)}onAggro(){this.playSound(this.soundset[3],!0)}onDeath(){this.hasDied=!0,this.playSound(this.soundset[2],!0),this.body[1]&&this.removeMesh(1),this.addColor(Rn.death),this.deathTimer.reset(I.time,3);let e=this.meshes.length;for(;e--;){let n=this.meshes[e];n.data.deathSize=(n.geometry.bounds.initiated?n.geometry.bounds.radius:1)*(n.scale[0]+n.scale[1]+n.scale[2])/3,Cn(n,null),ga(n.position,n.worldMatrix),E_(n.scale,n.worldMatrix),Am(n.quaternion,n.worldMatrix),n.data.deathVel=[Kt(-.5,.5),1,Kt(-.5,.5)],n.matrixAutoUpdate=!0}}tickDeath(e,n,s){this.deathTimer.done(n)?(this.clearMeshes(),this.clearEffects()):this.meshes.forEach(o=>{if(!o.visible||o.data.deathVel===void 0)return;let i=o.data.deathVel,r=o.data.deathSize;sn(o.position,o.position,i,e),gn(i,i,1-e*3);let l=s.getHeight(o.position[0],o.position[2])+r*.5;i[1]<0&&o.position[1]<l?i[1]<-1?(i[1]=Math.abs(i[1])*.7,i[0]+=Kt(-1,1)/r,i[2]+=Kt(-1,1)/r):i[1]=-.5:i[1]-=e*50,Js(_t,i,[0,1,0]),sn(o.rotation,o.rotation,_t,-e*5),Bt(o,!1)})}mountPosition(e){Ps(e,this.skin.mountPos,this.body[this.skin.mountPart].worldMatrix)}getAudioPitch(){return Math.max(.6,Math.min(1,.5/this.entity.radius))}getTopAbsolute(){return this.entity.radius*this.skeleton.height}addColor(e){this.colors.add(e),this.needsColorUpdate=!0}removeColor(e){this.colors.delete(e),this.needsColorUpdate=!0}colorUpdate(){this.needsColorUpdate=!1;for(let e=0;e<this.meshes.length;++e)this.updateMeshColor(this.meshes[e])}changeMeshBaseColor(e,n){e.data.basecolor=n,this.updateMeshColor(e)}updateMeshColor(e){let n=e.data.color;$r(n,e.data.basecolor),this.colors.forEach(s=>{let o=s[3],i=1-o;n[0]=n[0]*i+s[0]*o,n[1]=n[1]*i+s[1]*o,n[2]=n[2]*i+s[2]*o})}addAlpha(e){this.alphas.add(e),this.updateGoalAlpha()}removeAlpha(e){this.alphas.delete(e),this.updateGoalAlpha()}updateGoalAlpha(){this.goalAlpha=1,this.alphas.forEach(e=>{this.goalAlpha=Math.min(this.goalAlpha,e)})}alphaUpdate(e){if(this.currentAlpha!==this.goalAlpha){Math.abs(this.goalAlpha-this.currentAlpha)<.1?this.currentAlpha=this.goalAlpha:(e=Math.min(e,2),this.currentAlpha<this.goalAlpha?this.currentAlpha=Math.min(this.goalAlpha,this.currentAlpha+e*.5):this.currentAlpha=Math.max(this.goalAlpha,this.currentAlpha-e*.5));for(let n=0;n<this.meshes.length;++n){let s=this.meshes[n];s.data.alpha[0]=s.data.basealpha*this.currentAlpha}}}changeMeshBaseAlpha(e,n){e.data.basealpha=n}setShoulders(e,n=1,s=!1){if(!(this.hasDied||!this.skeleton.shoulders)){if(e===!1){for(let o=8;o<=9;++o)this.removeMesh(o);for(let o=14;o<=15;++o)this.body[o]&&this.removeMesh(o)}else for(let o=0;o<=1;++o)if(!this.body[8+o]){let i=this.mesh(8+o,0,!0,1,.6);Y(i.position,o?.5:-.5,-.4+n*.4,-.05),Y(i.scale,.8*n,.5*n,.5*n),this.changeMeshBaseColor(i,e)}if(s!==!1)for(let o=0;o<=1;++o){this.body[14+o]||this.mesh(14+o,8+o,!1,7,.3);let i=this.body[14+o];Y(i.rotation,0,3.14,0),Y(i.position,o?.2:-.2,0,-.5),Y(i.scale,.35,.55,.2),this.changeMeshBaseColor(i,s)}else for(let o=14;o<=15;++o)this.body[o]&&this.removeMesh(o)}}setCape(e,n){if(!(this.hasDied||!this.skeleton.cape))if(e===!1)this.body[10]!==void 0&&this.removeMesh(10);else{if(this.body[10]===void 0){let s=this.mesh(10,0,!0,8,.7);Y(s.position,0,.2,-.55)}Y(this.body[10].scale,n,n,n),this.changeMeshBaseColor(this.body[10],e)}}setHeadgear(e){this.hasDied||!this.skeleton.helmet||(e===!1?this.body[11]!==void 0&&this.removeMesh(11):(this.body[11]===void 0&&this.mesh(11,0,!1,9,.5),this.changeMeshBaseColor(this.body[11],e)))}setGem(e,n=1){if(!(this.hasDied||!this.skeleton.helmet))if(e===!1)this.body[12]!==void 0&&this.removeMesh(12);else{if(this.body[12]===void 0){let s=this.mesh(12,0,!1,7,.5);Y(s.position,0,.4,.54),Y(s.scale,.3*n,.3*n,.08*n)}this.changeMeshBaseColor(this.body[12],e)}}setCrown(e){this.hasDied||!this.skeleton.helmet||(e===!1?this.body[13]!==void 0&&this.removeMesh(13):(this.body[13]===void 0&&(this.mesh(13,0,!1,10,.8),this.body[13].position[1]=.8),this.changeMeshBaseColor(this.body[13],e)))}watersplash(e){let n=on();ot(n.position,this.entity.pos),n.position[1]=this.entity.pos[1]+this.entity.inWater+.05,Bt(n),Ao(e,n,this.soundPrio,!0)}};var T0=class extends S0{constructor(e){super(e),this.stickEffects=new Map,this.effects=new Set,this.visualFreeze=0,this.visualIncapacitate=0}addEffectBuff(e,n,s){if(n.logic.fx.stick&&(!(n.logic.incapacitated||n.logic.tags.has(4))||this.immuneCC.size<=0)&&!this.stickEffects.has(e)){let o=Us(n.logic.fx.stick,this.entity.visual.transform,this.entity.id===I.playerId||n.caster===I.playerId?1:0,!1);this.stickEffects.set(e,o)}if(!this.effects.has(e))n.logic.fx.visual&&this.entity.visual.skin.id!==n.logic.fx.visual&&this.changeEntityVisual(n.logic.fx.visual),n.logic.fx.mount&&this.changeEntityMount(n.logic.fx.mount(n)),n.logic.fx.color&&this.entity.visual.addColor(n.logic.fx.color),n.logic.fx.alpha&&this.entity.visual.addAlpha(n.logic.fx.alpha),n.logic.fx.anim&&(this.entity.visual.clearAnims(),this.entity.visual.anim(n.logic.fx.anim,!0,0)),this.visualFreeze+=n.visualFreeze,this.visualIncapacitate+=n.visualIncapacitate,this.effects.add(e);else if(s&&this.stickEffects.has(e)){let o=this.stickEffects.get(e);o.loops=0,o.fractionNow=0}n.logic.fx.apply&&s&&Ao(n.logic.fx.apply,this.entity.visual.transform,this.entity.id===I.playerId||n.caster===I.playerId?1:0,!1)}removeEffectBuff(e,n,s){if(this.stickEffects.has(e)){let o=this.stickEffects.get(e);this.buffs.has(e)||(o.done=!0,this.stickEffects.delete(e))}this.effects.has(e)&&(n.fx.visual&&this.entity.visual.skin.id===n.fx.visual&&this.changeEntityVisual(),n.fx.mount&&this.changeEntityMount(),n.fx.color&&this.entity.visual.removeColor(n.fx.color),n.fx.alpha&&this.entity.visual.removeAlpha(n.fx.alpha),n.fx.anim&&this.entity.visual.clearAnims(),this.visualFreeze-=s.visualFreeze,this.visualIncapacitate-=s.visualIncapacitate,this.effects.delete(e))}setBuff(e,n,s,o,i,r,l,a){let c=super.setBuff(e,n,s,o,i,r);c.data=a,c.visualFreeze=c.visualIncapacitate=0,this.immuneCC.size===0&&(c.logic.fx.frozen&&c.visualFreeze++,c.logic.fx.incapacitated&&c.visualIncapacitate++),this.entity.buffDisplayDirty=!0,this.entity.visual&&this.addEffectBuff(e,c,l)}removeBuff(e,n){let s=super.removeBuff(e,n);s&&(this.entity.buffDisplayDirty=!0,this.removeEffectBuff(e,s.logic,s),s.logic.fx.endSound!==void 0&&I.player!==void 0&&ti(s.logic.fx.endSound,this.entity.visual.transform,this.entity.id===I.playerId||n===I.playerId?1:0,0,1))}changeEntityVisual(e){this.entity.remakeTransform(e),this.stickEffects.forEach((n,s)=>{let o=Us(n.info.id,this.entity.visual.transform,n.priority,!1);o.loops=1,n.done=!0,this.stickEffects.set(s,o)})}changeEntityMount(e){this.entity.mount&&(this.entity.mount.onRemove(),this.entity.mount=void 0,this.entity.updateVisualPosition(0,I.time,I,!0)),e&&(this.entity.mount=new Cc(this.entity),this.entity.mount.setSkin(e),this.entity.updateTransformScale(),this.entity.updateVisualPosition(0,I.time,I,!0),this.entity.updateTransformRotation(.016),this.entity.updateMountRotation(.016))}};var E0=class{constructor(e){this.id=e.id||0,this.type=e.type,this.pos=[0,0,0],this.vel=[0,0,0],this.rot=0,this.radius=0,this.size=0,this.name=e.name,this.setSize(e.size||1)}async init(e){this.name=e.name||""}preFixed(e,n,s){}tickFixed(e,n,s){}postFixed(e,n,s){}preDelta(e,n,s){}tickDelta(e,n,s){}postDelta(e,n,s){}onRemove(){}setPos(e){this.pos[0]=e[0],this.pos[1]=e[1],this.pos[2]=e[2]}setRot(e){this.rot=Ua(e)}onTarget(e){return!0}setName(e){this.name=e}setSize(e){this.size=e,this.radius=e/2}hSquaredDistanceV3(e){let n=e[0]-this.pos[0],s=e[2]-this.pos[2];return n*n+s*s}distanceV2(e){return Ta($n,e,Oa(Ko,this.pos)),Ea($n)}distanceV3(e){return Zt(_t,e,this.pos),ds(_t)}squaredDistanceV2(e){return Ta($n,e,Oa(Ko,this.pos)),X3($n)}squaredDistance(e){return Zt(_t,e,this.pos),Xc(_t)}rotationToV2(e){return Ta($n,e,Oa(Ko,this.pos)),Lp($n,$n),cl($n)}rotationToV3(e){return Zt(_t,e,this.pos),ts(_t,_t),Xp(_t)}};var Ar=class extends E0{constructor(e){super(e),this.hudPos=[0,0,0],this.netDeletion=new kt(0,0)}handleMovementData(e,n){ot(this.pos,e.pos),ot(this.vel,e.vel)}onRemove(){this.visual&&this.visual.onRemove()}};var I0=class{constructor(e){this.entity=e,this.skills=new Map,this.skillIdsLearned=[],this.skillIdsActive=[],this.timedCast=new kt,this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0,this.gcdEnd=0}add(e,n=0,s=0,o){let i=this.skills.get(e);return i=Object.assign(i||{},{level:o!==void 0?o:i?i.level+1:1,logic:At.get(e),cd:new kt(n,s-n),preGcdEnd:0}),this.skills.set(e,i),i}updateSkillsLearned(e){this.skillIdsLearned.length=0,this.skillIdsLearned.push(...e)}remove(e){this.skills.delete(e)}compileActiveSkillIds(){this.skillIdsActive.length=0,this.skills.forEach((e,n)=>{if(!e.logic.engineOnly)for(let s=0;s<e.level;++s)this.skillIdsActive.push(n)})}globalCd(e,n){this.skills.forEach(s=>{!s.logic.auto&&!s.logic.ignoreGcd&&(s.cd.end<e&&(s.cd.start=e),s.cd.end<n&&(s.preGcdEnd=s.cd.end,s.cd.end=n),s.cd.duration=s.cd.end-s.cd.start)}),this.gcdEnd=n}clearGlobalCd(){this.skills.forEach(e=>{!e.logic.auto&&!e.logic.ignoreGcd&&e.cd.end===this.gcdEnd&&(e.cd.end=e.preGcdEnd,e.cd.duration=e.preGcdEnd-e.cd.start)})}startTimedCast(e,n,s,o){this.timedCast.reset(n,o),this.timedSkill=e,this.timedTarget=s,this.entity.steer[0]=0,this.entity.steer[1]=0,this.pvpBoundModifier=At.get(e.id).pvpBoundsAdd}interruptTimedCast(e,n){this.timedCast.reset(0,0),this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0,n&&this.clearGlobalCd()}finishTimedCast(e){return this.interruptTimedCast(!1,!1)}onDeath(){this.interruptTimedCast(!0,!1)}clear(){}hasInstantCast(e){return this.entity.buffs.instantCast.size>0&&Array.from(this.entity.buffs.instantCast).some(n=>n.logic.instantCast.has(e))}};var tT=new Map,D0=class extends I0{constructor(e){super(e)}tick(e,n,s){if(this.isPlayer){let o=this.entity.buffs.incapacitated.size>0;this.skills.forEach((i,r)=>{let l=tT.get(r)||tT.set(r,new Map).get(r),a=new Map,c=0;if(o&&!i.logic.ignoreIncapacitated?c=9:(c=i.logic.can(this.entity,i.level,this.entity.target,!0),(c===3||c===4)&&(c=i.logic.can(this.entity,i.level,this.entity.id,!0))),c!==i.status&&(i.status=c,l.get("status")!==c&&a.set("status",c)),i.cd.done(s.smoothtime))i.cd.icondone||(i.cd.icondone=!0,l.get("cd")!==void 0&&a.set("cd",void 0),l.get("remaining")!==void 0&&a.set("remaining",void 0));else{i.cd.icondone=!1;let f=Math.round(100-i.cd.fraction(s.smoothtime)*100),u;i.cd.duration>1.5&&(u=i.cd.remaining(s.smoothtime),u<=3?u=Math.ceil(u*10)/10:u=Math.ceil(u)),l.get("cd")!==f&&a.set("cd",f),l.get("remaining")!==u&&a.set("remaining",u)}a.size>0&&Oi.update(f=>(a.forEach((u,m)=>{l.set(m,u),f[i.logic.id][m]=u}),f))})}if(this.timedSkill&&this.entity.visual){let o=this.timedSkill.fx;if(o){let i=this.entity.visual.animQueue[0],r=this.timedCast.remaining(n);if(o.animCast){let l=Bf.get(o.animCast);r-=Math.min(.3,l.duration/2)}r>0?o.animChannel&&(!i||o.animChannel!==i.id)&&(this.entity.visual.clearAnims(),this.entity.visual.anim(o.animChannel,!0,0)):o.animCast&&(!i||o.animCast!==i.id)&&(this.entity.visual.clearAnims(),this.entity.visual.anim(o.animCast,!1,0))}}}add(e,n=0,s=0,o){super.add(e,n,s,o),this.isPlayer&&(this.compileActiveSkillIds(),Oi.update(r=>(r[e]={},r)),this.skills.get(e).logic.id<100&&Ni.update(r=>(r.set(e,o),r)))}remove(e){this.isPlayer&&(this.compileActiveSkillIds(),Oi.update(s=>(s[e]=void 0,s)),this.skills.get(e)&&Ni.update(s=>(s.delete(e),s))),super.remove(e)}updateSkillsLearned(e){super.updateSkillsLearned(e),Wc.update(n=>{n.clear();for(let s=0;s<e.length;++s){let o=e[s];n.has(o)||n.set(o,nu(e,o))}return n})}cd(e,n,s){this.skills.get(e).cd.set(n,s)}clearSkillInfo(){Ni.update(e=>(e.clear(),e)),Wc.update(e=>(e.clear(),e))}startTimedCast(e,n,s,o){super.startTimedCast(e,n,s,o),this.entity.uiFrameDirty=!0}interruptTimedCast(e,n){super.interruptTimedCast(e,n),this.entity.uiFrameDirty=!0,e&&this.entity.visual&&this.entity.visual.clearAnims()}};var V0=class extends oc{constructor(e){super(e)}setStat(e,n){this.stat.set(e,n),this.entity.statsDirty=!0,e==20?this.entity.setPrestige(n):e==21?this.entity.setElo(n):e==6||e==7?this.entity.uiFrameDirty=!0:e==19&&this.entity.inventory&&this.entity.inventory.setSize(n)}setResource(e,n){super.setResource(e,n),this.entity.uiFrameDirty=!0}die(){super.die(),this.entity.uiFrameDirty=!0,this.entity.visual&&this.entity.visual.onDeath()}respawn(){super.respawn(),this.entity.uiFrameDirty=!0,this.entity.visual&&this.entity.remakeTransform()}refreshCombatTimer(e,n){super.refreshCombatTimer(e,n),this.entity.uiFrameDirty=!0}onCombatEnd(){super.onCombatEnd(),this.entity.uiFrameDirty=!0}};var L0=class extends Ar{constructor(e){e.creature&&(e.skin=e.creature.skin,e.name=e.creature.name),super(e),this.creatureId=e.creature?e.creature.id:-1,this.stats=new V0(this),this.buffs=new T0(this),this.skills=new D0(this),this.steer=[0,0],this.speed=1,this.static=!1,this.jump=0,this.onGround=!0,this.belowGround=!1,this.inWater=0,this.groundNormal=[0,0,0],this.target=0,this.level=0,this.faction=0,this.posLock=[0,0],this.posLockRadius=0,this.aabb=Pu()}setAABB(){i0(this.aabb,this.pos,this.size,this.size,this.size)}preFixed(e,n,s){super.preFixed(e,n,s),this.buffs.tick(e,n,s),this.stats.tick(e,n),this.skills.tick(e,n,s),this.setSize((this.stats.getStat(31)||100)/100)}getStatBasedMoveSpeed(){return Math.max(Math.min(65534,this.stats.getStat(15)))}postFixed(e,n,s){this.handlePosLock()}handlePosLock(){if(this.posLockRadius>0){Ta(Ko,Oa($n,this.pos),this.posLock);let e=Ea(Ko);if(e>this.posLockRadius){let n=Y3(Ko,this.posLock,Df(Ko,Ko,this.posLockRadius/e));Y(this.pos,n[0],this.pos[1],n[1])}}}hasMovementOverride(){return this.buffs.movementOverride.size>0}buffMovementOverride(e,n,s){this.hasMovementOverride()&&this.buffs.movementOverride.forEach(o=>{o.logic.movementOverride(e,n,s,this,o)})}combatRangeCheck(e,n){let s=this.pos[0]-e.pos[0],o=Math.max(0,Math.abs(this.pos[1]-e.pos[1])-this.size),i=this.pos[2]-e.pos[2];return s*s+o*o+i*i<(n+(e.size+this.size))**2}combatCylinderCheck(e,n,s){return!(this.aabb[1]>e[1]+n||this.aabb[4]<e[1]-n||Math.sqrt((e[0]-this.pos[0])**2+(e[2]-this.pos[2])**2)>s+this.radius)}tickHoles(e){let n=I.getHole(this.pos[0],this.pos[2]),s=this.pos[1]-I.getHeight(this.pos[0],this.pos[2]);return this.belowGround=n&&s<=0,n}horizontalSteer(e,n,s){if(this.stats.alive){this.rot=s;let o=Lp($n,n);n[1]<0&&(o[1]*=.5),Df(o,o,e/20),R_(this.vel,o,s)}else this.vel[0]=0,this.vel[2]=0}setSteer(e,n){this.steer[0]=e,this.steer[1]=n}setJump(e){this.jump=e}setRot(e){super.setRot(e)}setSpeed(e){this.speed=e}setTarget(e){let n=e>0&&this.canTarget(I.getEntityById(e));return n!==!1&&n!==void 0?n.onTarget(this.id):this.target!==(this.target=0)}onTarget(e){let n=I.getEntityById(e);return n.target=this.id,super.onTarget(e)}getTargetEntity(){return I.getEntityById(this.target)}canTarget(e){return e}setFaction(e){this.faction=e}setLevel(e){this.level=e}setClass(e){this.class=e}onRemove(){this.stats.clear(),this.buffs.clearTempBuffs(),this.buffs.clearPassiveBuffs(),this.skills.clear(),super.onRemove()}hostility(e){return e.faction!==this.faction?1:0}canCombatInteract(e){return!0}canSupportInteract(e){return!0}die(e,n,s){}setPosLock(e,n,s){this.posLock[0]=~~e,this.posLock[1]=~~n,this.posLockRadius=~~s}tickWaterCollisions(e){let n=this.inWater;return this.inWater=Math.max(0,e.getWaterHeight(this.pos[0],this.pos[2])-this.pos[1]),!n&&this.inWater>0&&this.vel[1]<-3&&this.onEnterWater(),this.inWater>0}onEnterWater(){}};var ao=class extends L0{constructor(e){super(e),this.uiFrameDirty=!0,this.uiRange=!0,this.buffDisplayDirty=!0,this.visualPosition=[0,0,0],this.speechTimer=new kt(0,5),this.mount=void 0,this.mountRotAdd=0,this.namePlateScale=.5,e.creature&&(e.creature.col1[0]!==0&&(e.colPrim=e.creature.col1),e.creature.col2[0]!==0&&(e.colSec=e.creature.col2)),this.skin=e.skin,this.colPrim=e.colPrim,this.colSec=e.colSec,this.interiorlightTarget=[0,0,0,0],this.interiorlightTimer=new kt(0,.5),this.conciliator=[0,0,0],this.visual=new Cc(this),this.skin>0&&this.remakeTransform()}handleMovementData(e,n){let s=Bn([0,0,0],this.pos,this.conciliator),o=Zt([0,0,0],s,e.pos);Xc(o)>1?(Y(this.conciliator,0,0,0),ot(this.pos,e.pos)):Bn(this.conciliator,this.conciliator,o),ot(this.vel,e.vel)}makeVisual(e,n,s){this.visual.setSkin(e||this.skin,n||this.colPrim,s||this.colSec)}remakeTransform(e,n,s){this.makeVisual(e,n,s),this.updateTransformScale(),this.updateTransformRotation(1),this.updateVisualPosition(0,0,I,!0)}onRemove(){super.onRemove(),this.mount!==void 0&&this.mount.onRemove()}updateVisualPosition(e,n,s,o=!1){e>0&&(sn(this.pos,this.pos,this.conciliator,-e*10),gn(this.conciliator,this.conciliator,1-e*10));let i=ss(this.pos,this.visualPosition);(o||i>1e-5)&&(ot(this.visualPosition,this.pos),this.visualPosition[1]+=this.radius,this.mount===void 0?ot(this.visual.transform.position,this.visualPosition):(ot(this.mount.transform.position,this.visualPosition),this.mount.transform.position[1]+=this.mount.skin.size*.5-this.radius)),this.interiorlightTimer.done(n)&&(this.interiorlightTimer.reset(n),s.getInteriorLight(this.interiorlightTarget,this.aabb));let r=Math.min(1,e),l=this.interiorlightTarget,a=this.visual.interiorlight;a[0]+=Math.sign(l[0]-a[0])*r,a[1]+=Math.sign(l[1]-a[1])*r,a[2]+=Math.sign(l[2]-a[2])*r,a[3]+=Math.sign(l[3]-a[3])*r}updateTransformScale(){hs(this.visual.transform.scale,this.size*.7),this.mount!==void 0&&hs(this.mount.transform.scale,this.mount.skin.size*.7)}updateTransformRotation(e){if(this.stats.alive&&this.buffs.visualFreeze===0){this.updateMountRotation(e);let n=fl(this.rot+this.mountRotAdd,this.visual.transform.rotation[1]);Math.abs(n)>.01&&(this.visual.transform.rotation[1]=Sa(this.visual.transform.rotation[1]-n*Math.min(1,e*20),Math.PI*2))}}updateMountRotation(e){if(this.mount!==void 0){if((this.onGround||this.inWater>0)&&(this.steer[0]!==0||this.steer[1]!==0)){let n=this.steer[0]*1.5;this.steer[1]!=0&&(n*=.5*this.steer[1]),this.mountRotAdd-=(this.mountRotAdd-n)*Math.min(1,e*10)}this.mount.transform.rotation[1]=this.visual.transform.rotation[1]}else this.mountRotAdd=0}postFixed(e,n,s){super.postFixed(e,n,s),this.visual.tickFixed(e,n,s),this.mount!==void 0&&this.mount.tickFixed(e,n,s)}postDelta(e,n,s){super.postDelta(e,n,s),this.updateVisuals(e,n,s),this.updateUiParts(n)}updateVisuals(e,n,s){this.updateTransformRotation(e),this.updateTransformScale(),this.updateVisualPosition(e,n,s),this.mount!==void 0&&(this.mount.tick(e,n,s),this.mount.mountPosition(this.visual.transform.position)),this.visual.tick(e,n,s)}updateUiParts(e){let n=this.id===I.playerId,s=zn===this.id,o=Xt.has(this.name);if(s||o){let i=this.squaredDistance(I.player.pos)<900;i!=this.uiRange&&(this.uiFrameDirty=!0),this.uiRange=i}(this.uiFrameDirty||this.skills.timedSkill!==void 0)&&(s&&this.hydrateUnitStore(Go),n?this.hydrateUnitStore(Wo):o&&this.hydrateUnitStore(Xt.get(this.name).unitStore)),(this.buffDisplayDirty||n||s)&&(s&&this.hydrateBuffStore(n,Nc,fe.buffcountUnitframes),n?this.hydrateBuffStore(n,aa,fe.buffcountUnitframes):(this.buffDisplayDirty||s)&&o&&this.hydrateBuffStore(n,Xt.get(this.name).buffStore,fe.buffcountParty)),this.speechText!==void 0&&this.speechTimer.done(e)&&(this.speechText=void 0)}setTarget(e){let n=this.target,s=super.setTarget(e);if(n!=this.target&&this==I.player&&s){let o=I.getEntityById(e);o?(o.hydrateUnitStore(Go,fe.buffcountUnitframes),o.hydrateBuffStore(!1,Nc,fe.buffcountUnitframes)):Go.update(i=>(i.visible=!1,i))}return s}hydrateUnitStore(e){e.update(n=>(n.visible=!0,n.name=this.name,n.alive=this.stats.alive,n.hp=this.stats.getResource(6),n.hpMax=this.stats.getStat(6),n.mp=this.stats.getResource(7),n.mpMax=this.stats.getStat(7),n.level=this.level,n.class=this.class,n.id=this.id,n.clan=this.clan,n.faction=this.faction,n.party=this.party,n.role=this.partyrole,n.type=this.type,n.combat=!this.stats.combatTimer.done(I.time),n.range=this.uiRange,n.rarity=this.faction===2&&(this.rarity||!1),n.timedSkill=this.skills.timedSkill,n.timedCast=this.skills.timedCast,n)),this.uiFrameDirty=!1}hydrateBuffStore(e,n,s){n.update(o=>xB(o,this.buffs,s,e)),this.buffDisplayDirty=!1}speech(e,n){this.speechText=e,this.speechStyle=n,this.speechTimer.reset(I.time)}},xB=(t,e,n,s)=>{let o=[];e.buffs.forEach((r,l)=>{r.forEach((a,c)=>{!a.logic.passive&&a.logic.icon!==void 0&&(!fe.buffsHideIrrelevant||c===I.playerId||c===e.entity.id&&e.entity.faction===2||e.entity===I.player&&a.logic.type==1)&&(!a.logic.unique||o.reduce((f,u)=>f+(u.id===a.id?1:0),0)===0)&&o.push(a)})});let i=o.sort((r,l)=>l.time-r.time).sort((r,l)=>r.type-l.type).slice(0,n);if(t.length<i.length)for(;t.length<i.length;)t.push(MB());else if(t.length>i.length)for(;t.length>i.length;)FB(t.pop());return i.forEach((r,l)=>{CB(I.smoothtime,r,t[l],s)}),t},wB=0,nT=[],MB=()=>nT.pop()||{id:wB++,icon:"",type:1,time:0,duration:10,stacks:0,cancel:-1},FB=t=>{nT.push(t)},CB=(t,e,n,s)=>{e.logic.customIcon===void 0?n.icon=`/data/${e.logic.icon}.${Yn}?v=8685122`:n.icon=`/data/${e.logic.customIcon(e)}.${Yn}?v=8685122`,n.cancel=s&&e.logic.tags.has(12)?e.logic.id:-1,n.type=e.logic.type,n.time=Math.min(e.timer.duration,e.timer.passed(t)),n.duration=e.timer.duration,n.stacks=e.uniqueInstances>1?e.uniqueInstances:e.stacks};var cs=class extends ao{constructor(e){super(e),this.static=!0,this.interactions=e.interactions,this.interactions.length&&this.setDialogue(this.interactions[0].text,this.interactions[0].choices)}interact(e){this.createInteraction()}createInteraction(){jo.set({title:this.name,text:this.text,choices:this.choices})}setDialogue(e,n){this.text=e,this.choices=n}};var q0=class extends cs{constructor(e){super({type:6,...e})}};var R0=class extends q0{constructor(e){super({...e,...P.npcs.blacksmith})}};var z0=class extends cs{constructor(e){super({type:2,...e})}};var Ys=(t,e)=>{let n=t.length-e,s="",o=e+n;for(;e<o;){let i=t[e++];if(i<128)s+=String.fromCharCode(i);else if(i>191&&i<224){let r=t[e++];s+=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){let r=t[e++],l=t[e++],a=t[e++],c=((i&7)<<18|(r&63)<<12|(l&63)<<6|a&63)-65536;s+=String.fromCharCode(55296+(c>>10)),s+=String.fromCharCode(56320+(c&1023))}else{let r=t[e++],l=t[e++];s+=String.fromCharCode((i&15)<<12|(r&63)<<6|l&63)}}return s};var B0=class extends z0{constructor(e){super({...e,...P.npcs.conjurer})}interact(e){let n=Ys(e,1).split("#");n[0]!==""?this.setDialogue(this.interactions[0].text,Array.from(n,s=>{let o=s.split("~");return this.interactions[0].choices[0].replace("$1",o[0])+(o[1]>0?` (Lv. ${o[1]}+)`:"")})):this.setDialogue(this.interactions[0].text,[]),super.interact(e)}};var $0=class extends Ar{constructor(e){super({type:3,...e}),this.partytimeout=0,this.party=0,this.droptype="",this.tier=0,this.quality=0}partyTimeoutCheck(e){return this.party===0||e.id===this.party||e.party===this.party||I.time>this.partytimeout}canBePickedUpBy(e,n=30){return this.partyTimeoutCheck(e)&&e.stats.alive&&!e.buffs.buffs.has(128,e.id)&&e.squaredDistance(this.pos)<n}};var U0=class extends $0{constructor(e){super(e),this.visual={transform:oi(1561,!1,!1,!0)},this.visual.transform.data.multi.needsUpdate=!1,this.setSize(.2),this.visual.transform.visible=!1,this.uiTimeout=0,this.dirty=!1,this.hasInfo=!1,this.hasPos=!1,this.hasRot=!1,this.color="misc"}postDelta(e,n,s){if(this.visual.transform.visible&&this.dirty){let o=s.getChunkFromWorld(this.pos[0],this.pos[2]);o!==void 0&&o.deserialized&&(this.pos[1]=s.getHeight(this.pos[0],this.pos[2])+Math.random()*.1+.1,this.visual.transform.rotation[1]=Math.random()*Math.PI*2,Yp(this.visual.transform.rotation,s.getNormal(this.pos[0],this.pos[2])),ot(this.visual.transform.position,this.pos),this.visual.transform.data.multi.needsUpdate=!0,Bt(this.visual.transform,!1),this.dirty=!1)}}setDropInfo(e,n,s,o,i){this.hasInfo=!0,this.party=o,this.partytimeout=i,this.droptype=fx[e],this.tier=n,this.quality=s,this.lootquality=s;let r,l;this.droptype=="gold"?(this.name=this.tier+"c",this.setSize(.1),r="gold",this.color="gold",this.quality=100):(r=this.droptype+this.tier,l=ln[r],l&&(this.name=nn(this.droptype,this.tier)),this.droptype!=="misc"&&this.droptype!=="rune"&&this.droptype!=="book"?(this.color=jt(s)[1],fe.itemQualityPercent&&(this.name+=` ${this.quality}%`)):(this.color=this.droptype,this.quality=100,this.droptype==="rune"&&(this.lootquality=90)));let a=l&&l.art||r;$r(this.visual.transform.data.uvshift,Ai[a]),Y(this.visual.transform.scale,Ai[a][0]*20,1,Ai[a][1]*20),this.visual.transform.data.shine[0]=Math.random()*6.1,this.dirty=!0,this.visual.transform.visible=!0}onRemove(){Po(this.visual.transform.data.multi,this.visual.transform),nt.shift.down&&(Mc.add(this),this.uiTimeout=Math.round(I.time/5)*5+10)}};var O0=class extends ao{constructor(e){super({type:7,...e}),this.static=!0,this.class=5}};var N0=class extends O0{};var j0=class extends cs{constructor(e){super({type:12,...e})}};var W0=class extends j0{constructor(e){super({...e,interactions:[]})}};var G0=class extends cs{constructor(e){super({type:4,...e})}};var H0=class extends G0{constructor(e){super({...e,...P.npcs.merchant})}};var Y0=class extends ao{constructor(e){super({type:1,...e}),this.groundHeight=0;let n=Ch.get(e.creature.id);this.aggroMode=n.aggroMode,this.rarity=n.rarity}tickFixed(e,n,s){this.horizontalSteer(this.speed,this.steer,this.rot),super.tickFixed(e,n,s),this.tickHoles(e),this.stats.alive&&(sn(this.pos,this.pos,this.vel,e),this.groundHeight=s.raycastEnvironmentHeight(this.pos[0],this.pos[2],this.pos[1]+1,this.pos[1]-1,this.groundNormal),this.belowGround||(this.groundHeight=Math.max(this.groundHeight,s.getHeight(this.pos[0],this.pos[2])))),this.setAABB(),this.tickWaterCollisions(s),this.inWater>this.radius||(this.pos[1]-=10*e),this.pos[1]=Math.max(this.groundHeight,this.pos[1])}};var X0=class extends Y0{};var Q0=class extends Ar{constructor(e){super({type:11,...e})}};var Z0=class extends Q0{constructor(e){super(e),this.meshId=0,this.scale=0,this.effects=[],this.dirty=!1,this.rot=Math.random()*3.14}postDelta(e,n,s){if(this.dirty){ot(this.mesh.position,this.pos),this.mesh.rotation[1]=this.rot,hs(this.mesh.scale,this.scale),this.mesh.matrixNeedsUpdate=!0,Bt(this.mesh,!0);for(let o=0;o<this.effects.length;++o){let i=this.effects[o];Bt(i.transform,!0)}this.mesh.data.multi&&(this.mesh.data.multi.needsUpdate=!0),this.dirty=!1}}setNodeInfo(e,n){e!==this.meshId&&(this.meshId>0&&this.removeMesh(),this.meshId=e,this.makeMesh(),this.dirty=!0),this.scale!==n&&(this.scale=n,this.dirty=!0)}makeMesh(){let e=Mo.get(this.meshId);e.geometry>0?(this.mesh=oi(this.meshId,!0,!1,!0),os(this.mesh.data.interiorlight,0,0,0,0)):this.mesh=on();for(let n=0;n<e.effects.length;++n){let s=e.effects[n],o=on();ot(o.position,s.pos),ot(o.scale,s.scale),ot(o.rotation,s.rot),Cn(o,this.mesh);let i=Us(s.id,o,0,!0);this.effects.push(i)}}removeMesh(){this.mesh!==void 0&&(this.mesh.data.multi?Po(this.mesh.data.multi,this.mesh):vo(this.mesh)),this.mesh=void 0;for(let e=0;e<this.effects.length;++e)this.effects[e].done=!0;this.effects.length=0}onRemove(){this.removeMesh()}};var J0=class extends ao{constructor(e){super({type:10,...e}),this.groundHeight=0}tickFixed(e,n,s){this.horizontalSteer(this.speed,this.steer,this.rot),super.tickFixed(e,n,s),this.tickHoles(e),this.stats.alive&&(sn(this.pos,this.pos,this.vel,e),this.groundHeight=s.raycastEnvironmentHeight(this.pos[0],this.pos[2],this.pos[1]+1,this.pos[1]-1,this.groundNormal)),this.setAABB(),this.tickWaterCollisions(s),this.inWater>this.radius||(this.pos[1]-=10*e),this.pos[1]=Math.max(this.groundHeight,this.pos[1])}};var K0=class extends J0{};var e1=class extends ao{constructor(e){super({type:0,size:.9,...e}),this.exp=0,this.party=0,this.partyrole=0,this.prestige=0,this.prestigeRank=0,this.elo=0,this.eloRank=0,this.clan=void 0,this.clanRole=0,this.jumpLast=0}tickVelocity(e,n,s,o,i){this.inWater>this.radius?(this.onGround&&(this.vel[1]=Math.max(0,this.vel[1])),this.inWater<this.radius+.1&&(this.jump>0||this.vel[1]===0)?this.vel[1]=this.jumpLast===0&&o>0?7:0:(this.vel[1]+=o?e*8:e*-4,this.vel[1]=Math.max(Math.min(this.vel[1],4),-3)),this.horizontalSteer(i*.5,n,s)):this.onGround?(this.stats.alive&&o>0&&i>0&&(this.vel[1]=9,this.onGround=!1),this.horizontalSteer(i,n,s)):(this.vel[1]=Math.max(-60,this.vel[1]-25*e),this.stats.alive&&this.vel[0]===0&&this.vel[2]===0&&this.horizontalSteer(i*.5,n,s)),this.jumpLast=this.vel[1]<0?this.jumpLast:this.jump}tickMovement(e,n,s,o,i){this.tickVelocity(e,n,s,o,i);let r=this.tickHoles(e);this.setWorldCollAABB(this.vel[0]*e,this.vel[1]*e,this.vel[2]*e);let l=I.triangleGrid.queryAABB(this.aabb),a=[],c=[],f=[];for(let v=0;v<l.length;++v){let _=l[v],b=_[3][1];b>.6?c.push(_):b<-.6?f.push(_):a.push(_)}let u=ds(this.vel)*e,m=Math.floor(Math.max(1,u/.1)),g=e/m;for(let v=0;v<m;++v)this.tickCollisions(g,a,c,f,r);this.setAABB(),this.tickWaterCollisions(I),I.clampV3(this.pos)}setWorldCollAABB(e,n,s){let o=this.aabb,i=this.radius+.5;o[0]=this.pos[0]-Math.min(0,e)-i,o[3]=this.pos[0]+Math.max(0,e)+i,o[1]=this.pos[1]-Math.min(0,n)-i,o[4]=this.pos[1]+Math.max(0,n)+i*2,o[2]=this.pos[2]-Math.min(0,s)-i,o[5]=this.pos[2]+Math.max(0,s)+i}tickCollisions(e,n,s,o,i){let r=[...this.pos];sn(this.pos,this.pos,this.vel,e);let l=this.belowGround||i?0:I.getHeight(this.pos[0],this.pos[2]),a=I.getNormal(this.pos[0],this.pos[2]);this.tickWallCollisions(n,l,a),l=this.belowGround||i?0:I.getHeight(this.pos[0],this.pos[2]),a=I.getNormal(this.pos[0],this.pos[2]),this.tickFloorCollisions(s,l,a),this.tickCeilCollisions(o,r),this.belowGround||(this.pos[1]=Math.max(this.pos[1],I.getHeight(this.pos[0],this.pos[2])))}tickWallCollisions(e,n,s){if(s[1]<.6&&this.pos[1]<n){let c=-(Ay(...this.pos,this.pos[0],n,this.pos[2],...s)+.05);this.pos[0]-=s[0]*c,this.pos[2]-=s[2]*c}let o=this.radius,i=this.radius*1.5,r=this.pos[0],l=this.pos[1]+i,a=this.pos[2];for(let c=0;c<e.length;++c){let f=e[c];if(Hp(f[0],f[1],f[2],r,l,a)){let u=Py(r,l,a,...f[0],...f[3]);if(u<o&&u>-.5){let m=u-o;this.pos[0]-=f[3][0]*m,this.pos[2]-=f[3][2]*m}}}}tickFloorCollisions(e,n,s){let i=this.vel[1]>0||this.inWater>this.radius?0:.1,r=this.radius*1.5,l=1/0,a=!1;for(let f=0;f<e.length;++f){let u=e[f];if(Hp(u[0],u[1],u[2],...this.pos)){let m=Bh(...this.pos,...u[0],...u[3]);m<l&&m<i&&m>-r&&(l=m,a=!0,ot(this.groundNormal,u[3]))}}let c=-(n-this.pos[1]);s[1]>.6&&this.pos[1]<n+i&&c<l&&c<i&&c>-r&&(l=c,a=!0,ot(this.groundNormal,s)),a?(this.pos[1]-=l,this.onGround||(this.onGround=!0,this.onFallLanding(-this.vel[1]),this.vel[1]=Math.max(0,this.vel[1]))):(this.onGround=!1,Y(this.groundNormal,0,1,0))}tickCeilCollisions(e,n){let s=this.radius*1.5;for(let o=0;o<e.length;++o){let i=e[o],r=this.pos[0],l=this.pos[1],a=this.pos[2];if(Hp(i[0],i[1],i[2],r,l,a)){let c=Bh(...this.pos,...i[0],...i[3]);c<0&&c>-s&&(this.pos[1]>=n[1]&&(this.pos[0]=n[0],this.pos[2]=n[2]),this.vel[1]=Math.min(0,this.vel[1]),this.vel[0]=0,this.vel[2]=0)}}}setExp(e){this.exp=e}setParty(e,n){this.party=e,this.partyrole=n}setPrestige(e){return e!==this.prestige?(this.prestige=e,this.prestigeRank=rc(e),!0):!1}setElo(e){return e!==this.elo?(this.elo=e,this.eloRank=Ga(e),!0):!1}setClan(e,n=0){this.clan=e,this.clanRole=n}getNearbyPartyMembers(e){let n=[];return this.stats.alive&&n.push(this),this.party>0&&I.entities.type[0].forEach(s=>{s.party==this.party&&s!=this&&s.stats.alive&&ss(e,s.pos)<1e3&&n.push(s)}),n}hostility(e){return(I.mode.partyBasedHostility===!0?e.party!==this.party:e.faction!==this.faction)?e.type===0?e.stats.stat.get(26)===0&&this.stats.stat.get(26)===0?0:2:1:0}canCombatInteract(e){return e.type===0?e.buffs.buffs.has(128,e.id)?!1:!I.mode.pvpprotect||this.hostility(e)<2?!0:!(this.stats.stat.get(26)===0||e.stats.stat.get(26)===0)&&Math.abs(this.stats.stat.get(26)-e.stats.stat.get(26))<=5+Math.max(this.skills.pvpBoundModifier,e.skills.pvpBoundModifier):e.type===1||e.type===10||e.type===12?e.stats.stat.get(26)>0:!0}canSupportInteract(e){return this.hostility(e)===0&&(!I.mode.pvpprotect||(e.type===0?Math.abs(this.stats.stat.get(26)-e.stats.stat.get(26))<=5:!0))}onFallLanding(e){}};var SB=[1,2,3,4],Rl=class extends e1{constructor(e){e.skin=0,super(e)}tickFixed(e,n,s){super.tickFixed(e,n,s),this.tickMovement(e,this.steer,this.rot,this.jump,this.speed)}setClass(e){e!==this.class&&(super.setClass(e),this.skin=SB[this.class],this.remakeTransform())}makeVisual(e,n){super.makeVisual(e,n),this.prestige>0&&this.setPrestige(this.prestige,!0),this.level>=10&&this.setLevel(this.level),this.elo>1500&&this.setElo(this.elo,!0)}setPrestige(e,n){if(super.setPrestige(e)||n){let s=Math.min(this.prestigeRank,10),o=this.prestigeRank-11;s<1?(this.visual.setCrown(!1),this.visual.setHeadgear(!1)):(this.visual.setHeadgear(o<0?Sg[Math.min(4,s-1)]:Rn.darkgold),s>5?this.visual.setCrown(Sg[s-6]):this.visual.setCrown(!1)),o<0?this.visual.setGem(!1):this.visual.setGem(o4[o],o>0?1:.8)}}setElo(e,n){if(super.setElo(e)||n){let s=Ga(e);this.visual.setShoulders(Pg[Math.min(s,1)],.65+s*.08,s>0&&Pg[s])}}setLevel(e){super.setLevel(e),e>=15?this.visual.setCape(this.faction===0?Rn.vanguard:Rn.bloodlust,e>=25?1:.5):this.visual.setCape(!1)}setParty(e,n){this.uiFrameDirty=!0,this.buffDisplayDirty=!0,super.setParty(e,n)}onEnterWater(){this.visual.playSound(130,!1),this.visual.watersplash(94)}};var t1=class extends cs{constructor(e){super({type:9,...e})}};var n1=class extends t1{constructor(e){super({...e,...P.npcs.sage})}interact(e){this.interactions[0].choices[0]=this.interactions[0].choices[0].replace("$1",I.player.level*10),super.interact(e)}};var s1=class extends cs{constructor(e){super({type:5,...e})}};var o1=class extends s1{constructor(e){super({...e,...P.npcs.stash})}};var i1=class extends cs{constructor(e){super({type:8,...e})}};var r1=class extends i1{constructor(e){super({...e,...P.npcs.trader});let n=Sh.get(e.creature.id);this.items=[],$f.forEach(s=>{if(s.shop===n.shop){let o=new So,i=te();o.hydrate({type:s.type,tier:s.tier,stacks:s.stacks===0?void 0:s.stacks,upgrade:s.upgrade,store:i}),o.buyid=s.id,this.items.push([o,i])}})}};var l1=class{constructor(e){this.entity=e,this.slots=new Map,this.gold=0,this.medals=0,this.size=0,this.firstEmptySlot=0,this.firstEmptySlotDirty=!0,this.setSize(0)}tickFixed(e,n,s){}setSize(e){this.size=Math.min(100,e)}setGold(e){this.gold=e}setMedals(e){this.medals=e}setItem(e,n){let s=new So(n);return this.slots.set(e,s),e===this.firstEmptySlot&&(this.firstEmptySlotDirty=!0),s}removeItem(e){let n=this.slots.get(e);return this.slots.delete(e),(e<this.firstEmptySlot||this.firstEmptySlot===-1)&&(this.firstEmptySlot=e),n}async hydrateItems(e=!1){let n=[],s=[];if(this.slots.forEach((o,i)=>{o.dirty&&(o.dirty=!1,n.push(o.dbid),s.push(i))}),n.length){let o=await this.fetchData(n);this.compareData(o,s,0),this.postHydrate(s,e)}else e&&this.postHydrate(s,e)}hydrate(e){this.slots.has(e.slot)?this.slots.get(e.slot).hydrate(e):console.error("received hydration of unknown item")}postHydrate(e){}compareData(e,n,s){e.forEach(o=>{o.slot!==null&&(this.hydrate(o),n=n.filter(i=>i!==o.slot))}),n.forEach(o=>this.removeItem(o,s))}findFirstItemOfType(e,n){for(let s of this.slots)if(s[1].type==e&&s[1].tier==n)return s[1]}findFirstSlotOfType(e,n){let s=-1,o=0;for(let i of this.slots){let r=i[0],l=i[1];l.type==e&&l.tier==n&&r>s&&l.bound>=o&&(s=r,o=l.bound)}return s>=0?s:void 0}getFirstEmptySlot(){if(this.firstEmptySlotDirty){this.firstEmptySlotDirty=!1;for(let e=0;e<this.size;++e)if(!this.slots.has(e))return this.firstEmptySlot=e;this.firstEmptySlot=-1}return this.firstEmptySlot}findFirstUnmaxedStackableOfType(e,n){for(let s of this.slots)if(s[1].type==e&&s[1].tier==n&&s[1].stacks<50)return s[1];return-1}};var a1,c1=class extends l1{constructor(e){super(e),this.dirty=!1}tickFixed(e,n,s){super.tickFixed(e,n,s),this.dirty&&(this.hydrateItems(),this.dirty=!1)}setGold(e,n,s){super.setGold(e),du(e,n,s,"$g"),Qs.set(e)}setMedals(e,n,s){super.setMedals(e),du(e,n,s,"$m"),ca.set(e)}setItem(e,n,s){let o=super.setItem(e,n);o.reason=s,this.dirty=!0}removeItem(e,n){LF(super.removeItem(e),n),a1[e]!==void 0&&(a1[e].set(void 0),this.dirty=!0,this.updateInventoryCounts())}hydrate(e){e.store=a1[e.slot],super.hydrate(e)}postHydrate(e){super.postHydrate(e),this.updateInventoryCounts()}updateInventoryCounts(){let e={};this.slots.forEach(n=>{let s=n.type+n.tier;e[s]=(e[s]||0)+(n.stacks?n.stacks:1)}),ua.set(e)}async fetchData(e){let n=await fetch("/api/item/get",{method:"POST",body:JSON.stringify({ids:e})}),s=await n.json();if(s==="error"||n.ok===!1)console.error("inventory hydration error",s);else return s}setSize(e){super.setSize(e),fa.update(n=>{for(let s=111;s>=0;--s)s>=101?n[s]||(n[s]=te(void 0)):s>=this.size?n[s]&&delete n[s]:n[s]||(n[s]=te(void 0));return a1=n,n})}};var f1=class extends Rl{constructor(e){super(e),I.setPlayer(this),this.skills.isPlayer=!0,this.skills.clearSkillInfo(),this.inventory=new c1(this),this.partyInfoUpdateTimer=new kt(0,1),this.heartBeatTimer=new kt(0,1),this.secondlyUpdates=new kt(0,1),this.lastNetRot=this.rot,this.inputTicksPassed=0,this.inputTicksSinceLastPosUpdate=0,this.inputTicksSinceLastRotUpdate=0,is[1]=.7,this.smoothZoom=0,this.areaid=-1}makeVisual(e,n){super.makeVisual(e,n),this.visual.soundPrio=1}tickFixed(e,n,s){super.tickFixed(e,n,s),this.inventory.tickFixed(e,n,s)}preFixed(e,n,s){super.preFixed(e,n,s),(nt.turnright.down||nt.turnleft.down)&&(is[0]=Ua(is[0]+fe.mouseSensitivity*3*e*((nt.turnleft.down?1:0)-(nt.turnright.down?1:0)))),this.handleInput(e,n,s)}postFixed(e,n,s){super.postFixed(e,n,s)}handleInput(e,n,s){this.inputTicksPassed++;let o=!1,i=!1,r=!1,l=!1,a=!1,c=!1,f=this.steer[0],u=this.steer[1],m=this.jump,g=this.rot,v=f,_=u,b=m,k=g;this.hasMovementOverride()?(this.buffMovementOverride(e,n,s),f=this.steer[0],u=this.steer[1],m=this.jump,g=this.rot):(f=(nt.left.down?1:0)+(nt.right.down?-1:0),u=(nt.fwd.down||nt.lmb.down&&nt.rmb.down?1:0)+(nt.back.down?-1:0),m=nt.jump.down?1:0,g=fe.lockedcamera&&nt.lmb.down||nt.rmb.down||nt.turnleft.down||nt.turnright.down?is[0]:this.rot),(f!==v||u!==_)&&(i=f!==v,r=u!==_,this.setSteer(f,u)),m!==b&&(this.setJump(m),a=!0);let y=fl(g,this.lastNetRot);this.inputTicksSinceLastRotUpdate++,g!==k&&this.setRot(g),g!==this.lastNetRot&&((this.steer[0]!==0||this.steer[1]!==0)&&Math.abs(y)>.1||this.inputTicksSinceLastRotUpdate>10||r||i||Math.abs(y)>.2)&&(this.lastNetRot=k,o=!0);let F=this.getStatBasedMoveSpeed();F!=this.speed&&(this.setSpeed(F),l=!0),this.inputTicksSinceLastPosUpdate++,this.inputTicksSinceLastPosUpdate>600?c=!0:this.inputTicksSinceLastPosUpdate>40?(this.steer[0]!==0||this.steer[1]!==0)&&(c=!0):this.inputTicksSinceLastPosUpdate>20&&(this.steer[0]!==0||this.steer[1]!==0)&&(o||i||r)&&(c=!0),(o||i||r||l||a||c)&&this.sendInput(o,i,r,l,a,c)}sendInput(e,n,s,o,i,r){let l={uint8s:[],int8s:[],uint16s:[],doubles:[]};l.uint8s.push(Math.min(254,this.inputTicksPassed)),i&&l.uint8s.push(this.jump),n&&!s?l.int8s.push(this.steer[0]):(n||s)&&l.int8s.push(this.steer[0],this.steer[1]),e&&(this.inputTicksSinceLastRotUpdate=0,l.doubles.push(this.rot)),r&&(this.inputTicksSinceLastPosUpdate=0,l.doubles.push(this.pos[0],this.pos[1],this.pos[2])),o&&l.uint16s.push(this.speed),Es(Mt.clientPlayerInput.packData(l)),this.inputTicksPassed=0}updateCharPanel(){(fe.charpanelOpen||fe.skillmenuOpen)&&this.statsDirty&&(this.statsDirty=!1,Gi.update(e=>(Array.from(this.stats.stat).forEach(s=>e[s[0]]=s[1]),e)))}updatePartyInfo(e){if(this.partyInfoUpdateTimer.done(e)){this.partyInfoUpdateTimer.reset(e);let n=this.getNearbyPartyMembers(this.pos),s=Uh(n.length);es.update(o=>(o.role=this.partyrole,o.nearby=n.length,o.exprate=Math.round(s*100),o.itemfind=Math.min(10*100,Math.round(s*100+Ry(n)*100)),o))}}handleCamera(e){if(ot(Yt.position,this.mount?this.mount.transform.position:this.visual.transform.position),Yt.position[1]+=1.25,Yt.rotation[0]=is[1],!nt.lmb.down&&!nt.rmb.down&&(this.steer[0]!==0||this.steer[1]!==0)){let u=fl(this.rot,is[0])*Math.min(1,e*2);u!==0&&(Math.abs(u)>.03*e?(u=u>0?Math.max(u,Math.min(1,.6*e)):Math.min(u,Math.max(1,-.6*e)),is[0]-=u):is[0]=this.rot)}Yt.rotation[1]=is[0],Bt(Yt,!1);let n=fe.cameraZoom;Y(ht.transform.position,0,0,-n),_a(ht,!1);let s=[0,0,0],o=[0,0,0],i=[0,0,0];hi(ht,i,[0,0]),Zt(s,i,Yt.position),Em(o,s);let r=ds(s),l=[0,0,0],a=[0,0,0],c=[[-1,1],[1,1],[-1,-1],[1,-1]];for(let u=0;u<c.length;++u){let m=c[u];hi(ht,l,m),Zt(a,l,i),Bn(l,Yt.position,a);let g=I.triangleGrid.queryRay(l,s,o),v=1;for(let _=0;_<g.length;++_){let b=g[_];v=Math.min(v,Na(b[0],b[1],b[2],l,s,!0))}v<1&&(n=Math.min(r*v,n))}if(this.smoothZoom=Math.max(0,Math.min(this.smoothZoom+e*20,n)),Y(ht.transform.position,0,0,-this.smoothZoom),$1(ht),!this.belowGround){hi(ht,l,[0,-1]);let u=I.getHeight(l[0],l[2]);u>l[1]&&(Yt.position[1]+=u-l[1])}Bt(Yt,!1),_a(ht,!1),hi(ht,l,[0,-1]);let f=I.getWaterHeight(l[0],l[2]);if(f>l[1]){let u=f-l[1];o0(u);let m=l[1]-f;if(hi(ht,l,[0,1]),f<l[1]){let g=l[1]-f;Math.abs(g)>Math.abs(m)?(Yt.position[1]-=m,o0(0)):Yt.position[1]-=g,Bt(Yt,!1),_a(ht,!1)}}else o0(0)}handleAreaCheck(e){let n=e.getAreaId(this.pos[0],this.pos[2]);if(n!==this.areaid){this.areaid=n;let s=zf.get(n);s!==void 0&&Dr.set({type:"area",text:s.name,time:5e3})}}handleHeartBeat(e){let n=this.stats.getResource(6)/(this.stats.getStat(6)*.5);n>0&&n<1&&(n=(Math.max(0,Math.min(1,n))+.5)/1.5,xt(103),this.heartBeatTimer.reset(e,n))}postDelta(e,n,s){this.updateCharPanel(),this.updatePartyInfo(n),super.postDelta(e,n,s),this.handleCamera(e),this.secondlyUpdates.done(n)&&this.handleAreaCheck(s),this.heartBeatTimer.done(n)&&this.handleHeartBeat(n)}updateTransformRotation(e){this.stats.alive&&this.buffs.visualFreeze===0&&(this.updateMountRotation(e),this.buffs.movementOverride.size||!nt.rmb.down&&!(fe.lockedcamera&&nt.lmb.down)?this.visual.transform.rotation[1]=this.rot:this.visual.transform.rotation[1]=is[0],this.visual.transform.rotation[1]+=this.mountRotAdd)}setLevel(e){super.setLevel(e),this.uiFrameDirty=!0}onRemove(){super.onRemove(),I.removePlayer(this)}setExp(e){super.setExp(e),vm.update(n=>(n.current=e,n.max=ir(this.level),n))}setClan(e,n=0){super.setClan(e,n),Cm.set(e)}setRot(e,n=!1){super.setRot(e),n&&(is[0]=e)}};var H2=new Map([[6,R0],[2,B0],[7,N0],[4,H0],[0,Rl],[9,n1],[12,W0],[5,o1],[8,r1],[3,U0],[1,X0],[10,K0],[11,Z0]]),sT=(t,e)=>t==0?e==I.playerId?f1:Rl:H2.get(t);var Y2=[-0,-1,-0],u1=class{constructor(){this.id="",this.idInt=0,this.file="",this.bounds=0,this.chunkAmount=0,this.entities={array:[],map:new Map,type:{}},H2.forEach((e,n)=>this.entities.type[n]=[]),this.mode=Rd.normal,this.chunksMap=new Map,this.chunksArray=[],this.finishedLoadingChunks=new Set,this.time=this.accum=-0,this.timestep=1/60,this.tickId=0,this.data=void 0,this.triangleGrid=new F0}load(e,n){this.id=e,this.file=n,Ph.forEach(s=>{s.name===n&&(this.data=s,this.idInt=s.id)}),this.parse(!1)}tickIdToTimestamp(e){return e*this.timestep}setTimeFromTickId(e){return this.tickId=e,this.time=this.tickIdToTimestamp(e),this.tickId}createEntity(e,n,s){return s=s||{},s.id=n,new(sT(e,n))(s)}addEntity(e){if(e===void 0||e.type===void 0){console.log("Error: tried adding an entity of unknown type to the world");return}if(this.isEntityInWorld(e)||this.isEntityIdTaken(e.id)){console.log("Error: Entity in world or entity id taken"),console.log(e),console.log(this.getEntityById(e.id));return}return this.entities.array.push(e),this.entities.map.set(e.id,e),this.entities.type[e.type].push(e),e}removeEntity(e){if(e===void 0)return!1;this.entities.map.delete(e.id);let n=this.entities.array.indexOf(e);return n>-1&&this.entities.array.splice(n,1),n=this.entities.type[e.type].indexOf(e),n>-1&&this.entities.type[e.type].splice(n,1),e.onRemove(),e}isEntityIdTaken(e){return this.entities.map.has(e)}isEntityIdAllowed(e){return!0}isEntityInWorld(e){return this.entities.array.indexOf(e)>=0}entity(e){return this.entities.map.get(e)}getEntityById(e){return this.entities.map.get(e)}getPlayerByName(e){let n=e.toLowerCase();return this.entities.type[0].find(s=>s.name&&s.name.toLowerCase()===n)}getMonsterByName(e){let n=e.toLowerCase();return this.entities.array.find(s=>s.name&&s.name.toLowerCase()===n)}setMode(){this.mode=Rd[this.id]||Rd.normal}getHeight(e,n){e=gt(e,0,this.bounds),n=gt(n,0,this.bounds);let s=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!s||!s.deserialized?-0:To(s,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getHole(e,n){e=gt(e,0,this.bounds),n=gt(n,0,this.bounds);let s=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!s||!s.deserialized?-0:Tu(s,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getWaterHeight(e,n){e=gt(e,0,this.bounds),n=gt(n,0,this.bounds);let s=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!s||!s.deserialized?-1:Eu(s,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getAreaId(e,n){e=gt(e,0,this.bounds),n=gt(n,0,this.bounds);let s=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!s||!s.deserialized?-0:d2(s,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getEnvironmentId(e,n){e=gt(e,0,this.bounds),n=gt(n,0,this.bounds);let s=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!s||!s.deserialized?-0:h2(s,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getNormal(e,n){e=gt(e,0,this.bounds),n=gt(n,0,this.bounds);let s=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);if(!s||!s.deserialized)Y(Y2,0,0,0);else{e=e>=this.bounds?63:e%64,n=n>=this.bounds?63:n%64,e/=2.6666666666666665,n/=2.6666666666666665;let o=Math.floor(e)*2+24*Math.floor(n)*2;e%1+n%1>1&&o++,o*=3,Y(Y2,s.normals[o],s.normals[o+1],s.normals[o+2])}return Y2}clampV3(e){return e[0]=gt(e[0],0,this.bounds),e[1]=gt(e[1],0,2e3),e[2]=gt(e[2],0,this.bounds),e}getChunkFromWorld(e,n){return e=gt(e,0,this.bounds),n=gt(n,0,this.bounds),e=Math.min(Math.floor(e/64),this.chunkAmount-1),n=Math.min(Math.floor(n/64),this.chunkAmount-1),this.chunksMap.get(e+n*this.chunkAmount)}getChunk(e,n){if(!(e<0||n<0||e>=this.chunkAmount||n>=this.chunkAmount))return this.chunksMap.get(e+n*this.chunkAmount)}parse(e){this.setMode(),e||(this.chunkAmount=this.data.chunkAmount,this.bounds=64*this.chunkAmount,this.setGrids(),this.finishedLoadingChunks.clear(),this.createChunks())}setGrids(){this.triangleGrid.setDimensions(this.bounds,this.bounds,this.bounds,15,15,15)}rebuildTriangleOctree(){this.triangleGrid.clear(),this.chunksMap.forEach(e=>{for(let n=0;n<e.props.length;++n){let s=e.props[n];s.loaded=!1,s.loadGeometry(this,e)}})}triangleRaycastClosest(e,n,s,o,i,r){C0(as,e,n,s,o,i,r);let l=1,a=this.triangleGrid.queryRay(as.origin,as.dir,as.invDir);for(let c=0;c<a.length;++c){let f=a[c];l=Math.min(l,Na(f[0],f[1],f[2],as.origin,as.dir,!1))}return l}triangleRaycastAny(e,n,s,o,i,r,l){C0(as,e,n,s,o,i,r);let a=this.triangleGrid.queryRay(as.origin,as.dir,as.invDir);for(let c=0;c<a.length;++c){let f=a[c];if(Na(f[0],f[1],f[2],as.origin,as.dir,l)<1)return!0}return!1}raycastEnvironmentClosest(e,n,s,o,i,r){let l=this.getHeight(e,s)>n,a=this.triangleRaycastClosest(e,n,s,o,i,r);a<1&&(o*=a,i*=a,r*=a);let c=0,f=0,u=.1;if(l)f=1;else for(;c<100&&f<1;){let m=f+u,g=e+o*m,v=n+i*m,_=s+r*m,b=this.getHole(e,s)?0:this.getHeight(g,_),k=v-b;k<0?k>-.05?(f+=u,c=100):u*=.5:f+=u,c++}return Math.min(f,a,1)}raycastEnvironmentAny(e,n,s,o,i,r,l){let a=Math.sqrt(o*o+i*i+r*r),c=3/a,f=o*c,u=i*c,m=r*c,g=e,v=n+l,_=s,b=Math.floor(a/3),k=0;for(;k<b;)if(++k,g+=f,v+=u,_+=m,this.getHeight(g,_)>v)return!0;return this.triangleRaycastAny(e,n,s,o,i,r,!0)}raycastEnvironmentHeight(e,n,s,o,i){let l=this.getHole(e,n)?0:this.getHeight(e,n),a=0;s>l&&(i!==void 0&&ot(i,this.getNormal(e,n)),a=l);let c=s-o;ri[0]=ri[3]=e,ri[5]=ri[2]=n,ri[4]=s,ri[1]=o;let f=this.triangleGrid.queryAABB(ri);if(f.length>0){let u=1/0;C0(as,e,s,n,0,-c,0);for(let m=0;m<f.length;++m){let g=f[m],v=Na(g[0],g[1],g[2],as.origin,as.dir,!1);if(v<u){u=v;let _=s-v*c;_>a&&(a=_,i!==void 0&&ot(i,g[3]))}}}return a}addChunk(e){this.chunksMap.set(e.id,e),this.chunksArray.push(e)}removeChunk(e){this.chunksMap.delete(e.id),this.chunksArray.splice(this.chunksArray.indexOf(e),1)}};var oT=(t,e,n="")=>{Uc.update(s=>(s.push({text:t,icon:e,css:n}),s))};var PB={2:"On cooldown.",3:"Can only be cast on enemy.",4:"Can only be cast on ally.",5:"Not enough mana.",6:"Out of range.",10:"Target is dead.",7:"Can't do that during movement.",8:"Can't cast while busy.",9:"You are incapacitated.",11:"Can't do that in combat.",12:"Can't cast this right now.",13:"Level difference is too big.",14:"Target is not in line of sight."},iT=new Map;iT.set(16,t=>{if(Nt("system",`You have learned ${P.items.book[t[0]].name} Lv. ${t[1]}`,!0),xt(89),an(21,100),t[1]===0&&At.get(t[0]).autoSkillbar){let e=fe.skillbarsettings[I.player.name].findIndex(n=>n.id===-1);e>=0&&Ss[e].update(n=>(n.id=t[0],n))}}).set(15,t=>{I.player.skills.add(t[0],xs(t[2]),xs(t[3]),t[1])}).set(17,t=>{I.player.skills.remove(t[0])}).set(18,t=>{I.player.skills.updateSkillsLearned(t)}).set(19,t=>{Gc.set(Ys(t,0))}).set(1,t=>{Dr.set({type:"error",text:PB[t[0]]})}).set(20,t=>{I.player.setExp(t[1]),fe.msgExpGain&&Nt("exp",`Gained ${t[0]} experience. ${I.player.exp}/${ir(I.player.level)}`,!0),fv(t[0])}).set(21,t=>{I.player.setExp(t[1]),Nt("error",`Lost ${t[0]} experience. ${I.player.exp}/${ir(I.player.level)}`,!0)}).set(22,t=>{I.player.setExp(t[0])}).set(45,t=>{let e=I.entity(t[1]);xt(104),e&&sA(ot([0,0,0],e.visualPosition),t[0]),fe.msgFame&&Nt("fame",`Gained $fm${t[0]} fame ${e?"from "+e.name:""}`,!0)}).set(46,t=>{fe.msgFame&&Nt("fame",`Lost $fm${t[0]} fame.`,!0)}).set(47,t=>{xt(104),fe.msgFame&&Nt("fame",`Gained $fm${t[0]} salary from the war.`,!0)}).set(48,t=>{xt(105),fe.msgFame&&Nt("fame",`War: Gained $fm${t[0]} spoils of war (Fight ${t[1]>0?"Victory!":"Loss!"}).`,!0)}).set(49,t=>{xt(105),fe.msgFame&&Nt("fame",`Obelisk: Captured obelisk for $fm${t[0]} and $m${t[2]}.`,!0),I.player.inventory.setMedals(t[1],t[2],1)}).set(50,t=>{Ho.set(),Yo.set(!1),t[0]===1&&Nt("system","War: You have left the war due to inactivity.",!0)}).set(23,t=>{let e=I.getEntityById(t[0]);e&&e.interact(t)}).set(24,t=>{jo.set(void 0)}).set(25,t=>{let e=Ys(t,0);e.startsWith("Rolling for")&&!fe.msgItemPartyRoll||Nt("system",e,!0)}).set(26,t=>{Nt("error",Ys(t,0),!0)}).set(52,t=>{let e=Ys(t,1);Aa(P.ui.party.summon,P.ui.party.onSummon.replace("$1",e),[{text:P.ui.accept,nocombat:!0,remaining:20,fun:()=>{yt("summonaccept",e)}},{text:P.ui.decline,fun:()=>{}}])}).set(27,t=>{let e=Ys(t,1);Aa(P.ui.party.invite,P.ui.party.onInvite.replace("$1",e),[{text:P.ui.accept,fun:()=>{yt("partyaccept",t[0]+"")}},{text:P.ui.decline,fun:()=>{yt("partydecline",t[0]+"")}}])}).set(29,t=>{I.player.inventory.setItem(t[0],t[1],t[2])}).set(30,t=>{I.player.inventory.removeItem(t[0],t[1])}).set(31,t=>{I.player.inventory.setGold(t[0],t[1],t[2])}).set(32,t=>{I.player.inventory.setMedals(t[0],t[1],t[2])}).set(33,t=>{Ui.set(t[0]),du(t[0],t[1],12,"$sp")}).set(34,t=>{_m.set(t[0]==0?void 0:t[0]-1)}).set(51,t=>{bm.set(t[0]==0?void 0:t[0]-1)}).set(35,t=>{po.set(t[0]),t[0]&&xt(106)}).set(36,t=>{xm.set(t.pop()),AB(t,ma)}).set(37,t=>{Vr.update(e=>!e),Nt("inv",P.ui.merchant.auctioncancel,!0)}).set(38,t=>{let e=t.slice(2),n=[],s=[],o=[],i=[],r=[n,o,s],l=0,a=0,c=n;for(let f=0;f<e.length;f++)if(a===0)a=e[f],c=r[l],++l;else{let u=new So(e[f]);i.push(u),c.push(u),--a}wm.set({self:n,other:s,nonOrAcc:o,all:i}),t[0]&&xt(107),Rs.set({gold:t[1]})}).set(39,t=>{Rs.set({gold:t[0]})}).set(40,t=>{Rs.set(!1)}).set(41,t=>{Zs.set(!0),xt(108),an(19,100)}).set(42,t=>{Zs.set(!1)}).set(43,t=>{Xo.set(!0)}).set(44,t=>{Xo.set(!1)}).set(54,t=>{let e=I.entity(t[0]);e!==void 0&&(e.party=1)}).set(55,t=>{window.open("/leaderboards?mode=1&kill="+t[0],"_blank")}).set(56,t=>{Pd()}).set(58,t=>{fe.msgFriendOnlineStatus&&Nt("social",`${Ys(t,0)} has come online.`),pi.set(!0)}).set(59,t=>{pi.set(!0)}).set(60,t=>{pi.set(!0),Nt("social",`${Ys(t,0)} has sent you a friend request.`)}).set(61,t=>{pi.set(!0),Nt("social",`${Ys(t,0)} has accepted your friend request.`)}).set(53,t=>{let e=t[0];e<1e3&&e>0&&Dr.set({type:"error",timer:500,text:e}),e<=5&&e>0?xt(109):e===0?xt(110):e===1e3?xt(111):e===2e3&&xt(112)});var AB=(t,e)=>{e.update(n=>(n.length=0,t.forEach(s=>{n.push(new So(s))}),n))},rT=(t,e)=>{I.player&&iT.get(t)(e)},lT=new Map;lT.set(0,(t,e,n)=>{}).set(1,(t,e,n)=>{I.removeEntity(t)}).set(2,(t,e,n)=>{e[1]>0&&e[1]!==t.target&&t.visual&&t.type!==0&&t.visual.onAggro(),t===I.player&&Ig(e[1])}).set(3,(t,e,n)=>{for(let s=1;s<e.length;s+=2)t.stats.setResource(e[s],e[s+1])}).set(6,(t,e,n)=>{for(let s=1;s<e.length;s+=2)t.stats.setResource(e[s],e[s+1])}).set(4,(t,e,n)=>{for(let s=1;s<e.length;s+=2)t.stats.setStat(e[s],e[s+1])}).set(5,(t,e,n)=>{if(t==I.player&&(an(3,100),t.skills.cd(e[1],I.time,xs(e[2])),e[5]>0&&t.skills.globalCd(xs(e[4]),xs(e[5]))),!n&&t.visual&&!t.visual.inFog){let o=At.get(e[1]);(!o.castLen||!t.visual.currentAnim)&&o.fx.animCast&&t.visual.anim(o.fx.animCast),t.visual.onYell()}}).set(22,(t,e,n)=>{t.skills.startTimedCast(At.get(e[1]),xs(e[2]),e[3],xs(e[4])),e[5]>0&&t.skills.globalCd(xs(e[2]),xs(e[5]))}).set(23,(t,e,n)=>{t.skills.interruptTimedCast(!0,e[1]===1)}).set(24,(t,e,n)=>{t.skills.finishTimedCast(xs(e[1]))}).set(7,(t,e,n)=>{let s=e[1],o=e[2],i=I.getEntityById(e[3]),r=e[4],l=e[5],a=e[6],c=e[7];i!==void 0&&fe.dpsmeterMode===0&&Cd(i,s,o);let f=t===I.player,u=i===I.player;f?fe.showIncomingDamage&&q2([-.3,-.3,.5],s,l,a,!0,0):u&&q2(t.visualPosition,s,l,a,!1,2),l>0&&t.stats.changeResource(6,-s),c>0&&(t.stats.refreshCombatTimer(I.time,c),i&&i.stats.refreshCombatTimer(I.time,c));let m=At.get(o);if(!n&&l>0&&t.visual&&!t.visual.inFog){let g=r>0&&Cr.has(r)?Cr.get(r).effect.transform:i&&i.visual&&i.visual.transform,v=t.visual.transform;i&&i.visual&&m.fx.animImpact&&i.visual.anim(m.fx.animImpact,!1,t.id),l!==1?(t.visual.onHurt(s/t.stats.getStat(6),l),g&&X2(m,g,v,t.radius,u?1:0)):g&&(m.fx.effectDirImpact||m.fx.animImpact)&&cT(13,g,v,t.radius,u?1:0)}}).set(8,(t,e,n)=>{let s=I.getEntityById(e[3]);s!==void 0&&fe.dpsmeterMode===1&&Cd(s,e[1],e[2]),s&&e[5]>0&&s.stats.refreshCombatTimer(I.time,e[5]);let o=t===I.player,i=s===I.player;o?fe.showIncomingHeal&&R2([.3,-.3,.5],e[1],e[4],!0,0):i&&R2(t.visualPosition,e[1],e[4],!1,2),t.stats.changeResource(6,e[1]);let r=At.get(e[2]);!n&&s&&s.visual&&t.visual&&!t.visual.inFog&&X2(r,s.visual.transform,t.visual.transform,t.radius,o||i?1:0)}).set(9,(t,e,n)=>{t.stats.changeResource(7,e[1]);let s=I.getEntityById(e[3]),o=t===I.player;o&&fe.showIncomingHeal&&nA([.35,-.2,.5],e[1],e[4],!0,0);let i=At.get(e[2]);!n&&s&&s.visual&&t.visual&&!t.visual.inFog&&!s.visual.inFog&&X2(i,s.visual.transform,t.visual.transform,t.radius,o?1:0)}).set(10,(t,e,n)=>{e[1]==0?t.stats.alive&&(t.stats.die(),t==I.player?Aa(P.ui.death.death,P.ui.death.deathmsg,[{text:P.ui.death.respawn,blockedTime:Math.max(0,Math.ceil(e[2]-I.time)+1),fun:()=>{yt("respawn","")}}]):I.player&&t.id==zn&&an(4,100)):t.stats.alive||t.stats.respawn()}).set(11,(t,e,n)=>{t.setFaction(e[1])}).set(14,(t,e,n)=>{t.setLevel(e[1])}).set(16,(t,e,n)=>{t.setClass(e[1])}).set(12,(t,e,n)=>{t.setName(Ys(e,1))}).set(13,(t,e,n)=>{t.setClan(e.length>2?Ys(e,2):void 0,e[1])}).set(15,(t,e,n)=>{t.setLevel(e[1]);let s=`${t==I.player?"You":TB(e[0])} leveled up to ${e[1]}!`;Nt("lvlup",s),t==I.player&&(an(13,100),At.forEach(o=>{o.class===I.player.class&&o.minlevel===e[1]&&(an(16,100),oT(`<span class=textprimary><b class=textgreen>${P.items.book[o.id].name}</b><br>Skill book available at the Trader!</span>`,`skills/${o.id}.${Yn}`,"border primary"))})),t.visual&&!t.visual.inFog&&Ao(26,t.visual.transform,t==I.player?1:0,!1)}).set(17,(t,e,n)=>{t.buffs.setBuff(e[1],e[2],e[3],xs(e[4]),xs(e[5]),e[6],e[7],e.length>8?e.slice(8):void 0)}).set(19,(t,e,n)=>{e[2]===I.playerId&&tA(t.visualPosition,2,!1)}).set(18,(t,e,n)=>{t.buffs.removeBuff(e[1],e[2])}).set(20,(t,e,n)=>{let s=At.get(e[1]),o=new kt(I.time,xs(e[4])-I.time+.2);U8(e[0],e[2],s,e[3],o)}).set(21,(t,e,n)=>{let s=At.get(e[1]),o=e[2],i=xs(e[3])-I.time,r=new kt(I.time,i),l=4,a=e.length-l,c=a>6?2+(a-6)/4:2,f=[],u=[];for(let m=l;m<l+c*3;m+=3)f.push([wd(e[m],6400),wd(e[m+1],6400),wd(e[m+2],6400)]);if(c>2)for(let m=l+c*3;m<e.length;++m)u.push(e[m]/65535);O8(t.id,f,u,s,o,r)}).set(25,(t,e,n)=>{t.setParty(e[1],e[2])}).set(26,(t,e,n)=>{t.hasInfo===!1&&t.setDropInfo(e[1],e[2],e[3],e[4],e[5])}).set(27,(t,e,n)=>{t.setNodeInfo(e[1],e[2],e[3])}).set(28,(t,e,n)=>{t.setPosLock(e[1],e[2],e[3])});var aT=(t,e,n)=>{let s=I.getEntityById(e[0]);s===void 0||lT.get(t)(s,e,n)},TB=t=>{let e=I.getEntityById(t);return`${t>0?e?e.name:"unknown":"nobody"}`},cT=(t,e,n,s,o)=>{let i=Ao(t,on(),o,!0);Lm(i.transform,n,e,s),Bt(i.transform,!1)},X2=(t,e,n,s,o)=>{if(t.fx.effectDirImpact&&cT(t.fx.effectDirImpact,e,n,s,o),t.fx.effectImpact){let i=Ao(t.fx.effectImpact,on(),o,!0);ot(i.transform.position,n.position),Bt(i.transform,!1)}t.fx.effectTarget&&Ao(t.fx.effectTarget,n,o,!1)};var EB=[jo,po,Rs,Xo,Zs],IB=[la,ma,ui],DB=[Wo,Go],fT=()=>{DB.forEach(t=>t.update(e=>(e.visible=!1,e))),es.update(t=>(t.membercount=0,t.role=0,fe.partyinfo=t,t)),EB.forEach(t=>t.set()),IB.forEach(t=>t.set([]))};var m1=class extends u1{constructor(){super(),this.smoothtime=0,this.state=0,this.playerId=0,this.removePlayer(),this.netTimeoutTimer=new kt,this.chunkCache=[],Un("close",()=>{this.onDisconnect()}),this.netData=[],Un(Mt.serverEntityDelta.header,e=>{this.netData.push(Mt.serverEntityDelta.decode(e))}),Un(Mt.ping.header,e=>{N3(Mt.ping.decode(e))}),Un(Mt.serverChangeWorld.header,e=>{Or.set(Mt.serverChangeWorld.decode(e).world)}),Un(Mt.serverQueue.header,e=>{this.setState(1,"Queue Position: "+Mt.serverQueue.decode(e).pos)})}setState(e,n=""){this.state===2&&e===4&&dA(this),this.state=e,Cs.set(e!==4?n:!1)}handleEntityCreation(e){for(let n=0,s=e.log.length;n<s;++n){let o=e.log[n];o.type===0&&(this.isEntityIdTaken(o.data[0])||this.addEntity(this.createEntity(o.data[1],o.data[0],{creature:Fh.get(o.data[2])})))}}handleEntityInput(e){for(let n=0;n<e.inputs.length;++n){let s=e.inputs[n],o=this.entity(s.id);o!==void 0&&(H3(o.steer,s.steer),o.setRot(s.rot,!0),o.setJump(s.jump),o.setSpeed(s.speed))}}handleEntityMovements(e){for(let n=0;n<e.movements.length;++n){let s=e.movements[n],o=this.entity(s.id);if(o!==void 0){let i=e.inputs[n];o.handleMovementData(s,i)}}}handleEntityLog(e){for(let s=0,o=e.log.length;s<o;++s)aT(e.log[s].type,e.log[s].data,!1)}handlePersonalLog(e){for(let n=0,s=e.logPersonal.length;n<s;++n)rT(e.logPersonal[n].type,e.logPersonal[n].data)}pollNetData(e){let n=this.netData[0];if(n!==void 0)return Math.abs(n.tickId-e)>1&&(e=this.setTimeFromTickId(n.tickId)),n.tickId<=e?(this.netData.shift(),n):void 0}tickDelta(e,n){let s=this.time+n;for(let o=this.entities.array.length-1;o>=0;--o){let i=this.entities.array[o];i.preDelta(e,s,this),i.tickDelta(e,s,this),i.postDelta(e,s,this)}}tickFixed(e,n){let s=this.pollNetData(n);if(s!==void 0&&(this.handleEntityCreation(s),this.handleEntityInput(s),this.handleEntityLog(s),this.handlePersonalLog(s),this.handleEntityMovements(s)),this.state>2)for(let o=this.entities.array.length-1;o>=0;--o){let i=this.entities.array[o],r=this.getChunkFromWorld(i.pos[0],i.pos[2]);r!==void 0&&r.state>=5&&(i.preFixed(e,this.time,this,1),i.tickFixed(e,this.time,this,1),i.postFixed(e,this.time,this,1))}this.handleNetTimeouts()}tick(e){for(this.netData.length>5&&(this.accum+=(this.netData.length-5)*this.timestep),e=Math.min(e,1),this.accum+=e;this.accum>this.timestep;)this.accum-=this.timestep,this.setTimeFromTickId(this.tickId+1),this.tickFixed(this.timestep,this.tickId);this.setSmoothTime(e),this.state>2?(this.tickDelta(e,this.accum),O3()):this.player&&ot(Yt.position,this.player.pos),this.player&&this.manageChunks(e)}handleNetTimeouts(){if(this.player&&(this.netTimeoutTimer.done(this.time)||this.time<this.netTimeoutTimer.start)){this.netTimeoutTimer.reset(this.time-.5,1);for(let e=this.entities.array.length-1;e>=0;e--){let n=this.entities.array[e];n!==this.player&&(ss(n.pos,this.player.pos)<14400?n.netDeletion.reset(this.time,2):n.netDeletion.end>0&&n.netDeletion.done(this.time)&&(this.removeEntity(n),n.id===this.player.target&&this.player.setTarget(0)))}}}removeEntity(e){let n=super.removeEntity(e);return n&&this.state>2&&dh(e),n}load(e,n,s){this.destroy(),super.load(e,n),this.playerId=s,this.setState(2,"Loading World")}parse(e){super.parse(e),JP(this,!e)}onDisconnect(){ig(),this.netData.length=0,this.setState(0,"Loading World")}destroy(){this.setState(0,"Loading World");for(let e=0;e<this.chunksArray.length;e++){let n=this.chunksArray[e];this.returnCachedChunk(n),V2(n)}this.chunksMap.clear(),this.chunksArray.length=0;for(let e=this.entities.array.length-1;e>=0;e--)this.removeEntity(this.entities.array[e]);this.data=void 0,this.bounds=1,this.triangleGrid.clear(),KP(this),hA(this)}setPlayer(e){this.player=e,jc.set(!0),fT()}removePlayer(e){this.player===e&&(this.player=void 0,this.playerId=0,jc.set(!1),Ho.set(),Yo.set(!1))}setSmoothTime(e){let n=this.smoothtime-this.time;Math.abs(n)>1?this.smoothtime=this.time:n>.05?this.smoothtime+=e*.5:n<-.05?this.smoothtime+=e*2:this.smoothtime+=e}getInteriorLight(e,n){let s=this.triangleGrid.queryAABB(n);for(let o=0;o<s.length;++o)if(s[o].length>4){$r(e,s[o][4]);return}os(e,0,0,0,0)}createChunks(){}createCachedChunk(e,n,s){if(this.chunkCache.length){let o=this.chunkCache.pop();return I2(o,e,n,s,this.chunkAmount),o}else{let o=zP();return I2(o,e,n,s,this.chunkAmount),o}}returnCachedChunk(e){this.chunkCache.push(e)}manageChunks(e){ES(e);let n=Math.min(Math.max(0,Kv),this.chunkAmount-1),s=Math.min(Math.max(0,e2),this.chunkAmount-1),o=Math.min(Math.max(0,t2),this.chunkAmount-1),i=Math.min(Math.max(0,n2),this.chunkAmount-1),r=[];for(let u=n;u<=s;++u)for(let m=o;m<=i;++m){let g=this.chunkAmount*m+u,v=(u-Zv)**2+(m-Jv)**2;r.push({x:u,z:m,id:g,priority:v})}r.sort((u,m)=>u.priority-m.priority);let l=0,a=!1,c=0;for(;l<r.length;){let u=r[l];if(c>10)break;if(this.chunksMap.has(u.id))this.chunksMap.get(u.id).state<3&&(u.priority<9&&(a=!0),c++);else{let m=this.createCachedChunk(u.id,u.x,u.z);this.addChunk(m),m.state=1,u.priority<9&&(a=!0),c++}++l}let f=[];for(let u=0;u<this.chunksArray.length;++u){let m=this.chunksArray[u];o2&&(m.x+5<n||m.z+5<o||m.x-5>s||m.z-5>i?f.push(m):D2(m)),$P(m,this)}for(let u=f.length-1;u>=0;u--){let m=f[u];this.returnCachedChunk(m),this.removeChunk(m),V2(m)}a!==(this.state!==4)&&this.setState(a?3:4,"Loading World")}};window.onload=async()=>{console.log("Hordes 0.51.8685 Live"),await Th();let t=await fetch("data/game/game.bin?v=8685122");bh(Ca.gamedata.decode(new Uint8Array(await t.arrayBuffer()))),Dy(),HP(),fA(),new VP({target:document.querySelector("body")}),$3(xA,wA),D3(new m1({})),j2(!0),mT()};var uT=0,mT=()=>{let t=Af(),e=(t-(uT||1e3/60))/1e3;uT=t,MA(e,t),requestAnimationFrame(mT)};})();
