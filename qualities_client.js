(()=>{var GP=Object.defineProperty;var Qn=(t,e)=>{for(var n in e)GP(t,n,{get:e[n],enumerable:!0})};function ae(){}var Pr=t=>t;function Hl(t,e){for(let n in e)t[n]=e[n];return t}function mh(t){return t()}function Zu(){return Object.create(null)}function at(t){t.forEach(mh)}function Rs(t){return typeof t=="function"}function Ue(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}var Qu;function lt(t,e){return t===e?!0:(Qu||(Qu=document.createElement("a")),Qu.href=e,t===Qu.href)}function yn(t,e){return t!=t?e==e:t!==e}function G2(t){return Object.keys(t).length===0}function as(t,...e){if(t==null){for(let i of e)i(void 0);return ae}let n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function se(t,e,n){t.$$.on_destroy.push(as(e,n))}function Yl(t,e,n,i){if(t){let s=H2(t,e,n,i);return t[0](s)}}function H2(t,e,n,i){return t[1]&&i?Hl(n.ctx.slice(),t[1](i(e))):n.ctx}function Xl(t,e,n,i){if(t[2]&&i){let s=t[2](i(n));if(e.dirty===void 0)return s;if(typeof s=="object"){let o=[],r=Math.max(e.dirty.length,s.length);for(let l=0;l<r;l+=1)o[l]=e.dirty[l]|s[l];return o}return e.dirty|s}return e.dirty}function Ql(t,e,n,i,s,o){if(s){let r=H2(e,n,i,o);t.p(r,s)}}function Zl(t){if(t.ctx.length>32){let e=[],n=t.ctx.length/32;for(let i=0;i<n;i++)e[i]=-1;return e}return-1}function Vo(t){return t??""}function Qe(t,e,n){return t.set(n),e}var Y2=typeof window<"u",Ju=Y2?()=>window.performance.now():()=>Date.now(),Tc=Y2?t=>requestAnimationFrame(t):ae;var Jl=new Set;function X2(t){Jl.forEach(e=>{e.c(t)||(Jl.delete(e),e.f())}),Jl.size!==0&&Tc(X2)}function Ku(t){let e;return Jl.size===0&&Tc(X2),{promise:new Promise(n=>{Jl.add(e={c:t,f:n})}),abort(){Jl.delete(e)}}}var Ec=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var em=class t{_listeners="WeakMap"in Ec?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,n){return this._listeners.set(e,n),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(e=>{for(let n of e)t.entries.set(n.target,n),this._listeners.get(n.target)?.(n)}))}};em.entries="WeakMap"in Ec?new WeakMap:void 0;var Q2=!1;function Z2(){Q2=!0}function J2(){Q2=!1}function d(t,e){t.appendChild(e)}function ph(t){if(!t)return document;let e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function K2(t){let e=h("style");return e.textContent="/* empty */",YP(ph(t),e),e.sheet}function YP(t,e){return d(t.head||t,e),e.sheet}function w(t,e,n){t.insertBefore(e,n||null)}function x(t){t.parentNode&&t.parentNode.removeChild(t)}function it(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function XP(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function T(t){return document.createTextNode(t)}function We(){return T(" ")}function he(){return T("")}function Y(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function e_(t){return function(e){e.target===this&&t.call(this,e)}}function p(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Wt(t){return t===""?null:+t}function t_(t){return Array.from(t.childNodes)}function G(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ne(t,e){t.value=e??""}function qe(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,i?"important":"")}function Mn(t,e,n){for(let i=0;i<t.options.length;i+=1){let s=t.options[i];if(s.__value===e){s.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function ki(t){let e=t.querySelector(":checked");return e&&e.__value}function Lo(t,e,n){t.classList.toggle(e,!!n)}function Ic(t,e,{bubbles:n=!1,cancelable:i=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:i})}var tm=class{is_svg=!1;e=void 0;n=void 0;t=void 0;a=void 0;constructor(e=!1){this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,n,i=null){this.e||(this.is_svg?this.e=XP(n.nodeName):this.e=h(n.nodeType===11?"TEMPLATE":n.nodeName),this.t=n.tagName!=="TEMPLATE"?n:n.content,this.c(e)),this.i(i)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)w(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(x)}};function n_(t){let e={};return t.childNodes.forEach(n=>{e[n.slot||"default"]=!0}),e}var nm=new Map,im=0;function QP(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function ZP(t,e){let n={stylesheet:K2(e),rules:{}};return nm.set(t,n),n}function Dc(t,e,n,i,s,o,r,l=0){let a=16.666/i,c=`{
`;for(let b=0;b<=1;b+=a){let y=e+(n-e)*o(b);c+=b*100+`%{${r(y,1-y)}}
`}let f=c+`100% {${r(n,1-n)}}
}`,u=`__svelte_${QP(f)}_${l}`,m=ph(t),{stylesheet:g,rules:v}=nm.get(m)||ZP(m,t);v[u]||(v[u]=!0,g.insertRule(`@keyframes ${u} ${f}`,g.cssRules.length));let _=t.style.animation||"";return t.style.animation=`${_?`${_}, `:""}${u} ${i}ms linear ${s}ms 1 both`,im+=1,u}function sm(t,e){let n=(t.style.animation||"").split(", "),i=n.filter(e?o=>o.indexOf(e)<0:o=>o.indexOf("__svelte")===-1),s=n.length-i.length;s&&(t.style.animation=i.join(", "),im-=s,im||JP())}function JP(){Tc(()=>{im||(nm.forEach(t=>{let{ownerNode:e}=t.stylesheet;e&&x(e)}),nm.clear())})}var qo;function ro(t){qo=t}function Kl(){if(!qo)throw new Error("Function called outside component initialization");return qo}function dh(t){Kl().$$.before_update.push(t)}function Fn(t){Kl().$$.on_mount.push(t)}function Vc(t){Kl().$$.after_update.push(t)}function Tn(t){Kl().$$.on_destroy.push(t)}function lo(){let t=Kl();return(e,n,{cancelable:i=!1}={})=>{let s=t.$$.callbacks[e];if(s){let o=Ic(e,n,{cancelable:i});return s.slice().forEach(r=>{r.call(t,o)}),!o.defaultPrevented}return!0}}function ao(t,e){let n=t.$$.callbacks[e.type];n&&n.slice().forEach(i=>i.call(this,e))}var Tr=[];var Bt=[],ta=[],gh=[],i_=Promise.resolve(),vh=!1;function _h(){vh||(vh=!0,i_.then(om))}function bh(){return _h(),i_}function _n(t){ta.push(t)}function Ro(t){gh.push(t)}var hh=new Set,ea=0;function om(){if(ea!==0)return;let t=qo;do{try{for(;ea<Tr.length;){let e=Tr[ea];ea++,ro(e),KP(e.$$)}}catch(e){throw Tr.length=0,ea=0,e}for(ro(null),Tr.length=0,ea=0;Bt.length;)Bt.pop()();for(let e=0;e<ta.length;e+=1){let n=ta[e];hh.has(n)||(hh.add(n),n())}ta.length=0}while(Tr.length);for(;gh.length;)gh.pop()();vh=!1,hh.clear(),ro(t)}function KP(t){if(t.fragment!==null){t.update(),at(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(_n)}}function s_(t){let e=[],n=[];ta.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),ta=e}var Lc;function o_(){return Lc||(Lc=Promise.resolve(),Lc.then(()=>{Lc=null})),Lc}function qc(t,e,n){t.dispatchEvent(Ic(`${e?"intro":"outro"}${n}`))}var rm=new Set,zs;function Ee(){zs={r:0,c:[],p:zs}}function Ie(){zs.r||at(zs.c),zs=zs.p}function P(t,e){t&&t.i&&(rm.delete(t),t.i(e))}function I(t,e,n,i){if(t&&t.o){if(rm.has(t))return;rm.add(t),zs.c.push(()=>{rm.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}var r_={duration:0};function l_(t,e,n){let i={direction:"out"},s=e(t,n,i),o=!0,r,l=zs;l.r+=1;let a;function c(){let{delay:f=0,duration:u=300,easing:m=Pr,tick:g=ae,css:v}=s||r_;v&&(r=Dc(t,1,0,u,f,m,v));let _=Ju()+f,b=_+u;_n(()=>qc(t,!1,"start")),"inert"in t&&(a=t.inert,t.inert=!0),Ku(y=>{if(o){if(y>=b)return g(0,1),qc(t,!1,"end"),--l.r||at(l.c),!1;if(y>=_){let k=m((y-_)/u);g(1-k,k)}}return o})}return Rs(s)?o_().then(()=>{s=s(i),c()}):c(),{end(f){f&&"inert"in t&&(t.inert=a),f&&s.tick&&s.tick(1,0),o&&(r&&sm(t,r),o=!1)}}}function yh(t,e,n,i){let o=e(t,n,{direction:"both"}),r=i?0:1,l=null,a=null,c=null,f;function u(){c&&sm(t,c)}function m(v,_){let b=v.b-r;return _*=Math.abs(b),{a:r,b:v.b,d:b,duration:_,start:v.start,end:v.start+_,group:v.group}}function g(v){let{delay:_=0,duration:b=300,easing:y=Pr,tick:k=ae,css:A}=o||r_,S={start:Ju()+_,b:v};v||(S.group=zs,zs.r+=1),"inert"in t&&(v?f!==void 0&&(t.inert=f):(f=t.inert,t.inert=!0)),l||a?a=S:(A&&(u(),c=Dc(t,r,v,b,_,y,A)),v&&k(0,1),l=m(S,b),_n(()=>qc(t,v,"start")),Ku(F=>{if(a&&F>a.start&&(l=m(a,b),a=null,qc(t,l.b,"start"),A&&(u(),c=Dc(t,r,l.b,l.duration,0,y,o.css))),l){if(F>=l.end)k(r=l.b,1-r),qc(t,l.b,"end"),a||(l.b?u():--l.group.r||at(l.group.c)),l=null;else if(F>=l.start){let M=F-l.start;r=l.a+l.d*y(M/l.duration),k(r,1-r)}}return!!(l||a)}))}return{run(v){Rs(o)?o_().then(()=>{o=o({direction:v?"in":"out"}),g(v)}):g(v)},end(){u(),l=a=null}}}function me(t){return t?.length!==void 0?t:Array.from(t)}function a_(t,e){t.d(1),e.delete(t.key)}function Di(t,e){I(t,1,1,()=>{e.delete(t.key)})}function ui(t,e,n,i,s,o,r,l,a,c,f,u){let m=t.length,g=o.length,v=m,_={};for(;v--;)_[t[v].key]=v;let b=[],y=new Map,k=new Map,A=[];for(v=g;v--;){let D=u(s,o,v),R=n(D),E=r.get(R);E?i&&A.push(()=>E.p(D,e)):(E=c(R,D),E.c()),y.set(R,b[v]=E),R in _&&k.set(R,Math.abs(v-_[R]))}let S=new Set,F=new Set;function M(D){P(D,1),D.m(l,f),r.set(D.key,D),f=D.first,g--}for(;m&&g;){let D=b[g-1],R=t[m-1],E=D.key,L=R.key;D===R?(f=D.first,m--,g--):y.has(L)?!r.has(E)||S.has(E)?M(D):F.has(L)?m--:k.get(E)>k.get(L)?(F.add(E),M(D)):(S.add(L),m--):(a(R,r),m--)}for(;m--;){let D=t[m];y.has(D.key)||a(D,r)}for(;g;)M(b[g-1]);return at(A),b}function lm(t,e){let n={},i={},s={$$scope:1},o=t.length;for(;o--;){let r=t[o],l=e[o];if(l){for(let a in r)a in l||(i[a]=1);for(let a in l)s[a]||(n[a]=l[a],s[a]=1);t[o]=l}else for(let a in r)s[a]=1}for(let r in i)r in n||(n[r]=void 0);return n}function am(t){return typeof t=="object"&&t!==null?t:{}}var e9=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],t9=new Set([...e9]);function zo(t,e,n){let i=t.$$.props[e];i!==void 0&&(t.$$.bound[i]=n,n(t.$$.ctx[i]))}function ne(t){t&&t.c()}function K(t,e,n){let{fragment:i,after_update:s}=t.$$;i&&i.m(e,n),_n(()=>{let o=t.$$.on_mount.map(mh).filter(Rs);t.$$.on_destroy?t.$$.on_destroy.push(...o):at(o),t.$$.on_mount=[]}),s.forEach(_n)}function ee(t,e){let n=t.$$;n.fragment!==null&&(s_(n.after_update),at(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function i9(t,e){t.$$.dirty[0]===-1&&(Tr.push(t),_h(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ce(t,e,n,i,s,o,r=null,l=[-1]){let a=qo;ro(t);let c=t.$$={fragment:null,ctx:[],props:o,update:ae,not_equal:s,bound:Zu(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:Zu(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};r&&r(c.root);let f=!1;if(c.ctx=n?n(t,e.props||{},(u,m,...g)=>{let v=g.length?g[0]:m;return c.ctx&&s(c.ctx[u],c.ctx[u]=v)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](v),f&&i9(t,u)),m}):[],c.update(),f=!0,at(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){Z2();let u=t_(e.target);c.fragment&&c.fragment.l(u),u.forEach(x)}else c.fragment&&c.fragment.c();e.intro&&P(t.$$.fragment),K(t,e.target,e.anchor),J2(),om()}ro(a)}var s9;typeof HTMLElement=="function"&&(s9=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(t,e,n){super(),this.$$ctor=t,this.$$s=e,n&&this.attachShadow({mode:"open"})}addEventListener(t,e,n){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let i=this.$$c.$on(t,e);this.$$l_u.set(e,i)}super.addEventListener(t,e,n)}removeEventListener(t,e,n){if(super.removeEventListener(t,e,n),this.$$c){let i=this.$$l_u.get(e);i&&(i(),this.$$l_u.delete(e))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(s){return()=>{let o;return{c:function(){o=h("slot"),s!=="default"&&p(o,"name",s)},m:function(a,c){w(a,o,c)},d:function(a){a&&x(o)}}}};if(await Promise.resolve(),!this.$$cn)return;let e={},n=n_(this);for(let s of this.$$s)s in n&&(e[s]=[t(s)]);for(let s of this.attributes){let o=this.$$g_p(s.name);o in this.$$d||(this.$$d[o]=kh(o,s.value,this.$$p_d,"toProp"))}for(let s in this.$$p_d)!(s in this.$$d)&&this[s]!==void 0&&(this.$$d[s]=this[s],delete this[s]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});let i=()=>{this.$$r=!0;for(let s in this.$$p_d)if(this.$$d[s]=this.$$c.$$.ctx[this.$$c.$$.props[s]],this.$$p_d[s].reflect){let o=kh(s,this.$$d[s],this.$$p_d,"toAttribute");o==null?this.removeAttribute(this.$$p_d[s].attribute||s):this.setAttribute(this.$$p_d[s].attribute||s,o)}this.$$r=!1};this.$$c.$$.after_update.push(i),i();for(let s in this.$$l)for(let o of this.$$l[s]){let r=this.$$c.$on(s,o);this.$$l_u.set(o,r)}this.$$l={}}}attributeChangedCallback(t,e,n){this.$$r||(t=this.$$g_p(t),this.$$d[t]=kh(t,n,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{this.$$cn||(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function kh(t,e,n,i){let s=n[t]?.type;if(e=s==="Boolean"&&typeof e!="boolean"?e!=null:e,!i||!n[t])return e;if(i==="toAttribute")switch(s){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(s){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var xe=class{$$=void 0;$$set=void 0;$destroy(){ee(this,1),this.$destroy=ae}$on(e,n){if(!Rs(n))return ae;let i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{let s=i.indexOf(n);s!==-1&&i.splice(s,1)}}$set(e){this.$$set&&!G2(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var c_="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(c_);var na=[];function ie(t,e=ae){let n,i=new Set;function s(l){if(Ue(t,l)&&(t=l,n)){let a=!na.length;for(let c of i)c[1](),na.push(c,t);if(a){for(let c=0;c<na.length;c+=2)na[c][0](na[c+1]);na.length=0}}}function o(l){s(l(t))}function r(l,a=ae){let c=[l,a];return i.add(c),i.size===1&&(n=e(s,o)||ae),l(t),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:r}}var Rc=ie([]),Zn=ie({role:0,nearby:0,exprate:1,itemfind:1,queues:[],membercount:0}),cm=ie({parties:[],filterActivity:-1}),Hi=ie({flashing:!1,message:"",activity:0,listed:!1,applications:[]}),ia=ie([]),bn=ie(),co=ie([]),Er=ie({}),Bs=ie(),fm=ie(!1),f_=ie(),u_=ie(!1),xi=ie("Loading World"),zc=ie([]),Vi=ie(""),Us=ie({}),Os=ie({}),Bc=ie([]),sa=ie([]),En=ie(),um=ie("auto"),Yi=ie(0),oa=ie(0),Bo=ie(0),ra=ie([]),la=ie({}),Uo=ie({}),mm=ie({current:0,max:1}),pm=ie(),dm=ie(),Uc=ie(!1),hm=ie(0),gm=ie([0,0]),fo=ie(),$s=ie(),Ns=ie(!1),Oc=ie(new Map),Oo=ie(new Map),$c=ie(),$o=ie(),cs=ie(),aa=ie([]),fs=ie(),vm=ie(0),Ir=ie(!1),Dr=ie(!1),Li=ie(),_m=ie({self:[],other:[],nonOrAcc:[],all:[]}),Xi=ie(),js=ie(),No=ie(),ca=ie(),jo=ie({}),Nc=ie({}),bm=ie({}),ym=ie({}),km=ie(),fa=ie(),wi=[],Vr=ie();function o9(t){let e;return{c(){e=h("div"),e.innerHTML='<div class="bounce1 svelte-twvoek"></div><div class="bounce2 svelte-twvoek"></div><div class="bounce3 svelte-twvoek"></div>',p(e,"class","spinner svelte-twvoek")},m(n,i){w(n,e,i)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}var xh=class extends xe{constructor(e){super(),Ce(this,e,null,o9,yn,{})}},m_=xh;function xm(t,{delay:e=0,duration:n=400,easing:i=Pr}={}){let s=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:i,css:o=>`opacity: ${o*s}`}}function p_(t){let e,n,i,s,o,r;return n=new m_({}),{c(){e=h("div"),ne(n.$$.fragment),i=h("h2"),s=T(t[0]),o=h("small"),o.innerHTML='<img alt="Hordes.io" class="svgicon" src="/data/ui/icon.svg?v=8602459"/> 0.50.8602 Live',qe(i,"margin-top","100px"),p(o,"class","version textgrey textcenter svelte-aoht7k"),p(e,"class","l-ui container svelte-aoht7k")},m(l,a){w(l,e,a),K(n,e,null),d(e,i),d(i,s),d(e,o),r=!0},p(l,a){(!r||a&1)&&G(s,l[0])},i(l){r||(P(n.$$.fragment,l),r=!0)},o(l){I(n.$$.fragment,l),r=!1},d(l){l&&x(e),ee(n)}}}function r9(t){let e,n,i=t[0]&&p_(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=p_(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function l9(t,e,n){let{active:i}=e;return t.$$set=s=>{"active"in s&&n(0,i=s.active)},[i]}var wh=class extends xe{constructor(e){super(),Ce(this,e,l9,r9,Ue,{active:0})}},d_=wh;function us(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function h_(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Mh(t,e){let n=e[0],i=e[1],s=e[2],o=e[3],r=e[4],l=e[5],a=e[6],c=e[7],f=e[8],u=e[9],m=e[10],g=e[11],v=e[12],_=e[13],b=e[14],y=e[15],k=n*l-i*r,A=n*a-s*r,S=n*c-o*r,F=i*a-s*l,M=i*c-o*l,D=s*c-o*a,R=f*_-u*v,E=f*b-m*v,L=f*y-g*v,z=u*b-m*_,q=u*y-g*_,j=m*y-g*b,W=k*j-A*q+S*z+F*L-M*E+D*R;return W?(W=1/W,t[0]=(l*j-a*q+c*z)*W,t[1]=(s*q-i*j-o*z)*W,t[2]=(_*D-b*M+y*F)*W,t[3]=(m*M-u*D-g*F)*W,t[4]=(a*L-r*j-c*E)*W,t[5]=(n*j-s*L+o*E)*W,t[6]=(b*S-v*D-y*A)*W,t[7]=(f*D-m*S+g*A)*W,t[8]=(r*q-l*L+c*R)*W,t[9]=(i*L-n*q-o*R)*W,t[10]=(v*M-_*S+y*k)*W,t[11]=(u*S-f*M-g*k)*W,t[12]=(l*E-r*z-a*R)*W,t[13]=(n*z-i*E+s*R)*W,t[14]=(_*A-v*F-b*k)*W,t[15]=(f*F-u*A+m*k)*W,t):null}function wm(t,e,n){let i=e[0],s=e[1],o=e[2],r=e[3],l=e[4],a=e[5],c=e[6],f=e[7],u=e[8],m=e[9],g=e[10],v=e[11],_=e[12],b=e[13],y=e[14],k=e[15],A=n[0],S=n[1],F=n[2],M=n[3];return t[0]=A*i+S*l+F*u+M*_,t[1]=A*s+S*a+F*m+M*b,t[2]=A*o+S*c+F*g+M*y,t[3]=A*r+S*f+F*v+M*k,A=n[4],S=n[5],F=n[6],M=n[7],t[4]=A*i+S*l+F*u+M*_,t[5]=A*s+S*a+F*m+M*b,t[6]=A*o+S*c+F*g+M*y,t[7]=A*r+S*f+F*v+M*k,A=n[8],S=n[9],F=n[10],M=n[11],t[8]=A*i+S*l+F*u+M*_,t[9]=A*s+S*a+F*m+M*b,t[10]=A*o+S*c+F*g+M*y,t[11]=A*r+S*f+F*v+M*k,A=n[12],S=n[13],F=n[14],M=n[15],t[12]=A*i+S*l+F*u+M*_,t[13]=A*s+S*a+F*m+M*b,t[14]=A*o+S*c+F*g+M*y,t[15]=A*r+S*f+F*v+M*k,t}function ma(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function g_(t,e){let n=e[0],i=e[1],s=e[2],o=e[4],r=e[5],l=e[6],a=e[8],c=e[9],f=e[10];return t[0]=Math.sqrt(n*n+i*i+s*s),t[1]=Math.sqrt(o*o+r*r+l*l),t[2]=Math.sqrt(a*a+c*c+f*f),t}function v_(t){let e=t[0],n=t[1],i=t[2],s=t[4],o=t[5],r=t[6],l=t[8],a=t[9],c=t[10],f=e*e+n*n+i*i,u=s*s+o*o+r*r,m=l*l+a*a+c*c;return Math.sqrt(Math.max(f,u,m))}function Mm(t,e){let n=e[0]+e[5]+e[10],i=0;return n>0?(i=Math.sqrt(n+1)*2,t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=Math.sqrt(1+e[0]-e[5]-e[10])*2,t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=Math.sqrt(1+e[5]-e[0]-e[10])*2,t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=Math.sqrt(1+e[10]-e[0]-e[5])*2,t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function Fm(t,e,n,i){let s=e[0],o=e[1],r=e[2],l=e[3],a=s+s,c=o+o,f=r+r,u=s*a,m=s*c,g=s*f,v=o*c,_=o*f,b=r*f,y=l*a,k=l*c,A=l*f,S=i[0],F=i[1],M=i[2];return t[0]=(1-(v+b))*S,t[1]=(m+A)*S,t[2]=(g-k)*S,t[3]=0,t[4]=(m-A)*F,t[5]=(1-(u+b))*F,t[6]=(_+y)*F,t[7]=0,t[8]=(g+k)*M,t[9]=(_-y)*M,t[10]=(1-(u+v))*M,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function __(t,e,n,i,s){let o=1/Math.tan(e/2),r=1/(i-s);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(s+i)*r,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*s*i*r,t[15]=0,t}function b_(t,e,n,i,s,o,r){let l=1/(e-n),a=1/(i-s),c=1/(o-r);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*l,t[13]=(s+i)*a,t[14]=(r+o)*c,t[15]=1,t}function Fh(t,e,n,i){let s=e[0],o=e[1],r=e[2],l=i[0],a=i[1],c=i[2],f=s-n[0],u=o-n[1],m=r-n[2],g=f*f+u*u+m*m;g>0&&(g=1/Math.sqrt(g),f*=g,u*=g,m*=g);let v=a*m-c*u,_=c*f-l*m,b=l*u-a*f;return g=v*v+_*_+b*b,g>0&&(g=1/Math.sqrt(g),v*=g,_*=g,b*=g),t[0]=v,t[1]=_,t[2]=b,t[3]=0,t[4]=u*b-m*_,t[5]=m*v-f*b,t[6]=f*_-u*v,t[7]=0,t[8]=f,t[9]=u,t[10]=m,t[11]=0,t[12]=s,t[13]=o,t[14]=r,t[15]=1,t}function y_(t,e){return t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0),t}function mi(t){let e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)}function st(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function X(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function pi(t,e){return t[0]=e,t[1]=e,t[2]=e,t}function zn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Kn(t,e,n,i){return t[0]+=e,t[1]+=n,t[2]+=i,t}function Xt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function hn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function on(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t}function qr(t,e){let n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(n*n+i*i+s*s)}function ei(t,e){let n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return n*n+i*i+s*s}function jc(t){let e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function Cm(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Jn(t,e){let n=e[0],i=e[1],s=e[2],o=n*n+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function dn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Qi(t,e,n){let i=e[0],s=e[1],o=e[2],r=n[0],l=n[1],a=n[2];return t[0]=s*a-o*l,t[1]=o*r-i*a,t[2]=i*l-s*r,t}function pa(t,e,n,i){let s=e[0],o=e[1],r=e[2];return t[0]=s+i*(n[0]-s),t[1]=o+i*(n[1]-o),t[2]=r+i*(n[2]-r),t}function Mi(t,e,n){let i=e[0],s=e[1],o=e[2],r=n[3]*i+n[7]*s+n[11]*o+n[15];return r=r||1,t[0]=(n[0]*i+n[4]*s+n[8]*o+n[12])/r,t[1]=(n[1]*i+n[5]*s+n[9]*o+n[13])/r,t[2]=(n[2]*i+n[6]*s+n[10]*o+n[14])/r,t}function Rr(t,e,n,i,s){return t[0]=s[0]*e+s[4]*n+s[8]*i+s[12],t[1]=s[1]*e+s[5]*n+s[9]*i+s[13],t[2]=s[2]*e+s[6]*n+s[10]*i+s[14],t}function Sm(t,e,n,i,s){return t[0]=s[0]*e+s[4]*n+s[8]*i,t[1]=s[1]*e+s[5]*n+s[9]*i,t[2]=s[2]*e+s[6]*n+s[10]*i,t}function Ch(t,e,n){let i=e[0],s=e[1],o=e[2],r=n[0],l=n[1],a=n[2],c=n[3],f=l*o-a*s,u=a*i-r*o,m=r*s-l*i,g=l*m-a*u,v=a*f-r*m,_=r*u-l*f,b=c*2;return f*=b,u*=b,m*=b,g*=2,v*=2,_*=2,t[0]=i+f+g,t[1]=s+u+v,t[2]=o+m+_,t}var tO=function(){let t=[0,0,0],e=[0,0,0];return function(n,i){st(t,n),st(e,i),Jn(t,t),Jn(e,e);let s=dn(t,e);return s>1?0:s<-1?Math.PI:Math.acos(s)}}();function k_(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function zr(t,e,n){let i=Math.sin(n),s=Math.cos(n);return t[0]=e[2]*i+e[0]*s,t[1]=e[1],t[2]=e[2]*s-e[0]*i,t}function x_(t,e,n){let i=Math.sin(n),s=Math.cos(n);return t[0]=e[1]*i+e[0]*s,t[2]=e[1]*s-e[0]*i,t}function Br(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ti(t,e,n,i,s){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t}function w_(t,e){let n=e[0],i=e[1],s=e[2],o=e[3],r=n*n+i*i+s*s+o*o;return r>0&&(r=1/Math.sqrt(r)),t[0]=n*r,t[1]=i*r,t[2]=s*r,t[3]=o*r,t}function c9(t,e,n){n=n*.5;let i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function Sh(t,e,n,i){let s=e[0],o=e[1],r=e[2],l=e[3],a=n[0],c=n[1],f=n[2],u=n[3],m,g,v,_,b;return g=s*a+o*c+r*f+l*u,g<0&&(g=-g,a=-a,c=-c,f=-f,u=-u),1-g>1e-6?(m=Math.acos(g),v=Math.sin(m),_=Math.sin((1-i)*m)/v,b=Math.sin(i*m)/v):(_=1-i,b=i),t[0]=_*s+b*a,t[1]=_*o+b*c,t[2]=_*r+b*f,t[3]=_*l+b*u,t}function f9(t,e){let n=e[0]+e[4]+e[8],i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);let o=(s+1)%3,r=(s+2)%3;i=Math.sqrt(e[s*3+s]-e[o*3+o]-e[r*3+r]+1),t[s]=.5*i,i=.5/i,t[3]=(e[o*3+r]-e[r*3+o])*i,t[o]=(e[o*3+s]+e[s*3+o])*i,t[r]=(e[r*3+s]+e[s*3+r])*i}return t}function Am(t,e){let n=Math.sin(e[0]*.5),i=Math.cos(e[0]*.5),s=Math.sin(e[1]*.5),o=Math.cos(e[1]*.5),r=Math.sin(e[2]*.5),l=Math.cos(e[2]*.5);return t[0]=n*o*l+i*s*r,t[1]=i*s*l-n*o*r,t[2]=i*o*r-n*s*l,t[3]=i*o*l+n*s*r,t}var M_=w_;var fO=function(){let t=[0,0,0],e=[1,0,0],n=[0,1,0];return function(i,s,o){let r=dn(s,o);return r<-.999999?(Qi(t,e,s),mi(t)<1e-6&&Qi(t,n,s),Jn(t,t),c9(i,t,Math.PI),i):r>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Qi(t,s,o),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+r,M_(i,i))}}(),uO=function(){let t=[0,0,0,1],e=[0,0,0,1];return function(n,i,s,o,r,l){return Sh(t,i,r,l),Sh(e,s,o,l),Sh(n,t,e,2*l*(1-l)),n}}(),mO=function(){let t=[1,0,0,0,1,0,0,0,1];return function(e,n,i,s){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],M_(e,f9(e,t))}}();var Ah=us(),u9=()=>({parent:null,children:[],visible:!0,geometry:void 0,matrix:us(),worldMatrix:us(),position:[0,0,0],scale:[1,1,1],quaternion:[-0,-0,-0,1],rotation:[-0,-0,-0],matrixAutoUpdate:!1,matrixNeedsUpdate:!0,data:{}}),Cn=(t,e,n=!0)=>{n&&t.parent!==null&&e!==t.parent&&p9(t.parent,t,!1),t.parent=e,t.matrixNeedsUpdate=!0,n&&e&&m9(e,t,!1)},m9=(t,e,n=!0)=>{~t.children.indexOf(e)||t.children.push(e),n&&Cn(e,t,!1)},p9=(t,e,n=!0)=>{~t.children.indexOf(e)&&t.children.splice(t.children.indexOf(e),1),n&&Cn(e,null,!1)},Rt=(t,e)=>{if(!t.visible)return;let n=uo(t),i=d9(t,e,n);t.children.forEach(s=>{s.visible&&Rt(s,i)})},uo=t=>!t.matrixAutoUpdate&&!t.matrixNeedsUpdate?!1:(t.matrixNeedsUpdate=!1,Am(t.quaternion,t.rotation),Fm(t.matrix,t.quaternion,t.position,t.scale),!0),d9=(t,e,n)=>t.parent!==null?e||n?(wm(t.worldMatrix,t.parent.worldMatrix,t.matrix),!0):!1:n?(h_(t.worldMatrix,t.matrix),!0):!1,Tm=(t,e,n,i)=>{let s=Xt([0,0,0],n.position,e.position);Jn(s,s),on(t.position,e.position,s,i),t.rotation[0]=0,t.rotation[1]=Math.atan2(s[0],s[2])+1.5,t.rotation[2]=Math.sin(-s[1])+1.5,Rt(t,!1)},Ur=(t,e,n=!1,i)=>{n?Fh(Ah,t.position,e,i):Fh(Ah,e,t.position,i),y_(t.rotation,Ah)},Pm=[],rn=()=>Pm.length>0?Pm.pop():u9(),ms=t=>{h9(t),Pm.indexOf(t)<0?Pm.push(t):console.log("tried returning transform that is already known")},h9=t=>{t.data={},t.geometry=void 0,t.visible=!0,t.matrixAutoUpdate=!1,X(t.position,0,0,0),X(t.scale,1,1,1),X(t.rotation,0,0,0),Cn(t,null,!0);for(let e=0;e<t.children.length;++e)Cn(t.children[e],null);t.children.length=0};var Em=[0,0,0],Wc=(t=.1,e=100,n=45,i=1)=>{let s={near:t,far:e,fov:n,aspect:i,transform:rn(),projectionMatrix:us(),viewMatrix:us(),unprojectionViewMatrix:us(),projectionViewMatrix:us(),worldPosition:[0,0,0],frustum:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],frustumConstants:[0,0,0,0,0,0]};return s.transform.matrixAutoUpdate=!0,s},Gc=t=>{__(t.projectionMatrix,t.fov*(Math.PI/180),t.aspect,t.near,t.far)},C_=(t,e,n,i,s)=>{b_(t.projectionMatrix,e,n,i,s,t.near,t.far)},Ph=t=>{ma(t.worldPosition,t.transform.worldMatrix)},da=(t,e)=>{Rt(t.transform,e),Mh(t.viewMatrix,t.transform.worldMatrix),wm(t.projectionViewMatrix,t.projectionMatrix,t.viewMatrix),Mh(t.unprojectionViewMatrix,t.projectionViewMatrix),Ph(t)};var mo=(t,e,n)=>{let i=t.unprojectionViewMatrix,s=n[0],o=n[1],r=i[3]*s+i[7]*o+i[11]*-1+i[15];return e[0]=(i[0]*s+i[4]*o+i[8]*-1+i[12])/r,e[1]=(i[1]*s+i[5]*o+i[9]*-1+i[13])/r,e[2]=(i[2]*s+i[6]*o+i[10]*-1+i[14])/r,e},Im=t=>{let e=t.projectionViewMatrix;X(t.frustum[0],e[3]-e[0],e[7]-e[4],e[11]-e[8]),X(t.frustum[1],e[3]+e[0],e[7]+e[4],e[11]+e[8]),X(t.frustum[2],e[3]+e[1],e[7]+e[5],e[11]+e[9]),X(t.frustum[3],e[3]-e[1],e[7]-e[5],e[11]-e[9]),X(t.frustum[4],e[3]-e[2],e[7]-e[6],e[11]-e[10]),X(t.frustum[5],e[3]+e[2],e[7]+e[6],e[11]+e[10]),t.frustumConstants[0]=e[15]-e[12],t.frustumConstants[1]=e[15]+e[12],t.frustumConstants[2]=e[15]+e[13],t.frustumConstants[3]=e[15]-e[13],t.frustumConstants[4]=e[15]-e[14],t.frustumConstants[5]=e[15]+e[14];for(let n=0;n<6;n++){let i=t.frustum[n],s=1/mi(i);hn(i,i,s),t.frustumConstants[n]*=s}},S_=(t,e,n)=>{st(Em,e.bounds.center),Mi(Em,Em,n.worldMatrix);let i=e.bounds.radius*v_(n.worldMatrix);return Th(t,Em,i)},Th=(t,e,n)=>{for(let i=0;i<6;i++)if(dn(t.frustum[i],e)+t.frustumConstants[i]<-n)return!1;return!0};var Fi=document.createElement("canvas"),N=Fi.getContext("webgl2",{depth:!0,stencil:!1,premultipliedAlpha:!1,alpha:!1,antialias:!1,powerPreference:"high-performance",preserveDrawingBuffer:!0}),Dn=document.createElement("canvas"),Ci=Dn.getContext("2d",{alpha:!0}),ha=N.vertexAttribDivisor.bind(N),P_=N.drawArraysInstanced.bind(N),T_=N.drawElementsInstanced.bind(N),E_=N.createVertexArray.bind(N),Dm=N.bindVertexArray.bind(N),g9=N.deleteVertexArray.bind(N),Eh=N.getExtension("EXT_texture_filter_anisotropic"),I_=N.getExtension("WEBGL_compressed_texture_s3tc"),tt={maxTextureUnits:N.getParameter(N.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxAnisotropy:N.getParameter(Eh.MAX_TEXTURE_MAX_ANISOTROPY_EXT),blendFunc:{src:N.ONE,dst:N.ZERO,srcAlpha:0,dstAlpha:0},blendEquation:{modeRGB:N.FUNC_ADD,modeAlpha:0},frontFace:N.CCW,depthFunc:N.LESS,cullFace:null,depthMask:!0,flipY:!1,framebuffer:null,viewport:{width:-1,height:-1},textureUnits:[],activeTextureUnit:0,width:0,height:0,currentGeometry:-1,currentProgram:-1},D_=(t,e)=>{tt.width=t,tt.height=e,Fi.width=t,Fi.height=e,Dn.width=t,Dn.height=e},Hc=(t,e)=>{tt.viewport.width===t&&tt.viewport.height===e||(tt.viewport.width=t,tt.viewport.height=e,N.viewport(0,0,t,e))},Yc=t=>{tt[t]!==!0&&(N.enable(t),tt[t]=!0)},Vm=t=>{tt[t]!==!1&&(N.disable(t),tt[t]=!1)},V_=(t,e,n,i)=>{tt.blendFunc.src===t&&tt.blendFunc.dst===e&&tt.blendFunc.srcAlpha===n&&tt.blendFunc.dstAlpha===i||(tt.blendFunc.src=t,tt.blendFunc.dst=e,tt.blendFunc.srcAlpha=n,tt.blendFunc.dstAlpha=i,n!==void 0?N.blendFuncSeparate(t,e,n,i):N.blendFunc(t,e))},L_=(t,e)=>{tt.blendEquation.modeRGB===t&&tt.blendEquation.modeAlpha===e||(tt.blendEquation.modeRGB=t,tt.blendEquation.modeAlpha=e,e!==void 0?N.blendEquationSeparate(t,e):N.blendEquation(t))},q_=t=>{tt.cullFace!==t&&(tt.cullFace=t,N.cullFace(t))},R_=t=>{tt.frontFace!==t&&(tt.frontFace=t,N.frontFace(t))},Ih=t=>{tt.depthMask!==t&&(tt.depthMask=t,N.depthMask(t))},z_=t=>{tt.depthFunc!==t&&(tt.depthFunc=t,N.depthFunc(t))},Xc=t=>{tt.activeTextureUnit!==t&&(tt.activeTextureUnit=t,N.activeTexture(N.TEXTURE0+t))},A_=({target:t=N.FRAMEBUFFER,buffer:e=null}={})=>{tt.framebuffer!==e&&(tt.framebuffer=e,N.bindFramebuffer(t,e))},B_=t=>{t?(A_(t),Hc(t.width,t.height)):(A_(),Hc(tt.width,tt.height))},Dh=t=>{(!t||!t.depth)&&(Yc(N.DEPTH_TEST),Ih(!0)),N.clear(N.COLOR_BUFFER_BIT|N.DEPTH_BUFFER_BIT)};var ga=`#version 300 es
in vec2 uv;
in vec2 position;
out vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = vec4(position, 0.0, 1.0);
}`;var U_=[0,1,0],O_=[0,0,0],gt=Wc(.3,500,70),Ht=rn();Cn(gt.transform,Ht);X(gt.transform.position,0,0,-1);gt.transform.rotation[1]=Math.PI;Ht.matrixAutoUpdate=!0;function v9(t){let e;return{c(){e=h("div"),qe(e,"cursor",t[1])},m(n,i){w(n,e,i),t[2](e)},p(n,[i]){i&2&&qe(e,"cursor",n[1])},i:ae,o:ae,d(n){n&&x(e),t[2](null)}}}function _9(t,e,n){let i;se(t,um,r=>n(1,i=r));let s;Fn(()=>{s.appendChild(Fi),s.appendChild(Dn)});function o(r){Bt[r?"unshift":"push"](()=>{s=r,n(0,s)})}return[s,i,o]}var Vh=class extends xe{constructor(e){super(),Ce(this,e,_9,v9,Ue,{})}},$_=Vh;function N_(t){let e,n,i,s,o;return{c(){e=h("div"),n=h("img"),p(n,"class",i=Vo(t[2].css)+" svelte-fc7xg3"),lt(n.src,s=t[2].img)||p(n,"src",s),p(e,"class",o="container border "+t[2].border+" svelte-fc7xg3"),qe(e,"top",t[1]+"px"),qe(e,"left",t[0]+"px")},m(r,l){w(r,e,l),d(e,n)},p(r,l){l&4&&i!==(i=Vo(r[2].css)+" svelte-fc7xg3")&&p(n,"class",i),l&4&&!lt(n.src,s=r[2].img)&&p(n,"src",s),l&4&&o!==(o="container border "+r[2].border+" svelte-fc7xg3")&&p(e,"class",o),l&2&&qe(e,"top",r[1]+"px"),l&1&&qe(e,"left",r[0]+"px")},d(r){r&&x(e)}}}function b9(t){let e,n=t[2]&&t[0]&&t[1]&&N_(t);return{c(){n&&n.c(),e=he()},m(i,s){n&&n.m(i,s),w(i,e,s)},p(i,[s]){i[2]&&i[0]&&i[1]?n?n.p(i,s):(n=N_(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(i){i&&x(e),n&&n.d(i)}}}function y9(t,e,n){let i;se(t,En,l=>n(2,i=l));let s,o,r=l=>{(i||s||o)&&(i?(n(0,s=l.clientX-10),n(1,o=l.clientY-10)):(n(0,s=0),n(1,o=0)))};return Fn(()=>{document.addEventListener("mousemove",r,!1)}),Tn(()=>{document.removeEventListener("mousemove",r)}),[s,o,i]}var Lh=class extends xe{constructor(e){super(),Ce(this,e,y9,b9,Ue,{})}},j_=Lh;var W_=(t,e,n)=>n.items[t][t=="book"?Math.floor(e/5):e],G_=(t,e,n)=>W_(t,e,n).name+(t=="book"?" Lv. "+(e%5+1):""),H_=(t,e,n)=>W_(t,e,n).description;var Hs={};Qn(Hs,{activeWorld:()=>Or,alwaysShowLevel:()=>Xm,ambienceVolume:()=>ef,anisotropy:()=>Kc,audioVolume:()=>Wr,audioVolumeLowered:()=>Gr,bloom:()=>zm,buffCdFlashingDuration:()=>gf,buffCdFlashingInterval:()=>hf,buffcountParty:()=>_f,buffcountUnitframes:()=>vf,buffsHideIrrelevant:()=>cp,cameraZoom:()=>Om,cdTextBuffs:()=>rp,cdTextSkills:()=>op,charpanelOpen:()=>_o,chat:()=>af,chatbubbles:()=>ep,clanOpen:()=>go,classColorBars:()=>Zm,combatTextPush:()=>Qm,command:()=>Ws,current:()=>re,disableoffscreen:()=>qm,dpsmeterMode:()=>lf,dpsmeterOpen:()=>Qr,dpsmeterParty:()=>rf,dpsmeterTarget:()=>Zr,expmeterOpen:()=>of,filteredChannels:()=>ff,fogpattern:()=>Um,foliage:()=>Zc,fov:()=>Nr,fxaa:()=>Lm,inventoryCols:()=>Yr,inventoryOpen:()=>po,invertMouseX:()=>fp,invertMouseY:()=>up,itemProtectQuality:()=>pf,itemQualityFilter:()=>mf,itemQualityPercent:()=>sp,itemTypeFilter:()=>uf,itemmeterOpen:()=>sf,kbAltBack:()=>J_,kbAltForward:()=>Z_,kbBack:()=>eb,kbCharacter:()=>lb,kbClan:()=>cb,kbForward:()=>Y_,kbInventory:()=>ab,kbLeft:()=>K_,kbMap:()=>ob,kbNextParty:()=>ib,kbNextTarget:()=>nb,kbParty:()=>ub,kbPvp:()=>fb,kbRight:()=>tb,kbSkillbar1:()=>mb,kbSkillbar10:()=>kb,kbSkillbar11:()=>xb,kbSkillbar12:()=>wb,kbSkillbar13:()=>Mb,kbSkillbar14:()=>Fb,kbSkillbar15:()=>Cb,kbSkillbar16:()=>Sb,kbSkillbar17:()=>Ab,kbSkillbar18:()=>Pb,kbSkillbar19:()=>Tb,kbSkillbar2:()=>pb,kbSkillbar20:()=>Eb,kbSkillbar21:()=>Ib,kbSkillbar22:()=>Db,kbSkillbar23:()=>Vb,kbSkillbar24:()=>Lb,kbSkillbar3:()=>db,kbSkillbar4:()=>hb,kbSkillbar5:()=>gb,kbSkillbar6:()=>vb,kbSkillbar7:()=>_b,kbSkillbar8:()=>bb,kbSkillbar9:()=>yb,kbSkills:()=>rb,kbTurnLeft:()=>X_,kbTurnRight:()=>Q_,kbUntarget:()=>sb,lang:()=>Hr,lastConnectedChar:()=>Qc,lockedcamera:()=>mp,mapLowQuality:()=>Km,mapShowMonsters:()=>Jm,mouseSensitivity:()=>yf,musicVolume:()=>tf,nameShowEnemyPlayers:()=>Hm,nameShowFriendlyPlayers:()=>Gm,nameShowMonsters:()=>Wm,nameplateShowEnemyPlayers:()=>jm,nameplateShowFriendlyPlayers:()=>Nm,nameplateShowMonsters:()=>$m,nameplateShowTransparency:()=>Ym,nameplateViewRange:()=>cf,nextFriendlyTargetAllowNonParty:()=>dp,nextFriendlyTargetCycle:()=>kf,particles:()=>Bm,partyBuffLimitUpdateRate:()=>lp,partyOpen:()=>Zi,partyWidth:()=>Jr,pointerlock:()=>pp,pvpOpen:()=>vo,registerSetting:()=>qb,resolution:()=>jr,settingsOpen:()=>Xr,shadowmapResolution:()=>Jc,shadows:()=>Rm,showFpsPing:()=>ba,showIncomingDamage:()=>np,showIncomingHeal:()=>tp,showIncomingMana:()=>ip,showPartyMana:()=>ya,showSelfInParty:()=>ap,skillConfigs:()=>ka,skillPresetVisible:()=>bf,skillbarAmount:()=>Kr,skillbarsettings:()=>bo,skillmenuOpen:()=>ho,stashCols:()=>Ho,stashHeight:()=>Yo,stashShowGroups:()=>va,stashShowSettings:()=>nf,subscriptionOpen:()=>qi,tutprogress:()=>Gs,twitchOpen:()=>_a,viewRange:()=>$r,windowSettings:()=>df});var qh={};Qn(qh,{activeWorld:()=>Or,alwaysShowLevel:()=>Xm,ambienceVolume:()=>ef,anisotropy:()=>Kc,audioVolume:()=>Wr,audioVolumeLowered:()=>Gr,bloom:()=>zm,buffCdFlashingDuration:()=>gf,buffCdFlashingInterval:()=>hf,buffcountParty:()=>_f,buffcountUnitframes:()=>vf,buffsHideIrrelevant:()=>cp,cameraZoom:()=>Om,cdTextBuffs:()=>rp,cdTextSkills:()=>op,charpanelOpen:()=>_o,chat:()=>af,chatbubbles:()=>ep,clanOpen:()=>go,classColorBars:()=>Zm,combatTextPush:()=>Qm,command:()=>Ws,disableoffscreen:()=>qm,dpsmeterMode:()=>lf,dpsmeterOpen:()=>Qr,dpsmeterParty:()=>rf,dpsmeterTarget:()=>Zr,expmeterOpen:()=>of,filteredChannels:()=>ff,fogpattern:()=>Um,foliage:()=>Zc,fov:()=>Nr,fxaa:()=>Lm,inventoryCols:()=>Yr,inventoryOpen:()=>po,invertMouseX:()=>fp,invertMouseY:()=>up,itemProtectQuality:()=>pf,itemQualityFilter:()=>mf,itemQualityPercent:()=>sp,itemTypeFilter:()=>uf,itemmeterOpen:()=>sf,kbAltBack:()=>J_,kbAltForward:()=>Z_,kbBack:()=>eb,kbCharacter:()=>lb,kbClan:()=>cb,kbForward:()=>Y_,kbInventory:()=>ab,kbLeft:()=>K_,kbMap:()=>ob,kbNextParty:()=>ib,kbNextTarget:()=>nb,kbParty:()=>ub,kbPvp:()=>fb,kbRight:()=>tb,kbSkillbar1:()=>mb,kbSkillbar10:()=>kb,kbSkillbar11:()=>xb,kbSkillbar12:()=>wb,kbSkillbar13:()=>Mb,kbSkillbar14:()=>Fb,kbSkillbar15:()=>Cb,kbSkillbar16:()=>Sb,kbSkillbar17:()=>Ab,kbSkillbar18:()=>Pb,kbSkillbar19:()=>Tb,kbSkillbar2:()=>pb,kbSkillbar20:()=>Eb,kbSkillbar21:()=>Ib,kbSkillbar22:()=>Db,kbSkillbar23:()=>Vb,kbSkillbar24:()=>Lb,kbSkillbar3:()=>db,kbSkillbar4:()=>hb,kbSkillbar5:()=>gb,kbSkillbar6:()=>vb,kbSkillbar7:()=>_b,kbSkillbar8:()=>bb,kbSkillbar9:()=>yb,kbSkills:()=>rb,kbTurnLeft:()=>X_,kbTurnRight:()=>Q_,kbUntarget:()=>sb,lang:()=>Hr,lastConnectedChar:()=>Qc,lockedcamera:()=>mp,mapLowQuality:()=>Km,mapShowMonsters:()=>Jm,mouseSensitivity:()=>yf,musicVolume:()=>tf,nameShowEnemyPlayers:()=>Hm,nameShowFriendlyPlayers:()=>Gm,nameShowMonsters:()=>Wm,nameplateShowEnemyPlayers:()=>jm,nameplateShowFriendlyPlayers:()=>Nm,nameplateShowMonsters:()=>$m,nameplateShowTransparency:()=>Ym,nameplateViewRange:()=>cf,nextFriendlyTargetAllowNonParty:()=>dp,nextFriendlyTargetCycle:()=>kf,particles:()=>Bm,partyBuffLimitUpdateRate:()=>lp,partyOpen:()=>Zi,partyWidth:()=>Jr,pointerlock:()=>pp,pvpOpen:()=>vo,resolution:()=>jr,settingsOpen:()=>Xr,shadowmapResolution:()=>Jc,shadows:()=>Rm,showFpsPing:()=>ba,showIncomingDamage:()=>np,showIncomingHeal:()=>tp,showIncomingMana:()=>ip,showPartyMana:()=>ya,showSelfInParty:()=>ap,skillConfigs:()=>ka,skillPresetVisible:()=>bf,skillbarAmount:()=>Kr,skillbarsettings:()=>bo,skillmenuOpen:()=>ho,stashCols:()=>Ho,stashHeight:()=>Yo,stashShowGroups:()=>va,stashShowSettings:()=>nf,subscriptionOpen:()=>qi,tutprogress:()=>Gs,twitchOpen:()=>_a,viewRange:()=>$r,windowSettings:()=>df});var Or=ie(""),Qc=ie(0),$r=ie(60),Nr=ie(70),jr=ie(100),Zc=ie(100),Jc=ie(2),Lm=ie(!0),qm=ie(!0),Rm=ie(!0),zm=ie(!0),Bm=ie(!0),Kc=ie(4),Um=ie(!0),ef=ie(40),Wr=ie(70),Gr=ie(80),tf=ie(30),Hr=ie("en"),Ws=ie("faction"),Ho=ie(8),Yo=ie(300),va=ie(2),nf=ie(!1),Yr=ie(5),po=ie(!1),Xr=ie(!1),ho=ie(!1),Qr=ie(!1),sf=ie(!0),of=ie(!0),_a=ie(!0),qi=ie(!1),Zi=ie(!1),go=ie(!1),vo=ie(!1),rf=ie(!0),lf=ie(0),Zr=ie(0),_o=ie(!1),bo=ie({}),af=ie([0,0,0,0,0,0,1,1,1,1,1,1]),Om=ie(7),cf=ie(100),$m=ie(!0),Nm=ie(!0),jm=ie(!0),Wm=ie(!0),Gm=ie(!0),Hm=ie(!0),Ym=ie(!0),Xm=ie(!1),Qm=ie(!0),Zm=ie(!1),Jm=ie(!0),Km=ie(!1),Gs=ie(0),ep=ie(!0),tp=ie(!0),np=ie(!0),ip=ie(!0),ff=ie([]),uf=ie(""),mf=ie(0),sp=ie(!1),ba=ie(!1),pf=ie(70),df=ie([]),op=ie(!0),rp=ie(!0),hf=ie(.5),gf=ie(3),lp=ie(!0),Jr=ie(200),ap=ie(!0),ya=ie(!1),vf=ie(14),_f=ie(8),cp=ie(!1),ka=ie([]),bf=ie(!1),yf=ie(1),fp=ie(!1),up=ie(!1),mp=ie(!0),pp=ie(!0),dp=ie(!0),kf=ie(10),Y_=ie("w"),X_=ie("arrowleft"),Q_=ie("arrowright"),Z_=ie("arrowup"),J_=ie("arrowdown"),K_=ie("a"),eb=ie("s"),tb=ie("d"),nb=ie("tab"),ib=ie("x"),sb=ie("escape"),ob=ie("m"),rb=ie("k"),lb=ie("c"),ab=ie("b"),cb=ie("g"),fb=ie("v"),ub=ie("p"),mb=ie("1"),pb=ie("2"),db=ie("3"),hb=ie("4"),gb=ie("5"),vb=ie("6"),_b=ie("7"),bb=ie("8"),yb=ie("9"),kb=ie("0"),xb=ie(""),wb=ie(""),Mb=ie(""),Fb=ie(""),Cb=ie(""),Sb=ie(""),Ab=ie(""),Pb=ie(""),Tb=ie(""),Eb=ie(""),Ib=ie(""),Db=ie(""),Vb=ie(""),Lb=ie(""),Kr=ie(12);var Rh;Rh={...qh};var qb=(t,e)=>{{let n=localStorage.getItem(t),i=JSON.parse(n=="undefined"?null:n);i!==null&&e.set(i)}e.subscribe(n=>{re[t]=n,localStorage.setItem(t,JSON.stringify(n))})},re={};for(let t in Rh)qb(t,Rh[t]);var C;Hr.subscribe(async t=>{await fetch(`/data/loc/${t}.json?v=8602459`).then(async e=>{C=await e.json(),fm.set(!0)})});var tn=(t,e)=>G_(t,e,C),zh=(t,e)=>H_(t,e,C);function Rb(t,e,n){let i=t.slice();return i[6]=e[n],i}function zb(t){let e,n,i=me(t[2].opts),s=[];for(let r=0;r<i.length;r+=1)s[r]=Ob(Rb(t,i,r));let o=null;return i.length||(o=Bb(t)),{c(){e=h("div");for(let r=0;r<s.length;r+=1)s[r].c();o&&o.c(),p(e,"class","panel context border grey"),p(e,"style",n="left:"+t[2].x+"px; top:"+t[2].y+"px; "+(t[2].right?"transform: translateX(-100%);":"")+";")},m(r,l){w(r,e,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null);o&&o.m(e,null),t[4](e)},p(r,l){if(l&5){i=me(r[2].opts);let a;for(a=0;a<i.length;a+=1){let c=Rb(r,i,a);s[a]?s[a].p(c,l):(s[a]=Ob(c),s[a].c(),s[a].m(e,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=i.length,!i.length&&o?o.p(r,l):i.length?o&&(o.d(1),o=null):(o=Bb(r),o.c(),o.m(e,null))}l&4&&n!==(n="left:"+r[2].x+"px; top:"+r[2].y+"px; "+(r[2].right?"transform: translateX(-100%);":"")+";")&&p(e,"style",n)},d(r){r&&x(e),it(s,r),o&&o.d(),t[4](null)}}}function Bb(t){let e;return{c(){e=h("div"),e.textContent=`${C.ui.noOptions}`,p(e,"class","choice disabled")},m(n,i){w(n,e,i)},p:ae,d(n){n&&x(e)}}}function Ub(t){let e,n;return{c(){e=h("img"),p(e,"class","svgicon"),lt(e.src,n="/data/ui/icons/"+t[6].icon+".svg?v=8602459")||p(e,"src",n)},m(i,s){w(i,e,s)},p(i,s){s&4&&!lt(e.src,n="/data/ui/icons/"+i[6].icon+".svg?v=8602459")&&p(e,"src",n)},d(i){i&&x(e)}}}function Ob(t){let e,n=t[6].name+"",i,s,o,r,l=t[6].icon&&Ub(t);function a(...c){return t[3](t[6],...c)}return{c(){e=h("div"),l&&l.c(),i=T(n),p(e,"class",s="choice "+(t[6].css||""))},m(c,f){w(c,e,f),l&&l.m(e,null),d(e,i),o||(r=Y(e,"mouseup",a),o=!0)},p(c,f){t=c,t[6].icon?l?l.p(t,f):(l=Ub(t),l.c(),l.m(e,i)):l&&(l.d(1),l=null),f&4&&n!==(n=t[6].name+"")&&G(i,n),f&4&&s!==(s="choice "+(t[6].css||""))&&p(e,"class",s)},d(c){c&&x(e),l&&l.d(),o=!1,r()}}}function k9(t){let e,n=t[2]&&zb(t);return{c(){n&&n.c(),e=he()},m(i,s){n&&n.m(i,s),w(i,e,s)},p(i,[s]){i[2]?n?n.p(i,s):(n=zb(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(i){i&&x(e),n&&n.d(i)}}}function x9(t,e,n){let i;se(t,bn,c=>n(2,i=c));let s,o=c=>{c.target!=s&&c.target.parentNode!=s&&i&&bn.set(void 0)},r=(c,f)=>{f.fun(c),bn.set(void 0)};Fn(()=>{document.addEventListener("pointerdown",o,!1)}),Tn(()=>{document.removeEventListener("pointerdown",o)});let l=(c,f)=>r(f,c);function a(c){Bt[c?"unshift":"push"](()=>{s=c,n(1,s)})}return[r,s,i,l,a]}var Bh=class extends xe{constructor(e){super(),Ce(this,e,x9,k9,Ue,{opt:0})}get opt(){return this.$$.ctx[0]}},$b=Bh;var B=0,Nb={string:t=>{let e=Xb(t);return Ji(e)+e},varuint:t=>Ji(t),varint:t=>w9(t),buffer8:t=>{let e=t.length;return Ji(e)+e},buffer16:(t,e)=>{let n=t.length*2,i=Ji(n);return(e+i)%2==1&&i++,i+n}};var ge=t=>{let e=0,n=0,i=0;do i=t[B++],e|=(i&127)<<7*n,n++;while(i&128);return e};var Xo=(t,e)=>{for(;e>127;)t[B++]=e&127|128,e>>=7;t[B++]=e&127},Ji=t=>t<=0?1:Math.floor(Math.log(t)/Math.log(128))+1,w9=t=>Ji(t<<1^t>>31),ps=t=>t[B]&128?(255-t[B]+1)*-1:t[B],M9=(t,e)=>{e<0&&(e=255+e+1),t[B]=e&255,B+=1},De=t=>t[B],Xs=(t,e)=>{t[B]=e,B+=1},hp=t=>{let e=t[B]|t[B+1]<<8;return e&32768?e|4294901760:e},gp=(t,e)=>{t[B]=e&255,t[B+1]=e>>>8,B+=2},It=t=>t[B]|t[B+1]<<8;var Ys=t=>(t[B]|t[B+1]<<8|t[B+2]<<16)+t[B+3]*16777216,Gb=(t,e)=>{t[B]=e&255,t[B+1]=e>>>8,t[B+2]=e>>>16,t[B+3]=e>>>24,B+=4},Uh=new ArrayBuffer(8),Qo=new Uint8Array(Uh),Hb=new Float32Array(Uh),NO=new Float64Array(Uh),rt=t=>(Qo[0]=t[B],Qo[1]=t[B+1],Qo[2]=t[B+2],Qo[3]=t[B+3],Hb[0]),Yb=(t,e)=>{Hb[0]=e,t[B]=Qo[0],t[B+1]=Qo[1],t[B+2]=Qo[2],t[B+3]=Qo[3],B+=4};var jb=t=>{let e=ge(t);B%2==1&&B++;let n=new Uint16Array(t.buffer,B,e/2);return B+=e,n},Xb=t=>{let e=t.length;for(let n=t.length-1;n>=0;n--){let i=t.charCodeAt(n);i>127&&i<=2047?e++:i>2047&&i<=65535&&(e+=2),i>=56320&&i<=57343&&n--}return e},Wb=(t,e)=>{let n=Xb(e);Xo(t,n);for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[B++]=s:s<2048?(t[B++]=s>>6|192,t[B++]=s&63|128):(s&64512)==55296&&i+1<e.length&&(e.charCodeAt(i+1)&64512)==56320?(s=65536+((s&1023)<<10)+(e.charCodeAt(++i)&1023),t[B++]=s>>18|240,t[B++]=s>>12&63|128,t[B++]=s>>6&63|128,t[B++]=s&63|128):(t[B++]=s>>12|224,t[B++]=s>>6&63|128,t[B++]=s&63|128)}},Vn=t=>{let e=ge(t),n="",i=B+e;for(;B<i;){let s=t[B++];if(s<128)n+=String.fromCharCode(s);else if(s>191&&s<224){let o=t[B++];n+=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){let o=t[B++],r=t[B++],l=t[B++],a=((s&7)<<18|(o&63)<<12|(r&63)<<6|l&63)-65536;n+=String.fromCharCode(55296+(a>>10)),n+=String.fromCharCode(56320+(a&1023))}else{let o=t[B++],r=t[B++];n+=String.fromCharCode((s&15)<<12|(o&63)<<6|r&63)}}return n},Qb={encode:t=>{let e=t,n=e.doubles,i=e.int8s,s=e.uint16s,o=e.uint8s,r=0;r+=1,r+=Ji(n.length);for(let a=0;a<n.length;a++)r+=4;r+=Ji(i.length);for(let a=0;a<i.length;a++)r+=1;r+=Ji(s.length);for(let a=0;a<s.length;a++)r+=2;r+=Ji(o.length);for(let a=0;a<o.length;a++)r+=1;let l=new Uint8Array(r);B=0,Xs(l,e._header),Xo(l,n.length);for(let a=0;a<n.length;a++)Yb(l,n[a]);Xo(l,i.length);for(let a=0;a<i.length;a++)M9(l,i[a]);Xo(l,s.length);for(let a=0;a<s.length;a++)gp(l,s[a]);Xo(l,o.length);for(let a=0;a<o.length;a++)Xs(l,o[a]);return l}},Zb={encode:t=>{let e=t,n=0;n+=1,n+=2;let i=new Uint8Array(n);return B=0,Xs(i,e._header),gp(i,e.target),i}},Jb={encode:t=>{let e=t,n=e.info,i=0;i+=1,i+=2,i+=Ji(n.length);for(let o=0;o<n.length;o++)i+=4;let s=new Uint8Array(i);B=0,Xs(s,e._header),gp(s,e.id),Xo(s,n.length);for(let o=0;o<n.length;o++)Gb(s,n[o]);return s}},Kb={encode:t=>{let e=t,n=e.info,i=e.pos,s=0;s+=1,s+=2,s+=Ji(n.length);for(let r=0;r<n.length;r++)s+=4;s+=Ji(i.length);for(let r=0;r<i.length;r++)s+=4;let o=new Uint8Array(s);B=0,Xs(o,e._header),gp(o,e.id),Xo(o,n.length);for(let r=0;r<n.length;r++)Gb(o,n[r]);Xo(o,i.length);for(let r=0;r<i.length;r++)Yb(o,i[r]);return o}},e3={encode:t=>{let e=t,n=0;n+=1,n+=1;let i=new Uint8Array(n);return B=0,Xs(i,e._header),Xs(i,e.id),i}},t3={encode:t=>{let e=t,n=0;n+=1,n+=Nb.string(e.command,n),n+=Nb.string(e.string,n);let i=new Uint8Array(n);return B=0,Xs(i,e._header),Wb(i,e.command),Wb(i,e.string),i}},n3={decode:t=>{let e=t,n={};B=0,n._header=De(e),B+=1;let i=[];n.inputs=i;let s=ge(e);for(let u=0;u<s;u++){let m={};i[u]=m,m.id=It(e),B+=2,m.jump=De(e),B+=1,m.rot=rt(e),B+=4,m.speed=It(e),B+=2;let g=[];m.steer=g,g[0]=ps(e),B+=1;let v=ge(e);for(let _=1;_<v;_++)g[_]=ps(e),B+=1}let o=[];n.log=o;let r=ge(e);for(let u=0;u<r;u++){let m={};o[u]=m;let g=[];m.data=g;let v=ge(e);for(let _=0;_<v;_++)g[_]=ge(e);m.type=De(e),B+=1}let l=[];n.logPersonal=l;let a=ge(e);for(let u=0;u<a;u++){let m={};l[u]=m;let g=[];m.data=g;let v=ge(e);for(let _=0;_<v;_++)g[_]=ge(e);m.type=De(e),B+=1}let c=[];n.movements=c;let f=ge(e);for(let u=0;u<f;u++){let m={};c[u]=m,m.id=It(e),B+=2;let g=[];m.pos=g,g[0]=rt(e),B+=4,g[1]=rt(e),B+=4;let v=ge(e);for(let y=2;y<v;y++)g[y]=rt(e),B+=4;let _=[];m.vel=_,_[0]=rt(e),B+=4,_[1]=rt(e),B+=4;let b=ge(e);for(let y=2;y<b;y++)_[y]=rt(e),B+=4}return n.tickId=Ys(e),B+=4,n}},i3={decode:t=>{let e=t,n={};B=0,n._header=De(e),B+=1;let i=[];n.members=i;let s=ge(e);for(let l=0;l<s;l++){let a={};i[l]=a,a.class=De(e),B+=1,a.entityid=It(e),B+=2,a.level=De(e),B+=1,a.name=Vn(e),a.role=It(e),B+=2,a.world=Vn(e)}let o=[];n.queues=o;let r=ge(e);for(let l=0;l<r;l++)o[l]=Vn(e);return n}},s3={decode:t=>{let e=t,n={};B=0,n._header=De(e),B+=1,n.contrib=ge(e);let i=[];n.contributors=i;let s=ge(e);for(let l=0;l<s;l++){let a={};i[l]=a,a.class=De(e),B+=1,a.faction=De(e),B+=1,a.level=De(e),B+=1,a.name=Vn(e);let c=[];a.stats=c;let f=ge(e);for(let u=0;u<f;u++)c[u]=ge(e)}n.duration=ge(e);let o=[];n.kills=o,o[0]=ge(e);let r=ge(e);for(let l=1;l<r;l++)o[l]=ge(e);return n.level=ge(e),n.reward=ge(e),n.status=De(e),B+=1,n}},o3={decode:t=>{let e=t,n={};B=0,n._header=De(e),B+=1;let i=[];n.members=i;let s=ge(e);for(let o=0;o<s;o++){let r={};i[o]=r,r.entityid=It(e),B+=2;let l=[];r.pos=l;let a=ge(e);for(let c=0;c<a;c++)l[c]=It(e),B+=2}return n}},r3={decode:t=>{let e=t,n={};B=0,n._header=De(e),B+=1;let i=[];n.icons=i;let s=ge(e);for(let o=0;o<s;o++){let r={};i[o]=r,r.blink=!!ps(e),B+=1,r.id=It(e),B+=2;let l=[];r.pos=l,l[0]=It(e),B+=2;let a=ge(e);for(let c=1;c<a;c++)l[c]=It(e),B+=2}return n}},l3={decode:t=>{let e=t,n={};B=0,n._header=De(e),B+=1,n.channel=Vn(e),n.clan=Vn(e),n.class=De(e),B+=1,n.faction=De(e),B+=1,n.from=Vn(e),n.id=Ys(e),B+=4;let i=[];n.items=i;let s=ge(e);for(let o=0;o<s;o++){let r={};i[o]=r,r.id=Ys(e),B+=4,r.index=It(e),B+=2;let l=[];r.rolls=l;let a=ge(e);for(let c=0;c<a;c++)l[c]=It(e),B+=2;r.stacks=De(e),B+=1,r.tier=It(e),B+=2,r.type=Vn(e),r.upgrade=It(e),B+=2}return n.level=De(e),B+=1,n.message=Vn(e),n.subscribed=De(e),B+=1,n}},a3={decode:t=>{let e=t,n={};return B=0,n._header=De(e),B+=1,n.world=Vn(e),n}},c3={decode:t=>{let e=t,n={};B=0,n._header=De(e),B+=1;let i=[];n.messages=i;let s=ge(e);for(let o=0;o<s;o++){let r={};i[o]=r,r.message=Vn(e),r.type=Vn(e)}return n}},f3={decode:t=>{let e=t,n={};return B=0,n._header=De(e),B+=1,n.file=Vn(e),n.playerId=It(e),B+=2,n.tickId=Ys(e),B+=4,n.world=Vn(e),n}},u3={decode:t=>{let e=t,n={};return B=0,n._header=De(e),B+=1,n.pos=It(e),B+=2,n}},m3={decode:t=>{let e=t,n={};return B=0,n._header=De(e),B+=1,n.id=De(e),B+=1,n},encode:t=>{let e=t,n=0;n+=1,n+=1;let i=new Uint8Array(n);return B=0,Xs(i,e._header),Xs(i,e.id),i}};var p3={decode:t=>{let e=t,n={};B=0;let i=[];n.aabb=i;let s=ge(e);for(let F=0;F<s;F++)i[F]=rt(e),B+=4;let o=[];n.area=o;let r=ge(e);for(let F=0;F<r;F++)o[F]=It(e),B+=2;let l=[];n.environment=l;let a=ge(e);for(let F=0;F<a;F++)l[F]=It(e),B+=2;let c=[];n.holes=c;let f=ge(e);for(let F=0;F<f;F++)c[F]=It(e),B+=2;let u=[];n.props=u;let m=ge(e);for(let F=0;F<m;F++){let M={};u[F]=M,M.id=Ys(e),B+=4,M.rx=hp(e),B+=2,M.ry=hp(e),B+=2,M.rz=hp(e),B+=2,M.scale=It(e),B+=2,M.x=It(e),B+=2,M.y=Ys(e),B+=4,M.z=It(e),B+=2}let g=[];n.shore=g;let v=ge(e);for(let F=0;F<v;F++)g[F]=It(e),B+=2;n.terrain=jb(e);let _=[];n.texture=_;let b=ge(e);for(let F=0;F<b;F++)_[F]=jb(e);let y=[];n.textureid=y;let k=ge(e);for(let F=0;F<k;F++){let M=[];y[F]=M;let D=ge(e);for(let R=0;R<D;R++)M[R]=It(e),B+=2}let A=[];n.water=A;let S=ge(e);for(let F=0;F<S;F++)A[F]=It(e),B+=2;return n}},d3={decode:t=>{let e=t,n={};B=0;let i=[];n.color=i;let s=ge(e);for(let y=0;y<s;y++)i[y]=De(e),B+=1;let o=[];n.flags=o;let r=ge(e);for(let y=0;y<r;y++)o[y]=De(e),B+=1;let l=[];n.index=l;let a=ge(e);for(let y=0;y<a;y++)l[y]=ge(e);let c=[];n.indexInvisible=c;let f=ge(e);for(let y=0;y<f;y++)c[y]=ge(e);let u=[];n.normal=u;let m=ge(e);for(let y=0;y<m;y++)u[y]=ps(e),B+=1;let g=[];n.position=g;let v=ge(e);for(let y=0;y<v;y++)g[y]=hp(e),B+=2;n.sx=Ys(e),B+=4,n.sy=Ys(e),B+=4,n.sz=Ys(e),B+=4;let _=[];n.uv=_;let b=ge(e);for(let y=0;y<b;y++)_[y]=It(e),B+=2;return n}},h3={decode:t=>{let e=t,n={};B=0;let i=[];n.animations=i;let s=ge(e);for(let Q=0;Q<s;Q++){let $={};i[Q]=$,$.duration=rt(e),B+=4;let le=[];$.effects=le;let je=ge(e);for(let Re=0;Re<je;Re++){let Oe={};le[Re]=Oe,Oe.body=De(e),B+=1,Oe.end=rt(e),B+=4,Oe.id=De(e),B+=1,Oe.priority=De(e),B+=1,Oe.start=rt(e),B+=4,Oe.type=De(e),B+=1}$.id=De(e),B+=1,$.movement=De(e),B+=1,$.priority=De(e),B+=1;let Ve=[];$.sounds=Ve;let ke=ge(e);for(let Re=0;Re<ke;Re++){let Oe={};Ve[Re]=Oe,Oe.end=De(e),B+=1,Oe.id=De(e),B+=1,Oe.start=rt(e),B+=4}}let o=[];n.areas=o;let r=ge(e);for(let Q=0;Q<r;Q++){let $={};o[Q]=$,$.ambientday=De(e),B+=1,$.ambientnight=De(e),B+=1,$.id=De(e),B+=1,$.music=De(e),B+=1,$.name=Vn(e)}let l=[];n.arenas=l;let a=ge(e);for(let Q=0;Q<a;Q++){let $={};l[Q]=$,$.group=De(e),B+=1,$.id=De(e),B+=1;let le=[];$.pos=le;let je=ge(e);for(let Ve=0;Ve<je;Ve++)le[Ve]=rt(e),B+=4;$.radius=De(e),B+=1,$.rot=rt(e),B+=4,$.type=De(e),B+=1,$.world=De(e),B+=1}let c=[];n.classes=c;let f=ge(e);for(let Q=0;Q<f;Q++){let $={};c[Q]=$;let le=[];$.baseStats=le;let je=ge(e);for(let Je=0;Je<je;Je++){let Et=[];le[Je]=Et;let ye=ge(e);for(let Ke=0;Ke<ye;Ke++)Et[Ke]=De(e),B+=1}let Ve=[];$.engineSkills=Ve;let ke=ge(e);for(let Je=0;Je<ke;Je++)Ve[Je]=De(e),B+=1;$.id=De(e),B+=1;let Re=[];$.startSkills=Re;let Oe=ge(e);for(let Je=0;Je<Oe;Je++)Re[Je]=De(e),B+=1;let pt=[];$.statPerLevel=pt;let wt=ge(e);for(let Je=0;Je<wt;Je++){let Et=[];pt[Je]=Et;let ye=ge(e);for(let Ke=0;Ke<ye;Ke++)Et[Ke]=De(e),B+=1}}let u=[];n.creatures=u;let m=ge(e);for(let Q=0;Q<m;Q++){let $={};u[Q]=$;let le=[];$.col1=le;let je=ge(e);for(let Re=0;Re<je;Re++)le[Re]=rt(e),B+=4;let Ve=[];$.col2=Ve;let ke=ge(e);for(let Re=0;Re<ke;Re++)Ve[Re]=rt(e),B+=4;$.drProtection=!!ps(e),B+=1,$.faction=De(e),B+=1,$.id=It(e),B+=2,$.level=De(e),B+=1,$.name=Vn(e),$.skin=De(e),B+=1,$.type=De(e),B+=1}let g=[];n.creaturesConjurer=g;let v=ge(e);for(let Q=0;Q<v;Q++){let $={};g[Q]=$,$.id=It(e),B+=2,$.war=!!ps(e),B+=1}let _=[];n.creaturesMonster=_;let b=ge(e);for(let Q=0;Q<b;Q++){let $={};_[Q]=$,$.aggroMode=De(e),B+=1,$.id=It(e),B+=2,$.rarity=De(e),B+=1}let y=[];n.creaturesTrader=y;let k=ge(e);for(let Q=0;Q<k;Q++){let $={};y[Q]=$,$.id=It(e),B+=2,$.shop=De(e),B+=1}let A=[];n.effects=A;let S=ge(e);for(let Q=0;Q<S;Q++){let $={};A[Q]=$,$.duration=rt(e),B+=4;let le=[];$.events=le;let je=ge(e);for(let Re=0;Re<je;Re++){let Oe={};le[Re]=Oe,Oe.fraction=rt(e),B+=4,Oe.id=De(e),B+=1;let pt=[];Oe.params=pt;let wt=ge(e);for(let Je=0;Je<wt;Je++)pt[Je]=rt(e),B+=4}$.id=De(e),B+=1;let Ve=[];$.periods=Ve;let ke=ge(e);for(let Re=0;Re<ke;Re++){let Oe={};Ve[Re]=Oe,Oe.fractionEnd=rt(e),B+=4,Oe.fractionStart=rt(e),B+=4,Oe.id=De(e),B+=1;let pt=[];Oe.modifiers=pt;let wt=ge(e);for(let ye=0;ye<wt;ye++){let Ke={};pt[ye]=Ke,Ke.id=De(e),B+=1,Ke.mode=De(e),B+=1;let yt=[];Ke.params=yt;let St=ge(e);for(let Te=0;Te<St;Te++)yt[Te]=rt(e),B+=4}let Je=[];Oe.params=Je;let Et=ge(e);for(let ye=0;ye<Et;ye++)Je[ye]=rt(e),B+=4}}let F=[];n.environments=F;let M=ge(e);for(let Q=0;Q<M;Q++){let $={};F[Q]=$;let le=[];$.ambient=le;let je=ge(e);for(let Se=0;Se<je;Se++){let ot=[];le[Se]=ot;let Ze=ge(e);for(let ut=0;ut<Ze;ut++)ot[ut]=rt(e),B+=4}let Ve=[];$.bloom=Ve;let ke=ge(e);for(let Se=0;Se<ke;Se++)Ve[Se]=rt(e),B+=4;let Re=[];$.clouds=Re;let Oe=ge(e);for(let Se=0;Se<Oe;Se++){let ot=[];Re[Se]=ot;let Ze=ge(e);for(let ut=0;ut<Ze;ut++)ot[ut]=rt(e),B+=4}let pt=[];$.direct=pt;let wt=ge(e);for(let Se=0;Se<wt;Se++){let ot=[];pt[Se]=ot;let Ze=ge(e);for(let ut=0;ut<Ze;ut++)ot[ut]=rt(e),B+=4}let Je=[];$.fog=Je;let Et=ge(e);for(let Se=0;Se<Et;Se++){let ot=[];Je[Se]=ot;let Ze=ge(e);for(let ut=0;ut<Ze;ut++)ot[ut]=rt(e),B+=4}let ye=[];$.horizon=ye;let Ke=ge(e);for(let Se=0;Se<Ke;Se++){let ot=[];ye[Se]=ot;let Ze=ge(e);for(let ut=0;ut<Ze;ut++)ot[ut]=rt(e),B+=4}$.id=De(e),B+=1;let yt=[];$.skybot=yt;let St=ge(e);for(let Se=0;Se<St;Se++){let ot=[];yt[Se]=ot;let Ze=ge(e);for(let ut=0;ut<Ze;ut++)ot[ut]=rt(e),B+=4}let Te=[];$.skymid=Te;let ft=ge(e);for(let Se=0;Se<ft;Se++){let ot=[];Te[Se]=ot;let Ze=ge(e);for(let ut=0;ut<Ze;ut++)ot[ut]=rt(e),B+=4}let $t=[];$.skytop=$t;let Le=ge(e);for(let Se=0;Se<Le;Se++){let ot=[];$t[Se]=ot;let Ze=ge(e);for(let ut=0;ut<Ze;ut++)ot[ut]=rt(e),B+=4}let Ct=[];$.sun=Ct;let Lt=ge(e);for(let Se=0;Se<Lt;Se++){let ot=[];Ct[Se]=ot;let Ze=ge(e);for(let ut=0;ut<Ze;ut++)ot[ut]=rt(e),B+=4}let He=[];$.water=He;let et=ge(e);for(let Se=0;Se<et;Se++){let ot=[];He[Se]=ot;let Ze=ge(e);for(let ut=0;ut<Ze;ut++)ot[ut]=rt(e),B+=4}}let D=[];n.files=D;let R=ge(e);for(let Q=0;Q<R;Q++){let $={};D[Q]=$,$.ext=De(e),B+=1,$.id=It(e),B+=2,$.type=De(e),B+=1}let E=[];n.filesExt=E;let L=ge(e);for(let Q=0;Q<L;Q++)E[Q]=Vn(e);let z=[];n.foliages=z;let q=ge(e);for(let Q=0;Q<q;Q++){let $={};z[Q]=$,$.id=De(e),B+=1;let le=[];$.nodes=le;let je=ge(e);for(let Ve=0;Ve<je;Ve++){let ke={};le[Ve]=ke,ke.arc=rt(e),B+=4;let Re=[];ke.end=Re;let Oe=ge(e);for(let ye=0;ye<Oe;ye++)Re[ye]=rt(e),B+=4;ke.geotype=De(e),B+=1,ke.jitter_radius=rt(e),B+=4,ke.jitter_rotation=rt(e),B+=4,ke.jitter_size=rt(e),B+=4,ke.jitter_slant=rt(e),B+=4,ke.jitter_y=rt(e),B+=4,ke.leafCount=De(e),B+=1;let pt=[];ke.points=pt;let wt=ge(e);for(let ye=0;ye<wt;ye++)pt[ye]=rt(e),B+=4;ke.radius=rt(e),B+=4,ke.size=rt(e),B+=4,ke.slant=rt(e),B+=4;let Je=[];ke.start=Je;let Et=ge(e);for(let ye=0;ye<Et;ye++)Je[ye]=rt(e),B+=4;ke.y=rt(e),B+=4}$.seed=Ys(e),B+=4,$.texture=It(e),B+=2,$.type=De(e),B+=1}let j=[];n.meshes=j;let W=ge(e);for(let Q=0;Q<W;Q++){let $={};j[Q]=$,$.cull=De(e),B+=1;let le=[];$.effects=le;let je=ge(e);for(let Ve=0;Ve<je;Ve++){let ke={};le[Ve]=ke,ke.id=De(e),B+=1;let Re=[];ke.pos=Re;let Oe=ge(e);for(let ye=0;ye<Oe;ye++)Re[ye]=rt(e),B+=4;let pt=[];ke.rot=pt;let wt=ge(e);for(let ye=0;ye<wt;ye++)pt[ye]=rt(e),B+=4;let Je=[];ke.scale=Je;let Et=ge(e);for(let ye=0;ye<Et;ye++)Je[ye]=rt(e),B+=4}$.geometry=It(e),B+=2,$.id=It(e),B+=2,$.shader=De(e),B+=1,$.shadow=De(e),B+=1,$.texture=It(e),B+=2}let U=[];n.minimap=U;let O=ge(e);for(let Q=0;Q<O;Q++){let $={};U[Q]=$,$.img=It(e),B+=2;let le=[];$.pos=le;let je=ge(e);for(let Ve=0;Ve<je;Ve++)le[Ve]=It(e),B+=2;$.world=De(e),B+=1}let Z=[];n.particles=Z;let ve=ge(e);for(let Q=0;Q<ve;Q++){let $={};Z[Q]=$;let le=[];$.acc=le;let je=ge(e);for(let pt=0;pt<je;pt++)le[pt]=rt(e),B+=4;$.blend=De(e),B+=1;let Ve=[];$.colEnd=Ve;let ke=ge(e);for(let pt=0;pt<ke;pt++)Ve[pt]=rt(e),B+=4;let Re=[];$.colStart=Re;let Oe=ge(e);for(let pt=0;pt<Oe;pt++)Re[pt]=rt(e),B+=4;$.duration=rt(e),B+=4,$.friction=rt(e),B+=4,$.id=De(e),B+=1,$.idEnd=De(e),B+=1,$.idLoop=De(e),B+=1,$.idStart=De(e),B+=1,$.interp=De(e),B+=1,$.randomRota=rt(e),B+=4,$.rota=rt(e),B+=4,$.rotaEnd=rt(e),B+=4,$.scaleEnd=rt(e),B+=4,$.scaleStart=rt(e),B+=4}let Fe=[];n.ribbons=Fe;let _e=ge(e);for(let Q=0;Q<_e;Q++){let $={};Fe[Q]=$;let le=[];$.colEnd=le;let je=ge(e);for(let Re=0;Re<je;Re++)le[Re]=rt(e),B+=4;let Ve=[];$.colStart=Ve;let ke=ge(e);for(let Re=0;Re<ke;Re++)Ve[Re]=rt(e),B+=4;$.id=De(e),B+=1,$.interval=rt(e),B+=4,$.steps=De(e),B+=1,$.texture=It(e),B+=2}let ce=[];n.skeletons=ce;let fe=ge(e);for(let Q=0;Q<fe;Q++){let $={};ce[Q]=$,$.cape=!!ps(e),B+=1,$.groundNormal=!!ps(e),B+=1,$.height=rt(e),B+=4,$.helmet=!!ps(e),B+=1,$.id=De(e),B+=1,$.shoulders=!!ps(e),B+=1}let ze=[];n.skins=ze;let Pe=ge(e);for(let Q=0;Q<Pe;Q++){let $={};ze[Q]=$,$.animset=De(e),B+=1;let le=[];$.body=le;let je=ge(e);for(let Te=0;Te<je;Te++){let ft={};le[Te]=ft,ft.bid=De(e),B+=1;let $t=[];ft.col=$t;let Le=ge(e);for(let Ze=0;Ze<Le;Ze++)$t[Ze]=rt(e),B+=4;ft.colMode=De(e),B+=1,ft.lod=De(e),B+=1,ft.mid=It(e),B+=2,ft.pid=ps(e),B+=1;let Ct=[];ft.pos=Ct;let Lt=ge(e);for(let Ze=0;Ze<Lt;Ze++)Ct[Ze]=rt(e),B+=4;let He=[];ft.rot=He;let et=ge(e);for(let Ze=0;Ze<et;Ze++)He[Ze]=rt(e),B+=4;let Se=[];ft.scl=Se;let ot=ge(e);for(let Ze=0;Ze<ot;Ze++)Se[Ze]=rt(e),B+=4;ft.ts=De(e),B+=1}$.capeswing=De(e),B+=1;let Ve=[];$.colPrim=Ve;let ke=ge(e);for(let Te=0;Te<ke;Te++)Ve[Te]=rt(e),B+=4;let Re=[];$.colSec=Re;let Oe=ge(e);for(let Te=0;Te<Oe;Te++)Re[Te]=rt(e),B+=4;let pt=[];$.effects=pt;let wt=ge(e);for(let Te=0;Te<wt;Te++){let ft={};pt[Te]=ft,ft.bid=De(e),B+=1,ft.id=De(e),B+=1}$.id=De(e),B+=1,$.mountPart=De(e),B+=1;let Je=[];$.mountPos=Je;let Et=ge(e);for(let Te=0;Te<Et;Te++)Je[Te]=rt(e),B+=4;let ye=[];$.sheathedPos=ye;let Ke=ge(e);for(let Te=0;Te<Ke;Te++)ye[Te]=rt(e),B+=4;$.size=rt(e),B+=4,$.skeleton=De(e),B+=1,$.soundset=De(e),B+=1;let yt=[];$.unsheathedPos=yt;let St=ge(e);for(let Te=0;Te<St;Te++)yt[Te]=rt(e),B+=4}let Me=[];n.sounds=Me;let be=ge(e);for(let Q=0;Q<be;Q++){let $={};Me[Q]=$,$.distance=rt(e),B+=4;let le=[];$.files=le;let je=ge(e);for(let Ve=0;Ve<je;Ve++)le[Ve]=It(e),B+=2;$.id=De(e),B+=1}let H=[];n.soundsetSteps=H;let pe=ge(e);for(let Q=0;Q<pe;Q++){let $={};H[Q]=$,$.id=De(e),B+=1;let le=[];$.steps=le;let je=ge(e);for(let Ve=0;Ve<je;Ve++)le[Ve]=De(e),B+=1}let Be=[];n.soundsets=Be;let Ge=ge(e);for(let Q=0;Q<Ge;Q++){let $={};Be[Q]=$,$.id=De(e),B+=1;let le=[];$.sounds=le;let je=ge(e);for(let Ve=0;Ve<je;Ve++)le[Ve]=De(e),B+=1;$.steps=De(e),B+=1}let Xe=[];n.terrains=Xe;let Ye=ge(e);for(let Q=0;Q<Ye;Q++){let $={};Xe[Q]=$,$.brightest=De(e),B+=1,$.darkest=De(e),B+=1;let le=[];$.foliage=le;let je=ge(e);for(let Ve=0;Ve<je;Ve++){let ke=[];le[Ve]=ke;let Re=ge(e);for(let Oe=0;Oe<Re;Oe++)ke[Oe]=De(e),B+=1}$.id=De(e),B+=1,$.scale=De(e),B+=1,$.spec=De(e),B+=1,$.texture=It(e),B+=2}let ue=[];n.traderShopItems=ue;let oe=ge(e);for(let Q=0;Q<oe;Q++){let $={};ue[Q]=$,$.bind=De(e),B+=1,$.id=De(e),B+=1,$.shop=De(e),B+=1,$.stacks=De(e),B+=1,$.tier=It(e),B+=2,$.type=Vn(e),$.upgrade=De(e),B+=1}let $e=[];n.worlds=$e;let J=ge(e);for(let Q=0;Q<J;Q++){let $={};$e[Q]=$,$.chunkAmount=De(e),B+=1,$.id=De(e),B+=1,$.minlevel=De(e),B+=1,$.music=De(e),B+=1,$.name=Vn(e)}return n}};var Ft={clientPlayerInput:Qb,clientPlayerChangeTarget:Zb,clientPlayerSkill:Jb,clientPlayerEnvSkill:Kb,clientPlayerInteract:e3,clientCommand:t3,serverOnClientConnect:f3,serverEntityDelta:n3,serverPartyUpdate:i3,serverWarUpdate:s3,serverPartyPositions:o3,serverChangeWorld:a3,serverMapUpdate:r3,serverChat:l3,serverSystemMessage:c3,serverQueue:u3,ping:m3},xa={chunk:p3,gamedata:h3,modelformat:d3},g3=[],C9=0;for(let t in Ft)Ft[t]&&(Ft[t].header=C9++,Ft[t].packData=function(e){return e._header=this.header,this.encode(e)},g3.push(Ft[t]));var v3=t=>{if(t.length===0)return;let e=g3[t[0]];if(!(e&&e.maxSize<t.length))return e};var V,vp=[0,1,0];var bt=[0,0,0],kn=[0,0,0],el=[0,0,0],ds=[0,0,0],_p=[0,0,0],xf=[0,0,0];var yo=[0,0,0,0];var Bn=[0,0],Qs=[0,0];var WO=us(),_3=t=>{V=t},ko=0,b3=t=>ko=t;var Yh={};Qn(Yh,{onWorldEnter:()=>A9,parseBandwidth:()=>Gh,parseFrameDelta:()=>y3,parseLatency:()=>Hh,tick:()=>S9});var vt=(t,e,n)=>Math.min(Math.max(t,e),n),wa=(t,e)=>(t%e+e)%e,wf=(t,e,n)=>{let i=vt((n-t)/(e-t),0,1);return i*i*(3-2*i)},hs=(t,e,n,i,s)=>i+(vt(t,e,n)-e)/(n-e)*(s-i),Mf=(t,e,n)=>e+vt(t,0,1)*(n-e),Qt={linear:t=>t,easeInQuad:t=>t*t,easeInQuart:t=>t**4,easeOutQuad:t=>t*(2-t),easeOutExpo:t=>-Math.pow(2,-10*t)+1,easeOutFlick:t=>1-Math.pow(1-t,10),sin:t=>Math.sin(t*3.14),sinReverse:t=>1-Math.sin(t*3.14),easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeBounce:t=>t<.36363636363636365?7.5625*t*t:t<.7272727272727273?7.5625*(t-=.5454545454545454)*t+.75:t<.9090909090909091?7.5625*(t-=.8181818181818182)*t+.9375:7.5625*(t-=.9545454545454546)*t+.984375,anticipate:t=>-1/(1+Math.exp((t-.5)*50))+Math.sin((t-.5)*6.2)*1.4*(1-t*.5)+1,flicker:t=>Math.sin(t*3.14)*(1+Math.sin(t*38)*.3)},Zo=(t,e,n)=>t<e?hs(t,0,e,0,n):hs(Qt.easeInOutCubic(hs(t,e,1,0,1)),0,1,n,1),Ma=[Qt.linear,Qt.easeInQuad,Qt.easeInQuart,Qt.easeOutQuad,Qt.easeOutExpo,Qt.easeOutFlick,Qt.sin,Qt.sinReverse,Qt.easeInOutCubic,Qt.easeInOutQuint,Qt.easeBounce,Qt.anticipate,Qt.flicker];var kt=class{constructor(e=0,n=0){this.start=e,this.end=e+n,this.duration=n}done(e){return e>this.end}fraction(e){return vt(1-(this.end-e)/this.duration,0,1)}remaining(e){return this.end-e}passed(e){return e-this.start}reset(e,n=this.duration){return this.start=e,this.end=e+n,this.duration=n,!0}set(e,n){return this.start=e,this.end=n,this.duration=this.end-this.start,!0}};var Nh=.016,y3=t=>{Nh=(Nh*10+t)/11},k3=0,Oh=0,Gh=t=>{k3=t},jh=0,Hh=t=>{jh=(jh*2+t)/3},$h=0,Wh=new kt(0,.05),S9=t=>{y3(t),re.showFpsPing&&Wh.done(V.time)&&(Oh=(Oh*10+k3)/11,$h=($h*5+V.netData.length)/6,Wh.reset(V.time),gm.update(e=>(e[0]=vt(jh>>0,1,999),e[1]=(1/Nh).toFixed(1),e[2]=(Oh/1e3).toFixed(1),e[3]=V.player?`${~~V.player.pos[0]} ${~~V.player.pos[1]} ${~~V.player.pos[2]}`:"-",e[4]=$h.toFixed(1),e)))},A9=t=>{Wh.reset(t.time)};var P9=performance,Ff=()=>P9.now();var gs,Qh=0,x3=0,F3=(t,e)=>{Un(Ft.serverOnClientConnect.header,n=>{t(Ft.serverOnClientConnect.decode(n))}),Un("close",n=>{e(n.code)})},tl={open:[],close:[]};for(let t in Ft)tl[Ft[t].header]=[];var T9=t=>{},E9=t=>{console.log("Connected"),Qh=1;for(let e=0,n=tl.open.length;e<n;++e)tl.open[e](t)},I9=t=>{console.log("Connection closed:",t.reason,t.code),Qh=0,gs.close(),gs=void 0;for(let e=0,n=tl.close.length;e<n;++e)tl.close[e](t)},D9=t=>{V9(t.data.byteLength),t=new Uint8Array(t.data);let e=v3(t),n=e&&tl[e.header];if(n)for(let i=0,s=n.length;i<s;++i)n[i](t)},Un=(t,e)=>{tl[t].push(e)},Si=t=>{gs===void 0||Qh!==1||gs.send(t)},C3=t=>{if(gs!==void 0)return;let e="game1.hordes.io";gs=new WebSocket(`wss://${e}:`+t+"/play"),gs.binaryType="arraybuffer",gs.onerror=T9,gs.onopen=E9,gs.onclose=I9,gs.onmessage=D9};var w3=0,Xh=0,V9=t=>{Xh+=t,ko-w3>1e3/4&&(x3=Xh*4,Xh=0,w3=ko,Gh(x3))},S3=()=>{re.showFpsPing&&ko-M3>(Sf.length<10?100:2e3)&&(M3=ko,L9())},A3=t=>{if(Sf[t.id]){let e=Ff();if(Sf[t.id]<=e){let n=e-Sf[t.id];Hh(n)}}},Cf=0,M3=0,Sf=[],L9=()=>{Cf>254&&(Cf=0),Sf[Cf]=Ff(),Si(Ft.ping.packData({id:Cf})),Cf++};var xt=(t,e="")=>{Si(Ft.clientCommand.packData({command:t,string:e+""}))};var il={report:{client:!0},partyleave:{},partyinvite:{a:1},partycreate:{},time:{},bosslog:{},party:{a:1,chat:!0},clan:{a:1,chat:!0},faction:{a:1,chat:!0}},xo={itemmove:{a:2},itemdrop:{a:1},itemauctionpost:{a:2},itemauctionfind:{a:5},itemauctionbuy:{a:1},itemauctioncancel:{a:1},itemstash:{a:1},itemunstash:{a:1},itemsplithalf:{a:1},itemsplitone:{a:1},goldstash:{a:1},itemtradersell:{a:1},itemtraderbuy:{a:1},itemblacksmithupgrade:{a:1},petlootsettings:{a:2},statincrease:{a:2},skillconfig:{a:1},cancelbuff:{a:1},respawn:{},startqueue:{a:1},stopqueue:{a:1},partyaccept:{a:1},partydecline:{a:1},partykick:{a:1},partysetrole:{a:2},summonaccept:{a:1},whisper:{a:2,chat:!0},global:{a:1},...il};var P3=t=>{navigator.clipboard.writeText(t)};var Kh={};Qn(Kh,{addRequest:()=>Fa,confirmationBasedCallback:()=>yp,onWorldDestroy:()=>z9,onWorldEnter:()=>R9,postTick:()=>q9,removeTopRequest:()=>Jh});var Zh=new kt(0,1),Zs=[],q9=(t,e)=>{Zh.done(e.time)&&(Zh.reset(e.time),Zs.length&&(Zs.forEach(n=>{T3(n,1)}),co.set(Zs)))},R9=t=>{Zh.reset(0)},z9=t=>{Zs.length=0,co.set(Zs)},Fa=(t,e,n)=>{let i={title:t,text:e,choices:n};Zs.push(i),T3(i,0),co.set(Zs)},T3=(t,e)=>{for(let n=0;n<t.choices.length;++n){let i=t.choices[n];if(i.blockedTime!==void 0)i.blockedTime>1?(i.blockedTime-=e,i.unavailable=`(${i.blockedTime} s)`):i.unavailable=void 0;else if(i.nocombat&&V&&V.player&&V.player.stats){let s=~~V.player.stats.combatTimer.remaining(V.time);s>0?i.unavailable=`(Combat - ${s}s)`:i.unavailable=void 0}i.remaining!==void 0&&(i.remaining>1?(i.remaining-=e,i.additional=`(${~~i.remaining}s remaining)`):(i.additional=void 0,i.unavailable="(Timed out)"))}},Jh=()=>{Zs.length&&(Zs.shift(),co.set(Zs))},bp=!0,yp=(t,e,n,i)=>{t?bp&&(Fa(n,i,[{text:n,fun:()=>{bp=!0,e()}},{text:C.ui.decline,fun:()=>{bp=!0}}]),bp=!1):e()};var kp={normal:{partyBasedHostility:!1,pvpprotect:!0,instanced:!1},arena3v3:{name:"Arena 3v3",queue:!0,instanced:!0,groupsize:3,groupcount:2,partyBasedHostility:!0,pvpprotect:!1,startTimer:30},arena5v5:{name:"Arena 5v5",startTimer:30,groupsize:5,groupcount:2,queue:!0,instanced:!0,partyBasedHostility:!0,pvpprotect:!1}};var wp={};Qn(wp,{init:()=>U9,onRemoveEntity:()=>e1,onWorldDestroy:()=>$9,party:()=>nn,postTick:()=>O9});var xp,B9=0,nn=new Map,U9=()=>{Un(Ft.serverPartyUpdate.header,t=>{xp=t}),Un(Ft.serverPartyPositions.header,t=>{t=Ft.serverPartyPositions.decode(t).members,nn.forEach(e=>{let n=t.find(i=>i.entityid===e.id);n&&(e.pos[0]=n.pos[0],e.pos[1]=n.pos[1])})})},O9=(t,e)=>{if(e.player!==void 0){if(xp){nn.forEach(i=>{i.found=!1});let n=Ft.serverPartyUpdate.decode(xp);n.members.forEach(i=>{if(!nn.has(i.name))nn.set(i.name,{id:i.entityid,found:!0,pos:[0,0],local:i.world===e.id,name:i.name,buffStore:i.entityid===e.playerId?sa:ie([]),unitStore:i.entityid===e.playerId?Us:ie({id:i.entityid,name:i.name,level:i.level,class:i.class,world:i.world,role:i.role,party:e.player.party,faction:e.player.faction,type:0,visible:!0,alive:!0,rarity:!1,range:!1})});else{let s=nn.get(i.name);i.entityid!==e.playerId&&(s.local=i.world===e.id,s.unitStore.update(o=>(o.id=i.entityid,o.name=i.name,o.level=i.level,o.class=i.class,o.world=i.world,o.party=e.player.party,o.faction=e.player.faction,o.role=i.role,o))),s.id=i.entityid,s.found=!0}}),nn.forEach((i,s)=>{i.found||nn.delete(s)}),ia.set(Array.from(nn.values()).filter(i=>re.showSelfInParty||i.id!==e.playerId)),Zn.update(i=>(i.membercount=n.members.length,i.queues=n.queues,re.partyinfo=i,i)),xp=void 0}if(e.player.party>0)if(!re.partyBuffLimitUpdateRate)e.entities.type[0].forEach(n=>{n.party===e.player.party&&(n.buffDisplayDirty=!0)});else{let n=Array.from(nn.values())[B9++%nn.size];if(n){let i=e.entity(n.id);i!==void 0&&i.id!==e.playerId&&(i.buffDisplayDirty=!0)}}}},e1=t=>{if(nn.has(t.name)){let e=nn.get(t.name);e.unitStore.update(n=>(n.timedSkill=void 0,n.timedCast=void 0,n.alive=!0,n.range=!1,n.mp=n.hp=n.hpMax=n.mpMax=0,n)),e.buffStore.set([])}},$9=()=>{nn.clear()};var I1={};Qn(I1,{onWorldEnter:()=>h7,postTick:()=>g7,steps:()=>Pi,tut:()=>sn});function E3(t,e){return t[0]=e[0],t[1]=e[1],t}function di(t,e,n){return t[0]=e,t[1]=n,t}function I3(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function Ca(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Af(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function t1(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t}function Sa(t){let e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function D3(t){let e=t[0],n=t[1];return e*e+n*n}function Mp(t,e){let n=e[0],i=e[1],s=n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t}function V3(t,e,n){let i=Math.sin(n),s=Math.cos(n);return t[0]=e[1]*i+e[0]*s,t[1]=e[1]*s-e[0]*i,t}var Fp=[0,0,0],L3=(t,e,n,i,s)=>{if(t.length>0){X(e,1/0,1/0,1/0),X(n,-1/0,-1/0,-1/0);for(let o=0,r=t.length;o<r;o+=3){let l=t[o],a=t[o+1],c=t[o+2];e[0]=Math.min(l,e[0]),e[1]=Math.min(a,e[1]),e[2]=Math.min(c,e[2]),n[0]=Math.max(l,n[0]),n[1]=Math.max(a,n[1]),n[2]=Math.max(c,n[2])}}else X(e,0,0,0),X(n,-0,-0,-0);Xt(s,n,e),hn(i,zn(i,e,n),.5)},N9=t=>{L3(t.attributes.position.data,t.bounds.min,t.bounds.max,t.bounds.center,t.bounds.scale),t.bounds.initiated=!0},j9=t=>{let e=0;for(let n=0,i=t.attributes.position.data.length;n<i;n+=3)Fp[0]=t.attributes.position.data[n],Fp[1]=t.attributes.position.data[n+1],Fp[2]=t.attributes.position.data[n+2],e=Math.max(e,ei(t.bounds.center,Fp));t.bounds.radius=Math.sqrt(e)},q3=t=>{t.bounds.initiated||N9(t),j9(t)};var W9=1,G9=1,Sn=t=>{let e={id:W9++,vao:E_(),vaoNeedsUpdate:!0,attributes:t,drawRangeStart:0,drawRangeCount:0,attrRange:0,instancedCount:0,isInstanced:!1,bounds:{min:[0,0,0],max:[0,0,0],center:[0,0,0],scale:[0,0,0],radius:1/0,initiated:!1}};return n1(e,e.attributes),e},hi=(t,e)=>{tt.boundBuffer!==e.id&&(N.bindBuffer(e.target,e.buffer),tt.boundBuffer=e.id),e.bufferLen<e.data.length?(e.bufferLen=e.data.length,N.bufferData(e.target,e.data,e.bufferMode,0,e.data.length)):N.bufferSubData(e.target,0,e.data,0,e.data.length)},Cp=(t,e,n)=>{tt.boundBuffer!==e.id&&(N.bindBuffer(e.target,e.buffer),tt.boundBuffer=e.id);let i=n*e.size;e.bufferLen<i?(e.bufferLen=i,N.bufferData(e.target,e.data,e.bufferMode,0,i)):N.bufferSubData(e.target,0,e.data,0,i)},H9=(t,e,n)=>{n.id=G9++,n.size=n.size||1,n.type=n.type||(n.data.constructor===Float32Array?N.FLOAT:n.data.constructor===Uint16Array?N.UNSIGNED_SHORT:N.UNSIGNED_INT),n.target=e==="index"?N.ELEMENT_ARRAY_BUFFER:N.ARRAY_BUFFER,n.normalize=n.normalize||!1,n.count=n.data.length/n.size,n.divisor=n.instanced?typeof n.instanced=="number"?n.instanced:1:0,n.bufferMode=n.bufferMode||N.STATIC_DRAW,n.bufferLen=0,n.buffer||(n.buffer=N.createBuffer()),hi(t,n)},Y9=(t,e,n)=>{if(t.attributes[e]=n,n.divisor){if(t.isInstanced=!0,t.instancedCount&&t.instancedCount!==n.count*n.divisor)return t.instancedCount=Math.min(t.instancedCount,n.count*n.divisor);t.instancedCount=n.count*n.divisor}else e==="index"?t.drawRangeCount=n.count:t.attributes.index||(t.drawRangeCount=Math.max(t.drawRangeCount,n.count))},n1=(t,e)=>{Dm(null),tt.currentGeometry=-1;for(let n in e)e[n].id===void 0&&H9(t,n,e[n]),Y9(t,n,e[n]);t.attributes.position&&q3(t)},z3=(t,e,n)=>{t.attrRange=n,t.drawRangeStart=e,t.drawRangeCount=n},Sp=(t,e)=>{t.instancedCount=e},X9=(t,e)=>{Dm(t.vao);for(let n=0;n<e.attributeLocations.length;++n){let i=e.attributeLocations[n];if(!t.attributes[i])continue;let s=t.attributes[i];if(N.bindBuffer(N.ARRAY_BUFFER,s.buffer),tt.boundBuffer=s.id,s.size>4){let o=s.size/4,r=o*4,l=r*4;for(let a=0;a<o;++a)N.vertexAttribPointer(n+a,o,N.FLOAT,!1,l,r*a),N.enableVertexAttribArray(n+a),ha(n+a,1)}else N.vertexAttribPointer(n,s.size,s.type,s.normalize,0,0),N.enableVertexAttribArray(n),ha(n,s.divisor)}t.attributes.index&&N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,t.attributes.index.buffer),t.vaoNeedsUpdate=!1},Aa=(t,e)=>{tt.currentGeometry!==t.id&&(t.vaoNeedsUpdate&&X9(t,e),Dm(t.vao),tt.currentGeometry=t.id)},Pa=(t,e,n)=>{Aa(t,e),t.isInstanced?t.attributes.index?T_(n,t.drawRangeCount,t.attributes.index.type,t.drawRangeStart,t.instancedCount):P_(n,t.drawRangeStart,t.drawRangeCount,t.instancedCount):t.attributes.index?N.drawElements(n,t.drawRangeCount,t.attributes.index.type,t.drawRangeStart):N.drawArrays(n,t.drawRangeStart,t.drawRangeCount)};var Q9=1,fn=({vertex:t,fragment:e,uniforms:n={},instanced:i=[],active:s=!0,transparent:o=!1,cullFace:r=N.BACK,frontFace:l=N.CCW,depthTest:a=!0,depthWrite:c=!0,depthFunc:f=N.LESS,globalUniforms:u={},attributeLocations:m})=>{let g={id:Q9++,program:N.createProgram(),active:s,transparent:o,cullFace:r,frontFace:l,depthTest:a,depthWrite:c,depthFunc:f,blendFunc:{},blendEquation:{},uniforms:n,autoUniforms:[],uniformArray:[],samplerNames:[],samplerTexUnits:[],samplerTexArray:[],samplerTextures:[],globalUniforms:u,instancedAttributes:i,attributeLocations:m};g.transparent&&!g.blendFunc.src&&Tf(g,N.SRC_ALPHA,N.ONE_MINUS_SRC_ALPHA);let v=B3(t,N.VERTEX_SHADER),_=B3(e,N.FRAGMENT_SHADER);for(let b=0;b<m.length;++b)N.bindAttribLocation(g.program,b,m[b]);return N.attachShader(g.program,v),N.attachShader(g.program,_),N.linkProgram(g.program),N.deleteShader(v),N.deleteShader(_),g},U3=(t,e)=>{N.useProgram(t.program),tt.currentProgram=t.id;let n=N.getProgramParameter(t.program,N.ACTIVE_UNIFORMS),i=0,s=2;for(let o=0;o<n;o++){let r=N.getActiveUniform(t.program,o),l=N.getUniformLocation(t.program,r.name);if(l===null)continue;let a=r.name.match(/(\w+)/g)[0],c=r.type,f=c===35678||c===35682||c===36289,u=c===35682;if(f){let m=r.size,g=[];for(let v=0;v<m;++v){let _=u?i++:s++;g.push(_),t.samplerNames.push(a),t.samplerTexUnits.push(_),t.samplerTexArray.push(m===1?-1:v)}m===1?N.uniform1i(l,g[0]):N.uniform1iv(l,g)}else{e[a]?t.uniforms[a]||(t.uniforms[a]=e[a]):t.uniforms[a]||(K9.has(a)||t.autoUniforms.push(a),t.uniforms[a]={value:void 0});let m={name:a,location:l,type:c,data:t.uniforms[a],fun:J9(c,t.uniforms[a].value)};t.uniformArray.push(m)}}},O3=(t,e)=>{for(let n=0;n<e.length;++n){let i=e[n],s=N.getUniformBlockIndex(t.program,i.name);s!==N.INVALID_INDEX&&i.index>=0&&N.uniformBlockBinding(t.program,s,i.index)}},Ta=(t,e)=>{e||(N.useProgram(t.program),tt.currentProgram=t.id),Ea(t),s1(t.uniformArray),Pf(t),Ia(t)},Ln=(t,e,n,i)=>{let s=i.samplerNames.indexOf(t);s>=0?i.samplerTextures[s+n]=e:console.log("unknown texture type",t,i)},Ea=t=>{for(let e=0;e<t.samplerNames.length;++e){let n=t.samplerNames[e],i=t.samplerTexArray[e];t.globalUniforms[n]&&t.globalUniforms[n].value&&(i<0?t.samplerTextures[e]=t.globalUniforms[n].value:t.samplerTextures[e]=t.globalUniforms[n].value[i])}},Ap=(t,e)=>{for(let n=0;n<e.samplerNames.length;++n){let i=e.samplerNames[n],s=e.samplerTexArray[n];t[i]&&(s<0?e.samplerTextures[n]=t[i]:e.samplerTextures[n]=t[i][s])}},Pf=t=>{for(let e=0;e<t.samplerTexUnits.length;++e){let n=t.samplerTexUnits[e],i=t.samplerTextures[e];i&&tt.textureUnits[n]!==i.id&&(Xc(n),N.bindTexture(i.target,i.texture),tt.textureUnits[n]=i.id)}},Tf=(t,e,n,i,s)=>{t.blendFunc.src=e,t.blendFunc.dst=n,t.blendFunc.srcAlpha=i,t.blendFunc.dstAlpha=s,e&&(t.transparent=!0)},i1={},B3=(t,e)=>{if(i1[t]!==void 0)return i1[t];let n=i1[t]=N.createShader(e);return N.shaderSource(n,t),N.compileShader(n),n},Ia=t=>{t.depthTest?Yc(N.DEPTH_TEST):Vm(N.DEPTH_TEST),t.cullFace?Yc(N.CULL_FACE):Vm(N.CULL_FACE),t.blendFunc.src?Yc(N.BLEND):Vm(N.BLEND),t.cullFace&&q_(t.cullFace),R_(t.frontFace),Ih(t.depthWrite),z_(t.depthFunc),t.blendFunc.src&&V_(t.blendFunc.src,t.blendFunc.dst,t.blendFunc.srcAlpha,t.blendFunc.dstAlpha),t.blendEquation.modeRGB&&L_(t.blendEquation.modeRGB,t.blendEquation.modeAlpha)},s1=t=>{for(let e=0;e<t.length;++e){let n=t[e];Z9(N,n.fun,n.location,n.data.value)}};var Z9=(t,e,n,i)=>{switch(e){case 12:return t.uniformMatrix4fv(n,!1,i);case 9:return t.uniform4fv(n,i);case 8:return t.uniform3fv(n,i);case 5:return t.uniform1f(n,i);case 0:return t.uniform1i(n,i);case 1:return t.uniform1iv(n,i);case 2:return t.uniform2iv(n,i);case 3:return t.uniform3iv(n,i);case 4:return t.uniform4iv(n,i);case 6:return t.uniform1fv(n,i);case 7:return t.uniform2fv(n,i);case 10:return t.uniformMatrix2fv(n,!1,i);case 11:return t.uniformMatrix3fv(n,!1,i)}},J9=(t,e)=>{switch(t){case 5126:return Array.isArray(e)?6:5;case 35664:return 7;case 35665:return 8;case 35666:return 9;case 35670:case 5124:case 35678:case 35682:case 36289:case 35680:return Array.isArray(e)?1:0;case 35671:case 35667:return 2;case 35672:case 35668:return 3;case 35673:case 35669:return 4;case 35674:return 10;case 35675:return 11;case 35676:return 12}};var K9=new Set(["projectionViewMatrix","shadowPVMatrix","modelMatrix","viewMatrix","projectionMatrix","cameraPosition"]);var eT=0,Ri=(t,e,n,i=rn(),s=0)=>({id:eT++,uniformData:{},transform:i,geometry:t,program:e,shadowProgram:s,mode:n}),Ki=(t,e)=>{e.uniforms.modelMatrix&&(e.uniforms.modelMatrix.value=t.transform.worldMatrix);for(let n=0;n<e.autoUniforms.length;++n){let i=e.autoUniforms[n];e.uniforms[i].value=t.uniformData[i]}Ap(t.uniformData,e),Ta(e,tt.currentProgram===e.id),Pa(t.geometry,e,t.mode)};function $3(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function N3(t,e,n){switch(t){case j3:return(e+3>>2)*(n+3>>2)*8;case W3:return(e+3>>2)*(n+3>>2)*16;default:return 0}}var j3=33777,W3=33778,tT=131072,nT=31,iT=1,sT=2,oT=3,rT=4,lT=7,aT=21,cT=$3("DXT1"),fT=$3("DXT3");function G3(t){let e=new Int32Array(t,0,nT),n=e[aT],i;switch(n){case cT:i=j3;break;case fT:i=W3;break;default:console.error("Unsupported texture"+n)}let s=1;e[sT]&tT&&(s=Math.max(1,e[lT]));let o=e[rT],r=e[oT],l=e[iT]+4;return{data:new Uint8Array(t,l),width:o,height:r,levels:s,internalFormat:i}}var mT=1,Jo=function({image:t,buffer:e,target:n=N.TEXTURE_2D,type:i=N.UNSIGNED_BYTE,format:s=N.RGBA,internalFormat:o=s,wrapS:r=N.CLAMP_TO_EDGE,wrapT:l=N.CLAMP_TO_EDGE,generateMipmaps:a=!0,minFilter:c=a?N.LINEAR_MIPMAP_LINEAR:N.LINEAR,magFilter:f=N.LINEAR,flipY:u=!0,width:m,depth:g=0,height:v=m,compareMode:_=N.NONE,compareFunc:b=N.LEQUAL,anisotropy:y=1}){return{id:mT++,image:t,buffer:e,target:n,type:i,format:s,internalFormat:o,minFilter:c,magFilter:f,wrapS:r,wrapT:l,generateMipmaps:a,flipY:u,width:m,height:v,depth:g,compareMode:_,texture:N.createTexture(),anisotropy:Math.min(Math.max(1,y),tt.maxAnisotropy),needsUpdate:!0,state:{flipY:!1,minFilter:N.NEAREST_MIPMAP_LINEAR,magFilter:N.LINEAR,wrapS:N.REPEAT,wrapT:N.REPEAT,compareMode:N.NONE,anisotropy:1,image:void 0}}},H3=t=>{tt.textureUnits[tt.activeTextureUnit]!==t.id&&(N.bindTexture(t.target,t.texture),tt.textureUnits[tt.activeTextureUnit]=t.id)},es=(t,e=0)=>{let n=!(t.image===t.state.image&&!t.needsUpdate);if((n||tt.textureUnits[e]!==t.id)&&(Xc(e),H3(t)),!!n){if(t.needsUpdate=!1,t.flipY!==tt.flipY&&(N.pixelStorei(N.UNPACK_FLIP_Y_WEBGL,t.flipY),tt.flipY=t.flipY),t.minFilter!==t.state.minFilter&&(N.texParameteri(t.target,N.TEXTURE_MIN_FILTER,t.minFilter),t.state.minFilter=t.minFilter),t.magFilter!==t.state.magFilter&&(N.texParameteri(t.target,N.TEXTURE_MAG_FILTER,t.magFilter),t.state.magFilter=t.magFilter),t.wrapS!==t.state.wrapS&&(N.texParameteri(t.target,N.TEXTURE_WRAP_S,t.wrapS),t.state.wrapS=t.wrapS),t.wrapT!==t.state.wrapT&&(N.texParameteri(t.target,N.TEXTURE_WRAP_T,t.wrapT),t.state.wrapT=t.wrapT),t.anisotropy!==t.state.anisotropy&&(N.texParameterf(t.target,Eh.TEXTURE_MAX_ANISOTROPY_EXT,t.anisotropy),t.state.anisotropy=t.anisotropy),t.compareMode!==t.state.compareMode&&(N.texParameteri(t.target,N.TEXTURE_COMPARE_MODE,t.compareMode),t.state.compareMode=t.compareMode),t.image)t.image.width&&(t.width=t.image.width,t.height=t.image.height),N.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.type,t.image),t.generateMipmaps&&N.generateMipmap(t.target);else if(t.buffer){let i=0,s=t.height,o=t.width,r=t.buffer.data;for(let l=0;l<t.buffer.levels;++l){let a=N3(t.internalFormat,s,s),c=new Uint8Array(r.buffer,r.byteOffset+i,a);N.compressedTexImage2D(t.target,l,t.internalFormat,o,s,0,c),o=o>>1,s=s>>1,i+=a}}else t.target!==N.TEXTURE_2D_ARRAY?N.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.type,null):N.texImage3D(t.target,0,t.internalFormat,t.width,t.height,t.depth,0,t.format,t.type,null);t.state.image=t.image}},Pp=(t,e)=>{t.anisotropy=Math.min(Math.max(1,e),tt.maxAnisotropy),t.needsUpdate=!0};var Y3=(t,e,n,i,s)=>{Xc(0),H3(t),t.flipY!==tt.flipY&&(N.pixelStorei(N.UNPACK_FLIP_Y_WEBGL,t.flipY),tt.flipY=t.flipY),N.texSubImage3D(t.target,0,0,0,e,n,i,1,t.format,t.type,s),t.generateMipmaps&&N.generateMipmap(t.target)};var Mo=(t=N.canvas.width,e=N.canvas.height,n=1,i=!1,s=N.NONE,o=N.CLAMP_TO_EDGE,r=N.CLAMP_TO_EDGE)=>{let l=N.LINEAR,a=N.LINEAR,c={width:t,height:e,target:N.FRAMEBUFFER,buffer:N.createFramebuffer()};if(N.bindFramebuffer(c.target,c.buffer),n&&(c.colorTexture=Jo({width:t,height:e,wrapS:o,wrapT:r,minFilter:l,magFilter:a,flipY:!1,generateMipmaps:!1,internalFormat:N.RGBA8}),es(c.colorTexture),N.framebufferTexture2D(c.target,N.COLOR_ATTACHMENT0,N.TEXTURE_2D,c.colorTexture.texture,0)),i){let f=s===N.COMPARE_REF_TO_TEXTURE?N.LINEAR:N.NEAREST;c.depthTexture=Jo({width:t,height:e,wrapS:o,wrapT:r,minFilter:f,magFilter:f,flipY:!1,format:N.DEPTH_COMPONENT,internalFormat:N.DEPTH_COMPONENT24,type:N.UNSIGNED_INT,generateMipmaps:!1,compareMode:s}),es(c.depthTexture),N.framebufferTexture2D(c.target,N.DEPTH_ATTACHMENT,N.TEXTURE_2D,c.depthTexture.texture,0)}return N.bindFramebuffer(c.target,null),c},Ef=(t,e,n)=>{t.colorTexture.width=e,t.colorTexture.height=n,t.colorTexture.needsUpdate=!0,es(t.colorTexture),t.depthTexture&&(t.depthTexture.width=e,t.depthTexture.height=n,t.depthTexture.needsUpdate=!0,es(t.depthTexture)),t.width=e,t.height=n};var Nt=async(t,e,n)=>{let i=await fetch(t,{method:e!==void 0?"POST":"GET",body:e?JSON.stringify(e):void 0});return i.status===500?n(await i.text()):await i.json()};var Ep=new Map,If=new Map,Ip=new Map,r1=new Map,l1=new Map,Da=new Map,bs=new Map,a1=new Map,Va=new Map,La=new Map,Df=new Map,qa=new Map,Vf=new Map,c1=new Map,f1=new Map,u1=new Map,m1=new Map,pT=new Map,p1=new Map,Lf=new Map,qf=[],Rf=[],d1=new Map,Dp=new Map;var o1=t=>{t.classes.forEach(e=>Dp.set(e.id,e)),t.files.forEach(e=>Da.set(e.id,e)),t.particles.forEach(e=>Ep.set(e.id,e)),t.effects.forEach(e=>If.set(e.id,e)),t.sounds.forEach(e=>Ip.set(e.id,e)),t.soundsets.forEach(e=>r1.set(e.id,e)),t.soundsetSteps.forEach(e=>l1.set(e.id,e)),t.meshes.forEach(e=>bs.set(e.id,e)),t.ribbons.forEach(e=>a1.set(e.id,e)),t.areas.forEach(e=>Df.set(e.id,e)),t.terrains.forEach(e=>Va.set(e.id,e)),t.foliages.forEach(e=>La.set(e.id,e)),t.environments.forEach(e=>qa.set(e.id,e)),t.animations.forEach(e=>Vf.set(e.id,e)),t.skins.forEach(e=>c1.set(e.id,e)),t.skeletons.forEach(e=>f1.set(e.id,e)),t.creatures.forEach(e=>u1.set(e.id,e)),t.creaturesMonster.forEach(e=>m1.set(e.id,e)),t.creaturesConjurer.forEach(e=>pT.set(e.id,e)),t.creaturesTrader.forEach(e=>p1.set(e.id,e)),t.traderShopItems.forEach(e=>Lf.set(e.id,e)),t.worlds.forEach(e=>{d1.set(e.id,e)});for(let e=0;e<t.filesExt.length;++e)Rf.push(t.filesExt[e]);for(let e=0;e<t.minimap.length;++e)qf.push(t.minimap[e])};var Vp=(t,e)=>{if(!Da.has(t))return console.log("unknown file id: "+t),"";let n=Da.get(t);return`${t}.${e||Rf[n.ext]}`};var On="webp",Gn="webp",h1="webp",g1=()=>new Promise((t,e)=>{let n=new Image;n.onerror=()=>{e()},n.onload=()=>{On=Gn=h1="avif",t(!0)},n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="}).catch(()=>{console.log("Avif not supported",navigator.userAgent)});g1();var dT=127,hT=254,v1=2**15-1,gT=2**16-1,_1=2**32-1;var Q3=t=>{let e=xa.modelformat.decode(t),n=v1/(_1/e.sx),i=v1/(_1/e.sy),s=v1/(_1/e.sz);for(let o=0;o<e.position.length;o+=3)e.position[o+0]=e.position[o+0]/n,e.position[o+1]=e.position[o+1]/i,e.position[o+2]=e.position[o+2]/s;for(let o=0;o<e.uv.length;++o)e.uv[o]/=gT;for(let o=0;o<e.color.length;++o)e.color[o]/=hT;for(let o=0,r=e.normal.length;o<r;o++)e.normal[o]=e.normal[o]/dT;return e};var b1=async(t,e,n,i,s,o=3)=>{switch(e.split(".").pop()){case"jpg":case"png":case"avif":case"webp":{let r=new Image;r.onload=()=>{n[e]=i(r),s(n[e],t+e),r.onload=void 0},r.src=t+e+"?v=8602459";break}default:{fetch(t+e+"?v=8602459").then(r=>{if(!r.ok)throw new Error;r.arrayBuffer().then(async l=>{n[e]=await i(l),s(n[e],t+e)})}).catch(r=>{console.log(e+" fetch failed"),o>1&&b1(t,e,n,i,s,--o)});break}}};var ol={},_T=(t,e)=>{for(let n=0,i=ol[e].length;n<i;++n)ol[e][n](...t);ol[e]=void 0},zf=async(t,e,n,i,s)=>{n[e]?s(...n[e]):ol[t+e]?ol[t+e].push(s):(ol[t+e]=[],ol[t+e].push(s),b1(t,e,n,i,_T))},bT=t=>{let e=Q3(new Uint8Array(t));return[{index:{type:5125,data:new Uint32Array(e.index)},position:{size:3,data:new Float32Array(e.position)},normal:{size:3,data:new Float32Array(e.normal)},uv:{size:2,data:new Float32Array(e.uv)},color:{size:4,data:new Float32Array(e.color)}},e]},yT={},Ko=(t,e)=>{zf("data/assets/",Vp(t),yT,bT,e)};var Bf,Fo,Z3=()=>{Bf=Ri(Sn({position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),0,N.TRIANGLES),fetch("/data/items/atlas.json?v=8602459").then(async t=>{Fo=await t.json();for(let e in Fo)e!="s"&&(Fo[e]=Fo[e].map(n=>n/Fo.s))})},kT=t=>{let e=Jo({image:t,wrapS:N.REPEAT,wrapT:N.REPEAT,minFilter:N.LINEAR_MIPMAP_LINEAR,anisotropy:2**re.anisotropy});return es(e),[e]},xT=t=>{let e=G3(t),n=Jo({buffer:e,minFilter:N.LINEAR_MIPMAP_LINEAR,wrapS:N.REPEAT,wrapT:N.REPEAT,width:e.width,height:e.height,anisotropy:2**re.anisotropy,format:e.internalFormat,internalFormat:e.internalFormat});return es(n),[n]},y1={},gi=(t,e)=>{Da.has(t)||console.log("unknown file id: "+t);let n=Da.get(t);n.ext===3&&I_?zf("data/assets/",`${t}.${Rf[n.ext]}`,y1,xT,e):zf("data/assets/",`${t}.${h1||Rf[n.ext]}`,y1,kT,e)},J3,K3=(t,e,n)=>{J3=e,zf("data/assets/",t+".ogg",y1,wT,n)},wT=async t=>[await J3.decodeAudioData(t)];var Zt=(t,e)=>t+Math.random()*(e-t),k1=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;var ey=t=>x1(t,Math.random()),x1=(t,e)=>t[Math.floor(e*t.length)];var gn,tr=[],er=new Map,Co=new Map,Lp=new Set,iy=t=>{gn&&(MT(),FT(t),Lp.clear())},MT=()=>{sy(gn.listener,gt.transform.worldMatrix),Mm(yo,Ht.worldMatrix),X(bt,0,0,1),Ch(bt,bt,yo),X(kn,0,1,0),Ch(kn,kn,yo),gn.listener.setOrientation(bt[0],bt[1],bt[2],kn[0],kn[1],kn[2])},FT=t=>{let e=0,n=0;for(;n<tr.length;){let i=tr[n];i.ended?CT(i.id):(tr[e]=i,e++),++n}tr.length=e},sy=(t,e)=>{t.setPosition(e[12],e[13],e[14])},oy=function(){this.ended=!0},CT=t=>{Co.set(t,Math.max(0,Co.get(t)-1))},ty=(t,e)=>{if(!Co.has(t))Co.set(t,1);else{if(Co.get(t)>=e)return!1;Co.set(t,Co.get(t)+1)}return!0},w1={},ry=(t,e)=>{let n=ey(t);w1[n]!==void 0?e.buffer=w1[n]:K3(n,gn,i=>{w1[n]=i,e.buffer=i})},Js=(t,e,n,i,s)=>{if(gn===void 0||gn.state=="suspended"||Lp.has(t))return;if(n===0){if(tr.length>35||(X(bt,e.worldMatrix[12],e.worldMatrix[13],e.worldMatrix[14]),1/((Co.get(t)||0)+10+qr(Ht.position,bt))*1e3/(tr.length+20)**1.2<.4)||!ty(t,2))return}else if(n===1&&!ty(t,5))return;let o=Ip.get(t);if(!o){console.log("unknown sound id:"+t);return}Lp.add(t);let r=gn.createBufferSource();r.id=t,r.loop=i,r.playbackRate.value=s,ry(o.files,r);let l=er.get(n).in;return r.panner=gn.createPanner(),r.panner.distanceModel="exponential",r.panner.refDistance=o.distance,r.panner.rolloffFactor=1,sy(r.panner,e.worldMatrix),r.connect(r.panner),r.panner.connect(l),r.start(0,0),r.onended=oy,tr.push(r),r},ly=t=>{gn=new(window.AudioContext||window.webkitAudioContext),["ambience","music"].forEach((o,r)=>{let l=gn.createGain();l.connect(gn.destination),er.set(2+r,{gain:l,in:l}),Hs[o+"Volume"].subscribe(a=>{er.get(2+r).gain.gain.value=(a/100)**2})});let e=gn.createDynamicsCompressor(),n=gn.createGain();e.threshold.value=0,e.knee.value=0,e.ratio.value=15,e.attack.value=.005,e.release.value=.05,e.connect(n),n.connect(gn.destination);let i=gn.createGain();i.gain.value=2,i.connect(e);let s=gn.createGain();s.gain.value=.4,s.connect(e),er.set(1,{gain:n,in:i}),er.set(0,{gain:n,in:s}),Wr.subscribe(o=>{er.get(1).gain.gain.value=(o/150)**2}),Gr.subscribe(o=>{er.get(0).in.gain.value=o/100}),u_.set(!0),document.removeEventListener("click",ly)},ny=!1,ay=(t,e)=>{ny||(ny=!0,document.addEventListener("click",ly))},cy=t=>{tr.length=0,Co.clear(),Lp.clear()},M1=(t,e,n,i)=>{if(gn===void 0||gn.state=="suspended")return;let s=Ip.get(t);if(!s)return;let o=gn.createBufferSource();o.id=t,o.loop=n,ry(s.files,o);let r=er.get(e).in;return i&&(o.gain=gn.createGain(),o.gain.connect(r),r=o.gain),o.connect(r),o.start(0,n?Zt(0,1):0),o.onended=oy,o},Mt=(t,e)=>{let n=M1(t,1,!1,e!==void 0);e!==void 0&&n&&(n.gain.gain.value=e)},fy=(t,e)=>M1(t,e,!0,!0),uy=(t,e)=>M1(t,e,!1,!0);var ll=Math.PI*2,AT=Math.PI*3,Ra=t=>t<0||t>ll?(t%ll+ll)%ll:t,Uf=(t,e,n,i)=>(Xt(kn,i,n),Xt(bt,e,n),Qi(kn,kn,bt),Jn(t,kn));var qp=(t,e,n,i,s,o)=>{let r=[n[0]-t[0],n[1]-t[1],n[2]-t[2]],l=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],a=[i-t[0],s-t[1],o-t[2]],c=dn(r,r),f=dn(r,l),u=dn(r,a),m=dn(l,l),g=dn(l,a),v=1/(c*m-f*f),_=(m*u-f*g)*v,b=(c*g-f*u)*v;return _>=0&&b>=0&&_+b<=1},Rp=(t,e)=>{let n=Math.sin(t[1]),i=Math.cos(t[1]);t[0]=e[2]*i+e[0]*n,t[2]=e[2]*n-e[0]*i},al=t=>{let e=Math.atan2(t[0],t[1]);return e<0&&(e+=2*Math.PI),e},zp=t=>{let e=Math.atan2(t[0],t[2]);return e<0&&(e+=2*Math.PI),e},cl=(t,e)=>(e-t+AT)%ll-Math.PI;var Bp=(t,e,n)=>{Xt(bt,n,t);let i=dn(bt,e);return on(bt,t,e,i)},my=(t,e,n,i,s,o,r,l,a)=>{let c=-(r*i+l*s+a*o);return r*t+l*e+a*n+c},F1=(t,e,n,i,s,o,r,l,a)=>{let c=-(r*i+l*s+a*o);return e+(r*t+a*n+c)/l},py=(t,e,n,i,s,o,r,l,a)=>{let c=(r*(i-t)+l*(s-e)+a*(o-n))/(r*r+l*l+a*a),f=t+c*r,u=n+c*a;return Math.sqrt(Math.pow(f-t,2)+Math.pow(u-n,2))};var za=(t,e)=>(t[0]=e[0],t[1]=e[2],t);var Up=(t,e,n)=>(t[0]=e[0]+n[0],t[2]=e[2]+n[1],t);var dy=(t,e,n,i,s)=>{Xt(bt,e,i);let o=2*dn(n,bt),r=dn(bt,bt)-s*s,l=o*o-4*r;l>0?(t[0]=(-o-Math.sqrt(l))/2,t[1]=(-o+Math.sqrt(l))/2):t[0]=t[1]=-1},Ba=(t,e,n,i,s,o)=>{Xt(bt,e,t),Xt(kn,n,t),Qi(el,bt,kn);let r=dn(s,el),l;if(r>0){if(!o)return 1/0;l=1}else if(r<0)l=-1,r=-r;else return 1/0;Xt(ds,i,t);let a=l*dn(s,Qi(kn,ds,kn));if(a<0)return 1/0;let c=l*dn(s,Qi(bt,bt,ds));if(c<0||a+c>r)return 1/0;let f=-l*dn(ds,el);return f<0?1/0:f/r};var hy=(t,e,n,i)=>{let s=0,o=0,r=1;e.length>2&&(s=i.findIndex(f=>f>=n),s<0&&(s=i.length),o=s>0?i[s-1]:0,r=s>=i.length?1:i[s]);let l=e[s],a=e[s+1],c=(n-o)/(r-o);return pa(t,l,a,c),s};var Op=[0,0],Ua=[0,0],ni=[0,0],nt={},gy={},PT=function(t){return this.press.push(t),t},TT=function(t){return this.release.push(t),t},un=(t,e)=>(e.press||(e.down=!1,e.onPress=PT,e.onRelease=TT,e.press=[],e.release=[],e.mappings=[],e.store||(e.store=ie(!1))),t=Array.isArray(t)?t:[t],t.forEach(n=>{gy[n]=e,e.mappings.push(n)}),f_.set(nt),e),vy=()=>{un(re.kbForward,nt.fwd={}),un(re.kbLeft,nt.left={}),un(re.kbBack,nt.back={}),un(re.kbRight,nt.right={}),un(re.kbNextTarget,nt.nextTarget={}),un(re.kbNextParty,nt.nextParty={}),un(re.kbUntarget,nt.untarget={}),un(" ",nt.jump={}),un(re.kbAltForward,nt.fwd),un(re.kbAltBack,nt.back),un(re.kbTurnRight,nt.turnright={}),un(re.kbTurnLeft,nt.turnleft={}),un("shift",nt.shift={}),un("m0",nt.lmb={}),un("m2",nt.rmb={}),un("control",nt.ctrl={}),un("alt",nt.alt={}),un(re.kbMap,nt.map={}),un(re.kbSkills,nt.skills={}).onPress(()=>{ho.update(t=>!t),Mt(89)}),un(re.kbCharacter,nt.char={}).onPress(()=>{_o.update(t=>!t),Mt(89)}),un(re.kbInventory,nt.inventory={}).onPress(()=>{po.update(t=>!t),Mt(90)}),un(re.kbClan,nt.clan={}).onPress(()=>{go.update(t=>!t),Mt(90)}),un(re.kbPvp,nt.pvp={}).onPress(()=>{vo.update(t=>!t),Mt(90)}),un(re.kbParty,nt.party={}).onPress(()=>{Zi.update(t=>!t),Mt(90)}),document.addEventListener("wheel",VT,{passive:!0}),document.addEventListener("keydown",qT,!1),document.addEventListener("keyup",RT,!1),document.addEventListener("contextmenu",LT,!1),document.addEventListener("mousedown",IT,!1),document.addEventListener("mouseup",DT,!1),document.addEventListener("mousemove",ET,!1)},_y=t=>{C1&&(C1=!1,re.pointerlock&&!(nt.lmb.down||nt.rmb.down)&&(document.exitPointerLock(),$p=!1))},Of=0,ET=t=>{if(di(Op,2*(t.x*re.resolutionScale/Fi.width)-1,2*(1-t.y*re.resolutionScale/Fi.height)-1),di(Ua,~~(t.x*re.resolutionScale),~~(t.y*re.resolutionScale)),nt.rmb.down||nt.lmb.down){let e=vt(t.movementX,-100,100),n=vt(t.movementY,-100,100);ni[1]=vt(ni[1]+n*.0028*(re.invertMouseY?-re.mouseSensitivity:re.mouseSensitivity),-Math.PI/2,Math.PI/2),ni[0]=Ra(ni[0]-e*.005*(re.invertMouseX?-re.mouseSensitivity:re.mouseSensitivity)),Of+=Math.abs(n)+Math.abs(e)}},by=!1;En.subscribe(t=>{by=t!==void 0});var $p=!1,C1=!1,IT=t=>{(t.target==Fi||t.target.id=="chat")&&(re.pointerlock&&($p=!0,Fi.requestPointerLock()),nr("m"+t.button,!0),by&&En.update(e=>{e&&e.discard&&e.discard()}))},DT=t=>{nr("m"+t.button,!1),Of=0,C1=!0},VT=t=>{t.target==Fi&&Om.update(e=>vt(e+(t.deltaY>0?1:-1),2,18))},LT=t=>{t.preventDefault()},nr=(t,e,n)=>{let i=gy[t];return i!==void 0?(i.down!=e&&(i.down=e,i[e?"press":"release"].forEach(s=>{s(n)}),i.store.set(i.down)),n&&n.preventDefault(),!0):!1},qT=t=>{if(!yy(t))return;let e=t.key.toLowerCase();t.ctrlKey&&nr("ctrl+"+e,!0,t)||t.shiftKey&&nr("shift+"+e,!0,t)||nr(e,!0,t)},RT=t=>{if(!yy(t))return;let e=t.key.toLowerCase();nr("ctrl+"+e,!1),nr("shift+"+e,!1),nr(e,!1)},yy=t=>{let e=t.target.tagName.toLowerCase();return e!=="input"&&e!=="textarea"};var ky=(t,e,n,i)=>{window.gtag&&window.gtag("event",t,{event_category:e,event_label:n,value:i})};var S1=t=>1+(t-1)*.23,xy=t=>{let e=0;return t.forEach(n=>{e+=n.stats.getStat(18)}),BT(e,t.length)},BT=(t,e)=>t/Math.max(1,e)/100;var UT=[300,600,1e3,1400,2e3,2600,3200,4e3,4800,5700,6700,7700,8800,1e4,11500,13e3,14600,16400,18400,20400,22600,25100,27700,30400,33400,36600,4e4,43700,47500,51500,56200,61e3,66600,72500,78500,85300,92400,99700,107300,115700,124400,133400,142700,152300,162100],ir=t=>UT[vt(t,1,45)-1];var Np=class{constructor(e){this.id=e.id,this.cd=e.cd!==void 0?e.cd:0,this.costMp=e.costMp,this.targetMode=e.targetMode||0,this.onCast=e.onCast,this.onPermanent=e.onPermanent,this.range=e.range||0,this.graceRange=this.range+Math.min(this.range*.2,10),this.auto=e.auto||!1,this.engineOnly=e.engineOnly||!1,this.minlevel=e.minlevel||0,this.castLen=e.castLen||0,this.gcd=e.gcd!==void 0?e.gcd:1.5,this.custom=e.custom,this.skilllevels=Math.min(5,e.skilllevels||5),this.goldValue=e.goldValue||0,this.noReward=e.noReward||!1,this.outOfCombat=e.outOfCombat||!1,this.pvpBoundsAdd=e.pvpBoundsAdd||0,this.ignoreGcd=e.ignoreGcd||!1,this.ignoreIncapacitated=e.ignoreIncapacitated||!1,this.disablingBuffs=e.disablingBuffs||[],this.hasteAffected=e.hasteAffected!==void 0?e.hasteAffected:!0,this.skillpoints=e.skillpoints!==void 0?e.skillpoints:1,this.envCast=e.envCast||0}can(e,n,i=0,s){if(this.outOfCombat&&!e.stats.combatTimer.done(V.time))return 11;if(this.costMp!==void 0&&e.stats.getResource(7)<this.costMp(n))return 5;if(this.targetMode!==1){let o=V.getEntityById(i),r=o===void 0||o.stats.alive,l=o===void 0?-1:e.hostility(o);if(this.targetMode===4096){if((l===-1||l===0)&&r)return 3;if(!e.canCombatInteract(o))return 13}else if(this.targetMode===256){if((l===-1||l!==0)&&r)return 4}else if(this.targetMode===16)o=e;else if(this.targetMode===17&&(o===void 0||o===e))return 3;if(o!==void 0&&!o.stats.alive)return 10;if(o&&i!==e.id&&o!==e&&this.range>0&&!e.combatRangeCheck(o,s?this.range:this.graceRange))return 6}return this.disablingBuffs.some(o=>e.buffs.hasAnyWithTag(o))?12:0}};var we=class extends Np{constructor(e){super(e),this.fx=e.fx||{},this.autoSkillbar=e.autoSkillBar!==!1}};var Oa=(t,e,n,i)=>({id:t,minlevel:n,engineOnly:!1,cd:0,custom:i,autoSkillBar:!1,onPermanent:()=>e}),Ai=(t,e,n,i,s,o,r,l)=>({id:t,targetMode:16,minlevel:n,cd:s,costMp:r,fx:l,onCast:(a,c,f)=>({id:e,mode:4,stacks:1,duration:i,caster:a.id,target:a.id,aoe:{faction:!0,limit:o,circleRadius:30,circleHeight:20},level:c})}),jp=(t,e,n,i,s,o,r,l=5,a)=>({id:t,targetMode:256,range:30,minlevel:n,cd:s,castLen:i,costMp:r,fx:a,onCast:(c,f,u)=>({id:e,mode:l,stacks:1,caster:c.id,target:u,refresh:!0,duration:o,level:f})}),fl=(t,e,n=0,i=!0,s,o=!1,r=!1,l)=>({id:t,targetMode:16,cd:e,gcd:0,hasteAffected:!1,ignoreIncapacitated:o,ignoreGcd:!0,castLen:n,engineOnly:!0,outOfCombat:s,fx:l});var wy=new we(Oa(21,77,1));var My=new we({id:2,targetMode:16,minlevel:5,cd:30,gcd:0,costMp:t=>3+t*5,fx:{animCast:6},custom:[[t=>7+t*12," heal on block"]],onCast:(t,e,n)=>({id:59,mode:4,stacks:1,duration:9,caster:t.id,target:t.id,level:e})});var Fy=t=>.7+t*.2,OT=t=>Fy(t)+30/(250/20),Cy=new we({id:33,targetMode:17,skilllevels:1,minlevel:11,cd:15,range:30,disablingBuffs:[4],costMp:t=>12,custom:[[Fy,"s stunned at min range"],[OT,"s stunned at max range"]],onCast:(t,e,n)=>{}});var Sy=new we(Ai(20,76,15,300,150,20,t=>t*8,{animCast:6}));var Ay=new we({id:18,cd:0,minlevel:8,autoSkillBar:!1,fx:{},onPermanent:()=>73});var Py=new we({id:3,targetMode:1,minlevel:3,cd:6,costMp:t=>2+t*2,fx:{animCast:5,effectDirImpact:9},onCast:(t,e,n)=>({id:3,mode:0,caster:t.id,dmg:t.stats.getDamageRoll()*(1+e*.18),type:1,aoe:{faction:!1,circleRadius:2+5*t.size}})});var Ty=new we({id:17,targetMode:16,minlevel:13,cd:50,gcd:0,costMp:t=>t*8,fx:{animCast:6},onCast:(t,e,n)=>({id:72,mode:4,stacks:1,duration:17,caster:t.id,target:t.id,level:e})});var Ey=new we({id:50,targetMode:1,minlevel:7,cd:30,costMp:t=>t*4,fx:{animCast:40},custom:[[t=>20+t*5," % missing + 100 HP recovered"]],onCast:(t,e,n)=>({id:121,mode:4,stacks:1,caster:t.id,buffdata:[0],sendBuffData:!0,duration:1+e,level:e,aoe:{faction:!1,circleRadius:8}})});var $T=t=>t*8,Iy=new we({id:1,targetMode:4096,minlevel:1,cd:1,range:2,custom:[[$T,"% chance to daze target for 3 seconds"]],costMp:t=>1+t,fx:{animImpact:3},onCast:(t,e,n)=>{let i=5+t.stats.getDamageRoll()*(.38+e*.39);return{id:1,mode:0,caster:t.id,target:n,dmg:i,type:1}}});var Dy=t=>1e4+t*1e4,NT=(t,e)=>{if(e.type===1){let n=0;e.aggroValues.forEach((i,s)=>{i>n&&(n=i)}),e.aggroValues.set(t.caster,n+Dy(t.level)),e.buffs.buffs.has(122)&&add({id:125,mode:5,stacks:t.level,caster:e.id,target:t.caster,refresh:!0,duration:60,level:1})}},Vy=new we({id:34,targetMode:1,minlevel:6,cd:15,costMp:t=>t*4,fx:{animCast:7},custom:[[Dy," aggro generation"]],onCast:(t,e,n)=>({custom:NT,id:89,mode:4,stacks:1,caster:t.id,duration:2+e,level:e,aoe:{faction:!1,circleRadius:10}})});var Ly=new we({id:41,targetMode:16,minlevel:25,cd:30,skilllevels:1,gcd:0,costMp:t=>3+t*5,onCast:(t,e,n)=>{}});var qy=new we(Ai(19,75,18,300,150,20,t=>t*8,{animCast:6}));var Ry=new we({id:46,targetMode:1,range:30,minlevel:4,cd:30,castLen:0,costMp:t=>10+t*3,fx:{effectTarget:106},onCast:(t,e,n)=>{}});var zy=new we(Ai(22,78,17,300,120,20,t=>5+t*10,{animCast:6}));var By=new we(jp(24,80,15,1.5,0,300,t=>2+t*3,4,{animCast:9,animChannel:18}));var Uy=new we({id:52,targetMode:1,minlevel:7,envCast:7,cd:6,range:25,costMp:t=>t*2,fx:{effectMissile:107,effectTarget:111},onCast:(t,e,n,i,s,o)=>{}});var Oy=new we({id:14,targetMode:1,minlevel:3,cd:25,costMp:t=>t*4,fx:{animCast:31},onCast:(t,e,n)=>({id:69,mode:4,stacks:1,caster:t.id,duration:5.5+e*.5,level:e,aoe:{faction:!1,circleRadius:8}})});var $y=new we({id:16,targetMode:16,minlevel:13,cd:45,gcd:0,fx:{animCast:6},onCast:(t,e,n)=>({id:71,mode:4,stacks:1,duration:12,caster:t.id,target:t.id,level:e})});var Ny=new we({id:53,targetMode:16,minlevel:9,cd:80,gcd:0,ignoreIncapacitated:!0,ignoreGcd:!0,costMp:t=>t*5,onCast:(t,e,n)=>({id:117,mode:4,duration:5,stacks:1,caster:t.id,target:t.id,level:e})});var jy=new we({id:4,targetMode:4096,range:30,minlevel:1,cd:0,castLen:1.5,custom:[[t=>100+t*10,"% frozen buff multiplier"]],costMp:t=>1+t*2,fx:{animCast:29,effectDirImpact:30,animChannel:30,effectMissile:27},onCast:(t,e,n)=>({id:4,mode:6,speed:25,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.3+e*.32),type:1}),onPermanent:()=>100});var Wy=t=>2+t*2,Gy=new we({id:23,targetMode:16,minlevel:5,cd:60,gcd:0,costMp:t=>t*5,custom:[[Wy," attacks blocked"]],fx:{animCast:6},onCast:(t,e,n)=>({id:79,mode:4,stacks:Wy(e),duration:60,caster:t.id,target:t.id,level:e})});var Hy=new we({id:15,targetMode:1,range:30,minlevel:8,cd:8,castLen:1.5,costMp:t=>5+t*5,fx:{animCast:29,animChannel:30,effectDirImpact:31,effectMissile:28},onCast:(t,e,n)=>({id:15,mode:6,speed:10,timeout:2.5,caster:t.id,rot:t.rot,dmg:10+t.stats.getDamageRoll()*(.56+e*.6),type:1,aoe:{circleRadius:4+e*.5,faction:!1,onlyOnce:[]}})});var Yy=new we({id:51,targetMode:4096,range:30,minlevel:4,cd:10,castLen:2.8,costMp:t=>1+t*2,fx:{animCast:37,effectDirImpact:119,animChannel:30,effectMissile:118},onCast:(t,e,n)=>({id:51,mode:6,speed:20,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(1.25+e*1.33),type:1,noBlock:!0})});var jT=()=>12,Xy=new we({id:32,targetMode:1,skilllevels:1,minlevel:5,gcd:.7,cd:12,disablingBuffs:[4],costMp:t=>t*4,fx:{animCast:32},custom:[[jT,"m distance"]],onCast:(t,e,n)=>{}});var Qy=new we({id:37,targetMode:4096,range:30,minlevel:15,cd:40,castLen:2.3,costMp:t=>5+t*5,fx:{animCast:9,effectImpact:50,animChannel:16},onCast:(t,e,n)=>({id:91,mode:4,stacks:1,caster:t.id,target:n,duration:2.4+e*1,level:e})});var Zy=new we(Ai(28,84,12,15,60,15,t=>1+t*3,{animCast:6}));var Jy=new we({id:12,targetMode:4096,range:30-5,minlevel:1,castLen:0,cd:3,costMp:t=>Math.round(1+t*4.5),fx:{animCast:10,effectMissile:48},onCast:(t,e,n)=>({id:12,mode:6,dmg:5+t.stats.getDamageRoll()*(.03+e*.13),type:1,speed:15,caster:t.id,target:n,level:e})});var Ky=new we({id:30,targetMode:1,range:30,minlevel:18,cd:60,castLen:2.3,costMp:t=>10+t*8,fx:{effectImpact:70,animCast:14,animChannel:15,effectMissile:69},onCast:(t,e,n)=>({id:30,mode:6,speed:0,timeout:30,caster:t.id,rot:t.rot,interval:new kt(0,2),heal:t.stats.getDamageRoll()*(.08+e*.05),type:1,aoe:{circleRadius:30,circleHeight:30,faction:!0,limit:15}})});var ek=new we(Ai(13,68,6,15,90,15,void 0,{animCast:22}));var tk=new we({id:6,targetMode:256,range:30,minlevel:8,cd:0,castLen:1.7,costMp:t=>4+t*4,fx:{animCast:11,effectImpact:36,animChannel:12},onCast:(t,e,n)=>({id:6,mode:2,caster:t.id,target:n,heal:15+t.stats.getDamageRoll()*(.2+e*.18)})});var nk=new we({id:47,targetMode:256,range:30,minlevel:14,cd:12,castLen:0,costMp:t=>4+t*4,fx:{animCast:9,effectTarget:112},custom:[[t=>t," effects removed"]],onCast:(t,e,n)=>{let i=0;return{id:47,mode:2,caster:t.id,target:n,heal:(1+i)*(15+t.stats.getDamageRoll()*.25)}}});var WT=t=>1+t*2,GT=t=>1+t*2,ik=new we(Oa(43,106,3,[[WT,"% haste per stack"],[GT," jumps"]]));var sk=new we(jp(7,60,3,0,0,12,t=>2+t*2,5,{animCast:9}));var HT=t=>Math.round(t*1.3),YT=t=>t*2,ok=new we({id:42,targetMode:1,minlevel:8,cd:8,castLen:0,range:30-5,custom:[[HT," mana gained per soul"],[YT," extended Decay duration"]],costMp:t=>1+t*3,fx:{animCast:13,effectImpact:46},onCast:(t,e,n)=>({id:42,mode:1,caster:t.id,target:0,type:1,dmg:4+t.stats.getDamageRoll()*(.25+e*.4),level:e})});var rk=new we({id:105,engineOnly:!0,cd:0,fx:{effectImpact:47,effectMissile:45}});var lk=new we({id:36,targetMode:16,minlevel:10,cd:30,gcd:0,costMp:t=>8+t*2,onCast:(t,e,n)=>({id:90,mode:4,stacks:1,duration:5+e*5,caster:t.id,target:t.id,level:e})});var ak=new we({id:35,targetMode:1,skilllevels:1,minlevel:5,cd:120,skillpoints:0,castLen:5,outOfCombat:!0,hasteAffected:!1,pvpBoundsAdd:5,costMp:t=>20+t*5,fx:{animCast:20,animChannel:21},onCast:(t,e,n)=>{}});var ck=new we({id:49,targetMode:4096,range:30,minlevel:13,cd:25,costMp:t=>1+t*1,fx:{animCast:38,effectMissile:123,animChannel:28},onCast:(t,e,n)=>({id:49,buffid:119,mode:7,speed:60,caster:t.id,level:e,stacks:1,duration:1+e*2,refresh:!0,target:n})});var fk=new we({id:54,targetMode:4096,range:30,minlevel:8,cd:10,castLen:2.8,costMp:t=>8+t*3,fx:{animCast:39,effectDirImpact:121,animChannel:25,effectMissile:114},onCast:(t,e,n)=>({id:54,mode:6,speed:60,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(1.25+e*1.33),type:1,noBlock:!0})});var uk=new we(Oa(26,82,15));var XT=t=>3+t*5,mk=new we({id:11,targetMode:16,minlevel:7,cd:50,gcd:0,fx:{animCast:6},custom:[[XT,"% of max mp recovered"]],onCast:(t,e,n)=>({id:66,mode:4,stacks:1,duration:17,caster:t.id,target:t.id,level:e})});var pk=new we(Ai(27,83,12,10,80,20,t=>5+t*7,{animCast:6}));var dk=new we({id:29,cd:0,minlevel:9,autoSkillBar:!1,onPermanent:()=>85});var hk=new we({id:9,targetMode:4096,range:30,minlevel:3,cd:6,castLen:1.7,costMp:t=>2+t*3,fx:{animCast:24,effectDirImpact:85,animChannel:25,effectMissile:33},onCast:(t,e,n)=>({id:9,mode:6,speed:120,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.53+e*.45),type:1})});var gk=new we({id:10,targetMode:16,minlevel:5,cd:0,autoSkillBar:!1,skillpoints:0,onPermanent:()=>65});var vk=new we({id:38,targetMode:16,minlevel:5,skilllevels:1,cd:10,gcd:0,disablingBuffs:[4],costMp:t=>6,fx:{animCast:23},onCast:(t,e,n)=>!0});var _k=new we({id:31,targetMode:4096,range:30,minlevel:1,cd:0,castLen:1.5,costMp:t=>1+t*1,fx:{animCast:27,effectDirImpact:84,effectMissile:34,animChannel:28},onCast:(t,e,n)=>({id:31,mode:6,speed:60,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.24+e*.25),type:1})});var bk=new we(Ai(25,81,18,300,120,20,t=>5+t*5,{animCast:6}));var yk=new we({id:48,targetMode:4096,range:30,minlevel:6,cd:20,ignoreGcd:!0,costMp:t=>1+t*1,fx:{animCast:36,effectDirImpact:115,effectMissile:113,animChannel:28},custom:[[t=>t*120," HP recovered"]],onCast:(t,e,n)=>({id:48,mode:6,speed:80,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.28+e*.28),type:1})});var kk=new we({id:106,engineOnly:!0,cd:0,fx:{effectMissile:116,effectImpact:117}});var xk=new we({id:45,targetMode:1,range:30,minlevel:4,cd:25,castLen:0,costMp:t=>18+t*3,fx:{effectDirImpact:11,effectMissile:103},onCast:(t,e,n)=>{}});var QT={medalValue:1e3,goldValue:5e4,buyElo:1600,quality:90,level:45,gs:30,uniqueEquipped:!0},A1=[{id:0,custom:["Use: Removes all movement limiting effects."],useCd:60,incap:!0,animCast:45},{id:1,custom:["Use: Protects you against 30% of incoming damage for 10 seconds."],useCd:60,animCast:6,incap:!1},{id:2,custom:["Use: Increases your damage by 20% for 10 seconds."],useCd:80,incap:!1,animCast:6},{id:3,custom:["Use: Speeds up your movement by 45 for 8 seconds."],useCd:50,incap:!1,animCast:6},{id:4,custom:["Use: Attacks made against you grant 20 MP (up to 200) for 20 seconds."],useCd:60,incap:!1,animCast:6}],wk=t=>{A1.forEach((e,n)=>{t["charm"+e.id]={...QT,...e,type:"charm",tier:e.id,useSkill:107+n}})};var Mk=new we(fl(100,30,0,!0,!0,!1,!1,{animCast:17})),Fk=new we(fl(101,1.5,0,!0,!1,!1,!1)),Ck=new we(fl(104,1.5,0,!1,!1,!1,!1,{animCast:6})),Sk=new we(fl(103,1.5,3,!0,!1,!1,!1,{animCast:19,animChannel:18})),Ak=new we(fl(102,1.5,1.5,!1,!0,!1,!1,{animCast:9,animChannel:18})),Pk=A1.map((t,e)=>new we(fl(107+e,t.useCd,0,!1,!1,t.incap,!0,{animCast:t.animCast}))).reduce((t,e)=>({...t,["charm"+e.id]:e}),{});var Tk=new we({id:5,targetMode:4096,range:30,engineOnly:!0,auto:!0,cd:t=>100/t.stats.getStat(17),fx:{animCast:26,effectDirImpact:11,effectMissile:32},onCast:(t,e,n)=>({id:5,mode:6,speed:15*3,caster:t.id,target:n,dmg:t.stats.getDamageRoll(),type:0})});var Ek=new we({id:56,targetMode:1,range:50,cd:10,engineOnly:!0,castLen:2,fx:{animCast:41,animChannel:42}});var Ik=new we({id:44,targetMode:1,range:50,minlevel:3,cd:5,engineOnly:!0,castLen:1.5,costMp:t=>t*4});var Dk=new we({id:55,targetMode:1,range:50,minlevel:3,cd:20,engineOnly:!0,castLen:2,fx:{effectMissile:131,animCast:43,animChannel:42}});var Vk=new we({id:58,targetMode:1,range:10,cd:2,engineOnly:!0,hasteAffected:!1,castLen:30,fx:{animCast:9,animChannel:44}});var Lk=new we({id:57,targetMode:4096,engineOnly:!0,fx:{effectMissile:153,effectDirImpact:154}});var qk=new we({id:0,targetMode:4096,engineOnly:!0,auto:!0,range:2,cd:t=>100/t.stats.getStat(17),fx:{animImpact:4},onCast:(t,e,n)=>({id:0,mode:0,caster:t.id,target:n,dmg:t.stats.getDamageRoll(),type:0})});var Rk=new we({id:39,engineOnly:!1,skilllevels:1,minlevel:30,cd:0,goldValue:25e3,skillpoints:0,noReward:!0,autoSkillBar:!1});var zk=new we({id:40,targetMode:1,engineOnly:!0,cd:300,castLen:5,outOfCombat:!0,hasteAffected:!1,costMp:t=>20+t*5,fx:{animCast:9,animChannel:8},onCast:(t,e,n)=>{}});var Bk=new we({id:8,engineOnly:!0,cd:0,onPermanent:t=>t.class+61});var ZT={...Pk,hellspawn_missile:Lk,conjurer_obeliskport:Vk,boss_bigaoe:Ek,boss_puddledot:Dk,recall:zk,arrow:Tk,melee:qk,potion:Mk,book:Fk,specialization:Bk,mount:Rk,activatemount:Ak,container:Sk,boss_flamepits:Ik,useGeneric:Ck},JT={relentlessCry:Ey,whirlwind:Ry,temper:Ly,taunt:Vy,charge:Cy,warcry:qy,courage:Sy,armorreinforcement:wy,enrage:Ty,slash:Iy,blockBuff:My,crescentStrike:Py,crescentBleed:Ay},KT={frostcall:Uy,iceblock:Ny,shatterfrost:Yy,teleport:Xy,enchantment:By,arcticaura:zy,iceshield:Gy,hypothermic:$y,frostnova:Oy,icebolt:jy,icicle:Hy},e7={vampiricarrowReturn:kk,boneshot:fk,blindingshot:ck,vampiricarrow:yk,volley:xk,snipe:vk,poisonarrows:dk,temporaldilation:bk,pathfinding:pk,preciseShot:hk,serpentArrows:gk,invigorate:mk,swiftshot:_k,cranialpunctures:uk},t7={mimirscleanse:nk,soulharvestReturn:rk,plaguespreader:ik,soulharvest:ok,agonize:Qy,caninehowl:Zy,mana:ek,mend:tk,revitalize:sk,decay:Jy,healingtotem:Ky,summon:ak,spiritanimal:lk},Pt=new Map;[JT,KT,e7,t7,ZT].forEach((t,e)=>{for(let n in t)e<=3&&(t[n].class=e),Pt.set(t[n].id,t[n])});Pt.set(60,new we({id:60,engineOnly:!0}));var Ok=[1600,1800,2e3,2200],Uk=Ok.length,$a=t=>{for(let e=0;e<Uk;++e)if(Ok[e]>t)return e;return Math.max(0,Uk)},n7=10,i7=30,s7=240,o7=-.0015,r7=930,l7=100,$f=t=>n7+Math.round(Math.max(t/i7,s7*(1-Math.exp(o7*(t-r7)))-l7));var a7=[0,0,1,1,2,3],P1=(t,e)=>"book"+(e!==void 0?e:"")+a7[t%5],Nf=(t,e,n,i)=>`https://raw.githubusercontent.com/2f147f0487a9fe5b/cb2e2197348007b8/main/${t}/${t=="book"?P1(e,n):t+e}_q${i}.webp?v=8602459`,jf=t=>`/data/ui/skills/${t}.${Gn}?v=8602459`,$k=t=>`/data/ui/slotbg/${t}.${On}?v=8602459`,Nk=(t,e,n)=>`/data/world/${t}/map/${e}/${n}.${Gn}?v=8602459`,Ks=t=>`/data/ui/classes/${t}.${On}?v=8602459`,T1=t=>`/data/ui/factions/${t}.${On}?v=8602459`,jk=t=>`/data/ui/elo/${$a(t)}.svg?v=8602459`,Wk="/data/ui/currency/medal.svg?v=8602459",Na="/data/ui/currency/prestige.svg?v=8602459",sr="/data/ui/currency/fame.svg?v=8602459",Gk=t=>`/data/ui/rank/rank${t}.svg?v=8602459`;var Hk=t=>{Pt.forEach(e=>{if(!e.engineOnly)for(let n=0;n<e.skilllevels;++n){let i=e.id*5+n;t[`book${i}`]={type:"book",tier:i,level:e.minlevel+n*8,skillid:e.id,skilllevel:n,class:e.class,noReward:e.noReward||!1,goldValue:e.goldValue||(e.minlevel+n*5<5?4:0),quality:Math.round(Math.min(99,30+70*(n/5))),art:P1(i,e.class),useSkill:101}}})};var c7=[{id:0,storeValue:300,quality:90,level:1,custom:["Contains random mount (account bound) of rare or epic quality"],bindOnPurchase:1,useSkill:103},{id:1,storeValue:900,quality:90,level:1,custom:["Adds one month of Elixir to your account"],bindOnMerchant:1,useSkill:103},{id:2,storeValue:700,quality:90,level:1,bindOnMerchant:1,custom:["Used to upgrade rare pets, allowing them to pick up items."]}],Yk=t=>{c7.forEach(e=>{t["box"+e.id]={...e,type:"box",tier:e.id,unsellable:!0}})};var zi={hammer:{sound:119,rot:1},bow:{sound:120,rot:1},staff:{sound:120,rot:1},sword:{sound:119,rot:1},armlet:{sound:121},armor:{sound:122},bag:{sound:121},boot:{sound:121},glove:{sound:121},ring:{sound:123},amulet:{sound:123},quiver:{sound:121,rot:1},shield:{sound:122},totem:{sound:122,rot:1},orb:{sound:122},rune:{sound:123,rot:0},misc:{sound:124,rot:1},book:{sound:121},mount:{sound:121,rot:0},pet:{sound:121,rot:0},box:{sound:125,rot:0},gold:{sound:126},charm:{sound:123}},An={hammer:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:3,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:15,min:.05,max:.1}},stackable:!1},bow:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:2,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}},stackable:!1},staff:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:1,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}},stackable:!1},sword:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:0,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:20,min:.05,max:.1}},stackable:!1},armlet:{baselvl:1,slot:[102],tiers:13,drop:1,weight:.3,stats:{6:{base:10,min:.5,max:.9},12:{base:7,min:.5,max:.8}},stackable:!1},armor:{baselvl:2,slot:[103],tiers:11,drop:1,weight:1,stats:{12:{base:10,min:1.4,max:2.8},6:{base:20,min:1,max:2}},stackable:!1},bag:{baselvl:5,slot:[104],tiers:5,drop:1,weight:.1,stats:{19:{base:1,min:.1,max:.3}},stackable:!1},boot:{baselvl:2,slot:[105],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.6,max:1.1},15:{base:3,min:.03,max:.1}},stackable:!1},glove:{baselvl:2,slot:[106],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.7,max:1.1},14:{base:1,min:.1,max:1.5}},stackable:!1},ring:{baselvl:5,slot:[107],tiers:12,drop:.8,weight:.2,stats:{6:{base:10,min:.5,max:.9},7:{base:5,min:.6,max:1}},stackable:!1},amulet:{baselvl:7,slot:[108],tiers:12,drop:.8,weight:.3,stats:{7:{base:10,min:1,max:1.8},9:{base:1,min:.2,max:.3}},stackable:!1},quiver:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:2,stats:{14:{base:5,min:.1,max:.9},9:{base:1,min:.1,max:.3}},stackable:!1},shield:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:0,stats:{12:{base:20,min:.8,max:1.4},13:{base:4,min:1,max:2.8}},stackable:!1},totem:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:3,stats:{12:{base:10,min:.4,max:.9},9:{base:1,min:.1,max:.4}},stackable:!1},orb:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:1,stats:{3:{base:10,min:.3,max:.7},9:{base:1,min:.1,max:.3}},stackable:!1},rune:{baselvl:1,tiers:11,drop:.8,quality:70,stackable:!0},misc:{drop:8,weight:.1,stackable:!0},book:{drop:1.6,weight:.5,stackable:!0},charm:{slot:[110,111],noupgrade:!0,undroppable:!0,drop:0,stackable:!1},mount:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},box:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},pet:{undroppable:!0,drop:0,stackable:!1},gold:{drop:24}},Xk=Object.keys(An),Wf={6:{min:.2,max:.8,round:!0},7:{min:.2,max:.5,round:!0},8:{min:.1,max:1},9:{min:.1,max:.5},10:{min:.03,max:.13,round:!0},11:{min:.1,max:.2,round:!0},12:{min:.1,max:.8,round:!0},13:{min:.1,max:.4},14:{min:.1,max:.5},16:{min:.1,max:.4},2:{min:.08,max:.45,round:!0},0:{min:.08,max:.45,round:!0},3:{min:.08,max:.45,round:!0},4:{min:.08,max:.45,round:!0},1:{min:.08,max:.45,round:!0},5:{min:.08,max:.45,round:!0},18:{min:.01,max:.15,round:!0}},Qk=Object.keys(Wf),Gf={6:4,7:3,8:5,9:4,10:1,11:1,12:5,13:5,14:5,15:.3,16:5,17:0,2:2,0:2,3:2,4:2,1:2,5:2,19:1,18:2};var Zk=t=>{for(let e in An)if(An[e].tiers){let n=An[e];for(let i=0;i<n.tiers;++i)u7({type:e,tier:i,stats:n.stats,level:f7(e,i),class:n.class,quality:n.quality},t)}},f7=(t,e)=>An[t].baselvl+Math.floor(e/An[t].tiers*100),u7=(t,e)=>{let n={level:t.level,type:t.type,tier:t.tier,stats:t.stats?new Map:void 0,class:t.class,quality:t.quality};t.stats&&Object.keys(t.stats).sort((i,s)=>i-s).forEach(i=>{let s=t.stats[i];n.stats.set(parseInt(i),{min:s.base+t.level*s.min,max:s.base+(t.level+10)*s.max})}),e[t.type+t.tier]=n};var m7=[250,100,500,200,1e3,300],Jk=t=>{for(let e=0;e<6;++e){let n=Math.floor(e/2),i=e%2==0;t["misc"+e]={type:"misc",tier:e,level:1+n*20,goldvalue:5**n,quality:15,custom:[""+m7[e]+(i?" HP recovered":" MP recovered")],useSkill:100}}};var p7=[{lvl:30,g:1e4,qual:50,store:0,skin:6},{lvl:30,g:2e4,qual:50,store:0,skin:21},{lvl:30,g:5e4,qual:80,store:300,skin:51},{lvl:30,g:5e4,qual:80,store:300,skin:52},{lvl:30,g:5e4,qual:95,store:1200,skin:22},{lvl:30,g:5e4,qual:90,store:600,skin:23},{lvl:30,g:5e4,qual:80,store:300,skin:24},{lvl:30,g:5e4,qual:90,store:600,skin:25},{lvl:30,g:5e4,qual:95,store:1200,skin:27},{lvl:30,g:5e4,qual:95,store:1200,skin:28},{lvl:30,g:5e4,qual:80,store:300,skin:30},{lvl:30,g:5e4,qual:95,store:1200,skin:31},{lvl:30,g:5e4,qual:95,store:1200,skin:32},{lvl:30,g:5e4,qual:85,store:400,skin:29},{lvl:30,g:5e4,qual:95,store:1200,skin:33},{lvl:30,g:5e4,qual:95,store:0,skin:94},{lvl:30,g:5e4,qual:95,store:0,skin:95},{lvl:30,g:5e4,qual:95,store:0,skin:96},{lvl:30,g:5e4,qual:95,store:0,skin:97},{lvl:30,g:5e4,qual:95,store:0,skin:98},{lvl:30,g:5e4,qual:95,store:0,skin:100},{lvl:30,g:5e4,qual:95,store:0,skin:101},{lvl:30,g:5e4,qual:95,store:0,skin:93},{lvl:30,g:5e4,qual:95,store:0,skin:91},{lvl:30,g:5e4,qual:95,store:0,skin:99},{lvl:30,g:5e4,qual:95,store:0,skin:92}].map(t=>({level:t.lvl,goldValue:t.g,storeValue:t.store,bindOnUse:1,bindOnMerchant:t.store>0?1:0,quality:t.qual,skin:t.skin})),Kk=t=>{p7.forEach((e,n)=>{t["mount"+n]={...e,type:"mount",tier:n,requiredSkill:39,useSkill:102}})};var d7=[1919,1920,1944,1945,1946,1947,1948,1960,1968,1969,1970,1971,1972,1973,1974,1975],ex=t=>{d7.forEach((e,n)=>{t["pet"+n]={level:10,unsellable:!0,storeValue:e>1920?0:900,quality:90,bindOnUse:1,bindOnMerchant:e>=1968?0:1,type:"pet",tier:n,useSkill:104,skin:e}})};var ln={};Zk(ln);Jk(ln);Hk(ln);Kk(ln);wk(ln);ex(ln);Yk(ln);var rr=Object.values(ln);rr.forEach((t,e)=>t.id=e);var Pi=[{step:10,fun:()=>nt.fwd.down||nt.left.down||nt.right.down},{step:10,fun:()=>nt.lmb.down||nt.rmb.down,click:!0},{click:!0},{element:"ufplayer",click:!0},{},{element:"uftarget",click:!0},{element:"sk1"},{},{click:!0},{element:"expbar",click:!0},{},{element:"sysbag",step:100,fun:()=>re.inventoryOpen},{element:"bag2",click:!0},{click:!0},{element:"syschar",step:100,fun:()=>re.charpanelOpen},{element:"equipslots",click:!0},{fixed:()=>V.player.stats.getStat(22)>0?100:Math.round(V.player.exp/ir(V.player.level)*100)},{element:"syschar",step:100,fun:()=>re.charpanelOpen},{element:"statpoints"},{step:100,fixed:()=>Math.round(V.player.exp/ir(V.player.level)*100),fun:()=>V.player.level>3},{click:!0},{fixed:()=>Math.round(V.player.inventory.gold/32*100)},{fun:()=>re.traderWindow},{element:()=>{let t=0;return Lf.forEach(e=>{let n=ln[e.type+e.tier];n.type==="book"&&n.level===3&&n.class===V.player.class&&(t=e.id)}),"trader"+t}},{element:"bag0",click:!0},{element:"sysbook",step:100,fun:()=>re.skillmenuOpen},{element:"skilllist",click:!0},{element:"tutsetskillpoint",click:!0},{element:"tutapplyskills",click:!0},{element:"skillbar",click:!0},{click:!0},{click:!0},{click:!0},{click:!0,element:"partybtn"},{click:!0},{click:!0},{click:!0},{click:!0},{click:!0},{click:!0},{element:"chat"},{element:"chatinput"},{element:"syscog",step:100,click:!0,fun:()=>re.settingsOpen},{click:!0},{step:100,fun:()=>!re.settingsOpen},{click:!0},{click:!0},{gate:()=>V.player.level>=25,click:!0}],tx=!1,h7=()=>{E1.reset(V.smoothtime),tx||(tx=!0,Gs.subscribe(t=>{let e=Pi[t];e&&(e.gate===void 0||e.gate())?$o.set(nx(t)):$o.set()}))},nx=t=>(Mt(91),{...Pi[t],msg:C.ui.tutorial.msg[t],progress:0}),E1=new kt(0,.2),g7=()=>{let t=Pi[re.tutprogress];t&&E1.done(V.smoothtime)&&(E1.reset(V.smoothtime),(t.gate===void 0||t.gate())&&(t.gate&&t.gate()&&sn(re.tutprogress,void 0,1),t.fun&&t.fun()&&sn(re.tutprogress,t.step),t.fixed&&sn(re.tutprogress,void 0,t.fixed())))},sn=(t,e,n)=>(n||e>0)&&(t===-1||re.tutprogress===t)?($o.update(i=>i?(i.progress=Math.min(100,n||i.progress+e),i.complete=i.progress>=100,i.complete&&!i.closing&&(i.closing=!0,Mt(92),setTimeout(()=>{$o.set(),setTimeout(()=>{Gs.update(s=>(ky("tutorial","completestep",s,Math.round(performance.now()/1e3)),Pi[s+1]&&Pi[s+1].element&&typeof Pi[s+1].element!="string"&&(Pi[s+1].element=Pi[s+1].element()),s+1))},100)},1e3)),i):nx(t)),!0):!1;var Jt={partyleave:t=>({name:C.ui.party.leave,fun:()=>{xt("partyleave")}}),partyinvite:t=>({name:C.ui.party.invite,fun:()=>{xt("partyinvite",t)}}),partykick:t=>({name:C.ui.party.kick,fun:()=>{xt("partykick",t)}}),partygiveassistant:t=>({name:C.ui.party.giveAssistant,fun:()=>{xt("partysetrole",t+" 1")}}),partygiveleader:t=>({name:C.ui.party.giveLeader,fun:()=>{xt("partysetrole",t+" 2")}}),partyremoveassistant:t=>({name:C.ui.party.removeAssistant,fun:()=>{xt("partysetrole",t+" 0")}}),partycreate:t=>({name:C.ui.party.create,fun:()=>{xt("partycreate")}}),whisper:t=>({name:C.ui.chat.whisper,fun:()=>{Vi.set(`/${t} `)}}),itemdrop:(...t)=>({name:C.ui.inventory.drop,fun:()=>D1(...t)}),itemsell:(...t)=>({name:C.ui.inventory.sell,fun:()=>Hf(...t)}),itemstash:t=>({name:C.ui.stash.stash,fun:()=>{xt("itemstash",t)}}),itemmove:(t,e)=>({name:C.ui.inventory.equip,fun:()=>{sn(13,100),xt("itemmove",`${t} ${e}`)}}),itemsplithalf:t=>({name:C.ui.inventory.splithalf,fun:()=>{xt("itemsplithalf",t)}}),itemsplitone:t=>({name:C.ui.inventory.splitone,fun:()=>{xt("itemsplitone",t)}}),itemuse:(t,e,n,i)=>({name:C.ui.inventory.use,fun:()=>{yp(n<i,()=>Si(Ft.clientPlayerSkill.packData({id:e,info:[t]})),"Bind Item","Using this item will bind it to you. Continue?")}}),itemcopyid:t=>({name:C.ui.inventory.copyitemid,fun:()=>{P3(t)}}),report:(t,e,n)=>({name:"Report",fun:i=>{fo.set({name:t,reason:0,messageId:e,info:n})}})},ix=(t,e)=>{let n=[{name:e.name,css:"disabled"}];e.type===0&&(e.id==V.playerId?re.partyinfo.membercount>0?n.push(Jt.partyleave()):n.push(Jt.partycreate()):(e.faction==V.player.faction&&(nn.has(e.name)?re.partyinfo.role>e.role&&(re.partyinfo.role==2&&n.push(Jt.partykick(e.name)),e.role==0?n.push(Jt.partygiveassistant(e.name)):e.role==1&&n.push(Jt.partyremoveassistant(e.name)),re.partyinfo.role>1&&n.push(Jt.partygiveleader(e.name))):n.push(Jt.partyinvite(e.name))),n.push(Jt.report(e.name)),n.push(Jt.whisper(e.name)))),bn.set({x:t.pageX,y:t.pageY,opts:n})},sx=(t,e,n,i,s,o,r,l)=>{yp(e>=re.itemProtectQuality||n>0,()=>{xt(t,`${i}`)},r,`${l} ${tn(s,o)}?`)},Hf=(t,e,n,i,s)=>{sx("itemtradersell",t,e,n,i,s,"Sell item","Really sell")},D1=(t,e,n,i,s)=>{sx("itemdrop",t,e,n,i,s,"Drop item","Really drop")};function ox(t){let e,n;return{c(){e=h("img"),p(e,"class","icon svelte-erbdzy"),lt(e.src,n="/data/ui/icons/gem.svg?v=8602459")||p(e,"src",n)},m(i,s){w(i,e,s)},d(i){i&&x(e)}}}function v7(t){let e,n,i,s,o,r,l,a,c=t[4]&&ox(t);return{c(){e=h("span"),c&&c.c(),n=h("img"),s=T(t[1]),o=We(),r=h("span"),l=T(t[0]),p(n,"class","icon svelte-erbdzy"),lt(n.src,i=Ks(t[2]))||p(n,"src",i),p(e,"class","textwhite"),p(r,"class",a="name textf"+t[3]+" svelte-erbdzy")},m(f,u){w(f,e,u),c&&c.m(e,null),d(e,n),d(e,s),d(e,o),w(f,r,u),d(r,l)},p(f,[u]){f[4]?c||(c=ox(f),c.c(),c.m(e,n)):c&&(c.d(1),c=null),u&4&&!lt(n.src,i=Ks(f[2]))&&p(n,"src",i),u&2&&G(s,f[1]),u&1&&G(l,f[0]),u&8&&a!==(a="name textf"+f[3]+" svelte-erbdzy")&&p(r,"class",a)},i:ae,o:ae,d(f){f&&(x(e),x(r)),c&&c.d()}}}function _7(t,e,n){let{name:i}=e,{level:s}=e,{pclass:o}=e,{faction:r}=e,{sub:l=!1}=e;return t.$$set=a=>{"name"in a&&n(0,i=a.name),"level"in a&&n(1,s=a.level),"pclass"in a&&n(2,o=a.pclass),"faction"in a&&n(3,r=a.faction),"sub"in a&&n(4,l=a.sub)},[i,s,o,r,l]}var V1=class extends xe{constructor(e){super(),Ce(this,e,_7,v7,Ue,{name:0,level:1,pclass:2,faction:3,sub:4})}},Bi=V1;var G1={};Qn(G1,{addMessage:()=>Gt,hydratorItem:()=>ts,init:()=>D7,onWorldDestroy:()=>L7,postTick:()=>V7,wipeChatData:()=>W1});var rx=t=>{let e=(t||0).toString().split(""),n=e.splice(-2).join(""),i=e.splice(-2).join(""),s=e.join("");return{c:n,s:i,g:s}};var ja=(t,e=!0)=>{let n=Object.entries(t);return n.forEach(i=>{i[0]=parseInt(i[0]),e&&typeof i[1]=="object"&&(i[1]=ja(i[1]))}),new Map(n)};var ii=t=>t>=1e4?(t/1e3).toFixed(1)+"k":ht(t);var ht=t=>t<1e3?t+"":ht(~~(t/1e3))+","+("00"+~~(t%1e3)).substr(-3,3),ax=(t,e)=>t.length>e?`${t.slice(0,e-2)}...`:t,lx=ja({14:.1,13:.1,9:.1,8:.1,16:.1}),b7=ja({14:"%",13:"%",16:"%",18:"%"}),Hn=(t,e)=>(lx.has(t)&&(e*=lx.get(t),e=e.toFixed(e>=.1?1:2)),e+(b7.get(t)||""));var y7=t=>t.replace(/\$c(\d)/g,(e,n)=>`<img class=texticon src='${Ks(n)}'>`),k7=t=>t.replace(/\$l(\d+)/g,(e,n)=>`<span class=textwhite>${n}</span>`),x7=t=>t.replace(/\$f(\d)(\w*)/g,(e,n,i)=>`<span class=textf${n}>${i}</span>`),w7=t=>t.replace(/\$gt/g,(e,n)=>'<img class="svgicon" src="/data/ui/icons/check.svg?v=8602459">'),M7=t=>t.replace(/\$e(\d+)/g,(e,n)=>Yf(n,!1)),F7=t=>t.replace(/\$g(\d+)/g,(e,n)=>L1(n,!1)),C7=t=>t.replace(/\$m(\d+)/g,(e,n)=>q1(n,!1)),S7=t=>t.replace(/\$sp(\d+)/g,(e,n)=>"<img class=texticon src=/data/ui/icons/gem.svg?v=8602459/>"+n),A7=t=>t.replace(/\$fm(\d+)/g,(e,n)=>`<span class=textfame><img class=svgicon src='/data/ui/currency/fame.svg?v=8602459'> ${n}</span>`),L1=(t,e=!1)=>{let{c:n,s:i,g:s}=rx(t),o="<span/>";return s!=""&&(o+=`<span class=${e?"textred":"textgold"}>${s}</span> <img class=texticon src='/data/ui/currency/gold.${On}?v=8602459'/>`),i!=""&&(o+=`<span class=${e?"textred":"textsilver"}>${i}</span> <img class=texticon src='/data/ui/currency/silver.${On}?v=8602459'/>`),n!=""&&(o+=`<span class=${e?"textred":"textcopper"}>${n}</span> <img class=texticon src='/data/ui/currency/copper.${On}?v=8602459'/>`),o+"</span>"};var q1=(t,e=!1)=>`<span class='${e?"textred":"textgold"}'><img class='svgicon' src='${Wk}'> ${ht(t)}</span>`,Yf=t=>`<span class='bold textpvp'><img class='svgicon' src='${jk(t)}'> ${ht(t)}</span>`,ul=(t,e)=>`<span class='bold textprimary'><img class='svgicon' src='${Gk(t)}'> ${e}</span>`,P7=[y7,k7,x7,F7,A7,w7,S7,C7,M7],Xf=t=>P7.reduce((e,n)=>n(e),t);var R1,z1={},Dt=t=>(R1===void 0&&(R1=getComputedStyle(document.body)),z1[t]!==void 0?z1[t]:z1[t]=R1.getPropertyValue("--"+t));var cx=()=>{Ci.font="bold 18px hordes",Ci.fillText("Hordes",0,0)},lr=(t,e,n=1,i=1,s=1,o=1,r=0,l=0,a=.5,c=.5)=>{Ci.globalAlpha=re.nameplateShowTransparency?n:1;let f=t.width*i,u=t.height*i,m=Math.round(f*s),g=Math.round(u*o);return m===0||g===0||Ci.drawImage(t,0,0,Math.round(t.width*s),Math.round(t.height*o),Math.round(e[0]-f*a+r*i),Math.round(e[1]-u*c+l*i),m,g),m},ar=(t,e,n,i,s,o=0,r=0,l=.5,a=.5)=>lr(Qf(e,n),t,i,s,1,1,o,r,l,a),fx=(t,e,n,i,s=0,o=0,r=.5,l=.5)=>lr(e,t,n,i,1,1,s,o,r,l),ml=(t,e,n=!1)=>(n?(e[0]=t[0],e[1]=t[1]):Mi(e,t,gt.projectionViewMatrix),n||e[2]<1&&e[0]>-1&&e[0]<1?(e[1]=Math.max(-1,Math.min(e[1],1)),e[0]=Math.round((e[0]*.5+.5)*Dn.width),e[1]=Math.round((e[1]*-.5+.5)*Dn.height),e[1]=Math.max(30,e[1]),e):!1),ux=(t,e,n)=>{t.font="bold "+e+"px hordes",t.shadowColor="#000",t.shadowOffsetX=1,t.shadowOffsetY=1,t.fillStyle=n},Vt={name:{fill:Dt("name"),size:17},enemy:{fill:Dt("enemy"),size:17},pvp:{fill:Dt("pvp"),size:17},nameSmall:{fill:Dt("name"),size:13},enemySmall:{fill:Dt("enemy"),size:13},pvpSmall:{fill:Dt("pvp"),size:13},chatGlobal:{fill:Dt("global"),size:13,wrap:150},chatClan:{fill:Dt("clan"),size:13,wrap:150},chatParty:{fill:Dt("party"),size:13,wrap:150},chatWhisper:{fill:Dt("pvp"),size:13,wrap:150},chatYell:{fill:Dt("yell"),size:13,wrap:150},lev0:{fill:"#919191",size:13},lev1:{fill:Dt("name"),size:13},lev2:{fill:"#EEA303",size:13},lev3:{fill:Dt("enemy"),size:13},clan:{fill:Dt("clan"),size:17},faction0:{fill:Dt("f0"),size:17},faction1:{fill:Dt("f1"),size:17},faction0small:{fill:Dt("f0"),size:13},faction1small:{fill:Dt("f1"),size:13},phys:{fill:Dt("name"),size:18},physCrit:{fill:Dt("name"),size:24},spell:{fill:"#FFE404",size:28},spellCrit:{fill:"#FFE404",size:40},heal:{fill:"#12F027",size:28},mana:{fill:Dt("mana"),size:20},exp:{fill:Dt("exp"),size:20},fame:{fill:Dt("fame"),size:20},gold:{fill:"#EEDDA3",size:16},misc:{fill:"#A6EBFA",size:16},book:{fill:"#749DEF",size:20},rune:{fill:"#DC9A4D",size:20},itemgrey:{fill:"#747474",size:16},common:{fill:"#dddddd",size:20},uncommon:{fill:Dt("green"),size:20},rare:{fill:Dt("blue"),size:20},epic:{fill:Dt("purp"),size:20},legendary:{fill:"#EE960B",size:20},mythical:{fill:"#a72929",size:20},pheal:{fill:"#12F027",size:20},pdmg:{fill:Dt("enemy"),size:20}},B1={},Qf=(t,{fill:e,size:n,wrap:i=0})=>{let s=t+e+n;if(B1[s])return B1[s];let o=document.createElement("canvas"),r=o.getContext("2d");return r.font="bold "+n+"px hordes",i>0?T7(o,r,t,0,0,i,n,e):(o.width=Math.max(1,Math.ceil(r.measureText(t).width))+5,o.height=Math.ceil(n*1.2+5),ux(r,n,e),r.fillText(t,0,o.height-6)),B1[s]=o,o},Ti=(t,e,n,i,s,o,r)=>{t||(t=document.createElement("canvas"),t.width=n,t.height=i);let l=t.getContext("2d");return l.fillStyle=e,l.beginPath(),l.moveTo(s+r,o),l.arcTo(s+n,o,s+n,o+i,r),l.arcTo(s+n,o+i,s,o+i,r),l.arcTo(s,o+i,s,o,r),l.arcTo(s,o,s+n,o,r),l.closePath(),l.fill(),t},T7=(t,e,n,i,s,o,r,l)=>{let a=n.split(" "),c=[],f=0,u="";for(let m=0;m<a.length;++m){let g=u+a[m]+" ",v=e.measureText(g);v.width>o?(c.push(u),u=a[m]+" "):(f=Math.max(f,v.width),u=g)}c.push(u),t.width=Math.ceil(f+5),t.height=Math.ceil(c.length*r+10),Ti(t,"#00000099",t.width,t.height,0,0,5),ux(e,r,l);for(let m=0;m<c.length;++m)e.fillText(c[m],i+5,(m+1)*r+3)};var mx=(t,e,n,i,s,o)=>U1(t,s,o)&&Wa(i,s,o)&&$1(n,s,o)&&N1(e,s,o),U1=(t,e,n)=>ln[e+n]===void 0?(console.log("Error: Item can EQUIP type not found: "+e+n),!1):t>=ln[e+n].level,Wa=(t,e,n)=>ln[e+n].class===void 0||t===ln[e+n].class,E7=(t,e)=>t+Pt.get(e).skillpoints,O1=t=>t.reduce(E7,0),$1=(t,e,n)=>e!=="book"||Zf(t,ln[e+n].skillid)===ln[e+n].skilllevel;var Zf=(t,e)=>t.reduce((n,i)=>n+(i===e),0);var N1=(t,e,n)=>ln[e+n].requiredSkill===void 0||t.indexOf(ln[e+n].requiredSkill)>0;var px=(t,e,n)=>ln[e+n].buyElo===void 0||t>=ln[e+n].buyElo;var dx=(t,e,n,i)=>Math.ceil(t.goldValue||(.4*(t.level**1.3+e*.4))**(1.1+e/100)/An[t.type].drop)*(n||1)*(i?8:1);var cr=class{constructor(e){this.dbid=e,this.stats=new Map,this.dirty=!0}hydrate(e){if(this.dirty=!1,this.bound=e.bound,this.type=e.type,this.tier=e.tier,this.logic=ln[this.type+this.tier],this.auction=e.auction?new Date(e.auction):void 0,this.auctionprice=e.auctionprice,this.owner=e.name,this.stash=e.stash?new Date(e.stash):void 0,this.logic===void 0)throw"Unknown item "+e.type+e.tier;if(this.upgrade=e.upgrade,this.stats.clear(),e.rolls){if(this.setRolls(e.rolls),this.quality=this.nextRoll(),this.logic.stats){this.logic.stats.forEach((i,s)=>{this.stats.set(s,{type:"base",qual:this.quality,value:Math.floor(i.min+(i.max-i.min)*(this.quality/100)**2+Gf[s]*this.upgrade)})});let n=Math.min(4,Math.round((this.quality/100)**1.5*3.6));for(let i=0;i<n;++i){let s=this.nextRoll(),o=-1;for(;o===-1||this.stats.has(o);)o=parseInt(x1(Qk,s/101)),s=(s+5)%100;let r=(this.nextRoll()+this.quality)/2;this.stats.set(o,{type:"bonus",qual:r,value:Math.ceil(Math.max((Wf[o].min+(Wf[o].max-Wf[o].min)*(r/100)**2)*this.logic.level*An[this.type].weight,Gf[o])+Gf[o]*this.upgrade)})}}this.quality=this.logic.quality||this.quality,this.stacks=void 0}else this.stacks=e.stacks,this.quality=this.logic.quality||0,this.setRolls();this.gs=0,this.logic.gs?this.gs=this.logic.gs:this.stats.forEach((n,i)=>{if(i===17)return;let s=n.value/Gf[i];this.type=="shield"&&n.type=="base"&&(s*=.5),this.type=="orb"&&n.type=="base"&&(s*=.7),this.gs+=s}),this.gs=Math.round(this.gs)}setRolls(e){this.rolls=e,this.currentRoll=0}nextRoll(){if(this.currentRoll==this.rolls.length)throw"roll maximum reached";return this.rolls[this.currentRoll++]}goldValue(e){if(!this.canBeSold())throw"Item cant have value because it cant be sold";return dx(this.logic,this.quality,this.stacks,e)}storeValue(){return this.logic.storeValue||0}medalValue(){return this.logic.medalValue||0}canEquip(e){return mx(e.level,e.skills.skillIdsActive,e.skills.skillIdsLearned,e.class,this.type,this.tier)}canEquipClass(e){return Wa(e.class,this.type,this.tier)}equipReasons(e){let n=[];return this.logic.level&&n.push(["Lv. "+this.logic.level,!0]),n}canBeDropped(){return!An[this.type].undroppable&&!this.bound}canBeTraded(){return!this.bound}canBeSold(){return!this.logic.unsellable}getStashTime(){return this.dirty?0:this.stash!==void 0?this.stash.getTime():0}getEquipSlot(){return An[this.type].slot!==void 0?An[this.type].slot[0]:void 0}};var ts=new cr,I7=0,hx=new kt(0,10),Wp=[],Gp=[],D7=()=>{Un(Ft.serverChat.header,t=>{Wp.push(t)}),Un(Ft.serverSystemMessage.header,t=>{Gp.push(t)})},j1=0,V7=(t,e)=>{Wp.forEach(n=>{let i=Ft.serverChat.decode(n);for(let s=0;s<i.items.length;++s){let o=i.items[s];o.rolls.length>0?o.stacks=null:o.rolls=void 0}if(i.from==""){let s=i.message.split(" ");C&&C.ui.messages[s[0]]&&(i.message=C.ui.messages[s[0]],s.splice(1).forEach((o,r)=>{i.message=i.message.replace("$"+(r+1),o)})),i.channel="notice"}else if(re.chatbubbles&&j1>5){let s=i.channel=="to"?e.player.name:i.from,o=e.getPlayerByName(s);if(o){let r;switch(i.channel){case"from":case"to":r=Vt.chatWhisper;break;case"clan":r=Vt.chatClan;break;case"party":r=Vt.chatParty;break;case"yell":r=Vt.chatYell;break;default:case"global":r=Vt.chatGlobal;break}let l="",a=0;for(let c=0;c<i.items.length;++c){let f=i.items[c];l+=i.message.slice(a,f.index)+tn(f.type,f.tier),a=f.index}l+=i.message.slice(a),o.speech(s+": "+l,r)}}i.clan==="GM"&&i.channel==="global"&&(i.channel="GM"),Gt(i.channel,i.message,i.channel=="system"||i.channel=="notice",i.from,i.faction,i.class,i.level,i.subscribed,i.id,i.items)}),Gp.forEach(n=>{n=Ft.serverSystemMessage.decode(n),n.messages.forEach(i=>{Gt(i.type,i.message,!0)})}),Wp.length=0,Gp.length=0,j1++},Gt=(t,e,n=!1,i,s,o,r,l,a=0,c)=>{zc.update(f=>{f.length>100&&f.shift(),n&&(e=Xf(e)),t==="from"&&(hx.done(V.time)&&Mt(97),hx.reset(V.time));let u=new Date;return f.push({channel:t,time:`${String(u.getHours()).padStart(2,"0")}.${String(u.getMinutes()).padStart(2,"0")}`,text:e,key:++I7,sender:i,sub:l,faction:s,cclass:o,level:r,interpolate:n,id:a,items:c}),f})},W1=()=>{zc.set([]),j1=0},L7=()=>{Wp.length=0,Gp.length=0};var q7=[["white","common","grey"],["green","uncommon","green-l"],["blue","rare","blue-l"],["purp","epic","purp-l"],["orange", "legendary","orange-l"],["red", "mythical","red-l"]],Ga=t=>t>=110?5:t>=99?4:t>=90?3:t>=70?2:t>=50?1:0,Ut=t=>q7[Ga(t)];function gx(t){let e,n,i,s,o;return n=new Bi({props:{name:t[0].sender,pclass:t[0].cclass,level:t[0].level,faction:t[0].faction,sub:t[0].sub}}),{c(){e=h("span"),ne(n.$$.fragment),p(e,"class","sender svelte-7c1tlw")},m(r,l){w(r,e,l),K(n,e,null),i=!0,s||(o=[Y(e,"contextmenu",t[3]),Y(e,"dblclick",t[4])],s=!0)},p(r,l){let a={};l&1&&(a.name=r[0].sender),l&1&&(a.pclass=r[0].cclass),l&1&&(a.level=r[0].level),l&1&&(a.faction=r[0].faction),l&1&&(a.sub=r[0].sub),n.$set(a)},i(r){i||(P(n.$$.fragment,r),i=!0)},o(r){I(n.$$.fragment,r),i=!1},d(r){r&&x(e),ee(n),s=!1,at(o)}}}function R7(t){let e,n,i,s=t[0].time+"",o,r,l,a=t[0].channel+"",c,f,u,m,g,v,_=t[0].sender&&gx(t);return{c(){e=h("article"),n=h("div"),i=h("span"),o=T(s),r=h("span"),l=h("span"),c=T(a),f=We(),_&&_.c(),m=h("span"),p(i,"class","time svelte-7c1tlw"),p(l,"class","capitalize channel"),p(r,"class",u="text"+t[0].channel+" content svelte-7c1tlw"),p(m,"class",g="text"+t[0].channel+" svelte-7c1tlw"),p(n,"class","linewrap svelte-7c1tlw"),p(e,"class","line svelte-7c1tlw")},m(b,y){w(b,e,y),d(e,n),d(n,i),d(i,o),d(n,r),d(r,l),d(l,c),d(r,f),_&&_.m(r,null),d(n,m),t[5](m),v=!0},p(b,[y]){(!v||y&1)&&s!==(s=b[0].time+"")&&G(o,s),(!v||y&1)&&a!==(a=b[0].channel+"")&&G(c,a),b[0].sender?_?(_.p(b,y),y&1&&P(_,1)):(_=gx(b),_.c(),P(_,1),_.m(r,null)):_&&(Ee(),I(_,1,1,()=>{_=null}),Ie()),(!v||y&1&&u!==(u="text"+b[0].channel+" content svelte-7c1tlw"))&&p(r,"class",u),(!v||y&1&&g!==(g="text"+b[0].channel+" svelte-7c1tlw"))&&p(m,"class",g)},i(b){v||(P(_),v=!0)},o(b){I(_),v=!1},d(b){b&&x(e),_&&_.d(),t[5](null)}}}function z7(t,e,n){let i;se(t,Vr,u=>n(6,i=u));let{line:s=void 0}=e,o,r=lo(),l=u=>{let m=[{name:s.sender,css:"disabled"}];V.player.name!==s.sender&&(s.faction==V.player.faction&&!nn.has(s.sender)&&m.push(Jt.partyinvite(s.sender)),s.channel!=="to"&&m.push(Jt.report(s.sender,s.id,`Message: \u201C${s.text.length>40?s.text.substring(0,37)+"...":s.text}\u201D`)),m.push(Jt.whisper(s.sender))),bn.set({x:u.pageX,y:u.pageY,opts:m}),u.preventDefault()},a=u=>{if(u.altKey)Vi.update(m=>m+`>${u.currentTarget.item.id}`);else{let m=i?i.dbid:void 0;if(Qe(Vr,i=void 0,i),m!==u.currentTarget.item.id){let g=new cr(u.currentTarget.item.id);g.hydrate(u.currentTarget.item),Qe(Vr,i=g,i)}}};Fn(()=>{if(s.interpolate){let u=document.createElement("span");u.innerHTML=s.text,o.appendChild(u)}else{let u=document.createDocumentFragment(),m=0;s.items&&s.items.forEach(g=>{let v=s.text.substring(m,g.index);v.length>0&&u.appendChild(document.createTextNode(v)),m=g.index,ts.hydrate(g);let _=document.createElement("span"),b=Ut(ts.quality);_.classList.add("chatItem","text"+b[0]),_.textContent=tn(ts.type,ts.tier);let y=_.innerHTML;ts.logic.stats&&(y+=`<span class=text${b[2]}> ${ts.quality}%</span>`),ts.upgrade&&(y+=`<span class=textprimary> +${ts.upgrade}</span>`),ts.stacks&&(y=`<span class=textsecondary>${ts.stacks}</span><span class='textgrey'>\xD7</span>${y}`),_.innerHTML="["+y+"]",_.item=g,_.addEventListener("click",a),u.appendChild(_)}),m<s.text.length&&u.appendChild(document.createTextNode(s.text.substring(m))),o.appendChild(u)}});let c=u=>{r("focuschat",s.sender)};function f(u){Bt[u?"unshift":"push"](()=>{o=u,n(1,o)})}return t.$$set=u=>{"line"in u&&n(0,s=u.line)},[s,o,r,l,c,f]}var H1=class extends xe{constructor(e){super(),Ce(this,e,z7,R7,yn,{line:0})}},vx=H1;var{Map:B7}=Ec;function _x(t,e,n){let i=t.slice();return i[28]=e[n],i}function bx(t,e,n){let i=t.slice();return i[31]=e[n],i}function yx(t,e,n){let i=t.slice();return i[34]=e[n],i}function kx(t,e){let n,i,s;return i=new vx({props:{line:e[34]}}),i.$on("focuschat",e[8]),{key:t,first:null,c(){n=he(),ne(i.$$.fragment),this.first=n},m(o,r){w(o,n,r),K(i,o,r),s=!0},p(o,r){e=o;let l={};r[0]&64&&(l.line=e[34]),i.$set(l)},i(o){s||(P(i.$$.fragment,o),s=!0)},o(o){I(i.$$.fragment,o),s=!1},d(o){o&&x(n),ee(i,o)}}}function xx(t){let e,n,i=t[31]+"",s,o,r,l;function a(...c){return t[14](t[31],...c)}return{c(){e=h("div"),n=T("/"),s=T(i),p(e,"class",o="choice textsystem text"+t[31]+" svelte-12yh3k3")},m(c,f){w(c,e,f),d(e,n),d(e,s),r||(l=Y(e,"click",a),r=!0)},p(c,f){t=c},d(c){c&&x(e),r=!1,l()}}}function wx(t){let e,n=t[28]+"",i,s,o,r;function l(...a){return t[18](t[28],...a)}return{c(){e=h("small"),i=T(n),p(e,"class",s="btn border black text"+(t[0].indexOf(t[28])<0?t[28]:"grey")+" svelte-12yh3k3")},m(a,c){w(a,e,c),d(e,i),o||(r=Y(e,"click",l),o=!0)},p(a,c){t=a,c[0]&1&&s!==(s="btn border black text"+(t[0].indexOf(t[28])<0?t[28]:"grey")+" svelte-12yh3k3")&&p(e,"class",s)},d(a){a&&x(e),o=!1,r()}}}function U7(t){let e,n,i=[],s=new B7,o,r,l,a,c,f,u,m,g,v,_,b,y,k,A,S=me(t[6]),F=L=>L[34].key;for(let L=0;L<S.length;L+=1){let z=yx(t,S,L),q=F(z);s.set(q,i[L]=kx(q,z))}let M=me(Object.keys(il)),D=[];for(let L=0;L<M.length;L+=1)D[L]=xx(bx(t,M,L));let R=me(t[11]),E=[];for(let L=0;L<R.length;L+=1)E[L]=wx(_x(t,R,L));return{c(){e=h("div"),n=h("section");for(let L=0;L<i.length;L+=1)i[L].c();o=h("div"),r=h("section"),l=h("div"),a=h("div");for(let L=0;L<D.length;L+=1)D[L].c();c=h("div"),c.textContent="/[playername]",f=h("div"),u=T(t[7]),g=h("input"),_=h("div");for(let L=0;L<E.length;L+=1)E[L].c();p(n,"id","chat"),p(n,"class","panel frame scrollbar svelte-12yh3k3"),p(c,"class","choice textwhisper"),p(a,"class","panel context commandlist textsystem svelte-12yh3k3"),qe(a,"display",t[5]?"block":"none"),p(f,"class",m="command btn black text"+(xo[t[7]]?xo[t[7]].chat?t[7]:"system":"whisper")+" svelte-12yh3k3"),p(g,"id","chatinputelement"),p(g,"maxlength","480"),p(g,"type","text"),p(g,"class","svelte-12yh3k3"),p(l,"id","chatinput"),p(l,"class","inputcontainer panel-black border black svelte-12yh3k3"),p(r,"class",v="chatsection "+(t[4]?"":"hidden")+" svelte-12yh3k3"),p(_,"class",b="channelselect "+(t[4]?"hidden":"")+" svelte-12yh3k3"),p(o,"class","lowercontainer svelte-12yh3k3"),p(e,"class","l-corner-ll container uiscaled svelte-12yh3k3")},m(L,z){w(L,e,z),d(e,n);for(let q=0;q<i.length;q+=1)i[q]&&i[q].m(n,null);t[13](n),d(e,o),d(o,r),d(r,l),d(l,a);for(let q=0;q<D.length;q+=1)D[q]&&D[q].m(a,null);d(a,c),d(l,f),d(f,u),d(l,g),Ne(g,t[1]),t[17](g),d(o,_);for(let q=0;q<E.length;q+=1)E[q]&&E[q].m(_,null);y=!0,k||(A=[Y(f,"click",t[15]),Y(g,"input",t[16])],k=!0)},p(L,z){if(z[0]&320&&(S=me(L[6]),Ee(),i=ui(i,z,F,1,L,S,s,n,Di,kx,null,yx),Ie()),z[0]&512){M=me(Object.keys(il));let q;for(q=0;q<M.length;q+=1){let j=bx(L,M,q);D[q]?D[q].p(j,z):(D[q]=xx(j),D[q].c(),D[q].m(a,c))}for(;q<D.length;q+=1)D[q].d(1);D.length=M.length}if((!y||z[0]&32)&&qe(a,"display",L[5]?"block":"none"),(!y||z[0]&128)&&G(u,L[7]),(!y||z[0]&128&&m!==(m="command btn black text"+(xo[L[7]]?xo[L[7]].chat?L[7]:"system":"whisper")+" svelte-12yh3k3"))&&p(f,"class",m),z[0]&2&&g.value!==L[1]&&Ne(g,L[1]),(!y||z[0]&16&&v!==(v="chatsection "+(L[4]?"":"hidden")+" svelte-12yh3k3"))&&p(r,"class",v),z[0]&3073){R=me(L[11]);let q;for(q=0;q<R.length;q+=1){let j=_x(L,R,q);E[q]?E[q].p(j,z):(E[q]=wx(j),E[q].c(),E[q].m(_,null))}for(;q<E.length;q+=1)E[q].d(1);E.length=R.length}(!y||z[0]&16&&b!==(b="channelselect "+(L[4]?"hidden":"")+" svelte-12yh3k3"))&&p(_,"class",b)},i(L){if(!y){for(let z=0;z<S.length;z+=1)P(i[z]);y=!0}},o(L){for(let z=0;z<i.length;z+=1)I(i[z]);y=!1},d(L){L&&x(e);for(let z=0;z<i.length;z+=1)i[z].d();t[13](null),it(D,L),t[17](null),it(E,L),k=!1,at(A)}}}function O7(t,e,n){let i,s,o,r,l;se(t,ff,U=>n(0,s=U)),se(t,zc,U=>n(12,o=U)),se(t,Ws,U=>n(7,r=U)),se(t,Vi,U=>n(1,l=U));let a,c=!0;dh(()=>{c=a&&(a.offsetHeight+a.scrollTop>a.scrollHeight-20||a.scrollTop==0)}),Vc(()=>{c!==!1&&a.scrollTo(0,a.scrollHeight)});let f,u=!1,m=[],g=0,v=!1,_="faction",b=new Map([["c","clan"],["p","party"],["f","faction"]]),y=U=>xo[U]&&xo[U].chat,k=U=>{let O=l;if(U.keyCode===13)if(U.target===f){if(U.target.value!=""){sn(41,100);let Fe=U.target.value.match(/^\/[a-zA-Z0-9]+/g);Fe&&(Qe(Ws,r=Fe[0].substring(1),r),O=""),il[r]!==void 0&&il[r].client?il[r].fun(O):xt(r,O),O="",f.blur(),n(4,u=!1)}else y(r)||xt(r,O),f.blur(),n(4,u=!1);let Z=`/${r} `,ve=m.indexOf(Z);ve>=0&&m.splice(ve,1),m.length>10&&m.splice(0,1),m.push(Z),y(r)?_=r:(Qe(Ws,r=_,r),g=m.length)}else document.activeElement==document.body&&S();else(U.keyCode===38||U.keyCode===40)&&m.length?U.target===f&&(g+=U.keyCode===38?-1:1,g=vt(g,0,m.length-1),O=m[g],U.preventDefault()):U.keyCode===27&&(f.blur(),n(4,u=!1));Qe(Vi,l=O,l)},A=U=>{f.focus()},S=U=>{U&&Qe(Ws,r=U.detail,r),n(4,u=!0),bh().then(A),sn(40,100)},F=U=>{Qe(Ws,r=U,r),n(5,v=!1),f.focus()};Fn(()=>{document.addEventListener("keydown",k)}),Tn(()=>{document.removeEventListener("keydown",k)});let M=U=>{let O=s.indexOf(U);ff.update(Z=>(O>=0?Z.splice(O,1):Z.push(U),Z))},D=["faction","party","clan","pvp","inv","yell"],R;function E(U){Bt[U?"unshift":"push"](()=>{a=U,n(2,a)})}let L=(U,O)=>F(U),z=U=>n(5,v=!v);function q(){l=this.value,Vi.set(l)}function j(U){Bt[U?"unshift":"push"](()=>{f=U,n(3,f)})}let W=(U,O)=>M(U);return t.$$.update=()=>{if(t.$$.dirty[0]&4098){let U=l,O=U.match(/^\/[a-zA-Z0-9]+ /g);if(O){let Z=O[0].substring(1,O[0].length-1);if(Z==="r"||Z==="w")for(let ve=o.length-1;ve>0;--ve){let Fe=o[ve];Fe.channel=="from"&&(Qe(Ws,r=Fe.sender,r),ve=0)}else Qe(Ws,r=b.has(Z)?b.get(Z):Z,r);Qe(Vi,l=U.substring(O[0].length),l),S()}U.length>0&&S()}t.$$.dirty[0]&4097&&n(6,i=o.filter(U=>s.indexOf(U.channel)<0))},[s,l,a,f,u,v,i,r,S,F,M,D,o,E,L,z,q,j,W]}var Y1=class extends xe{constructor(e){super(),Ce(this,e,O7,U7,Ue,{},null,[-1,-1])}},Mx=Y1;function Fx(t){let e,n;return{c(){e=h("img"),lt(e.src,n="/data/ui/icons/"+t[1]+".svg?v=8602459")||p(e,"src",n),p(e,"class","titleicon svgicon svelte-z8c6c2")},m(i,s){w(i,e,s)},p(i,s){s[0]&2&&!lt(e.src,n="/data/ui/icons/"+i[1]+".svg?v=8602459")&&p(e,"src",n)},d(i){i&&x(e)}}}function Cx(t){let e,n,i,s;return{c(){e=h("img"),lt(e.src,n="/data/ui/icons/cog.svg?v=8602459")||p(e,"src",n),p(e,"class","btn black svgicon marg-right")},m(o,r){w(o,e,r),i||(s=Y(e,"click",t[13]),i=!0)},p:ae,d(o){o&&x(e),i=!1,s()}}}function Sx(t){let e,n,i,s;return{c(){e=h("img"),lt(e.src,n="/data/ui/icons/cross.svg?v=8602459")||p(e,"src",n),p(e,"class","btn black svgicon")},m(o,r){w(o,e,r),i||(s=Y(e,"click",t[20]),i=!0)},p:ae,d(o){o&&x(e),i=!1,s()}}}function $7(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v,_=t[1]&&Fx(t),b=t[3]&&Cx(t),y=t[2]&&Sx(t),k=t[19].default,A=Yl(k,t,t[18],null);return{c(){e=h("div"),n=h("div"),i=h("div"),_&&_.c(),s=h("div"),o=h("div"),r=T(t[0]),b&&b.c(),l=he(),y&&y.c(),c=h("div"),A&&A.c(),p(s,"class","textprimary title svelte-z8c6c2"),p(i,"class","titleframe svelte-z8c6c2"),p(i,"style",a=t[7]?"":"cursor: pointer;"),p(c,"class",f="slot "+(t[4]?"scrollbar":"")+" svelte-z8c6c2"),p(n,"class","window panel-black svelte-z8c6c2"),p(e,"class","window-pos"),p(e,"style",u="z-index: "+t[5]+"; position: absolute; "+t[10]+": "+Math.round(t[8][0])+"px; "+t[11]+": "+Math.round(t[8][1])+"px;")},m(S,F){w(S,e,F),d(e,n),d(n,i),_&&_.m(i,null),d(i,s),d(s,o),d(o,r),b&&b.m(i,null),d(i,l),y&&y.m(i,null),d(n,c),A&&A.m(c,null),t[21](n),m=!0,g||(v=Y(i,"mousedown",e_(t[12])),g=!0)},p(S,F){S[1]?_?_.p(S,F):(_=Fx(S),_.c(),_.m(i,s)):_&&(_.d(1),_=null),(!m||F[0]&1)&&G(r,S[0]),S[3]?b?b.p(S,F):(b=Cx(S),b.c(),b.m(i,l)):b&&(b.d(1),b=null),S[2]?y?y.p(S,F):(y=Sx(S),y.c(),y.m(i,null)):y&&(y.d(1),y=null),(!m||F[0]&128&&a!==(a=S[7]?"":"cursor: pointer;"))&&p(i,"style",a),A&&A.p&&(!m||F[0]&262144)&&Ql(A,k,S,S[18],m?Xl(k,S[18],F,null):Zl(S[18]),null),(!m||F[0]&16&&f!==(f="slot "+(S[4]?"scrollbar":"")+" svelte-z8c6c2"))&&p(c,"class",f),(!m||F[0]&288&&u!==(u="z-index: "+S[5]+"; position: absolute; "+S[10]+": "+Math.round(S[8][0])+"px; "+S[11]+": "+Math.round(S[8][1])+"px;"))&&p(e,"style",u)},i(S){m||(P(A,S),m=!0)},o(S){I(A,S),m=!1},d(S){S&&x(e),_&&_.d(),b&&b.d(),y&&y.d(),A&&A.d(S),t[21](null),g=!1,v()}}}function N7(t,e,n){let i;se(t,df,ce=>n(26,i=ce));let{$$slots:s={},$$scope:o}=e,r=lo(),{title:l="Title"}=e,{icon:a=void 0}=e,{close:c=!0}=e,{cog:f=!0}=e,{scroll:u=!1}=e,{permanent:m=!0}=e,{settings:g=[]}=e,{origin:v="right bottom"}=e,{defaultOffset:_=[3,3]}=e,{zindex:b=9}=e,y,k,A=v==="center"?"left":v.split(" ")[0],S=v==="center"?"top":v.split(" ")[1],F=A==="right"?1:-1,M=S==="bottom"?1:-1,D=0,R=0,E=!1,L=[..._],z=[0,0],q=ce=>{ce.button!==0||E||(z=[ce.clientX,ce.clientY],document.addEventListener("mousemove",j),document.addEventListener("mouseup",W))},j=ce=>{n(8,L=[L[0]-(ce.clientX-z[0])*F,L[1]-(ce.clientY-z[1])*M]),z=[ce.clientX,ce.clientY],U()},W=()=>{document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",W)},U=()=>{let[ce,fe,ze]=[y.offsetWidth,y.offsetHeight,30];n(8,L[0]=Math.max(-ce+ze,Math.min(L[0],D-ze)),L),n(8,L[1]=S==="bottom"?Math.max(-fe+ze,Math.min(L[1],R-fe)):Math.max(0,Math.min(L[1],R-ze)),L),O()};Fn(()=>{let ce=y.parentElement.parentElement;D=ce.clientWidth,R=ce.clientHeight;let fe=i.find(ze=>ze.id===l);fe?(n(8,L=fe.offset),n(7,E=fe.locked)):Z(),k=new ResizeObserver(ze=>{let{width:Pe,height:Me}=ze[0].contentRect;v==="center"&&(n(8,L[0]+=(Pe-D)/2,L),n(8,L[1]+=(Me-R)/2,L)),D=Pe,R=Me,U()}),k.observe(y.parentElement.parentElement)}),Tn(()=>{document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",W),k.disconnect(),n(6,y=k=void 0)});let O=()=>{m&&df.update(ce=>{let fe=ce.find(ze=>ze.id===l);return fe||(fe={id:l},ce.push(fe)),fe.offset=L,fe.locked=E,ce})},Z=()=>{if(v==="center"){let[ce,fe]=[y.offsetWidth,y.offsetHeight];n(8,L=[D/2-ce/2,R/2-fe/2])}else n(8,L=[..._])},ve=ce=>{let fe=[{name:l,css:"disabled"},{name:(E?"Unlock":"Lock")+" Window",fun:()=>{n(7,E=!E),O()}},{name:"Reset Window",fun:()=>{Z(),O()}},...g];bn.set({x:ce.pageX,y:ce.pageY,right:!0,opts:fe})},Fe=()=>r("close");function _e(ce){Bt[ce?"unshift":"push"](()=>{y=ce,n(6,y)})}return t.$$set=ce=>{"title"in ce&&n(0,l=ce.title),"icon"in ce&&n(1,a=ce.icon),"close"in ce&&n(2,c=ce.close),"cog"in ce&&n(3,f=ce.cog),"scroll"in ce&&n(4,u=ce.scroll),"permanent"in ce&&n(14,m=ce.permanent),"settings"in ce&&n(15,g=ce.settings),"origin"in ce&&n(16,v=ce.origin),"defaultOffset"in ce&&n(17,_=ce.defaultOffset),"zindex"in ce&&n(5,b=ce.zindex),"$$scope"in ce&&n(18,o=ce.$$scope)},[l,a,c,f,u,b,y,E,L,r,A,S,q,ve,m,g,v,_,o,s,Fe,_e]}var X1=class extends xe{constructor(e){super(),Ce(this,e,N7,$7,Ue,{title:0,icon:1,close:2,cog:3,scroll:4,permanent:14,settings:15,origin:16,defaultOffset:17,zindex:5},null,[-1,-1])}},jt=X1;function Ax(t,e,n){let i=t.slice();return i[4]=e[n],i[6]=n,i}function Px(t){let e,n;return e=new jt({props:{zindex:5,origin:"center",title:C.ui.headers.interaction,$$slots:{default:[j7]},$$scope:{ctx:t}}}),e.$on("close",t[3]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&129&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function Tx(t){let e,n,i=Xf(t[4])+"",s,o,r;function l(...a){return t[2](t[6],...a)}return{c(){e=h("div"),n=h("span"),p(e,"class","btn border black textgreen"),p(e,"value",s=t[6])},m(a,c){w(a,e,c),d(e,n),n.innerHTML=i,o||(r=Y(e,"click",l),o=!0)},p(a,c){t=a,c&1&&i!==(i=Xf(t[4])+"")&&(n.innerHTML=i)},d(a){a&&x(e),o=!1,r()}}}function j7(t){let e,n,i=t[0].title+"",s,o,r=t[0].text+"",l,a=me(t[0].choices),c=[];for(let f=0;f<a.length;f+=1)c[f]=Tx(Ax(t,a,f));return{c(){e=h("div"),n=h("h3"),s=T(i),o=h("p"),l=T(r);for(let f=0;f<c.length;f+=1)c[f].c();p(n,"class","textprimary name svelte-k1vie9"),p(e,"class","container svelte-k1vie9")},m(f,u){w(f,e,u),d(e,n),d(n,s),d(e,o),d(o,l);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(e,null)},p(f,u){if(u&1&&i!==(i=f[0].title+"")&&G(s,i),u&1&&r!==(r=f[0].text+"")&&G(l,r),u&3){a=me(f[0].choices);let m;for(m=0;m<a.length;m+=1){let g=Ax(f,a,m);c[m]?c[m].p(g,u):(c[m]=Tx(g),c[m].c(),c[m].m(e,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=a.length}},d(f){f&&x(e),it(c,f)}}}function W7(t){let e,n,i=t[0]&&Px(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=Px(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function G7(t,e,n){let i;se(t,Bs,l=>n(0,i=l));function s(l){Si(Ft.clientPlayerInteract.packData({id:l})),Qe(Bs,i=void 0,i)}return[i,s,(l,a)=>s(l),()=>{Qe(Bs,i=void 0,i)}]}var Q1=class extends xe{constructor(e){super(),Ce(this,e,G7,W7,Ue,{})}},Ex=Q1;function H7(t){let e,n,i,s,o,r,l,a,c,f=t[7].default,u=Yl(f,t,t[6],null);return{c(){e=h("div"),n=h("div"),i=h("span"),s=T(t[0]),o=h("span"),r=T(t[1]),u&&u.c(),p(i,"class","left svelte-i7i7g5"),p(o,"class","right svelte-i7i7g5"),p(n,"class",l="progressBar "+t[3]+" svelte-i7i7g5"),qe(n,"width",t[2]+"%"),qe(n,"font-size",t[4]),p(e,"class",a="bar "+(t[5]?"dark":"")+" svelte-i7i7g5"),qe(e,"z-index",t[3]=="hp"?"1":"0")},m(m,g){w(m,e,g),d(e,n),d(n,i),d(i,s),d(n,o),d(o,r),u&&u.m(e,null),c=!0},p(m,[g]){(!c||g&1)&&G(s,m[0]),(!c||g&2)&&G(r,m[1]),(!c||g&8&&l!==(l="progressBar "+m[3]+" svelte-i7i7g5"))&&p(n,"class",l),(!c||g&4)&&qe(n,"width",m[2]+"%"),(!c||g&16)&&qe(n,"font-size",m[4]),u&&u.p&&(!c||g&64)&&Ql(u,f,m,m[6],c?Xl(f,m[6],g,null):Zl(m[6]),null),(!c||g&32&&a!==(a="bar "+(m[5]?"dark":"")+" svelte-i7i7g5"))&&p(e,"class",a),(!c||g&8)&&qe(e,"z-index",m[3]=="hp"?"1":"0")},i(m){c||(P(u,m),c=!0)},o(m){I(u,m),c=!1},d(m){m&&x(e),u&&u.d(m)}}}function Y7(t,e,n){let{$$slots:i={},$$scope:s}=e,{left:o=""}=e,{right:r=""}=e,{fract:l}=e,{barcol:a}=e,{size:c}=e,{darken:f}=e;return t.$$set=u=>{"left"in u&&n(0,o=u.left),"right"in u&&n(1,r=u.right),"fract"in u&&n(2,l=u.fract),"barcol"in u&&n(3,a=u.barcol),"size"in u&&n(4,c=u.size),"darken"in u&&n(5,f=u.darken),"$$scope"in u&&n(6,s=u.$$scope)},[o,r,l,a,c,f,s,i]}var Z1=class extends xe{constructor(e){super(),Ce(this,e,Y7,H7,yn,{left:0,right:1,fract:2,barcol:3,size:4,darken:5})}},vi=Z1;var J1={};Qn(J1,{init:()=>X7,updateCd:()=>Kf});var Jf=new Map,Ix=!1,X7=()=>{fetch("/data/ui/circlecooldowns/circlecooldowns.txt?v=8602459").then(async t=>{let e=(await t.text()).split(`
`);for(let n=0;n<3;++n){let i=[];for(let s=0;s<101;++s){let o=new Image;o.src=e.shift(),i.push([o])}Jf.set([40,31,23][n],i)}Ix=!0})},Kf=(t,e,n)=>{Ix&&e&&t!==e.step&&(e.cdimg!==void 0&&(Jf.get(n)[e.step].push(e.removeChild(e.cdimg)),e.cdimg=void 0),(e.step=t)>0&&(Jf.get(n)[e.step].length===1?e.cdimg=Jf.get(n)[e.step][0].cloneNode():e.cdimg=Jf.get(n)[e.step].pop(),e.appendChild(e.cdimg)))};function Dx(t){let e,n;return{c(){e=h("div"),n=T(t[0]),p(e,"class","stacks slottext svelte-1nn7wcb")},m(i,s){w(i,e,s),d(e,n)},p(i,s){s&1&&G(n,i[0])},d(i){i&&x(e)}}}function Vx(t){let e,n=(t[5]>99?Math.round(t[5]/60)+"'":Math.ceil(t[5]))+"",i;return{c(){e=h("div"),i=T(n),p(e,"class","time absCentered slottext svelte-1nn7wcb")},m(s,o){w(s,e,o),d(e,i)},p(s,o){o&32&&n!==(n=(s[5]>99?Math.round(s[5]/60)+"'":Math.ceil(s[5]))+"")&&G(i,n)},d(s){s&&x(e)}}}function Q7(t){let e,n,i,s,o,r,l,a,c,f,u=t[0]>1&&Dx(t),m=t[3]>30&&re.cdTextBuffs&&t[5]>0&&Vx(t);return{c(){e=h("div"),n=h("div"),i=h("img"),o=h("div"),u&&u.c(),r=he(),m&&m.c(),p(i,"class","icon svelte-1nn7wcb"),lt(i.src,s=t[1])||p(i,"src",s),qe(i,"max-width",t[3]+"px"),p(o,"class","overlay svelte-1nn7wcb"),p(n,"class",l="slot border "+(t[2]===1?"negative":"positive")+" svelte-1nn7wcb"),p(e,"class",a="container "+(t[5]<re.buffCdFlashingDuration&&t[5]%re.buffCdFlashingInterval*2>re.buffCdFlashingInterval?"soon":"")+" svelte-1nn7wcb")},m(g,v){w(g,e,v),d(e,n),d(n,i),d(n,o),t[10](o),u&&u.m(n,null),d(n,r),m&&m.m(n,null),c||(f=Y(e,"contextmenu",t[6]),c=!0)},p(g,[v]){v&2&&!lt(i.src,s=g[1])&&p(i,"src",s),v&8&&qe(i,"max-width",g[3]+"px"),g[0]>1?u?u.p(g,v):(u=Dx(g),u.c(),u.m(n,r)):u&&(u.d(1),u=null),g[3]>30&&re.cdTextBuffs&&g[5]>0?m?m.p(g,v):(m=Vx(g),m.c(),m.m(n,null)):m&&(m.d(1),m=null),v&4&&l!==(l="slot border "+(g[2]===1?"negative":"positive")+" svelte-1nn7wcb")&&p(n,"class",l),v&32&&a!==(a="container "+(g[5]<re.buffCdFlashingDuration&&g[5]%re.buffCdFlashingInterval*2>re.buffCdFlashingInterval?"soon":"")+" svelte-1nn7wcb")&&p(e,"class",a)},i:ae,o:ae,d(g){g&&x(e),t[10](null),u&&u.d(),m&&m.d(),c=!1,f()}}}function Z7(t,e,n){let{stacks:i}=e,{duration:s}=e,{time:o}=e,{icon:r}=e,{type:l}=e,{size:a}=e,{cancel:c}=e,f=1,u=0,m,g=()=>{c>=0&&xt("cancelbuff",c)};function v(_){Bt[_?"unshift":"push"](()=>{m=_,n(4,m)})}return t.$$set=_=>{"stacks"in _&&n(0,i=_.stacks),"duration"in _&&n(7,s=_.duration),"time"in _&&n(8,o=_.time),"icon"in _&&n(1,r=_.icon),"type"in _&&n(2,l=_.type),"size"in _&&n(3,a=_.size),"cancel"in _&&n(9,c=_.cancel)},t.$$.update=()=>{t.$$.dirty&408&&(n(5,u=s-o),Kf(Math.round(o/s*100),m,a))},[i,r,l,a,m,u,g,s,o,c,v]}var K1=class extends xe{constructor(e){super(),Ce(this,e,Z7,Q7,yn,{stacks:0,duration:7,time:8,icon:1,type:2,size:3,cancel:9})}},Lx=K1;var yg={};Qn(yg,{envSkillId:()=>mr,findEnvironmentTarget:()=>Nw,hoverinteractive:()=>ud,hovertarget:()=>vn,init:()=>oI,onWorldDestroy:()=>mI,parseHudTargets:()=>bg,playertarget:()=>Rn,preTick:()=>cI,ray:()=>fr,setEnvCast:()=>ou,setHoverTarget:()=>su,setTarget:()=>ur,targetSwitchConciliate:()=>_g,targetSwitchNetTimer:()=>vl,tick:()=>fI});var Rx=(t,e,n)=>{let i=N.getUniformBlockIndex(t,e),s=N.getActiveUniformBlockParameter(t,i,N.UNIFORM_BLOCK_DATA_SIZE),o={name:e,size:s,uniforms:[],index:n},r=N.getActiveUniformBlockParameter(t,i,N.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES),l=N.getActiveUniforms(t,r,N.UNIFORM_OFFSET);for(let a=0;a<r.length;++a){let c=r[a],f=N.getActiveUniform(t,c),u=l[a],m=f.size,g=0,v=0,_=!1;f.type===N.FLOAT_VEC3?(g=3,v=m>1?4:3):f.type===N.FLOAT_VEC2?(g=2,v=m>1?4:2):f.type===N.FLOAT_VEC4?(g=4,v=4):f.type===N.FLOAT_MAT4?(g=16,v=16):f.type===N.FLOAT?(g=1,v=1):f.type===N.INT&&(g=1,v=1,_=!0),m*=g;let b={name:f.name.replace("[0]",""),size:m,offset:u,divisor:v,elements:g,isInt:_};o.uniforms.push(b)}return o.uniforms.sort((a,c)=>a.offset-c.offset),o},Ha=t=>{let e={layout:t,buffer:N.createBuffer(),data:{},dataArray:[]};N.bindBuffer(N.UNIFORM_BUFFER,e.buffer),N.bufferData(N.UNIFORM_BUFFER,t.size,N.DYNAMIC_DRAW),N.bindBuffer(N.UNIFORM_BUFFER,null);for(let n=0;n<t.uniforms.length;++n){let i=t.uniforms[n],s=[];for(let o=0;o<i.size;++o)s.push(0);e.data[i.name]=s,e.dataArray.push(s)}return e},pl=t=>{N.bindBufferBase(N.UNIFORM_BUFFER,t.layout.index,t.buffer)},So=(t,e,n,i=0)=>{i===0&&(i=e.length);for(let s=0;s<i;++s)t[s+n]=e[s]},zx=new ArrayBuffer(1e3),J7=new Int32Array(zx),qx=new Float32Array(zx),Hp=t=>{for(let e=0;e<t.layout.uniforms.length;++e){let n=t.layout.uniforms[e];t.data[n.name]!==t.dataArray[e]&&(t.dataArray[e]=t.data[n.name])}},si=t=>{let e=0;for(let n=0;n<t.layout.uniforms.length;++n){let i=t.layout.uniforms[n],s=t.dataArray[n],o=i.isInt?J7:qx,r=0;for(;r<s.length;)for(let l=0;l<i.divisor;++l)l<i.elements&&(o[e]=s[r],r++),e++}N.bindBuffer(N.UNIFORM_BUFFER,t.buffer),N.bufferSubData(N.UNIFORM_BUFFER,0,qx,0,t.layout.size/4),N.bindBuffer(N.UNIFORM_BUFFER,null)};var Ya=[],Xa,ys,Ao,hl,gl,Bx=t=>{let e=tt.width,n=tt.height;for(let i=0;i<2;++i)Ya.push(Mo(t,t,0,!0,N.COMPARE_REF_TO_TEXTURE));Xa=Mo(t,t,0,!0,N.COMPARE_REF_TO_TEXTURE),ys=Mo(e,n,1,!0),Ao=Mo(e,n,1,!0),hl=Mo(Math.ceil(e/4),Math.ceil(n/4)),gl=Mo(Math.ceil(e/4),Math.ceil(n/4))},Ux=(t,e)=>{Ef(ys,t,e),Ef(Ao,t,e),Ef(hl,Math.ceil(t/4),Math.ceil(e/4)),Ef(gl,Math.ceil(t/4),Math.ceil(e/4))};var rd={};Qn(rd,{bloom:()=>ig,bloomMerge:()=>sg,drop:()=>Yp,foliagePlant:()=>Xp,foliageStatic:()=>Qp,fxaa:()=>og,multimeshEffect:()=>Zp,multimeshFlat:()=>Jp,multimeshSimple:()=>Kp,multimeshTextured:()=>eu,multimeshTexturedVcol:()=>ed,multimeshTree:()=>eg,particles:()=>td,particles_additive:()=>tg,particles_normal:()=>ng,ribbon:()=>tu,ribbonTextured:()=>lg,shadowInstanced:()=>nu,shadowInstancedAlpha:()=>ag,simple:()=>nd,simpleTextured:()=>QE,simpleVcol:()=>ZE,sky:()=>cg,skyStarTex:()=>fg,sun:()=>ug,terrain:()=>id,terrainEditorAreas:()=>JE,terrainEditorGrid:()=>KE,terrainEditorHeights:()=>eI,terrainEditorTiles:()=>tI,terrainFog:()=>sd,tint:()=>rg,water:()=>od,waterEditorGrid:()=>nI});var $x=`#version 300 es
precision highp float;precision highp int;out vec4 fragColor;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D diffuse;in vec2 vUv;in float vShine;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 a=texture(diffuse,vUv);if(a.a<0.5)discard;a.rgb=mix(a.rgb*worldlight[1],a.rgb*1.1,smoothstep(-0.7,0.7,sin(time*6.0+vShine)));float b=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);a.rgb=mix(fog[0],a.rgb,b);fragColor=a;}`;var Nx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in mat4 worldMatrix;in vec4 uvshift;in float shine;out float vShine;out vec2 vUv;void main(){vShine=shine;vWorldPos=worldMatrix*vec4(position,1.0);vUv=uvshift.zw-uv*uvshift.xy;vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);}`;var jx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform sampler2D foliageDiffuse;in vec3 vLight;in vec3 vLightAmb;in vec3 vLightDir;in vec2 vUv;out vec4 fragColor;void main(){vec4 b=texture(foliageDiffuse,vUv);float c=0.1;b.a=b.a*smoothstep(1.0,0.0,(vCameraDistance-110.0)/20.0);if(b.a<c){discard;};float d=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float e=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 f=shadowPVMatrix[1]*(vWorldPos);vec3 g=(f.xyz/f.w)*0.5+0.5;d=texture(shadowMaps[1],g);}else{vec4 f=shadowPVMatrix[0]*(vWorldPos);vec3 g=(f.xyz/f.w)*0.5+0.5;d=texture(shadowMaps[0],g);}d=d;d=max(d,e);}b.rgb=b.rgb*(vLight+vLightAmb+vLightDir*d);float h=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,h);fragColor=b;}`;var Wx=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec4 instPos;in vec3 instNorm;in vec3 position;in vec2 uv;out vec3 vLightAmb;out vec3 vLightDir;out vec2 vUv;void main(){vUv=uv;vec3 b=vec3(0.0);for(int c=0;c<lightCount;++c){vec3 d=lightPos[c]-instPos.xyz;float e=lightCols[c].w-dot(d,d);if(e>0.0){e/=(lightCols[c].w);e=e*e;b+=0.3*lightCols[c].rgb*e;;}};vLight=b;vLightAmb=worldlight[1];vLightDir=worldlight[0]*max(0.0,dot(instNorm.xyz,worldlight[2]));vec3 f=position;float e=sin(time+instPos.x+f.x)*0.1*f.y;f.xz+=e;mat3 g;g[1]=instNorm.xyz;g[2]=normalize(cross(vec3(sin(instPos.x*100.0),0.0,cos(instPos.z*100.0)),g[1]));g[0]=normalize(cross(g[1],g[2]));vec3 h=g*f;vWorldPos=vec4(h*instPos.w+instPos.xyz,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var Gx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform sampler2D foliageDiffuse;in vec3 vLightAmb;in vec3 vLightDir;in vec3 vLight;in vec2 vUv;out vec4 fragColor;void main(){vec4 b=texture(foliageDiffuse,vUv);b.a=b.a*smoothstep(1.0,0.0,(vCameraDistance-110.0)/20.0);if(b.a<0.5){discard;};float c=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float d=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 e=shadowPVMatrix[1]*(vWorldPos);vec3 f=(e.xyz/e.w)*0.5+0.5;c=texture(shadowMaps[1],f);}else{vec4 e=shadowPVMatrix[0]*(vWorldPos);vec3 f=(e.xyz/e.w)*0.5+0.5;c=texture(shadowMaps[0],f);}c=c;c=max(c,d);}b.rgb=b.rgb*(vLight+vLightAmb+vLightDir*c);float g=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,g);fragColor=b;}`;var Hx=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec4 instPos;in vec3 instNorm;in vec3 position;in vec2 uv;out vec2 vUv;out vec3 vLightAmb;out vec3 vLightDir;void main(){vUv=uv;vec3 b=vec3(0.0);for(int c=0;c<lightCount;++c){vec3 d=lightPos[c]-instPos.xyz;float e=lightCols[c].w-dot(d,d);if(e>0.0){e/=(lightCols[c].w);e=e*e;b+=0.3*lightCols[c].rgb*e;;}}vLight=b;vLightAmb=worldlight[1];vLightDir+=worldlight[0]*max(0.0,dot(instNorm.xyz,worldlight[2]));vec3 f=position;mat3 g;g[1]=instNorm.xyz;g[2]=normalize(cross(vec3(sin(instPos.x*100.0),0.0,cos(instPos.z*100.0)),g[1]));g[0]=normalize(cross(g[1],g[2]));vec3 h=g*f;vWorldPos=vec4(h*instPos.w+instPos.xyz,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var Yx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vCol;in vec2 vYcutoff;in vec4 vUvshift;out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec2 a=vec2((vUv.x+vUvshift.x)*vUvshift.z,(vUv.y+vUvshift.y)*vUvshift.w);vec4 b=vec4(1.0,1.0,1.0,texture(diffuse,a).r)*vCol;b.a*=min(1.0,max(0.0,vUv.y/vYcutoff[0]));b.a*=min(1.0,max(0.0,(vYcutoff[1]-vUv.y)/(1.0-vYcutoff[1])));if(b.a<0.01){discard;}float c=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,c);fragColor=b;fragColor.rgb*=fragColor.a;}`;var Xx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in mat4 worldMatrix;in vec4 uvshift;in vec2 ycutoff;in vec4 color;out vec3 vNormal;out vec2 vUv;out vec4 vCol;out vec2 vYcutoff;out vec4 vUvshift;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vUvshift=uvshift;vCol=color;vYcutoff=ycutoff;vWorldPos=worldMatrix*vec4(position,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var Qx=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 vLight;in vec4 vColor;in vec3 vNormal;in vec4 vInteriorlight;in float vAlpha;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}float o=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float p=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 q=shadowPVMatrix[1]*(vWorldPos);vec3 r=(q.xyz/q.w)*0.5+0.5;o=texture(shadowMaps[1],r);}else{vec4 q=shadowPVMatrix[0]*(vWorldPos);vec3 r=(q.xyz/q.w)*0.5+0.5;o=texture(shadowMaps[0],r);}o=o;o=max(o,p);}vec3 s=worldlight[1];vec3 t=worldlight[0];s=mix(s,vInteriorlight.rgb*0.5,vInteriorlight.a);t=mix(t,vInteriorlight.rgb,vInteriorlight.a);float u=max(0.0,min(1.0,vColor[3]*0.2));vec4 v=vec4(b(s,t,vColor.rgb,vNormal,o,vLight,u),vAlpha);float w=max(0.0,min(1.0,-vColor[3]));v.rgb=mix(v.rgb,vColor.rgb,w);float x=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);v.rgb=mix(fog[0],v.rgb,x);fragColor=v;}`;var Zx=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 position;in vec3 normal;in vec4 color;in vec4 interiorlight;in float alpha;in mat4 worldMatrix;out vec4 vColor;out vec3 vNormal;out vec4 vInteriorlight;out float vAlpha;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vWorldPos=worldMatrix*vec4(position,1.0);vColor=color;vAlpha=alpha;vInteriorlight=interiorlight;vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var Jx=`#version 300 es
precision highp float;precision highp int;in vec4 vColor;out vec4 fragColor;void main(){fragColor=vColor;fragColor.a=1.0;}`;var Kx=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 position;in vec4 color;in mat4 worldMatrix;out vec4 vColor;void main(){vColor=color;gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);;}`;var ew=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Circle{vec4 circlePos;vec4 circleInfo;};in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vInteriorlight;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 o=texture(diffuse,vUv);if(o.a<0.5)discard;float p=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float q=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 r=shadowPVMatrix[1]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[1],s);}else{vec4 r=shadowPVMatrix[0]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[0],s);}p=p;p=max(p,q);}vec3 t=worldlight[1];vec3 u=worldlight[0];t=mix(t,vInteriorlight.rgb*0.5,vInteriorlight.a);u=mix(u,vInteriorlight.rgb,vInteriorlight.a);o.rgb=b(t,u,o.rgb,vNormal,p,vLight,0.0);o.rgb/=o.a;float v=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,v);float w=distance(vWorldPos.xz,circlePos.xz);float x=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(w<circlePos.w+0.1&&x>0.0){o.rgb=mix(o.rgb,circleInfo.rgb,x*circleInfo.a*((w<circlePos.w?w/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-w))/0.1)));}fragColor=o;}`;var tw=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in vec4 interiorlight;in mat4 worldMatrix;out vec3 vNormal;out vec2 vUv;out vec4 vInteriorlight;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vWorldPos=worldMatrix*vec4(position,1.0);vInteriorlight=interiorlight;vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var nw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Circle{vec4 circlePos;vec4 circleInfo;};in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vCol;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 o=texture(diffuse,vUv);if(o.a<0.5)discard;float p=(float(gl_FrontFacing)*2.0-1.0);float q=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float r=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 s=shadowPVMatrix[1]*(vWorldPos);vec3 t=(s.xyz/s.w)*0.5+0.5;q=texture(shadowMaps[1],t);}else{vec4 s=shadowPVMatrix[0]*(vWorldPos);vec3 t=(s.xyz/s.w)*0.5+0.5;q=texture(shadowMaps[0],t);}q=q;q=max(q,r);}vec3 u=mix(worldlight[1],vCol.rgb,vCol.a);vec3 v=worldlight[0]*(1.0-vCol.a);o.rgb=b(u,v,o.rgb,vNormal,q,vLight,0.0);float w=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,w);float x=distance(vWorldPos.xz,circlePos.xz);float y=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(x<circlePos.w+0.1&&y>0.0){o.rgb=mix(o.rgb,circleInfo.rgb,y*circleInfo.a*((x<circlePos.w?x/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-x))/0.1)));}fragColor=o;}`;var iw=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in vec4 color;in mat4 worldMatrix;out vec3 vNormal;out vec2 vUv;out vec4 vCol;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vCol=color;vWorldPos=worldMatrix*vec4(position,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var sw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){vec4 o=texture(diffuse,vUv);if(o.a<0.7)discard;if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}float p=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float q=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 r=shadowPVMatrix[1]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[1],s);}else{vec4 r=shadowPVMatrix[0]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[0],s);}p=p;p=max(p,q);}o.rgb=b(worldlight[1],worldlight[0],o.rgb,vNormal,p,vLight,0.0);o.rgb/=o.a;float t=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,t);fragColor=o;}`;var ow=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec3 position;in vec4 info;in vec2 progress;in vec4 scaleRota;in vec4 colStart;in vec4 colEnd;out vec4 vCol;out float vRotationCos;out float vRotationSin;out vec2 vOffset;void main(){float a=min(info[3]-1.0,floor(mix(info[2],info[3],mod(info[0]*progress[0],1.0))));vOffset=vec2(fract(a*0.125),-floor(a/8.0)*0.125);vCol=mix(colStart,colEnd,progress[1]);float b=mix(scaleRota[2],scaleRota[3],progress[0]);vRotationCos=cos(b);vRotationSin=sin(b);float c=mix(scaleRota[0],scaleRota[1],progress[1])*(abs(vRotationSin)+abs(vRotationCos));vec4 d=viewMatrix*vec4(position,1.0);gl_PointSize=c*resolution[1]*projectionMatrix[1][1]/length(d.xyz);gl_Position=projectionMatrix*d;}`;var rw=`#version 300 es
precision highp float;precision highp int;uniform sampler2D particleDiffuse;in vec4 vCol;in vec2 vOffset;in float vRotationCos;in float vRotationSin;out vec4 fragColor;const float a=1.0/(1024.0/8.0);void main(){float b=0.5;float c=abs(vRotationSin)+abs(vRotationCos);vec2 d=vec2(gl_PointCoord.x-b,gl_PointCoord.y-b)*c;vec2 e=d*vRotationCos;vec2 f=d*vRotationSin;d=vec2(e.x+f.y+b,e.y-f.x+b);if(d.x<a||d.x>1.0-a||d.y>1.0-a||d.y<a){discard;}d.x*=0.125;d.y=1.0-d.y*0.125;vec4 g=vec4(1.0,1.0,1.0,texture(particleDiffuse,d+vOffset).r);g*=vCol;if(g.a<0.01){discard;}fragColor=g;fragColor.rgb*=fragColor.a;fragColor.a*=0.33;}`;var lw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D particleDiffuse;in vec4 vCol;in vec2 vOffset;in float vRotationCos;in float vRotationSin;out vec4 fragColor;const float a=1.0/(1024.0/8.0);void main(){float b=0.5;float c=abs(vRotationSin)+abs(vRotationCos);vec2 d=vec2(gl_PointCoord.x-b,gl_PointCoord.y-b)*c;vec2 e=d*vRotationCos;vec2 f=d*vRotationSin;d=vec2(e.x+f.y+b,e.y-f.x+b);if(d.x<a||d.x>1.0-a||d.y>1.0-a||d.y<a){discard;}d.x*=0.125;d.y=1.0-d.y*0.125;vec3 g=texture(particleDiffuse,d+vOffset).rgb;if((g.r+g.g+g.b)<0.1){discard;}fragColor=vec4(g.rgb,1.0);}`;var aw=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;uniform vec2 offset[4];uniform vec4 amount;in vec2 vUv;out vec4 fragColor;void main(){vec3 a=texture(inputA,vUv+offset[0]).rgb*amount[0];a+=texture(inputA,vUv+offset[1]).rgb*amount[1];a+=texture(inputA,vUv+offset[2]).rgb*amount[2];a+=texture(inputA,vUv+offset[3]).rgb*amount[3];fragColor=vec4(a,1.0);}`;var cw=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;uniform sampler2D inputB;uniform float amount;in vec2 vUv;out vec4 fragColor;void main(){vec4 a=texture(inputA,vUv);vec3 b=texture(inputB,vUv).rgb;b=b*b;fragColor.w=a.w;fragColor.xyz=b*amount+a.xyz;}`;var fw=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;in vec2 vUv;out vec4 fragColor;
#define a  4.0
#define b (1.0/a)
#define c (1.0/128.0)
#define d (1.0/8.0)
vec3 e(vec4 f,sampler2D g,vec2 h){vec3 i=textureLod(g,f.zw,0.0).xyz;vec3 j=textureLod(g,f.zw+vec2(1,0)*h.xy,0.0).xyz;vec3 k=textureLod(g,f.zw+vec2(0,1)*h.xy,0.0).xyz;vec3 l=textureLod(g,f.zw+vec2(1,1)*h.xy,0.0).xyz;vec3 m=textureLod(g,f.xy,0.0).xyz;vec3 n=vec3(0.299,0.587,0.114);float o=dot(i,n);float p=dot(j,n);float q=dot(k,n);float r=dot(l,n);float s=dot(m,n);float t=min(s,min(min(o,p),min(q,r)));float u=max(s,max(max(o,p),max(q,r)));vec2 v;v.x=-((o+p)-(q+r));v.y=((o+q)-(p+r));float w=max((o+p+q+r)*(0.25*b),c);float x=1.0/(min(abs(v.x),abs(v.y))+w);v=min(vec2(a,a),max(vec2(-a,-a),v*x))*h.xy;vec3 y=(1.0/2.0)*(textureLod(g,f.xy+v*(1.0/3.0-0.5),0.0).xyz+textureLod(g,f.xy+v*(2.0/3.0-0.5),0.0).xyz);vec3 az=y*(1.0/2.0)+(1.0/4.0)*(textureLod(g,f.xy+v*(0.0/3.0-0.5),0.0).xyz+textureLod(g,f.xy+v*(3.0/3.0-0.5),0.0).xyz);float aa=dot(az,n);if((aa<t)||(aa>u))return y;return az;}void main(){vec2 h=1.0/resolution;vec4 f=vec4(vUv,vUv-(h*(0.5+d)));vec3 ab=e(f,inputA,1.0/resolution);fragColor=vec4(ab,1.);}`;var uw=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D inputA;uniform vec4 tint;uniform float warp;in vec2 vUv;out vec4 fragColor;void main(){float a=0.01;float b=5.0;vec2 c;c.x=sin(vUv.y*10.0+time)*a;c.y=cos(vUv.x*10.0+time)*a;vec4 d=texture(inputA,vUv);vec4 e=texture(inputA,vUv+c);vec4 f=mix(d,e,warp);f.rgb=mix(f.rgb,tint.rgb*0.2+0.8*tint.rgb*length(f.rgb),tint.a);fragColor=f;}`;var mw=`#version 300 es
precision highp float;precision highp int;uniform vec4 colStart;uniform vec4 colEnd;uniform vec2 offset;in vec2 vUv;out vec4 fragColor;void main(){fragColor=mix(colStart,colEnd,vUv.x);if(fragColor.a<0.01){discard;}fragColor.rgb*=fragColor.a;fragColor.a*=0.5;}`;var pw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform vec2 offset;in vec3 position;in vec2 uv;out vec2 vUv;void main(){vUv=vec2(uv.x-min(uv.x/offset.y,1.0)*offset.x,uv.y);gl_Position=projectionViewMatrix*vec4(position,1.0);}`;var dw=`#version 300 es
precision highp float;precision highp int;uniform vec4 colStart;uniform vec4 colEnd;uniform vec2 offset;uniform sampler2D diffuse;in vec2 vUv;out vec4 fragColor;void main(){fragColor=texture(diffuse,vUv);fragColor*=mix(colStart,colEnd,vUv.x);if(fragColor.a<0.01){discard;}}`;var hw=`#version 300 es
precision highp float;precision highp int;void main(){}`;var gw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in mat4 worldMatrix;in vec3 position;in vec2 uv;out vec2 vUv;void main(){vUv=uv;gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);}`;var vw=`#version 300 es
precision highp float;precision highp int;in vec2 vUv;uniform sampler2D diffuse;void main(){if(texture(diffuse,vUv).a<0.7)discard;}`;var _w=`#version 300 es
precision highp float;precision highp int;uniform vec4 color;out vec4 fragColor;void main(){fragColor=color;}`;var bw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 position;in vec2 uv;in vec3 normal;out vec2 vUv;out vec3 vNormal;out vec3 vPos;void main(){vUv=uv;vNormal=normal;vPos=position;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var yw=`#version 300 es
precision highp float;precision highp int;uniform sampler2D diffuse;in vec2 vUv;out vec4 fragColor;void main(){vec4 a=texture(diffuse,vUv);vec3 b=normalize(vec3(1.0,1.0,0.3));fragColor=a;if(fragColor.a<0.2)discard;}`;var kw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec2 uv;in vec3 position;in vec3 normal;out vec2 vUv;out vec3 vNormal;void main(){vUv=uv;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var xw=`#version 300 es
precision highp float;precision highp int;in vec4 vColor;out vec4 fragColor;void main(){fragColor=vColor;}`;var ww=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 position;in vec4 color;out vec4 vColor;void main(){vColor=color;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var Mw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Sky{vec3 skycolors[5];vec3 suncolor;};uniform sampler2D skyDiffuse;uniform sampler2D cloudDiffuse;in vec2 vUv;in vec3 vPos;out vec4 fragColor;void main(){gl_FragDepth=0.999999;vec3 a=vec3(0.0);float b=vPos.y/0.5;if(b>0.4){a=mix(skycolors[1],skycolors[0],smoothstep(0.4,1.0,b));}else if(b>0.25){a=mix(skycolors[2],skycolors[1],smoothstep(0.25,0.4,b));}else if(b>0.06){a=mix(skycolors[3],skycolors[2],smoothstep(0.06,0.25,b));}else{a=mix(fog[0],skycolors[3],smoothstep(0.0,0.06,b));}float c=1.0-sin(daycycle*6.28)+0.02;float d=smoothstep(0.1,0.5,b)*smoothstep(0.9,0.6,b);a+=texture(skyDiffuse,vUv*vec2(4.0,1.0)).rgb*c*d;float e=texture(cloudDiffuse,vec2(vUv.x+time/80.0,vUv.y*0.6+time/120.0)).r*texture(cloudDiffuse,vec2(vUv.x*2.0+time/300.0,vUv.y*0.6)).r;e=e*smoothstep(0.0,0.1,b)*smoothstep(0.9,0.6,b);e=smoothstep(0.25,0.7,e);a=mix(a,skycolors[4],e);fragColor=vec4(a,1.0);}`;var Fw=`#version 300 es
precision highp float;precision highp int;in vec2 vUv;uniform float seed;float a(in vec2 uv,float scale){uv*=scale;vec2 b=floor(uv),f=fract(uv),p;float c=3.,d;p=.5+.35*sin(11.*fract(sin((b+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);c=min(d,c);return smoothstep(0.,c,sin(f.x+f.y)*0.003);}vec2 d(vec2 e){e=vec2(dot(e,vec2(127.1,311.7)),dot(e,vec2(269.5,183.3)));return-1.0+2.0*fract(sin(e)*43758.5453123);}float f(in vec2 e){const float g=0.366025404;const float h=0.211324865;vec2 i=floor(e+(e.x+e.y)*g);vec2 j=e-i+(i.x+i.y)*h;vec2 l=(j.x>j.y)?vec2(1.0,0.0):vec2(0.0,1.0);vec2 m=j-l+h;vec2 n=j-1.0+2.0*h;vec3 q=max(0.5-vec3(dot(j,j),dot(m,m),dot(n,n)),0.0);vec3 r=q*q*q*vec3(dot(j,d(i+0.0)),dot(m,d(i+l)),dot(n,d(i+1.0)));float t=dot(r,vec3(70.0));return smoothstep(-1.0,1.0,t);}out vec4 fragColor;void main(){vec2 u=vec2(vUv.x+seed,vUv.y);float r=a(vUv,10.0);r+=a(vUv,20.0)*0.5;r+=a(vUv,30.0)*0.2;r*=f(vUv*20.0);fragColor.rgb+=r*4.0;}`;var Cw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Sky{vec3 skycolors[5];vec3 suncolor;};in vec2 vUv;in vec3 vPos;out vec4 fragColor;void main(){gl_FragDepth=0.999998;float a=length(vec2(0.5,0.5)-vUv);float b=smoothstep(0.3,0.2,a)*2.0;b+=smoothstep(0.5,0.1,a);b*=smoothstep(0.08,0.15,(vPos.y+0.2)*0.2+abs(sin(daycycle*6.282)));fragColor.rgba=vec4(suncolor,b);}`;var Sw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;vec3 f(vec3 g,vec3 h,vec3 i,vec3 j,float k,vec3 l,float m){float n=clamp(dot(j,worldlight[2]),0.0,k);vec3 o=g*mix(0.7,1.1,0.5+(0.5*n));vec3 p=normalize(worldlight[2]+vViewDir);vec3 q=h*pow(max(0.0,dot(p,j)),20.0)*m*max(k*0.7+0.2,0.2)*20.0;vec3 r=o+h*n+l;return r*i+q;}void s(vec4 t,float u,vec4 v){float w=t.x+t.y+t.z;e+=v[3]*smoothstep(v[1],v[2],w)*u;t.a=u;t.rgb*=u;d+=t;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 x=texture(atlas,vUvChannel);x[3]=max(0.0,min(1.0,1.0-(x.r+x.g+x.b)));if(x[0]==1.0&&x[1]==1.0&&x[2]==1.0)discard;s(texture(diffuse[0],vUvTexture[0]),x[0],terrainInfo[0]);s(texture(diffuse[1],vUvTexture[1]),x[1],terrainInfo[1]);s(texture(diffuse[2],vUvTexture[2]),x[2],terrainInfo[2]);s(texture(diffuse[3],vUvTexture[3]),x[3],terrainInfo[3]);d.rgb/=d.a;e/=d.a;d.a=1.0;float y=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float az=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 aa=shadowPVMatrix[1]*(vWorldPos);vec3 ab=(aa.xyz/aa.w)*0.5+0.5;y=texture(shadowMaps[1],ab);}else{vec4 aa=shadowPVMatrix[0]*(vWorldPos);vec3 ab=(aa.xyz/aa.w)*0.5+0.5;y=texture(shadowMaps[0],ab);}y=y;y=max(y,az);}d.rgb=f(worldlight[1],worldlight[0],d.rgb,vNormal,y,vLight,e);float ac=distance(vWorldPos.xz,circlePos.xz);float ad=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(ac<circlePos.w+0.1&&ad>0.0){d.rgb=mix(d.rgb,circleInfo.rgb,ad*circleInfo.a*((ac<circlePos.w?ac/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-ac))/0.1)));}float ae=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,ae);fragColor=d;}`;var Aw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float a=256.0;const float b=4.0;in vec3 position;in vec3 normal;out vec3 vNormal;out vec3 vUvChannel;out vec2 vUvTexture[4];out vec3 vViewDir;void main(){vNormal=normal;vWorldPos=modelMatrix*vec4(position,1.0);vUvChannel=vec3(position[0],position[2],0.0)/32.0;int c=quadrant%2;int d=int(quadrant%4);if(c==1)vUvChannel.x-=1.0;if(d>1)vUvChannel.y-=1.0;vUvChannel.z=float(quadrant);vec2 e=vec2(-vWorldPos[0],vWorldPos[2])/4.0;vUvTexture[0]=e*terrainInfo[0][0];vUvTexture[1]=e*terrainInfo[1][0];vUvTexture[2]=e*terrainInfo[2][0];vUvTexture[3]=e*terrainInfo[3][0];for(int f=0;f<lightCount;++f){vec3 g=lightPos[f]-vWorldPos.xyz;float h=lightCols[f].w-dot(g,g);if(h>0.0){h/=(lightCols[f].w);h=h*h;vLight+=0.2*lightCols[f].rgb*h;}}vViewDir=-normalize(vWorldPos.xyz-cameraPosition);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var Pw=`#version 300 es
precision highp float;precision highp int;in vec4 vWorldPos;out vec4 fragColor;uniform vec4 colors[576];uniform int divider;void main(){float a=64.0/float(divider);int b=int(floor(mod(vWorldPos.x,64.0)/a)+floor(mod(vWorldPos.z,64.0)/a)*float(divider));fragColor.rgba=colors[b];}`;var Tw=`#version 300 es
precision highp float;precision highp int;in vec3 vPos;in vec3 vNormal;out vec4 fragColor;void main(){float a=0.0;if(vNormal.y<0.93){a=1.0;}fragColor=vec4(0.0,0.0,a,0.4+a*0.6);if(abs(vPos.x-0.0)<0.001||abs(vPos.x-64.0)<0.001||abs(vPos.z-0.0)<0.001||abs(vPos.z-64.0)<0.001)fragColor=vec4(1.0,1.0,0.0,1.0);if((abs(vPos.x-32.0)<0.001&&mod(vPos.z,1.0)<0.5)||(abs(vPos.z-32.0)<0.001&&mod(vPos.x,1.0)<0.5))fragColor=vec4(1.0,1.0,0.0,1.0);}`;var Ew=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 normal;in vec3 position;out vec3 vPos;out vec3 vNormal;void main(){vNormal=normal;vPos=position;gl_Position=projectionViewMatrix*modelMatrix*vec4(position[0],position[1]+0.05,position[2],1.0);}`;var Iw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;void f(vec4 g,float h,vec4 i){float j=g.x+g.y+g.z;e+=i[3]*smoothstep(i[1],i[2],j)*h;g.a=h;g.rgb*=h;d+=g;}out vec4 fragColor;void main(){vec4 k=texture(atlas,vUvChannel);k[3]=max(0.0,min(1.0,1.0-(k.r+k.g+k.b)));if(k[0]==1.0&&k[1]==1.0&&k[2]==1.0)discard;f(texture(diffuse[0],vUvTexture[0]),k[0],terrainInfo[0]);f(texture(diffuse[1],vUvTexture[1]),k[1],terrainInfo[1]);f(texture(diffuse[2],vUvTexture[2]),k[2],terrainInfo[2]);f(texture(diffuse[3],vUvTexture[3]),k[3],terrainInfo[3]);d.rgb/=d.a;e/=d.a;d.a=1.0;if(mod(vWorldPos.y,2.0)<0.2){d.rgb=mix(d.rgb,vec3(0.8),0.5);}else{d.rgb=mix(d.rgb,vec3(0.2),0.5);}vec3 l=worldlight[2];l.y*=0.5;l=normalize(l);d.rgb*=max(0.3,min(1.0,dot(l,vNormal)*0.5+0.5));float m=distance(vWorldPos.xz,circlePos.xz);if(m<circlePos.w+0.1){d.rgb=mix(d.rgb,circleInfo.rgb,circleInfo.a*(max(0.,(0.3-abs(circlePos.w-m))/0.3)));}float n=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,n);fragColor=d;}`;var Dw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;void f(vec4 g,float h,vec4 i){float j=g.x+g.y+g.z;e+=i[3]*smoothstep(i[1],i[2],j)*h;g.a=h;g.rgb*=h;d+=g;}out vec4 fragColor;void main(){vec4 k=texture(atlas,vUvChannel);k[3]=max(0.0,min(1.0,1.0-(k.r+k.g+k.b)));if(k[0]==1.0&&k[1]==1.0&&k[2]==1.0)discard;d.rgb=texture(diffuse[0],vUvTexture[0]).rgb;float l=64.0/12.0;float m=l/2.0;bool n=mod(vWorldPos.z,l)>m;if(mod(vWorldPos.x,l)<m){if(n){d.rgb=vec3(0.45);}else{d.rgb=vec3(0.55);}}else{if(n){d.rgb=vec3(0.55);}else{d.rgb=vec3(0.45);}}vec3 o=worldlight[2];o.y*=0.5;o=normalize(o);d.rgb*=max(0.3,min(1.0,dot(o,vNormal)*0.5+0.5));float p=distance(vWorldPos.xz,circlePos.xz);if(p<circlePos.w+0.1){d.rgb=mix(d.rgb,circleInfo.rgb,circleInfo.a*(max(0.,(0.3-abs(circlePos.w-p))/0.3)));}float q=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,q);fragColor=d;}`;var Vw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;out vec4 fragColor;void main(){fragColor.rgb=fog[0];}`;var Lw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};in vec3 position;void main(){vec4 a=modelMatrix*vec4(position,1.0);gl_Position=projectionViewMatrix*a;}`;var qw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};uniform sampler2D waterLines;uniform sampler2D waterNoise;uniform sampler2D bufferPongColor;uniform sampler2D bufferPongDepth;in vec2 vUv;out vec4 fragColor;void main(){float a=length(cameraPosition-vWorldPos.xyz);float b=(texture(waterNoise,vUv.yx/4.0+time*0.1).r-0.5);float c=gl_FragCoord.z;c=c*2.0-1.0;c=projectionMatrix[3][2]/(c+projectionMatrix[2][2]);if(a>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec2 d=gl_FragCoord.xy/resolution;float e=texture(bufferPongDepth,d.xy).r;e=e*2.0-1.0;e=projectionMatrix[3][2]/(e+projectionMatrix[2][2]);float f=e-c;vec2 g=vec2(b*0.05,0.0);float h=f;float i=1.0-clamp(h/0.1,0.0,1.0);float j=1.0-clamp(h/0.6,0.0,1.0);float k=1.0-clamp(h/2.0,0.0,1.0);float l=1.0-clamp(h/10.0,0.0,1.0);float m=1.0-clamp(h/100.0+0.5,0.0,1.0);float n=texture(waterLines,vUv.yx+b*0.15).r;vec3 o=mix(watercolors[2],watercolors[1],l);vec3 p=texture(bufferPongColor,d.xy+g).rgb;vec3 q=(worldlight[0]+worldlight[1]);vec3 r=mix(o,p*o,m)+n*watercolors[0]*(0.05+k*0.3);r=mix(r,watercolors[0],j)*q;vec4 s=vec4(r,1.0-i);float t=min(1.0,max(0.0,(n*(b+0.3)*0.5)));s.rgb+=t*worldlight[0];float u=clamp((fog[1][1]-a)/(fog[1][1]-fog[1][0]),0.0,1.0);s.rgb=mix(fog[0],s.rgb,u);fragColor=s;}`;var Rw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Water{vec3 verts[4];};in vec3 position;in vec3 color;in vec3 colorFoam;in vec3 colorShallow;out vec2 vUv;void main(){vWorldPos.xyz=verts[gl_VertexID];vWorldPos.w=1.0;vUv=vWorldPos.xz/2.0;gl_Position=projectionViewMatrix*vWorldPos;}`;var zw=`#version 300 es
precision highp float;precision highp int;in vec4 vWorldPos;out vec4 fragColor;void main(){fragColor.rgba=vec4(1.0,mod(vWorldPos.y+0.001,1.0),0.0,0.5);}`;var Yp={frag:$x,vert:Nx},Xp={frag:jx,vert:Wx},Qp={frag:Gx,vert:Hx},Zp={frag:Yx,vert:Xx},Jp={frag:Qx,vert:Zx},Kp={frag:Jx,vert:Kx},eu={frag:ew,vert:tw},ed={frag:nw,vert:iw},eg={frag:sw},td={vert:ow},tg={frag:rw},ng={frag:lw},ig={frag:aw},sg={frag:cw},og={frag:fw},rg={frag:uw},tu={frag:mw,vert:pw},lg={frag:dw},nu={frag:hw,vert:gw},ag={frag:vw},nd={frag:_w,vert:bw},QE={frag:yw,vert:kw},ZE={frag:xw,vert:ww},cg={frag:Mw},fg={frag:Fw},ug={frag:Cw},id={frag:Sw,vert:Aw},JE={frag:Pw},KE={frag:Tw,vert:Ew},eI={frag:Iw},tI={frag:Dw},sd={frag:Vw,vert:Lw},od={frag:qw,vert:Rw},nI={frag:zw};var mt=[],mg=[],mn={},Yt={},iu={},Uw=()=>{mn={shadowMaps:{value:[Xa.depthTexture,Ya[1].depthTexture]}};for(let e in rd){let n=rd[e];n.vert&&(n.vert=n.vert.replace("#SHADOWS",re.shadows?1:0)),n.frag&&(n.frag=n.frag.replace("#SHADOWS",re.shadows?1:0))}let t={mesh:["position","uv","normal","color","interiorlight","alpha","worldMatrix"],effect:["position","uv","normal","color","uvshift","ycutoff","worldMatrix"],drop:["position","shine","uv","uvshift","worldMatrix"],particle:["position","info","progress","scaleRota","colStart","colEnd"],ribbon:["position","uv"],foliage:["position","uv","instPos","instNorm"],post:["position","uv"]};mt[13]=fn({vertex:Xp.vert,fragment:Xp.frag,cullFace:null,instanced:[{name:"instPos",size:4},{name:"instNorm",size:3}],globalUniforms:mn,transparent:!0,attributeLocations:t.foliage}),mt[14]=fn({vertex:Qp.vert,fragment:Qp.frag,cullFace:null,instanced:[{name:"instPos",size:4},{name:"instNorm",size:3}],globalUniforms:mn,transparent:!0,attributeLocations:t.foliage}),mt[3]=fn({vertex:Jp.vert,fragment:Jp.frag,instanced:[{name:"color",size:4},{name:"alpha",size:1},{name:"interiorlight",size:4}],globalUniforms:mn,attributeLocations:t.mesh,transparent:!0}),mt[4]=fn({vertex:eu.vert,fragment:eu.frag,instanced:[{name:"interiorlight",size:4}],globalUniforms:mn,attributeLocations:t.mesh}),mt[5]=fn({vertex:ed.vert,fragment:ed.frag,globalUniforms:mn,attributeLocations:t.mesh}),mt[15]=fn({vertex:Zp.vert,fragment:Zp.frag,globalUniforms:mn,transparent:!0,depthWrite:!1,instanced:[{name:"color",size:4},{name:"uvshift",size:4},{name:"ycutoff",size:2}],attributeLocations:t.effect}),mt[6]=fn({vertex:eu.vert,fragment:eg.frag,globalUniforms:mn,instanced:[{name:"interiorlight",size:4}],attributeLocations:t.mesh}),mt[7]=fn({vertex:Kp.vert,fragment:Kp.frag,instanced:[{name:"color",size:4}],globalUniforms:mn,attributeLocations:t.mesh}),mt[10]=fn({vertex:Yp.vert,fragment:Yp.frag,instanced:[{name:"uvshift",size:4},{name:"shine",size:1}],globalUniforms:mn,attributeLocations:t.drop}),mt[8]=fn({vertex:id.vert,fragment:id.frag,globalUniforms:mn,attributeLocations:t.mesh}),mt[9]=fn({vertex:sd.vert,fragment:sd.frag,globalUniforms:mn,attributeLocations:t.mesh}),mt[12]=fn({vertex:nd.vert,fragment:ug.frag,transparent:!0,globalUniforms:mn,attributeLocations:t.mesh}),mt[20]=fn({vertex:od.vert,fragment:od.frag,transparent:!0,cullFace:!1,globalUniforms:mn,attributeLocations:t.mesh}),mt[11]=fn({vertex:nd.vert,fragment:cg.frag,cullFace:null,depthTest:!0,globalUniforms:mn,attributeLocations:t.mesh}),mt[1]=fn({cullFace:null,vertex:nu.vert,fragment:ag.frag,globalUniforms:mn,attributeLocations:t.mesh}),mt[2]=fn({vertex:nu.vert,fragment:nu.frag,globalUniforms:mn,attributeLocations:t.mesh}),mt[16]=fn({vertex:td.vert,fragment:tg.frag,transparent:!0,depthWrite:!1,globalUniforms:mn,attributeLocations:t.particle}),mt[17]=fn({vertex:td.vert,fragment:ng.frag,transparent:!1,globalUniforms:mn,attributeLocations:t.particle}),mt[18]=fn({vertex:tu.vert,fragment:tu.frag,transparent:!0,cullFace:null,depthWrite:!1,globalUniforms:mn,attributeLocations:t.ribbon}),mt[19]=fn({vertex:tu.vert,fragment:lg.frag,transparent:!0,cullFace:null,depthWrite:!1,globalUniforms:mn,attributeLocations:t.ribbon}),mt[32]=fn({vertex:ga,fragment:og.frag,depthWrite:!1,depthTest:!1,globalUniforms:mn,uniforms:{inputA:{value:null}},attributeLocations:t.post}),mt[30]=fn({vertex:ga,fragment:ig.frag,depthWrite:!1,depthTest:!1,uniforms:{inputA:{value:null},offset:{value:[0,0,0,0,0,0,0,0]},amount:{value:[0,0,0,0]}},globalUniforms:mn,attributeLocations:t.post}),mt[31]=fn({vertex:ga,fragment:sg.frag,depthWrite:!1,depthTest:!1,uniforms:{inputA:{value:null},inputB:{value:null},amount:{value:1}},globalUniforms:mn,attributeLocations:t.post}),mt[33]=fn({vertex:ga,fragment:rg.frag,depthWrite:!1,depthTest:!1,globalUniforms:mn,uniforms:{inputA:{value:null},tint:{value:[0,0,0,0]},warp:{value:.5}},attributeLocations:t.post}),mt[34]=fn({vertex:ga,fragment:fg.frag,uniforms:{seed:{value:Date.now()%1e3}},attributeLocations:["position","uv"]}),iI(mt,mn),Tf(mt[18],N.ONE,N.ONE_MINUS_SRC_ALPHA),Tf(mt[16],N.ONE,N.ONE_MINUS_SRC_ALPHA),Tf(mt[15],N.ONE,N.ONE_MINUS_SRC_ALPHA),mg.push(3,4,6,7,10,15,5)},iI=(t,e)=>{let n=t[4].program,i=["Environment","Camera","Pointlights","Shadows","Circle","Screen","Sky","MeshTerrain","Water"],s=[n,n,n,n,n,t[32].program,t[11].program,t[8].program,t[20].program],o=[!0,!0,!0,!0,!0,!0,!0,!1,!1],r=[];for(let l=0;l<i.length;++l){let a=i[l],c=Rx(s[l],a,l),f=a.toLowerCase();if(iu[f]=c,r.push(c),o[l]){let u=Ha(c);pl(u),Yt[f]=u}}for(let l=0;l<t.length;++l){let a=t[l];a&&(U3(a,e),O3(a,r))}},Bw,ld=(t,e)=>{if(t!==Bw||e){let n=Yt.camera.data;Bw=t,So(n.cameraPosition,t.worldPosition,0),So(n.viewMatrix,t.viewMatrix,0),So(n.projectionMatrix,t.projectionMatrix,0),So(n.projectionViewMatrix,t.projectionViewMatrix,0),si(Yt.camera)}},Ow=(t,e)=>{di(Yt.screen.data.resolution,t,e),si(Yt.screen)};var Tt=(t,e)=>{let n=t>>16&255,i=t>>8&255,s=t&255,o=[n/255,i/255,s/255];return e!==void 0&&o.push(e),o};var qn={black:Tt(0,0),white:Tt(16777215,0),deadgrey:Tt(3355443,0),teal:Tt(3384995,0),magicblue:Tt(3362252,0),paleskin:Tt(14267315,0),darkskin:Tt(8411481,0),slimegreen:Tt(2542694,0),mushgreen:Tt(2077529,0),linen:Tt(13408614,0),woodbrown:Tt(4859433,0),woodbrown2:Tt(10250315,0),tealsteel:Tt(3358797,.5),darksteel:Tt(3355443,.5),greysteel:Tt(5066061,.5),blacksteel:Tt(988178,.5),leather:Tt(4337198,0),emerald:Tt(22866,-.1),gold:Tt(16751616,.9),darkgold:Tt(16747008,.9),paper:Tt(15129011,0),richpurple:Tt(7484623,0),fireorange:Tt(14715686,-.7),archergreen:Tt(10471258,0),warbrown:Tt(15172191,0),bronze:Tt(9258571,.5),silver:Tt(11583679,.6),shamanblue:Tt(3687924,0),mageblue:Tt(6607340,0),bone:Tt(14535066,.2),bone2:Tt(11836267,.2),ice:Tt(14610164,-.2),vanguard:Tt(2848511,0),bloodlust:Tt(14289947,0),pink:Tt(16711935,0),warden:Tt(14755623,0),evilred:Tt(13239043,0),ruby:Tt(15733030,1),moss:Tt(2925637,.2),rock:Tt(5006687,.4),death:Tt(3750201,.8),diamond:Tt(3076559,.9)},pg=[qn.woodbrown,qn.bronze,qn.greysteel,qn.silver,qn.gold],$w=[qn.diamond,qn.ruby],dg=[qn.leather,qn.greysteel,qn.silver,qn.gold,qn.diamond];var fr=[0,0,0],ad={enemy:[1,0,0],friendly:[0,1,0],dead:[.6,.6,.6]},ur=t=>{if(V&&V.player){let e=Ft.clientPlayerChangeTarget.packData({target:t});if(t!==Rn)if(t>0){let n=V.entity(t);n!==void 0&&(n.type===3?n.canBePickedUpBy(V.player)&&Mt(95):(Mt(93),n.faction===2&&sn(4,100)))}else t===0&&Mt(94);Ja=Rn,vl.reset(V.time),V.player.setTarget(t),Si(e)}Rn=t},Rn=0,vn=0,ud=!1,vl=new kt(0,1),Ja=0,_g=t=>{Ja!==t&&(Ja=t,vl.done(V.time)?(V.player.setTarget(t),Rn=t):vl.reset(V.time,vt(vl.passed(V.time)+.5,.5,2)))},gg=0,oI=()=>{nt.lmb.onPress(t=>{gg=V.time}),nt.lmb.onRelease(t=>{mr>0?uI():vn>0&&Of<20&&V.time-gg<.3&&ur(vn)}),nt.nextTarget.onPress(t=>{Za=t.shiftKey?2:1}),nt.nextParty.onPress(t=>{Za=2}),nt.untarget.onPress(t=>{ur(0)})},su=(t,e=!0)=>{vn=t,ud=e&&vn>0,um.set(ud?"pointer":"auto"),hm.set(vn)},rI=(t,e,n,i)=>{let s=[0,0,0];for(let o=0,r=i.length;o<r;++o){let l=i[o],[a,c,f]=l.hudPos;if(a>0&&a<e&&c>0&&c<n&&f<1){st(s,l.pos),s[1]+=l.size*.3;let u=ei(s,Bp(gt.worldPosition,fr,s));u<t&&u<(l.size+.7)**2&&l.stats.alive&&(t=u,vn=l.id)}}return t},lI=(t,e,n,i)=>{let s=!1;for(let o=0,r=i.length;o<r;++o){let l=i[o];if(l.hudPos[2]<1){let a=ei(l.pos,Bp(gt.worldPosition,fr,l.pos));a<t&&(t=a,vn=l.id,s=!0)}}return s},aI=()=>{mo(gt,fr,Op),Xt(fr,fr,gt.worldPosition),Jn(fr,fr);let t=Dn.width,e=Dn.height,n=vn,i=20,s=!1;vn=0;for(let o=0;o<=12;++o)o!==3&&o!==11&&(i=rI(i,t,e,V.entities.type[o]));s=vn!==0,lI(Math.min(i,.7),t,e,V.entities.type[3])&&(s=V.entity(vn).canBePickedUpBy(V.player)),(n!=vn||s!==ud)&&su(vn,s)},Nw=t=>{let e=[0,0,0];ma(Pn,gt.transform.worldMatrix),mo(gt,e,Op),Xt(e,e,Pn),Jn(e,e);let n=[0,0];dy(n,Pn,e,V.player.pos,fd);let i=999;if(t)if(i=n[1]-Math.max(0,n[0]),i<5||n[0]===-1&&n[0]===-1){let o=Bp(Pn,e,V.player.pos),r=o[0]-V.player.pos[0],l=o[2]-V.player.pos[2],a=1/Math.sqrt(r*r+l*l);st(Pn,V.player.pos),Pn[0]+=r*a*fd,Pn[1]+=10,Pn[2]+=l*a*fd,X(e,0,-1,0),i=20}else n[0]>0&&on(Pn,Pn,e,n[0]);hn(e,e,i);let s=V.raycastEnvironmentClosest(Pn[0],Pn[1],Pn[2],e[0],e[1],e[2]);return on(Pn,Pn,e,s),s===1&&(Pn[1]=V.getHeight(Pn[0],Pn[2])),Pn},cI=t=>{if(vl.done(V.time)&&Rn!==Ja&&V.player.setTarget(Ja),!nt.shift.down){if($p){vn>0&&(Of>=20||V.time-gg>.3)&&su(0,!1);return}aI()}},ns,vg=0,Qa=0,hg=[1,1,1,.3],fI=t=>{let e=Rn,n=vn>0?V.getEntityById(vn):void 0;n!==void 0?n!==ns&&(ns!==void 0&&ns.visual!==void 0&&ns.type!==3&&ns.visual.removeColor(hg),n.visual!==void 0&&n.type!==3&&n.visual.addColor(hg),ns=n):ns!==void 0&&ns.visual!==void 0&&(ns.type!==3&&ns.visual.removeColor(hg),ns=void 0);let i=Yt.circle.data;if(mr>0){let s=Nw(!0);ti(i.circleInfo,...ad.friendly,1),ti(i.circlePos,s[0],s[1],s[2],jw)}else if(e!==vg?(vg=e,Qa=1):Qa=Math.max(Qa*(1-t*10),0),e>0){let s=V.getEntityById(e);if(s!==void 0){ti(i.circlePos,s.pos[0],s.pos[1]-s.radius,s.pos[2],s.size+Qa);let o=s.stats&&s.stats.alive?V.player.hostility(s)>0?ad.enemy:ad.friendly:ad.dead;ti(i.circleInfo,...o,1-Qa)}}else ti(i.circlePos,0,0,0,0);si(Yt.circle)},cd=[],Za=0,bg=t=>{if(V.player){if(Za===1){let e=0,n=0;t=t.filter(s=>s.visual!==void 0&&s.stats!==void 0&&s.stats.alive&&s!==V.player&&V.player.hostility(s)>0&&V.player.canCombatInteract(s)&&Math.abs(cl(V.player.rot,V.player.rotationToV3(s.pos)))<.7);let i=Rn===0;for(let s=t.length-1;s>=0;--s){let o=t[s];i&&(e=o.id),Rn===o.id&&(i=!0),n||(n=o.id),e!==0&&(s=0)}e===0&&n!==0&&(e=n),ur(e),Za=0}else if(Za===2){let e=V.entities.type[0].filter(s=>!re.nextFriendlyTargetAllowNonParty&&!nn.has(s.name)?!1:s.stats&&s.stats.alive&&s.faction===V.player.faction&&qr(s.pos,V.player.pos)<30).sort((s,o)=>{let r=nn.has(s.name),l=nn.has(o.name);return r&&!l?-1:!r&&l?1:0}),n=e.length;if(e=e.filter(s=>cd.indexOf(s.id)<0),e.length===0)ur(V.playerId);else{let s=e[0];ur(s.id)}cd.push(Rn);let i=Math.min(10,re.nextFriendlyTargetCycle||10,n);for(;i>0&&cd.length>=i;)cd.shift();Za=0}}},mr=0,fd=0,jw=0,Pn=[0,0,0],ou=(t,e,n)=>{mr=t,fd=e,jw=n},uI=()=>{mr!==0&&(Si(Ft.clientPlayerEnvSkill.packData({id:mr,info:[],pos:Pn})),ou(0,0,0))},mI=()=>{Ja=0,vl.reset(0),ns=void 0,vg=0,Qa=0};function Ww(t,e,n){let i=t.slice();return i[26]=e[n],i}function Gw(t){let e,n,i,s,o,r,l,a,c,f,u,m=[],g=new Map,v,_,b,y,k,A,S=t[2]=="default"&&Hw(t);a=new vi({props:{size:"1.3em",fract:t[8],barcol:t[13],left:t[10],right:t[6],darken:!1,$$slots:{default:[pI]},$$scope:{ctx:t}}});let F=(t[2]=="default"||t[18])&&Xw(t);function M(q,j){return q[5].role>=1?gI:hI}let D=M(t,-1),R=D(t),E=t[2]=="default"&&t[5].combat&&t[5].alive&&Qw(t),L=me(t[19]),z=q=>q[26].id;for(let q=0;q<L.length;q+=1){let j=Ww(t,L,q),W=z(j);g.set(W,m[q]=Zw(W,j))}return{c(){e=h("div"),n=h("div"),S&&S.c(),i=h("img"),r=h("div"),l=h("div"),ne(a.$$.fragment),F&&F.c(),R.c(),f=he(),E&&E.c(),u=h("div");for(let q=0;q<m.length;q+=1)m[q].c();p(i,"class",s="pclass icon border black bgc"+t[5].class+" svelte-g292qg"),lt(i.src,o=(t[5].rarity!==!1?"/data/ui/mobpower/"+t[5].rarity:"/data/ui/classes/"+t[5].class)+"."+On+"?v=8602459")||p(i,"src",o),p(n,"class","iconcontainer svelte-g292qg"),p(l,"class",c="panel-black barsInner "+(t[5].id&&t[5].range?"targetable":"")+" svelte-g292qg"),p(u,"class",v="buffarray "+t[2]+" svelte-g292qg"),p(r,"class",_="bars "+(t[17]&&t[5].id==t[17].id&&t[2]=="party"?"target":"")+" svelte-g292qg"),p(e,"id",t[4]),p(e,"class",b="grid "+(t[3]?"right":"left")+" svelte-g292qg"),qe(e,"font-size",t[15]+"%"),qe(e,"opacity",t[5].range?"":.6)},m(q,j){w(q,e,j),d(e,n),S&&S.m(n,null),d(n,i),d(e,r),d(r,l),K(a,l,null),F&&F.m(l,null),R.m(r,null),d(r,f),E&&E.m(r,null),d(r,u);for(let W=0;W<m.length;W+=1)m[W]&&m[W].m(u,null);y=!0,k||(A=[Y(l,"click",t[20]),Y(l,"contextmenu",t[25])],k=!0)},p(q,j){q[2]=="default"?S||(S=Hw(q),S.c(),S.m(n,i)):S&&(S.d(1),S=null),(!y||j&32&&s!==(s="pclass icon border black bgc"+q[5].class+" svelte-g292qg"))&&p(i,"class",s),(!y||j&32&&!lt(i.src,o=(q[5].rarity!==!1?"/data/ui/mobpower/"+q[5].rarity:"/data/ui/classes/"+q[5].class)+"."+On+"?v=8602459"))&&p(i,"src",o);let W={};j&256&&(W.fract=q[8]),j&8192&&(W.barcol=q[13]),j&1024&&(W.left=q[10]),j&64&&(W.right=q[6]),j&536895748&&(W.$$scope={dirty:j,ctx:q}),a.$set(W),q[2]=="default"||q[18]?F?(F.p(q,j),j&262148&&P(F,1)):(F=Xw(q),F.c(),P(F,1),F.m(l,null)):F&&(Ee(),I(F,1,1,()=>{F=null}),Ie()),(!y||j&32&&c!==(c="panel-black barsInner "+(q[5].id&&q[5].range?"targetable":"")+" svelte-g292qg"))&&p(l,"class",c),D===(D=M(q,j))&&R?R.p(q,j):(R.d(1),R=D(q),R&&(R.c(),R.m(r,f))),q[2]=="default"&&q[5].combat&&q[5].alive?E||(E=Qw(q),E.c(),E.m(r,u)):E&&(E.d(1),E=null),j&524292&&(L=me(q[19]),Ee(),m=ui(m,j,z,1,q,L,g,u,Di,Zw,null,Ww),Ie()),(!y||j&4&&v!==(v="buffarray "+q[2]+" svelte-g292qg"))&&p(u,"class",v),(!y||j&131108&&_!==(_="bars "+(q[17]&&q[5].id==q[17].id&&q[2]=="party"?"target":"")+" svelte-g292qg"))&&p(r,"class",_),(!y||j&16)&&p(e,"id",q[4]),(!y||j&8&&b!==(b="grid "+(q[3]?"right":"left")+" svelte-g292qg"))&&p(e,"class",b),(!y||j&32768)&&qe(e,"font-size",q[15]+"%"),(!y||j&32)&&qe(e,"opacity",q[5].range?"":.6)},i(q){if(!y){P(a.$$.fragment,q),P(F);for(let j=0;j<L.length;j+=1)P(m[j]);y=!0}},o(q){I(a.$$.fragment,q),I(F);for(let j=0;j<m.length;j+=1)I(m[j]);y=!1},d(q){q&&x(e),S&&S.d(),ee(a),F&&F.d(),R.d(),E&&E.d();for(let j=0;j<m.length;j+=1)m[j].d();k=!1,at(A)}}}function Hw(t){let e;return{c(){e=h("div"),p(e,"class","deco svelte-g292qg")},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function Yw(t){let e,n,i;return{c(){e=h("div"),p(e,"class",n="progressBar "+t[13]+" hpdelta svelte-g292qg"),p(e,"style",i=(t[14]?"transition:none;":"")+"width:"+t[8]+"%;")},m(s,o){w(s,e,o)},p(s,o){o&8192&&n!==(n="progressBar "+s[13]+" hpdelta svelte-g292qg")&&p(e,"class",n),o&16640&&i!==(i=(s[14]?"transition:none;":"")+"width:"+s[8]+"%;")&&p(e,"style",i)},d(s){s&&x(e)}}}function pI(t){let e,n=t[2]=="default"&&Yw(t);return{c(){n&&n.c(),e=he()},m(i,s){n&&n.m(i,s),w(i,e,s)},p(i,s){i[2]=="default"?n?n.p(i,s):(n=Yw(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(i){i&&x(e),n&&n.d(i)}}}function Xw(t){let e,n;return e=new vi({props:{size:"0.7em",fract:t[9],barcol:t[16],left:t[11],right:t[7],darken:!0,$$slots:{default:[dI]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&512&&(o.fract=i[9]),s&65536&&(o.barcol=i[16]),s&2048&&(o.left=i[11]),s&128&&(o.right=i[7]),s&536875008&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function dI(t){let e;return{c(){e=h("div"),p(e,"class","progressBar bgspell castbar svelte-g292qg"),qe(e,"width",t[12]+"%"),qe(e,"display",t[12]>0?"inherit":"none")},m(n,i){w(n,e,i)},p(n,i){i&4096&&qe(e,"width",n[12]+"%"),i&4096&&qe(e,"display",n[12]>0?"inherit":"none")},d(n){n&&x(e)}}}function hI(t){let e,n,i;return{c(){e=h("img"),p(e,"class",n="tag icon border black bgf"+t[5].faction+" round svelte-g292qg"),lt(e.src,i="/data/ui/factions/"+t[5].faction+"."+On+"?v=8602459")||p(e,"src",i)},m(s,o){w(s,e,o)},p(s,o){o&32&&n!==(n="tag icon border black bgf"+s[5].faction+" round svelte-g292qg")&&p(e,"class",n),o&32&&!lt(e.src,i="/data/ui/factions/"+s[5].faction+"."+On+"?v=8602459")&&p(e,"src",i)},d(s){s&&x(e)}}}function gI(t){let e,n;return{c(){e=h("img"),p(e,"class","tag icon border black bgblack round svelte-g292qg"),lt(e.src,n="/data/ui/icons/"+(t[5].role==2?"star":"starsilver")+"."+On+"?v=8602459")||p(e,"src",n)},m(i,s){w(i,e,s)},p(i,s){s&32&&!lt(e.src,n="/data/ui/icons/"+(i[5].role==2?"star":"starsilver")+"."+On+"?v=8602459")&&p(e,"src",n)},d(i){i&&x(e)}}}function Qw(t){let e;return{c(){e=h("div"),p(e,"class","tag icon border black round combat svelte-g292qg")},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function Zw(t,e){let n,i,s,o=[e[26],{size:e[2]=="default"?31:23}],r={};for(let l=0;l<o.length;l+=1)r=Hl(r,o[l]);return i=new Lx({props:r}),{key:t,first:null,c(){n=he(),ne(i.$$.fragment),this.first=n},m(l,a){w(l,n,a),K(i,l,a),s=!0},p(l,a){e=l;let c=a&524292?lm(o,[a&524288&&am(e[26]),a&4&&{size:e[2]=="default"?31:23}]):{};i.$set(c)},i(l){s||(P(i.$$.fragment,l),s=!0)},o(l){I(i.$$.fragment,l),s=!1},d(l){l&&x(n),ee(i,l)}}}function vI(t){let e,n,i=t[5].visible&&Gw(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[5].visible?i?(i.p(s,o),o&32&&P(i,1)):(i=Gw(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function _I(t,e,n){let i,s,o,r,l=ae,a=()=>(l(),l=as(v,Z=>n(5,r=Z)),v),c,f,u,m=ae,g=()=>(m(),m=as(_,Z=>n(19,u=Z)),_);se(t,Os,Z=>n(17,c=Z)),se(t,ya,Z=>n(18,f=Z)),t.$$.on_destroy.push(()=>l()),t.$$.on_destroy.push(()=>m());let{unit:v}=e;a();let{buffs:_}=e;g();let{mode:b="default"}=e,{order:y=0}=e,{id:k=""}=e,A,S,F,M,D,R,E,L,z,q,j=!1,W=0,U=Z=>{r.id&&ur(r.id)},O=Z=>ix(Z,r);return t.$$set=Z=>{"unit"in Z&&a(n(0,v=Z.unit)),"buffs"in Z&&g(n(1,_=Z.buffs)),"mode"in Z&&n(2,b=Z.mode),"order"in Z&&n(3,y=Z.order),"id"in Z&&n(4,k=Z.id)},t.$$.update=()=>{t.$$.dirty&32&&n(24,i=r.world==V.id?r.alive?!1:"Dead":r.world),t.$$.dirty&18874404&&(n(21,A=r.hpMax?b=="default"?ii(r.hp)+"/"+ii(r.hpMax):ii(r.hp):"?"),n(6,F=i||A),n(8,D=i!="offline"?~~(r.hpMax?r.hp/r.hpMax*100:100):0),n(13,q=i?"bggrey":(V.mode.partyBasedHostility?r.party===V.player.party:r.faction===V.player.faction)?"bghealth":"bgenemy")),t.$$.dirty&36&&n(22,S=r.mpMax?b=="default"?ii(r.mp)+"/"+ii(r.mpMax):ii(r.mp):"?"),t.$$.dirty&32&&n(10,E=r.name?ax(r.name,10):""),t.$$.dirty&32&&n(11,L=r.timedSkill?(C.ui.hiddenskills[r.timedSkill.id]||C.items.book[r.timedSkill.id]).name:`Lv. ${r.level}`),t.$$.dirty&20971552&&n(7,M=i||(r.timedSkill?r.timedCast.remaining(V.smoothtime).toFixed(1):S)),t.$$.dirty&16777248&&n(9,R=i!="offline"?~~(r.mpMax?r.mp/r.mpMax*100:100):0),t.$$.dirty&16777248&&n(12,z=i!="offline"&&r.timedSkill?r.timedCast.fraction(V.smoothtime)*100:0),t.$$.dirty&16777216&&n(16,s=i?"bggrey":"bgmana"),t.$$.dirty&4&&n(15,o=Math.round(b=="default"?100:85)),t.$$.dirty&8388640&&(n(14,j=W!=r.id),n(23,W=r.id))},[v,_,b,y,k,r,F,M,D,R,E,L,z,q,j,o,s,c,f,u,U,A,S,W,i,O]}var kg=class extends xe{constructor(e){super(),Ce(this,e,_I,vI,Ue,{unit:0,buffs:1,mode:2,order:3,id:4})}},ru=kg;function bI(t){let e,n,i,s;return n=new ru({props:{id:"ufplayer",order:0,unit:Us,buffs:sa}}),i=new ru({props:{id:"uftarget",order:1,unit:Os,buffs:Bc}}),{c(){e=h("div"),ne(n.$$.fragment),ne(i.$$.fragment),p(e,"class","targetframes svelte-17up9g6")},m(o,r){w(o,e,r),K(n,e,null),K(i,e,null),s=!0},p:ae,i(o){s||(P(n.$$.fragment,o),P(i.$$.fragment,o),s=!0)},o(o){I(n.$$.fragment,o),I(i.$$.fragment,o),s=!1},d(o){o&&x(e),ee(n),ee(i)}}}var xg=class extends xe{constructor(e){super(),Ce(this,e,null,bI,yn,{})}},Jw=xg;function Kw(t){let e,n;return{c(){e=h("span"),n=T(t[2]),p(e,"class","slottext key svelte-1p1x0hl")},m(i,s){w(i,e,s),d(e,n)},p(i,s){s[0]&4&&G(n,i[2])},d(i){i&&x(e)}}}function e4(t){let e,n;return{c(){e=h("span"),n=T(t[3]),p(e,"class","slottext stacks svelte-1p1x0hl")},m(i,s){w(i,e,s),d(e,n)},p(i,s){s[0]&8&&G(n,i[3])},d(i){i&&x(e)}}}function t4(t){let e,n=(t[5]>99?Math.round(t[5]/60)+"'":t[5]<=3?t[5].toFixed(1):Math.ceil(t[5]))+"",i;return{c(){e=h("div"),i=T(n),p(e,"class","time absCentered slottext svelte-1p1x0hl")},m(s,o){w(s,e,o),d(e,i)},p(s,o){o[0]&32&&n!==(n=(s[5]>99?Math.round(s[5]/60)+"'":s[5]<=3?s[5].toFixed(1):Math.ceil(s[5]))+"")&&G(i,n)},d(s){s&&x(e)}}}function n4(t){let e;return{c(){e=h("div"),p(e,"class","autocast svelte-1p1x0hl")},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function i4(t){let e,n,i,s=t[31].default,o=Yl(s,t,t[30],null);return{c(){e=h("div"),o&&o.c(),p(e,"class",n="border "+t[6]+" slotdescription svelte-1p1x0hl"),p(e,"style",t[10])},m(r,l){w(r,e,l),o&&o.m(e,null),t[33](e),i=!0},p(r,l){o&&o.p&&(!i||l[0]&1073741824)&&Ql(o,s,r,r[30],i?Xl(s,r[30],l,null):Zl(r[30]),null),(!i||l[0]&64&&n!==(n="border "+r[6]+" slotdescription svelte-1p1x0hl"))&&p(e,"class",n),(!i||l[0]&1024)&&p(e,"style",r[10])},i(r){i||(P(o,r),i=!0)},o(r){I(o,r),i=!1},d(r){r&&x(e),o&&o.d(r),t[33](null)}}}function yI(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v,_,b,y=t[2]!==void 0&&Kw(t),k=t[3]!==void 0&&e4(t),A=re.cdTextSkills&&t[5]!==void 0&&t4(t),S=t[11]&&n4(t),F=t[9]&&t[0]&&!t[15]&&i4(t);return{c(){e=h("div"),y&&y.c(),n=he(),k&&k.c(),i=he(),A&&A.c(),s=h("div"),r=h("div"),a=h("div"),S&&S.c(),f=h("img"),F&&F.c(),p(s,"class",o="overlay "+(t[4]!==void 0?"":"hidden")+" svelte-1p1x0hl"),p(r,"class",l="overlay "+t[16]+" svelte-1p1x0hl"),p(a,"class",c="overlay "+(!t[14]||t[4]>0&&t[4]<10?"hidden":"offCd")+" svelte-1p1x0hl"),p(f,"class",u="icon "+t[7]+" svelte-1p1x0hl"),lt(f.src,m=t[17])||p(f,"src",m),p(e,"id",t[8]),p(e,"class",g="border "+t[6]+" "+(t[15]&&t[15].data==t[1]?"grey":"")+" slot "+(t[1]?"filled":"")+" svelte-1p1x0hl")},m(M,D){w(M,e,D),y&&y.m(e,null),d(e,n),k&&k.m(e,null),d(e,i),A&&A.m(e,null),d(e,s),t[32](s),d(e,r),d(e,a),S&&S.m(e,null),d(e,f),F&&F.m(e,null),v=!0,_||(b=[Y(e,"pointerenter",t[20]),Y(e,"pointerleave",t[21]),Y(e,"pointerdown",t[18]),Y(e,"pointerup",t[19])],_=!0)},p(M,D){M[2]!==void 0?y?y.p(M,D):(y=Kw(M),y.c(),y.m(e,n)):y&&(y.d(1),y=null),M[3]!==void 0?k?k.p(M,D):(k=e4(M),k.c(),k.m(e,i)):k&&(k.d(1),k=null),re.cdTextSkills&&M[5]!==void 0?A?A.p(M,D):(A=t4(M),A.c(),A.m(e,s)):A&&(A.d(1),A=null),(!v||D[0]&16&&o!==(o="overlay "+(M[4]!==void 0?"":"hidden")+" svelte-1p1x0hl"))&&p(s,"class",o),(!v||D[0]&65536&&l!==(l="overlay "+M[16]+" svelte-1p1x0hl"))&&p(r,"class",l),(!v||D[0]&16400&&c!==(c="overlay "+(!M[14]||M[4]>0&&M[4]<10?"hidden":"offCd")+" svelte-1p1x0hl"))&&p(a,"class",c),M[11]?S||(S=n4(M),S.c(),S.m(e,f)):S&&(S.d(1),S=null),(!v||D[0]&128&&u!==(u="icon "+M[7]+" svelte-1p1x0hl"))&&p(f,"class",u),(!v||D[0]&131072&&!lt(f.src,m=M[17]))&&p(f,"src",m),M[9]&&M[0]&&!M[15]?F?(F.p(M,D),D[0]&33281&&P(F,1)):(F=i4(M),F.c(),P(F,1),F.m(e,null)):F&&(Ee(),I(F,1,1,()=>{F=null}),Ie()),(!v||D[0]&256)&&p(e,"id",M[8]),(!v||D[0]&32834&&g!==(g="border "+M[6]+" "+(M[15]&&M[15].data==M[1]?"grey":"")+" slot "+(M[1]?"filled":"")+" svelte-1p1x0hl"))&&p(e,"class",g)},i(M){v||(P(F),v=!0)},o(M){I(F),v=!1},d(M){M&&x(e),y&&y.d(),k&&k.d(),A&&A.d(),t[32](null),S&&S.d(),F&&F.d(),_=!1,at(b)}}}function kI(t,e,n){let i,s,o,r;se(t,En,H=>n(15,r=H));let{$$slots:l={},$$scope:a}=e,{data:c=void 0}=e,{key:f}=e,{stacks:u}=e,{cd:m}=e,{remaining:g}=e,{border:v="grey"}=e,{img:_}=e,{meta:b}=e,{css:y=""}=e,{id:k=""}=e,{describe:A=!0}=e,{queued:S=!1}=e,{pickable:F=!0}=e,{descRoot:M}=e,{descPos:D="bottom: 100%; right: 100%;"}=e,{auto:R=!1}=e,{status:E=0}=e,{hover:L=!1}=e,{clickToUse:z=!1}=e,{shift:q=!1}=e,j=!1,W=(H,pe)=>H?"queued":pe==5?"oom":pe==6?"range":pe==11||pe==9?"combat":"hidden",U,O=H=>{H.altKey||(z&&!q?ze("use",{e:H,...b}):(j=!0,ce(!1),ze("click",b)))},Z=H=>{H.button==2?q?ze("use",{e:H,...b}):ze("context",{e:H,...b}):r?(r.data.type&&Mt(zi[r.data.type].sound),ze("move",{from:r.meta,to:b}),r.meta&&r.meta.store&&r.meta.store.set(),Qe(En,r=void 0,r)):z?q&&fe():H.altKey?b.item&&b.item.dbid&&Vi.update(pe=>pe+`>${b.item.dbid}`):fe(),j=!1},ve=H=>{ce(!0)},Fe=()=>{ze("discard")},_e=H=>{ce(!1),c&&j&&(j=!1,fe())},ce=H=>{L!=="force"&&n(0,L=H)},fe=()=>{!c||F===!1||(c.moving||Qe(En,r={data:c,img:_,meta:b,border:v,css:y,discard:Fe},r),c.type&&Mt(zi[c.type].sound))},ze=lo(),Pe;function Me(H){Bt[H?"unshift":"push"](()=>{Pe=H,n(13,Pe)})}function be(H){Bt[H?"unshift":"push"](()=>{U=H,n(12,U)})}return t.$$set=H=>{"data"in H&&n(1,c=H.data),"key"in H&&n(2,f=H.key),"stacks"in H&&n(3,u=H.stacks),"cd"in H&&n(4,m=H.cd),"remaining"in H&&n(5,g=H.remaining),"border"in H&&n(6,v=H.border),"img"in H&&n(22,_=H.img),"meta"in H&&n(23,b=H.meta),"css"in H&&n(7,y=H.css),"id"in H&&n(8,k=H.id),"describe"in H&&n(9,A=H.describe),"queued"in H&&n(24,S=H.queued),"pickable"in H&&n(25,F=H.pickable),"descRoot"in H&&n(26,M=H.descRoot),"descPos"in H&&n(10,D=H.descPos),"auto"in H&&n(11,R=H.auto),"status"in H&&n(27,E=H.status),"hover"in H&&n(0,L=H.hover),"clickToUse"in H&&n(28,z=H.clickToUse),"shift"in H&&n(29,q=H.shift),"$$scope"in H&&n(30,a=H.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&16400&&n(14,i=i||m>0),t.$$.dirty[0]&138444817&&n(17,s=_?r&&L||m>0||E==-1?_.replace(/(?<!githubusercontent)\.(?!githubusercontent)/,"_grey.").replace(/_q[0-9]/g,""):_:`/data/ui/slotbg/bg.${Gn}?v=8602459`),t.$$.dirty[0]&150996992&&n(16,o=W(R||S,E)),t.$$.dirty[0]&67112960&&U&&M&&M.appendChild(U),t.$$.dirty[0]&8208&&Kf(Math.floor(m||0),Pe,40)},[L,c,f,u,m,g,v,y,k,A,D,R,U,Pe,i,r,o,s,O,Z,ve,_e,_,b,S,F,M,E,z,q,a,l,Me,be]}var wg=class extends xe{constructor(e){super(),Ce(this,e,kI,yI,yn,{data:1,key:2,stacks:3,cd:4,remaining:5,border:6,img:22,meta:23,css:7,id:8,describe:9,queued:24,pickable:25,descRoot:26,descPos:10,auto:11,status:27,hover:0,clickToUse:28,shift:29},null,[-1,-1])}},_l=wg;var s4=(t,e)=>typeof t=="function"?t(e):t;var lu=Object.keys({onBlock:0,statsStatic:0,statsConvert:0,statsOverride:0,onInterval:0,multiplyIncomingHeal:0,multiplyIncomingDamage:0,addIncomingHeal:0,addIncomingDamage:0,addIncomingCrit:0,afterDamageEnemy:0,afterHealAlly:0,beforeDamageEnemy:0,beforeIncomingDamage:0,afterIncomingDamage:0,movementOverride:0,incapacitated:0,breakOnMove:0,breakOnCast:0,instantCast:0,onCast:0,onEnd:0,immuneAll:0,immuneCC:0,breakAfterPercentDamage:0}),de=class{constructor(e){this.id=e.id,this.intervalHaste=e.intervalHaste!==!1,this.intervalDuration=e.intervalDuration,this.intervalOnApply=e.intervalOnApply||!1,this.maxStacks=e.maxStacks,this.passive=e.passive||!1,this.clearOnDeath=e.clearOnDeath!==!1,this.custom=e.custom,this.unique=e.unique||!1,this.dr=e.dr||0,this.type=e.type||0,this.tags=e.tags||new Set,this.immuneAll=e.immuneAll||!1,this.immuneCC=e.immuneCC||!1,lu.forEach(n=>{this[n]=e[n]}),this.customIcon=e.customIcon,this.icon=e.icon,this.fx=e.fx||{}}onSet(e,n,i){this.tags.forEach(s=>{i.tags.get(s).add(e)}),lu.forEach(s=>{this[s]&&(s!=="incapacitated"&&s!=="movementOverride"||i.immuneCC.size<=0)&&i[s].add(e)})}onRemove(e,n,i){this.tags.forEach(s=>{i.tags.get(s).delete(e)}),lu.forEach(s=>{this[s]&&i[s].delete(e)})}};var o4=new de({id:77,passive:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(t.level*40)),e.addStat(28,Math.round(t.level*200))}});var r4=new de({id:59,tags:new Set([11]),icon:"ui/skills/2",fx:{stick:15},statsStatic:(t,e)=>{e.addStat(13,300+t.level*40)}});var md=(t,e)=>t*e/65535;var l4=(t,e)=>{let n=e/65535;return[(t>>>16)*n,(t&65535)*n]};var _i=t=>t/60;var Ka=(t,e)=>{if(t.static||!e.data)return!1;let n=l4(e.data[0]*2,6400),i=[n[0]-t.pos[0],n[1]-t.pos[2]];return Sa(i)>t.size?(t.setSteer(0,1),t.setRot(al(i)),t.setJump(0),!0):(t.setSteer(0,0),!1)};var a4=new de({id:87,incapacitated:!0,icon:"ui/skills/33",fx:{stick:74,endSound:65},statsOverride:(t,e)=>{e.stat.set(15,250)},movementOverride:(t,e,n,i,s)=>{Ka(i,s)||i.buffs.removeBuff(s.id,i.id)}});var c4=new de({id:76,icon:"ui/skills/20",fx:{stick:53},unique:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(t.level*30)),e.addStat(9,Math.round(t.level*22))}});var f4=new de({id:73,passive:!0,icon:"ui/skills/17",custom:[[t=>93+t*32,"% as additional damage over 10 seconds"]],afterDamageEnemy:{3:(t,e,n)=>{}}});var u4=new de({id:74,type:1,tags:new Set([1]),maxStacks:3,icon:"ui/skills/18",fx:{stick:38,color:[.7,.1,.1,.5]},intervalDuration:1.5,onInterval:(t,e,n)=>({id:18,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,noDaze:!0,type:1})});var m4=new de({id:72,icon:"ui/skills/17",fx:{stick:18,color:[.9,.3,.1,.7]},custom:[[t=>t*12,"% increased damage"]]});var p4=new de({id:121,incapacitated:!0,type:1,tags:new Set([7]),dr:3,breakAfterPercentDamage:.1,icon:"ui/skills/50",fx:{stick:86,incapacitated:!0},statsOverride:(t,e)=>{e.stat.get(15)>100&&e.stat.set(15,100)},movementOverride:(t,e,n,i,s)=>{Ka(i,s)},intervalDuration:1});var d4=new de({id:61,passive:!0,icon:"ui/skills/8",statsConvert:[[0,.3,10],[0,.3,11],[0,.3,8]]});var h4=new de({id:89,type:1,tags:new Set([3]),icon:"ui/skills/34",statsStatic:(t,e)=>{e.maxStat(29,10+t.level*10)}});var g4=new de({id:105,maxStacks:3,icon:"ui/skills/temperBoostBuff",fx:{stick:24,color:[.2,.2,.25,.95]},statsStatic:(t,e)=>{e.addStat(15,20)}});var v4=new de({id:104,maxStacks:3,tags:new Set([3,4]),icon:"ui/skills/41",fx:{stick:23,color:[.1,.1,.1,.92]},intervalDuration:.5,onInterval:(t,e,n)=>!0});var _4=new de({id:75,icon:"ui/skills/19",fx:{stick:54},unique:!0,statsStatic:(t,e)=>{e.addStat(10,t.level*3),e.addStat(11,t.level*4),e.addStat(6,t.level*50)}});var b4=new de({id:115,incapacitated:!0,tags:new Set([8]),immuneCC:!0,icon:"ui/skills/46",fx:{anim:34},statsStatic:(t,e)=>{e.maxStat(29,40)},statsOverride:(t,e)=>{e.stat.set(13,0)},intervalDuration:.5,onInterval:(t,e,n)=>!0});var y4=new de({id:91,type:1,tags:new Set([6]),incapacitated:!0,dr:3,icon:"ui/skills/37",fx:{visual:20,stick:88,endSound:69},statsStatic:(t,e)=>{e.maxStat(29,30+t.level*7),e.maxStat(30,20+t.level*5)}});var k4=new de({id:84,icon:"ui/skills/28",fx:{stick:65},unique:!0,statsStatic:(t,e)=>{e.addStat(16,100+t.level*60)}});var x4=new de({id:67,type:1,tags:new Set([3,1]),icon:"ui/skills/12",fx:{apply:50,stick:49,color:[.5,.4,.05,.5]},statsStatic:(t,e)=>{e.maxStat(29,20+t.level*3)},intervalDuration:1.5,onInterval:(t,e,n)=>({id:12,mode:1,caster:t.caster,target:e.id,dmg:1+n.stats.getDamageRoll()*(.1+t.level*.08),type:1,noDaze:!0})});var w4=new de({id:68,icon:"ui/skills/13",fx:{stick:52},intervalDuration:1,custom:[[t=>30+40*t,"MP recovered"]],onInterval:(t,e,n)=>{}});var M4=new de({id:107,maxStacks:5,icon:"ui/skills/43",fx:{stick:20}});var F4=new de({id:106,passive:!0});var C4=new de({id:60,maxStacks:3,icon:"ui/skills/7",fx:{stick:37},intervalDuration:1,multiplyIncomingHeal:{6:t=>1+t.stacks*.3,7:t=>1+(t.stacks-1)*.3},onInterval:(t,e,n)=>({id:7,mode:2,caster:t.caster,target:e.id,heal:6+n.stats.getDamageRoll()*(.028+t.level*.024)})});var S4=new de({id:64,passive:!0,icon:"ui/skills/8",statsConvert:[[4,.4,10],[4,.4,11]]});var A4=new de({id:90,breakOnCast:!0,icon:"ui/skills/36",fx:{visual:26,apply:76,endSound:69},statsStatic:(t,e)=>{e.addStat(15,8+t.level*12)}});var P4=new de({id:119,incapacitated:!0,type:1,tags:new Set([7]),dr:3,breakAfterPercentDamage:.1,icon:"ui/skills/49",fx:{incapacitated:!0,apply:122,stick:124},statsOverride:(t,e)=>{e.stat.get(15)>50&&e.stat.set(15,50)},movementOverride:(t,e,n,i,s)=>{Ka(i,s)}});var T4=new de({id:120,passive:!0});var E4=new de({id:82,passive:!0,statsStatic:(t,e)=>{e.addStat(14,Math.round(t.level*30))}});var I4=new de({id:66,icon:"ui/skills/11",fx:{stick:39,endSound:69},custom:[[t=>t*9,"% increased damage"]]});var D4=new de({id:83,icon:"ui/skills/27",fx:{stick:63},unique:!0,statsStatic:(t,e)=>{e.addStat(15,5+t.level*13)}});var V4=new de({id:85,passive:!0,icon:"ui/skills/29",custom:[[t=>40+t*21,"% per stack as additional damage over 10 seconds"]],afterDamageEnemy:{9:(t,e,n)=>{}}});var L4=new de({id:86,type:1,maxStacks:3,tags:new Set([3,1]),icon:"ui/skills/29",fx:{apply:51,stick:66,color:[.1,1,.3,.3]},statsStatic:(t,e)=>{e.maxStat(29,30)},intervalDuration:1.5,onInterval:(t,e,n)=>({id:29,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,type:1,noDaze:!0})});var q4=new de({id:95,maxStacks:4,icon:"ui/skills/31",instantCast:new Set([31]),beforeDamageEnemy:{31:(t,e,n,i)=>{}}});var R4=new de({id:65,passive:!0,icon:"ui/skills/10",custom:[[t=>2+t*1," Jumps"],[t=>15+t*12.5,"% damage per Jump"]],afterDamageEnemy:{9:(t,e,n)=>{}}});var z4=new de({id:92,icon:"ui/skills/38",fx:{stick:77},statsStatic:(t,e)=>{e.addStat(15,30)},instantCast:new Set([9]),onCast:{9:(t,e)=>{}}});var B4=new de({id:96,passive:!1,incapacitated:!0,icon:"ui/skills/38",statsOverride:(t,e)=>{e.stat.set(15,400)},movementOverride:(t,e,n,i,s)=>{i.setSteer(s.data[0]-1,s.data[1]-1)}});var U4=new de({id:63,passive:!0,icon:"ui/skills/8",statsConvert:[[2,.4,10],[2,.4,11]]});var O4=new de({id:81,icon:"ui/skills/25",fx:{stick:64},unique:!0,statsStatic:(t,e)=>{e.addStat(16,t.level*30)}});var $4=new de({id:118,passive:!0});var N4=new de({id:114,incapacitated:!0,tags:new Set([8]),icon:"ui/skills/45",fx:{anim:33},intervalHaste:!1,intervalDuration:.25,statsStatic:(t,e)=>{e.maxStat(29,15)},onInterval:(t,e,n)=>!0});var j4=new de({id:78,icon:"ui/skills/22",fx:{stick:60},unique:!0,statsStatic:(t,e)=>{e.addStat(14,t.level*30)}});var W4=new de({id:101,type:1,tags:new Set([5]),incapacitated:!0,dr:1,icon:"ui/skills/deepFrozen",fx:{stick:57,color:[.1,.9,.8,.9],frozen:!0},statsStatic:(t,e)=>{e.maxStat(29,100)},multiplyIncomingDamage:{4:t=>1+t.level*.1,15:t=>1+t.level*.1,51:t=>1+t.level*.1}});var G4=new de({id:80,icon:"ui/skills/24",fx:{stick:91},unique:!0,statsStatic:(t,e)=>{e.addStat(10,Math.floor(2+t.level*1.5)),e.addStat(11,Math.floor(3+t.level*3.5))}});var H4=new de({id:108,icon:"ui/skills/extraBolt",fx:{stick:22}});var Y4=new de({id:116,incapacitated:!0,tags:new Set([8,10]),breakOnMove:!0,icon:"ui/skills/52",fx:{anim:35},intervalDuration:1,intervalOnApply:1,onInterval:(t,e,n)=>!0});var X4=new de({id:69,type:1,tags:new Set([4]),dr:2,icon:"ui/skills/14",fx:{stick:56,color:[.7,.7,1,.4]},statsStatic:(t,e)=>{e.maxStat(29,100)},addIncomingCrit:{4:t=>10+t.level*30,15:t=>20+t.level*30},intervalDuration:1.5,onInterval:(t,e,n)=>({id:14,mode:1,caster:t.caster,target:e.id,dmg:n.stats.getDamageRoll()*(.09+t.level*.27),type:1,noDaze:!0})});var Q4=new de({id:99,type:1,tags:new Set([3]),maxStacks:4,icon:"ui/skills/frozenBuff",fx:{stick:58,color:[.1,.1,.8,.5]},statsStatic:(t,e)=>{e.maxStat(29,20)}});var Z4=new de({id:71,icon:"ui/skills/16",fx:{stick:40,endSound:69},statsStatic:(t,e)=>{e.addStat(16,30+t.level*70),e.addStat(27,2+t.level*8)}});var J4=new de({id:117,incapacitated:!0,tags:new Set([9,11,12]),immuneAll:!0,intervalDuration:1,intervalHaste:!1,icon:"ui/skills/53",fx:{stick:120,frozen:!0},statsStatic:(t,e)=>{e.maxStat(29,100)},onInterval:(t,e,n)=>({id:53,mode:2,caster:t.caster,target:n.id,heal:t.level*50,nocrit:!0})});var K4=new de({id:100,passive:!0});var e5=new de({id:79,icon:"ui/skills/23",fx:{stick:17}});var t5=new de({id:70,passive:!0});var n5=new de({id:62,passive:!0,icon:"ui/skills/8",statsConvert:[[3,.4,10],[3,.4,11]]});var i5=new de({id:112,type:0,icon:"ui/skills/charm4",fx:{stick:42,color:[0,0,1,.7]}});var s5=new de({id:113,type:1,tags:new Set([1]),maxStacks:10,icon:"ui/skills/firebuff",fx:{stick:67,color:[2,1,.3,1]}});var o5=new de({id:126,type:1,tags:new Set([1]),maxStacks:5,icon:"ui/skills/firebuff",fx:{stick:132,apply:135,color:[.7,.1,1.5,1]}});var r5=new de({id:94,type:1,tags:new Set([3]),icon:"ui/skills/dazedBuff",fx:{stick:73},statsStatic:(t,e)=>{e.maxStat(29,30)}});var l5=new de({id:110,type:0,icon:"ui/skills/charm2",fx:{stick:21,color:[1,0,0,.8]},statsStatic:(t,e)=>{e.addStat(27,t.level)}});var a5=new de({id:124,passive:!1,icon:"ui/skills/hellspawn"});var c5=new de({id:109,type:0,icon:"ui/skills/charm1",fx:{stick:61,color:[.3,.3,.3,.9]},statsStatic:(t,e)=>{e.addStat(31,50)},beforeIncomingDamage:(t,e,n,i)=>n*(t.level/100)});var f5=new de({id:123,passive:!0});var u5=new de({id:93,breakOnCast:!0,tags:new Set([12]),icon:"ui/skills/39",customIcon:t=>"items/mount/mount"+rr[t.data[0]].tier+"_q1",fx:{mount:t=>rr[t.data[0]].skin,apply:76,endSound:69},statsStatic:(t,e)=>{e.addStat(15,60)}});var m5=new de({id:130,clearOnDeath:!1,tags:new Set([12]),icon:"ui/skills/39",customIcon:t=>"items/pet/pet"+rr[t.data[0]].tier+"_q1"});var p5=new de({id:111,type:0,icon:"ui/skills/charm3",fx:{stick:62,color:[.3,0,.6,.8]},statsStatic:(t,e)=>{e.addStat(15,t.level)}});var d5=new de({id:127,type:0,maxStacks:8,clearOnDeath:!1,icon:"ui/skills/obeliskbuff"});var h5=new de({id:125,maxStacks:25,type:1,icon:"ui/skills/pierce",multiplyIncomingDamage:{0:t=>1+t.stacks*.2,60:t=>1+t.stacks*.2}});var g5=new de({id:103,icon:"ui/skills/postsummon",fx:{stick:80},unique:!0,statsStatic:(t,e)=>{e.addStat(15,20)}});var Mg=["potionhp","potionMp"].map((t,e)=>new de({id:[97,98][e],maxStacks:1,icon:"ui/skills/"+t,fx:{stick:[43,83][e]},intervalHaste:!1,intervalDuration:.5,onInterval:(n,i,s)=>({id:100,mode:[2,3][e],caster:n.caster,target:i.id,heal:e==1?void 0:n.level,mprec:e==0?void 0:n.level,nocrit:!0})}));var v5=new de({id:88,type:1,tags:new Set([5]),dr:1,incapacitated:!0,icon:"ui/skills/stunBuff",fx:{stick:86,incapacitated:!0},movementOverride:(t,e,n,i,s)=>{i.setSteer(0,0),i.setJump(0)}});var _5=new de({id:102,maxStacks:99,icon:"ui/skills/suddenDeath",statsStatic:(t,e)=>{e.maxStat(30,t.stacks)}});var b5=new de({id:122,passive:!1,immuneCC:!0,icon:"ui/skills/21",statsStatic:(t,e)=>{e.addStat(6,t.stacks*5e5),t.level>1&&(e.addStat(17,30),e.addStat(16,1e3),e.addStat(15,200),e.addStat(10,500),e.addStat(11,500))},onCast:{0:(t,e,n,i,s)=>{}}});var y5=new de({id:131,passive:!0});var k5=new de({id:132,passive:!0});var x5=new de({id:128,type:0,tags:new Set([12]),icon:"ui/skills/ghost",fx:{color:[.9,1.2,.8,.8],alpha:[.3]}});var w5=new de({id:129,type:0,icon:"ui/skills/moderator",fx:{color:[.3,1.2,.9,.7],alpha:[.3]}});var bl=new Map;[x5,w5,d5,o5,h5,y5,f5,a5,b5,s5,i5,p5,l5,c5,g5,_5,Mg[0],Mg[1],v5,u5,m5,r5,p4,b4,g4,v4,h4,a4,_4,c4,o4,u4,f4,m4,r4,d4,M4,F4,y4,A4,k4,w4,C4,S4,x4,J4,Y4,H4,W4,K4,Q4,G4,j4,e5,t5,X4,n5,Z4,T4,k5,P4,$4,N4,B4,q4,z4,V4,L4,O4,D4,E4,U4,R4,I4].forEach(t=>{bl.set(t.id,t)});var ec=class{constructor(e){this.entity=e,this.alive=!0,this.stat=new Map,this.resource=new Map,this.combatTimer=new kt(-1,6)}tick(e,n){this.combatTimer.start>0&&this.combatTimer.done(n)&&this.onCombatEnd(n)}die(){return this.alive?(this.alive=!1,this.entity.skills.onDeath(),this.entity.buffs.onDeath(),!0):!1}getStat(e){return this.stat.get(e)|0}getResource(e){return this.resource.get(e)|0}addStat(e,n){this.stat.set(e,(this.stat.get(e)|0)+n)}maxStat(e,n){this.stat.set(e,Math.max(this.stat.get(e)|0,n))}multiplyStat(e,n){this.stat.set(e,(this.stat.get(e)|0)*n)}setResource(e,n){let i=Math.round(vt(n,0,this.getStat(e)));return this.resource.set(e,i),i}changeResource(e,n){return this.setResource(e,this.getResource(e)+n)}respawn(){this.alive=!0,this.onCombatEnd()}clear(){}refreshCombatTimer(e,n){this.combatTimer.end<e+n&&this.combatTimer.reset(e,n)}onCombatEnd(){this.combatTimer.reset(-1)}getDamageRoll(){return Math.round((this.getStat(10)+this.getStat(11))/2)}};function M5(t,e,n){let i=t.slice();return i[12]=e[n],i}function F5(t,e,n){let i=t.slice();return i[15]=e[n],i}function C5(t,e,n){let i=t.slice();return i[18]=e[n],i}function S5(t,e,n){let i=t.slice();return i[18]=e[n],i}function A5(t,e,n){let i=t.slice();return i[23]=e[n],i}function P5(t,e,n){let i=t.slice();return i[26]=e[n],i}function T5(t,e,n){let i=t.slice();return i[23]=e[n],i}function E5(t,e,n){let i=t.slice();return i[26]=e[n],i}function I5(t,e,n){let i=t.slice();return i[33]=e[n],i}function D5(t,e,n){let i=t.slice();return i[26]=e[n],i}function xI(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v,_,b,y,k,A,S,F,M,D,R=!t[2]&&t[0].parent===void 0&&V5(t),E=t[0].actiontype&&L5(t),L=t[0].auto&&q5(t),z=t[0].costMp&&R5(t),q=t[0].castLen&&z5(t),j=t[0].cd&&B5(t),W=t[0].duration>0&&U5(t),U=t[0].unique&&O5(t),O=t[0].refresh&&$5(t),Z=t[0].range&&N5(t),ve=t[6][t[0].targetMode]&&j5(t),Fe=t[0].maxStacks&&W5(t),_e=t[0].dmg&&G5(t),ce=t[0].heal&&H5(t),fe=me([t[0].multiplyIncomingHeal,t[0].multiplyIncomingDamage]),ze=[];for(let J=0;J<2;J+=1)ze[J]=X5(I5(t,fe,J));let Pe=me([t[0].addIncomingHeal,t[0].addIncomingDamage]),Me=[];for(let J=0;J<2;J+=1)Me[J]=Z5(T5(t,Pe,J));let be=me([t[0].addIncomingCrit]),H=[];for(let J=0;J<1;J+=1)H[J]=K5(A5(t,be,J));let pe=t[0].statsStatic&&eM(t),Be=t[0].statsConvert&&nM(t),Ge=t[0].custom&&sM(t),Xe=t[0].aoe&&t[0].aoe.circleRadius&&rM(t),Ye=!t[0].parent&&lM(t),ue=me(t[5]),oe=[];for(let J=0;J<ue.length;J+=1)oe[J]=aM(M5(t,ue,J));let $e=J=>I(oe[J],1,1,()=>{oe[J]=null});return{c(){R&&R.c(),e=h("div"),E&&E.c(),n=he(),L&&L.c(),i=he(),z&&z.c(),s=he(),q&&q.c(),o=he(),j&&j.c(),r=he(),W&&W.c(),l=he(),U&&U.c(),a=he(),O&&O.c(),c=h("div"),Z&&Z.c(),f=he(),ve&&ve.c(),Fe&&Fe.c(),u=he(),_e&&_e.c(),m=he(),ce&&ce.c(),g=he();for(let J=0;J<2;J+=1)ze[J].c();v=he();for(let J=0;J<2;J+=1)Me[J].c();_=he();for(let J=0;J<1;J+=1)H[J].c();b=he(),pe&&pe.c(),y=he(),Be&&Be.c(),k=he(),Ge&&Ge.c(),A=he(),Xe&&Xe.c(),S=he(),Ye&&Ye.c(),F=he();for(let J=0;J<oe.length;J+=1)oe[J].c();M=he(),p(e,"class","pad textgreen svelte-14w0l4b")},m(J,Q){R&&R.m(J,Q),w(J,e,Q),E&&E.m(e,null),d(e,n),L&&L.m(e,null),d(e,i),z&&z.m(e,null),d(e,s),q&&q.m(e,null),d(e,o),j&&j.m(e,null),d(e,r),W&&W.m(e,null),d(e,l),U&&U.m(e,null),d(e,a),O&&O.m(e,null),d(e,c),Z&&Z.m(c,null),d(c,f),ve&&ve.m(c,null),Fe&&Fe.m(J,Q),w(J,u,Q),_e&&_e.m(J,Q),w(J,m,Q),ce&&ce.m(J,Q),w(J,g,Q);for(let $=0;$<2;$+=1)ze[$]&&ze[$].m(J,Q);w(J,v,Q);for(let $=0;$<2;$+=1)Me[$]&&Me[$].m(J,Q);w(J,_,Q);for(let $=0;$<1;$+=1)H[$]&&H[$].m(J,Q);w(J,b,Q),pe&&pe.m(J,Q),w(J,y,Q),Be&&Be.m(J,Q),w(J,k,Q),Ge&&Ge.m(J,Q),w(J,A,Q),Xe&&Xe.m(J,Q),w(J,S,Q),Ye&&Ye.m(J,Q),w(J,F,Q);for(let $=0;$<oe.length;$+=1)oe[$]&&oe[$].m(J,Q);w(J,M,Q),D=!0},p(J,Q){if(!J[2]&&J[0].parent===void 0?R?R.p(J,Q):(R=V5(J),R.c(),R.m(e.parentNode,e)):R&&(R.d(1),R=null),J[0].actiontype?E?E.p(J,Q):(E=L5(J),E.c(),E.m(e,n)):E&&(E.d(1),E=null),J[0].auto?L||(L=q5(J),L.c(),L.m(e,i)):L&&(L.d(1),L=null),J[0].costMp?z?z.p(J,Q):(z=R5(J),z.c(),z.m(e,s)):z&&(z.d(1),z=null),J[0].castLen?q?q.p(J,Q):(q=z5(J),q.c(),q.m(e,o)):q&&(q.d(1),q=null),J[0].cd?j?j.p(J,Q):(j=B5(J),j.c(),j.m(e,r)):j&&(j.d(1),j=null),J[0].duration>0?W?W.p(J,Q):(W=U5(J),W.c(),W.m(e,l)):W&&(W.d(1),W=null),J[0].unique?U||(U=O5(J),U.c(),U.m(e,a)):U&&(U.d(1),U=null),J[0].refresh?O||(O=$5(J),O.c(),O.m(e,c)):O&&(O.d(1),O=null),J[0].range?Z?Z.p(J,Q):(Z=N5(J),Z.c(),Z.m(c,f)):Z&&(Z.d(1),Z=null),J[6][J[0].targetMode]?ve?ve.p(J,Q):(ve=j5(J),ve.c(),ve.m(c,null)):ve&&(ve.d(1),ve=null),J[0].maxStacks?Fe?Fe.p(J,Q):(Fe=W5(J),Fe.c(),Fe.m(u.parentNode,u)):Fe&&(Fe.d(1),Fe=null),J[0].dmg?_e?_e.p(J,Q):(_e=G5(J),_e.c(),_e.m(m.parentNode,m)):_e&&(_e.d(1),_e=null),J[0].heal?ce?ce.p(J,Q):(ce=H5(J),ce.c(),ce.m(g.parentNode,g)):ce&&(ce.d(1),ce=null),Q[0]&129){fe=me([J[0].multiplyIncomingHeal,J[0].multiplyIncomingDamage]);let $;for($=0;$<2;$+=1){let le=I5(J,fe,$);ze[$]?ze[$].p(le,Q):(ze[$]=X5(le),ze[$].c(),ze[$].m(v.parentNode,v))}for(;$<2;$+=1)ze[$].d(1)}if(Q[0]&129){Pe=me([J[0].addIncomingHeal,J[0].addIncomingDamage]);let $;for($=0;$<2;$+=1){let le=T5(J,Pe,$);Me[$]?Me[$].p(le,Q):(Me[$]=Z5(le),Me[$].c(),Me[$].m(_.parentNode,_))}for(;$<2;$+=1)Me[$].d(1)}if(Q[0]&129){be=me([J[0].addIncomingCrit]);let $;for($=0;$<1;$+=1){let le=A5(J,be,$);H[$]?H[$].p(le,Q):(H[$]=K5(le),H[$].c(),H[$].m(b.parentNode,b))}for(;$<1;$+=1)H[$].d(1)}if(J[0].statsStatic?pe?pe.p(J,Q):(pe=eM(J),pe.c(),pe.m(y.parentNode,y)):pe&&(pe.d(1),pe=null),J[0].statsConvert?Be?Be.p(J,Q):(Be=nM(J),Be.c(),Be.m(k.parentNode,k)):Be&&(Be.d(1),Be=null),J[0].custom?Ge?Ge.p(J,Q):(Ge=sM(J),Ge.c(),Ge.m(A.parentNode,A)):Ge&&(Ge.d(1),Ge=null),J[0].aoe&&J[0].aoe.circleRadius?Xe?Xe.p(J,Q):(Xe=rM(J),Xe.c(),Xe.m(S.parentNode,S)):Xe&&(Xe.d(1),Xe=null),J[0].parent?Ye&&(Ye.d(1),Ye=null):Ye?Ye.p(J,Q):(Ye=lM(J),Ye.c(),Ye.m(F.parentNode,F)),Q[0]&34){ue=me(J[5]);let $;for($=0;$<ue.length;$+=1){let le=M5(J,ue,$);oe[$]?(oe[$].p(le,Q),P(oe[$],1)):(oe[$]=aM(le),oe[$].c(),P(oe[$],1),oe[$].m(M.parentNode,M))}for(Ee(),$=ue.length;$<oe.length;$+=1)$e($);Ie()}},i(J){if(!D){for(let Q=0;Q<ue.length;Q+=1)P(oe[Q]);D=!0}},o(J){oe=oe.filter(Boolean);for(let Q=0;Q<oe.length;Q+=1)I(oe[Q]);D=!1},d(J){J&&(x(e),x(u),x(m),x(g),x(v),x(_),x(b),x(y),x(k),x(A),x(S),x(F),x(M)),R&&R.d(J),E&&E.d(),L&&L.d(),z&&z.d(),q&&q.d(),j&&j.d(),W&&W.d(),U&&U.d(),O&&O.d(),Z&&Z.d(),ve&&ve.d(),Fe&&Fe.d(J),_e&&_e.d(J),ce&&ce.d(J),it(ze,J),it(Me,J),it(H,J),pe&&pe.d(J),Be&&Be.d(J),Ge&&Ge.d(J),Xe&&Xe.d(J),Ye&&Ye.d(J),it(oe,J)}}}function wI(t){let e,n=t[0].item+"",i;return{c(){e=h("div"),i=T(n)},m(s,o){w(s,e,o),d(e,i)},p(s,o){o[0]&1&&n!==(n=s[0].item+"")&&G(i,n)},i:ae,o:ae,d(s){s&&x(e)}}}function V5(t){let e,n,i,s,o=C.items.book[t[0].id].name+"",r,l=t[0].engineOnly?"":" Lv. "+t[1],a;return{c(){e=h("div"),n=h("img"),s=We(),r=T(o),a=T(l),p(n,"class","texticon"),lt(n.src,i=jf(t[0].id))||p(n,"src",i),p(e,"class","slottitle textprimary")},m(c,f){w(c,e,f),d(e,n),d(e,s),d(e,r),d(e,a)},p(c,f){f[0]&1&&!lt(n.src,i=jf(c[0].id))&&p(n,"src",i),f[0]&1&&o!==(o=C.items.book[c[0].id].name+"")&&G(r,o),f[0]&3&&l!==(l=c[0].engineOnly?"":" Lv. "+c[1])&&G(a,l)},d(c){c&&x(e)}}}function L5(t){let e,n=t[8][t[0].mode]+"",i,s,o=t[0].actiontype+"",r;return{c(){e=h("div"),i=T(n),s=We(),r=T(o),p(e,"class","textwhite")},m(l,a){w(l,e,a),d(e,i),d(e,s),d(e,r)},p(l,a){a[0]&1&&n!==(n=l[8][l[0].mode]+"")&&G(i,n),a[0]&1&&o!==(o=l[0].actiontype+"")&&G(r,o)},d(l){l&&x(e)}}}function q5(t){let e;return{c(){e=h("div"),e.textContent="Auto cast"},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function R5(t){let e,n,i=t[0].costMp(t[1])+"",s,o,r=C.ui.stats.array[7]+"",l;return{c(){e=h("div"),n=T("Cost: "),s=T(i),o=We(),l=T(r)},m(a,c){w(a,e,c),d(e,n),d(e,s),d(e,o),d(e,l)},p(a,c){c[0]&3&&i!==(i=a[0].costMp(a[1])+"")&&G(s,i)},d(a){a&&x(e)}}}function z5(t){let e,n=t[7](t[0].castLen)+"",i,s;return{c(){e=h("div"),i=T(n),s=T("s Cast time")},m(o,r){w(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].castLen)+"")&&G(i,n)},d(o){o&&x(e)}}}function B5(t){let e,n=t[7](t[0].cd)+"",i,s;return{c(){e=h("div"),i=T(n),s=T("s Cooldown")},m(o,r){w(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].cd)+"")&&G(i,n)},d(o){o&&x(e)}}}function U5(t){let e,n=t[7](t[0].duration)+"",i,s;return{c(){e=h("div"),i=T(n),s=T("s Duration")},m(o,r){w(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].duration)+"")&&G(i,n)},d(o){o&&x(e)}}}function O5(t){let e;return{c(){e=h("div"),e.textContent="Unique"},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function $5(t){let e;return{c(){e=h("div"),e.textContent="Stacks refresh duration"},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function N5(t){let e,n=t[7](t[0].range)+"",i,s;return{c(){e=h("span"),i=T(n),s=T("m range ")},m(o,r){w(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].range)+"")&&G(i,n)},d(o){o&&x(e)}}}function j5(t){let e,n=t[6][t[0].targetMode]+"",i;return{c(){e=h("span"),i=T(n)},m(s,o){w(s,e,o),d(e,i)},p(s,o){o[0]&1&&n!==(n=s[6][s[0].targetMode]+"")&&G(i,n)},d(s){s&&x(e)}}}function W5(t){let e,n,i,s=t[4].stacks+"",o,r,l,a;return{c(){e=h("div"),n=h("u"),i=T("At "),o=T(s),r=T(" stacks"),l=T(":"),a=h("span"),a.textContent="(Press shift to toggle)",p(e,"class","pad textsecondary svelte-14w0l4b"),p(a,"class","textgrey")},m(c,f){w(c,e,f),d(e,n),d(n,i),d(n,o),d(n,r),d(e,l),w(c,a,f)},p(c,f){f[0]&16&&s!==(s=c[4].stacks+"")&&G(o,s)},d(c){c&&(x(e),x(a))}}}function G5(t){let e,n=t[7](t[0].dmg)+"",i,s;return{c(){e=h("div"),i=T(n),s=T(" DMG"),p(e,"class","textgreen")},m(o,r){w(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].dmg)+"")&&G(i,n)},d(o){o&&x(e)}}}function H5(t){let e,n=t[7](t[0].heal)+"",i,s;return{c(){e=h("div"),i=T(n),s=T(" Heal"),p(e,"class","textgreen")},m(o,r){w(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].heal)+"")&&G(i,n)},d(o){o&&x(e)}}}function Y5(t){let e,n,i=C.items.book[t[26]].name+"",s,o,r=Math.round(100*t[7](t[33][t[26]](t[0]))-100)+"",l,a;return{c(){e=h("div"),n=T("Empower "),s=T(i),o=T(" by "),l=T(r),a=T("%"),p(e,"class","textcyan")},m(c,f){w(c,e,f),d(e,n),d(e,s),d(e,o),d(e,l),d(e,a)},p(c,f){f[0]&1&&i!==(i=C.items.book[c[26]].name+"")&&G(s,i),f[0]&1&&r!==(r=Math.round(100*c[7](c[33][c[26]](c[0]))-100)+"")&&G(l,r)},d(c){c&&x(e)}}}function X5(t){let e,n=me(Object.keys(t[33]||{})),i=[];for(let s=0;s<n.length;s+=1)i[s]=Y5(D5(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=he()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o[0]&129){n=me(Object.keys(s[33]||{}));let r;for(r=0;r<n.length;r+=1){let l=D5(s,n,r);i[r]?i[r].p(l,o):(i[r]=Y5(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function Q5(t){let e,n,i=C.items.book[t[26]].name+"",s,o,r=t[7](t[23][t[26]](t[0]))+"",l;return{c(){e=h("div"),n=T("Empower "),s=T(i),o=T(" by "),l=T(r),p(e,"class","textcyan")},m(a,c){w(a,e,c),d(e,n),d(e,s),d(e,o),d(e,l)},p(a,c){c[0]&1&&i!==(i=C.items.book[a[26]].name+"")&&G(s,i),c[0]&1&&r!==(r=a[7](a[23][a[26]](a[0]))+"")&&G(l,r)},d(a){a&&x(e)}}}function Z5(t){let e,n=me(Object.keys(t[23]||{})),i=[];for(let s=0;s<n.length;s+=1)i[s]=Q5(E5(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=he()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o[0]&129){n=me(Object.keys(s[23]||{}));let r;for(r=0;r<n.length;r+=1){let l=E5(s,n,r);i[r]?i[r].p(l,o):(i[r]=Q5(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function J5(t){let e,n,i=C.items.book[t[26]].name+"",s,o,r=Hn(14,t[7](t[23][t[26]](t[0])))+"",l;return{c(){e=h("div"),n=T("Empower Crit% of "),s=T(i),o=T(" by "),l=T(r),p(e,"class","textcyan")},m(a,c){w(a,e,c),d(e,n),d(e,s),d(e,o),d(e,l)},p(a,c){c[0]&1&&i!==(i=C.items.book[a[26]].name+"")&&G(s,i),c[0]&1&&r!==(r=Hn(14,a[7](a[23][a[26]](a[0])))+"")&&G(l,r)},d(a){a&&x(e)}}}function K5(t){let e,n=me(Object.keys(t[23]||{})),i=[];for(let s=0;s<n.length;s+=1)i[s]=J5(P5(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=he()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o[0]&129){n=me(Object.keys(s[23]||{}));let r;for(r=0;r<n.length;r+=1){let l=P5(s,n,r);i[r]?i[r].p(l,o):(i[r]=J5(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function eM(t){let e,n=me(Array.from(t[3].stat)),i=[];for(let s=0;s<n.length;s+=1)i[s]=tM(S5(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=he()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o[0]&8){n=me(Array.from(s[3].stat));let r;for(r=0;r<n.length;r+=1){let l=S5(s,n,r);i[r]?i[r].p(l,o):(i[r]=tM(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function tM(t){let e,n,i=Hn(t[18][0],t[18][1])+"",s,o,r=C.ui.stats.array[t[18][0]]+"",l,a;return{c(){e=h("div"),n=T("+"),s=T(i),o=We(),l=T(r),a=We(),p(e,"class","textcyan")},m(c,f){w(c,e,f),d(e,n),d(e,s),d(e,o),d(e,l),d(e,a)},p(c,f){f[0]&8&&i!==(i=Hn(c[18][0],c[18][1])+"")&&G(s,i),f[0]&8&&r!==(r=C.ui.stats.array[c[18][0]]+"")&&G(l,r)},d(c){c&&x(e)}}}function nM(t){let e,n=me(t[0].statsConvert),i=[];for(let s=0;s<n.length;s+=1)i[s]=iM(C5(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=he()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o[0]&1){n=me(s[0].statsConvert);let r;for(r=0;r<n.length;r+=1){let l=C5(s,n,r);i[r]?i[r].p(l,o):(i[r]=iM(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function iM(t){let e,n=C.ui.skilldescription.statincrement[0]+"",i,s,o=C.ui.stats.array[t[18][0]]+"",r,l,a=C.ui.skilldescription.statincrement[1]+"",c,f,u=Hn(t[18][0],t[18][1])+"",m,g,v=C.ui.stats.array[t[18][2]]+"",_,b,y=C.ui.skilldescription.statincrement[2]+"",k;return{c(){e=h("div"),i=T(n),s=We(),r=T(o),l=We(),c=T(a),f=We(),m=T(u),g=We(),_=T(v),b=We(),k=T(y),p(e,"class","textcyan")},m(A,S){w(A,e,S),d(e,i),d(e,s),d(e,r),d(e,l),d(e,c),d(e,f),d(e,m),d(e,g),d(e,_),d(e,b),d(e,k)},p(A,S){S[0]&1&&o!==(o=C.ui.stats.array[A[18][0]]+"")&&G(r,o),S[0]&1&&u!==(u=Hn(A[18][0],A[18][1])+"")&&G(m,u),S[0]&1&&v!==(v=C.ui.stats.array[A[18][2]]+"")&&G(_,v)},d(A){A&&x(e)}}}function sM(t){let e,n=me(t[0].custom),i=[];for(let s=0;s<n.length;s+=1)i[s]=oM(F5(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=he()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o[0]&131){n=me(s[0].custom);let r;for(r=0;r<n.length;r+=1){let l=F5(s,n,r);i[r]?i[r].p(l,o):(i[r]=oM(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function oM(t){let e,n=t[7](t[15][0](t[1]))+"",i,s=t[15][1]+"",o;return{c(){e=h("div"),i=T(n),o=T(s),p(e,"class","textcyan")},m(r,l){w(r,e,l),d(e,i),d(e,o)},p(r,l){l[0]&3&&n!==(n=r[7](r[15][0](r[1]))+"")&&G(i,n),l[0]&1&&s!==(s=r[15][1]+"")&&G(o,s)},d(r){r&&x(e)}}}function rM(t){let e,n=t[0].aoe.limit?"Up to "+t[0].aoe.limit:"All",i,s,o=t[0].aoe.faction?"allies":"enemies",r,l,a=t[7](t[0].aoe.circleRadius)+"",c,f;return{c(){e=h("div"),i=T(n),s=We(),r=T(o),l=T(" within "),c=T(a),f=T("m"),p(e,"class","textpvp")},m(u,m){w(u,e,m),d(e,i),d(e,s),d(e,r),d(e,l),d(e,c),d(e,f)},p(u,m){m[0]&1&&n!==(n=u[0].aoe.limit?"Up to "+u[0].aoe.limit:"All")&&G(i,n),m[0]&1&&o!==(o=u[0].aoe.faction?"allies":"enemies")&&G(r,o),m[0]&1&&a!==(a=u[7](u[0].aoe.circleRadius)+"")&&G(c,a)},d(u){u&&x(e)}}}function lM(t){let e,n,i,s=C.items.book[t[0].id].description+"",o;return{c(){e=h("div"),n=h("u"),n.textContent="Effect",i=T(": "),o=T(s),p(e,"class","textsecondary pad svelte-14w0l4b")},m(r,l){w(r,e,l),d(e,n),d(e,i),d(e,o)},p(r,l){l[0]&1&&s!==(s=C.items.book[r[0].id].description+"")&&G(o,s)},d(r){r&&x(e)}}}function aM(t){let e,n,i;return n=new pd({props:{level:t[1],skill:t[12]}}),{c(){e=h("div"),ne(n.$$.fragment),p(e,"class","pad svelte-14w0l4b")},m(s,o){w(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o[0]&2&&(r.level=s[1]),o[0]&32&&(r.skill=s[12]),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&x(e),ee(n)}}}function MI(t){let e,n,i,s,o=[wI,xI],r=[];function l(a,c){return a[0].item?0:1}return n=l(t,[-1,-1]),i=r[n]=o[n](t),{c(){e=h("div"),i.c(),p(e,"class","container textsecondary svelte-14w0l4b")},m(a,c){w(a,e,c),r[n].m(e,null),s=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(Ee(),I(r[f],1,1,()=>{r[f]=null}),Ie(),i=r[n],i?i.p(a,c):(i=r[n]=o[n](a),i.c()),P(i,1),i.m(e,null))},i(a){s||(P(i),s=!0)},o(a){I(i),s=!1},d(a){a&&x(e),r[n].d()}}}function FI(t,e,n){let{skill:i}=e,{level:s}=e,{asItemDescription:o=!1}=e,{shift:r=!1}=e,l={1:"Requires no target",16:"Self cast",256:"on Allies",4096:"on Enemy"},a=(_,b=V&&V.player)=>{if(!b)return"?";let y=s4(_,b);return y%1===0?y:y.toFixed(1)},c={0:"Melee attack",1:"Magic attack",2:"Heal",4:"Buff",5:"Stackable buff",6:"Ranged missile",7:"Ranged effect",9:"Effect"},f=[],u,m={},g=_=>{if(V)return _.onCast&&v("on cast",_.onCast,V.player,s),_.onBlock&&v("on block",_.onBlock,m,V.player),_.onInterval&&v(`every ${_.intervalDuration.toFixed(1)}s`,_.onInterval,m,V.player,V.player),_.onPermanent&&v("permanently",()=>({id:_.onPermanent(V.player),mode:4}),V.player,s),_},v=(_,b,y,k,A)=>{let S=b(y,k,A);if(!S||S===!0)return;let F=Object.assign({},S);if(F.actiontype=_,F.parent||(F.parent=[]),F.parent.push(i),F.mode===4||F.mode===5){let M=bl.get(F.id);f.unshift(g({...F,...M}))}else if(i.id===F.id)i.parent||(F.parent=void 0),n(0,i={...i,...F});else{if(i.parent){let M=i.parent.find(D=>D.id==F.id);if(M){M.parent||(F.parent=void 0),Object.assign(M,F);return}}f.unshift(g(F))}};return t.$$set=_=>{"skill"in _&&n(0,i=_.skill),"level"in _&&n(1,s=_.level),"asItemDescription"in _&&n(2,o=_.asItemDescription),"shift"in _&&n(9,r=_.shift)},t.$$.update=()=>{t.$$.dirty[0]&539&&(n(4,m={stacks:1,level:s}),n(4,m.stacks=i.maxStacks?r?1:i.maxStacks:1,m),n(0,i.stacks=m.stacks,i),n(5,f=[]),i.parent||g(i),i.statsStatic&&(n(3,u=new ec),i.statsStatic(m,u)))},[i,s,o,u,m,f,l,a,c,r]}var pd=class extends xe{constructor(e){super(),Ce(this,e,FI,MI,Ue,{skill:0,level:1,asItemDescription:2,shift:9},null,[-1,-1])}},yl=pd;function CI(t){let e;return{c(){e=h("span")},m(n,i){w(n,e,i),e.innerHTML=t[0]},p(n,[i]){i&1&&(e.innerHTML=n[0])},i:ae,o:ae,d(n){n&&x(e)}}}function SI(t,e,n){let i,s,o;se(t,Yi,a=>n(4,o=a));let{amount:r}=e,{isPrice:l=!1}=e;return t.$$set=a=>{"amount"in a&&n(1,r=a.amount),"isPrice"in a&&n(2,l=a.isPrice)},t.$$.update=()=>{t.$$.dirty&22&&n(3,i=l&&r>o),t.$$.dirty&10&&n(0,s=L1(r,i))},[s,r,l,i,o]}var Fg=class extends xe{constructor(e){super(),Ce(this,e,SI,CI,yn,{amount:1,isPrice:2})}},xn=Fg;function AI(t){let e;return{c(){e=h("span")},m(n,i){w(n,e,i),e.innerHTML=t[0]},p(n,[i]){i&1&&(e.innerHTML=n[0])},i:ae,o:ae,d(n){n&&x(e)}}}function PI(t,e,n){let i,s,o;se(t,oa,a=>n(4,o=a));let{amount:r}=e,{isPrice:l=!1}=e;return t.$$set=a=>{"amount"in a&&n(1,r=a.amount),"isPrice"in a&&n(2,l=a.isPrice)},t.$$.update=()=>{t.$$.dirty&22&&n(3,i=l&&r>o),t.$$.dirty&10&&n(0,s=q1(r,i))},[s,r,l,i,o]}var Cg=class extends xe{constructor(e){super(),Ce(this,e,PI,AI,yn,{amount:1,isPrice:2})}},pr=Cg;function TI(t){let e,n,i,s,o,r;return{c(){e=h("span"),n=h("img"),s=h("span"),o=T(t[0]),p(n,"class","svgicon texticon"),lt(n.src,i="/data/ui/icons/gem.svg?v=8602459")||p(n,"src",i),p(s,"class",r=!t[1]||t[0]<t[2]?"textprimary":"textred")},m(l,a){w(l,e,a),d(e,n),d(e,s),d(s,o)},p(l,[a]){a&1&&G(o,l[0]),a&7&&r!==(r=!l[1]||l[0]<l[2]?"textprimary":"textred")&&p(s,"class",r)},i:ae,o:ae,d(l){l&&x(e)}}}function EI(t,e,n){let i;se(t,Bo,r=>n(2,i=r));let{amount:s}=e,{isPrice:o=!1}=e;return t.$$set=r=>{"amount"in r&&n(0,s=r.amount),"isPrice"in r&&n(1,o=r.isPrice)},[s,o,i]}var Sg=class extends xe{constructor(e){super(),Ce(this,e,EI,TI,yn,{amount:0,isPrice:1})}},dr=Sg;function cM(t,e,n){let i=t.slice();return i[10]=e[n],i}function fM(t,e,n){let i=t.slice();return i[13]=e[n],i}function uM(t,e,n){let i=t.slice();return i[13]=e[n],i}function mM(t,e,n){let i=t.slice();return i[18]=e[n],i}function pM(t,e,n){let i=t.slice();return i[10]=e[n],i}function dM(t){let e,n,i=t[0].gs+"",s,o;return{c(){e=h("span"),n=T("GS: "),s=T(i),o=We(),p(e,"class","textgreen")},m(r,l){w(r,e,l),d(e,n),d(e,s),w(r,o,l)},p(r,l){l&1&&i!==(i=r[0].gs+"")&&G(s,i)},d(r){r&&(x(e),x(o))}}}function hM(t){let e,n,i=t[0].dbid+"",s;return{c(){e=h("span"),n=T("ID: "),s=T(i),p(e,"class","textgrey")},m(o,r){w(o,e,r),d(e,n),d(e,s)},p(o,r){r&1&&i!==(i=o[0].dbid+"")&&G(s,i)},d(o){o&&x(e)}}}function II(t){let e,n=t[10][1].type=="bonus"?"+ ":"",i,s=Hn(t[10][0],t[10][1].value)+"",o,r,l=C.ui.stats.array[t[10][0]]+"",a,c,f,u=t[10][1].type=="bonus"&&t[2]&&gM(t);return{c(){e=h("div"),i=T(n),o=T(s),r=We(),a=T(l),c=We(),u&&u.c(),p(e,"class",f="text"+Ut(t[10][1].qual)[0]+" svelte-e3ao5j")},m(m,g){w(m,e,g),d(e,i),d(e,o),d(e,r),d(e,a),d(e,c),u&&u.m(e,null)},p(m,g){g&128&&n!==(n=m[10][1].type=="bonus"?"+ ":"")&&G(i,n),g&128&&s!==(s=Hn(m[10][0],m[10][1].value)+"")&&G(o,s),g&128&&l!==(l=C.ui.stats.array[m[10][0]]+"")&&G(a,l),m[10][1].type=="bonus"&&m[2]?u?u.p(m,g):(u=gM(m),u.c(),u.m(e,null)):u&&(u.d(1),u=null),g&128&&f!==(f="text"+Ut(m[10][1].qual)[0]+" svelte-e3ao5j")&&p(e,"class",f)},d(m){m&&x(e),u&&u.d()}}}function DI(t){let e,n,i=t[0].stats.get(10).value+"",s,o,r,l,a=t[0].stats.get(11).value+"",c,f,u,m,g=C.ui.stats.misc.damage+"",v,_;return{c(){e=h("div"),n=h("span"),s=T(i),r=T(" - "),l=h("span"),c=T(a),u=We(),m=h("span"),v=T(g),p(n,"class",o="text"+Ut(t[0].stats.get(10).qual)[0]+" svelte-e3ao5j"),p(l,"class",f="text"+Ut(t[0].stats.get(11).qual)[0]+" svelte-e3ao5j"),p(m,"class",_="text"+Ut(Math.min(t[0].stats.get(10).qual,t[0].stats.get(11).qual))[0]+" svelte-e3ao5j")},m(b,y){w(b,e,y),d(e,n),d(n,s),d(e,r),d(e,l),d(l,c),d(e,u),d(e,m),d(m,v)},p(b,y){y&1&&i!==(i=b[0].stats.get(10).value+"")&&G(s,i),y&1&&o!==(o="text"+Ut(b[0].stats.get(10).qual)[0]+" svelte-e3ao5j")&&p(n,"class",o),y&1&&a!==(a=b[0].stats.get(11).value+"")&&G(c,a),y&1&&f!==(f="text"+Ut(b[0].stats.get(11).qual)[0]+" svelte-e3ao5j")&&p(l,"class",f),y&1&&_!==(_="text"+Ut(Math.min(b[0].stats.get(10).qual,b[0].stats.get(11).qual))[0]+" svelte-e3ao5j")&&p(m,"class",_)},d(b){b&&x(e)}}}function gM(t){let e,n=Math.round(t[10][1].qual)+"",i,s;return{c(){e=h("span"),i=T(n),s=T("%")},m(o,r){w(o,e,r),d(e,i),d(e,s)},p(o,r){r&128&&n!==(n=Math.round(o[10][1].qual)+"")&&G(i,n)},d(o){o&&x(e)}}}function vM(t){let e,n;function i(r,l){return l&129&&(e=null),e==null&&(e=!!(r[10][0]==10&&r[0].stats.has(11))),e?DI:II}let s=i(t,-1),o=s(t);return{c(){o.c(),n=he()},m(r,l){o.m(r,l),w(r,n,l)},p(r,l){s===(s=i(r,l))&&o?o.p(r,l):(o.d(1),o=s(r),o&&(o.c(),o.m(n.parentNode,n)))},d(r){r&&x(n),o.d(r)}}}function _M(t){let e,n=me(t[0].logic.custom),i=[];for(let s=0;s<n.length;s+=1)i[s]=bM(mM(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=he()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o&1){n=me(s[0].logic.custom);let r;for(r=0;r<n.length;r+=1){let l=mM(s,n,r);i[r]?i[r].p(l,o):(i[r]=bM(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function bM(t){let e,n=t[18]+"",i;return{c(){e=h("span"),i=T(n),p(e,"class","textgreen")},m(s,o){w(s,e,o),d(e,i)},p(s,o){o&1&&n!==(n=s[18]+"")&&G(i,n)},d(s){s&&x(e)}}}function yM(t){let e,n=t[13][0]+"",i,s;return{c(){e=h("div"),i=T(n),p(e,"class",s=t[13][1]?"textgreen":"textred")},m(o,r){w(o,e,r),d(e,i)},p(o,r){r&1&&n!==(n=o[13][0]+"")&&G(i,n),r&1&&s!==(s=o[13][1]?"textgreen":"textred")&&p(e,"class",s)},d(o){o&&x(e)}}}function VI(t){let e,n,i,s=t[0].logic.bindOnPurchase&&kM(t),o=t[0].logic.bindOnUse&&xM(t),r=t[0].logic.bindOnMerchant&&wM(t);return{c(){s&&s.c(),e=he(),o&&o.c(),n=he(),r&&r.c(),i=he()},m(l,a){s&&s.m(l,a),w(l,e,a),o&&o.m(l,a),w(l,n,a),r&&r.m(l,a),w(l,i,a)},p(l,a){l[0].logic.bindOnPurchase?s?s.p(l,a):(s=kM(l),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null),l[0].logic.bindOnUse?o?o.p(l,a):(o=xM(l),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null),l[0].logic.bindOnMerchant?r?r.p(l,a):(r=wM(l),r.c(),r.m(i.parentNode,i)):r&&(r.d(1),r=null)},d(l){l&&(x(e),x(n),x(i)),s&&s.d(l),o&&o.d(l),r&&r.d(l)}}}function LI(t){let e,n=C.ui.inventory.bindlevel[t[0].bound]+"",i;return{c(){e=h("div"),i=T(n),p(e,"class","textgreen")},m(s,o){w(s,e,o),d(e,i)},p(s,o){o&1&&n!==(n=C.ui.inventory.bindlevel[s[0].bound]+"")&&G(i,n)},d(s){s&&x(e)}}}function kM(t){let e,n=C.ui.inventory.bindlevel[t[0].logic.bindOnPurchase]+"",i,s,o=C.ui.itemdescription.onpurchase+"",r;return{c(){e=h("div"),i=T(n),s=We(),r=T(o),p(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,i),d(e,s),d(e,r)},p(l,a){a&1&&n!==(n=C.ui.inventory.bindlevel[l[0].logic.bindOnPurchase]+"")&&G(i,n)},d(l){l&&x(e)}}}function xM(t){let e,n=C.ui.inventory.bindlevel[t[0].logic.bindOnUse]+"",i,s,o=C.ui.itemdescription.onuse+"",r;return{c(){e=h("div"),i=T(n),s=We(),r=T(o),p(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,i),d(e,s),d(e,r)},p(l,a){a&1&&n!==(n=C.ui.inventory.bindlevel[l[0].logic.bindOnUse]+"")&&G(i,n)},d(l){l&&x(e)}}}function wM(t){let e,n=C.ui.inventory.bindlevel[t[0].logic.bindOnMerchant]+"",i,s,o=C.ui.itemdescription.onsale+"",r;return{c(){e=h("div"),i=T(n),s=We(),r=T(o),p(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,i),d(e,s),d(e,r)},p(l,a){a&1&&n!==(n=C.ui.inventory.bindlevel[l[0].logic.bindOnMerchant]+"")&&G(i,n)},d(l){l&&x(e)}}}function MM(t){let e,n,i=t[0].medalValue()>0&&t[1],s,o=t[0].storeValue()>0&&t[1],r,l=!(t[0].storeValue()>0&&t[1])&&t[0].canBeSold(),a,c=t[1]&&FM(t),f=i&&SM(t),u=o&&AM(t),m=l&&PM(t);return{c(){e=h("div"),c&&c.c(),n=he(),f&&f.c(),s=he(),u&&u.c(),r=he(),m&&m.c(),p(e,"class","panel value pack svelte-e3ao5j")},m(g,v){w(g,e,v),c&&c.m(e,null),d(e,n),f&&f.m(e,null),d(e,s),u&&u.m(e,null),d(e,r),m&&m.m(e,null),a=!0},p(g,v){g[1]?c?c.p(g,v):(c=FM(g),c.c(),c.m(e,n)):c&&(c.d(1),c=null),v&3&&(i=g[0].medalValue()>0&&g[1]),i?f?(f.p(g,v),v&3&&P(f,1)):(f=SM(g),f.c(),P(f,1),f.m(e,s)):f&&(Ee(),I(f,1,1,()=>{f=null}),Ie()),v&3&&(o=g[0].storeValue()>0&&g[1]),o?u?(u.p(g,v),v&3&&P(u,1)):(u=AM(g),u.c(),P(u,1),u.m(e,r)):u&&(Ee(),I(u,1,1,()=>{u=null}),Ie()),v&3&&(l=!(g[0].storeValue()>0&&g[1])&&g[0].canBeSold()),l?m?(m.p(g,v),v&3&&P(m,1)):(m=PM(g),m.c(),P(m,1),m.m(e,null)):m&&(Ee(),I(m,1,1,()=>{m=null}),Ie())},i(g){a||(P(f),P(u),P(m),a=!0)},o(g){I(f),I(u),I(m),a=!1},d(g){g&&x(e),c&&c.d(),f&&f.d(),u&&u.d(),m&&m.d()}}}function FM(t){let e,n=me(t[0].buyReasons(V&&V.player)),i=[];for(let s=0;s<n.length;s+=1)i[s]=CM(fM(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=he()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);w(s,e,o)},p(s,o){if(o&1){n=me(s[0].buyReasons(V&&V.player));let r;for(r=0;r<n.length;r+=1){let l=fM(s,n,r);i[r]?i[r].p(l,o):(i[r]=CM(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function CM(t){let e,n=t[13][0]+"",i;return{c(){e=h("div"),p(e,"class",i=t[13][1]?"textgreen":"textred")},m(s,o){w(s,e,o),e.innerHTML=n},p(s,o){o&1&&n!==(n=s[13][0]+"")&&(e.innerHTML=n),o&1&&i!==(i=s[13][1]?"textgreen":"textred")&&p(e,"class",i)},d(s){s&&x(e)}}}function SM(t){let e,n,i;return n=new pr({props:{amount:t[0].medalValue(),isPrice:!0}}),{c(){e=h("div"),ne(n.$$.fragment)},m(s,o){w(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&1&&(r.amount=s[0].medalValue()),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&x(e),ee(n)}}}function AM(t){let e,n,i;return n=new dr({props:{amount:t[0].storeValue(),isPrice:!0}}),{c(){e=h("div"),ne(n.$$.fragment)},m(s,o){w(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&1&&(r.amount=s[0].storeValue()),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&x(e),ee(n)}}}function PM(t){let e,n,i;return n=new xn({props:{amount:t[0].goldValue(t[1]),isPrice:t[1]}}),{c(){e=h("div"),ne(n.$$.fragment)},m(s,o){w(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&3&&(r.amount=s[0].goldValue(s[1])),o&2&&(r.isPrice=s[1]),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&x(e),ee(n)}}}function qI(t){let e,n,i,s,o=[BI,zI],r=[];function l(a,c){return a[0].type=="book"?0:1}return e=l(t,-1),n=r[e]=o[e](t),{c(){n.c(),i=he()},m(a,c){r[e].m(a,c),w(a,i,c),s=!0},p(a,c){let f=e;e=l(a,c),e===f?r[e].p(a,c):(Ee(),I(r[f],1,1,()=>{r[f]=null}),Ie(),n=r[e],n?n.p(a,c):(n=r[e]=o[e](a),n.c()),P(n,1),n.m(i.parentNode,i))},i(a){s||(P(n),s=!0)},o(a){I(n),s=!1},d(a){a&&x(i),r[e].d(a)}}}function RI(t){let e,n,i=me(t[6]),s=[];for(let o=0;o<i.length;o+=1)s[o]=TM(cM(t,i,o));return{c(){e=h("div"),n=h("div"),n.textContent=`${C.ui.itemdescription.equipeffect}:`;for(let o=0;o<s.length;o+=1)s[o].c();p(n,"class","textgrey"),p(e,"class","pack svelte-e3ao5j")},m(o,r){w(o,e,r),d(e,n);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null)},p(o,r){if(r&64){i=me(o[6]);let l;for(l=0;l<i.length;l+=1){let a=cM(o,i,l);s[l]?s[l].p(a,r):(s[l]=TM(a),s[l].c(),s[l].m(e,null))}for(;l<s.length;l+=1)s[l].d(1);s.length=i.length}},i:ae,o:ae,d(o){o&&x(e),it(s,o)}}}function zI(t){let e,n=zh(t[0].type,t[0].tier)+"",i;return{c(){e=h("div"),i=T(n),p(e,"class","pack description svelte-e3ao5j")},m(s,o){w(s,e,o),d(e,i)},p(s,o){o&1&&n!==(n=zh(s[0].type,s[0].tier)+"")&&G(i,n)},i:ae,o:ae,d(s){s&&x(e)}}}function BI(t){let e,n;return e=new yl({props:{shift:t[2],level:t[0].logic.skilllevel+1,skill:Pt.get(t[0].logic.skillid),asItemDescription:!0}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&4&&(o.shift=i[2]),s&1&&(o.level=i[0].logic.skilllevel+1),s&1&&(o.skill=Pt.get(i[0].logic.skillid)),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function TM(t){let e,n=t[10][1]>0?"+":"",i,s=Hn(t[10][0],t[10][1])+"",o,r,l=C.ui.stats.array[t[10][0]]+"",a,c;return{c(){e=h("div"),i=T(n),o=T(s),r=We(),a=T(l),p(e,"class",c="text"+(t[10][1]>0?"green":"red"))},m(f,u){w(f,e,u),d(e,i),d(e,o),d(e,r),d(e,a)},p(f,u){u&64&&n!==(n=f[10][1]>0?"+":"")&&G(i,n),u&64&&s!==(s=Hn(f[10][0],f[10][1])+"")&&G(o,s),u&64&&l!==(l=C.ui.stats.array[f[10][0]]+"")&&G(a,l),u&64&&c!==(c="text"+(f[10][1]>0?"green":"red"))&&p(e,"class",c)},d(f){f&&x(e)}}}function EM(t){let e,n,i,s;return n=new dd({props:{item:t[5],comparison:!0}}),{c(){e=h("div"),ne(n.$$.fragment),p(e,"class",i="slotdescription border "+Ut(t[5].quality)[0]+" comparecontainer svelte-e3ao5j")},m(o,r){w(o,e,r),K(n,e,null),s=!0},p(o,r){let l={};r&32&&(l.item=o[5]),n.$set(l),(!s||r&32&&i!==(i="slotdescription border "+Ut(o[5].quality)[0]+" comparecontainer svelte-e3ao5j"))&&p(e,"class",i)},i(o){s||(P(n.$$.fragment,o),s=!0)},o(o){I(n.$$.fragment,o),s=!1},d(o){o&&x(e),ee(n)}}}function UI(t){let e,n,i,s=t[2]?"T"+(t[0].tier+1)+" ":"",o,r=tn(t[0].type,t[0].tier)+"",l,a,c=t[0].upgrade?" +"+t[0].upgrade:"",f,u,m,g=(t[0].stacks?"":Ut(t[0].quality)[1])+"",v,_,b=t[0].type+"",y,k,A,S=t[0].quality&&!t[0].stacks?t[0].quality+"%":"",F,M,D,R,E,L,z,q,j=t[3]&&(t[1]||t[0].canBeSold()),W,U,O,Z,ve,Fe=t[0].gs>0&&dM(t),_e=t[0].dbid&&hM(t),ce=me(t[7]),fe=[];for(let oe=0;oe<ce.length;oe+=1)fe[oe]=vM(pM(t,ce,oe));let ze=t[0].logic.custom!==void 0&&_M(t),Pe=me(t[0].equipReasons(V&&V.player)),Me=[];for(let oe=0;oe<Pe.length;oe+=1)Me[oe]=yM(uM(t,Pe,oe));function be(oe,$e){return oe[0].bound>0?LI:VI}let H=be(t,-1),pe=H(t),Be=j&&MM(t),Ge=[RI,qI],Xe=[];function Ye(oe,$e){return oe[5]?0:oe[4]?1:-1}~(U=Ye(t,-1))&&(O=Xe[U]=Ge[U](t));let ue=t[5]&&EM(t);return{c(){e=h("div"),n=h("div"),i=h("div"),o=T(s),l=T(r),a=h("span"),f=T(c),m=h("div"),v=T(g),_=We(),y=T(b),k=We(),A=h("span"),F=T(S),M=h("small"),Fe&&Fe.c(),D=he(),_e&&_e.c(),R=We(),E=h("div");for(let oe=0;oe<fe.length;oe+=1)fe[oe].c();L=he(),ze&&ze.c(),z=h("div");for(let oe=0;oe<Me.length;oe+=1)Me[oe].c();q=he(),pe.c(),Be&&Be.c(),W=he(),O&&O.c(),ue&&ue.c(),Z=he(),p(a,"class","textprimary"),p(i,"class",u="slottitle text"+Ut(t[0].quality)[0]+" svelte-e3ao5j"),p(m,"class","type textwhite svelte-e3ao5j"),p(n,"class","pack svelte-e3ao5j"),p(E,"class","pack svelte-e3ao5j"),p(z,"class","pack svelte-e3ao5j"),p(e,"class","container svelte-e3ao5j")},m(oe,$e){w(oe,e,$e),d(e,n),d(n,i),d(i,o),d(i,l),d(i,a),d(a,f),d(n,m),d(m,v),d(m,_),d(m,y),d(m,k),d(m,A),d(A,F),d(n,M),Fe&&Fe.m(M,null),d(M,D),_e&&_e.m(M,null),d(n,R),d(e,E);for(let J=0;J<fe.length;J+=1)fe[J]&&fe[J].m(E,null);d(E,L),ze&&ze.m(E,null),d(e,z);for(let J=0;J<Me.length;J+=1)Me[J]&&Me[J].m(z,null);d(z,q),pe.m(z,null),Be&&Be.m(e,null),d(e,W),~U&&Xe[U].m(e,null),ue&&ue.m(oe,$e),w(oe,Z,$e),ve=!0},p(oe,[$e]){if((!ve||$e&5)&&s!==(s=oe[2]?"T"+(oe[0].tier+1)+" ":"")&&G(o,s),(!ve||$e&1)&&r!==(r=tn(oe[0].type,oe[0].tier)+"")&&G(l,r),(!ve||$e&1)&&c!==(c=oe[0].upgrade?" +"+oe[0].upgrade:"")&&G(f,c),(!ve||$e&1&&u!==(u="slottitle text"+Ut(oe[0].quality)[0]+" svelte-e3ao5j"))&&p(i,"class",u),(!ve||$e&1)&&g!==(g=(oe[0].stacks?"":Ut(oe[0].quality)[1])+"")&&G(v,g),(!ve||$e&1)&&b!==(b=oe[0].type+"")&&G(y,b),(!ve||$e&1)&&S!==(S=oe[0].quality&&!oe[0].stacks?oe[0].quality+"%":"")&&G(F,S),oe[0].gs>0?Fe?Fe.p(oe,$e):(Fe=dM(oe),Fe.c(),Fe.m(M,D)):Fe&&(Fe.d(1),Fe=null),oe[0].dbid?_e?_e.p(oe,$e):(_e=hM(oe),_e.c(),_e.m(M,null)):_e&&(_e.d(1),_e=null),$e&133){ce=me(oe[7]);let Q;for(Q=0;Q<ce.length;Q+=1){let $=pM(oe,ce,Q);fe[Q]?fe[Q].p($,$e):(fe[Q]=vM($),fe[Q].c(),fe[Q].m(E,L))}for(;Q<fe.length;Q+=1)fe[Q].d(1);fe.length=ce.length}if(oe[0].logic.custom!==void 0?ze?ze.p(oe,$e):(ze=_M(oe),ze.c(),ze.m(E,null)):ze&&(ze.d(1),ze=null),$e&1){Pe=me(oe[0].equipReasons(V&&V.player));let Q;for(Q=0;Q<Pe.length;Q+=1){let $=uM(oe,Pe,Q);Me[Q]?Me[Q].p($,$e):(Me[Q]=yM($),Me[Q].c(),Me[Q].m(z,q))}for(;Q<Me.length;Q+=1)Me[Q].d(1);Me.length=Pe.length}H===(H=be(oe,$e))&&pe?pe.p(oe,$e):(pe.d(1),pe=H(oe),pe&&(pe.c(),pe.m(z,null))),$e&11&&(j=oe[3]&&(oe[1]||oe[0].canBeSold())),j?Be?(Be.p(oe,$e),$e&11&&P(Be,1)):(Be=MM(oe),Be.c(),P(Be,1),Be.m(e,W)):Be&&(Ee(),I(Be,1,1,()=>{Be=null}),Ie());let J=U;U=Ye(oe,$e),U===J?~U&&Xe[U].p(oe,$e):(O&&(Ee(),I(Xe[J],1,1,()=>{Xe[J]=null}),Ie()),~U?(O=Xe[U],O?O.p(oe,$e):(O=Xe[U]=Ge[U](oe),O.c()),P(O,1),O.m(e,null)):O=null),oe[5]?ue?(ue.p(oe,$e),$e&32&&P(ue,1)):(ue=EM(oe),ue.c(),P(ue,1),ue.m(Z.parentNode,Z)):ue&&(Ee(),I(ue,1,1,()=>{ue=null}),Ie())},i(oe){ve||(P(Be),P(O),P(ue),ve=!0)},o(oe){I(Be),I(O),I(ue),ve=!1},d(oe){oe&&(x(e),x(Z)),Fe&&Fe.d(),_e&&_e.d(),it(fe,oe),ze&&ze.d(),it(Me,oe),pe.d(),Be&&Be.d(),~U&&Xe[U].d(),ue&&ue.d(oe)}}}function OI(t,e,n){let i,{item:s}=e,{comparison:o=!1}=e,{isTrader:r=!1}=e,{shift:l=!1}=e,{showTradeInfo:a=!0}=e,{showLore:c=!0}=e,f,u,m=g=>{let v=new Map;return s.stats.forEach((_,b)=>{v.set(b,_.value)}),g.stats.forEach((_,b)=>{let y=(v.get(b)||0)-_.value;y!==0?v.set(b,y):v.delete(b)}),Array.from(v)};return t.$$set=g=>{"item"in g&&n(0,s=g.item),"comparison"in g&&n(8,o=g.comparison),"isTrader"in g&&n(1,r=g.isTrader),"shift"in g&&n(2,l=g.shift),"showTradeInfo"in g&&n(3,a=g.showTradeInfo),"showLore"in g&&n(4,c=g.showLore)},t.$$.update=()=>{if(t.$$.dirty&1&&n(7,i=s.stats.has(10)?Array.from(s.stats).filter(g=>g[0]!==11):Array.from(s.stats)),t.$$.dirty&261)if(V&&l&&!o){let g=s.getEquipSlot();if(g!==void 0&&V.player.inventory.slots.has(g)){let v=V.player.inventory.slots.get(g);n(5,f=v.type!==void 0?v:void 0),n(6,u=m(v))}}else n(5,f=void 0),n(6,u=void 0)},[s,r,l,a,c,f,u,i,o]}var dd=class extends xe{constructor(e){super(),Ce(this,e,OI,UI,Ue,{item:0,comparison:8,isTrader:1,shift:2,showTradeInfo:3,showLore:4})}},tc=dd;function $I(t){let e,n;return e=new yl({props:{level:t[2]||1,skill:{...Pt.get(t[7].id)}}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&4&&(o.level=i[2]||1),s[0]&128&&(o.skill={...Pt.get(i[7].id)}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function NI(t){let e,n;return e=new tc({props:{item:t[4]}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&16&&(o.item=i[4]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function jI(t){let e,n,i,s,o=[NI,$I],r=[];function l(a,c){return a[4]?0:a[7].id>=0?1:-1}return~(e=l(t,[-1,-1]))&&(n=r[e]=o[e](t)),{c(){n&&n.c(),i=he()},m(a,c){~e&&r[e].m(a,c),w(a,i,c),s=!0},p(a,c){let f=e;e=l(a,c),e===f?~e&&r[e].p(a,c):(n&&(Ee(),I(r[f],1,1,()=>{r[f]=null}),Ie()),~e?(n=r[e],n?n.p(a,c):(n=r[e]=o[e](a),n.c()),P(n,1),n.m(i.parentNode,i)):n=null)},i(a){s||(P(n),s=!0)},o(a){I(n),s=!1},d(a){a&&x(i),~e&&r[e].d(a)}}}function WI(t){let e,n;return e=new _l({props:{shift:t[1],describe:t[7].id>=0&&!t[7].item||t[4]!==void 0,descPos:"bottom:100%;left:50%;transform:translateX(-50%);",clickToUse:!0,status:t[11]?-1:t[5]!==void 0?t[5].status:0,id:"sk"+t[7].hotkey,data:t[7].id>=0||t[4]!==void 0?t[7]:void 0,auto:t[9],queued:t[10],meta:t[16],css:t[15],stacks:t[3],cd:t[13],img:t[14],remaining:t[12],key:t[7].hotkey,border:t[10]||t[8]?"auto":t[11]||t[9]||t[6]||t[13]?"grey":t[4]?Ut(t[4].quality)[0]:"white",$$slots:{default:[jI]},$$scope:{ctx:t}}}),e.$on("discard",t[25]),e.$on("move",t[26]),e.$on("use",t[17]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&2&&(o.shift=i[1]),s[0]&144&&(o.describe=i[7].id>=0&&!i[7].item||i[4]!==void 0),s[0]&2080&&(o.status=i[11]?-1:i[5]!==void 0?i[5].status:0),s[0]&128&&(o.id="sk"+i[7].hotkey),s[0]&144&&(o.data=i[7].id>=0||i[4]!==void 0?i[7]:void 0),s[0]&512&&(o.auto=i[9]),s[0]&1024&&(o.queued=i[10]),s[0]&65536&&(o.meta=i[16]),s[0]&32768&&(o.css=i[15]),s[0]&8&&(o.stacks=i[3]),s[0]&8192&&(o.cd=i[13]),s[0]&16384&&(o.img=i[14]),s[0]&4096&&(o.remaining=i[12]),s[0]&128&&(o.key=i[7].hotkey),s[0]&12112&&(o.border=i[10]||i[8]?"auto":i[11]||i[9]||i[6]||i[13]?"grey":i[4]?Ut(i[4].quality)[0]:"white"),s[0]&148|s[1]&8&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function GI(t,e,n){let i,s,o,r,l,a,c,f,u,m,g,v,_,b,y,k,A=ae,S=()=>(A(),A=as(L,fe=>n(7,k=fe)),L),F,M,D,R,E;se(t,dm,fe=>n(20,F=fe)),se(t,pm,fe=>n(21,M=fe)),se(t,Oo,fe=>n(22,D=fe)),se(t,la,fe=>n(23,R=fe)),se(t,Uo,fe=>n(24,E=fe)),t.$$.on_destroy.push(()=>A());let{skill:L}=e;S();let{skillslot:z}=e,{shift:q=!1}=e,j,W,U,O;Vc(()=>{if(k.hotkey!==j&&(W!==void 0&&Fe(),j=k.hotkey,j!==void 0)){O=nt[j],O==null&&(O=nt[j]={});let fe=un(j,O);W=fe.onPress(Z),U=fe.onRelease(ve)}});let Z=fe=>{if(V.player&&k.id>=0){if(k.item){let Pe=V.player.inventory.findFirstSlotOfType(k.item.type,k.item.tier);if(Pe!==void 0){let Me=V.player.inventory.slots.get(Pe);if(Me.bound<Me.logic.bindOnUse){Gt("error","Right-click and use the item in your inventory to bind it before using");return}Qe(L,k.info[0]=Pe,k)}else return}let ze=Pt.get(k.id);ze.envCast>0?mr>0?ou(0,0,0):ou(k.id,ze.range,ze.envCast):Si(Ft.clientPlayerSkill.packData({id:k.id,info:k.info})),fe.type==="keydown"&&n(8,u=!0),Mt(96)}},ve=()=>{n(8,u=!1)},Fe=()=>{O&&O.mappings&&(O.mappings=O.mappings.filter(fe=>fe!=j)),O&&O.press&&(O.press=O.press.filter(fe=>fe!=W)),O&&O.release&&(O.release=O.release.filter(fe=>fe!=U)),j=void 0,W=void 0,U=void 0};Tn(Fe);function _e(fe){ao.call(this,t,fe)}function ce(fe){ao.call(this,t,fe)}return t.$$set=fe=>{"skill"in fe&&S(n(0,L=fe.skill)),"skillslot"in fe&&n(18,z=fe.skillslot),"shift"in fe&&n(1,q=fe.shift)},t.$$.update=()=>{t.$$.dirty[0]&262272&&n(16,i={type:"skill",slot:z,skill:k}),t.$$.dirty[0]&128&&n(6,s=k.id<0),t.$$.dirty[0]&128&&n(19,o=k.item),t.$$.dirty[0]&16777408&&n(5,r=s?void 0:E[k.id]),t.$$.dirty[0]&128&&n(15,l=k.item?"slotitem":"slotskill"),t.$$.dirty[0]&8388736&&n(4,a=R&&k.item&&V.player?V.player.inventory.findFirstItemOfType(k.item.type,k.item.tier):void 0),t.$$.dirty[0]&524496&&n(14,c=s?void 0:o?a?Nf(a.type,a.tier,a.logic.class,Ga(a.quality)):Nf(o.type,o.tier,0,0):jf(k.id)),t.$$.dirty[0]&8912912&&n(3,f=a!==void 0&&a.stacks!==void 0?R[o.type+o.tier]||0:void 0),t.$$.dirty[0]&4194496&&n(2,m=!k.item&&!s&&D.has(k.id)?D.get(k.id):0),t.$$.dirty[0]&32&&n(13,g=r?r.cd:void 0),t.$$.dirty[0]&32&&n(12,v=r?r.remaining:void 0),t.$$.dirty[0]&156&&n(11,_=k.item&&(!a||f===0)||!k.item&&m===0),t.$$.dirty[0]&2097280&&n(10,b=M!==void 0&&M===k.id),t.$$.dirty[0]&1048704&&n(9,y=F!==void 0&&F===k.id)},n(8,u=!1),[L,q,m,f,a,r,s,k,u,y,b,_,v,g,c,l,i,Z,z,o,F,M,D,R,E,_e,ce]}var Ag=class extends xe{constructor(e){super(),Ce(this,e,GI,WI,Ue,{skill:0,skillslot:18,shift:1},null,[-1,-1])}},IM=Ag;function DM(t,e,n){let i=t.slice();return i[10]=e[n],i[12]=n,i}function VM(t){let e,n;return e=new IM({props:{skill:t[10],skillslot:t[12],shift:t[0]}}),e.$on("discard",t[3]),e.$on("move",t[2]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&1&&(o.shift=i[0]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function HI(t){let e,n,i=me(wi),s=[];for(let r=0;r<i.length;r+=1)s[r]=VM(DM(t,i,r));let o=r=>I(s[r],1,1,()=>{s[r]=null});return{c(){e=h("div");for(let r=0;r<s.length;r+=1)s[r].c();p(e,"id","skillbar"),p(e,"class","panel-black bar svelte-1v6qmvo")},m(r,l){w(r,e,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null);n=!0},p(r,[l]){if(l&13){i=me(wi);let a;for(a=0;a<i.length;a+=1){let c=DM(r,i,a);s[a]?(s[a].p(c,l),P(s[a],1)):(s[a]=VM(c),s[a].c(),P(s[a],1),s[a].m(e,null))}for(Ee(),a=i.length;a<s.length;a+=1)o(a);Ie()}},i(r){if(!n){for(let l=0;l<i.length;l+=1)P(s[l]);n=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)I(s[l]);n=!1},d(r){r&&x(e),it(s,r)}}}function YI(t,e,n){let i,s,o,r;se(t,En,g=>n(5,i=g)),se(t,bo,g=>n(6,s=g)),se(t,Kr,g=>n(7,o=g));let l=nt.shift.store;se(t,l,g=>n(0,r=g));let a=V.player.name,c=s[a];c||(c=Qe(bo,s[a]=[],s));for(let g=0;g<o;++g)if(s[a][g]===void 0){let v=Dp.get(V.player.class).startSkills[g];s[a].push({id:v!==void 0&&Pt.get(v).autoSkillbar?v:-1,type:0,info:[]}),g===4||g===5?(Qe(bo,s[a][g].id=100,s),Qe(bo,s[a][g].item={type:"misc",tier:g-4},s)):g===11&&Qe(bo,s[a][11].id=40,s)}for(let g=0;g<o;++g)wi[g]===void 0&&wi.push(ie({id:-1,type:0,info:[]}));s[a].forEach((g,v)=>{wi[v]&&(g.hotkey=re["kbSkillbar"+(v+1)],wi[v].set(g))}),wi.forEach((g,v)=>{g.subscribe(_=>{bo.update(b=>(b[a][v]=_,b))})});let f=g=>{let{from:v,to:_}=g.detail;v!==_&&(v.type=="item"?wi[_.slot].update(b=>(b.id=v.item.logic.useSkill,b.item={type:v.item.type,tier:v.item.tier},b)):v.type=="skill"&&(wi[_.slot].update(b=>(b.id=v.skill.id,b.item=v.skill.item,b)),v.slot!==void 0&&wi[v.slot].update(u)))},u=g=>(g.id=-1,g.item=void 0,g);return[r,l,f,g=>{wi[i.meta.slot].update(u)}]}var Pg=class extends xe{constructor(e){super(),Ce(this,e,YI,HI,yn,{})}},LM=Pg;function qM(t){let e,n;return e=new tc({props:{isTrader:t[6],item:t[10],shift:t[8]}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&64&&(o.isTrader=i[6]),s&1024&&(o.item=i[10]),s&256&&(o.shift=i[8]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function XI(t){let e,n,i=t[10]&&qM(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,o){s[10]?i?(i.p(s,o),o&1024&&P(i,1)):(i=qM(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function QI(t){let e,n;return e=new _l({props:{describe:t[10]!==void 0,shift:t[8],cd:t[11],id:t[7],hover:t[5],descPos:t[4],descRoot:t[3],pickable:t[1],status:t[9]?-1:0,meta:t[14],img:t[15],border:t[13],stacks:t[12],data:t[10],key:t[2],$$slots:{default:[XI]},$$scope:{ctx:t}}}),e.$on("discard",t[21]),e.$on("use",t[22]),e.$on("click",t[23]),e.$on("context",t[24]),e.$on("move",t[25]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,[s]){let o={};s&1024&&(o.describe=i[10]!==void 0),s&256&&(o.shift=i[8]),s&2048&&(o.cd=i[11]),s&128&&(o.id=i[7]),s&32&&(o.hover=i[5]),s&16&&(o.descPos=i[4]),s&8&&(o.descRoot=i[3]),s&2&&(o.pickable=i[1]),s&512&&(o.status=i[9]?-1:0),s&16384&&(o.meta=i[14]),s&32768&&(o.img=i[15]),s&8192&&(o.border=i[13]),s&4096&&(o.stacks=i[12]),s&1024&&(o.data=i[10]),s&4&&(o.key=i[2]),s&134219072&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function ZI(t,e,n){let i,s,o,r,l,a,c,f,u=ae,m=()=>(u(),u=as(v,O=>n(10,f=O)),v),g;se(t,Uo,O=>n(20,g=O)),t.$$.on_destroy.push(()=>u());let{item:v}=e;m();let{filter:_=""}=e,{invslot:b}=e,{pickable:y=!0}=e,{text:k}=e,{descRoot:A}=e,{descPos:S}=e,{hover:F}=e,{isTrader:M=!1}=e,{clearOnMove:D=!1}=e,{id:R=""}=e,{shift:E=!1}=e,L=O=>O===!0||f.moving?!0:!(!O||f.type.includes(O)||f.logic.level>O||C.items[f.type][f.type==="book"?f.logic.skillid:f.tier].name.toLowerCase().includes(O));function z(O){ao.call(this,t,O)}function q(O){ao.call(this,t,O)}function j(O){ao.call(this,t,O)}function W(O){ao.call(this,t,O)}function U(O){ao.call(this,t,O)}return t.$$set=O=>{"item"in O&&m(n(0,v=O.item)),"filter"in O&&n(16,_=O.filter),"invslot"in O&&n(17,b=O.invslot),"pickable"in O&&n(1,y=O.pickable),"text"in O&&n(2,k=O.text),"descRoot"in O&&n(3,A=O.descRoot),"descPos"in O&&n(4,S=O.descPos),"hover"in O&&n(5,F=O.hover),"isTrader"in O&&n(6,M=O.isTrader),"clearOnMove"in O&&n(18,D=O.clearOnMove),"id"in O&&n(7,R=O.id),"shift"in O&&n(8,E=O.shift)},t.$$.update=()=>{t.$$.dirty&132096&&n(15,i=f?Nf(f.type,f.tier,f.logic?f.logic.class:0,Ga(f.quality)):b>100?$k(b):void 0),t.$$.dirty&394241&&n(14,s={type:"item",slot:b,item:f,store:D?v:void 0}),t.$$.dirty&66624&&n(9,o=f&&(M?!1:L(_))),t.$$.dirty&1536&&n(13,r=f?Ut(f.quality)[0]+(o?" grey":""):"grey"),t.$$.dirty&1024&&n(12,l=f&&(f.upgrade?"+"+f.upgrade:f.stacks)),t.$$.dirty&1049600&&n(19,a=f&&f.logic.useSkill?g[f.logic.useSkill]:void 0),t.$$.dirty&524288&&n(11,c=a?a.cd:void 0)},[v,y,k,A,S,F,M,R,E,o,f,c,l,r,s,i,_,b,D,a,g,z,q,j,W,U]}var Tg=class extends xe{constructor(e){super(),Ce(this,e,ZI,QI,Ue,{item:0,filter:16,invslot:17,pickable:1,text:2,descRoot:3,descPos:4,hover:5,isTrader:6,clearOnMove:18,id:7,shift:8})}},bi=Tg;function RM(t,e,n){let i=t.slice();return i[19]=e[n],i[21]=n,i}function zM(t){let e,n;return e=new jt({props:{zindex:7,title:C.ui.inventory.name,icon:"bag",$$slots:{default:[JI]},$$scope:{ctx:t}}}),e.$on("close",t[14]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&4194555&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function BM(t){let e,n;return e=new bi({props:{id:"bag"+t[21],item:t[19],invslot:t[21],filter:t[0].toLowerCase(),shift:t[4]||t[5]}}),e.$on("use",t[12]),e.$on("context",t[11]),e.$on("move",t[10]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&2&&(o.item=i[19]),s&1&&(o.filter=i[0].toLowerCase()),s&48&&(o.shift=i[4]||i[5]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function JI(t){let e,n,i,s,o,r,l,a,c,f,u=me(t[1].filter(UM)),m=[];for(let v=0;v<u.length;v+=1)m[v]=BM(RM(t,u,v));let g=v=>I(m[v],1,1,()=>{m[v]=null});return o=new xn({props:{amount:t[6]}}),l=new dr({props:{amount:t[7]}}),{c(){e=h("input"),i=h("div");for(let v=0;v<m.length;v+=1)m[v].c();s=h("div"),ne(o.$$.fragment),r=h("a"),ne(l.$$.fragment),p(e,"class","filter svelte-ha50yv"),p(e,"type","text"),p(e,"placeholder",n=C.ui.filter),p(i,"class","slotcontainer svelte-ha50yv"),qe(i,"grid-template-columns","repeat("+t[3]+", auto)"),p(s,"class","panel-black gold svelte-ha50yv"),p(r,"class","panel-black gold svelte-ha50yv"),qe(r,"margin-right","3px"),p(r,"target","_blank"),p(r,"href","/store")},m(v,_){w(v,e,_),Ne(e,t[0]),w(v,i,_);for(let b=0;b<m.length;b+=1)m[b]&&m[b].m(i,null);w(v,s,_),K(o,s,null),w(v,r,_),K(l,r,null),a=!0,c||(f=Y(e,"input",t[13]),c=!0)},p(v,_){if(_&1&&e.value!==v[0]&&Ne(e,v[0]),_&7219){u=me(v[1].filter(UM));let k;for(k=0;k<u.length;k+=1){let A=RM(v,u,k);m[k]?(m[k].p(A,_),P(m[k],1)):(m[k]=BM(A),m[k].c(),P(m[k],1),m[k].m(i,null))}for(Ee(),k=u.length;k<m.length;k+=1)g(k);Ie()}(!a||_&8)&&qe(i,"grid-template-columns","repeat("+v[3]+", auto)");let b={};_&64&&(b.amount=v[6]),o.$set(b);let y={};_&128&&(y.amount=v[7]),l.$set(y)},i(v){if(!a){for(let _=0;_<u.length;_+=1)P(m[_]);P(o.$$.fragment,v),P(l.$$.fragment,v),a=!0}},o(v){m=m.filter(Boolean);for(let _=0;_<m.length;_+=1)I(m[_]);I(o.$$.fragment,v),I(l.$$.fragment,v),a=!1},d(v){v&&(x(e),x(i),x(s),x(r)),it(m,v),ee(o),ee(l),c=!1,f()}}}function KI(t){let e,n,i=t[2]&&zM(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[2]?i?(i.p(s,o),o&4&&P(i,1)):(i=zM(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}var UM=(t,e)=>e<101;function eD(t,e,n){let i,s,o,r,l,a,c,f,u,m,g;se(t,Xi,M=>n(15,i=M)),se(t,cs,M=>n(16,s=M)),se(t,Li,M=>n(17,o=M)),se(t,En,M=>n(18,r=M)),se(t,ra,M=>n(1,l=M)),se(t,po,M=>n(2,a=M)),se(t,Yr,M=>n(3,c=M)),se(t,Yi,M=>n(6,m=M)),se(t,Bo,M=>n(7,g=M));let v="",_=nt.shift.store;se(t,_,M=>n(4,f=M));let b=nt.ctrl.store;se(t,b,M=>n(5,u=M));let y=M=>{let{from:D,to:R}=M.detail;if(D!==R&&D.type=="item"&&D.slot!==void 0&&R.slot!==void 0&&D.slot!==R.slot){if(xt("itemmove",`${D.slot} ${R.slot}`),D.slot>=101)return;D.item.stacks&&(D.item.stacks=""),D.item.moving=!0,R.item?(R.item.stacks&&(R.item.stacks=""),l[D.slot].set(R.item),R.item.moving=!0):l[D.slot]&&l[D.slot].set(void 0),l[R.slot].set(D.item)}},k=M=>{if(!M.detail.item||r)return;let D=[];if(o&&D.push(Jt.itemstash(M.detail.slot)),M.detail.item.canEquip(V.player)){let R=M.detail.item.getBestEquipslot(V.player.inventory);R!==void 0&&D.push(Jt.itemmove(M.detail.slot,R)),M.detail.item.logic.useSkill&&D.push(Jt.itemuse(M.detail.slot,M.detail.item.logic.useSkill,M.detail.item.bound,M.detail.item.logic.bindOnUse))}i&&M.detail.item.canBeSold()&&D.push(Jt.itemsell(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier)),M.detail.item.stacks>1&&(D.push(Jt.itemsplithalf(M.detail.slot)),D.push(Jt.itemsplitone(M.detail.slot))),D.push(Jt.itemcopyid(M.detail.item.dbid)),D.push({name:"Link in chat",fun:R=>Vi.update(E=>E+`>${M.detail.item.dbid}`)}),M.detail.item.canBeDropped()&&D.push(Jt.itemdrop(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier)),bn.set({x:M.detail.e.pageX-M.detail.e.layerX,y:M.detail.e.pageY+(46-M.detail.e.layerY),opts:D})},A=M=>{M.detail.item&&(o?xt("itemstash",`${M.detail.slot}`):s?(fs.set(M.detail.item),M.detail.item.type&&Mt(zi[M.detail.item.type].sound)):i&&M.detail.item.canBeSold()?Hf(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier):M.detail.item.canBeDropped()&&D1(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier))};function S(){v=this.value,n(0,v)}return[v,l,a,c,f,u,m,g,_,b,y,k,A,S,M=>Qe(po,a=!1,a)]}var Eg=class extends xe{constructor(e){super(),Ce(this,e,eD,KI,Ue,{})}},OM=Eg;var Dg={};Qn(Dg,{add:()=>hd,init:()=>$M,onWorldEnter:()=>tD,tick:()=>nD,values:()=>is});var is=new Map,Ig=new kt(0,.5),$M=()=>{is.clear(),Ig.reset(0)},tD=$M,nD=t=>{if(re.dpsmeterOpen&&Ig.done(V.time))if(Ig.reset(V.time),is.forEach((e,n)=>{if(e.ooc){V.time-e.start>5&&is.delete(n);return}!V.entity(e.id)||V.time-e.last>5?(e.ooc=!0,e.start=V.time):e.dps=Math.ceil(e.amount/Math.max(5,V.time-e.start))}),re.dpsmeterTarget){let e=is.get(re.dpsmeterTarget);e?Nc.set(Array.from(e.skills).sort((n,i)=>i[1].amount-n[1].amount).map(n=>(n[1].dps=Math.ceil(n[1].amount/Math.max(5,V.time-n[1].start)),n)).slice(0,10)):Zr.set(0)}else Nc.set(Array.from(is).sort((e,n)=>n[1].amount-e[1].amount).slice(0,10))},hd=(t,e,n)=>{if(t.name===void 0||!re.dpsmeterOpen||t.type!==0||re.dpsmeterParty&&(V.player.party===0&&t!==V.player||t.party!==V.player.party))return;let i;is.has(t.name)?i=is.get(t.name):(is.set(t.name,i={}),i.amount=0,i.start=0,i.class=t.class,i.dps=0,i.id=t.id,i.ooc=!0,i.skills=new Map),i.ooc?(i.start=V.time,i.ooc=!1,i.amount=e):i.amount+=e;let s=C.items.book[n]?C.items.book[n].name:"Unknown";i.skills.has(s)||i.skills.set(s,{id:n,class:t.class,amount:0,start:V.time});let o=i.skills.get(s);o.amount+=e,i.last=V.time};function NM(t,e,n){let i=t.slice();return i[11]=e[n],i[13]=n,i}function jM(t){let e,n;return e=new jt({props:{origin:"right bottom",title:t[5][t[1]],icon:"trophy",$$slots:{default:[iD]},$$scope:{ctx:t}}}),e.$on("close",t[10]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&2&&(o.title=i[5][i[1]]),s&16414&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function WM(t,e){let n,i,s,o,r;i=new vi({props:{size:"0.9em",fract:Math.round(100*e[11][1].amount/e[2][0][1].amount),barcol:"bgc"+e[11][1].class,left:`${e[13]+1}. ${e[11][0]}`,right:`${ii(e[11][1].amount)} (${ht(e[11][1].dps)})`}});function l(...a){return e[7](e[11],...a)}return{key:t,first:null,c(){n=h("div"),ne(i.$$.fragment),this.first=n},m(a,c){w(a,n,c),K(i,n,null),s=!0,o||(r=Y(n,"click",l),o=!0)},p(a,c){e=a;let f={};c&4&&(f.fract=Math.round(100*e[11][1].amount/e[2][0][1].amount)),c&4&&(f.barcol="bgc"+e[11][1].class),c&4&&(f.left=`${e[13]+1}. ${e[11][0]}`),c&4&&(f.right=`${ii(e[11][1].amount)} (${ht(e[11][1].dps)})`),i.$set(f)},i(a){s||(P(i.$$.fragment,a),s=!0)},o(a){I(i.$$.fragment,a),s=!1},d(a){a&&x(n),ee(i),o=!1,r()}}}function iD(t){let e,n=[],i=new Map,s,o,r=t[5][t[1]]+"",l,a,c,f,u,m,g,v,_=me(t[2]),b=y=>y[11][1].id;for(let y=0;y<_.length;y+=1){let k=NM(t,_,y),A=b(k);i.set(A,n[y]=WM(A,k))}return{c(){e=h("div");for(let y=0;y<n.length;y+=1)n[y].c();s=h("div"),o=h("div"),l=T(r),a=h("div"),c=T("Party"),u=h("div"),u.textContent=`${C.ui.reset}`,p(e,"class","wrapper svelte-hjyujf"),p(o,"class","btn grey"),p(a,"class",f="btn "+(t[4]?"grey active":"black textgrey")),p(u,"class","btn grey"),p(s,"class","grid buttons marg-top svelte-hjyujf"),qe(s,"grid-template-columns","2fr 1fr 1fr")},m(y,k){w(y,e,k);for(let A=0;A<n.length;A+=1)n[A]&&n[A].m(e,null);w(y,s,k),d(s,o),d(o,l),d(s,a),d(a,c),d(s,u),m=!0,g||(v=[Y(o,"click",t[6]),Y(a,"click",t[8]),Y(u,"click",t[9])],g=!0)},p(y,k){k&12&&(_=me(y[2]),Ee(),n=ui(n,k,b,1,y,_,i,e,Di,WM,null,NM),Ie()),(!m||k&2)&&r!==(r=y[5][y[1]]+"")&&G(l,r),(!m||k&16&&f!==(f="btn "+(y[4]?"grey active":"black textgrey")))&&p(a,"class",f)},i(y){if(!m){for(let k=0;k<_.length;k+=1)P(n[k]);m=!0}},o(y){for(let k=0;k<n.length;k+=1)I(n[k]);m=!1},d(y){y&&(x(e),x(s));for(let k=0;k<n.length;k+=1)n[k].d();g=!1,at(v)}}}function sD(t){let e,n,i=t[0]&&jM(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=jM(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function oD(t,e,n){let i,s,o,r,l;se(t,Qr,v=>n(0,i=v)),se(t,lf,v=>n(1,s=v)),se(t,Nc,v=>n(2,o=v)),se(t,Zr,v=>n(3,r=v)),se(t,rf,v=>n(4,l=v));let a=[C.ui.stats.misc.damage,C.ui.stats.misc.healing];return[i,s,o,r,l,a,v=>{bn.set({x:v.pageX,y:v.pageY-50,opts:a.map((_,b)=>({name:_,fun:()=>{lf.set(b),is.clear()}}))})},(v,_)=>{Qe(Zr,r=r?0:v[0],r)},v=>Qe(rf,l=!l,l),v=>is.clear(),v=>Qe(Qr,i=!1,i)]}var Vg=class extends xe{constructor(e){super(),Ce(this,e,oD,sD,Ue,{})}},GM=Vg;function HM(t){let e,n=t[0].area+"",i,s,o,r;return{c(){e=h("p"),i=T(n),o=We(),p(e,"class","text location textgreen svelte-dujqu3")},m(l,a){w(l,e,a),d(e,i),w(l,o,a),r=!0},p(l,a){(!r||a&1)&&n!==(n=l[0].area+"")&&G(i,n)},i(l){r||(l&&_n(()=>{r&&(s||(s=yh(e,xm,{},!0)),s.run(1))}),r=!0)},o(l){l&&(s||(s=yh(e,xm,{},!1)),s.run(0)),r=!1},d(l){l&&(x(e),x(o)),l&&s&&s.end()}}}function YM(t){let e,n=t[0].error+"",i,s,o;return{c(){e=h("p"),i=T(n),p(e,"class","text error textred svelte-dujqu3")},m(r,l){w(r,e,l),d(e,i),o=!0},p(r,l){(!o||l&1)&&n!==(n=r[0].error+"")&&G(i,n)},i(r){o||(s&&s.end(1),o=!0)},o(r){r&&(s=l_(e,xm,{})),o=!1},d(r){r&&x(e),r&&s&&s.end()}}}function rD(t){let e,n,i=t[0].area&&HM(t),s=t[0].error&&YM(t);return{c(){e=h("div"),i&&i.c(),n=he(),s&&s.c(),p(e,"class","l-ui")},m(o,r){w(o,e,r),i&&i.m(e,null),d(e,n),s&&s.m(e,null)},p(o,[r]){o[0].area?i?(i.p(o,r),r&1&&P(i,1)):(i=HM(o),i.c(),P(i,1),i.m(e,n)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie()),o[0].error?s?(s.p(o,r),r&1&&P(s,1)):(s=YM(o),s.c(),P(s,1),s.m(e,null)):s&&(Ee(),I(s,1,1,()=>{s=null}),Ie())},i(o){P(i),P(s)},o(o){I(i),I(s)},d(o){o&&x(e),i&&i.d(),s&&s.d()}}}function lD(t,e,n){let i={},s={};return Er.subscribe(o=>{n(0,i[o.type]=o.text,i),s[o.type]&&clearTimeout(s[o.type]),s[o.type]=setTimeout(()=>{n(0,i[o.type]=void 0,i)},o.time||1e3)}),[i]}var Lg=class extends xe{constructor(e){super(),Ce(this,e,lD,rD,Ue,{})}},XM=Lg;function QM(t,e,n){let i=t.slice();return i[3]=e[n],i}function ZM(t){let e,n;return e=new jt({props:{origin:"center",zindex:10,title:C.ui.headers.request,close:!1,$$slots:{default:[aD]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&65&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function JM(t){let e,n=t[3].text+"",i,s,o=(t[3].unavailable||"")+"",r,l,a=(t[3].additional||"")+"",c,f,u,m;function g(){return t[2](t[3])}return{c(){e=h("div"),i=T(n),s=We(),r=T(o),l=We(),c=T(a),p(e,"class",f="choice "+(t[3].unavailable?"unavailable textgrey":"")+" svelte-1uywqr8")},m(v,_){w(v,e,_),d(e,i),d(e,s),d(e,r),d(e,l),d(e,c),u||(m=Y(e,"click",g),u=!0)},p(v,_){t=v,_&1&&n!==(n=t[3].text+"")&&G(i,n),_&1&&o!==(o=(t[3].unavailable||"")+"")&&G(r,o),_&1&&a!==(a=(t[3].additional||"")+"")&&G(c,a),_&1&&f!==(f="choice "+(t[3].unavailable?"unavailable textgrey":"")+" svelte-1uywqr8")&&p(e,"class",f)},d(v){v&&x(e),u=!1,m()}}}function aD(t){let e,n,i=t[0][0].title+"",s,o,r=t[0][0].text+"",l=me(t[0][0].choices),a=[];for(let c=0;c<l.length;c+=1)a[c]=JM(QM(t,l,c));return{c(){e=h("div"),n=h("h3"),s=T(i),o=h("p");for(let c=0;c<a.length;c+=1)a[c].c();p(n,"class","textprimary"),p(e,"class","container svelte-1uywqr8")},m(c,f){w(c,e,f),d(e,n),d(n,s),d(e,o),o.innerHTML=r;for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(e,null)},p(c,f){if(f&1&&i!==(i=c[0][0].title+"")&&G(s,i),f&1&&r!==(r=c[0][0].text+"")&&(o.innerHTML=r),f&3){l=me(c[0][0].choices);let u;for(u=0;u<l.length;u+=1){let m=QM(c,l,u);a[u]?a[u].p(m,f):(a[u]=JM(m),a[u].c(),a[u].m(e,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=l.length}},d(c){c&&x(e),it(a,c)}}}function cD(t){let e,n,i=t[0].length&&ZM(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[0].length?i?(i.p(s,o),o&1&&P(i,1)):(i=ZM(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function fD(t,e,n){let i;se(t,co,r=>n(0,i=r));let s=async r=>{r&&await r(),Jh()};return[i,s,r=>{s(r.fun)}]}var qg=class extends xe{constructor(e){super(),Ce(this,e,fD,cD,Ue,{})}},KM=qg;function e6(t){let e,n,i=t[0][0].text+"",s,o,r=t[0][0].icon&&t6(t);return{c(){e=h("div"),r&&r.c(),n=h("div"),p(e,"class","notification panel-black border grey svelte-9nlpzp")},m(l,a){w(l,e,a),r&&r.m(e,null),d(e,n),n.innerHTML=i,s||(o=Y(e,"click",t[2]),s=!0)},p(l,a){l[0][0].icon?r?r.p(l,a):(r=t6(l),r.c(),r.m(e,n)):r&&(r.d(1),r=null),a&1&&i!==(i=l[0][0].text+"")&&(n.innerHTML=i)},d(l){l&&x(e),r&&r.d(),s=!1,o()}}}function t6(t){let e,n,i;return{c(){e=h("img"),p(e,"class",n="icon "+t[0][0].css+" svelte-9nlpzp"),lt(e.src,i="/data/ui/"+t[0][0].icon)||p(e,"src",i)},m(s,o){w(s,e,o)},p(s,o){o&1&&n!==(n="icon "+s[0][0].css+" svelte-9nlpzp")&&p(e,"class",n),o&1&&!lt(e.src,i="/data/ui/"+s[0][0].icon)&&p(e,"src",i)},d(s){s&&x(e)}}}function uD(t){let e,n=t[0].length&&!t[1]&&e6(t);return{c(){n&&n.c(),e=he()},m(i,s){n&&n.m(i,s),w(i,e,s)},p(i,[s]){i[0].length&&!i[1]?n?n.p(i,s):(n=e6(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(i){i&&x(e),n&&n.d(i)}}}function mD(t,e,n){let i,s;return se(t,Rc,r=>n(0,i=r)),se(t,xi,r=>n(1,s=r)),[i,s,()=>{Rc.update(r=>(r.shift(),r))}]}var Rg=class extends xe{constructor(e){super(),Ce(this,e,mD,uD,Ue,{})}},n6=Rg;function i6(t,e,n){let i=t.slice();return i[5]=e[n],i}function s6(t){let e,n;return{c(){e=h("div"),n=T(t[0]),p(e,"class","btn border grey")},m(i,s){w(i,e,s),d(e,n)},p(i,s){s&1&&G(n,i[0])},d(i){i&&x(e)}}}function o6(t){let e,n,i,s,o,r;function l(...c){return t[2](t[5],...c)}function a(...c){return t[4](t[5],...c)}return{c(){e=h("div"),n=h("img"),p(n,"class","svgicon"),lt(n.src,i="/data/ui/icons/"+t[5].img+".svg?v=8602459")||p(n,"src",i),p(e,"id",s="sys"+t[5].img),p(e,"class","btn border black")},m(c,f){w(c,e,f),d(e,n),o||(r=[Y(e,"mouseenter",l),Y(e,"mouseleave",t[3]),Y(e,"click",a)],o=!0)},p(c,f){t=c},d(c){c&&x(e),o=!1,at(r)}}}function pD(t){let e,n,i=t[0]!==""&&s6(t),s=me(t[1]),o=[];for(let r=0;r<s.length;r+=1)o[r]=o6(i6(t,s,r));return{c(){e=h("div"),i&&i.c(),n=he();for(let r=0;r<o.length;r+=1)o[r].c();p(e,"class","btnbar svelte-133q4bd")},m(r,l){w(r,e,l),i&&i.m(e,null),d(e,n);for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(e,null)},p(r,[l]){if(r[0]!==""?i?i.p(r,l):(i=s6(r),i.c(),i.m(e,n)):i&&(i.d(1),i=null),l&3){s=me(r[1]);let a;for(a=0;a<s.length;a+=1){let c=i6(r,s,a);o[a]?o[a].p(c,l):(o[a]=o6(c),o[a].c(),o[a].m(e,null))}for(;a<o.length;a+=1)o[a].d(1);o.length=s.length}},i:ae,o:ae,d(r){r&&x(e),i&&i.d(),it(o,r)}}}function dD(t,e,n){let i=[{img:"gem",desc:C.ui.elixir.subscription,store:qi},{img:"char",desc:C.ui.headers.character,store:_o},{img:"book",desc:C.ui.headers.skills,store:ho},{img:"bag",desc:C.ui.inventory.name,store:po},{img:"pvp",desc:C.ui.headers.pvp,store:vo},{img:"clan",desc:C.ui.clan.heading,store:go},{img:"trophy",desc:C.ui.headers.dpsMeter,store:Qr},{img:"cog",desc:C.ui.settings.name,store:Xr},{img:"fullscreen",desc:C.ui.headers.fullscreen,fun:async()=>{"keyboard"in navigator&&"lock"in navigator.keyboard&&await navigator.keyboard.lock(["Escape"]),document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}},{img:"back",desc:C.ui.headers.menuReturn,fun:()=>{document.location.href="/"}}],s="";return[s,i,(a,c)=>n(0,s=a.desc),a=>n(0,s=""),(a,c)=>{a.fun?a.fun():a.store.update(f=>!f)}]}var zg=class extends xe{constructor(e){super(),Ce(this,e,dD,pD,Ue,{})}},r6=zg;function hD(t){let e,n,i,s;return{c(){e=h("div"),p(e,"class",n="btn checkbox "+(t[2]?"active":""))},m(o,r){w(o,e,r),i||(s=Y(e,"click",t[3]),i=!0)},p(o,[r]){r&4&&n!==(n="btn checkbox "+(o[2]?"active":""))&&p(e,"class",n)},i:ae,o:ae,d(o){o&&x(e),i=!1,s()}}}function gD(t,e,n){let i,s=ae,o=()=>(s(),s=as(r,c=>n(2,i=c)),r);t.$$.on_destroy.push(()=>s());let{store:r}=e;o();let{cb:l}=e,a=c=>{Qe(r,i=!i,i),l&&l(i)};return t.$$set=c=>{"store"in c&&o(n(0,r=c.store)),"cb"in c&&n(1,l=c.cb)},[r,l,i,a]}var Bg=class extends xe{constructor(e){super(),Ce(this,e,gD,hD,Ue,{store:0,cb:1})}},Ot=Bg;function l6(t,e,n){let i=t.slice();return i[76]=e[n],i[78]=n,i}function a6(t,e,n){let i=t.slice();return i[73]=e[n],i}function c6(t,e,n){let i=t.slice();return i[70]=e[n],i[71]=e,i[72]=n,i}function f6(t,e,n){let i=t.slice();return i[79]=e[n],i}function u6(t){let e,n;return e=new jt({props:{zindex:9,title:C.ui.settings.name,origin:"center",icon:"cog",$$slots:{default:[xD]},$$scope:{ctx:t}}}),e.$on("close",t[68]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&2147483626|s[1]&1|s[2]&1048576&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function m6(t){let e,n=t[79].name+"",i,s,o,r;function l(...a){return t[36](t[79],...a)}return{c(){e=h("div"),i=T(n),p(e,"class",s="choice "+(t[79]==t[1]?"active":""))},m(a,c){w(a,e,c),d(e,i),o||(r=Y(e,"click",l),o=!0)},p(a,c){t=a,c[0]&2&&s!==(s="choice "+(t[79]==t[1]?"active":""))&&p(e,"class",s)},d(a){a&&x(e),o=!1,r()}}}function vD(t){let e,n,i,s,o,r;n=new Ot({props:{store:ep}});let l=me(C.ui.chat.types),a=[];for(let c=0;c<l.length;c+=1)a[c]=p6(l6(t,l,c));return{c(){e=h("div"),e.textContent=`${C.ui.settings.chatbubbles}`,ne(n.$$.fragment),i=h("div"),i.textContent=`${C.ui.settings.combatlog}`,s=h("div");for(let c=0;c<a.length;c+=1)a[c].c();o=he(),p(i,"class","textprimary")},m(c,f){w(c,e,f),K(n,c,f),w(c,i,f),w(c,s,f);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(c,f);w(c,o,f),r=!0},p(c,f){if(f[1]&1){l=me(C.ui.chat.types);let u;for(u=0;u<l.length;u+=1){let m=l6(c,l,u);a[u]?a[u].p(m,f):(a[u]=p6(m),a[u].c(),a[u].m(o.parentNode,o))}for(;u<a.length;u+=1)a[u].d(1);a.length=l.length}},i(c){r||(P(n.$$.fragment,c),r=!0)},o(c){I(n.$$.fragment,c),r=!1},d(c){c&&(x(e),x(i),x(s),x(o)),ee(n,c),it(a,c)}}}function _D(t){let e,n=C.ui.settings.language+"",i,s,o,r,l,a,c,f,u,m,g,v,_,b,y,k,A,S,F,M,D,R,E,L,z,q,j,W,U,O,Z,ve,Fe,_e,ce,fe,ze,Pe,Me,be,H,pe,Be=C.ui.settings.qualitymin+"",Ge,Xe,Ye,ue,oe,$e,J,Q=C.ui.settings.excludedrops+"",$,le,je,Ve,ke,Re,Oe,pt,wt,Je,Et,ye,Ke,yt,St,Te,ft,$t=C.ui.settings.skillcdtext+"",Le,Ct,Lt,He,et,Se,ot,Ze,ut,wn=C.ui.settings.flashinterval+"",Ss,li,Ii,dt=t[22].toFixed(1)+"",qt,As,jn,ai,wc=C.ui.settings.flashduration+"",Ar,Do,Ps,pn=t[23].toFixed(1)+"",zt,en,ci,zu,Ts,Bu,Es,Uu,ql,Mc,nh,Ou,Rl,$u,zl,Nu,Is,Fc,ih,ju,Bl,Wu,Ul,Cc,sh,Ol,$P=C.ui.settings.protectedquality+"",L2,q2,Sc,oh,R2,Ds,$l,NP=C.ui.settings.invwidth+"",z2,B2,Gu,rh,Vs,Ac,lh,Nl,jP=C.ui.settings.stashwidth+"",U2,O2,Hu,ah,Ls,jl,WP=C.ui.settings.stashheight+"",$2,N2,Yu,ch,qs,Pc,fh,Xu,Wl,ls,uh,j2,Gl=me(t[33]),fi=[];for(let te=0;te<Gl.length;te+=1)fi[te]=d6(a6(t,Gl,te));return y=new Ot({props:{store:ba}}),D=new Ot({props:{store:$m}}),E=new Ot({props:{store:Wm}}),z=new Ot({props:{store:Nm}}),j=new Ot({props:{store:Gm}}),U=new Ot({props:{store:jm}}),Z=new Ot({props:{store:Hm}}),Fe=new Ot({props:{store:Xm}}),ce=new Ot({props:{store:Zm}}),ze=new Ot({props:{store:Ym}}),H=new Ot({props:{store:sp}}),pt=new Ot({props:{store:np}}),Je=new Ot({props:{store:tp}}),ye=new Ot({props:{store:ip}}),yt=new Ot({props:{store:Qm}}),He=new Ot({props:{store:op,cb:t[34]}}),Se=new Ot({props:{store:rp}}),Ze=new Ot({props:{store:cp}}),ql=new Ot({props:{store:lp}}),Rl=new Ot({props:{store:ap}}),zl=new Ot({props:{store:ya}}),Bl=new Ot({props:{store:Jm}}),Ul=new Ot({props:{store:Km}}),Wl=new Ot({props:{store:_a}}),{c(){e=h("div"),i=T(n),s=We(),o=h("br"),r=h("small"),r.textContent=`${C.ui.settings.reload}`,l=h("select");for(let te=0;te<fi.length;te+=1)fi[te].c();a=h("div"),a.textContent=`${C.ui.settings.tutorial}`,c=h("div"),f=h("div"),f.textContent=`${C.ui.reset}`,u=h("div"),u.textContent=`${C.ui.settings.resettutorial}`,m=h("div"),m.textContent=`${C.ui.disable}`,g=h("div"),g.textContent=`${C.ui.settings.disabletutorial}`,v=h("div"),v.textContent=`${C.ui.settings.fpsping}`,_=h("div"),b=h("div"),b.textContent=`${C.ui.settings.showfps}`,ne(y.$$.fragment),k=h("div"),k.textContent=`${C.ui.settings.nameplates}`,A=h("div"),S=h("div"),S.textContent=`${C.ui.settings.drawrange}`,F=h("input"),M=h("div"),M.textContent=`${C.ui.settings.monsterbars}`,ne(D.$$.fragment),R=h("div"),R.textContent=`${C.ui.settings.monsternames}`,ne(E.$$.fragment),L=h("div"),L.textContent=`${C.ui.settings.friendlyplayerbars}`,ne(z.$$.fragment),q=h("div"),q.textContent=`${C.ui.settings.friendlyplayernames}`,ne(j.$$.fragment),W=h("div"),W.textContent=`${C.ui.settings.enemyplayerbars}`,ne(U.$$.fragment),O=h("div"),O.textContent=`${C.ui.settings.enemyplayernames}`,ne(Z.$$.fragment),ve=h("div"),ve.textContent=`${C.ui.settings.showlevel}`,ne(Fe.$$.fragment),_e=h("div"),_e.textContent=`${C.ui.settings.classcolors}`,ne(ce.$$.fragment),fe=h("div"),fe.textContent=`${C.ui.settings.transparency}`,ne(ze.$$.fragment),Pe=h("div"),Pe.textContent=`${C.ui.settings.drops}`,Me=h("div"),be=h("div"),be.textContent=`${C.ui.settings.showquality}`,ne(H.$$.fragment),pe=h("div"),Ge=T(Be),Xe=h("br"),Ye=h("small"),ue=T(t[20]),oe=T("%"),$e=h("input"),J=h("div"),$=T(Q),le=h("br"),je=h("small"),je.textContent=`${C.ui.settings.reload}`,Ve=h("input"),ke=h("div"),ke.textContent=`${C.ui.settings.damagehealing}`,Re=h("div"),Oe=h("div"),Oe.textContent=`${C.ui.settings.incomingdamage}`,ne(pt.$$.fragment),wt=h("div"),wt.textContent=`${C.ui.settings.incominghealing}`,ne(Je.$$.fragment),Et=h("div"),Et.textContent=`${C.ui.settings.incomingmana}`,ne(ye.$$.fragment),Ke=h("div"),Ke.textContent=`${C.ui.settings.preventoverlap}`,ne(yt.$$.fragment),St=h("div"),St.textContent=`${C.ui.settings.icons}`,Te=h("div"),ft=h("div"),Le=T($t),Ct=h("br"),Lt=h("small"),Lt.textContent=`${C.ui.settings.reload}`,ne(He.$$.fragment),et=h("div"),et.textContent=`${C.ui.settings.buffcdtext}`,ne(Se.$$.fragment),ot=h("div"),ot.textContent=`${C.ui.settings.selfbuffsonly}`,ne(Ze.$$.fragment),ut=h("div"),Ss=T(wn),li=h("br"),Ii=h("small"),qt=T(dt),As=T("s"),jn=h("input"),ai=h("div"),Ar=T(wc),Do=h("br"),Ps=h("small"),zt=T(pn),en=T("s"),ci=h("input"),zu=h("div"),zu.textContent=`${C.ui.settings.buffmax}`,Ts=h("input"),Bu=h("div"),Bu.textContent=`${C.ui.settings.buffmaxparty}`,Es=h("input"),Uu=h("div"),Uu.textContent=`${C.ui.settings.updateratelimit}`,ne(ql.$$.fragment),Mc=h("div"),Mc.textContent=`${C.ui.settings.unitframes}`,nh=h("div"),Ou=h("div"),Ou.textContent=`${C.ui.settings.showselfparty}`,ne(Rl.$$.fragment),$u=h("div"),$u.textContent=`${C.ui.settings.partymana}`,ne(zl.$$.fragment),Nu=h("div"),Nu.textContent=`${C.ui.settings.partyframewidth}`,Is=h("input"),Fc=h("div"),Fc.textContent=`${C.ui.settings.map}`,ih=h("div"),ju=h("div"),ju.textContent=`${C.ui.settings.mapshowmonsters}`,ne(Bl.$$.fragment),Wu=h("div"),Wu.textContent=`${C.ui.settings.maplowqual}`,ne(Ul.$$.fragment),Cc=h("div"),Cc.textContent=`${C.ui.inventory.name}`,sh=h("div"),Ol=h("div"),L2=T($P),q2=h("br"),Sc=h("small"),oh=T(t[27]),R2=T("%"),Ds=h("input"),$l=h("div"),z2=T(NP),B2=h("br"),Gu=h("small"),rh=T(t[28]),Vs=h("input"),Ac=h("div"),Ac.textContent=`${C.ui.stash.name}`,lh=h("div"),Nl=h("div"),U2=T(jP),O2=h("br"),Hu=h("small"),ah=T(t[29]),Ls=h("input"),jl=h("div"),$2=T(WP),N2=h("br"),Yu=h("small"),ch=T(t[30]),qs=h("input"),Pc=h("div"),Pc.textContent="Social",fh=h("div"),Xu=h("div"),Xu.textContent="Twitch Streams",ne(Wl.$$.fragment),p(r,"class","textgrey"),t[18]===void 0&&_n(()=>t[52].call(l)),p(a,"class","textprimary"),p(u,"class","btn blue"),p(g,"class","btn orange"),p(v,"class","textprimary"),p(k,"class","textprimary"),p(F,"type","range"),p(Pe,"class","textprimary"),p(Ye,"class","textgrey"),p($e,"type","range"),p($e,"min","0"),p($e,"max","100"),p(je,"class","textgrey"),p(Ve,"type","text"),p(Ve,"placeholder","misc, gold, ..."),p(ke,"class","textprimary"),p(St,"class","textprimary"),p(Lt,"class","textgrey"),p(Ii,"class","textgrey"),p(jn,"type","range"),p(jn,"min","0"),p(jn,"max","1"),p(jn,"step","0.1"),p(Ps,"class","textgrey"),p(ci,"type","range"),p(ci,"min","0"),p(ci,"max","5"),p(ci,"step","0.1"),p(Ts,"placeholder","14"),p(Ts,"type","number"),p(Ts,"min","0"),p(Es,"placeholder","8"),p(Es,"type","number"),p(Es,"min","0"),p(Mc,"class","textprimary"),p(Is,"type","range"),p(Is,"min","50"),p(Is,"max","400"),p(Fc,"class","textprimary"),p(Cc,"class","textprimary"),p(Sc,"class","textgrey"),p(Ds,"type","range"),p(Ds,"min","0"),p(Ds,"max","110"),p(Gu,"class","textgrey"),p(Vs,"type","range"),p(Vs,"min","4"),p(Vs,"max","10"),p(Ac,"class","textprimary"),p(Hu,"class","textgrey"),p(Ls,"type","range"),p(Ls,"min","7"),p(Ls,"max","20"),p(Yu,"class","textgrey"),p(qs,"type","range"),p(qs,"min","50"),p(qs,"max","500"),p(Pc,"class","textprimary")},m(te,Ae){w(te,e,Ae),d(e,i),d(e,s),d(e,o),d(e,r),w(te,l,Ae);for(let Wn=0;Wn<fi.length;Wn+=1)fi[Wn]&&fi[Wn].m(l,null);Mn(l,t[18],!0),w(te,a,Ae),w(te,c,Ae),w(te,f,Ae),w(te,u,Ae),w(te,m,Ae),w(te,g,Ae),w(te,v,Ae),w(te,_,Ae),w(te,b,Ae),K(y,te,Ae),w(te,k,Ae),w(te,A,Ae),w(te,S,Ae),w(te,F,Ae),Ne(F,t[19]),w(te,M,Ae),K(D,te,Ae),w(te,R,Ae),K(E,te,Ae),w(te,L,Ae),K(z,te,Ae),w(te,q,Ae),K(j,te,Ae),w(te,W,Ae),K(U,te,Ae),w(te,O,Ae),K(Z,te,Ae),w(te,ve,Ae),K(Fe,te,Ae),w(te,_e,Ae),K(ce,te,Ae),w(te,fe,Ae),K(ze,te,Ae),w(te,Pe,Ae),w(te,Me,Ae),w(te,be,Ae),K(H,te,Ae),w(te,pe,Ae),d(pe,Ge),d(pe,Xe),d(pe,Ye),d(Ye,ue),d(Ye,oe),w(te,$e,Ae),Ne($e,t[20]),w(te,J,Ae),d(J,$),d(J,le),d(J,je),w(te,Ve,Ae),Ne(Ve,t[21]),w(te,ke,Ae),w(te,Re,Ae),w(te,Oe,Ae),K(pt,te,Ae),w(te,wt,Ae),K(Je,te,Ae),w(te,Et,Ae),K(ye,te,Ae),w(te,Ke,Ae),K(yt,te,Ae),w(te,St,Ae),w(te,Te,Ae),w(te,ft,Ae),d(ft,Le),d(ft,Ct),d(ft,Lt),K(He,te,Ae),w(te,et,Ae),K(Se,te,Ae),w(te,ot,Ae),K(Ze,te,Ae),w(te,ut,Ae),d(ut,Ss),d(ut,li),d(ut,Ii),d(Ii,qt),d(Ii,As),w(te,jn,Ae),Ne(jn,t[22]),w(te,ai,Ae),d(ai,Ar),d(ai,Do),d(ai,Ps),d(Ps,zt),d(Ps,en),w(te,ci,Ae),Ne(ci,t[23]),w(te,zu,Ae),w(te,Ts,Ae),Ne(Ts,t[24]),w(te,Bu,Ae),w(te,Es,Ae),Ne(Es,t[25]),w(te,Uu,Ae),K(ql,te,Ae),w(te,Mc,Ae),w(te,nh,Ae),w(te,Ou,Ae),K(Rl,te,Ae),w(te,$u,Ae),K(zl,te,Ae),w(te,Nu,Ae),w(te,Is,Ae),Ne(Is,t[26]),w(te,Fc,Ae),w(te,ih,Ae),w(te,ju,Ae),K(Bl,te,Ae),w(te,Wu,Ae),K(Ul,te,Ae),w(te,Cc,Ae),w(te,sh,Ae),w(te,Ol,Ae),d(Ol,L2),d(Ol,q2),d(Ol,Sc),d(Sc,oh),d(Sc,R2),w(te,Ds,Ae),Ne(Ds,t[27]),w(te,$l,Ae),d($l,z2),d($l,B2),d($l,Gu),d(Gu,rh),w(te,Vs,Ae),Ne(Vs,t[28]),w(te,Ac,Ae),w(te,lh,Ae),w(te,Nl,Ae),d(Nl,U2),d(Nl,O2),d(Nl,Hu),d(Hu,ah),w(te,Ls,Ae),Ne(Ls,t[29]),w(te,jl,Ae),d(jl,$2),d(jl,N2),d(jl,Yu),d(Yu,ch),w(te,qs,Ae),Ne(qs,t[30]),w(te,Pc,Ae),w(te,fh,Ae),w(te,Xu,Ae),K(Wl,te,Ae),ls=!0,uh||(j2=[Y(l,"change",t[52]),Y(l,"change",t[34]),Y(u,"click",t[53]),Y(g,"click",t[54]),Y(F,"change",t[55]),Y(F,"input",t[55]),Y($e,"change",t[56]),Y($e,"input",t[56]),Y($e,"change",t[34]),Y(Ve,"input",t[57]),Y(Ve,"change",t[34]),Y(jn,"change",t[58]),Y(jn,"input",t[58]),Y(ci,"change",t[59]),Y(ci,"input",t[59]),Y(Ts,"input",t[60]),Y(Es,"input",t[61]),Y(Is,"change",t[62]),Y(Is,"input",t[62]),Y(Ds,"change",t[63]),Y(Ds,"input",t[63]),Y(Vs,"change",t[64]),Y(Vs,"input",t[64]),Y(Ls,"change",t[65]),Y(Ls,"input",t[65]),Y(qs,"change",t[66]),Y(qs,"input",t[66])],uh=!0)},p(te,Ae){if(Ae[1]&4){Gl=me(te[33]);let Wn;for(Wn=0;Wn<Gl.length;Wn+=1){let W2=a6(te,Gl,Wn);fi[Wn]?fi[Wn].p(W2,Ae):(fi[Wn]=d6(W2),fi[Wn].c(),fi[Wn].m(l,null))}for(;Wn<fi.length;Wn+=1)fi[Wn].d(1);fi.length=Gl.length}Ae[0]&262144|Ae[1]&4&&Mn(l,te[18]),Ae[0]&524288&&Ne(F,te[19]),(!ls||Ae[0]&1048576)&&G(ue,te[20]),Ae[0]&1048576&&Ne($e,te[20]),Ae[0]&2097152&&Ve.value!==te[21]&&Ne(Ve,te[21]),(!ls||Ae[0]&4194304)&&dt!==(dt=te[22].toFixed(1)+"")&&G(qt,dt),Ae[0]&4194304&&Ne(jn,te[22]),(!ls||Ae[0]&8388608)&&pn!==(pn=te[23].toFixed(1)+"")&&G(zt,pn),Ae[0]&8388608&&Ne(ci,te[23]),Ae[0]&16777216&&Wt(Ts.value)!==te[24]&&Ne(Ts,te[24]),Ae[0]&33554432&&Wt(Es.value)!==te[25]&&Ne(Es,te[25]),Ae[0]&67108864&&Ne(Is,te[26]),(!ls||Ae[0]&134217728)&&G(oh,te[27]),Ae[0]&134217728&&Ne(Ds,te[27]),(!ls||Ae[0]&268435456)&&G(rh,te[28]),Ae[0]&268435456&&Ne(Vs,te[28]),(!ls||Ae[0]&536870912)&&G(ah,te[29]),Ae[0]&536870912&&Ne(Ls,te[29]),(!ls||Ae[0]&1073741824)&&G(ch,te[30]),Ae[0]&1073741824&&Ne(qs,te[30])},i(te){ls||(P(y.$$.fragment,te),P(D.$$.fragment,te),P(E.$$.fragment,te),P(z.$$.fragment,te),P(j.$$.fragment,te),P(U.$$.fragment,te),P(Z.$$.fragment,te),P(Fe.$$.fragment,te),P(ce.$$.fragment,te),P(ze.$$.fragment,te),P(H.$$.fragment,te),P(pt.$$.fragment,te),P(Je.$$.fragment,te),P(ye.$$.fragment,te),P(yt.$$.fragment,te),P(He.$$.fragment,te),P(Se.$$.fragment,te),P(Ze.$$.fragment,te),P(ql.$$.fragment,te),P(Rl.$$.fragment,te),P(zl.$$.fragment,te),P(Bl.$$.fragment,te),P(Ul.$$.fragment,te),P(Wl.$$.fragment,te),ls=!0)},o(te){I(y.$$.fragment,te),I(D.$$.fragment,te),I(E.$$.fragment,te),I(z.$$.fragment,te),I(j.$$.fragment,te),I(U.$$.fragment,te),I(Z.$$.fragment,te),I(Fe.$$.fragment,te),I(ce.$$.fragment,te),I(ze.$$.fragment,te),I(H.$$.fragment,te),I(pt.$$.fragment,te),I(Je.$$.fragment,te),I(ye.$$.fragment,te),I(yt.$$.fragment,te),I(He.$$.fragment,te),I(Se.$$.fragment,te),I(Ze.$$.fragment,te),I(ql.$$.fragment,te),I(Rl.$$.fragment,te),I(zl.$$.fragment,te),I(Bl.$$.fragment,te),I(Ul.$$.fragment,te),I(Wl.$$.fragment,te),ls=!1},d(te){te&&(x(e),x(l),x(a),x(c),x(f),x(u),x(m),x(g),x(v),x(_),x(b),x(k),x(A),x(S),x(F),x(M),x(R),x(L),x(q),x(W),x(O),x(ve),x(_e),x(fe),x(Pe),x(Me),x(be),x(pe),x($e),x(J),x(Ve),x(ke),x(Re),x(Oe),x(wt),x(Et),x(Ke),x(St),x(Te),x(ft),x(et),x(ot),x(ut),x(jn),x(ai),x(ci),x(zu),x(Ts),x(Bu),x(Es),x(Uu),x(Mc),x(nh),x(Ou),x($u),x(Nu),x(Is),x(Fc),x(ih),x(ju),x(Wu),x(Cc),x(sh),x(Ol),x(Ds),x($l),x(Vs),x(Ac),x(lh),x(Nl),x(Ls),x(jl),x(qs),x(Pc),x(fh),x(Xu)),it(fi,te),ee(y,te),ee(D,te),ee(E,te),ee(z,te),ee(j,te),ee(U,te),ee(Z,te),ee(Fe,te),ee(ce,te),ee(ze,te),ee(H,te),ee(pt,te),ee(Je,te),ee(ye,te),ee(yt,te),ee(He,te),ee(Se,te),ee(Ze,te),ee(ql,te),ee(Rl,te),ee(zl,te),ee(Bl,te),ee(Ul,te),ee(Wl,te),uh=!1,at(j2)}}}function bD(t){let e,n,i,s=C.ui.settings.sfxmultiplier+"",o,r,l,a,c,f,u,m,g,v;return{c(){e=h("div"),e.textContent=`${C.ui.settings.sfxvolume}`,n=h("input"),i=h("div"),o=T(s),r=h("br"),l=h("small"),l.textContent=`${C.ui.settings.multiplierdesc}`,a=h("input"),c=h("div"),c.textContent=`${C.ui.settings.musicvolume}`,f=h("input"),u=h("div"),u.textContent=`${C.ui.settings.ambiencevolume}`,m=h("input"),p(n,"type","range"),p(l,"class","textgrey"),p(a,"type","range"),p(f,"type","range"),p(m,"type","range")},m(_,b){w(_,e,b),w(_,n,b),Ne(n,t[14]),w(_,i,b),d(i,o),d(i,r),d(i,l),w(_,a,b),Ne(a,t[15]),w(_,c,b),w(_,f,b),Ne(f,t[16]),w(_,u,b),w(_,m,b),Ne(m,t[17]),g||(v=[Y(n,"change",t[48]),Y(n,"input",t[48]),Y(a,"change",t[49]),Y(a,"input",t[49]),Y(f,"change",t[50]),Y(f,"input",t[50]),Y(m,"change",t[51]),Y(m,"input",t[51])],g=!0)},p(_,b){b[0]&16384&&Ne(n,_[14]),b[0]&32768&&Ne(a,_[15]),b[0]&65536&&Ne(f,_[16]),b[0]&131072&&Ne(m,_[17])},i:ae,o:ae,d(_){_&&(x(e),x(n),x(i),x(a),x(c),x(f),x(u),x(m)),g=!1,at(v)}}}function yD(t){let e,n,i,s=C.ui.settings.mousesensitivity+"",o,r,l,a=t[11].toFixed(2)+"",c,f,u,m,g,v,_,b,y,k,A,S,F,M=C.ui.settings.skillbarslots+"",D,R,E,L,z,q,j,W,U,O,Z,ve,Fe,_e,ce,fe,ze,Pe,Me,be,H,pe,Be,Ge;m=new Ot({props:{store:fp}}),v=new Ot({props:{store:up}}),b=new Ot({props:{store:mp}}),k=new Ot({props:{store:pp}}),Z=new Ot({props:{store:dp}});let Xe=me(t[3]),Ye=[];for(let ue=0;ue<Xe.length;ue+=1)Ye[ue]=h6(c6(t,Xe,ue));return{c(){e=h("div"),e.textContent=`${C.ui.settings.camera}`,n=h("div"),i=h("div"),o=T(s),r=We(),l=h("span"),c=T(a),f=h("input"),u=h("div"),u.textContent=`${C.ui.settings.invertmousex}`,ne(m.$$.fragment),g=h("div"),g.textContent=`${C.ui.settings.invertmousey}`,ne(v.$$.fragment),_=h("div"),_.textContent=`${C.ui.settings.lockedcamera}`,ne(b.$$.fragment),y=h("div"),y.textContent=`${C.ui.settings.pointerlock}`,ne(k.$$.fragment),A=h("div"),A.textContent=`${C.ui.settings.skillbar}`,S=h("div"),F=h("div"),D=T(M),R=We(),E=h("span"),L=T(t[12]),z=h("br"),q=h("small"),q.textContent=`${C.ui.settings.reload}`,j=h("input"),W=h("div"),W.textContent="Targeting",U=h("div"),O=h("div"),O.textContent="Target Next Friendly: Allow Non-Partied",ne(Z.$$.fragment),ve=h("div"),Fe=T("Target Next Friendly: Cycle Size "),_e=h("span"),ce=T(t[13]),fe=h("input"),ze=h("div"),ze.textContent=`${C.ui.settings.keybindings}`,Pe=h("div"),Me=h("small"),Me.textContent=`${C.ui.settings.reload}`,be=h("small"),be.textContent=`${C.ui.settings.bindingreset}`;for(let ue=0;ue<Ye.length;ue+=1)Ye[ue].c();H=he(),p(e,"class","textprimary"),p(l,"class","textgrey"),p(f,"type","range"),p(f,"step","0.05"),p(f,"min","0.1"),p(f,"max","3"),p(A,"class","textprimary"),p(E,"class","textgrey"),p(q,"class","textgrey"),p(j,"type","range"),p(j,"min","10"),p(j,"max","24"),p(W,"class","textprimary"),p(_e,"class","textgrey"),p(fe,"type","range"),p(fe,"min","1"),p(fe,"max","10"),p(ze,"class","textprimary"),p(Me,"class","textgrey"),p(be,"class","textprimary")},m(ue,oe){w(ue,e,oe),w(ue,n,oe),w(ue,i,oe),d(i,o),d(i,r),d(i,l),d(l,c),w(ue,f,oe),Ne(f,t[11]),w(ue,u,oe),K(m,ue,oe),w(ue,g,oe),K(v,ue,oe),w(ue,_,oe),K(b,ue,oe),w(ue,y,oe),K(k,ue,oe),w(ue,A,oe),w(ue,S,oe),w(ue,F,oe),d(F,D),d(F,R),d(F,E),d(E,L),d(F,z),d(F,q),w(ue,j,oe),Ne(j,t[12]),w(ue,W,oe),w(ue,U,oe),w(ue,O,oe),K(Z,ue,oe),w(ue,ve,oe),d(ve,Fe),d(ve,_e),d(_e,ce),w(ue,fe,oe),Ne(fe,t[13]),w(ue,ze,oe),w(ue,Pe,oe),w(ue,Me,oe),w(ue,be,oe);for(let $e=0;$e<Ye.length;$e+=1)Ye[$e]&&Ye[$e].m(ue,oe);w(ue,H,oe),pe=!0,Be||(Ge=[Y(f,"change",t[43]),Y(f,"input",t[43]),Y(j,"change",t[44]),Y(j,"input",t[44]),Y(j,"change",t[34]),Y(fe,"change",t[45]),Y(fe,"input",t[45])],Be=!0)},p(ue,oe){if((!pe||oe[0]&2048)&&a!==(a=ue[11].toFixed(2)+"")&&G(c,a),oe[0]&2048&&Ne(f,ue[11]),(!pe||oe[0]&4096)&&G(L,ue[12]),oe[0]&4096&&Ne(j,ue[12]),(!pe||oe[0]&8192)&&G(ce,ue[13]),oe[0]&8192&&Ne(fe,ue[13]),oe[0]&8|oe[1]&16){Xe=me(ue[3]);let $e;for($e=0;$e<Xe.length;$e+=1){let J=c6(ue,Xe,$e);Ye[$e]?Ye[$e].p(J,oe):(Ye[$e]=h6(J),Ye[$e].c(),Ye[$e].m(H.parentNode,H))}for(;$e<Ye.length;$e+=1)Ye[$e].d(1);Ye.length=Xe.length}},i(ue){pe||(P(m.$$.fragment,ue),P(v.$$.fragment,ue),P(b.$$.fragment,ue),P(k.$$.fragment,ue),P(Z.$$.fragment,ue),pe=!0)},o(ue){I(m.$$.fragment,ue),I(v.$$.fragment,ue),I(b.$$.fragment,ue),I(k.$$.fragment,ue),I(Z.$$.fragment,ue),pe=!1},d(ue){ue&&(x(e),x(n),x(i),x(f),x(u),x(g),x(_),x(y),x(A),x(S),x(F),x(j),x(W),x(U),x(O),x(ve),x(fe),x(ze),x(Pe),x(Me),x(be),x(H)),ee(m,ue),ee(v,ue),ee(b,ue),ee(k,ue),ee(Z,ue),it(Ye,ue),Be=!1,at(Ge)}}}function kD(t){let e,n,i,s,o,r=C.ui.settings.fov+"",l,a,c,f,u,m,g=C.ui.settings.anisotropy+"",v,_,b,y,k,A=C.ui.settings.grass+"",S,F,M,D,R,E,L,z,q,j=C.ui.settings.disableoffscreen+"",W,U,O,Z,ve,Fe,_e,ce,fe,ze,Pe,Me=C.ui.settings.shadows+"",be,H,pe,Be,Ge,Xe=C.ui.settings.shadowresolution+"",Ye,ue,oe,$e,J,Q,$;return E=new Ot({props:{store:Lm}}),z=new Ot({props:{store:zm}}),Z=new Ot({props:{store:qm}}),Fe=new Ot({props:{store:Bm}}),ce=new Ot({props:{cb:t[34],store:Um}}),Be=new Ot({props:{cb:t[34],store:Rm}}),{c(){e=h("div"),e.textContent=`${C.ui.settings.resolution}`,n=h("input"),i=h("div"),i.textContent=`${C.ui.settings.viewrange}`,s=h("input"),o=h("div"),l=T(r),a=We(),c=h("span"),f=T(t[7]),u=h("input"),m=h("div"),v=T(g),_=h("br"),b=h("small"),b.textContent=`${C.ui.settings.reload}`,y=h("input"),k=h("div"),S=T(A),F=h("br"),M=h("small"),M.textContent=`${C.ui.settings.reload}`,D=h("input"),R=h("div"),R.textContent=`${C.ui.settings.fxaa}`,ne(E.$$.fragment),L=h("div"),L.textContent=`${C.ui.settings.bloom}`,ne(z.$$.fragment),q=h("div"),W=T(j),U=h("br"),O=h("small"),O.textContent=`${C.ui.settings.offscreendesc}`,ne(Z.$$.fragment),ve=h("div"),ve.textContent=`${C.ui.settings.particles}`,ne(Fe.$$.fragment),_e=h("div"),_e.textContent=`${C.ui.settings.fogpattern}`,ne(ce.$$.fragment),fe=h("div"),fe.textContent=`${C.ui.settings.shadows}`,ze=h("div"),Pe=h("div"),be=T(Me),H=h("br"),pe=h("small"),pe.textContent=`${C.ui.settings.reload}`,ne(Be.$$.fragment),Ge=h("div"),Ye=T(Xe),ue=h("br"),oe=h("small"),oe.textContent=`${C.ui.settings.reload}`,$e=h("input"),p(n,"type","range"),p(n,"min","30"),p(n,"step","10"),p(s,"type","range"),p(s,"min","30"),p(c,"class","textgrey"),p(u,"type","range"),p(u,"min","50"),p(u,"max","100"),p(b,"class","textgrey"),p(y,"type","range"),p(y,"min","0"),p(y,"max","4"),p(M,"class","textgrey"),p(D,"type","range"),p(D,"min","0"),p(D,"max","100"),p(O,"class","textgrey"),p(fe,"class","textprimary"),p(pe,"class","textgrey"),p(oe,"class","textgrey"),p($e,"type","range"),p($e,"min","0"),p($e,"max","3")},m(le,je){w(le,e,je),w(le,n,je),Ne(n,t[5]),w(le,i,je),w(le,s,je),Ne(s,t[6]),w(le,o,je),d(o,l),d(o,a),d(o,c),d(c,f),w(le,u,je),Ne(u,t[7]),w(le,m,je),d(m,v),d(m,_),d(m,b),w(le,y,je),Ne(y,t[8]),w(le,k,je),d(k,S),d(k,F),d(k,M),w(le,D,je),Ne(D,t[9]),w(le,R,je),K(E,le,je),w(le,L,je),K(z,le,je),w(le,q,je),d(q,W),d(q,U),d(q,O),K(Z,le,je),w(le,ve,je),K(Fe,le,je),w(le,_e,je),K(ce,le,je),w(le,fe,je),w(le,ze,je),w(le,Pe,je),d(Pe,be),d(Pe,H),d(Pe,pe),K(Be,le,je),w(le,Ge,je),d(Ge,Ye),d(Ge,ue),d(Ge,oe),w(le,$e,je),Ne($e,t[10]),J=!0,Q||($=[Y(n,"change",t[37]),Y(n,"input",t[37]),Y(s,"change",t[38]),Y(s,"input",t[38]),Y(u,"change",t[39]),Y(u,"input",t[39]),Y(y,"change",t[40]),Y(y,"input",t[40]),Y(y,"change",t[34]),Y(D,"change",t[41]),Y(D,"input",t[41]),Y(D,"change",t[34]),Y($e,"change",t[42]),Y($e,"input",t[42]),Y($e,"change",t[34])],Q=!0)},p(le,je){je[0]&32&&Ne(n,le[5]),je[0]&64&&Ne(s,le[6]),(!J||je[0]&128)&&G(f,le[7]),je[0]&128&&Ne(u,le[7]),je[0]&256&&Ne(y,le[8]),je[0]&512&&Ne(D,le[9]),je[0]&1024&&Ne($e,le[10])},i(le){J||(P(E.$$.fragment,le),P(z.$$.fragment,le),P(Z.$$.fragment,le),P(Fe.$$.fragment,le),P(ce.$$.fragment,le),P(Be.$$.fragment,le),J=!0)},o(le){I(E.$$.fragment,le),I(z.$$.fragment,le),I(Z.$$.fragment,le),I(Fe.$$.fragment,le),I(ce.$$.fragment,le),I(Be.$$.fragment,le),J=!1},d(le){le&&(x(e),x(n),x(i),x(s),x(o),x(u),x(m),x(y),x(k),x(D),x(R),x(L),x(q),x(ve),x(_e),x(fe),x(ze),x(Pe),x(Ge),x($e)),ee(E,le),ee(z,le),ee(Z,le),ee(Fe,le),ee(ce,le),ee(Be,le),Q=!1,at($)}}}function p6(t){let e,n,i,s,o;function r(...l){return t[67](t[78],...l)}return{c(){e=h("div"),e.textContent=`${t[76]}`,n=h("div"),p(n,"class",i="btn checkbox "+(t[31][t[78]]?"active":""))},m(l,a){w(l,e,a),w(l,n,a),s||(o=Y(n,"click",r),s=!0)},p(l,a){t=l,a[1]&1&&i!==(i="btn checkbox "+(t[31][t[78]]?"active":""))&&p(n,"class",i)},d(l){l&&(x(e),x(n)),s=!1,o()}}}function d6(t){let e,n=t[73].name+"",i,s;return{c(){e=h("option"),i=T(n),e.__value=s=t[73].val,Ne(e,e.__value)},m(o,r){w(o,e,r),d(e,i)},p:ae,d(o){o&&x(e)}}}function h6(t){let e,n=t[70].name+"",i,s,o,r;function l(){t[46].call(s,t[70])}function a(...c){return t[47](t[70],...c)}return{c(){e=h("div"),i=T(n),s=h("input"),p(s,"type","text")},m(c,f){w(c,e,f),d(e,i),w(c,s,f),Ne(s,t[0].current[t[70].kb]),o||(r=[Y(s,"input",l),Y(s,"change",a)],o=!0)},p(c,f){t=c,f[0]&8&&n!==(n=t[70].name+"")&&G(i,n),f[0]&8&&s.value!==t[0].current[t[70].kb]&&Ne(s,t[0].current[t[70].kb])},d(c){c&&(x(e),x(s)),o=!1,at(r)}}}function xD(t){let e,n,i,s,o=t[1].name+"",r,l,a,c,f,u=me(t[32]),m=[];for(let b=0;b<u.length;b+=1)m[b]=m6(f6(t,u,b));let g=[kD,yD,bD,_D,vD],v=[];function _(b,y){return b[1].id=="gfx"?0:b[1].id=="controls"?1:b[1].id=="audio"?2:b[1].id=="ui"?3:b[1].id=="chat"?4:-1}return~(a=_(t,[-1,-1,-1]))&&(c=v[a]=g[a](t)),{c(){e=h("div"),n=h("div");for(let b=0;b<m.length;b+=1)m[b].c();i=h("div"),s=h("h3"),r=T(o),l=h("div"),c&&c.c(),p(s,"class","textprimary"),p(l,"class","settings svelte-13nnce4"),p(i,"class","menu panel-black scrollbar svelte-13nnce4"),p(e,"class","divide svelte-13nnce4")},m(b,y){w(b,e,y),d(e,n);for(let k=0;k<m.length;k+=1)m[k]&&m[k].m(n,null);d(e,i),d(i,s),d(s,r),d(i,l),~a&&v[a].m(l,null),f=!0},p(b,y){if(y[0]&2|y[1]&2){u=me(b[32]);let A;for(A=0;A<u.length;A+=1){let S=f6(b,u,A);m[A]?m[A].p(S,y):(m[A]=m6(S),m[A].c(),m[A].m(n,null))}for(;A<m.length;A+=1)m[A].d(1);m.length=u.length}(!f||y[0]&2)&&o!==(o=b[1].name+"")&&G(r,o);let k=a;a=_(b,y),a===k?~a&&v[a].p(b,y):(c&&(Ee(),I(v[k],1,1,()=>{v[k]=null}),Ie()),~a?(c=v[a],c?c.p(b,y):(c=v[a]=g[a](b),c.c()),P(c,1),c.m(l,null)):c=null)},i(b){f||(P(c),f=!0)},o(b){I(c),f=!1},d(b){b&&x(e),it(m,b),~a&&v[a].d()}}}function wD(t){let e,n,i=t[4]&&u6(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,o){s[4]?i?(i.p(s,o),o[0]&16&&P(i,1)):(i=u6(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function MD(t,e,n){let i,s,o,r,l,a,c,f,u,m,g,v,_,b,y,k,A,S,F,M,D,R,E,L,z,q,j,W;se(t,Xr,Le=>n(4,i=Le)),se(t,jr,Le=>n(5,s=Le)),se(t,$r,Le=>n(6,o=Le)),se(t,Nr,Le=>n(7,r=Le)),se(t,Kc,Le=>n(8,l=Le)),se(t,Zc,Le=>n(9,a=Le)),se(t,Jc,Le=>n(10,c=Le)),se(t,yf,Le=>n(11,f=Le)),se(t,Kr,Le=>n(12,u=Le)),se(t,kf,Le=>n(13,m=Le)),se(t,Wr,Le=>n(14,g=Le)),se(t,Gr,Le=>n(15,v=Le)),se(t,tf,Le=>n(16,_=Le)),se(t,ef,Le=>n(17,b=Le)),se(t,Hr,Le=>n(18,y=Le)),se(t,cf,Le=>n(19,k=Le)),se(t,mf,Le=>n(20,A=Le)),se(t,uf,Le=>n(21,S=Le)),se(t,hf,Le=>n(22,F=Le)),se(t,gf,Le=>n(23,M=Le)),se(t,vf,Le=>n(24,D=Le)),se(t,_f,Le=>n(25,R=Le)),se(t,Jr,Le=>n(26,E=Le)),se(t,pf,Le=>n(27,L=Le)),se(t,Yr,Le=>n(28,z=Le)),se(t,Ho,Le=>n(29,q=Le)),se(t,Yo,Le=>n(30,j=Le)),se(t,af,Le=>n(31,W=Le));let U=[{id:"ui",name:C.ui.settings.interface},{id:"gfx",name:C.ui.settings.graphics},{id:"controls",name:C.ui.settings.controls},{id:"chat",name:C.ui.settings.chat},{id:"audio",name:C.ui.settings.audio}],O=U[0],Z=[{val:"en",name:"English"},{val:"de",name:"German"},{val:"ru",name:"Russian"},{val:"zh",name:"Chinese"},{val:"pt",name:"Portugese"},{val:"es",name:"Spanish"},{val:"fr",name:"French"},{val:"ro",name:"Romanian"},{val:"it",name:"Italian"},{val:"nl",name:"Dutch"},{val:"vi",name:"Vietnamese"},{val:"hu",name:"Hungarian"},{val:"ro",name:"Romanian"},{val:"cs",name:"Czech"},{val:"pl",name:"Polish"}],ve=!1,Fe=()=>{n(2,ve=!0)},_e=(Le,Ct)=>{Ct.set(Le===""?void 0:Le),n(2,ve=!0)},ce=["Forward","Left","Back","Right","TurnLeft","TurnRight","Map","Skills","Character","Inventory","Clan","Pvp","Party","NextTarget","NextParty","Untarget"],fe=["Forward","Left","Back","Right","Turn Left","Turn Right","Map","Skills","Character","Inventory","Clan","Pvp","Party","Target Next Enemy","Target Next Friendly","Untarget"];for(let Le=1;Le<25;++Le)ce.push("Skillbar"+Le);ce=ce.map((Le,Ct)=>({name:fe[Ct]||Le,kb:"kb"+Le,setting:Hs["kb"+Le]}));let ze=(Le,Ct)=>{n(1,O=Le)};function Pe(){s=Wt(this.value),jr.set(s)}function Me(){o=Wt(this.value),$r.set(o)}function be(){r=Wt(this.value),Nr.set(r)}function H(){l=Wt(this.value),Kc.set(l)}function pe(){a=Wt(this.value),Zc.set(a)}function Be(){c=Wt(this.value),Jc.set(c)}function Ge(){f=Wt(this.value),yf.set(f)}function Xe(){u=Wt(this.value),Kr.set(u)}function Ye(){m=Wt(this.value),kf.set(m)}function ue(Le){re[Le.kb]=this.value,n(0,Hs)}let oe=(Le,Ct)=>{_e(re[Le.kb],Le.setting)};function $e(){g=Wt(this.value),Wr.set(g)}function J(){v=Wt(this.value),Gr.set(v)}function Q(){_=Wt(this.value),tf.set(_)}function $(){b=Wt(this.value),ef.set(b)}function le(){y=ki(this),Hr.set(y),n(33,Z)}let je=Le=>Gs.set(0),Ve=Le=>Gs.set(Pi.length);function ke(){k=Wt(this.value),cf.set(k)}function Re(){A=Wt(this.value),mf.set(A)}function Oe(){S=this.value,uf.set(S)}function pt(){F=Wt(this.value),hf.set(F)}function wt(){M=Wt(this.value),gf.set(M)}function Je(){D=Wt(this.value),vf.set(D)}function Et(){R=Wt(this.value),_f.set(R)}function ye(){E=Wt(this.value),Jr.set(E)}function Ke(){L=Wt(this.value),pf.set(L)}function yt(){z=Wt(this.value),Yr.set(z)}function St(){q=Wt(this.value),Ho.set(q)}function Te(){j=Wt(this.value),Yo.set(j)}return[Hs,O,ve,ce,i,s,o,r,l,a,c,f,u,m,g,v,_,b,y,k,A,S,F,M,D,R,E,L,z,q,j,W,U,Z,Fe,_e,ze,Pe,Me,be,H,pe,Be,Ge,Xe,Ye,ue,oe,$e,J,Q,$,le,je,Ve,ke,Re,Oe,pt,wt,Je,Et,ye,Ke,yt,St,Te,(Le,Ct)=>Qe(af,W[Le]=W[Le]?0:1,W),()=>{Qe(Xr,i=!1,i),ve&&window.location.reload()}]}var Ug=class extends xe{constructor(e){super(),Ce(this,e,MD,wD,Ue,{},null,[-1,-1,-1])}},g6=Ug;function v6(t,e,n){let i=t.slice();return i[39]=e[n],i}function _6(t,e,n){let i=t.slice();return i[39]=e[n],i}function b6(t,e,n){let i=t.slice();return i[44]=e[n],i[46]=n,i}function y6(t,e,n){let i=t.slice();return i[47]=e[n],i}function k6(t){let e,n;return e=new jt({props:{origin:"center",title:C.ui.headers.skills,settings:[{name:"Preset Manager",fun:t[31]}],icon:"book",$$slots:{default:[zD]},$$scope:{ctx:t}}}),e.$on("close",t[32]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&4096&&(o.settings=[{name:"Preset Manager",fun:i[31]}]),s[0]&6143|s[1]&524288&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function x6(t){let e,n;function i(r,l){return r[6]===void 0?CD:FD}let s=i(t,[-1,-1]),o=s(t);return{c(){e=h("div"),o.c(),p(e,"class",n="panel-black "+(t[6]===void 0?"bar-top-config":"bar-top-save")+" svelte-1e0alkc")},m(r,l){w(r,e,l),o.m(e,null)},p(r,l){s===(s=i(r,l))&&o?o.p(r,l):(o.d(1),o=s(r),o&&(o.c(),o.m(e,null))),l[0]&64&&n!==(n="panel-black "+(r[6]===void 0?"bar-top-config":"bar-top-save")+" svelte-1e0alkc")&&p(e,"class",n)},d(r){r&&x(e),o.d()}}}function FD(t){let e,n,i,s,o,r,l;return{c(){e=h("div"),n=h("input"),i=h("div"),i.textContent="Save",s=h("div"),s.textContent="Cancel",o=h("div"),p(n,"placeholder","Enter Preset Name"),p(n,"maxlength","25"),p(i,"class","btn green"),p(s,"class","btn orange")},m(a,c){w(a,e,c),w(a,n,c),Ne(n,t[6]),w(a,i,c),w(a,s,c),w(a,o,c),r||(l=[Y(n,"input",t[25]),Y(i,"click",t[15]),Y(s,"click",t[26])],r=!0)},p(a,c){c[0]&64&&n.value!==a[6]&&Ne(n,a[6])},d(a){a&&(x(e),x(n),x(i),x(s),x(o)),r=!1,at(l)}}}function CD(t){let e,n,i,s,o,r,l,a,c,f,u,m,g=me(t[10].filter(t[21])),v=[];for(let b=0;b<g.length;b+=1)v[b]=w6(y6(t,g,b));let _=t[7]===void 0&&M6(t);return{c(){e=h("span"),e.textContent="Preset:",n=h("select");for(let b=0;b<v.length;b+=1)v[b].c();i=he(),_&&_.c(),o=h("div"),r=T("Save"),a=h("div"),c=T("Delete"),p(e,"class","btn textprimary"),p(n,"class",s="btn grey "+(t[10].filter(t[22]).length===0?"disabled":"")),t[7]===void 0&&_n(()=>t[23].call(n)),p(o,"class",l="btn grey "+(t[5]?"":"disabled")),p(a,"class",f="btn grey "+(t[7]!==void 0?"":"disabled"))},m(b,y){w(b,e,y),w(b,n,y);for(let k=0;k<v.length;k+=1)v[k]&&v[k].m(n,null);d(n,i),_&&_.m(n,null),Mn(n,t[7],!0),w(b,o,y),d(o,r),w(b,a,y),d(a,c),u||(m=[Y(n,"change",t[23]),Y(n,"change",t[16]),Y(o,"click",t[24]),Y(a,"click",t[17])],u=!0)},p(b,y){if(y[0]&1024){g=me(b[10].filter(b[21]));let k;for(k=0;k<g.length;k+=1){let A=y6(b,g,k);v[k]?v[k].p(A,y):(v[k]=w6(A),v[k].c(),v[k].m(n,i))}for(;k<v.length;k+=1)v[k].d(1);v.length=g.length}b[7]===void 0?_?_.p(b,y):(_=M6(b),_.c(),_.m(n,null)):_&&(_.d(1),_=null),y[0]&1024&&s!==(s="btn grey "+(b[10].filter(b[22]).length===0?"disabled":""))&&p(n,"class",s),y[0]&1152&&Mn(n,b[7]),y[0]&32&&l!==(l="btn grey "+(b[5]?"":"disabled"))&&p(o,"class",l),y[0]&1152&&f!==(f="btn grey "+(b[7]!==void 0?"":"disabled"))&&p(a,"class",f)},d(b){b&&(x(e),x(n),x(o),x(a)),it(v,b),_&&_.d(),u=!1,at(m)}}}function w6(t){let e,n=t[47].name+"",i,s;return{c(){e=h("option"),i=T(n),e.__value=s=t[47].name,Ne(e,e.__value)},m(o,r){w(o,e,r),d(e,i)},p(o,r){r[0]&1024&&n!==(n=o[47].name+"")&&G(i,n),r[0]&1024&&s!==(s=o[47].name)&&(e.__value=s,Ne(e,e.__value))},d(o){o&&x(e)}}}function M6(t){let e,n;return{c(){e=h("option"),n=T("No Preset"),e.disabled=!0,e.selected=!0,e.__value=void 0,Ne(e,e.__value)},m(i,s){w(i,e,s),d(e,n)},p:ae,d(i){i&&x(e)}}}function SD(t){let e,n;return e=new yl({props:{level:Math.max(1,t[39].level),skill:Pt.get(t[39].id)}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&8&&(o.level=Math.max(1,i[39].level)),s[0]&8&&(o.skill=Pt.get(i[39].id)),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function AD(t){let e;return{c(){e=h("div"),e.textContent=`${C.ui.default}`,p(e,"class","textgrey")},m(n,i){w(n,e,i)},p:ae,d(n){n&&x(e)}}}function PD(t){let e,n=me(Array(Pt.get(t[39].id).skilllevels)),i=[];for(let s=0;s<n.length;s+=1)i[s]=F6(b6(t,n,s));return{c(){e=h("div");for(let s=0;s<i.length;s+=1)i[s].c();p(e,"class","skillpoints svelte-1e0alkc")},m(s,o){w(s,e,o);for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(e,null)},p(s,o){if(o[0]&24){n=me(Array(Pt.get(s[39].id).skilllevels));let r;for(r=0;r<n.length;r+=1){let l=b6(s,n,r);i[r]?i[r].p(l,o):(i[r]=F6(l),i[r].c(),i[r].m(e,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&x(e),it(i,s)}}}function TD(t){let e;return{c(){e=h("div"),p(e,"class","border grey")},m(n,i){w(n,e,i)},p:ae,d(n){n&&x(e)}}}function ED(t){let e;return{c(){e=h("div"),p(e,"class","btn incbtn grey svelte-1e0alkc")},m(n,i){w(n,e,i)},p:ae,d(n){n&&x(e)}}}function ID(t){let e,n;return{c(){e=h("div"),p(e,"class",n="btn incbtn "+(t[4]?"green":"white")+" svelte-1e0alkc")},m(i,s){w(i,e,s)},p(i,s){s[0]&16&&n!==(n="btn incbtn "+(i[4]?"green":"white")+" svelte-1e0alkc")&&p(e,"class",n)},d(i){i&&x(e)}}}function F6(t){let e;function n(o,r){return o[46]+1<=o[39].level?ID:o[46]+1<=o[39].learned?ED:TD}let i=n(t,[-1,-1]),s=i(t);return{c(){s.c(),e=he()},m(o,r){s.m(o,r),w(o,e,r)},p(o,r){i===(i=n(o,r))&&s?s.p(o,r):(s.d(1),s=i(o),s&&(s.c(),s.m(e.parentNode,e)))},d(o){o&&x(e),s.d(o)}}}function DD(t){let e;return{c(){e=h("div"),p(e,"class","name svelte-1e0alkc")},m(n,i){w(n,e,i)},p:ae,d(n){n&&x(e)}}}function VD(t){let e,n,i,s=t[39].level+"",o;return{c(){e=h("div"),n=T("Lv. "),i=h("span"),o=T(s),p(i,"class","bold textwhite"),p(e,"class","name svelte-1e0alkc")},m(r,l){w(r,e,l),d(e,n),d(e,i),d(i,o)},p(r,l){l[0]&8&&s!==(s=r[39].level+"")&&G(o,s)},d(r){r&&x(e)}}}function C6(t){let e,n,i,s,o,r,l;function a(...m){return t[27](t[39],...m)}function c(m,g){return g[0]&520&&(o=null),o==null&&(o=m[9]>=Pt.get(m[39].id).skillpoints&&m[39].level<Pt.get(m[39].id).skilllevels&&m[39].level<m[39].learned),o?qD:LD}let f=c(t,[-1,-1]),u=f(t);return{c(){e=h("div"),n=h("div"),i=T("-"),u.c(),p(n,"class",s="btn incbtn "+(t[39].level>0?"grey":"black disabled")+" svelte-1e0alkc"),p(e,"class","skillpoints svelte-1e0alkc")},m(m,g){w(m,e,g),d(e,n),d(n,i),u.m(e,null),r||(l=Y(n,"click",a),r=!0)},p(m,g){t=m,g[0]&8&&s!==(s="btn incbtn "+(t[39].level>0?"grey":"black disabled")+" svelte-1e0alkc")&&p(n,"class",s),f===(f=c(t,g))&&u?u.p(t,g):(u.d(1),u=f(t),u&&(u.c(),u.m(e,null)))},d(m){m&&x(e),u.d(),r=!1,l()}}}function LD(t){let e;return{c(){e=h("div"),e.textContent="+",p(e,"class","btn incbtn black disabled svelte-1e0alkc")},m(n,i){w(n,e,i)},p:ae,d(n){n&&x(e)}}}function qD(t){let e,n,i;function s(...o){return t[28](t[39],...o)}return{c(){e=h("div"),e.textContent="+",p(e,"id","tutsetskillpoint"),p(e,"class","btn incbtn green svelte-1e0alkc")},m(o,r){w(o,e,r),n||(i=Y(e,"click",s),n=!0)},p(o,r){t=o},d(o){o&&x(e),n=!1,i()}}}function S6(t){let e,n,i,s,o=C.items.book[t[39].id].name+"",r,l,a,c,f;n=new _l({props:{descPos:"left:100%;top:0;",descRoot:t[2],border:"white",data:{},pickable:t[39].pickable,meta:{type:"skill",skill:Pt.get(t[39].id)},css:"slotskill",img:`/data/ui/skills/${t[39].id}.${Gn}?v=8602459`,$$slots:{default:[SD]},$$scope:{ctx:t}}});function u(k,A){return k[39].engineOnly?AD:PD}let m=u(t,[-1,-1]),g=m(t);function v(k,A){return k[39].engineOnly?DD:VD}let _=v(t,[-1,-1]),b=_(t),y=!t[39].engineOnly&&C6(t);return{c(){e=h("div"),ne(n.$$.fragment),i=h("div"),s=h("div"),r=T(o),l=We(),g.c(),a=h("div"),b.c(),c=he(),y&&y.c(),p(s,"class","textprimary name svelte-1e0alkc"),p(e,"class","panel-bright skillbox svelte-1e0alkc")},m(k,A){w(k,e,A),K(n,e,null),d(e,i),d(i,s),d(s,r),d(i,l),g.m(i,null),d(e,a),b.m(a,null),d(a,c),y&&y.m(a,null),f=!0},p(k,A){let S={};A[0]&4&&(S.descRoot=k[2]),A[0]&8&&(S.pickable=k[39].pickable),A[0]&8&&(S.meta={type:"skill",skill:Pt.get(k[39].id)}),A[0]&8&&(S.img=`/data/ui/skills/${k[39].id}.${Gn}?v=8602459`),A[0]&8|A[1]&524288&&(S.$$scope={dirty:A,ctx:k}),n.$set(S),(!f||A[0]&8)&&o!==(o=C.items.book[k[39].id].name+"")&&G(r,o),m===(m=u(k,A))&&g?g.p(k,A):(g.d(1),g=m(k),g&&(g.c(),g.m(i,null))),_===(_=v(k,A))&&b?b.p(k,A):(b.d(1),b=_(k),b&&(b.c(),b.m(a,c))),k[39].engineOnly?y&&(y.d(1),y=null):y?y.p(k,A):(y=C6(k),y.c(),y.m(a,null))},i(k){f||(P(n.$$.fragment,k),f=!0)},o(k){I(n.$$.fragment,k),f=!1},d(k){k&&x(e),ee(n),g.d(),b.d(),y&&y.d()}}}function RD(t){let e,n;return e=new yl({props:{level:1,skill:t[39]}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&1&&(o.skill=i[39]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function A6(t){let e,n,i,s,o=C.items.book[t[39].id].name+"",r,l,a=C.ui.learnable+"",c,f,u=t[39].minlevel+"",m,g;return n=new _l({props:{descPos:"left:100%;top:0;",descRoot:t[2],border:"grey filtered",data:{},pickable:!1,meta:{type:"skill",skill:t[39]},css:"slotskill",img:`/data/ui/skills/${t[39].id}.${Gn}?v=8602459`,$$slots:{default:[RD]},$$scope:{ctx:t}}}),{c(){e=h("div"),ne(n.$$.fragment),i=h("div"),s=h("div"),r=T(o),l=h("div"),c=T(a),f=We(),m=T(u),p(s,"class","name svelte-1e0alkc"),p(i,"class","textgrey"),p(e,"class","panel-bright skillbox svelte-1e0alkc")},m(v,_){w(v,e,_),K(n,e,null),d(e,i),d(i,s),d(s,r),d(i,l),d(l,c),d(l,f),d(l,m),g=!0},p(v,_){let b={};_[0]&4&&(b.descRoot=v[2]),_[0]&1&&(b.meta={type:"skill",skill:v[39]}),_[0]&1&&(b.img=`/data/ui/skills/${v[39].id}.${Gn}?v=8602459`),_[0]&1|_[1]&524288&&(b.$$scope={dirty:_,ctx:v}),n.$set(b),(!g||_[0]&1)&&o!==(o=C.items.book[v[39].id].name+"")&&G(r,o),(!g||_[0]&1)&&u!==(u=v[39].minlevel+"")&&G(m,u)},i(v){g||(P(n.$$.fragment,v),g=!0)},o(v){I(n.$$.fragment,v),g=!1},d(v){v&&x(e),ee(n)}}}function zD(t){let e,n,i,s,o,r=(t[1]?t[1]:`${C.ui.stats.array[23]}: ${t[8]}`)+"",l,a,c,f,u,m,g,v,_,b=t[12]&&x6(t),y=me(t[3]),k=[];for(let D=0;D<y.length;D+=1)k[D]=S6(_6(t,y,D));let A=D=>I(k[D],1,1,()=>{k[D]=null}),S=me(Array.from(Pt.values()).filter(t[29]).sort(P6)),F=[];for(let D=0;D<S.length;D+=1)F[D]=A6(v6(t,S,D));let M=D=>I(F[D],1,1,()=>{F[D]=null});return{c(){e=h("div"),b&&b.c(),n=h("div");for(let D=0;D<k.length;D+=1)k[D].c();i=he();for(let D=0;D<F.length;D+=1)F[D].c();s=h("div"),o=h("span"),l=T(r),c=h("div"),f=T("Activate Skills"),m=h("span"),p(n,"id","skilllist"),p(n,"class","scrollbar panel-black skilllist svelte-1e0alkc"),p(o,"class",a=t[1]?"textred":t[8]>0?"textprimary":"textgrey"),p(c,"id","tutapplyskills"),p(c,"class",u="btn "+(t[4]?"green":"grey disabled")),p(s,"class","panel-black bar-bot svelte-1e0alkc"),p(e,"class","flexer svelte-1e0alkc")},m(D,R){w(D,e,R),b&&b.m(e,null),d(e,n);for(let E=0;E<k.length;E+=1)k[E]&&k[E].m(n,null);d(n,i);for(let E=0;E<F.length;E+=1)F[E]&&F[E].m(n,null);d(e,s),d(s,o),d(o,l),d(s,c),d(c,f),d(s,m),t[30](e),g=!0,v||(_=Y(c,"click",t[13]),v=!0)},p(D,R){if(D[12]?b?b.p(D,R):(b=x6(D),b.c(),b.m(e,n)):b&&(b.d(1),b=null),R[0]&16924){y=me(D[3]);let E;for(E=0;E<y.length;E+=1){let L=_6(D,y,E);k[E]?(k[E].p(L,R),P(k[E],1)):(k[E]=S6(L),k[E].c(),P(k[E],1),k[E].m(n,i))}for(Ee(),E=y.length;E<k.length;E+=1)A(E);Ie()}if(R[0]&5){S=me(Array.from(Pt.values()).filter(D[29]).sort(P6));let E;for(E=0;E<S.length;E+=1){let L=v6(D,S,E);F[E]?(F[E].p(L,R),P(F[E],1)):(F[E]=A6(L),F[E].c(),P(F[E],1),F[E].m(n,null))}for(Ee(),E=S.length;E<F.length;E+=1)M(E);Ie()}(!g||R[0]&258)&&r!==(r=(D[1]?D[1]:`${C.ui.stats.array[23]}: ${D[8]}`)+"")&&G(l,r),(!g||R[0]&258&&a!==(a=D[1]?"textred":D[8]>0?"textprimary":"textgrey"))&&p(o,"class",a),(!g||R[0]&16&&u!==(u="btn "+(D[4]?"green":"grey disabled")))&&p(c,"class",u)},i(D){if(!g){for(let R=0;R<y.length;R+=1)P(k[R]);for(let R=0;R<S.length;R+=1)P(F[R]);g=!0}},o(D){k=k.filter(Boolean);for(let R=0;R<k.length;R+=1)I(k[R]);F=F.filter(Boolean);for(let R=0;R<F.length;R+=1)I(F[R]);g=!1},d(D){D&&x(e),b&&b.d(),it(k,D),it(F,D),t[30](null),v=!1,_()}}}function BD(t){let e,n,i=t[11]&&k6(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,o){s[11]?i?(i.p(s,o),o[0]&2048&&P(i,1)):(i=k6(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}var P6=(t,e)=>t.minlevel-e.minlevel;function UD(t,e,n){let i,s,o,r,l,a,c,f,u;se(t,Oc,be=>n(0,o=be)),se(t,ka,be=>n(10,r=be)),se(t,jo,be=>n(19,l=be)),se(t,$c,be=>n(1,a=be)),se(t,Oo,be=>n(20,c=be)),se(t,ho,be=>n(11,f=be)),se(t,bf,be=>n(12,u=be));let m,g=be=>{let H=[];return be.forEach((pe,Be)=>{for(let Ge=0;Ge<pe.level;++Ge)H.push(pe.id)}),H},v=()=>{let be=S.filter(H=>!Pt.get(H)?.engineOnly);xt("skillconfig",be),n(4,b=!1),Qe($c,a=void 0,a),sn(28,100)},_=[],b=!1,y=!1,k=(be,H)=>{n(3,_=[]),be.forEach((pe,Be)=>{let Ge=Pt.get(Be);_.push({id:Be,level:pe,minlevel:Ge.minlevel,learned:H.get(Be)||0,engineOnly:Ge.engineOnly,pickable:Ge.onCast!==void 0})}),H.forEach((pe,Be)=>{if(!be.has(Be)){let Ge=Pt.get(Be);_.push({id:Be,level:0,minlevel:Ge.minlevel,learned:pe,engineOnly:Ge.engineOnly,pickable:Ge.onCast!==void 0})}}),_.sort((pe,Be)=>pe.id-Be.id)},A=()=>{F=g(_);let be=F.filter(H=>!Pt.get(H)?.engineOnly);n(18,M=O1(be))},S=[],F=[],M=0,D=(be,H)=>{be.level+=H,n(3,_),sn(27,100),R()},R=()=>{S=g(_);let be=S.filter(Ge=>!Pt.get(Ge)?.engineOnly);n(18,M=O1(be));let H=S.sort().join(","),pe=F.sort().join(",");n(4,b=S.length&&H!==pe);let Be=r.find(Ge=>H===Ge.skills.sort().join(","));Be?(n(7,z=Be.name),n(5,y=!1)):(n(7,z=void 0),n(5,y=!0))},E,L=()=>{E!==void 0&&(ka.update(be=>(be=be.filter(H=>H.name!==E||H.pclass!==V.player.class),be.push({name:E,skills:g(_),pclass:V.player.class}),be)),n(7,z=E),n(6,E=void 0),n(5,y=!1))},z,q=be=>{let H=r.find(pe=>pe.name===z&&pe.pclass===V.player.class);if(H){let pe=new Map;H.skills.forEach(Be=>{pe.has(Be)?pe.set(Be,pe.get(Be)+1):pe.set(Be,1)}),k(pe,o),R(),b&&v()}},j=()=>{ka.update(be=>be.filter(H=>H.name!==z)),n(7,z=void 0),n(5,y=!0)},W=be=>be.pclass===V.player.class,U=be=>be.pclass===V.player.class;function O(){z=ki(this),n(7,z)}let Z=be=>n(6,E="");function ve(){E=this.value,n(6,E)}let Fe=be=>n(6,E=void 0),_e=(be,H)=>D(be,-1),ce=(be,H)=>D(be,1),fe=be=>be.class===V.player.class&&!be.engineOnly&&!o.has(be.id);function ze(be){Bt[be?"unshift":"push"](()=>{m=be,n(2,m)})}let Pe=()=>{Qe(bf,u=!u,u)},Me=()=>{Qe(ho,f=!1,f)};return t.$$.update=()=>{t.$$.dirty[0]&1048577&&(k(c,o),A(),R()),t.$$.dirty[0]&2&&a&&n(4,b=!0),t.$$.dirty[0]&786432&&n(9,i=l[24]-M),t.$$.dirty[0]&786432&&n(8,s=l[24]-M)},[o,a,m,_,b,y,E,z,s,i,r,f,u,v,D,L,q,j,M,l,c,W,U,O,Z,ve,Fe,_e,ce,fe,ze,Pe,Me]}var Og=class extends xe{constructor(e){super(),Ce(this,e,UD,BD,Ue,{},null,[-1,-1])}},T6=Og;function E6(t,e,n){let i=t.slice();return i[19]=e[n],i[21]=n,i}function I6(t){let e,n,i=me(t[1]),s=[];for(let r=0;r<i.length;r+=1)s[r]=V6(E6(t,i,r));let o=null;return i.length||(o=D6(t)),{c(){e=h("div");for(let r=0;r<s.length;r+=1)s[r].c();n=he(),o&&o.c(),p(e,"class","divider")},m(r,l){w(r,e,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(r,l);w(r,n,l),o&&o.m(r,l)},p(r,l){if(l&74){i=me(r[1]);let a;for(a=0;a<i.length;a+=1){let c=E6(r,i,a);s[a]?s[a].p(c,l):(s[a]=V6(c),s[a].c(),s[a].m(n.parentNode,n))}for(;a<s.length;a+=1)s[a].d(1);s.length=i.length,!i.length&&o?o.p(r,l):i.length?o&&(o.d(1),o=null):(o=D6(r),o.c(),o.m(n.parentNode,n))}},d(r){r&&(x(e),x(n)),it(s,r),o&&o.d(r)}}}function D6(t){let e;return{c(){e=h("div"),e.textContent="No results",p(e,"class","textgrey result svelte-17jb1r5")},m(n,i){w(n,e,i)},p:ae,d(n){n&&x(e)}}}function V6(t){let e,n,i=t[19].name+"",s,o,r=t[19].type+"",l,a,c,f=(t[19].level||1)+"",u,m,g,v;function _(...b){return t[14](t[21],...b)}return{c(){e=h("div"),n=h("span"),s=T(i),o=h("span"),l=T(r),a=h("span"),c=T("Lv. "),u=T(f),p(o,"class","textgrey infocol svelte-17jb1r5"),p(a,"class","infocol svelte-17jb1r5"),p(e,"class",m="result "+(t[21]===t[3]?"sel":"")+" svelte-17jb1r5")},m(b,y){w(b,e,y),d(e,n),d(n,s),d(e,o),d(o,l),d(e,a),d(a,c),d(a,u),g||(v=Y(e,"mousedown",_),g=!0)},p(b,y){t=b,y&2&&i!==(i=t[19].name+"")&&G(s,i),y&2&&r!==(r=t[19].type+"")&&G(l,r),y&2&&f!==(f=(t[19].level||1)+"")&&G(u,f),y&8&&m!==(m="result "+(t[21]===t[3]?"sel":"")+" svelte-17jb1r5")&&p(e,"class",m)},d(b){b&&x(e),g=!1,v()}}}function OD(t){let e,n,i,s,o,r,l,a=t[2]&&I6(t);return{c(){e=h("div"),n=h("div"),i=h("input"),a&&a.c(),p(i,"placeholder",s=C.ui.merchant.itemSearch),p(i,"type","search"),p(n,"class",o="container input "+(t[2]?"focus":"")),p(e,"class","navbtn finder")},m(c,f){w(c,e,f),d(e,n),d(n,i),t[11](i),Ne(i,t[0]),a&&a.m(n,null),r||(l=[Y(i,"input",t[12]),Y(i,"input",t[5]),Y(i,"focus",t[13]),Y(i,"blur",t[7])],r=!0)},p(c,[f]){f&1&&i.value!==c[0]&&Ne(i,c[0]),c[2]?a?a.p(c,f):(a=I6(c),a.c(),a.m(n,null)):a&&(a.d(1),a=null),f&4&&o!==(o="container input "+(c[2]?"focus":""))&&p(n,"class",o)},i:ae,o:ae,d(c){c&&x(e),t[11](null),a&&a.d(),r=!1,at(l)}}}function $D(t,e,n){let i=lo(),s=rr.filter(M=>M.level<=45||M.type==="rune"&&M.tier===5).map(M=>({name:tn(M.type,M.tier),type:M.type,tier:M.tier,level:M.level})),o=()=>{let M=a.toLowerCase();M.length?n(1,f=s.filter(D=>D.type===M||D.name.toLowerCase().includes(M)).slice(0,c)):n(1,f=[]),m>=f.length&&_(f.length-1)},{type:r}=e,{tier:l}=e,{name:a=""}=e,{limit:c=5}=e,f=[],u=!1,m=-1,g,v,_=M=>{n(3,m=M),m>=0?(g=f[m],n(0,a=g.name),n(8,r=g.type),n(9,l=g.tier)):(g=void 0,n(0,a=""),n(8,r="all"),n(9,l="all"))},b=M=>{M.target==v&&((M.keyCode===38||M.keyCode===40)&&f.length?(_(wa(m+(M.keyCode===38?-1:1),f.length)),M.preventDefault()):(M.keyCode==13||M.keyCode==27)&&v.blur())},y=M=>{n(2,u=!1),_(Math.min(Math.max(0,m),f.length-1)),m>=0&&i("finalize")};Fn(()=>{document.addEventListener("keydown",b)}),Tn(()=>{document.removeEventListener("keydown",b),n(4,v=void 0)});function k(M){Bt[M?"unshift":"push"](()=>{v=M,n(4,v)})}function A(){a=this.value,n(0,a)}let S=M=>n(2,u=!0),F=(M,D)=>_(M);return t.$$set=M=>{"type"in M&&n(8,r=M.type),"tier"in M&&n(9,l=M.tier),"name"in M&&n(0,a=M.name),"limit"in M&&n(10,c=M.limit)},[a,f,u,m,v,o,_,y,r,l,c,k,A,S,F]}var $g=class extends xe{constructor(e){super(),Ce(this,e,$D,OD,Ue,{type:8,tier:9,name:0,limit:10})}},L6=$g;var q6=t=>9+Math.ceil(t*.001);function R6(t,e,n){let i=t.slice();return i[55]=e[n],i}function z6(t,e,n){let i=t.slice();return i[58]=e[n],i[60]=n,i}function B6(t){let e,n;return e=new jt({props:{origin:"left top",defaultOffset:[0,100],title:"Merchant",$$slots:{default:[XD]},$$scope:{ctx:t}}}),e.$on("close",t[50]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&2097135|s[1]&1073741824&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function ND(t){let e,n=t[58]+"",i,s,o,r;function l(...a){return t[44](t[58],...a)}return{c(){e=h("div"),i=T(n),p(e,"class",s="choice "+(t[58]==t[6]?"active":"")+" svelte-35lzg4")},m(a,c){w(a,e,c),d(e,i),o||(r=Y(e,"click",l),o=!0)},p(a,c){t=a,c[0]&64&&s!==(s="choice "+(t[58]==t[6]?"active":"")+" svelte-35lzg4")&&p(e,"class",s)},d(a){a&&x(e),o=!1,r()}}}function jD(t){let e;return{c(){e=h("div"),p(e,"class","divider svelte-35lzg4")},m(n,i){w(n,e,i)},p:ae,d(n){n&&x(e)}}}function U6(t){let e;function n(o,r){return o[58]===null?jD:ND}let s=n(t,[-1,-1])(t);return{c(){s.c(),e=he()},m(o,r){s.m(o,r),w(o,e,r)},p(o,r){s.p(o,r)},d(o){o&&x(e),s.d(o)}}}function O6(t){let e,n,i,s=tn(t[55].temp.type,t[55].temp.tier)+"",o,r,l,a=(t[55].temp.logic.level||1)+"",c,f,u,m=t[55].temp.owner+"",g,v,_=t[27](t[55].temp.auction.getTime())+"",b,y,k,A=t[13]&&t[55].temp.stacks>0?t[55].temp.stacks+" x ":"",S,F,M,D,R,E;n=new bi({props:{shift:t[20],descPos:"right:0;top:0;",descRoot:t[5],pickable:!1,item:t[55]}}),F=new xn({props:{amount:t[13]&&t[55].temp.stacks>0?Math.ceil(t[55].temp.auctionprice/t[55].temp.stacks):t[55].temp.auctionprice}});function L(...z){return t[47](t[55],...z)}return{c(){e=h("div"),ne(n.$$.fragment),i=h("span"),o=T(s),l=h("span"),c=T(a),u=h("span"),g=T(m),v=h("span"),b=T(_),y=h("div"),k=h("span"),S=T(A),ne(F.$$.fragment),p(i,"class",r="marg text"+Ut(t[55].temp.quality)[0]+" svelte-35lzg4"),qe(i,"margin-left","6px"),p(l,"class",f="marg "+(V.player.level>=t[55].temp.logic.level?"textgreen":"textred")+" svelte-35lzg4"),p(u,"class","marg svelte-35lzg4"),p(v,"class","marg svelte-35lzg4"),p(k,"class","textgreen"),p(y,"class","marg svelte-35lzg4"),qe(y,"text-align","end"),p(e,"class",M="buy "+(t[18]==t[55]?"selected":"")+" item panel-black svelte-35lzg4")},m(z,q){w(z,e,q),K(n,e,null),d(e,i),d(i,o),d(e,l),d(l,c),d(e,u),d(u,g),d(e,v),d(v,b),d(e,y),d(y,k),d(k,S),K(F,y,null),D=!0,R||(E=Y(e,"click",L),R=!0)},p(z,q){t=z;let j={};q[0]&1048576&&(j.shift=t[20]),q[0]&32&&(j.descRoot=t[5]),q[0]&131072&&(j.item=t[55]),n.$set(j),(!D||q[0]&131072)&&s!==(s=tn(t[55].temp.type,t[55].temp.tier)+"")&&G(o,s),(!D||q[0]&131072&&r!==(r="marg text"+Ut(t[55].temp.quality)[0]+" svelte-35lzg4"))&&p(i,"class",r),(!D||q[0]&131072)&&a!==(a=(t[55].temp.logic.level||1)+"")&&G(c,a),(!D||q[0]&131072&&f!==(f="marg "+(V.player.level>=t[55].temp.logic.level?"textgreen":"textred")+" svelte-35lzg4"))&&p(l,"class",f),(!D||q[0]&131072)&&m!==(m=t[55].temp.owner+"")&&G(g,m),(!D||q[0]&131072)&&_!==(_=t[27](t[55].temp.auction.getTime())+"")&&G(b,_),(!D||q[0]&139264)&&A!==(A=t[13]&&t[55].temp.stacks>0?t[55].temp.stacks+" x ":"")&&G(S,A);let W={};q[0]&139264&&(W.amount=t[13]&&t[55].temp.stacks>0?Math.ceil(t[55].temp.auctionprice/t[55].temp.stacks):t[55].temp.auctionprice),F.$set(W),(!D||q[0]&393216&&M!==(M="buy "+(t[18]==t[55]?"selected":"")+" item panel-black svelte-35lzg4"))&&p(e,"class",M)},i(z){D||(P(n.$$.fragment,z),P(F.$$.fragment,z),D=!0)},o(z){I(n.$$.fragment,z),I(F.$$.fragment,z),D=!1},d(z){z&&x(e),ee(n),ee(F),R=!1,E()}}}function WD(t){let e,n,i,s,o=[YD,HD],r=[];function l(a,c){return a[18].temp.owner!==V.player.name?0:1}return n=l(t,[-1,-1]),i=r[n]=o[n](t),{c(){e=h("section"),i.c(),p(e,"class","confirm panel-black svelte-35lzg4")},m(a,c){w(a,e,c),r[n].m(e,null),s=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(Ee(),I(r[f],1,1,()=>{r[f]=null}),Ie(),i=r[n],i?i.p(a,c):(i=r[n]=o[n](a),i.c()),P(i,1),i.m(e,null))},i(a){s||(P(i),s=!0)},o(a){I(i),s=!1},d(a){a&&x(e),r[n].d()}}}function GD(t){let e,n,i,s=(t[3]?tn(t[3].type,t[3].tier):C.ui.merchant.dragitem)+"",o,r,l,a,c=C.ui.merchant.price+"",f,u,m,g,v,_,b=C.ui.merchant.fee+"",y,k,A,S,F,M,D=C.ui.merchant.post+"",R,E,L,z,q,j;n=new bi({props:{descPos:"left:100%;bottom:100%;",clearOnMove:!0,invslot:void 0,pickable:!0,item:fs}}),n.$on("discard",t[26]),n.$on("move",t[25]),n.$on("click",t[26]),n.$on("context",t[26]),m=new xn({props:{amount:t[1]}}),A=new xn({props:{amount:t[15]}});let W=t[3]&&t[3].stacks>0&&$6(t);return{c(){e=h("section"),ne(n.$$.fragment),i=h("span"),o=T(s),l=h("div"),a=h("span"),f=T(c),u=T(": "),ne(m.$$.fragment),g=We(),v=h("br"),_=h("span"),y=T(b),k=T(": "),ne(A.$$.fragment),S=h("input"),W&&W.c(),M=h("div"),R=T(D),p(i,"class",r="marg text"+(t[3]?Ut(t[3].quality)[0]:"grey")+" svelte-35lzg4"),p(a,"class","textwhite"),p(_,"class","textgrey"),p(l,"class","marg svelte-35lzg4"),qe(l,"text-align","end"),p(S,"class","marg svelte-35lzg4"),p(S,"type","number"),p(S,"placeholder",F=C.ui.merchant.setPrice),p(M,"class",E="marg btn formatted secondary "+(t[16]?"":"disabled")+" svelte-35lzg4"),p(e,"class",L="post "+(t[3]&&t[3].stacks>0?"postStacks":"")+" panel-black svelte-35lzg4")},m(U,O){w(U,e,O),K(n,e,null),d(e,i),d(i,o),d(e,l),d(l,a),d(a,f),d(a,u),K(m,a,null),d(a,g),d(l,v),d(l,_),d(_,y),d(_,k),K(A,_,null),d(e,S),Ne(S,t[0]),W&&W.m(e,null),d(e,M),d(M,R),z=!0,q||(j=[Y(S,"input",t[48]),Y(M,"click",t[24])],q=!0)},p(U,O){(!z||O[0]&8)&&s!==(s=(U[3]?tn(U[3].type,U[3].tier):C.ui.merchant.dragitem)+"")&&G(o,s),(!z||O[0]&8&&r!==(r="marg text"+(U[3]?Ut(U[3].quality)[0]:"grey")+" svelte-35lzg4"))&&p(i,"class",r);let Z={};O[0]&2&&(Z.amount=U[1]),m.$set(Z);let ve={};O[0]&32768&&(ve.amount=U[15]),A.$set(ve),O[0]&1&&Wt(S.value)!==U[0]&&Ne(S,U[0]),U[3]&&U[3].stacks>0?W?W.p(U,O):(W=$6(U),W.c(),W.m(e,M)):W&&(W.d(1),W=null),(!z||O[0]&65536&&E!==(E="marg btn formatted secondary "+(U[16]?"":"disabled")+" svelte-35lzg4"))&&p(M,"class",E),(!z||O[0]&8&&L!==(L="post "+(U[3]&&U[3].stacks>0?"postStacks":"")+" panel-black svelte-35lzg4"))&&p(e,"class",L)},i(U){z||(P(n.$$.fragment,U),P(m.$$.fragment,U),P(A.$$.fragment,U),z=!0)},o(U){I(n.$$.fragment,U),I(m.$$.fragment,U),I(A.$$.fragment,U),z=!1},d(U){U&&x(e),ee(n),ee(m),ee(A),W&&W.d(),q=!1,at(j)}}}function HD(t){let e,n,i,s=tn(t[18].temp.type,t[18].temp.tier)+"",o,r,l,a,c,f,u;return{c(){e=h("span"),n=T("Stop "),i=h("span"),o=T(s),l=T(" from being listed?"),a=h("div"),a.textContent=`${C.ui.cancel}`,c=h("div"),c.textContent=`${C.ui.merchant.delist}`,p(i,"class",r="text"+Ut(t[18].temp.quality)[0]+" svelte-35lzg4"),p(e,"class","marg svelte-35lzg4"),p(a,"class","marg btn formatted grey svelte-35lzg4"),p(c,"class","marg btn formatted orange svelte-35lzg4")},m(m,g){w(m,e,g),d(e,n),d(e,i),d(i,o),d(e,l),w(m,a,g),w(m,c,g),f||(u=[Y(a,"click",t[29]),Y(c,"click",t[31])],f=!0)},p(m,g){g[0]&262144&&s!==(s=tn(m[18].temp.type,m[18].temp.tier)+"")&&G(o,s),g[0]&262144&&r!==(r="text"+Ut(m[18].temp.quality)[0]+" svelte-35lzg4")&&p(i,"class",r)},i:ae,o:ae,d(m){m&&(x(e),x(a),x(c)),f=!1,at(u)}}}function YD(t){let e,n=C.ui.merchant.buyItem[0]+"",i,s,o,r=t[18].temp.stacks>0?t[18].temp.stacks+" x ":"",l,a,c=tn(t[18].temp.type,t[18].temp.tier)+"",f,u,m,g=C.ui.merchant.buyItem[1]+"",v,_,b,y,k=C.ui.merchant.buyItem[2]+"",A,S,F,M,D,R;return b=new xn({props:{amount:t[18].temp.auctionprice}}),{c(){e=h("span"),i=T(n),s=We(),o=h("span"),l=T(r),a=h("span"),f=T(c),m=We(),v=T(g),_=We(),ne(b.$$.fragment),y=We(),A=T(k),S=h("div"),S.textContent=`${C.ui.cancel}`,F=h("div"),F.textContent=`${C.ui.merchant.buy}`,p(o,"class","textgreen"),p(a,"class",u="text"+Ut(t[18].temp.quality)[0]+" svelte-35lzg4"),p(e,"class","marg svelte-35lzg4"),p(S,"class","marg btn formatted grey svelte-35lzg4"),p(F,"class","marg btn formatted secondary svelte-35lzg4")},m(E,L){w(E,e,L),d(e,i),d(e,s),d(e,o),d(o,l),d(e,a),d(a,f),d(e,m),d(e,v),d(e,_),K(b,e,null),d(e,y),d(e,A),w(E,S,L),w(E,F,L),M=!0,D||(R=[Y(S,"click",t[29]),Y(F,"click",t[30])],D=!0)},p(E,L){(!M||L[0]&262144)&&r!==(r=E[18].temp.stacks>0?E[18].temp.stacks+" x ":"")&&G(l,r),(!M||L[0]&262144)&&c!==(c=tn(E[18].temp.type,E[18].temp.tier)+"")&&G(f,c),(!M||L[0]&262144&&u!==(u="text"+Ut(E[18].temp.quality)[0]+" svelte-35lzg4"))&&p(a,"class",u);let z={};L[0]&262144&&(z.amount=E[18].temp.auctionprice),b.$set(z)},i(E){M||(P(b.$$.fragment,E),M=!0)},o(E){I(b.$$.fragment,E),M=!1},d(E){E&&(x(e),x(S),x(F)),ee(b),D=!1,at(R)}}}function $6(t){let e,n,i,s,o,r,l;return{c(){e=h("select"),n=h("option"),n.textContent="Total",s=h("option"),s.textContent="Per Unit",n.__value=i=!1,Ne(n,n.__value),s.__value=o=!0,Ne(s,s.__value),p(e,"class","marg formatted svelte-35lzg4"),t[2]===void 0&&_n(()=>t[49].call(e))},m(a,c){w(a,e,c),d(e,n),d(e,s),Mn(e,t[2],!0),r||(l=Y(e,"change",t[49]),r=!0)},p(a,c){c[0]&4&&Mn(e,a[2])},d(a){a&&x(e),r=!1,l()}}}function XD(t){let e,n,i,s,o,r,l,a,c=C.ui.merchant.search+"",f,u,m,g=C.ui.merchant.previous+"",v,_,b,y=C.ui.merchant.next+"",k,A,S,F,M,D,R,E,L,z,q,j=C.ui.merchant.results+"",W,U,O=t[14]+1+"",Z,ve,Fe=Math.ceil(t[19]/50)+"",_e,ce,fe,ze,Pe,Me=t[32](t[10],"time",t[11])+"",be,H=C.ui.merchant.time+"",pe,Be,Ge,Xe=(t[12]?C.ui.merchant.perUnit:C.ui.merchant.total)+"",Ye,ue,oe,$e=t[32](t[10],"price",t[11])+"",J,Q=C.ui.merchant.price+"",$,le,je,Ve,ke,Re,Oe,pt,wt;function Je(He){t[37](He)}function Et(He){t[38](He)}function ye(He){t[39](He)}let Ke={limit:10};t[8]!==void 0&&(Ke.name=t[8]),t[7]!==void 0&&(Ke.tier=t[7]),t[6]!==void 0&&(Ke.type=t[6]),i=new L6({props:Ke}),Bt.push(()=>zo(i,"name",Je)),Bt.push(()=>zo(i,"tier",Et)),Bt.push(()=>zo(i,"type",ye)),i.$on("finalize",t[23]);let yt=me(t[22]),St=[];for(let He=0;He<yt.length;He+=1)St[He]=U6(z6(t,yt,He));let Te=me(t[17]),ft=[];for(let He=0;He<Te.length;He+=1)ft[He]=O6(R6(t,Te,He));let $t=He=>I(ft[He],1,1,()=>{ft[He]=null}),Le=[GD,WD],Ct=[];function Lt(He,et){return He[18]?1:0}return ke=Lt(t,[-1,-1]),Re=Ct[ke]=Le[ke](t),{c(){e=h("div"),n=h("section"),ne(i.$$.fragment),l=h("span"),a=h("div"),f=T(c),m=h("div"),v=T(g),b=h("div"),k=T(y),S=h("section");for(let He=0;He<St.length;He+=1)St[He].c();F=h("section"),M=h("div"),D=h("div"),R=h("div"),E=h("span"),L=h("span"),z=T(t[19]),q=We(),W=T(j),U=T(" ("),Z=T(O),ve=T("/"),_e=T(Fe),ce=T(")"),fe=h("span"),fe.textContent="Lv.",ze=h("span"),ze.textContent=`${C.ui.merchant.owner}`,Pe=h("span"),be=T(Me),pe=T(H),Ge=h("span"),Ye=T(Xe),oe=h("span"),J=T($e),$=T(Q),le=We(),Ve=h("div");for(let He=0;He<ft.length;He+=1)ft[He].c();Re.c(),p(a,"class",u="btn formatted secondary "+(t[9]?"":"disabled")),p(m,"class",_="btn formatted grey "+(t[9]&&t[14]>0?"":"disabled")),p(b,"class",A="btn formatted grey "+(t[9]&&t[17].length==50?"":"disabled")),p(n,"class","search panel-black svelte-35lzg4"),p(S,"class","choices border grey scrollbar svelte-35lzg4"),p(L,"class","btn black disabled textgrey"),p(fe,"class","btn black disabled textgrey"),p(ze,"class","btn black disabled textgrey"),p(Pe,"class",Be="btn grey "+(t[9]?"":"disabled")+" "+(t[10]=="time"?"textprimary active":"")),p(Ge,"class",ue="btn grey "+(t[9]?"":"disabled")+" "+(t[12]?"textgreen":"")),qe(Ge,"text-align","end"),p(oe,"class",je="btn grey "+(t[9]?"":"disabled")+" "+(t[10]=="price"?"textprimary active":"")),qe(oe,"text-align","end"),p(R,"class","buytblhead svelte-35lzg4"),p(D,"class","scrollbar scrollbar-fix"),p(Ve,"class","scrollbar scrollbar-fix"),p(M,"class","buytable svelte-35lzg4"),p(F,"class","items border grey svelte-35lzg4"),p(e,"class","layout svelte-35lzg4")},m(He,et){w(He,e,et),d(e,n),K(i,n,null),d(n,l),d(n,a),d(a,f),d(n,m),d(m,v),d(n,b),d(b,k),t[43](n),d(e,S);for(let Se=0;Se<St.length;Se+=1)St[Se]&&St[Se].m(S,null);d(e,F),d(F,M),d(M,D),d(D,R),d(R,E),d(R,L),d(L,z),d(L,q),d(L,W),d(L,U),d(L,Z),d(L,ve),d(L,_e),d(L,ce),d(R,fe),d(R,ze),d(R,Pe),d(Pe,be),d(Pe,pe),d(R,Ge),d(Ge,Ye),d(R,oe),d(oe,J),d(oe,$),d(oe,le),d(M,Ve);for(let Se=0;Se<ft.length;Se+=1)ft[Se]&&ft[Se].m(Ve,null);Ct[ke].m(e,null),Oe=!0,pt||(wt=[Y(a,"click",t[40]),Y(m,"click",t[41]),Y(b,"click",t[42]),Y(Pe,"click",t[45]),Y(Ge,"click",t[34]),Y(oe,"click",t[46])],pt=!0)},p(He,et){let Se={};if(!s&&et[0]&256&&(s=!0,Se.name=He[8],Ro(()=>s=!1)),!o&&et[0]&128&&(o=!0,Se.tier=He[7],Ro(()=>o=!1)),!r&&et[0]&64&&(r=!0,Se.type=He[6],Ro(()=>r=!1)),i.$set(Se),(!Oe||et[0]&512&&u!==(u="btn formatted secondary "+(He[9]?"":"disabled")))&&p(a,"class",u),(!Oe||et[0]&16896&&_!==(_="btn formatted grey "+(He[9]&&He[14]>0?"":"disabled")))&&p(m,"class",_),(!Oe||et[0]&131584&&A!==(A="btn formatted grey "+(He[9]&&He[17].length==50?"":"disabled")))&&p(b,"class",A),et[0]&12599744){yt=me(He[22]);let Ze;for(Ze=0;Ze<yt.length;Ze+=1){let ut=z6(He,yt,Ze);St[Ze]?St[Ze].p(ut,et):(St[Ze]=U6(ut),St[Ze].c(),St[Ze].m(S,null))}for(;Ze<St.length;Ze+=1)St[Ze].d(1);St.length=yt.length}if((!Oe||et[0]&524288)&&G(z,He[19]),(!Oe||et[0]&16384)&&O!==(O=He[14]+1+"")&&G(Z,O),(!Oe||et[0]&524288)&&Fe!==(Fe=Math.ceil(He[19]/50)+"")&&G(_e,Fe),(!Oe||et[0]&3072)&&Me!==(Me=He[32](He[10],"time",He[11])+"")&&G(be,Me),(!Oe||et[0]&1536&&Be!==(Be="btn grey "+(He[9]?"":"disabled")+" "+(He[10]=="time"?"textprimary active":"")))&&p(Pe,"class",Be),(!Oe||et[0]&4096)&&Xe!==(Xe=(He[12]?C.ui.merchant.perUnit:C.ui.merchant.total)+"")&&G(Ye,Xe),(!Oe||et[0]&4608&&ue!==(ue="btn grey "+(He[9]?"":"disabled")+" "+(He[12]?"textgreen":"")))&&p(Ge,"class",ue),(!Oe||et[0]&3072)&&$e!==($e=He[32](He[10],"price",He[11])+"")&&G(J,$e),(!Oe||et[0]&1536&&je!==(je="btn grey "+(He[9]?"":"disabled")+" "+(He[10]=="price"?"textprimary active":"")))&&p(oe,"class",je),et[0]&404103200){Te=me(He[17]);let Ze;for(Ze=0;Ze<Te.length;Ze+=1){let ut=R6(He,Te,Ze);ft[Ze]?(ft[Ze].p(ut,et),P(ft[Ze],1)):(ft[Ze]=O6(ut),ft[Ze].c(),P(ft[Ze],1),ft[Ze].m(Ve,null))}for(Ee(),Ze=Te.length;Ze<ft.length;Ze+=1)$t(Ze);Ie()}let ot=ke;ke=Lt(He,et),ke===ot?Ct[ke].p(He,et):(Ee(),I(Ct[ot],1,1,()=>{Ct[ot]=null}),Ie(),Re=Ct[ke],Re?Re.p(He,et):(Re=Ct[ke]=Le[ke](He),Re.c()),P(Re,1),Re.m(e,null))},i(He){if(!Oe){P(i.$$.fragment,He);for(let et=0;et<Te.length;et+=1)P(ft[et]);P(Re),Oe=!0}},o(He){I(i.$$.fragment,He),ft=ft.filter(Boolean);for(let et=0;et<ft.length;et+=1)I(ft[et]);I(Re),Oe=!1},d(He){He&&x(e),ee(i),t[43](null),it(St,He),it(ft,He),Ct[ke].d(),pt=!1,at(wt)}}}function QD(t){let e,n,i=t[4]&&B6(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,o){s[4]?i?(i.p(s,o),o[0]&16&&P(i,1)):(i=B6(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function ZD(t,e,n){let i,s,o,r,l,a;se(t,aa,ke=>n(35,i=ke)),se(t,fs,ke=>n(3,s=ke)),se(t,cs,ke=>n(4,o=ke)),se(t,Ir,ke=>n(36,r=ke)),se(t,vm,ke=>n(19,l=ke));let c=nt.shift.store;se(t,c,ke=>n(20,a=ke));let f,u=[C.ui.all,C.ui.merchant.filtermine,null,"bow","hammer","staff","sword",null,"orb","quiver","shield","totem",null,"armlet","armor","boot","glove",null,"amulet","bag","ring",null,"book","rune","misc",null,"mount","pet","box"],m=u[0],g="all",v="",_=[],b=!0,y="price",k=1,A=!1,S=!1,F=0,M=()=>{if(b&&o){n(18,_e=void 0);let ke=u.indexOf(m);xt("itemauctionfind",`${ke} ${ke===1?"all":g} ${y==="time"?0:A?2:1} ${k} ${F}`),n(9,b=!1)}},D,R,E=!1,L,z,q=()=>{z&&xt("itemauctionpost",`${s.dbid} ${R}`)},j=ke=>{let{from:Re,to:Oe}=ke.detail;Re!==Oe&&Re.type=="item"&&fs.set(Re.item)},W=ke=>{s&&s.type&&Mt(zi[s.type].sound),fs.set()},U,O=[],Z=[],ve=()=>{if(U=Date.now(),i.length){let ke=i.map(Re=>Re.dbid);fetch("/api/item/getAuction",{method:"POST",body:JSON.stringify({ids:ke})}).then(async Re=>{let Oe=await Re.json();Oe==="error"||Re.ok===!1?console.error(Oe):(n(17,Z.length=0,Z),i.forEach((pt,wt)=>{let Je=Oe.find(Et=>Et.id===pt.dbid);Je&&(Je.store=O[wt]||(O[wt]=ie()),Je.store.temp=pt,pt.hydrate(Je),Z.push(Je.store))}),n(13,S=A),n(9,b=!0))})}else n(13,S=A),n(9,b=!0),n(17,Z.length=0,Z)},Fe=ke=>{let Re=Math.ceil((ke-U)/6e4);return Re<60?`${Re} m`:`${Math.ceil(Re/60)} h`},_e,ce=ke=>{n(18,_e=ke)},fe=()=>{n(18,_e=void 0)},ze=()=>{xt("itemauctionbuy",_e.temp.dbid+""),fe()},Pe=()=>{xt("itemauctioncancel",_e.temp.dbid+""),fe()},Me=(ke,Re,Oe)=>ke==Re?Oe==1?"\u{1F815} ":"\u{1F817} ":"",be=ke=>{n(14,F=0),ke==y?n(11,k=k==1?0:1):n(10,y=ke),M()},H=()=>{n(12,A=!A),y=="price"?M():n(13,S=A)};fs.subscribe(ke=>{ke!==void 0&&(n(6,m=ke.type),n(7,g=ke.tier),n(11,k=1),n(10,y="price"),n(12,A=!0),n(14,F=0),M())});function pe(ke){v=ke,n(8,v)}function Be(ke){g=ke,n(7,g)}function Ge(ke){m=ke,n(6,m)}let Xe=ke=>{n(14,F=0),M()},Ye=ke=>{n(14,F--,F),M()},ue=ke=>{n(14,F++,F),M()};function oe(ke){Bt[ke?"unshift":"push"](()=>{f=ke,n(5,f)})}let $e=(ke,Re)=>{n(6,m=ke),n(8,v=""),n(7,g="all"),n(14,F=0),M()},J=ke=>be("time"),Q=ke=>be("price"),$=(ke,Re)=>!Re.altKey&&ce(ke);function le(){D=Wt(this.value),n(0,D),n(3,s),n(2,E),n(1,R),n(4,o)}function je(){E=ki(this),n(2,E)}let Ve=()=>{Qe(cs,o=void 0,o),n(8,v=""),n(7,g="all")};return t.$$.update=()=>{t.$$.dirty[0]&16|t.$$.dirty[1]&32&&o&&M(),t.$$.dirty[0]&16&&(o?n(18,_e=void 0):Qe(fs,s=void 0,s)),t.$$.dirty[0]&15&&(vt(),n(0,D=vt(D,0,2147483646)),n(1,R=s?vt((parseInt(D)||0)*(E&&s.stacks||1),0,2147483646):0),n(15,L=Number.isInteger(R)?q6(R):0),n(16,z=Number.isInteger(R)&&R>0&&s&&s.canBeTraded())),t.$$.dirty[1]&16&&ve()},[D,R,E,s,o,f,m,g,v,b,y,k,A,S,F,L,z,Z,_e,l,a,c,u,M,q,j,W,Fe,ce,fe,ze,Pe,Me,be,H,i,r,pe,Be,Ge,Xe,Ye,ue,oe,$e,J,Q,$,le,je,Ve]}var Ng=class extends xe{constructor(e){super(),Ce(this,e,ZD,QD,Ue,{},null,[-1,-1])}},N6=Ng;var gd=[{name:"Year",days:365,price:9e3},{name:"Month",days:30,price:900}],$n=[{sub:!1,stash:15,inventory:15,auction:10,auctionHours:12},{sub:!0,stash:100,inventory:25,auction:100,auctionHours:24}];function j6(t,e,n){let i=t.slice();return i[41]=e[n],i}function W6(t,e,n){let i=t.slice();return i[44]=e[n],i}function G6(t){let e,n;return e=new jt({props:{origin:"left top",defaultOffset:[3,100],title:"Stash",settings:[{name:"Stash Settings",fun:t[33]}],icon:"bag",$$slots:{default:[JD]},$$scope:{ctx:t}}}),e.$on("close",t[34]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&2048&&(o.settings=[{name:"Stash Settings",fun:i[33]}]),s[0]&131071|s[1]&65536&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function H6(t){let e,n,i,s,o,r,l,a=["Ungrouped","Grouped","Groups + Titles"][t[14]]+"",c,f,u,m;return{c(){e=h("div"),n=h("small"),n.textContent="Width",i=h("input"),s=h("small"),s.textContent="Height",o=h("input"),r=h("div"),l=h("small"),c=T(a),p(n,"class","btn textsecondary"),p(i,"type","range"),p(i,"min","7"),p(i,"max","20"),p(s,"class","btn textsecondary"),p(o,"type","range"),p(o,"min","50"),p(o,"max","500"),p(l,"class",f="btn grey text"+["white","green","cyan"][t[14]]+" svelte-rsg9c3"),p(e,"class","panel-black bar-top-config svelte-rsg9c3")},m(g,v){w(g,e,v),d(e,n),d(e,i),Ne(i,t[12]),d(e,s),d(e,o),Ne(o,t[13]),d(e,r),d(e,l),d(l,c),u||(m=[Y(i,"change",t[25]),Y(i,"input",t[25]),Y(o,"change",t[26]),Y(o,"input",t[26]),Y(l,"click",t[27])],u=!0)},p(g,v){v[0]&4096&&Ne(i,g[12]),v[0]&8192&&Ne(o,g[13]),v[0]&16384&&a!==(a=["Ungrouped","Grouped","Groups + Titles"][g[14]]+"")&&G(c,a),v[0]&16384&&f!==(f="btn grey text"+["white","green","cyan"][g[14]]+" svelte-rsg9c3")&&p(l,"class",f)},d(g){g&&x(e),u=!1,at(m)}}}function Y6(t){let e,n=t[41].name+"",i;return{c(){e=h("small"),i=T(n),p(e,"class","textprimary"),qe(e,"display","block"),qe(e,"font-size","10px"),qe(e,"text-transform","uppercase"),qe(e,"letter-spacing","0.1em")},m(s,o){w(s,e,o),d(e,i)},p(s,o){o[0]&16864&&n!==(n=s[41].name+"")&&G(i,n)},d(s){s&&x(e)}}}function X6(t){let e,n;return e=new bi({props:{descPos:"left:100%;top:0;",shift:t[15],descRoot:t[3],pickable:!1,text:t[19](t[44].temp?t[44].temp.getStashTime():0),item:t[44],filter:!t[9]||(!t[44].temp||t[44].temp.getStashTime()>t[4]||"")||t[6].includes(t[44])?!0:""}}),e.$on("click",function(){Rs(t[6].includes(t[44])?void 0:t[20])&&(t[6].includes(t[44])?void 0:t[20]).apply(this,arguments)}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){t=i;let o={};s[0]&32768&&(o.shift=t[15]),s[0]&8&&(o.descRoot=t[3]),s[0]&16864&&(o.text=t[19](t[44].temp?t[44].temp.getStashTime():0)),s[0]&16864&&(o.item=t[44]),s[0]&17392&&(o.filter=!t[9]||(!t[44].temp||t[44].temp.getStashTime()>t[4]||"")||t[6].includes(t[44])?!0:""),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function Q6(t){let e,n,i=t[14]===2&&t[41].stores.length>0&&Y6(t),s=me(t[41].stores),o=[];for(let l=0;l<s.length;l+=1)o[l]=X6(W6(t,s,l));let r=l=>I(o[l],1,1,()=>{o[l]=null});return{c(){i&&i.c(),e=h("div");for(let l=0;l<o.length;l+=1)o[l].c();p(e,"class","slotcontainer svelte-rsg9c3"),qe(e,"width",t[8].length?"fit-content":"auto"),qe(e,"grid-template-columns","repeat("+Math.min(t[8].length,t[12])+", auto)")},m(l,a){i&&i.m(l,a),w(l,e,a);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(e,null);n=!0},p(l,a){if(l[14]===2&&l[41].stores.length>0?i?i.p(l,a):(i=Y6(l),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null),a[0]&1623032){s=me(l[41].stores);let c;for(c=0;c<s.length;c+=1){let f=W6(l,s,c);o[c]?(o[c].p(f,a),P(o[c],1)):(o[c]=X6(f),o[c].c(),P(o[c],1),o[c].m(e,null))}for(Ee(),c=s.length;c<o.length;c+=1)r(c);Ie()}(!n||a[0]&256)&&qe(e,"width",l[8].length?"fit-content":"auto"),(!n||a[0]&4352)&&qe(e,"grid-template-columns","repeat("+Math.min(l[8].length,l[12])+", auto)")},i(l){if(!n){for(let a=0;a<s.length;a+=1)P(o[a]);n=!0}},o(l){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)I(o[a]);n=!1},d(l){l&&x(e),i&&i.d(l),it(o,l)}}}function Z6(t){let e,n,i;return{c(){e=h("span"),e.innerHTML='Upgrade <img class="svgicon texticon" src="/data/ui/icons/gem.svg?v=8602459"/>',p(e,"class","btn textwhite")},m(s,o){w(s,e,o),n||(i=Y(e,"click",t[29]),n=!0)},p:ae,d(s){s&&x(e),n=!1,i()}}}function J6(t){let e,n,i=(t[0]===1?C.ui.stash.deposit:C.ui.stash.withdraw)+"",s,o,r,l,a,c,f,u,m=(t[0]===1?C.ui.stash.deposit:C.ui.stash.withdraw)+"",g,v,_,b,y;return r=new xn({props:{amount:t[0]>0?t[1]:0}}),{c(){e=h("div"),n=h("span"),s=T(i),o=We(),ne(r.$$.fragment),l=T(" ?"),a=h("div"),c=h("input"),f=h("div"),f.textContent="Max",u=h("div"),g=T(m),qe(c,"width","150px"),p(c,"class","navbtn formatted"),p(c,"type","number"),p(f,"class","btn navbtn cyan formatted"),p(u,"class",v="btn navbtn "+(!t[9]||t[1]<=0?"disabled":"")+" "+(t[0]===1?"blue":"green")+" formatted"),p(a,"class","marg-top formelements svelte-rsg9c3"),p(e,"class","panel-black marg-top"),qe(e,"text-align","right")},m(k,A){w(k,e,A),d(e,n),d(n,s),d(n,o),K(r,n,null),d(n,l),d(e,a),d(a,c),Ne(c,t[1]),d(a,f),d(a,u),d(u,g),_=!0,b||(y=[Y(c,"input",t[32]),Y(f,"click",t[22]),Y(u,"click",t[21])],b=!0)},p(k,A){(!_||A[0]&1)&&i!==(i=(k[0]===1?C.ui.stash.deposit:C.ui.stash.withdraw)+"")&&G(s,i);let S={};A[0]&3&&(S.amount=k[0]>0?k[1]:0),r.$set(S),A[0]&2&&Wt(c.value)!==k[1]&&Ne(c,k[1]),(!_||A[0]&1)&&m!==(m=(k[0]===1?C.ui.stash.deposit:C.ui.stash.withdraw)+"")&&G(g,m),(!_||A[0]&515&&v!==(v="btn navbtn "+(!k[9]||k[1]<=0?"disabled":"")+" "+(k[0]===1?"blue":"green")+" formatted"))&&p(u,"class",v)},i(k){_||(P(r.$$.fragment,k),_=!0)},o(k){I(r.$$.fragment,k),_=!1},d(k){k&&x(e),ee(r),b=!1,at(y)}}}function JD(t){let e,n,i,s,o=t[8].length+"",r,l,a=(t[10].subscribed_until?$n[1].stash:$n[0].stash)+"",c,f,u,m,g,v,_,b,y,k,A,S,F,M,D,R,E=t[11]&&H6(t),L=me(t[14]<1?[{stores:t[8],name:""}]:[{stores:t[5],name:V.player.name},{stores:t[7],name:"Account Wide"},{stores:t[6],name:"Other characters"}]),z=[];for(let U=0;U<L.length;U+=1)z[U]=Q6(j6(t,L,U));let q=U=>I(z[U],1,1,()=>{z[U]=null}),j=!t[10].subscribed_until&&Z6(t);m=new xn({props:{amount:t[2].gold}});let W=t[0]>0&&J6(t);return{c(){E&&E.c(),e=h("div");for(let U=0;U<z.length;U+=1)z[U].c();n=h("div"),i=h("div"),s=h("span"),r=T(o),l=T(" / "),c=T(a),j&&j.c(),u=h("div"),ne(m.$$.fragment),g=h("div"),v=h("img"),y=h("div"),k=h("img"),W&&W.c(),F=he(),p(e,"class","panel-black scrollbar marg-top marg-bot slotparent svelte-rsg9c3"),qe(e,"max-height",t[13]+"px"),p(s,"class",f=t[8].length<(t[10].subscribed_until?$n[1].stash:$n[0].stash)?"textgreen":"textred"),p(i,"class","navbtn panel-black border black gold svelte-rsg9c3"),qe(i,"margin-right","auto"),p(u,"class","navbtn panel-black border black gold svelte-rsg9c3"),p(v,"class","svgicon"),lt(v.src,_="/data/ui/icons/deposit.svg?v=8602459")||p(v,"src",_),p(g,"class",b="navbtn btn grey gold "+(t[0]===1?"active":"")+" svelte-rsg9c3"),p(k,"class","svgicon"),lt(k.src,A="/data/ui/icons/withdraw.svg?v=8602459")||p(k,"src",A),p(y,"class",S="navbtn btn grey gold "+(t[0]===2?"active":"")+" svelte-rsg9c3"),p(n,"class","formelements svelte-rsg9c3")},m(U,O){E&&E.m(U,O),w(U,e,O);for(let Z=0;Z<z.length;Z+=1)z[Z]&&z[Z].m(e,null);t[28](e),w(U,n,O),d(n,i),d(i,s),d(s,r),d(s,l),d(s,c),j&&j.m(s,null),d(n,u),K(m,u,null),d(n,g),d(g,v),d(n,y),d(y,k),W&&W.m(U,O),w(U,F,O),M=!0,D||(R=[Y(e,"pointerup",t[18]),Y(g,"click",t[30]),Y(y,"click",t[31])],D=!0)},p(U,O){if(U[11]?E?E.p(U,O):(E=H6(U),E.c(),E.m(e.parentNode,e)):E&&(E.d(1),E=null),O[0]&1627128){L=me(U[14]<1?[{stores:U[8],name:""}]:[{stores:U[5],name:V.player.name},{stores:U[7],name:"Account Wide"},{stores:U[6],name:"Other characters"}]);let ve;for(ve=0;ve<L.length;ve+=1){let Fe=j6(U,L,ve);z[ve]?(z[ve].p(Fe,O),P(z[ve],1)):(z[ve]=Q6(Fe),z[ve].c(),P(z[ve],1),z[ve].m(e,null))}for(Ee(),ve=L.length;ve<z.length;ve+=1)q(ve);Ie()}(!M||O[0]&8192)&&qe(e,"max-height",U[13]+"px"),(!M||O[0]&256)&&o!==(o=U[8].length+"")&&G(r,o),(!M||O[0]&1024)&&a!==(a=(U[10].subscribed_until?$n[1].stash:$n[0].stash)+"")&&G(c,a),U[10].subscribed_until?j&&(j.d(1),j=null):j?j.p(U,O):(j=Z6(U),j.c(),j.m(s,null)),(!M||O[0]&1280&&f!==(f=U[8].length<(U[10].subscribed_until?$n[1].stash:$n[0].stash)?"textgreen":"textred"))&&p(s,"class",f);let Z={};O[0]&4&&(Z.amount=U[2].gold),m.$set(Z),(!M||O[0]&1&&b!==(b="navbtn btn grey gold "+(U[0]===1?"active":"")+" svelte-rsg9c3"))&&p(g,"class",b),(!M||O[0]&1&&S!==(S="navbtn btn grey gold "+(U[0]===2?"active":"")+" svelte-rsg9c3"))&&p(y,"class",S),U[0]>0?W?(W.p(U,O),O[0]&1&&P(W,1)):(W=J6(U),W.c(),P(W,1),W.m(F.parentNode,F)):W&&(Ee(),I(W,1,1,()=>{W=null}),Ie())},i(U){if(!M){for(let O=0;O<L.length;O+=1)P(z[O]);P(m.$$.fragment,U),P(W),M=!0}},o(U){z=z.filter(Boolean);for(let O=0;O<z.length;O+=1)I(z[O]);I(m.$$.fragment,U),I(W),M=!1},d(U){U&&(x(e),x(n),x(F)),E&&E.d(U),it(z,U),t[28](null),j&&j.d(),ee(m),W&&W.d(U),D=!1,at(R)}}}function KD(t){let e,n,i=t[2]&&t[10]&&G6(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,o){s[2]&&s[10]?i?(i.p(s,o),o[0]&1028&&P(i,1)):(i=G6(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function eV(t,e,n){let i,s,o,r,l,a,c,f,u,m,g;se(t,Li,pe=>n(2,i=pe)),se(t,Yi,pe=>n(23,s=pe)),se(t,En,pe=>n(37,o=pe)),se(t,_m,pe=>n(24,r=pe)),se(t,fa,pe=>n(10,l=pe)),se(t,nf,pe=>n(11,a=pe)),se(t,Ho,pe=>n(12,c=pe)),se(t,Yo,pe=>n(13,f=pe)),se(t,va,pe=>n(14,u=pe)),se(t,qi,pe=>n(16,g=pe));let v=nt.shift.store;se(t,v,pe=>n(15,m=pe));let _,b,y={},k=[],A=[],S=[],F=[],M=!1,D,R=async()=>{if(n(4,b=Date.now()),r.all.length){let pe=await fetch("/api/item/getStash",{method:"POST",body:JSON.stringify({ids:r.all.map(Ge=>Ge.dbid)})}),Be=await pe.json();if(Be==="error"||pe.ok===!1)console.error(Be);else{n(8,F.length=n(5,k.length=n(6,A.length=0,A),k),F),n(7,S.length=0,S);let Ge=new Map(r.all.map(Ye=>[Ye.dbid,Ye])),Xe=new Map(Be.map(Ye=>[Ye.id,Ye]));r.all.forEach(Ye=>{let ue=Xe.get(Ye.dbid);ue&&(ue.store=y[ue.id]||(y[ue.id]=ie()),r.other.find(oe=>oe.dbid===ue.id)?A.push(ue.store):r.self.find(oe=>oe.dbid===ue.id)?k.push(ue.store):S.push(ue.store),F.push(ue.store),Ge.has(ue.id)&&(Ge.get(ue.id).hydrate(ue),ue.store.temp=Ge.get(ue.id)))})}}else n(8,F.length=n(5,k.length=n(6,A.length=0,A),k),F),n(7,S.length=0,S);Z()},E=pe=>{o&&(xt("itemstash",`${o.meta.slot}`),Qe(En,o=void 0,o))},L=pe=>pe<b?void 0:`${Math.ceil((pe-b)/6e4)}m`,z=pe=>{M&&(pe.detail.item.getStashTime()>Date.now()?Gt("system",C.ui.stash.waitunstash):(xt("itemunstash",pe.detail.item.dbid+""),O()))},q=pe=>{M&&(xt("goldstash",W===1?U+"":-U+""),O())},j=()=>{n(1,U=W===1?s:i.gold)},W=2,U=0,O=()=>{n(9,M=!1),D=setTimeout(()=>{n(9,M=!0)},500)},Z=()=>{n(9,M=!0),D&&(clearTimeout(D),D=void 0)};function ve(){c=Wt(this.value),Ho.set(c)}function Fe(){f=Wt(this.value),Yo.set(f)}let _e=pe=>Qe(va,u=Qe(va,++u,u)%3,u);function ce(pe){Bt[pe?"unshift":"push"](()=>{_=pe,n(3,_)})}let fe=pe=>Qe(qi,g=!0,g),ze=pe=>n(0,W=1),Pe=pe=>n(0,W=2);function Me(){U=Wt(this.value),n(1,U),n(2,i),n(0,W),n(23,s)}let be=()=>{Qe(nf,a=!a,a)},H=pe=>Qe(Li,i=!1,i);return t.$$.update=()=>{t.$$.dirty[0]&16777216&&R(),t.$$.dirty[0]&8388615&&n(1,U=i?Math.min(W===1?s:i.gold,U):0)},[W,U,i,_,b,k,A,S,F,M,l,a,c,f,u,m,g,v,E,L,z,q,j,s,r,ve,Fe,_e,ce,fe,ze,Pe,Me,be,H]}var jg=class extends xe{constructor(e){super(),Ce(this,e,eV,KD,Ue,{},null,[-1,-1])}},K6=jg;function tV(t,e,n){let i=t.slice();return i[7]=e[n],i[9]=n,i}function eF(t,e,n){let i=t.slice();return i[10]=e[n],i}function tF(t){let e,n;return e=new jt({props:{origin:"center",title:C.npcs.trader.name,icon:"bag",$$slots:{default:[lV]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&8195&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function nF(t){let e,n;return e=new bi({props:{id:"trader"+t[10][0].buyid,descPos:"left:100%;top:0;",descRoot:t[0],isTrader:!0,pickable:!1,item:t[10][1]}}),e.$on("click",t[4]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&1&&(o.descRoot=i[0]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function nV(t){let e,n;return e=new bi({props:{isTrader:!0}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p:ae,i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function iV(t){let e;return{c(){e=h("span"),e.textContent=`${C.npcs.trader.select}`,p(e,"class","textgrey")},m(n,i){w(n,e,i)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function sV(t){let e,n,i,s,o,r=[rV,oV],l=[];function a(c,f){return f&2&&(e=null),e==null&&(e=!!c[1].data.canBeSold()),e?0:1}return n=a(t,-1),i=l[n]=r[n](t),{c(){i.c(),s=he()},m(c,f){l[n].m(c,f),w(c,s,f),o=!0},p(c,f){let u=n;n=a(c,f),n===u?l[n].p(c,f):(Ee(),I(l[u],1,1,()=>{l[u]=null}),Ie(),i=l[n],i?i.p(c,f):(i=l[n]=r[n](c),i.c()),P(i,1),i.m(s.parentNode,s))},i(c){o||(P(i),o=!0)},o(c){I(i),o=!1},d(c){c&&x(s),l[n].d(c)}}}function oV(t){let e;return{c(){e=h("span"),e.textContent=`${C.npcs.trader.refuse}`,p(e,"class","textred")},m(n,i){w(n,e,i)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function rV(t){let e,n;return e=new xn({props:{amount:t[1].data.goldValue()}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&2&&(o.amount=i[1].data.goldValue()),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function lV(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v=me(V.player.getTargetEntity().items),_=[];for(let M=0;M<v.length;M+=1)_[M]=nF(eF(t,v,M));let b=M=>I(_[M],1,1,()=>{_[M]=null}),y=me(Array(24-V.player.getTargetEntity().items.length)),k=[];for(let M=0;M<y.length;M+=1)k[M]=nV(tV(t,y,M));let A=[sV,iV],S=[];function F(M,D){return M[1]&&M[1].meta.type==="item"?0:1}return c=F(t,-1),f=S[c]=A[c](t),{c(){e=h("div"),n=h("p"),n.textContent=`${C.npcs.trader.buy}`,i=h("div");for(let M=0;M<_.length;M+=1)_[M].c();s=he();for(let M=0;M<k.length;M+=1)k[M].c();o=h("div"),r=h("p"),r.textContent=`${C.npcs.trader.info}`,l=h("p"),l.textContent=`${C.npcs.trader.price}`,a=h("span"),f.c(),p(n,"class","textprimary textcenter"),p(i,"class","panel-black slotcontainer svelte-12uytpc"),p(r,"class","textprimary"),p(a,"class","panel-black formatted info svelte-12uytpc"),p(o,"class","textcenter"),p(e,"class","container svelte-12uytpc")},m(M,D){w(M,e,D),d(e,n),d(e,i);for(let R=0;R<_.length;R+=1)_[R]&&_[R].m(i,null);d(i,s);for(let R=0;R<k.length;R+=1)k[R]&&k[R].m(i,null);d(e,o),d(o,r),d(o,l),d(o,a),S[c].m(a,null),t[5](e),u=!0,m||(g=Y(e,"pointerup",t[3]),m=!0)},p(M,D){if(D&17){v=me(V.player.getTargetEntity().items);let E;for(E=0;E<v.length;E+=1){let L=eF(M,v,E);_[E]?(_[E].p(L,D),P(_[E],1)):(_[E]=nF(L),_[E].c(),P(_[E],1),_[E].m(i,s))}for(Ee(),E=v.length;E<_.length;E+=1)b(E);Ie()}let R=c;c=F(M,D),c===R?S[c].p(M,D):(Ee(),I(S[R],1,1,()=>{S[R]=null}),Ie(),f=S[c],f?f.p(M,D):(f=S[c]=A[c](M),f.c()),P(f,1),f.m(a,null))},i(M){if(!u){for(let D=0;D<v.length;D+=1)P(_[D]);for(let D=0;D<y.length;D+=1)P(k[D]);P(f),u=!0}},o(M){_=_.filter(Boolean);for(let D=0;D<_.length;D+=1)I(_[D]);k=k.filter(Boolean);for(let D=0;D<k.length;D+=1)I(k[D]);I(f),u=!1},d(M){M&&x(e),it(_,M),it(k,M),S[c].d(),t[5](null),m=!1,g()}}}function aV(t){let e,n,i=t[2]&&tF(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[2]?i?(i.p(s,o),o&4&&P(i,1)):(i=tF(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function cV(t,e,n){let i,s;se(t,En,f=>n(1,i=f)),se(t,Xi,f=>n(2,s=f));let o=f=>{i&&i.meta&&i.meta.type==="item"&&i.data.canBeSold()&&Hf(i.data.quality,i.data.upgrade,i.meta.slot,i.data.type,i.data.tier),Qe(En,i=void 0,i)},r=f=>{xt("itemtraderbuy",`${f.detail.item.buyid}`)},l;function a(f){Bt[f?"unshift":"push"](()=>{l=f,n(0,l)})}return[l,i,s,o,r,a,f=>Qe(Xi,s=!1,s)]}var Wg=class extends xe{constructor(e){super(),Ce(this,e,cV,aV,Ue,{})}},iF=Wg;function sF(t,e,n){let i=t.slice();return i[13]=e[n],i[15]=n,i}function oF(t,e,n){let i=t.slice();return i[16]=e[n],i[15]=n,i}function rF(t,e,n){let i=t.slice();return i[18]=e[n],i}function lF(t){let e,n,i,s=t[16].classcount[t[18]]+"",o,r;return{c(){e=h("div"),n=h("div"),n.innerHTML=`<img class="texticon" src="${Ks(t[18])}"/>`,i=h("b"),o=T(s),p(i,"class",r=t[16].classcount[t[18]]>0?"textprimary":"textgrey")},m(l,a){w(l,e,a),d(e,n),d(e,i),d(i,o)},p(l,a){a&4&&s!==(s=l[16].classcount[l[18]]+"")&&G(o,s),a&4&&r!==(r=l[16].classcount[l[18]]>0?"textprimary":"textgrey")&&p(i,"class",r)},d(l){l&&x(e)}}}function aF(t){let e,n,i,s=t[16].message+"",o,r,l=t[4][t[16].activity]+"",a,c,f,u,m,g=t[16].minlevel+"",v,_,b=t[16].maxlevel+"",y,k,A,S,F,M,D;k=new Bi({props:{name:t[16].leadername,level:t[16].leaderlevel,pclass:t[16].leaderclass,faction:t[16].faction}});let R=me([0,1,2,3]),E=[];for(let q=0;q<4;q+=1)E[q]=lF(rF(t,R,q));function L(...q){return t[10](t[16],...q)}function z(...q){return t[11](t[16],...q)}return{c(){e=h("div"),n=h("div"),i=h("div"),o=T(s),r=h("div"),a=T(l),c=h("div"),f=h("div"),u=T("Lv. "),m=h("span"),v=T(g),_=T(" - "),y=T(b),ne(k.$$.fragment),A=h("div");for(let q=0;q<4;q+=1)E[q].c();p(i,"class","textprimary"),p(r,"class","textgrey textsmall"),qe(n,"text-overflow","ellipsis"),qe(n,"white-space","nowrap"),qe(n,"overflow","hidden"),p(m,"class","textgreen"),p(f,"class","textgrey"),p(c,"class","textcenter"),p(A,"class","grid four textcenter"),p(e,"class",S="panel-black listing marg-bot "+(t[1]===t[16]?"selected":t[5][t[16].applied])+" svelte-12t87hd")},m(q,j){w(q,e,j),d(e,n),d(n,i),d(i,o),d(n,r),d(r,a),d(e,c),d(c,f),d(f,u),d(f,m),d(m,v),d(m,_),d(m,y),K(k,c,null),d(e,A);for(let W=0;W<4;W+=1)E[W]&&E[W].m(A,null);F=!0,M||(D=[Y(e,"click",L),Y(e,"contextmenu",z)],M=!0)},p(q,j){t=q,(!F||j&4)&&s!==(s=t[16].message+"")&&G(o,s),(!F||j&4)&&l!==(l=t[4][t[16].activity]+"")&&G(a,l),(!F||j&4)&&g!==(g=t[16].minlevel+"")&&G(v,g),(!F||j&4)&&b!==(b=t[16].maxlevel+"")&&G(y,b);let W={};if(j&4&&(W.name=t[16].leadername),j&4&&(W.level=t[16].leaderlevel),j&4&&(W.pclass=t[16].leaderclass),j&4&&(W.faction=t[16].faction),k.$set(W),j&4){R=me([0,1,2,3]);let U;for(U=0;U<4;U+=1){let O=rF(t,R,U);E[U]?E[U].p(O,j):(E[U]=lF(O),E[U].c(),E[U].m(A,null))}for(;U<4;U+=1)E[U].d(1)}(!F||j&6&&S!==(S="panel-black listing marg-bot "+(t[1]===t[16]?"selected":t[5][t[16].applied])+" svelte-12t87hd"))&&p(e,"class",S)},i(q){F||(P(k.$$.fragment,q),F=!0)},o(q){I(k.$$.fragment,q),F=!1},d(q){q&&x(e),ee(k),it(E,q),M=!1,at(D)}}}function cF(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[13]}`,e.__value=n=t[15],Ne(e,e.__value)},m(i,s){w(i,e,s)},p:ae,d(i){i&&x(e)}}}function fV(t){let e,n,i,s,o,r,l,a,c;return{c(){e=h("div"),n=h("div"),i=T("\u{1F64B} Apply"),o=h("div"),r=T("\u{1F50E} Refresh"),p(n,"class",s="btn textcenter "+(t[1]&&t[1].applied===0?"green":"disabled")),p(o,"class",l="btn textcenter "+(t[0]?"disabled":"cyan")),p(e,"class","panel-black grid two")},m(f,u){w(f,e,u),d(e,n),d(n,i),d(e,o),d(o,r),a||(c=[Y(n,"click",t[7]),Y(o,"click",t[6])],a=!0)},p(f,u){u&2&&s!==(s="btn textcenter "+(f[1]&&f[1].applied===0?"green":"disabled"))&&p(n,"class",s),u&1&&l!==(l="btn textcenter "+(f[0]?"disabled":"cyan"))&&p(o,"class",l)},d(f){f&&x(e),a=!1,at(c)}}}function uV(t){let e;return{c(){e=h("div"),e.textContent="You are in a party.",p(e,"class","textcenter panel-black textgrey")},m(n,i){w(n,e,i)},p:ae,d(n){n&&x(e)}}}function mV(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v,_,b=me(t[2].parties.filter(t[9])),y=[];for(let R=0;R<b.length;R+=1)y[R]=aF(oF(t,b,R));let k=R=>I(y[R],1,1,()=>{y[R]=null}),A=me(t[4]),S=[];for(let R=0;R<A.length;R+=1)S[R]=cF(sF(t,A,R));function F(R,E){return R[3].membercount>0?uV:fV}let M=F(t,-1),D=M(t);return{c(){e=h("div"),n=h("div");for(let R=0;R<y.length;R+=1)y[R].c();i=h("div"),s=h("div"),o=h("small"),o.textContent="Filter Party Listings",r=h("div"),l=h("div"),l.textContent="Activity",a=h("select"),c=h("option"),c.textContent="All";for(let R=0;R<S.length;R+=1)S[R].c();u=h("small"),u.textContent="More filters to come!",m=We(),D.c(),p(n,"class","listcontainer scrollbar border grey svelte-12t87hd"),qe(n,"font-size","0.9em"),p(o,"class","textprimary"),c.__value=f=-1,Ne(c,c.__value),p(a,"class","btn grey small"),t[2].filterActivity===void 0&&_n(()=>t[12].call(a)),p(u,"class","textgrey"),p(r,"class","grid two search svelte-12t87hd"),p(s,"class","panel-black"),p(i,"class","grid"),qe(i,"grid-template-rows","1fr auto"),p(e,"class","layout svelte-12t87hd")},m(R,E){w(R,e,E),d(e,n);for(let L=0;L<y.length;L+=1)y[L]&&y[L].m(n,null);d(e,i),d(i,s),d(s,o),d(s,r),d(r,l),d(r,a),d(a,c);for(let L=0;L<S.length;L+=1)S[L]&&S[L].m(a,null);Mn(a,t[2].filterActivity,!0),d(r,u),d(i,m),D.m(i,null),g=!0,v||(_=Y(a,"change",t[12]),v=!0)},p(R,[E]){if(E&310){b=me(R[2].parties.filter(R[9]));let L;for(L=0;L<b.length;L+=1){let z=oF(R,b,L);y[L]?(y[L].p(z,E),P(y[L],1)):(y[L]=aF(z),y[L].c(),P(y[L],1),y[L].m(n,null))}for(Ee(),L=b.length;L<y.length;L+=1)k(L);Ie()}if(E&16){A=me(R[4]);let L;for(L=0;L<A.length;L+=1){let z=sF(R,A,L);S[L]?S[L].p(z,E):(S[L]=cF(z),S[L].c(),S[L].m(a,null))}for(;L<S.length;L+=1)S[L].d(1);S.length=A.length}E&4&&Mn(a,R[2].filterActivity),M===(M=F(R,E))&&D?D.p(R,E):(D.d(1),D=M(R),D&&(D.c(),D.m(i,null)))},i(R){if(!g){for(let E=0;E<b.length;E+=1)P(y[E]);g=!0}},o(R){y=y.filter(Boolean);for(let E=0;E<y.length;E+=1)I(y[E]);g=!1},d(R){R&&x(e),it(y,R),it(S,R),D.d(),v=!1,_()}}}function pV(t,e,n){let i,s;se(t,cm,b=>n(2,i=b)),se(t,Zn,b=>n(3,s=b));let o=C.ui.party.activities,r=["","applied","denied"],l=!1,a,c=async()=>{n(0,l=!0);let b=await Nt("/api/party/getlistedparties",{},()=>{});Qe(cm,i.parties=b,i),a&&n(1,a=b.find(y=>y.party===a.party)),setTimeout(()=>n(0,l=!1),200)};c();let f=()=>{a&&(n(1,a.applied=1,a),Nt("/api/party/makeapplication",{party:a.party,message:""},()=>{}),n(1,a=void 0))},u=(b,y)=>{bn.set({x:b.pageX,y:b.pageY,opts:[{name:y.leadername,css:"disabled"},Jt.whisper(y.leadername)]})},m=b=>i.filterActivity===-1||b.activity===i.filterActivity,g=(b,y)=>n(1,a=b),v=(b,y)=>u(y,b);function _(){i.filterActivity=ki(this),cm.set(i)}return[l,a,i,s,o,r,c,f,u,m,g,v,_]}var Gg=class extends xe{constructor(e){super(),Ce(this,e,pV,mV,Ue,{})}},fF=Gg;var vd=async t=>{let e;try{e=await Nt("/api/party/getpartystate",{},()=>{})}catch{e=void 0}e&&Hi.update(n=>{let i=!1;return e.applications.forEach(s=>{n.applications.find(r=>r.player===s.player)||(i=!0)}),n.applications=e.applications,n.message=e.message||n.message||"",n.activity=e.activity||n.activity||0,n.listed=e.listed,n.flashing=i&&!re.partyOpen,n})};function uF(t,e,n){let i=t.slice();return i[14]=e[n],i[16]=n,i}function mF(t,e,n){let i=t.slice();return i[17]=e[n],i[16]=n,i}function dV(t){let e,n,i,s=me(t[1].applications),o=[];for(let l=0;l<s.length;l+=1)o[l]=pF(mF(t,s,l));let r=l=>I(o[l],1,1,()=>{o[l]=null});return{c(){e=h("table"),n=h("tbody");for(let l=0;l<o.length;l+=1)o[l].c();p(e,"class","dense"),qe(e,"width","100%"),qe(e,"table-layout","fixed")},m(l,a){w(l,e,a),d(e,n);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(n,null);i=!0},p(l,a){if(a&226){s=me(l[1].applications);let c;for(c=0;c<s.length;c+=1){let f=mF(l,s,c);o[c]?(o[c].p(f,a),P(o[c],1)):(o[c]=pF(f),o[c].c(),P(o[c],1),o[c].m(n,null))}for(Ee(),c=s.length;c<o.length;c+=1)r(c);Ie()}},i(l){if(!i){for(let a=0;a<s.length;a+=1)P(o[a]);i=!0}},o(l){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)I(o[a]);i=!1},d(l){l&&x(e),it(o,l)}}}function hV(t){let e;function n(o,r){return o[1].listed?vV:gV}let i=n(t,-1),s=i(t);return{c(){e=h("p"),s.c(),p(e,"class","textcenter textgrey")},m(o,r){w(o,e,r),s.m(e,null)},p(o,r){i!==(i=n(o,r))&&(s.d(1),s=i(o),s&&(s.c(),s.m(e,null)))},i:ae,o:ae,d(o){o&&x(e),s.d()}}}function pF(t){let e,n,i,s,o=t[17].gearscore+"",r,l,a,c,f,u,m,g,v,_,b;i=new Bi({props:{name:t[17].name,level:t[17].level,pclass:t[17].class,faction:t[17].faction}});function y(...S){return t[8](t[17],...S)}function k(...S){return t[9](t[17],...S)}function A(...S){return t[10](t[17],...S)}return{c(){e=h("tr"),n=h("td"),ne(i.$$.fragment),s=h("td"),r=T(o),l=T(" GS"),a=h("td"),c=T("\u{1F91D}"),u=h("td"),m=T("\u274C"),p(n,"width","50%"),p(s,"width","20%"),p(s,"class","textcenter textcyan"),p(a,"width","15%"),p(a,"class",f="textcenter accept "+(t[17].invited?"active":"")+" svelte-6mz3cb"),p(u,"width","15%"),p(u,"class",g="textcenter deny "+(t[17].denied?"active":"")+" svelte-6mz3cb"),p(e,"class","striped"),qe(e,"cursor","unset")},m(S,F){w(S,e,F),d(e,n),K(i,n,null),d(e,s),d(s,r),d(s,l),d(e,a),d(a,c),d(e,u),d(u,m),v=!0,_||(b=[Y(a,"click",y),Y(u,"click",k),Y(e,"contextmenu",A)],_=!0)},p(S,F){t=S;let M={};F&2&&(M.name=t[17].name),F&2&&(M.level=t[17].level),F&2&&(M.pclass=t[17].class),F&2&&(M.faction=t[17].faction),i.$set(M),(!v||F&2)&&o!==(o=t[17].gearscore+"")&&G(r,o),(!v||F&2&&f!==(f="textcenter accept "+(t[17].invited?"active":"")+" svelte-6mz3cb"))&&p(a,"class",f),(!v||F&2&&g!==(g="textcenter deny "+(t[17].denied?"active":"")+" svelte-6mz3cb"))&&p(u,"class",g)},i(S){v||(P(i.$$.fragment,S),v=!0)},o(S){I(i.$$.fragment,S),v=!1},d(S){S&&x(e),ee(i),_=!1,at(b)}}}function gV(t){let e;return{c(){e=T("List your party to search for players")},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function vV(t){let e;return{c(){e=T("Waiting for players...")},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function dF(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[14]}`,e.__value=n=t[16],Ne(e,e.__value)},m(i,s){w(i,e,s)},p:ae,d(i){i&&x(e)}}}function _V(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v,_,b,y,k=t[1].listed?"\u{1F441}\uFE0F Unlist":"List",A,S,F,M,D,R,E=[hV,dV],L=[];function z(W,U){return W[1].applications.length===0?0:1}i=z(t,-1),s=L[i]=E[i](t);let q=me(t[3]),j=[];for(let W=0;W<q.length;W+=1)j[W]=dF(uF(t,q,W));return{c(){e=h("div"),n=h("div"),s.c(),o=h("div"),r=h("div"),l=h("div"),a=h("small"),a.textContent="Describe your party",c=h("input"),m=h("div"),g=h("small"),g.textContent="Select an activity",v=h("select");for(let W=0;W<j.length;W+=1)j[W].c();b=h("div"),y=h("div"),A=T(k),S=T(" Party"),p(n,"class","listcontainer scrollbar border grey svelte-6mz3cb"),p(a,"class","textprimary"),p(c,"maxlength",f=40),p(c,"class",u="marg-top "+(t[2].role<2||t[1].listed?"disabled":"")),p(c,"type","text"),p(c,"placeholder","Enter Party Message"),p(l,"class","panel-bright"),p(g,"class","textprimary"),p(v,"class",_="btn grey marg-top "+(t[2].role<2||t[1].listed?"disabled":"")),t[1].activity===void 0&&_n(()=>t[12].call(v)),p(m,"class","panel-bright marg-top"),p(r,"class","panel-black "),p(y,"class",F="btn purp textcenter "+(t[2].role<2||t[0]?"disabled":t[1].listed?"active":"")),p(b,"class","panel-black"),p(o,"class","grid"),qe(o,"grid-template-rows","1fr auto"),p(e,"class","layout svelte-6mz3cb")},m(W,U){w(W,e,U),d(e,n),L[i].m(n,null),d(e,o),d(o,r),d(r,l),d(l,a),d(l,c),Ne(c,t[1].message),d(r,m),d(m,g),d(m,v);for(let O=0;O<j.length;O+=1)j[O]&&j[O].m(v,null);Mn(v,t[1].activity,!0),d(o,b),d(b,y),d(y,A),d(y,S),M=!0,D||(R=[Y(c,"input",t[11]),Y(v,"change",t[12]),Y(y,"click",t[4])],D=!0)},p(W,[U]){let O=i;if(i=z(W,U),i===O?L[i].p(W,U):(Ee(),I(L[O],1,1,()=>{L[O]=null}),Ie(),s=L[i],s?s.p(W,U):(s=L[i]=E[i](W),s.c()),P(s,1),s.m(n,null)),(!M||U&6&&u!==(u="marg-top "+(W[2].role<2||W[1].listed?"disabled":"")))&&p(c,"class",u),U&2&&c.value!==W[1].message&&Ne(c,W[1].message),U&8){q=me(W[3]);let Z;for(Z=0;Z<q.length;Z+=1){let ve=uF(W,q,Z);j[Z]?j[Z].p(ve,U):(j[Z]=dF(ve),j[Z].c(),j[Z].m(v,null))}for(;Z<j.length;Z+=1)j[Z].d(1);j.length=q.length}(!M||U&6&&_!==(_="btn grey marg-top "+(W[2].role<2||W[1].listed?"disabled":"")))&&p(v,"class",_),U&2&&Mn(v,W[1].activity),(!M||U&2)&&k!==(k=W[1].listed?"\u{1F441}\uFE0F Unlist":"List")&&G(A,k),(!M||U&7&&F!==(F="btn purp textcenter "+(W[2].role<2||W[0]?"disabled":W[1].listed?"active":"")))&&p(y,"class",F)},i(W){M||(P(s),M=!0)},o(W){I(s),M=!1},d(W){W&&x(e),L[i].d(),it(j,W),D=!1,at(R)}}}function bV(t,e,n){let i,s;se(t,Hi,y=>n(1,i=y)),se(t,Zn,y=>n(2,s=y));let o=C.ui.party.activities,r,l=!1;vd();let a=async()=>{n(0,l=!0),i.listed?(Qe(Hi,i.listed=!1,i),await Nt("/api/party/unlistparty",{},()=>{})):(Qe(Hi,i.listed=!0,i),await Nt("/api/party/listparty",{message:i.message,activity:i.activity},()=>{})),n(0,l=!1)},c=y=>{xt("partyinvite",y.name),y.invited=!0,y.denied=!1,Hi.set(i)},f=y=>{y.denied=!0,y.invited=!1,Qe(Hi,i.applications=i.applications.filter(k=>k.player!==y.player),i),Nt("/api/party/denyapplication",{player:y.player},()=>{})},u=(y,k)=>{bn.set({x:y.pageX,y:y.pageY,opts:[{name:k.name,css:"disabled"},Jt.whisper(k.name)]})},m=(y,k)=>{c(y)},g=(y,k)=>{f(y)},v=(y,k)=>u(k,y);function _(){i.message=this.value,Hi.set(i)}function b(){i.activity=ki(this),Hi.set(i)}return[l,i,s,o,a,c,f,u,m,g,v,_,b]}var Hg=class extends xe{constructor(e){super(),Ce(this,e,bV,_V,Ue,{})}},hF=Hg;function gF(t){let e,n;return e=new jt({props:{origin:"center",title:"\u{1F465} Party",$$slots:{default:[xV]},$$scope:{ctx:t}}}),e.$on("close",t[3]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&67&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function yV(t){let e,n;return e=new hF({}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function kV(t){let e,n;return e=new fF({}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function xV(t){let e,n,i,s,o,r,l,a,c,f,u,m=[kV,yV],g=[];function v(_,b){return _[1]===0||_[0].membercount===0?0:1}return l=v(t,-1),a=g[l]=m[l](t),{c(){e=h("div"),n=h("div"),i=h("div"),i.textContent="Party List",s=h("div"),o=T("Your Party"),a.c(),p(i,"class","tab"),Lo(i,"active",t[1]===0),p(s,"class",r="tab "+(t[0].membercount===0?"disabled":"")),Lo(s,"active",t[1]===1),p(n,"class","tab-bar flex"),p(e,"class","container svelte-6dw5x1")},m(_,b){w(_,e,b),d(e,n),d(n,i),d(n,s),d(s,o),g[l].m(e,null),c=!0,f||(u=[Y(i,"click",t[4]),Y(s,"click",t[5])],f=!0)},p(_,b){(!c||b&2)&&Lo(i,"active",_[1]===0),(!c||b&1&&r!==(r="tab "+(_[0].membercount===0?"disabled":"")))&&p(s,"class",r),(!c||b&3)&&Lo(s,"active",_[1]===1);let y=l;l=v(_,b),l!==y&&(Ee(),I(g[y],1,1,()=>{g[y]=null}),Ie(),a=g[l],a||(a=g[l]=m[l](_),a.c()),P(a,1),a.m(e,null))},i(_){c||(P(a),c=!0)},o(_){I(a),c=!1},d(_){_&&x(e),g[l].d(),f=!1,at(u)}}}function wV(t){let e,n,i=t[2]&&gF(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[2]?i?(i.p(s,o),o&4&&P(i,1)):(i=gF(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function MV(t,e,n){let i,s;se(t,Zi,c=>n(2,i=c)),se(t,Zn,c=>n(0,s=c));let o=0,r=c=>Qe(Zi,i=!1,i),l=()=>{n(1,o=0)},a=()=>{n(1,o=1)};return t.$$.update=()=>{t.$$.dirty&1&&s.membercount===0&&n(1,o=0)},[s,o,i,r,l,a]}var Yg=class extends xe{constructor(e){super(),Ce(this,e,MV,wV,Ue,{})}},vF=Yg;var _d=t=>t.type==="pet"&&t.upgrade>=1?!1:t.stacks===void 0&&t.rolls.length>0&&!An[t.type].noupgrade,_F=t=>t<101,bd=t=>{if(!_d(t)||t.type==="pet")return 0;let e=ln[t.type+t.tier];return Math.ceil(((1+e.level*(1+t.upgrade))/An[t.type].drop)**(1.2+t.upgrade*.2))+100},bF=t=>{if(_d(t)){let e=[];if(t.type==="pet")e.push({type:"box",tier:2});else for(let n=0;n<Math.max(1,t.upgrade);++n)e.push({type:"rune",tier:n,stacks:Math.max(1,Math.min(2,t.upgrade-n))});return e}else return[]};var Zg={};Qn(Zg,{addExp:()=>Qg,addGold:()=>kd,init:()=>au,onWorldEnter:()=>FV,tick:()=>CV,values:()=>ks});var ks=new Map,Xg=new kt(0,1),yd=0,au=()=>{ks.set("exp",0),ks.set("gold",0),Xg.reset(0),yd=0},FV=au,CV=t=>{Xg.done(V.time)&&(++yd,Xg.reset(V.time),bm.set({gold:ks.get("gold"),gph:ks.get("gold")/yd*60*60}),ym.set({exp:ks.get("exp"),exph:ks.get("exp")/yd*60*60}))},Qg=t=>{ks.set("exp",(ks.get("exp")||0)+t)},kd=t=>{ks.set("gold",(ks.get("gold")||0)+t)};var yF=(t,e,n)=>{if(t&&t.type)switch(e){case 13:t.rolls&&t.quality>=70&&Mt(t.quality<90?98:99);case 1:re.chat[7]&&Gt("inv",C.ui.inventory.pick.replace("$1",tn(t.type,t.tier)),!0),sn(10,100),Mt(zi[t.type].sound),Pi[12].element="bag"+n,t.type=="book"&&sn(23,100)&&(Pi[24].element="bag"+n);break;case 10:t.rolls&&No.update(i=>(ca.set(t.upgrade-i.upgrade),t));break}},kF=(t,e)=>{if(t&&t.type)switch(e){case 7:re.chat[8]&&Gt("inv",C.ui.stash.stashed.replace("$1",tn(t.type,t.tier))),Mt(zi[t.type].sound);break;case 6:fs.set(),Ir.update(n=>!n),re.chat[8]&&Gt("inv",C.ui.merchant.auctionpost.replace("$1",tn(t.type,t.tier)));break;case 9:re.chat[8]&&Gt("inv",C.ui.inventory.sold.replace("$1",tn(t.type,t.tier))),Mt(zi[t.type].sound);break;case 2:re.chat[7]&&Gt("inv",C.ui.inventory.throw.replace("$1",tn(t.type,t.tier))),Mt(zi[t.type].sound);break}},cu=(t,e,n,i)=>{n!=0&&Mt(zi.gold.sound);let s=i+e;switch(n){case 1:re.chat[9]&&Gt("inv",C.ui.inventory.pick.replace("$1",s),!0),kd(e);break;case 4:Ir.update(o=>!o),re.chat[10]&&Gt("inv",C.ui.merchant.auctionbuy.replace("$1",s),!0);break;case 12:case 3:re.chat[10]&&Gt("inv",C.ui.inventory.spend.replace("$1",s),!0);break;case 11:re.chat[10]&&Gt("inv",C.ui.inventory.death.replace("$1",s),!0);break;case 9:re.chat[10]&&Gt("inv",C.ui.inventory.receive.replace("$1",s),!0),kd(e);break}};var xs=class extends cr{constructor(e){super(e)}hydrate(e){super.hydrate(e),e.store?e.store.set(this):console.error("no store for item",e),yF(this,this.reason,e.slot)}equipReasons(e){let n=[];if(this.logic.class!==void 0&&n.push(["Class: "+C.classes[this.logic.class].name,Wa(e.class,this.type,this.tier)]),this.logic.level&&n.push(["Requires Lv. "+this.logic.level,U1(e.level,this.type,this.tier)]),this.logic.requiredSkill&&n.push(["Must know: "+C.items.book[this.logic.requiredSkill].name,N1(e.skills.skillIdsActive,this.type,this.tier)]),Wa(e.class,this.type,this.tier)&&this.type=="book"){let i=$1(e.skills.skillIdsLearned,this.type,this.tier),s=Zf(e.skills.skillIdsLearned,this.logic.skillid);n.push([i?"Use book to learn skill":s>=this.logic.skilllevel?"You already know this skill":`Must learn book Lv. ${this.logic.skilllevel} first`,i])}return n}buyReasons(e){let n=[];return this.logic.buyElo!==void 0&&n.push([`Min. Rating: ${Yf(this.logic.buyElo)}`,px(e.elo,this.type,this.tier)]),n}getBestEquipslot(e){let n=An[this.type].slot;return n===void 0?void 0:n.find(s=>e.slots.get(s)===void 0)||n[0]}};function xF(t,e,n){let i=t.slice();return i[18]=e[n],i}function wF(t){let e,n;return e=new jt({props:{origin:"center",title:"Blacksmith",icon:"bag",$$slots:{default:[SV]},$$scope:{ctx:t}}}),e.$on("close",t[13]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&2097661&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function MF(t){let e;return{c(){e=h("div")},m(n,i){w(n,e,i)},p:ae,d(n){n&&x(e)}}}function FF(t){let e,n;return e=new bi({props:{pickable:!1,item:t[18],filter:t[18].filter}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&8&&(o.item=i[18]),s&8&&(o.filter=i[18].filter),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function SV(t){let e,n,i,s=(t[7]||"Place an item into the upgrade slot")+"",o,r,l,a,c,f,u,m,g,v,_,b,y,k,A,S;a=new bi({props:{clearOnMove:!0,invslot:t[0]?t[2]:void 0,pickable:!0,item:No,filter:t[5]?!0:""}}),a.$on("discard",t[10]),a.$on("move",t[9]);let F=me(t[3]),M=[];for(let E=0;E<F.length;E+=1)M[E]=FF(xF(t,F,E));let D=E=>I(M[E],1,1,()=>{M[E]=null}),R=null;return F.length||(R=MF(t)),v=new xn({props:{isPrice:!0,amount:t[0]?bd(t[0]):0}}),{c(){e=h("div"),n=h("h3"),n.textContent="Upgrade Item",i=h("span"),o=T(s),l=h("div"),ne(a.$$.fragment),f=h("div"),u=h("span"),u.textContent="Cost:",m=h("div");for(let E=0;E<M.length;E+=1)M[E].c();R&&R.c(),g=h("div"),ne(v.$$.fragment),_=h("div"),b=T("Upgrade"),p(n,"class","textwhite"),p(i,"class",r="panel-black upgradetext "+t[8]+" svelte-1u9u6qj"),p(l,"class",c="upgradeslot "+t[6]+" svelte-1u9u6qj"),p(m,"class","panel-black costgrid svelte-1u9u6qj"),qe(m,"grid-template-columns","repeat("+Math.min(3,t[3].length||1)+", 30px)"),p(_,"class",y="btn primary formatted textcenter upgradebutton "+(t[4]?"":"disabled")+" svelte-1u9u6qj"),p(f,"class","upgrade svelte-1u9u6qj"),p(e,"class","container textcenter svelte-1u9u6qj")},m(E,L){w(E,e,L),d(e,n),d(e,i),d(i,o),d(e,l),K(a,l,null),d(e,f),d(f,u),d(f,m);for(let z=0;z<M.length;z+=1)M[z]&&M[z].m(m,null);R&&R.m(m,null),d(f,g),K(v,g,null),d(f,_),d(_,b),k=!0,A||(S=Y(_,"click",t[11]),A=!0)},p(E,L){(!k||L&128)&&s!==(s=(E[7]||"Place an item into the upgrade slot")+"")&&G(o,s),(!k||L&256&&r!==(r="panel-black upgradetext "+E[8]+" svelte-1u9u6qj"))&&p(i,"class",r);let z={};if(L&5&&(z.invslot=E[0]?E[2]:void 0),L&32&&(z.filter=E[5]?!0:""),a.$set(z),(!k||L&64&&c!==(c="upgradeslot "+E[6]+" svelte-1u9u6qj"))&&p(l,"class",c),L&8){F=me(E[3]);let j;for(j=0;j<F.length;j+=1){let W=xF(E,F,j);M[j]?(M[j].p(W,L),P(M[j],1)):(M[j]=FF(W),M[j].c(),P(M[j],1),M[j].m(m,null))}for(Ee(),j=F.length;j<M.length;j+=1)D(j);Ie(),!F.length&&R?R.p(E,L):F.length?R&&(R.d(1),R=null):(R=MF(E),R.c(),R.m(m,null))}(!k||L&8)&&qe(m,"grid-template-columns","repeat("+Math.min(3,E[3].length||1)+", 30px)");let q={};L&1&&(q.amount=E[0]?bd(E[0]):0),v.$set(q),(!k||L&16&&y!==(y="btn primary formatted textcenter upgradebutton "+(E[4]?"":"disabled")+" svelte-1u9u6qj"))&&p(_,"class",y)},i(E){if(!k){P(a.$$.fragment,E);for(let L=0;L<F.length;L+=1)P(M[L]);P(v.$$.fragment,E),k=!0}},o(E){I(a.$$.fragment,E),M=M.filter(Boolean);for(let L=0;L<M.length;L+=1)I(M[L]);I(v.$$.fragment,E),k=!1},d(E){E&&x(e),ee(a),it(M,E),R&&R.d(),ee(v),A=!1,S()}}}function AV(t){let e,n,i=t[1]&&wF(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[1]?i?(i.p(s,o),o&2&&P(i,1)):(i=wF(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function PV(t,e,n){let i,s,o,r,l;se(t,ca,F=>n(12,i=F)),se(t,No,F=>n(0,s=F)),se(t,la,F=>n(14,o=F)),se(t,Yi,F=>n(15,r=F)),se(t,js,F=>n(1,l=F));let a=F=>{let{from:M,to:D}=F.detail;M!==D&&M.type=="item"&&(No.set(M.item),n(2,f=M.slot))},c=F=>{No.set(),n(2,f=void 0)},f,u=[],m=!1,g=!1,v=()=>{let F=_d(s),M=r>=bd(s),D=_F(f);n(4,m=F&&M&&D);let R=bF(s);R.forEach((E,L)=>{let z=u[L]||n(3,u[L]=ie(),u),q=new xs;q.hydrate({...E,store:z}),q.stacks!==void 0?z.filter=o[q.type+q.tier]>=q.stacks?"":!0:z.filter=o[q.type+q.tier]>=0?"":!0,z.filter&&n(4,m=!1)}),n(3,u=u.slice(0,R.length)),m||n(7,y="You lack the required materials"),F||n(7,y="This item cannot be upgraded"),M||n(7,y="You do not have enough gold"),D||n(7,y="You must un-equip the item first"),m?(n(8,k="textgreen"),n(7,y="Ready to upgrade")):n(8,k="textred")},_=()=>{s&&m&&!g&&(n(5,g=!0),Qe(ca,i=void 0,i),n(7,y="Upgrading..."),n(8,k="textprimary"),Mt(100),setTimeout(()=>xt("itemblacksmithupgrade",`${s.dbid}`),1e3))},b,y,k,A=()=>{Mt(i>0?101:102),n(6,b=i>0?"flash_success":"flash_fail"),n(7,y=(i>0?"Success! ":"Fail! ")+(i<0?"-":"+")+i),n(8,k=i>0?"textgreen":"textred")},S=F=>Qe(js,l=!1,l);return t.$$.update=()=>{t.$$.dirty&2&&(l||(Qe(No,s=void 0,s),Qe(ca,i=void 0,i))),t.$$.dirty&1&&(n(4,m=!0),s?v():(n(3,u.length=0,u),n(4,m=!1),n(8,k=void 0),n(7,y=void 0)),n(5,g=!1)),t.$$.dirty&4096&&(i!==void 0?A():(n(6,b=""),n(8,k="")))},[s,l,f,u,m,g,b,y,k,a,c,_,i,S]}var Jg=class extends xe{constructor(e){super(),Ce(this,e,PV,AV,Ue,{})}},CF=Jg;function TV(t){let e;return{c(){e=h("span")},m(n,i){w(n,e,i),e.innerHTML=t[0]},p(n,[i]){i&1&&(e.innerHTML=n[0])},i:ae,o:ae,d(n){n&&x(e)}}}function EV(t,e,n){let i,{amount:s}=e;return t.$$set=o=>{"amount"in o&&n(1,s=o.amount)},t.$$.update=()=>{t.$$.dirty&2&&n(0,i=Yf(s))},[i,s]}var Kg=class extends xe{constructor(e){super(),Ce(this,e,EV,TV,yn,{amount:1})}},xd=Kg;var ev=ja({0:{6:2,8:.3},1:{6:4,12:1},2:{14:.5},3:{14:.4,7:.8},4:{16:.3,7:.8},5:{14:.2,18:.3}});var SF=t=>1+t/1e3;function IV(t){let e,n=C.ui.stats.array[t[1]]+"",i,s,o=(t[3]?"+"+Hn(t[1],t[0].get(t[2]).get(t[1])):Hn(t[1],t[4][t[1]]||0))+"",r,l;return{c(){e=h("span"),i=T(n),s=h("span"),r=T(o),p(s,"class",l="statnumber "+(t[3]?"textgreen":t[0]?"textprimary":"textgreen"))},m(a,c){w(a,e,c),d(e,i),w(a,s,c),d(s,r)},p(a,[c]){c&2&&n!==(n=C.ui.stats.array[a[1]]+"")&&G(i,n),c&31&&o!==(o=(a[3]?"+"+Hn(a[1],a[0].get(a[2]).get(a[1])):Hn(a[1],a[4][a[1]]||0))+"")&&G(r,o),c&9&&l!==(l="statnumber "+(a[3]?"textgreen":a[0]?"textprimary":"textgreen"))&&p(s,"class",l)},i:ae,o:ae,d(a){a&&(x(e),x(s))}}}function DV(t,e,n){let i,s;se(t,jo,a=>n(4,s=a));let{relmap:o}=e,{id:r}=e,{relation:l=void 0}=e;return t.$$set=a=>{"relmap"in a&&n(0,o=a.relmap),"id"in a&&n(1,r=a.id),"relation"in a&&n(2,l=a.relation)},t.$$.update=()=>{t.$$.dirty&7&&n(3,i=l!==void 0&&o.get(l).get(r)!==void 0)},[o,r,l,i,s]}var tv=class extends xe{constructor(e){super(),Ce(this,e,DV,IV,Ue,{relmap:0,id:1,relation:2})}},wd=tv;var Po=[4e3,8e3,12e3,16e3,2e4,24e3,28e3,32e3,36e3,4e4,44e3,48e3];var hr=Po.length,nc=t=>{for(let e=0;e<hr;++e)if(Po[e]>t)return e;return Math.max(0,hr)},Fd=t=>t===0?0:Po[t-1],nv=t=>{for(let e=0;e<hr;++e)if(Po[e]>t)return Po[e];return Po[hr-1]},Md=[1,.8,.63,.479,.342,.23,.146,.085,.045,.024,.01,.003,0],jfe=Md.map(t=>1-t);var fu=t=>t===0?"No Bracket":t===Md.length?Md.length+" (Faction Leader)":`${t} (Top ${(Md[t-1]*100).toFixed(1)}%)`;function AF(t,e,n){let i=t.slice();return i[12]=e[n],i[14]=n,i}function PF(t,e,n){let i=t.slice();return i[15]=e[n],i}function TF(t,e,n){let i=t.slice();return i[18]=e[n],i[20]=n,i}function EF(t,e,n){let i=t.slice();return i[15]=e[n],i}function IF(t){let e,n;return e=new jt({props:{title:C.ui.headers.character,icon:"char",origin:"left top",defaultOffset:[3,100],$$slots:{default:[VV]},$$scope:{ctx:t}}}),e.$on("close",t[11]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&8388727&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function DF(t){let e,n,i,s,o,r,l;e=new wd({props:{id:t[15]}});function a(...f){return t[8](t[15],...f)}function c(...f){return t[10](t[15],...f)}return{c(){ne(e.$$.fragment),n=h("img"),lt(n.src,i="/data/ui/icons/arrow.svg?v=8602459")||p(n,"src",i),p(n,"class",s="btn "+(t[0][22]>0?"green":"disabled")+" svgicon statbtn svelte-rbq5ku")},m(f,u){K(e,f,u),w(f,n,u),o=!0,r||(l=[Y(n,"pointerenter",a),Y(n,"pointerleave",t[9]),Y(n,"click",c)],r=!0)},p(f,u){t=f,(!o||u&1&&s!==(s="btn "+(t[0][22]>0?"green":"disabled")+" svgicon statbtn svelte-rbq5ku"))&&p(n,"class",s)},i(f){o||(P(e.$$.fragment,f),o=!0)},o(f){I(e.$$.fragment,f),o=!1},d(f){f&&x(n),ee(e,f),r=!1,at(l)}}}function VF(t){let e,n;return e=new bi({props:{descPos:"left:100%;top:0;",item:t[18],invslot:101+t[20]}}),e.$on("use",BF),e.$on("context",BF),e.$on("move",qV),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&64&&(o.item=i[18]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function LF(t){let e,n;return e=new wd({props:{id:t[15],relmap:sv,relation:t[1]}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&2&&(o.relation=i[1]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function qF(t){let e,n,i=me(t[12]),s=[];for(let r=0;r<i.length;r+=1)s[r]=LF(PF(t,i,r));let o=r=>I(s[r],1,1,()=>{s[r]=null});return{c(){e=h("div");for(let r=0;r<s.length;r+=1)s[r].c();p(e,"class","statcol panel-black svelte-rbq5ku")},m(r,l){w(r,e,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null);n=!0},p(r,l){if(l&2){i=me(r[12]);let a;for(a=0;a<i.length;a+=1){let c=PF(r,i,a);s[a]?(s[a].p(c,l),P(s[a],1)):(s[a]=LF(c),s[a].c(),P(s[a],1),s[a].m(e,null))}for(Ee(),a=i.length;a<s.length;a+=1)o(a);Ie()}},i(r){if(!n){for(let l=0;l<i.length;l+=1)P(s[l]);n=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)I(s[l]);n=!1},d(r){r&&x(e),it(s,r)}}}function VV(t){let e,n,i,s,o=t[4].name+"",r,l,a,c=t[4].level+"",f,u,m,g,v,_,b=C.classes[t[4].class].name+"",y,k,A,S,F,M,D,R=C.factions[t[4].faction].name+"",E,L,z,q,j,W,U,O=ht(t[0][20]||0)+"",Z,ve,Fe=t[2]<hr?"/ "+ii(Po[t[2]]):"",_e,ce,fe=C.ui.charpanel.rank+"",ze,Pe,Me,be,H,pe,Be,Ge,Xe,Ye,ue,oe,$e,J,Q,$,le;Xe=new xd({props:{amount:t[0][21]||0}}),ue=new pr({props:{amount:t[5],isPrice:!1}});let je=me([0,1,2,3,4,5]),Ve=[];for(let ye=0;ye<6;ye+=1)Ve[ye]=DF(EF(t,je,ye));let ke=ye=>I(Ve[ye],1,1,()=>{Ve[ye]=null});J=new wd({props:{id:22}});let Re=me(t[6].filter(UF)),Oe=[];for(let ye=0;ye<Re.length;ye+=1)Oe[ye]=VF(TF(t,Re,ye));let pt=ye=>I(Oe[ye],1,1,()=>{Oe[ye]=null}),wt=me(zF),Je=[];for(let ye=0;ye<wt.length;ye+=1)Je[ye]=qF(AF(t,wt,ye));let Et=ye=>I(Je[ye],1,1,()=>{Je[ye]=null});return{c(){e=h("div"),n=h("div"),i=h("span"),i.textContent=`${C.ui.charpanel.name}`,s=h("span"),r=T(o),l=h("span"),l.textContent=`${C.ui.charpanel.level}`,a=h("span"),f=T(c),u=h("span"),u.textContent=`${C.ui.charpanel.class}`,m=h("span"),g=h("img"),_=We(),y=T(b),A=h("span"),A.textContent=`${C.ui.charpanel.faction}`,S=h("span"),F=h("img"),D=We(),E=T(R),z=h("span"),z.textContent=`${C.ui.stats.array[20]}`,q=h("span"),j=h("img"),U=We(),Z=T(O),ve=We(),_e=T(Fe),ce=T(" ("),ze=T(fe),Pe=We(),Me=T(t[2]),be=T("/"),H=T(hr),pe=T(")"),Be=h("span"),Be.textContent=`${C.ui.charpanel.rating}`,Ge=h("span"),ne(Xe.$$.fragment),Ye=h("span"),Ye.textContent=`${C.ui.charpanel.medals}`,ne(ue.$$.fragment),oe=h("div");for(let ye=0;ye<6;ye+=1)Ve[ye].c();$e=he(),ne(J.$$.fragment),Q=h("div");for(let ye=0;ye<Oe.length;ye+=1)Oe[ye].c();$=h("div");for(let ye=0;ye<Je.length;ye+=1)Je[ye].c();p(s,"class","bold textwhite"),p(a,"class","bold textwhite"),p(g,"class","texticon"),lt(g.src,v=Ks(t[4].class))||p(g,"src",v),p(m,"class",k="bold "+("textc"+t[4].class)+" svelte-rbq5ku"),p(F,"class","texticon"),lt(F.src,M=T1(t[4].faction))||p(F,"src",M),p(S,"class",L="bold "+("textf"+t[4].faction)+" svelte-rbq5ku"),p(j,"class","texticon"),lt(j.src,W=Na)||p(j,"src",W),p(q,"class","bold textprestige"),p(n,"class","statcol panel-black svelte-rbq5ku"),qe(n,"grid-template-columns","1fr 2fr"),p(oe,"id","statpoints"),p(oe,"class","statcol panel-black svelte-rbq5ku"),qe(oe,"grid-template-columns","1fr auto auto"),p(e,"class","grid"),qe(e,"grid-template-columns","3fr 2fr"),p(Q,"id","equipslots"),p(Q,"class","items svelte-rbq5ku"),p($,"class","grid three stats2 svelte-rbq5ku")},m(ye,Ke){w(ye,e,Ke),d(e,n),d(n,i),d(n,s),d(s,r),d(n,l),d(n,a),d(a,f),d(n,u),d(n,m),d(m,g),d(m,_),d(m,y),d(n,A),d(n,S),d(S,F),d(S,D),d(S,E),d(n,z),d(n,q),d(q,j),d(q,U),d(q,Z),d(q,ve),d(q,_e),d(q,ce),d(q,ze),d(q,Pe),d(q,Me),d(q,be),d(q,H),d(q,pe),d(n,Be),d(n,Ge),K(Xe,Ge,null),d(n,Ye),K(ue,n,null),d(e,oe);for(let yt=0;yt<6;yt+=1)Ve[yt]&&Ve[yt].m(oe,null);d(oe,$e),K(J,oe,null),w(ye,Q,Ke);for(let yt=0;yt<Oe.length;yt+=1)Oe[yt]&&Oe[yt].m(Q,null);w(ye,$,Ke);for(let yt=0;yt<Je.length;yt+=1)Je[yt]&&Je[yt].m($,null);le=!0},p(ye,Ke){(!le||Ke&16)&&o!==(o=ye[4].name+"")&&G(r,o),(!le||Ke&16)&&c!==(c=ye[4].level+"")&&G(f,c),(!le||Ke&16&&!lt(g.src,v=Ks(ye[4].class)))&&p(g,"src",v),(!le||Ke&16)&&b!==(b=C.classes[ye[4].class].name+"")&&G(y,b),(!le||Ke&16&&k!==(k="bold "+("textc"+ye[4].class)+" svelte-rbq5ku"))&&p(m,"class",k),(!le||Ke&16&&!lt(F.src,M=T1(ye[4].faction)))&&p(F,"src",M),(!le||Ke&16)&&R!==(R=C.factions[ye[4].faction].name+"")&&G(E,R),(!le||Ke&16&&L!==(L="bold "+("textf"+ye[4].faction)+" svelte-rbq5ku"))&&p(S,"class",L),(!le||Ke&1)&&O!==(O=ht(ye[0][20]||0)+"")&&G(Z,O),(!le||Ke&4)&&Fe!==(Fe=ye[2]<hr?"/ "+ii(Po[ye[2]]):"")&&G(_e,Fe),(!le||Ke&4)&&G(Me,ye[2]);let yt={};Ke&1&&(yt.amount=ye[0][21]||0),Xe.$set(yt);let St={};if(Ke&32&&(St.amount=ye[5]),ue.$set(St),Ke&131){je=me([0,1,2,3,4,5]);let Te;for(Te=0;Te<6;Te+=1){let ft=EF(ye,je,Te);Ve[Te]?(Ve[Te].p(ft,Ke),P(Ve[Te],1)):(Ve[Te]=DF(ft),Ve[Te].c(),P(Ve[Te],1),Ve[Te].m(oe,$e))}for(Ee(),Te=6;Te<6;Te+=1)ke(Te);Ie()}if(Ke&64){Re=me(ye[6].filter(UF));let Te;for(Te=0;Te<Re.length;Te+=1){let ft=TF(ye,Re,Te);Oe[Te]?(Oe[Te].p(ft,Ke),P(Oe[Te],1)):(Oe[Te]=VF(ft),Oe[Te].c(),P(Oe[Te],1),Oe[Te].m(Q,null))}for(Ee(),Te=Re.length;Te<Oe.length;Te+=1)pt(Te);Ie()}if(Ke&2){wt=me(zF);let Te;for(Te=0;Te<wt.length;Te+=1){let ft=AF(ye,wt,Te);Je[Te]?(Je[Te].p(ft,Ke),P(Je[Te],1)):(Je[Te]=qF(ft),Je[Te].c(),P(Je[Te],1),Je[Te].m($,null))}for(Ee(),Te=wt.length;Te<Je.length;Te+=1)Et(Te);Ie()}},i(ye){if(!le){P(Xe.$$.fragment,ye),P(ue.$$.fragment,ye);for(let Ke=0;Ke<6;Ke+=1)P(Ve[Ke]);P(J.$$.fragment,ye);for(let Ke=0;Ke<Re.length;Ke+=1)P(Oe[Ke]);for(let Ke=0;Ke<wt.length;Ke+=1)P(Je[Ke]);le=!0}},o(ye){I(Xe.$$.fragment,ye),I(ue.$$.fragment,ye),Ve=Ve.filter(Boolean);for(let Ke=0;Ke<6;Ke+=1)I(Ve[Ke]);I(J.$$.fragment,ye),Oe=Oe.filter(Boolean);for(let Ke=0;Ke<Oe.length;Ke+=1)I(Oe[Ke]);Je=Je.filter(Boolean);for(let Ke=0;Ke<Je.length;Ke+=1)I(Je[Ke]);le=!1},d(ye){ye&&(x(e),x(Q),x($)),ee(Xe),ee(ue),it(Ve,ye),ee(J),it(Oe,ye),it(Je,ye)}}}function LV(t){let e,n,i=t[3]&&t[4].visible&&IF(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[3]&&s[4].visible?i?(i.p(s,o),o&24&&P(i,1)):(i=IF(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}var RF=!1,sv=new Map;ev.forEach((t,e)=>{let n=new Map;t.forEach((i,s)=>{n.set(s,i)}),sv.set(e,n)});var zF=[[6,8,7,9,12,13],[10,11,17,14,16],[15,19,18,25,26]],qV=t=>{let{from:e,to:n}=t.detail;e!==n&&e.type=="item"&&xt("itemmove",`${e.slot} ${n.slot}`)},BF=t=>{let{item:e}=t.detail;if(e!==void 0){let n=V.player.inventory.getFirstEmptySlot();n>=0&&xt("itemmove",`${t.detail.slot} ${n}`)}},UF=(t,e)=>e>=101;function RV(t,e,n){let i,s,o,r,l,a;se(t,jo,_=>n(0,s=_)),se(t,_o,_=>n(3,o=_)),se(t,Us,_=>n(4,r=_)),se(t,oa,_=>n(5,l=_)),se(t,ra,_=>n(6,a=_)),V&&V.player&&!RF&&(RF=!0,bl.forEach((_,b)=>{b-61==V.player.class&&_.statsConvert&&_.statsConvert.forEach(y=>{let k=ev.get(y[0])||new Map;k.set(y[2],(k.get(y[2])||0)+y[1]),sv.set(y[0],k)})}));let c,f=_=>{s[22]&&(xt("statincrease",_+" "+(nt.shift.down?10:1)),n(1,c=void 0),sn(18,50))},u=(_,b)=>n(1,c=_),m=_=>n(1,c=void 0),g=(_,b)=>f(_),v=()=>{Qe(_o,o=!1,o)};return t.$$.update=()=>{t.$$.dirty&1&&n(2,i=nc(s[20]||0))},[s,c,i,o,r,l,a,f,u,m,g,v]}var iv=class extends xe{constructor(e){super(),Ce(this,e,RV,LV,Ue,{})}},OF=iv;function $F(t,e,n){let i=t.slice();return i[16]=e[n],i}function zV(t){let e,n,i=t[4].listed?"\u{1F441}\uFE0F ":"",s,o=t[2].membercount+"",r,l,a,c,f;return{c(){e=h("div"),n=h("span"),s=T(i),r=T(o),l=T("/10"),p(e,"id","partybtn"),p(e,"class",a="btn border black textgreen "+(t[4].flashing?"flashing":"")+" svelte-14vfgvr")},m(u,m){w(u,e,m),d(e,n),d(n,s),d(e,r),d(e,l),c||(f=Y(e,"click",t[11]),c=!0)},p(u,m){m&16&&i!==(i=u[4].listed?"\u{1F441}\uFE0F ":"")&&G(s,i),m&4&&o!==(o=u[2].membercount+"")&&G(r,o),m&16&&a!==(a="btn border black textgreen "+(u[4].flashing?"flashing":"")+" svelte-14vfgvr")&&p(e,"class",a)},d(u){u&&x(e),c=!1,f()}}}function BV(t){let e,n,i;return{c(){e=h("div"),e.textContent=`${C.ui.party.noParty}`,p(e,"id","partybtn"),p(e,"class","btn border black textgrey")},m(s,o){w(s,e,o),n||(i=Y(e,"click",t[10]),n=!0)},p:ae,d(s){s&&x(e),n=!1,i()}}}function UV(t){let e=t[2].exprate+"",n,i,s=t[2].membercount===0?"":"/"+t[2].nearby,o;return{c(){n=T(e),i=T("% EXP"),o=T(s)},m(r,l){w(r,n,l),w(r,i,l),w(r,o,l)},p(r,l){l&4&&e!==(e=r[2].exprate+"")&&G(n,e),l&4&&s!==(s=r[2].membercount===0?"":"/"+r[2].nearby)&&G(o,s)},d(r){r&&(x(n),x(i),x(o))}}}function OV(t){let e=ht(~~t[1].exph)+"",n,i;return{c(){n=T(e),i=T(" EXP / h")},m(s,o){w(s,n,o),w(s,i,o)},p(s,o){o&2&&e!==(e=ht(~~s[1].exph)+"")&&G(n,e)},d(s){s&&(x(n),x(i))}}}function $V(t){let e=t[2].itemfind+"",n,i;return{c(){n=T(e),i=T("% FIND")},m(s,o){w(s,n,o),w(s,i,o)},p(s,o){o&4&&e!==(e=s[2].itemfind+"")&&G(n,e)},i:ae,o:ae,d(s){s&&(x(n),x(i))}}}function NV(t){let e,n,i;return e=new xn({props:{amount:Math.round(t[0].gph)}}),{c(){ne(e.$$.fragment),n=T(" / h")},m(s,o){K(e,s,o),w(s,n,o),i=!0},p(s,o){let r={};o&1&&(r.amount=Math.round(s[0].gph)),e.$set(r)},i(s){i||(P(e.$$.fragment,s),i=!0)},o(s){I(e.$$.fragment,s),i=!1},d(s){s&&x(n),ee(e,s)}}}function NF(t,e){let n,i,s;return i=new ru({props:{mode:"party",unit:e[16].unitStore,buffs:e[16].buffStore}}),{key:t,first:null,c(){n=he(),ne(i.$$.fragment),this.first=n},m(o,r){w(o,n,r),K(i,o,r),s=!0},p(o,r){e=o;let l={};r&256&&(l.unit=e[16].unitStore),r&256&&(l.buffs=e[16].buffStore),i.$set(l)},i(o){s||(P(i.$$.fragment,o),s=!0)},o(o){I(i.$$.fragment,o),s=!1},d(o){o&&x(n),ee(i,o)}}}function jV(t){let e,n,i,s,o,r,l,a,c,f=[],u=new Map,m,g,v;function _(L,z){return L[2].membercount===0?BV:zV}let b=_(t,-1),y=b(t);function k(L,z){return L[5]?OV:UV}let A=k(t,-1),S=A(t),F=[NV,$V],M=[];function D(L,z){return L[6]?0:1}r=D(t,-1),l=M[r]=F[r](t);let R=me(t[8]),E=L=>L[16].name;for(let L=0;L<R.length;L+=1){let z=$F(t,R,L),q=E(z);u.set(q,f[L]=NF(q,z))}return{c(){e=h("div"),n=h("div"),i=h("div"),i.textContent=`\u{1F465} ${C.ui.party.name}`,y.c(),s=h("div"),S.c(),o=h("div"),l.c(),a=We(),c=h("div");for(let L=0;L<f.length;L+=1)f[L].c();p(i,"class","btn party"),p(s,"class","btn border black textexp"),p(o,"class","btn border black textcyan"),p(n,"class","btnbar"),p(c,"class","partyframes svelte-14vfgvr"),qe(c,"width",t[7]+"px"),p(e,"class","l-corner-ul uiscaled")},m(L,z){w(L,e,z),d(e,n),d(n,i),y.m(n,null),d(n,s),S.m(s,null),d(n,o),M[r].m(o,null),d(e,a),d(e,c);for(let q=0;q<f.length;q+=1)f[q]&&f[q].m(c,null);m=!0,g||(v=[Y(i,"click",t[9]),Y(s,"click",t[12]),Y(s,"contextmenu",au),Y(o,"click",t[13]),Y(o,"contextmenu",au)],g=!0)},p(L,[z]){b===(b=_(L,z))&&y?y.p(L,z):(y.d(1),y=b(L),y&&(y.c(),y.m(n,s))),A===(A=k(L,z))&&S?S.p(L,z):(S.d(1),S=A(L),S&&(S.c(),S.m(s,null)));let q=r;r=D(L,z),r===q?M[r].p(L,z):(Ee(),I(M[q],1,1,()=>{M[q]=null}),Ie(),l=M[r],l?l.p(L,z):(l=M[r]=F[r](L),l.c()),P(l,1),l.m(o,null)),z&256&&(R=me(L[8]),Ee(),f=ui(f,z,E,1,L,R,u,c,Di,NF,null,$F),Ie()),(!m||z&128)&&qe(c,"width",L[7]+"px")},i(L){if(!m){P(l);for(let z=0;z<R.length;z+=1)P(f[z]);m=!0}},o(L){I(l);for(let z=0;z<f.length;z+=1)I(f[z]);m=!1},d(L){L&&x(e),y.d(),S.d(),M[r].d();for(let z=0;z<f.length;z+=1)f[z].d();g=!1,at(v)}}}function WV(t,e,n){let i,s,o,r,l,a,c,f,u;se(t,bm,A=>n(0,i=A)),se(t,ym,A=>n(1,s=A)),se(t,Zn,A=>n(2,o=A)),se(t,Zi,A=>n(3,r=A)),se(t,Hi,A=>n(4,l=A)),se(t,of,A=>n(5,a=A)),se(t,sf,A=>n(6,c=A)),se(t,Jr,A=>n(7,f=A)),se(t,ia,A=>n(8,u=A));let m=A=>{let S=[{name:"Party Panel",fun:()=>{Qe(Zi,r=!0,r)}},o.membercount?Jt.partyleave():Jt.partycreate()];bn.set({x:A.pageX,y:A.pageY,opts:S})},g=()=>{console.log(s)},v=()=>{console.log(i)};return[i,s,o,r,l,a,c,f,u,m,A=>Qe(Zi,r=!r,r),A=>Qe(Zi,r=!r,r),A=>{Qe(of,a=!a,a)},A=>{Qe(sf,c=!c,c)}]}var ov=class extends xe{constructor(e){super(),Ce(this,e,WV,jV,Ue,{})}},jF=ov;function GV(t){let e;return{c(){e=h("div"),p(e,"class","pattern svelte-1m0q37p")},m(n,i){w(n,e,i)},p:ae,d(n){n&&x(e)}}}function HV(t){let e,n,i;return n=new vi({props:{size:"0.8em",fract:t[0],barcol:"bgexp",left:t[1],right:`${t[0]}%`,$$slots:{default:[GV]},$$scope:{ctx:t}}}),{c(){e=h("div"),ne(n.$$.fragment),p(e,"id","expbar"),p(e,"class","container svelte-1m0q37p")},m(s,o){w(s,e,o),K(n,e,null),i=!0},p(s,[o]){let r={};o&1&&(r.fract=s[0]),o&2&&(r.left=s[1]),o&1&&(r.right=`${s[0]}%`),o&8&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&x(e),ee(n)}}}function YV(t,e,n){let i;se(t,mm,r=>n(2,i=r));let s,o;return t.$$.update=()=>{t.$$.dirty&4&&(n(0,s=(100*i.current/i.max).toFixed(2)),n(1,o=`${ht(i.current)} / ${ht(i.max)} EXP`))},[s,o,i]}var rv=class extends xe{constructor(e){super(),Ce(this,e,YV,HV,Ue,{})}},WF=rv;function GF(t){let e,n,i=t[5].msg+"",s,o,r,l=t[5].fixed||t[5].step||t[5].fixed?"Skip":"Next",a,c,f,u,m,g=(t[5].fixed||t[5].step||t[5].fixed)&&HF(t);return{c(){e=h("div"),n=h("div"),g&&g.c(),s=h("div"),o=h("div"),o.textContent="Disable tutorial",r=h("div"),a=T(l),p(n,"class","textprimary msgtext svelte-wv9du9"),p(o,"class","btn grey"),p(r,"class","btn green"),p(s,"class","marg-top"),qe(s,"display","flex"),qe(s,"justify-content","space-between"),p(e,"class",c="msg "+(t[5].complete?"complete":"")+" svelte-wv9du9"),qe(e,"cursor","pointer")},m(v,_){w(v,e,_),d(e,n),n.innerHTML=i,g&&g.m(e,null),d(e,s),d(s,o),d(s,r),d(r,a),f=!0,u||(m=[Y(o,"click",t[6]),Y(e,"click",t[7])],u=!0)},p(v,_){(!f||_&32)&&i!==(i=v[5].msg+"")&&(n.innerHTML=i),v[5].fixed||v[5].step||v[5].fixed?g?(g.p(v,_),_&32&&P(g,1)):(g=HF(v),g.c(),P(g,1),g.m(e,s)):g&&(Ee(),I(g,1,1,()=>{g=null}),Ie()),(!f||_&32)&&l!==(l=v[5].fixed||v[5].step||v[5].fixed?"Skip":"Next")&&G(a,l),(!f||_&32&&c!==(c="msg "+(v[5].complete?"complete":"")+" svelte-wv9du9"))&&p(e,"class",c)},i(v){f||(P(g),f=!0)},o(v){I(g),f=!1},d(v){v&&x(e),g&&g.d(),u=!1,at(m)}}}function HF(t){let e,n;return e=new vi({props:{size:"0.8em",fract:t[5].progress,barcol:"bgtut",left:"",right:Math.ceil(t[5].progress)+"%"}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&32&&(o.fract=i[5].progress),s&32&&(o.right=Math.ceil(i[5].progress)+"%"),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function YF(t){let e,n;return{c(){e=h("div"),p(e,"class",n="border skill tut "+(t[5].complete?"complete":"")+" svelte-wv9du9"),qe(e,"top",t[2]+"px"),qe(e,"left",t[1]+"px"),qe(e,"width",t[3]+"px"),qe(e,"height",t[4]+"px")},m(i,s){w(i,e,s)},p(i,s){s&32&&n!==(n="border skill tut "+(i[5].complete?"complete":"")+" svelte-wv9du9")&&p(e,"class",n),s&4&&qe(e,"top",i[2]+"px"),s&2&&qe(e,"left",i[1]+"px"),s&8&&qe(e,"width",i[3]+"px"),s&16&&qe(e,"height",i[4]+"px")},d(i){i&&x(e)}}}function XV(t){let e,n,i,s=t[5]&&t[5].msg&&GF(t),o=t[0]&&YF(t);return{c(){s&&s.c(),e=he(),o&&o.c(),n=he()},m(r,l){s&&s.m(r,l),w(r,e,l),o&&o.m(r,l),w(r,n,l),i=!0},p(r,[l]){r[5]&&r[5].msg?s?(s.p(r,l),l&32&&P(s,1)):(s=GF(r),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),I(s,1,1,()=>{s=null}),Ie()),r[0]?o?o.p(r,l):(o=YF(r),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},i(r){i||(P(s),i=!0)},o(r){I(s),i=!1},d(r){r&&(x(e),x(n)),s&&s.d(r),o&&o.d(r)}}}function QV(t,e,n){let i;se(t,$o,u=>n(5,i=u));let s=!1,o,r,l,a;return $o.subscribe(u=>{if(u){let m=document.getElementById(u.element);if(m){n(0,s=!0);let g=m.getBoundingClientRect();n(3,l=g.width+10),n(4,a=g.height+10),n(1,o=g.x-5),n(2,r=g.y-5)}else n(0,s=!1)}else n(0,s=!1)}),[s,o,r,l,a,i,u=>Gs.set(1e3),u=>{sn(-1,100)}]}var lv=class extends xe{constructor(e){super(),Ce(this,e,QV,XV,Ue,{})}},XF=lv;function ZV(t,e,n){let i=t.slice();return i[7]=e[n],i[9]=n,i}function QF(t){let e,n;return e=new jt({props:{zindex:8,origin:"center",title:"Report a player",$$slots:{default:[tL]},$$scope:{ctx:t}}}),e.$on("close",t[4]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&1031&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function JV(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[7]}`,e.__value=n=t[9],Ne(e,e.__value)},m(i,s){w(i,e,s)},p:ae,d(i){i&&x(e)}}}function ZF(t){let e,n=t[2].info+"",i;return{c(){e=h("p"),i=T(n),p(e,"class","textprimary")},m(s,o){w(s,e,o),d(e,i)},p(s,o){o&4&&n!==(n=s[2].info+"")&&G(i,n)},d(s){s&&x(e)}}}function KV(t){let e,n=(t[0].result==="ok"?"Report submitted.":t[0].result)+"",i,s,o,r,l,a;return{c(){e=h("p"),i=T(n),o=h("div"),r=h("div"),r.textContent="Close",p(e,"class",s=t[0].result==="ok"?"textgreen":"textred"),p(r,"class","btn grey navbtn"),p(o,"class","subnav")},m(c,f){w(c,e,f),d(e,i),w(c,o,f),d(o,r),l||(a=Y(r,"click",t[4]),l=!0)},p(c,f){f&1&&n!==(n=(c[0].result==="ok"?"Report submitted.":c[0].result)+"")&&G(i,n),f&1&&s!==(s=c[0].result==="ok"?"textgreen":"textred")&&p(e,"class",s)},d(c){c&&(x(e),x(o)),l=!1,a()}}}function eL(t){let e,n,i,s,o,r,l,a,c;return{c(){e=h("div"),n=h("div"),i=T("Report"),o=h("div"),r=T("Cancel"),p(n,"class",s="btn grey navbtn "+(t[1]?"disabled":"")),p(o,"class",l="btn grey navbtn "+(t[1]?"disabled":"")),p(e,"class","subnav")},m(f,u){w(f,e,u),d(e,n),d(n,i),d(e,o),d(o,r),a||(c=[Y(n,"click",t[3]),Y(o,"click",t[4])],a=!0)},p(f,u){u&2&&s!==(s="btn grey navbtn "+(f[1]?"disabled":""))&&p(n,"class",s),u&2&&l!==(l="btn grey navbtn "+(f[1]?"disabled":""))&&p(o,"class",l)},d(f){f&&x(e),a=!1,at(c)}}}function tL(t){let e,n,i,s,o=t[2].name+"",r,l,a,c,f,u,m,g=C.ui.report.info[t[2].reason]+"",v,_,b,y,k,A,S,F,M=me(C.ui.report.reasons),D=[];for(let q=0;q<M.length;q+=1)D[q]=JV(ZV(t,M,q));let R=t[2].info&&ZF(t);function E(q,j){return q[0]?KV:eL}let L=E(t,-1),z=L(t);return{c(){e=h("div"),n=h("p"),i=T("Describe what happened with "),s=h("span"),r=T(o),l=T(" as accurately as you can:"),a=h("div"),c=h("select");for(let q=0;q<D.length;q+=1)D[q].c();u=h("p"),m=h("small"),v=T(g),R&&R.c(),_=h("div"),b=h("textarea"),A=h("p"),A.innerHTML='<small>Please do not file false reports. If you are unsure about a players behavior, refer to our <a href="/terms" target="_blank">Conduct Policy</a>.</small>',z.c(),p(s,"class","textprimary"),p(c,"class",f=t[1]?"disabled":""),t[2].reason===void 0&&_n(()=>t[5].call(c)),p(a,"class","subnav"),p(u,"class","textgrey"),p(b,"maxlength",y=300),p(b,"class",k="scrollbar reportdescription "+(t[1]?"disabled":"")+" svelte-jnzoj3"),p(b,"rows","4"),p(b,"placeholder","Provide additional context, a little description of the situation helps our moderators."),p(_,"class","subnav"),p(A,"class","textgrey"),p(e,"class","card container svelte-jnzoj3")},m(q,j){w(q,e,j),d(e,n),d(n,i),d(n,s),d(s,r),d(n,l),d(e,a),d(a,c);for(let W=0;W<D.length;W+=1)D[W]&&D[W].m(c,null);Mn(c,t[2].reason,!0),d(e,u),d(u,m),d(m,v),R&&R.m(e,null),d(e,_),d(_,b),Ne(b,t[2].description),d(e,A),z.m(e,null),S||(F=[Y(c,"change",t[5]),Y(b,"input",t[6])],S=!0)},p(q,j){j&4&&o!==(o=q[2].name+"")&&G(r,o),j&2&&f!==(f=q[1]?"disabled":"")&&p(c,"class",f),j&4&&Mn(c,q[2].reason),j&4&&g!==(g=C.ui.report.info[q[2].reason]+"")&&G(v,g),q[2].info?R?R.p(q,j):(R=ZF(q),R.c(),R.m(e,_)):R&&(R.d(1),R=null),j&2&&k!==(k="scrollbar reportdescription "+(q[1]?"disabled":"")+" svelte-jnzoj3")&&p(b,"class",k),j&4&&Ne(b,q[2].description),L===(L=E(q,j))&&z?z.p(q,j):(z.d(1),z=L(q),z&&(z.c(),z.m(e,null)))},d(q){q&&x(e),it(D,q),R&&R.d(),z.d(),S=!1,at(F)}}}function nL(t){let e,n,i=t[2]!==void 0&&QF(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[2]!==void 0?i?(i.p(s,o),o&4&&P(i,1)):(i=QF(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function iL(t,e,n){let i;se(t,fo,f=>n(2,i=f));let s,o=!1,r=async()=>{n(1,o=!0),n(0,s=await Nt("/api/report/submit",{name:i.name,reason:i.reason,messageId:i.messageId,description:i.description||""}))},l=()=>{Qe(fo,i=void 0,i),n(0,s=void 0),n(1,o=void 0)};function a(){i.reason=ki(this),fo.set(i)}function c(){i.description=this.value,fo.set(i)}return[s,o,i,r,l,a,c]}var av=class extends xe{constructor(e){super(),Ce(this,e,iL,nL,Ue,{})}},JF=av;var kl=t=>Math.round((10+t*5)**1.85/50)*50,xl=t=>Math.min(100,8+t*2);var KF=(t,e=200)=>{let n;return(i,s)=>{n&&clearTimeout(n),n=setTimeout(o=>t(i),s??e)}};function eC(t,e,n){let i=t.slice();return i[17]=e[n],i[19]=n,i}function tC(t){let e,n,i,s=me(t[1]),o=[];for(let a=0;a<s.length;a+=1)o[a]=iC(eC(t,s,a));let r=a=>I(o[a],1,1,()=>{o[a]=null}),l=null;return s.length||(l=nC(t)),{c(){e=h("div");for(let a=0;a<o.length;a+=1)o[a].c();n=he(),l&&l.c(),p(e,"class","divider")},m(a,c){w(a,e,c);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(a,c);w(a,n,c),l&&l.m(a,c),i=!0},p(a,c){if(c&74){s=me(a[1]);let f;for(f=0;f<s.length;f+=1){let u=eC(a,s,f);o[f]?(o[f].p(u,c),P(o[f],1)):(o[f]=iC(u),o[f].c(),P(o[f],1),o[f].m(n.parentNode,n))}for(Ee(),f=s.length;f<o.length;f+=1)r(f);Ie(),!s.length&&l?l.p(a,c):s.length?l&&(l.d(1),l=null):(l=nC(a),l.c(),l.m(n.parentNode,n))}},i(a){if(!i){for(let c=0;c<s.length;c+=1)P(o[c]);i=!0}},o(a){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)I(o[c]);i=!1},d(a){a&&(x(e),x(n)),it(o,a),l&&l.d(a)}}}function nC(t){let e;return{c(){e=h("div"),e.textContent="No results",p(e,"class","textgrey result")},m(n,i){w(n,e,i)},p:ae,d(n){n&&x(e)}}}function iC(t){let e,n,i,s,o,r,l=[t[17]],a={};for(let f=0;f<l.length;f+=1)a=Hl(a,l[f]);n=new Bi({props:a});function c(...f){return t[14](t[19],...f)}return{c(){e=h("div"),ne(n.$$.fragment),p(e,"class",i="result "+(t[19]===t[3]?"sel":""))},m(f,u){w(f,e,u),K(n,e,null),s=!0,o||(r=Y(e,"mousedown",c),o=!0)},p(f,u){t=f;let m=u&2?lm(l,[am(t[17])]):{};n.$set(m),(!s||u&8&&i!==(i="result "+(t[19]===t[3]?"sel":"")))&&p(e,"class",i)},i(f){s||(P(n.$$.fragment,f),s=!0)},o(f){I(n.$$.fragment,f),s=!1},d(f){f&&x(e),ee(n),o=!1,r()}}}function sL(t){let e,n,i,s,o,r,l,a=t[2]&&tC(t);return{c(){e=h("div"),n=h("div"),i=h("input"),a&&a.c(),p(i,"placeholder","Name"),p(i,"type","text"),p(n,"class",s="container input "+(t[2]?"focus":"")),p(e,"class","navbtn finder")},m(c,f){w(c,e,f),d(e,n),d(n,i),t[10](i),Ne(i,t[0]),a&&a.m(n,null),o=!0,r||(l=[Y(i,"input",t[11]),Y(i,"input",t[5]),Y(i,"focus",t[12]),Y(i,"blur",t[13])],r=!0)},p(c,[f]){f&1&&i.value!==c[0]&&Ne(i,c[0]),c[2]?a?(a.p(c,f),f&4&&P(a,1)):(a=tC(c),a.c(),P(a,1),a.m(n,null)):a&&(Ee(),I(a,1,1,()=>{a=null}),Ie()),(!o||f&4&&s!==(s="container input "+(c[2]?"focus":"")))&&p(n,"class",s)},i(c){o||(P(a),o=!0)},o(c){I(a),o=!1},d(c){c&&x(e),t[10](null),a&&a.d(),r=!1,at(l)}}}function oL(t,e,n){let i=KF(async()=>{n(1,a=await Nt("api/playerinfo/search",{[r]:o,order:"name",limit:l})),g(a.findIndex(S=>S.name.toLowerCase()==o.toLowerCase()))}),{id:s}=e,{name:o=""}=e,{type:r="name"}=e,{limit:l=5}=e,a=[],c=!1,f=-1,u,m,g=S=>{n(3,f=S),f>=0&&(u=a[f],n(0,o=u.name),n(7,s=u.id))},v=S=>{S.target==m&&((S.keyCode===38||S.keyCode===40)&&a.length?(g(wa(f+(S.keyCode===38?-1:1),a.length)),S.preventDefault()):(S.keyCode==13||S.keyCode==27)&&m.blur())};Fn(()=>{document.addEventListener("keydown",v)}),Tn(()=>{document.removeEventListener("keydown",v),n(4,m=void 0)});function _(S){Bt[S?"unshift":"push"](()=>{m=S,n(4,m)})}function b(){o=this.value,n(0,o)}let y=S=>n(2,c=!0),k=S=>n(2,c=!1),A=(S,F)=>g(S);return t.$$set=S=>{"id"in S&&n(7,s=S.id),"name"in S&&n(0,o=S.name),"type"in S&&n(8,r=S.type),"limit"in S&&n(9,l=S.limit)},[o,a,c,f,m,i,g,s,r,l,_,b,y,k,A]}var cv=class extends xe{constructor(e){super(),Ce(this,e,oL,sL,Ue,{id:7,name:0,type:8,limit:9})}},Cd=cv;function sC(t,e,n){let i=t.slice();return i[24]=e[n],i[23]=n,i}function oC(t,e,n){let i=t.slice();return i[21]=e[n],i[23]=n,i}function rC(t,e,n){let i=t.slice();return i[26]=e[n],i[23]=n,i}function lC(t){let e,n,i,s,o,r,l,a,c=t[0].tag+"",f,u,m=t[0].name+"",g,v,_,b=C.factions[t[0].faction].name+"",y,k,A=C.ui.clan.heading+"",S,F,M,D,R,E,L,z,q=t[0].level+"",j,W,U,O=xl(t[0].level)+"",Z,ve,Fe,_e,ce=xl(t[0].level+1)-xl(t[0].level)+"",fe,ze,Pe=C.ui.clan.capacity+"",Me,be,H,pe=t[0].tax+"",Be,Ge,Xe,Ye,ue,oe,$e=t[0].members.length+"",J,Q,$,le=`${t[0].online} (+${t[0].online*60} EXP/h)`,je,Ve,ke,Re,Oe,pt,wt=ht(t[0].prestige)+"",Je,Et,ye,Ke,yt,St,Te,ft,$t,Le,Ct,Lt,He,et;M=new vi({props:{size:"1em",fract:Math.ceil(t[0].exp/kl(t[0].level)*100),barcol:"bgpurp",left:`${ht(t[0].exp)} / ${ht(kl(t[0].level))} EXP`,right:`${Math.ceil(t[0].exp/kl(t[0].level)*100)}% `}}),ye=new xn({props:{amount:t[0].gold}});let Se=t[0].role>-1&&aC(t),ot=t[0].role>0&&cC(t),Ze=t[0].eligibleApply.length>0&&fC(t),ut=t[1]&&mC(t),wn=t[0].role>0&&pC(t),Ss=[lL,rL],li=[];function Ii(dt,qt){return dt[6]=="members"?0:dt[6]=="applications"?1:-1}return~(Le=Ii(t,-1))&&(Ct=li[Le]=Ss[Le](t)),{c(){e=h("div"),n=h("div"),i=h("div"),s=h("img"),r=h("div"),l=h("div"),a=h("h1"),f=T(c),u=h("h3"),g=T(m),_=h("p"),y=T(b),k=We(),S=T(A),F=h("div"),ne(M.$$.fragment),D=h("div"),R=h("div"),E=h("div"),L=h("span"),L.textContent=`${C.ui.clan.level}`,z=h("span"),j=T(q),W=h("span"),W.textContent=`${C.ui.clan.capacity}`,U=h("span"),Z=T(O),ve=h("span"),ve.textContent=`${C.ui.clan.nextlevel}`,Fe=h("span"),_e=T("+"),fe=T(ce),ze=We(),Me=T(Pe),be=h("span"),be.textContent=`${C.ui.clan.taxrate}`,H=h("span"),Be=T(pe),Ge=T("%"),Xe=h("div"),Ye=h("div"),ue=h("span"),ue.textContent=`${C.ui.clan.members}`,oe=h("span"),J=T($e),Q=h("span"),Q.textContent=`${C.ui.clan.online}`,$=h("span"),je=T(le),Ve=h("span"),Ve.textContent=`${C.ui.stats.array[20]}`,ke=h("span"),Re=h("img"),pt=We(),Je=T(wt),Et=h("span"),Et.textContent=`${C.ui.clan.treasury}`,ne(ye.$$.fragment),Se&&Se.c(),Ke=he(),ot&&ot.c(),yt=he(),Ze&&Ze.c(),St=he(),ut&&ut.c(),Te=h("div"),ft=h("div"),$t=h("div"),$t.textContent=`${C.ui.clan.members}`,wn&&wn.c(),Ct&&Ct.c(),p(s,"class","helmet absCentered svelte-6t8hqd"),lt(s.src,o="/data/ui/factions/"+t[0].faction+".svg?v=8602459")||p(s,"src",o),p(l,"class",v="textf"+t[0].faction+" svelte-6t8hqd"),p(r,"class","textcenter"),p(i,"class","hero svelte-6t8hqd"),p(F,"class","panel-black svelte-6t8hqd"),p(L,"class","textprimary"),p(W,"class","textprimary"),p(ve,"class","textprimary"),p(be,"class","textprimary"),p(E,"class","panel-black grid two svelte-6t8hqd"),p(ue,"class","textprimary"),p(Q,"class","textprimary"),p(Ve,"class","textprimary"),p(Re,"class","svgicon"),lt(Re.src,Oe=Na)||p(Re,"src",Oe),p(ke,"class","textprestige"),p(Et,"class","textprimary"),p(Ye,"class","panel-black grid two svelte-6t8hqd"),p(D,"class","marg-top grid two"),p(n,"class","row slim"),p(e,"class","fold fadeIn"),p($t,"class","btn navbtn grey"),p(ft,"class","subnav marg-top"),p(Te,"class","row slim fadeIn")},m(dt,qt){w(dt,e,qt),d(e,n),d(n,i),d(i,s),d(i,r),d(r,l),d(l,a),d(a,f),d(l,u),d(u,g),d(r,_),d(_,y),d(_,k),d(_,S),d(n,F),K(M,F,null),d(n,D),d(D,R),d(R,E),d(E,L),d(E,z),d(z,j),d(E,W),d(E,U),d(U,Z),d(E,ve),d(E,Fe),d(Fe,_e),d(Fe,fe),d(Fe,ze),d(Fe,Me),d(E,be),d(E,H),d(H,Be),d(H,Ge),d(D,Xe),d(Xe,Ye),d(Ye,ue),d(Ye,oe),d(oe,J),d(Ye,Q),d(Ye,$),d($,je),d(Ye,Ve),d(Ye,ke),d(ke,Re),d(ke,pt),d(ke,Je),d(Ye,Et),K(ye,Ye,null),Se&&Se.m(n,null),d(n,Ke),ot&&ot.m(n,null),d(n,yt),Ze&&Ze.m(n,null),d(n,St),ut&&ut.m(n,null),w(dt,Te,qt),d(Te,ft),d(ft,$t),wn&&wn.m(ft,null),~Le&&li[Le].m(Te,null),Lt=!0,He||(et=Y($t,"click",t[14]),He=!0)},p(dt,qt){(!Lt||qt&1&&!lt(s.src,o="/data/ui/factions/"+dt[0].faction+".svg?v=8602459"))&&p(s,"src",o),(!Lt||qt&1)&&c!==(c=dt[0].tag+"")&&G(f,c),(!Lt||qt&1)&&m!==(m=dt[0].name+"")&&G(g,m),(!Lt||qt&1&&v!==(v="textf"+dt[0].faction+" svelte-6t8hqd"))&&p(l,"class",v),(!Lt||qt&1)&&b!==(b=C.factions[dt[0].faction].name+"")&&G(y,b);let As={};qt&1&&(As.fract=Math.ceil(dt[0].exp/kl(dt[0].level)*100)),qt&1&&(As.left=`${ht(dt[0].exp)} / ${ht(kl(dt[0].level))} EXP`),qt&1&&(As.right=`${Math.ceil(dt[0].exp/kl(dt[0].level)*100)}% `),M.$set(As),(!Lt||qt&1)&&q!==(q=dt[0].level+"")&&G(j,q),(!Lt||qt&1)&&O!==(O=xl(dt[0].level)+"")&&G(Z,O),(!Lt||qt&1)&&ce!==(ce=xl(dt[0].level+1)-xl(dt[0].level)+"")&&G(fe,ce),(!Lt||qt&1)&&pe!==(pe=dt[0].tax+"")&&G(Be,pe),(!Lt||qt&1)&&$e!==($e=dt[0].members.length+"")&&G(J,$e),(!Lt||qt&1)&&le!==(le=`${dt[0].online} (+${dt[0].online*60} EXP/h)`)&&G(je,le),(!Lt||qt&1)&&wt!==(wt=ht(dt[0].prestige)+"")&&G(Je,wt);let jn={};qt&1&&(jn.amount=dt[0].gold),ye.$set(jn),dt[0].role>-1?Se?Se.p(dt,qt):(Se=aC(dt),Se.c(),Se.m(n,Ke)):Se&&(Se.d(1),Se=null),dt[0].role>0?ot?(ot.p(dt,qt),qt&1&&P(ot,1)):(ot=cC(dt),ot.c(),P(ot,1),ot.m(n,yt)):ot&&(Ee(),I(ot,1,1,()=>{ot=null}),Ie()),dt[0].eligibleApply.length>0?Ze?Ze.p(dt,qt):(Ze=fC(dt),Ze.c(),Ze.m(n,St)):Ze&&(Ze.d(1),Ze=null),dt[1]?ut?ut.p(dt,qt):(ut=mC(dt),ut.c(),ut.m(n,null)):ut&&(ut.d(1),ut=null),dt[0].role>0?wn?wn.p(dt,qt):(wn=pC(dt),wn.c(),wn.m(ft,null)):wn&&(wn.d(1),wn=null);let ai=Le;Le=Ii(dt,qt),Le===ai?~Le&&li[Le].p(dt,qt):(Ct&&(Ee(),I(li[ai],1,1,()=>{li[ai]=null}),Ie()),~Le?(Ct=li[Le],Ct?Ct.p(dt,qt):(Ct=li[Le]=Ss[Le](dt),Ct.c()),P(Ct,1),Ct.m(Te,null)):Ct=null)},i(dt){Lt||(P(M.$$.fragment,dt),P(ye.$$.fragment,dt),P(ot),P(Ct),Lt=!0)},o(dt){I(M.$$.fragment,dt),I(ye.$$.fragment,dt),I(ot),I(Ct),Lt=!1},d(dt){dt&&(x(e),x(Te)),ee(M),ee(ye),Se&&Se.d(),ot&&ot.d(),Ze&&Ze.d(),ut&&ut.d(),wn&&wn.d(),~Le&&li[Le].d(),He=!1,et()}}}function aC(t){let e,n,i,s=C.ui.clan.roles[t[0].role]+"",o;return{c(){e=h("div"),n=h("span"),n.textContent=`${C.ui.clan.highestrank}: `,i=h("span"),o=T(s),p(n,"class","textprimary"),p(i,"class","textgreen"),p(e,"class","marg-top panel-black svelte-6t8hqd")},m(r,l){w(r,e,l),d(e,n),d(e,i),d(i,o)},p(r,l){l&1&&s!==(s=C.ui.clan.roles[r[0].role]+"")&&G(o,s)},d(r){r&&x(e)}}}function cC(t){let e,n,i,s,o,r,l=C.ui.clan.inviteplayer+"",a,c,f,u,m;function g(_){t[12](_)}let v={};return t[4]!==void 0&&(v.name=t[4]),s=new Cd({props:v}),Bt.push(()=>zo(s,"name",g)),{c(){e=h("div"),n=h("span"),n.textContent=`${C.ui.clan.inviteplayers}`,i=h("div"),ne(s.$$.fragment),r=h("div"),a=T(l),p(n,"class","textgrey"),p(r,"class",c="btn formatted navbtn grey "+(t[3]||!t[4].length?"disabled":"")),p(i,"class","subnav"),p(e,"class","marg-top panel-black svelte-6t8hqd")},m(_,b){w(_,e,b),d(e,n),d(e,i),K(s,i,null),d(i,r),d(r,a),f=!0,u||(m=Y(r,"click",t[8]),u=!0)},p(_,b){let y={};!o&&b&16&&(o=!0,y.name=_[4],Ro(()=>o=!1)),s.$set(y),(!f||b&24&&c!==(c="btn formatted navbtn grey "+(_[3]||!_[4].length?"disabled":"")))&&p(r,"class",c)},i(_){f||(P(s.$$.fragment,_),f=!0)},o(_){I(s.$$.fragment,_),f=!1},d(_){_&&x(e),ee(s),u=!1,m()}}}function fC(t){let e,n,i,s,o,r=C.ui.apply+"",l,a,c,f,u=me(t[0].eligibleApply),m=[];for(let g=0;g<u.length;g+=1)m[g]=uC(rC(t,u,g));return{c(){e=h("div"),n=h("span"),n.textContent=`${C.ui.clan.apply}`,i=h("div"),s=h("select");for(let g=0;g<m.length;g+=1)m[g].c();o=h("div"),l=T(r),p(n,"class","textgrey"),p(s,"class","navbtn"),t[5]===void 0&&_n(()=>t[13].call(s)),p(o,"class",a="btn formatted navbtn grey "+(t[3]||!t[5].length?"disabled":"")),p(i,"class","subnav"),p(e,"class","marg-top panel-black svelte-6t8hqd")},m(g,v){w(g,e,v),d(e,n),d(e,i),d(i,s);for(let _=0;_<m.length;_+=1)m[_]&&m[_].m(s,null);Mn(s,t[5],!0),d(i,o),d(o,l),c||(f=[Y(s,"change",t[13]),Y(o,"click",t[9])],c=!0)},p(g,v){if(v&33){u=me(g[0].eligibleApply);let _;for(_=0;_<u.length;_+=1){let b=rC(g,u,_);m[_]?m[_].p(b,v):(m[_]=uC(b),m[_].c(),m[_].m(s,null))}for(;_<m.length;_+=1)m[_].d(1);m.length=u.length}v&33&&Mn(s,g[5]),v&41&&a!==(a="btn formatted navbtn grey "+(g[3]||!g[5].length?"disabled":""))&&p(o,"class",a)},d(g){g&&x(e),it(m,g),c=!1,at(f)}}}function uC(t){let e,n=t[26]+"",i,s,o;return{c(){e=h("option"),i=T(n),e.selected=s=t[5]==t[26],e.__value=o=t[26],Ne(e,e.__value)},m(r,l){w(r,e,l),d(e,i)},p(r,l){l&1&&n!==(n=r[26]+"")&&G(i,n),l&33&&s!==(s=r[5]==r[26])&&(e.selected=s),l&1&&o!==(o=r[26])&&(e.__value=o,Ne(e,e.__value))},d(r){r&&x(e)}}}function mC(t){let e,n,i,s,o;return{c(){e=h("div"),n=h("span"),i=T(t[1]),p(n,"class",s="text"+t[2]+" svelte-6t8hqd"),p(e,"class",o="marg-top panel-black border "+t[2]+" svelte-6t8hqd")},m(r,l){w(r,e,l),d(e,n),d(n,i)},p(r,l){l&2&&G(i,r[1]),l&4&&s!==(s="text"+r[2]+" svelte-6t8hqd")&&p(n,"class",s),l&4&&o!==(o="marg-top panel-black border "+r[2]+" svelte-6t8hqd")&&p(e,"class",o)},d(r){r&&x(e)}}}function pC(t){let e,n=C.ui.clan.applications+"",i,s,o=t[0].applications.length+"",r,l,a,c,f;return{c(){e=h("div"),i=T(n),s=T(" ("),r=T(o),l=T(")"),a=We(),p(e,"class","btn navbtn grey")},m(u,m){w(u,e,m),d(e,i),d(e,s),d(e,r),d(e,l),w(u,a,m),c||(f=Y(e,"click",t[15]),c=!0)},p(u,m){m&1&&o!==(o=u[0].applications.length+"")&&G(r,o)},d(u){u&&(x(e),x(a)),c=!1,f()}}}function rL(t){let e,n,i,s,o,r,l=[],a=new Map,c,f=me(t[0].applications),u=m=>m[24].name;for(let m=0;m<f.length;m+=1){let g=sC(t,f,m),v=u(g);a.set(v,l[m]=dC(v,g))}return{c(){e=h("div"),e.textContent=`${C.ui.clan.applicationdesc}`,n=h("table"),i=h("thead"),s=h("tr"),o=h("th"),o.textContent=`${C.ui.clan.player}`,r=h("tbody");for(let m=0;m<l.length;m+=1)l[m].c();p(e,"class","marg-top textgrey"),p(o,"width","70%"),p(s,"class","textprimary"),p(n,"class","marg-top panel-black svelte-6t8hqd")},m(m,g){w(m,e,g),w(m,n,g),d(n,i),d(i,s),d(s,o),d(n,r);for(let v=0;v<l.length;v+=1)l[v]&&l[v].m(r,null);c=!0},p(m,g){g&1025&&(f=me(m[0].applications),Ee(),l=ui(l,g,u,1,m,f,a,r,Di,dC,null,sC),Ie())},i(m){if(!c){for(let g=0;g<f.length;g+=1)P(l[g]);c=!0}},o(m){for(let g=0;g<l.length;g+=1)I(l[g]);c=!1},d(m){m&&(x(e),x(n));for(let g=0;g<l.length;g+=1)l[g].d()}}}function lL(t){let e,n,i,s,o,r,l,a=[],c=new Map,f,u=me(t[0].members),m=g=>g[21].name;for(let g=0;g<u.length;g+=1){let v=oC(t,u,g),_=m(v);c.set(_,a[g]=hC(_,v))}return{c(){e=h("div"),e.textContent=`${C.ui.clan.memberdesc}`,n=h("table"),i=h("thead"),s=h("tr"),o=h("th"),o.textContent=`${C.ui.clan.roles[0]}`,r=h("th"),r.textContent=`${C.ui.clan.rank}`,l=h("tbody");for(let g=0;g<a.length;g+=1)a[g].c();p(e,"class","marg-top textgrey"),p(o,"width","70%"),p(s,"class","textprimary"),p(n,"class","marg-top panel-black svelte-6t8hqd")},m(g,v){w(g,e,v),w(g,n,v),d(n,i),d(i,s),d(s,o),d(s,r),d(n,l);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(l,null);f=!0},p(g,v){v&129&&(u=me(g[0].members),Ee(),a=ui(a,v,m,1,g,u,c,l,Di,hC,null,oC),Ie())},i(g){if(!f){for(let v=0;v<u.length;v+=1)P(a[v]);f=!0}},o(g){for(let v=0;v<a.length;v+=1)I(a[v]);f=!1},d(g){g&&(x(e),x(n));for(let v=0;v<a.length;v+=1)a[v].d()}}}function dC(t,e){let n,i,s,o,r,l;s=new Bi({props:{name:e[24].name,pclass:e[24].class,level:e[24].level,faction:e[0].faction}});function a(...c){return e[17](e[24],...c)}return{key:t,first:null,c(){n=h("tr"),i=h("td"),ne(s.$$.fragment),p(n,"class","striped"),this.first=n},m(c,f){w(c,n,f),d(n,i),K(s,i,null),o=!0,r||(l=Y(n,"mousedown",a),r=!0)},p(c,f){e=c;let u={};f&1&&(u.name=e[24].name),f&1&&(u.pclass=e[24].class),f&1&&(u.level=e[24].level),f&1&&(u.faction=e[0].faction),s.$set(u)},i(c){o||(P(s.$$.fragment,c),o=!0)},o(c){I(s.$$.fragment,c),o=!1},d(c){c&&x(n),ee(s),r=!1,l()}}}function hC(t,e){let n,i,s,o,r=e[21].online?"\u2B24":"",l,a=e[21].owned?"\u2B50":"",c,f,u=C.ui.clan.roles[e[21].clanrole]+"",m,g,v,_,b;s=new Bi({props:{name:e[21].name,pclass:e[21].class,level:e[21].level,faction:e[0].faction}});function y(...k){return e[16](e[21],...k)}return{key:t,first:null,c(){n=h("tr"),i=h("td"),ne(s.$$.fragment),o=h("span"),l=T(r),c=T(a),f=h("td"),m=T(u),p(o,"class","textgreen"),p(n,"class",g="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"),this.first=n},m(k,A){w(k,n,A),d(n,i),K(s,i,null),d(i,o),d(o,l),d(o,c),d(n,f),d(f,m),v=!0,_||(b=Y(n,"mousedown",y),_=!0)},p(k,A){e=k;let S={};A&1&&(S.name=e[21].name),A&1&&(S.pclass=e[21].class),A&1&&(S.level=e[21].level),A&1&&(S.faction=e[0].faction),s.$set(S),(!v||A&1)&&r!==(r=e[21].online?"\u2B24":"")&&G(l,r),(!v||A&1)&&a!==(a=e[21].owned?"\u2B50":"")&&G(c,a),(!v||A&1)&&u!==(u=C.ui.clan.roles[e[21].clanrole]+"")&&G(m,u),(!v||A&1&&g!==(g="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"))&&p(n,"class",g)},i(k){v||(P(s.$$.fragment,k),v=!0)},o(k){I(s.$$.fragment,k),v=!1},d(k){k&&x(n),ee(s),_=!1,b()}}}function aL(t){let e,n,i=t[0]&&lC(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=lC(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function cL(t,e,n){let{tag:i}=e,s,o,r=async()=>{let R=await Nt("/api/claninfo/info",{tag:i});R.name&&(n(0,s=R),s.eligibleApply.length&&n(5,v=s.eligibleApply[0]),n(0,s.online=s.members.filter(E=>E.online).length,s)),o&&(clearTimeout(o),o=setTimeout(r,5e3))};o=!0,r(),Tn(()=>{clearTimeout(o),o=void 0});let l=(R,E)=>{let L=[];E.owned?L.push({name:C.ui.clan.leave,fun:async()=>{u(await Nt("/api/clan/leave",{name:E.name}),C.ui.clan.left)}}):E.clanrole<s.role&&L.push({name:C.ui.clan.kick,fun:async()=>{u(await Nt("/api/clan/kick",{name:E.name}),C.ui.clan.memberkicked)}});for(let z=0;z<(s.role==3?4:s.role);z++)L.push({name:C.ui.clan.setrank+": "+C.ui.clan.roles[z],fun:async()=>{u(await Nt("/api/clan/setrole",{name:E.name,role:z}),C.ui.clan.setrank+": "+C.ui.clan.roles[z])}});bn.set({x:R.pageX,y:R.pageY,opts:L})},a,c,f=!1,u=async(R,E)=>{R.result!=="ok"?(n(1,a=R.result),n(2,c="red")):(n(1,a=E),n(2,c="green")),await r(),n(3,f=!1)},m="",g=async()=>{n(3,f=!0),u(await Nt("/api/clan/invite",{name:m,tag:i}),C.ui.clan.invited[0]+m+C.ui.clan.invited[1]),n(4,m="")},v="",_=async()=>{n(3,f=!0),u(await Nt("/api/clan/apply",{name:v,tag:i}),C.ui.clan.applied),n(5,v="")},b=(R,E)=>{let L=[];s.role>0&&L.push({name:C.ui.clan.applicationaccept,fun:async()=>{u(await Nt("/api/clan/invite",{tag:i,name:E.name}),C.ui.clan.applicationaccepted)}}),s.role>1&&L.push({name:C.ui.clan.applicationdeny,fun:async()=>{u(await Nt("/api/clan/denyapplication",{id:E.id}),C.ui.clan.applicationdenied)}}),bn.set({x:R.pageX,y:R.pageY,opts:L})},y="members";function k(R){m=R,n(4,m)}function A(){v=ki(this),n(5,v),n(0,s)}let S=R=>n(6,y="members"),F=R=>n(6,y="applications"),M=(R,E)=>l(E,R),D=(R,E)=>b(E,R);return t.$$set=R=>{"tag"in R&&n(11,i=R.tag)},[s,a,c,f,m,v,y,l,g,_,b,i,k,A,S,F,M,D]}var fv=class extends xe{constructor(e){super(),Ce(this,e,cL,aL,Ue,{tag:11})}},gC=fv;function fL(t){let e,n,i,s,o,r,l=C.ui.cost+"",a,c,f,u,m,g,v,_=C.ui.clan.createbutton+"",b,y,k,A,S;return f=new xn({props:{amount:1e5}}),{c(){e=h("h3"),e.textContent=`${C.ui.clan.createheading}`,n=h("label"),n.textContent=`${C.ui.clan.createname}`,i=h("input"),s=h("label"),s.textContent=`${C.ui.clan.createtag}`,o=h("input"),r=h("p"),a=T(l),c=T(": "),ne(f.$$.fragment),m=h("div"),g=T(t[3]),v=h("div"),b=T(_),p(e,"class","textprimary"),p(n,"class","svelte-7uvqsx"),p(i,"type","text"),p(i,"placeholder","Guardians of Guardstone (a-Z)"),p(i,"maxlength","20"),p(s,"class","svelte-7uvqsx"),p(o,"type","text"),p(o,"placeholder","GoG (a-Z !~=#*+-)"),p(o,"maxlength","4"),p(r,"class",u="text"+(t[2]>1e5?"primary":"red")),p(m,"class","textred"),qe(v,"display","inline-block"),p(v,"class",y="btn marg-top formatted "+(t[4]?"blue":"blue disabled"))},m(F,M){w(F,e,M),w(F,n,M),w(F,i,M),Ne(i,t[0]),w(F,s,M),w(F,o,M),Ne(o,t[1]),w(F,r,M),d(r,a),d(r,c),K(f,r,null),w(F,m,M),d(m,g),w(F,v,M),d(v,b),k=!0,A||(S=[Y(i,"input",t[7]),Y(o,"input",t[8]),Y(v,"click",t[5])],A=!0)},p(F,[M]){M&1&&i.value!==F[0]&&Ne(i,F[0]),M&2&&o.value!==F[1]&&Ne(o,F[1]),(!k||M&4&&u!==(u="text"+(F[2]>1e5?"primary":"red")))&&p(r,"class",u),(!k||M&8)&&G(g,F[3]),(!k||M&16&&y!==(y="btn marg-top formatted "+(F[4]?"blue":"blue disabled")))&&p(v,"class",y)},i(F){k||(P(f.$$.fragment,F),k=!0)},o(F){I(f.$$.fragment,F),k=!1},d(F){F&&(x(e),x(n),x(i),x(s),x(o),x(r),x(m),x(v)),ee(f),A=!1,at(S)}}}function uL(t,e,n){let i,s;se(t,Yi,m=>n(2,s=m));let o="",r="",l=!1,a="",c=async()=>{if(l)return;n(6,l=!0);let m=await Nt("/api/clan/create",{name:o,tag:r});m.result!=="ok"&&(n(3,a=m.result),n(6,l=!1))};function f(){o=this.value,n(0,o)}function u(){r=this.value,n(1,r)}return t.$$.update=()=>{t.$$.dirty&71&&n(4,i=!l&&s>=1e5&&o.length<=20&&o.length>=3&&r.length<=4&&r.length>=2)},[o,r,s,a,i,c,l,f,u]}var uv=class extends xe{constructor(e){super(),Ce(this,e,uL,fL,Ue,{})}},vC=uv;function _C(t,e,n){let i=t.slice();return i[4]=e[n],i[6]=n,i}function mL(t){let e,n,i;function s(...o){return t[2](t[4],...o)}return{c(){e=h("div"),e.textContent=`${C.ui.accept}`,p(e,"class","btn blue")},m(o,r){w(o,e,r),n||(i=Y(e,"click",s),n=!0)},p(o,r){t=o},d(o){o&&x(e),n=!1,i()}}}function pL(t){let e;return{c(){e=h("div"),e.textContent=`${C.ui.clan.application}`},m(n,i){w(n,e,i)},p:ae,d(n){n&&x(e)}}}function bC(t,e){let n,i,s=e[4].tag+"",o,r,l=e[4].name+"",a,c;function f(g,v){return g[4].request?pL:mL}let u=f(e,-1),m=u(e);return{key:t,first:null,c(){n=h("tr"),i=h("td"),o=T(s),r=h("td"),a=T(l),c=h("td"),m.c(),p(c,"class","textcenter"),p(n,"class","striped"),this.first=n},m(g,v){w(g,n,v),d(n,i),d(i,o),d(n,r),d(r,a),d(n,c),m.m(c,null)},p(g,v){e=g,v&1&&s!==(s=e[4].tag+"")&&G(o,s),v&1&&l!==(l=e[4].name+"")&&G(a,l),u===(u=f(e,v))&&m?m.p(e,v):(m.d(1),m=u(e),m&&(m.c(),m.m(c,null)))},d(g){g&&x(n),m.d()}}}function dL(t){let e,n,i,s,o,r,l,a=[],c=new Map,f=me(t[0]),u=m=>m[4].clan;for(let m=0;m<f.length;m+=1){let g=_C(t,f,m),v=u(g);c.set(v,a[m]=bC(v,g))}return{c(){e=h("table"),n=h("thead"),i=h("tr"),s=h("th"),s.textContent=`${C.ui.clan.createtag}`,o=h("th"),o.textContent=`${C.ui.clan.createname}`,r=h("th"),r.textContent=`${C.ui.clan.action}`,l=h("tbody");for(let m=0;m<a.length;m+=1)a[m].c();p(s,"width","20%"),p(o,"width","60%"),p(r,"class","textcenter"),p(i,"class","textprimary"),p(e,"class","marg-top panel-black")},m(m,g){w(m,e,g),d(e,n),d(n,i),d(i,s),d(i,o),d(i,r),d(e,l);for(let v=0;v<a.length;v+=1)a[v]&&a[v].m(l,null)},p(m,[g]){g&3&&(f=me(m[0]),a=ui(a,g,u,1,m,f,c,l,a_,bC,null,_C))},i:ae,o:ae,d(m){m&&x(e);for(let g=0;g<a.length;g+=1)a[g].d()}}}function hL(t,e,n){let i=[];(async()=>{n(0,i=await Nt("/api/clan/invites",{name:V.player.name}))})();let o=async l=>{await Nt("/api/clan/apply",{tag:l,name:V.player.name})};return[i,o,(l,a)=>o(l.tag)]}var mv=class extends xe{constructor(e){super(),Ce(this,e,hL,dL,Ue,{})}},yC=mv;function kC(t){let e,n;return e=new jt({props:{origin:"center",title:C.ui.clan.heading,icon:"clan",scroll:!0,$$slots:{default:[kL]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&133&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function gL(t){let e,n,i,s,o,r,l;return{c(){e=h("div"),n=h("div"),i=h("h3"),i.textContent=`${C.ui.clan.noclan}`,s=h("div"),s.textContent=`${C.ui.clan.viewinvites}`,o=h("div"),o.textContent=`${C.ui.clan.createheading}`,p(s,"class","btn grey"),p(o,"class","btn grey marg-top"),p(n,"class","panel-black"),p(e,"class","clanInfoBox textcenter svelte-1vwl908")},m(a,c){w(a,e,c),d(e,n),d(n,i),d(n,s),d(n,o),r||(l=[Y(s,"click",t[4]),Y(o,"click",t[5])],r=!0)},p:ae,i:ae,o:ae,d(a){a&&x(e),r=!1,at(l)}}}function vL(t){let e,n,i,s,o,r,l,a=[yL,bL],c=[];function f(u,m){return u[0]=="create"?0:u[0]=="invites"?1:-1}return~(i=f(t,-1))&&(s=c[i]=a[i](t)),{c(){e=h("div"),n=h("div"),n.textContent=`${C.ui.back}`,s&&s.c(),qe(n,"display","inline-block"),p(n,"class","btn formatted grey"),p(e,"class","modemenu svelte-1vwl908")},m(u,m){w(u,e,m),d(e,n),~i&&c[i].m(e,null),o=!0,r||(l=Y(n,"click",t[3]),r=!0)},p(u,m){let g=i;i=f(u,m),i!==g&&(s&&(Ee(),I(c[g],1,1,()=>{c[g]=null}),Ie()),~i?(s=c[i],s||(s=c[i]=a[i](u),s.c()),P(s,1),s.m(e,null)):s=null)},i(u){o||(P(s),o=!0)},o(u){I(s),o=!1},d(u){u&&x(e),~i&&c[i].d(),r=!1,l()}}}function _L(t){let e,n,i;return n=new gC({props:{tag:t[2]}}),{c(){e=h("div"),ne(n.$$.fragment),p(e,"class","clanView svelte-1vwl908")},m(s,o){w(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&4&&(r.tag=s[2]),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&x(e),ee(n)}}}function bL(t){let e,n;return e=new yC({}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function yL(t){let e,n;return e=new vC({}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function kL(t){let e,n,i,s,o=[_L,vL,gL],r=[];function l(a,c){return a[2]?0:a[0]?1:2}return n=l(t,-1),i=r[n]=o[n](t),{c(){e=h("div"),i.c(),p(e,"class","container svelte-1vwl908")},m(a,c){w(a,e,c),r[n].m(e,null),s=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(Ee(),I(r[f],1,1,()=>{r[f]=null}),Ie(),i=r[n],i?i.p(a,c):(i=r[n]=o[n](a),i.c()),P(i,1),i.m(e,null))},i(a){s||(P(i),s=!0)},o(a){I(i),s=!1},d(a){a&&x(e),r[n].d()}}}function xL(t){let e,n,i=t[1]&&kC(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[1]?i?(i.p(s,o),o&2&&P(i,1)):(i=kC(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function wL(t,e,n){let i,s;se(t,go,f=>n(1,i=f)),se(t,km,f=>n(2,s=f));let o=!1;return[o,i,s,f=>n(0,o=!1),f=>n(0,o="invites"),f=>n(0,o="create"),()=>{Qe(go,i=!1,i)}]}var pv=class extends xe{constructor(e){super(),Ce(this,e,wL,xL,Ue,{})}},xC=pv;var dv=t=>{let e=~~(t/86400),n=~~(t/(60*60)%24),i=~~(t/60%60),s=~~(t%60);return`${e?e+"d ":""}${n?n+"h ":""}${i?i+"m ":""}${s?s+"s":""}`};var uu=t=>~~(1e4+t**1.5*8e3);function wC(t,e,n){let i=t.slice();return i[9]=e[n],i[11]=n,i}function MC(t){let e,n;return e=new jt({props:{origin:"center",title:C.ui.headers.warstats,icon:"pvp",$$slots:{default:[FL]},$$scope:{ctx:t}}}),e.$on("close",t[8]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&4101&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function ML(t){let e,n=ht(t[2].contrib)+"",i,s,o=ht(uu(t[2].level))+"",r,l,a=t[2].level+"",c,f;return{c(){e=h("span"),i=T(n),s=T(" / "),r=T(o),l=T(" (Lv. "),c=T(a),f=T(" War)"),qe(e,"font-size","14px"),p(e,"class","absCentered textprimary")},m(u,m){w(u,e,m),d(e,i),d(e,s),d(e,r),d(e,l),d(e,c),d(e,f)},p(u,m){m&4&&n!==(n=ht(u[2].contrib)+"")&&G(i,n),m&4&&o!==(o=ht(uu(u[2].level))+"")&&G(r,o),m&4&&a!==(a=u[2].level+"")&&G(c,a)},d(u){u&&x(e)}}}function FC(t,e){let n,i,s,o,r=ht(e[9].stats[1])+"",l,a,c=ht(e[9].stats[2])+"",f,u,m=e[9].stats[0]+"",g,v,_=ht(e[9].stats[3])+"",b,y,k;return s=new Bi({props:{name:e[9].name,pclass:e[9].class,level:e[9].level,faction:e[9].faction}}),{key:t,first:null,c(){n=h("tr"),i=h("td"),ne(s.$$.fragment),o=h("td"),l=T(r),a=h("td"),f=T(c),u=h("td"),g=T(m),v=h("td"),b=T(_),p(o,"class","textcenter"),p(a,"class","textcenter"),p(u,"class","textcenter"),p(v,"class","textcenter textfame"),p(n,"class",y="striped "+(V&&V.player&&V.player.name===e[9].name?"selected":"")),this.first=n},m(A,S){w(A,n,S),d(n,i),K(s,i,null),d(n,o),d(o,l),d(n,a),d(a,f),d(n,u),d(u,g),d(n,v),d(v,b),k=!0},p(A,S){e=A;let F={};S&5&&(F.name=e[9].name),S&5&&(F.pclass=e[9].class),S&5&&(F.level=e[9].level),S&5&&(F.faction=e[9].faction),s.$set(F),(!k||S&5)&&r!==(r=ht(e[9].stats[1])+"")&&G(l,r),(!k||S&5)&&c!==(c=ht(e[9].stats[2])+"")&&G(f,c),(!k||S&5)&&m!==(m=e[9].stats[0]+"")&&G(g,m),(!k||S&5)&&_!==(_=ht(e[9].stats[3])+"")&&G(b,_),(!k||S&5&&y!==(y="striped "+(V&&V.player&&V.player.name===e[9].name?"selected":"")))&&p(n,"class",y)},i(A){k||(P(s.$$.fragment,A),k=!0)},o(A){I(s.$$.fragment,A),k=!1},d(A){A&&x(n),ee(s)}}}function FL(t){let e,n,i,s,o,r,l,a,c,f=t[2].kills[0]+"",u,m,g,v,_,b,y=ht(t[2].reward)+"",k,A,S=C.ui.war.status+"",F,M,D,R=C.ui.war.statustypes[t[2].status]+"",E,L,z,q=C.ui.war.duration+"",j,W,U,O=dv(t[2].duration)+"",Z,ve,Fe,_e,ce,fe,ze,Pe,Me=t[2].kills[1]+"",be,H,pe,Be,Ge,Xe,Ye,ue,oe=C.ui.stats.misc.damage+"",$e,J,Q,$=C.ui.stats.misc.healing+"",le,je,Ve,ke=C.ui.stats.misc.kills+"",Re,Oe,pt,wt,Je,Et,ye=C.ui.stats.misc.fame+"",Ke,yt,St,Te=[],ft=new Map,$t,Le,Ct;H=new vi({props:{size:"1.3em",fract:~~(t[2].contrib/uu(t[2].level)*100),left:"",right:"",barcol:"bgpurp",$$slots:{default:[ML]},$$scope:{ctx:t}}});let Lt=me(t[2].contributors.sort(t[7])),He=et=>et[9].name;for(let et=0;et<Lt.length;et+=1){let Se=wC(t,Lt,et),ot=He(Se);ft.set(ot,Te[et]=FC(ot,Se))}return{c(){e=h("div"),n=h("div"),i=h("div"),s=h("div"),o=h("span"),o.textContent=`${C.factions[0].name}`,r=h("span"),l=h("img"),c=We(),u=T(f),m=h("div"),g=h("span"),v=h("img"),b=We(),k=T(y),A=h("span"),F=T(S),M=T(": "),D=h("span"),E=T(R),z=h("span"),j=T(q),W=T(": "),U=h("span"),Z=T(O),ve=We(),Fe=h("div"),_e=h("span"),_e.textContent=`${C.factions[1].name}`,ce=h("span"),fe=h("img"),Pe=We(),be=T(Me),ne(H.$$.fragment),pe=h("div"),Be=h("table"),Ge=h("thead"),Xe=h("tr"),Ye=h("th"),Ye.textContent=`${C.ui.war.player}`,ue=h("th"),$e=T(oe),Q=h("th"),le=T($),Ve=h("th"),Re=T(ke),pt=h("th"),wt=h("img"),Et=We(),Ke=T(ye),St=h("tbody");for(let et=0;et<Te.length;et+=1)Te[et].c();p(o,"class","infosmall textf0 svelte-19s383j"),qe(o,"margin-top","30px"),p(l,"class","svgicon"),lt(l.src,a="/data/ui/icons/pvp.svg?v=8602459")||p(l,"src",a),p(r,"class","infobig textprimary svelte-19s383j"),qe(r,"margin-top","10px"),p(v,"class","svgicon"),lt(v.src,_=sr)||p(v,"src",_),p(g,"class","infobig textfame svelte-19s383j"),qe(g,"margin-top","20px"),p(D,"class",L="text"+["red","orange","green"][t[2].status]+" svelte-19s383j"),p(A,"class","infosmall svelte-19s383j"),qe(A,"margin-top","10px"),p(U,"class","textprimary"),p(z,"class","infosmall svelte-19s383j"),qe(z,"margin-bottom","20px"),p(_e,"class","infosmall textf1 svelte-19s383j"),qe(_e,"margin-top","30px"),p(fe,"class","svgicon"),lt(fe.src,ze="/data/ui/icons/pvp.svg?v=8602459")||p(fe,"src",ze),p(ce,"class","infobig textprimary svelte-19s383j"),qe(ce,"margin-top","10px"),p(i,"class","grid three"),p(n,"class","panel-black border grey"),p(Ye,"width","30%"),p(ue,"class",J="textcenter "+(t[0]==1?"textwhite":"")),p(Q,"class",je="textcenter "+(t[0]==2?"textwhite":"")),p(Ve,"class",Oe="textcenter "+(t[0]==0?"textwhite":"")),p(wt,"class","svgicon"),lt(wt.src,Je=sr)||p(wt,"src",Je),p(pt,"class",yt="textcenter "+(t[0]==3?"textwhite":"")),p(Xe,"class","textprimary"),p(Be,"class","dense panel-black"),p(pe,"class","scrollbar"),p(e,"class","layout svelte-19s383j")},m(et,Se){w(et,e,Se),d(e,n),d(n,i),d(i,s),d(s,o),d(s,r),d(r,l),d(r,c),d(r,u),d(i,m),d(m,g),d(g,v),d(g,b),d(g,k),d(m,A),d(A,F),d(A,M),d(A,D),d(D,E),d(m,z),d(z,j),d(z,W),d(z,U),d(U,Z),d(m,ve),d(i,Fe),d(Fe,_e),d(Fe,ce),d(ce,fe),d(ce,Pe),d(ce,be),K(H,n,null),d(e,pe),d(pe,Be),d(Be,Ge),d(Ge,Xe),d(Xe,Ye),d(Xe,ue),d(ue,$e),d(Xe,Q),d(Q,le),d(Xe,Ve),d(Ve,Re),d(Xe,pt),d(pt,wt),d(pt,Et),d(pt,Ke),d(Be,St);for(let ot=0;ot<Te.length;ot+=1)Te[ot]&&Te[ot].m(St,null);$t=!0,Le||(Ct=[Y(ue,"click",t[3]),Y(Q,"click",t[4]),Y(Ve,"click",t[5]),Y(pt,"click",t[6])],Le=!0)},p(et,Se){(!$t||Se&4)&&f!==(f=et[2].kills[0]+"")&&G(u,f),(!$t||Se&4)&&y!==(y=ht(et[2].reward)+"")&&G(k,y),(!$t||Se&4)&&R!==(R=C.ui.war.statustypes[et[2].status]+"")&&G(E,R),(!$t||Se&4&&L!==(L="text"+["red","orange","green"][et[2].status]+" svelte-19s383j"))&&p(D,"class",L),(!$t||Se&4)&&O!==(O=dv(et[2].duration)+"")&&G(Z,O),(!$t||Se&4)&&Me!==(Me=et[2].kills[1]+"")&&G(be,Me);let ot={};Se&4&&(ot.fract=~~(et[2].contrib/uu(et[2].level)*100)),Se&4100&&(ot.$$scope={dirty:Se,ctx:et}),H.$set(ot),(!$t||Se&1&&J!==(J="textcenter "+(et[0]==1?"textwhite":"")))&&p(ue,"class",J),(!$t||Se&1&&je!==(je="textcenter "+(et[0]==2?"textwhite":"")))&&p(Q,"class",je),(!$t||Se&1&&Oe!==(Oe="textcenter "+(et[0]==0?"textwhite":"")))&&p(Ve,"class",Oe),(!$t||Se&1&&yt!==(yt="textcenter "+(et[0]==3?"textwhite":"")))&&p(pt,"class",yt),Se&5&&(Lt=me(et[2].contributors.sort(et[7])),Ee(),Te=ui(Te,Se,He,1,et,Lt,ft,St,Di,FC,null,wC),Ie())},i(et){if(!$t){P(H.$$.fragment,et);for(let Se=0;Se<Lt.length;Se+=1)P(Te[Se]);$t=!0}},o(et){I(H.$$.fragment,et);for(let Se=0;Se<Te.length;Se+=1)I(Te[Se]);$t=!1},d(et){et&&x(e),ee(H);for(let Se=0;Se<Te.length;Se+=1)Te[Se].d();Le=!1,at(Ct)}}}function CL(t){let e,n,i=t[1]&&MC(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[1]?i?(i.p(s,o),o&2&&P(i,1)):(i=MC(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function SL(t,e,n){let i,s;se(t,Ns,m=>n(1,i=m)),se(t,$s,m=>n(2,s=m));let o=1;return[o,i,s,()=>n(0,o=1),()=>n(0,o=2),()=>n(0,o=0),()=>n(0,o=3),(m,g)=>g.stats[o]-m.stats[o],()=>{Qe(Ns,i=!1,i)}]}var hv=class extends xe{constructor(e){super(),Ce(this,e,SL,CL,Ue,{})}},CC=hv;function SC(t,e,n){let i=t.slice();return i[15]=e[n],i}function AC(t,e,n){let i=t.slice();return i[18]=e[n],i[20]=n,i}function PC(t){let e,n;return e=new jt({props:{origin:"center",title:C.ui.headers.pvp,icon:"pvp",$$slots:{default:[DL]},$$scope:{ctx:t}}}),e.$on("close",t[13]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&2097278&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function TC(t){let e,n,i;function s(){return t[11](t[20])}return{c(){e=h("div"),e.textContent=`${t[18]}`,p(e,"class","tab"),Lo(e,"active",t[20]===t[1])},m(o,r){w(o,e,r),n||(i=Y(e,"click",s),n=!0)},p(o,r){t=o,r&2&&Lo(e,"active",t[20]===t[1])},d(o){o&&x(e),n=!1,i()}}}function AL(t){let e,n,i,s,o,r,l,a,c=t[5].arena_position+"",f,u,m,g,v=t[5].arena_wins_today+"",_,b,y,k,A=t[5].arena_losses_today+"",S,F,M,D,R,E,L,z,q,j,W,U,O,Z,ve;s=new xd({props:{amount:t[5].arena_rating}});let Fe=me(t[8]),_e=[];for(let Pe=0;Pe<Fe.length;Pe+=1)_e[Pe]=EC(SC(t,Fe,Pe));R=new pr({props:{amount:Math.ceil($f(t[5].arena_rating)/5)}});let ce=[EL,TL],fe=[];function ze(Pe,Me){return Pe[5].arena_wins_today?0:1}return j=ze(t,-1),W=fe[j]=ce[j](t),Z=new pr({props:{amount:t[5].medals}}),{c(){e=h("div"),n=h("h4"),n.textContent="Current Rating",i=h("h2"),ne(s.$$.fragment),o=h("div");for(let Pe=0;Pe<_e.length;Pe+=1)_e[Pe].c();r=h("div"),l=h("span"),l.textContent="Arena Position",a=h("span"),f=T(c),u=h("span"),u.textContent="Wins / Loss Today",m=h("span"),g=h("span"),_=T(v),y=T(" - "),k=h("span"),S=T(A),M=h("span"),M.textContent="Medals per win",D=h("span"),ne(R.$$.fragment),E=h("span"),L=T("End of day bonus"),q=h("span"),W.c(),U=h("span"),U.textContent="Total Medals",O=h("span"),ne(Z.$$.fragment),p(n,"class","textgreen"),p(e,"class","textcenter panel-black"),p(o,"class","panel-black marg-top grid two textcenter"),p(l,"class","textwhite"),p(a,"class","textgreen statnumber"),p(u,"class","textwhite"),p(g,"class",b=t[5].arena_wins_today?"textgreen":"textgrey"),p(k,"class",F=t[5].arena_losses_today?"textred":"textgrey"),p(m,"class","textgrey statnumber"),p(M,"class","textwhite"),p(D,"class","statnumber"),p(E,"class",z=t[5].arena_wins_today?"textgreen":"textgrey"),p(q,"class","statnumber"),p(U,"class","textwhite"),p(O,"class","statnumber"),p(r,"class","stats panel-black marg-top svelte-voya4q")},m(Pe,Me){w(Pe,e,Me),d(e,n),d(e,i),K(s,i,null),w(Pe,o,Me);for(let be=0;be<_e.length;be+=1)_e[be]&&_e[be].m(o,null);w(Pe,r,Me),d(r,l),d(r,a),d(a,f),d(r,u),d(r,m),d(m,g),d(g,_),d(m,y),d(m,k),d(k,S),d(r,M),d(r,D),K(R,D,null),d(r,E),d(E,L),d(r,q),fe[j].m(q,null),d(r,U),d(r,O),K(Z,O,null),ve=!0},p(Pe,Me){let be={};if(Me&32&&(be.amount=Pe[5].arena_rating),s.$set(be),Me&832){Fe=me(Pe[8]);let Ge;for(Ge=0;Ge<Fe.length;Ge+=1){let Xe=SC(Pe,Fe,Ge);_e[Ge]?_e[Ge].p(Xe,Me):(_e[Ge]=EC(Xe),_e[Ge].c(),_e[Ge].m(o,null))}for(;Ge<_e.length;Ge+=1)_e[Ge].d(1);_e.length=Fe.length}(!ve||Me&32)&&c!==(c=Pe[5].arena_position+"")&&G(f,c),(!ve||Me&32)&&v!==(v=Pe[5].arena_wins_today+"")&&G(_,v),(!ve||Me&32&&b!==(b=Pe[5].arena_wins_today?"textgreen":"textgrey"))&&p(g,"class",b),(!ve||Me&32)&&A!==(A=Pe[5].arena_losses_today+"")&&G(S,A),(!ve||Me&32&&F!==(F=Pe[5].arena_losses_today?"textred":"textgrey"))&&p(k,"class",F);let H={};Me&32&&(H.amount=Math.ceil($f(Pe[5].arena_rating)/5)),R.$set(H),(!ve||Me&32&&z!==(z=Pe[5].arena_wins_today?"textgreen":"textgrey"))&&p(E,"class",z);let pe=j;j=ze(Pe,Me),j===pe?fe[j].p(Pe,Me):(Ee(),I(fe[pe],1,1,()=>{fe[pe]=null}),Ie(),W=fe[j],W?W.p(Pe,Me):(W=fe[j]=ce[j](Pe),W.c()),P(W,1),W.m(q,null));let Be={};Me&32&&(Be.amount=Pe[5].medals),Z.$set(Be)},i(Pe){ve||(P(s.$$.fragment,Pe),P(R.$$.fragment,Pe),P(W),P(Z.$$.fragment,Pe),ve=!0)},o(Pe){I(s.$$.fragment,Pe),I(R.$$.fragment,Pe),I(W),I(Z.$$.fragment,Pe),ve=!1},d(Pe){Pe&&(x(e),x(o),x(r)),ee(s),it(_e,Pe),ee(R),fe[j].d(),ee(Z)}}}function PL(t){let e,n,i,s,o,r,l,a,c=ht(t[5].prestige)+"",f,u,m,g,v=ul(t[3],C.ui.title.name[V.player.faction][t[3]-1])+"",_,b=ht(nv(t[5].prestige))+"",y,k,A,S,F,M,D,R=ht(t[5].kills_today)+"",E,L,z,q,j,W,U=ht(t[5].fame_today)+"",O,Z,ve,Fe,_e,ce,fe=ht(t[5].kills_this_week)+"",ze,Pe,Me,be,H,pe,Be=ht(t[5].fame)+"",Ge,Xe,Ye,ue=t[5].fame_position+"",oe,$e,J,Q=fu(t[5].fame_bracket)+"",$,le,je,Ve,ke,Re,Oe=ht(t[5].kills_last_week)+"",pt,wt,Je,Et,ye,Ke,yt=ht(t[5].fame_last_week)+"",St,Te,ft,$t=t[5].fame_position_last_week+"",Le,Ct,Lt,He=fu(t[5].fame_bracket_last_week)+"",et,Se,ot,Ze,ut,wn,Ss=ht(t[5].kills_lifetime)+"",li,Ii,dt,qt,As,jn,ai=ht(t[5].fame_lifetime)+"",wc,Ar,Do,Ps=(t[5].rank_lifetime>0?ul(t[5].rank_lifetime,C.ui.title.name[V.player.faction][t[5].rank_lifetime-1]):"Unranked")+"",pn;return n=new vi({props:{size:"1.5em",fract:t[4],barcol:"bgpurp",$$slots:{default:[IL]},$$scope:{ctx:t}}}),{c(){e=h("div"),ne(n.$$.fragment),i=h("div"),s=h("span"),s.textContent=`${C.ui.pvpmenu.currentprestige}`,o=h("span"),r=h("img"),a=We(),f=T(c),u=h("span"),u.textContent=`${C.ui.pvpmenu.nextrank}`,m=h("span"),g=new tm(!1),_=T(" ("),y=T(b),k=T(")"),A=h("div"),S=h("small"),S.textContent=`${C.ui.pvpmenu.today}`,F=h("span"),M=h("span"),M.textContent=`${C.ui.stats.misc.kills}`,D=h("span"),E=T(R),L=h("span"),L.textContent=`${C.ui.stats.misc.fame}`,z=h("span"),q=h("img"),W=We(),O=T(U),Z=h("div"),ve=h("small"),ve.textContent=`${C.ui.pvpmenu.thisweek}`,Fe=h("a"),Fe.textContent=`${C.ui.pvpmenu.viewbrackets}`,_e=h("span"),_e.textContent=`${C.ui.stats.misc.kills}`,ce=h("span"),ze=T(fe),Pe=h("span"),Pe.textContent=`${C.ui.stats.misc.fame}`,Me=h("span"),be=h("img"),pe=We(),Ge=T(Be),Xe=h("span"),Xe.textContent=`${C.ui.pvpmenu.fameposition}`,Ye=h("span"),oe=T(ue),$e=h("span"),$e.textContent=`${C.ui.pvpmenu.famebracket}`,J=h("span"),$=T(Q),le=h("div"),je=h("small"),je.textContent=`${C.ui.pvpmenu.lastweek}`,Ve=h("span"),ke=h("span"),ke.textContent=`${C.ui.stats.misc.kills}`,Re=h("span"),pt=T(Oe),wt=h("span"),wt.textContent=`${C.ui.stats.misc.fame}`,Je=h("span"),Et=h("img"),Ke=We(),St=T(yt),Te=h("span"),Te.textContent=`${C.ui.pvpmenu.fameposition}`,ft=h("span"),Le=T($t),Ct=h("span"),Ct.textContent=`${C.ui.pvpmenu.famebracket}`,Lt=h("span"),et=T(He),Se=h("div"),ot=h("small"),ot.textContent=`${C.ui.pvpmenu.lifetime}`,Ze=h("span"),ut=h("span"),ut.textContent=`${C.ui.stats.misc.kills}`,wn=h("span"),li=T(Ss),Ii=h("span"),Ii.textContent=`${C.ui.stats.misc.fame}`,dt=h("span"),qt=h("img"),jn=We(),wc=T(ai),Ar=h("span"),Ar.textContent=`${C.ui.pvpmenu.highestrank}`,Do=h("span"),p(s,"class","textwhite"),p(r,"class","svgicon"),lt(r.src,l=Na)||p(r,"src",l),p(o,"class","textprestige statnumber"),p(u,"class","textwhite"),g.a=_,p(m,"class","textprestige statnumber"),p(i,"class","stats marg-top svelte-voya4q"),p(e,"class","panel-black"),p(S,"class","bold textgreen"),p(M,"class","textwhite"),p(D,"class","textprimary statnumber"),p(L,"class","textwhite"),p(q,"class","svgicon"),lt(q.src,j=sr)||p(q,"src",j),p(z,"class","textfame statnumber"),p(A,"class","stats panel-black marg-top svelte-voya4q"),p(ve,"class","bold textgreen"),p(Fe,"class","statnumber"),p(Fe,"href","/pvp"),p(Fe,"target","_blank"),p(Fe,"rel","noopener noreferrer"),p(_e,"class","textwhite"),p(ce,"class","textprimary statnumber"),p(Pe,"class","textwhite"),p(be,"class","svgicon"),lt(be.src,H=sr)||p(be,"src",H),p(Me,"class","textfame statnumber"),p(Xe,"class","textwhite"),p(Ye,"class","textgreen statnumber"),p($e,"class","textwhite"),p(J,"class","textprimary statnumber"),p(Z,"class","stats panel-black marg-top svelte-voya4q"),p(je,"class","bold textgreen"),p(ke,"class","textwhite"),p(Re,"class","textprimary statnumber"),p(wt,"class","textwhite"),p(Et,"class","svgicon"),lt(Et.src,ye=sr)||p(Et,"src",ye),p(Je,"class","textfame statnumber"),p(Te,"class","textwhite"),p(ft,"class","textgreen statnumber"),p(Ct,"class","textwhite"),p(Lt,"class","textprimary statnumber"),p(le,"class","stats panel-black marg-top svelte-voya4q"),p(ot,"class","bold textgreen"),p(ut,"class","textwhite"),p(wn,"class","textprimary statnumber"),p(Ii,"class","textwhite"),p(qt,"class","svgicon"),lt(qt.src,As=sr)||p(qt,"src",As),p(dt,"class","textfame statnumber"),p(Ar,"class","textwhite"),p(Do,"class","textprestige statnumber"),p(Se,"class","stats panel-black marg-top svelte-voya4q")},m(zt,en){w(zt,e,en),K(n,e,null),d(e,i),d(i,s),d(i,o),d(o,r),d(o,a),d(o,f),d(i,u),d(i,m),g.m(v,m),d(m,_),d(m,y),d(m,k),w(zt,A,en),d(A,S),d(A,F),d(A,M),d(A,D),d(D,E),d(A,L),d(A,z),d(z,q),d(z,W),d(z,O),w(zt,Z,en),d(Z,ve),d(Z,Fe),d(Z,_e),d(Z,ce),d(ce,ze),d(Z,Pe),d(Z,Me),d(Me,be),d(Me,pe),d(Me,Ge),d(Z,Xe),d(Z,Ye),d(Ye,oe),d(Z,$e),d(Z,J),d(J,$),w(zt,le,en),d(le,je),d(le,Ve),d(le,ke),d(le,Re),d(Re,pt),d(le,wt),d(le,Je),d(Je,Et),d(Je,Ke),d(Je,St),d(le,Te),d(le,ft),d(ft,Le),d(le,Ct),d(le,Lt),d(Lt,et),w(zt,Se,en),d(Se,ot),d(Se,Ze),d(Se,ut),d(Se,wn),d(wn,li),d(Se,Ii),d(Se,dt),d(dt,qt),d(dt,jn),d(dt,wc),d(Se,Ar),d(Se,Do),Do.innerHTML=Ps,pn=!0},p(zt,en){let ci={};en&16&&(ci.fract=zt[4]),en&2097156&&(ci.$$scope={dirty:en,ctx:zt}),n.$set(ci),(!pn||en&32)&&c!==(c=ht(zt[5].prestige)+"")&&G(f,c),(!pn||en&8)&&v!==(v=ul(zt[3],C.ui.title.name[V.player.faction][zt[3]-1])+"")&&g.p(v),(!pn||en&32)&&b!==(b=ht(nv(zt[5].prestige))+"")&&G(y,b),(!pn||en&32)&&R!==(R=ht(zt[5].kills_today)+"")&&G(E,R),(!pn||en&32)&&U!==(U=ht(zt[5].fame_today)+"")&&G(O,U),(!pn||en&32)&&fe!==(fe=ht(zt[5].kills_this_week)+"")&&G(ze,fe),(!pn||en&32)&&Be!==(Be=ht(zt[5].fame)+"")&&G(Ge,Be),(!pn||en&32)&&ue!==(ue=zt[5].fame_position+"")&&G(oe,ue),(!pn||en&32)&&Q!==(Q=fu(zt[5].fame_bracket)+"")&&G($,Q),(!pn||en&32)&&Oe!==(Oe=ht(zt[5].kills_last_week)+"")&&G(pt,Oe),(!pn||en&32)&&yt!==(yt=ht(zt[5].fame_last_week)+"")&&G(St,yt),(!pn||en&32)&&$t!==($t=zt[5].fame_position_last_week+"")&&G(Le,$t),(!pn||en&32)&&He!==(He=fu(zt[5].fame_bracket_last_week)+"")&&G(et,He),(!pn||en&32)&&Ss!==(Ss=ht(zt[5].kills_lifetime)+"")&&G(li,Ss),(!pn||en&32)&&ai!==(ai=ht(zt[5].fame_lifetime)+"")&&G(wc,ai),(!pn||en&32)&&Ps!==(Ps=(zt[5].rank_lifetime>0?ul(zt[5].rank_lifetime,C.ui.title.name[V.player.faction][zt[5].rank_lifetime-1]):"Unranked")+"")&&(Do.innerHTML=Ps)},i(zt){pn||(P(n.$$.fragment,zt),pn=!0)},o(zt){I(n.$$.fragment,zt),pn=!1},d(zt){zt&&(x(e),x(A),x(Z),x(le),x(Se)),ee(n)}}}function EC(t){let e,n,i=t[15]+"",s,o,r,l;function a(...c){return t[12](t[15],...c)}return{c(){e=h("div"),n=T("Queue "),s=T(i),p(e,"class",o="btn grey "+(t[6].queues&&t[6].queues.includes("arena"+t[15])?"active":""))},m(c,f){w(c,e,f),d(e,n),d(e,s),r||(l=Y(e,"click",a),r=!0)},p(c,f){t=c,f&64&&o!==(o="btn grey "+(t[6].queues&&t[6].queues.includes("arena"+t[15])?"active":""))&&p(e,"class",o)},d(c){c&&x(e),r=!1,l()}}}function TL(t){let e;return{c(){e=T("-")},m(n,i){w(n,e,i)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function EL(t){let e,n;return e=new pr({props:{amount:$f(t[5].arena_rating)}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&32&&(o.amount=$f(i[5].arena_rating)),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function IL(t){let e,n=(t[2]>0?ul(t[2],C.ui.title.name[V.player.faction][t[2]-1]):"Unranked")+"";return{c(){e=h("span"),p(e,"class","absCentered ranktitle svelte-voya4q")},m(i,s){w(i,e,s),e.innerHTML=n},p(i,s){s&4&&n!==(n=(i[2]>0?ul(i[2],C.ui.title.name[V.player.faction][i[2]-1]):"Unranked")+"")&&(e.innerHTML=n)},d(i){i&&x(e)}}}function DL(t){let e,n,i,s,o,r,l=me(t[7]),a=[];for(let m=0;m<l.length;m+=1)a[m]=TC(AC(t,l,m));let c=[PL,AL],f=[];function u(m,g){return m[1]===0?0:m[1]===1?1:-1}return~(s=u(t,-1))&&(o=f[s]=c[s](t)),{c(){e=h("div"),n=h("div");for(let m=0;m<a.length;m+=1)a[m].c();i=h("div"),o&&o.c(),p(n,"class","tab-bar flex"),p(i,"class","panel-bright"),p(e,"class","container svelte-voya4q")},m(m,g){w(m,e,g),d(e,n);for(let v=0;v<a.length;v+=1)a[v]&&a[v].m(n,null);d(e,i),~s&&f[s].m(i,null),r=!0},p(m,g){if(g&130){l=me(m[7]);let _;for(_=0;_<l.length;_+=1){let b=AC(m,l,_);a[_]?a[_].p(b,g):(a[_]=TC(b),a[_].c(),a[_].m(n,null))}for(;_<a.length;_+=1)a[_].d(1);a.length=l.length}let v=s;s=u(m,g),s===v?~s&&f[s].p(m,g):(o&&(Ee(),I(f[v],1,1,()=>{f[v]=null}),Ie()),~s?(o=f[s],o?o.p(m,g):(o=f[s]=c[s](m),o.c()),P(o,1),o.m(i,null)):o=null)},i(m){r||(P(o),r=!0)},o(m){I(o),r=!1},d(m){m&&x(e),it(a,m),~s&&f[s].d()}}}function VL(t){let e,n,i=t[0]&&PC(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=PC(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function LL(t,e,n){let i,s;se(t,Zn,k=>n(6,i=k)),se(t,vo,k=>n(0,s=k));let o=["Prestige","Arena"],r=0,l=0,a=1,c=0,f={},u=async()=>{n(5,f=await Nt("/api/pvp/getplayerpvpinfo",{name:V.player.name})),n(2,l=nc(f.prestige)),n(3,a=Math.min(l+1,12));let k=Fd(a)-Fd(l),A=f.prestige-Fd(l);n(4,c=~~(A/k*100))},m=0,g=["3v3","5v5"],v=k=>{xt(i.queues.includes(k)?"stopqueue":"startqueue",k)},_=k=>{n(1,r=k)},b=(k,A)=>v("arena"+k),y=()=>{Qe(vo,s=!1,s)};return t.$$.update=()=>{t.$$.dirty&1025&&(s&&Date.now()-m>3e4||m===0)&&(u(),n(10,m=Date.now()))},[s,r,l,a,c,f,i,o,g,v,m,_,b,y]}var gv=class extends xe{constructor(e){super(),Ce(this,e,LL,VL,Ue,{})}},IC=gv;function DC(t){let e,n,i=t[1].name+"",s,o,r,l=t[1].level!==void 0?`Lv. ${t[1].level} `:"",a,c,f=(t[1].class!==void 0?C.classes[t[1].class].name:"Item")+"",u,m,g,v=(t[1].faction!==void 0?C.factions[t[1].faction].name:"")+"",_,b;return{c(){e=h("div"),n=h("div"),s=T(i),o=h("div"),r=h("span"),a=T(l),c=h("span"),u=T(f),g=h("span"),_=T(v),p(n,"class","textwhite title svelte-1wip79f"),p(c,"class",m=Vo(t[1].class!==void 0?"textc"+t[1].class:"textyellow")+" svelte-1wip79f"),p(g,"class",b=Vo(t[1].faction!==void 0?"textf"+t[1].faction:"")+" svelte-1wip79f"),p(e,"class","panel-black container svelte-1wip79f"),qe(e,"display",t[0]?"block":"none")},m(y,k){w(y,e,k),d(e,n),d(n,s),d(e,o),d(o,r),d(r,a),d(o,c),d(c,u),d(e,g),d(g,_)},p(y,k){k&2&&i!==(i=y[1].name+"")&&G(s,i),k&2&&l!==(l=y[1].level!==void 0?`Lv. ${y[1].level} `:"")&&G(a,l),k&2&&f!==(f=(y[1].class!==void 0?C.classes[y[1].class].name:"Item")+"")&&G(u,f),k&2&&m!==(m=Vo(y[1].class!==void 0?"textc"+y[1].class:"textyellow")+" svelte-1wip79f")&&p(c,"class",m),k&2&&v!==(v=(y[1].faction!==void 0?C.factions[y[1].faction].name:"")+"")&&G(_,v),k&2&&b!==(b=Vo(y[1].faction!==void 0?"textf"+y[1].faction:"")+" svelte-1wip79f")&&p(g,"class",b),k&1&&qe(e,"display",y[0]?"block":"none")},d(y){y&&x(e)}}}function qL(t){let e,n=t[1]&&DC(t);return{c(){n&&n.c(),e=he()},m(i,s){n&&n.m(i,s),w(i,e,s)},p(i,[s]){i[1]?n?n.p(i,s):(n=DC(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(i){i&&x(e),n&&n.d(i)}}}function RL(t,e,n){let i;se(t,hm,o=>n(0,i=o));let s;return t.$$.update=()=>{t.$$.dirty&1&&i>0&&V.isEntityIdTaken(i)&&n(1,s=V.entity(i))},[i,s]}var vv=class extends xe{constructor(e){super(),Ce(this,e,RL,qL,Ue,{})}},VC=vv;var _v=fa,mu=async t=>{let e=await Nt("/api/account/info");_v.set(e),Bo.set(e.storepoints),t&&t(e)};function zL(t){let e,n,i,s,o,r,l,a,c=C.ui.elixir.chatsupport+"",f,u,m,g,v,_=C.ui.elixir.noads+"",b,y,k,A,S,F,M,D,R,E=C.ui.elixir.bagslots+"",L,z,q,j,W,U,O,Z,ve,Fe=C.ui.elixir.stashstorage+"",_e,ce,fe,ze,Pe,Me,be,H,pe,Be=C.ui.elixir.merchantlimit+"",Ge,Xe,Ye,ue,oe,$e,J,Q,$,le=C.ui.elixir.merchantduration+"",je,Ve;return{c(){e=h("div"),n=h("div"),n.innerHTML='<img class="artwork svelte-cbx1m" src="/data/ui/elixir.svg?v=8602459"/><div class="sparkle svelte-cbx1m" style="font-size:35px; left:30%; top:30%; animation-delay: -1s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:50px; left:40%; top:60%; animation-delay: -2s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:80px; left:60%; top:20%; animation-delay: -3s;">+</div>',i=h("div"),s=h("h1"),s.innerHTML='Hordes <span class="textsub">Elixir</span>',o=h("div"),r=h("img"),a=We(),f=T(c),u=h("div"),m=h("img"),v=We(),b=T(_),y=h("div"),k=h("img"),S=We(),F=h("span"),F.textContent=`${$n[0].inventory}`,M=We(),D=h("span"),D.textContent=`${$n[1].inventory}`,R=We(),L=T(E),z=h("div"),q=h("img"),W=We(),U=h("span"),U.textContent=`${$n[0].stash}`,O=We(),Z=h("span"),Z.textContent=`${$n[1].stash}`,ve=We(),_e=T(Fe),ce=h("div"),fe=h("img"),Pe=We(),Me=h("span"),Me.textContent=`${$n[0].auction}`,be=We(),H=h("span"),H.textContent=`${$n[1].auction}`,pe=We(),Ge=T(Be),Xe=h("div"),Ye=h("img"),oe=We(),$e=h("span"),$e.textContent=`${$n[0].auctionHours}h`,J=We(),Q=h("span"),Q.textContent=`${$n[1].auctionHours}h`,$=We(),je=T(le),Ve=h("div"),Ve.textContent=`${C.ui.elixir.tba}`,p(n,"class","artcontainer svelte-cbx1m"),p(s,"class","textprimary"),p(r,"class","svgicon"),lt(r.src,l="/data/ui/icons/gem.svg?v=8602459")||p(r,"src",l),p(o,"class","textwhite"),p(m,"class","svgicon"),lt(m.src,g="/data/ui/icons/check.svg?v=8602459")||p(m,"src",g),p(u,"class","textwhite"),p(k,"class","svgicon"),lt(k.src,A="/data/ui/icons/check.svg?v=8602459")||p(k,"src",A),p(F,"class","old svelte-cbx1m"),p(D,"class","textsub"),p(y,"class","textwhite"),p(q,"class","svgicon"),lt(q.src,j="/data/ui/icons/check.svg?v=8602459")||p(q,"src",j),p(U,"class","old svelte-cbx1m"),p(Z,"class","textsub"),p(z,"class","textwhite"),p(fe,"class","svgicon"),lt(fe.src,ze="/data/ui/icons/check.svg?v=8602459")||p(fe,"src",ze),p(Me,"class","old svelte-cbx1m"),p(H,"class","textsub"),p(ce,"class","textwhite"),p(Ye,"class","svgicon"),lt(Ye.src,ue="/data/ui/icons/check.svg?v=8602459")||p(Ye,"src",ue),p($e,"class","old svelte-cbx1m"),p(Q,"class","textsub"),p(Xe,"class","textwhite"),p(Ve,"class","textgrey"),p(e,"class","split svelte-cbx1m")},m(ke,Re){w(ke,e,Re),d(e,n),d(e,i),d(i,s),d(i,o),d(o,r),d(o,a),d(o,f),d(i,u),d(u,m),d(u,v),d(u,b),d(i,y),d(y,k),d(y,S),d(y,F),d(y,M),d(y,D),d(y,R),d(y,L),d(i,z),d(z,q),d(z,W),d(z,U),d(z,O),d(z,Z),d(z,ve),d(z,_e),d(i,ce),d(ce,fe),d(ce,Pe),d(ce,Me),d(ce,be),d(ce,H),d(ce,pe),d(ce,Ge),d(i,Xe),d(Xe,Ye),d(Xe,oe),d(Xe,$e),d(Xe,J),d(Xe,Q),d(Xe,$),d(Xe,je),d(i,Ve)},p:ae,i:ae,o:ae,d(ke){ke&&x(e)}}}var bv=class extends xe{constructor(e){super(),Ce(this,e,null,zL,Ue,{})}},LC=bv;var ct={SECONDS_A_MINUTE:60,SECONDS_A_HOUR:3600,SECONDS_A_DAY:86400,SECONDS_A_WEEK:604800,MILLISECONDS_A_SECOND:1e3,MILLISECONDS_A_MINUTE:6e4,MILLISECONDS_A_HOUR:36e5,MILLISECONDS_A_DAY:864e5,MILLISECONDS_A_WEEK:6048e5,MS:"millisecond",S:"second",MIN:"minute",H:"hour",D:"day",W:"week",M:"month",Q:"quarter",Y:"year",DATE:"date",FORMAT_DEFAULT:"YYYY-MM-DDTHH:mm:ssZ",INVALID_DATE_STRING:"Invalid Date",REGEX_PARSE:/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,REGEX_FORMAT:/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g},yv=(t,e,n)=>{let i=String(t);return!i||i.length>=e?t:`${Array(e+1-i.length).join(n)}${t}`},BL=t=>{let e=-t.utcOffset(),n=Math.abs(e),i=Math.floor(n/60),s=n%60;return`${e<=0?"+":"-"}${yv(i,2,"0")}:${yv(s,2,"0")}`},UL=(t,e)=>{let n=(e.year()-t.year())*12+(e.month()-t.month()),i=t.clone().add(n,ct.M),s=e-i<0,o=t.clone().add(n+(s?-1:1),ct.M);return Number(-(n+(e-i)/(s?i-o:o-i))||0)},OL=t=>t<0?Math.ceil(t)||0:Math.floor(t),$L=t=>({M:ct.M,y:ct.Y,w:ct.W,d:ct.D,h:ct.H,m:ct.MIN,s:ct.S,ms:ct.MS,Q:ct.Q})[t]||String(t||"").toLowerCase().replace(/s$/,""),NL=t=>t===void 0,jL={s:yv,z:BL,m:UL,a:OL,p:$L,u:NL},WL={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},Sd="en",wl={};wl[Sd]=WL;var kv=t=>t instanceof ic,Ad=(t,e,n)=>{let i;if(!t)return Sd;if(typeof t=="string")wl[t]&&(i=t),e&&(wl[t]=e,i=t);else{let{name:s}=t;wl[s]=t,i=s}return n||(Sd=i),i},Yn=(t,e,n)=>{if(kv(t))return t.clone();let i=e?typeof e=="string"?{format:e,pl:n}:e:{};return i.date=t,new ic(i)},GL=(t,e)=>Yn(t,{locale:e.$L,utc:e.$u,$offset:e.$offset}),an=jL;an.l=Ad;an.i=kv;an.w=GL;var HL=t=>{let{date:e,utc:n}=t;if(e===null)return new Date(NaN);if(an.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){let i=e.match(ct.REGEX_PARSE);if(i)return n?new Date(Date.UTC(i[1],i[2]-1,i[3]||1,i[4]||0,i[5]||0,i[6]||0,i[7]||0)):new Date(i[1],i[2]-1,i[3]||1,i[4]||0,i[5]||0,i[6]||0,i[7]||0)}return new Date(e)},ic=class{constructor(e){this.$L=this.$L||Ad(e.locale,null,!0),this.parse(e)}parse(e){this.$d=HL(e),this.init()}init(){let{$d:e}=this;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()}$utils(){return an}isValid(){return this.$d.toString()!==ct.INVALID_DATE_STRING}isSame(e,n){let i=Yn(e);return this.startOf(n)<=i&&i<=this.endOf(n)}isAfter(e,n){return Yn(e)<this.startOf(n)}isBefore(e,n){return this.endOf(n)<Yn(e)}$g(e,n,i){return an.u(e)?this[n]:this.set(i,e)}year(e){return this.$g(e,"$y",ct.Y)}month(e){return this.$g(e,"$M",ct.M)}day(e){return this.$g(e,"$W",ct.D)}date(e){return this.$g(e,"$D",ct.DATE)}hour(e){return this.$g(e,"$H",ct.H)}minute(e){return this.$g(e,"$m",ct.MIN)}second(e){return this.$g(e,"$s",ct.S)}millisecond(e){return this.$g(e,"$ms",ct.MS)}unix(){return Math.floor(this.valueOf()/1e3)}valueOf(){return this.$d.getTime()}startOf(e,n){let i=an.u(n)?!0:n,s=an.p(e),o=(u,m)=>{let g=an.w(this.$u?Date.UTC(this.$y,m,u):new Date(this.$y,m,u),this);return i?g:g.endOf(ct.D)},r=(u,m)=>{let g=[0,0,0,0],v=[23,59,59,999];return an.w(this.toDate()[u].apply(this.toDate(),(i?g:v).slice(m)),this)},{$W:l,$M:a,$D:c}=this,f=`set${this.$u?"UTC":""}`;switch(s){case ct.Y:return i?o(1,0):o(31,11);case ct.M:return i?o(1,a):o(0,a+1);case ct.W:{let u=this.$locale().weekStart||0,m=(l<u?l+7:l)-u;return o(i?c-m:c+(6-m),a)}case ct.D:case ct.DATE:return r(`${f}Hours`,0);case ct.H:return r(`${f}Minutes`,1);case ct.MIN:return r(`${f}Seconds`,2);case ct.S:return r(`${f}Milliseconds`,3);default:return this.clone()}}endOf(e){return this.startOf(e,!1)}$set(e,n){let i=an.p(e),s=`set${this.$u?"UTC":""}`,o={[ct.D]:`${s}Date`,[ct.DATE]:`${s}Date`,[ct.M]:`${s}Month`,[ct.Y]:`${s}FullYear`,[ct.H]:`${s}Hours`,[ct.MIN]:`${s}Minutes`,[ct.S]:`${s}Seconds`,[ct.MS]:`${s}Milliseconds`}[i],r=i===ct.D?this.$D+(n-this.$W):n;if(i===ct.M||i===ct.Y){let l=this.clone().set(ct.DATE,1);l.$d[o](r),l.init(),this.$d=l.set(ct.DATE,Math.min(this.$D,l.daysInMonth())).toDate()}else o&&this.$d[o](r);return this.init(),this}set(e,n){return this.clone().$set(e,n)}get(e){return this[an.p(e)]()}add(e,n){e=Number(e);let i=an.p(n),s=l=>{let a=Yn(this);return an.w(a.date(a.date()+Math.round(l*e)),this)};if(i===ct.M)return this.set(ct.M,this.$M+e);if(i===ct.Y)return this.set(ct.Y,this.$y+e);if(i===ct.D)return s(1);if(i===ct.W)return s(7);let o={[ct.MIN]:ct.MILLISECONDS_A_MINUTE,[ct.H]:ct.MILLISECONDS_A_HOUR,[ct.S]:ct.MILLISECONDS_A_SECOND}[i]||1,r=this.$d.getTime()+e*o;return an.w(r,this)}subtract(e,n){return this.add(e*-1,n)}format(e){if(!this.isValid())return ct.INVALID_DATE_STRING;let n=e||ct.FORMAT_DEFAULT,i=an.z(this),s=this.$locale(),{$H:o,$m:r,$M:l}=this,{weekdays:a,months:c,meridiem:f}=s,u=(_,b,y,k)=>_&&(_[b]||_(this,n))||y[b].substr(0,k),m=_=>an.s(o%12||12,_,"0"),g=f||((_,b,y)=>{let k=_<12?"AM":"PM";return y?k.toLowerCase():k}),v={YY:String(this.$y).slice(-2),YYYY:this.$y,M:l+1,MM:an.s(l+1,2,"0"),MMM:u(s.monthsShort,l,c,3),MMMM:c[l]||c(this,n),D:this.$D,DD:an.s(this.$D,2,"0"),d:String(this.$W),dd:u(s.weekdaysMin,this.$W,a,2),ddd:u(s.weekdaysShort,this.$W,a,3),dddd:a[this.$W],H:String(o),HH:an.s(o,2,"0"),h:m(1),hh:m(2),a:g(o,r,!0),A:g(o,r,!1),m:String(r),mm:an.s(r,2,"0"),s:String(this.$s),ss:an.s(this.$s,2,"0"),SSS:an.s(this.$ms,3,"0"),Z:i};return n.replace(ct.REGEX_FORMAT,(_,b)=>b||v[_]||i.replace(":",""))}utcOffset(){return-Math.round(this.$d.getTimezoneOffset()/15)*15}diff(e,n,i){let s=an.p(n),o=Yn(e),r=(o.utcOffset()-this.utcOffset())*ct.MILLISECONDS_A_MINUTE,l=this-o,a=an.m(this,o);return a={[ct.Y]:a/12,[ct.M]:a,[ct.Q]:a/3,[ct.W]:(l-r)/ct.MILLISECONDS_A_WEEK,[ct.D]:(l-r)/ct.MILLISECONDS_A_DAY,[ct.H]:l/ct.MILLISECONDS_A_HOUR,[ct.MIN]:l/ct.MILLISECONDS_A_MINUTE,[ct.S]:l/ct.MILLISECONDS_A_SECOND}[s]||l,i?a:an.a(a)}daysInMonth(){return this.endOf(ct.M).$D}$locale(){return wl[this.$L]}locale(e,n){if(!e)return this.$L;let i=this.clone();return i.$L=Ad(e,n,!0),i}clone(){return an.w(this.$d,this)}toDate(){return new Date(this.valueOf())}toJSON(){return this.isValid()?this.toISOString():null}toISOString(){return this.$d.toISOString()}toString(){return this.$d.toUTCString()}};Yn.prototype=ic.prototype;Yn.extend=(t,e)=>(t(e,ic,Yn),Yn);Yn.locale=Ad;Yn.isDayjs=kv;Yn.unix=t=>Yn(t*1e3);Yn.en=wl[Sd];Yn.Ls=wl;var pu=Yn;function qC(t,e,n){let i=t.slice();return i[13]=e[n],i[15]=n,i}function YL(t){let e=C.ui.elixir.notactive+"",n;return{c(){n=T(e)},m(i,s){w(i,n,s)},p:ae,d(i){i&&x(n)}}}function XL(t){let e,n,i,s=pu(t[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"",o;return{c(){e=h("img"),i=We(),o=T(s),p(e,"class","svgicon"),lt(e.src,n="/data/ui/icons/check.svg?v=8602459")||p(e,"src",n)},m(r,l){w(r,e,l),w(r,i,l),w(r,o,l)},p(r,l){l&2&&s!==(s=pu(r[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"")&&G(o,s)},d(r){r&&(x(e),x(i),x(o))}}}function RC(t){let e,n=t[13].name+"",i,s,o,r,l,a,c;o=new dr({props:{amount:t[13].price}});function f(...u){return t[9](t[15],...u)}return{c(){e=h("btn"),i=T(n),s=We(),ne(o.$$.fragment),p(e,"class",r="btn black navbtn textwhite "+(t[5]==t[15]?"active":"")+" big")},m(u,m){w(u,e,m),d(e,i),d(e,s),K(o,e,null),l=!0,a||(c=Y(e,"click",f),a=!0)},p(u,m){t=u,(!l||m&32&&r!==(r="btn black navbtn textwhite "+(t[5]==t[15]?"active":"")+" big"))&&p(e,"class",r)},i(u){l||(P(o.$$.fragment,u),l=!0)},o(u){I(o.$$.fragment,u),l=!1},d(u){u&&x(e),ee(o),a=!1,c()}}}function zC(t){let e,n=C.ui.elixir.sendgift+"",i,s,o,r;return{c(){e=h("btn"),i=T(n),p(e,"class",s="btn navbtn "+(t[6]?"active white":"textprimary")+" big")},m(l,a){w(l,e,a),d(e,i),o||(r=Y(e,"click",t[10]),o=!0)},p(l,a){a&64&&s!==(s="btn navbtn "+(l[6]?"active white":"textprimary")+" big")&&p(e,"class",s)},d(l){l&&x(e),o=!1,r()}}}function QL(t){let e;function n(o,r){return o[0]=="addsubscription"?KL:JL}let i=n(t,-1),s=i(t);return{c(){e=h("div"),s.c(),p(e,"class","fadeIn card marg-top")},m(o,r){w(o,e,r),s.m(e,null)},p(o,r){i!==(i=n(o,r))&&(s.d(1),s=i(o),s&&(s.c(),s.m(e,null)))},i:ae,o:ae,d(o){o&&x(e),s.d()}}}function ZL(t){let e,n,i=(t[6]?C.ui.elixir.willgift:C.ui.elixir.willadd)+"",s,o,r,l=C.ui.elixir.subduration[t[5]]+"",a,c,f,u,m=C.ui.elixir.willcost+"",g,v,_,b,y,k,A,S,F=(t[6]?C.ui.elixir.send:t[1].subscribed_until?C.ui.elixir.extend:C.ui.elixir.activate)+"",M,D,R,E,L;v=new dr({props:{amount:t[8].price}});let z=[tq,eq],q=[];function j(O,Z){return O[6]?1:0}b=j(t,-1),y=q[b]=z[b](t);let W=t[0]=="addsubscription"&&t[2]&&BC(t),U=t[1].storepoints<t[8].price&&UC(t);return{c(){e=h("div"),n=h("div"),s=T(i),o=We(),r=h("span"),a=T(l),c=We(),f=h("span"),f.textContent=`${C.ui.elixir.subscription}`,u=T("? "),g=T(m),ne(v.$$.fragment),_=T("."),y.c(),k=he(),W&&W.c(),A=h("div"),S=h("div"),M=T(F),U&&U.c(),p(r,"class","bold textwhite"),p(f,"class","textsub"),p(n,"class","textgrey"),p(S,"class",D="btn grey formatted "+(t[3]=="addsubscription"||t[1].storepoints<t[8].price?"disabled":"")),p(A,"class","subnav"),p(e,"class","fadeIn card marg-top"),qe(e,"padding","18px")},m(O,Z){w(O,e,Z),d(e,n),d(n,s),d(n,o),d(n,r),d(r,a),d(n,c),d(n,f),d(n,u),d(n,g),K(v,n,null),d(n,_),q[b].m(e,null),d(e,k),W&&W.m(e,null),d(e,A),d(A,S),d(S,M),U&&U.m(e,null),R=!0,E||(L=Y(S,"click",t[12]),E=!0)},p(O,Z){(!R||Z&64)&&i!==(i=(O[6]?C.ui.elixir.willgift:C.ui.elixir.willadd)+"")&&G(s,i),(!R||Z&32)&&l!==(l=C.ui.elixir.subduration[O[5]]+"")&&G(a,l);let ve={};Z&256&&(ve.amount=O[8].price),v.$set(ve);let Fe=b;b=j(O,Z),b===Fe?q[b].p(O,Z):(Ee(),I(q[Fe],1,1,()=>{q[Fe]=null}),Ie(),y=q[b],y?y.p(O,Z):(y=q[b]=z[b](O),y.c()),P(y,1),y.m(e,k)),O[0]=="addsubscription"&&O[2]?W?W.p(O,Z):(W=BC(O),W.c(),W.m(e,A)):W&&(W.d(1),W=null),(!R||Z&66)&&F!==(F=(O[6]?C.ui.elixir.send:O[1].subscribed_until?C.ui.elixir.extend:C.ui.elixir.activate)+"")&&G(M,F),(!R||Z&266&&D!==(D="btn grey formatted "+(O[3]=="addsubscription"||O[1].storepoints<O[8].price?"disabled":"")))&&p(S,"class",D),O[1].storepoints<O[8].price?U||(U=UC(O),U.c(),U.m(e,null)):U&&(U.d(1),U=null)},i(O){R||(P(v.$$.fragment,O),P(y),R=!0)},o(O){I(v.$$.fragment,O),I(y),R=!1},d(O){O&&x(e),ee(v),q[b].d(),W&&W.d(),U&&U.d(),E=!1,L()}}}function JL(t){let e;return{c(){e=h("p"),e.textContent="Please Select an option above!",p(e,"class","fadeIn textgrey")},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function KL(t){let e;return{c(){e=h("p"),e.textContent=`${C.ui.elixir.thankyou}`,p(e,"class","fadeIn textsub")},m(n,i){w(n,e,i)},d(n){n&&x(e)}}}function eq(t){let e,n,i,s;function o(l){t[11](l)}let r={};return t[7]!==void 0&&(r.name=t[7]),n=new Cd({props:r}),Bt.push(()=>zo(n,"name",o)),{c(){e=h("div"),ne(n.$$.fragment),p(e,"class","subnav")},m(l,a){w(l,e,a),K(n,e,null),s=!0},p(l,a){let c={};!i&&a&128&&(i=!0,c.name=l[7],Ro(()=>i=!1)),n.$set(c)},i(l){s||(P(n.$$.fragment,l),s=!0)},o(l){I(n.$$.fragment,l),s=!1},d(l){l&&x(e),ee(n)}}}function tq(t){let e,n=C.ui.elixir.enable+"",i,s,o,r=pu(t[1].subscribed_until||void 0).add(t[8].days,"day").format("MMM DD, YYYY HH:mm")+"",l,a;return{c(){e=h("p"),i=T(n),s=We(),o=h("span"),l=T(r),a=T("."),p(o,"class","textwhite"),p(e,"class","bold textsub")},m(c,f){w(c,e,f),d(e,i),d(e,s),d(e,o),d(o,l),d(e,a)},p(c,f){f&258&&r!==(r=pu(c[1].subscribed_until||void 0).add(c[8].days,"day").format("MMM DD, YYYY HH:mm")+"")&&G(l,r)},i:ae,o:ae,d(c){c&&x(e)}}}function BC(t){let e,n;return{c(){e=h("p"),n=T(t[2]),p(e,"class","fadeIn textred")},m(i,s){w(i,e,s),d(e,n)},p(i,s){s&4&&G(n,i[2])},d(i){i&&x(e)}}}function UC(t){let e,n,i=C.ui.elixir.pointserror+"",s,o,r;return{c(){e=h("p"),n=h("small"),s=T(i),o=We(),r=h("a"),r.textContent=`${C.ui.elixir.buypoints} ${C.ui.elixir.currency}`,p(r,"class","textprimary"),p(r,"href","/store")},m(l,a){w(l,e,a),d(e,n),d(n,s),d(n,o),d(n,r)},d(l){l&&x(e)}}}function nq(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v,_,b;n=new LC({});function y(z,q){return z[1].subscribed_until?XL:YL}let k=y(t,-1),A=k(t);a=new dr({props:{amount:t[1].storepoints}});let S=me(gd),F=[];for(let z=0;z<S.length;z+=1)F[z]=RC(qC(t,S,z));let M=z=>I(F[z],1,1,()=>{F[z]=null}),D=t[5]!==void 0&&zC(t),R=[ZL,QL],E=[];function L(z,q){return z[5]!==void 0?0:1}return v=L(t,-1),_=E[v]=R[v](t),{c(){e=h("div"),ne(n.$$.fragment),i=h("small"),i.textContent=`${C.ui.elixir.subscription}`,s=h("div"),A.c(),r=h("small"),r.textContent=`${C.ui.elixir.currency}`,l=h("div"),ne(a.$$.fragment),c=We(),f=h("a"),f.textContent=`${C.ui.elixir.buypoints} ${C.ui.elixir.currency}`,u=h("p"),u.textContent=`${C.ui.elixir.support}`,m=h("div");for(let z=0;z<F.length;z+=1)F[z].c();g=he(),D&&D.c(),_.c(),p(i,"class","textgrey"),p(s,"class",o="cardinfo "+(t[1].subscribed_until?"textsub":"textgrey")),p(r,"class","textgrey"),p(f,"class","textwhite"),p(f,"href","/store"),p(l,"class","cardinfo"),p(u,"class","textgrey"),p(m,"class","subnav"),p(e,"class","card")},m(z,q){w(z,e,q),K(n,e,null),d(e,i),d(e,s),A.m(s,null),d(e,r),d(e,l),K(a,l,null),d(l,c),d(l,f),d(e,u),d(e,m);for(let j=0;j<F.length;j+=1)F[j]&&F[j].m(m,null);d(m,g),D&&D.m(m,null),E[v].m(e,null),b=!0},p(z,[q]){k===(k=y(z,q))&&A?A.p(z,q):(A.d(1),A=k(z),A&&(A.c(),A.m(s,null))),(!b||q&2&&o!==(o="cardinfo "+(z[1].subscribed_until?"textsub":"textgrey")))&&p(s,"class",o);let j={};if(q&2&&(j.amount=z[1].storepoints),a.$set(j),q&32){S=me(gd);let U;for(U=0;U<S.length;U+=1){let O=qC(z,S,U);F[U]?(F[U].p(O,q),P(F[U],1)):(F[U]=RC(O),F[U].c(),P(F[U],1),F[U].m(m,g))}for(Ee(),U=S.length;U<F.length;U+=1)M(U);Ie()}z[5]!==void 0?D?D.p(z,q):(D=zC(z),D.c(),D.m(m,null)):D&&(D.d(1),D=null);let W=v;v=L(z,q),v===W?E[v].p(z,q):(Ee(),I(E[W],1,1,()=>{E[W]=null}),Ie(),_=E[v],_?_.p(z,q):(_=E[v]=R[v](z),_.c()),P(_,1),_.m(e,null))},i(z){if(!b){P(n.$$.fragment,z),P(a.$$.fragment,z);for(let q=0;q<S.length;q+=1)P(F[q]);P(_),b=!0}},o(z){I(n.$$.fragment,z),I(a.$$.fragment,z),F=F.filter(Boolean);for(let q=0;q<F.length;q+=1)I(F[q]);I(_),b=!1},d(z){z&&x(e),ee(n),A.d(),ee(a),it(F,z),D&&D.d(),E[v].d()}}}function iq(t,e,n){let i,s,o=!1,r,{user:l}=e,{flash:a=void 0}=e,{flashmsg:c=void 0}=e,{action:f=void 0}=e,{apiCall:u}=e,m=(b,y)=>n(5,s=b),g=b=>n(6,o=!o);function v(b){r=b,n(7,r)}let _=b=>u("addsubscription","/api/account/addsubscription",{value:s,gift:o?r:void 0},!0,y=>{y.result=="ok"&&(n(5,s=void 0),n(0,a="addsubscription"))});return t.$$set=b=>{"user"in b&&n(1,l=b.user),"flash"in b&&n(0,a=b.flash),"flashmsg"in b&&n(2,c=b.flashmsg),"action"in b&&n(3,f=b.action),"apiCall"in b&&n(4,u=b.apiCall)},t.$$.update=()=>{t.$$.dirty&32&&n(8,i=gd[s])},[a,l,c,f,u,s,o,r,i,m,g,v,_]}var xv=class extends xe{constructor(e){super(),Ce(this,e,iq,nq,Ue,{user:1,flash:0,flashmsg:2,action:3,apiCall:4})}},OC=xv;function $C(t){let e,n;return e=new jt({props:{origin:"center",title:"Store / Elixir",icon:"gem",$$slots:{default:[sq]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&316&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function sq(t){let e,n,i;return n=new OC({props:{user:t[5],flash:t[2],flashmsg:t[3],action:t[4],apiCall:t[0]}}),{c(){e=h("div"),ne(n.$$.fragment),p(e,"class","container svelte-1lv1z23")},m(s,o){w(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&32&&(r.user=s[5]),o&4&&(r.flash=s[2]),o&8&&(r.flashmsg=s[3]),o&16&&(r.action=s[4]),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&x(e),ee(n)}}}function oq(t){let e,n,i=t[1]&&t[5]&&$C(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[1]&&s[5]?i?(i.p(s,o),o&34&&P(i,1)):(i=$C(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function rq(t,e,n){let i,s;se(t,qi,u=>n(1,i=u)),se(t,_v,u=>n(5,s=u));let o,r,l,a,c=async(u,m,g,v,_)=>{n(4,a=u);let b=await Nt(m,g);n(4,a=void 0),b.result==="ok"?n(2,r=void 0):(n(2,r=u),n(3,l=b.result)),v&&mu(),_&&_(b)},f=u=>Qe(qi,i=!1,i);return t.$$.update=()=>{t.$$.dirty&2&&i&&mu()},[c,i,r,l,a,s,f]}var wv=class extends xe{constructor(e){super(),Ce(this,e,rq,oq,Ue,{apiCall:0})}get apiCall(){return this.$$.ctx[0]}},NC=wv;function jC(t){let e,n;return{c(){e=h("ins"),n=h("script"),n.textContent="(adsbygoogle = window.adsbygoogle || []).push({});",p(e,"class","adsbygoogle"),qe(e,"display","inline-block"),qe(e,"width","728px"),qe(e,"height","90px"),p(e,"data-ad-client","ca-pub-6128207871826113"),p(e,"data-ad-slot","2385450998")},m(i,s){w(i,e,s),w(i,n,s)},d(i){i&&(x(e),x(n))}}}function lq(t){let e,n,i,s,o,r,l,a=t[1]%2==0&&jC(t);return{c(){e=h("div"),n=h("h3"),i=T("Hordes.io is free! Buy "),s=h("span"),s.innerHTML='<span class="textwhite">Hordes</span> <img class="svgicon texticon" src="/data/ui/icons/gem.svg?v=8602459"/>  Elixir',o=T(" to hide this window and support development."),a&&a.c(),p(s,"class","btn textsub"),p(n,"class","textgrey blocktext svelte-svpjti"),p(e,"class","container panel-black svelte-svpjti")},m(c,f){w(c,e,f),d(e,n),d(n,i),d(n,s),d(n,o),a&&a.m(e,null),r||(l=Y(s,"click",t[2]),r=!0)},p(c,[f]){c[1]%2==0?a||(a=jC(c),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:ae,o:ae,d(c){c&&x(e),a&&a.d(),r=!1,l()}}}function aq(t,e,n){let i,s;return se(t,qi,r=>n(0,i=r)),se(t,Dr,r=>n(1,s=r)),[i,s,r=>Qe(qi,i=!0,i)]}var Mv=class extends xe{constructor(e){super(),Ce(this,e,aq,lq,Ue,{})}},WC=Mv;function GC(t,e,n){let i=t.slice();return i[4]=e[n],i}function HC(t){let e,n,i=ii(t[4].viewers)+"",s;return{c(){e=h("div"),n=h("span"),s=T(i),p(n,"class","textgreen"),p(e,"class","bold viewcount textbox svelte-13wcf6i")},m(o,r){w(o,e,r),d(e,n),d(n,s)},p(o,r){r&2&&i!==(i=ii(o[4].viewers)+"")&&G(s,i)},d(o){o&&x(e)}}}function YC(t){let e,n,i,s=t[4].name+"",o,r,l,a,c=t[4].viewers&&HC(t);return{c(){e=h("a"),n=h("div"),c&&c.c(),i=h("div"),o=T(s),p(i,"class","name textbox svelte-13wcf6i"),p(n,"class","border black preview svelte-13wcf6i"),p(n,"style",r=(t[4].preview?"background-image:url("+t[4].preview+");":"")+"); "+(t[0]?"margin-top:2px;":"")),p(e,"class","fadeIn stream svelte-13wcf6i"),p(e,"target","_blank"),p(e,"rel","noopener noreferrer"),p(e,"href",l=t[4].url),p(e,"style",a=t[0]?"":"width:calc(100%/6);")},m(f,u){w(f,e,u),d(e,n),c&&c.m(n,null),d(n,i),d(i,o)},p(f,u){f[4].viewers?c?c.p(f,u):(c=HC(f),c.c(),c.m(n,i)):c&&(c.d(1),c=null),u&2&&s!==(s=f[4].name+"")&&G(o,s),u&3&&r!==(r=(f[4].preview?"background-image:url("+f[4].preview+");":"")+"); "+(f[0]?"margin-top:2px;":""))&&p(n,"style",r),u&2&&l!==(l=f[4].url)&&p(e,"href",l),u&1&&a!==(a=f[0]?"":"width:calc(100%/6);")&&p(e,"style",a)},d(f){f&&x(e),c&&c.d()}}}function cq(t){let e,n,i=me(t[1]),s=[];for(let o=0;o<i.length;o+=1)s[o]=YC(GC(t,i,o));return{c(){e=h("div");for(let o=0;o<s.length;o+=1)s[o].c();p(e,"style",n="pointer-events: all; "+(t[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))},m(o,r){w(o,e,r);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null)},p(o,[r]){if(r&3){i=me(o[1]);let l;for(l=0;l<i.length;l+=1){let a=GC(o,i,l);s[l]?s[l].p(a,r):(s[l]=YC(a),s[l].c(),s[l].m(e,null))}for(;l<s.length;l+=1)s[l].d(1);s.length=i.length}r&1&&n!==(n="pointer-events: all; "+(o[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))&&p(e,"style",n)},i:ae,o:ae,d(o){o&&x(e),it(s,o)}}}function fq(t,e,n){let{vertical:i=!1}=e,s=[],o,r=async()=>{o=setTimeout(r,2e4),n(1,s=await Nt("/api/twitch/streams",{max:6}))};return Fn(r),Tn(l=>{o&&clearTimeout(o)}),t.$$set=l=>{"vertical"in l&&n(0,i=l.vertical)},[i,s]}var Fv=class extends xe{constructor(e){super(),Ce(this,e,fq,cq,Ue,{vertical:0})}},XC=Fv;function QC(t){let e,n,i=t[1][3]+"",s,o,r=t[1][1]+"",l,a,c,f=t[1][0]+"",u,m,g,v=t[1][2]+"",_,b,y,k=t[1][4]+"",A,S;return{c(){e=h("small"),n=h("div"),s=T(i),o=h("div"),l=T(r),a=T(" fps"),c=h("div"),u=T(f),m=T(" ms"),g=h("div"),_=T(v),b=T(" KBs"),y=h("div"),A=T(k),S=T(" BFR"),p(n,"class","textyellow"),p(o,"class","textgreen"),p(c,"class","textcyan"),p(g,"class","textorange"),p(y,"class","textpurp"),p(e,"class","marg-top bar btn black grey svelte-nijy6x")},m(F,M){w(F,e,M),d(e,n),d(n,s),d(e,o),d(o,l),d(o,a),d(e,c),d(c,u),d(c,m),d(e,g),d(g,_),d(g,b),d(e,y),d(y,A),d(y,S)},p(F,M){M&2&&i!==(i=F[1][3]+"")&&G(s,i),M&2&&r!==(r=F[1][1]+"")&&G(l,r),M&2&&f!==(f=F[1][0]+"")&&G(u,f),M&2&&v!==(v=F[1][2]+"")&&G(_,v),M&2&&k!==(k=F[1][4]+"")&&G(A,k)},d(F){F&&x(e)}}}function uq(t){let e,n=t[0]&&QC(t);return{c(){n&&n.c(),e=he()},m(i,s){n&&n.m(i,s),w(i,e,s)},p(i,[s]){i[0]?n?n.p(i,s):(n=QC(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(i){i&&x(e),n&&n.d(i)}}}function mq(t,e,n){let i,s;return se(t,ba,o=>n(0,i=o)),se(t,gm,o=>n(1,s=o)),[i,s]}var Cv=class extends xe{constructor(e){super(),Ce(this,e,mq,uq,Ue,{})}},ZC=Cv;function JC(t){let e,n;return e=new jt({props:{title:"Item",icon:"char",origin:"center",cog:!1,$$slots:{default:[pq]},$$scope:{ctx:t}}}),e.$on("close",t[1]),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&5&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function pq(t){let e,n,i,s;return n=new tc({props:{item:t[0],showTradeInfo:!1,showLore:!1}}),{c(){e=h("div"),ne(n.$$.fragment),p(e,"class",i="panel-black border "+Ut(t[0].quality)[0])},m(o,r){w(o,e,r),K(n,e,null),s=!0},p(o,r){let l={};r&1&&(l.item=o[0]),n.$set(l),(!s||r&1&&i!==(i="panel-black border "+Ut(o[0].quality)[0]))&&p(e,"class",i)},i(o){s||(P(n.$$.fragment,o),s=!0)},o(o){I(n.$$.fragment,o),s=!1},d(o){o&&x(e),ee(n)}}}function dq(t){let e,n,i=t[0]&&JC(t);return{c(){i&&i.c(),e=he()},m(s,o){i&&i.m(s,o),w(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=JC(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),I(i,1,1,()=>{i=null}),Ie())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&x(e),i&&i.d(s)}}}function hq(t,e,n){let i;return se(t,Vr,o=>n(0,i=o)),[i,()=>{Qe(Vr,i=void 0,i)}]}var Sv=class extends xe{constructor(e){super(),Ce(this,e,hq,dq,Ue,{})}},KC=Sv;var m2={};Qn(m2,{canvas:()=>yi,changeCanvas:()=>f0,init:()=>xR,onWorldDestroy:()=>CR,onWorldEnter:()=>FR,postTick:()=>wR});var Pv=0,ss=0,Tv=0,Ev=5,du=10,hu=10,nS=0,gq,Iv=0,Dv=0,Vv=0,Lv=0,iS=(t,e)=>{t=Math.max(150,Math.min(1500,t)),ss=t*.8,Tv=Math.min(ss,150),Pv=20,Iv=ss,Lv=ss**2,Dv=Math.min(ss,50),Vv=Math.min(ss/32,150/32)**2,gt.far=nS=t,gq=t**2,Gc(gt),hu=Math.min(ss,100+e*50),du=Math.min(ss,40+e*10),Ev=(hu+du)/2,Nn=Math.ceil(t*2/32),Nn+=Nn%2,vr=Nn/2,vr+=vr%2,vq()},Av=[],gr=[],Pd=[],qv=0,Rv=0,zv=-1/0,Bv=-1/0,Uv=-1/0,Ov=-1/0,_r=-1/0,gu=-1/0,br=-1/0,vu=-1/0,Nn=0,vr=0,vq=()=>{let t=vr,e=(Math.min(ss*.7,250)/32)**2,n=(Math.max(e,ss)/32)**2,i=(nS/32)**2;Av.length=0,gr.length=0;for(let s=0;s<Nn;++s)for(let o=0;o<Nn;++o){let r=(t-o)**2+(t-s)**2,l=0;r>i?l=3:r>n?l=2:r>e&&(l=1),Av.push(r),gr.push(l)}Pd.length=0;for(let s=0;s<Nn;++s)for(let o=0;o<Nn;++o){let r=o%2,a=s%2*2+r,c=Math.min(gr[o+s*Nn],2);if(c<2){let f=gr[Math.min(Nn-1,o+1)+s*Nn]>c,u=gr[Math.max(0,o-1)+s*Nn]>c,m=gr[o+Math.max(0,s-1)*Nn]>c,g=gr[o+Math.min(Nn-1,s+1)*Nn]>c,v=a*33+c*16+((u?1:0)|(m?2:0)|(f?4:0)|(g?8:0));Pd.push(v)}else Pd.push(a*33+c*16)}},$v=(t,e)=>{if(t<_r||t>=gu||e<br||e>=vu)return 3;let n=t-_r,i=e-br;return gr[n+i*Nn]},sS=(t,e)=>{if(t<_r||t>=gu||e<br||e>=vu)return 1/0;let n=t-_r,i=e-br;return Av[n+i*Nn]},oS=(t,e)=>{if(t<_r||t>=gu||e<br||e>=vu)return 2*16;let n=t-_r,i=e-br;return Pd[n+i*Nn]},eS=-1/0,tS=-1/0,_q=(t,e)=>(t=Math.floor(t/64)*2,e=Math.floor(e/64)*2,t!==eS||e!==tS?(_r=t-vr,gu=t+vr,br=e-vr,vu=e+vr,zv=Math.floor(_r/2),Bv=Math.ceil(gu/2),Uv=Math.floor(br/2),Ov=Math.ceil(vu/2),qv=Math.floor(t/2),Rv=Math.floor(e/2),eS=t,tS=e,!0):!1),Nv=!0,rS=t=>{Nv=_q(Ht.position[0],Ht.position[2])};var bq=0,aS=(t,e,n,i=0,s=!1,o=!1)=>{let r={id:bq++,geometry:Sn({}),program:t,shadowProgram:i,mode:e,uniformData:{},individualFrustums:o,dynamic:s,needsUpdate:!1,lastUpdateCamPos:[0,0,0],drawCount:0,cullFace:1029,instances:[],instancedAttributeNames:[],instancedAttributes:[],instancedData:[]};for(let l=0;l<n.length;++l){let a=n[l];lS(r,a.name,a.size)}return lS(r,"worldMatrix",16),r},lS=(t,e,n)=>{t.instancedAttributes.push({name:e,instanced:!0,bufferMode:t.dynamic?35048:35044,size:n,data:new Float32Array(n)}),t.instancedAttributeNames.push(e),t.instancedData.push([])},jv=t=>{let e=rn();e.geometry=t.geometry,e.data.multi=t,t.instances.push(e);for(let n=0;n<t.instancedAttributes.length;++n){let i=t.instancedAttributes[n],s=t.instancedAttributeNames[n];t.instancedData[n].push(e.data[s]=s==="worldMatrix"?e.worldMatrix:Array(i.size).fill(1))}return t.needsUpdate=!0,e},cS=(t,e,n,i)=>{let s=t.instances.indexOf(e),o=t.instancedAttributeNames.indexOf(n);o>=0&&(t.instancedData[o][s]=i,e.data[n]=i)},ws=(t,e)=>{let n=t.instances.indexOf(e);t.instances.splice(n,1);for(let i=0;i<t.instancedAttributes.length;++i)t.instancedData[i].splice(n,1);t.needsUpdate=!0,ms(e)},fS=t=>{for(let e=0;e<t.instances;++e)ms(t[e]);for(let e=0;e<t.instancedAttributes.length;++e)t.instancedData[e].length=0;t.instances.length=0,t.needsUpdate=!0},yq=(t,e)=>{t.needsUpdate=t.dynamic;for(let l=0;l<t.instancedAttributes.length;++l){let a=t.instancedAttributes[l];kq(a,a.size,t.instances.length)}let n=t.dynamic,i=t.individualFrustums,s=t.instancedData,o=t.instances,r=0;for(let l=0;l<o.length;++l){let a=o[l];if(a.visible&&(!n||!i||S_(e,a.geometry,a))){for(let f=0;f<t.instancedAttributes.length;++f){let u=t.instancedAttributes[f],m=u.data,g=s[f][l],v=r*u.size,_=v+u.size;for(let b=v,y=0;b<_;++b,++y)m[b]=g[y]}r++}}if(t.drawCount=r,Sp(t.geometry,t.drawCount),t.drawCount!==0)for(let l=0;l<t.instancedAttributes.length;++l){let a=t.instancedAttributes[l];Cp(t.geometry,a,r)}},sc=(t,e,n,i)=>{if(n&&t.needsUpdate&&yq(t,i),e.active&&t.drawCount>0){e.cullFace=t.cullFace;for(let s=0;s<e.autoUniforms.length;++s){let o=e.autoUniforms[s];e.uniforms[o].value=t.uniformData[o]}Ap(t.uniformData,e),Ta(e,tt.currentProgram===e.id),Pa(t.geometry,e,t.mode)}},uS=(t,e)=>{let n={...e};for(let i=0;i<t.instancedAttributeNames.length;++i)n[t.instancedAttributeNames[i]]=t.instancedAttributes[i];n1(t.geometry,n)},kq=(t,e,n)=>{t.data=t.data.byteLength>=e*n*4?t.data:new Float32Array(e*(n+5))};var To=[],mS=(10+1)*6,Fl=new Uint32Array(mS);for(let t=0,e=0;t<mS;t+=6,e+=2)Fl[t+0]=e,Fl[t+1]=e+1,Fl[t+2]=e+3,Fl[t+3]=e,Fl[t+4]=e+3,Fl[t+5]=e+2;var Td=new Map,pS=(t,e,n,i,s,o)=>{let r=a1.get(t),l=Td.get(r.steps),a;return!l||l.length===0?a=new Wv(r):a=l.pop(),a.reset(r,e,n,i,s,o),To.push(a),a},dS=(t,e)=>{for(let n=0;n<To.length;n++)if(To[n].tick(t,e),To[n].remove){let i=To.splice(n--,1)[0];hS(i)}},hS=t=>{Td.has(t.maxSteps)||Td.set(t.maxSteps,[]),Td.get(t.maxSteps).push(t),t.onCache()},gS=t=>{To.forEach(hS),To.length=0},vS=()=>{for(let t=0;t<To.length;++t){let e=To[t];e.mesh.transform.visible&&Ki(e.mesh,mt[e.mesh.program])}},Wv=class{constructor(e){this.maxSteps=e.steps,this.stepTimer=new kt(0,1),this.duration=new kt(0,1),this.remove=!1,this.a=[0,0,0],this.b=[0,0,0],this.timeoutSteps=0;let n=this.maxSteps+1;this.uv=new Float32Array(n*4),this.positions=new Float32Array(n*6);for(let i=0,s=0;i<n;++i,s+=4)this.uv[s]=i/this.maxSteps,this.uv[s+2]=i/this.maxSteps,this.uv[s+1]=1,this.uv[s+3]=0;this.geometry=Sn({position:{size:3,data:this.positions},uv:{size:2,data:this.uv},index:{type:N.UNSIGNED_INT,data:Fl.subarray(0,6*this.maxSteps)}}),Cp(this.geometry,this.geometry.attributes.uv,n),this.mesh=Ri(this.geometry,19,N.TRIANGLES),this.mesh.uniformData.offset=[0,0],this.waitingForTexture=!1,this.parent=null}reset(e,n,i,s,o,r){this.stepTimer.reset(0,e.interval),this.duration.reset(r,o),this.currentStep=0,this.a=st(this.a,i),this.b=st(this.b,s),this.mesh.uniformData.offset[1]=1/(this.maxSteps+1),this.remove=!1,this.timeoutSteps=0,this.geometry.drawRangeCount=0,this.mesh.uniformData.colStart=e.colStart,this.mesh.uniformData.colEnd=e.colEnd,e.texture>0?(this.waitingForTexture=!0,this.mesh.program=19,gi(e.texture,l=>{this.mesh.uniformData.diffuse=l,this.waitingForTexture=!1})):(this.waitingForTexture=!1,this.mesh.program=18,this.mesh.uniformData.diffuse=void 0),this.parent=n}tick(e,n){if(this.waitingForTexture){this.mesh.transform.visible=!1;return}if(this.duration.duration>0&&this.duration.done(n)){this.remove=!0;return}if(this.parent!==null){if(this.mesh.transform.visible=this.parent.visible&&(!this.parent.parent||this.parent.parent.visible),!this.mesh.transform.visible)return;this.mesh.transform.visible&&this.timeoutSteps==0&&(this.positions.set(Mi(bt,this.a,this.parent.worldMatrix),0),this.positions.set(Mi(bt,this.b,this.parent.worldMatrix),3))}this.stepTimer.done(n)&&(this.stepTimer.reset(n),this.step()),hi(this.geometry,this.geometry.attributes.position);let i=this.stepTimer.fraction(n);this.mesh.uniformData.offset[0]=(1-i)/this.maxSteps}detach(){this.timeoutSteps=Math.max(1,this.currentStep),this.parent=null}step(){this.currentStep=Math.min(this.maxSteps,this.currentStep+1),this.positions.copyWithin(6,0),this.geometry.drawRangeCount=this.currentStep*6,this.timeoutSteps>0&&(this.timeoutSteps--,this.timeoutSteps==0&&(this.remove=!0))}onCache(){this.mesh.transform.visible=!1,this.parent=null}};var Ed=[],Cl=1e3,wq=500,oc=wq,xr=[],bS=()=>{Aq();for(let t=0;t<Cl;++t)Ed.push({pos:[-0,-0,-0],vel:[-0,-0,-0],info:Ep.get(1),distance:0,start:0,end:1.01,forced:!1,scaleRota:[0,0,0,0],infoVec:[0,0,0,0],progVec:[0,0]})},Id=(t,e,n,i)=>{let s=e,o=n,r=!0,l=n;for(;e-n<0;)r?t[l].distance>t[e].distance?(_S(t,l,e),l=e,n--,r=!r):e++:t[l].distance>=t[n].distance?n--:(_S(t,l,n),e++,l=n,r=!r);l-1>s&&Id(t,s,l-1,i),l+1<o&&Id(t,l+1,o,i)},_S=(t,e,n)=>{let i=t[e];t[e]=t[n],t[n]=i},Mq=(t,e,n)=>{let i=[[],[]],s=0,o=0;for(;s<xr.length;){let r=xr[s];if(r.start<0||r.end>t){if(xr[o]=r,o++,r.pos[0]>-1e3){let l=r.pos,a=r.vel,c=r.info.acc;if(l[0]+=(a[0]+=c[0]*e)*e,l[1]+=(a[1]+=c[1]*e)*e,l[2]+=(a[2]+=c[2]*e)*e,r.info.friction>0){let f=1-r.info.friction;a[0]*=f,a[1]*=f,a[2]*=f}if(r.distance=dn(n.frustum[5],l)+n.frustumConstants[5],r.distance<Dv&&r.distance>0){let f=r.start<0?(Math.sin(t/r.info.duration)+1)*.5:(t-r.start)/r.info.duration;r.progVec[0]=f,r.progVec[1]=Ma[r.info.interp](f),i[r.info.blend].push(r)}}}else oc+=r.forced?1:0,Ed.push(r);++s}return xr.length=o,Id(i[0],0,i[0].length-1,i[0].length),Id(i[1],0,i[1].length-1,i[1].length),i},Fq=t=>{for(let e=0;e<2;++e)Sq(t[e],_u[e]),Cq(t[e],_u[e],Sl[e])},Cq=(t,e,n)=>{t.length>0?(n.transform.visible=!0,z3(e,0,t.length),hi(e,e.attributes.position),hi(e,e.attributes.info),hi(e,e.attributes.progress),hi(e,e.attributes.scaleRota),hi(e,e.attributes.colStart),hi(e,e.attributes.colEnd)):n.transform.visible=!1},Sq=(t,e)=>{let n=e.attributes.position.data,i=e.attributes.progress.data,s=e.attributes.info.data,o=e.attributes.scaleRota.data,r=e.attributes.colStart.data,l=e.attributes.colEnd.data;for(let a=0;a<t.length;++a){let c=t[a],f=c.pos,u=c.infoVec,m=c.progVec,g=c.scaleRota,v=c.info.colStart,_=c.info.colEnd,b=a*2,y=a*3,k=a*4;n[y]=f[0],n[y+1]=f[1],n[y+2]=f[2],s[k]=u[0],s[k+1]=u[1],s[k+2]=u[2],s[k+3]=u[3],i[b]=m[0],i[b+1]=m[1],o[k]=g[0],o[k+1]=g[1],o[k+2]=g[2],o[k+3]=g[3],r[k]=v[0],r[k+1]=v[1],r[k+2]=v[2],r[k+3]=v[3],l[k]=_[0],l[k+1]=_[1],l[k+2]=_[2],l[k+3]=_[3]}},yS=t=>{let e=Mq(ko,t,gt);Fq(e)},kr=[0,0,0],eo=(t,e,n=0,i=0,s=0,o=0,r=0,l=0,a=!1)=>{if(e?Rr(kr,n,i,s,e):X(kr,n,i,s),a){if(oc<=0)return}else{if(dn(gt.frustum[0],kr)+gt.frustumConstants[0]<0||dn(gt.frustum[1],kr)+gt.frustumConstants[1]<0)return;let v=dn(gt.frustum[5],kr)+gt.frustumConstants[5];if(v<0||v*10>Ed.length)return}let c=Ed.pop();if(!c){let v=xr.length-1;for(;v>=0&&xr[v].forced;)--v;v>=0&&(c=xr.splice(v,1)[0])}if(!c)return;let f=1;if(e){let v=e[0],_=e[1],b=e[2];f=Math.sqrt(v*v+_*_+b*b),Sm(c.vel,o,r,l,e)}else X(c.vel,o,r,l);c.pos[0]=kr[0],c.pos[1]=kr[1],c.pos[2]=kr[2];let u=Ep.get(t);c.info=u,c.start=a?-1:ko,c.end=c.start+c.info.duration;let m=Math.random()*u.randomRota,g=m+u.rota;return Math.random()<.5&&(m*=-1,g*=-1),ti(c.scaleRota,u.scaleStart*f,u.scaleEnd*f,m,g),ti(c.infoVec,u.idLoop,0,u.idStart,u.idEnd+1),di(c.progVec,0,0),c.forced=a,xr.push(c),a&&oc--,c},Sl=[],_u=[],Aq=()=>{for(let t=0;t<2;++t)_u[t]=Sn({position:{size:3,data:new Float32Array(3*Cl)},progress:{size:2,data:new Float32Array(2*Cl)},info:{size:4,data:new Float32Array(4*Cl)},scaleRota:{size:4,data:new Float32Array(4*Cl)},colStart:{size:4,data:new Float32Array(4*Cl)},colEnd:{size:4,data:new Float32Array(4*Cl)}});Sl[0]=Ri(_u[0],17,N.POINTS),Sl[1]=Ri(_u[1],16,N.POINTS),gi(1215,t=>{Ln("particleDiffuse",t,0,mt[17]),Ln("particleDiffuse",t,0,mt[16])})};var kS=()=>{let t=mt[17];t.active&&Sl[0].transform.visible&&Ki(Sl[0],t)},xS=()=>{let t=mt[16];t.active&&Sl[1].transform.visible&&Ki(Sl[1],t)};var yu=[],Dd,bu,wS,MS=()=>{bu=Yt.pointlights.data.lightCols,Dd=Yt.pointlights.data.lightPos,wS=Yt.pointlights.data.lightCount},FS=t=>{let e=[0,0,0],n=[];for(let s=0,o=yu.length;s<o;++s){let r=yu[s];r.remove?(yu.splice(s,1),--s,--o):r.transform.visible&&(X(e,r.transform.worldMatrix[12],r.transform.worldMatrix[13],r.transform.worldMatrix[14]),r.distance=ei(gt.worldPosition,e),r.distance<Lv&&n.push(r))}n.sort((s,o)=>s.distance-o.distance);let i=Math.min(n.length,16);for(let s=0;s<i;++s){let o=n[s],r=s*4,l=s*3;Dd[l]=o.transform.worldMatrix[12],Dd[l+1]=o.transform.worldMatrix[13],Dd[l+2]=o.transform.worldMatrix[14],bu[r]=o.value[0],bu[r+1]=o.value[1],bu[r+2]=o.value[2],bu[r+3]=o.value[3]}wS[0]=i,si(Yt.pointlights)},CS=(t,e,n)=>{let i={transform:n,distance:0,remove:!1,value:[...t,e]};return yu.push(i),i},SS=t=>{yu.length=0};var Al=[Wc(1,1),Wc(1,1)],rc=!1,AS=0,PS=t=>{AS=t},ku=t=>{rc=t},TS=t=>{let n=[du,hu],i=[5,20,20];for(let s=0;s<Al.length;++s){let o=Al[s],r=n[s],l=[0,0,0];Sm(l,1,1,1,o.transform.worldMatrix);let a=[...Ht.position],c=i[s];for(let g=0;g<3;++g)a[g]=Math.floor(a[g]/c)*c;let f=(Math.abs(Math.cos(-1))+Math.abs(Math.sin(-1)))*r,u=r,m=[u,f,f];for(let g=0;g<3;++g){let v=m[g]*2/AS,_=a[g]*l[g];_=_-_%v,_=_/l[g],a[g]=_}k_(o.transform.position,a)||(st(o.transform.position,a),X(o.transform.rotation,-1,0,0),o.far=f,o.near=-1e3,C_(o,-u,u,-f,f),da(o,!0),Im(o),rc=!0)}if(rc){let s=Yt.shadows.data;So(s.shadowRange,[du,Ev,hu],0),So(s.shadowPVMatrix,Al[0].projectionViewMatrix,0),So(s.shadowPVMatrix,Al[1].projectionViewMatrix,16),si(Yt.shadows)}return rc?1:0};var Vd=new Map,Ld=[],qd=[],Rd=[],zd=[],Bd=[],to=(t,e,n,i)=>{let s=t<<1|e;if(s=s<<1|n,s=s<<1|i,Vd.has(s))return jv(Vd.get(s));{let o=Eq(t,e,n,i);return Vd.set(s,o),jv(o)}},IS=(t,e,n,i)=>{t?e?qd.push(i):Rd.push(i):Ld.push(i),n===2?(ku(!0),zd.push(i)):n===1&&(ku(!0),Bd.push(i))},Eq=(t,e,n,i)=>{let s=bs.get(t),o=mg[s.shader],r=mt[o],l=re.shadows&&e?s.texture?1:2:0,a=aS(o,N.TRIANGLES,r.instancedAttributes,l,n,i);a.cullFace=s.cull?N.BACK:N.NONE;let c=!1,f=!1;return s.texture?gi(s.texture,u=>{f=!0,a.uniformData.diffuse=u,c&&IS(r.transparent,r.depthWrite,re.shadows&&e?n?2:1:0,a)}):f=!0,Ko(s.geometry,u=>{uS(a,u),c=!0,f&&IS(r.transparent,r.depthWrite,re.shadows&&e?n?2:1:0,a)}),a},DS=()=>{Vd.forEach(fS)};var VS=[{fun:(t,e,n)=>{eo(e[0],t.transform.worldMatrix,e[1],e[2],e[3],e[4],e[5],e[6],!1)}},{fun:(t,e,n)=>{let i=e[1],s=Math.PI*2/i;for(let o=0;o<i;++o){let r=Math.sin(o*s),l=Math.cos(o*s);eo(e[0],t.transform.worldMatrix,r*e[6]+e[2],e[3],l*e[6]+e[4],r*e[5],0,l*e[5],!1)}}},{fun:(t,e,n)=>{for(let i=0;i<e[1];++i)eo(e[0],t.transform.worldMatrix,e[2],e[3],e[4],Zt(e[5],e[6]),Zt(e[7],e[8]),Zt(e[9],e[10]),!1)}},{fun:(t,e,n)=>{Js(e[0],t.transform,t.priority,!1,1)}}];var Hv=[{create:(t,e)=>CS([e[0],e[1],e[2]],e[3],t.transform),tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{n.remove=!0},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,i,s)=>{let o=Ma[e[2]](s);n.value[3]=e[0]+o*(e[1]-e[0])}]},{create:(t,e)=>[0,0,0,0],tick:(t,e,n,i,s)=>{n[0]>=e[1]&&(n[0]=0,eo(e[0],t.transform.worldMatrix,Zt(e[2],e[3])+n[1],Zt(e[4],e[5])+n[2],Zt(e[6],e[7])+n[3],Zt(e[8],e[9]),Zt(e[10],e[11]),Zt(e[12],e[13]),!1)),n[0]+=~~(i*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,i,s)=>{let o=e[1]*s;n[1]=Math.sin(o)*e[0],n[3]=Math.cos(o)*e[0]}]},{create:(t,e)=>{if(oc>0)return eo(e[0],t.transform.worldMatrix,0,0,0,0,0,0,!0)},tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{n.start=1,n.end=1},show:(t,e,n)=>{},hide:(t,e,n)=>{n.pos[0]=-1e3},modifiers:[(t,e,n,i,s)=>{let o=e[1]*s;Rr(n.pos,Math.sin(o)*e[0],0,Math.cos(o)*e[0],t.transform.worldMatrix)},(t,e,n,i,s)=>{Rr(n.pos,e[0],e[1],e[2],t.transform.worldMatrix)}]},{create:(t,e)=>Js(e[0],t.transform,t.priority,!0,1),tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{n.stop()},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>{let n=to(e[0],!1,!0,!0);return X(n.position,e[1],e[2],e[3]),X(n.scale,e[4],e[5],e[6]),X(n.rotation,e[7],e[8],e[9]),Cn(n,t.transform),Rt(n,!1),n},tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{ws(n.data.multi,n)},show:(t,e,n)=>{n.visible=!0},hide:(t,e,n)=>{n.visible=!1},modifiers:[(t,e,n,i,s)=>{let o=e[1]*s;n.rotation[1]=e[2]+o,n.position[0]=Math.sin(o)*e[0],n.position[2]=Math.cos(o)*e[0],n.matrixNeedsUpdate=!0,Rt(n,!1)},(t,e,n,i,s)=>{let o=n.data.multi.instancedAttributes[e[0]];for(let r=0;r<o.size;++r)n.data[o.name][r]=e[1+r]},(t,e,n,i,s)=>{let o=n.data.multi.instancedAttributes[e[0]];for(let r=0;r<o.size;++r){let l=e[1+r],a=e[5+r];n.data[o.name][r]=l+s*(a-l)}},(t,e,n,i,s)=>{let o=Ma[e[6]](s);n.scale[0]=e[0]+o*(e[3]-e[0]),n.scale[1]=e[1]+o*(e[4]-e[1]),n.scale[2]=e[2]+o*(e[5]-e[2]),n.matrixNeedsUpdate=!0},(t,e,n,i,s)=>{let o=Ma[e[6]](s);n.rotation[0]=e[0]+o*(e[3]-e[0]),n.rotation[1]=e[1]+o*(e[4]-e[1]),n.rotation[2]=e[2]+o*(e[5]-e[2]),n.matrixNeedsUpdate=!0}]},{create:(t,e)=>pS(e[0],t.transform,[e[1],e[2],e[3]],[e[4],e[5],e[6]],0,0),tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{n.detach()},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,i,s)=>{let o=e[1]*s;n.b[0]=n.a[0]=Math.sin(o)*e[0],n.b[2]=n.a[2]=Math.cos(o)*e[0]}]},{create:(t,e)=>{if(oc<e[1])return;let n=[];for(let i=0;i<e[1];++i)n.push(eo(e[0],t.transform.worldMatrix,0,0,0,0,0,0,!0));return n},tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{for(let i=0;i<n.length;++i){let s=n[i];s.start=s.end=1}},show:(t,e,n)=>{},hide:(t,e,n)=>{for(let i=0;i<n.length;++i){let s=n[i];s.pos[0]=-1e3}},modifiers:[(t,e,n,i,s)=>{let o=n.length,r=6.283/o,l=e[0],a=e[1]*s;for(let c=0;c<o;++c){let f=n[c],u=r*c+a;Rr(f.pos,Math.sin(u)*l,0,Math.cos(u)*l,t.transform.worldMatrix)}}]},{create:(t,e)=>[0,0],tick:(t,e,n,i,s)=>{if(n[0]>=e[6]){n[0]=0;let o=e[1],r=Math.PI*2/o;for(let l=0;l<o;++l)eo(e[0],t.transform.worldMatrix,e[2],e[3],e[4],Math.sin(l*r+n[1])*e[5],0,Math.cos(l*r+n[1])*e[5],!1)}n[0]+=~~(i*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,i,s)=>{n[1]=e[0]*s}]},{create:(t,e)=>[0],tick:(t,e,n,i,s)=>{if(n[0]>=e[1]){n[0]=0;let o=rn();X(o.rotation,Zt(e[8],e[9]),Zt(e[10],e[11]),Zt(e[12],e[13])),Gv(e[0],o,t.priority,!0),Rr(o.position,Zt(e[2],e[3]),Zt(e[4],e[5]),Zt(e[6],e[7]),t.transform.worldMatrix),uo(o,!1)}n[0]+=~~(i*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>{let n=Math.sin(t.transform.rotation[1])*Math.cos(t.transform.rotation[0])*e[0],i=-Math.sin(t.transform.rotation[0])*e[0],s=Math.cos(t.transform.rotation[1])*Math.cos(t.transform.rotation[0])*e[0],o=t.info.duration,r=o;if(e[1]){let l=V.raycastEnvironmentClosest(t.transform.position[0],t.transform.position[1],t.transform.position[2],n*o,i*o,s*o);l<1&&(r=o*l)}return[n,i,s,r]},tick:(t,e,n,i,s)=>{if(e[1]&&(n[3]-=i,n[3]<=0)){t.done=!0;return}t.transform.position[0]+=n[0]*i,t.transform.position[1]+=n[1]*i,t.transform.position[2]+=n[2]*i,t.transform.matrixNeedsUpdate=!0,Rt(t.transform,!1)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>[],tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{let i=rn();st(i.position,t.transform.position),st(i.rotation,t.transform.rotation),Gv(e[0],i,t.priority,!0),uo(i,!1)},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]}],Gv,LS=t=>{Gv=t};var Ei=[],Pl=[],Tl=[],xu=[],qS=(t,e)=>{let n=Iv;qq(t,e,n),Rq(t,e,n),zq(t,e,n),Bq(t,e),Uq(t,e),Oq(t,e);for(let i=0;i<Ei.length;++i){let s=Ei[i],o=s.visible!==s.transform.visible;if(s.visible=s.transform.visible,s.visible)for(let r=0;r<s.info.events.length;++r){let l=s.info.events[r];(s.loops===0||l.fraction>0)&&s.fractionLast<=l.fraction&&s.fractionNow>l.fraction&&VS[l.id].fun(s,l.params,t)}for(let r=0;r<s.info.periods.length;++r){let l=s.info.periods[r],a=Hv[l.id],c=s.periodData[r]!==void 0,f=s.fractionNow>=l.fractionStart&&s.fractionNow<=l.fractionEnd,u=!1;if(s.visible&&f&&!c&&s.fractionLast<=l.fractionStart&&(c=(s.periodData[r]=a.create(s,l.params,t))!==void 0,u=c),f&&c&&(o&&(s.visible?a.show(s,l.params,s.periodData[r]):a.hide(s,l.params,s.periodData[r])),s.visible)){let m=s.periodData[r],g=(s.fractionNow-l.fractionStart)/(l.fractionEnd-l.fractionStart);a.tick(s,l.params,m,t,g);for(let v=0;v<l.modifiers.length;++v){let _=l.modifiers[v];(u||o||_.mode===1)&&a.modifiers[_.id](s,_.params,m,t,g)}}!f&&c&&(a.end(s,l.params,s.periodData[r]),s.periodData[r]=void 0)}s.visible&&s.returnTransform&&s.transform.parent===null&&Rt(s.transform,!1)}},Yv=[],Xv=(t,e,n,i)=>Yv.length>0?Vq(Yv.pop(),t,e,n,i):Dq(t,e,n,i),Dq=(t,e,n,i)=>({info:t,priority:n,transform:e,returnTransform:i,visible:!0,fractionNow:0,fractionLast:0,timeEnd:0,periodData:[],done:!1,loops:0}),Vq=(t,e,n,i,s)=>(t.info=e,t.priority=i,t.transform=n,t.returnTransform=s,t),Lq=t=>(t.visible=!0,t.fractionNow=0,t.fractionLast=0,t.timeEnd=0,t.periodData.length=0,t.done=!1,t.loops=0,t),Ud=t=>{$q(t),t.returnTransform&&ms(t.transform),Yv.push(Lq(t))},Ms=(t,e,n,i)=>{let s=If.get(t),o=Xv(s,e,n,i);return Ei.push(o),Pl.push(o),o},Ui=(t,e,n,i)=>{let s=If.get(t),o=Xv(s,e,n,i);return Ei.push(o),Tl.push(o),o},RS=(t,e,n,i)=>{let s=If.get(t),o=Xv(s,e,n,i);return Ei.push(o),xu.push(o),o},qq=(t,e,n)=>{for(let i=0;i<Pl.length;++i){let s=Pl[i];s.info.duration===0?s.timeEnd===0?(s.timeEnd=e+s.info.duration,s.fractionLast=0,s.fractionNow=.999):(s.fractionLast=0,s.fractionNow=1):(s.timeEnd===0&&(s.timeEnd=e+s.info.duration),s.fractionLast=s.fractionNow,s.fractionNow=vt(1-(s.timeEnd-e)/s.info.duration,0,1))}},Rq=t=>{for(let e=0;e<Tl.length;++e){let n=Tl[e];n.fractionLast=n.fractionNow,n.fractionNow=(n.fractionNow+t/n.info.duration)%1,n.fractionLast>n.fractionNow&&(n.fractionLast=0,n.loops++)}},zq=(t,e,n)=>{},Bq=(t,e,n)=>{let i=Pl.length;for(;i--;){let s=Pl[i];(s.fractionNow===1||s.done)&&(Pl.splice(i,1),Ei.splice(Ei.indexOf(s),1),Ud(s))}},Uq=(t,e,n)=>{let i=Tl.length;for(;i--;){let s=Tl[i];s.done&&(Tl.splice(i,1),Ei.splice(Ei.indexOf(s),1),Ud(s))}},Oq=(t,e,n)=>{let i=xu.length;for(;i--;){let s=xu[i];s.done&&(xu.splice(i,1),Ei.splice(Ei.indexOf(s),1),Ud(s))}},$q=t=>{for(let e=0;e<t.info.periods.length;++e){let n=t.info.periods[e],i=Hv[n.id];t.periodData[e]!==void 0&&(i.end(t,n.params,t.periodData[e]),t.periodData[e]=void 0)}},zS=t=>{for(let e=0;e<Ei.length;++e)Ud(Ei[e]);Ei.length=0,Pl.length=0,Tl.length=0,xu.length=0};LS(Ms);var lc=[0,2,2.3],ac=[0,0,0];Jn(lc,lc);var cn={},Nd=["fog","sun","direct","ambient","skytop","skymid","skybot","horizon","water","clouds"],jd=["bloom"];for(let t=0;t<Nd.length;++t)cn[Nd[t]]=[[.5,.5,.5],[.5,.5,.5],[.5,.5,.5]];for(let t=0;t<jd.length;++t)cn[jd[t]]=[0,0,0];var BS=(t,e,n,i)=>{Gq(),Xq(t,n,e),Hq(),e>0&&Yq(e,i),si(Yt.sky),si(Yt.environment);let s=Yt.environment.data;N.clearColor(s.fog[0],s.fog[1],s.fog[2],1)},jq=(t,e,n,i,s,o,r)=>{let l=[0,0,0],a=[0,0,0];pa(l,e,n,o),pa(a,i,s,o),pa(t,l,a,r)},Wq=(t,e,n,i,s,o)=>{let r=Mf(s,t,e),l=Mf(s,n,i);return Mf(o,r,l)},no=(t,e,n,i,s)=>{let o=[0,0,0],r=[0,0,0];hn(o,n,1-s),hn(r,i,s),t[e]=o[0]+r[0],t[e+1]=o[1]+r[1],t[e+2]=o[2]+r[2]},Gq=()=>{let t=Ht.position[0],e=Ht.position[2],n=t,i=e,s=t+32,o=e+32,r=qa.get(V.getEnvironmentId(n,i)),l=qa.get(V.getEnvironmentId(s,i)),a=qa.get(V.getEnvironmentId(n,o)),c=qa.get(V.getEnvironmentId(s,o));if(!r||!l||!a||!c)return;let f=t/32%1,u=e/32%1;for(let m=0;m<Nd.length;++m){let g=Nd[m];for(let v=0;v<3;++v)jq(cn[g][v],r[g][v],l[g][v],a[g][v],c[g][v],f,u)}for(let m=0;m<jd.length;++m){let g=jd[m];for(let v=0;v<3;++v)cn[g][v]=Wq(r[g][v],l[g][v],a[g][v],c[g][v],f,u)}},Hq=()=>{let t=Yt.environment.data.watercolors;for(let e=0;e<9;++e)t[e]=cn.water[Math.floor(e/3)][e%3]},Yq=(t,e)=>{let n=Yt.environment.data.worldlight,i=[0,0,0],s=Math.max(0,1-t/80),o=Math.min(1,1-s);no(i,0,cn.water[1],cn.water[2],o);let r=[0,0,0];r[0]=(n[0]+n[3])*i[0]*1.5,r[1]=(n[1]+n[4])*i[1]*1.5,r[2]=(n[2]+n[5])*i[2]*1.5;let l=Yt.sky.data.skycolors,a=Yt.sky.data.suncolor,c=Yt.environment.data.worldlight,f=Yt.environment.data.fog,u=Math.max(.2,.5*s),m=Math.min(.4,Math.max(.1,.5*s)),g=Math.max(.3,.7*s);for(let v=0;v<15;++v)l[v]=u*r[v%3];X(f,u*r[0],u*r[1],u*r[2]),st(a,f);for(let v=0;v<9;++v)Yt.environment.data.watercolors[v]=m;for(let v=0;v<6;++v)c[v]=g*r[v%3]},Od=0,Eo=1,$d=2,Wd=[{from:Eo,to:Od,start:0,end:0,dur:0},{from:Od,to:Od,start:0,end:0,dur:0},{from:Od,to:Eo,start:0,end:0,dur:0},{from:Eo,to:Eo,start:0,end:0,dur:0},{from:Eo,to:$d,start:0,end:0,dur:0},{from:$d,to:$d,start:0,end:0,dur:0},{from:$d,to:Eo,start:0,end:0,dur:0},{from:Eo,to:Eo,start:0,end:0,dur:0}],US=0;Wd.forEach(t=>{let e=t.from!==t.to,n=!e&&t.from!==Eo;e?t.dur=.5:n?t.dur=5:t.dur=1.5,US+=t.dur});var Qv=0;Wd.forEach(t=>{t.start=Qv,Qv=t.end=Qv+1/US*t.dur});var Xq=(t,e,n)=>{t=vt(t,0,1);let i=.5,s=0,o=0;for(let a=0;a<Wd.length;++a){let c=Wd[a];if(c.end>=t){i=wf(c.start,c.end,t),s=c.from,o=c.to;break}}let r=Yt.sky.data;no(r.skycolors,0,cn.skytop[s],cn.skytop[o],i),no(r.skycolors,3,cn.skymid[s],cn.skymid[o],i),no(r.skycolors,6,cn.skybot[s],cn.skybot[o],i),no(r.skycolors,9,cn.horizon[s],cn.horizon[o],i),no(r.skycolors,12,cn.clouds[s],cn.clouds[o],i),no(r.suncolor,0,cn.sun[s],cn.sun[o],i),st(ac,lc),ac[1]=Math.abs(Math.sin(t*6.282)),Jn(ac,ac);let l=Yt.environment.data;no(l.worldlight,0,cn.direct[s],cn.direct[o],i),no(l.worldlight,3,cn.ambient[s],cn.ambient[o],i),l.worldlight[6]=lc[0],l.worldlight[7]=lc[1],l.worldlight[8]=lc[2],no(l.fog,0,cn.fog[s],cn.fog[o],i),l.fog[3]=n>0?-100:Pv,l.fog[4]=n>0?Tv:ss,l.daycycle[0]=t,l.time[0]=e%3600,mt[31].uniforms.amount.value=Mf(i,cn.bloom[s],cn.bloom[o])};var Qq=[],Zq=[],$S=(t,e)=>{if(gn===void 0||gn.suspended)return;let n=gn.currentTime,i=Df.get(V.getAreaId(Ht.position[0],Ht.position[2])),o=t>.5?i.ambientnight:i.ambientday,r=5;e>0&&(o=167,r=.5),OS(Qq,n,r,o,!1),OS(Zq,n,5,i.music,!0)},OS=(t,e,n,i,s)=>{let o=!1;for(let r=t.length-1;r>=0;--r){let l=t[r],a=l.sound,c=a.gain.gain;l.id===i&&!a.ended?(o=!0,l.fade!==1&&(l.fade=1,c.setTargetAtTime(1,e,n))):c.value<.02||a.ended?(a.stop(),t.splice(r,1)):l.fade!==0&&(l.fade=0,c.setTargetAtTime(0,e,l.fadeDuration))}if(!o&&i!==0){let r=s?uy(i,3):fy(i,2);r&&(r.gain.gain.setValueAtTime(0,e),t.push({id:i,sound:r,fade:0,fadeDuration:n}))}};var Io=[0,0,0,0],NS=(t,e,n,i)=>{if(V.player&&V.player.buffs.buffs.has(128))Io[0]=.2,Io[1]=.4,Io[2]=.4,Io[3]=.7,i.add(33),mt[33].uniforms.warp.value=.1,mt[31].uniforms.amount.value=3;else if(e>0){let s=Yt.environment.data.fog;Io[0]=s[0],Io[1]=s[1],Io[2]=s[2],Io[3]=.5,i.add(33),mt[33].uniforms.warp.value=.3,mt[31].uniforms.amount.value=Math.min(3,Math.max(.3,e/10))}mt[33].uniforms.tint.value=Io};var jS=()=>{},Gd=0,Hd=t=>Gd=t,WS=(t,e,n)=>{let i=(e/3600+.9)%1;i<.7?i=wf(0,.7,i)*.4:i=.4+wf(.7,1,i)*.6,BS(i,Gd,e,n),NS(i,Gd,e,n),$S(i,Gd)};var wu=()=>[-0,-0,-0,-0,-0,-0],io=wu();var GS=(t,e)=>!(t[3]<e[0]||t[0]>e[3]||t[4]<e[1]||t[1]>e[4]||t[5]<e[2]||t[2]>e[5]),Kq=(t,e,n,i,s)=>(t[0]=e[0],t[3]=e[0]+n,t[1]=e[1],t[4]=e[1]+i,t[2]=e[2],t[5]=e[2]+s,t);var HS=(t,e)=>{t[0]=t[1]=t[2]=1/0,t[3]=t[4]=t[5]=-1/0;for(let n=0;n<e.length;++n){let i=e[n];t[0]=Math.min(t[0],i[0]),t[3]=Math.max(t[3],i[0]),t[1]=Math.min(t[1],i[1]),t[4]=Math.max(t[4],i[1]),t[2]=Math.min(t[2],i[2]),t[5]=Math.max(t[5],i[2])}return t};var Yd=(t,e,n,i,s)=>(X(bt,e[0]-n/2,e[1]-i/2,e[2]-s/2),Kq(t,bt,n,i,s));var YS=(t,e,n,i,s)=>{let o=(t[0]-e[0])*n[0],r=(t[1]-e[1])*n[1],l=(t[2]-e[2])*n[2],a=(t[3]-e[0])*n[0],c=(t[4]-e[1])*n[1],f=(t[5]-e[2])*n[2],u=Math.max(i,Math.min(o,a),Math.min(r,c),Math.min(l,f)),m=Math.min(s,Math.max(o,a),Math.max(r,c),Math.max(l,f));return!(m<0||u>m)};var XS=(t,e,n)=>{let i=[0,0,0];for(let s=0;s<6;++s){let o=e[s],r=n[s];if(o[0]>0?i[0]=t[3]:i[0]=t[0],o[1]>0?i[1]=t[4]:i[1]=t[1],o[2]>0?i[2]=t[5]:i[2]=t[2],dn(o,i)+r<0)return!1}return!0};var Xd=class{constructor(){this.id=0,this.pos=[-0,-0,-0],this.rot=[-0,-0,-0],this.scale=1,this.matrix=void 0,this.loaded=!1}setWorldMatrix(e,n){this.matrix=e,zn(bt,n,this.pos),pi(kn,this.scale),Am(yo,this.rot),Fm(this.matrix,yo,bt,kn)}loadGeometry(e,n){if(!this.loaded){let i=bs.get(this.id);this.loaded=!0,i.geometry===0?this.postGeometryLoad(e,n):Ko(i.geometry,(s,o)=>{let r=!e.finishedLoadingChunks.has(n.id);this.addMesh(e,n),r&&this.addCollider(e,n,s,o),this.postGeometryLoad(e,n)})}}onUpdate(e,n,i){}addMesh(){}postGeometryLoad(e,n){n.loadingProps--}handleColliderGeometry(e,n,i,s){let o=this.matrix,r=i.position,l=i.color,a=i.flags;for(let c=0,f=n.length;c<f;c+=3){let u=n[c],m=n[c+1],g=n[c+2],v=Zv(u*3,s,r,o),_=Zv(m*3,s,r,o),b=Zv(g*3,s,r,o),y=[v,_,b],k=HS(wu(),y);if(a[u]&1&&a[m]&1&&a[g]&1){if(y.push(Uf([0,0,0],v,_,b)),l.length){let A=[(l[u*4+0]+l[m*4+0]+l[g*4+0])/3,(l[u*4+1]+l[m*4+1]+l[g*4+1])/3,(l[u*4+2]+l[m*4+2]+l[g*4+2])/3,(l[u*4+3]+l[m*4+3]+l[g*4+3])/3];y.push(A)}e.triangleGrid.add(y,k)}}}addCollider(e,n,i,s){let o=new Map;this.handleColliderGeometry(e,s.index,s,o),this.handleColliderGeometry(e,s.indexInvisible,s,o)}onRemove(){}},Zv=(t,e,n,i)=>{if(e.has(t))return e.get(t);{let s=[n[t],n[t+1],n[t+2]];return Mi(s,s,i),e.set(t,s),s}};var Qd=class extends Xd{constructor(){super(),this.mesh=void 0,this.effects=[],this.isEffectProp=!1,this.effectsCreated=!1}onUpdate(e,n,i){this.mesh!==void 0&&this.updateMesh(n),super.onUpdate(e,n,i)}updateMesh(e){this.setWorldMatrix(this.mesh.worldMatrix,e),zn(this.mesh.position,e,this.pos),X(this.mesh.rotation,this.rot[0],this.rot[1],this.rot[2]),pi(this.mesh.scale,this.scale),this.mesh.data.multi&&(this.mesh.data.multi.needsUpdate=!0)}onRemove(e){super.onRemove(e),bs.get(this.id).effects.length&&this.deleteEffects(),this.mesh&&(this.mesh.data.multi?ws(this.mesh.data.multi,this.mesh):ms(this.mesh),this.mesh=void 0)}addMesh(e,n){if(this.mesh===void 0){let i=bs.get(this.id);this.mesh=to(this.id,i.shadow,!1,!0),this.mesh.visible=!1,this.updateMesh(n.origin),i.effects.length&&(this.isEffectProp=!0)}}onChunkRebuild(e){this.mesh&&this.mesh.data&&this.mesh.data.interiorlight&&V.getInteriorLight(this.mesh.data.interiorlight,Yd(io,this.mesh.position,3,3,3))}createEffects(){if(this.isEffectProp=!0,!this.effectsCreated){let e=bs.get(this.id).effects;for(let n=0;n<e.length;++n){let i=e[n],s=rn();st(s.position,i.pos),st(s.scale,i.scale),st(s.rotation,i.rot),Cn(s,this.mesh),Rt(s,!0);let o=Ui(i.id,s,0,!0);this.effects.push(o)}this.effectsCreated=!0}}deleteEffects(){if(this.effectsCreated){for(let e=0;e<this.effects.length;++e)this.effects[e].done=!0;this.effects.length=0,this.effectsCreated=!1}}setVisible(e){this.mesh.visible!==e&&(this.mesh.visible=!0,this.mesh.data.multi.needsUpdate=!0)}setEffectVisible(e){this.isEffectProp&&this.effectsCreated!==e&&(e?this.createEffects():this.deleteEffects())}};var ZS=(t,e,n)=>{e[n]=(t&31)*8,e[n+1]=(t>>5&31)*8,e[n+2]=(t>>10&31)*8},QS=65536/64,eR=2147483647/2e3,Jv=65536/(Math.PI*2),tR=65536/100;var JS=(t,e)=>(t.id=e.id,X(t.pos,e.x/QS,e.y/eR,e.z/QS),X(t.rot,e.rx/Jv,e.ry/Jv,e.rz/Jv),t.scale=Math.max(e.scale,100)/tR,t);var KS=(t,e,n,i)=>{t.id=e,t.x=n,t.z=i,t.origin[0]=n*64,t.origin[2]=i*64,t.deserialized=!1,t.props.length=0,t.data=void 0,t.loadingProps=0},e8=(t,e)=>{t.data=e,t8(t),nR(t,!0),t.deserialized=!0},Fs=(t,e,n)=>{e/=2.6666666666666665,n/=2.6666666666666665;let i=e%1,s=n%1;if(i===0&&s===0)return t.data.terrain[e+25*n]*.030517578125;{let o=Math.floor(e),r=Math.floor(n),l=i+s<1,a=t.data.terrain[o+25*r+(l?0:1)],c=t.data.terrain[o+25*Math.min(24,r+1)],f=t.data.terrain[o+1+25*(r+(l?0:1))],u=l?-(i-1+s):-(s-1),m=l?s:-(i-1),g=1-u-m;return(u*a+m*c+g*f)*.030517578125}},Fu=(t,e,n)=>{if(t.data.holes.length===0)return!1;e/=2.6666666666666665,n/=2.6666666666666665;let i=Math.floor(e)+Math.floor(n)*24;return t.data.holes.indexOf(i)>=0},Cu=(t,e,n)=>{if(t.data.water.length===0)return-1;e/=64,n/=64;let i=e%1,s=n%1;if(i===0&&s===0)return t.data.water[e+2*n]*.030517578125;{let o=Math.floor(e),r=Math.floor(n),l=i+s<1,a=t.data.water[o+2*r+(l?0:1)],c=t.data.water[o+2*Math.min(2-1,r+1)],f=t.data.water[o+1+2*(r+(l?0:1))],u=l?-(i-1+s):-(s-1),m=l?s:-(i-1),g=1-u-m;return(u*a+m*c+g*f)*.030517578125}};var Kv=(t,e,n)=>{e/=16,n/=16;let s=Math.floor(e)+Math.floor(n)*4;return t.data.area[s]||0},e2=(t,e,n)=>{e/=32,n/=32;let s=Math.floor(e)+Math.floor(n)*2;return t.data.environment[s]||0},t8=t=>{let e=[-0,-0,-0];for(let n=0;n<24;++n)for(let i=0;i<24;++i){let s=(i*2+24*n*2)*3,o=i*2.6666666666666665,r=n*2.6666666666666665;X(ds,o,Fs(t,o,r),r),X(_p,o,Fs(t,o,r+2.6666666666666665),r+2.6666666666666665),X(xf,o+2.6666666666666665,Fs(t,o+2.6666666666666665,r),r),Uf(e,ds,_p,xf),t.normals[s]=e[0],t.normals[s+1]=e[1],t.normals[s+2]=e[2],X(ds,o+2.6666666666666665,Fs(t,o+2.6666666666666665,r),r),X(xf,o+2.6666666666666665,Fs(t,o+2.6666666666666665,r+2.6666666666666665),r+2.6666666666666665),Uf(e,ds,_p,xf),t.normals[s+3]=e[0],t.normals[s+4]=e[1],t.normals[s+5]=e[2]}};var nR=(t,e)=>{for(let n=0,i=t.data.props.length;n<i;++n){let s=t.data.props[n],o=JS(new Qd,s);t.props.push(o),e&&t.loadingProps++}for(let n=0;n<t.props.length;++n){let i=t.props[n];i.onUpdate(V,t.origin,V.bounds),i.loadGeometry(V,t)}},iR=t=>{for(let e=0;e<t.props.length;++e)t.props[e].onRemove(t);t.props.length=0},n8=t=>{iR(t)},i8=(t,e)=>Math.floor(t%64/32)+Math.floor(e%64/32)*2,s8=(t,e)=>Math.floor(t%32*3)+Math.floor(e%32*3)*96;var Su=1,Zd=t=>{Su=t%2147483647,Su<=0&&(Su+=2147483646),El(),El()},El=()=>Su=Su*16807%2147483647,Au=()=>(El()-1)/2147483647,cc=(t,e)=>Au()*(e-t)+t;var Kd,e0,t0,Oi=[0,0,0],fc,uc,mc,sR=[21,56,50,44,13,19,7,42],n2=3758102380,i2=(t,e)=>t>>e&1,wr=(t,e,n,i)=>sR[i2(t,i)<<2|i2(e,i)<<1|i2(n,i)],Jd=t=>{let e=(Oi[0]+Oi[1]+Oi[2])/6,n=fc-Oi[0]+e,i=uc-Oi[1]+e,s=mc-Oi[2]+e,o=.6-n*n-i*i-s*s,r=oR(Kd+Oi[0],e0+Oi[1],t0+Oi[2]);if(Oi[t]++,o<0)return 0;let l=r>>5&1,a=r>>4&1,c=r>>3&1,f=r>>2&1,u=r&3,m=u===1?n:u===2?i:s,g=u===1?i:u===2?s:n,v=u===1?s:u===2?n:i;return m=l===c?-m:m,g=l===a?-g:g,v=l!==(a^c)?-v:v,o*=o,8*o*o*(m+(u===0?g+v:f===0?g:v))},oR=(t,e,n)=>wr(t,e,n,0)+wr(e,n,t,1)+wr(n,t,e,2)+wr(t,e,n,3)+wr(e,n,t,4)+wr(n,t,e,5)+wr(t,e,n,6)+wr(e,n,t,7),r8=(t,e,n)=>{let i=t+n2,s=e+n2,o=n+n2,r=(i+s+o)/3;Kd=Math.floor(i+r),e0=Math.floor(s+r),t0=Math.floor(o+r),r=(Kd+e0+t0)/6,fc=i-Kd+r,uc=s-e0+r,mc=o-t0+r,Oi[0]=Oi[1]=Oi[2]=0;let l=fc>=mc?fc>=uc?0:1:uc>=mc?1:2,a=fc<mc?fc<uc?0:1:uc<mc?1:2;return Jd(l)+Jd(3-l-a)+Jd(a)+Jd(0)};var l8=t=>{let e=0,n=0,i=0;for(let u=0;u<t.nodes.length;++u){let m=t.nodes[u],g=m.leafCount,v=m.points.length/2;e+=v*3*g,n+=v*2*g,i+=Math.max(0,(v-2)*3)*g,m.geotype===1&&(i+=3*g*Math.min(1,m.points.length))}let s=new Float32Array(e),o=new Float32Array(n),r=new Uint32Array(i);Zd(t.seed);let l=0,a=0,c=0,f=0;for(let u=0;u<t.nodes.length;++u){let m=t.nodes[u],g=m.start,v=m.end,_=Math.atan2(v[1]-g[1],v[0]-g[0]),{geotype:b,leafCount:y,y:k,radius:A,slant:S,size:F,arc:M,jitter_slant:D,jitter_size:R,jitter_rotation:E,jitter_radius:L,jitter_y:z}=m,q=m.points.length/2,j=Math.PI*2/(y===2?4:y);for(let W=0;W<y;++W){let U=W*j+cc(-E,E),O=S+cc(-D,D),Z=F*cc(1-R,1),ve=A*cc(1-L,1),Fe=k*cc(1-z,1);for(let _e=0;_e<q;++_e){let ce=m.points[_e*2],fe=m.points[_e*2+1],ze=ce-g[0],Pe=fe-g[1],Me=ze*Math.cos(-_)-Pe*Math.sin(-_),be=ze*Math.sin(-_)+Pe*Math.cos(-_),H=0,pe=0,Be=0;if(m.geotype===0){let Ye=O+M*Me;H=Math.sin(Ye)*Me,pe=Math.cos(Ye)*Me,Be=be}else H=Me,pe=M*(Math.abs(Me)+Math.abs(be)),Be=be;let Ge=H*Math.cos(U)-Be*Math.sin(U),Xe=H*Math.sin(U)+Be*Math.cos(U);s[l]=Ge*Z+Math.cos(U)*ve,s[l+1]=Fe+pe*Z,s[l+2]=Xe*Z+Math.sin(U)*ve,o[a]=ce,o[a+1]=1-fe,l+=3,a+=2}if(b===0)for(let _e=0;_e<q-2;++_e)r[c]=f+_e,r[c+1]=f+_e+1,r[c+2]=f+_e+2,c+=3;else for(let _e=0;_e<q-1;++_e){let ce=_e===q-2;r[c]=f,r[c+1]=ce?f+q-1:f+_e+1,r[c+2]=ce?f+1:f+_e+2,c+=3}f+=q}}return Sn({position:{size:3,data:s},uv:{size:2,data:o},index:{type:5125,data:r}})};var c8=Math.floor(64**2*(re.foliage/100)),f8=[],n0=[],u8=[];for(let t=0;t<64*64;++t){let e=Math.max(0,r8(Math.floor(t/64)/7,t%64/7,1));u8.push(e)}for(let t=0;t<8;++t)f8.push(new Float32Array(7*c8)),n0.push([]);var m8=(t,e)=>{if(re.foliage===0||!e)return;aR(t,N),Zd(t.id+1e3);let n=t.geometry.foliage.folIds,i=[],s=t.geometry.foliage.instances,o=[];for(let c=0;c<n.length;++c)i.push(La.get(n[c])),o.push(0);let r=re.foliage,l=!1;t.data.holes.length>0&&(l=!0);let a=[-1,-1,-1,-1];for(let c=0;c<4;++c){let f=t.data.textureid[c];for(let u=0;u<4;++u)f[u]===27&&(a[c]=u)}for(let c=0;c<64;++c)for(let f=0;f<64;++f){if(El()%100>r)continue;let u=c+t.origin[0],m=f+t.origin[2],g=V.getNormal(u,m);if(g[1]<.6||l&&Fu(t,c,f)||Cu(t,c,f)>Fs(t,c,f)+80)continue;let v=i8(c,f),_=s8(c,f),b=t.data.texture[v][_],y=b&31,k=b>>5&31,A=b>>10&31,S=a[v];S>=0&&(S===0&&y>0?y=255:S===1&&k>0?k=255:S===2&&A>0&&(A=255));let F=El()%Math.max(32,y+k+A),M=3;F<y?M=0:F<y+k?M=1:F<y+k+A&&(M=2);let D=t.data.textureid[v][M],R=Va.get(D).foliage,E=u8[u%64+m%64*64];for(let L=0;L<R.length;++L){let z=R[L],q=z[1];if(El()%255>q||z[2]&&E<=0)continue;let j=z[0],W=n.indexOf(j);if(o[W]>=c8||W<0)continue;let U=s[W].attributes.inst.data,O=o[W]*7,Z=Math.max(0,Math.min(64,c-.25+Au()*.5)),ve=Math.max(0,Math.min(64,f-.25+Au()*.5)),Fe=Fs(t,Z,ve);U[O]=Z+t.origin[0],U[O+1]=Fe,U[O+2]=ve+t.origin[2],U[O+3]=z[2]?.5+Math.min(1.4,E*1.5):.5+Au(),U[O+4]=g[0]+.001,U[O+5]=g[1],U[O+6]=g[2],o[W]++}}for(let c=0;c<n.length;++c){let f=s[c],u=o[c];Sp(f,u),hi(f,f.attributes.inst),f.bounds=t.geometry.terrain.bounds}},i0=new Map,s2=new Map,a8=new Set,rR=t=>n0[t].length<1?Sn({inst:{instanced:!0,size:7,data:f8[t]}}):n0[t].pop(),lR=(t,e)=>{n0[t].push(e)},aR=(t,e)=>{if(!t.geometry.foliage){let n=t.geometry.foliage={instances:[],folIds:[]};for(let i=0;i<4;++i){let s=t.data.textureid[i];for(let o=0;o<4;++o){let r=Va.get(s[o]).foliage;for(let l=0;l<r.length;++l)n.folIds.indexOf(r[l][0])<0&&n.folIds.push(r[l][0])}}n.folIds.length>8&&(n.folIds.length=8);for(let i=0;i<n.folIds.length;++i){let s=n.folIds[i];n.instances.push(rR(i));let o=La.get(s);i0.has(o.id)||i0.set(o.id,l8(o)),a8.has(o.texture)||(a8.add(o.texture),gi(o.texture,r=>{Pp(r,16),es(r),s2.set(o.texture,r)}))}}},p8=t=>{if(t.geometry.foliage){for(let e=0;e<t.geometry.foliage.instances.length;++e)lR(e,t.geometry.foliage.instances[e]);t.geometry.foliage=void 0}},d8=(t,e)=>{},h8=t=>{if(!re.foliage)return;let e=3,n=2,i=[],s=[],o=[];for(let r=0,l=t.length;r<l;++r){let a=t[r];if(sS(a.x*2,a.z*2)<Vv){let c=a.geometry.foliage;for(let f=0;f<c.folIds.length;++f){let u=c.folIds[f],m=i.indexOf(u);m<0&&(i.push(u),s.push([]),o.push(La.get(u).type===0?13:14),m=i.length-1),s[m].push(c.instances[f])}}}for(let r=0;r<i.length;++r){let l=La.get(i[r]);if(i0.has(l.id)&&s2.has(l.texture)){let a=o[r],c=mt[a];tt.currentProgram!==c.id&&(N.useProgram(c.program),tt.currentProgram=c.id,Ia(c),Ea(c),s1(c.uniformArray));let f=i0.get(l.id);Aa(f,c),Ln("foliageDiffuse",s2.get(l.texture),0,c),Pf(c);let u=s[r];for(let m=0;m<u.length;++m){let g=u[m];N.bindBuffer(N.ARRAY_BUFFER,g.attributes.inst.buffer),N.vertexAttribPointer(e,3,N.FLOAT,!1,7*4,4*4),N.enableVertexAttribArray(e),ha(e,1),N.vertexAttribPointer(n,4,N.FLOAT,!1,7*4,0),N.enableVertexAttribArray(n),ha(n,1),tt.boundBuffer=g.attributes.inst.id,N.drawElementsInstanced(N.TRIANGLES,f.drawRangeCount,f.attributes.index.type,f.drawRangeStart,g.instancedCount)}}}};var pc=[],dc=[],Mr=new Map,g8=(t,e,n,i,s)=>{let o=V.entity(t),r=V.entity(e);if(n.fx.effectMissile&&o!==void 0&&r!==void 0&&(!o.visual.inFog||!r.visual.inFog)){let l={mId:i,targetid:e,timer:s,effect:Ui(n.fx.effectMissile,rn(),o===V.playerId?1:0,!0),start:zn([0,0,0],zr(bt,[0,0,o.radius],o.rot),o.visualPosition)};l.effect.transform.matrixAutoUpdate=!0,pc.push(l),Mr.set(i,l),_8(l,pc.length-1)}},v8=(t,e,n,i,s,o)=>{if(i.fx.effectMissile){let r={mId:s,timer:o,path:e,fractions:n,currentIndex:0,effect:Ui(i.fx.effectMissile,rn(),t===V.playerId?1:0,!0)};r.effect.transform.matrixAutoUpdate=!0,dc.push(r),Mr.set(s,r),b8(r,dc.length-1)}},_8=(t,e)=>{if(!V.isEntityIdTaken(t.targetid)||t.timer.done(V.smoothtime)){pc.splice(e,1),t.effect.done=!0,Mr.delete(t.mId);return}let n=V.entity(t.targetid),i=Xt(t.effect.transform.position,n.visualPosition,t.start);on(t.effect.transform.position,t.start,i,t.timer.fraction(V.smoothtime));let s=V.getHeight(t.effect.transform.position[0],t.effect.transform.position[2])+.3;s>t.effect.transform.position[1]&&(t.effect.transform.position[1]=s),Ur(t.effect.transform,n.visualPosition,!1,vp),t.timer.passed(V.smoothtime)>.5&&(st(t.start,t.effect.transform.position),t.timer.reset(V.smoothtime,t.timer.end-V.smoothtime)),Rt(t.effect.transform,!1)},b8=(t,e)=>{if(t.timer.done(V.smoothtime)){dc.splice(e,1),t.effect.done=!0,Mr.delete(t.mId);return}let n=Math.max(0,Math.min(1,t.timer.fraction(V.smoothtime)));t.currentIndex=hy(t.effect.transform.position,t.path,n,t.fractions),Rt(t.effect.transform,!1)},y8=()=>{pc.forEach(_8),dc.forEach(b8)},k8=t=>{pc.forEach(e=>{e.effect.done=!0}),dc.forEach(e=>{e.effect.done=!0}),pc.length=0,dc.length=0,Mr.clear()};var os,x8=()=>{os=Ri(void 0,11,N.TRIANGLES),pi(os.transform.scale,40),os.transform.visible=!1,os.transform.matrixAutoUpdate=!0,Ko(1456,t=>{let e=Sn(t);os.geometry=e;let n=Mo(1024,1024,1,!1,N.NONE,N.REPEAT,N.REPEAT);B_(n),Ki(Bf,mt[34]);let i=n.colorTexture;Ln("skyDiffuse",i,0,mt[11]),gi(1748,s=>{os.transform.visible=!0,Ln("cloudDiffuse",s,0,mt[11])})})},w8=()=>{X(os.transform.position,gt.transform.worldMatrix[12],gt.transform.worldMatrix[13],gt.transform.worldMatrix[14]),Rt(os.transform,!1)},M8=()=>{os.transform.visible&&Ki(os,mt[11])};var $i,F8=()=>{$i=Ri(void 0,12,N.TRIANGLES),pi($i.transform.scale,.1),Cn($i.transform,os.transform),$i.transform.visible=!1,Ko(1455,t=>{$i.geometry=Sn(t),$i.transform.visible=!0})},C8=()=>{st($i.transform.position,ac),hn($i.transform.position,$i.transform.position,.45),Ur($i.transform,O_,!1,U_),$i.transform.matrixNeedsUpdate=!0},S8=()=>{$i.transform.visible&&Ki($i,mt[12])};var o0=24,At=o0+1,E8=At**2,o2=new Map,Fr=96,A8=96/12,hc=8,Pu=new Uint8Array(3*Fr**2),r2=new Map,s0=o0/2,P8=3,T8=[1,2,4,8],Il=[0],Kt=[],pR=(t,e,n,i)=>{let s=e+n*At,o=e+(n+i)*At,r=e+(n+i)*At+i,l=e+n*At+i;Kt.push(s),Kt.push(o),Kt.push(l),Kt.push(o),Kt.push(r),Kt.push(l)};for(let t=0;t<2;++t)for(let e=0;e<2;++e)for(let n=0;n<P8;++n){let i=T8[n],s=T8[n+1],o=e*s0,r=(e+1)*s0,l=t*s0,a=(t+1)*s0;for(let c=0;c<(n===P8-1?1:16);++c){let f=1&c,u=2&c,m=4&c,g=8&c,v=o+(f?i:0),_=r-(m?i:0),b=l+(u?i:0),y=a-(g?i:0);for(let k=b;k<y;k+=i)for(let A=v;A<_;A+=i)pR(Kt,A,k,i);if(f){for(let k=l;k<a;k+=s){let A=o+k*At,S=o+(k+s)*At,F=o+(k+i)*At+i;if(Kt.push(A,S,F),k<a-s){let M=F+i*At,D=M+i*At;Kt.push(F,S,M),Kt.push(M,S,D)}}u||Kt.push(o+l*At,o+(l+i)*At+i,o+l*At+i),g||Kt.push(o+a*At,o+a*At+i,o+(a-i)*At+i)}if(u){for(let k=o;k<r;k+=s){let A=k+l*At,S=k+l*At+s,F=k+(l+i)*At+i;if(Kt.push(A,F,S),k<r-s){let M=F+i;Kt.push(F,M,S),Kt.push(M,M+i,S)}}f||Kt.push(o+l*At,o+(l+i)*At,o+(l+i)*At+i),m||Kt.push(r+l*At,r+(l+i)*At-i,r+(l+i)*At)}if(m){for(let k=l;k<a;k+=s){let A=r+k*At,S=r+(k+s)*At,F=r+(k+i)*At-i;if(Kt.push(A,F,S),k<a-s){let M=F+i*At,D=M+i*At;Kt.push(F,M,S),Kt.push(M,D,S)}}u||Kt.push(r+l*At,r+l*At-i,r+(l+i)*At-i),g||Kt.push(r+a*At,r+(a-i)*At-i,r+a*At-i)}if(g){for(let k=o;k<r;k+=s){let A=k+a*At,S=k+a*At+s,F=k+(a-i)*At+i;if(Kt.push(A,S,F),k<r-s){let M=F+i,D=M+i;Kt.push(F,S,M),Kt.push(M,S,D)}}f||Kt.push(o+a*At,o+(a-i)*At+i,o+(a-i)*At),m||Kt.push(r+a*At,r+(a-i)*At,r+(a-i)*At-i)}Il.push(Kt.length)}}var dR={type:N.UNSIGNED_INT,data:new Uint32Array(Kt)},l2=new Float32Array(E8*3),hR=new Float32Array(E8*3);for(let t=0,e=0;t<=o0;++t)for(let n=0;n<=o0;++n,++e)l2[e*3+0]=n*2.6666666666666665,l2[e*3+2]=t*2.6666666666666665;var I8=()=>{},D8=(t,e,n)=>{if(vR(t),e){let i=t.geometry.terrain,s=i.attributes.position.data,o=i.attributes.normal.data;for(let l=0;l<25;++l)for(let a=0;a<25;++a){let c=a+25*l,f=t.data.terrain[c]*.030517578125;s[c*3+1]=f}let r=t.normals;for(let l=0;l<25*25*3;++l)o[l]=0;for(let l=0;l<24;++l)for(let a=0;a<24;++a){let c=(a*2+24*l*2)*3,f=r[c],u=r[c+1],m=r[c+2],g=r[c+3],v=r[c+4],_=r[c+5],b=(a+25*l)*3,y=(a+25*(l+1))*3,k=(a+1+25*l)*3,A=(a+1+25*(l+1))*3;o[b]+=f,o[b+1]+=u,o[b+2]+=m,o[y]+=f+g,o[y+1]+=u+v,o[y+2]+=m+_,o[k]+=f+g,o[k+1]+=u+v,o[k+2]+=m+_,o[A]+=g,o[A+1]+=v,o[A+2]+=_}if(t.z>0){let a=V.getChunk(t.x,t.z-1).normals,c=24-1;for(let f=0;f<24;++f){let u=(f*2+24*c*2)*3,m=a[u],g=a[u+1],v=a[u+2],_=a[u+3],b=a[u+4],y=a[u+5],k=(f+1)*3,A=f*3;o[A]+=m+_,o[A+1]+=g+b,o[A+2]+=v+y,o[k]+=_,o[k+1]+=b,o[k+2]+=y}}if(t.z+1<V.chunkAmount){let a=V.getChunk(t.x,t.z+1).normals,c=0,f=25-1;for(let u=0;u<24;++u){let m=(u*2+24*c*2)*3,g=a[m],v=a[m+1],_=a[m+2],b=a[m+3],y=a[m+4],k=a[m+5],A=(u+25*f)*3,S=(u+1+25*f)*3;o[A]+=g,o[A+1]+=v,o[A+2]+=_,o[S]+=g+b,o[S+1]+=v+y,o[S+2]+=_+k}}if(t.x>0){let a=V.getChunk(t.x-1,t.z).normals,c=24-1;for(let f=0;f<24;++f){let u=(c*2+24*f*2)*3,m=a[u],g=a[u+1],v=a[u+2],_=a[u+3],b=a[u+4],y=a[u+5],k=25*f*3,A=25*(f+1)*3;o[k]+=m+_,o[k+1]+=g+b,o[k+2]+=v+y,o[A]+=_,o[A+1]+=b,o[A+2]+=y}}if(t.x+1<V.chunkAmount){let a=V.getChunk(t.x+1,t.z).normals,c=0,f=25-1;for(let u=0;u<24;++u){let m=(c*2+24*u*2)*3,g=a[m],v=a[m+1],_=a[m+2],b=a[m+3],y=a[m+4],k=a[m+5],A=(f+25*u)*3,S=(f+25*(u+1))*3;o[S]+=g+b,o[S+1]+=v+y,o[S+2]+=_+k,o[A]+=g,o[A+1]+=v,o[A+2]+=_}}for(let l=0;l<25;++l)for(let a=0;a<25;++a){let c=(a+25*l)*3,f=o[c],u=o[c+1],m=o[c+2],g=1/Math.sqrt(f*f+u*u+m*m);o[c]=f*g,o[c+1]=u*g,o[c+2]=m*g}hi(i,i.attributes.position),hi(i,i.attributes.normal)}if(n){let i=t.x*2%hc*2+t.z*2%hc*hc;t.meshes.atlas=_R(t),t.meshes.texSet=t.data.textureid.map(bR);let s=t.data.holes.length>0;for(let o=0;o<2;++o)for(let r=0;r<2;++r){let l=r*2+o,a=t.data.texture[l];for(let f=0;f<Fr;++f)for(let u=0;u<Fr;++u){let m=f*Fr+u,g=m*3;if(ZS(a[m],Pu,g),s){let v=o*12+Math.floor(u/A8)+(Math.floor(f/A8)+r*12)*24;t.data.holes.indexOf(v)>=0&&(Pu[g+0]=255,Pu[g+1]=255,Pu[g+2]=255)}}Y3(t.meshes.atlas,i+l,Fr,Fr,Pu);let c=t.meshes.quadrantUbos[l];c.data.quadrant[0]=i+l,c.data.terrainInfo=t.meshes.texSet[l].info,Hp(c),si(c)}}},gR={min:[0,0,0],max:[64,64,64],center:[32,32,32],scale:[64,64,64],radius:60,initiated:!0},vR=t=>{if(t.geometry.terrain||(t.geometry.terrain=Sn({position:{size:3,data:l2},normal:{size:3,data:hR},index:dR}),Object.assign(t.geometry.terrain.bounds,gR)),!t.meshes.terrain){let e=Ri(t.geometry.terrain,8,N.TRIANGLES);t.meshes.terrain=e,t.meshes.quadrantUbos=[];for(let n=0;n<4;++n){let i=Ha(iu.meshterrain);i.data.modelMatrix=e.transform.matrix,t.meshes.quadrantUbos.push(i)}}st(t.meshes.terrain.transform.position,t.origin),t.meshes.terrain.transform.matrixNeedsUpdate=!0,Rt(t.meshes.terrain.transform,!1),t.state=Math.max(t.state,5)},_R=t=>{let e=Math.floor(t.x*2/hc),n=Math.floor(t.z*2/hc),i=e+1e3*n;if(!o2.has(i)){let s=Jo({width:Fr,height:Fr,target:N.TEXTURE_2D_ARRAY,format:N.RGB,internalFormat:N.RGB565,depth:hc**2,flipY:!1,generateMipmaps:!1});Pp(s,4),es(s),o2.set(i,s)}return o2.get(i)},bR=t=>{let e=t.join(",");if(!r2.has(e)){let n={info:[],diffuse:[],loaded:0};t.forEach((i,s)=>{let o=Va.get(i);n.info[s*4+0]=o.scale/127,n.info[s*4+1]=o.darkest/255*3,n.info[s*4+2]=o.brightest/255*3,n.info[s*4+3]=o.spec/255,gi(o.texture,r=>{n.diffuse[s]=r,n.loaded++})}),r2.set(e,n)}return r2.get(e)},V8=t=>{},L8=(t,e)=>{},q8=()=>{},R8=t=>{let e=mt[8];if(!e.active)return;N.useProgram(e.program),tt.currentProgram=e.id,Ia(e),Ea(e);let n,i,s=1;for(let r=0;r<t.length;++r){let l=t[r],a=l.meshes.terrain,c=a.geometry;n!==l.meshes.atlas&&(Ln("atlas",l.meshes.atlas,0,e),n=l.meshes.atlas),Aa(c,e);for(let f=0;f<4;++f)if(l.quadrantlod[f]<=s){let u=l.meshes.texSet[f];if(u.loaded<4)continue;let m=l.meshes.quadrantUbos[f];if(pl(m),i!==u){for(let b=0;b<4;++b)Ln("diffuse",u.diffuse[b],b,e);i=u}Pf(e);let g=l.quadrantmask[f],v=Il[g]*4,_=Il[g+1]-Il[g];N.drawElements(a.mode,_,c.attributes.index.type,v)}}let o=mt[9];if(o.active){N.useProgram(o.program),tt.currentProgram=o.id,Ia(o),Ea(e);for(let r=0;r<t.length;++r){let l=t[r],a=l.meshes.terrain,c=a.geometry,f=l.meshes.quadrantUbos[0];pl(f),Aa(c,o);for(let u=0;u<4;++u)if(l.quadrantlod[u]>s){let m=l.quadrantmask[u],g=Il[m]*4,v=Il[m+1]-Il[m];N.drawElements(a.mode,v,c.attributes.index.type,g)}}}};var z8,B8=()=>{z8=Sn({position:{size:3,data:new Float32Array([0,0,0,64,0,0,0,0,64,64,0,64])},index:{type:N.UNSIGNED_INT,data:new Uint32Array([0,2,1,2,3,1])}}),gi(1748,t=>Ln("waterNoise",t,0,mt[20])),gi(1243,t=>Ln("waterLines",t,0,mt[20])),Ln("bufferPongColor",Ao.colorTexture,0,mt[20]),Ln("bufferPongDepth",Ao.depthTexture,0,mt[20])},U8=(t,e)=>{if(!e||t.data.water.length===0)return;t.meshes.waterubo||(t.meshes.waterubo=Ha(iu.water));let n=t.origin[0],i=t.origin[2],s=t.meshes.waterubo.data.verts;for(let o=0;o<4;++o){let r=t.data.water[o]*.030517578125;s[o*3]=n+o%2*64,s[o*3+1]=r,s[o*3+2]=i+Math.floor(o/2)*64}Hp(t.meshes.waterubo),si(t.meshes.waterubo)},O8=t=>{},$8=t=>{let e=mt[20];Ta(e,tt.currentProgram===e.id);for(let n=0,i=t.length;n<i;++n){let s=t[n];s.data.water.length!==0&&(pl(s.meshes.waterubo),Pa(z8,e,N.TRIANGLES))}};var N8=t=>{Z3(),Uw(),PS(t),jS(),B8(),bS(),MS(),x8(),F8(),q8()},j8=(t,e,n)=>{WS(t,e,n),I8(),TS(e),y8(),qS(t,e),yS(t),FS(t),dS(t,e),w8(),C8(),iy(t)},W8=(t,e)=>{ay(t,e),L8(t,e),d8(t,e)},G8=t=>{k8(t),zS(t),SS(t),gS(t),cy(t)},gc=[],H8=t=>{gc.push(t)},a2=t=>{gc.splice(gc.indexOf(t),1)},Y8=t=>{R8(t),kS(),M8(),h8(t)},X8=t=>{S8()},Q8=t=>{$8(t),xS(),vS()},Z8=(t,e,n,i,s,o,r)=>{if(t.state!==8&&(D8(t,e,n),m8(t,i),U8(t,o),s))for(let l=0;l<t.props.length;++l)t.props[l].onChunkRebuild(t)},J8=t=>{V8(t),p8(t),O8(t)};var vc={neticons:[],npcs:[]},Cr=.6,l0=!1,Dl=200,Vl=200,u2=!1,a0=0,c0=0,yi=document.createElement("canvas");yi.className="border black minimap";var Cs=yi.getContext("2d"),c2=new Map,Eu=new Map;yi.addEventListener("wheel",t=>{Cr=vt(Cr+(t.deltaY<0?.07:-.07),.25,1.5)},{passive:!0});yi.addEventListener("mousedown",t=>{u2=!0});yi.addEventListener("mouseup",t=>{u2=!1});yi.addEventListener("mousemove",t=>{if(u2){let e=t.movementX,n=t.movementY;a0-=e/Cr,c0-=n/Cr}});var Tu={player:"#fff",monster:"#D53434",pvp:Dt("pvp"),friendly:Dt("health"),party:Dt("party"),black:Dt("black")},xR=()=>{nt.map.onPress(()=>{f0(l0=!l0)}),Un(Ft.serverMapUpdate.header,t=>{vc.neticons=Ft.serverMapUpdate.decode(t).icons})},f0=t=>{a0=c0=0,t?(document.body.appendChild(yi),Dl=~~Math.min(Math.max(200,window.innerWidth*.7),1e3),Vl=~~Math.min(Math.max(200,window.innerHeight*.7),800),Dl%2!==0&&(Dl+=1),Vl%2!==0&&(Vl+=1),yi.width=Dl,yi.height=Vl,yi.className="border black minimap enlarged"):(document.getElementById("minimapcontainer").appendChild(yi),yi.className="border black minimap",Dl=yi.width=200,Vl=yi.height=200)},nA=function(){this.loaded=!0},eA=0,wR=t=>{eA++;let e=V.player;if(!e||re.mapLowQuality&&eA%10!==0)return;let n=Cs;n.globalAlpha=1,n.clearRect(0,0,Dl,Vl);let i=e,s=i.pos[0]+a0,o=i.pos[2]+c0,r=Cr<.4?16:4,l=r*64,a=V.chunkAmount,c=Math.round(l*Cr),f=Dl,u=Vl,m=f*(l/c),g=u*(l/c),v=Math.ceil(m/l),_=Math.ceil(g/l),b=s-m/2,y=o-g/2,k=Math.floor(b/l),A=Math.floor(y/l),S=k+v,F=A+_;(S*l-b)*(c/l)<f&&S++,(F*l-y)*(c/l)<u&&F++,k=Math.max(0,k),A=Math.max(0,A),S=Math.min(a/r,S),F=Math.min(a/r,F);for(let O=k;O<S;++O)for(let Z=A;Z<F;++Z){let ve=O*r+Z*a*r,Fe=r+"-"+ve;if(Eu.has(Fe)){let _e=Eu.get(Fe);if(_e.loaded){let ce=(O*l-b)*(c/l),fe=(Z*l-y)*(c/l);n.drawImage(_e,ce,fe,c,c)}}else{let _e=new Image;_e.src=Nk(V.file,r,ve),_e.onload=nA,Eu.set(Fe,_e)}}let M=!1;if(vc.neticons.forEach(O=>{M=M||O.blink;let Z=r0(O.pos[0],O.pos[1],s,o,c,l,f,u);f2(Z,O.id,O.blink)}),M&&(n.globalAlpha=1),vc.npcs.forEach(O=>{let Z=MR(O.pos[0],O.pos[1],s,o,c,l,f,u);Z[0]>0&&Z[1]>0&&Z[0]<f&&Z[1]<u&&f2(Z,O.img,!1)}),V.entities.array.forEach(O=>{if(!O.stats||!O.stats.alive||O===e)return;let Z=r0(O.pos[0],O.pos[2],s,o,c,l,f,u);tA(Z,O.type,e.hostility(O),O.party>0&&O.party===e.party)}),nn.forEach(O=>{if(O.local&&O.pos!==void 0&&!V.isEntityIdTaken(O.id)){let Z=r0(O.pos[0],O.pos[1],s,o,c,l,f,u);tA(Z,0,0,e.party)}}),e.buffs.buffs.has(128)){let O=e.buffs.buffs.get(128).get(e.id);if(O.data){let Z=r0(O.data[0],O.data[1],s,o,c,l,f,u);f2(Z,2100,!1)}}n.globalAlpha=l0&&V.smoothtime%1<.5?.5:1;let D=V.player.visual.transform.rotation[1],R=Math.sin(D)*6,E=Math.cos(D)*6,L=Math.sin(D+2.4)*6,z=Math.cos(D+2.4)*6,q=Math.sin(D-2.4)*6,j=Math.cos(D-2.4)*6,W=f/2-a0*Cr,U=u/2-c0*Cr;n.fillStyle="#C1DAE2",n.strokeStyle="#1A293A",n.lineWidth=1,n.beginPath(),n.moveTo(W+R,U+E),n.lineTo(W+L,U+z),n.lineTo(W+q,U+j),n.closePath(),n.fill(),n.stroke()},f2=(t,e,n)=>{if(c2.has(e)){let i=c2.get(e);if(i.loaded===!0){!n||V.smoothtime%1<.5?Cs.globalAlpha=n?.6:.8:Cs.globalAlpha=1;let s=i.width,o=i.height;Cs.drawImage(i,t[0]-s/2,t[1]-o/2,~~s,~~o)}}else{let i=document.createElement("img");i.src="data/assets/"+Vp(e)+"?v=8602459",i.onload=nA,c2.set(e,i)}},tA=(t,e,n,i)=>{if(!(!re.mapShowMonsters&&e===1))if(e===0){if(l0&&i&&V.smoothtime%1>.5)return;n===0?Cs.fillStyle=i?Tu.party:Tu.friendly:Cs.fillStyle=Tu.pvp,Cs.fillRect(...t,6,6),Cs.strokeRect(...t,6,6)}else Cs.fillStyle=n>0?Tu.monster:Tu.friendly,Cs.fillRect(...t,4,4),Cs.strokeRect(...t,4,4)},MR=(t,e,n,i,s,o,r,l)=>{let a=t-n,c=e-i,f=a/o*s,u=c/o*s,m=r/2+f,g=l/2+u;return[m,g]},r0=(t,e,n,i,s,o,r,l)=>{let a=t-n,c=e-i,f=a/o*s,u=c/o*s,m=Math.min(r-3,Math.max(0,r/2+f)),g=Math.min(l-3,Math.max(0,l/2+u));return[m,g]},FR=t=>{Eu.clear();for(let e=0;e<qf.length;++e)qf[e].world===t.idInt&&vc.npcs.push(qf[e])},CR=t=>{Eu.clear(),vc.neticons.length=0,vc.npcs.length=0};function iA(t){let e,n,i,s;return{c(){e=h("img"),p(e,"class","btn border black bgblack round warIcon svelte-1khf45q"),lt(e.src,n="/data/ui/icons/war0."+On+"?v=8602459")||p(e,"src",n)},m(o,r){w(o,e,r),i||(s=Y(e,"click",t[2]),i=!0)},p:ae,d(o){o&&x(e),i=!1,s()}}}function SR(t){let e,n=t[0]!==void 0&&iA(t);return{c(){e=h("div"),n&&n.c(),p(e,"id","minimapcontainer"),p(e,"class","marg-top minimapcontainer svelte-1khf45q")},m(i,s){w(i,e,s),n&&n.m(e,null)},p(i,[s]){i[0]!==void 0?n?n.p(i,s):(n=iA(i),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},i:ae,o:ae,d(i){i&&x(e),n&&n.d()}}}function AR(t,e,n){let i,s;return se(t,$s,r=>n(0,i=r)),se(t,Ns,r=>n(1,s=r)),Fn(()=>{f0(!1)}),[i,s,r=>Qe(Ns,s=!s,s)]}var p2=class extends xe{constructor(e){super(),Ce(this,e,AR,SR,Ue,{})}},sA=p2;function oA(t){let e,n;return e=new WC({}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function rA(t){let e,n;return e=new XC({props:{vertical:!0}}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function PR(t){let e,n,i,s,o,r,l,a,c,f,u,m,g,v,_,b,y,k,A,S,F,M,D,R,E,L,z,q,j,W,U,O,Z,ve,Fe,_e,ce,fe,ze,Pe;e=new XM({}),i=new j_({});let Me=t[0]&&!t[0].subscribed_until&&(t[1]||t[2]||t[3]||t[4]||t[5])&&oA(t);r=new XF({}),l=new JF({}),a=new $b({}),c=new vF({}),f=new KM({}),u=new Ex({}),m=new jF({}),g=new Mx({}),v=new OM({}),_=new GM({}),b=new n6({}),y=new g6({}),k=new OF({}),A=new T6({}),S=new N6({}),F=new K6({}),M=new iF({}),D=new CF({}),R=new CC({}),E=new IC({}),L=new xC({}),z=new NC({}),q=new KC({}),W=new r6({}),U=new sA({}),O=new ZC({});let be=t[6]&&rA(t);return _e=new Jw({}),ce=new LM({}),fe=new VC({}),ze=new WF({}),{c(){ne(e.$$.fragment),n=h("div"),ne(i.$$.fragment),s=h("div"),Me&&Me.c(),o=he(),ne(r.$$.fragment),ne(l.$$.fragment),ne(a.$$.fragment),ne(c.$$.fragment),ne(f.$$.fragment),ne(u.$$.fragment),ne(m.$$.fragment),ne(g.$$.fragment),ne(v.$$.fragment),ne(_.$$.fragment),ne(b.$$.fragment),ne(y.$$.fragment),ne(k.$$.fragment),ne(A.$$.fragment),ne(S.$$.fragment),ne(F.$$.fragment),ne(M.$$.fragment),ne(D.$$.fragment),ne(R.$$.fragment),ne(E.$$.fragment),ne(L.$$.fragment),ne(z.$$.fragment),ne(q.$$.fragment),j=h("div"),ne(W.$$.fragment),ne(U.$$.fragment),ne(O.$$.fragment),be&&be.c(),Z=h("div"),ve=h("div"),Fe=h("div"),ne(_e.$$.fragment),ne(ce.$$.fragment),ne(fe.$$.fragment),ne(ze.$$.fragment),p(j,"class","l-corner-ur uiscaled"),p(s,"class","container svelte-k3qmu8"),p(Fe,"class","actionbarcontainer svelte-k3qmu8"),p(ve,"class","uiscaled"),p(Z,"class","container svelte-k3qmu8"),p(n,"class","l-ui layout svelte-k3qmu8")},m(H,pe){K(e,H,pe),w(H,n,pe),K(i,n,null),d(n,s),Me&&Me.m(s,null),d(s,o),K(r,s,null),K(l,s,null),K(a,s,null),K(c,s,null),K(f,s,null),K(u,s,null),K(m,s,null),K(g,s,null),K(v,s,null),K(_,s,null),K(b,s,null),K(y,s,null),K(k,s,null),K(A,s,null),K(S,s,null),K(F,s,null),K(M,s,null),K(D,s,null),K(R,s,null),K(E,s,null),K(L,s,null),K(z,s,null),K(q,s,null),d(s,j),K(W,j,null),K(U,j,null),K(O,j,null),be&&be.m(j,null),d(n,Z),d(Z,ve),d(ve,Fe),K(_e,Fe,null),K(ce,Fe,null),K(fe,Z,null),K(ze,n,null),Pe=!0},p(H,[pe]){H[0]&&!H[0].subscribed_until&&(H[1]||H[2]||H[3]||H[4]||H[5])?Me?pe&63&&P(Me,1):(Me=oA(H),Me.c(),P(Me,1),Me.m(s,o)):Me&&(Ee(),I(Me,1,1,()=>{Me=null}),Ie()),H[6]?be?pe&64&&P(be,1):(be=rA(H),be.c(),P(be,1),be.m(j,null)):be&&(Ee(),I(be,1,1,()=>{be=null}),Ie())},i(H){Pe||(P(e.$$.fragment,H),P(i.$$.fragment,H),P(Me),P(r.$$.fragment,H),P(l.$$.fragment,H),P(a.$$.fragment,H),P(c.$$.fragment,H),P(f.$$.fragment,H),P(u.$$.fragment,H),P(m.$$.fragment,H),P(g.$$.fragment,H),P(v.$$.fragment,H),P(_.$$.fragment,H),P(b.$$.fragment,H),P(y.$$.fragment,H),P(k.$$.fragment,H),P(A.$$.fragment,H),P(S.$$.fragment,H),P(F.$$.fragment,H),P(M.$$.fragment,H),P(D.$$.fragment,H),P(R.$$.fragment,H),P(E.$$.fragment,H),P(L.$$.fragment,H),P(z.$$.fragment,H),P(q.$$.fragment,H),P(W.$$.fragment,H),P(U.$$.fragment,H),P(O.$$.fragment,H),P(be),P(_e.$$.fragment,H),P(ce.$$.fragment,H),P(fe.$$.fragment,H),P(ze.$$.fragment,H),Pe=!0)},o(H){I(e.$$.fragment,H),I(i.$$.fragment,H),I(Me),I(r.$$.fragment,H),I(l.$$.fragment,H),I(a.$$.fragment,H),I(c.$$.fragment,H),I(f.$$.fragment,H),I(u.$$.fragment,H),I(m.$$.fragment,H),I(g.$$.fragment,H),I(v.$$.fragment,H),I(_.$$.fragment,H),I(b.$$.fragment,H),I(y.$$.fragment,H),I(k.$$.fragment,H),I(A.$$.fragment,H),I(S.$$.fragment,H),I(F.$$.fragment,H),I(M.$$.fragment,H),I(D.$$.fragment,H),I(R.$$.fragment,H),I(E.$$.fragment,H),I(L.$$.fragment,H),I(z.$$.fragment,H),I(q.$$.fragment,H),I(W.$$.fragment,H),I(U.$$.fragment,H),I(O.$$.fragment,H),I(be),I(_e.$$.fragment,H),I(ce.$$.fragment,H),I(fe.$$.fragment,H),I(ze.$$.fragment,H),Pe=!1},d(H){H&&x(n),ee(e,H),ee(i),Me&&Me.d(),ee(r),ee(l),ee(a),ee(c),ee(f),ee(u),ee(m),ee(g),ee(v),ee(_),ee(b),ee(y),ee(k),ee(A),ee(S),ee(F),ee(M),ee(D),ee(R),ee(E),ee(L),ee(z),ee(q),ee(W),ee(U),ee(O),be&&be.d(),ee(_e),ee(ce),ee(fe),ee(ze)}}}function TR(t,e,n){let i,s,o,r,l,a,c;return se(t,fa,f=>n(0,i=f)),se(t,Dr,f=>n(1,s=f)),se(t,cs,f=>n(2,o=f)),se(t,js,f=>n(3,r=f)),se(t,Xi,f=>n(4,l=f)),se(t,Li,f=>n(5,a=f)),se(t,_a,f=>n(6,c=f)),mu(),[i,s,o,r,l,a,c]}var d2=class extends xe{constructor(e){super(),Ce(this,e,TR,PR,Ue,{})}},lA=d2;function aA(t){let e,n;return e=new lA({}),{c(){ne(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function ER(t){let e,n,i,s;e=new d_({props:{active:t[0]}});let o=t[1]&&!t[0]&&t[2]&&aA(t);return i=new $_({}),{c(){ne(e.$$.fragment),o&&o.c(),n=he(),ne(i.$$.fragment)},m(r,l){K(e,r,l),o&&o.m(r,l),w(r,n,l),K(i,r,l),s=!0},p(r,[l]){let a={};l&1&&(a.active=r[0]),e.$set(a),r[1]&&!r[0]&&r[2]?o?l&7&&P(o,1):(o=aA(r),o.c(),P(o,1),o.m(n.parentNode,n)):o&&(Ee(),I(o,1,1,()=>{o=null}),Ie())},i(r){s||(P(e.$$.fragment,r),P(o),P(i.$$.fragment,r),s=!0)},o(r){I(e.$$.fragment,r),I(o),I(i.$$.fragment,r),s=!1},d(r){r&&x(n),ee(e,r),o&&o.d(r),ee(i,r)}}}function IR(t,e,n){let i,s,o;return se(t,xi,r=>n(0,i=r)),se(t,fm,r=>n(1,s=r)),se(t,Uc,r=>n(2,o=r)),[i,s,o]}var h2=class extends xe{constructor(e){super(),Ce(this,e,IR,ER,Ue,{})}},cA=h2;var uA=[],Iu=0,u0=0,fA=()=>{let t=uA.shift();t[0](...t[1]),u0--},mA=(t,e,n)=>{if(n)for(;Iu>0;)Iu--,u0++,fA();else Iu>0&&u0<5&&(Iu--,u0++,requestIdleCallback(fA,{timeout:5e3}))},g2=(t,e,n)=>{uA.push([t,e]),Iu++};var pA=()=>({id:0,x:0,z:0,origin:[0,0,0],deserialized:!1,props:[],normals:new Float32Array(3456),data:void 0,loadingProps:0,center2d:[0,0],geometry:{},meshes:{},state:0,neighbors:[],quadrantlod:[0,0,0,0],quadrantmask:[0,49,98,147],inRange:!1,isMeshVisible:!1,isEffectsVisible:!1,reloadAttempts:0}),v2=(t,e,n,i,s)=>{KS(t,e,n,i),t.reloadAttempts=0,t.center2d[0]=t.origin[0]+64/2,t.center2d[1]=t.origin[2]+64/2,t.neighbors.length=0;for(let o=Math.max(0,n-1);o<=Math.min(s-1,n+1);o++)for(let r=Math.max(0,i-1);r<=Math.min(s-1,i+1);r++){let l=o+r*s;l!==t.id&&t.neighbors.push(l)}t.state=0},dA=t=>t.state>=2?!1:(t.state=2,DR(t),!0),DR=async t=>{try{let n=await(await fetch(`data/world/${V.file}/${t.id}?v=8602459`,{cache:"default"})).arrayBuffer();g2(VR,[new Uint8Array(n),t]),t.reloadAttempts=0}catch(e){t.reloadAttempts++<5?(t.state=2-1,dA(t)):console.log(`failed to load chunk ${t.id}, giving up`,e)}},VR=(t,e)=>{e.state=3,e8(e,xa.chunk.decode(t)),_2(e)},_2=t=>{if(t.inRange=$v(t.x*2,t.z*2)<3,t.inRange)for(let e=0;e<2;++e)for(let n=0;n<2;++n){let i=n*2+e,s=Math.min(2,$v(t.x*2+e,t.z*2+n)),o=oS(t.x*2+e,t.z*2+n);t.quadrantlod[i]=s,t.quadrantmask[i]=o}},hA=(t,e)=>{let n=t.state;if(n===0||n===3){if(t.inRange){n===0&&(t.state=1);let i=t.loadingProps===0;for(let s=0;s<t.neighbors.length;++s){let o=e.chunksMap.get(t.neighbors[s]);o?o.state<3&&(o.state===0&&(o.state=1),i=!1):i=!1}n===3&&i&&(t.state=4,LR(t,!0,!0,!0,!0,!0,!0))}}else n>=5?t.inRange&&t.state<7?(H8(t),t.state=7):!t.inRange&&t.state===7&&(a2(t),Du(t,!1,!1),t.state=6):n===1&&dA(t)&&(t.state=2)},Du=(t,e,n)=>{if(t.isMeshVisible!==e){t.isMeshVisible=e;for(let i=0;i<t.props.length;++i)t.props[i].setVisible(e)}if(!n&&t.isEffectsVisible!==e){t.isEffectsVisible=e;for(let i=0;i<t.props.length;++i)t.props[i].setEffectVisible(e)}},LR=(t,e,n,i,s,o,r)=>{g2(Z8,[t,e,n,i,s,o])},b2=t=>{n8(t),t.state===7&&(a2(t),Du(t,!1,!1),t.state=6),J8(t),t.state=8};var vA=(t,e,n)=>{let i=[];for(let s=0;s<t.length;++s){let o=t[s];XS(o.data.aabb,e.frustum,e.frustumConstants)?(i.push(o),Du(o,!0,n)):Du(o,!1,n)}return i},qR=()=>{let t=gc;if(N.enable(N.POLYGON_OFFSET_FILL),N.polygonOffset(1.3,3),rc){for(let e=1;e>=0;--e){let n=Ya[e],i=Al[e];ld(i,!0),Vu(n),Dh(n),t=vA(t,i,!0);for(let s=0,o=Bd.length;s<o;++s){let r=Bd[s];sc(r,mt[r.shadowProgram],!0,i)}}ku(!1)}ld(Al[0],!0),m0(Ya[0],Xa,N.DEPTH_BUFFER_BIT),Vu(Xa);for(let e=0,n=zd.length;e<n;++e){let i=zd[e];sc(i,mt[i.shadowProgram],!1,gt)}N.disable(N.POLYGON_OFFSET_FILL)},RR=t=>{ld(gt,!0),Vu(ys),Dh(ys);for(let e=0,n=Ld.length;e<n;++e){let i=Ld[e];sc(i,mt[i.program],!0,gt)}Y8(t)},zR=t=>{X8(t);for(let e=0,n=qd.length;e<n;++e){let i=qd[e];sc(i,mt[i.program],!0,gt)}m0(ys,Ao,N.DEPTH_BUFFER_BIT),m0(ys,Ao,N.COLOR_BUFFER_BIT),Vu(ys),Q8(t);for(let e=0,n=Rd.length;e<n;++e){let i=Rd[e];sc(i,mt[i.program],!0,gt)}},_c=(t,e,n,i,s)=>{let o=mt[t];n&&Ln("inputA",n.colorTexture,0,o),i&&Ln("inputB",i.colorTexture,0,o);for(let r=0;r<s.length;++r){let l=o.uniforms[s[r][0]];l.value=s[r][1]}Vu(e),Ki(Bf,o)},BR=t=>{let e=Ao,n=ys;if(t.has(32)&&(t.delete(32),_c(32,e,n,null,[]),[e,n]=[n,e]),t.has(33)&&(t.delete(33),_c(33,e,n,null,[]),[e,n]=[n,e]),t.has(30)){t.delete(30);let i=.5/hl.width,s=.5/hl.height;_c(30,gl,n,null,[["offset",[-i,-s,i,-s,i,s,-i,s]],["amount",[.25,.25,.25,.25]]]);let o=["amount",[.125,.375,.375,.125]];i*=2,s*=2,_c(30,hl,gl,null,[["offset",[-i*2,0,-i,0,i,0,i*2,0]],o]),_c(30,gl,hl,null,[["offset",[0,-s*2,0,-s,0,s,0,s*2]],o]),_c(31,null,n,gl,[])}else m0(n,null,N.COLOR_BUFFER_BIT)},m0=(t,e,n,i=N.NEAREST)=>{let s=t.width,o=t.height,r=e!==null?e.width:ys.width,l=e!==null?e.height:ys.height;N.bindFramebuffer(N.READ_FRAMEBUFFER,t.buffer),N.bindFramebuffer(N.DRAW_FRAMEBUFFER,e!==null?e.buffer:null),N.blitFramebuffer(0,0,s,o,0,0,r,l,n,i)},Vu=t=>{t?(N.bindFramebuffer(N.FRAMEBUFFER,t.buffer),Hc(t.width,t.height)):(N.bindFramebuffer(N.FRAMEBUFFER,null),Hc(tt.width,tt.height))},_A=t=>{Bx(t)},bA=t=>{qR();let e=vA(gc,gt,!1);RR(e),zR(e),BR(t)};var bc=re.resolution/100,kA=!1,yA=[256,512,1024,2048][re.shadowmapResolution]||1024,xA=()=>{N||(alert("WebGL2 problem found."),window.location.href="/technical"),wA(),_A(yA),N8(yA),FA(tt.width,tt.height),Dn.className="l-canvas",Fi.className="l-canvas",Fi.style.pointerEvents="all",window.addEventListener("resize",MA,!1)};$r.subscribe(t=>{iS(t**2/10,re.shadowmapResolution)});Nr.subscribe(t=>{gt.fov=t,Gc(gt)});xi.subscribe(t=>{kA=!t});var wA=()=>{let t=window.innerWidth*bc,e=window.innerHeight*bc;D_(t,e)},MA=()=>{let t=window.innerWidth*bc,e=window.innerHeight*bc;wA(),Ux(t,e),FA(t,e)},FA=(t,e)=>{gt.aspect=t/e,Gc(gt),Ow(t,e)};jr.subscribe(t=>{let e=t/100,n=bc!==e;bc=e,re.resolutionScale=e,n&&MA()});var CA=(t,e)=>{Im(gt);let n=new Set;re.fxaa&&n.add(32),re.bloom&&n.add(30),kA&&(j8(t,e.smoothtime,n),bA(n))},SA=(t,e)=>{W8(t,e)},AA=t=>{G8(t),DS()};xo.report.fun=t=>{t.length>=3?fo.set({name:t,reason:0,reasonfixed:!1}):Gt("error","Enter a player name to report",!0)};var M2={};Qn(M2,{init:()=>HR,postTick:()=>YR});var Lu=[],so=0,PA=t=>{so+=t;let e=[];for(let i=0;i<Lu.length;i++){let s=Lu[i];if(s.timer.done(so))$R(s),Lu.splice(i--,1);else if(so>=s.timer.start){let o=s.timer.fraction(so);st(s.screenPos,s.pos);let r=ml(s.screenPos,s.screenPos,s.flat);if(r){let l=s.timer.remaining(so);if(s.alpha=l<.3?l/.3:1,s.crit){let a=Math.min(1,o*6);s.scale=1+(a>.5?2-a*2:a*2)*1.6}else r[1]-=50-(1-o)**2*50,s.scale=1;e.push(s)}}}if(e.sort((i,s)=>s.timer.start-i.timer.start),re.combatTextPush){let i=0,s=!0,o=[0,0],r=[0,0];for(;i<10&&s;){++i,s=!1;for(let l=0;l<e.length;++l){let a=e[l],c=a.width*a.scale,f=a.height*a.scale;o[0]=a.screenPos[0]+a.screenOffset[0],o[1]=a.screenPos[1]+a.screenOffset[1];for(let u=0;u<e.length;++u){if(u===l)continue;let m=e[u],g=m.width*m.scale;if(m.flat!==a.flat||g<c||g===c&&l<u)continue;let v=m.height*m.scale;r[0]=m.screenPos[0]+m.screenOffset[0],r[1]=m.screenPos[1]+m.screenOffset[1];let _=r[0]-o[0],b=r[1]-o[1],y=g/2+c/2,k=v/2+f/2;if(Math.abs(_)<y&&Math.abs(b)<k){let A=_<0?_+y:_-y,S=b<0?b+k:b-k;Math.abs(A)<Math.abs(S)*1.2?a.screenOffset[0]+=A:a.screenOffset[1]+=S,s=!0,o[0]=a.screenPos[0]+a.screenOffset[0],o[1]=a.screenPos[1]+a.screenOffset[1]}}}}}let n=[0,0];for(let i=0;i<e.length;++i){let s=e[i];s.screenOffset[0]*=Math.max(0,1-t*3),s.screenOffset[1]*=Math.max(0,1-t*3),n[0]=s.screenPos[0]+s.screenOffset[0],n[1]=s.screenPos[1]+s.screenOffset[1],fx(n,s.img,s.alpha,s.scale)}},k2=(t,e,n,i,s=!1,o)=>{let r=n===3;qu(t,s,r,s||!r,n===0?"Miss":ht(e)+(n===1?"\u{1F6E1}\uFE0F":""),s?Vt.pdmg:i===1?r?Vt.spellCrit:Vt.spell:r?Vt.physCrit:Vt.phys,o,so,r?1.2:.9)},x2=(t,e,n,i=!1,s)=>{qu(t,i,n===3,i||n!==3,ht(e),i?Vt.pheal:Vt.heal,s,so,1.3)},TA=(t,e,n)=>{qu(t,n,!1,!0,"Immune",n?Vt.mana:Vt.spell,e,so,2)},EA=(t,e,n,i=!1)=>{qu(t,i,n===3,i||n!==3,e,Vt.mana,0,so,1.3)};var IA=(t,e)=>{qu(t,!1,!1,!0,`+${e} Fame`,Vt.fame,5.5,so,1.5)},qu=(t,e=!1,n=!1,i=!1,s,o,r,l,a)=>{let c=OR();st(c.pos,t),c.pos[1]+=r||0,c.side=Math.sin(Lu.length*2.3),c.flat=e,c.crit=n,c.float=i,c.timer.reset(l,a),X(c.screenPos,0,0,0),di(c.screenOffset,0,0,0),c.scale=0,c.alpha=0,c.img=Qf(s,o),c.width=c.img.width,c.height=c.img.height,Lu.push(c)},y2=[],OR=()=>y2.length?y2.pop():{pos:[0,0,0],flat:!0,crit:!0,float:!0,yoffset:0,timer:new kt(0,1),screenPos:[0,0,0],screenOffset:[0,0],scale:0,alpha:0,img:void 0,width:0,height:0},$R=t=>{y2.push(t)};var w2=re.itemTypeFilter.toLowerCase().replace(/\s/g,"").split(","),yc=new Set,NR=(t,e,n)=>{for(let i=n.length-1;i>=0;i--){let s=n[i];(s==e||ei(e.pos,s.pos)<5**2)&&(t.push(s),zn(t.pos,t.pos,s.pos),n.splice(i,1))}},DA=(t,e)=>{st(t.hudPos,t.visualPosition||t.pos),ml(t.hudPos,t.hudPos)&&t.hudPos[2]<.997&&e.push(t)},VA=t=>{let e=[];V.entities.array.forEach(s=>{s.type!==3||!s.visual.transform.visible||s.quality<re.itemQualityFilter||w2.includes(s.droptype)||DA(s,e)}),yc.forEach(s=>{s.uiTimeout<V.time?yc.delete(s):DA(s,e)}),e=e.sort((s,o)=>o.id-s.id);let n=new Set;for(;e.length;){let s=e[0],o=[];o.pos=[0,0,0],NR(o,s,e),hn(o.pos,o.pos,1/o.length),X(o.pos,Math.round(o.pos[0]),Math.round(o.pos[1]),Math.round(o.pos[2])),ml(o.pos,o.pos)?n.add(o.sort((r,l)=>r.hudPos[2]-l.hudPos[2])):n.delete(o)}let i=0;Array.from(n).sort((s,o)=>o.pos[2]-s.pos[2]).forEach(s=>{let o=s.length/5*100,r=0,l=0;s.forEach((a,c)=>{a.hudTextImg||(a.hudTextImg=Qf(a.name,Vt[a.color]));let f=a.hudTextImg.width,u=Math.round(s.pos[0]+l-o*.5)-2,m=Math.round(s.pos[1]-r*20)-8;if(a.uiTimeout===0){let g=a.canBePickedUpBy(V.player),v=a.partyTimeoutCheck(V.player);g&&!(Ua[0]>u+f||Ua[1]>m+20||Ua[0]<u||Ua[1]<m)?(i=a.id,Ci.globalAlpha=1):Ci.globalAlpha=g?.4:.1,Ci.fillStyle="#000000",Ci.beginPath(),Ci.rect(u,m,f,20),Ci.fill(),ar(di(Bn,u+2,m+8),a.name,v?Vt[a.color]:Vt.itemgrey,g?1:.8,1,0,0,0)}l+=f+3,l>o&&(r++,l=0)})}),i!==vn&&su(i)};var Xn=[],LA,qA,Ni=2,RA=()=>{let n=Math.ceil(100),i=Math.max(7,Math.ceil(9*1)),s=Math.max(1,Math.ceil(Ni*1)),o=n-Ni*2,r=i-Ni*2;Xn.push(Ti(null,Dt("panel"),n,i,0,0,s)),Ti(Xn[0],Dt("grey"),o,r,Ni,Ni,1),Xn.push(Ti(null,Dt("health"),o,r,0,0,1)),Xn.push(Ti(null,"#ffbc00",o,r,0,0,1)),Xn.push(Ti(null,Dt("enemy"),o,r,0,0,1)),Xn.push(Ti(null,Dt("party"),o,r,0,0,1)),Xn.push(Ti(null,Dt("pvp"),o,r,0,0,1)),Xn.push(Ti(null,"#555555",o,r,0,0,1)),Xn.push(Ti(null,Dt("spell"),o,r,0,0,1));for(let l=0;l<=3;++l)Xn.push(Ti(null,Dt("c"+l),o,r,0,0,1));LA=Ti(null,"#ffffff",100+Ni*2,9+Ni*2,0,0,3),qA=Ti(null,"#ffffff",100+Ni*2,16+Ni*2,0,0,3)},jR=()=>{let t=[];return V.entities.array.forEach((e,n)=>{!e.visual||!e.visual.transform.visible||e.stats&&!e.stats.alive||e.id!==Rn&&e.visual.cDist&&e.visual.cDist>60||e.type===3&&e.id!==vn||(st(e.hudPos,e.visualPosition||e.pos),e.type!==3&&(e.hudPos[1]+=e.visual.getTopAbsolute(),e.mount!==void 0&&(e.hudPos[1]+=1)),ml(e.hudPos,e.hudPos)&&(e.id===V.playerId&&(e.hudPos[0]=Math.round(.5*Dn.width),e.hudPos[1]=Math.round(.5*Dn.height)),t.push(e)))}),t.sort((e,n)=>n.hudPos[2]-e.hudPos[2])},WR=(t,e,n)=>e?4:n===0?re.classColorBars&&t.type===0?8+t.class:1:V.player.canCombatInteract(t)?n===2?re.classColorBars?8+t.class:5:t.type===1&&t.aggroMode===0?2:3:6,GR=(t,e)=>{let n=t.visual&&t.visual.cDist;if(n>re.nameplateViewRange)return;n?n/=70:n=0;let i=t.party>0&&t.party===V.player.party,s=t.faction!==void 0?V.player.hostility(t):0,o=V.player.clan,r=V.player.level,l=t.id===Rn,a=t.id===V.playerId,c=t.id===vn;if(t.type!==3&&t.stats&&t.stats.alive){t.namePlateScale=vt(t.namePlateScale+((l?1:0)-t.namePlateScale)*.25,.5,1);let m=l?1:Math.max(.1,Math.min(1,1-n))*.7,g=l||i?1:Math.min(.8,c?.9:m*.75+.2),v=t.skills.timedSkill!==void 0;!a&&l&&lr(v?qA:LA,t.hudPos,1,t.namePlateScale,1,v?2:1,0,v?4:0);let _=l||s===0&&re.nameplateShowFriendlyPlayers||s===1&&re.nameplateShowMonsters||s===2&&re.nameplateShowEnemyPlayers;if(v&&_){let b=Xn[0].height-Ni,y=vt(t.skills.timedCast.fraction(V.smoothtime),0,1);lr(Xn[0],t.hudPos,g,t.namePlateScale,1,1,0,b),y>0&&lr(Xn[7],t.hudPos,g,t.namePlateScale,y,1,0,b)}if(!a&&_&&(lr(Xn[0],t.hudPos,g,t.namePlateScale,1,v?2:1),lr(Xn[WR(t,i,s)],t.hudPos,g,t.namePlateScale,t.stats.getResource(6)/t.stats.getStat(6),1),t.clan&&ar(di(Bn,t.hudPos[0]-(Xn[0].width/2+Ni)*t.namePlateScale,t.hudPos[1]),t.clan,t.clan==o?Vt.clan:t.faction===0?Vt.faction0small:Vt.faction1small,g,1,2,0,1),t.level&&(re.alwaysShowLevel||l))){let b=Vt.lev1;s!==0&&(t.level-r>4?b=Vt.lev3:t.level-r>1?b=Vt.lev2:t.level-r<-5&&(b=Vt.lev0)),ar(di(Bn,t.hudPos[0]+(Xn[0].width/2+Ni)*t.namePlateScale,t.hudPos[1]),t.level,b,g,1,0,0,0)}}let f,u=!1;if(t.type===3?(f=t.partyTimeoutCheck(V.player)?Vt[t.color]:Vt.itemgrey,u=!0):s===0?(f=l?Vt.name:Vt.nameSmall,u=re.nameShowFriendlyPlayers):s===1?(f=l?Vt.enemy:Vt.enemySmall,u=re.nameShowMonsters):s===2&&(f=l?Vt.pvp:Vt.pvpSmall,u=re.nameShowEnemyPlayers),l||u){let m=t.type===3&&c&&!t.canBePickedUpBy(V.player)?.5:l||t.type===3?1:c?.9:Math.max(.1,Math.min(1,1-n))*.7,g=l?-16:-9,v=a&&t.clan?t.clan.length*5:0,_=ar(t.hudPos,t.name,f,m,1,v,g);t.clan&&a&&ar(di(Bn,t.hudPos[0]-_/2+Ni,t.hudPos[1]),t.clan,t.faction===0?l?Vt.faction0:Vt.faction0small:l?Vt.faction1:Vt.faction1small,m,1,t.clan.length*5,g,1)}t.speechText&&ar(t.hudPos,t.speechText,t.speechStyle,1,1,0,l?-30:-20,.5,1)},zA=t=>{yc.clear();let e=jR();bg(e),e=e.sort((n,i)=>n.id===Rn||n.id===vn?1:i.id===Rn||i.id===vn?-1:i.hudPos[2]-n.hudPos[2]),ti(yo,0,0,0,0),e.forEach(GR)};var HR=()=>{cx(),RA()},YR=t=>{Ci.clearRect(0,0,Dn.width,Dn.height),nt.shift.down?VA(t):zA(t),PA(t)};var F2={};Qn(F2,{onWorldEnter:()=>XR});var XR=()=>{xt("petlootsettings",w2.join(",")+" "+re.itemQualityFilter)};var C2={};Qn(C2,{init:()=>QR});var QR=()=>{Un(Ft.serverWarUpdate.header,t=>{let e=Ft.serverWarUpdate.decode(t);$s.update(n=>(n===void 0||e.contributors.length===0&&(e.contributors=n.contributors),e))})};var kc=[M2,yg,Dg,Zg,m2,I1,Yh,J1,Kh,F2,G1,wp,C2],S2=!1,BA=()=>{kc.forEach(t=>{t.init&&t.init()})},UA=t=>{kc.forEach(e=>{e.preTick&&e.preTick(t)})},OA=t=>{kc.forEach(e=>{e.tick&&e.tick(t)})},$A=(t,e)=>{kc.forEach(n=>{n.postTick&&n.postTick(t,e)})},NA=t=>{kc.forEach(e=>{e.onWorldEnter&&e.onWorldEnter(t)}),S2=!0},jA=t=>{S2&&kc.forEach(e=>{e.onWorldDestroy&&e.onWorldDestroy(t)}),S2=!1};var GA=async t=>{let n=await(await fetch("api/user/join",{method:"POST",body:JSON.stringify({id:t})})).json();if(n.world)Or.set(n.world),Qc.set(t);else throw Or.set(void 0),Qc.set(void 0),n.result||"Unknown Error";return!0};var HA=0,p0=!1,YA=new kt(0,2e4),XA=2,QA=t=>{YA.done(t)&&(t>1e5&&!p0&&t-HA>60*1e3*3?(p0=!0,HA=t,Dr.set(XA),XA++):p0&&(p0=!1,Dr.set(0)),YA.reset(t))};var A2={arena3v3:{port:5006},arena5v5:{port:5007},main:{port:5009},dev2:{port:5010},dev_default:{port:5010},dev_pathfind:{port:5011},arena_big_swamp:{port:5012},arena_cage:{port:5013},arena_cove:{port:5014},arena_lava:{port:5015},arena_ruins:{port:5016},arena_small_swamp:{port:5017}};var P2=t=>{A2[re.activeWorld]===void 0?window.location.href="/":(console.log("Connecting to "+re.activeWorld),t&&xi.set("Connecting"),C3(A2[re.activeWorld].port))},ZA=t=>{V.load(t.world,t.file,t.playerId),V.setTimeFromTickId(t.tickId),Ru=0},Ru=0,JA=async t=>{if(t===4002)xi.set("Connecting"),V.destroy();else try{if(Ru<10?xi.set("Connecting"):xi.set(`Connecting (${t})`),t===1006&&(Ru++,Ru>=20)||t>=4008)throw!0;V.destroy();let e=Ru>1?k1(500,1e3):k1(1200,1600);for(await new Promise(n=>setTimeout(n,e));document.visibilityState==="hidden";)xi.set("Browser is idle"),await new Promise(n=>setTimeout(n,e));await GA(re.lastConnectedChar)}catch{return window.location.href="/",!1}P2(!1)},KA=(t,e)=>{b3(e),mA(t,e,V.state<=2),QA(e),V&&V.player?(_y(t),UA(t),V.tick(t),OA(t),CA(t,V),$A(t,V)):V&&V.tick(t)};var d0=class{constructor(){this.nodes=new Map,this.width=-0,this.height=-0,this.depth=-0,this.yd=-0,this.zd=-0,this.xm=-0,this.ym=-0,this.zm=-0,this.xs=-0,this.ys=-0,this.zs=-0,this.dirty=!1}setDimensions(e,n,i,s,o,r){this.clear(),this.dirty=!0;let l=Math.floor(e/s),a=Math.floor(n/o),c=Math.floor(i/r);this.width=e,this.height=n,this.depth=i,this.yd=a,this.zd=c,this.xm=l-1,this.ym=a-1,this.zm=c-1,this.xs=e/l,this.ys=n/a,this.zs=i/c}clear(){this.nodes.clear()}add(e,n){let i=Math.max(0,Math.min(this.xm,~~(n[0]/this.xs))),s=Math.max(0,Math.min(this.ym,~~(n[1]/this.ys))),o=Math.max(0,Math.min(this.zm,~~(n[2]/this.zs))),r=Math.max(0,Math.min(this.xm,~~(n[3]/this.xs))),l=Math.max(0,Math.min(this.ym,~~(n[4]/this.ys))),a=Math.max(0,Math.min(this.zm,~~(n[5]/this.zs)));for(let c=i;c<=r;++c)for(let f=s;f<=l;++f)for(let u=o;u<=a;++u){let m=c*this.yd*this.zd+f*this.zd+u;this.nodes.has(m)||this.nodes.set(m,{aabbs:[],content:[],count:0});let g=this.nodes.get(m);g.content.push(e),g.aabbs.push(n),g.count++}}queryAABB(e){let n=Math.max(0,Math.min(this.xm,~~(e[0]/this.xs))),i=Math.max(0,Math.min(this.ym,~~(e[1]/this.ys))),s=Math.max(0,Math.min(this.zm,~~(e[2]/this.zs))),o=Math.max(0,Math.min(this.xm,~~(e[3]/this.xs))),r=Math.max(0,Math.min(this.ym,~~(e[4]/this.ys))),l=Math.max(0,Math.min(this.zm,~~(e[5]/this.zs))),a=[];for(let c=n;c<=o;++c)for(let f=i;f<=r;++f)for(let u=s;u<=l;++u){let m=c*this.yd*this.zd+f*this.zd+u;if(this.nodes.has(m)){let g=this.nodes.get(m);for(let v=0;v<g.count;++v){let _=g.content[v];GS(g.aabbs[v],e)&&!a.includes(_)&&a.push(_)}}}return a}queryRay(e,n,i){let s=e[0]+n[0],o=e[1]+n[1],r=e[2]+n[2],l=Math.max(0,Math.min(this.xm,~~(Math.min(e[0],s)/this.xs))),a=Math.max(0,Math.min(this.ym,~~(Math.min(e[1],o)/this.ys))),c=Math.max(0,Math.min(this.zm,~~(Math.min(e[2],r)/this.zs))),f=Math.max(0,Math.min(this.xm,~~(Math.max(e[0],s)/this.xs))),u=Math.max(0,Math.min(this.ym,~~(Math.max(e[1],o)/this.ys))),m=Math.max(0,Math.min(this.zm,~~(Math.max(e[2],r)/this.zs))),g=[];for(let v=l;v<=f;++v)for(let _=a;_<=u;++_)for(let b=c;b<=m;++b){let y=v*this.yd*this.zd+_*this.zd+b;if(this.nodes.has(y)){let k=this.nodes.get(y);for(let A=0;A<k.count;++A){let S=k.content[A];YS(k.aabbs[A],e,i,0,1)&&!g.includes(S)&&g.push(S)}}}return g}queryNodeContents(e,n,i){e=Math.max(0,Math.min(this.xm,~~(e/this.xs))),n=Math.max(0,Math.min(this.ym,~~(n/this.ys))),i=Math.max(0,Math.min(this.zm,~~(i/this.zs)));let s=e*this.yd*this.zd+n*this.zd+i;return this.nodes.has(s)?this.nodes.get(s).content:[]}};var oi={origin:[0,0,0],dir:[0,-1,0],invDir:[0,0,0]},h0=(t,e,n,i,s,o,r)=>{X(t.origin,e,n,i),X(t.dir,s,o,r),Cm(t.invDir,t.dir)};var g0=class{constructor(e){this.entity=e,this.buffs=new Map,this.casters=new Map,lu.forEach(n=>{this[n]=new Set}),this.tags=new Map;for(let n=0;n<13;++n)this.tags.set(n,new Set)}tick(e,n,i){}setBuff(e,n,i,s,o,r){i<=0&&console.error("buff with zero or less stacks");let l=this.buffs.get(e)||this.buffs.set(e,new Map).get(e),a=l.get(n)||{};if(a.caster=n,a.id=e,a.level=r,a.stacks=i,a.logic=bl.get(e),a.timer=new kt(s,o),a.active=!0,a.uniqueInstances=0,a.remove=!1,a.logic.intervalDuration!==void 0){let f=s;a.interval&&(f=a.interval.start);let u=V.entity(n);a.interval=new kt(f,a.logic.intervalHaste&&u!==void 0?a.logic.intervalDuration/SF(u.stats.getStat(16)):a.logic.intervalDuration)}else a.interval=new kt(0,0);return l.set(n,a),a.logic.onSet(a,n,this),(this.casters.get(n)||this.casters.set(n,new Map).get(n)).set(e,a),a.logic.unique&&this.updateUniqueState(e),a}removeBuff(e,n){let i=this.buffs.get(e);if(i){let s=i.get(n);if(s){s.logic.onRemove(s,n,this),i.delete(n),i.size===0&&this.buffs.delete(e);let o=this.casters.get(n);return o.delete(e),o.size===0&&this.casters.delete(n),s.logic.unique&&this.updateUniqueState(e),s}}}updateUniqueState(e){let n=this.buffs.get(e);if(n){let i;n.forEach((s,o)=>{(!i||s.level>i.level)&&(i=s),s.active=!1,s.uniqueInstances=n.size}),i.active=!0}}clear(e,n=!1){this.buffs.forEach((i,s)=>{i.forEach((o,r)=>{(!n||r!==this.entity.id)&&o.logic.passive==e&&o.logic.clearOnDeath&&this.removeBuff(s,r)})})}clearTempBuffs(){this.clear(!1)}clearPassiveBuffs(){this.clear(!0)}onDeath(){this.clearTempBuffs()}hasAnyWithTag(e){return this.tags.get(e).size>0}};var Wi=[5,4,0,2,3,8,9],Gi=(t,e,n,i)=>{let s=t.entity.mount!==void 0;t.walking=!s&&t.walking,ez(t,s),tz(t,s),KR(t,s),JR(t,e,n,i,s),ZR(t,e,n,i,s)},ZR=(t,e,n,i)=>{if(t.body[0].visible&&t.entity.buffs.visualIncapacitate>0){Kn(t.body[0].rotation,(Math.sin(n*2.2)+Math.sin(n*2.1)*.3)*.3+1,(Math.sin(n*2.1)+Math.sin(n*2)*.6)*.3,(Math.sin(n*.8)+Math.sin(n*2.3)*.5)*.3);for(let s=2;s<=3;++s)t.body[s].position[1]-=.2}},JR=(t,e,n,i,s)=>{let o=t.body[2];if(o.visible&&(t.body[6]!==void 0&&(t.sheathed||(s?ji(t,!0):t.entity.target&&!t.walking&&!t.falling?(o.rotation[0]+=1,o.rotation[2]+=.6,o.position[2]-=.3,o.position[1]-=.2,o.position[0]-=.1,t.body[4].position[0]-=.05,t.body[5].position[0]+=.05,t.body[4].position[2]-=.2,t.body[0].position[1]+=-.05+Math.sin(n*3)*.05,t.body[0].rotation[1]-=Math.cos(n*3)*.05):(o.rotation[0]+=.5,o.position[1]-=.2,o.position[0]-=.1))),t.currentAnim&&t.currentAnim.info.movement!==13)){let l=Qt.easeInOutCubic(t.currentAnim.fract),a=-Math.sin(l*7.5-1.5),c=-Math.sin(l*6.28),f=-Math.sin(l*3.14),u=Qt.easeOutExpo(-f);switch(hn(o.rotation,o.rotation,1-u),t.currentAnim.info.movement){case 0:if(t.body[6]!==void 0)ji(t,!1),Kn(o.rotation,f*1.7,u*1.5,a*u+u*.5),o.position[2]-=f-l*u,o.position[1]+=Math.sin(l*13+3)*u*.5,o.position[0]+=(-.5+l*1.5)*u,t.body[0].rotation[1]+=c*1.5;else{let m=Math.cos(l*6.28);t.body[0].position[2]+=(.3+Math.sin(l*6.28-3.14)*.2)*u,t.body[0].rotation[0]+=Math.sin(l*3.28)*.5*u;for(let g=0;g<=1;++g){let v=t.body[2+g];v.visible&&(hn(v.position,v.position,1-u),v.position[2]+=(1-m*.5)*u,v.position[1]+=Math.sin(l*6.28)*(l>.5?.7:1),v.position[0]+=(g?.5+f*.2:-.5-f*.2)*u,X(v.rotation,0,1.5,0))}}break;case 1:ji(t,!1),o.rotation[0]-=f*1.7,o.rotation[1]+=u*1.5-u,o.rotation[2]+=a*u+u*.5,o.position[2]+=u,o.position[0]-=u*.5,t.body[0].rotation[1]-=c*1.5-u*.5;break;case 12:ji(t,!1),o.rotation[0]=1.7,o.rotation[1]=0,o.rotation[2]=.5,o.position[2]=1.3,o.position[1]=.2,o.position[0]=-.5;break;case 4:ji(t,!1),o.rotation[0]+=f*1.7,o.rotation[1]-=f*1.5,o.position[0]-=u*.5,t.body[0].rotation[1]=l*2*Math.PI+u*3;break;case 3:{ji(t,!0),X(t.body[0].rotation,f,0,0),X(o.position,-.3,0,.7);break}case 11:{ji(t,!1),X(t.body[0].rotation,f*.4,0,f*.3),o.rotation[0]-=f*.8,o.rotation[1]+=f*.4;break}case 9:{ji(t,!1),X(o.rotation,0,0,0);break}case 5:{ji(t,!0);break}}}let r=t.body[3];t.body[7]!==void 0&&r.visible&&(t.entity.target&&!t.walking&&!t.falling?(r.rotation[2]-=.2,r.rotation[1]-=1,r.position[1]+=.1,r.position[2]+=.4):(r.rotation[2]-=.1,r.position[1]+=.1))},KR=(t,e)=>{for(let n=0;n<=1;++n){let i=t.body[4+n];if(i.visible)if(e)X(i.rotation,-.9,n?.2:-.2,n?.4:-.4),X(i.position,n?.6:-.6,-.4,.5);else{let s=al(t.entity.steer);if(t.currentAnim&&t.currentAnim.info.movement===10){X(i.position,0,0,0);continue}if(t.falling)if(t.flip==0){let o=Math.max(-1,Math.min(0,t.entity.vel[1]*.2))*.1,r=n?t.cycle(0)*.3-o:t.cycle(.5)*.3+o;X(bt,n?.3-o:-.3+o,-.65,r),zr(i.position,bt,0),X(i.rotation,-r,s,0)}else X(i.position,n?.3:-.3,-.3,0),X(i.rotation,0,0,0);else if(t.entity.inWater>t.entity.radius)t.walking?(X(i.rotation,1.3,n?.1:-.1,0),X(i.position,n?.3:-.3,Math.cos(t.cycleRad+n*Math.PI)*.4,-1.1)):(X(i.rotation,1,n?.1:-.1,0),X(i.position,n?.3:-.3,-.7,Math.cos(t.cycleRad+n*Math.PI)*.4));else{if(t.walking){let o=t.entity.steer[1]<0?.4:.6,r=t.cycle(0)*o*1.3;X(bt,n?.3:-.3,Math.max(0,Math.cos(t.cycleRad+(n?0:Math.PI))*.6)-.55,t.cycle(n?0:.5)*o),zr(i.position,bt,s),X(i.rotation,n?-r:r,s,0)}else X(i.rotation,0,n?.1:-.1,0),X(i.position,n?.45:-.45,-.65,0);t.currentAnim&&!t.walking&&(t.currentAnim.info.movement==5||t.currentAnim.info.movement==13||t.currentAnim.info.movement==6||t.currentAnim.info.movement==9)&&X(i.position,n?.4:-.55,-.65,n?.2:-.3)}}}},ez=(t,e)=>{let n=t.body[0],i=n.position,s=n.rotation;if(n.visible){if(!t.falling||e?(t.walking?t.entity.inWater>t.entity.radius?X(i,0,-.1,0):X(i,0,Math.cos(t.cycleRad*2)*.1+.4,0):t.entity.inWater>t.entity.radius?X(i,0,.3,0):X(i,0,e?.5:t.cycle(0)*.1+.4,0),t.transform.rotation[0]!==0&&(t.transform.rotation[0]=0)):(t.transform.rotation[0]=t.cycleRad*t.flip,X(i,0,t.flip!=0?.3:.5,0)),t.entity.inWater>t.entity.radius)t.walking?X(s,1.2,0,Math.sin(t.cycleRad)*.1):X(s,Math.sin(t.cycleRad)*.1-.1,0,Math.cos(t.cycleRad)*.05);else{X(s,-t.pushBack[1]*5+t.movementPushback[2],0,t.pushBack[0]*5-t.movementPushback[0]),Up(i,i,t.pushBackOffset),on(i,i,t.movementPushback,1);let o=-t.movementPushback[1]*.5;X(n.scale,1+o,1-o,1+o)}if(t.currentAnim!==void 0){let o=t.currentAnim.info.movement;if((o==5||o==6)&&(s[1]-=.3+.05*t.cycle(.2),s[0]+=.3+.02*t.cycle(.4),i[1]-=.1+.05*t.cycle(.6),i[0]-=.05),o==6)s[1]*=1-t.currentAnim.fract;else if(o==10)X(i,0,.2+Math.sin(t.currentAnim.fract*Math.PI)*.5,0),s[0]+=t.currentAnim.fract*ll,s[1]+=al(t.entity.steer);else if(o==9){let r=Qt.easeOutQuad(vt(t.currentAnim.fract*2,0,1));i[1]+=Math.sin(3+r*5)*.2,s[0]+=.5-r*.5}else o==12?s[1]=t.currentAnim.fract*Math.PI*2:o==13&&(i[2]-=.2+t.cycle(.4)*.05,s[0]=-.2+t.cycle(.8)*.12,s[1]=-.2,s[2]=.2+t.cycle(.15)*.05)}}},tz=(t,e)=>{for(let n=0;n<=1;++n){let i=t.body[2+n];if(i.visible){if(!t.falling||e)if(t.entity.inWater>t.entity.radius)if(t.walking){let s=t.cycle(0),o=t.entity.steer[1]<0?.3:.5,r=Math.sin(t.cycleRad*2+5);X(i.rotation,0,s*o*1.3+(n?Math.PI:0),0),X(i.position,(n?.7:-.7)+r*(n?-.2:.2),.2+s*o*(n?-1.5:1.5),-.2+s*(n?-.3:.3))}else{let s=Math.cos(t.cycleRad+n*2);X(i.rotation,0,(n?-.43+Math.PI:.43)+s*.15*(n?1:-1),.3),X(i.position,n?.7:-.7,s*.05-.2,.6-s*.2)}else if(t.walking){let s=t.cycle(0),o=t.entity.steer[1]<0?.3:.5,r=Math.sin(t.cycleRad*2+5);X(i.rotation,0,s*o*1.3+(n?Math.PI:0),0),X(i.position,(n?.7:-.7)+r*(n?-.2:.2),-.2+s*(n?.3:-.3),.2+s*o*(n?-1.5:1.5)),i.position[0]=n?Math.max(.5,i.position[0]):Math.min(-.5,i.position[0])}else if(e)X(i.rotation,0,n?-1.3+Math.PI:1.3,.3),X(i.position,n?.3:-.3,-.5,.7);else{let s=t.cycle(0);X(i.rotation,0,(n?-.43+Math.PI:.43)+s*.15*(n?1:-1),.3),X(i.position,n?.7:-.7,-.3+s*.08,.15-s*.1)}else X(i.position,n?.6:-.6,-vt(t.entity.vel[1],-5,5)/20,0),i.position[0]+=(n?1:-1)*Math.sin(i.position[1]*3.1+.8)*.3,X(i.rotation,0,n?Math.PI:0,-.3-i.position[1]);if(t.currentAnim){let s=t.currentAnim.info.movement;if(s==5||s==6)n==0?(i.position[0]-=.2,i.position[1]-=.2,s==6&&(hn(i.position,i.position,1-t.currentAnim.fract),i.position[0]+=-t.currentAnim.fract*.3,i.position[2]+=Math.sin(Math.min(.5,t.currentAnim.fract)*7+4)*.8+.4)):(i.position[0]-=.4,i.position[2]+=.5-t.cycle(.3)*.2,i.rotation[1]+=.6+t.cycle(.4)*.2,i.rotation[0]-=.8,s==6&&(hn(i.position,i.position,1-t.currentAnim.fract),i.position[0]+=t.currentAnim.fract*.3,i.position[2]+=Math.sin(Math.min(.5,t.currentAnim.fract)*7+4)*.7+.3));else if(s===9){let o=Qt.easeInOutCubic(vt(t.currentAnim.fract*2,0,1));X(i.rotation,1-o,0,0);let r=Math.sin(o*3);n==0?X(i.position,-.12-r*.35,-.1+o*1.2,.3+r):X(i.position,.12+r*.35,o*1.2,.3+r)}else if(s===11){let o=Math.sin(Qt.easeInOutCubic(t.currentAnim.fract)*3);i.position[0]+=o*(n?.3:0),i.position[1]=o*(n?-.2:1)-.3,i.position[2]=o*(n?-.3:1)}else s===13&&(i.position[0]=n?.6:0,i.position[1]=n?.7:1,i.position[2]=.8,i.rotation[0]=n?t.cycle(.4)*.2:t.cycle(.2)*.2,i.rotation[1]=n?2:1,i.rotation[2]=n?2:1)}if(t.body[8+n]){let s=t.body[8+n];s.visible&&(Ur(s,i.position,!1,vp),hn(s.rotation,s.rotation,.5),s.rotation[1]-=n?.8:-.8,s.rotation[2]-=n?.5:-.5)}}}},ji=(t,e)=>{t.sheathed!==e&&(t.sheathed=e,t.body[6]!==void 0&&(Cn(t.body[6],e?t.body[0]:t.body[2]),t.sheathed?st(t.body[6].position,t.skin.sheathedPos):st(t.body[6].position,t.skin.unsheathedPos),t.body[6].matrixNeedsUpdate=!0),t.body[7]!==void 0&&(Cn(t.body[7],e?t.body[0]:t.body[3]),t.sheathed?(X(t.body[7].position,0,-.2,-.65),X(t.body[7].rotation,0,-1.57,0)):(X(t.body[7].position,-.2,0,0),X(t.body[7].rotation,0,0,0)),t.body[7].matrixNeedsUpdate=!0))};var T2=[5,4,0,2,3],E2=(t,e,n,i)=>{let s=t.body[3];if(s.visible&&(X(s.rotation,.2,1.7+t.cycleSin*.15,.4),X(s.position,.1+t.cycleSin*.2,-.3,.9),t.entity.target>0&&(s.position[0]=.2,s.position[1]+=.15,s.position[2]+=.1,s.rotation[0]+=.2,s.rotation[1]=1.8,s.rotation[2]-=.2),t.currentAnim))switch(t.currentAnim.info.movement){case 5:{ji(t,!1);let o=Qt.easeOutQuad(vt(t.currentAnim.fract*2,0,1));X(s.rotation,1.2,2,.3),X(s.position,.2,0,.8+o*.8),X(t.body[2].position,-.1-Math.sin(o*2)*.6,o*.1,.8-o*.8),X(t.body[0].position,0,.6-o*.2,0),X(t.body[0].rotation,.2-o*.2,-.4+o*.3,0);break}case 7:{ji(t,!1);let o=Qt.easeOutFlick(vt((t.currentAnim.fract-.5)*2,0,1));X(s.rotation,1.2,2,.3+o*.1),X(s.position,.2,o*.3,1.6),X(t.body[2].position,-.7,.1,-o*.7),X(t.body[0].position,0,.4,0),X(t.body[0].rotation,0,-.1,0);break}case 8:{ji(t,!1);let o=Qt.easeOutQuad(vt(t.currentAnim.fract*2,0,1));X(t.body[2].position,-.5-o*.3,-.3+o*.3,Math.sin(o*6.28)*.6),X(s.rotation,.2+.5*o,2,.3),X(s.position,.2,-.4+o*.3,.8+o*.8),t.body[0].rotation[1]=0,t.body[0].rotation[0]=-.2+o*.2}break}!t.walking&&t.body[4].visible&&(t.body[4].position[2]-=.3,t.body[5].position[2]+=.1)};var eP=[2],tP=(t,e,n,i)=>{let s=t.body[2];Kn(s.rotation,.9,-.4,0),s.position[2]-=.1};var nP=[0,16,17],iP=(t,e,n,i)=>{let s=t.cycle(.5);if(X(t.body[0].scale,s*.1+1,1+t.cycleSin*.1,s*.1+1),X(t.body[0].position,0,-.2+t.cycleSin*.1,0),X(t.body[0].rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5),Up(t.body[0].position,t.body[0].position,t.pushBackOffset),t.currentAnim){let o=Qt.easeOutExpo(t.currentAnim.fract**3);switch(t.currentAnim.info.movement){case 0:t.body[0].position[2]+=Math.sin(o*6.28-3.14);break}}for(let o=0;o<2;++o){let r=t.body[16+o];if(r.visible=t.transform.visible,!r.visible)continue;for(let c=0;c<r.children.length;++c)r.children[c].visible=!0;let l=o==0?t.transform:t.body[16+o-1];Xt(bt,l.position,r.position),X(el,0,0,-l.scale[0]*.7),zr(kn,el,l.rotation[1]),zn(bt,bt,kn);let a=mi(bt);a>30*t.entity.size?st(r.position,t.entity.pos):on(r.position,r.position,bt,Math.max(0,Math.min(.5,20*e*(a-r.scale[1]*.7)))),X(r.rotation,0,zp(Xt(bt,l.position,r.position)),0),pi(r.scale,(3-o)*.3*(.8+t.cycle(o*.3)*.1)*t.transform.scale[0]),r.position[1]=Math.max(t.entity.pos[1]+r.scale[1]*.5,r.position[1]-e*2.5),Rt(r,!1)}};var sP=[2,3],oP=(t,e,n,i)=>{if(!t.currentAnim)for(let s=0;s<2;++s){let o=t.body[2+s];if(!o.visible)continue;let r=t.cycle(1.3);X(o.rotation,.78,0,s?r*.2:-r*.2),X(o.position,s?.2:-.2,-.4,.6)}};var rP=[0,4,5],lP=(t,e,n,i)=>{let s=t.body[0],o=t.body[4],r=t.body[5];if(t.walking&&!t.falling){t.speed=t.entity.speed*(t.entity.steer[1]===-1?-1.2:1)*.04/(.6+t.entity.size*.6);let l=Math.cos(t.cycleRad);X(o.rotation,0,t.cycleSin*.2,t.cycleSin*.2),X(o.position,0,Math.abs(l)*.3+.2,0),X(r.rotation,0,Math.PI+l*.2,l*.2),X(r.position,0,Math.abs(t.cycleSin)*.3,0),X(s.position,t.cycle(.3)*.01,t.cycleSin*.02,0),X(s.rotation,0,t.cycleSin*.01,Math.sin(t.cycleRad*2)*.01),t.entity.target>0&&Math.random()<.3&&t.fraction(.1,e)&&t.playSound(t.stepset[0],!1)}else{if(t.speed=.5,t.currentAnim){let l=Qt.easeOutExpo(t.currentAnim.fract**3);switch(t.currentAnim.info.movement){case 0:{let a=Math.sin(l*6.28-3.14);X(s.position,0,Math.max(0,-a),a*.5);for(let c=0;c<2;++c){let f=c==0?o:r,u=c==0?1:-1,m=c==1?Math.PI:0;X(f.rotation,u*Math.min(a,0),m+a*.1*u,0),X(f.position,0,Math.max(0,-a),a*.5)}break}}}else{let l=t.cycle(-.1)*.05;X(s.position,0,t.cycle(-.1)*.1,0);for(let a=0;a<2;++a){let c=a==0?o:r;X(c.rotation,0,a==1?Math.PI:0,t.falling?.4:l*.5),X(c.position,0,0,0)}}X(s.rotation,0,0,0)}Kn(s.rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5)};var aP=[],cP=(t,e,n,i)=>{X(t.transform.rotation,-t.pushBack[1]*2,t.entity.rot,t.pushBack[0]*2)};var fP=[0,2,3,16],uP=(t,e,n,i)=>{let s=t.body[0],o=t.body[2],r=t.body[3],l=25/o.scale[0],a=n+t.entity.id;if(X(s.rotation,Math.sin(a*l/8)*.15,0,Math.sin(a*l/10)*.07),Kn(s.rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5),X(s.position,0,1+Math.sin(a*18)*.1,0),t.body[16]!==void 0){let f=t.body[16];f.position[1]=f.data.skin.pos[1]+Math.sin(a*18+2.75)*.1}let c=Math.sin(a*l)*.7;for(let f=0;f<2;++f){let u=f==0,m=u?o:r;m.rotation[2]=m.data.skin.rot[2]+(u?Math.PI-c:c)}if(t.currentAnim&&t.currentAnim.info.movement===0){let f=t.currentAnim.fract,u=Math.sin(Zo(f,.2,-.4)*3.14)*1.5;if(s.position[2]+=u,s.rotation[0]+=u*.4,f>.65){let m=Qt.easeOutQuad(hs(f,.65,1,0,1));s.rotation[0]-=m*Math.PI*2,s.position[1]+=Math.sin(m*Math.PI)*1.5}}};var mP=[0,2,3],pP=(t,e,n,i)=>{for(let s=0;s<2;++s){let o=t.body[2+s];o.position[1]*=.8,o.position[2]*=.8,o.position[1]+=.5;let r=t.body[4+s];r.position[1]-=0,r.position[0]+=s?.4:-.4}X(t.body[0].scale,1.8,2,1.8),t.body[0].position[1]+=1};var dP=[2],hP=(t,e,n,i)=>{X(t.body[2].position,-.8,-.2,.7),X(t.body[2].rotation,1.8+t.cycleSin*.1,0,0)};var gP=[17,0,16,21,2,3,4,5],vP=(t,e,n,i)=>{let s=t.body[4].scale[1];t.currentAnim&&t.currentAnim.info.movement===0?hz(t,s):mz(t,s)},mz=(t,e)=>{let n=hs(t.entity.speed/20/(.2+t.entity.size*.8),3,10,0,1),i=hs(n,0,1,.6,.4),s=hs(n,0,1,.5,.2);t.speedMultiplier=hs(n,0,1,1,.5),pz(t,s,i,e),dz(t,s,i,e)},pz=(t,e,n,i)=>{let s=0,o=0,r=0,l=0,a=0,c=0,f=0,u=hs(e,.2,.5,.5,1);t.walking?(s=Math.sin(t.cycleRad*2-1)*.07,r=Math.sin(t.cycleRad*2)*.07,o=-t.cycle(0)*.1*u,a=Math.sin(t.cycleRad*2+n)*.05,l=-t.cycle(n)*.07*u,c=t.cycle(n+.2)*.3,f=0):(s=t.cycle(.3)*.03,r=t.cycle(.35)*.02,a=t.cycle(0)*.02-.05,c=Math.sin(t.cycleRad*2)*.07,f=t.cycle(.3)*.1);let m=t.body[17];X(m.position,0,i*.8+s-.15,1.2),X(m.rotation,.1,f,0);let g=t.body[0];X(g.position,0,i*.7+r-.15,.5),X(g.rotation,-.06,o*1.3,o);let v=t.body[16];X(v.position,0,i*.75+a-.15,-.35),X(v.rotation,.04,l*1.3,l);let _=t.body[21];X(_.position,-c*.35,-.18+s*.5,-.67),X(_.rotation,.6,c,0)},dz=(t,e,n,i)=>{let s=[2,3,4,5];for(let o=0;o<4;++o){let r=s[o],l=t.body[r],a=o%2==0,c=o<2,f=-.75+i*.5,u=c?.8:-.6,m=c?.35:.26,g=t.entity.steer[1]<0?-.5:1;if(t.walking){let v=(a?0:e)+(c?0:n),_=t.cycleScaled(v,g),b=Math.max(0,t.cycleScaled(v-Math.PI,g)*.3);u-=_*.4,X(l.rotation,_,0,0),X(l.position,a?-m:m,f+b,u)}else X(l.rotation,0,a?-.2:.2,0),X(l.position,a?-m:m,f,u)}},hz=(t,e)=>{let n=t.currentAnim.fract,i=Math.sin(Zo(n,.2,-.4)*3.14)*1.5,s=[2,3,4,5];for(let f=0;f<4;++f){let u=s[f],m=t.body[u],g=f%2==0,v=f<2,_=-.75+e*.5,b=(v?.8:-.6)+i*.2,y=v?.35:.26;X(m.rotation,i*.5,0,0),X(m.position,g?-y:y,_,b)}let o=t.body[17];X(o.position,0,.8*e-.15,1.2+i*.4),X(o.rotation,i*.4,0,Math.sin(i*3)*.5);let r=t.body[0];X(r.position,0,.7*e-.15,.5+i*.4),X(r.rotation,-.06,0,0);let l=t.body[16];X(l.position,0,.75*e-.15,-.35+i*.4),X(l.rotation,.04,0,0);let a=t.body[21],c=Math.max(i,0);X(a.position,0,-.18*.5+c*.3,-.67),X(a.rotation,.6+c,0,0)};var _P=[2,3,4,5],bP=[[-.6,-.5,.5],[.6,-.5,.5],[-.6,-.5,-.5],[.6,-.5,-.5]],yP=[2,3,4,5,0,16,21,17,19,20],kP=(t,e,n,i)=>{let s=t.body[4].scale[1];t.currentAnim&&t.currentAnim.info.movement===0?vz(t,s):_z(t,s)},vz=(t,e)=>{xz(t,e),wz(t,e),Mz(t,e)},_z=(t,e)=>{t.speedMultiplier=.8,bz(t,e),yz(t,e),kz(t,e)},bz=(t,e)=>{let n=t.body[0],i=t.body[16],s=t.body[21],o=e-.9+n.scale[1]*.5;if(t.walking){let r=t.cycle(0)*.2;n.position[1]=o+Math.sin(t.cycleRad*2)*.05,i.position[1]=o+Math.sin(t.cycleRad*2+.5)*.05,X(n.rotation,0,r,0),X(i.rotation,0,-r,0),s&&(s.position[1]=s.data.skin.pos[1]+o+Math.sin(t.cycleRad*2)*.05)}else n.position[1]=o,i.position[1]=o,X(n.rotation,0,0,0),X(i.rotation,0,0,0),s&&(s.position[1]=s.data.skin.pos[1]+o+Math.sin(t.cycleRad)*.05);n.matrixNeedsUpdate=!0,i.matrixNeedsUpdate=!0,uo(n),uo(i)},yz=(t,e)=>{let n=t.walking?.2:.08,i=t.body[17];i!==void 0&&X(i.rotation,0,t.cycle(.4)*n,0);let s=t.body[19];s!==void 0&&X(s.rotation,0,t.cycle(.2)*n,0);let o=t.body[20];o!==void 0&&X(o.rotation,0,t.cycle(t.walking?.1:.9)*n,0)},kz=(t,e)=>{let n=t.walking,i=n?t.cycle(0)*.5:0,s=n?t.cycle(.25)*.5:0,o=n?t.cycle(.75)*.5:0,r=t.entity.steer[1]<0?-.5:1;for(let l=0;l<4;++l){let a=_P[l],c=t.body[a],f=l%2==0,u=l<2,m=t.body[u?0:16],g=bP[l];Mi(c.position,g,m.matrix);let v=0,_=0;f&&u||!u&&!f?(v=s,_=i):(v=o,_=-i),c.position[1]+=Math.max(0,v*.5),c.position[2]+=_*r*.4,c.rotation[0]=-_*r}},xz=(t,e)=>{let n=t.currentAnim.fract,i=Math.sin(Zo(n,.2,-.4)*3.14)*1.5,s=t.body[0],o=t.body[16],r=t.body[21],l=e-1+s.scale[1]*.5;X(s.position,0,l,s.data.skin.pos[2]+i*.4),X(s.rotation,0,i*.2,0),X(o.position,0,l,o.data.skin.pos[2]+i*.4),X(o.rotation,0,-i*.2,0),r!==void 0&&(X(r.position,0,r.data.skin.pos[1]+l,r.data.skin.pos[2]+i*.4),X(r.rotation,0,0,0)),s.matrixNeedsUpdate=!0,o.matrixNeedsUpdate=!0,uo(s),uo(o)},wz=(t,e)=>{let n=t.currentAnim.fract,i=Math.sin(Zo(n,.2,-.4)*3.14)*1.5,s=t.body[17];s!==void 0&&X(s.rotation,i*.4,0,Math.sin(i*3)*.5);let o=t.body[19];o!==void 0&&X(o.rotation,0,i*.5,0);let r=t.body[20];r!==void 0&&X(r.rotation,0,i*.5,0)},Mz=(t,e)=>{let n=t.currentAnim.fract,i=Math.sin(Zo(n,.2,-.4)*3.14)*1.5;for(let s=0;s<4;++s){let o=_P[s],r=t.body[o],l=s<2,a=t.body[l?0:16],c=bP[s];Mi(r.position,c,a.matrix),X(r.rotation,i*.5,0,0)}};var xP=[18,3],wP=(t,e,n,i)=>{X(t.body[18].rotation,0,0,n*.3),X(t.body[3].position,.8,-.2,.7),X(t.body[3].rotation,1.8,0,0)};var v0=[5,4,0,2,3],_0=(t,e,n,i)=>{Kn(t.body[0].rotation,(Math.sin(n*1.8)*Math.cos(n*12)*.3+Math.sin(n*1.4)*.3)*.1-.2,(Math.sin(n*1.3)+Math.sin(n*2.4)*.6)*.15,(Math.sin(n*.2)+Math.sin(n*1.9)*.5)*.2);for(let s=0;s<=1;++s){let o=t.body[2+s];o.visible&&Kn(o.rotation,(Math.sin(n*2)*Math.cos(n*9)+Math.sin(n*1.3))*.2,(Math.sin(n*2-2)*Math.cos(n*7)+Math.sin(n*.8))*.3,0);let r=t.body[4+s];r.visible&&(r.rotation[1]+=Math.sin(n*.2-s)*.3,r.position[0]+=s?.15:-.15)}};var MP=[2],FP=(t,e,n,i)=>{t.body[2].position[2]+=.6,Kn(t.body[2].rotation,-2.1,-4.1,-.2)};var CP=[2,3,0],SP=(t,e,n,i)=>{if(t.currentAnim===void 0||t.currentAnim.info.movement===0)for(let s=0;s<2;++s){let o=t.body[2+s],r=Math.sin(n*4+s);X(o.position,s?.5:-.5,r*.2,1),X(o.rotation,0,1.5,-r*.2)}Kn(t.body[0].rotation,(Math.sin(n*1.8)*Math.cos(n*2)*.3+Math.sin(n*1.4)*.3)*.1+.2,(Math.sin(n*1.3)+Math.sin(n*2.4)*.6)*.1,(Math.sin(n*.4)+Math.sin(n*1.9)*.5)*.1)};var AP=[[Gi,E2],[Gi,tP],[iP],[Gi,oP],[lP],[cP],[Gi,pP],[Gi],[],[Gi,hP],[Gi,wP],[Gi,_0],[Gi,E2,_0],[Gi,_0],[Gi,FP],[Gi,SP],[vP],[kP],[uP]],PP=[new Set([...Wi,...T2]),new Set([...Wi,...eP]),new Set([...nP]),new Set([...Wi,...sP]),new Set([...rP]),new Set([...aP]),new Set([...Wi,...mP]),new Set([...Wi]),new Set,new Set([...Wi,...dP]),new Set([...Wi,...xP]),new Set([...Wi,...v0]),new Set([...Wi,...T2,...v0]),new Set([...Wi,...v0]),new Set([...Wi,...MP]),new Set([...Wi,...CP]),new Set([...gP]),new Set([...yP]),new Set([...fP])];var xc=class{constructor(e){this.transform=rn(),this.transform.matrixAutoUpdate=!0,this.soundPrio=e.radius>3?1:0,this.doesYell=e.type!==0,this.entity=e,this.cycleOne=0,this.cycleRad=Zt(0,1),this.cycleSin=0,this.speed=1,this.speedMultiplier=1,this.lastFlags=0,this.deathTimer=new kt(0,0),this.hurtSoundTimer=new kt(0,5),this.pushBack=[0,0],this.pushBackVel=[0,0],this.pushBackOffset=[0,0],this.movementPushback=[0,0,0],this.movementPushbackVel=[0,0,0],this.groundNormal=[0,0,0],this.cDist=1/0,this.cDistLast=1/0,this.inFog=!0,this.animQueue=[],this.currentAnim=void 0,this.eyesBlink=0,this.capeoffset=0,this.walking=!0,this.falling=!1,this.hasDied=!1,this.flip=0,this.hasJustJumped=!1,this.hasJustLanded=!0,this.sheathed=!1,this.interiorlight=[0,0,0,0],this.needsColorUpdate=!1,this.colors=new Set,this.alphas=new Set,this.currentAlpha=0,this.goalAlpha=1,this.body=[],this.meshes=[],this.effects=[],this.skin=void 0,this.soundset=void 0,this.stepset=void 0,this.skeleton=void 0,this.animset=void 0,this.colPrim=void 0,this.colSec=void 0}setSkin(e,n,i){this.skin!==void 0&&(this.removeSkin(),this.cDistLast=0,this.hasDied=!1,this.deathTimer.reset(0,0),this.removeColor(qn.death)),this.skin=c1.get(e);let s=r1.get(this.skin.soundset);this.soundset=s.sounds,this.stepset=l1.get(s.steps).steps,this.skeleton=f1.get(this.skin.skeleton),this.animset=AP[this.skin.animset],this.colPrim=n||this.skin.colPrim,this.colSec=i||this.skin.colSec;let o=PP[this.skin.animset];for(let r=0;r<this.skin.body.length;++r){let l=this.skin.body[r],a=l.col;l.colMode===1?a=this.colPrim:l.colMode===2&&(a=this.colSec);let c=this.mesh(l.bid,l.pid,o.has(l.bid),l.mid,l.lod,a,l.ts===1);c&&(st(c.position,l.pos),st(c.scale,l.scl),st(c.rotation,l.rot),c.data.skin=l)}for(let r=0;r<this.skin.effects.length;++r){let l=this.skin.effects[r];this.effects.push(Ui(l.id,this.body[l.bid],0,!1))}}removeSkin(){this.clearAnims(),this.clearMeshes(),this.clearEffects()}cycle(e){return e==0?this.cycleSin:Math.sin(this.cycleRad+2*e*Math.PI)}cycleScaled(e,n){return Math.sin(this.cycleRad*Math.sign(n)+2*e*Math.PI)*n}checkCycleReset(){let e=this.falling<<1|(!this.falling&&this.walking)<<2;e!=this.lastFlags&&(this.cycleOne=0,this.lastFlags=e)}addPushBack(e,n,i){this.cDist<50&&(this.pushBackVel[0]-=e*i/this.entity.size,this.pushBackVel[1]-=n*i/this.entity.size)}addRandomPushback(e){this.cDist<50&&(this.pushBackVel[0]-=Zt(-1,1)*e/this.entity.size,this.pushBackVel[1]-=Zt(-1,1)*e/this.entity.size)}tickPushBack(e,n,i){this.cDist<50&&(t1(this.pushBackVel,this.pushBackVel,this.pushBack,-e*1500/this.entity.size),Af(this.pushBackVel,this.pushBackVel,1-e*30),t1(this.pushBack,this.pushBack,this.pushBackVel,e),V3(this.pushBackOffset,this.pushBack,-this.entity.rot)),this.cDist<25&&(on(this.movementPushback,this.movementPushback,this.movementPushbackVel,e*60),on(this.movementPushbackVel,this.movementPushbackVel,this.movementPushbackVel,-(e*20)),on(this.movementPushbackVel,this.movementPushbackVel,this.movementPushback,-(e*10)),this.movementPushbackVel[2]+=this.entity.steer[1]*.01,this.movementPushbackVel[0]-=this.entity.steer[0]*.01)}disableVis(e){for(let n=0,i=e.children.length;n<i;++n){let s=e.children[n];s.visible=!1,this.disableVis(s)}}checkVis(e,n,i){for(let s=0,o=e.children.length;s<o;++s){let r=e.children[s];this.meshes.indexOf(r)<0||(r.visible=r.data.lod*n/this.cDist>i,r.visible?this.checkVis(r,n,i):this.disableVis(r))}}updateVisibility(){let e=this.entity.mount!==void 0?1/0:Math.max(60,Math.min(150,gt.far*.7));return this.cDist=qr(this.transform.position,gt.worldPosition),this.inFog=this.cDist>e,!this.inFog&&(!re.disableoffscreen||Th(gt,this.entity.visualPosition,this.transform.scale[1]))?(!this.hasDied&&Math.abs(this.cDistLast-this.cDist)>1&&(this.cDistLast=this.cDist,this.checkVis(this.transform,Math.max(1,this.transform.scale[1]),1.5/(45+e))),this.transform.visible=!0,!0):(this.cDistLast=0,this.transform.visible&&(this.transform.visible=!1,this.meshes.forEach(n=>n.visible=!1),this.clearAnims()),!1)}tick(e,n,i){this.updateVisibility()?(this.needsColorUpdate&&this.colorUpdate(),this.alphaUpdate(e),this.entity.stats===void 0||this.entity.stats.alive?this.entity.buffs.visualFreeze===0&&(this.cycleOne=(this.cycleOne+this.speed*e)%1,this.cycleRad=this.cycleOne*Math.PI*2,this.cycleSin=Math.sin(this.cycleRad),this.tickAnimations(e),this.falling=this.entity.inWater<this.entity.radius&&(this.falling&&!this.entity.onGround||!this.falling&&!this.entity.onGround&&Math.abs(this.entity.vel[1])>6),this.walking=this.entity.steer[0]!=0||this.entity.steer[1]!=0,this.tickVisuals(e,n,i)):this.tickDeath(e,n,i),Rt(this.transform,!1)):this.alphaUpdate(100)}tickVisuals(e,n,i){this.checkCycleReset(),this.calculateCycleSpeed(),this.body[1]!==void 0&&this.tickEyes(e,this.body[1]),this.body[10]!==void 0&&this.tickCape(e,this.body[10]),this.tickWalking(e),this.tickLanding();for(let s=0;s<this.animset.length;++s)this.animset[s](this,e,n,i);if(this.skeleton.groundNormal||this.entity.mount&&this.entity.mount.skeleton.groundNormal){let s=Math.min(1,e*10);this.groundNormal[0]+=(this.entity.groundNormal[0]-this.groundNormal[0])*s,this.groundNormal[2]+=(this.entity.groundNormal[2]-this.groundNormal[2])*s,Rp(this.transform.rotation,this.groundNormal)}else this.flip||(this.transform.rotation[0]=this.transform.rotation[2]=0)}tickFixed(e,n,i){this.hasDied||this.tickPushBack(e,n,i)}tickAnimations(e){let n=this.currentAnim=this.animQueue[0];if(n){let i=n.info,s=n.fract;if(this.animQueue.length>1&&i.priority===0?n.fract>.6?n.time+=e*5:n.time=n.info.duration:n.time+=e,n.fract=n.time/i.duration,n.time>i.duration)if(n.loop)n.fract%=1,n.time=0;else{n.fract=1,this.onAnimEnd(n),this.animQueue.shift();return}for(let o=0;o<i.sounds.length;++o){let r=i.sounds[o];r.end>0?n.fract>=r.start&&n.fract<=r.end?n.activeSounds[o]===void 0&&(n.activeSounds[o]=Js(r.id,this.transform,this.soundPrio,!0,1)):n.activeSounds[o]!==void 0&&(n.activeSounds[o].stop(),n.activeSounds[o]=void 0):n.fract>=r.start&&(s<r.start||r.start===0&&s===0)&&(n.id===4&&r.id===50?Js(this.soundset[4],this.transform,this.soundPrio,!1,1):Js(r.id,this.transform,this.soundPrio,!1,1))}for(let o=0;o<i.effects.length;++o){let r=i.effects[o];if(r.type===0&&n.fract>r.start&&s<=r.start){let l,a=!1;if(r.body===99){let c=V.entity(n.dirImpactTarget);c&&c.visual&&(l=rn(),Tm(l,c.visual.transform,this.transform,c.radius),Rt(l,!1),c.visual.addPushBack(this.transform.position[0]-c.visual.transform.position[0],this.transform.position[2]-c.visual.transform.position[2],2)),a=!0}else r.body===101?(l=rn(),st(l.position,this.transform.position),st(l.scale,this.transform.scale),st(l.rotation,this.transform.rotation),Rt(l,!1),a=!0):l=r.body===100?this.transform:this.body[r.body];if(l===void 0)continue;Ms(r.id,l,this.soundPrio,a)}else if(r.type>0)if(n.fract>=r.start&&n.fract<=r.end)if(n.activeEffects[o]===void 0){let l=r.body===100?this.transform:this.body[r.body];l&&(n.activeEffects[o]=r.type===1?Ui(r.id,l,this.soundPrio,!1):RS(r.id,l,this.soundPrio,!1))}else{let l=n.activeEffects[o];r.type===1||(l.fractionLast=l.fractionNow,l.fractionNow=Math.min(1,Math.max(0,1-(r.end-n.fract)/(r.end-r.start))))}else n.activeEffects[o]!==void 0&&(n.activeEffects[o].done=!0,n.activeEffects[o]=void 0)}}}tickEyes(e,n){if(n.visible){let i=0;this.eyesBlink>0?i=this.eyesBlink-e:Math.random()<.006?i=.1:i=this.eyesBlink,(this.eyesBlink>0&&i<0||i>0&&this.eyesBlink<0)&&(n.scale[1]=i>0?.1:n.scale[0],n.matrixNeedsUpdate=!0),this.eyesBlink=i}}tickCape(e,n){n.visible&&this.skin.capeswing&&((this.entity.steer[1]>0||this.falling)&&(this.capeoffset+=mi(this.entity.vel)*.5*e),this.capeoffset=Math.max(0,Math.min(2,this.capeoffset*(1-e*3))),X(n.rotation,this.capeoffset,0,0))}tickLanding(){this.entity.inWater>this.entity.radius||(this.hasJustJumped&&this.entity.onGround&&(this.cDist<20&&this.entity.vel[1]<-4&&(this.soundPrio===1&&this.playSound(56,!0),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.15,this.eyesBlink=.3),this.hasJustLanded=!0,this.hasJustJumped=!1,this.flip=0),this.hasJustLanded&&!this.entity.onGround&&(this.entity.vel[1]>5&&(this.soundPrio===1&&this.playSound(57,!0),Math.random()<.5&&(this.flip=this.entity.steer[1]),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.1,this.eyesBlink=.3),this.hasJustJumped=!0,this.hasJustLanded=!1))}tickWalking(e){if((this.cDist<20||this.transform.scale[1]>2)&&!this.falling){let n=this.transform.scale[1]>2||this.body[0].scale[1]>2,i=this.fraction(.2,e),s=this.fraction(.7,e);if(this.entity.inWater>0){if(this.entity.inWater<this.entity.radius*2)this.walking?this.entity.inWater<this.entity.radius?(i||s)&&(this.playSound(n?55:this.entity.inWater>this.entity.radius/2?127:128,!1),this.watersplash(92)):(i||s)&&(i&&this.playSound(129,!1),this.watersplash(93)):(i||s)&&this.watersplash(93);else if(this.entity.inWater>3&&(i||s)&&Math.random()<.5){let o=this.transform.position;eo(153,void 0,o[0],o[1],o[2],0,0,0,!1)}}else this.walking&&(n||this.soundPrio===1)&&(i||s)&&this.playSound(n?55:this.stepset[0],!n)}}calculateCycleSpeed(){this.falling?this.speed=1.5:this.walking?this.entity.inWater<this.entity.radius?this.speed=this.entity.speed/20*(this.entity.steer[1]===-1?1.3:1)*.45/(.4+this.entity.size*.6):this.speed=this.entity.speed/20*.2:this.speed=.5,this.speed*=this.speedMultiplier}fraction(e,n,i=this.cycleOne){return i>=e&&i-this.speed*n<e}mesh(e,n,i,s,o,r,l=!1){let a=to(s,l,!0,!1);if(a.data.lod=o,cS(a.data.multi,a,"interiorlight",this.interiorlight),a.visible=!1,a.matrixAutoUpdate=i,r!==void 0&&this.changeMeshBaseColor(a,r),a.data.basealpha=1,a.data.alpha[0]=this.currentAlpha,n>=0){if(!this.body[n])return;Cn(a,this.body[n]),a.parent.data.lod=Math.max(o,a.parent.data.lod||1)}else n===-1&&Cn(a,this.transform);return this.meshes.push(a),this.body[e]=a,a}removeMesh(e){let n=this.body[e];n!==void 0&&(ws(n.data.multi,n),this.meshes.splice(this.meshes.indexOf(n),1),this.body[e]=void 0)}clearMeshes(){for(let e=0;e<this.meshes.length;++e){let n=this.meshes[e];ws(n.data.multi,n)}this.meshes.length=0,this.body.length=0}clearEffects(){for(let e=0;e<this.effects.length;++e){let n=this.effects[e];n.done=!0}this.effects.length=0}onRemove(){this.removeSkin(),ms(this.transform)}anim(e,n,i){if(this.transform.visible&&this.animQueue.length<=2){let s=Vf.get(e),o={id:e,info:s,loop:n,dirImpactTarget:i,activeSounds:[],activeEffects:[],time:0,fract:0};this.animQueue.push(o)}}clearAnims(){for(let e=0;e<this.animQueue.length;++e)this.onAnimEnd(this.animQueue[e]);this.animQueue.length=0}onAnimEnd(e){for(let n=0;n<e.activeEffects.length;++n){let i=e.activeEffects[n];i&&(i.done=!0)}e.activeEffects.length=0;for(let n=0;n<e.activeSounds.length;++n){let i=e.activeSounds[n];i&&i.stop()}e.activeSounds.length=0}playSound(e,n){return e===0||this.inFog?!1:(Js(e,this.transform,this.soundPrio,!1,n?this.getAudioPitch():1),!0)}onHurt(e){(e>.2||this.hurtSoundTimer.done(V.time))&&this.playSound(this.soundset[1],!0)&&this.hurtSoundTimer.reset(V.time)}onYell(){this.doesYell&&Zt(0,1)<.3&&this.playSound(this.soundset[0],!0)}onAggro(){this.playSound(this.soundset[3],!0)}onDeath(){this.hasDied=!0,this.playSound(this.soundset[2],!0),this.body[1]&&this.removeMesh(1),this.addColor(qn.death),this.deathTimer.reset(V.time,3);let e=this.meshes.length;for(;e--;){let n=this.meshes[e];n.data.deathSize=(n.geometry.bounds.initiated?n.geometry.bounds.radius:1)*(n.scale[0]+n.scale[1]+n.scale[2])/3,Cn(n,null),ma(n.position,n.worldMatrix),g_(n.scale,n.worldMatrix),Mm(n.quaternion,n.worldMatrix),n.data.deathVel=[Zt(-.5,.5),1,Zt(-.5,.5)],n.matrixAutoUpdate=!0}}tickDeath(e,n,i){this.deathTimer.done(n)?(this.clearMeshes(),this.clearEffects()):this.meshes.forEach(s=>{if(!s.visible||s.data.deathVel===void 0)return;let o=s.data.deathVel,r=s.data.deathSize;on(s.position,s.position,o,e),hn(o,o,1-e*3);let l=i.getHeight(s.position[0],s.position[2])+r*.5;o[1]<0&&s.position[1]<l?o[1]<-1?(o[1]=Math.abs(o[1])*.7,o[0]+=Zt(-1,1)/r,o[2]+=Zt(-1,1)/r):o[1]=-.5:o[1]-=e*50,Qi(bt,o,[0,1,0]),on(s.rotation,s.rotation,bt,-e*5),Rt(s,!1)})}mountPosition(e){Mi(e,this.skin.mountPos,this.body[this.skin.mountPart].worldMatrix)}getAudioPitch(){return Math.max(.6,Math.min(1,.5/this.entity.radius))}getTopAbsolute(){return this.entity.radius*this.skeleton.height}addColor(e){this.colors.add(e),this.needsColorUpdate=!0}removeColor(e){this.colors.delete(e),this.needsColorUpdate=!0}colorUpdate(){this.needsColorUpdate=!1;for(let e=0;e<this.meshes.length;++e)this.updateMeshColor(this.meshes[e])}changeMeshBaseColor(e,n){e.data.basecolor=n,this.updateMeshColor(e)}updateMeshColor(e){let n=e.data.color;Br(n,e.data.basecolor),this.colors.forEach(i=>{let s=i[3],o=1-s;n[0]=n[0]*o+i[0]*s,n[1]=n[1]*o+i[1]*s,n[2]=n[2]*o+i[2]*s})}addAlpha(e){this.alphas.add(e),this.updateGoalAlpha()}removeAlpha(e){this.alphas.delete(e),this.updateGoalAlpha()}updateGoalAlpha(){this.goalAlpha=1,this.alphas.forEach(e=>{this.goalAlpha=Math.min(this.goalAlpha,e)})}alphaUpdate(e){if(this.currentAlpha!==this.goalAlpha){Math.abs(this.goalAlpha-this.currentAlpha)<.1?this.currentAlpha=this.goalAlpha:(e=Math.min(e,2),this.currentAlpha<this.goalAlpha?this.currentAlpha=Math.min(this.goalAlpha,this.currentAlpha+e*.5):this.currentAlpha=Math.max(this.goalAlpha,this.currentAlpha-e*.5));for(let n=0;n<this.meshes.length;++n){let i=this.meshes[n];i.data.alpha[0]=i.data.basealpha*this.currentAlpha}}}changeMeshBaseAlpha(e,n){e.data.basealpha=n}setShoulders(e,n=1,i=!1){if(!(this.hasDied||!this.skeleton.shoulders)){if(e===!1){for(let s=8;s<=9;++s)this.removeMesh(s);for(let s=14;s<=15;++s)this.body[s]&&this.removeMesh(s)}else for(let s=0;s<=1;++s)if(!this.body[8+s]){let o=this.mesh(8+s,0,!0,1,.6);X(o.position,s?.5:-.5,-.4+n*.4,-.05),X(o.scale,.8*n,.5*n,.5*n),this.changeMeshBaseColor(o,e)}if(i!==!1)for(let s=0;s<=1;++s){this.body[14+s]||this.mesh(14+s,8+s,!1,7,.3);let o=this.body[14+s];X(o.rotation,0,3.14,0),X(o.position,s?.2:-.2,0,-.5),X(o.scale,.35,.55,.2),this.changeMeshBaseColor(o,i)}else for(let s=14;s<=15;++s)this.body[s]&&this.removeMesh(s)}}setCape(e,n){if(!(this.hasDied||!this.skeleton.cape))if(e===!1)this.body[10]!==void 0&&this.removeMesh(10);else{if(this.body[10]===void 0){let i=this.mesh(10,0,!0,8,.7);X(i.position,0,.2,-.55)}X(this.body[10].scale,n,n,n),this.changeMeshBaseColor(this.body[10],e)}}setHeadgear(e){this.hasDied||!this.skeleton.helmet||(e===!1?this.body[11]!==void 0&&this.removeMesh(11):(this.body[11]===void 0&&this.mesh(11,0,!1,9,.5),this.changeMeshBaseColor(this.body[11],e)))}setGem(e,n=1){if(!(this.hasDied||!this.skeleton.helmet))if(e===!1)this.body[12]!==void 0&&this.removeMesh(12);else{if(this.body[12]===void 0){let i=this.mesh(12,0,!1,7,.5);X(i.position,0,.4,.54),X(i.scale,.3*n,.3*n,.08*n)}this.changeMeshBaseColor(this.body[12],e)}}setCrown(e){this.hasDied||!this.skeleton.helmet||(e===!1?this.body[13]!==void 0&&this.removeMesh(13):(this.body[13]===void 0&&(this.mesh(13,0,!1,10,.8),this.body[13].position[1]=.8),this.changeMeshBaseColor(this.body[13],e)))}watersplash(e){let n=rn();st(n.position,this.entity.pos),n.position[1]=this.entity.pos[1]+this.entity.inWater+.05,Rt(n),Ms(e,n,this.soundPrio,!0)}};var b0=class extends g0{constructor(e){super(e),this.stickEffects=new Map,this.effects=new Set,this.visualFreeze=0,this.visualIncapacitate=0}addEffectBuff(e,n,i){if(n.logic.fx.stick&&(!(n.logic.incapacitated||n.logic.tags.has(4))||this.immuneCC.size<=0)&&!this.stickEffects.has(e)){let s=Ui(n.logic.fx.stick,this.entity.visual.transform,this.entity.id===V.playerId||n.caster===V.playerId?1:0,!1);this.stickEffects.set(e,s)}if(!this.effects.has(e))n.logic.fx.visual&&this.entity.visual.skin.id!==n.logic.fx.visual&&this.changeEntityVisual(n.logic.fx.visual),n.logic.fx.mount&&this.changeEntityMount(n.logic.fx.mount(n)),n.logic.fx.color&&this.entity.visual.addColor(n.logic.fx.color),n.logic.fx.alpha&&this.entity.visual.addAlpha(n.logic.fx.alpha),n.logic.fx.anim&&(this.entity.visual.clearAnims(),this.entity.visual.anim(n.logic.fx.anim,!0,0)),this.visualFreeze+=n.visualFreeze,this.visualIncapacitate+=n.visualIncapacitate,this.effects.add(e);else if(i&&this.stickEffects.has(e)){let s=this.stickEffects.get(e);s.loops=0,s.fractionNow=0}n.logic.fx.apply&&i&&Ms(n.logic.fx.apply,this.entity.visual.transform,this.entity.id===V.playerId||n.caster===V.playerId?1:0,!1)}removeEffectBuff(e,n,i){if(this.stickEffects.has(e)){let s=this.stickEffects.get(e);this.buffs.has(e)||(s.done=!0,this.stickEffects.delete(e))}this.effects.has(e)&&(n.fx.visual&&this.entity.visual.skin.id===n.fx.visual&&this.changeEntityVisual(),n.fx.mount&&this.changeEntityMount(),n.fx.color&&this.entity.visual.removeColor(n.fx.color),n.fx.alpha&&this.entity.visual.removeAlpha(n.fx.alpha),n.fx.anim&&this.entity.visual.clearAnims(),this.visualFreeze-=i.visualFreeze,this.visualIncapacitate-=i.visualIncapacitate,this.effects.delete(e))}setBuff(e,n,i,s,o,r,l,a){let c=super.setBuff(e,n,i,s,o,r);c.data=a,c.visualFreeze=c.visualIncapacitate=0,this.immuneCC.size===0&&(c.logic.fx.frozen&&c.visualFreeze++,c.logic.fx.incapacitated&&c.visualIncapacitate++),this.entity.buffDisplayDirty=!0,this.entity.visual&&this.addEffectBuff(e,c,l)}removeBuff(e,n){let i=super.removeBuff(e,n);i&&(this.entity.buffDisplayDirty=!0,this.removeEffectBuff(e,i.logic,i),i.logic.fx.endSound!==void 0&&V.player!==void 0&&Js(i.logic.fx.endSound,this.entity.visual.transform,this.entity.id===V.playerId||n===V.playerId?1:0,0,1))}changeEntityVisual(e){this.entity.remakeTransform(e),this.stickEffects.forEach((n,i)=>{let s=Ui(n.info.id,this.entity.visual.transform,n.priority,!1);s.loops=1,n.done=!0,this.stickEffects.set(i,s)})}changeEntityMount(e){this.entity.mount&&(this.entity.mount.onRemove(),this.entity.mount=void 0,this.entity.updateVisualPosition(0,V.time,V,!0)),e&&(this.entity.mount=new xc(this.entity),this.entity.mount.setSkin(e),this.entity.updateTransformScale(),this.entity.updateVisualPosition(0,V.time,V,!0),this.entity.updateTransformRotation(.016),this.entity.updateMountRotation(.016))}};var y0=class{constructor(e){this.id=e.id||0,this.type=e.type,this.pos=[0,0,0],this.vel=[0,0,0],this.rot=0,this.radius=0,this.size=0,this.name=e.name,this.setSize(e.size||1)}async init(e){this.name=e.name||""}preFixed(e,n,i){}tickFixed(e,n,i){}postFixed(e,n,i){}preDelta(e,n,i){}tickDelta(e,n,i){}postDelta(e,n,i){}onRemove(){}setPos(e){this.pos[0]=e[0],this.pos[1]=e[1],this.pos[2]=e[2]}setRot(e){this.rot=Ra(e)}onTarget(e){return!0}setName(e){this.name=e}setSize(e){this.size=e,this.radius=e/2}hSquaredDistanceV3(e){let n=e[0]-this.pos[0],i=e[2]-this.pos[2];return n*n+i*i}distanceV2(e){return Ca(Bn,e,za(Qs,this.pos)),Sa(Bn)}distanceV3(e){return Xt(bt,e,this.pos),mi(bt)}squaredDistanceV2(e){return Ca(Bn,e,za(Qs,this.pos)),D3(Bn)}squaredDistance(e){return Xt(bt,e,this.pos),jc(bt)}rotationToV2(e){return Ca(Bn,e,za(Qs,this.pos)),Mp(Bn,Bn),al(Bn)}rotationToV3(e){return Xt(bt,e,this.pos),Jn(bt,bt),zp(bt)}};var Sr=class extends y0{constructor(e){super(e),this.hudPos=[0,0,0],this.netDeletion=new kt(0,0)}handleMovementData(e,n){st(this.pos,e.pos),st(this.vel,e.vel)}onRemove(){this.visual&&this.visual.onRemove()}};var k0=class{constructor(e){this.entity=e,this.skills=new Map,this.skillIdsLearned=[],this.skillIdsActive=[],this.timedCast=new kt,this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0,this.gcdEnd=0}add(e,n=0,i=0,s){let o=this.skills.get(e);return o=Object.assign(o||{},{level:s!==void 0?s:o?o.level+1:1,logic:Pt.get(e),cd:new kt(n,i-n),preGcdEnd:0}),this.skills.set(e,o),o}updateSkillsLearned(e){this.skillIdsLearned.length=0,this.skillIdsLearned.push(...e)}remove(e){this.skills.delete(e)}compileActiveSkillIds(){this.skillIdsActive.length=0,this.skills.forEach((e,n)=>{if(!e.logic.engineOnly)for(let i=0;i<e.level;++i)this.skillIdsActive.push(n)})}globalCd(e,n){this.skills.forEach(i=>{!i.logic.auto&&!i.logic.ignoreGcd&&(i.cd.end<e&&(i.cd.start=e),i.cd.end<n&&(i.preGcdEnd=i.cd.end,i.cd.end=n),i.cd.duration=i.cd.end-i.cd.start)}),this.gcdEnd=n}clearGlobalCd(){this.skills.forEach(e=>{!e.logic.auto&&!e.logic.ignoreGcd&&e.cd.end===this.gcdEnd&&(e.cd.end=e.preGcdEnd,e.cd.duration=e.preGcdEnd-e.cd.start)})}startTimedCast(e,n,i,s){this.timedCast.reset(n,s),this.timedSkill=e,this.timedTarget=i,this.entity.steer[0]=0,this.entity.steer[1]=0,this.pvpBoundModifier=Pt.get(e.id).pvpBoundsAdd}interruptTimedCast(e,n){this.timedCast.reset(0,0),this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0,n&&this.clearGlobalCd()}finishTimedCast(e){return this.interruptTimedCast(!1,!1)}onDeath(){this.interruptTimedCast(!0,!1)}clear(){}hasInstantCast(e){return this.entity.buffs.instantCast.size>0&&Array.from(this.entity.buffs.instantCast).some(n=>n.logic.instantCast.has(e))}};var TP=new Map,x0=class extends k0{constructor(e){super(e)}tick(e,n,i){if(this.isPlayer){let s=this.entity.buffs.incapacitated.size>0;this.skills.forEach((o,r)=>{let l=TP.get(r)||TP.set(r,new Map).get(r),a=new Map,c=0;if(s&&!o.logic.ignoreIncapacitated?c=9:(c=o.logic.can(this.entity,o.level,this.entity.target,!0),(c===3||c===4)&&(c=o.logic.can(this.entity,o.level,this.entity.id,!0))),c!==o.status&&(o.status=c,l.get("status")!==c&&a.set("status",c)),o.cd.done(i.smoothtime))o.cd.icondone||(o.cd.icondone=!0,l.get("cd")!==void 0&&a.set("cd",void 0),l.get("remaining")!==void 0&&a.set("remaining",void 0));else{o.cd.icondone=!1;let f=Math.round(100-o.cd.fraction(i.smoothtime)*100),u;o.cd.duration>1.5&&(u=o.cd.remaining(i.smoothtime),u<=3?u=Math.ceil(u*10)/10:u=Math.ceil(u)),l.get("cd")!==f&&a.set("cd",f),l.get("remaining")!==u&&a.set("remaining",u)}a.size>0&&Uo.update(f=>(a.forEach((u,m)=>{l.set(m,u),f[o.logic.id][m]=u}),f))})}if(this.timedSkill&&this.entity.visual){let s=this.timedSkill.fx;if(s){let o=this.entity.visual.animQueue[0],r=this.timedCast.remaining(n);if(s.animCast){let l=Vf.get(s.animCast);r-=Math.min(.3,l.duration/2)}r>0?s.animChannel&&(!o||s.animChannel!==o.id)&&(this.entity.visual.clearAnims(),this.entity.visual.anim(s.animChannel,!0,0)):s.animCast&&(!o||s.animCast!==o.id)&&(this.entity.visual.clearAnims(),this.entity.visual.anim(s.animCast,!1,0))}}}add(e,n=0,i=0,s){super.add(e,n,i,s),this.isPlayer&&(this.compileActiveSkillIds(),Uo.update(r=>(r[e]={},r)),this.skills.get(e).logic.id<100&&Oo.update(r=>(r.set(e,s),r)))}remove(e){this.isPlayer&&(this.compileActiveSkillIds(),Uo.update(i=>(i[e]=void 0,i)),this.skills.get(e)&&Oo.update(i=>(i.delete(e),i))),super.remove(e)}updateSkillsLearned(e){super.updateSkillsLearned(e),Oc.update(n=>{n.clear();for(let i=0;i<e.length;++i){let s=e[i];n.has(s)||n.set(s,Zf(e,s))}return n})}cd(e,n,i){this.skills.get(e).cd.set(n,i)}clearSkillInfo(){Oo.update(e=>(e.clear(),e)),Oc.update(e=>(e.clear(),e))}startTimedCast(e,n,i,s){super.startTimedCast(e,n,i,s),this.entity.uiFrameDirty=!0}interruptTimedCast(e,n){super.interruptTimedCast(e,n),this.entity.uiFrameDirty=!0,e&&this.entity.visual&&this.entity.visual.clearAnims()}};var w0=class extends ec{constructor(e){super(e)}setStat(e,n){this.stat.set(e,n),this.entity.statsDirty=!0,e==20?this.entity.setPrestige(n):e==21?this.entity.setElo(n):e==6||e==7?this.entity.uiFrameDirty=!0:e==19&&this.entity.inventory&&this.entity.inventory.setSize(n)}setResource(e,n){super.setResource(e,n),this.entity.uiFrameDirty=!0}die(){super.die(),this.entity.uiFrameDirty=!0,this.entity.visual&&this.entity.visual.onDeath()}respawn(){super.respawn(),this.entity.uiFrameDirty=!0,this.entity.visual&&this.entity.remakeTransform()}refreshCombatTimer(e,n){super.refreshCombatTimer(e,n),this.entity.uiFrameDirty=!0}onCombatEnd(){super.onCombatEnd(),this.entity.uiFrameDirty=!0}};var M0=class extends Sr{constructor(e){e.creature&&(e.skin=e.creature.skin,e.name=e.creature.name),super(e),this.creatureId=e.creature?e.creature.id:-1,this.stats=new w0(this),this.buffs=new b0(this),this.skills=new x0(this),this.steer=[0,0],this.speed=1,this.static=!1,this.jump=0,this.onGround=!0,this.belowGround=!1,this.inWater=0,this.groundNormal=[0,0,0],this.target=0,this.level=0,this.faction=0,this.posLock=[0,0],this.posLockRadius=0,this.aabb=wu()}setAABB(){Yd(this.aabb,this.pos,this.size,this.size,this.size)}preFixed(e,n,i){super.preFixed(e,n,i),this.buffs.tick(e,n,i),this.stats.tick(e,n),this.skills.tick(e,n,i),this.setSize((this.stats.getStat(31)||100)/100)}getStatBasedMoveSpeed(){return Math.max(Math.min(65534,this.stats.getStat(15)))}postFixed(e,n,i){this.handlePosLock()}handlePosLock(){if(this.posLockRadius>0){Ca(Qs,za(Bn,this.pos),this.posLock);let e=Sa(Qs);if(e>this.posLockRadius){let n=I3(Qs,this.posLock,Af(Qs,Qs,this.posLockRadius/e));X(this.pos,n[0],this.pos[1],n[1])}}}hasMovementOverride(){return this.buffs.movementOverride.size>0}buffMovementOverride(e,n,i){this.hasMovementOverride()&&this.buffs.movementOverride.forEach(s=>{s.logic.movementOverride(e,n,i,this,s)})}combatRangeCheck(e,n){let i=this.pos[0]-e.pos[0],s=Math.max(0,Math.abs(this.pos[1]-e.pos[1])-this.size),o=this.pos[2]-e.pos[2];return i*i+s*s+o*o<(n+(e.size+this.size))**2}combatCylinderCheck(e,n,i){return!(this.aabb[1]>e[1]+n||this.aabb[4]<e[1]-n||Math.sqrt((e[0]-this.pos[0])**2+(e[2]-this.pos[2])**2)>i+this.radius)}tickHoles(e){let n=V.getHole(this.pos[0],this.pos[2]),i=this.pos[1]-V.getHeight(this.pos[0],this.pos[2]);return this.belowGround=n&&i<=0,n}horizontalSteer(e,n,i){if(this.stats.alive){this.rot=i;let s=Mp(Bn,n);n[1]<0&&(s[1]*=.5),Af(s,s,e/20),x_(this.vel,s,i)}else this.vel[0]=0,this.vel[2]=0}setSteer(e,n){this.steer[0]=e,this.steer[1]=n}setJump(e){this.jump=e}setRot(e){super.setRot(e)}setSpeed(e){this.speed=e}setTarget(e){let n=e>0&&this.canTarget(V.getEntityById(e));return n!==!1&&n!==void 0?n.onTarget(this.id):this.target!==(this.target=0)}onTarget(e){let n=V.getEntityById(e);return n.target=this.id,super.onTarget(e)}getTargetEntity(){return V.getEntityById(this.target)}canTarget(e){return e}setFaction(e){this.faction=e}setLevel(e){this.level=e}setClass(e){this.class=e}onRemove(){this.stats.clear(),this.buffs.clearTempBuffs(),this.buffs.clearPassiveBuffs(),this.skills.clear(),super.onRemove()}hostility(e){return e.faction!==this.faction?1:0}canCombatInteract(e){return!0}canSupportInteract(e){return!0}die(e,n,i){}setPosLock(e,n,i){this.posLock[0]=~~e,this.posLock[1]=~~n,this.posLockRadius=~~i}tickWaterCollisions(e){let n=this.inWater;return this.inWater=Math.max(0,e.getWaterHeight(this.pos[0],this.pos[2])-this.pos[1]),!n&&this.inWater>0&&this.vel[1]<-3&&this.onEnterWater(),this.inWater>0}onEnterWater(){}};var rs=class extends M0{constructor(e){super(e),this.uiFrameDirty=!0,this.uiRange=!0,this.buffDisplayDirty=!0,this.visualPosition=[0,0,0],this.speechTimer=new kt(0,5),this.mount=void 0,this.mountRotAdd=0,this.namePlateScale=.5,e.creature&&(e.creature.col1[0]!==0&&(e.colPrim=e.creature.col1),e.creature.col2[0]!==0&&(e.colSec=e.creature.col2)),this.skin=e.skin,this.colPrim=e.colPrim,this.colSec=e.colSec,this.interiorlightTarget=[0,0,0,0],this.interiorlightTimer=new kt(0,.5),this.conciliator=[0,0,0],this.visual=new xc(this),this.skin>0&&this.remakeTransform()}handleMovementData(e,n){let i=zn([0,0,0],this.pos,this.conciliator),s=Xt([0,0,0],i,e.pos);jc(s)>1?(X(this.conciliator,0,0,0),st(this.pos,e.pos)):zn(this.conciliator,this.conciliator,s),st(this.vel,e.vel)}makeVisual(e,n,i){this.visual.setSkin(e||this.skin,n||this.colPrim,i||this.colSec)}remakeTransform(e,n,i){this.makeVisual(e,n,i),this.updateTransformScale(),this.updateTransformRotation(1),this.updateVisualPosition(0,0,V,!0)}onRemove(){super.onRemove(),this.mount!==void 0&&this.mount.onRemove()}updateVisualPosition(e,n,i,s=!1){e>0&&(on(this.pos,this.pos,this.conciliator,-e*10),hn(this.conciliator,this.conciliator,1-e*10));let o=ei(this.pos,this.visualPosition);(s||o>1e-5)&&(st(this.visualPosition,this.pos),this.visualPosition[1]+=this.radius,this.mount===void 0?st(this.visual.transform.position,this.visualPosition):(st(this.mount.transform.position,this.visualPosition),this.mount.transform.position[1]+=this.mount.skin.size*.5-this.radius)),this.interiorlightTimer.done(n)&&(this.interiorlightTimer.reset(n),i.getInteriorLight(this.interiorlightTarget,this.aabb));let r=Math.min(1,e),l=this.interiorlightTarget,a=this.visual.interiorlight;a[0]+=Math.sign(l[0]-a[0])*r,a[1]+=Math.sign(l[1]-a[1])*r,a[2]+=Math.sign(l[2]-a[2])*r,a[3]+=Math.sign(l[3]-a[3])*r}updateTransformScale(){pi(this.visual.transform.scale,this.size*.7),this.mount!==void 0&&pi(this.mount.transform.scale,this.mount.skin.size*.7)}updateTransformRotation(e){if(this.stats.alive&&this.buffs.visualFreeze===0){this.updateMountRotation(e);let n=cl(this.rot+this.mountRotAdd,this.visual.transform.rotation[1]);Math.abs(n)>.01&&(this.visual.transform.rotation[1]=wa(this.visual.transform.rotation[1]-n*Math.min(1,e*20),Math.PI*2))}}updateMountRotation(e){if(this.mount!==void 0){if((this.onGround||this.inWater>0)&&(this.steer[0]!==0||this.steer[1]!==0)){let n=this.steer[0]*1.5;this.steer[1]!=0&&(n*=.5*this.steer[1]),this.mountRotAdd-=(this.mountRotAdd-n)*Math.min(1,e*10)}this.mount.transform.rotation[1]=this.visual.transform.rotation[1]}else this.mountRotAdd=0}postFixed(e,n,i){super.postFixed(e,n,i),this.visual.tickFixed(e,n,i),this.mount!==void 0&&this.mount.tickFixed(e,n,i)}postDelta(e,n,i){super.postDelta(e,n,i),this.updateVisuals(e,n,i),this.updateUiParts(n)}updateVisuals(e,n,i){this.updateTransformRotation(e),this.updateTransformScale(),this.updateVisualPosition(e,n,i),this.mount!==void 0&&(this.mount.tick(e,n,i),this.mount.mountPosition(this.visual.transform.position)),this.visual.tick(e,n,i)}updateUiParts(e){let n=this.id===V.playerId,i=Rn===this.id,s=nn.has(this.name);if(i||s){let o=this.squaredDistance(V.player.pos)<900;o!=this.uiRange&&(this.uiFrameDirty=!0),this.uiRange=o}(this.uiFrameDirty||this.skills.timedSkill!==void 0)&&(i&&this.hydrateUnitStore(Os),n?this.hydrateUnitStore(Us):s&&this.hydrateUnitStore(nn.get(this.name).unitStore)),(this.buffDisplayDirty||n||i)&&(i&&this.hydrateBuffStore(n,Bc,re.buffcountUnitframes),n?this.hydrateBuffStore(n,sa,re.buffcountUnitframes):(this.buffDisplayDirty||i)&&s&&this.hydrateBuffStore(n,nn.get(this.name).buffStore,re.buffcountParty)),this.speechText!==void 0&&this.speechTimer.done(e)&&(this.speechText=void 0)}setTarget(e){let n=this.target,i=super.setTarget(e);if(n!=this.target&&this==V.player&&i){let s=V.getEntityById(e);s?(s.hydrateUnitStore(Os,re.buffcountUnitframes),s.hydrateBuffStore(!1,Bc,re.buffcountUnitframes)):Os.update(o=>(o.visible=!1,o))}return i}hydrateUnitStore(e){e.update(n=>(n.visible=!0,n.name=this.name,n.alive=this.stats.alive,n.hp=this.stats.getResource(6),n.hpMax=this.stats.getStat(6),n.mp=this.stats.getResource(7),n.mpMax=this.stats.getStat(7),n.level=this.level,n.class=this.class,n.id=this.id,n.clan=this.clan,n.faction=this.faction,n.party=this.party,n.role=this.partyrole,n.type=this.type,n.combat=!this.stats.combatTimer.done(V.time),n.range=this.uiRange,n.rarity=this.faction===2&&(this.rarity||!1),n.timedSkill=this.skills.timedSkill,n.timedCast=this.skills.timedCast,n)),this.uiFrameDirty=!1}hydrateBuffStore(e,n,i){n.update(s=>Tz(s,this.buffs,i,e)),this.buffDisplayDirty=!1}speech(e,n){this.speechText=e,this.speechStyle=n,this.speechTimer.reset(V.time)}},Tz=(t,e,n,i)=>{let s=[];e.buffs.forEach((r,l)=>{r.forEach((a,c)=>{!a.logic.passive&&a.logic.icon!==void 0&&(!re.buffsHideIrrelevant||c===V.playerId||c===e.entity.id&&e.entity.faction===2||e.entity===V.player&&a.logic.type==1)&&(!a.logic.unique||s.reduce((f,u)=>f+(u.id===a.id?1:0),0)===0)&&s.push(a)})});let o=s.sort((r,l)=>l.time-r.time).sort((r,l)=>r.type-l.type).slice(0,n);if(t.length<o.length)for(;t.length<o.length;)t.push(Iz());else if(t.length>o.length)for(;t.length>o.length;)Dz(t.pop());return o.forEach((r,l)=>{Vz(V.smoothtime,r,t[l],i)}),t},Ez=0,EP=[],Iz=()=>EP.pop()||{id:Ez++,icon:"",type:1,time:0,duration:10,stacks:0,cancel:-1},Dz=t=>{EP.push(t)},Vz=(t,e,n,i)=>{e.logic.customIcon===void 0?n.icon=`/data/${e.logic.icon}.${Gn}?v=8602459`:n.icon=`/data/${e.logic.customIcon(e)}.${Gn}?v=8602459`,n.cancel=i&&e.logic.tags.has(12)?e.logic.id:-1,n.type=e.logic.type,n.time=Math.min(e.timer.duration,e.timer.passed(t)),n.duration=e.timer.duration,n.stacks=e.uniqueInstances>1?e.uniqueInstances:e.stacks};var ri=class extends rs{constructor(e){super(e),this.static=!0,this.interactions=e.interactions,this.interactions.length&&this.setDialogue(this.interactions[0].text,this.interactions[0].choices)}interact(e){this.createInteraction()}createInteraction(){Bs.set({title:this.name,text:this.text,choices:this.choices})}setDialogue(e,n){this.text=e,this.choices=n}};var F0=class extends ri{constructor(e){super({type:6,...e})}};var C0=class extends F0{constructor(e){super({...e,...C.npcs.blacksmith})}};var S0=class extends ri{constructor(e){super({type:2,...e})}};var oo=(t,e)=>{let n=t.length-e,i="",s=e+n;for(;e<s;){let o=t[e++];if(o<128)i+=String.fromCharCode(o);else if(o>191&&o<224){let r=t[e++];i+=String.fromCharCode((o&31)<<6|r&63)}else if(o>239&&o<365){let r=t[e++],l=t[e++],a=t[e++],c=((o&7)<<18|(r&63)<<12|(l&63)<<6|a&63)-65536;i+=String.fromCharCode(55296+(c>>10)),i+=String.fromCharCode(56320+(c&1023))}else{let r=t[e++],l=t[e++];i+=String.fromCharCode((o&15)<<12|(r&63)<<6|l&63)}}return i};var A0=class extends S0{constructor(e){super({...e,...C.npcs.conjurer})}interact(e){let n=oo(e,1).split("#");n[0]!==""?this.setDialogue(this.interactions[0].text,Array.from(n,i=>{let s=i.split("~");return this.interactions[0].choices[0].replace("$1",s[0])+(s[1]>0?` (Lv. ${s[1]}+)`:"")})):this.setDialogue(this.interactions[0].text,[]),super.interact(e)}};var P0=class extends Sr{constructor(e){super({type:3,...e}),this.partytimeout=0,this.party=0,this.droptype="",this.tier=0,this.quality=0}partyTimeoutCheck(e){return this.party===0||e.id===this.party||e.party===this.party||V.time>this.partytimeout}canBePickedUpBy(e,n=30){return this.partyTimeoutCheck(e)&&e.stats.alive&&!e.buffs.buffs.has(128,e.id)&&e.squaredDistance(this.pos)<n}};var T0=class extends P0{constructor(e){super(e),this.visual={transform:to(1561,!1,!1,!0)},this.visual.transform.data.multi.needsUpdate=!1,this.setSize(.2),this.visual.transform.visible=!1,this.uiTimeout=0,this.dirty=!1,this.hasInfo=!1,this.hasPos=!1,this.hasRot=!1,this.color="misc"}postDelta(e,n,i){if(this.visual.transform.visible&&this.dirty){let s=i.getChunkFromWorld(this.pos[0],this.pos[2]);s!==void 0&&s.deserialized&&(this.pos[1]=i.getHeight(this.pos[0],this.pos[2])+Math.random()*.1+.1,this.visual.transform.rotation[1]=Math.random()*Math.PI*2,Rp(this.visual.transform.rotation,i.getNormal(this.pos[0],this.pos[2])),st(this.visual.transform.position,this.pos),this.visual.transform.data.multi.needsUpdate=!0,Rt(this.visual.transform,!1),this.dirty=!1)}}setDropInfo(e,n,i,s,o){this.hasInfo=!0,this.party=s,this.partytimeout=o,this.droptype=Xk[e],this.tier=n,this.quality=i,this.lootquality=i;let r,l;this.droptype=="gold"?(this.name=this.tier+"c",this.setSize(.1),r="gold",this.color="gold",this.quality=100):(r=this.droptype+this.tier,l=ln[r],l&&(this.name=tn(this.droptype,this.tier)),this.droptype!=="misc"&&this.droptype!=="rune"&&this.droptype!=="book"?(this.color=Ut(i)[1],re.itemQualityPercent&&(this.name+=` ${this.quality}%`)):(this.color=this.droptype,this.quality=100,this.droptype==="rune"&&(this.lootquality=90)));let a=l&&l.art||r;Br(this.visual.transform.data.uvshift,Fo[a]),X(this.visual.transform.scale,Fo[a][0]*20,1,Fo[a][1]*20),this.visual.transform.data.shine[0]=Math.random()*6.1,this.dirty=!0,this.visual.transform.visible=!0}onRemove(){ws(this.visual.transform.data.multi,this.visual.transform),nt.shift.down&&(yc.add(this),this.uiTimeout=Math.round(V.time/5)*5+10)}};var E0=class extends rs{constructor(e){super({type:7,...e}),this.static=!0,this.class=5}};var I0=class extends E0{};var D0=class extends ri{constructor(e){super({type:12,...e})}};var V0=class extends D0{constructor(e){super({...e,interactions:[]})}};var L0=class extends ri{constructor(e){super({type:4,...e})}};var q0=class extends L0{constructor(e){super({...e,...C.npcs.merchant})}};var R0=class extends rs{constructor(e){super({type:1,...e}),this.groundHeight=0;let n=m1.get(e.creature.id);this.aggroMode=n.aggroMode,this.rarity=n.rarity}tickFixed(e,n,i){this.horizontalSteer(this.speed,this.steer,this.rot),super.tickFixed(e,n,i),this.tickHoles(e),this.stats.alive&&(on(this.pos,this.pos,this.vel,e),this.groundHeight=i.raycastEnvironmentHeight(this.pos[0],this.pos[2],this.pos[1]+1,this.pos[1]-1,this.groundNormal),this.belowGround||(this.groundHeight=Math.max(this.groundHeight,i.getHeight(this.pos[0],this.pos[2])))),this.setAABB(),this.tickWaterCollisions(i),this.inWater>this.radius||(this.pos[1]-=10*e),this.pos[1]=Math.max(this.groundHeight,this.pos[1])}};var z0=class extends R0{};var B0=class extends Sr{constructor(e){super({type:11,...e})}};var U0=class extends B0{constructor(e){super(e),this.meshId=0,this.scale=0,this.effects=[],this.dirty=!1,this.rot=Math.random()*3.14}postDelta(e,n,i){if(this.dirty){st(this.mesh.position,this.pos),this.mesh.rotation[1]=this.rot,pi(this.mesh.scale,this.scale),this.mesh.matrixNeedsUpdate=!0,Rt(this.mesh,!0);for(let s=0;s<this.effects.length;++s){let o=this.effects[s];Rt(o.transform,!0)}this.mesh.data.multi&&(this.mesh.data.multi.needsUpdate=!0),this.dirty=!1}}setNodeInfo(e,n){e!==this.meshId&&(this.meshId>0&&this.removeMesh(),this.meshId=e,this.makeMesh(),this.dirty=!0),this.scale!==n&&(this.scale=n,this.dirty=!0)}makeMesh(){let e=bs.get(this.meshId);e.geometry>0?(this.mesh=to(this.meshId,!0,!1,!0),ti(this.mesh.data.interiorlight,0,0,0,0)):this.mesh=rn();for(let n=0;n<e.effects.length;++n){let i=e.effects[n],s=rn();st(s.position,i.pos),st(s.scale,i.scale),st(s.rotation,i.rot),Cn(s,this.mesh);let o=Ui(i.id,s,0,!0);this.effects.push(o)}}removeMesh(){this.mesh!==void 0&&(this.mesh.data.multi?ws(this.mesh.data.multi,this.mesh):ms(this.mesh)),this.mesh=void 0;for(let e=0;e<this.effects.length;++e)this.effects[e].done=!0;this.effects.length=0}onRemove(){this.removeMesh()}};var O0=class extends rs{constructor(e){super({type:10,...e}),this.groundHeight=0}tickFixed(e,n,i){this.horizontalSteer(this.speed,this.steer,this.rot),super.tickFixed(e,n,i),this.tickHoles(e),this.stats.alive&&(on(this.pos,this.pos,this.vel,e),this.groundHeight=i.raycastEnvironmentHeight(this.pos[0],this.pos[2],this.pos[1]+1,this.pos[1]-1,this.groundNormal)),this.setAABB(),this.tickWaterCollisions(i),this.inWater>this.radius||(this.pos[1]-=10*e),this.pos[1]=Math.max(this.groundHeight,this.pos[1])}};var $0=class extends O0{};var N0=class extends rs{constructor(e){super({type:0,size:.9,...e}),this.exp=0,this.party=0,this.partyrole=0,this.prestige=0,this.prestigeRank=0,this.elo=0,this.eloRank=0,this.clan=void 0,this.clanRole=0,this.jumpLast=0}tickVelocity(e,n,i,s,o){this.inWater>this.radius?(this.onGround&&(this.vel[1]=Math.max(0,this.vel[1])),this.inWater<this.radius+.1&&(this.jump>0||this.vel[1]===0)?this.vel[1]=this.jumpLast===0&&s>0?7:0:(this.vel[1]+=s?e*8:e*-4,this.vel[1]=Math.max(Math.min(this.vel[1],4),-3)),this.horizontalSteer(o*.5,n,i)):this.onGround?(this.stats.alive&&s>0&&o>0&&(this.vel[1]=9,this.onGround=!1),this.horizontalSteer(o,n,i)):(this.vel[1]=Math.max(-60,this.vel[1]-25*e),this.stats.alive&&this.vel[0]===0&&this.vel[2]===0&&this.horizontalSteer(o*.5,n,i)),this.jumpLast=this.vel[1]<0?this.jumpLast:this.jump}tickMovement(e,n,i,s,o){this.tickVelocity(e,n,i,s,o);let r=this.tickHoles(e);this.setWorldCollAABB(this.vel[0]*e,this.vel[1]*e,this.vel[2]*e);let l=V.triangleGrid.queryAABB(this.aabb),a=[],c=[],f=[];for(let v=0;v<l.length;++v){let _=l[v],b=_[3][1];b>.6?c.push(_):b<-.6?f.push(_):a.push(_)}let u=mi(this.vel)*e,m=Math.floor(Math.max(1,u/.1)),g=e/m;for(let v=0;v<m;++v)this.tickCollisions(g,a,c,f,r);this.setAABB(),this.tickWaterCollisions(V),V.clampV3(this.pos)}setWorldCollAABB(e,n,i){let s=this.aabb,o=this.radius+.5;s[0]=this.pos[0]-Math.min(0,e)-o,s[3]=this.pos[0]+Math.max(0,e)+o,s[1]=this.pos[1]-Math.min(0,n)-o,s[4]=this.pos[1]+Math.max(0,n)+o*2,s[2]=this.pos[2]-Math.min(0,i)-o,s[5]=this.pos[2]+Math.max(0,i)+o}tickCollisions(e,n,i,s,o){let r=[...this.pos];on(this.pos,this.pos,this.vel,e);let l=this.belowGround||o?0:V.getHeight(this.pos[0],this.pos[2]),a=V.getNormal(this.pos[0],this.pos[2]);this.tickWallCollisions(n,l,a),l=this.belowGround||o?0:V.getHeight(this.pos[0],this.pos[2]),a=V.getNormal(this.pos[0],this.pos[2]),this.tickFloorCollisions(i,l,a),this.tickCeilCollisions(s,r),this.belowGround||(this.pos[1]=Math.max(this.pos[1],V.getHeight(this.pos[0],this.pos[2])))}tickWallCollisions(e,n,i){if(i[1]<.6&&this.pos[1]<n){let c=-(py(...this.pos,this.pos[0],n,this.pos[2],...i)+.05);this.pos[0]-=i[0]*c,this.pos[2]-=i[2]*c}let s=this.radius,o=this.radius*1.5,r=this.pos[0],l=this.pos[1]+o,a=this.pos[2];for(let c=0;c<e.length;++c){let f=e[c];if(qp(f[0],f[1],f[2],r,l,a)){let u=my(r,l,a,...f[0],...f[3]);if(u<s&&u>-.5){let m=u-s;this.pos[0]-=f[3][0]*m,this.pos[2]-=f[3][2]*m}}}}tickFloorCollisions(e,n,i){let o=this.vel[1]>0||this.inWater>this.radius?0:.1,r=this.radius*1.5,l=1/0,a=!1;for(let f=0;f<e.length;++f){let u=e[f];if(qp(u[0],u[1],u[2],...this.pos)){let m=F1(...this.pos,...u[0],...u[3]);m<l&&m<o&&m>-r&&(l=m,a=!0,st(this.groundNormal,u[3]))}}let c=-(n-this.pos[1]);i[1]>.6&&this.pos[1]<n+o&&c<l&&c<o&&c>-r&&(l=c,a=!0,st(this.groundNormal,i)),a?(this.pos[1]-=l,this.onGround||(this.onGround=!0,this.onFallLanding(-this.vel[1]),this.vel[1]=Math.max(0,this.vel[1]))):(this.onGround=!1,X(this.groundNormal,0,1,0))}tickCeilCollisions(e,n){let i=this.radius*1.5;for(let s=0;s<e.length;++s){let o=e[s],r=this.pos[0],l=this.pos[1],a=this.pos[2];if(qp(o[0],o[1],o[2],r,l,a)){let c=F1(...this.pos,...o[0],...o[3]);c<0&&c>-i&&(this.pos[1]>=n[1]&&(this.pos[0]=n[0],this.pos[2]=n[2]),this.vel[1]=Math.min(0,this.vel[1]),this.vel[0]=0,this.vel[2]=0)}}}setExp(e){this.exp=e}setParty(e,n){this.party=e,this.partyrole=n}setPrestige(e){return e!==this.prestige?(this.prestige=e,this.prestigeRank=nc(e),!0):!1}setElo(e){return e!==this.elo?(this.elo=e,this.eloRank=$a(e),!0):!1}setClan(e,n=0){this.clan=e,this.clanRole=n}getNearbyPartyMembers(e){let n=[];return this.stats.alive&&n.push(this),this.party>0&&V.entities.type[0].forEach(i=>{i.party==this.party&&i!=this&&i.stats.alive&&ei(e,i.pos)<1e3&&n.push(i)}),n}hostility(e){return(V.mode.partyBasedHostility===!0?e.party!==this.party:e.faction!==this.faction)?e.type===0?e.stats.stat.get(26)===0&&this.stats.stat.get(26)===0?0:2:1:0}canCombatInteract(e){return e.type===0?e.buffs.buffs.has(128,e.id)?!1:!V.mode.pvpprotect||this.hostility(e)<2?!0:!(this.stats.stat.get(26)===0||e.stats.stat.get(26)===0)&&Math.abs(this.stats.stat.get(26)-e.stats.stat.get(26))<=5+Math.max(this.skills.pvpBoundModifier,e.skills.pvpBoundModifier):e.type===1||e.type===10||e.type===12?e.stats.stat.get(26)>0:!0}canSupportInteract(e){return this.hostility(e)===0&&(!V.mode.pvpprotect||(e.type===0?Math.abs(this.stats.stat.get(26)-e.stats.stat.get(26))<=5:!0))}onFallLanding(e){}};var Lz=[1,2,3,4],Ll=class extends N0{constructor(e){e.skin=0,super(e)}tickFixed(e,n,i){super.tickFixed(e,n,i),this.tickMovement(e,this.steer,this.rot,this.jump,this.speed)}setClass(e){e!==this.class&&(super.setClass(e),this.skin=Lz[this.class],this.remakeTransform())}makeVisual(e,n){super.makeVisual(e,n),this.prestige>0&&this.setPrestige(this.prestige,!0),this.level>=10&&this.setLevel(this.level),this.elo>1500&&this.setElo(this.elo,!0)}setPrestige(e,n){if(super.setPrestige(e)||n){let i=Math.min(this.prestigeRank,10),s=this.prestigeRank-11;i<1?(this.visual.setCrown(!1),this.visual.setHeadgear(!1)):(this.visual.setHeadgear(s<0?pg[Math.min(4,i-1)]:qn.darkgold),i>5?this.visual.setCrown(pg[i-6]):this.visual.setCrown(!1)),s<0?this.visual.setGem(!1):this.visual.setGem($w[s],s>0?1:.8)}}setElo(e,n){if(super.setElo(e)||n){let i=$a(e);this.visual.setShoulders(dg[Math.min(i,1)],.65+i*.08,i>0&&dg[i])}}setLevel(e){super.setLevel(e),e>=15?this.visual.setCape(this.faction===0?qn.vanguard:qn.bloodlust,e>=25?1:.5):this.visual.setCape(!1)}setParty(e,n){this.uiFrameDirty=!0,this.buffDisplayDirty=!0,super.setParty(e,n)}onEnterWater(){this.visual.playSound(130,!1),this.visual.watersplash(94)}};var j0=class extends ri{constructor(e){super({type:9,...e})}};var W0=class extends j0{constructor(e){super({...e,...C.npcs.sage})}interact(e){this.interactions[0].choices[0]=this.interactions[0].choices[0].replace("$1",V.player.level*10),super.interact(e)}};var G0=class extends ri{constructor(e){super({type:5,...e})}};var H0=class extends G0{constructor(e){super({...e,...C.npcs.stash})}};var Y0=class extends ri{constructor(e){super({type:8,...e})}};var X0=class extends Y0{constructor(e){super({...e,...C.npcs.trader});let n=p1.get(e.creature.id);this.items=[],Lf.forEach(i=>{if(i.shop===n.shop){let s=new xs,o=ie();s.hydrate({type:i.type,tier:i.tier,stacks:i.stacks===0?void 0:i.stacks,upgrade:i.upgrade,store:o}),s.buyid=i.id,this.items.push([s,o])}})}};var Q0=class{constructor(e){this.entity=e,this.slots=new Map,this.gold=0,this.medals=0,this.size=0,this.firstEmptySlot=0,this.firstEmptySlotDirty=!0,this.setSize(0)}tickFixed(e,n,i){}setSize(e){this.size=Math.min(100,e)}setGold(e){this.gold=e}setMedals(e){this.medals=e}setItem(e,n){let i=new xs(n);return this.slots.set(e,i),e===this.firstEmptySlot&&(this.firstEmptySlotDirty=!0),i}removeItem(e){let n=this.slots.get(e);return this.slots.delete(e),(e<this.firstEmptySlot||this.firstEmptySlot===-1)&&(this.firstEmptySlot=e),n}async hydrateItems(e=!1){let n=[],i=[];if(this.slots.forEach((s,o)=>{s.dirty&&(s.dirty=!1,n.push(s.dbid),i.push(o))}),n.length){let s=await this.fetchData(n);this.compareData(s,i,0),this.postHydrate(i,e)}else e&&this.postHydrate(i,e)}hydrate(e){this.slots.has(e.slot)?this.slots.get(e.slot).hydrate(e):console.error("received hydration of unknown item")}postHydrate(e){}compareData(e,n,i){e.forEach(s=>{s.slot!==null&&(this.hydrate(s),n=n.filter(o=>o!==s.slot))}),n.forEach(s=>this.removeItem(s,i))}findFirstItemOfType(e,n){for(let i of this.slots)if(i[1].type==e&&i[1].tier==n)return i[1]}findFirstSlotOfType(e,n){let i=-1,s=0;for(let o of this.slots){let r=o[0],l=o[1];l.type==e&&l.tier==n&&r>i&&l.bound>=s&&(i=r,s=l.bound)}return i>=0?i:void 0}getFirstEmptySlot(){if(this.firstEmptySlotDirty){this.firstEmptySlotDirty=!1;for(let e=0;e<this.size;++e)if(!this.slots.has(e))return this.firstEmptySlot=e;this.firstEmptySlot=-1}return this.firstEmptySlot}findFirstUnmaxedStackableOfType(e,n){for(let i of this.slots)if(i[1].type==e&&i[1].tier==n&&i[1].stacks<50)return i[1];return-1}};var Z0,J0=class extends Q0{constructor(e){super(e),this.dirty=!1}tickFixed(e,n,i){super.tickFixed(e,n,i),this.dirty&&(this.hydrateItems(),this.dirty=!1)}setGold(e,n,i){super.setGold(e),cu(e,n,i,"$g"),Yi.set(e)}setMedals(e,n,i){super.setMedals(e),cu(e,n,i,"$m"),oa.set(e)}setItem(e,n,i){let s=super.setItem(e,n);s.reason=i,this.dirty=!0}removeItem(e,n){kF(super.removeItem(e),n),Z0[e]!==void 0&&(Z0[e].set(void 0),this.dirty=!0,this.updateInventoryCounts())}hydrate(e){e.store=Z0[e.slot],super.hydrate(e)}postHydrate(e){super.postHydrate(e),this.updateInventoryCounts()}updateInventoryCounts(){let e={};this.slots.forEach(n=>{let i=n.type+n.tier;e[i]=(e[i]||0)+(n.stacks?n.stacks:1)}),la.set(e)}async fetchData(e){let n=await fetch("/api/item/get",{method:"POST",body:JSON.stringify({ids:e})}),i=await n.json();if(i==="error"||n.ok===!1)console.error("inventory hydration error",i);else return i}setSize(e){super.setSize(e),ra.update(n=>{for(let i=111;i>=0;--i)i>=101?n[i]||(n[i]=ie(void 0)):i>=this.size?n[i]&&delete n[i]:n[i]||(n[i]=ie(void 0));return Z0=n,n})}};var K0=class extends Ll{constructor(e){super(e),V.setPlayer(this),this.skills.isPlayer=!0,this.skills.clearSkillInfo(),this.inventory=new J0(this),this.partyInfoUpdateTimer=new kt(0,1),this.heartBeatTimer=new kt(0,1),this.secondlyUpdates=new kt(0,1),this.lastNetRot=this.rot,this.inputTicksPassed=0,this.inputTicksSinceLastPosUpdate=0,this.inputTicksSinceLastRotUpdate=0,ni[1]=.7,this.smoothZoom=0,this.areaid=-1}makeVisual(e,n){super.makeVisual(e,n),this.visual.soundPrio=1}tickFixed(e,n,i){super.tickFixed(e,n,i),this.inventory.tickFixed(e,n,i)}preFixed(e,n,i){super.preFixed(e,n,i),(nt.turnright.down||nt.turnleft.down)&&(ni[0]=Ra(ni[0]+re.mouseSensitivity*3*e*((nt.turnleft.down?1:0)-(nt.turnright.down?1:0)))),this.handleInput(e,n,i)}postFixed(e,n,i){super.postFixed(e,n,i)}handleInput(e,n,i){this.inputTicksPassed++;let s=!1,o=!1,r=!1,l=!1,a=!1,c=!1,f=this.steer[0],u=this.steer[1],m=this.jump,g=this.rot,v=f,_=u,b=m,y=g;this.hasMovementOverride()?(this.buffMovementOverride(e,n,i),f=this.steer[0],u=this.steer[1],m=this.jump,g=this.rot):(f=(nt.left.down?1:0)+(nt.right.down?-1:0),u=(nt.fwd.down||nt.lmb.down&&nt.rmb.down?1:0)+(nt.back.down?-1:0),m=nt.jump.down?1:0,g=re.lockedcamera&&nt.lmb.down||nt.rmb.down||nt.turnleft.down||nt.turnright.down?ni[0]:this.rot),(f!==v||u!==_)&&(o=f!==v,r=u!==_,this.setSteer(f,u)),m!==b&&(this.setJump(m),a=!0);let k=cl(g,this.lastNetRot);this.inputTicksSinceLastRotUpdate++,g!==y&&this.setRot(g),g!==this.lastNetRot&&((this.steer[0]!==0||this.steer[1]!==0)&&Math.abs(k)>.1||this.inputTicksSinceLastRotUpdate>10||r||o||Math.abs(k)>.2)&&(this.lastNetRot=y,s=!0);let A=this.getStatBasedMoveSpeed();A!=this.speed&&(this.setSpeed(A),l=!0),this.inputTicksSinceLastPosUpdate++,this.inputTicksSinceLastPosUpdate>600?c=!0:this.inputTicksSinceLastPosUpdate>40?(this.steer[0]!==0||this.steer[1]!==0)&&(c=!0):this.inputTicksSinceLastPosUpdate>20&&(this.steer[0]!==0||this.steer[1]!==0)&&(s||o||r)&&(c=!0),(s||o||r||l||a||c)&&this.sendInput(s,o,r,l,a,c)}sendInput(e,n,i,s,o,r){let l={uint8s:[],int8s:[],uint16s:[],doubles:[]};l.uint8s.push(Math.min(254,this.inputTicksPassed)),o&&l.uint8s.push(this.jump),n&&!i?l.int8s.push(this.steer[0]):(n||i)&&l.int8s.push(this.steer[0],this.steer[1]),e&&(this.inputTicksSinceLastRotUpdate=0,l.doubles.push(this.rot)),r&&(this.inputTicksSinceLastPosUpdate=0,l.doubles.push(this.pos[0],this.pos[1],this.pos[2])),s&&l.uint16s.push(this.speed),Si(Ft.clientPlayerInput.packData(l)),this.inputTicksPassed=0}updateCharPanel(){(re.charpanelOpen||re.skillmenuOpen)&&this.statsDirty&&(this.statsDirty=!1,jo.update(e=>(Array.from(this.stats.stat).forEach(i=>e[i[0]]=i[1]),e)))}updatePartyInfo(e){if(this.partyInfoUpdateTimer.done(e)){this.partyInfoUpdateTimer.reset(e);let n=this.getNearbyPartyMembers(this.pos),i=S1(n.length);Zn.update(s=>(s.role=this.partyrole,s.nearby=n.length,s.exprate=Math.round(i*100),s.itemfind=Math.min(10*100,Math.round(i*100+xy(n)*100)),s))}}handleCamera(e){if(st(Ht.position,this.mount?this.mount.transform.position:this.visual.transform.position),Ht.position[1]+=1.25,Ht.rotation[0]=ni[1],!nt.lmb.down&&!nt.rmb.down&&(this.steer[0]!==0||this.steer[1]!==0)){let u=cl(this.rot,ni[0])*Math.min(1,e*2);u!==0&&(Math.abs(u)>.03*e?(u=u>0?Math.max(u,Math.min(1,.6*e)):Math.min(u,Math.max(1,-.6*e)),ni[0]-=u):ni[0]=this.rot)}Ht.rotation[1]=ni[0],Rt(Ht,!1);let n=re.cameraZoom;X(gt.transform.position,0,0,-n),da(gt,!1);let i=[0,0,0],s=[0,0,0],o=[0,0,0];mo(gt,o,[0,0]),Xt(i,o,Ht.position),Cm(s,i);let r=mi(i),l=[0,0,0],a=[0,0,0],c=[[-1,1],[1,1],[-1,-1],[1,-1]];for(let u=0;u<c.length;++u){let m=c[u];mo(gt,l,m),Xt(a,l,o),zn(l,Ht.position,a);let g=V.triangleGrid.queryRay(l,i,s),v=1;for(let _=0;_<g.length;++_){let b=g[_];v=Math.min(v,Ba(b[0],b[1],b[2],l,i,!0))}v<1&&(n=Math.min(r*v,n))}if(this.smoothZoom=Math.max(0,Math.min(this.smoothZoom+e*20,n)),X(gt.transform.position,0,0,-this.smoothZoom),Ph(gt),!this.belowGround){mo(gt,l,[0,-1]);let u=V.getHeight(l[0],l[2]);u>l[1]&&(Ht.position[1]+=u-l[1])}Rt(Ht,!1),da(gt,!1),mo(gt,l,[0,-1]);let f=V.getWaterHeight(l[0],l[2]);if(f>l[1]){let u=f-l[1];Hd(u);let m=l[1]-f;if(mo(gt,l,[0,1]),f<l[1]){let g=l[1]-f;Math.abs(g)>Math.abs(m)?(Ht.position[1]-=m,Hd(0)):Ht.position[1]-=g,Rt(Ht,!1),da(gt,!1)}}else Hd(0)}handleAreaCheck(e){let n=e.getAreaId(this.pos[0],this.pos[2]);if(n!==this.areaid){this.areaid=n;let i=Df.get(n);i!==void 0&&Er.set({type:"area",text:i.name,time:5e3})}}handleHeartBeat(e){let n=this.stats.getResource(6)/(this.stats.getStat(6)*.5);n>0&&n<1&&(n=(Math.max(0,Math.min(1,n))+.5)/1.5,Mt(103),this.heartBeatTimer.reset(e,n))}postDelta(e,n,i){this.updateCharPanel(),this.updatePartyInfo(n),super.postDelta(e,n,i),this.handleCamera(e),this.secondlyUpdates.done(n)&&this.handleAreaCheck(i),this.heartBeatTimer.done(n)&&this.handleHeartBeat(n)}updateTransformRotation(e){this.stats.alive&&this.buffs.visualFreeze===0&&(this.updateMountRotation(e),this.buffs.movementOverride.size||!nt.rmb.down&&!(re.lockedcamera&&nt.lmb.down)?this.visual.transform.rotation[1]=this.rot:this.visual.transform.rotation[1]=ni[0],this.visual.transform.rotation[1]+=this.mountRotAdd)}setLevel(e){super.setLevel(e),this.uiFrameDirty=!0}onRemove(){super.onRemove(),V.removePlayer(this)}setExp(e){super.setExp(e),mm.update(n=>(n.current=e,n.max=ir(this.level),n))}setClan(e,n=0){super.setClan(e,n),km.set(e)}setRot(e,n=!1){super.setRot(e),n&&(ni[0]=e)}};var I2=new Map([[6,C0],[2,A0],[7,I0],[4,q0],[0,Ll],[9,W0],[12,V0],[5,H0],[8,X0],[3,T0],[1,z0],[10,$0],[11,U0]]),IP=(t,e)=>t==0?e==V.playerId?K0:Ll:I2.get(t);var D2=[-0,-1,-0],eh=class{constructor(){this.id="",this.idInt=0,this.file="",this.bounds=0,this.chunkAmount=0,this.entities={array:[],map:new Map,type:{}},I2.forEach((e,n)=>this.entities.type[n]=[]),this.mode=kp.normal,this.chunksMap=new Map,this.chunksArray=[],this.finishedLoadingChunks=new Set,this.time=this.accum=-0,this.timestep=1/60,this.tickId=0,this.data=void 0,this.triangleGrid=new d0}load(e,n){this.id=e,this.file=n,d1.forEach(i=>{i.name===n&&(this.data=i,this.idInt=i.id)}),this.parse(!1)}tickIdToTimestamp(e){return e*this.timestep}setTimeFromTickId(e){return this.tickId=e,this.time=this.tickIdToTimestamp(e),this.tickId}createEntity(e,n,i){return i=i||{},i.id=n,new(IP(e,n))(i)}addEntity(e){if(e===void 0||e.type===void 0){console.log("Error: tried adding an entity of unknown type to the world");return}if(this.entities.array.length>=32766){console.log("Error: tried addint entity but we already are at the maximum");return}if(this.isEntityInWorld(e)||this.isEntityIdTaken(e.id)){console.log("Error: Entity in world or entity id taken"),console.log(e),console.log(this.getEntityById(e.id));return}return this.entities.array.push(e),this.entities.map.set(e.id,e),this.entities.type[e.type].push(e),e}removeEntity(e){if(e===void 0)return!1;this.entities.map.delete(e.id);let n=this.entities.array.indexOf(e);return n>-1&&this.entities.array.splice(n,1),n=this.entities.type[e.type].indexOf(e),n>-1&&this.entities.type[e.type].splice(n,1),e.onRemove(),e}isEntityIdTaken(e){return this.entities.map.has(e)}isEntityIdAllowed(e){return!0}isEntityInWorld(e){return this.entities.array.indexOf(e)>=0}entity(e){return this.entities.map.get(e)}getEntityById(e){return this.entities.map.get(e)}getPlayerByName(e){let n=e.toLowerCase();return this.entities.type[0].find(i=>i.name&&i.name.toLowerCase()===n)}getMonsterByName(e){let n=e.toLowerCase();return this.entities.array.find(i=>i.name&&i.name.toLowerCase()===n)}setMode(){this.mode=kp[this.id]||kp.normal}getHeight(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-0:Fs(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getHole(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-0:Fu(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getWaterHeight(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-1:Cu(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getAreaId(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-0:Kv(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getEnvironmentId(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-0:e2(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getNormal(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);if(!i||!i.deserialized)X(D2,0,0,0);else{e=e>=this.bounds?63:e%64,n=n>=this.bounds?63:n%64,e/=2.6666666666666665,n/=2.6666666666666665;let s=Math.floor(e)*2+24*Math.floor(n)*2;e%1+n%1>1&&s++,s*=3,X(D2,i.normals[s],i.normals[s+1],i.normals[s+2])}return D2}clampV3(e){return e[0]=vt(e[0],0,this.bounds),e[1]=vt(e[1],0,2e3),e[2]=vt(e[2],0,this.bounds),e}getChunkFromWorld(e,n){return e=vt(e,0,this.bounds),n=vt(n,0,this.bounds),e=Math.min(Math.floor(e/64),this.chunkAmount-1),n=Math.min(Math.floor(n/64),this.chunkAmount-1),this.chunksMap.get(e+n*this.chunkAmount)}getChunk(e,n){if(!(e<0||n<0||e>=this.chunkAmount||n>=this.chunkAmount))return this.chunksMap.get(e+n*this.chunkAmount)}parse(e){this.setMode(),e||(this.chunkAmount=this.data.chunkAmount,this.bounds=64*this.chunkAmount,this.setGrids(),this.finishedLoadingChunks.clear(),this.createChunks())}setGrids(){this.triangleGrid.setDimensions(this.bounds,this.bounds,this.bounds,15,15,15)}rebuildTriangleOctree(){this.triangleGrid.clear(),this.chunksMap.forEach(e=>{for(let n=0;n<e.props.length;++n){let i=e.props[n];i.loaded=!1,i.loadGeometry(this,e)}})}triangleRaycastClosest(e,n,i,s,o,r){h0(oi,e,n,i,s,o,r);let l=1,a=this.triangleGrid.queryRay(oi.origin,oi.dir,oi.invDir);for(let c=0;c<a.length;++c){let f=a[c];l=Math.min(l,Ba(f[0],f[1],f[2],oi.origin,oi.dir,!1))}return l}triangleRaycastAny(e,n,i,s,o,r,l){h0(oi,e,n,i,s,o,r);let a=this.triangleGrid.queryRay(oi.origin,oi.dir,oi.invDir);for(let c=0;c<a.length;++c){let f=a[c];if(Ba(f[0],f[1],f[2],oi.origin,oi.dir,l)<1)return!0}return!1}raycastEnvironmentClosest(e,n,i,s,o,r){let l=this.getHeight(e,i)>n,a=this.triangleRaycastClosest(e,n,i,s,o,r);a<1&&(s*=a,o*=a,r*=a);let c=0,f=0,u=.1;if(l)f=1;else for(;c<100&&f<1;){let m=f+u,g=e+s*m,v=n+o*m,_=i+r*m,b=this.getHole(e,i)?0:this.getHeight(g,_),y=v-b;y<0?y>-.05?(f+=u,c=100):u*=.5:f+=u,c++}return Math.min(f,a,1)}raycastEnvironmentAny(e,n,i,s,o,r,l){let a=Math.sqrt(s*s+o*o+r*r),c=3/a,f=s*c,u=o*c,m=r*c,g=e,v=n+l,_=i,b=Math.floor(a/3),y=0;for(;y<b;)if(++y,g+=f,v+=u,_+=m,this.getHeight(g,_)>v)return!0;return this.triangleRaycastAny(e,n,i,s,o,r,!0)}raycastEnvironmentHeight(e,n,i,s,o){let l=this.getHole(e,n)?0:this.getHeight(e,n),a=0;i>l&&(o!==void 0&&st(o,this.getNormal(e,n)),a=l);let c=i-s;io[0]=io[3]=e,io[5]=io[2]=n,io[4]=i,io[1]=s;let f=this.triangleGrid.queryAABB(io);if(f.length>0){let u=1/0;h0(oi,e,i,n,0,-c,0);for(let m=0;m<f.length;++m){let g=f[m],v=Ba(g[0],g[1],g[2],oi.origin,oi.dir,!1);if(v<u){u=v;let _=i-v*c;_>a&&(a=_,o!==void 0&&st(o,g[3]))}}}return a}addChunk(e){this.chunksMap.set(e.id,e),this.chunksArray.push(e)}removeChunk(e){this.chunksMap.delete(e.id),this.chunksArray.splice(this.chunksArray.indexOf(e),1)}};var DP=(t,e,n="")=>{Rc.update(i=>(i.push({text:t,icon:e,css:n}),i))};var qz={2:"On cooldown.",3:"Can only be cast on enemy.",4:"Can only be cast on ally.",5:"Not enough mana.",6:"Out of range.",10:"Target is dead.",7:"Can't do that during movement.",8:"Can't cast while busy.",9:"You are incapacitated.",11:"Can't do that in combat.",12:"Can't cast this right now.",13:"Level difference is too big.",14:"Target is not in line of sight."},VP=new Map;VP.set(16,t=>{if(Gt("system",`You have learned ${C.items.book[t[0]].name} Lv. ${t[1]}`,!0),Mt(89),sn(24,100),t[1]===0&&Pt.get(t[0]).autoSkillbar){let e=re.skillbarsettings[V.player.name].findIndex(n=>n.id===-1);e>=0&&wi[e].update(n=>(n.id=t[0],n))}}).set(15,t=>{V.player.skills.add(t[0],_i(t[2]),_i(t[3]),t[1])}).set(17,t=>{V.player.skills.remove(t[0])}).set(18,t=>{V.player.skills.updateSkillsLearned(t)}).set(19,t=>{$c.set(oo(t,0))}).set(1,t=>{Er.set({type:"error",text:qz[t[0]]})}).set(20,t=>{V.player.setExp(t[1]),re.chat[0]&&Gt("exp",`Gained ${t[0]} experience. ${V.player.exp}/${ir(V.player.level)}`,!0),Qg(t[0])}).set(21,t=>{V.player.setExp(t[1]),Gt("error",`Lost ${t[0]} experience. ${V.player.exp}/${ir(V.player.level)}`,!0)}).set(22,t=>{V.player.setExp(t[0])}).set(45,t=>{let e=V.entity(t[1]);Mt(104),e&&IA(st([0,0,0],e.visualPosition),t[0]),re.chat[11]&&Gt("fame",`Gained $fm${t[0]} fame ${e?"from "+e.name:""}`,!0)}).set(46,t=>{re.chat[11]&&Gt("fame",`Lost $fm${t[0]} fame.`,!0)}).set(47,t=>{Mt(104),re.chat[11]&&Gt("fame",`Gained $fm${t[0]} salary from the war.`,!0)}).set(48,t=>{Mt(105),re.chat[11]&&Gt("fame",`War: Gained $fm${t[0]} spoils of war (Fight ${t[1]>0?"Victory!":"Loss!"}).`,!0)}).set(49,t=>{Mt(105),re.chat[11]&&Gt("fame",`Obelisk: Captured obelisk for $fm${t[0]} and $m${t[2]}.`,!0),V.player.inventory.setMedals(t[1],t[2],1)}).set(50,t=>{$s.set(),Ns.set(!1),t[0]===1&&Gt("system","War: You have left the war due to inactivity.",!0)}).set(23,t=>{let e=V.getEntityById(t[0]);e&&e.interact(t)}).set(24,t=>{Bs.set(void 0)}).set(25,t=>{Gt("system",oo(t,0),!0)}).set(26,t=>{Gt("error",oo(t,0),!0)}).set(52,t=>{let e=oo(t,1);Fa(C.ui.party.summon,C.ui.party.onSummon.replace("$1",e),[{text:C.ui.accept,nocombat:!0,remaining:20,fun:()=>{xt("summonaccept",e)}},{text:C.ui.decline,fun:()=>{}}])}).set(27,t=>{let e=oo(t,1);Fa(C.ui.party.invite,C.ui.party.onInvite.replace("$1",e),[{text:C.ui.accept,fun:()=>{xt("partyaccept",t[0]+"")}},{text:C.ui.decline,fun:()=>{xt("partydecline",t[0]+"")}}])}).set(29,t=>{V.player.inventory.setItem(t[0],t[1],t[2])}).set(30,t=>{V.player.inventory.removeItem(t[0],t[1])}).set(31,t=>{V.player.inventory.setGold(t[0],t[1],t[2])}).set(32,t=>{V.player.inventory.setMedals(t[0],t[1],t[2])}).set(33,t=>{Bo.set(t[0]),cu(t[0],t[1],12,"$sp")}).set(34,t=>{pm.set(t[0]==0?void 0:t[0]-1)}).set(51,t=>{dm.set(t[0]==0?void 0:t[0]-1)}).set(35,t=>{cs.set(t[0]),t[0]&&Mt(106)}).set(36,t=>{vm.set(t.pop()),Rz(t,aa)}).set(37,t=>{Ir.update(e=>!e),Gt("inv",C.ui.merchant.auctioncancel,!0)}).set(38,t=>{let e=t.slice(2),n=[],i=[],s=[],o=[],r=[n,s,i],l=0,a=0,c=n;for(let f=0;f<e.length;f++)if(a===0)a=e[f],c=r[l],++l;else{let u=new xs(e[f]);o.push(u),c.push(u),--a}_m.set({self:n,other:i,nonOrAcc:s,all:o}),t[0]&&Mt(107),Li.set({gold:t[1]})}).set(39,t=>{Li.set({gold:t[0]})}).set(40,t=>{Li.set(!1)}).set(41,t=>{Xi.set(!0),Mt(108),sn(22,100)}).set(42,t=>{Xi.set(!1)}).set(43,t=>{js.set(!0)}).set(44,t=>{js.set(!1)}).set(54,t=>{let e=V.entity(t[0]);e!==void 0&&(e.party=1)}).set(55,t=>{window.open("/leaderboards?mode=1&kill="+t[0],"_blank")}).set(56,t=>{vd()}).set(53,t=>{let e=t[0];e<1e3&&e>0&&Er.set({type:"error",timer:500,text:e}),e<=5&&e>0?Mt(109):e===0?Mt(110):e===1e3?Mt(111):e===2e3&&Mt(112)});var Rz=(t,e)=>{e.update(n=>(n.length=0,t.forEach(i=>{n.push(new xs(i))}),n))},LP=(t,e)=>{V.player&&VP.get(t)(e)},qP=new Map;qP.set(0,(t,e,n)=>{}).set(1,(t,e,n)=>{V.removeEntity(t)}).set(2,(t,e,n)=>{e[1]>0&&e[1]!==t.target&&t.visual&&t.type!==0&&t.visual.onAggro(),t===V.player&&_g(e[1])}).set(3,(t,e,n)=>{for(let i=1;i<e.length;i+=2)t.stats.setResource(e[i],e[i+1])}).set(6,(t,e,n)=>{for(let i=1;i<e.length;i+=2)t.stats.setResource(e[i],e[i+1])}).set(4,(t,e,n)=>{for(let i=1;i<e.length;i+=2)t.stats.setStat(e[i],e[i+1])}).set(5,(t,e,n)=>{if(t==V.player&&(sn(6,100),t.skills.cd(e[1],V.time,_i(e[2])),e[5]>0&&t.skills.globalCd(_i(e[4]),_i(e[5]))),!n&&t.visual&&!t.visual.inFog){let s=Pt.get(e[1]);(!s.castLen||!t.visual.currentAnim)&&s.fx.animCast&&t.visual.anim(s.fx.animCast),t.visual.onYell()}}).set(22,(t,e,n)=>{t.skills.startTimedCast(Pt.get(e[1]),_i(e[2]),e[3],_i(e[4])),e[5]>0&&t.skills.globalCd(_i(e[2]),_i(e[5]))}).set(23,(t,e,n)=>{t.skills.interruptTimedCast(!0,e[1]===1)}).set(24,(t,e,n)=>{t.skills.finishTimedCast(_i(e[1]))}).set(7,(t,e,n)=>{let i=e[1],s=e[2],o=V.getEntityById(e[3]),r=e[4],l=e[5],a=e[6],c=e[7];o!==void 0&&re.dpsmeterMode===0&&hd(o,i,s);let f=t===V.player,u=o===V.player;f?re.showIncomingDamage&&k2([-.3,-.3,.5],i,l,a,!0,0):u&&k2(t.visualPosition,i,l,a,!1,2),l>0&&t.stats.changeResource(6,-i),c>0&&(t.stats.refreshCombatTimer(V.time,c),o&&o.stats.refreshCombatTimer(V.time,c));let m=Pt.get(s);if(!n&&l>0&&t.visual&&!t.visual.inFog){let g=r>0&&Mr.has(r)?Mr.get(r).effect.transform:o&&o.visual&&o.visual.transform,v=t.visual.transform;o&&o.visual&&m.fx.animImpact&&o.visual.anim(m.fx.animImpact,!1,t.id),l!==1?(t.visual.onHurt(i/t.stats.getStat(6),l),g&&V2(m,g,v,t.radius,u?1:0)):g&&(m.fx.effectDirImpact||m.fx.animImpact)&&zP(13,g,v,t.radius,u?1:0)}}).set(8,(t,e,n)=>{let i=V.getEntityById(e[3]);i!==void 0&&re.dpsmeterMode===1&&hd(i,e[1],e[2]),i&&e[5]>0&&i.stats.refreshCombatTimer(V.time,e[5]);let s=t===V.player,o=i===V.player;s?re.showIncomingHeal&&x2([.3,-.3,.5],e[1],e[4],!0,0):o&&x2(t.visualPosition,e[1],e[4],!1,2),t.stats.changeResource(6,e[1]);let r=Pt.get(e[2]);!n&&i&&i.visual&&t.visual&&!t.visual.inFog&&V2(r,i.visual.transform,t.visual.transform,t.radius,s||o?1:0)}).set(9,(t,e,n)=>{t.stats.changeResource(7,e[1]);let i=V.getEntityById(e[3]),s=t===V.player;s&&re.showIncomingHeal&&EA([.35,-.2,.5],e[1],e[4],!0,0);let o=Pt.get(e[2]);!n&&i&&i.visual&&t.visual&&!t.visual.inFog&&!i.visual.inFog&&V2(o,i.visual.transform,t.visual.transform,t.radius,s?1:0)}).set(10,(t,e,n)=>{e[1]==0?t.stats.alive&&(t.stats.die(),t==V.player?Fa(C.ui.death.death,C.ui.death.deathmsg,[{text:C.ui.death.respawn,blockedTime:Math.max(0,Math.ceil(e[2]-V.time)+1),fun:()=>{xt("respawn","")}}]):V.player&&t.id==Rn&&sn(7,100)):t.stats.alive||t.stats.respawn()}).set(11,(t,e,n)=>{t.setFaction(e[1])}).set(14,(t,e,n)=>{t.setLevel(e[1])}).set(16,(t,e,n)=>{t.setClass(e[1])}).set(12,(t,e,n)=>{t.setName(oo(e,1))}).set(13,(t,e,n)=>{t.setClan(e.length>2?oo(e,2):void 0,e[1])}).set(15,(t,e,n)=>{if(t.setLevel(e[1]),re.chat[6]){let i=`${t==V.player?"You":zz(e[0])} leveled up to ${e[1]}!`;Gt("lvlup",i),t==V.player&&(sn(16,100),Pt.forEach(s=>{s.class===V.player.class&&s.minlevel===e[1]&&(sn(19,100),DP(`<span class=textprimary><b class=textgreen>${C.items.book[s.id].name}</b><br>Skill book available at the Trader!</span>`,`skills/${s.id}.${Gn}`,"border primary"))}))}t.visual&&!t.visual.inFog&&Ms(26,t.visual.transform,t==V.player?1:0,!1)}).set(17,(t,e,n)=>{t.buffs.setBuff(e[1],e[2],e[3],_i(e[4]),_i(e[5]),e[6],e[7],e.length>8?e.slice(8):void 0)}).set(19,(t,e,n)=>{e[2]===V.playerId&&TA(t.visualPosition,2,!1)}).set(18,(t,e,n)=>{t.buffs.removeBuff(e[1],e[2])}).set(20,(t,e,n)=>{let i=Pt.get(e[1]),s=new kt(V.time,_i(e[4])-V.time+.2);g8(e[0],e[2],i,e[3],s)}).set(21,(t,e,n)=>{let i=Pt.get(e[1]),s=e[2],o=_i(e[3])-V.time,r=new kt(V.time,o),l=4,a=e.length-l,c=a>6?2+(a-6)/4:2,f=[],u=[];for(let m=l;m<l+c*3;m+=3)f.push([md(e[m],6400),md(e[m+1],6400),md(e[m+2],6400)]);if(c>2)for(let m=l+c*3;m<e.length;++m)u.push(e[m]/65535);v8(t.id,f,u,i,s,r)}).set(25,(t,e,n)=>{t.setParty(e[1],e[2])}).set(26,(t,e,n)=>{t.hasInfo===!1&&t.setDropInfo(e[1],e[2],e[3],e[4],e[5])}).set(27,(t,e,n)=>{t.setNodeInfo(e[1],e[2],e[3])}).set(28,(t,e,n)=>{t.setPosLock(e[1],e[2],e[3])});var RP=(t,e,n)=>{let i=V.getEntityById(e[0]);i===void 0||qP.get(t)(i,e,n)},zz=t=>{let e=V.getEntityById(t);return`${t>0?e?e.name:"unknown":"nobody"}`},zP=(t,e,n,i,s)=>{let o=Ms(t,rn(),s,!0);Tm(o.transform,n,e,i),Rt(o.transform,!1)},V2=(t,e,n,i,s)=>{if(t.fx.effectDirImpact&&zP(t.fx.effectDirImpact,e,n,i,s),t.fx.effectImpact){let o=Ms(t.fx.effectImpact,rn(),s,!0);st(o.transform.position,n.position),Rt(o.transform,!1)}t.fx.effectTarget&&Ms(t.fx.effectTarget,n,s,!1)};var Bz=[Bs,cs,Li,js,Xi],Uz=[ia,aa,co],Oz=[Us,Os],BP=()=>{Oz.forEach(t=>t.update(e=>(e.visible=!1,e))),Zn.update(t=>(t.membercount=0,t.role=0,re.partyinfo=t,t)),Bz.forEach(t=>t.set()),Uz.forEach(t=>t.set([]))};var th=class extends eh{constructor(){super(),this.smoothtime=0,this.state=0,this.playerId=0,this.removePlayer(),this.netTimeoutTimer=new kt,this.chunkCache=[],Un("close",()=>{this.onDisconnect()}),this.netData=[],Un(Ft.serverEntityDelta.header,e=>{this.netData.push(Ft.serverEntityDelta.decode(e))}),Un(Ft.ping.header,e=>{A3(Ft.ping.decode(e))}),Un(Ft.serverChangeWorld.header,e=>{Or.set(Ft.serverChangeWorld.decode(e).world)}),Un(Ft.serverQueue.header,e=>{this.setState(1,"Queue Position: "+Ft.serverQueue.decode(e).pos)})}setState(e,n=""){this.state===2&&e===4&&NA(this),this.state=e,xi.set(e!==4?n:!1)}handleEntityCreation(e){for(let n=0,i=e.log.length;n<i;++n){let s=e.log[n];s.type===0&&(this.isEntityIdTaken(s.data[0])||this.addEntity(this.createEntity(s.data[1],s.data[0],{creature:u1.get(s.data[2])})))}}handleEntityInput(e){for(let n=0;n<e.inputs.length;++n){let i=e.inputs[n],s=this.entity(i.id);s!==void 0&&(E3(s.steer,i.steer),s.setRot(i.rot,!0),s.setJump(i.jump),s.setSpeed(i.speed))}}handleEntityMovements(e){for(let n=0;n<e.movements.length;++n){let i=e.movements[n],s=this.entity(i.id);if(s!==void 0){let o=e.inputs[n];s.handleMovementData(i,o)}}}handleEntityLog(e){for(let i=0,s=e.log.length;i<s;++i)RP(e.log[i].type,e.log[i].data,!1)}handlePersonalLog(e){for(let n=0,i=e.logPersonal.length;n<i;++n)LP(e.logPersonal[n].type,e.logPersonal[n].data)}pollNetData(e){let n=this.netData[0];if(n!==void 0)return Math.abs(n.tickId-e)>1&&(e=this.setTimeFromTickId(n.tickId)),n.tickId<=e?(this.netData.shift(),n):void 0}tickDelta(e,n){let i=this.time+n;for(let s=this.entities.array.length-1;s>=0;--s){let o=this.entities.array[s];o.preDelta(e,i,this),o.tickDelta(e,i,this),o.postDelta(e,i,this)}}tickFixed(e,n){let i=this.pollNetData(n);if(i!==void 0&&(this.handleEntityCreation(i),this.handleEntityInput(i),this.handleEntityLog(i),this.handlePersonalLog(i),this.handleEntityMovements(i)),this.state>2)for(let s=this.entities.array.length-1;s>=0;--s){let o=this.entities.array[s],r=this.getChunkFromWorld(o.pos[0],o.pos[2]);r!==void 0&&r.state>=5&&(o.preFixed(e,this.time,this,1),o.tickFixed(e,this.time,this,1),o.postFixed(e,this.time,this,1))}this.handleNetTimeouts()}tick(e){for(this.netData.length>5&&(this.accum+=(this.netData.length-5)*this.timestep),e=Math.min(e,1),this.accum+=e;this.accum>this.timestep;)this.accum-=this.timestep,this.setTimeFromTickId(this.tickId+1),this.tickFixed(this.timestep,this.tickId);this.setSmoothTime(e),this.state>2?(this.tickDelta(e,this.accum),S3()):this.player&&st(Ht.position,this.player.pos),this.player&&this.manageChunks(e)}handleNetTimeouts(){if(this.player&&(this.netTimeoutTimer.done(this.time)||this.time<this.netTimeoutTimer.start)){this.netTimeoutTimer.reset(this.time-.5,1);for(let e=this.entities.array.length-1;e>=0;e--){let n=this.entities.array[e];n!==this.player&&(ei(n.pos,this.player.pos)<14400?n.netDeletion.reset(this.time,2):n.netDeletion.end>0&&n.netDeletion.done(this.time)&&(this.removeEntity(n),n.id===this.player.target&&this.player.setTarget(0)))}}}removeEntity(e){let n=super.removeEntity(e);return n&&this.state>2&&e1(e),n}load(e,n,i){this.destroy(),super.load(e,n),this.playerId=i,this.setState(2,"Loading World")}parse(e){super.parse(e),SA(this,!e)}onDisconnect(){W1(),this.netData.length=0,this.setState(0,"Loading World")}destroy(){this.setState(0,"Loading World");for(let e=0;e<this.chunksArray.length;e++){let n=this.chunksArray[e];this.returnCachedChunk(n),b2(n)}this.chunksMap.clear(),this.chunksArray.length=0;for(let e=this.entities.array.length-1;e>=0;e--)this.removeEntity(this.entities.array[e]);this.data=void 0,this.bounds=1,this.triangleGrid.clear(),AA(this),jA(this)}setPlayer(e){this.player=e,Uc.set(!0),BP()}removePlayer(e){this.player===e&&(this.player=void 0,this.playerId=0,Uc.set(!1),$s.set(),Ns.set(!1))}setSmoothTime(e){let n=this.smoothtime-this.time;Math.abs(n)>1?this.smoothtime=this.time:n>.05?this.smoothtime+=e*.5:n<-.05?this.smoothtime+=e*2:this.smoothtime+=e}getInteriorLight(e,n){let i=this.triangleGrid.queryAABB(n);for(let s=0;s<i.length;++s)if(i[s].length>4){Br(e,i[s][4]);return}ti(e,0,0,0,0)}createChunks(){}createCachedChunk(e,n,i){if(this.chunkCache.length){let s=this.chunkCache.pop();return v2(s,e,n,i,this.chunkAmount),s}else{let s=pA();return v2(s,e,n,i,this.chunkAmount),s}}returnCachedChunk(e){this.chunkCache.push(e)}manageChunks(e){rS(e);let n=Math.min(Math.max(0,zv),this.chunkAmount-1),i=Math.min(Math.max(0,Bv),this.chunkAmount-1),s=Math.min(Math.max(0,Uv),this.chunkAmount-1),o=Math.min(Math.max(0,Ov),this.chunkAmount-1),r=[];for(let u=n;u<=i;++u)for(let m=s;m<=o;++m){let g=this.chunkAmount*m+u,v=(u-qv)**2+(m-Rv)**2;r.push({x:u,z:m,id:g,priority:v})}r.sort((u,m)=>u.priority-m.priority);let l=0,a=!1,c=0;for(;l<r.length;){let u=r[l];if(c>10)break;if(this.chunksMap.has(u.id))this.chunksMap.get(u.id).state<3&&(u.priority<9&&(a=!0),c++);else{let m=this.createCachedChunk(u.id,u.x,u.z);this.addChunk(m),m.state=1,u.priority<9&&(a=!0),c++}++l}let f=[];for(let u=0;u<this.chunksArray.length;++u){let m=this.chunksArray[u];Nv&&(m.x+5<n||m.z+5<s||m.x-5>i||m.z-5>o?f.push(m):_2(m)),hA(m,this)}for(let u=f.length-1;u>=0;u--){let m=f[u];this.returnCachedChunk(m),this.removeChunk(m),b2(m)}a!==(this.state!==4)&&this.setState(a?3:4,"Loading World")}};window.onload=async()=>{console.log("Hordes 0.50.8602 Live"),await g1();let t=await fetch("data/game/game.bin?v=8602459");o1(xa.gamedata.decode(new Uint8Array(await t.arrayBuffer()))),vy(),xA(),BA(),new cA({target:document.querySelector("body")}),F3(ZA,JA),_3(new th({})),P2(!0),OP()};var UP=0,OP=()=>{let t=Ff(),e=(t-(UP||1e3/60))/1e3;UP=t,KA(e,t),requestAnimationFrame(OP)};})();
