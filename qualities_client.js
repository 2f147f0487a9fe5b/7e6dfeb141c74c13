(()=>{var RP=Object.defineProperty;var Xn=(t,e)=>{for(var n in e)RP(t,n,{get:e[n],enumerable:!0})};function ue(){}var Fr=t=>t;function Nl(t,e){for(let n in e)t[n]=e[n];return t}function ch(t){return t()}function Gu(){return Object.create(null)}function lt(t){t.forEach(ch)}function qi(t){return typeof t=="function"}function Oe(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}var Wu;function at(t,e){return t===e?!0:(Wu||(Wu=document.createElement("a")),Wu.href=e,t===Wu.href)}function Fn(t,e){return t!=t?e==e:t!==e}function O2(t){return Object.keys(t).length===0}function li(t,...e){if(t==null){for(let s of e)s(void 0);return ue}let n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function oe(t,e,n){t.$$.on_destroy.push(li(e,n))}function jl(t,e,n,s){if(t){let i=$2(t,e,n,s);return t[0](i)}}function $2(t,e,n,s){return t[1]&&s?Nl(n.ctx.slice(),t[1](s(e))):n.ctx}function Wl(t,e,n,s){if(t[2]&&s){let i=t[2](s(n));if(e.dirty===void 0)return i;if(typeof i=="object"){let o=[],r=Math.max(e.dirty.length,i.length);for(let l=0;l<r;l+=1)o[l]=e.dirty[l]|i[l];return o}return e.dirty|i}return e.dirty}function Gl(t,e,n,s,i,o){if(i){let r=$2(e,n,s,o);t.p(r,i)}}function Hl(t){if(t.ctx.length>32){let e=[],n=t.ctx.length/32;for(let s=0;s<n;s++)e[s]=-1;return e}return-1}function Eo(t){return t??""}function tt(t,e,n){return t.set(n),e}var N2=typeof window<"u",Hu=N2?()=>window.performance.now():()=>Date.now(),Fc=N2?t=>requestAnimationFrame(t):ue;var Yl=new Set;function j2(t){Yl.forEach(e=>{e.c(t)||(Yl.delete(e),e.f())}),Yl.size!==0&&Fc(j2)}function Yu(t){let e;return Yl.size===0&&Fc(j2),{promise:new Promise(n=>{Yl.add(e={c:t,f:n})}),abort(){Yl.delete(e)}}}var Cc=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var Xu=class t{_listeners="WeakMap"in Cc?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,n){return this._listeners.set(e,n),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(e=>{for(let n of e)t.entries.set(n.target,n),this._listeners.get(n.target)?.(n)}))}};Xu.entries="WeakMap"in Cc?new WeakMap:void 0;var W2=!1;function G2(){W2=!0}function H2(){W2=!1}function d(t,e){t.appendChild(e)}function fh(t){if(!t)return document;let e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Y2(t){let e=h("style");return e.textContent="/* empty */",BP(fh(t),e),e.sheet}function BP(t,e){return d(t.head||t,e),e.sheet}function w(t,e,n){t.insertBefore(e,n||null)}function x(t){t.parentNode&&t.parentNode.removeChild(t)}function st(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function UP(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function T(t){return document.createTextNode(t)}function $e(){return T(" ")}function be(){return T("")}function X(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function X2(t){return function(e){e.target===this&&t.call(this,e)}}function m(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function $t(t){return t===""?null:+t}function Q2(t){return Array.from(t.childNodes)}function G(t,e){e=""+e,t.data!==e&&(t.data=e)}function We(t,e){t.value=e??""}function qe(t,e,n,s){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,s?"important":"")}function wn(t,e,n){for(let s=0;s<t.options.length;s+=1){let i=t.options[s];if(i.__value===e){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function ks(t){let e=t.querySelector(":checked");return e&&e.__value}function Do(t,e,n){t.classList.toggle(e,!!n)}function Sc(t,e,{bubbles:n=!1,cancelable:s=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:s})}var Qu=class{is_svg=!1;e=void 0;n=void 0;t=void 0;a=void 0;constructor(e=!1){this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,n,s=null){this.e||(this.is_svg?this.e=UP(n.nodeName):this.e=h(n.nodeType===11?"TEMPLATE":n.nodeName),this.t=n.tagName!=="TEMPLATE"?n:n.content,this.c(e)),this.i(s)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)w(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(x)}};function Z2(t){let e={};return t.childNodes.forEach(n=>{e[n.slot||"default"]=!0}),e}var Zu=new Map,Ju=0;function OP(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function $P(t,e){let n={stylesheet:Y2(e),rules:{}};return Zu.set(t,n),n}function Ac(t,e,n,s,i,o,r,l=0){let a=16.666/s,c=`{
`;for(let b=0;b<=1;b+=a){let y=e+(n-e)*o(b);c+=b*100+`%{${r(y,1-y)}}
`}let f=c+`100% {${r(n,1-n)}}
}`,u=`__svelte_${OP(f)}_${l}`,p=fh(t),{stylesheet:g,rules:v}=Zu.get(p)||$P(p,t);v[u]||(v[u]=!0,g.insertRule(`@keyframes ${u} ${f}`,g.cssRules.length));let _=t.style.animation||"";return t.style.animation=`${_?`${_}, `:""}${u} ${s}ms linear ${i}ms 1 both`,Ju+=1,u}function Ku(t,e){let n=(t.style.animation||"").split(", "),s=n.filter(e?o=>o.indexOf(e)<0:o=>o.indexOf("__svelte")===-1),i=n.length-s.length;i&&(t.style.animation=s.join(", "),Ju-=i,Ju||NP())}function NP(){Fc(()=>{Ju||(Zu.forEach(t=>{let{ownerNode:e}=t.stylesheet;e&&x(e)}),Zu.clear())})}var Io;function so(t){Io=t}function Xl(){if(!Io)throw new Error("Function called outside component initialization");return Io}function uh(t){Xl().$$.before_update.push(t)}function Pn(t){Xl().$$.on_mount.push(t)}function Pc(t){Xl().$$.after_update.push(t)}function Tn(t){Xl().$$.on_destroy.push(t)}function Cr(){let t=Xl();return(e,n,{cancelable:s=!1}={})=>{let i=t.$$.callbacks[e];if(i){let o=Sc(e,n,{cancelable:s});return i.slice().forEach(r=>{r.call(t,o)}),!o.defaultPrevented}return!0}}function io(t,e){let n=t.$$.callbacks[e.type];n&&n.slice().forEach(s=>s.call(this,e))}var Sr=[];var Nt=[],Zl=[],mh=[],J2=Promise.resolve(),dh=!1;function hh(){dh||(dh=!0,J2.then(ep))}function gh(){return hh(),J2}function _n(t){Zl.push(t)}function Vo(t){mh.push(t)}var ph=new Set,Ql=0;function ep(){if(Ql!==0)return;let t=Io;do{try{for(;Ql<Sr.length;){let e=Sr[Ql];Ql++,so(e),jP(e.$$)}}catch(e){throw Sr.length=0,Ql=0,e}for(so(null),Sr.length=0,Ql=0;Nt.length;)Nt.pop()();for(let e=0;e<Zl.length;e+=1){let n=Zl[e];ph.has(n)||(ph.add(n),n())}Zl.length=0}while(Sr.length);for(;mh.length;)mh.pop()();dh=!1,ph.clear(),so(t)}function jP(t){if(t.fragment!==null){t.update(),lt(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(_n)}}function K2(t){let e=[],n=[];Zl.forEach(s=>t.indexOf(s)===-1?e.push(s):n.push(s)),n.forEach(s=>s()),Zl=e}var Tc;function e_(){return Tc||(Tc=Promise.resolve(),Tc.then(()=>{Tc=null})),Tc}function Ec(t,e,n){t.dispatchEvent(Sc(`${e?"intro":"outro"}${n}`))}var tp=new Set,Ri;function Ee(){Ri={r:0,c:[],p:Ri}}function De(){Ri.r||lt(Ri.c),Ri=Ri.p}function P(t,e){t&&t.i&&(tp.delete(t),t.i(e))}function V(t,e,n,s){if(t&&t.o){if(tp.has(t))return;tp.add(t),Ri.c.push(()=>{tp.delete(t),s&&(n&&t.d(1),s())}),t.o(e)}else s&&s()}var t_={duration:0};function n_(t,e,n){let s={direction:"out"},i=e(t,n,s),o=!0,r,l=Ri;l.r+=1;let a;function c(){let{delay:f=0,duration:u=300,easing:p=Fr,tick:g=ue,css:v}=i||t_;v&&(r=Ac(t,1,0,u,f,p,v));let _=Hu()+f,b=_+u;_n(()=>Ec(t,!1,"start")),"inert"in t&&(a=t.inert,t.inert=!0),Yu(y=>{if(o){if(y>=b)return g(0,1),Ec(t,!1,"end"),--l.r||lt(l.c),!1;if(y>=_){let k=p((y-_)/u);g(1-k,k)}}return o})}return qi(i)?e_().then(()=>{i=i(s),c()}):c(),{end(f){f&&"inert"in t&&(t.inert=a),f&&i.tick&&i.tick(1,0),o&&(r&&Ku(t,r),o=!1)}}}function vh(t,e,n,s){let o=e(t,n,{direction:"both"}),r=s?0:1,l=null,a=null,c=null,f;function u(){c&&Ku(t,c)}function p(v,_){let b=v.b-r;return _*=Math.abs(b),{a:r,b:v.b,d:b,duration:_,start:v.start,end:v.start+_,group:v.group}}function g(v){let{delay:_=0,duration:b=300,easing:y=Fr,tick:k=ue,css:S}=o||t_,A={start:Hu()+_,b:v};v||(A.group=Ri,Ri.r+=1),"inert"in t&&(v?f!==void 0&&(t.inert=f):(f=t.inert,t.inert=!0)),l||a?a=A:(S&&(u(),c=Ac(t,r,v,b,_,y,S)),v&&k(0,1),l=p(A,b),_n(()=>Ec(t,v,"start")),Yu(F=>{if(a&&F>a.start&&(l=p(a,b),a=null,Ec(t,l.b,"start"),S&&(u(),c=Ac(t,r,l.b,l.duration,0,y,o.css))),l){if(F>=l.end)k(r=l.b,1-r),Ec(t,l.b,"end"),a||(l.b?u():--l.group.r||lt(l.group.c)),l=null;else if(F>=l.start){let M=F-l.start;r=l.a+l.d*y(M/l.duration),k(r,1-r)}}return!!(l||a)}))}return{run(v){qi(o)?e_().then(()=>{o=o({direction:v?"in":"out"}),g(v)}):g(v)},end(){u(),l=a=null}}}function me(t){return t?.length!==void 0?t:Array.from(t)}function s_(t,e){t.d(1),e.delete(t.key)}function Is(t,e){V(t,1,1,()=>{e.delete(t.key)})}function us(t,e,n,s,i,o,r,l,a,c,f,u){let p=t.length,g=o.length,v=p,_={};for(;v--;)_[t[v].key]=v;let b=[],y=new Map,k=new Map,S=[];for(v=g;v--;){let D=u(i,o,v),L=n(D),E=r.get(L);E?s&&S.push(()=>E.p(D,e)):(E=c(L,D),E.c()),y.set(L,b[v]=E),L in _&&k.set(L,Math.abs(v-_[L]))}let A=new Set,F=new Set;function M(D){P(D,1),D.m(l,f),r.set(D.key,D),f=D.first,g--}for(;p&&g;){let D=b[g-1],L=t[p-1],E=D.key,R=L.key;D===L?(f=D.first,p--,g--):y.has(R)?!r.has(E)||A.has(E)?M(D):F.has(R)?p--:k.get(E)>k.get(R)?(F.add(E),M(D)):(A.add(R),p--):(a(L,r),p--)}for(;p--;){let D=t[p];y.has(D.key)||a(D,r)}for(;g;)M(b[g-1]);return lt(S),b}function np(t,e){let n={},s={},i={$$scope:1},o=t.length;for(;o--;){let r=t[o],l=e[o];if(l){for(let a in r)a in l||(s[a]=1);for(let a in l)i[a]||(n[a]=l[a],i[a]=1);t[o]=l}else for(let a in r)i[a]=1}for(let r in s)r in n||(n[r]=void 0);return n}function sp(t){return typeof t=="object"&&t!==null?t:{}}var WP=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],GP=new Set([...WP]);function Lo(t,e,n){let s=t.$$.props[e];s!==void 0&&(t.$$.bound[s]=n,n(t.$$.ctx[s]))}function ne(t){t&&t.c()}function ee(t,e,n){let{fragment:s,after_update:i}=t.$$;s&&s.m(e,n),_n(()=>{let o=t.$$.on_mount.map(ch).filter(qi);t.$$.on_destroy?t.$$.on_destroy.push(...o):lt(o),t.$$.on_mount=[]}),i.forEach(_n)}function te(t,e){let n=t.$$;n.fragment!==null&&(K2(n.after_update),lt(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function YP(t,e){t.$$.dirty[0]===-1&&(Sr.push(t),hh(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Se(t,e,n,s,i,o,r=null,l=[-1]){let a=Io;so(t);let c=t.$$={fragment:null,ctx:[],props:o,update:ue,not_equal:i,bound:Gu(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:Gu(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};r&&r(c.root);let f=!1;if(c.ctx=n?n(t,e.props||{},(u,p,...g)=>{let v=g.length?g[0]:p;return c.ctx&&i(c.ctx[u],c.ctx[u]=v)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](v),f&&YP(t,u)),p}):[],c.update(),f=!0,lt(c.before_update),c.fragment=s?s(c.ctx):!1,e.target){if(e.hydrate){G2();let u=Q2(e.target);c.fragment&&c.fragment.l(u),u.forEach(x)}else c.fragment&&c.fragment.c();e.intro&&P(t.$$.fragment),ee(t,e.target,e.anchor),H2(),ep()}so(a)}var XP;typeof HTMLElement=="function"&&(XP=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(t,e,n){super(),this.$$ctor=t,this.$$s=e,n&&this.attachShadow({mode:"open"})}addEventListener(t,e,n){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let s=this.$$c.$on(t,e);this.$$l_u.set(e,s)}super.addEventListener(t,e,n)}removeEventListener(t,e,n){if(super.removeEventListener(t,e,n),this.$$c){let s=this.$$l_u.get(e);s&&(s(),this.$$l_u.delete(e))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(i){return()=>{let o;return{c:function(){o=h("slot"),i!=="default"&&m(o,"name",i)},m:function(a,c){w(a,o,c)},d:function(a){a&&x(o)}}}};if(await Promise.resolve(),!this.$$cn)return;let e={},n=Z2(this);for(let i of this.$$s)i in n&&(e[i]=[t(i)]);for(let i of this.attributes){let o=this.$$g_p(i.name);o in this.$$d||(this.$$d[o]=_h(o,i.value,this.$$p_d,"toProp"))}for(let i in this.$$p_d)!(i in this.$$d)&&this[i]!==void 0&&(this.$$d[i]=this[i],delete this[i]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});let s=()=>{this.$$r=!0;for(let i in this.$$p_d)if(this.$$d[i]=this.$$c.$$.ctx[this.$$c.$$.props[i]],this.$$p_d[i].reflect){let o=_h(i,this.$$d[i],this.$$p_d,"toAttribute");o==null?this.removeAttribute(this.$$p_d[i].attribute||i):this.setAttribute(this.$$p_d[i].attribute||i,o)}this.$$r=!1};this.$$c.$$.after_update.push(s),s();for(let i in this.$$l)for(let o of this.$$l[i]){let r=this.$$c.$on(i,o);this.$$l_u.set(o,r)}this.$$l={}}}attributeChangedCallback(t,e,n){this.$$r||(t=this.$$g_p(t),this.$$d[t]=_h(t,n,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{this.$$cn||(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function _h(t,e,n,s){let i=n[t]?.type;if(e=i==="Boolean"&&typeof e!="boolean"?e!=null:e,!s||!n[t])return e;if(s==="toAttribute")switch(i){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(i){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var Fe=class{$$=void 0;$$set=void 0;$destroy(){te(this,1),this.$destroy=ue}$on(e,n){if(!qi(n))return ue;let s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{let i=s.indexOf(n);i!==-1&&s.splice(i,1)}}$set(e){this.$$set&&!O2(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var i_="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(i_);var Jl=[];function K(t,e=ue){let n,s=new Set;function i(l){if(Oe(t,l)&&(t=l,n)){let a=!Jl.length;for(let c of s)c[1](),Jl.push(c,t);if(a){for(let c=0;c<Jl.length;c+=2)Jl[c][0](Jl[c+1]);Jl.length=0}}}function o(l){i(l(t))}function r(l,a=ue){let c=[l,a];return s.add(c),s.size===1&&(n=e(i,o)||ue),l(t),()=>{s.delete(c),s.size===0&&n&&(n(),n=null)}}return{set:i,update:o,subscribe:r}}var Dc=K([]),Qn=K({role:0,nearby:0,exprate:1,itemfind:1,queues:[],membercount:0}),ip=K({parties:[],filterActivity:-1}),Gs=K({flashing:!1,message:"",activity:0,listed:!1,applications:[]}),Kl=K([]),bn=K(),oo=K([]),Ar=K({}),zi=K(),op=K(!1),o_=K(),r_=K(!1),xs=K("Loading World"),Ic=K([]),Bi=K({}),Ui=K({}),Vc=K([]),ea=K([]),En=K(),rp=K("auto"),Hs=K(0),ta=K(0),qo=K(0),na=K([]),sa=K({}),Ro=K({}),lp=K({current:0,max:1}),ap=K(),cp=K(),Lc=K(!1),fp=K(0),up=K([0,0]),ro=K(),Oi=K(),$i=K(!1),qc=K(new Map),zo=K(new Map),Rc=K(),Bo=K(),ai=K(),ia=K([]),ci=K(),pp=K(0),Pr=K(!1),Tr=K(!1),Vs=K(),mp=K({self:[],other:[],nonOrAcc:[],all:[]}),Ys=K(),Ni=K(),Uo=K(),oa=K(),Oo=K({}),zc=K({}),dp=K({}),hp=K({}),gp=K(),ra=K(),ws=[];function QP(t){let e;return{c(){e=h("div"),e.innerHTML='<div class="bounce1 svelte-twvoek"></div><div class="bounce2 svelte-twvoek"></div><div class="bounce3 svelte-twvoek"></div>',m(e,"class","spinner svelte-twvoek")},m(n,s){w(n,e,s)},p:ue,i:ue,o:ue,d(n){n&&x(e)}}}var bh=class extends Fe{constructor(e){super(),Se(this,e,null,QP,Fn,{})}},l_=bh;function vp(t,{delay:e=0,duration:n=400,easing:s=Fr}={}){let i=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:s,css:o=>`opacity: ${o*i}`}}function a_(t){let e,n,s,i,o,r;return n=new l_({}),{c(){e=h("div"),ne(n.$$.fragment),s=h("h2"),i=T(t[0]),o=h("small"),o.innerHTML='<img alt="Hordes.io" class="svgicon" src="/data/ui/icon.svg?v=8593107"/> 0.50.8593 Live',qe(s,"margin-top","100px"),m(o,"class","version textgrey textcenter svelte-aoht7k"),m(e,"class","l-ui container svelte-aoht7k")},m(l,a){w(l,e,a),ee(n,e,null),d(e,s),d(s,i),d(e,o),r=!0},p(l,a){(!r||a&1)&&G(i,l[0])},i(l){r||(P(n.$$.fragment,l),r=!0)},o(l){V(n.$$.fragment,l),r=!1},d(l){l&&x(e),te(n)}}}function ZP(t){let e,n,s=t[0]&&a_(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[0]?s?(s.p(i,o),o&1&&P(s,1)):(s=a_(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function JP(t,e,n){let{active:s}=e;return t.$$set=i=>{"active"in i&&n(0,s=i.active)},[s]}var yh=class extends Fe{constructor(e){super(),Se(this,e,JP,ZP,Oe,{active:0})}},c_=yh;function fi(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function f_(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function kh(t,e){let n=e[0],s=e[1],i=e[2],o=e[3],r=e[4],l=e[5],a=e[6],c=e[7],f=e[8],u=e[9],p=e[10],g=e[11],v=e[12],_=e[13],b=e[14],y=e[15],k=n*l-s*r,S=n*a-i*r,A=n*c-o*r,F=s*a-i*l,M=s*c-o*l,D=i*c-o*a,L=f*_-u*v,E=f*b-p*v,R=f*y-g*v,z=u*b-p*_,q=u*y-g*_,j=p*y-g*b,W=k*j-S*q+A*z+F*R-M*E+D*L;return W?(W=1/W,t[0]=(l*j-a*q+c*z)*W,t[1]=(i*q-s*j-o*z)*W,t[2]=(_*D-b*M+y*F)*W,t[3]=(p*M-u*D-g*F)*W,t[4]=(a*R-r*j-c*E)*W,t[5]=(n*j-i*R+o*E)*W,t[6]=(b*A-v*D-y*S)*W,t[7]=(f*D-p*A+g*S)*W,t[8]=(r*q-l*R+c*L)*W,t[9]=(s*R-n*q-o*L)*W,t[10]=(v*M-_*A+y*k)*W,t[11]=(u*A-f*M-g*k)*W,t[12]=(l*E-r*z-a*L)*W,t[13]=(n*z-s*E+i*L)*W,t[14]=(_*S-v*F-b*k)*W,t[15]=(f*F-u*S+p*k)*W,t):null}function _p(t,e,n){let s=e[0],i=e[1],o=e[2],r=e[3],l=e[4],a=e[5],c=e[6],f=e[7],u=e[8],p=e[9],g=e[10],v=e[11],_=e[12],b=e[13],y=e[14],k=e[15],S=n[0],A=n[1],F=n[2],M=n[3];return t[0]=S*s+A*l+F*u+M*_,t[1]=S*i+A*a+F*p+M*b,t[2]=S*o+A*c+F*g+M*y,t[3]=S*r+A*f+F*v+M*k,S=n[4],A=n[5],F=n[6],M=n[7],t[4]=S*s+A*l+F*u+M*_,t[5]=S*i+A*a+F*p+M*b,t[6]=S*o+A*c+F*g+M*y,t[7]=S*r+A*f+F*v+M*k,S=n[8],A=n[9],F=n[10],M=n[11],t[8]=S*s+A*l+F*u+M*_,t[9]=S*i+A*a+F*p+M*b,t[10]=S*o+A*c+F*g+M*y,t[11]=S*r+A*f+F*v+M*k,S=n[12],A=n[13],F=n[14],M=n[15],t[12]=S*s+A*l+F*u+M*_,t[13]=S*i+A*a+F*p+M*b,t[14]=S*o+A*c+F*g+M*y,t[15]=S*r+A*f+F*v+M*k,t}function aa(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function u_(t,e){let n=e[0],s=e[1],i=e[2],o=e[4],r=e[5],l=e[6],a=e[8],c=e[9],f=e[10];return t[0]=Math.sqrt(n*n+s*s+i*i),t[1]=Math.sqrt(o*o+r*r+l*l),t[2]=Math.sqrt(a*a+c*c+f*f),t}function p_(t){let e=t[0],n=t[1],s=t[2],i=t[4],o=t[5],r=t[6],l=t[8],a=t[9],c=t[10],f=e*e+n*n+s*s,u=i*i+o*o+r*r,p=l*l+a*a+c*c;return Math.sqrt(Math.max(f,u,p))}function bp(t,e){let n=e[0]+e[5]+e[10],s=0;return n>0?(s=Math.sqrt(n+1)*2,t[3]=.25*s,t[0]=(e[6]-e[9])/s,t[1]=(e[8]-e[2])/s,t[2]=(e[1]-e[4])/s):e[0]>e[5]&&e[0]>e[10]?(s=Math.sqrt(1+e[0]-e[5]-e[10])*2,t[3]=(e[6]-e[9])/s,t[0]=.25*s,t[1]=(e[1]+e[4])/s,t[2]=(e[8]+e[2])/s):e[5]>e[10]?(s=Math.sqrt(1+e[5]-e[0]-e[10])*2,t[3]=(e[8]-e[2])/s,t[0]=(e[1]+e[4])/s,t[1]=.25*s,t[2]=(e[6]+e[9])/s):(s=Math.sqrt(1+e[10]-e[0]-e[5])*2,t[3]=(e[1]-e[4])/s,t[0]=(e[8]+e[2])/s,t[1]=(e[6]+e[9])/s,t[2]=.25*s),t}function yp(t,e,n,s){let i=e[0],o=e[1],r=e[2],l=e[3],a=i+i,c=o+o,f=r+r,u=i*a,p=i*c,g=i*f,v=o*c,_=o*f,b=r*f,y=l*a,k=l*c,S=l*f,A=s[0],F=s[1],M=s[2];return t[0]=(1-(v+b))*A,t[1]=(p+S)*A,t[2]=(g-k)*A,t[3]=0,t[4]=(p-S)*F,t[5]=(1-(u+b))*F,t[6]=(_+y)*F,t[7]=0,t[8]=(g+k)*M,t[9]=(_-y)*M,t[10]=(1-(u+v))*M,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function m_(t,e,n,s,i){let o=1/Math.tan(e/2),r=1/(s-i);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+s)*r,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*s*r,t[15]=0,t}function d_(t,e,n,s,i,o,r){let l=1/(e-n),a=1/(s-i),c=1/(o-r);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*l,t[13]=(i+s)*a,t[14]=(r+o)*c,t[15]=1,t}function xh(t,e,n,s){let i=e[0],o=e[1],r=e[2],l=s[0],a=s[1],c=s[2],f=i-n[0],u=o-n[1],p=r-n[2],g=f*f+u*u+p*p;g>0&&(g=1/Math.sqrt(g),f*=g,u*=g,p*=g);let v=a*p-c*u,_=c*f-l*p,b=l*u-a*f;return g=v*v+_*_+b*b,g>0&&(g=1/Math.sqrt(g),v*=g,_*=g,b*=g),t[0]=v,t[1]=_,t[2]=b,t[3]=0,t[4]=u*b-p*_,t[5]=p*v-f*b,t[6]=f*_-u*v,t[7]=0,t[8]=f,t[9]=u,t[10]=p,t[11]=0,t[12]=i,t[13]=o,t[14]=r,t[15]=1,t}function h_(t,e){return t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0),t}function ps(t){let e=t[0],n=t[1],s=t[2];return Math.sqrt(e*e+n*n+s*s)}function it(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Y(t,e,n,s){return t[0]=e,t[1]=n,t[2]=s,t}function ms(t,e){return t[0]=e,t[1]=e,t[2]=e,t}function Rn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Jn(t,e,n,s){return t[0]+=e,t[1]+=n,t[2]+=s,t}function Xt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function dn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function sn(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t}function Dr(t,e){let n=e[0]-t[0],s=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+s*s+i*i)}function Kn(t,e){let n=e[0]-t[0],s=e[1]-t[1],i=e[2]-t[2];return n*n+s*s+i*i}function Bc(t){let e=t[0],n=t[1],s=t[2];return e*e+n*n+s*s}function kp(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Zn(t,e){let n=e[0],s=e[1],i=e[2],o=n*n+s*s+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function mn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Xs(t,e,n){let s=e[0],i=e[1],o=e[2],r=n[0],l=n[1],a=n[2];return t[0]=i*a-o*l,t[1]=o*r-s*a,t[2]=s*l-i*r,t}function ca(t,e,n,s){let i=e[0],o=e[1],r=e[2];return t[0]=i+s*(n[0]-i),t[1]=o+s*(n[1]-o),t[2]=r+s*(n[2]-r),t}function Ms(t,e,n){let s=e[0],i=e[1],o=e[2],r=n[3]*s+n[7]*i+n[11]*o+n[15];return r=r||1,t[0]=(n[0]*s+n[4]*i+n[8]*o+n[12])/r,t[1]=(n[1]*s+n[5]*i+n[9]*o+n[13])/r,t[2]=(n[2]*s+n[6]*i+n[10]*o+n[14])/r,t}function Ir(t,e,n,s,i){return t[0]=i[0]*e+i[4]*n+i[8]*s+i[12],t[1]=i[1]*e+i[5]*n+i[9]*s+i[13],t[2]=i[2]*e+i[6]*n+i[10]*s+i[14],t}function xp(t,e,n,s,i){return t[0]=i[0]*e+i[4]*n+i[8]*s,t[1]=i[1]*e+i[5]*n+i[9]*s,t[2]=i[2]*e+i[6]*n+i[10]*s,t}function wh(t,e,n){let s=e[0],i=e[1],o=e[2],r=n[0],l=n[1],a=n[2],c=n[3],f=l*o-a*i,u=a*s-r*o,p=r*i-l*s,g=l*p-a*u,v=a*f-r*p,_=r*u-l*f,b=c*2;return f*=b,u*=b,p*=b,g*=2,v*=2,_*=2,t[0]=s+f+g,t[1]=i+u+v,t[2]=o+p+_,t}var NU=function(){let t=[0,0,0],e=[0,0,0];return function(n,s){it(t,n),it(e,s),Zn(t,t),Zn(e,e);let i=mn(t,e);return i>1?0:i<-1?Math.PI:Math.acos(i)}}();function g_(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Vr(t,e,n){let s=Math.sin(n),i=Math.cos(n);return t[0]=e[2]*s+e[0]*i,t[1]=e[1],t[2]=e[2]*i-e[0]*s,t}function v_(t,e,n){let s=Math.sin(n),i=Math.cos(n);return t[0]=e[1]*s+e[0]*i,t[2]=e[1]*i-e[0]*s,t}function Lr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function es(t,e,n,s,i){return t[0]=e,t[1]=n,t[2]=s,t[3]=i,t}function __(t,e){let n=e[0],s=e[1],i=e[2],o=e[3],r=n*n+s*s+i*i+o*o;return r>0&&(r=1/Math.sqrt(r)),t[0]=n*r,t[1]=s*r,t[2]=i*r,t[3]=o*r,t}function e7(t,e,n){n=n*.5;let s=Math.sin(n);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(n),t}function Mh(t,e,n,s){let i=e[0],o=e[1],r=e[2],l=e[3],a=n[0],c=n[1],f=n[2],u=n[3],p,g,v,_,b;return g=i*a+o*c+r*f+l*u,g<0&&(g=-g,a=-a,c=-c,f=-f,u=-u),1-g>1e-6?(p=Math.acos(g),v=Math.sin(p),_=Math.sin((1-s)*p)/v,b=Math.sin(s*p)/v):(_=1-s,b=s),t[0]=_*i+b*a,t[1]=_*o+b*c,t[2]=_*r+b*f,t[3]=_*l+b*u,t}function t7(t,e){let n=e[0]+e[4]+e[8],s;if(n>0)s=Math.sqrt(n+1),t[3]=.5*s,s=.5/s,t[0]=(e[5]-e[7])*s,t[1]=(e[6]-e[2])*s,t[2]=(e[1]-e[3])*s;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);let o=(i+1)%3,r=(i+2)%3;s=Math.sqrt(e[i*3+i]-e[o*3+o]-e[r*3+r]+1),t[i]=.5*s,s=.5/s,t[3]=(e[o*3+r]-e[r*3+o])*s,t[o]=(e[o*3+i]+e[i*3+o])*s,t[r]=(e[r*3+i]+e[i*3+r])*s}return t}function wp(t,e){let n=Math.sin(e[0]*.5),s=Math.cos(e[0]*.5),i=Math.sin(e[1]*.5),o=Math.cos(e[1]*.5),r=Math.sin(e[2]*.5),l=Math.cos(e[2]*.5);return t[0]=n*o*l+s*i*r,t[1]=s*i*l-n*o*r,t[2]=s*o*r-n*i*l,t[3]=s*o*l+n*i*r,t}var b_=__;var JU=function(){let t=[0,0,0],e=[1,0,0],n=[0,1,0];return function(s,i,o){let r=mn(i,o);return r<-.999999?(Xs(t,e,i),ps(t)<1e-6&&Xs(t,n,i),Zn(t,t),e7(s,t,Math.PI),s):r>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(Xs(t,i,o),s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=1+r,b_(s,s))}}(),KU=function(){let t=[0,0,0,1],e=[0,0,0,1];return function(n,s,i,o,r,l){return Mh(t,s,r,l),Mh(e,i,o,l),Mh(n,t,e,2*l*(1-l)),n}}(),eO=function(){let t=[1,0,0,0,1,0,0,0,1];return function(e,n,s,i){return t[0]=s[0],t[3]=s[1],t[6]=s[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],b_(e,t7(e,t))}}();var Fh=fi(),n7=()=>({parent:null,children:[],visible:!0,geometry:void 0,matrix:fi(),worldMatrix:fi(),position:[0,0,0],scale:[1,1,1],quaternion:[-0,-0,-0,1],rotation:[-0,-0,-0],matrixAutoUpdate:!1,matrixNeedsUpdate:!0,data:{}}),Mn=(t,e,n=!0)=>{n&&t.parent!==null&&e!==t.parent&&i7(t.parent,t,!1),t.parent=e,t.matrixNeedsUpdate=!0,n&&e&&s7(e,t,!1)},s7=(t,e,n=!0)=>{~t.children.indexOf(e)||t.children.push(e),n&&Mn(e,t,!1)},i7=(t,e,n=!0)=>{~t.children.indexOf(e)&&t.children.splice(t.children.indexOf(e),1),n&&Mn(e,null,!1)},qt=(t,e)=>{if(!t.visible)return;let n=lo(t),s=o7(t,e,n);t.children.forEach(i=>{i.visible&&qt(i,s)})},lo=t=>!t.matrixAutoUpdate&&!t.matrixNeedsUpdate?!1:(t.matrixNeedsUpdate=!1,wp(t.quaternion,t.rotation),yp(t.matrix,t.quaternion,t.position,t.scale),!0),o7=(t,e,n)=>t.parent!==null?e||n?(_p(t.worldMatrix,t.parent.worldMatrix,t.matrix),!0):!1:n?(f_(t.worldMatrix,t.matrix),!0):!1,Fp=(t,e,n,s)=>{let i=Xt([0,0,0],n.position,e.position);Zn(i,i),sn(t.position,e.position,i,s),t.rotation[0]=0,t.rotation[1]=Math.atan2(i[0],i[2])+1.5,t.rotation[2]=Math.sin(-i[1])+1.5,qt(t,!1)},qr=(t,e,n=!1,s)=>{n?xh(Fh,t.position,e,s):xh(Fh,e,t.position,s),h_(t.rotation,Fh)},Mp=[],on=()=>Mp.length>0?Mp.pop():n7(),ui=t=>{r7(t),Mp.indexOf(t)<0?Mp.push(t):console.log("tried returning transform that is already known")},r7=t=>{t.data={},t.geometry=void 0,t.visible=!0,t.matrixAutoUpdate=!1,Y(t.position,0,0,0),Y(t.scale,1,1,1),Y(t.rotation,0,0,0),Mn(t,null,!0);for(let e=0;e<t.children.length;++e)Mn(t.children[e],null);t.children.length=0};var Cp=[0,0,0],Uc=(t=.1,e=100,n=45,s=1)=>{let i={near:t,far:e,fov:n,aspect:s,transform:on(),projectionMatrix:fi(),viewMatrix:fi(),unprojectionViewMatrix:fi(),projectionViewMatrix:fi(),worldPosition:[0,0,0],frustum:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],frustumConstants:[0,0,0,0,0,0]};return i.transform.matrixAutoUpdate=!0,i},Oc=t=>{m_(t.projectionMatrix,t.fov*(Math.PI/180),t.aspect,t.near,t.far)},k_=(t,e,n,s,i)=>{d_(t.projectionMatrix,e,n,s,i,t.near,t.far)},Ch=t=>{aa(t.worldPosition,t.transform.worldMatrix)},fa=(t,e)=>{qt(t.transform,e),kh(t.viewMatrix,t.transform.worldMatrix),_p(t.projectionViewMatrix,t.projectionMatrix,t.viewMatrix),kh(t.unprojectionViewMatrix,t.projectionViewMatrix),Ch(t)};var ao=(t,e,n)=>{let s=t.unprojectionViewMatrix,i=n[0],o=n[1],r=s[3]*i+s[7]*o+s[11]*-1+s[15];return e[0]=(s[0]*i+s[4]*o+s[8]*-1+s[12])/r,e[1]=(s[1]*i+s[5]*o+s[9]*-1+s[13])/r,e[2]=(s[2]*i+s[6]*o+s[10]*-1+s[14])/r,e},Sp=t=>{let e=t.projectionViewMatrix;Y(t.frustum[0],e[3]-e[0],e[7]-e[4],e[11]-e[8]),Y(t.frustum[1],e[3]+e[0],e[7]+e[4],e[11]+e[8]),Y(t.frustum[2],e[3]+e[1],e[7]+e[5],e[11]+e[9]),Y(t.frustum[3],e[3]-e[1],e[7]-e[5],e[11]-e[9]),Y(t.frustum[4],e[3]-e[2],e[7]-e[6],e[11]-e[10]),Y(t.frustum[5],e[3]+e[2],e[7]+e[6],e[11]+e[10]),t.frustumConstants[0]=e[15]-e[12],t.frustumConstants[1]=e[15]+e[12],t.frustumConstants[2]=e[15]+e[13],t.frustumConstants[3]=e[15]-e[13],t.frustumConstants[4]=e[15]-e[14],t.frustumConstants[5]=e[15]+e[14];for(let n=0;n<6;n++){let s=t.frustum[n],i=1/ps(s);dn(s,s,i),t.frustumConstants[n]*=i}},x_=(t,e,n)=>{it(Cp,e.bounds.center),Ms(Cp,Cp,n.worldMatrix);let s=e.bounds.radius*p_(n.worldMatrix);return Sh(t,Cp,s)},Sh=(t,e,n)=>{for(let s=0;s<6;s++)if(mn(t.frustum[s],e)+t.frustumConstants[s]<-n)return!1;return!0};var Fs=document.createElement("canvas"),$=Fs.getContext("webgl2",{depth:!0,stencil:!1,premultipliedAlpha:!1,alpha:!1,antialias:!1,powerPreference:"high-performance",preserveDrawingBuffer:!0}),In=document.createElement("canvas"),Cs=In.getContext("2d",{alpha:!0}),ua=$.vertexAttribDivisor.bind($),M_=$.drawArraysInstanced.bind($),F_=$.drawElementsInstanced.bind($),C_=$.createVertexArray.bind($),Ap=$.bindVertexArray.bind($),l7=$.deleteVertexArray.bind($),Ah=$.getExtension("EXT_texture_filter_anisotropic"),S_=$.getExtension("WEBGL_compressed_texture_s3tc"),et={maxTextureUnits:$.getParameter($.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxAnisotropy:$.getParameter(Ah.MAX_TEXTURE_MAX_ANISOTROPY_EXT),blendFunc:{src:$.ONE,dst:$.ZERO,srcAlpha:0,dstAlpha:0},blendEquation:{modeRGB:$.FUNC_ADD,modeAlpha:0},frontFace:$.CCW,depthFunc:$.LESS,cullFace:null,depthMask:!0,flipY:!1,framebuffer:null,viewport:{width:-1,height:-1},textureUnits:[],activeTextureUnit:0,width:0,height:0,currentGeometry:-1,currentProgram:-1},A_=(t,e)=>{et.width=t,et.height=e,Fs.width=t,Fs.height=e,In.width=t,In.height=e},$c=(t,e)=>{et.viewport.width===t&&et.viewport.height===e||(et.viewport.width=t,et.viewport.height=e,$.viewport(0,0,t,e))},Nc=t=>{et[t]!==!0&&($.enable(t),et[t]=!0)},Pp=t=>{et[t]!==!1&&($.disable(t),et[t]=!1)},P_=(t,e,n,s)=>{et.blendFunc.src===t&&et.blendFunc.dst===e&&et.blendFunc.srcAlpha===n&&et.blendFunc.dstAlpha===s||(et.blendFunc.src=t,et.blendFunc.dst=e,et.blendFunc.srcAlpha=n,et.blendFunc.dstAlpha=s,n!==void 0?$.blendFuncSeparate(t,e,n,s):$.blendFunc(t,e))},T_=(t,e)=>{et.blendEquation.modeRGB===t&&et.blendEquation.modeAlpha===e||(et.blendEquation.modeRGB=t,et.blendEquation.modeAlpha=e,e!==void 0?$.blendEquationSeparate(t,e):$.blendEquation(t))},E_=t=>{et.cullFace!==t&&(et.cullFace=t,$.cullFace(t))},D_=t=>{et.frontFace!==t&&(et.frontFace=t,$.frontFace(t))},Ph=t=>{et.depthMask!==t&&(et.depthMask=t,$.depthMask(t))},I_=t=>{et.depthFunc!==t&&(et.depthFunc=t,$.depthFunc(t))},jc=t=>{et.activeTextureUnit!==t&&(et.activeTextureUnit=t,$.activeTexture($.TEXTURE0+t))},w_=({target:t=$.FRAMEBUFFER,buffer:e=null}={})=>{et.framebuffer!==e&&(et.framebuffer=e,$.bindFramebuffer(t,e))},V_=t=>{t?(w_(t),$c(t.width,t.height)):(w_(),$c(et.width,et.height))},Th=t=>{(!t||!t.depth)&&(Nc($.DEPTH_TEST),Ph(!0)),$.clear($.COLOR_BUFFER_BIT|$.DEPTH_BUFFER_BIT)};var pa=`#version 300 es
in vec2 uv;
in vec2 position;
out vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = vec4(position, 0.0, 1.0);
}`;var L_=[0,1,0],q_=[0,0,0],gt=Uc(.3,500,70),Gt=on();Mn(gt.transform,Gt);Y(gt.transform.position,0,0,-1);gt.transform.rotation[1]=Math.PI;Gt.matrixAutoUpdate=!0;function a7(t){let e;return{c(){e=h("div"),qe(e,"cursor",t[1])},m(n,s){w(n,e,s),t[2](e)},p(n,[s]){s&2&&qe(e,"cursor",n[1])},i:ue,o:ue,d(n){n&&x(e),t[2](null)}}}function c7(t,e,n){let s;oe(t,rp,r=>n(1,s=r));let i;Pn(()=>{i.appendChild(Fs),i.appendChild(In)});function o(r){Nt[r?"unshift":"push"](()=>{i=r,n(0,i)})}return[i,s,o]}var Eh=class extends Fe{constructor(e){super(),Se(this,e,c7,a7,Oe,{})}},R_=Eh;function z_(t){let e,n,s,i,o;return{c(){e=h("div"),n=h("img"),m(n,"class",s=Eo(t[2].css)+" svelte-fc7xg3"),at(n.src,i=t[2].img)||m(n,"src",i),m(e,"class",o="container border "+t[2].border+" svelte-fc7xg3"),qe(e,"top",t[1]+"px"),qe(e,"left",t[0]+"px")},m(r,l){w(r,e,l),d(e,n)},p(r,l){l&4&&s!==(s=Eo(r[2].css)+" svelte-fc7xg3")&&m(n,"class",s),l&4&&!at(n.src,i=r[2].img)&&m(n,"src",i),l&4&&o!==(o="container border "+r[2].border+" svelte-fc7xg3")&&m(e,"class",o),l&2&&qe(e,"top",r[1]+"px"),l&1&&qe(e,"left",r[0]+"px")},d(r){r&&x(e)}}}function f7(t){let e,n=t[2]&&t[0]&&t[1]&&z_(t);return{c(){n&&n.c(),e=be()},m(s,i){n&&n.m(s,i),w(s,e,i)},p(s,[i]){s[2]&&s[0]&&s[1]?n?n.p(s,i):(n=z_(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ue,o:ue,d(s){s&&x(e),n&&n.d(s)}}}function u7(t,e,n){let s;oe(t,En,l=>n(2,s=l));let i,o,r=l=>{(s||i||o)&&(s?(n(0,i=l.clientX-10),n(1,o=l.clientY-10)):(n(0,i=0),n(1,o=0)))};return Pn(()=>{document.addEventListener("mousemove",r,!1)}),Tn(()=>{document.removeEventListener("mousemove",r)}),[i,o,s]}var Dh=class extends Fe{constructor(e){super(),Se(this,e,u7,f7,Oe,{})}},B_=Dh;var U_=(t,e,n)=>n.items[t][t=="book"?Math.floor(e/5):e],O_=(t,e,n)=>U_(t,e,n).name+(t=="book"?" Lv. "+(e%5+1):""),$_=(t,e,n)=>U_(t,e,n).description;var Wi={};Xn(Wi,{activeWorld:()=>Rr,alwaysShowLevel:()=>jp,ambienceVolume:()=>Xc,anisotropy:()=>Yc,audioVolume:()=>Or,audioVolumeLowered:()=>$r,bloom:()=>Ip,buffCdFlashingDuration:()=>uf,buffCdFlashingInterval:()=>ff,buffcountParty:()=>mf,buffcountUnitframes:()=>pf,buffsHideIrrelevant:()=>im,cameraZoom:()=>qp,cdTextBuffs:()=>tm,cdTextSkills:()=>em,charpanelOpen:()=>mo,chat:()=>nf,chatbubbles:()=>Xp,clanOpen:()=>uo,classColorBars:()=>Gp,combatTextPush:()=>Wp,command:()=>Qs,current:()=>le,disableoffscreen:()=>Ep,dpsmeterMode:()=>tf,dpsmeterOpen:()=>Gr,dpsmeterParty:()=>ef,dpsmeterTarget:()=>Hr,expmeterOpen:()=>Kc,filteredChannels:()=>of,fogpattern:()=>Lp,foliage:()=>Gc,fov:()=>Br,fxaa:()=>Tp,inventoryCols:()=>jr,inventoryOpen:()=>co,invertMouseX:()=>om,invertMouseY:()=>rm,itemProtectQuality:()=>af,itemQualityFilter:()=>lf,itemQualityPercent:()=>Kp,itemTypeFilter:()=>rf,itemmeterOpen:()=>Jc,kbAltBack:()=>H_,kbAltForward:()=>G_,kbBack:()=>X_,kbCharacter:()=>nb,kbClan:()=>ib,kbForward:()=>N_,kbInventory:()=>sb,kbLeft:()=>Y_,kbMap:()=>eb,kbNextParty:()=>J_,kbNextTarget:()=>Z_,kbParty:()=>rb,kbPvp:()=>ob,kbRight:()=>Q_,kbSkillbar1:()=>lb,kbSkillbar10:()=>gb,kbSkillbar11:()=>vb,kbSkillbar12:()=>_b,kbSkillbar13:()=>bb,kbSkillbar14:()=>yb,kbSkillbar15:()=>kb,kbSkillbar16:()=>xb,kbSkillbar17:()=>wb,kbSkillbar18:()=>Mb,kbSkillbar19:()=>Fb,kbSkillbar2:()=>ab,kbSkillbar20:()=>Cb,kbSkillbar21:()=>Sb,kbSkillbar22:()=>Ab,kbSkillbar23:()=>Pb,kbSkillbar24:()=>Tb,kbSkillbar3:()=>cb,kbSkillbar4:()=>fb,kbSkillbar5:()=>ub,kbSkillbar6:()=>pb,kbSkillbar7:()=>mb,kbSkillbar8:()=>db,kbSkillbar9:()=>hb,kbSkills:()=>tb,kbTurnLeft:()=>j_,kbTurnRight:()=>W_,kbUntarget:()=>K_,lang:()=>Nr,lastConnectedChar:()=>Wc,lockedcamera:()=>lm,mapLowQuality:()=>Yp,mapShowMonsters:()=>Hp,mouseSensitivity:()=>hf,musicVolume:()=>Qc,nameShowEnemyPlayers:()=>$p,nameShowFriendlyPlayers:()=>Op,nameShowMonsters:()=>Up,nameplateShowEnemyPlayers:()=>Bp,nameplateShowFriendlyPlayers:()=>zp,nameplateShowMonsters:()=>Rp,nameplateShowTransparency:()=>Np,nameplateViewRange:()=>sf,nextFriendlyTargetAllowNonParty:()=>cm,nextFriendlyTargetCycle:()=>gf,particles:()=>Vp,partyBuffLimitUpdateRate:()=>nm,partyOpen:()=>Zs,partyWidth:()=>Yr,pointerlock:()=>am,pvpOpen:()=>po,registerSetting:()=>Eb,resolution:()=>Ur,settingsOpen:()=>Wr,shadowmapResolution:()=>Hc,shadows:()=>Dp,showFpsPing:()=>ha,showIncomingDamage:()=>Zp,showIncomingHeal:()=>Qp,showIncomingMana:()=>Jp,showPartyMana:()=>ga,showSelfInParty:()=>sm,skillConfigs:()=>va,skillPresetVisible:()=>df,skillbarAmount:()=>Xr,skillbarsettings:()=>ho,skillmenuOpen:()=>fo,stashCols:()=>jo,stashHeight:()=>Wo,stashShowGroups:()=>ma,stashShowSettings:()=>Zc,subscriptionOpen:()=>Ls,tutprogress:()=>ji,twitchOpen:()=>da,viewRange:()=>zr,windowSettings:()=>cf});var Ih={};Xn(Ih,{activeWorld:()=>Rr,alwaysShowLevel:()=>jp,ambienceVolume:()=>Xc,anisotropy:()=>Yc,audioVolume:()=>Or,audioVolumeLowered:()=>$r,bloom:()=>Ip,buffCdFlashingDuration:()=>uf,buffCdFlashingInterval:()=>ff,buffcountParty:()=>mf,buffcountUnitframes:()=>pf,buffsHideIrrelevant:()=>im,cameraZoom:()=>qp,cdTextBuffs:()=>tm,cdTextSkills:()=>em,charpanelOpen:()=>mo,chat:()=>nf,chatbubbles:()=>Xp,clanOpen:()=>uo,classColorBars:()=>Gp,combatTextPush:()=>Wp,command:()=>Qs,disableoffscreen:()=>Ep,dpsmeterMode:()=>tf,dpsmeterOpen:()=>Gr,dpsmeterParty:()=>ef,dpsmeterTarget:()=>Hr,expmeterOpen:()=>Kc,filteredChannels:()=>of,fogpattern:()=>Lp,foliage:()=>Gc,fov:()=>Br,fxaa:()=>Tp,inventoryCols:()=>jr,inventoryOpen:()=>co,invertMouseX:()=>om,invertMouseY:()=>rm,itemProtectQuality:()=>af,itemQualityFilter:()=>lf,itemQualityPercent:()=>Kp,itemTypeFilter:()=>rf,itemmeterOpen:()=>Jc,kbAltBack:()=>H_,kbAltForward:()=>G_,kbBack:()=>X_,kbCharacter:()=>nb,kbClan:()=>ib,kbForward:()=>N_,kbInventory:()=>sb,kbLeft:()=>Y_,kbMap:()=>eb,kbNextParty:()=>J_,kbNextTarget:()=>Z_,kbParty:()=>rb,kbPvp:()=>ob,kbRight:()=>Q_,kbSkillbar1:()=>lb,kbSkillbar10:()=>gb,kbSkillbar11:()=>vb,kbSkillbar12:()=>_b,kbSkillbar13:()=>bb,kbSkillbar14:()=>yb,kbSkillbar15:()=>kb,kbSkillbar16:()=>xb,kbSkillbar17:()=>wb,kbSkillbar18:()=>Mb,kbSkillbar19:()=>Fb,kbSkillbar2:()=>ab,kbSkillbar20:()=>Cb,kbSkillbar21:()=>Sb,kbSkillbar22:()=>Ab,kbSkillbar23:()=>Pb,kbSkillbar24:()=>Tb,kbSkillbar3:()=>cb,kbSkillbar4:()=>fb,kbSkillbar5:()=>ub,kbSkillbar6:()=>pb,kbSkillbar7:()=>mb,kbSkillbar8:()=>db,kbSkillbar9:()=>hb,kbSkills:()=>tb,kbTurnLeft:()=>j_,kbTurnRight:()=>W_,kbUntarget:()=>K_,lang:()=>Nr,lastConnectedChar:()=>Wc,lockedcamera:()=>lm,mapLowQuality:()=>Yp,mapShowMonsters:()=>Hp,mouseSensitivity:()=>hf,musicVolume:()=>Qc,nameShowEnemyPlayers:()=>$p,nameShowFriendlyPlayers:()=>Op,nameShowMonsters:()=>Up,nameplateShowEnemyPlayers:()=>Bp,nameplateShowFriendlyPlayers:()=>zp,nameplateShowMonsters:()=>Rp,nameplateShowTransparency:()=>Np,nameplateViewRange:()=>sf,nextFriendlyTargetAllowNonParty:()=>cm,nextFriendlyTargetCycle:()=>gf,particles:()=>Vp,partyBuffLimitUpdateRate:()=>nm,partyOpen:()=>Zs,partyWidth:()=>Yr,pointerlock:()=>am,pvpOpen:()=>po,resolution:()=>Ur,settingsOpen:()=>Wr,shadowmapResolution:()=>Hc,shadows:()=>Dp,showFpsPing:()=>ha,showIncomingDamage:()=>Zp,showIncomingHeal:()=>Qp,showIncomingMana:()=>Jp,showPartyMana:()=>ga,showSelfInParty:()=>sm,skillConfigs:()=>va,skillPresetVisible:()=>df,skillbarAmount:()=>Xr,skillbarsettings:()=>ho,skillmenuOpen:()=>fo,stashCols:()=>jo,stashHeight:()=>Wo,stashShowGroups:()=>ma,stashShowSettings:()=>Zc,subscriptionOpen:()=>Ls,tutprogress:()=>ji,twitchOpen:()=>da,viewRange:()=>zr,windowSettings:()=>cf});var Rr=K(""),Wc=K(0),zr=K(60),Br=K(70),Ur=K(100),Gc=K(100),Hc=K(2),Tp=K(!0),Ep=K(!0),Dp=K(!0),Ip=K(!0),Vp=K(!0),Yc=K(4),Lp=K(!0),Xc=K(40),Or=K(70),$r=K(80),Qc=K(30),Nr=K("en"),Qs=K("faction"),jo=K(8),Wo=K(300),ma=K(2),Zc=K(!1),jr=K(5),co=K(!1),Wr=K(!1),fo=K(!1),Gr=K(!1),Jc=K(!0),Kc=K(!0),da=K(!0),Ls=K(!1),Zs=K(!1),uo=K(!1),po=K(!1),ef=K(!0),tf=K(0),Hr=K(0),mo=K(!1),ho=K({}),nf=K([0,0,0,0,0,0,1,1,1,1,1,1]),qp=K(7),sf=K(100),Rp=K(!0),zp=K(!0),Bp=K(!0),Up=K(!0),Op=K(!0),$p=K(!0),Np=K(!0),jp=K(!1),Wp=K(!0),Gp=K(!1),Hp=K(!0),Yp=K(!1),ji=K(0),Xp=K(!0),Qp=K(!0),Zp=K(!0),Jp=K(!0),of=K([]),rf=K(""),lf=K(0),Kp=K(!1),ha=K(!1),af=K(70),cf=K([]),em=K(!0),tm=K(!0),ff=K(.5),uf=K(3),nm=K(!0),Yr=K(200),sm=K(!0),ga=K(!1),pf=K(14),mf=K(8),im=K(!1),va=K([]),df=K(!1),hf=K(1),om=K(!1),rm=K(!1),lm=K(!0),am=K(!0),cm=K(!0),gf=K(10),N_=K("w"),j_=K("arrowleft"),W_=K("arrowright"),G_=K("arrowup"),H_=K("arrowdown"),Y_=K("a"),X_=K("s"),Q_=K("d"),Z_=K("tab"),J_=K("x"),K_=K("escape"),eb=K("m"),tb=K("k"),nb=K("c"),sb=K("b"),ib=K("g"),ob=K("v"),rb=K("p"),lb=K("1"),ab=K("2"),cb=K("3"),fb=K("4"),ub=K("5"),pb=K("6"),mb=K("7"),db=K("8"),hb=K("9"),gb=K("0"),vb=K(""),_b=K(""),bb=K(""),yb=K(""),kb=K(""),xb=K(""),wb=K(""),Mb=K(""),Fb=K(""),Cb=K(""),Sb=K(""),Ab=K(""),Pb=K(""),Tb=K(""),Xr=K(12);var Vh;Vh={...Ih};var Eb=(t,e)=>{{let n=localStorage.getItem(t),s=JSON.parse(n=="undefined"?null:n);s!==null&&e.set(s)}e.subscribe(n=>{le[t]=n,localStorage.setItem(t,JSON.stringify(n))})},le={};for(let t in Vh)Eb(t,Vh[t]);var C;Nr.subscribe(async t=>{await fetch(`/data/loc/${t}.json?v=8593107`).then(async e=>{C=await e.json(),op.set(!0)})});var hn=(t,e)=>O_(t,e,C),Lh=(t,e)=>$_(t,e,C);function Db(t,e,n){let s=t.slice();return s[6]=e[n],s}function Ib(t){let e,n,s=me(t[2].opts),i=[];for(let r=0;r<s.length;r+=1)i[r]=qb(Db(t,s,r));let o=null;return s.length||(o=Vb(t)),{c(){e=h("div");for(let r=0;r<i.length;r+=1)i[r].c();o&&o.c(),m(e,"class","panel context border grey"),m(e,"style",n="left:"+t[2].x+"px; top:"+t[2].y+"px; "+(t[2].right?"transform: translateX(-100%);":"")+";")},m(r,l){w(r,e,l);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(e,null);o&&o.m(e,null),t[4](e)},p(r,l){if(l&5){s=me(r[2].opts);let a;for(a=0;a<s.length;a+=1){let c=Db(r,s,a);i[a]?i[a].p(c,l):(i[a]=qb(c),i[a].c(),i[a].m(e,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length,!s.length&&o?o.p(r,l):s.length?o&&(o.d(1),o=null):(o=Vb(r),o.c(),o.m(e,null))}l&4&&n!==(n="left:"+r[2].x+"px; top:"+r[2].y+"px; "+(r[2].right?"transform: translateX(-100%);":"")+";")&&m(e,"style",n)},d(r){r&&x(e),st(i,r),o&&o.d(),t[4](null)}}}function Vb(t){let e;return{c(){e=h("div"),e.textContent=`${C.ui.noOptions}`,m(e,"class","choice disabled")},m(n,s){w(n,e,s)},p:ue,d(n){n&&x(e)}}}function Lb(t){let e,n;return{c(){e=h("img"),m(e,"class","svgicon"),at(e.src,n="/data/ui/icons/"+t[6].icon+".svg?v=8593107")||m(e,"src",n)},m(s,i){w(s,e,i)},p(s,i){i&4&&!at(e.src,n="/data/ui/icons/"+s[6].icon+".svg?v=8593107")&&m(e,"src",n)},d(s){s&&x(e)}}}function qb(t){let e,n=t[6].name+"",s,i,o,r,l=t[6].icon&&Lb(t);function a(...c){return t[3](t[6],...c)}return{c(){e=h("div"),l&&l.c(),s=T(n),m(e,"class",i="choice "+(t[6].css||""))},m(c,f){w(c,e,f),l&&l.m(e,null),d(e,s),o||(r=X(e,"mouseup",a),o=!0)},p(c,f){t=c,t[6].icon?l?l.p(t,f):(l=Lb(t),l.c(),l.m(e,s)):l&&(l.d(1),l=null),f&4&&n!==(n=t[6].name+"")&&G(s,n),f&4&&i!==(i="choice "+(t[6].css||""))&&m(e,"class",i)},d(c){c&&x(e),l&&l.d(),o=!1,r()}}}function p7(t){let e,n=t[2]&&Ib(t);return{c(){n&&n.c(),e=be()},m(s,i){n&&n.m(s,i),w(s,e,i)},p(s,[i]){s[2]?n?n.p(s,i):(n=Ib(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ue,o:ue,d(s){s&&x(e),n&&n.d(s)}}}function m7(t,e,n){let s;oe(t,bn,c=>n(2,s=c));let i,o=c=>{c.target!=i&&c.target.parentNode!=i&&s&&bn.set(void 0)},r=(c,f)=>{f.fun(c),bn.set(void 0)};Pn(()=>{document.addEventListener("pointerdown",o,!1)}),Tn(()=>{document.removeEventListener("pointerdown",o)});let l=(c,f)=>r(f,c);function a(c){Nt[c?"unshift":"push"](()=>{i=c,n(1,i)})}return[r,i,s,l,a]}var qh=class extends Fe{constructor(e){super(),Se(this,e,m7,p7,Oe,{opt:0})}get opt(){return this.$$.ctx[0]}},Rb=qh;var B=0,zb={string:t=>{let e=jb(t);return Js(e)+e},varuint:t=>Js(t),varint:t=>d7(t),buffer8:t=>{let e=t.length;return Js(e)+e},buffer16:(t,e)=>{let n=t.length*2,s=Js(n);return(e+s)%2==1&&s++,s+n}};var ve=t=>{let e=0,n=0,s=0;do s=t[B++],e|=(s&127)<<7*n,n++;while(s&128);return e};var Go=(t,e)=>{for(;e>127;)t[B++]=e&127|128,e>>=7;t[B++]=e&127},Js=t=>t<=0?1:Math.floor(Math.log(t)/Math.log(128))+1,d7=t=>Js(t<<1^t>>31),pi=t=>t[B]&128?(255-t[B]+1)*-1:t[B],h7=(t,e)=>{e<0&&(e=255+e+1),t[B]=e&255,B+=1},Ie=t=>t[B],Gi=(t,e)=>{t[B]=e,B+=1},fm=t=>{let e=t[B]|t[B+1]<<8;return e&32768?e|4294901760:e},um=(t,e)=>{t[B]=e&255,t[B+1]=e>>>8,B+=2},Rt=t=>t[B]|t[B+1]<<8;var go=t=>(t[B]|t[B+1]<<8|t[B+2]<<16)+t[B+3]*16777216,Ob=(t,e)=>{t[B]=e&255,t[B+1]=e>>>8,t[B+2]=e>>>16,t[B+3]=e>>>24,B+=4},Rh=new ArrayBuffer(8),Ho=new Uint8Array(Rh),$b=new Float32Array(Rh),EO=new Float64Array(Rh),rt=t=>(Ho[0]=t[B],Ho[1]=t[B+1],Ho[2]=t[B+2],Ho[3]=t[B+3],$b[0]),Nb=(t,e)=>{$b[0]=e,t[B]=Ho[0],t[B+1]=Ho[1],t[B+2]=Ho[2],t[B+3]=Ho[3],B+=4};var Bb=t=>{let e=ve(t);B%2==1&&B++;let n=new Uint16Array(t.buffer,B,e/2);return B+=e,n},jb=t=>{let e=t.length;for(let n=t.length-1;n>=0;n--){let s=t.charCodeAt(n);s>127&&s<=2047?e++:s>2047&&s<=65535&&(e+=2),s>=56320&&s<=57343&&n--}return e},Ub=(t,e)=>{let n=jb(e);Go(t,n);for(let s=0;s<e.length;s++){let i=e.charCodeAt(s);i<128?t[B++]=i:i<2048?(t[B++]=i>>6|192,t[B++]=i&63|128):(i&64512)==55296&&s+1<e.length&&(e.charCodeAt(s+1)&64512)==56320?(i=65536+((i&1023)<<10)+(e.charCodeAt(++s)&1023),t[B++]=i>>18|240,t[B++]=i>>12&63|128,t[B++]=i>>6&63|128,t[B++]=i&63|128):(t[B++]=i>>12|224,t[B++]=i>>6&63|128,t[B++]=i&63|128)}},zn=t=>{let e=ve(t),n="",s=B+e;for(;B<s;){let i=t[B++];if(i<128)n+=String.fromCharCode(i);else if(i>191&&i<224){let o=t[B++];n+=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){let o=t[B++],r=t[B++],l=t[B++],a=((i&7)<<18|(o&63)<<12|(r&63)<<6|l&63)-65536;n+=String.fromCharCode(55296+(a>>10)),n+=String.fromCharCode(56320+(a&1023))}else{let o=t[B++],r=t[B++];n+=String.fromCharCode((i&15)<<12|(o&63)<<6|r&63)}}return n},Wb={encode:t=>{let e=t,n=e.doubles,s=e.int8s,i=e.uint16s,o=e.uint8s,r=0;r+=1,r+=Js(n.length);for(let a=0;a<n.length;a++)r+=4;r+=Js(s.length);for(let a=0;a<s.length;a++)r+=1;r+=Js(i.length);for(let a=0;a<i.length;a++)r+=2;r+=Js(o.length);for(let a=0;a<o.length;a++)r+=1;let l=new Uint8Array(r);B=0,Gi(l,e._header),Go(l,n.length);for(let a=0;a<n.length;a++)Nb(l,n[a]);Go(l,s.length);for(let a=0;a<s.length;a++)h7(l,s[a]);Go(l,i.length);for(let a=0;a<i.length;a++)um(l,i[a]);Go(l,o.length);for(let a=0;a<o.length;a++)Gi(l,o[a]);return l}},Gb={encode:t=>{let e=t,n=0;n+=1,n+=2;let s=new Uint8Array(n);return B=0,Gi(s,e._header),um(s,e.target),s}},Hb={encode:t=>{let e=t,n=e.info,s=0;s+=1,s+=2,s+=Js(n.length);for(let o=0;o<n.length;o++)s+=4;let i=new Uint8Array(s);B=0,Gi(i,e._header),um(i,e.id),Go(i,n.length);for(let o=0;o<n.length;o++)Ob(i,n[o]);return i}},Yb={encode:t=>{let e=t,n=e.info,s=e.pos,i=0;i+=1,i+=2,i+=Js(n.length);for(let r=0;r<n.length;r++)i+=4;i+=Js(s.length);for(let r=0;r<s.length;r++)i+=4;let o=new Uint8Array(i);B=0,Gi(o,e._header),um(o,e.id),Go(o,n.length);for(let r=0;r<n.length;r++)Ob(o,n[r]);Go(o,s.length);for(let r=0;r<s.length;r++)Nb(o,s[r]);return o}},Xb={encode:t=>{let e=t,n=0;n+=1,n+=1;let s=new Uint8Array(n);return B=0,Gi(s,e._header),Gi(s,e.id),s}},Qb={encode:t=>{let e=t,n=0;n+=1,n+=zb.string(e.command,n),n+=zb.string(e.string,n);let s=new Uint8Array(n);return B=0,Gi(s,e._header),Ub(s,e.command),Ub(s,e.string),s}},Zb={decode:t=>{let e=t,n={};B=0,n._header=Ie(e),B+=1;let s=[];n.inputs=s;let i=ve(e);for(let u=0;u<i;u++){let p={};s[u]=p,p.id=Rt(e),B+=2,p.jump=Ie(e),B+=1,p.rot=rt(e),B+=4,p.speed=Rt(e),B+=2;let g=[];p.steer=g,g[0]=pi(e),B+=1;let v=ve(e);for(let _=1;_<v;_++)g[_]=pi(e),B+=1}let o=[];n.log=o;let r=ve(e);for(let u=0;u<r;u++){let p={};o[u]=p;let g=[];p.data=g;let v=ve(e);for(let _=0;_<v;_++)g[_]=ve(e);p.type=Ie(e),B+=1}let l=[];n.logPersonal=l;let a=ve(e);for(let u=0;u<a;u++){let p={};l[u]=p;let g=[];p.data=g;let v=ve(e);for(let _=0;_<v;_++)g[_]=ve(e);p.type=Ie(e),B+=1}let c=[];n.movements=c;let f=ve(e);for(let u=0;u<f;u++){let p={};c[u]=p,p.id=Rt(e),B+=2;let g=[];p.pos=g,g[0]=rt(e),B+=4,g[1]=rt(e),B+=4;let v=ve(e);for(let y=2;y<v;y++)g[y]=rt(e),B+=4;let _=[];p.vel=_,_[0]=rt(e),B+=4,_[1]=rt(e),B+=4;let b=ve(e);for(let y=2;y<b;y++)_[y]=rt(e),B+=4}return n.tickId=go(e),B+=4,n}},Jb={decode:t=>{let e=t,n={};B=0,n._header=Ie(e),B+=1;let s=[];n.members=s;let i=ve(e);for(let l=0;l<i;l++){let a={};s[l]=a,a.class=Ie(e),B+=1,a.entityid=Rt(e),B+=2,a.level=Ie(e),B+=1,a.name=zn(e),a.role=Rt(e),B+=2,a.world=zn(e)}let o=[];n.queues=o;let r=ve(e);for(let l=0;l<r;l++)o[l]=zn(e);return n}},Kb={decode:t=>{let e=t,n={};B=0,n._header=Ie(e),B+=1,n.contrib=ve(e);let s=[];n.contributors=s;let i=ve(e);for(let l=0;l<i;l++){let a={};s[l]=a,a.class=Ie(e),B+=1,a.faction=Ie(e),B+=1,a.level=Ie(e),B+=1,a.name=zn(e);let c=[];a.stats=c;let f=ve(e);for(let u=0;u<f;u++)c[u]=ve(e)}n.duration=ve(e);let o=[];n.kills=o,o[0]=ve(e);let r=ve(e);for(let l=1;l<r;l++)o[l]=ve(e);return n.level=ve(e),n.reward=ve(e),n.status=Ie(e),B+=1,n}},e3={decode:t=>{let e=t,n={};B=0,n._header=Ie(e),B+=1;let s=[];n.members=s;let i=ve(e);for(let o=0;o<i;o++){let r={};s[o]=r,r.entityid=Rt(e),B+=2;let l=[];r.pos=l;let a=ve(e);for(let c=0;c<a;c++)l[c]=Rt(e),B+=2}return n}},t3={decode:t=>{let e=t,n={};B=0,n._header=Ie(e),B+=1;let s=[];n.icons=s;let i=ve(e);for(let o=0;o<i;o++){let r={};s[o]=r,r.blink=!!pi(e),B+=1,r.id=Rt(e),B+=2;let l=[];r.pos=l,l[0]=Rt(e),B+=2;let a=ve(e);for(let c=1;c<a;c++)l[c]=Rt(e),B+=2}return n}},n3={decode:t=>{let e=t,n={};B=0,n._header=Ie(e),B+=1;let s=[];n.messages=s;let i=ve(e);for(let o=0;o<i;o++){let r={};s[o]=r,r.channel=zn(e),r.clan=zn(e),r.class=Ie(e),B+=1,r.faction=Ie(e),B+=1,r.from=zn(e),r.id=go(e),B+=4,r.level=Ie(e),B+=1,r.message=zn(e),r.subscribed=Ie(e),B+=1}return n}},s3={decode:t=>{let e=t,n={};return B=0,n._header=Ie(e),B+=1,n.world=zn(e),n}},i3={decode:t=>{let e=t,n={};B=0,n._header=Ie(e),B+=1;let s=[];n.messages=s;let i=ve(e);for(let o=0;o<i;o++){let r={};s[o]=r,r.message=zn(e),r.type=zn(e)}return n}},o3={decode:t=>{let e=t,n={};return B=0,n._header=Ie(e),B+=1,n.file=zn(e),n.playerId=Rt(e),B+=2,n.tickId=go(e),B+=4,n.world=zn(e),n}},r3={decode:t=>{let e=t,n={};return B=0,n._header=Ie(e),B+=1,n.pos=Rt(e),B+=2,n}},l3={decode:t=>{let e=t,n={};return B=0,n._header=Ie(e),B+=1,n.id=Ie(e),B+=1,n},encode:t=>{let e=t,n=0;n+=1,n+=1;let s=new Uint8Array(n);return B=0,Gi(s,e._header),Gi(s,e.id),s}};var a3={decode:t=>{let e=t,n={};B=0;let s=[];n.aabb=s;let i=ve(e);for(let F=0;F<i;F++)s[F]=rt(e),B+=4;let o=[];n.area=o;let r=ve(e);for(let F=0;F<r;F++)o[F]=Rt(e),B+=2;let l=[];n.environment=l;let a=ve(e);for(let F=0;F<a;F++)l[F]=Rt(e),B+=2;let c=[];n.holes=c;let f=ve(e);for(let F=0;F<f;F++)c[F]=Rt(e),B+=2;let u=[];n.props=u;let p=ve(e);for(let F=0;F<p;F++){let M={};u[F]=M,M.id=go(e),B+=4,M.rx=fm(e),B+=2,M.ry=fm(e),B+=2,M.rz=fm(e),B+=2,M.scale=Rt(e),B+=2,M.x=Rt(e),B+=2,M.y=go(e),B+=4,M.z=Rt(e),B+=2}let g=[];n.shore=g;let v=ve(e);for(let F=0;F<v;F++)g[F]=Rt(e),B+=2;n.terrain=Bb(e);let _=[];n.texture=_;let b=ve(e);for(let F=0;F<b;F++)_[F]=Bb(e);let y=[];n.textureid=y;let k=ve(e);for(let F=0;F<k;F++){let M=[];y[F]=M;let D=ve(e);for(let L=0;L<D;L++)M[L]=Rt(e),B+=2}let S=[];n.water=S;let A=ve(e);for(let F=0;F<A;F++)S[F]=Rt(e),B+=2;return n}},c3={decode:t=>{let e=t,n={};B=0;let s=[];n.color=s;let i=ve(e);for(let y=0;y<i;y++)s[y]=Ie(e),B+=1;let o=[];n.flags=o;let r=ve(e);for(let y=0;y<r;y++)o[y]=Ie(e),B+=1;let l=[];n.index=l;let a=ve(e);for(let y=0;y<a;y++)l[y]=ve(e);let c=[];n.indexInvisible=c;let f=ve(e);for(let y=0;y<f;y++)c[y]=ve(e);let u=[];n.normal=u;let p=ve(e);for(let y=0;y<p;y++)u[y]=pi(e),B+=1;let g=[];n.position=g;let v=ve(e);for(let y=0;y<v;y++)g[y]=fm(e),B+=2;n.sx=go(e),B+=4,n.sy=go(e),B+=4,n.sz=go(e),B+=4;let _=[];n.uv=_;let b=ve(e);for(let y=0;y<b;y++)_[y]=Rt(e),B+=2;return n}},f3={decode:t=>{let e=t,n={};B=0;let s=[];n.animations=s;let i=ve(e);for(let Q=0;Q<i;Q++){let U={};s[Q]=U,U.duration=rt(e),B+=4;let fe=[];U.effects=fe;let je=ve(e);for(let ze=0;ze<je;ze++){let Be={};fe[ze]=Be,Be.body=Ie(e),B+=1,Be.end=rt(e),B+=4,Be.id=Ie(e),B+=1,Be.priority=Ie(e),B+=1,Be.start=rt(e),B+=4,Be.type=Ie(e),B+=1}U.id=Ie(e),B+=1,U.movement=Ie(e),B+=1,U.priority=Ie(e),B+=1;let Ve=[];U.sounds=Ve;let xe=ve(e);for(let ze=0;ze<xe;ze++){let Be={};Ve[ze]=Be,Be.end=Ie(e),B+=1,Be.id=Ie(e),B+=1,Be.start=rt(e),B+=4}}let o=[];n.areas=o;let r=ve(e);for(let Q=0;Q<r;Q++){let U={};o[Q]=U,U.ambientday=Ie(e),B+=1,U.ambientnight=Ie(e),B+=1,U.id=Ie(e),B+=1,U.music=Ie(e),B+=1,U.name=zn(e)}let l=[];n.arenas=l;let a=ve(e);for(let Q=0;Q<a;Q++){let U={};l[Q]=U,U.group=Ie(e),B+=1,U.id=Ie(e),B+=1;let fe=[];U.pos=fe;let je=ve(e);for(let Ve=0;Ve<je;Ve++)fe[Ve]=rt(e),B+=4;U.radius=Ie(e),B+=1,U.rot=rt(e),B+=4,U.type=Ie(e),B+=1,U.world=Ie(e),B+=1}let c=[];n.classes=c;let f=ve(e);for(let Q=0;Q<f;Q++){let U={};c[Q]=U;let fe=[];U.baseStats=fe;let je=ve(e);for(let Ze=0;Ze<je;Ze++){let Et=[];fe[Ze]=Et;let ye=ve(e);for(let Je=0;Je<ye;Je++)Et[Je]=Ie(e),B+=1}let Ve=[];U.engineSkills=Ve;let xe=ve(e);for(let Ze=0;Ze<xe;Ze++)Ve[Ze]=Ie(e),B+=1;U.id=Ie(e),B+=1;let ze=[];U.startSkills=ze;let Be=ve(e);for(let Ze=0;Ze<Be;Ze++)ze[Ze]=Ie(e),B+=1;let mt=[];U.statPerLevel=mt;let wt=ve(e);for(let Ze=0;Ze<wt;Ze++){let Et=[];mt[Ze]=Et;let ye=ve(e);for(let Je=0;Je<ye;Je++)Et[Je]=Ie(e),B+=1}}let u=[];n.creatures=u;let p=ve(e);for(let Q=0;Q<p;Q++){let U={};u[Q]=U;let fe=[];U.col1=fe;let je=ve(e);for(let ze=0;ze<je;ze++)fe[ze]=rt(e),B+=4;let Ve=[];U.col2=Ve;let xe=ve(e);for(let ze=0;ze<xe;ze++)Ve[ze]=rt(e),B+=4;U.drProtection=!!pi(e),B+=1,U.faction=Ie(e),B+=1,U.id=Rt(e),B+=2,U.level=Ie(e),B+=1,U.name=zn(e),U.skin=Ie(e),B+=1,U.type=Ie(e),B+=1}let g=[];n.creaturesConjurer=g;let v=ve(e);for(let Q=0;Q<v;Q++){let U={};g[Q]=U,U.id=Rt(e),B+=2,U.war=!!pi(e),B+=1}let _=[];n.creaturesMonster=_;let b=ve(e);for(let Q=0;Q<b;Q++){let U={};_[Q]=U,U.aggroMode=Ie(e),B+=1,U.id=Rt(e),B+=2,U.rarity=Ie(e),B+=1}let y=[];n.creaturesTrader=y;let k=ve(e);for(let Q=0;Q<k;Q++){let U={};y[Q]=U,U.id=Rt(e),B+=2,U.shop=Ie(e),B+=1}let S=[];n.effects=S;let A=ve(e);for(let Q=0;Q<A;Q++){let U={};S[Q]=U,U.duration=rt(e),B+=4;let fe=[];U.events=fe;let je=ve(e);for(let ze=0;ze<je;ze++){let Be={};fe[ze]=Be,Be.fraction=rt(e),B+=4,Be.id=Ie(e),B+=1;let mt=[];Be.params=mt;let wt=ve(e);for(let Ze=0;Ze<wt;Ze++)mt[Ze]=rt(e),B+=4}U.id=Ie(e),B+=1;let Ve=[];U.periods=Ve;let xe=ve(e);for(let ze=0;ze<xe;ze++){let Be={};Ve[ze]=Be,Be.fractionEnd=rt(e),B+=4,Be.fractionStart=rt(e),B+=4,Be.id=Ie(e),B+=1;let mt=[];Be.modifiers=mt;let wt=ve(e);for(let ye=0;ye<wt;ye++){let Je={};mt[ye]=Je,Je.id=Ie(e),B+=1,Je.mode=Ie(e),B+=1;let yt=[];Je.params=yt;let St=ve(e);for(let Pe=0;Pe<St;Pe++)yt[Pe]=rt(e),B+=4}let Ze=[];Be.params=Ze;let Et=ve(e);for(let ye=0;ye<Et;ye++)Ze[ye]=rt(e),B+=4}}let F=[];n.environments=F;let M=ve(e);for(let Q=0;Q<M;Q++){let U={};F[Q]=U;let fe=[];U.ambient=fe;let je=ve(e);for(let Me=0;Me<je;Me++){let ot=[];fe[Me]=ot;let Qe=ve(e);for(let ut=0;ut<Qe;ut++)ot[ut]=rt(e),B+=4}let Ve=[];U.bloom=Ve;let xe=ve(e);for(let Me=0;Me<xe;Me++)Ve[Me]=rt(e),B+=4;let ze=[];U.clouds=ze;let Be=ve(e);for(let Me=0;Me<Be;Me++){let ot=[];ze[Me]=ot;let Qe=ve(e);for(let ut=0;ut<Qe;ut++)ot[ut]=rt(e),B+=4}let mt=[];U.direct=mt;let wt=ve(e);for(let Me=0;Me<wt;Me++){let ot=[];mt[Me]=ot;let Qe=ve(e);for(let ut=0;ut<Qe;ut++)ot[ut]=rt(e),B+=4}let Ze=[];U.fog=Ze;let Et=ve(e);for(let Me=0;Me<Et;Me++){let ot=[];Ze[Me]=ot;let Qe=ve(e);for(let ut=0;ut<Qe;ut++)ot[ut]=rt(e),B+=4}let ye=[];U.horizon=ye;let Je=ve(e);for(let Me=0;Me<Je;Me++){let ot=[];ye[Me]=ot;let Qe=ve(e);for(let ut=0;ut<Qe;ut++)ot[ut]=rt(e),B+=4}U.id=Ie(e),B+=1;let yt=[];U.skybot=yt;let St=ve(e);for(let Me=0;Me<St;Me++){let ot=[];yt[Me]=ot;let Qe=ve(e);for(let ut=0;ut<Qe;ut++)ot[ut]=rt(e),B+=4}let Pe=[];U.skymid=Pe;let ft=ve(e);for(let Me=0;Me<ft;Me++){let ot=[];Pe[Me]=ot;let Qe=ve(e);for(let ut=0;ut<Qe;ut++)ot[ut]=rt(e),B+=4}let Ut=[];U.skytop=Ut;let Le=ve(e);for(let Me=0;Me<Le;Me++){let ot=[];Ut[Me]=ot;let Qe=ve(e);for(let ut=0;ut<Qe;ut++)ot[ut]=rt(e),B+=4}let Ct=[];U.sun=Ct;let Vt=ve(e);for(let Me=0;Me<Vt;Me++){let ot=[];Ct[Me]=ot;let Qe=ve(e);for(let ut=0;ut<Qe;ut++)ot[ut]=rt(e),B+=4}let He=[];U.water=He;let Ke=ve(e);for(let Me=0;Me<Ke;Me++){let ot=[];He[Me]=ot;let Qe=ve(e);for(let ut=0;ut<Qe;ut++)ot[ut]=rt(e),B+=4}}let D=[];n.files=D;let L=ve(e);for(let Q=0;Q<L;Q++){let U={};D[Q]=U,U.ext=Ie(e),B+=1,U.id=Rt(e),B+=2,U.type=Ie(e),B+=1}let E=[];n.filesExt=E;let R=ve(e);for(let Q=0;Q<R;Q++)E[Q]=zn(e);let z=[];n.foliages=z;let q=ve(e);for(let Q=0;Q<q;Q++){let U={};z[Q]=U,U.id=Ie(e),B+=1;let fe=[];U.nodes=fe;let je=ve(e);for(let Ve=0;Ve<je;Ve++){let xe={};fe[Ve]=xe,xe.arc=rt(e),B+=4;let ze=[];xe.end=ze;let Be=ve(e);for(let ye=0;ye<Be;ye++)ze[ye]=rt(e),B+=4;xe.geotype=Ie(e),B+=1,xe.jitter_radius=rt(e),B+=4,xe.jitter_rotation=rt(e),B+=4,xe.jitter_size=rt(e),B+=4,xe.jitter_slant=rt(e),B+=4,xe.jitter_y=rt(e),B+=4,xe.leafCount=Ie(e),B+=1;let mt=[];xe.points=mt;let wt=ve(e);for(let ye=0;ye<wt;ye++)mt[ye]=rt(e),B+=4;xe.radius=rt(e),B+=4,xe.size=rt(e),B+=4,xe.slant=rt(e),B+=4;let Ze=[];xe.start=Ze;let Et=ve(e);for(let ye=0;ye<Et;ye++)Ze[ye]=rt(e),B+=4;xe.y=rt(e),B+=4}U.seed=go(e),B+=4,U.texture=Rt(e),B+=2,U.type=Ie(e),B+=1}let j=[];n.meshes=j;let W=ve(e);for(let Q=0;Q<W;Q++){let U={};j[Q]=U,U.cull=Ie(e),B+=1;let fe=[];U.effects=fe;let je=ve(e);for(let Ve=0;Ve<je;Ve++){let xe={};fe[Ve]=xe,xe.id=Ie(e),B+=1;let ze=[];xe.pos=ze;let Be=ve(e);for(let ye=0;ye<Be;ye++)ze[ye]=rt(e),B+=4;let mt=[];xe.rot=mt;let wt=ve(e);for(let ye=0;ye<wt;ye++)mt[ye]=rt(e),B+=4;let Ze=[];xe.scale=Ze;let Et=ve(e);for(let ye=0;ye<Et;ye++)Ze[ye]=rt(e),B+=4}U.geometry=Rt(e),B+=2,U.id=Rt(e),B+=2,U.shader=Ie(e),B+=1,U.shadow=Ie(e),B+=1,U.texture=Rt(e),B+=2}let N=[];n.minimap=N;let O=ve(e);for(let Q=0;Q<O;Q++){let U={};N[Q]=U,U.img=Rt(e),B+=2;let fe=[];U.pos=fe;let je=ve(e);for(let Ve=0;Ve<je;Ve++)fe[Ve]=Rt(e),B+=2;U.world=Ie(e),B+=1}let se=[];n.particles=se;let re=ve(e);for(let Q=0;Q<re;Q++){let U={};se[Q]=U;let fe=[];U.acc=fe;let je=ve(e);for(let mt=0;mt<je;mt++)fe[mt]=rt(e),B+=4;U.blend=Ie(e),B+=1;let Ve=[];U.colEnd=Ve;let xe=ve(e);for(let mt=0;mt<xe;mt++)Ve[mt]=rt(e),B+=4;let ze=[];U.colStart=ze;let Be=ve(e);for(let mt=0;mt<Be;mt++)ze[mt]=rt(e),B+=4;U.duration=rt(e),B+=4,U.friction=rt(e),B+=4,U.id=Ie(e),B+=1,U.idEnd=Ie(e),B+=1,U.idLoop=Ie(e),B+=1,U.idStart=Ie(e),B+=1,U.interp=Ie(e),B+=1,U.randomRota=rt(e),B+=4,U.rota=rt(e),B+=4,U.rotaEnd=rt(e),B+=4,U.scaleEnd=rt(e),B+=4,U.scaleStart=rt(e),B+=4}let ie=[];n.ribbons=ie;let ce=ve(e);for(let Q=0;Q<ce;Q++){let U={};ie[Q]=U;let fe=[];U.colEnd=fe;let je=ve(e);for(let ze=0;ze<je;ze++)fe[ze]=rt(e),B+=4;let Ve=[];U.colStart=Ve;let xe=ve(e);for(let ze=0;ze<xe;ze++)Ve[ze]=rt(e),B+=4;U.id=Ie(e),B+=1,U.interval=rt(e),B+=4,U.steps=Ie(e),B+=1,U.texture=Rt(e),B+=2}let ke=[];n.skeletons=ke;let ge=ve(e);for(let Q=0;Q<ge;Q++){let U={};ke[Q]=U,U.cape=!!pi(e),B+=1,U.groundNormal=!!pi(e),B+=1,U.height=rt(e),B+=4,U.helmet=!!pi(e),B+=1,U.id=Ie(e),B+=1,U.shoulders=!!pi(e),B+=1}let Ne=[];n.skins=Ne;let Te=ve(e);for(let Q=0;Q<Te;Q++){let U={};Ne[Q]=U,U.animset=Ie(e),B+=1;let fe=[];U.body=fe;let je=ve(e);for(let Pe=0;Pe<je;Pe++){let ft={};fe[Pe]=ft,ft.bid=Ie(e),B+=1;let Ut=[];ft.col=Ut;let Le=ve(e);for(let Qe=0;Qe<Le;Qe++)Ut[Qe]=rt(e),B+=4;ft.colMode=Ie(e),B+=1,ft.lod=Ie(e),B+=1,ft.mid=Rt(e),B+=2,ft.pid=pi(e),B+=1;let Ct=[];ft.pos=Ct;let Vt=ve(e);for(let Qe=0;Qe<Vt;Qe++)Ct[Qe]=rt(e),B+=4;let He=[];ft.rot=He;let Ke=ve(e);for(let Qe=0;Qe<Ke;Qe++)He[Qe]=rt(e),B+=4;let Me=[];ft.scl=Me;let ot=ve(e);for(let Qe=0;Qe<ot;Qe++)Me[Qe]=rt(e),B+=4;ft.ts=Ie(e),B+=1}U.capeswing=Ie(e),B+=1;let Ve=[];U.colPrim=Ve;let xe=ve(e);for(let Pe=0;Pe<xe;Pe++)Ve[Pe]=rt(e),B+=4;let ze=[];U.colSec=ze;let Be=ve(e);for(let Pe=0;Pe<Be;Pe++)ze[Pe]=rt(e),B+=4;let mt=[];U.effects=mt;let wt=ve(e);for(let Pe=0;Pe<wt;Pe++){let ft={};mt[Pe]=ft,ft.bid=Ie(e),B+=1,ft.id=Ie(e),B+=1}U.id=Ie(e),B+=1,U.mountPart=Ie(e),B+=1;let Ze=[];U.mountPos=Ze;let Et=ve(e);for(let Pe=0;Pe<Et;Pe++)Ze[Pe]=rt(e),B+=4;let ye=[];U.sheathedPos=ye;let Je=ve(e);for(let Pe=0;Pe<Je;Pe++)ye[Pe]=rt(e),B+=4;U.size=rt(e),B+=4,U.skeleton=Ie(e),B+=1,U.soundset=Ie(e),B+=1;let yt=[];U.unsheathedPos=yt;let St=ve(e);for(let Pe=0;Pe<St;Pe++)yt[Pe]=rt(e),B+=4}let Ce=[];n.sounds=Ce;let _e=ve(e);for(let Q=0;Q<_e;Q++){let U={};Ce[Q]=U,U.distance=rt(e),B+=4;let fe=[];U.files=fe;let je=ve(e);for(let Ve=0;Ve<je;Ve++)fe[Ve]=Rt(e),B+=2;U.id=Ie(e),B+=1}let H=[];n.soundsetSteps=H;let de=ve(e);for(let Q=0;Q<de;Q++){let U={};H[Q]=U,U.id=Ie(e),B+=1;let fe=[];U.steps=fe;let je=ve(e);for(let Ve=0;Ve<je;Ve++)fe[Ve]=Ie(e),B+=1}let Re=[];n.soundsets=Re;let Ge=ve(e);for(let Q=0;Q<Ge;Q++){let U={};Re[Q]=U,U.id=Ie(e),B+=1;let fe=[];U.sounds=fe;let je=ve(e);for(let Ve=0;Ve<je;Ve++)fe[Ve]=Ie(e),B+=1;U.steps=Ie(e),B+=1}let Xe=[];n.terrains=Xe;let Ye=ve(e);for(let Q=0;Q<Ye;Q++){let U={};Xe[Q]=U,U.brightest=Ie(e),B+=1,U.darkest=Ie(e),B+=1;let fe=[];U.foliage=fe;let je=ve(e);for(let Ve=0;Ve<je;Ve++){let xe=[];fe[Ve]=xe;let ze=ve(e);for(let Be=0;Be<ze;Be++)xe[Be]=Ie(e),B+=1}U.id=Ie(e),B+=1,U.scale=Ie(e),B+=1,U.spec=Ie(e),B+=1,U.texture=Rt(e),B+=2}let pe=[];n.traderShopItems=pe;let ae=ve(e);for(let Q=0;Q<ae;Q++){let U={};pe[Q]=U,U.bind=Ie(e),B+=1,U.id=Ie(e),B+=1,U.shop=Ie(e),B+=1,U.stacks=Ie(e),B+=1,U.tier=Rt(e),B+=2,U.type=zn(e),U.upgrade=Ie(e),B+=1}let Ue=[];n.worlds=Ue;let Z=ve(e);for(let Q=0;Q<Z;Q++){let U={};Ue[Q]=U,U.chunkAmount=Ie(e),B+=1,U.id=Ie(e),B+=1,U.minlevel=Ie(e),B+=1,U.music=Ie(e),B+=1,U.name=zn(e)}return n}};var Ft={clientPlayerInput:Wb,clientPlayerChangeTarget:Gb,clientPlayerSkill:Hb,clientPlayerEnvSkill:Yb,clientPlayerInteract:Xb,clientCommand:Qb,serverOnClientConnect:o3,serverEntityDelta:Zb,serverPartyUpdate:Jb,serverWarUpdate:Kb,serverPartyPositions:e3,serverChangeWorld:s3,serverMapUpdate:t3,serverChat:n3,serverSystemMessage:i3,serverQueue:r3,ping:l3},_a={chunk:a3,gamedata:f3,modelformat:c3},u3=[],v7=0;for(let t in Ft)Ft[t]&&(Ft[t].header=v7++,Ft[t].packData=function(e){return e._header=this.header,this.encode(e)},u3.push(Ft[t]));var p3=t=>{if(t.length===0)return;let e=u3[t[0]];if(!(e&&e.maxSize<t.length))return e};var I,pm=[0,1,0];var bt=[0,0,0],yn=[0,0,0],Qr=[0,0,0],mi=[0,0,0],mm=[0,0,0],vf=[0,0,0];var vo=[0,0,0,0];var Bn=[0,0],Hi=[0,0];var IO=fi(),m3=t=>{I=t},_o=0,d3=t=>_o=t;var Wh={};Xn(Wh,{onWorldEnter:()=>b7,parseBandwidth:()=>Nh,parseFrameDelta:()=>h3,parseLatency:()=>jh,tick:()=>_7});var vt=(t,e,n)=>Math.min(Math.max(t,e),n),ba=(t,e)=>(t%e+e)%e,_f=(t,e,n)=>{let s=vt((n-t)/(e-t),0,1);return s*s*(3-2*s)},di=(t,e,n,s,i)=>s+(vt(t,e,n)-e)/(n-e)*(i-s),bf=(t,e,n)=>e+vt(t,0,1)*(n-e),Qt={linear:t=>t,easeInQuad:t=>t*t,easeInQuart:t=>t**4,easeOutQuad:t=>t*(2-t),easeOutExpo:t=>-Math.pow(2,-10*t)+1,easeOutFlick:t=>1-Math.pow(1-t,10),sin:t=>Math.sin(t*3.14),sinReverse:t=>1-Math.sin(t*3.14),easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeBounce:t=>t<.36363636363636365?7.5625*t*t:t<.7272727272727273?7.5625*(t-=.5454545454545454)*t+.75:t<.9090909090909091?7.5625*(t-=.8181818181818182)*t+.9375:7.5625*(t-=.9545454545454546)*t+.984375,anticipate:t=>-1/(1+Math.exp((t-.5)*50))+Math.sin((t-.5)*6.2)*1.4*(1-t*.5)+1,flicker:t=>Math.sin(t*3.14)*(1+Math.sin(t*38)*.3)},Yo=(t,e,n)=>t<e?di(t,0,e,0,n):di(Qt.easeInOutCubic(di(t,e,1,0,1)),0,1,n,1),ya=[Qt.linear,Qt.easeInQuad,Qt.easeInQuart,Qt.easeOutQuad,Qt.easeOutExpo,Qt.easeOutFlick,Qt.sin,Qt.sinReverse,Qt.easeInOutCubic,Qt.easeInOutQuint,Qt.easeBounce,Qt.anticipate,Qt.flicker];var kt=class{constructor(e=0,n=0){this.start=e,this.end=e+n,this.duration=n}done(e){return e>this.end}fraction(e){return vt(1-(this.end-e)/this.duration,0,1)}remaining(e){return this.end-e}passed(e){return e-this.start}reset(e,n=this.duration){return this.start=e,this.end=e+n,this.duration=n,!0}set(e,n){return this.start=e,this.end=n,this.duration=this.end-this.start,!0}};var Uh=.016,h3=t=>{Uh=(Uh*10+t)/11},g3=0,zh=0,Nh=t=>{g3=t},Oh=0,jh=t=>{Oh=(Oh*2+t)/3},Bh=0,$h=new kt(0,.05),_7=t=>{h3(t),le.showFpsPing&&$h.done(I.time)&&(zh=(zh*10+g3)/11,Bh=(Bh*5+I.netData.length)/6,$h.reset(I.time),up.update(e=>(e[0]=vt(Oh>>0,1,999),e[1]=(1/Uh).toFixed(1),e[2]=(zh/1e3).toFixed(1),e[3]=I.player?`${~~I.player.pos[0]} ${~~I.player.pos[1]} ${~~I.player.pos[2]}`:"-",e[4]=Bh.toFixed(1),e)))},b7=t=>{$h.reset(t.time)};var y7=performance,yf=()=>y7.now();var hi,Hh=0,v3=0,y3=(t,e)=>{Un(Ft.serverOnClientConnect.header,n=>{t(Ft.serverOnClientConnect.decode(n))}),Un("close",n=>{e(n.code)})},Zr={open:[],close:[]};for(let t in Ft)Zr[Ft[t].header]=[];var k7=t=>{},x7=t=>{console.log("Connected"),Hh=1;for(let e=0,n=Zr.open.length;e<n;++e)Zr.open[e](t)},w7=t=>{console.log("Connection closed:",t.reason,t.code),Hh=0,hi.close(),hi=void 0;for(let e=0,n=Zr.close.length;e<n;++e)Zr.close[e](t)},M7=t=>{F7(t.data.byteLength),t=new Uint8Array(t.data);let e=p3(t),n=e&&Zr[e.header];if(n)for(let s=0,i=n.length;s<i;++s)n[s](t)},Un=(t,e)=>{Zr[t].push(e)},Ss=t=>{hi===void 0||Hh!==1||hi.send(t)},k3=t=>{if(hi!==void 0)return;let e="game1.hordes.io";hi=new WebSocket(`wss://${e}:`+t+"/play"),hi.binaryType="arraybuffer",hi.onerror=k7,hi.onopen=x7,hi.onclose=w7,hi.onmessage=M7};var _3=0,Gh=0,F7=t=>{Gh+=t,_o-_3>1e3/4&&(v3=Gh*4,Gh=0,_3=_o,Nh(v3))},x3=()=>{le.showFpsPing&&_o-b3>(xf.length<10?100:2e3)&&(b3=_o,C7())},w3=t=>{if(xf[t.id]){let e=yf();if(xf[t.id]<=e){let n=e-xf[t.id];jh(n)}}},kf=0,b3=0,xf=[],C7=()=>{kf>254&&(kf=0),xf[kf]=yf(),Ss(Ft.ping.packData({id:kf})),kf++};var xt=(t,e="")=>{Ss(Ft.clientCommand.packData({command:t,string:e+""}))};var Kr={report:{client:!0},partyleave:{},partyinvite:{a:1},partycreate:{},time:{},bosslog:{},party:{a:1,chat:!0},clan:{a:1,chat:!0},faction:{a:1,chat:!0}},bo={itemmove:{a:2},itemdrop:{a:1},itemauctionpost:{a:2},itemauctionfind:{a:5},itemauctionbuy:{a:1},itemauctioncancel:{a:1},itemstash:{a:1},itemunstash:{a:1},itemsplithalf:{a:1},itemsplitone:{a:1},goldstash:{a:1},itemtradersell:{a:1},itemtraderbuy:{a:1},itemblacksmithupgrade:{a:1},petlootsettings:{a:2},statincrease:{a:2},skillconfig:{a:1},cancelbuff:{a:1},respawn:{},startqueue:{a:1},stopqueue:{a:1},partyaccept:{a:1},partydecline:{a:1},partykick:{a:1},partysetrole:{a:2},summonaccept:{a:1},whisper:{a:2,chat:!0},global:{a:1},...Kr};var M3=t=>{navigator.clipboard.writeText(t)};var Qh={};Xn(Qh,{addRequest:()=>ka,confirmationBasedCallback:()=>hm,onWorldDestroy:()=>P7,onWorldEnter:()=>A7,postTick:()=>S7,removeTopRequest:()=>Xh});var Yh=new kt(0,1),Yi=[],S7=(t,e)=>{Yh.done(e.time)&&(Yh.reset(e.time),Yi.length&&(Yi.forEach(n=>{F3(n,1)}),oo.set(Yi)))},A7=t=>{Yh.reset(0)},P7=t=>{Yi.length=0,oo.set(Yi)},ka=(t,e,n)=>{let s={title:t,text:e,choices:n};Yi.push(s),F3(s,0),oo.set(Yi)},F3=(t,e)=>{for(let n=0;n<t.choices.length;++n){let s=t.choices[n];if(s.blockedTime!==void 0)s.blockedTime>1?(s.blockedTime-=e,s.unavailable=`(${s.blockedTime} s)`):s.unavailable=void 0;else if(s.nocombat&&I&&I.player&&I.player.stats){let i=~~I.player.stats.combatTimer.remaining(I.time);i>0?s.unavailable=`(Combat - ${i}s)`:s.unavailable=void 0}s.remaining!==void 0&&(s.remaining>1?(s.remaining-=e,s.additional=`(${~~s.remaining}s remaining)`):(s.additional=void 0,s.unavailable="(Timed out)"))}},Xh=()=>{Yi.length&&(Yi.shift(),oo.set(Yi))},dm=!0,hm=(t,e,n,s)=>{t?dm&&(ka(n,s,[{text:n,fun:()=>{dm=!0,e()}},{text:C.ui.decline,fun:()=>{dm=!0}}]),dm=!1):e()};var gm={normal:{partyBasedHostility:!1,pvpprotect:!0,instanced:!1},arena3v3:{name:"Arena 3v3",queue:!0,instanced:!0,groupsize:3,groupcount:2,partyBasedHostility:!0,pvpprotect:!1,startTimer:30},arena5v5:{name:"Arena 5v5",startTimer:30,groupsize:5,groupcount:2,queue:!0,instanced:!0,partyBasedHostility:!0,pvpprotect:!1}};var _m={};Xn(_m,{init:()=>E7,onRemoveEntity:()=>Zh,onWorldDestroy:()=>I7,party:()=>en,postTick:()=>D7});var vm,T7=0,en=new Map,E7=()=>{Un(Ft.serverPartyUpdate.header,t=>{vm=t}),Un(Ft.serverPartyPositions.header,t=>{t=Ft.serverPartyPositions.decode(t).members,en.forEach(e=>{let n=t.find(s=>s.entityid===e.id);n&&(e.pos[0]=n.pos[0],e.pos[1]=n.pos[1])})})},D7=(t,e)=>{if(e.player!==void 0){if(vm){en.forEach(s=>{s.found=!1});let n=Ft.serverPartyUpdate.decode(vm);n.members.forEach(s=>{if(!en.has(s.name))en.set(s.name,{id:s.entityid,found:!0,pos:[0,0],local:s.world===e.id,name:s.name,buffStore:s.entityid===e.playerId?ea:K([]),unitStore:s.entityid===e.playerId?Bi:K({id:s.entityid,name:s.name,level:s.level,class:s.class,world:s.world,role:s.role,party:e.player.party,faction:e.player.faction,type:0,visible:!0,alive:!0,rarity:!1,range:!1})});else{let i=en.get(s.name);s.entityid!==e.playerId&&(i.local=s.world===e.id,i.unitStore.update(o=>(o.id=s.entityid,o.name=s.name,o.level=s.level,o.class=s.class,o.world=s.world,o.party=e.player.party,o.faction=e.player.faction,o.role=s.role,o))),i.id=s.entityid,i.found=!0}}),en.forEach((s,i)=>{s.found||en.delete(i)}),Kl.set(Array.from(en.values()).filter(s=>le.showSelfInParty||s.id!==e.playerId)),Qn.update(s=>(s.membercount=n.members.length,s.queues=n.queues,le.partyinfo=s,s)),vm=void 0}if(e.player.party>0)if(!le.partyBuffLimitUpdateRate)e.entities.type[0].forEach(n=>{n.party===e.player.party&&(n.buffDisplayDirty=!0)});else{let n=Array.from(en.values())[T7++%en.size];if(n){let s=e.entity(n.id);s!==void 0&&s.id!==e.playerId&&(s.buffDisplayDirty=!0)}}}},Zh=t=>{if(en.has(t.name)){let e=en.get(t.name);e.unitStore.update(n=>(n.timedSkill=void 0,n.timedCast=void 0,n.alive=!0,n.range=!1,n.mp=n.hp=n.hpMax=n.mpMax=0,n)),e.buffStore.set([])}},I7=()=>{en.clear()};var P1={};Xn(P1,{onWorldEnter:()=>rT,postTick:()=>lT,steps:()=>Ps,tut:()=>tn});function C3(t,e){return t[0]=e[0],t[1]=e[1],t}function ds(t,e,n){return t[0]=e,t[1]=n,t}function S3(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function xa(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function wf(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function Jh(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t}function wa(t){let e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function A3(t){let e=t[0],n=t[1];return e*e+n*n}function bm(t,e){let n=e[0],s=e[1],i=n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function P3(t,e,n){let s=Math.sin(n),i=Math.cos(n);return t[0]=e[1]*s+e[0]*i,t[1]=e[1]*i-e[0]*s,t}var ym=[0,0,0],T3=(t,e,n,s,i)=>{if(t.length>0){Y(e,1/0,1/0,1/0),Y(n,-1/0,-1/0,-1/0);for(let o=0,r=t.length;o<r;o+=3){let l=t[o],a=t[o+1],c=t[o+2];e[0]=Math.min(l,e[0]),e[1]=Math.min(a,e[1]),e[2]=Math.min(c,e[2]),n[0]=Math.max(l,n[0]),n[1]=Math.max(a,n[1]),n[2]=Math.max(c,n[2])}}else Y(e,0,0,0),Y(n,-0,-0,-0);Xt(i,n,e),dn(s,Rn(s,e,n),.5)},V7=t=>{T3(t.attributes.position.data,t.bounds.min,t.bounds.max,t.bounds.center,t.bounds.scale),t.bounds.initiated=!0},L7=t=>{let e=0;for(let n=0,s=t.attributes.position.data.length;n<s;n+=3)ym[0]=t.attributes.position.data[n],ym[1]=t.attributes.position.data[n+1],ym[2]=t.attributes.position.data[n+2],e=Math.max(e,Kn(t.bounds.center,ym));t.bounds.radius=Math.sqrt(e)},E3=t=>{t.bounds.initiated||V7(t),L7(t)};var q7=1,R7=1,Cn=t=>{let e={id:q7++,vao:C_(),vaoNeedsUpdate:!0,attributes:t,drawRangeStart:0,drawRangeCount:0,attrRange:0,instancedCount:0,isInstanced:!1,bounds:{min:[0,0,0],max:[0,0,0],center:[0,0,0],scale:[0,0,0],radius:1/0,initiated:!1}};return Kh(e,e.attributes),e},hs=(t,e)=>{et.boundBuffer!==e.id&&($.bindBuffer(e.target,e.buffer),et.boundBuffer=e.id),e.bufferLen<e.data.length?(e.bufferLen=e.data.length,$.bufferData(e.target,e.data,e.bufferMode,0,e.data.length)):$.bufferSubData(e.target,0,e.data,0,e.data.length)},km=(t,e,n)=>{et.boundBuffer!==e.id&&($.bindBuffer(e.target,e.buffer),et.boundBuffer=e.id);let s=n*e.size;e.bufferLen<s?(e.bufferLen=s,$.bufferData(e.target,e.data,e.bufferMode,0,s)):$.bufferSubData(e.target,0,e.data,0,s)},z7=(t,e,n)=>{n.id=R7++,n.size=n.size||1,n.type=n.type||(n.data.constructor===Float32Array?$.FLOAT:n.data.constructor===Uint16Array?$.UNSIGNED_SHORT:$.UNSIGNED_INT),n.target=e==="index"?$.ELEMENT_ARRAY_BUFFER:$.ARRAY_BUFFER,n.normalize=n.normalize||!1,n.count=n.data.length/n.size,n.divisor=n.instanced?typeof n.instanced=="number"?n.instanced:1:0,n.bufferMode=n.bufferMode||$.STATIC_DRAW,n.bufferLen=0,n.buffer||(n.buffer=$.createBuffer()),hs(t,n)},B7=(t,e,n)=>{if(t.attributes[e]=n,n.divisor){if(t.isInstanced=!0,t.instancedCount&&t.instancedCount!==n.count*n.divisor)return t.instancedCount=Math.min(t.instancedCount,n.count*n.divisor);t.instancedCount=n.count*n.divisor}else e==="index"?t.drawRangeCount=n.count:t.attributes.index||(t.drawRangeCount=Math.max(t.drawRangeCount,n.count))},Kh=(t,e)=>{Ap(null),et.currentGeometry=-1;for(let n in e)e[n].id===void 0&&z7(t,n,e[n]),B7(t,n,e[n]);t.attributes.position&&E3(t)},I3=(t,e,n)=>{t.attrRange=n,t.drawRangeStart=e,t.drawRangeCount=n},xm=(t,e)=>{t.instancedCount=e},U7=(t,e)=>{Ap(t.vao);for(let n=0;n<e.attributeLocations.length;++n){let s=e.attributeLocations[n];if(!t.attributes[s])continue;let i=t.attributes[s];if($.bindBuffer($.ARRAY_BUFFER,i.buffer),et.boundBuffer=i.id,i.size>4){let o=i.size/4,r=o*4,l=r*4;for(let a=0;a<o;++a)$.vertexAttribPointer(n+a,o,$.FLOAT,!1,l,r*a),$.enableVertexAttribArray(n+a),ua(n+a,1)}else $.vertexAttribPointer(n,i.size,i.type,i.normalize,0,0),$.enableVertexAttribArray(n),ua(n,i.divisor)}t.attributes.index&&$.bindBuffer($.ELEMENT_ARRAY_BUFFER,t.attributes.index.buffer),t.vaoNeedsUpdate=!1},Ma=(t,e)=>{et.currentGeometry!==t.id&&(t.vaoNeedsUpdate&&U7(t,e),Ap(t.vao),et.currentGeometry=t.id)},Fa=(t,e,n)=>{Ma(t,e),t.isInstanced?t.attributes.index?F_(n,t.drawRangeCount,t.attributes.index.type,t.drawRangeStart,t.instancedCount):M_(n,t.drawRangeStart,t.drawRangeCount,t.instancedCount):t.attributes.index?$.drawElements(n,t.drawRangeCount,t.attributes.index.type,t.drawRangeStart):$.drawArrays(n,t.drawRangeStart,t.drawRangeCount)};var O7=1,cn=({vertex:t,fragment:e,uniforms:n={},instanced:s=[],active:i=!0,transparent:o=!1,cullFace:r=$.BACK,frontFace:l=$.CCW,depthTest:a=!0,depthWrite:c=!0,depthFunc:f=$.LESS,globalUniforms:u={},attributeLocations:p})=>{let g={id:O7++,program:$.createProgram(),active:i,transparent:o,cullFace:r,frontFace:l,depthTest:a,depthWrite:c,depthFunc:f,blendFunc:{},blendEquation:{},uniforms:n,autoUniforms:[],uniformArray:[],samplerNames:[],samplerTexUnits:[],samplerTexArray:[],samplerTextures:[],globalUniforms:u,instancedAttributes:s,attributeLocations:p};g.transparent&&!g.blendFunc.src&&Ff(g,$.SRC_ALPHA,$.ONE_MINUS_SRC_ALPHA);let v=V3(t,$.VERTEX_SHADER),_=V3(e,$.FRAGMENT_SHADER);for(let b=0;b<p.length;++b)$.bindAttribLocation(g.program,b,p[b]);return $.attachShader(g.program,v),$.attachShader(g.program,_),$.linkProgram(g.program),$.deleteShader(v),$.deleteShader(_),g},L3=(t,e)=>{$.useProgram(t.program),et.currentProgram=t.id;let n=$.getProgramParameter(t.program,$.ACTIVE_UNIFORMS),s=0,i=2;for(let o=0;o<n;o++){let r=$.getActiveUniform(t.program,o),l=$.getUniformLocation(t.program,r.name);if(l===null)continue;let a=r.name.match(/(\w+)/g)[0],c=r.type,f=c===35678||c===35682||c===36289,u=c===35682;if(f){let p=r.size,g=[];for(let v=0;v<p;++v){let _=u?s++:i++;g.push(_),t.samplerNames.push(a),t.samplerTexUnits.push(_),t.samplerTexArray.push(p===1?-1:v)}p===1?$.uniform1i(l,g[0]):$.uniform1iv(l,g)}else{e[a]?t.uniforms[a]||(t.uniforms[a]=e[a]):t.uniforms[a]||(j7.has(a)||t.autoUniforms.push(a),t.uniforms[a]={value:void 0});let p={name:a,location:l,type:c,data:t.uniforms[a],fun:N7(c,t.uniforms[a].value)};t.uniformArray.push(p)}}},q3=(t,e)=>{for(let n=0;n<e.length;++n){let s=e[n],i=$.getUniformBlockIndex(t.program,s.name);i!==$.INVALID_INDEX&&s.index>=0&&$.uniformBlockBinding(t.program,i,s.index)}},Ca=(t,e)=>{e||($.useProgram(t.program),et.currentProgram=t.id),Sa(t),t1(t.uniformArray),Mf(t),Aa(t)},Vn=(t,e,n,s)=>{let i=s.samplerNames.indexOf(t);i>=0?s.samplerTextures[i+n]=e:console.log("unknown texture type",t,s)},Sa=t=>{for(let e=0;e<t.samplerNames.length;++e){let n=t.samplerNames[e],s=t.samplerTexArray[e];t.globalUniforms[n]&&t.globalUniforms[n].value&&(s<0?t.samplerTextures[e]=t.globalUniforms[n].value:t.samplerTextures[e]=t.globalUniforms[n].value[s])}},wm=(t,e)=>{for(let n=0;n<e.samplerNames.length;++n){let s=e.samplerNames[n],i=e.samplerTexArray[n];t[s]&&(i<0?e.samplerTextures[n]=t[s]:e.samplerTextures[n]=t[s][i])}},Mf=t=>{for(let e=0;e<t.samplerTexUnits.length;++e){let n=t.samplerTexUnits[e],s=t.samplerTextures[e];s&&et.textureUnits[n]!==s.id&&(jc(n),$.bindTexture(s.target,s.texture),et.textureUnits[n]=s.id)}},Ff=(t,e,n,s,i)=>{t.blendFunc.src=e,t.blendFunc.dst=n,t.blendFunc.srcAlpha=s,t.blendFunc.dstAlpha=i,e&&(t.transparent=!0)},e1={},V3=(t,e)=>{if(e1[t]!==void 0)return e1[t];let n=e1[t]=$.createShader(e);return $.shaderSource(n,t),$.compileShader(n),n},Aa=t=>{t.depthTest?Nc($.DEPTH_TEST):Pp($.DEPTH_TEST),t.cullFace?Nc($.CULL_FACE):Pp($.CULL_FACE),t.blendFunc.src?Nc($.BLEND):Pp($.BLEND),t.cullFace&&E_(t.cullFace),D_(t.frontFace),Ph(t.depthWrite),I_(t.depthFunc),t.blendFunc.src&&P_(t.blendFunc.src,t.blendFunc.dst,t.blendFunc.srcAlpha,t.blendFunc.dstAlpha),t.blendEquation.modeRGB&&T_(t.blendEquation.modeRGB,t.blendEquation.modeAlpha)},t1=t=>{for(let e=0;e<t.length;++e){let n=t[e];$7($,n.fun,n.location,n.data.value)}};var $7=(t,e,n,s)=>{switch(e){case 12:return t.uniformMatrix4fv(n,!1,s);case 9:return t.uniform4fv(n,s);case 8:return t.uniform3fv(n,s);case 5:return t.uniform1f(n,s);case 0:return t.uniform1i(n,s);case 1:return t.uniform1iv(n,s);case 2:return t.uniform2iv(n,s);case 3:return t.uniform3iv(n,s);case 4:return t.uniform4iv(n,s);case 6:return t.uniform1fv(n,s);case 7:return t.uniform2fv(n,s);case 10:return t.uniformMatrix2fv(n,!1,s);case 11:return t.uniformMatrix3fv(n,!1,s)}},N7=(t,e)=>{switch(t){case 5126:return Array.isArray(e)?6:5;case 35664:return 7;case 35665:return 8;case 35666:return 9;case 35670:case 5124:case 35678:case 35682:case 36289:case 35680:return Array.isArray(e)?1:0;case 35671:case 35667:return 2;case 35672:case 35668:return 3;case 35673:case 35669:return 4;case 35674:return 10;case 35675:return 11;case 35676:return 12}};var j7=new Set(["projectionViewMatrix","shadowPVMatrix","modelMatrix","viewMatrix","projectionMatrix","cameraPosition"]);var W7=0,qs=(t,e,n,s=on(),i=0)=>({id:W7++,uniformData:{},transform:s,geometry:t,program:e,shadowProgram:i,mode:n}),Ks=(t,e)=>{e.uniforms.modelMatrix&&(e.uniforms.modelMatrix.value=t.transform.worldMatrix);for(let n=0;n<e.autoUniforms.length;++n){let s=e.autoUniforms[n];e.uniforms[s].value=t.uniformData[s]}wm(t.uniformData,e),Ca(e,et.currentProgram===e.id),Fa(t.geometry,e,t.mode)};function R3(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function z3(t,e,n){switch(t){case B3:return(e+3>>2)*(n+3>>2)*8;case U3:return(e+3>>2)*(n+3>>2)*16;default:return 0}}var B3=33777,U3=33778,G7=131072,H7=31,Y7=1,X7=2,Q7=3,Z7=4,J7=7,K7=21,e9=R3("DXT1"),t9=R3("DXT3");function O3(t){let e=new Int32Array(t,0,H7),n=e[K7],s;switch(n){case e9:s=B3;break;case t9:s=U3;break;default:console.error("Unsupported texture"+n)}let i=1;e[X7]&G7&&(i=Math.max(1,e[J7]));let o=e[Z7],r=e[Q7],l=e[Y7]+4;return{data:new Uint8Array(t,l),width:o,height:r,levels:i,internalFormat:s}}var s9=1,Xo=function({image:t,buffer:e,target:n=$.TEXTURE_2D,type:s=$.UNSIGNED_BYTE,format:i=$.RGBA,internalFormat:o=i,wrapS:r=$.CLAMP_TO_EDGE,wrapT:l=$.CLAMP_TO_EDGE,generateMipmaps:a=!0,minFilter:c=a?$.LINEAR_MIPMAP_LINEAR:$.LINEAR,magFilter:f=$.LINEAR,flipY:u=!0,width:p,depth:g=0,height:v=p,compareMode:_=$.NONE,compareFunc:b=$.LEQUAL,anisotropy:y=1}){return{id:s9++,image:t,buffer:e,target:n,type:s,format:i,internalFormat:o,minFilter:c,magFilter:f,wrapS:r,wrapT:l,generateMipmaps:a,flipY:u,width:p,height:v,depth:g,compareMode:_,texture:$.createTexture(),anisotropy:Math.min(Math.max(1,y),et.maxAnisotropy),needsUpdate:!0,state:{flipY:!1,minFilter:$.NEAREST_MIPMAP_LINEAR,magFilter:$.LINEAR,wrapS:$.REPEAT,wrapT:$.REPEAT,compareMode:$.NONE,anisotropy:1,image:void 0}}},$3=t=>{et.textureUnits[et.activeTextureUnit]!==t.id&&($.bindTexture(t.target,t.texture),et.textureUnits[et.activeTextureUnit]=t.id)},ei=(t,e=0)=>{let n=!(t.image===t.state.image&&!t.needsUpdate);if((n||et.textureUnits[e]!==t.id)&&(jc(e),$3(t)),!!n){if(t.needsUpdate=!1,t.flipY!==et.flipY&&($.pixelStorei($.UNPACK_FLIP_Y_WEBGL,t.flipY),et.flipY=t.flipY),t.minFilter!==t.state.minFilter&&($.texParameteri(t.target,$.TEXTURE_MIN_FILTER,t.minFilter),t.state.minFilter=t.minFilter),t.magFilter!==t.state.magFilter&&($.texParameteri(t.target,$.TEXTURE_MAG_FILTER,t.magFilter),t.state.magFilter=t.magFilter),t.wrapS!==t.state.wrapS&&($.texParameteri(t.target,$.TEXTURE_WRAP_S,t.wrapS),t.state.wrapS=t.wrapS),t.wrapT!==t.state.wrapT&&($.texParameteri(t.target,$.TEXTURE_WRAP_T,t.wrapT),t.state.wrapT=t.wrapT),t.anisotropy!==t.state.anisotropy&&($.texParameterf(t.target,Ah.TEXTURE_MAX_ANISOTROPY_EXT,t.anisotropy),t.state.anisotropy=t.anisotropy),t.compareMode!==t.state.compareMode&&($.texParameteri(t.target,$.TEXTURE_COMPARE_MODE,t.compareMode),t.state.compareMode=t.compareMode),t.image)t.image.width&&(t.width=t.image.width,t.height=t.image.height),$.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.type,t.image),t.generateMipmaps&&$.generateMipmap(t.target);else if(t.buffer){let s=0,i=t.height,o=t.width,r=t.buffer.data;for(let l=0;l<t.buffer.levels;++l){let a=z3(t.internalFormat,i,i),c=new Uint8Array(r.buffer,r.byteOffset+s,a);$.compressedTexImage2D(t.target,l,t.internalFormat,o,i,0,c),o=o>>1,i=i>>1,s+=a}}else t.target!==$.TEXTURE_2D_ARRAY?$.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.type,null):$.texImage3D(t.target,0,t.internalFormat,t.width,t.height,t.depth,0,t.format,t.type,null);t.state.image=t.image}},Mm=(t,e)=>{t.anisotropy=Math.min(Math.max(1,e),et.maxAnisotropy),t.needsUpdate=!0};var N3=(t,e,n,s,i)=>{jc(0),$3(t),t.flipY!==et.flipY&&($.pixelStorei($.UNPACK_FLIP_Y_WEBGL,t.flipY),et.flipY=t.flipY),$.texSubImage3D(t.target,0,0,0,e,n,s,1,t.format,t.type,i),t.generateMipmaps&&$.generateMipmap(t.target)};var ko=(t=$.canvas.width,e=$.canvas.height,n=1,s=!1,i=$.NONE,o=$.CLAMP_TO_EDGE,r=$.CLAMP_TO_EDGE)=>{let l=$.LINEAR,a=$.LINEAR,c={width:t,height:e,target:$.FRAMEBUFFER,buffer:$.createFramebuffer()};if($.bindFramebuffer(c.target,c.buffer),n&&(c.colorTexture=Xo({width:t,height:e,wrapS:o,wrapT:r,minFilter:l,magFilter:a,flipY:!1,generateMipmaps:!1,internalFormat:$.RGBA8}),ei(c.colorTexture),$.framebufferTexture2D(c.target,$.COLOR_ATTACHMENT0,$.TEXTURE_2D,c.colorTexture.texture,0)),s){let f=i===$.COMPARE_REF_TO_TEXTURE?$.LINEAR:$.NEAREST;c.depthTexture=Xo({width:t,height:e,wrapS:o,wrapT:r,minFilter:f,magFilter:f,flipY:!1,format:$.DEPTH_COMPONENT,internalFormat:$.DEPTH_COMPONENT24,type:$.UNSIGNED_INT,generateMipmaps:!1,compareMode:i}),ei(c.depthTexture),$.framebufferTexture2D(c.target,$.DEPTH_ATTACHMENT,$.TEXTURE_2D,c.depthTexture.texture,0)}return $.bindFramebuffer(c.target,null),c},Cf=(t,e,n)=>{t.colorTexture.width=e,t.colorTexture.height=n,t.colorTexture.needsUpdate=!0,ei(t.colorTexture),t.depthTexture&&(t.depthTexture.width=e,t.depthTexture.height=n,t.depthTexture.needsUpdate=!0,ei(t.depthTexture)),t.width=e,t.height=n};var Ot=async(t,e,n)=>{let s=await fetch(t,{method:e!==void 0?"POST":"GET",body:e?JSON.stringify(e):void 0});return s.status===500?n(await s.text()):await s.json()};var Cm=new Map,Sf=new Map,Sm=new Map,s1=new Map,i1=new Map,Pa=new Map,_i=new Map,o1=new Map,Ta=new Map,Ea=new Map,Af=new Map,Da=new Map,Pf=new Map,r1=new Map,l1=new Map,a1=new Map,c1=new Map,i9=new Map,f1=new Map,Tf=new Map,Ef=[],Df=[],u1=new Map,Am=new Map;var n1=t=>{t.classes.forEach(e=>Am.set(e.id,e)),t.files.forEach(e=>Pa.set(e.id,e)),t.particles.forEach(e=>Cm.set(e.id,e)),t.effects.forEach(e=>Sf.set(e.id,e)),t.sounds.forEach(e=>Sm.set(e.id,e)),t.soundsets.forEach(e=>s1.set(e.id,e)),t.soundsetSteps.forEach(e=>i1.set(e.id,e)),t.meshes.forEach(e=>_i.set(e.id,e)),t.ribbons.forEach(e=>o1.set(e.id,e)),t.areas.forEach(e=>Af.set(e.id,e)),t.terrains.forEach(e=>Ta.set(e.id,e)),t.foliages.forEach(e=>Ea.set(e.id,e)),t.environments.forEach(e=>Da.set(e.id,e)),t.animations.forEach(e=>Pf.set(e.id,e)),t.skins.forEach(e=>r1.set(e.id,e)),t.skeletons.forEach(e=>l1.set(e.id,e)),t.creatures.forEach(e=>a1.set(e.id,e)),t.creaturesMonster.forEach(e=>c1.set(e.id,e)),t.creaturesConjurer.forEach(e=>i9.set(e.id,e)),t.creaturesTrader.forEach(e=>f1.set(e.id,e)),t.traderShopItems.forEach(e=>Tf.set(e.id,e)),t.worlds.forEach(e=>{u1.set(e.id,e)});for(let e=0;e<t.filesExt.length;++e)Df.push(t.filesExt[e]);for(let e=0;e<t.minimap.length;++e)Ef.push(t.minimap[e])};var Pm=(t,e)=>{if(!Pa.has(t))return console.log("unknown file id: "+t),"";let n=Pa.get(t);return`${t}.${e||Df[n.ext]}`};var On="webp",Gn="webp",p1="webp",m1=()=>new Promise((t,e)=>{let n=new Image;n.onerror=()=>{e()},n.onload=()=>{On=Gn=p1="avif",t(!0)},n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="}).catch(()=>{console.log("Avif not supported",navigator.userAgent)});m1();var o9=127,r9=254,d1=2**15-1,l9=2**16-1,h1=2**32-1;var W3=t=>{let e=_a.modelformat.decode(t),n=d1/(h1/e.sx),s=d1/(h1/e.sy),i=d1/(h1/e.sz);for(let o=0;o<e.position.length;o+=3)e.position[o+0]=e.position[o+0]/n,e.position[o+1]=e.position[o+1]/s,e.position[o+2]=e.position[o+2]/i;for(let o=0;o<e.uv.length;++o)e.uv[o]/=l9;for(let o=0;o<e.color.length;++o)e.color[o]/=r9;for(let o=0,r=e.normal.length;o<r;o++)e.normal[o]=e.normal[o]/o9;return e};var g1=async(t,e,n,s,i,o=3)=>{switch(e.split(".").pop()){case"jpg":case"png":case"avif":case"webp":{let r=new Image;r.onload=()=>{n[e]=s(r),i(n[e],t+e),r.onload=void 0},r.src=t+e+"?v=8593107";break}default:{fetch(t+e+"?v=8593107").then(r=>{if(!r.ok)throw new Error;r.arrayBuffer().then(async l=>{n[e]=await s(l),i(n[e],t+e)})}).catch(r=>{console.log(e+" fetch failed"),o>1&&g1(t,e,n,s,i,--o)});break}}};var tl={},c9=(t,e)=>{for(let n=0,s=tl[e].length;n<s;++n)tl[e][n](...t);tl[e]=void 0},If=async(t,e,n,s,i)=>{n[e]?i(...n[e]):tl[t+e]?tl[t+e].push(i):(tl[t+e]=[],tl[t+e].push(i),g1(t,e,n,s,c9))},f9=t=>{let e=W3(new Uint8Array(t));return[{index:{type:5125,data:new Uint32Array(e.index)},position:{size:3,data:new Float32Array(e.position)},normal:{size:3,data:new Float32Array(e.normal)},uv:{size:2,data:new Float32Array(e.uv)},color:{size:4,data:new Float32Array(e.color)}},e]},u9={},Qo=(t,e)=>{If("data/assets/",Pm(t),u9,f9,e)};var Vf,xo,G3=()=>{Vf=qs(Cn({position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),0,$.TRIANGLES),fetch("/data/items/atlas.json?v=8593107").then(async t=>{xo=await t.json();for(let e in xo)e!="s"&&(xo[e]=xo[e].map(n=>n/xo.s))})},p9=t=>{let e=Xo({image:t,wrapS:$.REPEAT,wrapT:$.REPEAT,minFilter:$.LINEAR_MIPMAP_LINEAR,anisotropy:2**le.anisotropy});return ei(e),[e]},m9=t=>{let e=O3(t),n=Xo({buffer:e,minFilter:$.LINEAR_MIPMAP_LINEAR,wrapS:$.REPEAT,wrapT:$.REPEAT,width:e.width,height:e.height,anisotropy:2**le.anisotropy,format:e.internalFormat,internalFormat:e.internalFormat});return ei(n),[n]},v1={},gs=(t,e)=>{Pa.has(t)||console.log("unknown file id: "+t);let n=Pa.get(t);n.ext===3&&S_?If("data/assets/",`${t}.${Df[n.ext]}`,v1,m9,e):If("data/assets/",`${t}.${p1||Df[n.ext]}`,v1,p9,e)},H3,Y3=(t,e,n)=>{H3=e,If("data/assets/",t+".ogg",v1,d9,n)},d9=async t=>[await H3.decodeAudioData(t)];var Zt=(t,e)=>t+Math.random()*(e-t),_1=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;var X3=t=>b1(t,Math.random()),b1=(t,e)=>t[Math.floor(e*t.length)];var gn,Jo=[],Zo=new Map,wo=new Map,Tm=new Set,J3=t=>{gn&&(h9(),g9(t),Tm.clear())},h9=()=>{K3(gn.listener,gt.transform.worldMatrix),bp(vo,Gt.worldMatrix),Y(bt,0,0,1),wh(bt,bt,vo),Y(yn,0,1,0),wh(yn,yn,vo),gn.listener.setOrientation(bt[0],bt[1],bt[2],yn[0],yn[1],yn[2])},g9=t=>{let e=0,n=0;for(;n<Jo.length;){let s=Jo[n];s.ended?v9(s.id):(Jo[e]=s,e++),++n}Jo.length=e},K3=(t,e)=>{t.setPosition(e[12],e[13],e[14])},ey=function(){this.ended=!0},v9=t=>{wo.set(t,Math.max(0,wo.get(t)-1))},Q3=(t,e)=>{if(!wo.has(t))wo.set(t,1);else{if(wo.get(t)>=e)return!1;wo.set(t,wo.get(t)+1)}return!0},y1={},ty=(t,e)=>{let n=X3(t);y1[n]!==void 0?e.buffer=y1[n]:Y3(n,gn,s=>{y1[n]=s,e.buffer=s})},Xi=(t,e,n,s,i)=>{if(gn===void 0||gn.state=="suspended"||Tm.has(t))return;if(n===0){if(Jo.length>35||(Y(bt,e.worldMatrix[12],e.worldMatrix[13],e.worldMatrix[14]),1/((wo.get(t)||0)+10+Dr(Gt.position,bt))*1e3/(Jo.length+20)**1.2<.4)||!Q3(t,2))return}else if(n===1&&!Q3(t,5))return;let o=Sm.get(t);if(!o){console.log("unknown sound id:"+t);return}Tm.add(t);let r=gn.createBufferSource();r.id=t,r.loop=s,r.playbackRate.value=i,ty(o.files,r);let l=Zo.get(n).in;return r.panner=gn.createPanner(),r.panner.distanceModel="exponential",r.panner.refDistance=o.distance,r.panner.rolloffFactor=1,K3(r.panner,e.worldMatrix),r.connect(r.panner),r.panner.connect(l),r.start(0,0),r.onended=ey,Jo.push(r),r},ny=t=>{gn=new(window.AudioContext||window.webkitAudioContext),["ambience","music"].forEach((o,r)=>{let l=gn.createGain();l.connect(gn.destination),Zo.set(2+r,{gain:l,in:l}),Wi[o+"Volume"].subscribe(a=>{Zo.get(2+r).gain.gain.value=(a/100)**2})});let e=gn.createDynamicsCompressor(),n=gn.createGain();e.threshold.value=0,e.knee.value=0,e.ratio.value=15,e.attack.value=.005,e.release.value=.05,e.connect(n),n.connect(gn.destination);let s=gn.createGain();s.gain.value=2,s.connect(e);let i=gn.createGain();i.gain.value=.4,i.connect(e),Zo.set(1,{gain:n,in:s}),Zo.set(0,{gain:n,in:i}),Or.subscribe(o=>{Zo.get(1).gain.gain.value=(o/150)**2}),$r.subscribe(o=>{Zo.get(0).in.gain.value=o/100}),r_.set(!0),document.removeEventListener("click",ny)},Z3=!1,sy=(t,e)=>{Z3||(Z3=!0,document.addEventListener("click",ny))},iy=t=>{Jo.length=0,wo.clear(),Tm.clear()},k1=(t,e,n,s)=>{if(gn===void 0||gn.state=="suspended")return;let i=Sm.get(t);if(!i)return;let o=gn.createBufferSource();o.id=t,o.loop=n,ty(i.files,o);let r=Zo.get(e).in;return s&&(o.gain=gn.createGain(),o.gain.connect(r),r=o.gain),o.connect(r),o.start(0,n?Zt(0,1):0),o.onended=ey,o},Mt=(t,e)=>{let n=k1(t,1,!1,e!==void 0);e!==void 0&&n&&(n.gain.gain.value=e)},oy=(t,e)=>k1(t,e,!0,!0),ry=(t,e)=>k1(t,e,!1,!0);var sl=Math.PI*2,b9=Math.PI*3,Ia=t=>t<0||t>sl?(t%sl+sl)%sl:t,Lf=(t,e,n,s)=>(Xt(yn,s,n),Xt(bt,e,n),Xs(yn,yn,bt),Zn(t,yn));var Em=(t,e,n,s,i,o)=>{let r=[n[0]-t[0],n[1]-t[1],n[2]-t[2]],l=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],a=[s-t[0],i-t[1],o-t[2]],c=mn(r,r),f=mn(r,l),u=mn(r,a),p=mn(l,l),g=mn(l,a),v=1/(c*p-f*f),_=(p*u-f*g)*v,b=(c*g-f*u)*v;return _>=0&&b>=0&&_+b<=1},Dm=(t,e)=>{let n=Math.sin(t[1]),s=Math.cos(t[1]);t[0]=e[2]*s+e[0]*n,t[2]=e[2]*n-e[0]*s},il=t=>{let e=Math.atan2(t[0],t[1]);return e<0&&(e+=2*Math.PI),e},Im=t=>{let e=Math.atan2(t[0],t[2]);return e<0&&(e+=2*Math.PI),e},ol=(t,e)=>(e-t+b9)%sl-Math.PI;var Vm=(t,e,n)=>{Xt(bt,n,t);let s=mn(bt,e);return sn(bt,t,e,s)},ly=(t,e,n,s,i,o,r,l,a)=>{let c=-(r*s+l*i+a*o);return r*t+l*e+a*n+c},x1=(t,e,n,s,i,o,r,l,a)=>{let c=-(r*s+l*i+a*o);return e+(r*t+a*n+c)/l},ay=(t,e,n,s,i,o,r,l,a)=>{let c=(r*(s-t)+l*(i-e)+a*(o-n))/(r*r+l*l+a*a),f=t+c*r,u=n+c*a;return Math.sqrt(Math.pow(f-t,2)+Math.pow(u-n,2))};var Va=(t,e)=>(t[0]=e[0],t[1]=e[2],t);var Lm=(t,e,n)=>(t[0]=e[0]+n[0],t[2]=e[2]+n[1],t);var cy=(t,e,n,s,i)=>{Xt(bt,e,s);let o=2*mn(n,bt),r=mn(bt,bt)-i*i,l=o*o-4*r;l>0?(t[0]=(-o-Math.sqrt(l))/2,t[1]=(-o+Math.sqrt(l))/2):t[0]=t[1]=-1},La=(t,e,n,s,i,o)=>{Xt(bt,e,t),Xt(yn,n,t),Xs(Qr,bt,yn);let r=mn(i,Qr),l;if(r>0){if(!o)return 1/0;l=1}else if(r<0)l=-1,r=-r;else return 1/0;Xt(mi,s,t);let a=l*mn(i,Xs(yn,mi,yn));if(a<0)return 1/0;let c=l*mn(i,Xs(bt,bt,mi));if(c<0||a+c>r)return 1/0;let f=-l*mn(mi,Qr);return f<0?1/0:f/r};var fy=(t,e,n,s)=>{let i=0,o=0,r=1;e.length>2&&(i=s.findIndex(f=>f>=n),i<0&&(i=s.length),o=i>0?s[i-1]:0,r=i>=s.length?1:s[i]);let l=e[i],a=e[i+1],c=(n-o)/(r-o);return ca(t,l,a,c),i};var qm=[0,0],qa=[0,0],ts=[0,0],nt={},uy={},y9=function(t){return this.press.push(t),t},k9=function(t){return this.release.push(t),t},fn=(t,e)=>(e.press||(e.down=!1,e.onPress=y9,e.onRelease=k9,e.press=[],e.release=[],e.mappings=[],e.store||(e.store=K(!1))),t=Array.isArray(t)?t:[t],t.forEach(n=>{uy[n]=e,e.mappings.push(n)}),o_.set(nt),e),py=()=>{fn(le.kbForward,nt.fwd={}),fn(le.kbLeft,nt.left={}),fn(le.kbBack,nt.back={}),fn(le.kbRight,nt.right={}),fn(le.kbNextTarget,nt.nextTarget={}),fn(le.kbNextParty,nt.nextParty={}),fn(le.kbUntarget,nt.untarget={}),fn(" ",nt.jump={}),fn(le.kbAltForward,nt.fwd),fn(le.kbAltBack,nt.back),fn(le.kbTurnRight,nt.turnright={}),fn(le.kbTurnLeft,nt.turnleft={}),fn("shift",nt.shift={}),fn("m0",nt.lmb={}),fn("m2",nt.rmb={}),fn("control",nt.ctrl={}),fn("alt",nt.alt={}),fn(le.kbMap,nt.map={}),fn(le.kbSkills,nt.skills={}).onPress(()=>{fo.update(t=>!t),Mt(89)}),fn(le.kbCharacter,nt.char={}).onPress(()=>{mo.update(t=>!t),Mt(89)}),fn(le.kbInventory,nt.inventory={}).onPress(()=>{co.update(t=>!t),Mt(90)}),fn(le.kbClan,nt.clan={}).onPress(()=>{uo.update(t=>!t),Mt(90)}),fn(le.kbPvp,nt.pvp={}).onPress(()=>{po.update(t=>!t),Mt(90)}),fn(le.kbParty,nt.party={}).onPress(()=>{Zs.update(t=>!t),Mt(90)}),document.addEventListener("wheel",F9,{passive:!0}),document.addEventListener("keydown",S9,!1),document.addEventListener("keyup",A9,!1),document.addEventListener("contextmenu",C9,!1),document.addEventListener("mousedown",w9,!1),document.addEventListener("mouseup",M9,!1),document.addEventListener("mousemove",x9,!1)},my=t=>{w1&&(w1=!1,le.pointerlock&&!(nt.lmb.down||nt.rmb.down)&&(document.exitPointerLock(),Rm=!1))},qf=0,x9=t=>{if(ds(qm,2*(t.x*le.resolutionScale/Fs.width)-1,2*(1-t.y*le.resolutionScale/Fs.height)-1),ds(qa,~~(t.x*le.resolutionScale),~~(t.y*le.resolutionScale)),nt.rmb.down||nt.lmb.down){let e=vt(t.movementX,-100,100),n=vt(t.movementY,-100,100);ts[1]=vt(ts[1]+n*.0028*(le.invertMouseY?-le.mouseSensitivity:le.mouseSensitivity),-Math.PI/2,Math.PI/2),ts[0]=Ia(ts[0]-e*.005*(le.invertMouseX?-le.mouseSensitivity:le.mouseSensitivity)),qf+=Math.abs(n)+Math.abs(e)}},dy=!1;En.subscribe(t=>{dy=t!==void 0});var Rm=!1,w1=!1,w9=t=>{(t.target==Fs||t.target.id=="chat")&&(le.pointerlock&&(Rm=!0,Fs.requestPointerLock()),Ko("m"+t.button,!0),dy&&En.update(e=>{e&&e.discard&&e.discard()}))},M9=t=>{Ko("m"+t.button,!1),qf=0,w1=!0},F9=t=>{t.target==Fs&&qp.update(e=>vt(e+(t.deltaY>0?1:-1),2,18))},C9=t=>{t.preventDefault()},Ko=(t,e,n)=>{let s=uy[t];return s!==void 0?(s.down!=e&&(s.down=e,s[e?"press":"release"].forEach(i=>{i(n)}),s.store.set(s.down)),n&&n.preventDefault(),!0):!1},S9=t=>{if(!hy(t))return;let e=t.key.toLowerCase();t.ctrlKey&&Ko("ctrl+"+e,!0,t)||t.shiftKey&&Ko("shift+"+e,!0,t)||Ko(e,!0,t)},A9=t=>{if(!hy(t))return;let e=t.key.toLowerCase();Ko("ctrl+"+e,!1),Ko("shift+"+e,!1),Ko(e,!1)},hy=t=>{let e=t.target.tagName.toLowerCase();return e!=="input"&&e!=="textarea"};var gy=(t,e,n,s)=>{window.gtag&&window.gtag("event",t,{event_category:e,event_label:n,value:s})};var M1=t=>1+(t-1)*.23,vy=t=>{let e=0;return t.forEach(n=>{e+=n.stats.getStat(18)}),T9(e,t.length)},T9=(t,e)=>t/Math.max(1,e)/100;var E9=[300,600,1e3,1400,2e3,2600,3200,4e3,4800,5700,6700,7700,8800,1e4,11500,13e3,14600,16400,18400,20400,22600,25100,27700,30400,33400,36600,4e4,43700,47500,51500,56200,61e3,66600,72500,78500,85300,92400,99700,107300,115700,124400,133400,142700,152300,162100],er=t=>E9[vt(t,1,45)-1];var zm=class{constructor(e){this.id=e.id,this.cd=e.cd!==void 0?e.cd:0,this.costMp=e.costMp,this.targetMode=e.targetMode||0,this.onCast=e.onCast,this.onPermanent=e.onPermanent,this.range=e.range||0,this.graceRange=this.range+Math.min(this.range*.2,10),this.auto=e.auto||!1,this.engineOnly=e.engineOnly||!1,this.minlevel=e.minlevel||0,this.castLen=e.castLen||0,this.gcd=e.gcd!==void 0?e.gcd:1.5,this.custom=e.custom,this.skilllevels=Math.min(5,e.skilllevels||5),this.goldValue=e.goldValue||0,this.noReward=e.noReward||!1,this.outOfCombat=e.outOfCombat||!1,this.pvpBoundsAdd=e.pvpBoundsAdd||0,this.ignoreGcd=e.ignoreGcd||!1,this.ignoreIncapacitated=e.ignoreIncapacitated||!1,this.disablingBuffs=e.disablingBuffs||[],this.hasteAffected=e.hasteAffected!==void 0?e.hasteAffected:!0,this.skillpoints=e.skillpoints!==void 0?e.skillpoints:1,this.envCast=e.envCast||0}can(e,n,s=0,i){if(this.outOfCombat&&!e.stats.combatTimer.done(I.time))return 11;if(this.costMp!==void 0&&e.stats.getResource(7)<this.costMp(n))return 5;if(this.targetMode!==1){let o=I.getEntityById(s),r=o===void 0||o.stats.alive,l=o===void 0?-1:e.hostility(o);if(this.targetMode===4096){if((l===-1||l===0)&&r)return 3;if(!e.canCombatInteract(o))return 13}else if(this.targetMode===256){if((l===-1||l!==0)&&r)return 4}else if(this.targetMode===16)o=e;else if(this.targetMode===17&&(o===void 0||o===e))return 3;if(o!==void 0&&!o.stats.alive)return 10;if(o&&s!==e.id&&o!==e&&this.range>0&&!e.combatRangeCheck(o,i?this.range:this.graceRange))return 6}return this.disablingBuffs.some(o=>e.buffs.hasAnyWithTag(o))?12:0}};var we=class extends zm{constructor(e){super(e),this.fx=e.fx||{},this.autoSkillbar=e.autoSkillBar!==!1}};var Ra=(t,e,n,s)=>({id:t,minlevel:n,engineOnly:!1,cd:0,custom:s,autoSkillBar:!1,onPermanent:()=>e}),As=(t,e,n,s,i,o,r,l)=>({id:t,targetMode:16,minlevel:n,cd:i,costMp:r,fx:l,onCast:(a,c,f)=>({id:e,mode:4,stacks:1,duration:s,caster:a.id,target:a.id,aoe:{faction:!0,limit:o,circleRadius:30,circleHeight:20},level:c})}),Bm=(t,e,n,s,i,o,r,l=5,a)=>({id:t,targetMode:256,range:30,minlevel:n,cd:i,castLen:s,costMp:r,fx:a,onCast:(c,f,u)=>({id:e,mode:l,stacks:1,caster:c.id,target:u,refresh:!0,duration:o,level:f})}),rl=(t,e,n=0,s=!0,i,o=!1,r=!1,l)=>({id:t,targetMode:16,cd:e,gcd:0,hasteAffected:!1,ignoreIncapacitated:o,ignoreGcd:!0,castLen:n,engineOnly:!0,outOfCombat:i,fx:l});var _y=new we(Ra(21,77,1));var by=new we({id:2,targetMode:16,minlevel:5,cd:30,gcd:0,costMp:t=>3+t*5,fx:{animCast:6},custom:[[t=>7+t*12," heal on block"]],onCast:(t,e,n)=>({id:59,mode:4,stacks:1,duration:9,caster:t.id,target:t.id,level:e})});var yy=t=>.7+t*.2,D9=t=>yy(t)+30/(250/20),ky=new we({id:33,targetMode:17,skilllevels:1,minlevel:11,cd:15,range:30,disablingBuffs:[4],costMp:t=>12,custom:[[yy,"s stunned at min range"],[D9,"s stunned at max range"]],onCast:(t,e,n)=>{}});var xy=new we(As(20,76,15,300,150,20,t=>t*8,{animCast:6}));var wy=new we({id:18,cd:0,minlevel:8,autoSkillBar:!1,fx:{},onPermanent:()=>73});var My=new we({id:3,targetMode:1,minlevel:3,cd:6,costMp:t=>2+t*2,fx:{animCast:5,effectDirImpact:9},onCast:(t,e,n)=>({id:3,mode:0,caster:t.id,dmg:t.stats.getDamageRoll()*(1+e*.18),type:1,aoe:{faction:!1,circleRadius:2+5*t.size}})});var Fy=new we({id:17,targetMode:16,minlevel:13,cd:50,gcd:0,costMp:t=>t*8,fx:{animCast:6},onCast:(t,e,n)=>({id:72,mode:4,stacks:1,duration:17,caster:t.id,target:t.id,level:e})});var Cy=new we({id:50,targetMode:1,minlevel:7,cd:30,costMp:t=>t*4,fx:{animCast:40},custom:[[t=>20+t*5," % missing + 100 HP recovered"]],onCast:(t,e,n)=>({id:121,mode:4,stacks:1,caster:t.id,buffdata:[0],sendBuffData:!0,duration:1+e,level:e,aoe:{faction:!1,circleRadius:8}})});var I9=t=>t*8,Sy=new we({id:1,targetMode:4096,minlevel:1,cd:1,range:2,custom:[[I9,"% chance to daze target for 3 seconds"]],costMp:t=>1+t,fx:{animImpact:3},onCast:(t,e,n)=>{let s=5+t.stats.getDamageRoll()*(.38+e*.39);return{id:1,mode:0,caster:t.id,target:n,dmg:s,type:1}}});var Ay=t=>1e4+t*1e4,V9=(t,e)=>{if(e.type===1){let n=0;e.aggroValues.forEach((s,i)=>{s>n&&(n=s)}),e.aggroValues.set(t.caster,n+Ay(t.level)),e.buffs.buffs.has(122)&&add({id:125,mode:5,stacks:t.level,caster:e.id,target:t.caster,refresh:!0,duration:60,level:1})}},Py=new we({id:34,targetMode:1,minlevel:6,cd:15,costMp:t=>t*4,fx:{animCast:7},custom:[[Ay," aggro generation"]],onCast:(t,e,n)=>({custom:V9,id:89,mode:4,stacks:1,caster:t.id,duration:2+e,level:e,aoe:{faction:!1,circleRadius:10}})});var Ty=new we({id:41,targetMode:16,minlevel:25,cd:30,skilllevels:1,gcd:0,costMp:t=>3+t*5,onCast:(t,e,n)=>{}});var Ey=new we(As(19,75,18,300,150,20,t=>t*8,{animCast:6}));var Dy=new we({id:46,targetMode:1,range:30,minlevel:4,cd:30,castLen:0,costMp:t=>10+t*3,fx:{effectTarget:106},onCast:(t,e,n)=>{}});var Iy=new we(As(22,78,17,300,120,20,t=>5+t*10,{animCast:6}));var Vy=new we(Bm(24,80,15,1.5,0,300,t=>2+t*3,4,{animCast:9,animChannel:18}));var Ly=new we({id:52,targetMode:1,minlevel:7,envCast:7,cd:6,range:25,costMp:t=>t*2,fx:{effectMissile:107,effectTarget:111},onCast:(t,e,n,s,i,o)=>{}});var qy=new we({id:14,targetMode:1,minlevel:3,cd:25,costMp:t=>t*4,fx:{animCast:31},onCast:(t,e,n)=>({id:69,mode:4,stacks:1,caster:t.id,duration:5.5+e*.5,level:e,aoe:{faction:!1,circleRadius:8}})});var Ry=new we({id:16,targetMode:16,minlevel:13,cd:45,gcd:0,fx:{animCast:6},onCast:(t,e,n)=>({id:71,mode:4,stacks:1,duration:12,caster:t.id,target:t.id,level:e})});var zy=new we({id:53,targetMode:16,minlevel:9,cd:80,gcd:0,ignoreIncapacitated:!0,ignoreGcd:!0,costMp:t=>t*5,onCast:(t,e,n)=>({id:117,mode:4,duration:5,stacks:1,caster:t.id,target:t.id,level:e})});var By=new we({id:4,targetMode:4096,range:30,minlevel:1,cd:0,castLen:1.5,custom:[[t=>100+t*10,"% frozen buff multiplier"]],costMp:t=>1+t*2,fx:{animCast:29,effectDirImpact:30,animChannel:30,effectMissile:27},onCast:(t,e,n)=>({id:4,mode:6,speed:25,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.3+e*.32),type:1}),onPermanent:()=>100});var Uy=t=>2+t*2,Oy=new we({id:23,targetMode:16,minlevel:5,cd:60,gcd:0,costMp:t=>t*5,custom:[[Uy," attacks blocked"]],fx:{animCast:6},onCast:(t,e,n)=>({id:79,mode:4,stacks:Uy(e),duration:60,caster:t.id,target:t.id,level:e})});var $y=new we({id:15,targetMode:1,range:30,minlevel:8,cd:8,castLen:1.5,costMp:t=>5+t*5,fx:{animCast:29,animChannel:30,effectDirImpact:31,effectMissile:28},onCast:(t,e,n)=>({id:15,mode:6,speed:10,timeout:2.5,caster:t.id,rot:t.rot,dmg:10+t.stats.getDamageRoll()*(.56+e*.6),type:1,aoe:{circleRadius:4+e*.5,faction:!1,onlyOnce:[]}})});var Ny=new we({id:51,targetMode:4096,range:30,minlevel:4,cd:10,castLen:2.8,costMp:t=>1+t*2,fx:{animCast:37,effectDirImpact:119,animChannel:30,effectMissile:118},onCast:(t,e,n)=>({id:51,mode:6,speed:20,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(1.25+e*1.33),type:1,noBlock:!0})});var L9=()=>12,jy=new we({id:32,targetMode:1,skilllevels:1,minlevel:5,gcd:.7,cd:12,disablingBuffs:[4],costMp:t=>t*4,fx:{animCast:32},custom:[[L9,"m distance"]],onCast:(t,e,n)=>{}});var Wy=new we({id:37,targetMode:4096,range:30,minlevel:15,cd:40,castLen:2.3,costMp:t=>5+t*5,fx:{animCast:9,effectImpact:50,animChannel:16},onCast:(t,e,n)=>({id:91,mode:4,stacks:1,caster:t.id,target:n,duration:2.4+e*1,level:e})});var Gy=new we(As(28,84,12,15,60,15,t=>1+t*3,{animCast:6}));var Hy=new we({id:12,targetMode:4096,range:30-5,minlevel:1,castLen:0,cd:3,costMp:t=>Math.round(1+t*4.5),fx:{animCast:10,effectMissile:48},onCast:(t,e,n)=>({id:12,mode:6,dmg:5+t.stats.getDamageRoll()*(.03+e*.13),type:1,speed:15,caster:t.id,target:n,level:e})});var Yy=new we({id:30,targetMode:1,range:30,minlevel:18,cd:60,castLen:2.3,costMp:t=>10+t*8,fx:{effectImpact:70,animCast:14,animChannel:15,effectMissile:69},onCast:(t,e,n)=>({id:30,mode:6,speed:0,timeout:30,caster:t.id,rot:t.rot,interval:new kt(0,2),heal:t.stats.getDamageRoll()*(.08+e*.05),type:1,aoe:{circleRadius:30,circleHeight:30,faction:!0,limit:15}})});var Xy=new we(As(13,68,6,15,90,15,void 0,{animCast:22}));var Qy=new we({id:6,targetMode:256,range:30,minlevel:8,cd:0,castLen:1.7,costMp:t=>4+t*4,fx:{animCast:11,effectImpact:36,animChannel:12},onCast:(t,e,n)=>({id:6,mode:2,caster:t.id,target:n,heal:15+t.stats.getDamageRoll()*(.2+e*.18)})});var Zy=new we({id:47,targetMode:256,range:30,minlevel:14,cd:12,castLen:0,costMp:t=>4+t*4,fx:{animCast:9,effectTarget:112},custom:[[t=>t," effects removed"]],onCast:(t,e,n)=>{let s=0;return{id:47,mode:2,caster:t.id,target:n,heal:(1+s)*(15+t.stats.getDamageRoll()*.25)}}});var q9=t=>1+t*2,R9=t=>1+t*2,Jy=new we(Ra(43,106,3,[[q9,"% haste per stack"],[R9," jumps"]]));var Ky=new we(Bm(7,60,3,0,0,12,t=>2+t*2,5,{animCast:9}));var z9=t=>Math.round(t*1.3),B9=t=>t*2,ek=new we({id:42,targetMode:1,minlevel:8,cd:8,castLen:0,range:30-5,custom:[[z9," mana gained per soul"],[B9," extended Decay duration"]],costMp:t=>1+t*3,fx:{animCast:13,effectImpact:46},onCast:(t,e,n)=>({id:42,mode:1,caster:t.id,target:0,type:1,dmg:4+t.stats.getDamageRoll()*(.25+e*.4),level:e})});var tk=new we({id:105,engineOnly:!0,cd:0,fx:{effectImpact:47,effectMissile:45}});var nk=new we({id:36,targetMode:16,minlevel:10,cd:30,gcd:0,costMp:t=>8+t*2,onCast:(t,e,n)=>({id:90,mode:4,stacks:1,duration:5+e*5,caster:t.id,target:t.id,level:e})});var sk=new we({id:35,targetMode:1,skilllevels:1,minlevel:5,cd:120,skillpoints:0,castLen:5,outOfCombat:!0,hasteAffected:!1,pvpBoundsAdd:5,costMp:t=>20+t*5,fx:{animCast:20,animChannel:21},onCast:(t,e,n)=>{}});var ik=new we({id:49,targetMode:4096,range:30,minlevel:13,cd:25,costMp:t=>1+t*1,fx:{animCast:38,effectMissile:123,animChannel:28},onCast:(t,e,n)=>({id:49,buffid:119,mode:7,speed:60,caster:t.id,level:e,stacks:1,duration:1+e*2,refresh:!0,target:n})});var ok=new we({id:54,targetMode:4096,range:30,minlevel:8,cd:10,castLen:2.8,costMp:t=>8+t*3,fx:{animCast:39,effectDirImpact:121,animChannel:25,effectMissile:114},onCast:(t,e,n)=>({id:54,mode:6,speed:60,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(1.25+e*1.33),type:1,noBlock:!0})});var rk=new we(Ra(26,82,15));var U9=t=>3+t*5,lk=new we({id:11,targetMode:16,minlevel:7,cd:50,gcd:0,fx:{animCast:6},custom:[[U9,"% of max mp recovered"]],onCast:(t,e,n)=>({id:66,mode:4,stacks:1,duration:17,caster:t.id,target:t.id,level:e})});var ak=new we(As(27,83,12,10,80,20,t=>5+t*7,{animCast:6}));var ck=new we({id:29,cd:0,minlevel:9,autoSkillBar:!1,onPermanent:()=>85});var fk=new we({id:9,targetMode:4096,range:30,minlevel:3,cd:6,castLen:1.7,costMp:t=>2+t*3,fx:{animCast:24,effectDirImpact:85,animChannel:25,effectMissile:33},onCast:(t,e,n)=>({id:9,mode:6,speed:120,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.53+e*.45),type:1})});var uk=new we({id:10,targetMode:16,minlevel:5,cd:0,autoSkillBar:!1,skillpoints:0,onPermanent:()=>65});var pk=new we({id:38,targetMode:16,minlevel:5,skilllevels:1,cd:10,gcd:0,disablingBuffs:[4],costMp:t=>6,fx:{animCast:23},onCast:(t,e,n)=>!0});var mk=new we({id:31,targetMode:4096,range:30,minlevel:1,cd:0,castLen:1.5,costMp:t=>1+t*1,fx:{animCast:27,effectDirImpact:84,effectMissile:34,animChannel:28},onCast:(t,e,n)=>({id:31,mode:6,speed:60,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.24+e*.25),type:1})});var dk=new we(As(25,81,18,300,120,20,t=>5+t*5,{animCast:6}));var hk=new we({id:48,targetMode:4096,range:30,minlevel:6,cd:20,ignoreGcd:!0,costMp:t=>1+t*1,fx:{animCast:36,effectDirImpact:115,effectMissile:113,animChannel:28},custom:[[t=>t*120," HP recovered"]],onCast:(t,e,n)=>({id:48,mode:6,speed:80,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.28+e*.28),type:1})});var gk=new we({id:106,engineOnly:!0,cd:0,fx:{effectMissile:116,effectImpact:117}});var vk=new we({id:45,targetMode:1,range:30,minlevel:4,cd:25,castLen:0,costMp:t=>18+t*3,fx:{effectDirImpact:11,effectMissile:103},onCast:(t,e,n)=>{}});var O9={medalValue:1e3,goldValue:5e4,buyElo:1600,quality:90,level:45,gs:30,uniqueEquipped:!0},F1=[{id:0,custom:["Use: Removes all movement limiting effects."],useCd:60,incap:!0,animCast:45},{id:1,custom:["Use: Protects you against 30% of incoming damage for 10 seconds."],useCd:60,animCast:6,incap:!1},{id:2,custom:["Use: Increases your damage by 20% for 10 seconds."],useCd:80,incap:!1,animCast:6},{id:3,custom:["Use: Speeds up your movement by 45 for 8 seconds."],useCd:50,incap:!1,animCast:6},{id:4,custom:["Use: Attacks made against you grant 20 MP (up to 200) for 20 seconds."],useCd:60,incap:!1,animCast:6}],_k=t=>{F1.forEach((e,n)=>{t["charm"+e.id]={...O9,...e,type:"charm",tier:e.id,useSkill:107+n}})};var bk=new we(rl(100,30,0,!0,!0,!1,!1,{animCast:17})),yk=new we(rl(101,1.5,0,!0,!1,!1,!1)),kk=new we(rl(104,1.5,0,!1,!1,!1,!1,{animCast:6})),xk=new we(rl(103,1.5,3,!0,!1,!1,!1,{animCast:19,animChannel:18})),wk=new we(rl(102,1.5,1.5,!1,!0,!1,!1,{animCast:9,animChannel:18})),Mk=F1.map((t,e)=>new we(rl(107+e,t.useCd,0,!1,!1,t.incap,!0,{animCast:t.animCast}))).reduce((t,e)=>({...t,["charm"+e.id]:e}),{});var Fk=new we({id:5,targetMode:4096,range:30,engineOnly:!0,auto:!0,cd:t=>100/t.stats.getStat(17),fx:{animCast:26,effectDirImpact:11,effectMissile:32},onCast:(t,e,n)=>({id:5,mode:6,speed:15*3,caster:t.id,target:n,dmg:t.stats.getDamageRoll(),type:0})});var Ck=new we({id:56,targetMode:1,range:50,cd:10,engineOnly:!0,castLen:2,fx:{animCast:41,animChannel:42}});var Sk=new we({id:44,targetMode:1,range:50,minlevel:3,cd:5,engineOnly:!0,castLen:1.5,costMp:t=>t*4});var Ak=new we({id:55,targetMode:1,range:50,minlevel:3,cd:20,engineOnly:!0,castLen:2,fx:{effectMissile:131,animCast:43,animChannel:42}});var Pk=new we({id:58,targetMode:1,range:10,cd:2,engineOnly:!0,hasteAffected:!1,castLen:30,fx:{animCast:9,animChannel:44}});var Tk=new we({id:57,targetMode:4096,engineOnly:!0,fx:{effectMissile:153,effectDirImpact:154}});var Ek=new we({id:0,targetMode:4096,engineOnly:!0,auto:!0,range:2,cd:t=>100/t.stats.getStat(17),fx:{animImpact:4},onCast:(t,e,n)=>({id:0,mode:0,caster:t.id,target:n,dmg:t.stats.getDamageRoll(),type:0})});var Dk=new we({id:39,engineOnly:!1,skilllevels:1,minlevel:30,cd:0,goldValue:25e3,skillpoints:0,noReward:!0,autoSkillBar:!1});var Ik=new we({id:40,targetMode:1,engineOnly:!0,cd:300,castLen:5,outOfCombat:!0,hasteAffected:!1,costMp:t=>20+t*5,fx:{animCast:9,animChannel:8},onCast:(t,e,n)=>{}});var Vk=new we({id:8,engineOnly:!0,cd:0,onPermanent:t=>t.class+61});var $9={...Mk,hellspawn_missile:Tk,conjurer_obeliskport:Pk,boss_bigaoe:Ck,boss_puddledot:Ak,recall:Ik,arrow:Fk,melee:Ek,potion:bk,book:yk,specialization:Vk,mount:Dk,activatemount:wk,container:xk,boss_flamepits:Sk,useGeneric:kk},N9={relentlessCry:Cy,whirlwind:Dy,temper:Ty,taunt:Py,charge:ky,warcry:Ey,courage:xy,armorreinforcement:_y,enrage:Fy,slash:Sy,blockBuff:by,crescentStrike:My,crescentBleed:wy},j9={frostcall:Ly,iceblock:zy,shatterfrost:Ny,teleport:jy,enchantment:Vy,arcticaura:Iy,iceshield:Oy,hypothermic:Ry,frostnova:qy,icebolt:By,icicle:$y},W9={vampiricarrowReturn:gk,boneshot:ok,blindingshot:ik,vampiricarrow:hk,volley:vk,snipe:pk,poisonarrows:ck,temporaldilation:dk,pathfinding:ak,preciseShot:fk,serpentArrows:uk,invigorate:lk,swiftshot:mk,cranialpunctures:rk},G9={mimirscleanse:Zy,soulharvestReturn:tk,plaguespreader:Jy,soulharvest:ek,agonize:Wy,caninehowl:Gy,mana:Xy,mend:Qy,revitalize:Ky,decay:Hy,healingtotem:Yy,summon:sk,spiritanimal:nk},Pt=new Map;[N9,j9,W9,G9,$9].forEach((t,e)=>{for(let n in t)e<=3&&(t[n].class=e),Pt.set(t[n].id,t[n])});Pt.set(60,new we({id:60,engineOnly:!0}));var qk=[1600,1800,2e3,2200],Lk=qk.length,za=t=>{for(let e=0;e<Lk;++e)if(qk[e]>t)return e;return Math.max(0,Lk)},H9=10,Y9=30,X9=240,Q9=-.0015,Z9=930,J9=100,Rf=t=>H9+Math.round(Math.max(t/Y9,X9*(1-Math.exp(Q9*(t-Z9)))-J9));var K9=[0,0,1,1,2,3],C1=(t,e)=>"book"+(e!==void 0?e:"")+K9[t%5],zf=(t,e,n,s)=>`https://raw.githubusercontent.com/2f147f0487a9fe5b/cb2e2197348007b8/main/${t}/${t=="book"?C1(e,n):t+e}_q${s}.webp?v=8593107`,Bf=t=>`/data/ui/skills/${t}.${Gn}?v=8593107`,Rk=t=>`/data/ui/slotbg/${t}.${On}?v=8593107`,zk=(t,e,n)=>`/data/world/${t}/map/${e}/${n}.${Gn}?v=8593107`,Qi=t=>`/data/ui/classes/${t}.${On}?v=8593107`,S1=t=>`/data/ui/factions/${t}.${On}?v=8593107`,Bk=t=>`/data/ui/elo/${za(t)}.svg?v=8593107`,Uk="/data/ui/currency/medal.svg?v=8593107",Ba="/data/ui/currency/prestige.svg?v=8593107",tr="/data/ui/currency/fame.svg?v=8593107",Ok=t=>`/data/ui/rank/rank${t}.svg?v=8593107`;var $k=t=>{Pt.forEach(e=>{if(!e.engineOnly)for(let n=0;n<e.skilllevels;++n){let s=e.id*5+n;t[`book${s}`]={type:"book",tier:s,level:e.minlevel+n*8,skillid:e.id,skilllevel:n,class:e.class,noReward:e.noReward||!1,goldValue:e.goldValue||(e.minlevel+n*5<5?4:0),quality:Math.round(Math.min(99,30+70*(n/5))),art:C1(s,e.class),useSkill:101}}})};var eT=[{id:0,storeValue:300,quality:90,level:1,custom:["Contains random mount (account bound) of rare or epic quality"],bindOnPurchase:1,useSkill:103},{id:1,storeValue:900,quality:90,level:1,custom:["Adds one month of Elixir to your account"],bindOnMerchant:1,useSkill:103},{id:2,storeValue:700,quality:90,level:1,bindOnMerchant:1,custom:["Used to upgrade rare pets, allowing them to pick up items."]}],Nk=t=>{eT.forEach(e=>{t["box"+e.id]={...e,type:"box",tier:e.id,unsellable:!0}})};var Rs={hammer:{sound:119,rot:1},bow:{sound:120,rot:1},staff:{sound:120,rot:1},sword:{sound:119,rot:1},armlet:{sound:121},armor:{sound:122},bag:{sound:121},boot:{sound:121},glove:{sound:121},ring:{sound:123},amulet:{sound:123},quiver:{sound:121,rot:1},shield:{sound:122},totem:{sound:122,rot:1},orb:{sound:122},rune:{sound:123,rot:0},misc:{sound:124,rot:1},book:{sound:121},mount:{sound:121,rot:0},pet:{sound:121,rot:0},box:{sound:125,rot:0},gold:{sound:126},charm:{sound:123}},Sn={hammer:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:3,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:15,min:.05,max:.1}},stackable:!1},bow:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:2,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}},stackable:!1},staff:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:1,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}},stackable:!1},sword:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:0,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:20,min:.05,max:.1}},stackable:!1},armlet:{baselvl:1,slot:[102],tiers:13,drop:1,weight:.3,stats:{6:{base:10,min:.5,max:.9},12:{base:7,min:.5,max:.8}},stackable:!1},armor:{baselvl:2,slot:[103],tiers:11,drop:1,weight:1,stats:{12:{base:10,min:1.4,max:2.8},6:{base:20,min:1,max:2}},stackable:!1},bag:{baselvl:5,slot:[104],tiers:5,drop:1,weight:.1,stats:{19:{base:1,min:.1,max:.3}},stackable:!1},boot:{baselvl:2,slot:[105],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.6,max:1.1},15:{base:3,min:.03,max:.1}},stackable:!1},glove:{baselvl:2,slot:[106],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.7,max:1.1},14:{base:1,min:.1,max:1.5}},stackable:!1},ring:{baselvl:5,slot:[107],tiers:12,drop:.8,weight:.2,stats:{6:{base:10,min:.5,max:.9},7:{base:5,min:.6,max:1}},stackable:!1},amulet:{baselvl:7,slot:[108],tiers:12,drop:.8,weight:.3,stats:{7:{base:10,min:1,max:1.8},9:{base:1,min:.2,max:.3}},stackable:!1},quiver:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:2,stats:{14:{base:5,min:.1,max:.9},9:{base:1,min:.1,max:.3}},stackable:!1},shield:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:0,stats:{12:{base:20,min:.8,max:1.4},13:{base:4,min:1,max:2.8}},stackable:!1},totem:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:3,stats:{12:{base:10,min:.4,max:.9},9:{base:1,min:.1,max:.4}},stackable:!1},orb:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:1,stats:{3:{base:10,min:.3,max:.7},9:{base:1,min:.1,max:.3}},stackable:!1},rune:{baselvl:1,tiers:11,drop:.8,quality:70,stackable:!0},misc:{drop:8,weight:.1,stackable:!0},book:{drop:1.6,weight:.5,stackable:!0},charm:{slot:[110,111],noupgrade:!0,undroppable:!0,drop:0,stackable:!1},mount:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},box:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},pet:{undroppable:!0,drop:0,stackable:!1},gold:{drop:24}},jk=Object.keys(Sn),Uf={6:{min:.2,max:.8,round:!0},7:{min:.2,max:.5,round:!0},8:{min:.1,max:1},9:{min:.1,max:.5},10:{min:.03,max:.13,round:!0},11:{min:.1,max:.2,round:!0},12:{min:.1,max:.8,round:!0},13:{min:.1,max:.4},14:{min:.1,max:.5},16:{min:.1,max:.4},2:{min:.08,max:.45,round:!0},0:{min:.08,max:.45,round:!0},3:{min:.08,max:.45,round:!0},4:{min:.08,max:.45,round:!0},1:{min:.08,max:.45,round:!0},5:{min:.08,max:.45,round:!0},18:{min:.01,max:.15,round:!0}},Wk=Object.keys(Uf),Of={6:4,7:3,8:5,9:4,10:1,11:1,12:5,13:5,14:5,15:.3,16:5,17:0,2:2,0:2,3:2,4:2,1:2,5:2,19:1,18:2};var Gk=t=>{for(let e in Sn)if(Sn[e].tiers){let n=Sn[e];for(let s=0;s<n.tiers;++s)nT({type:e,tier:s,stats:n.stats,level:tT(e,s),class:n.class,quality:n.quality},t)}},tT=(t,e)=>Sn[t].baselvl+Math.floor(e/Sn[t].tiers*100),nT=(t,e)=>{let n={level:t.level,type:t.type,tier:t.tier,stats:t.stats?new Map:void 0,class:t.class,quality:t.quality};t.stats&&Object.keys(t.stats).sort((s,i)=>s-i).forEach(s=>{let i=t.stats[s];n.stats.set(parseInt(s),{min:i.base+t.level*i.min,max:i.base+(t.level+10)*i.max})}),e[t.type+t.tier]=n};var sT=[250,100,500,200,1e3,300],Hk=t=>{for(let e=0;e<6;++e){let n=Math.floor(e/2),s=e%2==0;t["misc"+e]={type:"misc",tier:e,level:1+n*20,goldvalue:5**n,quality:15,custom:[""+sT[e]+(s?" HP recovered":" MP recovered")],useSkill:100}}};var iT=[{lvl:30,g:1e4,qual:50,store:0,skin:6},{lvl:30,g:2e4,qual:50,store:0,skin:21},{lvl:30,g:5e4,qual:80,store:300,skin:51},{lvl:30,g:5e4,qual:80,store:300,skin:52},{lvl:30,g:5e4,qual:95,store:1200,skin:22},{lvl:30,g:5e4,qual:90,store:600,skin:23},{lvl:30,g:5e4,qual:80,store:300,skin:24},{lvl:30,g:5e4,qual:90,store:600,skin:25},{lvl:30,g:5e4,qual:95,store:1200,skin:27},{lvl:30,g:5e4,qual:95,store:1200,skin:28},{lvl:30,g:5e4,qual:80,store:300,skin:30},{lvl:30,g:5e4,qual:95,store:1200,skin:31},{lvl:30,g:5e4,qual:95,store:1200,skin:32},{lvl:30,g:5e4,qual:85,store:400,skin:29},{lvl:30,g:5e4,qual:95,store:1200,skin:33},{lvl:30,g:5e4,qual:95,store:0,skin:94},{lvl:30,g:5e4,qual:95,store:0,skin:95},{lvl:30,g:5e4,qual:95,store:0,skin:96},{lvl:30,g:5e4,qual:95,store:0,skin:97},{lvl:30,g:5e4,qual:95,store:0,skin:98},{lvl:30,g:5e4,qual:95,store:0,skin:100},{lvl:30,g:5e4,qual:95,store:0,skin:101},{lvl:30,g:5e4,qual:95,store:0,skin:93},{lvl:30,g:5e4,qual:95,store:0,skin:91},{lvl:30,g:5e4,qual:95,store:0,skin:99},{lvl:30,g:5e4,qual:95,store:0,skin:92}].map(t=>({level:t.lvl,goldValue:t.g,storeValue:t.store,bindOnUse:1,bindOnMerchant:t.store>0?1:0,quality:t.qual,skin:t.skin})),Yk=t=>{iT.forEach((e,n)=>{t["mount"+n]={...e,type:"mount",tier:n,requiredSkill:39,useSkill:102}})};var oT=[1919,1920,1944,1945,1946,1947,1948,1960,1968,1969,1970,1971,1972,1973,1974,1975],Xk=t=>{oT.forEach((e,n)=>{t["pet"+n]={level:10,unsellable:!0,storeValue:e>1920?0:900,quality:90,bindOnUse:1,bindOnMerchant:e>=1968?0:1,type:"pet",tier:n,useSkill:104,skin:e}})};var rn={};Gk(rn);Hk(rn);$k(rn);Yk(rn);_k(rn);Xk(rn);Nk(rn);var sr=Object.values(rn);sr.forEach((t,e)=>t.id=e);var Ps=[{step:10,fun:()=>nt.fwd.down||nt.left.down||nt.right.down},{step:10,fun:()=>nt.lmb.down||nt.rmb.down,click:!0},{click:!0},{element:"ufplayer",click:!0},{},{element:"uftarget",click:!0},{element:"sk1"},{},{click:!0},{element:"expbar",click:!0},{},{element:"sysbag",step:100,fun:()=>le.inventoryOpen},{element:"bag2",click:!0},{click:!0},{element:"syschar",step:100,fun:()=>le.charpanelOpen},{element:"equipslots",click:!0},{fixed:()=>I.player.stats.getStat(22)>0?100:Math.round(I.player.exp/er(I.player.level)*100)},{element:"syschar",step:100,fun:()=>le.charpanelOpen},{element:"statpoints"},{step:100,fixed:()=>Math.round(I.player.exp/er(I.player.level)*100),fun:()=>I.player.level>3},{click:!0},{fixed:()=>Math.round(I.player.inventory.gold/32*100)},{fun:()=>le.traderWindow},{element:()=>{let t=0;return Tf.forEach(e=>{let n=rn[e.type+e.tier];n.type==="book"&&n.level===3&&n.class===I.player.class&&(t=e.id)}),"trader"+t}},{element:"bag0",click:!0},{element:"sysbook",step:100,fun:()=>le.skillmenuOpen},{element:"skilllist",click:!0},{element:"tutsetskillpoint",click:!0},{element:"tutapplyskills",click:!0},{element:"skillbar",click:!0},{click:!0},{click:!0},{click:!0},{click:!0,element:"partybtn"},{click:!0},{click:!0},{click:!0},{click:!0},{click:!0},{click:!0},{element:"chat"},{element:"chatinput"},{element:"syscog",step:100,click:!0,fun:()=>le.settingsOpen},{click:!0},{step:100,fun:()=>!le.settingsOpen},{click:!0},{click:!0},{gate:()=>I.player.level>=25,click:!0}],Qk=!1,rT=()=>{A1.reset(I.smoothtime),Qk||(Qk=!0,ji.subscribe(t=>{let e=Ps[t];e&&(e.gate===void 0||e.gate())?Bo.set(Zk(t)):Bo.set()}))},Zk=t=>(Mt(91),{...Ps[t],msg:C.ui.tutorial.msg[t],progress:0}),A1=new kt(0,.2),lT=()=>{let t=Ps[le.tutprogress];t&&A1.done(I.smoothtime)&&(A1.reset(I.smoothtime),(t.gate===void 0||t.gate())&&(t.gate&&t.gate()&&tn(le.tutprogress,void 0,1),t.fun&&t.fun()&&tn(le.tutprogress,t.step),t.fixed&&tn(le.tutprogress,void 0,t.fixed())))},tn=(t,e,n)=>(n||e>0)&&(t===-1||le.tutprogress===t)?(Bo.update(s=>s?(s.progress=Math.min(100,n||s.progress+e),s.complete=s.progress>=100,s.complete&&!s.closing&&(s.closing=!0,Mt(92),setTimeout(()=>{Bo.set(),setTimeout(()=>{ji.update(i=>(gy("tutorial","completestep",i,Math.round(performance.now()/1e3)),Ps[i+1]&&Ps[i+1].element&&typeof Ps[i+1].element!="string"&&(Ps[i+1].element=Ps[i+1].element()),i+1))},100)},1e3)),s):Zk(t)),!0):!1;var nn={partyleave:t=>({name:C.ui.party.leave,fun:()=>{xt("partyleave")}}),partyinvite:t=>({name:C.ui.party.invite,fun:()=>{xt("partyinvite",t)}}),partykick:t=>({name:C.ui.party.kick,fun:()=>{xt("partykick",t)}}),partygiveassistant:t=>({name:C.ui.party.giveAssistant,fun:()=>{xt("partysetrole",t+" 1")}}),partygiveleader:t=>({name:C.ui.party.giveLeader,fun:()=>{xt("partysetrole",t+" 2")}}),partyremoveassistant:t=>({name:C.ui.party.removeAssistant,fun:()=>{xt("partysetrole",t+" 0")}}),partycreate:t=>({name:C.ui.party.create,fun:()=>{xt("partycreate")}}),whisper:t=>({name:C.ui.chat.whisper,fun:()=>{Qs.set(t)}}),itemdrop:(...t)=>({name:C.ui.inventory.drop,fun:()=>T1(...t)}),itemsell:(...t)=>({name:C.ui.inventory.sell,fun:()=>$f(...t)}),itemstash:t=>({name:C.ui.stash.stash,fun:()=>{xt("itemstash",t)}}),itemmove:(t,e)=>({name:C.ui.inventory.equip,fun:()=>{tn(13,100),xt("itemmove",`${t} ${e}`)}}),itemsplithalf:t=>({name:C.ui.inventory.splithalf,fun:()=>{xt("itemsplithalf",t)}}),itemsplitone:t=>({name:C.ui.inventory.splitone,fun:()=>{xt("itemsplitone",t)}}),itemuse:(t,e,n,s)=>({name:C.ui.inventory.use,fun:()=>{hm(n<s,()=>Ss(Ft.clientPlayerSkill.packData({id:e,info:[t]})),"Bind Item","Using this item will bind it to you. Continue?")}}),itemcopyid:t=>({name:C.ui.inventory.copyitemid,fun:()=>{M3(t)}}),report:(t,e,n)=>({name:"Report",fun:s=>{ro.set({name:t,reason:0,messageId:e,info:n})}})},Jk=(t,e)=>{let n=[{name:e.name,css:"disabled"}];e.type===0&&(e.id==I.playerId?le.partyinfo.membercount>0?n.push(nn.partyleave()):n.push(nn.partycreate()):(e.faction==I.player.faction&&(en.has(e.name)?le.partyinfo.role>e.role&&(le.partyinfo.role==2&&n.push(nn.partykick(e.name)),e.role==0?n.push(nn.partygiveassistant(e.name)):e.role==1&&n.push(nn.partyremoveassistant(e.name)),le.partyinfo.role>1&&n.push(nn.partygiveleader(e.name))):n.push(nn.partyinvite(e.name))),n.push(nn.report(e.name)),n.push(nn.whisper(e.name)))),bn.set({x:t.pageX,y:t.pageY,opts:n})},Kk=(t,e,n,s,i,o,r,l)=>{hm(e>=le.itemProtectQuality||n>0,()=>{xt(t,`${s}`)},r,`${l} ${hn(i,o)}?`)},$f=(t,e,n,s,i)=>{Kk("itemtradersell",t,e,n,s,i,"Sell item","Really sell")},T1=(t,e,n,s,i)=>{Kk("itemdrop",t,e,n,s,i,"Drop item","Really drop")};function ex(t){let e,n;return{c(){e=h("img"),m(e,"class","icon svelte-erbdzy"),at(e.src,n="/data/ui/icons/gem.svg?v=8593107")||m(e,"src",n)},m(s,i){w(s,e,i)},d(s){s&&x(e)}}}function aT(t){let e,n,s,i,o,r,l,a,c=t[4]&&ex(t);return{c(){e=h("span"),c&&c.c(),n=h("img"),i=T(t[1]),o=$e(),r=h("span"),l=T(t[0]),m(n,"class","icon svelte-erbdzy"),at(n.src,s=Qi(t[2]))||m(n,"src",s),m(e,"class","textwhite"),m(r,"class",a="name textf"+t[3]+" svelte-erbdzy")},m(f,u){w(f,e,u),c&&c.m(e,null),d(e,n),d(e,i),d(e,o),w(f,r,u),d(r,l)},p(f,[u]){f[4]?c||(c=ex(f),c.c(),c.m(e,n)):c&&(c.d(1),c=null),u&4&&!at(n.src,s=Qi(f[2]))&&m(n,"src",s),u&2&&G(i,f[1]),u&1&&G(l,f[0]),u&8&&a!==(a="name textf"+f[3]+" svelte-erbdzy")&&m(r,"class",a)},i:ue,o:ue,d(f){f&&(x(e),x(r)),c&&c.d()}}}function cT(t,e,n){let{name:s}=e,{level:i}=e,{pclass:o}=e,{faction:r}=e,{sub:l=!1}=e;return t.$$set=a=>{"name"in a&&n(0,s=a.name),"level"in a&&n(1,i=a.level),"pclass"in a&&n(2,o=a.pclass),"faction"in a&&n(3,r=a.faction),"sub"in a&&n(4,l=a.sub)},[s,i,o,r,l]}var E1=class extends Fe{constructor(e){super(),Se(this,e,cT,aT,Oe,{name:0,level:1,pclass:2,faction:3,sub:4})}},zs=E1;var{Map:fT}=Cc;function tx(t,e,n){let s=t.slice();return s[31]=e[n],s}function nx(t,e,n){let s=t.slice();return s[34]=e[n],s}function sx(t,e,n){let s=t.slice();return s[37]=e[n],s}function ix(t){let e,n,s,i,o;n=new zs({props:{name:t[37].sender,pclass:t[37].cclass,level:t[37].level,faction:t[37].faction,sub:t[37].sub}});function r(...a){return t[14](t[37],...a)}function l(...a){return t[15](t[37],...a)}return{c(){e=h("span"),ne(n.$$.fragment),m(e,"class","sender svelte-16y0b84")},m(a,c){w(a,e,c),ee(n,e,null),s=!0,i||(o=[X(e,"contextmenu",r),X(e,"dblclick",l)],i=!0)},p(a,c){t=a;let f={};c[0]&32&&(f.name=t[37].sender),c[0]&32&&(f.pclass=t[37].cclass),c[0]&32&&(f.level=t[37].level),c[0]&32&&(f.faction=t[37].faction),c[0]&32&&(f.sub=t[37].sub),n.$set(f)},i(a){s||(P(n.$$.fragment,a),s=!0)},o(a){V(n.$$.fragment,a),s=!1},d(a){a&&x(e),te(n),i=!1,lt(o)}}}function uT(t){let e,n=t[37].text+"",s,i;return{c(){e=h("span"),s=T(n),m(e,"class",i="text"+t[37].channel+" svelte-16y0b84")},m(o,r){w(o,e,r),d(e,s)},p(o,r){r[0]&32&&n!==(n=o[37].text+"")&&G(s,n),r[0]&32&&i!==(i="text"+o[37].channel+" svelte-16y0b84")&&m(e,"class",i)},d(o){o&&x(e)}}}function pT(t){let e,n=t[37].text+"",s;return{c(){e=h("span"),m(e,"class",s="text"+t[37].channel+" svelte-16y0b84")},m(i,o){w(i,e,o),e.innerHTML=n},p(i,o){o[0]&32&&n!==(n=i[37].text+"")&&(e.innerHTML=n),o[0]&32&&s!==(s="text"+i[37].channel+" svelte-16y0b84")&&m(e,"class",s)},d(i){i&&x(e)}}}function ox(t,e){let n,s,i,o=e[37].time+"",r,l,a,c=e[37].channel+"",f,u,p,g,v=e[37].sender&&ix(e);function _(k,S){return k[37].interpolate?pT:uT}let b=_(e,[-1,-1]),y=b(e);return{key:t,first:null,c(){n=h("article"),s=h("div"),i=h("span"),r=T(o),l=h("span"),a=h("span"),f=T(c),u=$e(),v&&v.c(),y.c(),m(i,"class","time svelte-16y0b84"),m(a,"class","capitalize channel svelte-16y0b84"),m(l,"class",p="text"+e[37].channel+" content svelte-16y0b84"),m(s,"class","linewrap svelte-16y0b84"),m(n,"class","line svelte-16y0b84"),this.first=n},m(k,S){w(k,n,S),d(n,s),d(s,i),d(i,r),d(s,l),d(l,a),d(a,f),d(l,u),v&&v.m(l,null),y.m(s,null),g=!0},p(k,S){e=k,(!g||S[0]&32)&&o!==(o=e[37].time+"")&&G(r,o),(!g||S[0]&32)&&c!==(c=e[37].channel+"")&&G(f,c),e[37].sender?v?(v.p(e,S),S[0]&32&&P(v,1)):(v=ix(e),v.c(),P(v,1),v.m(l,null)):v&&(Ee(),V(v,1,1,()=>{v=null}),De()),(!g||S[0]&32&&p!==(p="text"+e[37].channel+" content svelte-16y0b84"))&&m(l,"class",p),b===(b=_(e,S))&&y?y.p(e,S):(y.d(1),y=b(e),y&&(y.c(),y.m(s,null)))},i(k){g||(P(v),g=!0)},o(k){V(v),g=!1},d(k){k&&x(n),v&&v.d(),y.d()}}}function rx(t){let e,n,s=t[34]+"",i,o,r,l;function a(...c){return t[17](t[34],...c)}return{c(){e=h("div"),n=T("/"),i=T(s),m(e,"class",o="choice textsystem text"+t[34]+" svelte-16y0b84")},m(c,f){w(c,e,f),d(e,n),d(e,i),r||(l=X(e,"click",a),r=!0)},p(c,f){t=c},d(c){c&&x(e),r=!1,l()}}}function lx(t){let e,n=t[31]+"",s,i,o,r;function l(...a){return t[21](t[31],...a)}return{c(){e=h("small"),s=T(n),m(e,"class",i="btn border black text"+(t[0].indexOf(t[31])<0?t[31]:"grey")+" svelte-16y0b84")},m(a,c){w(a,e,c),d(e,s),o||(r=X(e,"click",l),o=!0)},p(a,c){t=a,c[0]&1&&i!==(i="btn border black text"+(t[0].indexOf(t[31])<0?t[31]:"grey")+" svelte-16y0b84")&&m(e,"class",i)},d(a){a&&x(e),o=!1,r()}}}function mT(t){let e,n,s=[],i=new fT,o,r,l,a,c,f,u,p,g,v,_,b,y,k,S,A=me(t[5]),F=R=>R[37].key;for(let R=0;R<A.length;R+=1){let z=sx(t,A,R),q=F(z);i.set(q,s[R]=ox(q,z))}let M=me(Object.keys(Kr)),D=[];for(let R=0;R<M.length;R+=1)D[R]=rx(nx(t,M,R));let L=me(t[12]),E=[];for(let R=0;R<L.length;R+=1)E[R]=lx(tx(t,L,R));return{c(){e=h("div"),n=h("section");for(let R=0;R<s.length;R+=1)s[R].c();o=h("div"),r=h("section"),l=h("div"),a=h("div");for(let R=0;R<D.length;R+=1)D[R].c();c=h("div"),c.textContent="/[playername]",f=h("div"),u=T(t[6]),g=h("input"),_=h("div");for(let R=0;R<E.length;R+=1)E[R].c();m(n,"id","chat"),m(n,"class","panel frame scrollbar svelte-16y0b84"),m(c,"class","choice textwhisper"),m(a,"class","panel context commandlist textsystem svelte-16y0b84"),qe(a,"display",t[4]?"block":"none"),m(f,"class",p="command btn black text"+(bo[t[6]]?bo[t[6]].chat?t[6]:"system":"whisper")+" svelte-16y0b84"),m(g,"maxlength","480"),m(g,"type","text"),m(g,"class","svelte-16y0b84"),m(l,"id","chatinput"),m(l,"class","inputcontainer panel-black border black svelte-16y0b84"),m(r,"class",v="chatsection "+(t[3]?"":"hidden")+" svelte-16y0b84"),m(_,"class",b="channelselect "+(t[3]?"hidden":"")+" svelte-16y0b84"),m(o,"class","lowercontainer svelte-16y0b84"),m(e,"class","l-corner-ll container uiscaled svelte-16y0b84")},m(R,z){w(R,e,z),d(e,n);for(let q=0;q<s.length;q+=1)s[q]&&s[q].m(n,null);t[16](n),d(e,o),d(o,r),d(r,l),d(l,a);for(let q=0;q<D.length;q+=1)D[q]&&D[q].m(a,null);d(a,c),d(l,f),d(f,u),d(l,g),t[19](g),d(o,_);for(let q=0;q<E.length;q+=1)E[q]&&E[q].m(_,null);y=!0,k||(S=[X(f,"click",t[18]),X(g,"input",t[20])],k=!0)},p(R,z){if(z[0]&2336&&(A=me(R[5]),Ee(),s=us(s,z,F,1,R,A,i,n,Is,ox,null,sx),De()),z[0]&512){M=me(Object.keys(Kr));let q;for(q=0;q<M.length;q+=1){let j=nx(R,M,q);D[q]?D[q].p(j,z):(D[q]=rx(j),D[q].c(),D[q].m(a,c))}for(;q<D.length;q+=1)D[q].d(1);D.length=M.length}if((!y||z[0]&16)&&qe(a,"display",R[4]?"block":"none"),(!y||z[0]&64)&&G(u,R[6]),(!y||z[0]&64&&p!==(p="command btn black text"+(bo[R[6]]?bo[R[6]].chat?R[6]:"system":"whisper")+" svelte-16y0b84"))&&m(f,"class",p),(!y||z[0]&8&&v!==(v="chatsection "+(R[3]?"":"hidden")+" svelte-16y0b84"))&&m(r,"class",v),z[0]&5121){L=me(R[12]);let q;for(q=0;q<L.length;q+=1){let j=tx(R,L,q);E[q]?E[q].p(j,z):(E[q]=lx(j),E[q].c(),E[q].m(_,null))}for(;q<E.length;q+=1)E[q].d(1);E.length=L.length}(!y||z[0]&8&&b!==(b="channelselect "+(R[3]?"hidden":"")+" svelte-16y0b84"))&&m(_,"class",b)},i(R){if(!y){for(let z=0;z<A.length;z+=1)P(s[z]);y=!0}},o(R){for(let z=0;z<s.length;z+=1)V(s[z]);y=!1},d(R){R&&x(e);for(let z=0;z<s.length;z+=1)s[z].d();t[16](null),st(D,R),t[19](null),st(E,R),k=!1,lt(S)}}}function dT(t,e,n){let s,i,o,r;oe(t,of,re=>n(0,i=re)),oe(t,Ic,re=>n(13,o=re)),oe(t,Qs,re=>n(6,r=re));let l,a=!0;uh(()=>{a=l&&(l.offsetHeight+l.scrollTop>l.scrollHeight-20||l.scrollTop==0)}),Pc(()=>{a!==!1&&l.scrollTo(0,l.scrollHeight)});let c,f=!1,u=[],p=0,g=!1,v,_="faction",b=new Map([["c","clan"],["p","party"],["f","faction"]]),y=re=>{let ie=re.match(/^\/[a-zA-Z0-9]+ /g);if(ie){let ce=ie[0].substring(1,ie[0].length-1);if(ce==="r"||ce==="w")for(let ke=o.length-1;ke>0;--ke){let ge=o[ke];ge.channel=="from"&&(tt(Qs,r=ge.sender,r),ke=0)}else tt(Qs,r=b.has(ce)?b.get(ce):ce,r);n(2,c.value=re.substring(ie[0].length),c)}},k=re=>bo[re]&&bo[re].chat,S=re=>{if(re.keyCode===13)if(re.target==c){if(re.target.value!=""){tn(41,100);let ke=re.target.value.match(/^\/[a-zA-Z0-9]+/g);ke&&(tt(Qs,r=ke[0].substring(1),r),n(2,c.value="",c)),Kr[r]!==void 0&&Kr[r].client?Kr[r].fun(c.value):xt(r,c.value),n(2,c.value="",c),n(3,f=!1),c.blur()}else k(r)||xt(r,c.value),n(3,f=!1),c.blur();let ie=`/${r} `,ce=u.indexOf(ie);ce>=0&&u.splice(ce,1),u.length>10&&u.splice(0,1),u.push(ie),k(r)?_=r:(tt(Qs,r=_,r),p=u.length)}else document.activeElement==document.body&&F();else(re.keyCode===38||re.keyCode===40)&&u.length?re.target==c&&(p+=re.keyCode===38?-1:1,p=vt(p,0,u.length-1),y(u[p]),re.preventDefault()):re.keyCode===27&&(n(3,f=!1),c.blur())},A=re=>{c&&c.focus()},F=re=>{re&&tt(Qs,r=re,r),n(3,f=!0),gh().then(A),tn(40,100)},M=re=>{tt(Qs,r=re,r),n(4,g=!1),c&&c.focus()};Pn(()=>{document.addEventListener("keydown",S)}),Tn(()=>{document.removeEventListener("keydown",S),n(2,c=void 0)});let D=re=>{let ie=i.indexOf(re);of.update(ce=>(ie>=0?ce.splice(ie,1):ce.push(re),ce))},L=(re,ie)=>{let ce=[{name:ie.sender,css:"disabled"}];I.player.name!==ie.sender&&(ie.faction==I.player.faction&&!en.has(ie.sender)&&ce.push(nn.partyinvite(ie.sender)),ie.channel!=="to"&&ce.push(nn.report(ie.sender,ie.id,`Message: \u201C${ie.text.length>40?ie.text.substring(0,37)+"...":ie.text}\u201D`)),ce.push({name:"Whisper",fun:ke=>{F(ie.sender)}})),bn.set({x:re.pageX,y:re.pageY,opts:ce}),re.preventDefault()},E=["faction","party","clan","pvp","inv","yell"],R=(re,ie)=>L(ie,re),z=(re,ie)=>{F(re.sender)};function q(re){Nt[re?"unshift":"push"](()=>{l=re,n(1,l)})}let j=(re,ie)=>M(re),W=re=>n(4,g=!g);function N(re){Nt[re?"unshift":"push"](()=>{c=re,n(2,c)})}let O=re=>y(re.target.value),se=(re,ie)=>D(re);return t.$$.update=()=>{t.$$.dirty[0]&8193&&n(5,s=o.filter(re=>i.indexOf(re.channel)<0))},[i,l,c,f,g,s,r,y,F,M,D,L,E,o,R,z,q,j,W,N,O,se]}var D1=class extends Fe{constructor(e){super(),Se(this,e,dT,mT,Oe,{},null,[-1,-1])}},ax=D1;function cx(t){let e,n;return{c(){e=h("img"),at(e.src,n="/data/ui/icons/"+t[1]+".svg?v=8593107")||m(e,"src",n),m(e,"class","titleicon svgicon svelte-z8c6c2")},m(s,i){w(s,e,i)},p(s,i){i[0]&2&&!at(e.src,n="/data/ui/icons/"+s[1]+".svg?v=8593107")&&m(e,"src",n)},d(s){s&&x(e)}}}function fx(t){let e,n,s,i;return{c(){e=h("img"),at(e.src,n="/data/ui/icons/cross.svg?v=8593107")||m(e,"src",n),m(e,"class","btn black svgicon")},m(o,r){w(o,e,r),s||(i=X(e,"click",t[18]),s=!0)},p:ue,d(o){o&&x(e),s=!1,i()}}}function hT(t){let e,n,s,i,o,r,l,a,c,f,u,p,g,v,_,b=t[1]&&cx(t),y=t[2]&&fx(t),k=t[17].default,S=jl(k,t,t[16],null);return{c(){e=h("div"),n=h("div"),s=h("div"),b&&b.c(),i=h("div"),o=h("div"),r=T(t[0]),l=h("img"),y&&y.c(),f=h("div"),S&&S.c(),m(i,"class","textprimary title svelte-z8c6c2"),at(l.src,a="/data/ui/icons/cog.svg?v=8593107")||m(l,"src",a),m(l,"class","btn black svgicon marg-right"),m(s,"class","titleframe svelte-z8c6c2"),m(s,"style",c=t[6]?"":"cursor: pointer;"),m(f,"class",u="slot "+(t[3]?"scrollbar":"")+" svelte-z8c6c2"),m(n,"class","window panel-black svelte-z8c6c2"),m(e,"class","window-pos"),m(e,"style",p="z-index: "+t[4]+"; position: absolute; "+t[9]+": "+Math.round(t[7][0])+"px; "+t[10]+": "+Math.round(t[7][1])+"px;")},m(A,F){w(A,e,F),d(e,n),d(n,s),b&&b.m(s,null),d(s,i),d(i,o),d(o,r),d(s,l),y&&y.m(s,null),d(n,f),S&&S.m(f,null),t[19](n),g=!0,v||(_=[X(l,"click",t[12]),X(s,"mousedown",X2(t[11]))],v=!0)},p(A,F){A[1]?b?b.p(A,F):(b=cx(A),b.c(),b.m(s,i)):b&&(b.d(1),b=null),(!g||F[0]&1)&&G(r,A[0]),A[2]?y?y.p(A,F):(y=fx(A),y.c(),y.m(s,null)):y&&(y.d(1),y=null),(!g||F[0]&64&&c!==(c=A[6]?"":"cursor: pointer;"))&&m(s,"style",c),S&&S.p&&(!g||F[0]&65536)&&Gl(S,k,A,A[16],g?Wl(k,A[16],F,null):Hl(A[16]),null),(!g||F[0]&8&&u!==(u="slot "+(A[3]?"scrollbar":"")+" svelte-z8c6c2"))&&m(f,"class",u),(!g||F[0]&144&&p!==(p="z-index: "+A[4]+"; position: absolute; "+A[9]+": "+Math.round(A[7][0])+"px; "+A[10]+": "+Math.round(A[7][1])+"px;"))&&m(e,"style",p)},i(A){g||(P(S,A),g=!0)},o(A){V(S,A),g=!1},d(A){A&&x(e),b&&b.d(),y&&y.d(),S&&S.d(A),t[19](null),v=!1,lt(_)}}}function gT(t,e,n){let s;oe(t,cf,ie=>n(24,s=ie));let{$$slots:i={},$$scope:o}=e,r=Cr(),{title:l="Title"}=e,{icon:a=void 0}=e,{close:c=!0}=e,{scroll:f=!1}=e,{settings:u=[]}=e,{origin:p="right bottom"}=e,{defaultOffset:g=[3,3]}=e,{zindex:v=9}=e,_,b,y=p==="center"?"left":p.split(" ")[0],k=p==="center"?"top":p.split(" ")[1],S=y==="right"?1:-1,A=k==="bottom"?1:-1,F=0,M=0,D=!1,L=[...g],E=[0,0],R=ie=>{ie.button!==0||D||(E=[ie.clientX,ie.clientY],document.addEventListener("mousemove",z),document.addEventListener("mouseup",q))},z=ie=>{n(7,L=[L[0]-(ie.clientX-E[0])*S,L[1]-(ie.clientY-E[1])*A]),E=[ie.clientX,ie.clientY],j()},q=()=>{document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",q)},j=()=>{let[ie,ce,ke]=[_.offsetWidth,_.offsetHeight,30];n(7,L[0]=Math.max(-ie+ke,Math.min(L[0],F-ke)),L),n(7,L[1]=k==="bottom"?Math.max(-ce+ke,Math.min(L[1],M-ce)):Math.max(0,Math.min(L[1],M-ke)),L),W()};Pn(()=>{let ie=_.parentElement.parentElement;F=ie.clientWidth,M=ie.clientHeight;let ce=s.find(ke=>ke.id===l);ce?(n(7,L=ce.offset),n(6,D=ce.locked)):N(),b=new ResizeObserver(ke=>{let{width:ge,height:Ne}=ke[0].contentRect;p==="center"&&(n(7,L[0]+=(ge-F)/2,L),n(7,L[1]+=(Ne-M)/2,L)),F=ge,M=Ne,j()}),b.observe(_.parentElement.parentElement)}),Tn(()=>{document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",q),b.disconnect(),n(5,_=b=void 0)});let W=()=>{cf.update(ie=>{let ce=ie.find(ke=>ke.id===l);return ce||(ce={id:l},ie.push(ce)),ce.offset=L,ce.locked=D,ie})},N=()=>{if(p==="center"){let[ie,ce]=[_.offsetWidth,_.offsetHeight];n(7,L=[F/2-ie/2,M/2-ce/2])}else n(7,L=[...g])},O=ie=>{let ce=[{name:l,css:"disabled"},{name:(D?"Unlock":"Lock")+" Window",fun:()=>{n(6,D=!D),W()}},{name:"Reset Window",fun:()=>{N(),W()}},...u];bn.set({x:ie.pageX,y:ie.pageY,right:!0,opts:ce})},se=()=>r("close");function re(ie){Nt[ie?"unshift":"push"](()=>{_=ie,n(5,_)})}return t.$$set=ie=>{"title"in ie&&n(0,l=ie.title),"icon"in ie&&n(1,a=ie.icon),"close"in ie&&n(2,c=ie.close),"scroll"in ie&&n(3,f=ie.scroll),"settings"in ie&&n(13,u=ie.settings),"origin"in ie&&n(14,p=ie.origin),"defaultOffset"in ie&&n(15,g=ie.defaultOffset),"zindex"in ie&&n(4,v=ie.zindex),"$$scope"in ie&&n(16,o=ie.$$scope)},[l,a,c,f,v,_,D,L,r,y,k,R,O,u,p,g,o,i,se,re]}var I1=class extends Fe{constructor(e){super(),Se(this,e,gT,hT,Oe,{title:0,icon:1,close:2,scroll:3,settings:13,origin:14,defaultOffset:15,zindex:4},null,[-1,-1])}},jt=I1;var ux=t=>{let e=(t||0).toString().split(""),n=e.splice(-2).join(""),s=e.splice(-2).join(""),i=e.join("");return{c:n,s,g:i}};var Ua=(t,e=!0)=>{let n=Object.entries(t);return n.forEach(s=>{s[0]=parseInt(s[0]),e&&typeof s[1]=="object"&&(s[1]=Ua(s[1]))}),new Map(n)};var ns=t=>t>=1e4?(t/1e3).toFixed(1)+"k":ht(t);var ht=t=>t<1e3?t+"":ht(~~(t/1e3))+","+("00"+~~(t%1e3)).substr(-3,3),mx=(t,e)=>t.length>e?`${t.slice(0,e-2)}...`:t,px=Ua({14:.1,13:.1,9:.1,8:.1,16:.1}),vT=Ua({14:"%",13:"%",16:"%",18:"%"}),ss=(t,e)=>(px.has(t)&&(e*=px.get(t),e=e.toFixed(e>=.1?1:2)),e+(vT.get(t)||""));var _T=t=>t.replace(/\$c(\d)/g,(e,n)=>`<img class=texticon src='${Qi(n)}'>`),bT=t=>t.replace(/\$l(\d+)/g,(e,n)=>`<span class=textwhite>${n}</span>`),yT=t=>t.replace(/\$f(\d)(\w*)/g,(e,n,s)=>`<span class=textf${n}>${s}</span>`),kT=t=>t.replace(/\$gt/g,(e,n)=>'<img class="svgicon" src="/data/ui/icons/check.svg?v=8593107">'),xT=t=>t.replace(/\$e(\d+)/g,(e,n)=>Nf(n,!1)),wT=t=>t.replace(/\$g(\d+)/g,(e,n)=>V1(n,!1)),MT=t=>t.replace(/\$m(\d+)/g,(e,n)=>L1(n,!1)),FT=t=>t.replace(/\$sp(\d+)/g,(e,n)=>"<img class=texticon src=/data/ui/icons/gem.svg?v=8593107/>"+n),CT=t=>t.replace(/\$fm(\d+)/g,(e,n)=>`<span class=textfame><img class=svgicon src='/data/ui/currency/fame.svg?v=8593107'> ${n}</span>`),V1=(t,e=!1)=>{let{c:n,s,g:i}=ux(t),o="<span/>";return i!=""&&(o+=`<span class=${e?"textred":"textgold"}>${i}</span> <img class=texticon src='/data/ui/currency/gold.${On}?v=8593107'/>`),s!=""&&(o+=`<span class=${e?"textred":"textsilver"}>${s}</span> <img class=texticon src='/data/ui/currency/silver.${On}?v=8593107'/>`),n!=""&&(o+=`<span class=${e?"textred":"textcopper"}>${n}</span> <img class=texticon src='/data/ui/currency/copper.${On}?v=8593107'/>`),o+"</span>"};var L1=(t,e=!1)=>`<span class='${e?"textred":"textgold"}'><img class='svgicon' src='${Uk}'> ${ht(t)}</span>`,Nf=t=>`<span class='bold textpvp'><img class='svgicon' src='${Bk(t)}'> ${ht(t)}</span>`,ll=(t,e)=>`<span class='bold textprimary'><img class='svgicon' src='${Ok(t)}'> ${e}</span>`,ST=[_T,bT,yT,wT,CT,kT,FT,MT,xT],jf=t=>ST.reduce((e,n)=>n(e),t);function dx(t,e,n){let s=t.slice();return s[4]=e[n],s[6]=n,s}function hx(t){let e,n;return e=new jt({props:{zindex:5,origin:"center",title:C.ui.headers.interaction,$$slots:{default:[AT]},$$scope:{ctx:t}}}),e.$on("close",t[3]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&129&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function gx(t){let e,n,s=jf(t[4])+"",i,o,r;function l(...a){return t[2](t[6],...a)}return{c(){e=h("div"),n=h("span"),m(e,"class","btn border black textgreen"),m(e,"value",i=t[6])},m(a,c){w(a,e,c),d(e,n),n.innerHTML=s,o||(r=X(e,"click",l),o=!0)},p(a,c){t=a,c&1&&s!==(s=jf(t[4])+"")&&(n.innerHTML=s)},d(a){a&&x(e),o=!1,r()}}}function AT(t){let e,n,s=t[0].title+"",i,o,r=t[0].text+"",l,a=me(t[0].choices),c=[];for(let f=0;f<a.length;f+=1)c[f]=gx(dx(t,a,f));return{c(){e=h("div"),n=h("h3"),i=T(s),o=h("p"),l=T(r);for(let f=0;f<c.length;f+=1)c[f].c();m(n,"class","textprimary name svelte-k1vie9"),m(e,"class","container svelte-k1vie9")},m(f,u){w(f,e,u),d(e,n),d(n,i),d(e,o),d(o,l);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(e,null)},p(f,u){if(u&1&&s!==(s=f[0].title+"")&&G(i,s),u&1&&r!==(r=f[0].text+"")&&G(l,r),u&3){a=me(f[0].choices);let p;for(p=0;p<a.length;p+=1){let g=dx(f,a,p);c[p]?c[p].p(g,u):(c[p]=gx(g),c[p].c(),c[p].m(e,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=a.length}},d(f){f&&x(e),st(c,f)}}}function PT(t){let e,n,s=t[0]&&hx(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[0]?s?(s.p(i,o),o&1&&P(s,1)):(s=hx(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function TT(t,e,n){let s;oe(t,zi,l=>n(0,s=l));function i(l){Ss(Ft.clientPlayerInteract.packData({id:l})),tt(zi,s=void 0,s)}return[s,i,(l,a)=>i(l),()=>{tt(zi,s=void 0,s)}]}var q1=class extends Fe{constructor(e){super(),Se(this,e,TT,PT,Oe,{})}},vx=q1;function ET(t){let e,n,s,i,o,r,l,a,c,f=t[7].default,u=jl(f,t,t[6],null);return{c(){e=h("div"),n=h("div"),s=h("span"),i=T(t[0]),o=h("span"),r=T(t[1]),u&&u.c(),m(s,"class","left svelte-i7i7g5"),m(o,"class","right svelte-i7i7g5"),m(n,"class",l="progressBar "+t[3]+" svelte-i7i7g5"),qe(n,"width",t[2]+"%"),qe(n,"font-size",t[4]),m(e,"class",a="bar "+(t[5]?"dark":"")+" svelte-i7i7g5"),qe(e,"z-index",t[3]=="hp"?"1":"0")},m(p,g){w(p,e,g),d(e,n),d(n,s),d(s,i),d(n,o),d(o,r),u&&u.m(e,null),c=!0},p(p,[g]){(!c||g&1)&&G(i,p[0]),(!c||g&2)&&G(r,p[1]),(!c||g&8&&l!==(l="progressBar "+p[3]+" svelte-i7i7g5"))&&m(n,"class",l),(!c||g&4)&&qe(n,"width",p[2]+"%"),(!c||g&16)&&qe(n,"font-size",p[4]),u&&u.p&&(!c||g&64)&&Gl(u,f,p,p[6],c?Wl(f,p[6],g,null):Hl(p[6]),null),(!c||g&32&&a!==(a="bar "+(p[5]?"dark":"")+" svelte-i7i7g5"))&&m(e,"class",a),(!c||g&8)&&qe(e,"z-index",p[3]=="hp"?"1":"0")},i(p){c||(P(u,p),c=!0)},o(p){V(u,p),c=!1},d(p){p&&x(e),u&&u.d(p)}}}function DT(t,e,n){let{$$slots:s={},$$scope:i}=e,{left:o=""}=e,{right:r=""}=e,{fract:l}=e,{barcol:a}=e,{size:c}=e,{darken:f}=e;return t.$$set=u=>{"left"in u&&n(0,o=u.left),"right"in u&&n(1,r=u.right),"fract"in u&&n(2,l=u.fract),"barcol"in u&&n(3,a=u.barcol),"size"in u&&n(4,c=u.size),"darken"in u&&n(5,f=u.darken),"$$scope"in u&&n(6,i=u.$$scope)},[o,r,l,a,c,f,i,s]}var R1=class extends Fe{constructor(e){super(),Se(this,e,DT,ET,Fn,{left:0,right:1,fract:2,barcol:3,size:4,darken:5})}},vs=R1;var z1={};Xn(z1,{init:()=>IT,updateCd:()=>Gf});var Wf=new Map,_x=!1,IT=()=>{fetch("/data/ui/circlecooldowns/circlecooldowns.txt?v=8593107").then(async t=>{let e=(await t.text()).split(`
`);for(let n=0;n<3;++n){let s=[];for(let i=0;i<101;++i){let o=new Image;o.src=e.shift(),s.push([o])}Wf.set([40,31,23][n],s)}_x=!0})},Gf=(t,e,n)=>{_x&&e&&t!==e.step&&(e.cdimg!==void 0&&(Wf.get(n)[e.step].push(e.removeChild(e.cdimg)),e.cdimg=void 0),(e.step=t)>0&&(Wf.get(n)[e.step].length===1?e.cdimg=Wf.get(n)[e.step][0].cloneNode():e.cdimg=Wf.get(n)[e.step].pop(),e.appendChild(e.cdimg)))};function bx(t){let e,n;return{c(){e=h("div"),n=T(t[0]),m(e,"class","stacks slottext svelte-1nn7wcb")},m(s,i){w(s,e,i),d(e,n)},p(s,i){i&1&&G(n,s[0])},d(s){s&&x(e)}}}function yx(t){let e,n=(t[5]>99?Math.round(t[5]/60)+"'":Math.ceil(t[5]))+"",s;return{c(){e=h("div"),s=T(n),m(e,"class","time absCentered slottext svelte-1nn7wcb")},m(i,o){w(i,e,o),d(e,s)},p(i,o){o&32&&n!==(n=(i[5]>99?Math.round(i[5]/60)+"'":Math.ceil(i[5]))+"")&&G(s,n)},d(i){i&&x(e)}}}function VT(t){let e,n,s,i,o,r,l,a,c,f,u=t[0]>1&&bx(t),p=t[3]>30&&le.cdTextBuffs&&t[5]>0&&yx(t);return{c(){e=h("div"),n=h("div"),s=h("img"),o=h("div"),u&&u.c(),r=be(),p&&p.c(),m(s,"class","icon svelte-1nn7wcb"),at(s.src,i=t[1])||m(s,"src",i),qe(s,"max-width",t[3]+"px"),m(o,"class","overlay svelte-1nn7wcb"),m(n,"class",l="slot border "+(t[2]===1?"negative":"positive")+" svelte-1nn7wcb"),m(e,"class",a="container "+(t[5]<le.buffCdFlashingDuration&&t[5]%le.buffCdFlashingInterval*2>le.buffCdFlashingInterval?"soon":"")+" svelte-1nn7wcb")},m(g,v){w(g,e,v),d(e,n),d(n,s),d(n,o),t[10](o),u&&u.m(n,null),d(n,r),p&&p.m(n,null),c||(f=X(e,"contextmenu",t[6]),c=!0)},p(g,[v]){v&2&&!at(s.src,i=g[1])&&m(s,"src",i),v&8&&qe(s,"max-width",g[3]+"px"),g[0]>1?u?u.p(g,v):(u=bx(g),u.c(),u.m(n,r)):u&&(u.d(1),u=null),g[3]>30&&le.cdTextBuffs&&g[5]>0?p?p.p(g,v):(p=yx(g),p.c(),p.m(n,null)):p&&(p.d(1),p=null),v&4&&l!==(l="slot border "+(g[2]===1?"negative":"positive")+" svelte-1nn7wcb")&&m(n,"class",l),v&32&&a!==(a="container "+(g[5]<le.buffCdFlashingDuration&&g[5]%le.buffCdFlashingInterval*2>le.buffCdFlashingInterval?"soon":"")+" svelte-1nn7wcb")&&m(e,"class",a)},i:ue,o:ue,d(g){g&&x(e),t[10](null),u&&u.d(),p&&p.d(),c=!1,f()}}}function LT(t,e,n){let{stacks:s}=e,{duration:i}=e,{time:o}=e,{icon:r}=e,{type:l}=e,{size:a}=e,{cancel:c}=e,f=1,u=0,p,g=()=>{c>=0&&xt("cancelbuff",c)};function v(_){Nt[_?"unshift":"push"](()=>{p=_,n(4,p)})}return t.$$set=_=>{"stacks"in _&&n(0,s=_.stacks),"duration"in _&&n(7,i=_.duration),"time"in _&&n(8,o=_.time),"icon"in _&&n(1,r=_.icon),"type"in _&&n(2,l=_.type),"size"in _&&n(3,a=_.size),"cancel"in _&&n(9,c=_.cancel)},t.$$.update=()=>{t.$$.dirty&408&&(n(5,u=i-o),Gf(Math.round(o/i*100),p,a))},[s,r,l,a,p,u,g,i,o,c,v]}var B1=class extends Fe{constructor(e){super(),Se(this,e,LT,VT,Fn,{stacks:0,duration:7,time:8,icon:1,type:2,size:3,cancel:9})}},kx=B1;var rg={};Xn(rg,{envSkillId:()=>rr,findEnvironmentTarget:()=>Pw,hoverinteractive:()=>id,hovertarget:()=>vn,init:()=>jE,onWorldDestroy:()=>ZE,parseHudTargets:()=>og,playertarget:()=>qn,preTick:()=>YE,ray:()=>ir,setEnvCast:()=>Jf,setHoverTarget:()=>Zf,setTarget:()=>or,targetSwitchConciliate:()=>ig,targetSwitchNetTimer:()=>pl,tick:()=>XE});var wx=(t,e,n)=>{let s=$.getUniformBlockIndex(t,e),i=$.getActiveUniformBlockParameter(t,s,$.UNIFORM_BLOCK_DATA_SIZE),o={name:e,size:i,uniforms:[],index:n},r=$.getActiveUniformBlockParameter(t,s,$.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES),l=$.getActiveUniforms(t,r,$.UNIFORM_OFFSET);for(let a=0;a<r.length;++a){let c=r[a],f=$.getActiveUniform(t,c),u=l[a],p=f.size,g=0,v=0,_=!1;f.type===$.FLOAT_VEC3?(g=3,v=p>1?4:3):f.type===$.FLOAT_VEC2?(g=2,v=p>1?4:2):f.type===$.FLOAT_VEC4?(g=4,v=4):f.type===$.FLOAT_MAT4?(g=16,v=16):f.type===$.FLOAT?(g=1,v=1):f.type===$.INT&&(g=1,v=1,_=!0),p*=g;let b={name:f.name.replace("[0]",""),size:p,offset:u,divisor:v,elements:g,isInt:_};o.uniforms.push(b)}return o.uniforms.sort((a,c)=>a.offset-c.offset),o},Oa=t=>{let e={layout:t,buffer:$.createBuffer(),data:{},dataArray:[]};$.bindBuffer($.UNIFORM_BUFFER,e.buffer),$.bufferData($.UNIFORM_BUFFER,t.size,$.DYNAMIC_DRAW),$.bindBuffer($.UNIFORM_BUFFER,null);for(let n=0;n<t.uniforms.length;++n){let s=t.uniforms[n],i=[];for(let o=0;o<s.size;++o)i.push(0);e.data[s.name]=i,e.dataArray.push(i)}return e},al=t=>{$.bindBufferBase($.UNIFORM_BUFFER,t.layout.index,t.buffer)},Mo=(t,e,n,s=0)=>{s===0&&(s=e.length);for(let i=0;i<s;++i)t[i+n]=e[i]},Mx=new ArrayBuffer(1e3),qT=new Int32Array(Mx),xx=new Float32Array(Mx),Um=t=>{for(let e=0;e<t.layout.uniforms.length;++e){let n=t.layout.uniforms[e];t.data[n.name]!==t.dataArray[e]&&(t.dataArray[e]=t.data[n.name])}},is=t=>{let e=0;for(let n=0;n<t.layout.uniforms.length;++n){let s=t.layout.uniforms[n],i=t.dataArray[n],o=s.isInt?qT:xx,r=0;for(;r<i.length;)for(let l=0;l<s.divisor;++l)l<s.elements&&(o[e]=i[r],r++),e++}$.bindBuffer($.UNIFORM_BUFFER,t.buffer),$.bufferSubData($.UNIFORM_BUFFER,0,xx,0,t.layout.size/4),$.bindBuffer($.UNIFORM_BUFFER,null)};var $a=[],Na,bi,Fo,fl,ul,Fx=t=>{let e=et.width,n=et.height;for(let s=0;s<2;++s)$a.push(ko(t,t,0,!0,$.COMPARE_REF_TO_TEXTURE));Na=ko(t,t,0,!0,$.COMPARE_REF_TO_TEXTURE),bi=ko(e,n,1,!0),Fo=ko(e,n,1,!0),fl=ko(Math.ceil(e/4),Math.ceil(n/4)),ul=ko(Math.ceil(e/4),Math.ceil(n/4))},Cx=(t,e)=>{Cf(bi,t,e),Cf(Fo,t,e),Cf(fl,Math.ceil(t/4),Math.ceil(e/4)),Cf(ul,Math.ceil(t/4),Math.ceil(e/4))};var Km={};Xn(Km,{bloom:()=>N1,bloomMerge:()=>j1,drop:()=>Om,foliagePlant:()=>$m,foliageStatic:()=>Nm,fxaa:()=>W1,multimeshEffect:()=>jm,multimeshFlat:()=>Wm,multimeshSimple:()=>Gm,multimeshTextured:()=>Hf,multimeshTexturedVcol:()=>Hm,multimeshTree:()=>U1,particles:()=>Ym,particles_additive:()=>O1,particles_normal:()=>$1,ribbon:()=>Yf,ribbonTextured:()=>H1,shadowInstanced:()=>Xf,shadowInstancedAlpha:()=>Y1,simple:()=>Xm,simpleTextured:()=>VE,simpleVcol:()=>LE,sky:()=>X1,skyStarTex:()=>Q1,sun:()=>Z1,terrain:()=>Qm,terrainEditorAreas:()=>qE,terrainEditorGrid:()=>RE,terrainEditorHeights:()=>zE,terrainEditorTiles:()=>BE,terrainFog:()=>Zm,tint:()=>G1,water:()=>Jm,waterEditorGrid:()=>UE});var Ax=`#version 300 es
precision highp float;precision highp int;out vec4 fragColor;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D diffuse;in vec2 vUv;in float vShine;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 a=texture(diffuse,vUv);if(a.a<0.5)discard;a.rgb=mix(a.rgb*worldlight[1],a.rgb*1.1,smoothstep(-0.7,0.7,sin(time*6.0+vShine)));float b=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);a.rgb=mix(fog[0],a.rgb,b);fragColor=a;}`;var Px=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in mat4 worldMatrix;in vec4 uvshift;in float shine;out float vShine;out vec2 vUv;void main(){vShine=shine;vWorldPos=worldMatrix*vec4(position,1.0);vUv=uvshift.zw-uv*uvshift.xy;vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);}`;var Tx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform sampler2D foliageDiffuse;in vec3 vLight;in vec3 vLightAmb;in vec3 vLightDir;in vec2 vUv;out vec4 fragColor;void main(){vec4 b=texture(foliageDiffuse,vUv);float c=0.1;b.a=b.a*smoothstep(1.0,0.0,(vCameraDistance-110.0)/20.0);if(b.a<c){discard;};float d=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float e=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 f=shadowPVMatrix[1]*(vWorldPos);vec3 g=(f.xyz/f.w)*0.5+0.5;d=texture(shadowMaps[1],g);}else{vec4 f=shadowPVMatrix[0]*(vWorldPos);vec3 g=(f.xyz/f.w)*0.5+0.5;d=texture(shadowMaps[0],g);}d=d;d=max(d,e);}b.rgb=b.rgb*(vLight+vLightAmb+vLightDir*d);float h=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,h);fragColor=b;}`;var Ex=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec4 instPos;in vec3 instNorm;in vec3 position;in vec2 uv;out vec3 vLightAmb;out vec3 vLightDir;out vec2 vUv;void main(){vUv=uv;vec3 b=vec3(0.0);for(int c=0;c<lightCount;++c){vec3 d=lightPos[c]-instPos.xyz;float e=lightCols[c].w-dot(d,d);if(e>0.0){e/=(lightCols[c].w);e=e*e;b+=0.3*lightCols[c].rgb*e;;}};vLight=b;vLightAmb=worldlight[1];vLightDir=worldlight[0]*max(0.0,dot(instNorm.xyz,worldlight[2]));vec3 f=position;float e=sin(time+instPos.x+f.x)*0.1*f.y;f.xz+=e;mat3 g;g[1]=instNorm.xyz;g[2]=normalize(cross(vec3(sin(instPos.x*100.0),0.0,cos(instPos.z*100.0)),g[1]));g[0]=normalize(cross(g[1],g[2]));vec3 h=g*f;vWorldPos=vec4(h*instPos.w+instPos.xyz,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var Dx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform sampler2D foliageDiffuse;in vec3 vLightAmb;in vec3 vLightDir;in vec3 vLight;in vec2 vUv;out vec4 fragColor;void main(){vec4 b=texture(foliageDiffuse,vUv);b.a=b.a*smoothstep(1.0,0.0,(vCameraDistance-110.0)/20.0);if(b.a<0.5){discard;};float c=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float d=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 e=shadowPVMatrix[1]*(vWorldPos);vec3 f=(e.xyz/e.w)*0.5+0.5;c=texture(shadowMaps[1],f);}else{vec4 e=shadowPVMatrix[0]*(vWorldPos);vec3 f=(e.xyz/e.w)*0.5+0.5;c=texture(shadowMaps[0],f);}c=c;c=max(c,d);}b.rgb=b.rgb*(vLight+vLightAmb+vLightDir*c);float g=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,g);fragColor=b;}`;var Ix=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec4 instPos;in vec3 instNorm;in vec3 position;in vec2 uv;out vec2 vUv;out vec3 vLightAmb;out vec3 vLightDir;void main(){vUv=uv;vec3 b=vec3(0.0);for(int c=0;c<lightCount;++c){vec3 d=lightPos[c]-instPos.xyz;float e=lightCols[c].w-dot(d,d);if(e>0.0){e/=(lightCols[c].w);e=e*e;b+=0.3*lightCols[c].rgb*e;;}}vLight=b;vLightAmb=worldlight[1];vLightDir+=worldlight[0]*max(0.0,dot(instNorm.xyz,worldlight[2]));vec3 f=position;mat3 g;g[1]=instNorm.xyz;g[2]=normalize(cross(vec3(sin(instPos.x*100.0),0.0,cos(instPos.z*100.0)),g[1]));g[0]=normalize(cross(g[1],g[2]));vec3 h=g*f;vWorldPos=vec4(h*instPos.w+instPos.xyz,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var Vx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vCol;in vec2 vYcutoff;in vec4 vUvshift;out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec2 a=vec2((vUv.x+vUvshift.x)*vUvshift.z,(vUv.y+vUvshift.y)*vUvshift.w);vec4 b=vec4(1.0,1.0,1.0,texture(diffuse,a).r)*vCol;b.a*=min(1.0,max(0.0,vUv.y/vYcutoff[0]));b.a*=min(1.0,max(0.0,(vYcutoff[1]-vUv.y)/(1.0-vYcutoff[1])));if(b.a<0.01){discard;}float c=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,c);fragColor=b;fragColor.rgb*=fragColor.a;}`;var Lx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in mat4 worldMatrix;in vec4 uvshift;in vec2 ycutoff;in vec4 color;out vec3 vNormal;out vec2 vUv;out vec4 vCol;out vec2 vYcutoff;out vec4 vUvshift;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vUvshift=uvshift;vCol=color;vYcutoff=ycutoff;vWorldPos=worldMatrix*vec4(position,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var qx=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 vLight;in vec4 vColor;in vec3 vNormal;in vec4 vInteriorlight;in float vAlpha;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}float o=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float p=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 q=shadowPVMatrix[1]*(vWorldPos);vec3 r=(q.xyz/q.w)*0.5+0.5;o=texture(shadowMaps[1],r);}else{vec4 q=shadowPVMatrix[0]*(vWorldPos);vec3 r=(q.xyz/q.w)*0.5+0.5;o=texture(shadowMaps[0],r);}o=o;o=max(o,p);}vec3 s=worldlight[1];vec3 t=worldlight[0];s=mix(s,vInteriorlight.rgb*0.5,vInteriorlight.a);t=mix(t,vInteriorlight.rgb,vInteriorlight.a);float u=max(0.0,min(1.0,vColor[3]*0.2));vec4 v=vec4(b(s,t,vColor.rgb,vNormal,o,vLight,u),vAlpha);float w=max(0.0,min(1.0,-vColor[3]));v.rgb=mix(v.rgb,vColor.rgb,w);float x=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);v.rgb=mix(fog[0],v.rgb,x);fragColor=v;}`;var Rx=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 position;in vec3 normal;in vec4 color;in vec4 interiorlight;in float alpha;in mat4 worldMatrix;out vec4 vColor;out vec3 vNormal;out vec4 vInteriorlight;out float vAlpha;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vWorldPos=worldMatrix*vec4(position,1.0);vColor=color;vAlpha=alpha;vInteriorlight=interiorlight;vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var zx=`#version 300 es
precision highp float;precision highp int;in vec4 vColor;out vec4 fragColor;void main(){fragColor=vColor;fragColor.a=1.0;}`;var Bx=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 position;in vec4 color;in mat4 worldMatrix;out vec4 vColor;void main(){vColor=color;gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);;}`;var Ux=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Circle{vec4 circlePos;vec4 circleInfo;};in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vInteriorlight;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 o=texture(diffuse,vUv);if(o.a<0.5)discard;float p=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float q=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 r=shadowPVMatrix[1]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[1],s);}else{vec4 r=shadowPVMatrix[0]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[0],s);}p=p;p=max(p,q);}vec3 t=worldlight[1];vec3 u=worldlight[0];t=mix(t,vInteriorlight.rgb*0.5,vInteriorlight.a);u=mix(u,vInteriorlight.rgb,vInteriorlight.a);o.rgb=b(t,u,o.rgb,vNormal,p,vLight,0.0);o.rgb/=o.a;float v=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,v);float w=distance(vWorldPos.xz,circlePos.xz);float x=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(w<circlePos.w+0.1&&x>0.0){o.rgb=mix(o.rgb,circleInfo.rgb,x*circleInfo.a*((w<circlePos.w?w/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-w))/0.1)));}fragColor=o;}`;var Ox=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in vec4 interiorlight;in mat4 worldMatrix;out vec3 vNormal;out vec2 vUv;out vec4 vInteriorlight;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vWorldPos=worldMatrix*vec4(position,1.0);vInteriorlight=interiorlight;vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var $x=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Circle{vec4 circlePos;vec4 circleInfo;};in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vCol;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 o=texture(diffuse,vUv);if(o.a<0.5)discard;float p=(float(gl_FrontFacing)*2.0-1.0);float q=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float r=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 s=shadowPVMatrix[1]*(vWorldPos);vec3 t=(s.xyz/s.w)*0.5+0.5;q=texture(shadowMaps[1],t);}else{vec4 s=shadowPVMatrix[0]*(vWorldPos);vec3 t=(s.xyz/s.w)*0.5+0.5;q=texture(shadowMaps[0],t);}q=q;q=max(q,r);}vec3 u=mix(worldlight[1],vCol.rgb,vCol.a);vec3 v=worldlight[0]*(1.0-vCol.a);o.rgb=b(u,v,o.rgb,vNormal,q,vLight,0.0);float w=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,w);float x=distance(vWorldPos.xz,circlePos.xz);float y=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(x<circlePos.w+0.1&&y>0.0){o.rgb=mix(o.rgb,circleInfo.rgb,y*circleInfo.a*((x<circlePos.w?x/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-x))/0.1)));}fragColor=o;}`;var Nx=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in vec4 color;in mat4 worldMatrix;out vec3 vNormal;out vec2 vUv;out vec4 vCol;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vCol=color;vWorldPos=worldMatrix*vec4(position,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var jx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){vec4 o=texture(diffuse,vUv);if(o.a<0.7)discard;if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}float p=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float q=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 r=shadowPVMatrix[1]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[1],s);}else{vec4 r=shadowPVMatrix[0]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[0],s);}p=p;p=max(p,q);}o.rgb=b(worldlight[1],worldlight[0],o.rgb,vNormal,p,vLight,0.0);o.rgb/=o.a;float t=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,t);fragColor=o;}`;var Wx=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec3 position;in vec4 info;in vec2 progress;in vec4 scaleRota;in vec4 colStart;in vec4 colEnd;out vec4 vCol;out float vRotationCos;out float vRotationSin;out vec2 vOffset;void main(){float a=min(info[3]-1.0,floor(mix(info[2],info[3],mod(info[0]*progress[0],1.0))));vOffset=vec2(fract(a*0.125),-floor(a/8.0)*0.125);vCol=mix(colStart,colEnd,progress[1]);float b=mix(scaleRota[2],scaleRota[3],progress[0]);vRotationCos=cos(b);vRotationSin=sin(b);float c=mix(scaleRota[0],scaleRota[1],progress[1])*(abs(vRotationSin)+abs(vRotationCos));vec4 d=viewMatrix*vec4(position,1.0);gl_PointSize=c*resolution[1]*projectionMatrix[1][1]/length(d.xyz);gl_Position=projectionMatrix*d;}`;var Gx=`#version 300 es
precision highp float;precision highp int;uniform sampler2D particleDiffuse;in vec4 vCol;in vec2 vOffset;in float vRotationCos;in float vRotationSin;out vec4 fragColor;const float a=1.0/(1024.0/8.0);void main(){float b=0.5;float c=abs(vRotationSin)+abs(vRotationCos);vec2 d=vec2(gl_PointCoord.x-b,gl_PointCoord.y-b)*c;vec2 e=d*vRotationCos;vec2 f=d*vRotationSin;d=vec2(e.x+f.y+b,e.y-f.x+b);if(d.x<a||d.x>1.0-a||d.y>1.0-a||d.y<a){discard;}d.x*=0.125;d.y=1.0-d.y*0.125;vec4 g=vec4(1.0,1.0,1.0,texture(particleDiffuse,d+vOffset).r);g*=vCol;if(g.a<0.01){discard;}fragColor=g;fragColor.rgb*=fragColor.a;fragColor.a*=0.33;}`;var Hx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D particleDiffuse;in vec4 vCol;in vec2 vOffset;in float vRotationCos;in float vRotationSin;out vec4 fragColor;const float a=1.0/(1024.0/8.0);void main(){float b=0.5;float c=abs(vRotationSin)+abs(vRotationCos);vec2 d=vec2(gl_PointCoord.x-b,gl_PointCoord.y-b)*c;vec2 e=d*vRotationCos;vec2 f=d*vRotationSin;d=vec2(e.x+f.y+b,e.y-f.x+b);if(d.x<a||d.x>1.0-a||d.y>1.0-a||d.y<a){discard;}d.x*=0.125;d.y=1.0-d.y*0.125;vec3 g=texture(particleDiffuse,d+vOffset).rgb;if((g.r+g.g+g.b)<0.1){discard;}fragColor=vec4(g.rgb,1.0);}`;var Yx=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;uniform vec2 offset[4];uniform vec4 amount;in vec2 vUv;out vec4 fragColor;void main(){vec3 a=texture(inputA,vUv+offset[0]).rgb*amount[0];a+=texture(inputA,vUv+offset[1]).rgb*amount[1];a+=texture(inputA,vUv+offset[2]).rgb*amount[2];a+=texture(inputA,vUv+offset[3]).rgb*amount[3];fragColor=vec4(a,1.0);}`;var Xx=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;uniform sampler2D inputB;uniform float amount;in vec2 vUv;out vec4 fragColor;void main(){vec4 a=texture(inputA,vUv);vec3 b=texture(inputB,vUv).rgb;b=b*b;fragColor.w=a.w;fragColor.xyz=b*amount+a.xyz;}`;var Qx=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;in vec2 vUv;out vec4 fragColor;
#define a  4.0
#define b (1.0/a)
#define c (1.0/128.0)
#define d (1.0/8.0)
vec3 e(vec4 f,sampler2D g,vec2 h){vec3 i=textureLod(g,f.zw,0.0).xyz;vec3 j=textureLod(g,f.zw+vec2(1,0)*h.xy,0.0).xyz;vec3 k=textureLod(g,f.zw+vec2(0,1)*h.xy,0.0).xyz;vec3 l=textureLod(g,f.zw+vec2(1,1)*h.xy,0.0).xyz;vec3 m=textureLod(g,f.xy,0.0).xyz;vec3 n=vec3(0.299,0.587,0.114);float o=dot(i,n);float p=dot(j,n);float q=dot(k,n);float r=dot(l,n);float s=dot(m,n);float t=min(s,min(min(o,p),min(q,r)));float u=max(s,max(max(o,p),max(q,r)));vec2 v;v.x=-((o+p)-(q+r));v.y=((o+q)-(p+r));float w=max((o+p+q+r)*(0.25*b),c);float x=1.0/(min(abs(v.x),abs(v.y))+w);v=min(vec2(a,a),max(vec2(-a,-a),v*x))*h.xy;vec3 y=(1.0/2.0)*(textureLod(g,f.xy+v*(1.0/3.0-0.5),0.0).xyz+textureLod(g,f.xy+v*(2.0/3.0-0.5),0.0).xyz);vec3 az=y*(1.0/2.0)+(1.0/4.0)*(textureLod(g,f.xy+v*(0.0/3.0-0.5),0.0).xyz+textureLod(g,f.xy+v*(3.0/3.0-0.5),0.0).xyz);float aa=dot(az,n);if((aa<t)||(aa>u))return y;return az;}void main(){vec2 h=1.0/resolution;vec4 f=vec4(vUv,vUv-(h*(0.5+d)));vec3 ab=e(f,inputA,1.0/resolution);fragColor=vec4(ab,1.);}`;var Zx=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D inputA;uniform vec4 tint;uniform float warp;in vec2 vUv;out vec4 fragColor;void main(){float a=0.01;float b=5.0;vec2 c;c.x=sin(vUv.y*10.0+time)*a;c.y=cos(vUv.x*10.0+time)*a;vec4 d=texture(inputA,vUv);vec4 e=texture(inputA,vUv+c);vec4 f=mix(d,e,warp);f.rgb=mix(f.rgb,tint.rgb*0.2+0.8*tint.rgb*length(f.rgb),tint.a);fragColor=f;}`;var Jx=`#version 300 es
precision highp float;precision highp int;uniform vec4 colStart;uniform vec4 colEnd;uniform vec2 offset;in vec2 vUv;out vec4 fragColor;void main(){fragColor=mix(colStart,colEnd,vUv.x);if(fragColor.a<0.01){discard;}fragColor.rgb*=fragColor.a;fragColor.a*=0.5;}`;var Kx=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform vec2 offset;in vec3 position;in vec2 uv;out vec2 vUv;void main(){vUv=vec2(uv.x-min(uv.x/offset.y,1.0)*offset.x,uv.y);gl_Position=projectionViewMatrix*vec4(position,1.0);}`;var ew=`#version 300 es
precision highp float;precision highp int;uniform vec4 colStart;uniform vec4 colEnd;uniform vec2 offset;uniform sampler2D diffuse;in vec2 vUv;out vec4 fragColor;void main(){fragColor=texture(diffuse,vUv);fragColor*=mix(colStart,colEnd,vUv.x);if(fragColor.a<0.01){discard;}}`;var tw=`#version 300 es
precision highp float;precision highp int;void main(){}`;var nw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in mat4 worldMatrix;in vec3 position;in vec2 uv;out vec2 vUv;void main(){vUv=uv;gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);}`;var sw=`#version 300 es
precision highp float;precision highp int;in vec2 vUv;uniform sampler2D diffuse;void main(){if(texture(diffuse,vUv).a<0.7)discard;}`;var iw=`#version 300 es
precision highp float;precision highp int;uniform vec4 color;out vec4 fragColor;void main(){fragColor=color;}`;var ow=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 position;in vec2 uv;in vec3 normal;out vec2 vUv;out vec3 vNormal;out vec3 vPos;void main(){vUv=uv;vNormal=normal;vPos=position;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var rw=`#version 300 es
precision highp float;precision highp int;uniform sampler2D diffuse;in vec2 vUv;out vec4 fragColor;void main(){vec4 a=texture(diffuse,vUv);vec3 b=normalize(vec3(1.0,1.0,0.3));fragColor=a;if(fragColor.a<0.2)discard;}`;var lw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec2 uv;in vec3 position;in vec3 normal;out vec2 vUv;out vec3 vNormal;void main(){vUv=uv;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var aw=`#version 300 es
precision highp float;precision highp int;in vec4 vColor;out vec4 fragColor;void main(){fragColor=vColor;}`;var cw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 position;in vec4 color;out vec4 vColor;void main(){vColor=color;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var fw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Sky{vec3 skycolors[5];vec3 suncolor;};uniform sampler2D skyDiffuse;uniform sampler2D cloudDiffuse;in vec2 vUv;in vec3 vPos;out vec4 fragColor;void main(){gl_FragDepth=0.999999;vec3 a=vec3(0.0);float b=vPos.y/0.5;if(b>0.4){a=mix(skycolors[1],skycolors[0],smoothstep(0.4,1.0,b));}else if(b>0.25){a=mix(skycolors[2],skycolors[1],smoothstep(0.25,0.4,b));}else if(b>0.06){a=mix(skycolors[3],skycolors[2],smoothstep(0.06,0.25,b));}else{a=mix(fog[0],skycolors[3],smoothstep(0.0,0.06,b));}float c=1.0-sin(daycycle*6.28)+0.02;float d=smoothstep(0.1,0.5,b)*smoothstep(0.9,0.6,b);a+=texture(skyDiffuse,vUv*vec2(4.0,1.0)).rgb*c*d;float e=texture(cloudDiffuse,vec2(vUv.x+time/80.0,vUv.y*0.6+time/120.0)).r*texture(cloudDiffuse,vec2(vUv.x*2.0+time/300.0,vUv.y*0.6)).r;e=e*smoothstep(0.0,0.1,b)*smoothstep(0.9,0.6,b);e=smoothstep(0.25,0.7,e);a=mix(a,skycolors[4],e);fragColor=vec4(a,1.0);}`;var uw=`#version 300 es
precision highp float;precision highp int;in vec2 vUv;uniform float seed;float a(in vec2 uv,float scale){uv*=scale;vec2 b=floor(uv),f=fract(uv),p;float c=3.,d;p=.5+.35*sin(11.*fract(sin((b+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);c=min(d,c);return smoothstep(0.,c,sin(f.x+f.y)*0.003);}vec2 d(vec2 e){e=vec2(dot(e,vec2(127.1,311.7)),dot(e,vec2(269.5,183.3)));return-1.0+2.0*fract(sin(e)*43758.5453123);}float f(in vec2 e){const float g=0.366025404;const float h=0.211324865;vec2 i=floor(e+(e.x+e.y)*g);vec2 j=e-i+(i.x+i.y)*h;vec2 l=(j.x>j.y)?vec2(1.0,0.0):vec2(0.0,1.0);vec2 m=j-l+h;vec2 n=j-1.0+2.0*h;vec3 q=max(0.5-vec3(dot(j,j),dot(m,m),dot(n,n)),0.0);vec3 r=q*q*q*vec3(dot(j,d(i+0.0)),dot(m,d(i+l)),dot(n,d(i+1.0)));float t=dot(r,vec3(70.0));return smoothstep(-1.0,1.0,t);}out vec4 fragColor;void main(){vec2 u=vec2(vUv.x+seed,vUv.y);float r=a(vUv,10.0);r+=a(vUv,20.0)*0.5;r+=a(vUv,30.0)*0.2;r*=f(vUv*20.0);fragColor.rgb+=r*4.0;}`;var pw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Sky{vec3 skycolors[5];vec3 suncolor;};in vec2 vUv;in vec3 vPos;out vec4 fragColor;void main(){gl_FragDepth=0.999998;float a=length(vec2(0.5,0.5)-vUv);float b=smoothstep(0.3,0.2,a)*2.0;b+=smoothstep(0.5,0.1,a);b*=smoothstep(0.08,0.15,(vPos.y+0.2)*0.2+abs(sin(daycycle*6.282)));fragColor.rgba=vec4(suncolor,b);}`;var mw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;vec3 f(vec3 g,vec3 h,vec3 i,vec3 j,float k,vec3 l,float m){float n=clamp(dot(j,worldlight[2]),0.0,k);vec3 o=g*mix(0.7,1.1,0.5+(0.5*n));vec3 p=normalize(worldlight[2]+vViewDir);vec3 q=h*pow(max(0.0,dot(p,j)),20.0)*m*max(k*0.7+0.2,0.2)*20.0;vec3 r=o+h*n+l;return r*i+q;}void s(vec4 t,float u,vec4 v){float w=t.x+t.y+t.z;e+=v[3]*smoothstep(v[1],v[2],w)*u;t.a=u;t.rgb*=u;d+=t;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 x=texture(atlas,vUvChannel);x[3]=max(0.0,min(1.0,1.0-(x.r+x.g+x.b)));if(x[0]==1.0&&x[1]==1.0&&x[2]==1.0)discard;s(texture(diffuse[0],vUvTexture[0]),x[0],terrainInfo[0]);s(texture(diffuse[1],vUvTexture[1]),x[1],terrainInfo[1]);s(texture(diffuse[2],vUvTexture[2]),x[2],terrainInfo[2]);s(texture(diffuse[3],vUvTexture[3]),x[3],terrainInfo[3]);d.rgb/=d.a;e/=d.a;d.a=1.0;float y=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float az=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 aa=shadowPVMatrix[1]*(vWorldPos);vec3 ab=(aa.xyz/aa.w)*0.5+0.5;y=texture(shadowMaps[1],ab);}else{vec4 aa=shadowPVMatrix[0]*(vWorldPos);vec3 ab=(aa.xyz/aa.w)*0.5+0.5;y=texture(shadowMaps[0],ab);}y=y;y=max(y,az);}d.rgb=f(worldlight[1],worldlight[0],d.rgb,vNormal,y,vLight,e);float ac=distance(vWorldPos.xz,circlePos.xz);float ad=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(ac<circlePos.w+0.1&&ad>0.0){d.rgb=mix(d.rgb,circleInfo.rgb,ad*circleInfo.a*((ac<circlePos.w?ac/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-ac))/0.1)));}float ae=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,ae);fragColor=d;}`;var dw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float a=256.0;const float b=4.0;in vec3 position;in vec3 normal;out vec3 vNormal;out vec3 vUvChannel;out vec2 vUvTexture[4];out vec3 vViewDir;void main(){vNormal=normal;vWorldPos=modelMatrix*vec4(position,1.0);vUvChannel=vec3(position[0],position[2],0.0)/32.0;int c=quadrant%2;int d=int(quadrant%4);if(c==1)vUvChannel.x-=1.0;if(d>1)vUvChannel.y-=1.0;vUvChannel.z=float(quadrant);vec2 e=vec2(-vWorldPos[0],vWorldPos[2])/4.0;vUvTexture[0]=e*terrainInfo[0][0];vUvTexture[1]=e*terrainInfo[1][0];vUvTexture[2]=e*terrainInfo[2][0];vUvTexture[3]=e*terrainInfo[3][0];for(int f=0;f<lightCount;++f){vec3 g=lightPos[f]-vWorldPos.xyz;float h=lightCols[f].w-dot(g,g);if(h>0.0){h/=(lightCols[f].w);h=h*h;vLight+=0.2*lightCols[f].rgb*h;}}vViewDir=-normalize(vWorldPos.xyz-cameraPosition);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var hw=`#version 300 es
precision highp float;precision highp int;in vec4 vWorldPos;out vec4 fragColor;uniform vec4 colors[576];uniform int divider;void main(){float a=64.0/float(divider);int b=int(floor(mod(vWorldPos.x,64.0)/a)+floor(mod(vWorldPos.z,64.0)/a)*float(divider));fragColor.rgba=colors[b];}`;var gw=`#version 300 es
precision highp float;precision highp int;in vec3 vPos;in vec3 vNormal;out vec4 fragColor;void main(){float a=0.0;if(vNormal.y<0.93){a=1.0;}fragColor=vec4(0.0,0.0,a,0.4+a*0.6);if(abs(vPos.x-0.0)<0.001||abs(vPos.x-64.0)<0.001||abs(vPos.z-0.0)<0.001||abs(vPos.z-64.0)<0.001)fragColor=vec4(1.0,1.0,0.0,1.0);if((abs(vPos.x-32.0)<0.001&&mod(vPos.z,1.0)<0.5)||(abs(vPos.z-32.0)<0.001&&mod(vPos.x,1.0)<0.5))fragColor=vec4(1.0,1.0,0.0,1.0);}`;var vw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 normal;in vec3 position;out vec3 vPos;out vec3 vNormal;void main(){vNormal=normal;vPos=position;gl_Position=projectionViewMatrix*modelMatrix*vec4(position[0],position[1]+0.05,position[2],1.0);}`;var _w=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;void f(vec4 g,float h,vec4 i){float j=g.x+g.y+g.z;e+=i[3]*smoothstep(i[1],i[2],j)*h;g.a=h;g.rgb*=h;d+=g;}out vec4 fragColor;void main(){vec4 k=texture(atlas,vUvChannel);k[3]=max(0.0,min(1.0,1.0-(k.r+k.g+k.b)));if(k[0]==1.0&&k[1]==1.0&&k[2]==1.0)discard;f(texture(diffuse[0],vUvTexture[0]),k[0],terrainInfo[0]);f(texture(diffuse[1],vUvTexture[1]),k[1],terrainInfo[1]);f(texture(diffuse[2],vUvTexture[2]),k[2],terrainInfo[2]);f(texture(diffuse[3],vUvTexture[3]),k[3],terrainInfo[3]);d.rgb/=d.a;e/=d.a;d.a=1.0;if(mod(vWorldPos.y,2.0)<0.2){d.rgb=mix(d.rgb,vec3(0.8),0.5);}else{d.rgb=mix(d.rgb,vec3(0.2),0.5);}vec3 l=worldlight[2];l.y*=0.5;l=normalize(l);d.rgb*=max(0.3,min(1.0,dot(l,vNormal)*0.5+0.5));float m=distance(vWorldPos.xz,circlePos.xz);if(m<circlePos.w+0.1){d.rgb=mix(d.rgb,circleInfo.rgb,circleInfo.a*(max(0.,(0.3-abs(circlePos.w-m))/0.3)));}float n=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,n);fragColor=d;}`;var bw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;void f(vec4 g,float h,vec4 i){float j=g.x+g.y+g.z;e+=i[3]*smoothstep(i[1],i[2],j)*h;g.a=h;g.rgb*=h;d+=g;}out vec4 fragColor;void main(){vec4 k=texture(atlas,vUvChannel);k[3]=max(0.0,min(1.0,1.0-(k.r+k.g+k.b)));if(k[0]==1.0&&k[1]==1.0&&k[2]==1.0)discard;d.rgb=texture(diffuse[0],vUvTexture[0]).rgb;float l=64.0/12.0;float m=l/2.0;bool n=mod(vWorldPos.z,l)>m;if(mod(vWorldPos.x,l)<m){if(n){d.rgb=vec3(0.45);}else{d.rgb=vec3(0.55);}}else{if(n){d.rgb=vec3(0.55);}else{d.rgb=vec3(0.45);}}vec3 o=worldlight[2];o.y*=0.5;o=normalize(o);d.rgb*=max(0.3,min(1.0,dot(o,vNormal)*0.5+0.5));float p=distance(vWorldPos.xz,circlePos.xz);if(p<circlePos.w+0.1){d.rgb=mix(d.rgb,circleInfo.rgb,circleInfo.a*(max(0.,(0.3-abs(circlePos.w-p))/0.3)));}float q=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,q);fragColor=d;}`;var yw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;out vec4 fragColor;void main(){fragColor.rgb=fog[0];}`;var kw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};in vec3 position;void main(){vec4 a=modelMatrix*vec4(position,1.0);gl_Position=projectionViewMatrix*a;}`;var xw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};uniform sampler2D waterLines;uniform sampler2D waterNoise;uniform sampler2D bufferPongColor;uniform sampler2D bufferPongDepth;in vec2 vUv;out vec4 fragColor;void main(){float a=length(cameraPosition-vWorldPos.xyz);float b=(texture(waterNoise,vUv.yx/4.0+time*0.1).r-0.5);float c=gl_FragCoord.z;c=c*2.0-1.0;c=projectionMatrix[3][2]/(c+projectionMatrix[2][2]);if(a>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec2 d=gl_FragCoord.xy/resolution;float e=texture(bufferPongDepth,d.xy).r;e=e*2.0-1.0;e=projectionMatrix[3][2]/(e+projectionMatrix[2][2]);float f=e-c;vec2 g=vec2(b*0.05,0.0);float h=f;float i=1.0-clamp(h/0.1,0.0,1.0);float j=1.0-clamp(h/0.6,0.0,1.0);float k=1.0-clamp(h/2.0,0.0,1.0);float l=1.0-clamp(h/10.0,0.0,1.0);float m=1.0-clamp(h/100.0+0.5,0.0,1.0);float n=texture(waterLines,vUv.yx+b*0.15).r;vec3 o=mix(watercolors[2],watercolors[1],l);vec3 p=texture(bufferPongColor,d.xy+g).rgb;vec3 q=(worldlight[0]+worldlight[1]);vec3 r=mix(o,p*o,m)+n*watercolors[0]*(0.05+k*0.3);r=mix(r,watercolors[0],j)*q;vec4 s=vec4(r,1.0-i);float t=min(1.0,max(0.0,(n*(b+0.3)*0.5)));s.rgb+=t*worldlight[0];float u=clamp((fog[1][1]-a)/(fog[1][1]-fog[1][0]),0.0,1.0);s.rgb=mix(fog[0],s.rgb,u);fragColor=s;}`;var ww=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Water{vec3 verts[4];};in vec3 position;in vec3 color;in vec3 colorFoam;in vec3 colorShallow;out vec2 vUv;void main(){vWorldPos.xyz=verts[gl_VertexID];vWorldPos.w=1.0;vUv=vWorldPos.xz/2.0;gl_Position=projectionViewMatrix*vWorldPos;}`;var Mw=`#version 300 es
precision highp float;precision highp int;in vec4 vWorldPos;out vec4 fragColor;void main(){fragColor.rgba=vec4(1.0,mod(vWorldPos.y+0.001,1.0),0.0,0.5);}`;var Om={frag:Ax,vert:Px},$m={frag:Tx,vert:Ex},Nm={frag:Dx,vert:Ix},jm={frag:Vx,vert:Lx},Wm={frag:qx,vert:Rx},Gm={frag:zx,vert:Bx},Hf={frag:Ux,vert:Ox},Hm={frag:$x,vert:Nx},U1={frag:jx},Ym={vert:Wx},O1={frag:Gx},$1={frag:Hx},N1={frag:Yx},j1={frag:Xx},W1={frag:Qx},G1={frag:Zx},Yf={frag:Jx,vert:Kx},H1={frag:ew},Xf={frag:tw,vert:nw},Y1={frag:sw},Xm={frag:iw,vert:ow},VE={frag:rw,vert:lw},LE={frag:aw,vert:cw},X1={frag:fw},Q1={frag:uw},Z1={frag:pw},Qm={frag:mw,vert:dw},qE={frag:hw},RE={frag:gw,vert:vw},zE={frag:_w},BE={frag:bw},Zm={frag:yw,vert:kw},Jm={frag:xw,vert:ww},UE={frag:Mw};var pt=[],J1=[],un={},Ht={},Qf={},Cw=()=>{un={shadowMaps:{value:[Na.depthTexture,$a[1].depthTexture]}};for(let e in Km){let n=Km[e];n.vert&&(n.vert=n.vert.replace("#SHADOWS",le.shadows?1:0)),n.frag&&(n.frag=n.frag.replace("#SHADOWS",le.shadows?1:0))}let t={mesh:["position","uv","normal","color","interiorlight","alpha","worldMatrix"],effect:["position","uv","normal","color","uvshift","ycutoff","worldMatrix"],drop:["position","shine","uv","uvshift","worldMatrix"],particle:["position","info","progress","scaleRota","colStart","colEnd"],ribbon:["position","uv"],foliage:["position","uv","instPos","instNorm"],post:["position","uv"]};pt[13]=cn({vertex:$m.vert,fragment:$m.frag,cullFace:null,instanced:[{name:"instPos",size:4},{name:"instNorm",size:3}],globalUniforms:un,transparent:!0,attributeLocations:t.foliage}),pt[14]=cn({vertex:Nm.vert,fragment:Nm.frag,cullFace:null,instanced:[{name:"instPos",size:4},{name:"instNorm",size:3}],globalUniforms:un,transparent:!0,attributeLocations:t.foliage}),pt[3]=cn({vertex:Wm.vert,fragment:Wm.frag,instanced:[{name:"color",size:4},{name:"alpha",size:1},{name:"interiorlight",size:4}],globalUniforms:un,attributeLocations:t.mesh,transparent:!0}),pt[4]=cn({vertex:Hf.vert,fragment:Hf.frag,instanced:[{name:"interiorlight",size:4}],globalUniforms:un,attributeLocations:t.mesh}),pt[5]=cn({vertex:Hm.vert,fragment:Hm.frag,globalUniforms:un,attributeLocations:t.mesh}),pt[15]=cn({vertex:jm.vert,fragment:jm.frag,globalUniforms:un,transparent:!0,depthWrite:!1,instanced:[{name:"color",size:4},{name:"uvshift",size:4},{name:"ycutoff",size:2}],attributeLocations:t.effect}),pt[6]=cn({vertex:Hf.vert,fragment:U1.frag,globalUniforms:un,instanced:[{name:"interiorlight",size:4}],attributeLocations:t.mesh}),pt[7]=cn({vertex:Gm.vert,fragment:Gm.frag,instanced:[{name:"color",size:4}],globalUniforms:un,attributeLocations:t.mesh}),pt[10]=cn({vertex:Om.vert,fragment:Om.frag,instanced:[{name:"uvshift",size:4},{name:"shine",size:1}],globalUniforms:un,attributeLocations:t.drop}),pt[8]=cn({vertex:Qm.vert,fragment:Qm.frag,globalUniforms:un,attributeLocations:t.mesh}),pt[9]=cn({vertex:Zm.vert,fragment:Zm.frag,globalUniforms:un,attributeLocations:t.mesh}),pt[12]=cn({vertex:Xm.vert,fragment:Z1.frag,transparent:!0,globalUniforms:un,attributeLocations:t.mesh}),pt[20]=cn({vertex:Jm.vert,fragment:Jm.frag,transparent:!0,cullFace:!1,globalUniforms:un,attributeLocations:t.mesh}),pt[11]=cn({vertex:Xm.vert,fragment:X1.frag,cullFace:null,depthTest:!0,globalUniforms:un,attributeLocations:t.mesh}),pt[1]=cn({cullFace:null,vertex:Xf.vert,fragment:Y1.frag,globalUniforms:un,attributeLocations:t.mesh}),pt[2]=cn({vertex:Xf.vert,fragment:Xf.frag,globalUniforms:un,attributeLocations:t.mesh}),pt[16]=cn({vertex:Ym.vert,fragment:O1.frag,transparent:!0,depthWrite:!1,globalUniforms:un,attributeLocations:t.particle}),pt[17]=cn({vertex:Ym.vert,fragment:$1.frag,transparent:!1,globalUniforms:un,attributeLocations:t.particle}),pt[18]=cn({vertex:Yf.vert,fragment:Yf.frag,transparent:!0,cullFace:null,depthWrite:!1,globalUniforms:un,attributeLocations:t.ribbon}),pt[19]=cn({vertex:Yf.vert,fragment:H1.frag,transparent:!0,cullFace:null,depthWrite:!1,globalUniforms:un,attributeLocations:t.ribbon}),pt[32]=cn({vertex:pa,fragment:W1.frag,depthWrite:!1,depthTest:!1,globalUniforms:un,uniforms:{inputA:{value:null}},attributeLocations:t.post}),pt[30]=cn({vertex:pa,fragment:N1.frag,depthWrite:!1,depthTest:!1,uniforms:{inputA:{value:null},offset:{value:[0,0,0,0,0,0,0,0]},amount:{value:[0,0,0,0]}},globalUniforms:un,attributeLocations:t.post}),pt[31]=cn({vertex:pa,fragment:j1.frag,depthWrite:!1,depthTest:!1,uniforms:{inputA:{value:null},inputB:{value:null},amount:{value:1}},globalUniforms:un,attributeLocations:t.post}),pt[33]=cn({vertex:pa,fragment:G1.frag,depthWrite:!1,depthTest:!1,globalUniforms:un,uniforms:{inputA:{value:null},tint:{value:[0,0,0,0]},warp:{value:.5}},attributeLocations:t.post}),pt[34]=cn({vertex:pa,fragment:Q1.frag,uniforms:{seed:{value:Date.now()%1e3}},attributeLocations:["position","uv"]}),OE(pt,un),Ff(pt[18],$.ONE,$.ONE_MINUS_SRC_ALPHA),Ff(pt[16],$.ONE,$.ONE_MINUS_SRC_ALPHA),Ff(pt[15],$.ONE,$.ONE_MINUS_SRC_ALPHA),J1.push(3,4,6,7,10,15,5)},OE=(t,e)=>{let n=t[4].program,s=["Environment","Camera","Pointlights","Shadows","Circle","Screen","Sky","MeshTerrain","Water"],i=[n,n,n,n,n,t[32].program,t[11].program,t[8].program,t[20].program],o=[!0,!0,!0,!0,!0,!0,!0,!1,!1],r=[];for(let l=0;l<s.length;++l){let a=s[l],c=wx(i[l],a,l),f=a.toLowerCase();if(Qf[f]=c,r.push(c),o[l]){let u=Oa(c);al(u),Ht[f]=u}}for(let l=0;l<t.length;++l){let a=t[l];a&&(L3(a,e),q3(a,r))}},Fw,ed=(t,e)=>{if(t!==Fw||e){let n=Ht.camera.data;Fw=t,Mo(n.cameraPosition,t.worldPosition,0),Mo(n.viewMatrix,t.viewMatrix,0),Mo(n.projectionMatrix,t.projectionMatrix,0),Mo(n.projectionViewMatrix,t.projectionViewMatrix,0),is(Ht.camera)}},Sw=(t,e)=>{ds(Ht.screen.data.resolution,t,e),is(Ht.screen)};var Tt=(t,e)=>{let n=t>>16&255,s=t>>8&255,i=t&255,o=[n/255,s/255,i/255];return e!==void 0&&o.push(e),o};var NE=[["white","common"],["green","uncommon"],["blue","rare"],["purp","epic"],["orange", "legendary"],["red", "mythical"]],ja=t=>t>=110?5:t>=99?4:t>=90?3:t>=70?2:t>=50?1:0,Yt=t=>NE[ja(t)];var Ln={black:Tt(0,0),white:Tt(16777215,0),deadgrey:Tt(3355443,0),teal:Tt(3384995,0),magicblue:Tt(3362252,0),paleskin:Tt(14267315,0),darkskin:Tt(8411481,0),slimegreen:Tt(2542694,0),mushgreen:Tt(2077529,0),linen:Tt(13408614,0),woodbrown:Tt(4859433,0),woodbrown2:Tt(10250315,0),tealsteel:Tt(3358797,.5),darksteel:Tt(3355443,.5),greysteel:Tt(5066061,.5),blacksteel:Tt(988178,.5),leather:Tt(4337198,0),emerald:Tt(22866,-.1),gold:Tt(16751616,.9),darkgold:Tt(16747008,.9),paper:Tt(15129011,0),richpurple:Tt(7484623,0),fireorange:Tt(14715686,-.7),archergreen:Tt(10471258,0),warbrown:Tt(15172191,0),bronze:Tt(9258571,.5),silver:Tt(11583679,.6),shamanblue:Tt(3687924,0),mageblue:Tt(6607340,0),bone:Tt(14535066,.2),bone2:Tt(11836267,.2),ice:Tt(14610164,-.2),vanguard:Tt(2848511,0),bloodlust:Tt(14289947,0),pink:Tt(16711935,0),warden:Tt(14755623,0),evilred:Tt(13239043,0),ruby:Tt(15733030,1),moss:Tt(2925637,.2),rock:Tt(5006687,.4),death:Tt(3750201,.8),diamond:Tt(3076559,.9)},K1=[Ln.woodbrown,Ln.bronze,Ln.greysteel,Ln.silver,Ln.gold],Aw=[Ln.diamond,Ln.ruby],eg=[Ln.leather,Ln.greysteel,Ln.silver,Ln.gold,Ln.diamond];var ir=[0,0,0],td={enemy:[1,0,0],friendly:[0,1,0],dead:[.6,.6,.6]},or=t=>{if(I&&I.player){let e=Ft.clientPlayerChangeTarget.packData({target:t});if(t!==qn)if(t>0){let n=I.entity(t);n!==void 0&&(n.type===3?n.canBePickedUpBy(I.player)&&Mt(95):(Mt(93),n.faction===2&&tn(4,100)))}else t===0&&Mt(94);Ha=qn,pl.reset(I.time),I.player.setTarget(t),Ss(e)}qn=t},qn=0,vn=0,id=!1,pl=new kt(0,1),Ha=0,ig=t=>{Ha!==t&&(Ha=t,pl.done(I.time)?(I.player.setTarget(t),qn=t):pl.reset(I.time,vt(pl.passed(I.time)+.5,.5,2)))},ng=0,jE=()=>{nt.lmb.onPress(t=>{ng=I.time}),nt.lmb.onRelease(t=>{rr>0?QE():vn>0&&qf<20&&I.time-ng<.3&&or(vn)}),nt.nextTarget.onPress(t=>{Ga=t.shiftKey?2:1}),nt.nextParty.onPress(t=>{Ga=2}),nt.untarget.onPress(t=>{or(0)})},Zf=(t,e=!0)=>{vn=t,id=e&&vn>0,rp.set(id?"pointer":"auto"),fp.set(vn)},WE=(t,e,n,s)=>{let i=[0,0,0];for(let o=0,r=s.length;o<r;++o){let l=s[o],[a,c,f]=l.hudPos;if(a>0&&a<e&&c>0&&c<n&&f<1){it(i,l.pos),i[1]+=l.size*.3;let u=Kn(i,Vm(gt.worldPosition,ir,i));u<t&&u<(l.size+.7)**2&&l.stats.alive&&(t=u,vn=l.id)}}return t},GE=(t,e,n,s)=>{let i=!1;for(let o=0,r=s.length;o<r;++o){let l=s[o];if(l.hudPos[2]<1){let a=Kn(l.pos,Vm(gt.worldPosition,ir,l.pos));a<t&&(t=a,vn=l.id,i=!0)}}return i},HE=()=>{ao(gt,ir,qm),Xt(ir,ir,gt.worldPosition),Zn(ir,ir);let t=In.width,e=In.height,n=vn,s=20,i=!1;vn=0;for(let o=0;o<=12;++o)o!==3&&o!==11&&(s=WE(s,t,e,I.entities.type[o]));i=vn!==0,GE(Math.min(s,.7),t,e,I.entities.type[3])&&(i=I.entity(vn).canBePickedUpBy(I.player)),(n!=vn||i!==id)&&Zf(vn,i)},Pw=t=>{let e=[0,0,0];aa(An,gt.transform.worldMatrix),ao(gt,e,qm),Xt(e,e,An),Zn(e,e);let n=[0,0];cy(n,An,e,I.player.pos,sd);let s=999;if(t)if(s=n[1]-Math.max(0,n[0]),s<5||n[0]===-1&&n[0]===-1){let o=Vm(An,e,I.player.pos),r=o[0]-I.player.pos[0],l=o[2]-I.player.pos[2],a=1/Math.sqrt(r*r+l*l);it(An,I.player.pos),An[0]+=r*a*sd,An[1]+=10,An[2]+=l*a*sd,Y(e,0,-1,0),s=20}else n[0]>0&&sn(An,An,e,n[0]);dn(e,e,s);let i=I.raycastEnvironmentClosest(An[0],An[1],An[2],e[0],e[1],e[2]);return sn(An,An,e,i),i===1&&(An[1]=I.getHeight(An[0],An[2])),An},YE=t=>{if(pl.done(I.time)&&qn!==Ha&&I.player.setTarget(Ha),!nt.shift.down){if(Rm){vn>0&&(qf>=20||I.time-ng>.3)&&Zf(0,!1);return}HE()}},ti,sg=0,Wa=0,tg=[1,1,1,.3],XE=t=>{let e=qn,n=vn>0?I.getEntityById(vn):void 0;n!==void 0?n!==ti&&(ti!==void 0&&ti.visual!==void 0&&ti.type!==3&&ti.visual.removeColor(tg),n.visual!==void 0&&n.type!==3&&n.visual.addColor(tg),ti=n):ti!==void 0&&ti.visual!==void 0&&(ti.type!==3&&ti.visual.removeColor(tg),ti=void 0);let s=Ht.circle.data;if(rr>0){let i=Pw(!0);es(s.circleInfo,...td.friendly,1),es(s.circlePos,i[0],i[1],i[2],Tw)}else if(e!==sg?(sg=e,Wa=1):Wa=Math.max(Wa*(1-t*10),0),e>0){let i=I.getEntityById(e);if(i!==void 0){es(s.circlePos,i.pos[0],i.pos[1]-i.radius,i.pos[2],i.size+Wa);let o=i.stats&&i.stats.alive?I.player.hostility(i)>0?td.enemy:td.friendly:td.dead;es(s.circleInfo,...o,1-Wa)}}else es(s.circlePos,0,0,0,0);is(Ht.circle)},nd=[],Ga=0,og=t=>{if(I.player){if(Ga===1){let e=0,n=0;t=t.filter(i=>i.visual!==void 0&&i.stats!==void 0&&i.stats.alive&&i!==I.player&&I.player.hostility(i)>0&&I.player.canCombatInteract(i)&&Math.abs(ol(I.player.rot,I.player.rotationToV3(i.pos)))<.7);let s=qn===0;for(let i=t.length-1;i>=0;--i){let o=t[i];s&&(e=o.id),qn===o.id&&(s=!0),n||(n=o.id),e!==0&&(i=0)}e===0&&n!==0&&(e=n),or(e),Ga=0}else if(Ga===2){let e=I.entities.type[0].filter(i=>!le.nextFriendlyTargetAllowNonParty&&!en.has(i.name)?!1:i.stats&&i.stats.alive&&i.faction===I.player.faction&&Dr(i.pos,I.player.pos)<30).sort((i,o)=>{let r=en.has(i.name),l=en.has(o.name);return r&&!l?-1:!r&&l?1:0}),n=e.length;if(e=e.filter(i=>nd.indexOf(i.id)<0),e.length===0)or(I.playerId);else{let i=e[0];or(i.id)}nd.push(qn);let s=Math.min(10,le.nextFriendlyTargetCycle||10,n);for(;s>0&&nd.length>=s;)nd.shift();Ga=0}}},rr=0,sd=0,Tw=0,An=[0,0,0],Jf=(t,e,n)=>{rr=t,sd=e,Tw=n},QE=()=>{rr!==0&&(Ss(Ft.clientPlayerEnvSkill.packData({id:rr,info:[],pos:An})),Jf(0,0,0))},ZE=()=>{Ha=0,pl.reset(0),ti=void 0,sg=0,Wa=0};function Ew(t,e,n){let s=t.slice();return s[26]=e[n],s}function Dw(t){let e,n,s,i,o,r,l,a,c,f,u,p=[],g=new Map,v,_,b,y,k,S,A=t[2]=="default"&&Iw(t);a=new vs({props:{size:"1.3em",fract:t[8],barcol:t[13],left:t[10],right:t[6],darken:!1,$$slots:{default:[JE]},$$scope:{ctx:t}}});let F=(t[2]=="default"||t[18])&&Lw(t);function M(q,j){return q[5].role>=1?tD:eD}let D=M(t,-1),L=D(t),E=t[2]=="default"&&t[5].combat&&t[5].alive&&qw(t),R=me(t[19]),z=q=>q[26].id;for(let q=0;q<R.length;q+=1){let j=Ew(t,R,q),W=z(j);g.set(W,p[q]=Rw(W,j))}return{c(){e=h("div"),n=h("div"),A&&A.c(),s=h("img"),r=h("div"),l=h("div"),ne(a.$$.fragment),F&&F.c(),L.c(),f=be(),E&&E.c(),u=h("div");for(let q=0;q<p.length;q+=1)p[q].c();m(s,"class",i="pclass icon border black bgc"+t[5].class+" svelte-g292qg"),at(s.src,o=(t[5].rarity!==!1?"/data/ui/mobpower/"+t[5].rarity:"/data/ui/classes/"+t[5].class)+"."+On+"?v=8593107")||m(s,"src",o),m(n,"class","iconcontainer svelte-g292qg"),m(l,"class",c="panel-black barsInner "+(t[5].id&&t[5].range?"targetable":"")+" svelte-g292qg"),m(u,"class",v="buffarray "+t[2]+" svelte-g292qg"),m(r,"class",_="bars "+(t[17]&&t[5].id==t[17].id&&t[2]=="party"?"target":"")+" svelte-g292qg"),m(e,"id",t[4]),m(e,"class",b="grid "+(t[3]?"right":"left")+" svelte-g292qg"),qe(e,"font-size",t[15]+"%"),qe(e,"opacity",t[5].range?"":.6)},m(q,j){w(q,e,j),d(e,n),A&&A.m(n,null),d(n,s),d(e,r),d(r,l),ee(a,l,null),F&&F.m(l,null),L.m(r,null),d(r,f),E&&E.m(r,null),d(r,u);for(let W=0;W<p.length;W+=1)p[W]&&p[W].m(u,null);y=!0,k||(S=[X(l,"click",t[20]),X(l,"contextmenu",t[25])],k=!0)},p(q,j){q[2]=="default"?A||(A=Iw(q),A.c(),A.m(n,s)):A&&(A.d(1),A=null),(!y||j&32&&i!==(i="pclass icon border black bgc"+q[5].class+" svelte-g292qg"))&&m(s,"class",i),(!y||j&32&&!at(s.src,o=(q[5].rarity!==!1?"/data/ui/mobpower/"+q[5].rarity:"/data/ui/classes/"+q[5].class)+"."+On+"?v=8593107"))&&m(s,"src",o);let W={};j&256&&(W.fract=q[8]),j&8192&&(W.barcol=q[13]),j&1024&&(W.left=q[10]),j&64&&(W.right=q[6]),j&536895748&&(W.$$scope={dirty:j,ctx:q}),a.$set(W),q[2]=="default"||q[18]?F?(F.p(q,j),j&262148&&P(F,1)):(F=Lw(q),F.c(),P(F,1),F.m(l,null)):F&&(Ee(),V(F,1,1,()=>{F=null}),De()),(!y||j&32&&c!==(c="panel-black barsInner "+(q[5].id&&q[5].range?"targetable":"")+" svelte-g292qg"))&&m(l,"class",c),D===(D=M(q,j))&&L?L.p(q,j):(L.d(1),L=D(q),L&&(L.c(),L.m(r,f))),q[2]=="default"&&q[5].combat&&q[5].alive?E||(E=qw(q),E.c(),E.m(r,u)):E&&(E.d(1),E=null),j&524292&&(R=me(q[19]),Ee(),p=us(p,j,z,1,q,R,g,u,Is,Rw,null,Ew),De()),(!y||j&4&&v!==(v="buffarray "+q[2]+" svelte-g292qg"))&&m(u,"class",v),(!y||j&131108&&_!==(_="bars "+(q[17]&&q[5].id==q[17].id&&q[2]=="party"?"target":"")+" svelte-g292qg"))&&m(r,"class",_),(!y||j&16)&&m(e,"id",q[4]),(!y||j&8&&b!==(b="grid "+(q[3]?"right":"left")+" svelte-g292qg"))&&m(e,"class",b),(!y||j&32768)&&qe(e,"font-size",q[15]+"%"),(!y||j&32)&&qe(e,"opacity",q[5].range?"":.6)},i(q){if(!y){P(a.$$.fragment,q),P(F);for(let j=0;j<R.length;j+=1)P(p[j]);y=!0}},o(q){V(a.$$.fragment,q),V(F);for(let j=0;j<p.length;j+=1)V(p[j]);y=!1},d(q){q&&x(e),A&&A.d(),te(a),F&&F.d(),L.d(),E&&E.d();for(let j=0;j<p.length;j+=1)p[j].d();k=!1,lt(S)}}}function Iw(t){let e;return{c(){e=h("div"),m(e,"class","deco svelte-g292qg")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function Vw(t){let e,n,s;return{c(){e=h("div"),m(e,"class",n="progressBar "+t[13]+" hpdelta svelte-g292qg"),m(e,"style",s=(t[14]?"transition:none;":"")+"width:"+t[8]+"%;")},m(i,o){w(i,e,o)},p(i,o){o&8192&&n!==(n="progressBar "+i[13]+" hpdelta svelte-g292qg")&&m(e,"class",n),o&16640&&s!==(s=(i[14]?"transition:none;":"")+"width:"+i[8]+"%;")&&m(e,"style",s)},d(i){i&&x(e)}}}function JE(t){let e,n=t[2]=="default"&&Vw(t);return{c(){n&&n.c(),e=be()},m(s,i){n&&n.m(s,i),w(s,e,i)},p(s,i){s[2]=="default"?n?n.p(s,i):(n=Vw(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(s){s&&x(e),n&&n.d(s)}}}function Lw(t){let e,n;return e=new vs({props:{size:"0.7em",fract:t[9],barcol:t[16],left:t[11],right:t[7],darken:!0,$$slots:{default:[KE]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&512&&(o.fract=s[9]),i&65536&&(o.barcol=s[16]),i&2048&&(o.left=s[11]),i&128&&(o.right=s[7]),i&536875008&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function KE(t){let e;return{c(){e=h("div"),m(e,"class","progressBar bgspell castbar svelte-g292qg"),qe(e,"width",t[12]+"%"),qe(e,"display",t[12]>0?"inherit":"none")},m(n,s){w(n,e,s)},p(n,s){s&4096&&qe(e,"width",n[12]+"%"),s&4096&&qe(e,"display",n[12]>0?"inherit":"none")},d(n){n&&x(e)}}}function eD(t){let e,n,s;return{c(){e=h("img"),m(e,"class",n="tag icon border black bgf"+t[5].faction+" round svelte-g292qg"),at(e.src,s="/data/ui/factions/"+t[5].faction+"."+On+"?v=8593107")||m(e,"src",s)},m(i,o){w(i,e,o)},p(i,o){o&32&&n!==(n="tag icon border black bgf"+i[5].faction+" round svelte-g292qg")&&m(e,"class",n),o&32&&!at(e.src,s="/data/ui/factions/"+i[5].faction+"."+On+"?v=8593107")&&m(e,"src",s)},d(i){i&&x(e)}}}function tD(t){let e,n;return{c(){e=h("img"),m(e,"class","tag icon border black bgblack round svelte-g292qg"),at(e.src,n="/data/ui/icons/"+(t[5].role==2?"star":"starsilver")+"."+On+"?v=8593107")||m(e,"src",n)},m(s,i){w(s,e,i)},p(s,i){i&32&&!at(e.src,n="/data/ui/icons/"+(s[5].role==2?"star":"starsilver")+"."+On+"?v=8593107")&&m(e,"src",n)},d(s){s&&x(e)}}}function qw(t){let e;return{c(){e=h("div"),m(e,"class","tag icon border black round combat svelte-g292qg")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function Rw(t,e){let n,s,i,o=[e[26],{size:e[2]=="default"?31:23}],r={};for(let l=0;l<o.length;l+=1)r=Nl(r,o[l]);return s=new kx({props:r}),{key:t,first:null,c(){n=be(),ne(s.$$.fragment),this.first=n},m(l,a){w(l,n,a),ee(s,l,a),i=!0},p(l,a){e=l;let c=a&524292?np(o,[a&524288&&sp(e[26]),a&4&&{size:e[2]=="default"?31:23}]):{};s.$set(c)},i(l){i||(P(s.$$.fragment,l),i=!0)},o(l){V(s.$$.fragment,l),i=!1},d(l){l&&x(n),te(s,l)}}}function nD(t){let e,n,s=t[5].visible&&Dw(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[5].visible?s?(s.p(i,o),o&32&&P(s,1)):(s=Dw(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function sD(t,e,n){let s,i,o,r,l=ue,a=()=>(l(),l=li(v,se=>n(5,r=se)),v),c,f,u,p=ue,g=()=>(p(),p=li(_,se=>n(19,u=se)),_);oe(t,Ui,se=>n(17,c=se)),oe(t,ga,se=>n(18,f=se)),t.$$.on_destroy.push(()=>l()),t.$$.on_destroy.push(()=>p());let{unit:v}=e;a();let{buffs:_}=e;g();let{mode:b="default"}=e,{order:y=0}=e,{id:k=""}=e,S,A,F,M,D,L,E,R,z,q,j=!1,W=0,N=se=>{r.id&&or(r.id)},O=se=>Jk(se,r);return t.$$set=se=>{"unit"in se&&a(n(0,v=se.unit)),"buffs"in se&&g(n(1,_=se.buffs)),"mode"in se&&n(2,b=se.mode),"order"in se&&n(3,y=se.order),"id"in se&&n(4,k=se.id)},t.$$.update=()=>{t.$$.dirty&32&&n(24,s=r.world==I.id?r.alive?!1:"Dead":r.world),t.$$.dirty&18874404&&(n(21,S=r.hpMax?b=="default"?ns(r.hp)+"/"+ns(r.hpMax):ns(r.hp):"?"),n(6,F=s||S),n(8,D=s!="offline"?~~(r.hpMax?r.hp/r.hpMax*100:100):0),n(13,q=s?"bggrey":(I.mode.partyBasedHostility?r.party===I.player.party:r.faction===I.player.faction)?"bghealth":"bgenemy")),t.$$.dirty&36&&n(22,A=r.mpMax?b=="default"?ns(r.mp)+"/"+ns(r.mpMax):ns(r.mp):"?"),t.$$.dirty&32&&n(10,E=r.name?mx(r.name,10):""),t.$$.dirty&32&&n(11,R=r.timedSkill?(C.ui.hiddenskills[r.timedSkill.id]||C.items.book[r.timedSkill.id]).name:`Lv. ${r.level}`),t.$$.dirty&20971552&&n(7,M=s||(r.timedSkill?r.timedCast.remaining(I.smoothtime).toFixed(1):A)),t.$$.dirty&16777248&&n(9,L=s!="offline"?~~(r.mpMax?r.mp/r.mpMax*100:100):0),t.$$.dirty&16777248&&n(12,z=s!="offline"&&r.timedSkill?r.timedCast.fraction(I.smoothtime)*100:0),t.$$.dirty&16777216&&n(16,i=s?"bggrey":"bgmana"),t.$$.dirty&4&&n(15,o=Math.round(b=="default"?100:85)),t.$$.dirty&8388640&&(n(14,j=W!=r.id),n(23,W=r.id))},[v,_,b,y,k,r,F,M,D,L,E,R,z,q,j,o,i,c,f,u,N,S,A,W,s,O]}var lg=class extends Fe{constructor(e){super(),Se(this,e,sD,nD,Oe,{unit:0,buffs:1,mode:2,order:3,id:4})}},Kf=lg;function iD(t){let e,n,s,i;return n=new Kf({props:{id:"ufplayer",order:0,unit:Bi,buffs:ea}}),s=new Kf({props:{id:"uftarget",order:1,unit:Ui,buffs:Vc}}),{c(){e=h("div"),ne(n.$$.fragment),ne(s.$$.fragment),m(e,"class","targetframes svelte-17up9g6")},m(o,r){w(o,e,r),ee(n,e,null),ee(s,e,null),i=!0},p:ue,i(o){i||(P(n.$$.fragment,o),P(s.$$.fragment,o),i=!0)},o(o){V(n.$$.fragment,o),V(s.$$.fragment,o),i=!1},d(o){o&&x(e),te(n),te(s)}}}var ag=class extends Fe{constructor(e){super(),Se(this,e,null,iD,Fn,{})}},zw=ag;function Bw(t){let e,n;return{c(){e=h("span"),n=T(t[2]),m(e,"class","slottext key svelte-1p1x0hl")},m(s,i){w(s,e,i),d(e,n)},p(s,i){i[0]&4&&G(n,s[2])},d(s){s&&x(e)}}}function Uw(t){let e,n;return{c(){e=h("span"),n=T(t[3]),m(e,"class","slottext stacks svelte-1p1x0hl")},m(s,i){w(s,e,i),d(e,n)},p(s,i){i[0]&8&&G(n,s[3])},d(s){s&&x(e)}}}function Ow(t){let e,n=(t[5]>99?Math.round(t[5]/60)+"'":t[5]<=3?t[5].toFixed(1):Math.ceil(t[5]))+"",s;return{c(){e=h("div"),s=T(n),m(e,"class","time absCentered slottext svelte-1p1x0hl")},m(i,o){w(i,e,o),d(e,s)},p(i,o){o[0]&32&&n!==(n=(i[5]>99?Math.round(i[5]/60)+"'":i[5]<=3?i[5].toFixed(1):Math.ceil(i[5]))+"")&&G(s,n)},d(i){i&&x(e)}}}function $w(t){let e;return{c(){e=h("div"),m(e,"class","autocast svelte-1p1x0hl")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function Nw(t){let e,n,s,i=t[31].default,o=jl(i,t,t[30],null);return{c(){e=h("div"),o&&o.c(),m(e,"class",n="border "+t[6]+" slotdescription svelte-1p1x0hl"),m(e,"style",t[10])},m(r,l){w(r,e,l),o&&o.m(e,null),t[33](e),s=!0},p(r,l){o&&o.p&&(!s||l[0]&1073741824)&&Gl(o,i,r,r[30],s?Wl(i,r[30],l,null):Hl(r[30]),null),(!s||l[0]&64&&n!==(n="border "+r[6]+" slotdescription svelte-1p1x0hl"))&&m(e,"class",n),(!s||l[0]&1024)&&m(e,"style",r[10])},i(r){s||(P(o,r),s=!0)},o(r){V(o,r),s=!1},d(r){r&&x(e),o&&o.d(r),t[33](null)}}}function oD(t){let e,n,s,i,o,r,l,a,c,f,u,p,g,v,_,b,y=t[2]!==void 0&&Bw(t),k=t[3]!==void 0&&Uw(t),S=le.cdTextSkills&&t[5]!==void 0&&Ow(t),A=t[11]&&$w(t),F=t[9]&&t[0]&&!t[15]&&Nw(t);return{c(){e=h("div"),y&&y.c(),n=be(),k&&k.c(),s=be(),S&&S.c(),i=h("div"),r=h("div"),a=h("div"),A&&A.c(),f=h("img"),F&&F.c(),m(i,"class",o="overlay "+(t[4]!==void 0?"":"hidden")+" svelte-1p1x0hl"),m(r,"class",l="overlay "+t[16]+" svelte-1p1x0hl"),m(a,"class",c="overlay "+(!t[14]||t[4]>0&&t[4]<10?"hidden":"offCd")+" svelte-1p1x0hl"),m(f,"class",u="icon "+t[7]+" svelte-1p1x0hl"),at(f.src,p=t[17])||m(f,"src",p),m(e,"id",t[8]),m(e,"class",g="border "+t[6]+" "+(t[15]&&t[15].data==t[1]?"grey":"")+" slot "+(t[1]?"filled":"")+" svelte-1p1x0hl")},m(M,D){w(M,e,D),y&&y.m(e,null),d(e,n),k&&k.m(e,null),d(e,s),S&&S.m(e,null),d(e,i),t[32](i),d(e,r),d(e,a),A&&A.m(e,null),d(e,f),F&&F.m(e,null),v=!0,_||(b=[X(e,"pointerenter",t[20]),X(e,"pointerleave",t[21]),X(e,"pointerdown",t[18]),X(e,"pointerup",t[19])],_=!0)},p(M,D){M[2]!==void 0?y?y.p(M,D):(y=Bw(M),y.c(),y.m(e,n)):y&&(y.d(1),y=null),M[3]!==void 0?k?k.p(M,D):(k=Uw(M),k.c(),k.m(e,s)):k&&(k.d(1),k=null),le.cdTextSkills&&M[5]!==void 0?S?S.p(M,D):(S=Ow(M),S.c(),S.m(e,i)):S&&(S.d(1),S=null),(!v||D[0]&16&&o!==(o="overlay "+(M[4]!==void 0?"":"hidden")+" svelte-1p1x0hl"))&&m(i,"class",o),(!v||D[0]&65536&&l!==(l="overlay "+M[16]+" svelte-1p1x0hl"))&&m(r,"class",l),(!v||D[0]&16400&&c!==(c="overlay "+(!M[14]||M[4]>0&&M[4]<10?"hidden":"offCd")+" svelte-1p1x0hl"))&&m(a,"class",c),M[11]?A||(A=$w(M),A.c(),A.m(e,f)):A&&(A.d(1),A=null),(!v||D[0]&128&&u!==(u="icon "+M[7]+" svelte-1p1x0hl"))&&m(f,"class",u),(!v||D[0]&131072&&!at(f.src,p=M[17]))&&m(f,"src",p),M[9]&&M[0]&&!M[15]?F?(F.p(M,D),D[0]&33281&&P(F,1)):(F=Nw(M),F.c(),P(F,1),F.m(e,null)):F&&(Ee(),V(F,1,1,()=>{F=null}),De()),(!v||D[0]&256)&&m(e,"id",M[8]),(!v||D[0]&32834&&g!==(g="border "+M[6]+" "+(M[15]&&M[15].data==M[1]?"grey":"")+" slot "+(M[1]?"filled":"")+" svelte-1p1x0hl"))&&m(e,"class",g)},i(M){v||(P(F),v=!0)},o(M){V(F),v=!1},d(M){M&&x(e),y&&y.d(),k&&k.d(),S&&S.d(),t[32](null),A&&A.d(),F&&F.d(),_=!1,lt(b)}}}function rD(t,e,n){let s,i,o,r;oe(t,En,H=>n(15,r=H));let{$$slots:l={},$$scope:a}=e,{data:c=void 0}=e,{key:f}=e,{stacks:u}=e,{cd:p}=e,{remaining:g}=e,{border:v="grey"}=e,{img:_}=e,{meta:b}=e,{css:y=""}=e,{id:k=""}=e,{describe:S=!0}=e,{queued:A=!1}=e,{pickable:F=!0}=e,{descRoot:M}=e,{descPos:D="bottom: 100%; right: 100%;"}=e,{auto:L=!1}=e,{status:E=0}=e,{hover:R=!1}=e,{clickToUse:z=!1}=e,{shift:q=!1}=e,j=!1,W=(H,de)=>H?"queued":de==5?"oom":de==6?"range":de==11||de==9?"combat":"hidden",N,O=H=>{z&&!q?Ne("use",{e:H,...b}):(j=!0,ke(!1),Ne("click",b))},se=H=>{H.button==2?q?Ne("use",{e:H,...b}):Ne("context",{e:H,...b}):r?(r.data.type&&Mt(Rs[r.data.type].sound),Ne("move",{from:r.meta,to:b}),r.meta&&r.meta.store&&r.meta.store.set(),tt(En,r=void 0,r)):(!z||q)&&ge(),j=!1},re=H=>{ke(!0)},ie=()=>{Ne("discard")},ce=H=>{ke(!1),c&&j&&(j=!1,ge())},ke=H=>{R!=="force"&&n(0,R=H)},ge=()=>{!c||F===!1||(c.moving||tt(En,r={data:c,img:_,meta:b,border:v,css:y,discard:ie},r),c.type&&Mt(Rs[c.type].sound))},Ne=Cr(),Te;function Ce(H){Nt[H?"unshift":"push"](()=>{Te=H,n(13,Te)})}function _e(H){Nt[H?"unshift":"push"](()=>{N=H,n(12,N)})}return t.$$set=H=>{"data"in H&&n(1,c=H.data),"key"in H&&n(2,f=H.key),"stacks"in H&&n(3,u=H.stacks),"cd"in H&&n(4,p=H.cd),"remaining"in H&&n(5,g=H.remaining),"border"in H&&n(6,v=H.border),"img"in H&&n(22,_=H.img),"meta"in H&&n(23,b=H.meta),"css"in H&&n(7,y=H.css),"id"in H&&n(8,k=H.id),"describe"in H&&n(9,S=H.describe),"queued"in H&&n(24,A=H.queued),"pickable"in H&&n(25,F=H.pickable),"descRoot"in H&&n(26,M=H.descRoot),"descPos"in H&&n(10,D=H.descPos),"auto"in H&&n(11,L=H.auto),"status"in H&&n(27,E=H.status),"hover"in H&&n(0,R=H.hover),"clickToUse"in H&&n(28,z=H.clickToUse),"shift"in H&&n(29,q=H.shift),"$$scope"in H&&n(30,a=H.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&16400&&n(14,s=s||p>0),t.$$.dirty[0]&138444817&&n(17,i=_?r&&R||p>0||E==-1?_.replace(/(?<!githubusercontent)\.(?!githubusercontent)/,"_grey.").replace(/_q[0-9]/g,""):_:`/data/ui/slotbg/bg.${Gn}?v=8593107`),t.$$.dirty[0]&150996992&&n(16,o=W(L||A,E)),t.$$.dirty[0]&67112960&&N&&M&&M.appendChild(N),t.$$.dirty[0]&8208&&Gf(Math.floor(p||0),Te,40)},[R,c,f,u,p,g,v,y,k,S,D,L,N,Te,s,r,o,i,O,se,re,ce,_,b,A,F,M,E,z,q,a,l,Ce,_e]}var cg=class extends Fe{constructor(e){super(),Se(this,e,rD,oD,Fn,{data:1,key:2,stacks:3,cd:4,remaining:5,border:6,img:22,meta:23,css:7,id:8,describe:9,queued:24,pickable:25,descRoot:26,descPos:10,auto:11,status:27,hover:0,clickToUse:28,shift:29},null,[-1,-1])}},ml=cg;var jw=(t,e)=>typeof t=="function"?t(e):t;var eu=Object.keys({onBlock:0,statsStatic:0,statsConvert:0,statsOverride:0,onInterval:0,multiplyIncomingHeal:0,multiplyIncomingDamage:0,addIncomingHeal:0,addIncomingDamage:0,addIncomingCrit:0,afterDamageEnemy:0,afterHealAlly:0,beforeDamageEnemy:0,beforeIncomingDamage:0,afterIncomingDamage:0,movementOverride:0,incapacitated:0,breakOnMove:0,breakOnCast:0,instantCast:0,onCast:0,onEnd:0,immuneAll:0,immuneCC:0,breakAfterPercentDamage:0}),he=class{constructor(e){this.id=e.id,this.intervalHaste=e.intervalHaste!==!1,this.intervalDuration=e.intervalDuration,this.intervalOnApply=e.intervalOnApply||!1,this.maxStacks=e.maxStacks,this.passive=e.passive||!1,this.clearOnDeath=e.clearOnDeath!==!1,this.custom=e.custom,this.unique=e.unique||!1,this.dr=e.dr||0,this.type=e.type||0,this.tags=e.tags||new Set,this.immuneAll=e.immuneAll||!1,this.immuneCC=e.immuneCC||!1,eu.forEach(n=>{this[n]=e[n]}),this.customIcon=e.customIcon,this.icon=e.icon,this.fx=e.fx||{}}onSet(e,n,s){this.tags.forEach(i=>{s.tags.get(i).add(e)}),eu.forEach(i=>{this[i]&&(i!=="incapacitated"&&i!=="movementOverride"||s.immuneCC.size<=0)&&s[i].add(e)})}onRemove(e,n,s){this.tags.forEach(i=>{s.tags.get(i).delete(e)}),eu.forEach(i=>{this[i]&&s[i].delete(e)})}};var Ww=new he({id:77,passive:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(t.level*40)),e.addStat(28,Math.round(t.level*200))}});var Gw=new he({id:59,tags:new Set([11]),icon:"ui/skills/2",fx:{stick:15},statsStatic:(t,e)=>{e.addStat(13,300+t.level*40)}});var od=(t,e)=>t*e/65535;var Hw=(t,e)=>{let n=e/65535;return[(t>>>16)*n,(t&65535)*n]};var _s=t=>t/60;var Ya=(t,e)=>{if(t.static||!e.data)return!1;let n=Hw(e.data[0]*2,6400),s=[n[0]-t.pos[0],n[1]-t.pos[2]];return wa(s)>t.size?(t.setSteer(0,1),t.setRot(il(s)),t.setJump(0),!0):(t.setSteer(0,0),!1)};var Yw=new he({id:87,incapacitated:!0,icon:"ui/skills/33",fx:{stick:74,endSound:65},statsOverride:(t,e)=>{e.stat.set(15,250)},movementOverride:(t,e,n,s,i)=>{Ya(s,i)||s.buffs.removeBuff(i.id,s.id)}});var Xw=new he({id:76,icon:"ui/skills/20",fx:{stick:53},unique:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(t.level*30)),e.addStat(9,Math.round(t.level*22))}});var Qw=new he({id:73,passive:!0,icon:"ui/skills/17",custom:[[t=>93+t*32,"% as additional damage over 10 seconds"]],afterDamageEnemy:{3:(t,e,n)=>{}}});var Zw=new he({id:74,type:1,tags:new Set([1]),maxStacks:3,icon:"ui/skills/18",fx:{stick:38,color:[.7,.1,.1,.5]},intervalDuration:1.5,onInterval:(t,e,n)=>({id:18,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,noDaze:!0,type:1})});var Jw=new he({id:72,icon:"ui/skills/17",fx:{stick:18,color:[.9,.3,.1,.7]},custom:[[t=>t*12,"% increased damage"]]});var Kw=new he({id:121,incapacitated:!0,type:1,tags:new Set([7]),dr:3,breakAfterPercentDamage:.1,icon:"ui/skills/50",fx:{stick:86,incapacitated:!0},statsOverride:(t,e)=>{e.stat.get(15)>100&&e.stat.set(15,100)},movementOverride:(t,e,n,s,i)=>{Ya(s,i)},intervalDuration:1});var e4=new he({id:61,passive:!0,icon:"ui/skills/8",statsConvert:[[0,.3,10],[0,.3,11],[0,.3,8]]});var t4=new he({id:89,type:1,tags:new Set([3]),icon:"ui/skills/34",statsStatic:(t,e)=>{e.maxStat(29,10+t.level*10)}});var n4=new he({id:105,maxStacks:3,icon:"ui/skills/temperBoostBuff",fx:{stick:24,color:[.2,.2,.25,.95]},statsStatic:(t,e)=>{e.addStat(15,20)}});var s4=new he({id:104,maxStacks:3,tags:new Set([3,4]),icon:"ui/skills/41",fx:{stick:23,color:[.1,.1,.1,.92]},intervalDuration:.5,onInterval:(t,e,n)=>!0});var i4=new he({id:75,icon:"ui/skills/19",fx:{stick:54},unique:!0,statsStatic:(t,e)=>{e.addStat(10,t.level*3),e.addStat(11,t.level*4),e.addStat(6,t.level*50)}});var o4=new he({id:115,incapacitated:!0,tags:new Set([8]),immuneCC:!0,icon:"ui/skills/46",fx:{anim:34},statsStatic:(t,e)=>{e.maxStat(29,40)},statsOverride:(t,e)=>{e.stat.set(13,0)},intervalDuration:.5,onInterval:(t,e,n)=>!0});var r4=new he({id:91,type:1,tags:new Set([6]),incapacitated:!0,dr:3,icon:"ui/skills/37",fx:{visual:20,stick:88,endSound:69},statsStatic:(t,e)=>{e.maxStat(29,30+t.level*7),e.maxStat(30,20+t.level*5)}});var l4=new he({id:84,icon:"ui/skills/28",fx:{stick:65},unique:!0,statsStatic:(t,e)=>{e.addStat(16,100+t.level*60)}});var a4=new he({id:67,type:1,tags:new Set([3,1]),icon:"ui/skills/12",fx:{apply:50,stick:49,color:[.5,.4,.05,.5]},statsStatic:(t,e)=>{e.maxStat(29,20+t.level*3)},intervalDuration:1.5,onInterval:(t,e,n)=>({id:12,mode:1,caster:t.caster,target:e.id,dmg:1+n.stats.getDamageRoll()*(.1+t.level*.08),type:1,noDaze:!0})});var c4=new he({id:68,icon:"ui/skills/13",fx:{stick:52},intervalDuration:1,custom:[[t=>30+40*t,"MP recovered"]],onInterval:(t,e,n)=>{}});var f4=new he({id:107,maxStacks:5,icon:"ui/skills/43",fx:{stick:20}});var u4=new he({id:106,passive:!0});var p4=new he({id:60,maxStacks:3,icon:"ui/skills/7",fx:{stick:37},intervalDuration:1,multiplyIncomingHeal:{6:t=>1+t.stacks*.3,7:t=>1+(t.stacks-1)*.3},onInterval:(t,e,n)=>({id:7,mode:2,caster:t.caster,target:e.id,heal:6+n.stats.getDamageRoll()*(.028+t.level*.024)})});var m4=new he({id:64,passive:!0,icon:"ui/skills/8",statsConvert:[[4,.4,10],[4,.4,11]]});var d4=new he({id:90,breakOnCast:!0,icon:"ui/skills/36",fx:{visual:26,apply:76,endSound:69},statsStatic:(t,e)=>{e.addStat(15,8+t.level*12)}});var h4=new he({id:119,incapacitated:!0,type:1,tags:new Set([7]),dr:3,breakAfterPercentDamage:.1,icon:"ui/skills/49",fx:{incapacitated:!0,apply:122,stick:124},statsOverride:(t,e)=>{e.stat.get(15)>50&&e.stat.set(15,50)},movementOverride:(t,e,n,s,i)=>{Ya(s,i)}});var g4=new he({id:120,passive:!0});var v4=new he({id:82,passive:!0,statsStatic:(t,e)=>{e.addStat(14,Math.round(t.level*30))}});var _4=new he({id:66,icon:"ui/skills/11",fx:{stick:39,endSound:69},custom:[[t=>t*9,"% increased damage"]]});var b4=new he({id:83,icon:"ui/skills/27",fx:{stick:63},unique:!0,statsStatic:(t,e)=>{e.addStat(15,5+t.level*13)}});var y4=new he({id:85,passive:!0,icon:"ui/skills/29",custom:[[t=>40+t*21,"% per stack as additional damage over 10 seconds"]],afterDamageEnemy:{9:(t,e,n)=>{}}});var k4=new he({id:86,type:1,maxStacks:3,tags:new Set([3,1]),icon:"ui/skills/29",fx:{apply:51,stick:66,color:[.1,1,.3,.3]},statsStatic:(t,e)=>{e.maxStat(29,30)},intervalDuration:1.5,onInterval:(t,e,n)=>({id:29,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,type:1,noDaze:!0})});var x4=new he({id:95,maxStacks:4,icon:"ui/skills/31",instantCast:new Set([31]),beforeDamageEnemy:{31:(t,e,n,s)=>{}}});var w4=new he({id:65,passive:!0,icon:"ui/skills/10",custom:[[t=>2+t*1," Jumps"],[t=>15+t*12.5,"% damage per Jump"]],afterDamageEnemy:{9:(t,e,n)=>{}}});var M4=new he({id:92,icon:"ui/skills/38",fx:{stick:77},statsStatic:(t,e)=>{e.addStat(15,30)},instantCast:new Set([9]),onCast:{9:(t,e)=>{}}});var F4=new he({id:96,passive:!1,incapacitated:!0,icon:"ui/skills/38",statsOverride:(t,e)=>{e.stat.set(15,400)},movementOverride:(t,e,n,s,i)=>{s.setSteer(i.data[0]-1,i.data[1]-1)}});var C4=new he({id:63,passive:!0,icon:"ui/skills/8",statsConvert:[[2,.4,10],[2,.4,11]]});var S4=new he({id:81,icon:"ui/skills/25",fx:{stick:64},unique:!0,statsStatic:(t,e)=>{e.addStat(16,t.level*30)}});var A4=new he({id:118,passive:!0});var P4=new he({id:114,incapacitated:!0,tags:new Set([8]),icon:"ui/skills/45",fx:{anim:33},intervalHaste:!1,intervalDuration:.25,statsStatic:(t,e)=>{e.maxStat(29,15)},onInterval:(t,e,n)=>!0});var T4=new he({id:78,icon:"ui/skills/22",fx:{stick:60},unique:!0,statsStatic:(t,e)=>{e.addStat(14,t.level*30)}});var E4=new he({id:101,type:1,tags:new Set([5]),incapacitated:!0,dr:1,icon:"ui/skills/deepFrozen",fx:{stick:57,color:[.1,.9,.8,.9],frozen:!0},statsStatic:(t,e)=>{e.maxStat(29,100)},multiplyIncomingDamage:{4:t=>1+t.level*.1,15:t=>1+t.level*.1,51:t=>1+t.level*.1}});var D4=new he({id:80,icon:"ui/skills/24",fx:{stick:91},unique:!0,statsStatic:(t,e)=>{e.addStat(10,Math.floor(2+t.level*1.5)),e.addStat(11,Math.floor(3+t.level*3.5))}});var I4=new he({id:108,icon:"ui/skills/extraBolt",fx:{stick:22}});var V4=new he({id:116,incapacitated:!0,tags:new Set([8,10]),breakOnMove:!0,icon:"ui/skills/52",fx:{anim:35},intervalDuration:1,intervalOnApply:1,onInterval:(t,e,n)=>!0});var L4=new he({id:69,type:1,tags:new Set([4]),dr:2,icon:"ui/skills/14",fx:{stick:56,color:[.7,.7,1,.4]},statsStatic:(t,e)=>{e.maxStat(29,100)},addIncomingCrit:{4:t=>10+t.level*30,15:t=>20+t.level*30},intervalDuration:1.5,onInterval:(t,e,n)=>({id:14,mode:1,caster:t.caster,target:e.id,dmg:n.stats.getDamageRoll()*(.09+t.level*.27),type:1,noDaze:!0})});var q4=new he({id:99,type:1,tags:new Set([3]),maxStacks:4,icon:"ui/skills/frozenBuff",fx:{stick:58,color:[.1,.1,.8,.5]},statsStatic:(t,e)=>{e.maxStat(29,20)}});var R4=new he({id:71,icon:"ui/skills/16",fx:{stick:40,endSound:69},statsStatic:(t,e)=>{e.addStat(16,30+t.level*70),e.addStat(27,2+t.level*8)}});var z4=new he({id:117,incapacitated:!0,tags:new Set([9,11,12]),immuneAll:!0,intervalDuration:1,intervalHaste:!1,icon:"ui/skills/53",fx:{stick:120,frozen:!0},statsStatic:(t,e)=>{e.maxStat(29,100)},onInterval:(t,e,n)=>({id:53,mode:2,caster:t.caster,target:n.id,heal:t.level*50,nocrit:!0})});var B4=new he({id:100,passive:!0});var U4=new he({id:79,icon:"ui/skills/23",fx:{stick:17}});var O4=new he({id:70,passive:!0});var $4=new he({id:62,passive:!0,icon:"ui/skills/8",statsConvert:[[3,.4,10],[3,.4,11]]});var N4=new he({id:112,type:0,icon:"ui/skills/charm4",fx:{stick:42,color:[0,0,1,.7]}});var j4=new he({id:113,type:1,tags:new Set([1]),maxStacks:10,icon:"ui/skills/firebuff",fx:{stick:67,color:[2,1,.3,1]}});var W4=new he({id:126,type:1,tags:new Set([1]),maxStacks:5,icon:"ui/skills/firebuff",fx:{stick:132,apply:135,color:[.7,.1,1.5,1]}});var G4=new he({id:94,type:1,tags:new Set([3]),icon:"ui/skills/dazedBuff",fx:{stick:73},statsStatic:(t,e)=>{e.maxStat(29,30)}});var H4=new he({id:110,type:0,icon:"ui/skills/charm2",fx:{stick:21,color:[1,0,0,.8]},statsStatic:(t,e)=>{e.addStat(27,t.level)}});var Y4=new he({id:124,passive:!1,icon:"ui/skills/hellspawn"});var X4=new he({id:109,type:0,icon:"ui/skills/charm1",fx:{stick:61,color:[.3,.3,.3,.9]},statsStatic:(t,e)=>{e.addStat(31,50)},beforeIncomingDamage:(t,e,n,s)=>n*(t.level/100)});var Q4=new he({id:123,passive:!0});var Z4=new he({id:93,breakOnCast:!0,tags:new Set([12]),icon:"ui/skills/39",customIcon:t=>"items/mount/mount"+sr[t.data[0]].tier+"_q1",fx:{mount:t=>sr[t.data[0]].skin,apply:76,endSound:69},statsStatic:(t,e)=>{e.addStat(15,60)}});var J4=new he({id:130,clearOnDeath:!1,tags:new Set([12]),icon:"ui/skills/39",customIcon:t=>"items/pet/pet"+sr[t.data[0]].tier+"_q1"});var K4=new he({id:111,type:0,icon:"ui/skills/charm3",fx:{stick:62,color:[.3,0,.6,.8]},statsStatic:(t,e)=>{e.addStat(15,t.level)}});var e5=new he({id:127,type:0,maxStacks:8,clearOnDeath:!1,icon:"ui/skills/obeliskbuff"});var t5=new he({id:125,maxStacks:25,type:1,icon:"ui/skills/pierce",multiplyIncomingDamage:{0:t=>1+t.stacks*.2,60:t=>1+t.stacks*.2}});var n5=new he({id:103,icon:"ui/skills/postsummon",fx:{stick:80},unique:!0,statsStatic:(t,e)=>{e.addStat(15,20)}});var fg=["potionhp","potionMp"].map((t,e)=>new he({id:[97,98][e],maxStacks:1,icon:"ui/skills/"+t,fx:{stick:[43,83][e]},intervalHaste:!1,intervalDuration:.5,onInterval:(n,s,i)=>({id:100,mode:[2,3][e],caster:n.caster,target:s.id,heal:e==1?void 0:n.level,mprec:e==0?void 0:n.level,nocrit:!0})}));var s5=new he({id:88,type:1,tags:new Set([5]),dr:1,incapacitated:!0,icon:"ui/skills/stunBuff",fx:{stick:86,incapacitated:!0},movementOverride:(t,e,n,s,i)=>{s.setSteer(0,0),s.setJump(0)}});var i5=new he({id:102,maxStacks:99,icon:"ui/skills/suddenDeath",statsStatic:(t,e)=>{e.maxStat(30,t.stacks)}});var o5=new he({id:122,passive:!1,immuneCC:!0,icon:"ui/skills/21",statsStatic:(t,e)=>{e.addStat(6,t.stacks*5e5),t.level>1&&(e.addStat(17,30),e.addStat(16,1e3),e.addStat(15,200),e.addStat(10,500),e.addStat(11,500))},onCast:{0:(t,e,n,s,i)=>{}}});var r5=new he({id:131,passive:!0});var l5=new he({id:132,passive:!0});var a5=new he({id:128,type:0,tags:new Set([12]),icon:"ui/skills/ghost",fx:{color:[.9,1.2,.8,.8],alpha:[.3]}});var c5=new he({id:129,type:0,icon:"ui/skills/moderator",fx:{color:[.3,1.2,.9,.7],alpha:[.3]}});var dl=new Map;[a5,c5,e5,W4,t5,r5,Q4,Y4,o5,j4,N4,K4,H4,X4,n5,i5,fg[0],fg[1],s5,Z4,J4,G4,Kw,o4,n4,s4,t4,Yw,i4,Xw,Ww,Zw,Qw,Jw,Gw,e4,f4,u4,r4,d4,l4,c4,p4,m4,a4,z4,V4,I4,E4,B4,q4,D4,T4,U4,O4,L4,$4,R4,g4,l5,h4,A4,P4,F4,x4,M4,y4,k4,S4,b4,v4,C4,w4,_4].forEach(t=>{dl.set(t.id,t)});var Xa=class{constructor(e){this.entity=e,this.alive=!0,this.stat=new Map,this.resource=new Map,this.combatTimer=new kt(-1,6)}tick(e,n){this.combatTimer.start>0&&this.combatTimer.done(n)&&this.onCombatEnd(n)}die(){return this.alive?(this.alive=!1,this.entity.skills.onDeath(),this.entity.buffs.onDeath(),!0):!1}getStat(e){return this.stat.get(e)|0}getResource(e){return this.resource.get(e)|0}addStat(e,n){this.stat.set(e,(this.stat.get(e)|0)+n)}maxStat(e,n){this.stat.set(e,Math.max(this.stat.get(e)|0,n))}multiplyStat(e,n){this.stat.set(e,(this.stat.get(e)|0)*n)}setResource(e,n){let s=Math.round(vt(n,0,this.getStat(e)));return this.resource.set(e,s),s}changeResource(e,n){return this.setResource(e,this.getResource(e)+n)}respawn(){this.alive=!0,this.onCombatEnd()}clear(){}refreshCombatTimer(e,n){this.combatTimer.end<e+n&&this.combatTimer.reset(e,n)}onCombatEnd(){this.combatTimer.reset(-1)}getDamageRoll(){return Math.round((this.getStat(10)+this.getStat(11))/2)}};function f5(t,e,n){let s=t.slice();return s[12]=e[n],s}function u5(t,e,n){let s=t.slice();return s[15]=e[n],s}function p5(t,e,n){let s=t.slice();return s[18]=e[n],s}function m5(t,e,n){let s=t.slice();return s[18]=e[n],s}function d5(t,e,n){let s=t.slice();return s[23]=e[n],s}function h5(t,e,n){let s=t.slice();return s[26]=e[n],s}function g5(t,e,n){let s=t.slice();return s[23]=e[n],s}function v5(t,e,n){let s=t.slice();return s[26]=e[n],s}function _5(t,e,n){let s=t.slice();return s[33]=e[n],s}function b5(t,e,n){let s=t.slice();return s[26]=e[n],s}function lD(t){let e,n,s,i,o,r,l,a,c,f,u,p,g,v,_,b,y,k,S,A,F,M,D,L=!t[2]&&t[0].parent===void 0&&y5(t),E=t[0].actiontype&&k5(t),R=t[0].auto&&x5(t),z=t[0].costMp&&w5(t),q=t[0].castLen&&M5(t),j=t[0].cd&&F5(t),W=t[0].duration>0&&C5(t),N=t[0].unique&&S5(t),O=t[0].refresh&&A5(t),se=t[0].range&&P5(t),re=t[6][t[0].targetMode]&&T5(t),ie=t[0].maxStacks&&E5(t),ce=t[0].dmg&&D5(t),ke=t[0].heal&&I5(t),ge=me([t[0].multiplyIncomingHeal,t[0].multiplyIncomingDamage]),Ne=[];for(let Z=0;Z<2;Z+=1)Ne[Z]=L5(_5(t,ge,Z));let Te=me([t[0].addIncomingHeal,t[0].addIncomingDamage]),Ce=[];for(let Z=0;Z<2;Z+=1)Ce[Z]=R5(g5(t,Te,Z));let _e=me([t[0].addIncomingCrit]),H=[];for(let Z=0;Z<1;Z+=1)H[Z]=B5(d5(t,_e,Z));let de=t[0].statsStatic&&U5(t),Re=t[0].statsConvert&&$5(t),Ge=t[0].custom&&j5(t),Xe=t[0].aoe&&t[0].aoe.circleRadius&&G5(t),Ye=!t[0].parent&&H5(t),pe=me(t[5]),ae=[];for(let Z=0;Z<pe.length;Z+=1)ae[Z]=Y5(f5(t,pe,Z));let Ue=Z=>V(ae[Z],1,1,()=>{ae[Z]=null});return{c(){L&&L.c(),e=h("div"),E&&E.c(),n=be(),R&&R.c(),s=be(),z&&z.c(),i=be(),q&&q.c(),o=be(),j&&j.c(),r=be(),W&&W.c(),l=be(),N&&N.c(),a=be(),O&&O.c(),c=h("div"),se&&se.c(),f=be(),re&&re.c(),ie&&ie.c(),u=be(),ce&&ce.c(),p=be(),ke&&ke.c(),g=be();for(let Z=0;Z<2;Z+=1)Ne[Z].c();v=be();for(let Z=0;Z<2;Z+=1)Ce[Z].c();_=be();for(let Z=0;Z<1;Z+=1)H[Z].c();b=be(),de&&de.c(),y=be(),Re&&Re.c(),k=be(),Ge&&Ge.c(),S=be(),Xe&&Xe.c(),A=be(),Ye&&Ye.c(),F=be();for(let Z=0;Z<ae.length;Z+=1)ae[Z].c();M=be(),m(e,"class","pad textgreen svelte-14w0l4b")},m(Z,Q){L&&L.m(Z,Q),w(Z,e,Q),E&&E.m(e,null),d(e,n),R&&R.m(e,null),d(e,s),z&&z.m(e,null),d(e,i),q&&q.m(e,null),d(e,o),j&&j.m(e,null),d(e,r),W&&W.m(e,null),d(e,l),N&&N.m(e,null),d(e,a),O&&O.m(e,null),d(e,c),se&&se.m(c,null),d(c,f),re&&re.m(c,null),ie&&ie.m(Z,Q),w(Z,u,Q),ce&&ce.m(Z,Q),w(Z,p,Q),ke&&ke.m(Z,Q),w(Z,g,Q);for(let U=0;U<2;U+=1)Ne[U]&&Ne[U].m(Z,Q);w(Z,v,Q);for(let U=0;U<2;U+=1)Ce[U]&&Ce[U].m(Z,Q);w(Z,_,Q);for(let U=0;U<1;U+=1)H[U]&&H[U].m(Z,Q);w(Z,b,Q),de&&de.m(Z,Q),w(Z,y,Q),Re&&Re.m(Z,Q),w(Z,k,Q),Ge&&Ge.m(Z,Q),w(Z,S,Q),Xe&&Xe.m(Z,Q),w(Z,A,Q),Ye&&Ye.m(Z,Q),w(Z,F,Q);for(let U=0;U<ae.length;U+=1)ae[U]&&ae[U].m(Z,Q);w(Z,M,Q),D=!0},p(Z,Q){if(!Z[2]&&Z[0].parent===void 0?L?L.p(Z,Q):(L=y5(Z),L.c(),L.m(e.parentNode,e)):L&&(L.d(1),L=null),Z[0].actiontype?E?E.p(Z,Q):(E=k5(Z),E.c(),E.m(e,n)):E&&(E.d(1),E=null),Z[0].auto?R||(R=x5(Z),R.c(),R.m(e,s)):R&&(R.d(1),R=null),Z[0].costMp?z?z.p(Z,Q):(z=w5(Z),z.c(),z.m(e,i)):z&&(z.d(1),z=null),Z[0].castLen?q?q.p(Z,Q):(q=M5(Z),q.c(),q.m(e,o)):q&&(q.d(1),q=null),Z[0].cd?j?j.p(Z,Q):(j=F5(Z),j.c(),j.m(e,r)):j&&(j.d(1),j=null),Z[0].duration>0?W?W.p(Z,Q):(W=C5(Z),W.c(),W.m(e,l)):W&&(W.d(1),W=null),Z[0].unique?N||(N=S5(Z),N.c(),N.m(e,a)):N&&(N.d(1),N=null),Z[0].refresh?O||(O=A5(Z),O.c(),O.m(e,c)):O&&(O.d(1),O=null),Z[0].range?se?se.p(Z,Q):(se=P5(Z),se.c(),se.m(c,f)):se&&(se.d(1),se=null),Z[6][Z[0].targetMode]?re?re.p(Z,Q):(re=T5(Z),re.c(),re.m(c,null)):re&&(re.d(1),re=null),Z[0].maxStacks?ie?ie.p(Z,Q):(ie=E5(Z),ie.c(),ie.m(u.parentNode,u)):ie&&(ie.d(1),ie=null),Z[0].dmg?ce?ce.p(Z,Q):(ce=D5(Z),ce.c(),ce.m(p.parentNode,p)):ce&&(ce.d(1),ce=null),Z[0].heal?ke?ke.p(Z,Q):(ke=I5(Z),ke.c(),ke.m(g.parentNode,g)):ke&&(ke.d(1),ke=null),Q[0]&129){ge=me([Z[0].multiplyIncomingHeal,Z[0].multiplyIncomingDamage]);let U;for(U=0;U<2;U+=1){let fe=_5(Z,ge,U);Ne[U]?Ne[U].p(fe,Q):(Ne[U]=L5(fe),Ne[U].c(),Ne[U].m(v.parentNode,v))}for(;U<2;U+=1)Ne[U].d(1)}if(Q[0]&129){Te=me([Z[0].addIncomingHeal,Z[0].addIncomingDamage]);let U;for(U=0;U<2;U+=1){let fe=g5(Z,Te,U);Ce[U]?Ce[U].p(fe,Q):(Ce[U]=R5(fe),Ce[U].c(),Ce[U].m(_.parentNode,_))}for(;U<2;U+=1)Ce[U].d(1)}if(Q[0]&129){_e=me([Z[0].addIncomingCrit]);let U;for(U=0;U<1;U+=1){let fe=d5(Z,_e,U);H[U]?H[U].p(fe,Q):(H[U]=B5(fe),H[U].c(),H[U].m(b.parentNode,b))}for(;U<1;U+=1)H[U].d(1)}if(Z[0].statsStatic?de?de.p(Z,Q):(de=U5(Z),de.c(),de.m(y.parentNode,y)):de&&(de.d(1),de=null),Z[0].statsConvert?Re?Re.p(Z,Q):(Re=$5(Z),Re.c(),Re.m(k.parentNode,k)):Re&&(Re.d(1),Re=null),Z[0].custom?Ge?Ge.p(Z,Q):(Ge=j5(Z),Ge.c(),Ge.m(S.parentNode,S)):Ge&&(Ge.d(1),Ge=null),Z[0].aoe&&Z[0].aoe.circleRadius?Xe?Xe.p(Z,Q):(Xe=G5(Z),Xe.c(),Xe.m(A.parentNode,A)):Xe&&(Xe.d(1),Xe=null),Z[0].parent?Ye&&(Ye.d(1),Ye=null):Ye?Ye.p(Z,Q):(Ye=H5(Z),Ye.c(),Ye.m(F.parentNode,F)),Q[0]&34){pe=me(Z[5]);let U;for(U=0;U<pe.length;U+=1){let fe=f5(Z,pe,U);ae[U]?(ae[U].p(fe,Q),P(ae[U],1)):(ae[U]=Y5(fe),ae[U].c(),P(ae[U],1),ae[U].m(M.parentNode,M))}for(Ee(),U=pe.length;U<ae.length;U+=1)Ue(U);De()}},i(Z){if(!D){for(let Q=0;Q<pe.length;Q+=1)P(ae[Q]);D=!0}},o(Z){ae=ae.filter(Boolean);for(let Q=0;Q<ae.length;Q+=1)V(ae[Q]);D=!1},d(Z){Z&&(x(e),x(u),x(p),x(g),x(v),x(_),x(b),x(y),x(k),x(S),x(A),x(F),x(M)),L&&L.d(Z),E&&E.d(),R&&R.d(),z&&z.d(),q&&q.d(),j&&j.d(),W&&W.d(),N&&N.d(),O&&O.d(),se&&se.d(),re&&re.d(),ie&&ie.d(Z),ce&&ce.d(Z),ke&&ke.d(Z),st(Ne,Z),st(Ce,Z),st(H,Z),de&&de.d(Z),Re&&Re.d(Z),Ge&&Ge.d(Z),Xe&&Xe.d(Z),Ye&&Ye.d(Z),st(ae,Z)}}}function aD(t){let e,n=t[0].item+"",s;return{c(){e=h("div"),s=T(n)},m(i,o){w(i,e,o),d(e,s)},p(i,o){o[0]&1&&n!==(n=i[0].item+"")&&G(s,n)},i:ue,o:ue,d(i){i&&x(e)}}}function y5(t){let e,n,s,i,o=C.items.book[t[0].id].name+"",r,l=t[0].engineOnly?"":" Lv. "+t[1],a;return{c(){e=h("div"),n=h("img"),i=$e(),r=T(o),a=T(l),m(n,"class","texticon"),at(n.src,s=Bf(t[0].id))||m(n,"src",s),m(e,"class","slottitle textprimary")},m(c,f){w(c,e,f),d(e,n),d(e,i),d(e,r),d(e,a)},p(c,f){f[0]&1&&!at(n.src,s=Bf(c[0].id))&&m(n,"src",s),f[0]&1&&o!==(o=C.items.book[c[0].id].name+"")&&G(r,o),f[0]&3&&l!==(l=c[0].engineOnly?"":" Lv. "+c[1])&&G(a,l)},d(c){c&&x(e)}}}function k5(t){let e,n=t[8][t[0].mode]+"",s,i,o=t[0].actiontype+"",r;return{c(){e=h("div"),s=T(n),i=$e(),r=T(o),m(e,"class","textwhite")},m(l,a){w(l,e,a),d(e,s),d(e,i),d(e,r)},p(l,a){a[0]&1&&n!==(n=l[8][l[0].mode]+"")&&G(s,n),a[0]&1&&o!==(o=l[0].actiontype+"")&&G(r,o)},d(l){l&&x(e)}}}function x5(t){let e;return{c(){e=h("div"),e.textContent="Auto cast"},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function w5(t){let e,n,s=t[0].costMp(t[1])+"",i,o,r=C.ui.stats.array[7]+"",l;return{c(){e=h("div"),n=T("Cost: "),i=T(s),o=$e(),l=T(r)},m(a,c){w(a,e,c),d(e,n),d(e,i),d(e,o),d(e,l)},p(a,c){c[0]&3&&s!==(s=a[0].costMp(a[1])+"")&&G(i,s)},d(a){a&&x(e)}}}function M5(t){let e,n=t[7](t[0].castLen)+"",s,i;return{c(){e=h("div"),s=T(n),i=T("s Cast time")},m(o,r){w(o,e,r),d(e,s),d(e,i)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].castLen)+"")&&G(s,n)},d(o){o&&x(e)}}}function F5(t){let e,n=t[7](t[0].cd)+"",s,i;return{c(){e=h("div"),s=T(n),i=T("s Cooldown")},m(o,r){w(o,e,r),d(e,s),d(e,i)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].cd)+"")&&G(s,n)},d(o){o&&x(e)}}}function C5(t){let e,n=t[7](t[0].duration)+"",s,i;return{c(){e=h("div"),s=T(n),i=T("s Duration")},m(o,r){w(o,e,r),d(e,s),d(e,i)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].duration)+"")&&G(s,n)},d(o){o&&x(e)}}}function S5(t){let e;return{c(){e=h("div"),e.textContent="Unique"},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function A5(t){let e;return{c(){e=h("div"),e.textContent="Stacks refresh duration"},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function P5(t){let e,n=t[7](t[0].range)+"",s,i;return{c(){e=h("span"),s=T(n),i=T("m range ")},m(o,r){w(o,e,r),d(e,s),d(e,i)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].range)+"")&&G(s,n)},d(o){o&&x(e)}}}function T5(t){let e,n=t[6][t[0].targetMode]+"",s;return{c(){e=h("span"),s=T(n)},m(i,o){w(i,e,o),d(e,s)},p(i,o){o[0]&1&&n!==(n=i[6][i[0].targetMode]+"")&&G(s,n)},d(i){i&&x(e)}}}function E5(t){let e,n,s,i=t[4].stacks+"",o,r,l,a;return{c(){e=h("div"),n=h("u"),s=T("At "),o=T(i),r=T(" stacks"),l=T(":"),a=h("span"),a.textContent="(Press shift to toggle)",m(e,"class","pad textsecondary svelte-14w0l4b"),m(a,"class","textgrey")},m(c,f){w(c,e,f),d(e,n),d(n,s),d(n,o),d(n,r),d(e,l),w(c,a,f)},p(c,f){f[0]&16&&i!==(i=c[4].stacks+"")&&G(o,i)},d(c){c&&(x(e),x(a))}}}function D5(t){let e,n=t[7](t[0].dmg)+"",s,i;return{c(){e=h("div"),s=T(n),i=T(" DMG"),m(e,"class","textgreen")},m(o,r){w(o,e,r),d(e,s),d(e,i)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].dmg)+"")&&G(s,n)},d(o){o&&x(e)}}}function I5(t){let e,n=t[7](t[0].heal)+"",s,i;return{c(){e=h("div"),s=T(n),i=T(" Heal"),m(e,"class","textgreen")},m(o,r){w(o,e,r),d(e,s),d(e,i)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].heal)+"")&&G(s,n)},d(o){o&&x(e)}}}function V5(t){let e,n,s=C.items.book[t[26]].name+"",i,o,r=Math.round(100*t[7](t[33][t[26]](t[0]))-100)+"",l,a;return{c(){e=h("div"),n=T("Empower "),i=T(s),o=T(" by "),l=T(r),a=T("%"),m(e,"class","textcyan")},m(c,f){w(c,e,f),d(e,n),d(e,i),d(e,o),d(e,l),d(e,a)},p(c,f){f[0]&1&&s!==(s=C.items.book[c[26]].name+"")&&G(i,s),f[0]&1&&r!==(r=Math.round(100*c[7](c[33][c[26]](c[0]))-100)+"")&&G(l,r)},d(c){c&&x(e)}}}function L5(t){let e,n=me(Object.keys(t[33]||{})),s=[];for(let i=0;i<n.length;i+=1)s[i]=V5(b5(t,n,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=be()},m(i,o){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(i,o);w(i,e,o)},p(i,o){if(o[0]&129){n=me(Object.keys(i[33]||{}));let r;for(r=0;r<n.length;r+=1){let l=b5(i,n,r);s[r]?s[r].p(l,o):(s[r]=V5(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(i){i&&x(e),st(s,i)}}}function q5(t){let e,n,s=C.items.book[t[26]].name+"",i,o,r=t[7](t[23][t[26]](t[0]))+"",l;return{c(){e=h("div"),n=T("Empower "),i=T(s),o=T(" by "),l=T(r),m(e,"class","textcyan")},m(a,c){w(a,e,c),d(e,n),d(e,i),d(e,o),d(e,l)},p(a,c){c[0]&1&&s!==(s=C.items.book[a[26]].name+"")&&G(i,s),c[0]&1&&r!==(r=a[7](a[23][a[26]](a[0]))+"")&&G(l,r)},d(a){a&&x(e)}}}function R5(t){let e,n=me(Object.keys(t[23]||{})),s=[];for(let i=0;i<n.length;i+=1)s[i]=q5(v5(t,n,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=be()},m(i,o){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(i,o);w(i,e,o)},p(i,o){if(o[0]&129){n=me(Object.keys(i[23]||{}));let r;for(r=0;r<n.length;r+=1){let l=v5(i,n,r);s[r]?s[r].p(l,o):(s[r]=q5(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(i){i&&x(e),st(s,i)}}}function z5(t){let e,n,s=C.items.book[t[26]].name+"",i,o,r=ss(14,t[7](t[23][t[26]](t[0])))+"",l;return{c(){e=h("div"),n=T("Empower Crit% of "),i=T(s),o=T(" by "),l=T(r),m(e,"class","textcyan")},m(a,c){w(a,e,c),d(e,n),d(e,i),d(e,o),d(e,l)},p(a,c){c[0]&1&&s!==(s=C.items.book[a[26]].name+"")&&G(i,s),c[0]&1&&r!==(r=ss(14,a[7](a[23][a[26]](a[0])))+"")&&G(l,r)},d(a){a&&x(e)}}}function B5(t){let e,n=me(Object.keys(t[23]||{})),s=[];for(let i=0;i<n.length;i+=1)s[i]=z5(h5(t,n,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=be()},m(i,o){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(i,o);w(i,e,o)},p(i,o){if(o[0]&129){n=me(Object.keys(i[23]||{}));let r;for(r=0;r<n.length;r+=1){let l=h5(i,n,r);s[r]?s[r].p(l,o):(s[r]=z5(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(i){i&&x(e),st(s,i)}}}function U5(t){let e,n=me(Array.from(t[3].stat)),s=[];for(let i=0;i<n.length;i+=1)s[i]=O5(m5(t,n,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=be()},m(i,o){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(i,o);w(i,e,o)},p(i,o){if(o[0]&8){n=me(Array.from(i[3].stat));let r;for(r=0;r<n.length;r+=1){let l=m5(i,n,r);s[r]?s[r].p(l,o):(s[r]=O5(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(i){i&&x(e),st(s,i)}}}function O5(t){let e,n,s=ss(t[18][0],t[18][1])+"",i,o,r=C.ui.stats.array[t[18][0]]+"",l,a;return{c(){e=h("div"),n=T("+"),i=T(s),o=$e(),l=T(r),a=$e(),m(e,"class","textcyan")},m(c,f){w(c,e,f),d(e,n),d(e,i),d(e,o),d(e,l),d(e,a)},p(c,f){f[0]&8&&s!==(s=ss(c[18][0],c[18][1])+"")&&G(i,s),f[0]&8&&r!==(r=C.ui.stats.array[c[18][0]]+"")&&G(l,r)},d(c){c&&x(e)}}}function $5(t){let e,n=me(t[0].statsConvert),s=[];for(let i=0;i<n.length;i+=1)s[i]=N5(p5(t,n,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=be()},m(i,o){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(i,o);w(i,e,o)},p(i,o){if(o[0]&1){n=me(i[0].statsConvert);let r;for(r=0;r<n.length;r+=1){let l=p5(i,n,r);s[r]?s[r].p(l,o):(s[r]=N5(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(i){i&&x(e),st(s,i)}}}function N5(t){let e,n=C.ui.skilldescription.statincrement[0]+"",s,i,o=C.ui.stats.array[t[18][0]]+"",r,l,a=C.ui.skilldescription.statincrement[1]+"",c,f,u=ss(t[18][0],t[18][1])+"",p,g,v=C.ui.stats.array[t[18][2]]+"",_,b,y=C.ui.skilldescription.statincrement[2]+"",k;return{c(){e=h("div"),s=T(n),i=$e(),r=T(o),l=$e(),c=T(a),f=$e(),p=T(u),g=$e(),_=T(v),b=$e(),k=T(y),m(e,"class","textcyan")},m(S,A){w(S,e,A),d(e,s),d(e,i),d(e,r),d(e,l),d(e,c),d(e,f),d(e,p),d(e,g),d(e,_),d(e,b),d(e,k)},p(S,A){A[0]&1&&o!==(o=C.ui.stats.array[S[18][0]]+"")&&G(r,o),A[0]&1&&u!==(u=ss(S[18][0],S[18][1])+"")&&G(p,u),A[0]&1&&v!==(v=C.ui.stats.array[S[18][2]]+"")&&G(_,v)},d(S){S&&x(e)}}}function j5(t){let e,n=me(t[0].custom),s=[];for(let i=0;i<n.length;i+=1)s[i]=W5(u5(t,n,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=be()},m(i,o){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(i,o);w(i,e,o)},p(i,o){if(o[0]&131){n=me(i[0].custom);let r;for(r=0;r<n.length;r+=1){let l=u5(i,n,r);s[r]?s[r].p(l,o):(s[r]=W5(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(i){i&&x(e),st(s,i)}}}function W5(t){let e,n=t[7](t[15][0](t[1]))+"",s,i=t[15][1]+"",o;return{c(){e=h("div"),s=T(n),o=T(i),m(e,"class","textcyan")},m(r,l){w(r,e,l),d(e,s),d(e,o)},p(r,l){l[0]&3&&n!==(n=r[7](r[15][0](r[1]))+"")&&G(s,n),l[0]&1&&i!==(i=r[15][1]+"")&&G(o,i)},d(r){r&&x(e)}}}function G5(t){let e,n=t[0].aoe.limit?"Up to "+t[0].aoe.limit:"All",s,i,o=t[0].aoe.faction?"allies":"enemies",r,l,a=t[7](t[0].aoe.circleRadius)+"",c,f;return{c(){e=h("div"),s=T(n),i=$e(),r=T(o),l=T(" within "),c=T(a),f=T("m"),m(e,"class","textpvp")},m(u,p){w(u,e,p),d(e,s),d(e,i),d(e,r),d(e,l),d(e,c),d(e,f)},p(u,p){p[0]&1&&n!==(n=u[0].aoe.limit?"Up to "+u[0].aoe.limit:"All")&&G(s,n),p[0]&1&&o!==(o=u[0].aoe.faction?"allies":"enemies")&&G(r,o),p[0]&1&&a!==(a=u[7](u[0].aoe.circleRadius)+"")&&G(c,a)},d(u){u&&x(e)}}}function H5(t){let e,n,s,i=C.items.book[t[0].id].description+"",o;return{c(){e=h("div"),n=h("u"),n.textContent="Effect",s=T(": "),o=T(i),m(e,"class","textsecondary pad svelte-14w0l4b")},m(r,l){w(r,e,l),d(e,n),d(e,s),d(e,o)},p(r,l){l[0]&1&&i!==(i=C.items.book[r[0].id].description+"")&&G(o,i)},d(r){r&&x(e)}}}function Y5(t){let e,n,s;return n=new rd({props:{level:t[1],skill:t[12]}}),{c(){e=h("div"),ne(n.$$.fragment),m(e,"class","pad svelte-14w0l4b")},m(i,o){w(i,e,o),ee(n,e,null),s=!0},p(i,o){let r={};o[0]&2&&(r.level=i[1]),o[0]&32&&(r.skill=i[12]),n.$set(r)},i(i){s||(P(n.$$.fragment,i),s=!0)},o(i){V(n.$$.fragment,i),s=!1},d(i){i&&x(e),te(n)}}}function cD(t){let e,n,s,i,o=[aD,lD],r=[];function l(a,c){return a[0].item?0:1}return n=l(t,[-1,-1]),s=r[n]=o[n](t),{c(){e=h("div"),s.c(),m(e,"class","container textsecondary svelte-14w0l4b")},m(a,c){w(a,e,c),r[n].m(e,null),i=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(Ee(),V(r[f],1,1,()=>{r[f]=null}),De(),s=r[n],s?s.p(a,c):(s=r[n]=o[n](a),s.c()),P(s,1),s.m(e,null))},i(a){i||(P(s),i=!0)},o(a){V(s),i=!1},d(a){a&&x(e),r[n].d()}}}function fD(t,e,n){let{skill:s}=e,{level:i}=e,{asItemDescription:o=!1}=e,{shift:r=!1}=e,l={1:"Requires no target",16:"Self cast",256:"on Allies",4096:"on Enemy"},a=(_,b=I&&I.player)=>{if(!b)return"?";let y=jw(_,b);return y%1===0?y:y.toFixed(1)},c={0:"Melee attack",1:"Magic attack",2:"Heal",4:"Buff",5:"Stackable buff",6:"Ranged missile",7:"Ranged effect",9:"Effect"},f=[],u,p={},g=_=>{if(I)return _.onCast&&v("on cast",_.onCast,I.player,i),_.onBlock&&v("on block",_.onBlock,p,I.player),_.onInterval&&v(`every ${_.intervalDuration.toFixed(1)}s`,_.onInterval,p,I.player,I.player),_.onPermanent&&v("permanently",()=>({id:_.onPermanent(I.player),mode:4}),I.player,i),_},v=(_,b,y,k,S)=>{let A=b(y,k,S);if(!A||A===!0)return;let F=Object.assign({},A);if(F.actiontype=_,F.parent||(F.parent=[]),F.parent.push(s),F.mode===4||F.mode===5){let M=dl.get(F.id);f.unshift(g({...F,...M}))}else if(s.id===F.id)s.parent||(F.parent=void 0),n(0,s={...s,...F});else{if(s.parent){let M=s.parent.find(D=>D.id==F.id);if(M){M.parent||(F.parent=void 0),Object.assign(M,F);return}}f.unshift(g(F))}};return t.$$set=_=>{"skill"in _&&n(0,s=_.skill),"level"in _&&n(1,i=_.level),"asItemDescription"in _&&n(2,o=_.asItemDescription),"shift"in _&&n(9,r=_.shift)},t.$$.update=()=>{t.$$.dirty[0]&539&&(n(4,p={stacks:1,level:i}),n(4,p.stacks=s.maxStacks?r?1:s.maxStacks:1,p),n(0,s.stacks=p.stacks,s),n(5,f=[]),s.parent||g(s),s.statsStatic&&(n(3,u=new Xa),s.statsStatic(p,u)))},[s,i,o,u,p,f,l,a,c,r]}var rd=class extends Fe{constructor(e){super(),Se(this,e,fD,cD,Oe,{skill:0,level:1,asItemDescription:2,shift:9},null,[-1,-1])}},hl=rd;function uD(t){let e;return{c(){e=h("span")},m(n,s){w(n,e,s),e.innerHTML=t[0]},p(n,[s]){s&1&&(e.innerHTML=n[0])},i:ue,o:ue,d(n){n&&x(e)}}}function pD(t,e,n){let s,i,o;oe(t,Hs,a=>n(4,o=a));let{amount:r}=e,{isPrice:l=!1}=e;return t.$$set=a=>{"amount"in a&&n(1,r=a.amount),"isPrice"in a&&n(2,l=a.isPrice)},t.$$.update=()=>{t.$$.dirty&22&&n(3,s=l&&r>o),t.$$.dirty&10&&n(0,i=V1(r,s))},[i,r,l,s,o]}var ug=class extends Fe{constructor(e){super(),Se(this,e,pD,uD,Fn,{amount:1,isPrice:2})}},kn=ug;function mD(t){let e;return{c(){e=h("span")},m(n,s){w(n,e,s),e.innerHTML=t[0]},p(n,[s]){s&1&&(e.innerHTML=n[0])},i:ue,o:ue,d(n){n&&x(e)}}}function dD(t,e,n){let s,i,o;oe(t,ta,a=>n(4,o=a));let{amount:r}=e,{isPrice:l=!1}=e;return t.$$set=a=>{"amount"in a&&n(1,r=a.amount),"isPrice"in a&&n(2,l=a.isPrice)},t.$$.update=()=>{t.$$.dirty&22&&n(3,s=l&&r>o),t.$$.dirty&10&&n(0,i=L1(r,s))},[i,r,l,s,o]}var pg=class extends Fe{constructor(e){super(),Se(this,e,dD,mD,Fn,{amount:1,isPrice:2})}},lr=pg;function hD(t){let e,n,s,i,o,r;return{c(){e=h("span"),n=h("img"),i=h("span"),o=T(t[0]),m(n,"class","svgicon texticon"),at(n.src,s="/data/ui/icons/gem.svg?v=8593107")||m(n,"src",s),m(i,"class",r=!t[1]||t[0]<t[2]?"textprimary":"textred")},m(l,a){w(l,e,a),d(e,n),d(e,i),d(i,o)},p(l,[a]){a&1&&G(o,l[0]),a&7&&r!==(r=!l[1]||l[0]<l[2]?"textprimary":"textred")&&m(i,"class",r)},i:ue,o:ue,d(l){l&&x(e)}}}function gD(t,e,n){let s;oe(t,qo,r=>n(2,s=r));let{amount:i}=e,{isPrice:o=!1}=e;return t.$$set=r=>{"amount"in r&&n(0,i=r.amount),"isPrice"in r&&n(1,o=r.isPrice)},[i,o,s]}var mg=class extends Fe{constructor(e){super(),Se(this,e,gD,hD,Fn,{amount:0,isPrice:1})}},ar=mg;function X5(t,e,n){let s=t.slice();return s[8]=e[n],s}function Q5(t,e,n){let s=t.slice();return s[11]=e[n],s}function Z5(t,e,n){let s=t.slice();return s[11]=e[n],s}function J5(t,e,n){let s=t.slice();return s[16]=e[n],s}function K5(t,e,n){let s=t.slice();return s[8]=e[n],s}function eM(t){let e,n,s=t[0].gs+"",i,o;return{c(){e=h("span"),n=T("GS: "),i=T(s),o=$e(),m(e,"class","textgreen")},m(r,l){w(r,e,l),d(e,n),d(e,i),w(r,o,l)},p(r,l){l&1&&s!==(s=r[0].gs+"")&&G(i,s)},d(r){r&&(x(e),x(o))}}}function tM(t){let e,n,s=t[0].dbid+"",i;return{c(){e=h("span"),n=T("ID: "),i=T(s),m(e,"class","textgrey")},m(o,r){w(o,e,r),d(e,n),d(e,i)},p(o,r){r&1&&s!==(s=o[0].dbid+"")&&G(i,s)},d(o){o&&x(e)}}}function vD(t){let e,n=t[8][1].type=="bonus"?"+ ":"",s,i=ss(t[8][0],t[8][1].value)+"",o,r,l=C.ui.stats.array[t[8][0]]+"",a,c,f,u=t[8][1].type=="bonus"&&t[2]&&nM(t);return{c(){e=h("div"),s=T(n),o=T(i),r=$e(),a=T(l),c=$e(),u&&u.c(),m(e,"class",f="text"+Yt(t[8][1].qual)[0]+" svelte-e3ao5j")},m(p,g){w(p,e,g),d(e,s),d(e,o),d(e,r),d(e,a),d(e,c),u&&u.m(e,null)},p(p,g){p[8][1].type=="bonus"&&p[2]?u?u.p(p,g):(u=nM(p),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},d(p){p&&x(e),u&&u.d()}}}function _D(t){let e,n,s=t[0].stats.get(10).value+"",i,o,r,l,a=t[0].stats.get(11).value+"",c,f,u,p,g=C.ui.stats.misc.damage+"",v,_;return{c(){e=h("div"),n=h("span"),i=T(s),r=T(" - "),l=h("span"),c=T(a),u=$e(),p=h("span"),v=T(g),m(n,"class",o="text"+Yt(t[0].stats.get(10).qual)[0]+" svelte-e3ao5j"),m(l,"class",f="text"+Yt(t[0].stats.get(11).qual)[0]+" svelte-e3ao5j"),m(p,"class",_="text"+Yt(Math.min(t[0].stats.get(10).qual,t[0].stats.get(11).qual))[0]+" svelte-e3ao5j")},m(b,y){w(b,e,y),d(e,n),d(n,i),d(e,r),d(e,l),d(l,c),d(e,u),d(e,p),d(p,v)},p(b,y){y&1&&s!==(s=b[0].stats.get(10).value+"")&&G(i,s),y&1&&o!==(o="text"+Yt(b[0].stats.get(10).qual)[0]+" svelte-e3ao5j")&&m(n,"class",o),y&1&&a!==(a=b[0].stats.get(11).value+"")&&G(c,a),y&1&&f!==(f="text"+Yt(b[0].stats.get(11).qual)[0]+" svelte-e3ao5j")&&m(l,"class",f),y&1&&_!==(_="text"+Yt(Math.min(b[0].stats.get(10).qual,b[0].stats.get(11).qual))[0]+" svelte-e3ao5j")&&m(p,"class",_)},d(b){b&&x(e)}}}function nM(t){let e;return{c(){e=h("span"),e.textContent=`${Math.round(t[8][1].qual)}%`},m(n,s){w(n,e,s)},p:ue,d(n){n&&x(e)}}}function sM(t){let e,n;function s(r,l){return l&1&&(e=null),e==null&&(e=!!(r[8][0]==10&&r[0].stats.has(11))),e?_D:vD}let i=s(t,-1),o=i(t);return{c(){o.c(),n=be()},m(r,l){o.m(r,l),w(r,n,l)},p(r,l){i===(i=s(r,l))&&o?o.p(r,l):(o.d(1),o=i(r),o&&(o.c(),o.m(n.parentNode,n)))},d(r){r&&x(n),o.d(r)}}}function iM(t){let e,n=me(t[0].logic.custom),s=[];for(let i=0;i<n.length;i+=1)s[i]=oM(J5(t,n,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=be()},m(i,o){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(i,o);w(i,e,o)},p(i,o){if(o&1){n=me(i[0].logic.custom);let r;for(r=0;r<n.length;r+=1){let l=J5(i,n,r);s[r]?s[r].p(l,o):(s[r]=oM(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(i){i&&x(e),st(s,i)}}}function oM(t){let e,n=t[16]+"",s;return{c(){e=h("span"),s=T(n),m(e,"class","textgreen")},m(i,o){w(i,e,o),d(e,s)},p(i,o){o&1&&n!==(n=i[16]+"")&&G(s,n)},d(i){i&&x(e)}}}function rM(t){let e,n=t[11][0]+"",s,i;return{c(){e=h("div"),s=T(n),m(e,"class",i=t[11][1]?"textgreen":"textred")},m(o,r){w(o,e,r),d(e,s)},p(o,r){r&1&&n!==(n=o[11][0]+"")&&G(s,n),r&1&&i!==(i=o[11][1]?"textgreen":"textred")&&m(e,"class",i)},d(o){o&&x(e)}}}function bD(t){let e,n,s,i=t[0].logic.bindOnPurchase&&lM(t),o=t[0].logic.bindOnUse&&aM(t),r=t[0].logic.bindOnMerchant&&cM(t);return{c(){i&&i.c(),e=be(),o&&o.c(),n=be(),r&&r.c(),s=be()},m(l,a){i&&i.m(l,a),w(l,e,a),o&&o.m(l,a),w(l,n,a),r&&r.m(l,a),w(l,s,a)},p(l,a){l[0].logic.bindOnPurchase?i?i.p(l,a):(i=lM(l),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null),l[0].logic.bindOnUse?o?o.p(l,a):(o=aM(l),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null),l[0].logic.bindOnMerchant?r?r.p(l,a):(r=cM(l),r.c(),r.m(s.parentNode,s)):r&&(r.d(1),r=null)},d(l){l&&(x(e),x(n),x(s)),i&&i.d(l),o&&o.d(l),r&&r.d(l)}}}function yD(t){let e,n=C.ui.inventory.bindlevel[t[0].bound]+"",s;return{c(){e=h("div"),s=T(n),m(e,"class","textgreen")},m(i,o){w(i,e,o),d(e,s)},p(i,o){o&1&&n!==(n=C.ui.inventory.bindlevel[i[0].bound]+"")&&G(s,n)},d(i){i&&x(e)}}}function lM(t){let e,n=C.ui.inventory.bindlevel[t[0].logic.bindOnPurchase]+"",s,i,o=C.ui.itemdescription.onpurchase+"",r;return{c(){e=h("div"),s=T(n),i=$e(),r=T(o),m(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,s),d(e,i),d(e,r)},p(l,a){a&1&&n!==(n=C.ui.inventory.bindlevel[l[0].logic.bindOnPurchase]+"")&&G(s,n)},d(l){l&&x(e)}}}function aM(t){let e,n=C.ui.inventory.bindlevel[t[0].logic.bindOnUse]+"",s,i,o=C.ui.itemdescription.onuse+"",r;return{c(){e=h("div"),s=T(n),i=$e(),r=T(o),m(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,s),d(e,i),d(e,r)},p(l,a){a&1&&n!==(n=C.ui.inventory.bindlevel[l[0].logic.bindOnUse]+"")&&G(s,n)},d(l){l&&x(e)}}}function cM(t){let e,n=C.ui.inventory.bindlevel[t[0].logic.bindOnMerchant]+"",s,i,o=C.ui.itemdescription.onsale+"",r;return{c(){e=h("div"),s=T(n),i=$e(),r=T(o),m(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,s),d(e,i),d(e,r)},p(l,a){a&1&&n!==(n=C.ui.inventory.bindlevel[l[0].logic.bindOnMerchant]+"")&&G(s,n)},d(l){l&&x(e)}}}function fM(t){let e,n,s=t[0].medalValue()>0&&t[1],i,o=t[0].storeValue()>0&&t[1],r,l=!(t[0].storeValue()>0&&t[1])&&t[0].canBeSold(),a,c=t[1]&&uM(t),f=s&&mM(t),u=o&&dM(t),p=l&&hM(t);return{c(){e=h("div"),c&&c.c(),n=be(),f&&f.c(),i=be(),u&&u.c(),r=be(),p&&p.c(),m(e,"class","panel value pack svelte-e3ao5j")},m(g,v){w(g,e,v),c&&c.m(e,null),d(e,n),f&&f.m(e,null),d(e,i),u&&u.m(e,null),d(e,r),p&&p.m(e,null),a=!0},p(g,v){g[1]?c?c.p(g,v):(c=uM(g),c.c(),c.m(e,n)):c&&(c.d(1),c=null),v&3&&(s=g[0].medalValue()>0&&g[1]),s?f?(f.p(g,v),v&3&&P(f,1)):(f=mM(g),f.c(),P(f,1),f.m(e,i)):f&&(Ee(),V(f,1,1,()=>{f=null}),De()),v&3&&(o=g[0].storeValue()>0&&g[1]),o?u?(u.p(g,v),v&3&&P(u,1)):(u=dM(g),u.c(),P(u,1),u.m(e,r)):u&&(Ee(),V(u,1,1,()=>{u=null}),De()),v&3&&(l=!(g[0].storeValue()>0&&g[1])&&g[0].canBeSold()),l?p?(p.p(g,v),v&3&&P(p,1)):(p=hM(g),p.c(),P(p,1),p.m(e,null)):p&&(Ee(),V(p,1,1,()=>{p=null}),De())},i(g){a||(P(f),P(u),P(p),a=!0)},o(g){V(f),V(u),V(p),a=!1},d(g){g&&x(e),c&&c.d(),f&&f.d(),u&&u.d(),p&&p.d()}}}function uM(t){let e,n=me(t[0].buyReasons(I&&I.player)),s=[];for(let i=0;i<n.length;i+=1)s[i]=pM(Q5(t,n,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=be()},m(i,o){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(i,o);w(i,e,o)},p(i,o){if(o&1){n=me(i[0].buyReasons(I&&I.player));let r;for(r=0;r<n.length;r+=1){let l=Q5(i,n,r);s[r]?s[r].p(l,o):(s[r]=pM(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(i){i&&x(e),st(s,i)}}}function pM(t){let e,n=t[11][0]+"",s;return{c(){e=h("div"),m(e,"class",s=t[11][1]?"textgreen":"textred")},m(i,o){w(i,e,o),e.innerHTML=n},p(i,o){o&1&&n!==(n=i[11][0]+"")&&(e.innerHTML=n),o&1&&s!==(s=i[11][1]?"textgreen":"textred")&&m(e,"class",s)},d(i){i&&x(e)}}}function mM(t){let e,n,s;return n=new lr({props:{amount:t[0].medalValue(),isPrice:!0}}),{c(){e=h("div"),ne(n.$$.fragment)},m(i,o){w(i,e,o),ee(n,e,null),s=!0},p(i,o){let r={};o&1&&(r.amount=i[0].medalValue()),n.$set(r)},i(i){s||(P(n.$$.fragment,i),s=!0)},o(i){V(n.$$.fragment,i),s=!1},d(i){i&&x(e),te(n)}}}function dM(t){let e,n,s;return n=new ar({props:{amount:t[0].storeValue(),isPrice:!0}}),{c(){e=h("div"),ne(n.$$.fragment)},m(i,o){w(i,e,o),ee(n,e,null),s=!0},p(i,o){let r={};o&1&&(r.amount=i[0].storeValue()),n.$set(r)},i(i){s||(P(n.$$.fragment,i),s=!0)},o(i){V(n.$$.fragment,i),s=!1},d(i){i&&x(e),te(n)}}}function hM(t){let e,n,s;return n=new kn({props:{amount:t[0].goldValue(t[1]),isPrice:t[1]}}),{c(){e=h("div"),ne(n.$$.fragment)},m(i,o){w(i,e,o),ee(n,e,null),s=!0},p(i,o){let r={};o&3&&(r.amount=i[0].goldValue(i[1])),o&2&&(r.isPrice=i[1]),n.$set(r)},i(i){s||(P(n.$$.fragment,i),s=!0)},o(i){V(n.$$.fragment,i),s=!1},d(i){i&&x(e),te(n)}}}function kD(t){let e,n,s,i,o=[MD,wD],r=[];function l(a,c){return a[0].type=="book"?0:1}return e=l(t,-1),n=r[e]=o[e](t),{c(){n.c(),s=be()},m(a,c){r[e].m(a,c),w(a,s,c),i=!0},p(a,c){let f=e;e=l(a,c),e===f?r[e].p(a,c):(Ee(),V(r[f],1,1,()=>{r[f]=null}),De(),n=r[e],n?n.p(a,c):(n=r[e]=o[e](a),n.c()),P(n,1),n.m(s.parentNode,s))},i(a){i||(P(n),i=!0)},o(a){V(n),i=!1},d(a){a&&x(s),r[e].d(a)}}}function xD(t){let e,n,s=me(t[4]),i=[];for(let o=0;o<s.length;o+=1)i[o]=gM(X5(t,s,o));return{c(){e=h("div"),n=h("div"),n.textContent=`${C.ui.itemdescription.equipeffect}:`;for(let o=0;o<i.length;o+=1)i[o].c();m(n,"class","textgrey"),m(e,"class","pack svelte-e3ao5j")},m(o,r){w(o,e,r),d(e,n);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(e,null)},p(o,r){if(r&16){s=me(o[4]);let l;for(l=0;l<s.length;l+=1){let a=X5(o,s,l);i[l]?i[l].p(a,r):(i[l]=gM(a),i[l].c(),i[l].m(e,null))}for(;l<i.length;l+=1)i[l].d(1);i.length=s.length}},i:ue,o:ue,d(o){o&&x(e),st(i,o)}}}function wD(t){let e,n=Lh(t[0].type,t[0].tier)+"",s;return{c(){e=h("div"),s=T(n),m(e,"class","pack description svelte-e3ao5j")},m(i,o){w(i,e,o),d(e,s)},p(i,o){o&1&&n!==(n=Lh(i[0].type,i[0].tier)+"")&&G(s,n)},i:ue,o:ue,d(i){i&&x(e)}}}function MD(t){let e,n;return e=new hl({props:{shift:t[2],level:t[0].logic.skilllevel+1,skill:Pt.get(t[0].logic.skillid),asItemDescription:!0}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&4&&(o.shift=s[2]),i&1&&(o.level=s[0].logic.skilllevel+1),i&1&&(o.skill=Pt.get(s[0].logic.skillid)),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function gM(t){let e,n=t[8][1]>0?"+":"",s,i=ss(t[8][0],t[8][1])+"",o,r,l=C.ui.stats.array[t[8][0]]+"",a,c;return{c(){e=h("div"),s=T(n),o=T(i),r=$e(),a=T(l),m(e,"class",c="text"+(t[8][1]>0?"green":"red"))},m(f,u){w(f,e,u),d(e,s),d(e,o),d(e,r),d(e,a)},p(f,u){u&16&&n!==(n=f[8][1]>0?"+":"")&&G(s,n),u&16&&i!==(i=ss(f[8][0],f[8][1])+"")&&G(o,i),u&16&&l!==(l=C.ui.stats.array[f[8][0]]+"")&&G(a,l),u&16&&c!==(c="text"+(f[8][1]>0?"green":"red"))&&m(e,"class",c)},d(f){f&&x(e)}}}function vM(t){let e,n,s,i;return n=new ld({props:{item:t[3],comparison:!0}}),{c(){e=h("div"),ne(n.$$.fragment),m(e,"class",s="slotdescription border "+Yt(t[3].quality)[0]+" comparecontainer svelte-e3ao5j")},m(o,r){w(o,e,r),ee(n,e,null),i=!0},p(o,r){let l={};r&8&&(l.item=o[3]),n.$set(l),(!i||r&8&&s!==(s="slotdescription border "+Yt(o[3].quality)[0]+" comparecontainer svelte-e3ao5j"))&&m(e,"class",s)},i(o){i||(P(n.$$.fragment,o),i=!0)},o(o){V(n.$$.fragment,o),i=!1},d(o){o&&x(e),te(n)}}}function FD(t){let e,n,s,i=t[2]?"T"+(t[0].tier+1)+" ":"",o,r=hn(t[0].type,t[0].tier)+"",l,a,c=t[0].upgrade?" +"+t[0].upgrade:"",f,u,p,g=(t[0].stacks?"":Yt(t[0].quality)[1])+"",v,_,b=t[0].type+"",y,k,S,A=t[0].quality&&!t[0].stacks?t[0].quality+"%":"",F,M,D,L,E,R,z,q,j=t[1]||t[0].canBeSold(),W,N,O,se,re,ie=t[0].gs>0&&eM(t),ce=t[0].dbid&&tM(t),ke=me(t[5]),ge=[];for(let ae=0;ae<ke.length;ae+=1)ge[ae]=sM(K5(t,ke,ae));let Ne=t[0].logic.custom!==void 0&&iM(t),Te=me(t[0].equipReasons(I&&I.player)),Ce=[];for(let ae=0;ae<Te.length;ae+=1)Ce[ae]=rM(Z5(t,Te,ae));function _e(ae,Ue){return ae[0].bound>0?yD:bD}let H=_e(t,-1),de=H(t),Re=j&&fM(t),Ge=[xD,kD],Xe=[];function Ye(ae,Ue){return ae[3]?0:1}N=Ye(t,-1),O=Xe[N]=Ge[N](t);let pe=t[3]&&vM(t);return{c(){e=h("div"),n=h("div"),s=h("div"),o=T(i),l=T(r),a=h("span"),f=T(c),p=h("div"),v=T(g),_=$e(),y=T(b),k=$e(),S=h("span"),F=T(A),M=h("small"),ie&&ie.c(),D=be(),ce&&ce.c(),L=$e(),E=h("div");for(let ae=0;ae<ge.length;ae+=1)ge[ae].c();R=be(),Ne&&Ne.c(),z=h("div");for(let ae=0;ae<Ce.length;ae+=1)Ce[ae].c();q=be(),de.c(),Re&&Re.c(),W=be(),O.c(),pe&&pe.c(),se=be(),m(a,"class","textprimary"),m(s,"class",u="slottitle text"+Yt(t[0].quality)[0]+" svelte-e3ao5j"),m(p,"class","type textwhite svelte-e3ao5j"),m(n,"class","pack svelte-e3ao5j"),m(E,"class","pack svelte-e3ao5j"),m(z,"class","pack svelte-e3ao5j"),m(e,"class","container svelte-e3ao5j")},m(ae,Ue){w(ae,e,Ue),d(e,n),d(n,s),d(s,o),d(s,l),d(s,a),d(a,f),d(n,p),d(p,v),d(p,_),d(p,y),d(p,k),d(p,S),d(S,F),d(n,M),ie&&ie.m(M,null),d(M,D),ce&&ce.m(M,null),d(n,L),d(e,E);for(let Z=0;Z<ge.length;Z+=1)ge[Z]&&ge[Z].m(E,null);d(E,R),Ne&&Ne.m(E,null),d(e,z);for(let Z=0;Z<Ce.length;Z+=1)Ce[Z]&&Ce[Z].m(z,null);d(z,q),de.m(z,null),Re&&Re.m(e,null),d(e,W),Xe[N].m(e,null),pe&&pe.m(ae,Ue),w(ae,se,Ue),re=!0},p(ae,[Ue]){if((!re||Ue&5)&&i!==(i=ae[2]?"T"+(ae[0].tier+1)+" ":"")&&G(o,i),(!re||Ue&1)&&r!==(r=hn(ae[0].type,ae[0].tier)+"")&&G(l,r),(!re||Ue&1)&&c!==(c=ae[0].upgrade?" +"+ae[0].upgrade:"")&&G(f,c),(!re||Ue&1&&u!==(u="slottitle text"+Yt(ae[0].quality)[0]+" svelte-e3ao5j"))&&m(s,"class",u),(!re||Ue&1)&&g!==(g=(ae[0].stacks?"":Yt(ae[0].quality)[1])+"")&&G(v,g),(!re||Ue&1)&&b!==(b=ae[0].type+"")&&G(y,b),(!re||Ue&1)&&A!==(A=ae[0].quality&&!ae[0].stacks?ae[0].quality+"%":"")&&G(F,A),ae[0].gs>0?ie?ie.p(ae,Ue):(ie=eM(ae),ie.c(),ie.m(M,D)):ie&&(ie.d(1),ie=null),ae[0].dbid?ce?ce.p(ae,Ue):(ce=tM(ae),ce.c(),ce.m(M,null)):ce&&(ce.d(1),ce=null),Ue&37){ke=me(ae[5]);let Q;for(Q=0;Q<ke.length;Q+=1){let U=K5(ae,ke,Q);ge[Q]?ge[Q].p(U,Ue):(ge[Q]=sM(U),ge[Q].c(),ge[Q].m(E,R))}for(;Q<ge.length;Q+=1)ge[Q].d(1);ge.length=ke.length}if(ae[0].logic.custom!==void 0?Ne?Ne.p(ae,Ue):(Ne=iM(ae),Ne.c(),Ne.m(E,null)):Ne&&(Ne.d(1),Ne=null),Ue&1){Te=me(ae[0].equipReasons(I&&I.player));let Q;for(Q=0;Q<Te.length;Q+=1){let U=Z5(ae,Te,Q);Ce[Q]?Ce[Q].p(U,Ue):(Ce[Q]=rM(U),Ce[Q].c(),Ce[Q].m(z,q))}for(;Q<Ce.length;Q+=1)Ce[Q].d(1);Ce.length=Te.length}H===(H=_e(ae,Ue))&&de?de.p(ae,Ue):(de.d(1),de=H(ae),de&&(de.c(),de.m(z,null))),Ue&3&&(j=ae[1]||ae[0].canBeSold()),j?Re?(Re.p(ae,Ue),Ue&3&&P(Re,1)):(Re=fM(ae),Re.c(),P(Re,1),Re.m(e,W)):Re&&(Ee(),V(Re,1,1,()=>{Re=null}),De());let Z=N;N=Ye(ae,Ue),N===Z?Xe[N].p(ae,Ue):(Ee(),V(Xe[Z],1,1,()=>{Xe[Z]=null}),De(),O=Xe[N],O?O.p(ae,Ue):(O=Xe[N]=Ge[N](ae),O.c()),P(O,1),O.m(e,null)),ae[3]?pe?(pe.p(ae,Ue),Ue&8&&P(pe,1)):(pe=vM(ae),pe.c(),P(pe,1),pe.m(se.parentNode,se)):pe&&(Ee(),V(pe,1,1,()=>{pe=null}),De())},i(ae){re||(P(Re),P(O),P(pe),re=!0)},o(ae){V(Re),V(O),V(pe),re=!1},d(ae){ae&&(x(e),x(se)),ie&&ie.d(),ce&&ce.d(),st(ge,ae),Ne&&Ne.d(),st(Ce,ae),de.d(),Re&&Re.d(),Xe[N].d(),pe&&pe.d(ae)}}}function CD(t,e,n){let{item:s}=e,{comparison:i=!1}=e,{isTrader:o=!1}=e,{shift:r=!1}=e,l=s.stats.has(10)?Array.from(s.stats).filter(u=>u[0]!==11):Array.from(s.stats),a,c,f=u=>{let p=new Map;return s.stats.forEach((g,v)=>{p.set(v,g.value)}),u.stats.forEach((g,v)=>{let _=(p.get(v)||0)-g.value;_!==0?p.set(v,_):p.delete(v)}),Array.from(p)};return t.$$set=u=>{"item"in u&&n(0,s=u.item),"comparison"in u&&n(6,i=u.comparison),"isTrader"in u&&n(1,o=u.isTrader),"shift"in u&&n(2,r=u.shift)},t.$$.update=()=>{if(t.$$.dirty&69)if(I&&r&&!i){let u=s.getEquipSlot();if(u!==void 0&&I.player.inventory.slots.has(u)){let p=I.player.inventory.slots.get(u);n(3,a=p.type!==void 0?p:void 0),n(4,c=f(p))}}else n(3,a=void 0),n(4,c=void 0)},[s,o,r,a,c,l,i]}var ld=class extends Fe{constructor(e){super(),Se(this,e,CD,FD,Oe,{item:0,comparison:6,isTrader:1,shift:2})}},ad=ld;var bg={};Xn(bg,{addMessage:()=>Wt,init:()=>PD,onWorldDestroy:()=>ED,postTick:()=>TD,wipeChatData:()=>_g});var dg,hg={},Dt=t=>(dg===void 0&&(dg=getComputedStyle(document.body)),hg[t]!==void 0?hg[t]:hg[t]=dg.getPropertyValue("--"+t));var _M=()=>{Cs.font="bold 18px hordes",Cs.fillText("Hordes",0,0)},cr=(t,e,n=1,s=1,i=1,o=1,r=0,l=0,a=.5,c=.5)=>{Cs.globalAlpha=le.nameplateShowTransparency?n:1;let f=t.width*s,u=t.height*s,p=Math.round(f*i),g=Math.round(u*o);return p===0||g===0||Cs.drawImage(t,0,0,Math.round(t.width*i),Math.round(t.height*o),Math.round(e[0]-f*a+r*s),Math.round(e[1]-u*c+l*s),p,g),p},fr=(t,e,n,s,i,o=0,r=0,l=.5,a=.5)=>cr(tu(e,n),t,s,i,1,1,o,r,l,a),bM=(t,e,n,s,i=0,o=0,r=.5,l=.5)=>cr(e,t,n,s,1,1,i,o,r,l),gl=(t,e,n=!1)=>(n?(e[0]=t[0],e[1]=t[1]):Ms(e,t,gt.projectionViewMatrix),n||e[2]<1&&e[0]>-1&&e[0]<1?(e[1]=Math.max(-1,Math.min(e[1],1)),e[0]=Math.round((e[0]*.5+.5)*In.width),e[1]=Math.round((e[1]*-.5+.5)*In.height),e[1]=Math.max(30,e[1]),e):!1),yM=(t,e,n)=>{t.font="bold "+e+"px hordes",t.shadowColor="#000",t.shadowOffsetX=1,t.shadowOffsetY=1,t.fillStyle=n},It={name:{fill:Dt("name"),size:17},enemy:{fill:Dt("enemy"),size:17},pvp:{fill:Dt("pvp"),size:17},nameSmall:{fill:Dt("name"),size:13},enemySmall:{fill:Dt("enemy"),size:13},pvpSmall:{fill:Dt("pvp"),size:13},chatGlobal:{fill:Dt("global"),size:13,wrap:150},chatClan:{fill:Dt("clan"),size:13,wrap:150},chatParty:{fill:Dt("party"),size:13,wrap:150},chatWhisper:{fill:Dt("pvp"),size:13,wrap:150},chatYell:{fill:Dt("yell"),size:13,wrap:150},lev0:{fill:"#919191",size:13},lev1:{fill:Dt("name"),size:13},lev2:{fill:"#EEA303",size:13},lev3:{fill:Dt("enemy"),size:13},clan:{fill:Dt("clan"),size:17},faction0:{fill:Dt("f0"),size:17},faction1:{fill:Dt("f1"),size:17},faction0small:{fill:Dt("f0"),size:13},faction1small:{fill:Dt("f1"),size:13},phys:{fill:Dt("name"),size:18},physCrit:{fill:Dt("name"),size:24},spell:{fill:"#FFE404",size:28},spellCrit:{fill:"#FFE404",size:40},heal:{fill:"#12F027",size:28},mana:{fill:Dt("mana"),size:20},exp:{fill:Dt("exp"),size:20},fame:{fill:Dt("fame"),size:20},gold:{fill:"#EEDDA3",size:16},misc:{fill:"#A6EBFA",size:16},book:{fill:"#749DEF",size:20},rune:{fill:"#DC9A4D",size:20},itemgrey:{fill:"#747474",size:16},common:{fill:"#dddddd",size:20},uncommon:{fill:Dt("green"),size:20},rare:{fill:Dt("blue"),size:20},epic:{fill:Dt("purp"),size:20},legendary:{fill:"#EE960B",size:20},mythical:{fill:"#a72929",size:20},pheal:{fill:"#12F027",size:20},pdmg:{fill:Dt("enemy"),size:20}},gg={},tu=(t,{fill:e,size:n,wrap:s=0})=>{let i=t+e+n;if(gg[i])return gg[i];let o=document.createElement("canvas"),r=o.getContext("2d");return r.font="bold "+n+"px hordes",s>0?SD(o,r,t,0,0,s,n,e):(o.width=Math.max(1,Math.ceil(r.measureText(t).width))+5,o.height=Math.ceil(n*1.2+5),yM(r,n,e),r.fillText(t,0,o.height-6)),gg[i]=o,o},Ts=(t,e,n,s,i,o,r)=>{t||(t=document.createElement("canvas"),t.width=n,t.height=s);let l=t.getContext("2d");return l.fillStyle=e,l.beginPath(),l.moveTo(i+r,o),l.arcTo(i+n,o,i+n,o+s,r),l.arcTo(i+n,o+s,i,o+s,r),l.arcTo(i,o+s,i,o,r),l.arcTo(i,o,i+n,o,r),l.closePath(),l.fill(),t},SD=(t,e,n,s,i,o,r,l)=>{let a=n.split(" "),c=[],f=0,u="";for(let p=0;p<a.length;++p){let g=u+a[p]+" ",v=e.measureText(g);v.width>o?(c.push(u),u=a[p]+" "):(f=Math.max(f,v.width),u=g)}c.push(u),t.width=Math.ceil(f+5),t.height=Math.ceil(c.length*r+10),Ts(t,"#00000099",t.width,t.height,0,0,5),yM(e,r,l);for(let p=0;p<c.length;++p)e.fillText(c[p],s+5,(p+1)*r+3)};var AD=0,kM=new kt(0,10),cd=[],fd=[],PD=()=>{Un(Ft.serverChat.header,t=>{cd.push(t)}),Un(Ft.serverSystemMessage.header,t=>{fd.push(t)})},vg=0,TD=(t,e)=>{cd.forEach(n=>{n=Ft.serverChat.decode(n),n.messages.forEach(s=>{if(s.from==""){let i=s.message.split(" ");C&&C.ui.messages[i[0]]&&(s.message=C.ui.messages[i[0]],i.splice(1).forEach((o,r)=>{s.message=s.message.replace("$"+(r+1),o)})),s.channel="notice"}else if(le.chatbubbles&&vg>5){let i=s.channel=="to"?e.player.name:s.from,o=e.getPlayerByName(i);if(o){let r;switch(s.channel){case"from":case"to":r=It.chatWhisper;break;case"clan":r=It.chatClan;break;case"party":r=It.chatParty;break;case"yell":r=It.chatYell;break;default:case"global":r=It.chatGlobal;break}o.speech(i+": "+s.message,r)}}s.clan==="GM"&&s.channel==="global"&&(s.channel="GM"),Wt(s.channel,s.message,s.channel=="system"||s.channel=="notice",s.from,s.faction,s.class,s.level,s.subscribed,s.id)})}),fd.forEach(n=>{n=Ft.serverSystemMessage.decode(n),n.messages.forEach(s=>{Wt(s.type,s.message,!0)})}),cd.length=0,fd.length=0,vg++},Wt=(t,e,n=!1,s,i,o,r,l,a=0)=>{Ic.update(c=>{c.length>100&&c.shift(),n&&(e=jf(e)),t==="from"&&(kM.done(I.time)&&Mt(97),kM.reset(I.time));let f=new Date;return c.push({channel:t,time:`${String(f.getHours()).padStart(2,"0")}.${String(f.getMinutes()).padStart(2,"0")}`,text:e,key:++AD,sender:s,sub:l,faction:i,cclass:o,level:r,interpolate:n,id:a}),c})},_g=()=>{Ic.set([]),vg=0},ED=()=>{cd.length=0,fd.length=0};function DD(t){let e,n;return e=new hl({props:{level:t[2]||1,skill:{...Pt.get(t[7].id)}}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i[0]&4&&(o.level=s[2]||1),i[0]&128&&(o.skill={...Pt.get(s[7].id)}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function ID(t){let e,n;return e=new ad({props:{item:t[4]}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i[0]&16&&(o.item=s[4]),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function VD(t){let e,n,s,i,o=[ID,DD],r=[];function l(a,c){return a[4]?0:a[7].id>=0?1:-1}return~(e=l(t,[-1,-1]))&&(n=r[e]=o[e](t)),{c(){n&&n.c(),s=be()},m(a,c){~e&&r[e].m(a,c),w(a,s,c),i=!0},p(a,c){let f=e;e=l(a,c),e===f?~e&&r[e].p(a,c):(n&&(Ee(),V(r[f],1,1,()=>{r[f]=null}),De()),~e?(n=r[e],n?n.p(a,c):(n=r[e]=o[e](a),n.c()),P(n,1),n.m(s.parentNode,s)):n=null)},i(a){i||(P(n),i=!0)},o(a){V(n),i=!1},d(a){a&&x(s),~e&&r[e].d(a)}}}function LD(t){let e,n;return e=new ml({props:{shift:t[1],describe:t[7].id>=0&&!t[7].item||t[4]!==void 0,descPos:"bottom:100%;left:50%;transform:translateX(-50%);",clickToUse:!0,status:t[11]?-1:t[5]!==void 0?t[5].status:0,id:"sk"+t[7].hotkey,data:t[7].id>=0||t[4]!==void 0?t[7]:void 0,auto:t[9],queued:t[10],meta:t[16],css:t[15],stacks:t[3],cd:t[13],img:t[14],remaining:t[12],key:t[7].hotkey,border:t[10]||t[8]?"auto":t[11]||t[9]||t[6]||t[13]?"grey":t[4]?Yt(t[4].quality)[0]:"white",$$slots:{default:[VD]},$$scope:{ctx:t}}}),e.$on("discard",t[25]),e.$on("move",t[26]),e.$on("use",t[17]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i[0]&2&&(o.shift=s[1]),i[0]&144&&(o.describe=s[7].id>=0&&!s[7].item||s[4]!==void 0),i[0]&2080&&(o.status=s[11]?-1:s[5]!==void 0?s[5].status:0),i[0]&128&&(o.id="sk"+s[7].hotkey),i[0]&144&&(o.data=s[7].id>=0||s[4]!==void 0?s[7]:void 0),i[0]&512&&(o.auto=s[9]),i[0]&1024&&(o.queued=s[10]),i[0]&65536&&(o.meta=s[16]),i[0]&32768&&(o.css=s[15]),i[0]&8&&(o.stacks=s[3]),i[0]&8192&&(o.cd=s[13]),i[0]&16384&&(o.img=s[14]),i[0]&4096&&(o.remaining=s[12]),i[0]&128&&(o.key=s[7].hotkey),i[0]&12112&&(o.border=s[10]||s[8]?"auto":s[11]||s[9]||s[6]||s[13]?"grey":s[4]?Yt(s[4].quality)[0]:"white"),i[0]&148|i[1]&8&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function qD(t,e,n){let s,i,o,r,l,a,c,f,u,p,g,v,_,b,y,k,S=ue,A=()=>(S(),S=li(R,ge=>n(7,k=ge)),R),F,M,D,L,E;oe(t,cp,ge=>n(20,F=ge)),oe(t,ap,ge=>n(21,M=ge)),oe(t,zo,ge=>n(22,D=ge)),oe(t,sa,ge=>n(23,L=ge)),oe(t,Ro,ge=>n(24,E=ge)),t.$$.on_destroy.push(()=>S());let{skill:R}=e;A();let{skillslot:z}=e,{shift:q=!1}=e,j,W,N,O;Pc(()=>{if(k.hotkey!==j&&(W!==void 0&&ie(),j=k.hotkey,j!==void 0)){O=nt[j],O==null&&(O=nt[j]={});let ge=fn(j,O);W=ge.onPress(se),N=ge.onRelease(re)}});let se=ge=>{if(I.player&&k.id>=0){if(k.item){let Te=I.player.inventory.findFirstSlotOfType(k.item.type,k.item.tier);if(Te!==void 0){let Ce=I.player.inventory.slots.get(Te);if(Ce.bound<Ce.logic.bindOnUse){Wt("error","Right-click and use the item in your inventory to bind it before using");return}tt(R,k.info[0]=Te,k)}else return}let Ne=Pt.get(k.id);Ne.envCast>0?rr>0?Jf(0,0,0):Jf(k.id,Ne.range,Ne.envCast):Ss(Ft.clientPlayerSkill.packData({id:k.id,info:k.info})),ge.type==="keydown"&&n(8,u=!0),Mt(96)}},re=()=>{n(8,u=!1)},ie=()=>{O&&O.mappings&&(O.mappings=O.mappings.filter(ge=>ge!=j)),O&&O.press&&(O.press=O.press.filter(ge=>ge!=W)),O&&O.release&&(O.release=O.release.filter(ge=>ge!=N)),j=void 0,W=void 0,N=void 0};Tn(ie);function ce(ge){io.call(this,t,ge)}function ke(ge){io.call(this,t,ge)}return t.$$set=ge=>{"skill"in ge&&A(n(0,R=ge.skill)),"skillslot"in ge&&n(18,z=ge.skillslot),"shift"in ge&&n(1,q=ge.shift)},t.$$.update=()=>{t.$$.dirty[0]&262272&&n(16,s={type:"skill",slot:z,skill:k}),t.$$.dirty[0]&128&&n(6,i=k.id<0),t.$$.dirty[0]&128&&n(19,o=k.item),t.$$.dirty[0]&16777408&&n(5,r=i?void 0:E[k.id]),t.$$.dirty[0]&128&&n(15,l=k.item?"slotitem":"slotskill"),t.$$.dirty[0]&8388736&&n(4,a=L&&k.item&&I.player?I.player.inventory.findFirstItemOfType(k.item.type,k.item.tier):void 0),t.$$.dirty[0]&524496&&n(14,c=i?void 0:o?a?zf(a.type,a.tier,a.logic.class,ja(a.quality)):zf(o.type,o.tier,0,0):Bf(k.id)),t.$$.dirty[0]&8912912&&n(3,f=a!==void 0&&a.stacks!==void 0?L[o.type+o.tier]||0:void 0),t.$$.dirty[0]&4194496&&n(2,p=!k.item&&!i&&D.has(k.id)?D.get(k.id):0),t.$$.dirty[0]&32&&n(13,g=r?r.cd:void 0),t.$$.dirty[0]&32&&n(12,v=r?r.remaining:void 0),t.$$.dirty[0]&156&&n(11,_=k.item&&(!a||f===0)||!k.item&&p===0),t.$$.dirty[0]&2097280&&n(10,b=M!==void 0&&M===k.id),t.$$.dirty[0]&1048704&&n(9,y=F!==void 0&&F===k.id)},n(8,u=!1),[R,q,p,f,a,r,i,k,u,y,b,_,v,g,c,l,s,se,z,o,F,M,D,L,E,ce,ke]}var yg=class extends Fe{constructor(e){super(),Se(this,e,qD,LD,Oe,{skill:0,skillslot:18,shift:1},null,[-1,-1])}},xM=yg;function wM(t,e,n){let s=t.slice();return s[10]=e[n],s[12]=n,s}function MM(t){let e,n;return e=new xM({props:{skill:t[10],skillslot:t[12],shift:t[0]}}),e.$on("discard",t[3]),e.$on("move",t[2]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&1&&(o.shift=s[0]),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function RD(t){let e,n,s=me(ws),i=[];for(let r=0;r<s.length;r+=1)i[r]=MM(wM(t,s,r));let o=r=>V(i[r],1,1,()=>{i[r]=null});return{c(){e=h("div");for(let r=0;r<i.length;r+=1)i[r].c();m(e,"id","skillbar"),m(e,"class","panel-black bar svelte-1v6qmvo")},m(r,l){w(r,e,l);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(e,null);n=!0},p(r,[l]){if(l&13){s=me(ws);let a;for(a=0;a<s.length;a+=1){let c=wM(r,s,a);i[a]?(i[a].p(c,l),P(i[a],1)):(i[a]=MM(c),i[a].c(),P(i[a],1),i[a].m(e,null))}for(Ee(),a=s.length;a<i.length;a+=1)o(a);De()}},i(r){if(!n){for(let l=0;l<s.length;l+=1)P(i[l]);n=!0}},o(r){i=i.filter(Boolean);for(let l=0;l<i.length;l+=1)V(i[l]);n=!1},d(r){r&&x(e),st(i,r)}}}function zD(t,e,n){let s,i,o,r;oe(t,En,g=>n(5,s=g)),oe(t,ho,g=>n(6,i=g)),oe(t,Xr,g=>n(7,o=g));let l=nt.shift.store;oe(t,l,g=>n(0,r=g));let a=I.player.name,c=i[a];c||(c=tt(ho,i[a]=[],i));for(let g=0;g<o;++g)if(i[a][g]===void 0){let v=Am.get(I.player.class).startSkills[g];i[a].push({id:v!==void 0&&Pt.get(v).autoSkillbar?v:-1,type:0,info:[]}),g===4||g===5?(tt(ho,i[a][g].id=100,i),tt(ho,i[a][g].item={type:"misc",tier:g-4},i)):g===11&&tt(ho,i[a][11].id=40,i)}for(let g=0;g<o;++g)ws[g]===void 0&&ws.push(K({id:-1,type:0,info:[]}));i[a].forEach((g,v)=>{ws[v]&&(g.hotkey=le["kbSkillbar"+(v+1)],ws[v].set(g))}),ws.forEach((g,v)=>{g.subscribe(_=>{ho.update(b=>(b[a][v]=_,b))})});let f=g=>{let{from:v,to:_}=g.detail;v!==_&&(v.type=="item"?ws[_.slot].update(b=>(b.id=v.item.logic.useSkill,b.item={type:v.item.type,tier:v.item.tier},b)):v.type=="skill"&&(ws[_.slot].update(b=>(b.id=v.skill.id,b.item=v.skill.item,b)),v.slot!==void 0&&ws[v.slot].update(u)))},u=g=>(g.id=-1,g.item=void 0,g);return[r,l,f,g=>{ws[s.meta.slot].update(u)}]}var kg=class extends Fe{constructor(e){super(),Se(this,e,zD,RD,Fn,{})}},FM=kg;function CM(t){let e,n;return e=new ad({props:{isTrader:t[6],item:t[10],shift:t[8]}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&64&&(o.isTrader=s[6]),i&1024&&(o.item=s[10]),i&256&&(o.shift=s[8]),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function BD(t){let e,n,s=t[10]&&CM(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,o){i[10]?s?(s.p(i,o),o&1024&&P(s,1)):(s=CM(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function UD(t){let e,n;return e=new ml({props:{describe:t[10]!==void 0,shift:t[8],cd:t[11],id:t[7],hover:t[5],descPos:t[4],descRoot:t[3],pickable:t[1],status:t[9]?-1:0,meta:t[14],img:t[15],border:t[13],stacks:t[12],data:t[10],key:t[2],$$slots:{default:[BD]},$$scope:{ctx:t}}}),e.$on("discard",t[21]),e.$on("use",t[22]),e.$on("click",t[23]),e.$on("context",t[24]),e.$on("move",t[25]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,[i]){let o={};i&1024&&(o.describe=s[10]!==void 0),i&256&&(o.shift=s[8]),i&2048&&(o.cd=s[11]),i&128&&(o.id=s[7]),i&32&&(o.hover=s[5]),i&16&&(o.descPos=s[4]),i&8&&(o.descRoot=s[3]),i&2&&(o.pickable=s[1]),i&512&&(o.status=s[9]?-1:0),i&16384&&(o.meta=s[14]),i&32768&&(o.img=s[15]),i&8192&&(o.border=s[13]),i&4096&&(o.stacks=s[12]),i&1024&&(o.data=s[10]),i&4&&(o.key=s[2]),i&134219072&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function OD(t,e,n){let s,i,o,r,l,a,c,f,u=ue,p=()=>(u(),u=li(v,O=>n(10,f=O)),v),g;oe(t,Ro,O=>n(20,g=O)),t.$$.on_destroy.push(()=>u());let{item:v}=e;p();let{filter:_=""}=e,{invslot:b}=e,{pickable:y=!0}=e,{text:k}=e,{descRoot:S}=e,{descPos:A}=e,{hover:F}=e,{isTrader:M=!1}=e,{clearOnMove:D=!1}=e,{id:L=""}=e,{shift:E=!1}=e,R=O=>O===!0||f.moving?!0:!(!O||f.type.includes(O)||f.logic.level>O||C.items[f.type][f.type==="book"?f.logic.skillid:f.tier].name.toLowerCase().includes(O));function z(O){io.call(this,t,O)}function q(O){io.call(this,t,O)}function j(O){io.call(this,t,O)}function W(O){io.call(this,t,O)}function N(O){io.call(this,t,O)}return t.$$set=O=>{"item"in O&&p(n(0,v=O.item)),"filter"in O&&n(16,_=O.filter),"invslot"in O&&n(17,b=O.invslot),"pickable"in O&&n(1,y=O.pickable),"text"in O&&n(2,k=O.text),"descRoot"in O&&n(3,S=O.descRoot),"descPos"in O&&n(4,A=O.descPos),"hover"in O&&n(5,F=O.hover),"isTrader"in O&&n(6,M=O.isTrader),"clearOnMove"in O&&n(18,D=O.clearOnMove),"id"in O&&n(7,L=O.id),"shift"in O&&n(8,E=O.shift)},t.$$.update=()=>{t.$$.dirty&132096&&n(15,s=f?zf(f.type,f.tier,f.logic?f.logic.class:0,ja(f.quality)):b>100?Rk(b):void 0),t.$$.dirty&394241&&n(14,i={type:"item",slot:b,item:f,store:D?v:void 0}),t.$$.dirty&66624&&n(9,o=f&&(M?!1:R(_))),t.$$.dirty&1536&&n(13,r=f?Yt(f.quality)[0]+(o?" grey":""):"grey"),t.$$.dirty&1024&&n(12,l=f&&(f.upgrade?"+"+f.upgrade:f.stacks)),t.$$.dirty&1049600&&n(19,a=f&&f.logic.useSkill?g[f.logic.useSkill]:void 0),t.$$.dirty&524288&&n(11,c=a?a.cd:void 0)},[v,y,k,S,A,F,M,L,E,o,f,c,l,r,i,s,_,b,D,a,g,z,q,j,W,N]}var xg=class extends Fe{constructor(e){super(),Se(this,e,OD,UD,Oe,{item:0,filter:16,invslot:17,pickable:1,text:2,descRoot:3,descPos:4,hover:5,isTrader:6,clearOnMove:18,id:7,shift:8})}},bs=xg;function SM(t,e,n){let s=t.slice();return s[19]=e[n],s[21]=n,s}function AM(t){let e,n;return e=new jt({props:{zindex:7,title:C.ui.inventory.name,icon:"bag",$$slots:{default:[$D]},$$scope:{ctx:t}}}),e.$on("close",t[14]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&4194555&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function PM(t){let e,n;return e=new bs({props:{id:"bag"+t[21],item:t[19],invslot:t[21],filter:t[0].toLowerCase(),shift:t[4]||t[5]}}),e.$on("use",t[12]),e.$on("context",t[11]),e.$on("move",t[10]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&2&&(o.item=s[19]),i&1&&(o.filter=s[0].toLowerCase()),i&48&&(o.shift=s[4]||s[5]),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function $D(t){let e,n,s,i,o,r,l,a,c,f,u=me(t[1].filter(TM)),p=[];for(let v=0;v<u.length;v+=1)p[v]=PM(SM(t,u,v));let g=v=>V(p[v],1,1,()=>{p[v]=null});return o=new kn({props:{amount:t[6]}}),l=new ar({props:{amount:t[7]}}),{c(){e=h("input"),s=h("div");for(let v=0;v<p.length;v+=1)p[v].c();i=h("div"),ne(o.$$.fragment),r=h("a"),ne(l.$$.fragment),m(e,"class","filter svelte-ha50yv"),m(e,"type","text"),m(e,"placeholder",n=C.ui.filter),m(s,"class","slotcontainer svelte-ha50yv"),qe(s,"grid-template-columns","repeat("+t[3]+", auto)"),m(i,"class","panel-black gold svelte-ha50yv"),m(r,"class","panel-black gold svelte-ha50yv"),qe(r,"margin-right","3px"),m(r,"target","_blank"),m(r,"href","/store")},m(v,_){w(v,e,_),We(e,t[0]),w(v,s,_);for(let b=0;b<p.length;b+=1)p[b]&&p[b].m(s,null);w(v,i,_),ee(o,i,null),w(v,r,_),ee(l,r,null),a=!0,c||(f=X(e,"input",t[13]),c=!0)},p(v,_){if(_&1&&e.value!==v[0]&&We(e,v[0]),_&7219){u=me(v[1].filter(TM));let k;for(k=0;k<u.length;k+=1){let S=SM(v,u,k);p[k]?(p[k].p(S,_),P(p[k],1)):(p[k]=PM(S),p[k].c(),P(p[k],1),p[k].m(s,null))}for(Ee(),k=u.length;k<p.length;k+=1)g(k);De()}(!a||_&8)&&qe(s,"grid-template-columns","repeat("+v[3]+", auto)");let b={};_&64&&(b.amount=v[6]),o.$set(b);let y={};_&128&&(y.amount=v[7]),l.$set(y)},i(v){if(!a){for(let _=0;_<u.length;_+=1)P(p[_]);P(o.$$.fragment,v),P(l.$$.fragment,v),a=!0}},o(v){p=p.filter(Boolean);for(let _=0;_<p.length;_+=1)V(p[_]);V(o.$$.fragment,v),V(l.$$.fragment,v),a=!1},d(v){v&&(x(e),x(s),x(i),x(r)),st(p,v),te(o),te(l),c=!1,f()}}}function ND(t){let e,n,s=t[2]&&AM(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[2]?s?(s.p(i,o),o&4&&P(s,1)):(s=AM(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}var TM=(t,e)=>e<101;function jD(t,e,n){let s,i,o,r,l,a,c,f,u,p,g;oe(t,Ys,M=>n(15,s=M)),oe(t,ai,M=>n(16,i=M)),oe(t,Vs,M=>n(17,o=M)),oe(t,En,M=>n(18,r=M)),oe(t,na,M=>n(1,l=M)),oe(t,co,M=>n(2,a=M)),oe(t,jr,M=>n(3,c=M)),oe(t,Hs,M=>n(6,p=M)),oe(t,qo,M=>n(7,g=M));let v="",_=nt.shift.store;oe(t,_,M=>n(4,f=M));let b=nt.ctrl.store;oe(t,b,M=>n(5,u=M));let y=M=>{let{from:D,to:L}=M.detail;if(D!==L&&D.type=="item"&&D.slot!==void 0&&L.slot!==void 0&&D.slot!==L.slot){if(xt("itemmove",`${D.slot} ${L.slot}`),D.slot>=101)return;D.item.stacks&&(D.item.stacks=""),D.item.moving=!0,L.item?(L.item.stacks&&(L.item.stacks=""),l[D.slot].set(L.item),L.item.moving=!0):l[D.slot]&&l[D.slot].set(void 0),l[L.slot].set(D.item)}},k=M=>{if(!M.detail.item||r)return;let D=[];if(o&&D.push(nn.itemstash(M.detail.slot)),M.detail.item.canEquip(I.player)){let L=M.detail.item.getBestEquipslot(I.player.inventory);L!==void 0&&D.push(nn.itemmove(M.detail.slot,L)),M.detail.item.logic.useSkill&&D.push(nn.itemuse(M.detail.slot,M.detail.item.logic.useSkill,M.detail.item.bound,M.detail.item.logic.bindOnUse))}s&&M.detail.item.canBeSold()&&D.push(nn.itemsell(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier)),M.detail.item.stacks>1&&(D.push(nn.itemsplithalf(M.detail.slot)),D.push(nn.itemsplitone(M.detail.slot))),D.push(nn.itemcopyid(M.detail.item.dbid)),M.detail.item.canBeDropped()&&D.push(nn.itemdrop(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier)),bn.set({x:M.detail.e.pageX-M.detail.e.layerX,y:M.detail.e.pageY+(46-M.detail.e.layerY),opts:D})},S=M=>{M.detail.item&&(o?xt("itemstash",`${M.detail.slot}`):i?(ci.set(M.detail.item),M.detail.item.type&&Mt(Rs[M.detail.item.type].sound)):s&&M.detail.item.canBeSold()?$f(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier):M.detail.item.canBeDropped()&&T1(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier))};function A(){v=this.value,n(0,v)}return[v,l,a,c,f,u,p,g,_,b,y,k,S,A,M=>tt(co,a=!1,a)]}var wg=class extends Fe{constructor(e){super(),Se(this,e,jD,ND,Oe,{})}},EM=wg;var Fg={};Xn(Fg,{add:()=>ud,init:()=>DM,onWorldEnter:()=>WD,tick:()=>GD,values:()=>ni});var ni=new Map,Mg=new kt(0,.5),DM=()=>{ni.clear(),Mg.reset(0)},WD=DM,GD=t=>{if(le.dpsmeterOpen&&Mg.done(I.time))if(Mg.reset(I.time),ni.forEach((e,n)=>{if(e.ooc){I.time-e.start>5&&ni.delete(n);return}!I.entity(e.id)||I.time-e.last>5?(e.ooc=!0,e.start=I.time):e.dps=Math.ceil(e.amount/Math.max(5,I.time-e.start))}),le.dpsmeterTarget){let e=ni.get(le.dpsmeterTarget);e?zc.set(Array.from(e.skills).sort((n,s)=>s[1].amount-n[1].amount).map(n=>(n[1].dps=Math.ceil(n[1].amount/Math.max(5,I.time-n[1].start)),n)).slice(0,10)):Hr.set(0)}else zc.set(Array.from(ni).sort((e,n)=>n[1].amount-e[1].amount).slice(0,10))},ud=(t,e,n)=>{if(t.name===void 0||!le.dpsmeterOpen||t.type!==0||le.dpsmeterParty&&(I.player.party===0&&t!==I.player||t.party!==I.player.party))return;let s;ni.has(t.name)?s=ni.get(t.name):(ni.set(t.name,s={}),s.amount=0,s.start=0,s.class=t.class,s.dps=0,s.id=t.id,s.ooc=!0,s.skills=new Map),s.ooc?(s.start=I.time,s.ooc=!1,s.amount=e):s.amount+=e;let i=C.items.book[n]?C.items.book[n].name:"Unknown";s.skills.has(i)||s.skills.set(i,{id:n,class:t.class,amount:0,start:I.time});let o=s.skills.get(i);o.amount+=e,s.last=I.time};function IM(t,e,n){let s=t.slice();return s[11]=e[n],s[13]=n,s}function VM(t){let e,n;return e=new jt({props:{origin:"right bottom",title:t[5][t[1]],icon:"trophy",$$slots:{default:[HD]},$$scope:{ctx:t}}}),e.$on("close",t[10]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&2&&(o.title=s[5][s[1]]),i&16414&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function LM(t,e){let n,s,i,o,r;s=new vs({props:{size:"0.9em",fract:Math.round(100*e[11][1].amount/e[2][0][1].amount),barcol:"bgc"+e[11][1].class,left:`${e[13]+1}. ${e[11][0]}`,right:`${ns(e[11][1].amount)} (${ht(e[11][1].dps)})`}});function l(...a){return e[7](e[11],...a)}return{key:t,first:null,c(){n=h("div"),ne(s.$$.fragment),this.first=n},m(a,c){w(a,n,c),ee(s,n,null),i=!0,o||(r=X(n,"click",l),o=!0)},p(a,c){e=a;let f={};c&4&&(f.fract=Math.round(100*e[11][1].amount/e[2][0][1].amount)),c&4&&(f.barcol="bgc"+e[11][1].class),c&4&&(f.left=`${e[13]+1}. ${e[11][0]}`),c&4&&(f.right=`${ns(e[11][1].amount)} (${ht(e[11][1].dps)})`),s.$set(f)},i(a){i||(P(s.$$.fragment,a),i=!0)},o(a){V(s.$$.fragment,a),i=!1},d(a){a&&x(n),te(s),o=!1,r()}}}function HD(t){let e,n=[],s=new Map,i,o,r=t[5][t[1]]+"",l,a,c,f,u,p,g,v,_=me(t[2]),b=y=>y[11][1].id;for(let y=0;y<_.length;y+=1){let k=IM(t,_,y),S=b(k);s.set(S,n[y]=LM(S,k))}return{c(){e=h("div");for(let y=0;y<n.length;y+=1)n[y].c();i=h("div"),o=h("div"),l=T(r),a=h("div"),c=T("Party"),u=h("div"),u.textContent=`${C.ui.reset}`,m(e,"class","wrapper svelte-hjyujf"),m(o,"class","btn grey"),m(a,"class",f="btn "+(t[4]?"grey active":"black textgrey")),m(u,"class","btn grey"),m(i,"class","grid buttons marg-top svelte-hjyujf"),qe(i,"grid-template-columns","2fr 1fr 1fr")},m(y,k){w(y,e,k);for(let S=0;S<n.length;S+=1)n[S]&&n[S].m(e,null);w(y,i,k),d(i,o),d(o,l),d(i,a),d(a,c),d(i,u),p=!0,g||(v=[X(o,"click",t[6]),X(a,"click",t[8]),X(u,"click",t[9])],g=!0)},p(y,k){k&12&&(_=me(y[2]),Ee(),n=us(n,k,b,1,y,_,s,e,Is,LM,null,IM),De()),(!p||k&2)&&r!==(r=y[5][y[1]]+"")&&G(l,r),(!p||k&16&&f!==(f="btn "+(y[4]?"grey active":"black textgrey")))&&m(a,"class",f)},i(y){if(!p){for(let k=0;k<_.length;k+=1)P(n[k]);p=!0}},o(y){for(let k=0;k<n.length;k+=1)V(n[k]);p=!1},d(y){y&&(x(e),x(i));for(let k=0;k<n.length;k+=1)n[k].d();g=!1,lt(v)}}}function YD(t){let e,n,s=t[0]&&VM(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[0]?s?(s.p(i,o),o&1&&P(s,1)):(s=VM(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function XD(t,e,n){let s,i,o,r,l;oe(t,Gr,v=>n(0,s=v)),oe(t,tf,v=>n(1,i=v)),oe(t,zc,v=>n(2,o=v)),oe(t,Hr,v=>n(3,r=v)),oe(t,ef,v=>n(4,l=v));let a=[C.ui.stats.misc.damage,C.ui.stats.misc.healing];return[s,i,o,r,l,a,v=>{bn.set({x:v.pageX,y:v.pageY-50,opts:a.map((_,b)=>({name:_,fun:()=>{tf.set(b),ni.clear()}}))})},(v,_)=>{tt(Hr,r=r?0:v[0],r)},v=>tt(ef,l=!l,l),v=>ni.clear(),v=>tt(Gr,s=!1,s)]}var Cg=class extends Fe{constructor(e){super(),Se(this,e,XD,YD,Oe,{})}},qM=Cg;function RM(t){let e,n=t[0].area+"",s,i,o,r;return{c(){e=h("p"),s=T(n),o=$e(),m(e,"class","text location textgreen svelte-dujqu3")},m(l,a){w(l,e,a),d(e,s),w(l,o,a),r=!0},p(l,a){(!r||a&1)&&n!==(n=l[0].area+"")&&G(s,n)},i(l){r||(l&&_n(()=>{r&&(i||(i=vh(e,vp,{},!0)),i.run(1))}),r=!0)},o(l){l&&(i||(i=vh(e,vp,{},!1)),i.run(0)),r=!1},d(l){l&&(x(e),x(o)),l&&i&&i.end()}}}function zM(t){let e,n=t[0].error+"",s,i,o;return{c(){e=h("p"),s=T(n),m(e,"class","text error textred svelte-dujqu3")},m(r,l){w(r,e,l),d(e,s),o=!0},p(r,l){(!o||l&1)&&n!==(n=r[0].error+"")&&G(s,n)},i(r){o||(i&&i.end(1),o=!0)},o(r){r&&(i=n_(e,vp,{})),o=!1},d(r){r&&x(e),r&&i&&i.end()}}}function QD(t){let e,n,s=t[0].area&&RM(t),i=t[0].error&&zM(t);return{c(){e=h("div"),s&&s.c(),n=be(),i&&i.c(),m(e,"class","l-ui")},m(o,r){w(o,e,r),s&&s.m(e,null),d(e,n),i&&i.m(e,null)},p(o,[r]){o[0].area?s?(s.p(o,r),r&1&&P(s,1)):(s=RM(o),s.c(),P(s,1),s.m(e,n)):s&&(Ee(),V(s,1,1,()=>{s=null}),De()),o[0].error?i?(i.p(o,r),r&1&&P(i,1)):(i=zM(o),i.c(),P(i,1),i.m(e,null)):i&&(Ee(),V(i,1,1,()=>{i=null}),De())},i(o){P(s),P(i)},o(o){V(s),V(i)},d(o){o&&x(e),s&&s.d(),i&&i.d()}}}function ZD(t,e,n){let s={},i={};return Ar.subscribe(o=>{n(0,s[o.type]=o.text,s),i[o.type]&&clearTimeout(i[o.type]),i[o.type]=setTimeout(()=>{n(0,s[o.type]=void 0,s)},o.time||1e3)}),[s]}var Sg=class extends Fe{constructor(e){super(),Se(this,e,ZD,QD,Oe,{})}},BM=Sg;function UM(t,e,n){let s=t.slice();return s[3]=e[n],s}function OM(t){let e,n;return e=new jt({props:{origin:"center",zindex:10,title:C.ui.headers.request,close:!1,$$slots:{default:[JD]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&65&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function $M(t){let e,n=t[3].text+"",s,i,o=(t[3].unavailable||"")+"",r,l,a=(t[3].additional||"")+"",c,f,u,p;function g(){return t[2](t[3])}return{c(){e=h("div"),s=T(n),i=$e(),r=T(o),l=$e(),c=T(a),m(e,"class",f="choice "+(t[3].unavailable?"unavailable textgrey":"")+" svelte-1uywqr8")},m(v,_){w(v,e,_),d(e,s),d(e,i),d(e,r),d(e,l),d(e,c),u||(p=X(e,"click",g),u=!0)},p(v,_){t=v,_&1&&n!==(n=t[3].text+"")&&G(s,n),_&1&&o!==(o=(t[3].unavailable||"")+"")&&G(r,o),_&1&&a!==(a=(t[3].additional||"")+"")&&G(c,a),_&1&&f!==(f="choice "+(t[3].unavailable?"unavailable textgrey":"")+" svelte-1uywqr8")&&m(e,"class",f)},d(v){v&&x(e),u=!1,p()}}}function JD(t){let e,n,s=t[0][0].title+"",i,o,r=t[0][0].text+"",l=me(t[0][0].choices),a=[];for(let c=0;c<l.length;c+=1)a[c]=$M(UM(t,l,c));return{c(){e=h("div"),n=h("h3"),i=T(s),o=h("p");for(let c=0;c<a.length;c+=1)a[c].c();m(n,"class","textprimary"),m(e,"class","container svelte-1uywqr8")},m(c,f){w(c,e,f),d(e,n),d(n,i),d(e,o),o.innerHTML=r;for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(e,null)},p(c,f){if(f&1&&s!==(s=c[0][0].title+"")&&G(i,s),f&1&&r!==(r=c[0][0].text+"")&&(o.innerHTML=r),f&3){l=me(c[0][0].choices);let u;for(u=0;u<l.length;u+=1){let p=UM(c,l,u);a[u]?a[u].p(p,f):(a[u]=$M(p),a[u].c(),a[u].m(e,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=l.length}},d(c){c&&x(e),st(a,c)}}}function KD(t){let e,n,s=t[0].length&&OM(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[0].length?s?(s.p(i,o),o&1&&P(s,1)):(s=OM(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function eI(t,e,n){let s;oe(t,oo,r=>n(0,s=r));let i=async r=>{r&&await r(),Xh()};return[s,i,r=>{i(r.fun)}]}var Ag=class extends Fe{constructor(e){super(),Se(this,e,eI,KD,Oe,{})}},NM=Ag;function jM(t){let e,n,s=t[0][0].text+"",i,o,r=t[0][0].icon&&WM(t);return{c(){e=h("div"),r&&r.c(),n=h("div"),m(e,"class","notification panel-black border grey svelte-9nlpzp")},m(l,a){w(l,e,a),r&&r.m(e,null),d(e,n),n.innerHTML=s,i||(o=X(e,"click",t[2]),i=!0)},p(l,a){l[0][0].icon?r?r.p(l,a):(r=WM(l),r.c(),r.m(e,n)):r&&(r.d(1),r=null),a&1&&s!==(s=l[0][0].text+"")&&(n.innerHTML=s)},d(l){l&&x(e),r&&r.d(),i=!1,o()}}}function WM(t){let e,n,s;return{c(){e=h("img"),m(e,"class",n="icon "+t[0][0].css+" svelte-9nlpzp"),at(e.src,s="/data/ui/"+t[0][0].icon)||m(e,"src",s)},m(i,o){w(i,e,o)},p(i,o){o&1&&n!==(n="icon "+i[0][0].css+" svelte-9nlpzp")&&m(e,"class",n),o&1&&!at(e.src,s="/data/ui/"+i[0][0].icon)&&m(e,"src",s)},d(i){i&&x(e)}}}function tI(t){let e,n=t[0].length&&!t[1]&&jM(t);return{c(){n&&n.c(),e=be()},m(s,i){n&&n.m(s,i),w(s,e,i)},p(s,[i]){s[0].length&&!s[1]?n?n.p(s,i):(n=jM(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ue,o:ue,d(s){s&&x(e),n&&n.d(s)}}}function nI(t,e,n){let s,i;return oe(t,Dc,r=>n(0,s=r)),oe(t,xs,r=>n(1,i=r)),[s,i,()=>{Dc.update(r=>(r.shift(),r))}]}var Pg=class extends Fe{constructor(e){super(),Se(this,e,nI,tI,Oe,{})}},GM=Pg;function HM(t,e,n){let s=t.slice();return s[5]=e[n],s}function YM(t){let e,n;return{c(){e=h("div"),n=T(t[0]),m(e,"class","btn border grey")},m(s,i){w(s,e,i),d(e,n)},p(s,i){i&1&&G(n,s[0])},d(s){s&&x(e)}}}function XM(t){let e,n,s,i,o,r;function l(...c){return t[2](t[5],...c)}function a(...c){return t[4](t[5],...c)}return{c(){e=h("div"),n=h("img"),m(n,"class","svgicon"),at(n.src,s="/data/ui/icons/"+t[5].img+".svg?v=8593107")||m(n,"src",s),m(e,"id",i="sys"+t[5].img),m(e,"class","btn border black")},m(c,f){w(c,e,f),d(e,n),o||(r=[X(e,"mouseenter",l),X(e,"mouseleave",t[3]),X(e,"click",a)],o=!0)},p(c,f){t=c},d(c){c&&x(e),o=!1,lt(r)}}}function sI(t){let e,n,s=t[0]!==""&&YM(t),i=me(t[1]),o=[];for(let r=0;r<i.length;r+=1)o[r]=XM(HM(t,i,r));return{c(){e=h("div"),s&&s.c(),n=be();for(let r=0;r<o.length;r+=1)o[r].c();m(e,"class","btnbar svelte-133q4bd")},m(r,l){w(r,e,l),s&&s.m(e,null),d(e,n);for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(e,null)},p(r,[l]){if(r[0]!==""?s?s.p(r,l):(s=YM(r),s.c(),s.m(e,n)):s&&(s.d(1),s=null),l&3){i=me(r[1]);let a;for(a=0;a<i.length;a+=1){let c=HM(r,i,a);o[a]?o[a].p(c,l):(o[a]=XM(c),o[a].c(),o[a].m(e,null))}for(;a<o.length;a+=1)o[a].d(1);o.length=i.length}},i:ue,o:ue,d(r){r&&x(e),s&&s.d(),st(o,r)}}}function iI(t,e,n){let s=[{img:"gem",desc:C.ui.elixir.subscription,store:Ls},{img:"char",desc:C.ui.headers.character,store:mo},{img:"book",desc:C.ui.headers.skills,store:fo},{img:"bag",desc:C.ui.inventory.name,store:co},{img:"pvp",desc:C.ui.headers.pvp,store:po},{img:"clan",desc:C.ui.clan.heading,store:uo},{img:"trophy",desc:C.ui.headers.dpsMeter,store:Gr},{img:"cog",desc:C.ui.settings.name,store:Wr},{img:"fullscreen",desc:C.ui.headers.fullscreen,fun:async()=>{"keyboard"in navigator&&"lock"in navigator.keyboard&&await navigator.keyboard.lock(["Escape"]),document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}},{img:"back",desc:C.ui.headers.menuReturn,fun:()=>{document.location.href="/"}}],i="";return[i,s,(a,c)=>n(0,i=a.desc),a=>n(0,i=""),(a,c)=>{a.fun?a.fun():a.store.update(f=>!f)}]}var Tg=class extends Fe{constructor(e){super(),Se(this,e,iI,sI,Oe,{})}},QM=Tg;function oI(t){let e,n,s,i;return{c(){e=h("div"),m(e,"class",n="btn checkbox "+(t[2]?"active":""))},m(o,r){w(o,e,r),s||(i=X(e,"click",t[3]),s=!0)},p(o,[r]){r&4&&n!==(n="btn checkbox "+(o[2]?"active":""))&&m(e,"class",n)},i:ue,o:ue,d(o){o&&x(e),s=!1,i()}}}function rI(t,e,n){let s,i=ue,o=()=>(i(),i=li(r,c=>n(2,s=c)),r);t.$$.on_destroy.push(()=>i());let{store:r}=e;o();let{cb:l}=e,a=c=>{tt(r,s=!s,s),l&&l(s)};return t.$$set=c=>{"store"in c&&o(n(0,r=c.store)),"cb"in c&&n(1,l=c.cb)},[r,l,s,a]}var Eg=class extends Fe{constructor(e){super(),Se(this,e,rI,oI,Oe,{store:0,cb:1})}},Bt=Eg;function ZM(t,e,n){let s=t.slice();return s[76]=e[n],s[78]=n,s}function JM(t,e,n){let s=t.slice();return s[73]=e[n],s}function KM(t,e,n){let s=t.slice();return s[70]=e[n],s[71]=e,s[72]=n,s}function e6(t,e,n){let s=t.slice();return s[79]=e[n],s}function t6(t){let e,n;return e=new jt({props:{zindex:9,title:C.ui.settings.name,origin:"center",icon:"cog",$$slots:{default:[pI]},$$scope:{ctx:t}}}),e.$on("close",t[68]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i[0]&2147483626|i[1]&1|i[2]&1048576&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function n6(t){let e,n=t[79].name+"",s,i,o,r;function l(...a){return t[36](t[79],...a)}return{c(){e=h("div"),s=T(n),m(e,"class",i="choice "+(t[79]==t[1]?"active":""))},m(a,c){w(a,e,c),d(e,s),o||(r=X(e,"click",l),o=!0)},p(a,c){t=a,c[0]&2&&i!==(i="choice "+(t[79]==t[1]?"active":""))&&m(e,"class",i)},d(a){a&&x(e),o=!1,r()}}}function lI(t){let e,n,s,i,o,r;n=new Bt({props:{store:Xp}});let l=me(C.ui.chat.types),a=[];for(let c=0;c<l.length;c+=1)a[c]=s6(ZM(t,l,c));return{c(){e=h("div"),e.textContent=`${C.ui.settings.chatbubbles}`,ne(n.$$.fragment),s=h("div"),s.textContent=`${C.ui.settings.combatlog}`,i=h("div");for(let c=0;c<a.length;c+=1)a[c].c();o=be(),m(s,"class","textprimary")},m(c,f){w(c,e,f),ee(n,c,f),w(c,s,f),w(c,i,f);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(c,f);w(c,o,f),r=!0},p(c,f){if(f[1]&1){l=me(C.ui.chat.types);let u;for(u=0;u<l.length;u+=1){let p=ZM(c,l,u);a[u]?a[u].p(p,f):(a[u]=s6(p),a[u].c(),a[u].m(o.parentNode,o))}for(;u<a.length;u+=1)a[u].d(1);a.length=l.length}},i(c){r||(P(n.$$.fragment,c),r=!0)},o(c){V(n.$$.fragment,c),r=!1},d(c){c&&(x(e),x(s),x(i),x(o)),te(n,c),st(a,c)}}}function aI(t){let e,n=C.ui.settings.language+"",s,i,o,r,l,a,c,f,u,p,g,v,_,b,y,k,S,A,F,M,D,L,E,R,z,q,j,W,N,O,se,re,ie,ce,ke,ge,Ne,Te,Ce,_e,H,de,Re=C.ui.settings.qualitymin+"",Ge,Xe,Ye,pe,ae,Ue,Z,Q=C.ui.settings.excludedrops+"",U,fe,je,Ve,xe,ze,Be,mt,wt,Ze,Et,ye,Je,yt,St,Pe,ft,Ut=C.ui.settings.skillcdtext+"",Le,Ct,Vt,He,Ke,Me,ot,Qe,ut,xn=C.ui.settings.flashinterval+"",Ci,ls,Ds,dt=t[22].toFixed(1)+"",Lt,Si,jn,as,_c=C.ui.settings.flashduration+"",Mr,To,Ai,pn=t[23].toFixed(1)+"",zt,Kt,cs,Iu,Pi,Vu,Ti,Lu,Dl,bc,K0,qu,Il,Ru,Vl,zu,Ei,yc,eh,Bu,Ll,Uu,ql,kc,th,Rl,IP=C.ui.settings.protectedquality+"",T2,E2,xc,nh,D2,Di,zl,VP=C.ui.settings.invwidth+"",I2,V2,Ou,sh,Ii,wc,ih,Bl,LP=C.ui.settings.stashwidth+"",L2,q2,$u,oh,Vi,Ul,qP=C.ui.settings.stashheight+"",R2,z2,Nu,rh,Li,Mc,lh,ju,Ol,ri,ah,B2,$l=me(t[33]),fs=[];for(let J=0;J<$l.length;J+=1)fs[J]=i6(JM(t,$l,J));return y=new Bt({props:{store:ha}}),D=new Bt({props:{store:Rp}}),E=new Bt({props:{store:Up}}),z=new Bt({props:{store:zp}}),j=new Bt({props:{store:Op}}),N=new Bt({props:{store:Bp}}),se=new Bt({props:{store:$p}}),ie=new Bt({props:{store:jp}}),ke=new Bt({props:{store:Gp}}),Ne=new Bt({props:{store:Np}}),H=new Bt({props:{store:Kp}}),mt=new Bt({props:{store:Zp}}),Ze=new Bt({props:{store:Qp}}),ye=new Bt({props:{store:Jp}}),yt=new Bt({props:{store:Wp}}),He=new Bt({props:{store:em,cb:t[34]}}),Me=new Bt({props:{store:tm}}),Qe=new Bt({props:{store:im}}),Dl=new Bt({props:{store:nm}}),Il=new Bt({props:{store:sm}}),Vl=new Bt({props:{store:ga}}),Ll=new Bt({props:{store:Hp}}),ql=new Bt({props:{store:Yp}}),Ol=new Bt({props:{store:da}}),{c(){e=h("div"),s=T(n),i=$e(),o=h("br"),r=h("small"),r.textContent=`${C.ui.settings.reload}`,l=h("select");for(let J=0;J<fs.length;J+=1)fs[J].c();a=h("div"),a.textContent=`${C.ui.settings.tutorial}`,c=h("div"),f=h("div"),f.textContent=`${C.ui.reset}`,u=h("div"),u.textContent=`${C.ui.settings.resettutorial}`,p=h("div"),p.textContent=`${C.ui.disable}`,g=h("div"),g.textContent=`${C.ui.settings.disabletutorial}`,v=h("div"),v.textContent=`${C.ui.settings.fpsping}`,_=h("div"),b=h("div"),b.textContent=`${C.ui.settings.showfps}`,ne(y.$$.fragment),k=h("div"),k.textContent=`${C.ui.settings.nameplates}`,S=h("div"),A=h("div"),A.textContent=`${C.ui.settings.drawrange}`,F=h("input"),M=h("div"),M.textContent=`${C.ui.settings.monsterbars}`,ne(D.$$.fragment),L=h("div"),L.textContent=`${C.ui.settings.monsternames}`,ne(E.$$.fragment),R=h("div"),R.textContent=`${C.ui.settings.friendlyplayerbars}`,ne(z.$$.fragment),q=h("div"),q.textContent=`${C.ui.settings.friendlyplayernames}`,ne(j.$$.fragment),W=h("div"),W.textContent=`${C.ui.settings.enemyplayerbars}`,ne(N.$$.fragment),O=h("div"),O.textContent=`${C.ui.settings.enemyplayernames}`,ne(se.$$.fragment),re=h("div"),re.textContent=`${C.ui.settings.showlevel}`,ne(ie.$$.fragment),ce=h("div"),ce.textContent=`${C.ui.settings.classcolors}`,ne(ke.$$.fragment),ge=h("div"),ge.textContent=`${C.ui.settings.transparency}`,ne(Ne.$$.fragment),Te=h("div"),Te.textContent=`${C.ui.settings.drops}`,Ce=h("div"),_e=h("div"),_e.textContent=`${C.ui.settings.showquality}`,ne(H.$$.fragment),de=h("div"),Ge=T(Re),Xe=h("br"),Ye=h("small"),pe=T(t[20]),ae=T("%"),Ue=h("input"),Z=h("div"),U=T(Q),fe=h("br"),je=h("small"),je.textContent=`${C.ui.settings.reload}`,Ve=h("input"),xe=h("div"),xe.textContent=`${C.ui.settings.damagehealing}`,ze=h("div"),Be=h("div"),Be.textContent=`${C.ui.settings.incomingdamage}`,ne(mt.$$.fragment),wt=h("div"),wt.textContent=`${C.ui.settings.incominghealing}`,ne(Ze.$$.fragment),Et=h("div"),Et.textContent=`${C.ui.settings.incomingmana}`,ne(ye.$$.fragment),Je=h("div"),Je.textContent=`${C.ui.settings.preventoverlap}`,ne(yt.$$.fragment),St=h("div"),St.textContent=`${C.ui.settings.icons}`,Pe=h("div"),ft=h("div"),Le=T(Ut),Ct=h("br"),Vt=h("small"),Vt.textContent=`${C.ui.settings.reload}`,ne(He.$$.fragment),Ke=h("div"),Ke.textContent=`${C.ui.settings.buffcdtext}`,ne(Me.$$.fragment),ot=h("div"),ot.textContent=`${C.ui.settings.selfbuffsonly}`,ne(Qe.$$.fragment),ut=h("div"),Ci=T(xn),ls=h("br"),Ds=h("small"),Lt=T(dt),Si=T("s"),jn=h("input"),as=h("div"),Mr=T(_c),To=h("br"),Ai=h("small"),zt=T(pn),Kt=T("s"),cs=h("input"),Iu=h("div"),Iu.textContent=`${C.ui.settings.buffmax}`,Pi=h("input"),Vu=h("div"),Vu.textContent=`${C.ui.settings.buffmaxparty}`,Ti=h("input"),Lu=h("div"),Lu.textContent=`${C.ui.settings.updateratelimit}`,ne(Dl.$$.fragment),bc=h("div"),bc.textContent=`${C.ui.settings.unitframes}`,K0=h("div"),qu=h("div"),qu.textContent=`${C.ui.settings.showselfparty}`,ne(Il.$$.fragment),Ru=h("div"),Ru.textContent=`${C.ui.settings.partymana}`,ne(Vl.$$.fragment),zu=h("div"),zu.textContent=`${C.ui.settings.partyframewidth}`,Ei=h("input"),yc=h("div"),yc.textContent=`${C.ui.settings.map}`,eh=h("div"),Bu=h("div"),Bu.textContent=`${C.ui.settings.mapshowmonsters}`,ne(Ll.$$.fragment),Uu=h("div"),Uu.textContent=`${C.ui.settings.maplowqual}`,ne(ql.$$.fragment),kc=h("div"),kc.textContent=`${C.ui.inventory.name}`,th=h("div"),Rl=h("div"),T2=T(IP),E2=h("br"),xc=h("small"),nh=T(t[27]),D2=T("%"),Di=h("input"),zl=h("div"),I2=T(VP),V2=h("br"),Ou=h("small"),sh=T(t[28]),Ii=h("input"),wc=h("div"),wc.textContent=`${C.ui.stash.name}`,ih=h("div"),Bl=h("div"),L2=T(LP),q2=h("br"),$u=h("small"),oh=T(t[29]),Vi=h("input"),Ul=h("div"),R2=T(qP),z2=h("br"),Nu=h("small"),rh=T(t[30]),Li=h("input"),Mc=h("div"),Mc.textContent="Social",lh=h("div"),ju=h("div"),ju.textContent="Twitch Streams",ne(Ol.$$.fragment),m(r,"class","textgrey"),t[18]===void 0&&_n(()=>t[52].call(l)),m(a,"class","textprimary"),m(u,"class","btn blue"),m(g,"class","btn orange"),m(v,"class","textprimary"),m(k,"class","textprimary"),m(F,"type","range"),m(Te,"class","textprimary"),m(Ye,"class","textgrey"),m(Ue,"type","range"),m(Ue,"min","0"),m(Ue,"max","100"),m(je,"class","textgrey"),m(Ve,"type","text"),m(Ve,"placeholder","misc, gold, ..."),m(xe,"class","textprimary"),m(St,"class","textprimary"),m(Vt,"class","textgrey"),m(Ds,"class","textgrey"),m(jn,"type","range"),m(jn,"min","0"),m(jn,"max","1"),m(jn,"step","0.1"),m(Ai,"class","textgrey"),m(cs,"type","range"),m(cs,"min","0"),m(cs,"max","5"),m(cs,"step","0.1"),m(Pi,"placeholder","14"),m(Pi,"type","number"),m(Pi,"min","0"),m(Ti,"placeholder","8"),m(Ti,"type","number"),m(Ti,"min","0"),m(bc,"class","textprimary"),m(Ei,"type","range"),m(Ei,"min","50"),m(Ei,"max","400"),m(yc,"class","textprimary"),m(kc,"class","textprimary"),m(xc,"class","textgrey"),m(Di,"type","range"),m(Di,"min","0"),m(Di,"max","110"),m(Ou,"class","textgrey"),m(Ii,"type","range"),m(Ii,"min","4"),m(Ii,"max","10"),m(wc,"class","textprimary"),m($u,"class","textgrey"),m(Vi,"type","range"),m(Vi,"min","7"),m(Vi,"max","20"),m(Nu,"class","textgrey"),m(Li,"type","range"),m(Li,"min","50"),m(Li,"max","500"),m(Mc,"class","textprimary")},m(J,Ae){w(J,e,Ae),d(e,s),d(e,i),d(e,o),d(e,r),w(J,l,Ae);for(let Wn=0;Wn<fs.length;Wn+=1)fs[Wn]&&fs[Wn].m(l,null);wn(l,t[18],!0),w(J,a,Ae),w(J,c,Ae),w(J,f,Ae),w(J,u,Ae),w(J,p,Ae),w(J,g,Ae),w(J,v,Ae),w(J,_,Ae),w(J,b,Ae),ee(y,J,Ae),w(J,k,Ae),w(J,S,Ae),w(J,A,Ae),w(J,F,Ae),We(F,t[19]),w(J,M,Ae),ee(D,J,Ae),w(J,L,Ae),ee(E,J,Ae),w(J,R,Ae),ee(z,J,Ae),w(J,q,Ae),ee(j,J,Ae),w(J,W,Ae),ee(N,J,Ae),w(J,O,Ae),ee(se,J,Ae),w(J,re,Ae),ee(ie,J,Ae),w(J,ce,Ae),ee(ke,J,Ae),w(J,ge,Ae),ee(Ne,J,Ae),w(J,Te,Ae),w(J,Ce,Ae),w(J,_e,Ae),ee(H,J,Ae),w(J,de,Ae),d(de,Ge),d(de,Xe),d(de,Ye),d(Ye,pe),d(Ye,ae),w(J,Ue,Ae),We(Ue,t[20]),w(J,Z,Ae),d(Z,U),d(Z,fe),d(Z,je),w(J,Ve,Ae),We(Ve,t[21]),w(J,xe,Ae),w(J,ze,Ae),w(J,Be,Ae),ee(mt,J,Ae),w(J,wt,Ae),ee(Ze,J,Ae),w(J,Et,Ae),ee(ye,J,Ae),w(J,Je,Ae),ee(yt,J,Ae),w(J,St,Ae),w(J,Pe,Ae),w(J,ft,Ae),d(ft,Le),d(ft,Ct),d(ft,Vt),ee(He,J,Ae),w(J,Ke,Ae),ee(Me,J,Ae),w(J,ot,Ae),ee(Qe,J,Ae),w(J,ut,Ae),d(ut,Ci),d(ut,ls),d(ut,Ds),d(Ds,Lt),d(Ds,Si),w(J,jn,Ae),We(jn,t[22]),w(J,as,Ae),d(as,Mr),d(as,To),d(as,Ai),d(Ai,zt),d(Ai,Kt),w(J,cs,Ae),We(cs,t[23]),w(J,Iu,Ae),w(J,Pi,Ae),We(Pi,t[24]),w(J,Vu,Ae),w(J,Ti,Ae),We(Ti,t[25]),w(J,Lu,Ae),ee(Dl,J,Ae),w(J,bc,Ae),w(J,K0,Ae),w(J,qu,Ae),ee(Il,J,Ae),w(J,Ru,Ae),ee(Vl,J,Ae),w(J,zu,Ae),w(J,Ei,Ae),We(Ei,t[26]),w(J,yc,Ae),w(J,eh,Ae),w(J,Bu,Ae),ee(Ll,J,Ae),w(J,Uu,Ae),ee(ql,J,Ae),w(J,kc,Ae),w(J,th,Ae),w(J,Rl,Ae),d(Rl,T2),d(Rl,E2),d(Rl,xc),d(xc,nh),d(xc,D2),w(J,Di,Ae),We(Di,t[27]),w(J,zl,Ae),d(zl,I2),d(zl,V2),d(zl,Ou),d(Ou,sh),w(J,Ii,Ae),We(Ii,t[28]),w(J,wc,Ae),w(J,ih,Ae),w(J,Bl,Ae),d(Bl,L2),d(Bl,q2),d(Bl,$u),d($u,oh),w(J,Vi,Ae),We(Vi,t[29]),w(J,Ul,Ae),d(Ul,R2),d(Ul,z2),d(Ul,Nu),d(Nu,rh),w(J,Li,Ae),We(Li,t[30]),w(J,Mc,Ae),w(J,lh,Ae),w(J,ju,Ae),ee(Ol,J,Ae),ri=!0,ah||(B2=[X(l,"change",t[52]),X(l,"change",t[34]),X(u,"click",t[53]),X(g,"click",t[54]),X(F,"change",t[55]),X(F,"input",t[55]),X(Ue,"change",t[56]),X(Ue,"input",t[56]),X(Ue,"change",t[34]),X(Ve,"input",t[57]),X(Ve,"change",t[34]),X(jn,"change",t[58]),X(jn,"input",t[58]),X(cs,"change",t[59]),X(cs,"input",t[59]),X(Pi,"input",t[60]),X(Ti,"input",t[61]),X(Ei,"change",t[62]),X(Ei,"input",t[62]),X(Di,"change",t[63]),X(Di,"input",t[63]),X(Ii,"change",t[64]),X(Ii,"input",t[64]),X(Vi,"change",t[65]),X(Vi,"input",t[65]),X(Li,"change",t[66]),X(Li,"input",t[66])],ah=!0)},p(J,Ae){if(Ae[1]&4){$l=me(J[33]);let Wn;for(Wn=0;Wn<$l.length;Wn+=1){let U2=JM(J,$l,Wn);fs[Wn]?fs[Wn].p(U2,Ae):(fs[Wn]=i6(U2),fs[Wn].c(),fs[Wn].m(l,null))}for(;Wn<fs.length;Wn+=1)fs[Wn].d(1);fs.length=$l.length}Ae[0]&262144|Ae[1]&4&&wn(l,J[18]),Ae[0]&524288&&We(F,J[19]),(!ri||Ae[0]&1048576)&&G(pe,J[20]),Ae[0]&1048576&&We(Ue,J[20]),Ae[0]&2097152&&Ve.value!==J[21]&&We(Ve,J[21]),(!ri||Ae[0]&4194304)&&dt!==(dt=J[22].toFixed(1)+"")&&G(Lt,dt),Ae[0]&4194304&&We(jn,J[22]),(!ri||Ae[0]&8388608)&&pn!==(pn=J[23].toFixed(1)+"")&&G(zt,pn),Ae[0]&8388608&&We(cs,J[23]),Ae[0]&16777216&&$t(Pi.value)!==J[24]&&We(Pi,J[24]),Ae[0]&33554432&&$t(Ti.value)!==J[25]&&We(Ti,J[25]),Ae[0]&67108864&&We(Ei,J[26]),(!ri||Ae[0]&134217728)&&G(nh,J[27]),Ae[0]&134217728&&We(Di,J[27]),(!ri||Ae[0]&268435456)&&G(sh,J[28]),Ae[0]&268435456&&We(Ii,J[28]),(!ri||Ae[0]&536870912)&&G(oh,J[29]),Ae[0]&536870912&&We(Vi,J[29]),(!ri||Ae[0]&1073741824)&&G(rh,J[30]),Ae[0]&1073741824&&We(Li,J[30])},i(J){ri||(P(y.$$.fragment,J),P(D.$$.fragment,J),P(E.$$.fragment,J),P(z.$$.fragment,J),P(j.$$.fragment,J),P(N.$$.fragment,J),P(se.$$.fragment,J),P(ie.$$.fragment,J),P(ke.$$.fragment,J),P(Ne.$$.fragment,J),P(H.$$.fragment,J),P(mt.$$.fragment,J),P(Ze.$$.fragment,J),P(ye.$$.fragment,J),P(yt.$$.fragment,J),P(He.$$.fragment,J),P(Me.$$.fragment,J),P(Qe.$$.fragment,J),P(Dl.$$.fragment,J),P(Il.$$.fragment,J),P(Vl.$$.fragment,J),P(Ll.$$.fragment,J),P(ql.$$.fragment,J),P(Ol.$$.fragment,J),ri=!0)},o(J){V(y.$$.fragment,J),V(D.$$.fragment,J),V(E.$$.fragment,J),V(z.$$.fragment,J),V(j.$$.fragment,J),V(N.$$.fragment,J),V(se.$$.fragment,J),V(ie.$$.fragment,J),V(ke.$$.fragment,J),V(Ne.$$.fragment,J),V(H.$$.fragment,J),V(mt.$$.fragment,J),V(Ze.$$.fragment,J),V(ye.$$.fragment,J),V(yt.$$.fragment,J),V(He.$$.fragment,J),V(Me.$$.fragment,J),V(Qe.$$.fragment,J),V(Dl.$$.fragment,J),V(Il.$$.fragment,J),V(Vl.$$.fragment,J),V(Ll.$$.fragment,J),V(ql.$$.fragment,J),V(Ol.$$.fragment,J),ri=!1},d(J){J&&(x(e),x(l),x(a),x(c),x(f),x(u),x(p),x(g),x(v),x(_),x(b),x(k),x(S),x(A),x(F),x(M),x(L),x(R),x(q),x(W),x(O),x(re),x(ce),x(ge),x(Te),x(Ce),x(_e),x(de),x(Ue),x(Z),x(Ve),x(xe),x(ze),x(Be),x(wt),x(Et),x(Je),x(St),x(Pe),x(ft),x(Ke),x(ot),x(ut),x(jn),x(as),x(cs),x(Iu),x(Pi),x(Vu),x(Ti),x(Lu),x(bc),x(K0),x(qu),x(Ru),x(zu),x(Ei),x(yc),x(eh),x(Bu),x(Uu),x(kc),x(th),x(Rl),x(Di),x(zl),x(Ii),x(wc),x(ih),x(Bl),x(Vi),x(Ul),x(Li),x(Mc),x(lh),x(ju)),st(fs,J),te(y,J),te(D,J),te(E,J),te(z,J),te(j,J),te(N,J),te(se,J),te(ie,J),te(ke,J),te(Ne,J),te(H,J),te(mt,J),te(Ze,J),te(ye,J),te(yt,J),te(He,J),te(Me,J),te(Qe,J),te(Dl,J),te(Il,J),te(Vl,J),te(Ll,J),te(ql,J),te(Ol,J),ah=!1,lt(B2)}}}function cI(t){let e,n,s,i=C.ui.settings.sfxmultiplier+"",o,r,l,a,c,f,u,p,g,v;return{c(){e=h("div"),e.textContent=`${C.ui.settings.sfxvolume}`,n=h("input"),s=h("div"),o=T(i),r=h("br"),l=h("small"),l.textContent=`${C.ui.settings.multiplierdesc}`,a=h("input"),c=h("div"),c.textContent=`${C.ui.settings.musicvolume}`,f=h("input"),u=h("div"),u.textContent=`${C.ui.settings.ambiencevolume}`,p=h("input"),m(n,"type","range"),m(l,"class","textgrey"),m(a,"type","range"),m(f,"type","range"),m(p,"type","range")},m(_,b){w(_,e,b),w(_,n,b),We(n,t[14]),w(_,s,b),d(s,o),d(s,r),d(s,l),w(_,a,b),We(a,t[15]),w(_,c,b),w(_,f,b),We(f,t[16]),w(_,u,b),w(_,p,b),We(p,t[17]),g||(v=[X(n,"change",t[48]),X(n,"input",t[48]),X(a,"change",t[49]),X(a,"input",t[49]),X(f,"change",t[50]),X(f,"input",t[50]),X(p,"change",t[51]),X(p,"input",t[51])],g=!0)},p(_,b){b[0]&16384&&We(n,_[14]),b[0]&32768&&We(a,_[15]),b[0]&65536&&We(f,_[16]),b[0]&131072&&We(p,_[17])},i:ue,o:ue,d(_){_&&(x(e),x(n),x(s),x(a),x(c),x(f),x(u),x(p)),g=!1,lt(v)}}}function fI(t){let e,n,s,i=C.ui.settings.mousesensitivity+"",o,r,l,a=t[11].toFixed(2)+"",c,f,u,p,g,v,_,b,y,k,S,A,F,M=C.ui.settings.skillbarslots+"",D,L,E,R,z,q,j,W,N,O,se,re,ie,ce,ke,ge,Ne,Te,Ce,_e,H,de,Re,Ge;p=new Bt({props:{store:om}}),v=new Bt({props:{store:rm}}),b=new Bt({props:{store:lm}}),k=new Bt({props:{store:am}}),se=new Bt({props:{store:cm}});let Xe=me(t[3]),Ye=[];for(let pe=0;pe<Xe.length;pe+=1)Ye[pe]=o6(KM(t,Xe,pe));return{c(){e=h("div"),e.textContent=`${C.ui.settings.camera}`,n=h("div"),s=h("div"),o=T(i),r=$e(),l=h("span"),c=T(a),f=h("input"),u=h("div"),u.textContent=`${C.ui.settings.invertmousex}`,ne(p.$$.fragment),g=h("div"),g.textContent=`${C.ui.settings.invertmousey}`,ne(v.$$.fragment),_=h("div"),_.textContent=`${C.ui.settings.lockedcamera}`,ne(b.$$.fragment),y=h("div"),y.textContent=`${C.ui.settings.pointerlock}`,ne(k.$$.fragment),S=h("div"),S.textContent=`${C.ui.settings.skillbar}`,A=h("div"),F=h("div"),D=T(M),L=$e(),E=h("span"),R=T(t[12]),z=h("br"),q=h("small"),q.textContent=`${C.ui.settings.reload}`,j=h("input"),W=h("div"),W.textContent="Targeting",N=h("div"),O=h("div"),O.textContent="Target Next Friendly: Allow Non-Partied",ne(se.$$.fragment),re=h("div"),ie=T("Target Next Friendly: Cycle Size "),ce=h("span"),ke=T(t[13]),ge=h("input"),Ne=h("div"),Ne.textContent=`${C.ui.settings.keybindings}`,Te=h("div"),Ce=h("small"),Ce.textContent=`${C.ui.settings.reload}`,_e=h("small"),_e.textContent=`${C.ui.settings.bindingreset}`;for(let pe=0;pe<Ye.length;pe+=1)Ye[pe].c();H=be(),m(e,"class","textprimary"),m(l,"class","textgrey"),m(f,"type","range"),m(f,"step","0.05"),m(f,"min","0.1"),m(f,"max","3"),m(S,"class","textprimary"),m(E,"class","textgrey"),m(q,"class","textgrey"),m(j,"type","range"),m(j,"min","10"),m(j,"max","24"),m(W,"class","textprimary"),m(ce,"class","textgrey"),m(ge,"type","range"),m(ge,"min","1"),m(ge,"max","10"),m(Ne,"class","textprimary"),m(Ce,"class","textgrey"),m(_e,"class","textprimary")},m(pe,ae){w(pe,e,ae),w(pe,n,ae),w(pe,s,ae),d(s,o),d(s,r),d(s,l),d(l,c),w(pe,f,ae),We(f,t[11]),w(pe,u,ae),ee(p,pe,ae),w(pe,g,ae),ee(v,pe,ae),w(pe,_,ae),ee(b,pe,ae),w(pe,y,ae),ee(k,pe,ae),w(pe,S,ae),w(pe,A,ae),w(pe,F,ae),d(F,D),d(F,L),d(F,E),d(E,R),d(F,z),d(F,q),w(pe,j,ae),We(j,t[12]),w(pe,W,ae),w(pe,N,ae),w(pe,O,ae),ee(se,pe,ae),w(pe,re,ae),d(re,ie),d(re,ce),d(ce,ke),w(pe,ge,ae),We(ge,t[13]),w(pe,Ne,ae),w(pe,Te,ae),w(pe,Ce,ae),w(pe,_e,ae);for(let Ue=0;Ue<Ye.length;Ue+=1)Ye[Ue]&&Ye[Ue].m(pe,ae);w(pe,H,ae),de=!0,Re||(Ge=[X(f,"change",t[43]),X(f,"input",t[43]),X(j,"change",t[44]),X(j,"input",t[44]),X(j,"change",t[34]),X(ge,"change",t[45]),X(ge,"input",t[45])],Re=!0)},p(pe,ae){if((!de||ae[0]&2048)&&a!==(a=pe[11].toFixed(2)+"")&&G(c,a),ae[0]&2048&&We(f,pe[11]),(!de||ae[0]&4096)&&G(R,pe[12]),ae[0]&4096&&We(j,pe[12]),(!de||ae[0]&8192)&&G(ke,pe[13]),ae[0]&8192&&We(ge,pe[13]),ae[0]&8|ae[1]&16){Xe=me(pe[3]);let Ue;for(Ue=0;Ue<Xe.length;Ue+=1){let Z=KM(pe,Xe,Ue);Ye[Ue]?Ye[Ue].p(Z,ae):(Ye[Ue]=o6(Z),Ye[Ue].c(),Ye[Ue].m(H.parentNode,H))}for(;Ue<Ye.length;Ue+=1)Ye[Ue].d(1);Ye.length=Xe.length}},i(pe){de||(P(p.$$.fragment,pe),P(v.$$.fragment,pe),P(b.$$.fragment,pe),P(k.$$.fragment,pe),P(se.$$.fragment,pe),de=!0)},o(pe){V(p.$$.fragment,pe),V(v.$$.fragment,pe),V(b.$$.fragment,pe),V(k.$$.fragment,pe),V(se.$$.fragment,pe),de=!1},d(pe){pe&&(x(e),x(n),x(s),x(f),x(u),x(g),x(_),x(y),x(S),x(A),x(F),x(j),x(W),x(N),x(O),x(re),x(ge),x(Ne),x(Te),x(Ce),x(_e),x(H)),te(p,pe),te(v,pe),te(b,pe),te(k,pe),te(se,pe),st(Ye,pe),Re=!1,lt(Ge)}}}function uI(t){let e,n,s,i,o,r=C.ui.settings.fov+"",l,a,c,f,u,p,g=C.ui.settings.anisotropy+"",v,_,b,y,k,S=C.ui.settings.grass+"",A,F,M,D,L,E,R,z,q,j=C.ui.settings.disableoffscreen+"",W,N,O,se,re,ie,ce,ke,ge,Ne,Te,Ce=C.ui.settings.shadows+"",_e,H,de,Re,Ge,Xe=C.ui.settings.shadowresolution+"",Ye,pe,ae,Ue,Z,Q,U;return E=new Bt({props:{store:Tp}}),z=new Bt({props:{store:Ip}}),se=new Bt({props:{store:Ep}}),ie=new Bt({props:{store:Vp}}),ke=new Bt({props:{cb:t[34],store:Lp}}),Re=new Bt({props:{cb:t[34],store:Dp}}),{c(){e=h("div"),e.textContent=`${C.ui.settings.resolution}`,n=h("input"),s=h("div"),s.textContent=`${C.ui.settings.viewrange}`,i=h("input"),o=h("div"),l=T(r),a=$e(),c=h("span"),f=T(t[7]),u=h("input"),p=h("div"),v=T(g),_=h("br"),b=h("small"),b.textContent=`${C.ui.settings.reload}`,y=h("input"),k=h("div"),A=T(S),F=h("br"),M=h("small"),M.textContent=`${C.ui.settings.reload}`,D=h("input"),L=h("div"),L.textContent=`${C.ui.settings.fxaa}`,ne(E.$$.fragment),R=h("div"),R.textContent=`${C.ui.settings.bloom}`,ne(z.$$.fragment),q=h("div"),W=T(j),N=h("br"),O=h("small"),O.textContent=`${C.ui.settings.offscreendesc}`,ne(se.$$.fragment),re=h("div"),re.textContent=`${C.ui.settings.particles}`,ne(ie.$$.fragment),ce=h("div"),ce.textContent=`${C.ui.settings.fogpattern}`,ne(ke.$$.fragment),ge=h("div"),ge.textContent=`${C.ui.settings.shadows}`,Ne=h("div"),Te=h("div"),_e=T(Ce),H=h("br"),de=h("small"),de.textContent=`${C.ui.settings.reload}`,ne(Re.$$.fragment),Ge=h("div"),Ye=T(Xe),pe=h("br"),ae=h("small"),ae.textContent=`${C.ui.settings.reload}`,Ue=h("input"),m(n,"type","range"),m(n,"min","30"),m(n,"step","10"),m(i,"type","range"),m(i,"min","30"),m(c,"class","textgrey"),m(u,"type","range"),m(u,"min","50"),m(u,"max","100"),m(b,"class","textgrey"),m(y,"type","range"),m(y,"min","0"),m(y,"max","4"),m(M,"class","textgrey"),m(D,"type","range"),m(D,"min","0"),m(D,"max","100"),m(O,"class","textgrey"),m(ge,"class","textprimary"),m(de,"class","textgrey"),m(ae,"class","textgrey"),m(Ue,"type","range"),m(Ue,"min","0"),m(Ue,"max","3")},m(fe,je){w(fe,e,je),w(fe,n,je),We(n,t[5]),w(fe,s,je),w(fe,i,je),We(i,t[6]),w(fe,o,je),d(o,l),d(o,a),d(o,c),d(c,f),w(fe,u,je),We(u,t[7]),w(fe,p,je),d(p,v),d(p,_),d(p,b),w(fe,y,je),We(y,t[8]),w(fe,k,je),d(k,A),d(k,F),d(k,M),w(fe,D,je),We(D,t[9]),w(fe,L,je),ee(E,fe,je),w(fe,R,je),ee(z,fe,je),w(fe,q,je),d(q,W),d(q,N),d(q,O),ee(se,fe,je),w(fe,re,je),ee(ie,fe,je),w(fe,ce,je),ee(ke,fe,je),w(fe,ge,je),w(fe,Ne,je),w(fe,Te,je),d(Te,_e),d(Te,H),d(Te,de),ee(Re,fe,je),w(fe,Ge,je),d(Ge,Ye),d(Ge,pe),d(Ge,ae),w(fe,Ue,je),We(Ue,t[10]),Z=!0,Q||(U=[X(n,"change",t[37]),X(n,"input",t[37]),X(i,"change",t[38]),X(i,"input",t[38]),X(u,"change",t[39]),X(u,"input",t[39]),X(y,"change",t[40]),X(y,"input",t[40]),X(y,"change",t[34]),X(D,"change",t[41]),X(D,"input",t[41]),X(D,"change",t[34]),X(Ue,"change",t[42]),X(Ue,"input",t[42]),X(Ue,"change",t[34])],Q=!0)},p(fe,je){je[0]&32&&We(n,fe[5]),je[0]&64&&We(i,fe[6]),(!Z||je[0]&128)&&G(f,fe[7]),je[0]&128&&We(u,fe[7]),je[0]&256&&We(y,fe[8]),je[0]&512&&We(D,fe[9]),je[0]&1024&&We(Ue,fe[10])},i(fe){Z||(P(E.$$.fragment,fe),P(z.$$.fragment,fe),P(se.$$.fragment,fe),P(ie.$$.fragment,fe),P(ke.$$.fragment,fe),P(Re.$$.fragment,fe),Z=!0)},o(fe){V(E.$$.fragment,fe),V(z.$$.fragment,fe),V(se.$$.fragment,fe),V(ie.$$.fragment,fe),V(ke.$$.fragment,fe),V(Re.$$.fragment,fe),Z=!1},d(fe){fe&&(x(e),x(n),x(s),x(i),x(o),x(u),x(p),x(y),x(k),x(D),x(L),x(R),x(q),x(re),x(ce),x(ge),x(Ne),x(Te),x(Ge),x(Ue)),te(E,fe),te(z,fe),te(se,fe),te(ie,fe),te(ke,fe),te(Re,fe),Q=!1,lt(U)}}}function s6(t){let e,n,s,i,o;function r(...l){return t[67](t[78],...l)}return{c(){e=h("div"),e.textContent=`${t[76]}`,n=h("div"),m(n,"class",s="btn checkbox "+(t[31][t[78]]?"active":""))},m(l,a){w(l,e,a),w(l,n,a),i||(o=X(n,"click",r),i=!0)},p(l,a){t=l,a[1]&1&&s!==(s="btn checkbox "+(t[31][t[78]]?"active":""))&&m(n,"class",s)},d(l){l&&(x(e),x(n)),i=!1,o()}}}function i6(t){let e,n=t[73].name+"",s,i;return{c(){e=h("option"),s=T(n),e.__value=i=t[73].val,We(e,e.__value)},m(o,r){w(o,e,r),d(e,s)},p:ue,d(o){o&&x(e)}}}function o6(t){let e,n=t[70].name+"",s,i,o,r;function l(){t[46].call(i,t[70])}function a(...c){return t[47](t[70],...c)}return{c(){e=h("div"),s=T(n),i=h("input"),m(i,"type","text")},m(c,f){w(c,e,f),d(e,s),w(c,i,f),We(i,t[0].current[t[70].kb]),o||(r=[X(i,"input",l),X(i,"change",a)],o=!0)},p(c,f){t=c,f[0]&8&&n!==(n=t[70].name+"")&&G(s,n),f[0]&8&&i.value!==t[0].current[t[70].kb]&&We(i,t[0].current[t[70].kb])},d(c){c&&(x(e),x(i)),o=!1,lt(r)}}}function pI(t){let e,n,s,i,o=t[1].name+"",r,l,a,c,f,u=me(t[32]),p=[];for(let b=0;b<u.length;b+=1)p[b]=n6(e6(t,u,b));let g=[uI,fI,cI,aI,lI],v=[];function _(b,y){return b[1].id=="gfx"?0:b[1].id=="controls"?1:b[1].id=="audio"?2:b[1].id=="ui"?3:b[1].id=="chat"?4:-1}return~(a=_(t,[-1,-1,-1]))&&(c=v[a]=g[a](t)),{c(){e=h("div"),n=h("div");for(let b=0;b<p.length;b+=1)p[b].c();s=h("div"),i=h("h3"),r=T(o),l=h("div"),c&&c.c(),m(i,"class","textprimary"),m(l,"class","settings svelte-13nnce4"),m(s,"class","menu panel-black scrollbar svelte-13nnce4"),m(e,"class","divide svelte-13nnce4")},m(b,y){w(b,e,y),d(e,n);for(let k=0;k<p.length;k+=1)p[k]&&p[k].m(n,null);d(e,s),d(s,i),d(i,r),d(s,l),~a&&v[a].m(l,null),f=!0},p(b,y){if(y[0]&2|y[1]&2){u=me(b[32]);let S;for(S=0;S<u.length;S+=1){let A=e6(b,u,S);p[S]?p[S].p(A,y):(p[S]=n6(A),p[S].c(),p[S].m(n,null))}for(;S<p.length;S+=1)p[S].d(1);p.length=u.length}(!f||y[0]&2)&&o!==(o=b[1].name+"")&&G(r,o);let k=a;a=_(b,y),a===k?~a&&v[a].p(b,y):(c&&(Ee(),V(v[k],1,1,()=>{v[k]=null}),De()),~a?(c=v[a],c?c.p(b,y):(c=v[a]=g[a](b),c.c()),P(c,1),c.m(l,null)):c=null)},i(b){f||(P(c),f=!0)},o(b){V(c),f=!1},d(b){b&&x(e),st(p,b),~a&&v[a].d()}}}function mI(t){let e,n,s=t[4]&&t6(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,o){i[4]?s?(s.p(i,o),o[0]&16&&P(s,1)):(s=t6(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function dI(t,e,n){let s,i,o,r,l,a,c,f,u,p,g,v,_,b,y,k,S,A,F,M,D,L,E,R,z,q,j,W;oe(t,Wr,Le=>n(4,s=Le)),oe(t,Ur,Le=>n(5,i=Le)),oe(t,zr,Le=>n(6,o=Le)),oe(t,Br,Le=>n(7,r=Le)),oe(t,Yc,Le=>n(8,l=Le)),oe(t,Gc,Le=>n(9,a=Le)),oe(t,Hc,Le=>n(10,c=Le)),oe(t,hf,Le=>n(11,f=Le)),oe(t,Xr,Le=>n(12,u=Le)),oe(t,gf,Le=>n(13,p=Le)),oe(t,Or,Le=>n(14,g=Le)),oe(t,$r,Le=>n(15,v=Le)),oe(t,Qc,Le=>n(16,_=Le)),oe(t,Xc,Le=>n(17,b=Le)),oe(t,Nr,Le=>n(18,y=Le)),oe(t,sf,Le=>n(19,k=Le)),oe(t,lf,Le=>n(20,S=Le)),oe(t,rf,Le=>n(21,A=Le)),oe(t,ff,Le=>n(22,F=Le)),oe(t,uf,Le=>n(23,M=Le)),oe(t,pf,Le=>n(24,D=Le)),oe(t,mf,Le=>n(25,L=Le)),oe(t,Yr,Le=>n(26,E=Le)),oe(t,af,Le=>n(27,R=Le)),oe(t,jr,Le=>n(28,z=Le)),oe(t,jo,Le=>n(29,q=Le)),oe(t,Wo,Le=>n(30,j=Le)),oe(t,nf,Le=>n(31,W=Le));let N=[{id:"ui",name:C.ui.settings.interface},{id:"gfx",name:C.ui.settings.graphics},{id:"controls",name:C.ui.settings.controls},{id:"chat",name:C.ui.settings.chat},{id:"audio",name:C.ui.settings.audio}],O=N[0],se=[{val:"en",name:"English"},{val:"de",name:"German"},{val:"ru",name:"Russian"},{val:"zh",name:"Chinese"},{val:"pt",name:"Portugese"},{val:"es",name:"Spanish"},{val:"fr",name:"French"},{val:"ro",name:"Romanian"},{val:"it",name:"Italian"},{val:"nl",name:"Dutch"},{val:"vi",name:"Vietnamese"},{val:"hu",name:"Hungarian"},{val:"ro",name:"Romanian"},{val:"cs",name:"Czech"},{val:"pl",name:"Polish"}],re=!1,ie=()=>{n(2,re=!0)},ce=(Le,Ct)=>{Ct.set(Le===""?void 0:Le),n(2,re=!0)},ke=["Forward","Left","Back","Right","TurnLeft","TurnRight","Map","Skills","Character","Inventory","Clan","Pvp","Party","NextTarget","NextParty","Untarget"],ge=["Forward","Left","Back","Right","Turn Left","Turn Right","Map","Skills","Character","Inventory","Clan","Pvp","Party","Target Next Enemy","Target Next Friendly","Untarget"];for(let Le=1;Le<25;++Le)ke.push("Skillbar"+Le);ke=ke.map((Le,Ct)=>({name:ge[Ct]||Le,kb:"kb"+Le,setting:Wi["kb"+Le]}));let Ne=(Le,Ct)=>{n(1,O=Le)};function Te(){i=$t(this.value),Ur.set(i)}function Ce(){o=$t(this.value),zr.set(o)}function _e(){r=$t(this.value),Br.set(r)}function H(){l=$t(this.value),Yc.set(l)}function de(){a=$t(this.value),Gc.set(a)}function Re(){c=$t(this.value),Hc.set(c)}function Ge(){f=$t(this.value),hf.set(f)}function Xe(){u=$t(this.value),Xr.set(u)}function Ye(){p=$t(this.value),gf.set(p)}function pe(Le){le[Le.kb]=this.value,n(0,Wi)}let ae=(Le,Ct)=>{ce(le[Le.kb],Le.setting)};function Ue(){g=$t(this.value),Or.set(g)}function Z(){v=$t(this.value),$r.set(v)}function Q(){_=$t(this.value),Qc.set(_)}function U(){b=$t(this.value),Xc.set(b)}function fe(){y=ks(this),Nr.set(y),n(33,se)}let je=Le=>ji.set(0),Ve=Le=>ji.set(Ps.length);function xe(){k=$t(this.value),sf.set(k)}function ze(){S=$t(this.value),lf.set(S)}function Be(){A=this.value,rf.set(A)}function mt(){F=$t(this.value),ff.set(F)}function wt(){M=$t(this.value),uf.set(M)}function Ze(){D=$t(this.value),pf.set(D)}function Et(){L=$t(this.value),mf.set(L)}function ye(){E=$t(this.value),Yr.set(E)}function Je(){R=$t(this.value),af.set(R)}function yt(){z=$t(this.value),jr.set(z)}function St(){q=$t(this.value),jo.set(q)}function Pe(){j=$t(this.value),Wo.set(j)}return[Wi,O,re,ke,s,i,o,r,l,a,c,f,u,p,g,v,_,b,y,k,S,A,F,M,D,L,E,R,z,q,j,W,N,se,ie,ce,Ne,Te,Ce,_e,H,de,Re,Ge,Xe,Ye,pe,ae,Ue,Z,Q,U,fe,je,Ve,xe,ze,Be,mt,wt,Ze,Et,ye,Je,yt,St,Pe,(Le,Ct)=>tt(nf,W[Le]=W[Le]?0:1,W),()=>{tt(Wr,s=!1,s),re&&window.location.reload()}]}var Dg=class extends Fe{constructor(e){super(),Se(this,e,dI,mI,Oe,{},null,[-1,-1,-1])}},r6=Dg;var l6=(t,e,n,s,i,o)=>Ig(t,i,o)&&Qa(s,i,o)&&Lg(n,i,o)&&qg(e,i,o),Ig=(t,e,n)=>rn[e+n]===void 0?(console.log("Error: Item can EQUIP type not found: "+e+n),!1):t>=rn[e+n].level,Qa=(t,e,n)=>rn[e+n].class===void 0||t===rn[e+n].class,hI=(t,e)=>t+Pt.get(e).skillpoints,Vg=t=>t.reduce(hI,0),Lg=(t,e,n)=>e!=="book"||nu(t,rn[e+n].skillid)===rn[e+n].skilllevel;var nu=(t,e)=>t.reduce((n,s)=>n+(s===e),0);var qg=(t,e,n)=>rn[e+n].requiredSkill===void 0||t.indexOf(rn[e+n].requiredSkill)>0;var a6=(t,e,n)=>rn[e+n].buyElo===void 0||t>=rn[e+n].buyElo;function c6(t,e,n){let s=t.slice();return s[39]=e[n],s}function f6(t,e,n){let s=t.slice();return s[39]=e[n],s}function u6(t,e,n){let s=t.slice();return s[44]=e[n],s[46]=n,s}function p6(t,e,n){let s=t.slice();return s[47]=e[n],s}function m6(t){let e,n;return e=new jt({props:{origin:"center",title:C.ui.headers.skills,settings:[{name:"Preset Manager",fun:t[31]}],icon:"book",$$slots:{default:[PI]},$$scope:{ctx:t}}}),e.$on("close",t[32]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i[0]&4096&&(o.settings=[{name:"Preset Manager",fun:s[31]}]),i[0]&6143|i[1]&524288&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function d6(t){let e,n;function s(r,l){return r[6]===void 0?vI:gI}let i=s(t,[-1,-1]),o=i(t);return{c(){e=h("div"),o.c(),m(e,"class",n="panel-black "+(t[6]===void 0?"bar-top-config":"bar-top-save")+" svelte-1e0alkc")},m(r,l){w(r,e,l),o.m(e,null)},p(r,l){i===(i=s(r,l))&&o?o.p(r,l):(o.d(1),o=i(r),o&&(o.c(),o.m(e,null))),l[0]&64&&n!==(n="panel-black "+(r[6]===void 0?"bar-top-config":"bar-top-save")+" svelte-1e0alkc")&&m(e,"class",n)},d(r){r&&x(e),o.d()}}}function gI(t){let e,n,s,i,o,r,l;return{c(){e=h("div"),n=h("input"),s=h("div"),s.textContent="Save",i=h("div"),i.textContent="Cancel",o=h("div"),m(n,"placeholder","Enter Preset Name"),m(n,"maxlength","25"),m(s,"class","btn green"),m(i,"class","btn orange")},m(a,c){w(a,e,c),w(a,n,c),We(n,t[6]),w(a,s,c),w(a,i,c),w(a,o,c),r||(l=[X(n,"input",t[25]),X(s,"click",t[15]),X(i,"click",t[26])],r=!0)},p(a,c){c[0]&64&&n.value!==a[6]&&We(n,a[6])},d(a){a&&(x(e),x(n),x(s),x(i),x(o)),r=!1,lt(l)}}}function vI(t){let e,n,s,i,o,r,l,a,c,f,u,p,g=me(t[10].filter(t[21])),v=[];for(let b=0;b<g.length;b+=1)v[b]=h6(p6(t,g,b));let _=t[7]===void 0&&g6(t);return{c(){e=h("span"),e.textContent="Preset:",n=h("select");for(let b=0;b<v.length;b+=1)v[b].c();s=be(),_&&_.c(),o=h("div"),r=T("Save"),a=h("div"),c=T("Delete"),m(e,"class","btn textprimary"),m(n,"class",i="btn grey "+(t[10].filter(t[22]).length===0?"disabled":"")),t[7]===void 0&&_n(()=>t[23].call(n)),m(o,"class",l="btn grey "+(t[5]?"":"disabled")),m(a,"class",f="btn grey "+(t[7]!==void 0?"":"disabled"))},m(b,y){w(b,e,y),w(b,n,y);for(let k=0;k<v.length;k+=1)v[k]&&v[k].m(n,null);d(n,s),_&&_.m(n,null),wn(n,t[7],!0),w(b,o,y),d(o,r),w(b,a,y),d(a,c),u||(p=[X(n,"change",t[23]),X(n,"change",t[16]),X(o,"click",t[24]),X(a,"click",t[17])],u=!0)},p(b,y){if(y[0]&1024){g=me(b[10].filter(b[21]));let k;for(k=0;k<g.length;k+=1){let S=p6(b,g,k);v[k]?v[k].p(S,y):(v[k]=h6(S),v[k].c(),v[k].m(n,s))}for(;k<v.length;k+=1)v[k].d(1);v.length=g.length}b[7]===void 0?_?_.p(b,y):(_=g6(b),_.c(),_.m(n,null)):_&&(_.d(1),_=null),y[0]&1024&&i!==(i="btn grey "+(b[10].filter(b[22]).length===0?"disabled":""))&&m(n,"class",i),y[0]&1152&&wn(n,b[7]),y[0]&32&&l!==(l="btn grey "+(b[5]?"":"disabled"))&&m(o,"class",l),y[0]&1152&&f!==(f="btn grey "+(b[7]!==void 0?"":"disabled"))&&m(a,"class",f)},d(b){b&&(x(e),x(n),x(o),x(a)),st(v,b),_&&_.d(),u=!1,lt(p)}}}function h6(t){let e,n=t[47].name+"",s,i;return{c(){e=h("option"),s=T(n),e.__value=i=t[47].name,We(e,e.__value)},m(o,r){w(o,e,r),d(e,s)},p(o,r){r[0]&1024&&n!==(n=o[47].name+"")&&G(s,n),r[0]&1024&&i!==(i=o[47].name)&&(e.__value=i,We(e,e.__value))},d(o){o&&x(e)}}}function g6(t){let e,n;return{c(){e=h("option"),n=T("No Preset"),e.disabled=!0,e.selected=!0,e.__value=void 0,We(e,e.__value)},m(s,i){w(s,e,i),d(e,n)},p:ue,d(s){s&&x(e)}}}function _I(t){let e,n;return e=new hl({props:{level:Math.max(1,t[39].level),skill:Pt.get(t[39].id)}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i[0]&8&&(o.level=Math.max(1,s[39].level)),i[0]&8&&(o.skill=Pt.get(s[39].id)),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function bI(t){let e;return{c(){e=h("div"),e.textContent=`${C.ui.default}`,m(e,"class","textgrey")},m(n,s){w(n,e,s)},p:ue,d(n){n&&x(e)}}}function yI(t){let e,n=me(Array(Pt.get(t[39].id).skilllevels)),s=[];for(let i=0;i<n.length;i+=1)s[i]=v6(u6(t,n,i));return{c(){e=h("div");for(let i=0;i<s.length;i+=1)s[i].c();m(e,"class","skillpoints svelte-1e0alkc")},m(i,o){w(i,e,o);for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(e,null)},p(i,o){if(o[0]&24){n=me(Array(Pt.get(i[39].id).skilllevels));let r;for(r=0;r<n.length;r+=1){let l=u6(i,n,r);s[r]?s[r].p(l,o):(s[r]=v6(l),s[r].c(),s[r].m(e,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(i){i&&x(e),st(s,i)}}}function kI(t){let e;return{c(){e=h("div"),m(e,"class","border grey")},m(n,s){w(n,e,s)},p:ue,d(n){n&&x(e)}}}function xI(t){let e;return{c(){e=h("div"),m(e,"class","btn incbtn grey svelte-1e0alkc")},m(n,s){w(n,e,s)},p:ue,d(n){n&&x(e)}}}function wI(t){let e,n;return{c(){e=h("div"),m(e,"class",n="btn incbtn "+(t[4]?"green":"white")+" svelte-1e0alkc")},m(s,i){w(s,e,i)},p(s,i){i[0]&16&&n!==(n="btn incbtn "+(s[4]?"green":"white")+" svelte-1e0alkc")&&m(e,"class",n)},d(s){s&&x(e)}}}function v6(t){let e;function n(o,r){return o[46]+1<=o[39].level?wI:o[46]+1<=o[39].learned?xI:kI}let s=n(t,[-1,-1]),i=s(t);return{c(){i.c(),e=be()},m(o,r){i.m(o,r),w(o,e,r)},p(o,r){s===(s=n(o,r))&&i?i.p(o,r):(i.d(1),i=s(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&x(e),i.d(o)}}}function MI(t){let e;return{c(){e=h("div"),m(e,"class","name svelte-1e0alkc")},m(n,s){w(n,e,s)},p:ue,d(n){n&&x(e)}}}function FI(t){let e,n,s,i=t[39].level+"",o;return{c(){e=h("div"),n=T("Lv. "),s=h("span"),o=T(i),m(s,"class","bold textwhite"),m(e,"class","name svelte-1e0alkc")},m(r,l){w(r,e,l),d(e,n),d(e,s),d(s,o)},p(r,l){l[0]&8&&i!==(i=r[39].level+"")&&G(o,i)},d(r){r&&x(e)}}}function _6(t){let e,n,s,i,o,r,l;function a(...p){return t[27](t[39],...p)}function c(p,g){return g[0]&520&&(o=null),o==null&&(o=p[9]>=Pt.get(p[39].id).skillpoints&&p[39].level<Pt.get(p[39].id).skilllevels&&p[39].level<p[39].learned),o?SI:CI}let f=c(t,[-1,-1]),u=f(t);return{c(){e=h("div"),n=h("div"),s=T("-"),u.c(),m(n,"class",i="btn incbtn "+(t[39].level>0?"grey":"black disabled")+" svelte-1e0alkc"),m(e,"class","skillpoints svelte-1e0alkc")},m(p,g){w(p,e,g),d(e,n),d(n,s),u.m(e,null),r||(l=X(n,"click",a),r=!0)},p(p,g){t=p,g[0]&8&&i!==(i="btn incbtn "+(t[39].level>0?"grey":"black disabled")+" svelte-1e0alkc")&&m(n,"class",i),f===(f=c(t,g))&&u?u.p(t,g):(u.d(1),u=f(t),u&&(u.c(),u.m(e,null)))},d(p){p&&x(e),u.d(),r=!1,l()}}}function CI(t){let e;return{c(){e=h("div"),e.textContent="+",m(e,"class","btn incbtn black disabled svelte-1e0alkc")},m(n,s){w(n,e,s)},p:ue,d(n){n&&x(e)}}}function SI(t){let e,n,s;function i(...o){return t[28](t[39],...o)}return{c(){e=h("div"),e.textContent="+",m(e,"id","tutsetskillpoint"),m(e,"class","btn incbtn green svelte-1e0alkc")},m(o,r){w(o,e,r),n||(s=X(e,"click",i),n=!0)},p(o,r){t=o},d(o){o&&x(e),n=!1,s()}}}function b6(t){let e,n,s,i,o=C.items.book[t[39].id].name+"",r,l,a,c,f;n=new ml({props:{descPos:"left:100%;top:0;",descRoot:t[2],border:"white",data:{},pickable:t[39].pickable,meta:{type:"skill",skill:Pt.get(t[39].id)},css:"slotskill",img:`/data/ui/skills/${t[39].id}.${Gn}?v=8593107`,$$slots:{default:[_I]},$$scope:{ctx:t}}});function u(k,S){return k[39].engineOnly?bI:yI}let p=u(t,[-1,-1]),g=p(t);function v(k,S){return k[39].engineOnly?MI:FI}let _=v(t,[-1,-1]),b=_(t),y=!t[39].engineOnly&&_6(t);return{c(){e=h("div"),ne(n.$$.fragment),s=h("div"),i=h("div"),r=T(o),l=$e(),g.c(),a=h("div"),b.c(),c=be(),y&&y.c(),m(i,"class","textprimary name svelte-1e0alkc"),m(e,"class","panel-bright skillbox svelte-1e0alkc")},m(k,S){w(k,e,S),ee(n,e,null),d(e,s),d(s,i),d(i,r),d(s,l),g.m(s,null),d(e,a),b.m(a,null),d(a,c),y&&y.m(a,null),f=!0},p(k,S){let A={};S[0]&4&&(A.descRoot=k[2]),S[0]&8&&(A.pickable=k[39].pickable),S[0]&8&&(A.meta={type:"skill",skill:Pt.get(k[39].id)}),S[0]&8&&(A.img=`/data/ui/skills/${k[39].id}.${Gn}?v=8593107`),S[0]&8|S[1]&524288&&(A.$$scope={dirty:S,ctx:k}),n.$set(A),(!f||S[0]&8)&&o!==(o=C.items.book[k[39].id].name+"")&&G(r,o),p===(p=u(k,S))&&g?g.p(k,S):(g.d(1),g=p(k),g&&(g.c(),g.m(s,null))),_===(_=v(k,S))&&b?b.p(k,S):(b.d(1),b=_(k),b&&(b.c(),b.m(a,c))),k[39].engineOnly?y&&(y.d(1),y=null):y?y.p(k,S):(y=_6(k),y.c(),y.m(a,null))},i(k){f||(P(n.$$.fragment,k),f=!0)},o(k){V(n.$$.fragment,k),f=!1},d(k){k&&x(e),te(n),g.d(),b.d(),y&&y.d()}}}function AI(t){let e,n;return e=new hl({props:{level:1,skill:t[39]}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i[0]&1&&(o.skill=s[39]),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function y6(t){let e,n,s,i,o=C.items.book[t[39].id].name+"",r,l,a=C.ui.learnable+"",c,f,u=t[39].minlevel+"",p,g;return n=new ml({props:{descPos:"left:100%;top:0;",descRoot:t[2],border:"grey filtered",data:{},pickable:!1,meta:{type:"skill",skill:t[39]},css:"slotskill",img:`/data/ui/skills/${t[39].id}.${Gn}?v=8593107`,$$slots:{default:[AI]},$$scope:{ctx:t}}}),{c(){e=h("div"),ne(n.$$.fragment),s=h("div"),i=h("div"),r=T(o),l=h("div"),c=T(a),f=$e(),p=T(u),m(i,"class","name svelte-1e0alkc"),m(s,"class","textgrey"),m(e,"class","panel-bright skillbox svelte-1e0alkc")},m(v,_){w(v,e,_),ee(n,e,null),d(e,s),d(s,i),d(i,r),d(s,l),d(l,c),d(l,f),d(l,p),g=!0},p(v,_){let b={};_[0]&4&&(b.descRoot=v[2]),_[0]&1&&(b.meta={type:"skill",skill:v[39]}),_[0]&1&&(b.img=`/data/ui/skills/${v[39].id}.${Gn}?v=8593107`),_[0]&1|_[1]&524288&&(b.$$scope={dirty:_,ctx:v}),n.$set(b),(!g||_[0]&1)&&o!==(o=C.items.book[v[39].id].name+"")&&G(r,o),(!g||_[0]&1)&&u!==(u=v[39].minlevel+"")&&G(p,u)},i(v){g||(P(n.$$.fragment,v),g=!0)},o(v){V(n.$$.fragment,v),g=!1},d(v){v&&x(e),te(n)}}}function PI(t){let e,n,s,i,o,r=(t[1]?t[1]:`${C.ui.stats.array[23]}: ${t[8]}`)+"",l,a,c,f,u,p,g,v,_,b=t[12]&&d6(t),y=me(t[3]),k=[];for(let D=0;D<y.length;D+=1)k[D]=b6(f6(t,y,D));let S=D=>V(k[D],1,1,()=>{k[D]=null}),A=me(Array.from(Pt.values()).filter(t[29]).sort(k6)),F=[];for(let D=0;D<A.length;D+=1)F[D]=y6(c6(t,A,D));let M=D=>V(F[D],1,1,()=>{F[D]=null});return{c(){e=h("div"),b&&b.c(),n=h("div");for(let D=0;D<k.length;D+=1)k[D].c();s=be();for(let D=0;D<F.length;D+=1)F[D].c();i=h("div"),o=h("span"),l=T(r),c=h("div"),f=T("Activate Skills"),p=h("span"),m(n,"id","skilllist"),m(n,"class","scrollbar panel-black skilllist svelte-1e0alkc"),m(o,"class",a=t[1]?"textred":t[8]>0?"textprimary":"textgrey"),m(c,"id","tutapplyskills"),m(c,"class",u="btn "+(t[4]?"green":"grey disabled")),m(i,"class","panel-black bar-bot svelte-1e0alkc"),m(e,"class","flexer svelte-1e0alkc")},m(D,L){w(D,e,L),b&&b.m(e,null),d(e,n);for(let E=0;E<k.length;E+=1)k[E]&&k[E].m(n,null);d(n,s);for(let E=0;E<F.length;E+=1)F[E]&&F[E].m(n,null);d(e,i),d(i,o),d(o,l),d(i,c),d(c,f),d(i,p),t[30](e),g=!0,v||(_=X(c,"click",t[13]),v=!0)},p(D,L){if(D[12]?b?b.p(D,L):(b=d6(D),b.c(),b.m(e,n)):b&&(b.d(1),b=null),L[0]&16924){y=me(D[3]);let E;for(E=0;E<y.length;E+=1){let R=f6(D,y,E);k[E]?(k[E].p(R,L),P(k[E],1)):(k[E]=b6(R),k[E].c(),P(k[E],1),k[E].m(n,s))}for(Ee(),E=y.length;E<k.length;E+=1)S(E);De()}if(L[0]&5){A=me(Array.from(Pt.values()).filter(D[29]).sort(k6));let E;for(E=0;E<A.length;E+=1){let R=c6(D,A,E);F[E]?(F[E].p(R,L),P(F[E],1)):(F[E]=y6(R),F[E].c(),P(F[E],1),F[E].m(n,null))}for(Ee(),E=A.length;E<F.length;E+=1)M(E);De()}(!g||L[0]&258)&&r!==(r=(D[1]?D[1]:`${C.ui.stats.array[23]}: ${D[8]}`)+"")&&G(l,r),(!g||L[0]&258&&a!==(a=D[1]?"textred":D[8]>0?"textprimary":"textgrey"))&&m(o,"class",a),(!g||L[0]&16&&u!==(u="btn "+(D[4]?"green":"grey disabled")))&&m(c,"class",u)},i(D){if(!g){for(let L=0;L<y.length;L+=1)P(k[L]);for(let L=0;L<A.length;L+=1)P(F[L]);g=!0}},o(D){k=k.filter(Boolean);for(let L=0;L<k.length;L+=1)V(k[L]);F=F.filter(Boolean);for(let L=0;L<F.length;L+=1)V(F[L]);g=!1},d(D){D&&x(e),b&&b.d(),st(k,D),st(F,D),t[30](null),v=!1,_()}}}function TI(t){let e,n,s=t[11]&&m6(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,o){i[11]?s?(s.p(i,o),o[0]&2048&&P(s,1)):(s=m6(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}var k6=(t,e)=>t.minlevel-e.minlevel;function EI(t,e,n){let s,i,o,r,l,a,c,f,u;oe(t,qc,_e=>n(0,o=_e)),oe(t,va,_e=>n(10,r=_e)),oe(t,Oo,_e=>n(19,l=_e)),oe(t,Rc,_e=>n(1,a=_e)),oe(t,zo,_e=>n(20,c=_e)),oe(t,fo,_e=>n(11,f=_e)),oe(t,df,_e=>n(12,u=_e));let p,g=_e=>{let H=[];return _e.forEach((de,Re)=>{for(let Ge=0;Ge<de.level;++Ge)H.push(de.id)}),H},v=()=>{let _e=A.filter(H=>!Pt.get(H)?.engineOnly);xt("skillconfig",_e),n(4,b=!1),tt(Rc,a=void 0,a),tn(28,100)},_=[],b=!1,y=!1,k=(_e,H)=>{n(3,_=[]),_e.forEach((de,Re)=>{let Ge=Pt.get(Re);_.push({id:Re,level:de,minlevel:Ge.minlevel,learned:H.get(Re)||0,engineOnly:Ge.engineOnly,pickable:Ge.onCast!==void 0})}),H.forEach((de,Re)=>{if(!_e.has(Re)){let Ge=Pt.get(Re);_.push({id:Re,level:0,minlevel:Ge.minlevel,learned:de,engineOnly:Ge.engineOnly,pickable:Ge.onCast!==void 0})}}),_.sort((de,Re)=>de.id-Re.id)},S=()=>{F=g(_);let _e=F.filter(H=>!Pt.get(H)?.engineOnly);n(18,M=Vg(_e))},A=[],F=[],M=0,D=(_e,H)=>{_e.level+=H,n(3,_),tn(27,100),L()},L=()=>{A=g(_);let _e=A.filter(Ge=>!Pt.get(Ge)?.engineOnly);n(18,M=Vg(_e));let H=A.sort().join(","),de=F.sort().join(",");n(4,b=A.length&&H!==de);let Re=r.find(Ge=>H===Ge.skills.sort().join(","));Re?(n(7,z=Re.name),n(5,y=!1)):(n(7,z=void 0),n(5,y=!0))},E,R=()=>{E!==void 0&&(va.update(_e=>(_e=_e.filter(H=>H.name!==E||H.pclass!==I.player.class),_e.push({name:E,skills:g(_),pclass:I.player.class}),_e)),n(7,z=E),n(6,E=void 0),n(5,y=!1))},z,q=_e=>{let H=r.find(de=>de.name===z&&de.pclass===I.player.class);if(H){let de=new Map;H.skills.forEach(Re=>{de.has(Re)?de.set(Re,de.get(Re)+1):de.set(Re,1)}),k(de,o),L(),b&&v()}},j=()=>{va.update(_e=>_e.filter(H=>H.name!==z)),n(7,z=void 0),n(5,y=!0)},W=_e=>_e.pclass===I.player.class,N=_e=>_e.pclass===I.player.class;function O(){z=ks(this),n(7,z)}let se=_e=>n(6,E="");function re(){E=this.value,n(6,E)}let ie=_e=>n(6,E=void 0),ce=(_e,H)=>D(_e,-1),ke=(_e,H)=>D(_e,1),ge=_e=>_e.class===I.player.class&&!_e.engineOnly&&!o.has(_e.id);function Ne(_e){Nt[_e?"unshift":"push"](()=>{p=_e,n(2,p)})}let Te=()=>{tt(df,u=!u,u)},Ce=()=>{tt(fo,f=!1,f)};return t.$$.update=()=>{t.$$.dirty[0]&1048577&&(k(c,o),S(),L()),t.$$.dirty[0]&2&&a&&n(4,b=!0),t.$$.dirty[0]&786432&&n(9,s=l[24]-M),t.$$.dirty[0]&786432&&n(8,i=l[24]-M)},[o,a,p,_,b,y,E,z,i,s,r,f,u,v,D,R,q,j,M,l,c,W,N,O,se,re,ie,ce,ke,ge,Ne,Te,Ce]}var Rg=class extends Fe{constructor(e){super(),Se(this,e,EI,TI,Oe,{},null,[-1,-1])}},x6=Rg;function w6(t,e,n){let s=t.slice();return s[19]=e[n],s[21]=n,s}function M6(t){let e,n,s=me(t[1]),i=[];for(let r=0;r<s.length;r+=1)i[r]=C6(w6(t,s,r));let o=null;return s.length||(o=F6(t)),{c(){e=h("div");for(let r=0;r<i.length;r+=1)i[r].c();n=be(),o&&o.c(),m(e,"class","divider")},m(r,l){w(r,e,l);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(r,l);w(r,n,l),o&&o.m(r,l)},p(r,l){if(l&74){s=me(r[1]);let a;for(a=0;a<s.length;a+=1){let c=w6(r,s,a);i[a]?i[a].p(c,l):(i[a]=C6(c),i[a].c(),i[a].m(n.parentNode,n))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length,!s.length&&o?o.p(r,l):s.length?o&&(o.d(1),o=null):(o=F6(r),o.c(),o.m(n.parentNode,n))}},d(r){r&&(x(e),x(n)),st(i,r),o&&o.d(r)}}}function F6(t){let e;return{c(){e=h("div"),e.textContent="No results",m(e,"class","textgrey result svelte-17jb1r5")},m(n,s){w(n,e,s)},p:ue,d(n){n&&x(e)}}}function C6(t){let e,n,s=t[19].name+"",i,o,r=t[19].type+"",l,a,c,f=(t[19].level||1)+"",u,p,g,v;function _(...b){return t[14](t[21],...b)}return{c(){e=h("div"),n=h("span"),i=T(s),o=h("span"),l=T(r),a=h("span"),c=T("Lv. "),u=T(f),m(o,"class","textgrey infocol svelte-17jb1r5"),m(a,"class","infocol svelte-17jb1r5"),m(e,"class",p="result "+(t[21]===t[3]?"sel":"")+" svelte-17jb1r5")},m(b,y){w(b,e,y),d(e,n),d(n,i),d(e,o),d(o,l),d(e,a),d(a,c),d(a,u),g||(v=X(e,"mousedown",_),g=!0)},p(b,y){t=b,y&2&&s!==(s=t[19].name+"")&&G(i,s),y&2&&r!==(r=t[19].type+"")&&G(l,r),y&2&&f!==(f=(t[19].level||1)+"")&&G(u,f),y&8&&p!==(p="result "+(t[21]===t[3]?"sel":"")+" svelte-17jb1r5")&&m(e,"class",p)},d(b){b&&x(e),g=!1,v()}}}function DI(t){let e,n,s,i,o,r,l,a=t[2]&&M6(t);return{c(){e=h("div"),n=h("div"),s=h("input"),a&&a.c(),m(s,"placeholder",i=C.ui.merchant.itemSearch),m(s,"type","search"),m(n,"class",o="container input "+(t[2]?"focus":"")),m(e,"class","navbtn finder")},m(c,f){w(c,e,f),d(e,n),d(n,s),t[11](s),We(s,t[0]),a&&a.m(n,null),r||(l=[X(s,"input",t[12]),X(s,"input",t[5]),X(s,"focus",t[13]),X(s,"blur",t[7])],r=!0)},p(c,[f]){f&1&&s.value!==c[0]&&We(s,c[0]),c[2]?a?a.p(c,f):(a=M6(c),a.c(),a.m(n,null)):a&&(a.d(1),a=null),f&4&&o!==(o="container input "+(c[2]?"focus":""))&&m(n,"class",o)},i:ue,o:ue,d(c){c&&x(e),t[11](null),a&&a.d(),r=!1,lt(l)}}}function II(t,e,n){let s=Cr(),i=sr.filter(M=>M.level<=45).map(M=>({name:hn(M.type,M.tier),type:M.type,tier:M.tier,level:M.level})),o=()=>{let M=a.toLowerCase();M.length?n(1,f=i.filter(D=>D.type===M||D.name.toLowerCase().includes(M)).slice(0,c)):n(1,f=[]),p>=f.length&&_(f.length-1)},{type:r}=e,{tier:l}=e,{name:a=""}=e,{limit:c=5}=e,f=[],u=!1,p=-1,g,v,_=M=>{n(3,p=M),p>=0?(g=f[p],n(0,a=g.name),n(8,r=g.type),n(9,l=g.tier)):(g=void 0,n(0,a=""),n(8,r="all"),n(9,l="all"))},b=M=>{M.target==v&&((M.keyCode===38||M.keyCode===40)&&f.length?(_(ba(p+(M.keyCode===38?-1:1),f.length)),M.preventDefault()):(M.keyCode==13||M.keyCode==27)&&v.blur())},y=M=>{n(2,u=!1),_(Math.min(Math.max(0,p),f.length-1)),p>=0&&s("finalize")};Pn(()=>{document.addEventListener("keydown",b)}),Tn(()=>{document.removeEventListener("keydown",b),n(4,v=void 0)});function k(M){Nt[M?"unshift":"push"](()=>{v=M,n(4,v)})}function S(){a=this.value,n(0,a)}let A=M=>n(2,u=!0),F=(M,D)=>_(M);return t.$$set=M=>{"type"in M&&n(8,r=M.type),"tier"in M&&n(9,l=M.tier),"name"in M&&n(0,a=M.name),"limit"in M&&n(10,c=M.limit)},[a,f,u,p,v,o,_,y,r,l,c,k,S,A,F]}var zg=class extends Fe{constructor(e){super(),Se(this,e,II,DI,Oe,{type:8,tier:9,name:0,limit:10})}},S6=zg;var A6=t=>9+Math.ceil(t*.001);function P6(t,e,n){let s=t.slice();return s[55]=e[n],s}function T6(t,e,n){let s=t.slice();return s[58]=e[n],s[60]=n,s}function E6(t){let e,n;return e=new jt({props:{origin:"left top",defaultOffset:[0,100],title:"Merchant",$$slots:{default:[UI]},$$scope:{ctx:t}}}),e.$on("close",t[50]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i[0]&2097135|i[1]&1073741824&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function VI(t){let e,n=t[58]+"",s,i,o,r;function l(...a){return t[44](t[58],...a)}return{c(){e=h("div"),s=T(n),m(e,"class",i="choice "+(t[58]==t[6]?"active":"")+" svelte-35lzg4")},m(a,c){w(a,e,c),d(e,s),o||(r=X(e,"click",l),o=!0)},p(a,c){t=a,c[0]&64&&i!==(i="choice "+(t[58]==t[6]?"active":"")+" svelte-35lzg4")&&m(e,"class",i)},d(a){a&&x(e),o=!1,r()}}}function LI(t){let e;return{c(){e=h("div"),m(e,"class","divider svelte-35lzg4")},m(n,s){w(n,e,s)},p:ue,d(n){n&&x(e)}}}function D6(t){let e;function n(o,r){return o[58]===null?LI:VI}let i=n(t,[-1,-1])(t);return{c(){i.c(),e=be()},m(o,r){i.m(o,r),w(o,e,r)},p(o,r){i.p(o,r)},d(o){o&&x(e),i.d(o)}}}function I6(t){let e,n,s,i=hn(t[55].temp.type,t[55].temp.tier)+"",o,r,l,a=(t[55].temp.logic.level||1)+"",c,f,u,p=t[55].temp.owner+"",g,v,_=t[27](t[55].temp.auction.getTime())+"",b,y,k,S=t[13]&&t[55].temp.stacks>0?t[55].temp.stacks+" x ":"",A,F,M,D,L,E;n=new bs({props:{shift:t[20],descPos:"right:0;top:0;",descRoot:t[5],pickable:!1,item:t[55]}}),F=new kn({props:{amount:t[13]&&t[55].temp.stacks>0?Math.ceil(t[55].temp.auctionprice/t[55].temp.stacks):t[55].temp.auctionprice}});function R(...z){return t[47](t[55],...z)}return{c(){e=h("div"),ne(n.$$.fragment),s=h("span"),o=T(i),l=h("span"),c=T(a),u=h("span"),g=T(p),v=h("span"),b=T(_),y=h("div"),k=h("span"),A=T(S),ne(F.$$.fragment),m(s,"class",r="marg text"+Yt(t[55].temp.quality)[0]+" svelte-35lzg4"),qe(s,"margin-left","6px"),m(l,"class",f="marg "+(I.player.level>=t[55].temp.logic.level?"textgreen":"textred")+" svelte-35lzg4"),m(u,"class","marg svelte-35lzg4"),m(v,"class","marg svelte-35lzg4"),m(k,"class","textgreen"),m(y,"class","marg svelte-35lzg4"),qe(y,"text-align","end"),m(e,"class",M="buy "+(t[18]==t[55]?"selected":"")+" item panel-black svelte-35lzg4")},m(z,q){w(z,e,q),ee(n,e,null),d(e,s),d(s,o),d(e,l),d(l,c),d(e,u),d(u,g),d(e,v),d(v,b),d(e,y),d(y,k),d(k,A),ee(F,y,null),D=!0,L||(E=X(e,"click",R),L=!0)},p(z,q){t=z;let j={};q[0]&1048576&&(j.shift=t[20]),q[0]&32&&(j.descRoot=t[5]),q[0]&131072&&(j.item=t[55]),n.$set(j),(!D||q[0]&131072)&&i!==(i=hn(t[55].temp.type,t[55].temp.tier)+"")&&G(o,i),(!D||q[0]&131072&&r!==(r="marg text"+Yt(t[55].temp.quality)[0]+" svelte-35lzg4"))&&m(s,"class",r),(!D||q[0]&131072)&&a!==(a=(t[55].temp.logic.level||1)+"")&&G(c,a),(!D||q[0]&131072&&f!==(f="marg "+(I.player.level>=t[55].temp.logic.level?"textgreen":"textred")+" svelte-35lzg4"))&&m(l,"class",f),(!D||q[0]&131072)&&p!==(p=t[55].temp.owner+"")&&G(g,p),(!D||q[0]&131072)&&_!==(_=t[27](t[55].temp.auction.getTime())+"")&&G(b,_),(!D||q[0]&139264)&&S!==(S=t[13]&&t[55].temp.stacks>0?t[55].temp.stacks+" x ":"")&&G(A,S);let W={};q[0]&139264&&(W.amount=t[13]&&t[55].temp.stacks>0?Math.ceil(t[55].temp.auctionprice/t[55].temp.stacks):t[55].temp.auctionprice),F.$set(W),(!D||q[0]&393216&&M!==(M="buy "+(t[18]==t[55]?"selected":"")+" item panel-black svelte-35lzg4"))&&m(e,"class",M)},i(z){D||(P(n.$$.fragment,z),P(F.$$.fragment,z),D=!0)},o(z){V(n.$$.fragment,z),V(F.$$.fragment,z),D=!1},d(z){z&&x(e),te(n),te(F),L=!1,E()}}}function qI(t){let e,n,s,i,o=[BI,zI],r=[];function l(a,c){return a[18].temp.owner!==I.player.name?0:1}return n=l(t,[-1,-1]),s=r[n]=o[n](t),{c(){e=h("section"),s.c(),m(e,"class","confirm panel-black svelte-35lzg4")},m(a,c){w(a,e,c),r[n].m(e,null),i=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(Ee(),V(r[f],1,1,()=>{r[f]=null}),De(),s=r[n],s?s.p(a,c):(s=r[n]=o[n](a),s.c()),P(s,1),s.m(e,null))},i(a){i||(P(s),i=!0)},o(a){V(s),i=!1},d(a){a&&x(e),r[n].d()}}}function RI(t){let e,n,s,i=(t[3]?hn(t[3].type,t[3].tier):C.ui.merchant.dragitem)+"",o,r,l,a,c=C.ui.merchant.price+"",f,u,p,g,v,_,b=C.ui.merchant.fee+"",y,k,S,A,F,M,D=C.ui.merchant.post+"",L,E,R,z,q,j;n=new bs({props:{descPos:"left:100%;bottom:100%;",clearOnMove:!0,invslot:void 0,pickable:!0,item:ci}}),n.$on("discard",t[26]),n.$on("move",t[25]),n.$on("click",t[26]),n.$on("context",t[26]),p=new kn({props:{amount:t[1]}}),S=new kn({props:{amount:t[15]}});let W=t[3]&&t[3].stacks>0&&V6(t);return{c(){e=h("section"),ne(n.$$.fragment),s=h("span"),o=T(i),l=h("div"),a=h("span"),f=T(c),u=T(": "),ne(p.$$.fragment),g=$e(),v=h("br"),_=h("span"),y=T(b),k=T(": "),ne(S.$$.fragment),A=h("input"),W&&W.c(),M=h("div"),L=T(D),m(s,"class",r="marg text"+(t[3]?Yt(t[3].quality)[0]:"grey")+" svelte-35lzg4"),m(a,"class","textwhite"),m(_,"class","textgrey"),m(l,"class","marg svelte-35lzg4"),qe(l,"text-align","end"),m(A,"class","marg svelte-35lzg4"),m(A,"type","number"),m(A,"placeholder",F=C.ui.merchant.setPrice),m(M,"class",E="marg btn formatted secondary "+(t[16]?"":"disabled")+" svelte-35lzg4"),m(e,"class",R="post "+(t[3]&&t[3].stacks>0?"postStacks":"")+" panel-black svelte-35lzg4")},m(N,O){w(N,e,O),ee(n,e,null),d(e,s),d(s,o),d(e,l),d(l,a),d(a,f),d(a,u),ee(p,a,null),d(a,g),d(l,v),d(l,_),d(_,y),d(_,k),ee(S,_,null),d(e,A),We(A,t[0]),W&&W.m(e,null),d(e,M),d(M,L),z=!0,q||(j=[X(A,"input",t[48]),X(M,"click",t[24])],q=!0)},p(N,O){(!z||O[0]&8)&&i!==(i=(N[3]?hn(N[3].type,N[3].tier):C.ui.merchant.dragitem)+"")&&G(o,i),(!z||O[0]&8&&r!==(r="marg text"+(N[3]?Yt(N[3].quality)[0]:"grey")+" svelte-35lzg4"))&&m(s,"class",r);let se={};O[0]&2&&(se.amount=N[1]),p.$set(se);let re={};O[0]&32768&&(re.amount=N[15]),S.$set(re),O[0]&1&&$t(A.value)!==N[0]&&We(A,N[0]),N[3]&&N[3].stacks>0?W?W.p(N,O):(W=V6(N),W.c(),W.m(e,M)):W&&(W.d(1),W=null),(!z||O[0]&65536&&E!==(E="marg btn formatted secondary "+(N[16]?"":"disabled")+" svelte-35lzg4"))&&m(M,"class",E),(!z||O[0]&8&&R!==(R="post "+(N[3]&&N[3].stacks>0?"postStacks":"")+" panel-black svelte-35lzg4"))&&m(e,"class",R)},i(N){z||(P(n.$$.fragment,N),P(p.$$.fragment,N),P(S.$$.fragment,N),z=!0)},o(N){V(n.$$.fragment,N),V(p.$$.fragment,N),V(S.$$.fragment,N),z=!1},d(N){N&&x(e),te(n),te(p),te(S),W&&W.d(),q=!1,lt(j)}}}function zI(t){let e,n,s,i=hn(t[18].temp.type,t[18].temp.tier)+"",o,r,l,a,c,f,u;return{c(){e=h("span"),n=T("Stop "),s=h("span"),o=T(i),l=T(" from being listed?"),a=h("div"),a.textContent=`${C.ui.cancel}`,c=h("div"),c.textContent=`${C.ui.merchant.delist}`,m(s,"class",r="text"+Yt(t[18].temp.quality)[0]+" svelte-35lzg4"),m(e,"class","marg svelte-35lzg4"),m(a,"class","marg btn formatted grey svelte-35lzg4"),m(c,"class","marg btn formatted orange svelte-35lzg4")},m(p,g){w(p,e,g),d(e,n),d(e,s),d(s,o),d(e,l),w(p,a,g),w(p,c,g),f||(u=[X(a,"click",t[29]),X(c,"click",t[31])],f=!0)},p(p,g){g[0]&262144&&i!==(i=hn(p[18].temp.type,p[18].temp.tier)+"")&&G(o,i),g[0]&262144&&r!==(r="text"+Yt(p[18].temp.quality)[0]+" svelte-35lzg4")&&m(s,"class",r)},i:ue,o:ue,d(p){p&&(x(e),x(a),x(c)),f=!1,lt(u)}}}function BI(t){let e,n=C.ui.merchant.buyItem[0]+"",s,i,o,r=t[18].temp.stacks>0?t[18].temp.stacks+" x ":"",l,a,c=hn(t[18].temp.type,t[18].temp.tier)+"",f,u,p,g=C.ui.merchant.buyItem[1]+"",v,_,b,y,k=C.ui.merchant.buyItem[2]+"",S,A,F,M,D,L;return b=new kn({props:{amount:t[18].temp.auctionprice}}),{c(){e=h("span"),s=T(n),i=$e(),o=h("span"),l=T(r),a=h("span"),f=T(c),p=$e(),v=T(g),_=$e(),ne(b.$$.fragment),y=$e(),S=T(k),A=h("div"),A.textContent=`${C.ui.cancel}`,F=h("div"),F.textContent=`${C.ui.merchant.buy}`,m(o,"class","textgreen"),m(a,"class",u="text"+Yt(t[18].temp.quality)[0]+" svelte-35lzg4"),m(e,"class","marg svelte-35lzg4"),m(A,"class","marg btn formatted grey svelte-35lzg4"),m(F,"class","marg btn formatted secondary svelte-35lzg4")},m(E,R){w(E,e,R),d(e,s),d(e,i),d(e,o),d(o,l),d(e,a),d(a,f),d(e,p),d(e,v),d(e,_),ee(b,e,null),d(e,y),d(e,S),w(E,A,R),w(E,F,R),M=!0,D||(L=[X(A,"click",t[29]),X(F,"click",t[30])],D=!0)},p(E,R){(!M||R[0]&262144)&&r!==(r=E[18].temp.stacks>0?E[18].temp.stacks+" x ":"")&&G(l,r),(!M||R[0]&262144)&&c!==(c=hn(E[18].temp.type,E[18].temp.tier)+"")&&G(f,c),(!M||R[0]&262144&&u!==(u="text"+Yt(E[18].temp.quality)[0]+" svelte-35lzg4"))&&m(a,"class",u);let z={};R[0]&262144&&(z.amount=E[18].temp.auctionprice),b.$set(z)},i(E){M||(P(b.$$.fragment,E),M=!0)},o(E){V(b.$$.fragment,E),M=!1},d(E){E&&(x(e),x(A),x(F)),te(b),D=!1,lt(L)}}}function V6(t){let e,n,s,i,o,r,l;return{c(){e=h("select"),n=h("option"),n.textContent="Total",i=h("option"),i.textContent="Per Unit",n.__value=s=!1,We(n,n.__value),i.__value=o=!0,We(i,i.__value),m(e,"class","marg formatted svelte-35lzg4"),t[2]===void 0&&_n(()=>t[49].call(e))},m(a,c){w(a,e,c),d(e,n),d(e,i),wn(e,t[2],!0),r||(l=X(e,"change",t[49]),r=!0)},p(a,c){c[0]&4&&wn(e,a[2])},d(a){a&&x(e),r=!1,l()}}}function UI(t){let e,n,s,i,o,r,l,a,c=C.ui.merchant.search+"",f,u,p,g=C.ui.merchant.previous+"",v,_,b,y=C.ui.merchant.next+"",k,S,A,F,M,D,L,E,R,z,q,j=C.ui.merchant.results+"",W,N,O=t[14]+1+"",se,re,ie=Math.ceil(t[19]/50)+"",ce,ke,ge,Ne,Te,Ce=t[32](t[10],"time",t[11])+"",_e,H=C.ui.merchant.time+"",de,Re,Ge,Xe=(t[12]?C.ui.merchant.perUnit:C.ui.merchant.total)+"",Ye,pe,ae,Ue=t[32](t[10],"price",t[11])+"",Z,Q=C.ui.merchant.price+"",U,fe,je,Ve,xe,ze,Be,mt,wt;function Ze(He){t[37](He)}function Et(He){t[38](He)}function ye(He){t[39](He)}let Je={limit:10};t[8]!==void 0&&(Je.name=t[8]),t[7]!==void 0&&(Je.tier=t[7]),t[6]!==void 0&&(Je.type=t[6]),s=new S6({props:Je}),Nt.push(()=>Lo(s,"name",Ze)),Nt.push(()=>Lo(s,"tier",Et)),Nt.push(()=>Lo(s,"type",ye)),s.$on("finalize",t[23]);let yt=me(t[22]),St=[];for(let He=0;He<yt.length;He+=1)St[He]=D6(T6(t,yt,He));let Pe=me(t[17]),ft=[];for(let He=0;He<Pe.length;He+=1)ft[He]=I6(P6(t,Pe,He));let Ut=He=>V(ft[He],1,1,()=>{ft[He]=null}),Le=[RI,qI],Ct=[];function Vt(He,Ke){return He[18]?1:0}return xe=Vt(t,[-1,-1]),ze=Ct[xe]=Le[xe](t),{c(){e=h("div"),n=h("section"),ne(s.$$.fragment),l=h("span"),a=h("div"),f=T(c),p=h("div"),v=T(g),b=h("div"),k=T(y),A=h("section");for(let He=0;He<St.length;He+=1)St[He].c();F=h("section"),M=h("div"),D=h("div"),L=h("div"),E=h("span"),R=h("span"),z=T(t[19]),q=$e(),W=T(j),N=T(" ("),se=T(O),re=T("/"),ce=T(ie),ke=T(")"),ge=h("span"),ge.textContent="Lv.",Ne=h("span"),Ne.textContent=`${C.ui.merchant.owner}`,Te=h("span"),_e=T(Ce),de=T(H),Ge=h("span"),Ye=T(Xe),ae=h("span"),Z=T(Ue),U=T(Q),fe=$e(),Ve=h("div");for(let He=0;He<ft.length;He+=1)ft[He].c();ze.c(),m(a,"class",u="btn formatted secondary "+(t[9]?"":"disabled")),m(p,"class",_="btn formatted grey "+(t[9]&&t[14]>0?"":"disabled")),m(b,"class",S="btn formatted grey "+(t[9]&&t[17].length==50?"":"disabled")),m(n,"class","search panel-black svelte-35lzg4"),m(A,"class","choices border grey scrollbar svelte-35lzg4"),m(R,"class","btn black disabled textgrey"),m(ge,"class","btn black disabled textgrey"),m(Ne,"class","btn black disabled textgrey"),m(Te,"class",Re="btn grey "+(t[9]?"":"disabled")+" "+(t[10]=="time"?"textprimary active":"")),m(Ge,"class",pe="btn grey "+(t[9]?"":"disabled")+" "+(t[12]?"textgreen":"")),qe(Ge,"text-align","end"),m(ae,"class",je="btn grey "+(t[9]?"":"disabled")+" "+(t[10]=="price"?"textprimary active":"")),qe(ae,"text-align","end"),m(L,"class","buytblhead svelte-35lzg4"),m(D,"class","scrollbar scrollbar-fix"),m(Ve,"class","scrollbar scrollbar-fix"),m(M,"class","buytable svelte-35lzg4"),m(F,"class","items border grey svelte-35lzg4"),m(e,"class","layout svelte-35lzg4")},m(He,Ke){w(He,e,Ke),d(e,n),ee(s,n,null),d(n,l),d(n,a),d(a,f),d(n,p),d(p,v),d(n,b),d(b,k),t[43](n),d(e,A);for(let Me=0;Me<St.length;Me+=1)St[Me]&&St[Me].m(A,null);d(e,F),d(F,M),d(M,D),d(D,L),d(L,E),d(L,R),d(R,z),d(R,q),d(R,W),d(R,N),d(R,se),d(R,re),d(R,ce),d(R,ke),d(L,ge),d(L,Ne),d(L,Te),d(Te,_e),d(Te,de),d(L,Ge),d(Ge,Ye),d(L,ae),d(ae,Z),d(ae,U),d(ae,fe),d(M,Ve);for(let Me=0;Me<ft.length;Me+=1)ft[Me]&&ft[Me].m(Ve,null);Ct[xe].m(e,null),Be=!0,mt||(wt=[X(a,"click",t[40]),X(p,"click",t[41]),X(b,"click",t[42]),X(Te,"click",t[45]),X(Ge,"click",t[34]),X(ae,"click",t[46])],mt=!0)},p(He,Ke){let Me={};if(!i&&Ke[0]&256&&(i=!0,Me.name=He[8],Vo(()=>i=!1)),!o&&Ke[0]&128&&(o=!0,Me.tier=He[7],Vo(()=>o=!1)),!r&&Ke[0]&64&&(r=!0,Me.type=He[6],Vo(()=>r=!1)),s.$set(Me),(!Be||Ke[0]&512&&u!==(u="btn formatted secondary "+(He[9]?"":"disabled")))&&m(a,"class",u),(!Be||Ke[0]&16896&&_!==(_="btn formatted grey "+(He[9]&&He[14]>0?"":"disabled")))&&m(p,"class",_),(!Be||Ke[0]&131584&&S!==(S="btn formatted grey "+(He[9]&&He[17].length==50?"":"disabled")))&&m(b,"class",S),Ke[0]&12599744){yt=me(He[22]);let Qe;for(Qe=0;Qe<yt.length;Qe+=1){let ut=T6(He,yt,Qe);St[Qe]?St[Qe].p(ut,Ke):(St[Qe]=D6(ut),St[Qe].c(),St[Qe].m(A,null))}for(;Qe<St.length;Qe+=1)St[Qe].d(1);St.length=yt.length}if((!Be||Ke[0]&524288)&&G(z,He[19]),(!Be||Ke[0]&16384)&&O!==(O=He[14]+1+"")&&G(se,O),(!Be||Ke[0]&524288)&&ie!==(ie=Math.ceil(He[19]/50)+"")&&G(ce,ie),(!Be||Ke[0]&3072)&&Ce!==(Ce=He[32](He[10],"time",He[11])+"")&&G(_e,Ce),(!Be||Ke[0]&1536&&Re!==(Re="btn grey "+(He[9]?"":"disabled")+" "+(He[10]=="time"?"textprimary active":"")))&&m(Te,"class",Re),(!Be||Ke[0]&4096)&&Xe!==(Xe=(He[12]?C.ui.merchant.perUnit:C.ui.merchant.total)+"")&&G(Ye,Xe),(!Be||Ke[0]&4608&&pe!==(pe="btn grey "+(He[9]?"":"disabled")+" "+(He[12]?"textgreen":"")))&&m(Ge,"class",pe),(!Be||Ke[0]&3072)&&Ue!==(Ue=He[32](He[10],"price",He[11])+"")&&G(Z,Ue),(!Be||Ke[0]&1536&&je!==(je="btn grey "+(He[9]?"":"disabled")+" "+(He[10]=="price"?"textprimary active":"")))&&m(ae,"class",je),Ke[0]&404103200){Pe=me(He[17]);let Qe;for(Qe=0;Qe<Pe.length;Qe+=1){let ut=P6(He,Pe,Qe);ft[Qe]?(ft[Qe].p(ut,Ke),P(ft[Qe],1)):(ft[Qe]=I6(ut),ft[Qe].c(),P(ft[Qe],1),ft[Qe].m(Ve,null))}for(Ee(),Qe=Pe.length;Qe<ft.length;Qe+=1)Ut(Qe);De()}let ot=xe;xe=Vt(He,Ke),xe===ot?Ct[xe].p(He,Ke):(Ee(),V(Ct[ot],1,1,()=>{Ct[ot]=null}),De(),ze=Ct[xe],ze?ze.p(He,Ke):(ze=Ct[xe]=Le[xe](He),ze.c()),P(ze,1),ze.m(e,null))},i(He){if(!Be){P(s.$$.fragment,He);for(let Ke=0;Ke<Pe.length;Ke+=1)P(ft[Ke]);P(ze),Be=!0}},o(He){V(s.$$.fragment,He),ft=ft.filter(Boolean);for(let Ke=0;Ke<ft.length;Ke+=1)V(ft[Ke]);V(ze),Be=!1},d(He){He&&x(e),te(s),t[43](null),st(St,He),st(ft,He),Ct[xe].d(),mt=!1,lt(wt)}}}function OI(t){let e,n,s=t[4]&&E6(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,o){i[4]?s?(s.p(i,o),o[0]&16&&P(s,1)):(s=E6(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function $I(t,e,n){let s,i,o,r,l,a;oe(t,ia,xe=>n(35,s=xe)),oe(t,ci,xe=>n(3,i=xe)),oe(t,ai,xe=>n(4,o=xe)),oe(t,Pr,xe=>n(36,r=xe)),oe(t,pp,xe=>n(19,l=xe));let c=nt.shift.store;oe(t,c,xe=>n(20,a=xe));let f,u=[C.ui.all,C.ui.merchant.filtermine,null,"bow","hammer","staff","sword",null,"orb","quiver","shield","totem",null,"armlet","armor","boot","glove",null,"amulet","bag","ring",null,"book","rune","misc",null,"mount","pet","box"],p=u[0],g="all",v="",_=[],b=!0,y="price",k=1,S=!1,A=!1,F=0,M=()=>{if(b&&o){n(18,ce=void 0);let xe=u.indexOf(p);xt("itemauctionfind",`${xe} ${xe===1?"all":g} ${y==="time"?0:S?2:1} ${k} ${F}`),n(9,b=!1)}},D,L,E=!1,R,z,q=()=>{z&&xt("itemauctionpost",`${i.dbid} ${L}`)},j=xe=>{let{from:ze,to:Be}=xe.detail;ze!==Be&&ze.type=="item"&&ci.set(ze.item)},W=xe=>{i&&i.type&&Mt(Rs[i.type].sound),ci.set()},N,O=[],se=[],re=()=>{if(N=Date.now(),s.length){let xe=s.map(ze=>ze.dbid);fetch("/api/item/get",{method:"POST",body:JSON.stringify({auction:1,ids:xe})}).then(async ze=>{let Be=await ze.json();Be.fail?console.error(Be):(n(17,se.length=0,se),s.forEach((mt,wt)=>{let Ze=Be.find(Et=>Et.id===mt.dbid);Ze&&(Ze.store=O[wt]||(O[wt]=K()),Ze.store.temp=mt,mt.hydrate(Ze),se.push(Ze.store))}),n(13,A=S),n(9,b=!0))})}else n(13,A=S),n(9,b=!0),n(17,se.length=0,se)},ie=xe=>{let ze=Math.ceil((xe-N)/6e4);return ze<60?`${ze} m`:`${Math.ceil(ze/60)} h`},ce,ke=xe=>{n(18,ce=xe)},ge=()=>{n(18,ce=void 0)},Ne=()=>{xt("itemauctionbuy",ce.temp.dbid+""),ge()},Te=()=>{xt("itemauctioncancel",ce.temp.dbid+""),ge()},Ce=(xe,ze,Be)=>xe==ze?Be==1?"\u{1F815} ":"\u{1F817} ":"",_e=xe=>{n(14,F=0),xe==y?n(11,k=k==1?0:1):n(10,y=xe),M()},H=()=>{n(12,S=!S),y=="price"?M():n(13,A=S)};ci.subscribe(xe=>{xe!==void 0&&(n(6,p=xe.type),n(7,g=xe.tier),n(11,k=1),n(10,y="price"),n(12,S=!0),n(14,F=0),M())});function de(xe){v=xe,n(8,v)}function Re(xe){g=xe,n(7,g)}function Ge(xe){p=xe,n(6,p)}let Xe=xe=>{n(14,F=0),M()},Ye=xe=>{n(14,F--,F),M()},pe=xe=>{n(14,F++,F),M()};function ae(xe){Nt[xe?"unshift":"push"](()=>{f=xe,n(5,f)})}let Ue=(xe,ze)=>{n(6,p=xe),n(8,v=""),n(7,g="all"),n(14,F=0),M()},Z=xe=>_e("time"),Q=xe=>_e("price"),U=(xe,ze)=>ke(xe);function fe(){D=$t(this.value),n(0,D),n(3,i),n(2,E),n(1,L),n(4,o)}function je(){E=ks(this),n(2,E)}let Ve=()=>{tt(ai,o=void 0,o),n(8,v=""),n(7,g="all")};return t.$$.update=()=>{t.$$.dirty[0]&16|t.$$.dirty[1]&32&&o&&M(),t.$$.dirty[0]&16&&(o?n(18,ce=void 0):tt(ci,i=void 0,i)),t.$$.dirty[0]&15&&(vt(),n(0,D=vt(D,0,2147483646)),n(1,L=i?vt((parseInt(D)||0)*(E&&i.stacks||1),0,2147483646):0),n(15,R=Number.isInteger(L)?A6(L):0),n(16,z=Number.isInteger(L)&&L>0&&i&&i.canBeTraded())),t.$$.dirty[1]&16&&re()},[D,L,E,i,o,f,p,g,v,b,y,k,S,A,F,R,z,se,ce,l,a,c,u,M,q,j,W,ie,ke,ge,Ne,Te,Ce,_e,H,s,r,de,Re,Ge,Xe,Ye,pe,ae,Ue,Z,Q,U,fe,je,Ve]}var Bg=class extends Fe{constructor(e){super(),Se(this,e,$I,OI,Oe,{},null,[-1,-1])}},L6=Bg;var pd=[{name:"Year",days:365,price:9e3},{name:"Month",days:30,price:900}],$n=[{sub:!1,stash:15,inventory:15,auction:10,auctionHours:12},{sub:!0,stash:100,inventory:25,auction:100,auctionHours:24}];function q6(t,e,n){let s=t.slice();return s[41]=e[n],s}function R6(t,e,n){let s=t.slice();return s[44]=e[n],s}function z6(t){let e,n;return e=new jt({props:{origin:"left top",defaultOffset:[3,100],title:"Stash",settings:[{name:"Stash Settings",fun:t[33]}],icon:"bag",$$slots:{default:[NI]},$$scope:{ctx:t}}}),e.$on("close",t[34]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i[0]&2048&&(o.settings=[{name:"Stash Settings",fun:s[33]}]),i[0]&131071|i[1]&65536&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function B6(t){let e,n,s,i,o,r,l,a=["Ungrouped","Grouped","Groups + Titles"][t[14]]+"",c,f,u,p;return{c(){e=h("div"),n=h("small"),n.textContent="Width",s=h("input"),i=h("small"),i.textContent="Height",o=h("input"),r=h("div"),l=h("small"),c=T(a),m(n,"class","btn textsecondary"),m(s,"type","range"),m(s,"min","7"),m(s,"max","20"),m(i,"class","btn textsecondary"),m(o,"type","range"),m(o,"min","50"),m(o,"max","500"),m(l,"class",f="btn grey text"+["white","green","cyan"][t[14]]+" svelte-rsg9c3"),m(e,"class","panel-black bar-top-config svelte-rsg9c3")},m(g,v){w(g,e,v),d(e,n),d(e,s),We(s,t[12]),d(e,i),d(e,o),We(o,t[13]),d(e,r),d(e,l),d(l,c),u||(p=[X(s,"change",t[25]),X(s,"input",t[25]),X(o,"change",t[26]),X(o,"input",t[26]),X(l,"click",t[27])],u=!0)},p(g,v){v[0]&4096&&We(s,g[12]),v[0]&8192&&We(o,g[13]),v[0]&16384&&a!==(a=["Ungrouped","Grouped","Groups + Titles"][g[14]]+"")&&G(c,a),v[0]&16384&&f!==(f="btn grey text"+["white","green","cyan"][g[14]]+" svelte-rsg9c3")&&m(l,"class",f)},d(g){g&&x(e),u=!1,lt(p)}}}function U6(t){let e,n=t[41].name+"",s;return{c(){e=h("small"),s=T(n),m(e,"class","textprimary"),qe(e,"display","block"),qe(e,"font-size","10px"),qe(e,"text-transform","uppercase"),qe(e,"letter-spacing","0.1em")},m(i,o){w(i,e,o),d(e,s)},p(i,o){o[0]&16864&&n!==(n=i[41].name+"")&&G(s,n)},d(i){i&&x(e)}}}function O6(t){let e,n;return e=new bs({props:{descPos:"left:100%;top:0;",shift:t[15],descRoot:t[3],pickable:!1,text:t[19](t[44].temp?t[44].temp.getStashTime():0),item:t[44],filter:!t[9]||(!t[44].temp||t[44].temp.getStashTime()>t[4]||"")||t[6].includes(t[44])?!0:""}}),e.$on("click",function(){qi(t[6].includes(t[44])?void 0:t[20])&&(t[6].includes(t[44])?void 0:t[20]).apply(this,arguments)}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){t=s;let o={};i[0]&32768&&(o.shift=t[15]),i[0]&8&&(o.descRoot=t[3]),i[0]&16864&&(o.text=t[19](t[44].temp?t[44].temp.getStashTime():0)),i[0]&16864&&(o.item=t[44]),i[0]&17392&&(o.filter=!t[9]||(!t[44].temp||t[44].temp.getStashTime()>t[4]||"")||t[6].includes(t[44])?!0:""),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function $6(t){let e,n,s=t[14]===2&&t[41].stores.length>0&&U6(t),i=me(t[41].stores),o=[];for(let l=0;l<i.length;l+=1)o[l]=O6(R6(t,i,l));let r=l=>V(o[l],1,1,()=>{o[l]=null});return{c(){s&&s.c(),e=h("div");for(let l=0;l<o.length;l+=1)o[l].c();m(e,"class","slotcontainer svelte-rsg9c3"),qe(e,"width",t[8].length?"fit-content":"auto"),qe(e,"grid-template-columns","repeat("+Math.min(t[8].length,t[12])+", auto)")},m(l,a){s&&s.m(l,a),w(l,e,a);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(e,null);n=!0},p(l,a){if(l[14]===2&&l[41].stores.length>0?s?s.p(l,a):(s=U6(l),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null),a[0]&1623032){i=me(l[41].stores);let c;for(c=0;c<i.length;c+=1){let f=R6(l,i,c);o[c]?(o[c].p(f,a),P(o[c],1)):(o[c]=O6(f),o[c].c(),P(o[c],1),o[c].m(e,null))}for(Ee(),c=i.length;c<o.length;c+=1)r(c);De()}(!n||a[0]&256)&&qe(e,"width",l[8].length?"fit-content":"auto"),(!n||a[0]&4352)&&qe(e,"grid-template-columns","repeat("+Math.min(l[8].length,l[12])+", auto)")},i(l){if(!n){for(let a=0;a<i.length;a+=1)P(o[a]);n=!0}},o(l){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)V(o[a]);n=!1},d(l){l&&x(e),s&&s.d(l),st(o,l)}}}function N6(t){let e,n,s;return{c(){e=h("span"),e.innerHTML='Upgrade <img class="svgicon texticon" src="/data/ui/icons/gem.svg?v=8593107"/>',m(e,"class","btn textwhite")},m(i,o){w(i,e,o),n||(s=X(e,"click",t[29]),n=!0)},p:ue,d(i){i&&x(e),n=!1,s()}}}function j6(t){let e,n,s=(t[0]===1?C.ui.stash.deposit:C.ui.stash.withdraw)+"",i,o,r,l,a,c,f,u,p=(t[0]===1?C.ui.stash.deposit:C.ui.stash.withdraw)+"",g,v,_,b,y;return r=new kn({props:{amount:t[0]>0?t[1]:0}}),{c(){e=h("div"),n=h("span"),i=T(s),o=$e(),ne(r.$$.fragment),l=T(" ?"),a=h("div"),c=h("input"),f=h("div"),f.textContent="Max",u=h("div"),g=T(p),qe(c,"width","150px"),m(c,"class","navbtn formatted"),m(c,"type","number"),m(f,"class","btn navbtn cyan formatted"),m(u,"class",v="btn navbtn "+(!t[9]||t[1]<=0?"disabled":"")+" "+(t[0]===1?"blue":"green")+" formatted"),m(a,"class","marg-top formelements svelte-rsg9c3"),m(e,"class","panel-black marg-top"),qe(e,"text-align","right")},m(k,S){w(k,e,S),d(e,n),d(n,i),d(n,o),ee(r,n,null),d(n,l),d(e,a),d(a,c),We(c,t[1]),d(a,f),d(a,u),d(u,g),_=!0,b||(y=[X(c,"input",t[32]),X(f,"click",t[22]),X(u,"click",t[21])],b=!0)},p(k,S){(!_||S[0]&1)&&s!==(s=(k[0]===1?C.ui.stash.deposit:C.ui.stash.withdraw)+"")&&G(i,s);let A={};S[0]&3&&(A.amount=k[0]>0?k[1]:0),r.$set(A),S[0]&2&&$t(c.value)!==k[1]&&We(c,k[1]),(!_||S[0]&1)&&p!==(p=(k[0]===1?C.ui.stash.deposit:C.ui.stash.withdraw)+"")&&G(g,p),(!_||S[0]&515&&v!==(v="btn navbtn "+(!k[9]||k[1]<=0?"disabled":"")+" "+(k[0]===1?"blue":"green")+" formatted"))&&m(u,"class",v)},i(k){_||(P(r.$$.fragment,k),_=!0)},o(k){V(r.$$.fragment,k),_=!1},d(k){k&&x(e),te(r),b=!1,lt(y)}}}function NI(t){let e,n,s,i,o=t[8].length+"",r,l,a=(t[10].subscribed_until?$n[1].stash:$n[0].stash)+"",c,f,u,p,g,v,_,b,y,k,S,A,F,M,D,L,E=t[11]&&B6(t),R=me(t[14]<1?[{stores:t[8],name:""}]:[{stores:t[5],name:I.player.name},{stores:t[7],name:"Account Wide"},{stores:t[6],name:"Other characters"}]),z=[];for(let N=0;N<R.length;N+=1)z[N]=$6(q6(t,R,N));let q=N=>V(z[N],1,1,()=>{z[N]=null}),j=!t[10].subscribed_until&&N6(t);p=new kn({props:{amount:t[2].gold}});let W=t[0]>0&&j6(t);return{c(){E&&E.c(),e=h("div");for(let N=0;N<z.length;N+=1)z[N].c();n=h("div"),s=h("div"),i=h("span"),r=T(o),l=T(" / "),c=T(a),j&&j.c(),u=h("div"),ne(p.$$.fragment),g=h("div"),v=h("img"),y=h("div"),k=h("img"),W&&W.c(),F=be(),m(e,"class","panel-black scrollbar marg-top marg-bot slotparent svelte-rsg9c3"),qe(e,"max-height",t[13]+"px"),m(i,"class",f=t[8].length<(t[10].subscribed_until?$n[1].stash:$n[0].stash)?"textgreen":"textred"),m(s,"class","navbtn panel-black border black gold svelte-rsg9c3"),qe(s,"margin-right","auto"),m(u,"class","navbtn panel-black border black gold svelte-rsg9c3"),m(v,"class","svgicon"),at(v.src,_="/data/ui/icons/deposit.svg?v=8593107")||m(v,"src",_),m(g,"class",b="navbtn btn grey gold "+(t[0]===1?"active":"")+" svelte-rsg9c3"),m(k,"class","svgicon"),at(k.src,S="/data/ui/icons/withdraw.svg?v=8593107")||m(k,"src",S),m(y,"class",A="navbtn btn grey gold "+(t[0]===2?"active":"")+" svelte-rsg9c3"),m(n,"class","formelements svelte-rsg9c3")},m(N,O){E&&E.m(N,O),w(N,e,O);for(let se=0;se<z.length;se+=1)z[se]&&z[se].m(e,null);t[28](e),w(N,n,O),d(n,s),d(s,i),d(i,r),d(i,l),d(i,c),j&&j.m(i,null),d(n,u),ee(p,u,null),d(n,g),d(g,v),d(n,y),d(y,k),W&&W.m(N,O),w(N,F,O),M=!0,D||(L=[X(e,"pointerup",t[18]),X(g,"click",t[30]),X(y,"click",t[31])],D=!0)},p(N,O){if(N[11]?E?E.p(N,O):(E=B6(N),E.c(),E.m(e.parentNode,e)):E&&(E.d(1),E=null),O[0]&1627128){R=me(N[14]<1?[{stores:N[8],name:""}]:[{stores:N[5],name:I.player.name},{stores:N[7],name:"Account Wide"},{stores:N[6],name:"Other characters"}]);let re;for(re=0;re<R.length;re+=1){let ie=q6(N,R,re);z[re]?(z[re].p(ie,O),P(z[re],1)):(z[re]=$6(ie),z[re].c(),P(z[re],1),z[re].m(e,null))}for(Ee(),re=R.length;re<z.length;re+=1)q(re);De()}(!M||O[0]&8192)&&qe(e,"max-height",N[13]+"px"),(!M||O[0]&256)&&o!==(o=N[8].length+"")&&G(r,o),(!M||O[0]&1024)&&a!==(a=(N[10].subscribed_until?$n[1].stash:$n[0].stash)+"")&&G(c,a),N[10].subscribed_until?j&&(j.d(1),j=null):j?j.p(N,O):(j=N6(N),j.c(),j.m(i,null)),(!M||O[0]&1280&&f!==(f=N[8].length<(N[10].subscribed_until?$n[1].stash:$n[0].stash)?"textgreen":"textred"))&&m(i,"class",f);let se={};O[0]&4&&(se.amount=N[2].gold),p.$set(se),(!M||O[0]&1&&b!==(b="navbtn btn grey gold "+(N[0]===1?"active":"")+" svelte-rsg9c3"))&&m(g,"class",b),(!M||O[0]&1&&A!==(A="navbtn btn grey gold "+(N[0]===2?"active":"")+" svelte-rsg9c3"))&&m(y,"class",A),N[0]>0?W?(W.p(N,O),O[0]&1&&P(W,1)):(W=j6(N),W.c(),P(W,1),W.m(F.parentNode,F)):W&&(Ee(),V(W,1,1,()=>{W=null}),De())},i(N){if(!M){for(let O=0;O<R.length;O+=1)P(z[O]);P(p.$$.fragment,N),P(W),M=!0}},o(N){z=z.filter(Boolean);for(let O=0;O<z.length;O+=1)V(z[O]);V(p.$$.fragment,N),V(W),M=!1},d(N){N&&(x(e),x(n),x(F)),E&&E.d(N),st(z,N),t[28](null),j&&j.d(),te(p),W&&W.d(N),D=!1,lt(L)}}}function jI(t){let e,n,s=t[2]&&t[10]&&z6(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,o){i[2]&&i[10]?s?(s.p(i,o),o[0]&1028&&P(s,1)):(s=z6(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function WI(t,e,n){let s,i,o,r,l,a,c,f,u,p,g;oe(t,Vs,de=>n(2,s=de)),oe(t,Hs,de=>n(23,i=de)),oe(t,En,de=>n(37,o=de)),oe(t,mp,de=>n(24,r=de)),oe(t,ra,de=>n(10,l=de)),oe(t,Zc,de=>n(11,a=de)),oe(t,jo,de=>n(12,c=de)),oe(t,Wo,de=>n(13,f=de)),oe(t,ma,de=>n(14,u=de)),oe(t,Ls,de=>n(16,g=de));let v=nt.shift.store;oe(t,v,de=>n(15,p=de));let _,b,y={},k=[],S=[],A=[],F=[],M=!1,D,L=async()=>{if(n(4,b=Date.now()),r.all.length){let Re=await(await fetch("/api/item/get",{method:"POST",body:JSON.stringify({stash:1,ids:r.all.map(Ge=>Ge.dbid)})})).json();if(Re.fail)console.error(Re);else{n(8,F.length=n(5,k.length=n(6,S.length=0,S),k),F),n(7,A.length=0,A);let Ge=new Map(r.all.map(Ye=>[Ye.dbid,Ye])),Xe=new Map(Re.map(Ye=>[Ye.id,Ye]));r.all.forEach(Ye=>{let pe=Xe.get(Ye.dbid);pe&&(pe.store=y[pe.id]||(y[pe.id]=K()),r.other.find(ae=>ae.dbid===pe.id)?S.push(pe.store):r.self.find(ae=>ae.dbid===pe.id)?k.push(pe.store):A.push(pe.store),F.push(pe.store),Ge.has(pe.id)&&(Ge.get(pe.id).hydrate(pe),pe.store.temp=Ge.get(pe.id)))})}}else n(8,F.length=n(5,k.length=n(6,S.length=0,S),k),F),n(7,A.length=0,A);se()},E=de=>{o&&(xt("itemstash",`${o.meta.slot}`),tt(En,o=void 0,o))},R=de=>de<b?void 0:`${Math.ceil((de-b)/6e4)}m`,z=de=>{M&&(de.detail.item.getStashTime()>Date.now()?Wt("system",C.ui.stash.waitunstash):(xt("itemunstash",de.detail.item.dbid+""),O()))},q=de=>{M&&(xt("goldstash",W===1?N+"":-N+""),O())},j=()=>{n(1,N=W===1?i:s.gold)},W=2,N=0,O=()=>{n(9,M=!1),D=setTimeout(()=>{n(9,M=!0)},500)},se=()=>{n(9,M=!0),D&&(clearTimeout(D),D=void 0)};function re(){c=$t(this.value),jo.set(c)}function ie(){f=$t(this.value),Wo.set(f)}let ce=de=>tt(ma,u=tt(ma,++u,u)%3,u);function ke(de){Nt[de?"unshift":"push"](()=>{_=de,n(3,_)})}let ge=de=>tt(Ls,g=!0,g),Ne=de=>n(0,W=1),Te=de=>n(0,W=2);function Ce(){N=$t(this.value),n(1,N),n(2,s),n(0,W),n(23,i)}let _e=()=>{tt(Zc,a=!a,a)},H=de=>tt(Vs,s=!1,s);return t.$$.update=()=>{t.$$.dirty[0]&16777216&&L(),t.$$.dirty[0]&8388615&&n(1,N=s?Math.min(W===1?i:s.gold,N):0)},[W,N,s,_,b,k,S,A,F,M,l,a,c,f,u,p,g,v,E,R,z,q,j,i,r,re,ie,ce,ke,ge,Ne,Te,Ce,_e,H]}var Ug=class extends Fe{constructor(e){super(),Se(this,e,WI,jI,Oe,{},null,[-1,-1])}},W6=Ug;function GI(t,e,n){let s=t.slice();return s[7]=e[n],s[9]=n,s}function G6(t,e,n){let s=t.slice();return s[10]=e[n],s}function H6(t){let e,n;return e=new jt({props:{origin:"center",title:C.npcs.trader.name,icon:"bag",$$slots:{default:[JI]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&8195&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function Y6(t){let e,n;return e=new bs({props:{id:"trader"+t[10][0].buyid,descPos:"left:100%;top:0;",descRoot:t[0],isTrader:!0,pickable:!1,item:t[10][1]}}),e.$on("click",t[4]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&1&&(o.descRoot=s[0]),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function HI(t){let e,n;return e=new bs({props:{isTrader:!0}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p:ue,i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function YI(t){let e;return{c(){e=h("span"),e.textContent=`${C.npcs.trader.select}`,m(e,"class","textgrey")},m(n,s){w(n,e,s)},p:ue,i:ue,o:ue,d(n){n&&x(e)}}}function XI(t){let e,n,s,i,o,r=[ZI,QI],l=[];function a(c,f){return f&2&&(e=null),e==null&&(e=!!c[1].data.canBeSold()),e?0:1}return n=a(t,-1),s=l[n]=r[n](t),{c(){s.c(),i=be()},m(c,f){l[n].m(c,f),w(c,i,f),o=!0},p(c,f){let u=n;n=a(c,f),n===u?l[n].p(c,f):(Ee(),V(l[u],1,1,()=>{l[u]=null}),De(),s=l[n],s?s.p(c,f):(s=l[n]=r[n](c),s.c()),P(s,1),s.m(i.parentNode,i))},i(c){o||(P(s),o=!0)},o(c){V(s),o=!1},d(c){c&&x(i),l[n].d(c)}}}function QI(t){let e;return{c(){e=h("span"),e.textContent=`${C.npcs.trader.refuse}`,m(e,"class","textred")},m(n,s){w(n,e,s)},p:ue,i:ue,o:ue,d(n){n&&x(e)}}}function ZI(t){let e,n;return e=new kn({props:{amount:t[1].data.goldValue()}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&2&&(o.amount=s[1].data.goldValue()),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function JI(t){let e,n,s,i,o,r,l,a,c,f,u,p,g,v=me(I.player.getTargetEntity().items),_=[];for(let M=0;M<v.length;M+=1)_[M]=Y6(G6(t,v,M));let b=M=>V(_[M],1,1,()=>{_[M]=null}),y=me(Array(24-I.player.getTargetEntity().items.length)),k=[];for(let M=0;M<y.length;M+=1)k[M]=HI(GI(t,y,M));let S=[XI,YI],A=[];function F(M,D){return M[1]&&M[1].meta.type==="item"?0:1}return c=F(t,-1),f=A[c]=S[c](t),{c(){e=h("div"),n=h("p"),n.textContent=`${C.npcs.trader.buy}`,s=h("div");for(let M=0;M<_.length;M+=1)_[M].c();i=be();for(let M=0;M<k.length;M+=1)k[M].c();o=h("div"),r=h("p"),r.textContent=`${C.npcs.trader.info}`,l=h("p"),l.textContent=`${C.npcs.trader.price}`,a=h("span"),f.c(),m(n,"class","textprimary textcenter"),m(s,"class","panel-black slotcontainer svelte-12uytpc"),m(r,"class","textprimary"),m(a,"class","panel-black formatted info svelte-12uytpc"),m(o,"class","textcenter"),m(e,"class","container svelte-12uytpc")},m(M,D){w(M,e,D),d(e,n),d(e,s);for(let L=0;L<_.length;L+=1)_[L]&&_[L].m(s,null);d(s,i);for(let L=0;L<k.length;L+=1)k[L]&&k[L].m(s,null);d(e,o),d(o,r),d(o,l),d(o,a),A[c].m(a,null),t[5](e),u=!0,p||(g=X(e,"pointerup",t[3]),p=!0)},p(M,D){if(D&17){v=me(I.player.getTargetEntity().items);let E;for(E=0;E<v.length;E+=1){let R=G6(M,v,E);_[E]?(_[E].p(R,D),P(_[E],1)):(_[E]=Y6(R),_[E].c(),P(_[E],1),_[E].m(s,i))}for(Ee(),E=v.length;E<_.length;E+=1)b(E);De()}let L=c;c=F(M,D),c===L?A[c].p(M,D):(Ee(),V(A[L],1,1,()=>{A[L]=null}),De(),f=A[c],f?f.p(M,D):(f=A[c]=S[c](M),f.c()),P(f,1),f.m(a,null))},i(M){if(!u){for(let D=0;D<v.length;D+=1)P(_[D]);for(let D=0;D<y.length;D+=1)P(k[D]);P(f),u=!0}},o(M){_=_.filter(Boolean);for(let D=0;D<_.length;D+=1)V(_[D]);k=k.filter(Boolean);for(let D=0;D<k.length;D+=1)V(k[D]);V(f),u=!1},d(M){M&&x(e),st(_,M),st(k,M),A[c].d(),t[5](null),p=!1,g()}}}function KI(t){let e,n,s=t[2]&&H6(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[2]?s?(s.p(i,o),o&4&&P(s,1)):(s=H6(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function eV(t,e,n){let s,i;oe(t,En,f=>n(1,s=f)),oe(t,Ys,f=>n(2,i=f));let o=f=>{s&&s.meta&&s.meta.type==="item"&&s.data.canBeSold()&&$f(s.data.quality,s.data.upgrade,s.meta.slot,s.data.type,s.data.tier),tt(En,s=void 0,s)},r=f=>{xt("itemtraderbuy",`${f.detail.item.buyid}`)},l;function a(f){Nt[f?"unshift":"push"](()=>{l=f,n(0,l)})}return[l,s,i,o,r,a,f=>tt(Ys,i=!1,i)]}var Og=class extends Fe{constructor(e){super(),Se(this,e,eV,KI,Oe,{})}},X6=Og;function Q6(t,e,n){let s=t.slice();return s[13]=e[n],s[15]=n,s}function Z6(t,e,n){let s=t.slice();return s[16]=e[n],s[15]=n,s}function J6(t,e,n){let s=t.slice();return s[18]=e[n],s}function K6(t){let e,n,s,i=t[16].classcount[t[18]]+"",o,r;return{c(){e=h("div"),n=h("div"),n.innerHTML=`<img class="texticon" src="${Qi(t[18])}"/>`,s=h("b"),o=T(i),m(s,"class",r=t[16].classcount[t[18]]>0?"textprimary":"textgrey")},m(l,a){w(l,e,a),d(e,n),d(e,s),d(s,o)},p(l,a){a&4&&i!==(i=l[16].classcount[l[18]]+"")&&G(o,i),a&4&&r!==(r=l[16].classcount[l[18]]>0?"textprimary":"textgrey")&&m(s,"class",r)},d(l){l&&x(e)}}}function eF(t){let e,n,s,i=t[16].message+"",o,r,l=t[4][t[16].activity]+"",a,c,f,u,p,g=t[16].minlevel+"",v,_,b=t[16].maxlevel+"",y,k,S,A,F,M,D;k=new zs({props:{name:t[16].leadername,level:t[16].leaderlevel,pclass:t[16].leaderclass,faction:t[16].faction}});let L=me([0,1,2,3]),E=[];for(let q=0;q<4;q+=1)E[q]=K6(J6(t,L,q));function R(...q){return t[10](t[16],...q)}function z(...q){return t[11](t[16],...q)}return{c(){e=h("div"),n=h("div"),s=h("div"),o=T(i),r=h("div"),a=T(l),c=h("div"),f=h("div"),u=T("Lv. "),p=h("span"),v=T(g),_=T(" - "),y=T(b),ne(k.$$.fragment),S=h("div");for(let q=0;q<4;q+=1)E[q].c();m(s,"class","textprimary"),m(r,"class","textgrey textsmall"),qe(n,"text-overflow","ellipsis"),qe(n,"white-space","nowrap"),qe(n,"overflow","hidden"),m(p,"class","textgreen"),m(f,"class","textgrey"),m(c,"class","textcenter"),m(S,"class","grid four textcenter"),m(e,"class",A="panel-black listing marg-bot "+(t[1]===t[16]?"selected":t[5][t[16].applied])+" svelte-12t87hd")},m(q,j){w(q,e,j),d(e,n),d(n,s),d(s,o),d(n,r),d(r,a),d(e,c),d(c,f),d(f,u),d(f,p),d(p,v),d(p,_),d(p,y),ee(k,c,null),d(e,S);for(let W=0;W<4;W+=1)E[W]&&E[W].m(S,null);F=!0,M||(D=[X(e,"click",R),X(e,"contextmenu",z)],M=!0)},p(q,j){t=q,(!F||j&4)&&i!==(i=t[16].message+"")&&G(o,i),(!F||j&4)&&l!==(l=t[4][t[16].activity]+"")&&G(a,l),(!F||j&4)&&g!==(g=t[16].minlevel+"")&&G(v,g),(!F||j&4)&&b!==(b=t[16].maxlevel+"")&&G(y,b);let W={};if(j&4&&(W.name=t[16].leadername),j&4&&(W.level=t[16].leaderlevel),j&4&&(W.pclass=t[16].leaderclass),j&4&&(W.faction=t[16].faction),k.$set(W),j&4){L=me([0,1,2,3]);let N;for(N=0;N<4;N+=1){let O=J6(t,L,N);E[N]?E[N].p(O,j):(E[N]=K6(O),E[N].c(),E[N].m(S,null))}for(;N<4;N+=1)E[N].d(1)}(!F||j&6&&A!==(A="panel-black listing marg-bot "+(t[1]===t[16]?"selected":t[5][t[16].applied])+" svelte-12t87hd"))&&m(e,"class",A)},i(q){F||(P(k.$$.fragment,q),F=!0)},o(q){V(k.$$.fragment,q),F=!1},d(q){q&&x(e),te(k),st(E,q),M=!1,lt(D)}}}function tF(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[13]}`,e.__value=n=t[15],We(e,e.__value)},m(s,i){w(s,e,i)},p:ue,d(s){s&&x(e)}}}function tV(t){let e,n,s,i,o,r,l,a,c;return{c(){e=h("div"),n=h("div"),s=T("\u{1F64B} Apply"),o=h("div"),r=T("\u{1F50E} Refresh"),m(n,"class",i="btn textcenter "+(t[1]&&t[1].applied===0?"green":"disabled")),m(o,"class",l="btn textcenter "+(t[0]?"disabled":"cyan")),m(e,"class","panel-black grid two")},m(f,u){w(f,e,u),d(e,n),d(n,s),d(e,o),d(o,r),a||(c=[X(n,"click",t[7]),X(o,"click",t[6])],a=!0)},p(f,u){u&2&&i!==(i="btn textcenter "+(f[1]&&f[1].applied===0?"green":"disabled"))&&m(n,"class",i),u&1&&l!==(l="btn textcenter "+(f[0]?"disabled":"cyan"))&&m(o,"class",l)},d(f){f&&x(e),a=!1,lt(c)}}}function nV(t){let e;return{c(){e=h("div"),e.textContent="You are in a party.",m(e,"class","textcenter panel-black textgrey")},m(n,s){w(n,e,s)},p:ue,d(n){n&&x(e)}}}function sV(t){let e,n,s,i,o,r,l,a,c,f,u,p,g,v,_,b=me(t[2].parties.filter(t[9])),y=[];for(let L=0;L<b.length;L+=1)y[L]=eF(Z6(t,b,L));let k=L=>V(y[L],1,1,()=>{y[L]=null}),S=me(t[4]),A=[];for(let L=0;L<S.length;L+=1)A[L]=tF(Q6(t,S,L));function F(L,E){return L[3].membercount>0?nV:tV}let M=F(t,-1),D=M(t);return{c(){e=h("div"),n=h("div");for(let L=0;L<y.length;L+=1)y[L].c();s=h("div"),i=h("div"),o=h("small"),o.textContent="Filter Party Listings",r=h("div"),l=h("div"),l.textContent="Activity",a=h("select"),c=h("option"),c.textContent="All";for(let L=0;L<A.length;L+=1)A[L].c();u=h("small"),u.textContent="More filters to come!",p=$e(),D.c(),m(n,"class","listcontainer scrollbar border grey svelte-12t87hd"),qe(n,"font-size","0.9em"),m(o,"class","textprimary"),c.__value=f=-1,We(c,c.__value),m(a,"class","btn grey small"),t[2].filterActivity===void 0&&_n(()=>t[12].call(a)),m(u,"class","textgrey"),m(r,"class","grid two search svelte-12t87hd"),m(i,"class","panel-black"),m(s,"class","grid"),qe(s,"grid-template-rows","1fr auto"),m(e,"class","layout svelte-12t87hd")},m(L,E){w(L,e,E),d(e,n);for(let R=0;R<y.length;R+=1)y[R]&&y[R].m(n,null);d(e,s),d(s,i),d(i,o),d(i,r),d(r,l),d(r,a),d(a,c);for(let R=0;R<A.length;R+=1)A[R]&&A[R].m(a,null);wn(a,t[2].filterActivity,!0),d(r,u),d(s,p),D.m(s,null),g=!0,v||(_=X(a,"change",t[12]),v=!0)},p(L,[E]){if(E&310){b=me(L[2].parties.filter(L[9]));let R;for(R=0;R<b.length;R+=1){let z=Z6(L,b,R);y[R]?(y[R].p(z,E),P(y[R],1)):(y[R]=eF(z),y[R].c(),P(y[R],1),y[R].m(n,null))}for(Ee(),R=b.length;R<y.length;R+=1)k(R);De()}if(E&16){S=me(L[4]);let R;for(R=0;R<S.length;R+=1){let z=Q6(L,S,R);A[R]?A[R].p(z,E):(A[R]=tF(z),A[R].c(),A[R].m(a,null))}for(;R<A.length;R+=1)A[R].d(1);A.length=S.length}E&4&&wn(a,L[2].filterActivity),M===(M=F(L,E))&&D?D.p(L,E):(D.d(1),D=M(L),D&&(D.c(),D.m(s,null)))},i(L){if(!g){for(let E=0;E<b.length;E+=1)P(y[E]);g=!0}},o(L){y=y.filter(Boolean);for(let E=0;E<y.length;E+=1)V(y[E]);g=!1},d(L){L&&x(e),st(y,L),st(A,L),D.d(),v=!1,_()}}}function iV(t,e,n){let s,i;oe(t,ip,b=>n(2,s=b)),oe(t,Qn,b=>n(3,i=b));let o=C.ui.party.activities,r=["","applied","denied"],l=!1,a,c=async()=>{n(0,l=!0);let b=await Ot("/api/party/getlistedparties",{},()=>{});tt(ip,s.parties=b,s),a&&n(1,a=b.find(y=>y.party===a.party)),setTimeout(()=>n(0,l=!1),200)};c();let f=()=>{a&&(n(1,a.applied=1,a),Ot("/api/party/makeapplication",{party:a.party,message:""},()=>{}),n(1,a=void 0))},u=(b,y)=>{bn.set({x:b.pageX,y:b.pageY,opts:[{name:y.leadername,css:"disabled"},nn.whisper(y.leadername)]})},p=b=>s.filterActivity===-1||b.activity===s.filterActivity,g=(b,y)=>n(1,a=b),v=(b,y)=>u(y,b);function _(){s.filterActivity=ks(this),ip.set(s)}return[l,a,s,i,o,r,c,f,u,p,g,v,_]}var $g=class extends Fe{constructor(e){super(),Se(this,e,iV,sV,Oe,{})}},nF=$g;var md=async t=>{let e;try{e=await Ot("/api/party/getpartystate",{},()=>{})}catch{e=void 0}e&&Gs.update(n=>{let s=!1;return e.applications.forEach(i=>{n.applications.find(r=>r.player===i.player)||(s=!0)}),n.applications=e.applications,n.message=e.message||n.message||"",n.activity=e.activity||n.activity||0,n.listed=e.listed,n.flashing=s&&!le.partyOpen,n})};function sF(t,e,n){let s=t.slice();return s[14]=e[n],s[16]=n,s}function iF(t,e,n){let s=t.slice();return s[17]=e[n],s[16]=n,s}function oV(t){let e,n,s,i=me(t[1].applications),o=[];for(let l=0;l<i.length;l+=1)o[l]=oF(iF(t,i,l));let r=l=>V(o[l],1,1,()=>{o[l]=null});return{c(){e=h("table"),n=h("tbody");for(let l=0;l<o.length;l+=1)o[l].c();m(e,"class","dense"),qe(e,"width","100%"),qe(e,"table-layout","fixed")},m(l,a){w(l,e,a),d(e,n);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(n,null);s=!0},p(l,a){if(a&226){i=me(l[1].applications);let c;for(c=0;c<i.length;c+=1){let f=iF(l,i,c);o[c]?(o[c].p(f,a),P(o[c],1)):(o[c]=oF(f),o[c].c(),P(o[c],1),o[c].m(n,null))}for(Ee(),c=i.length;c<o.length;c+=1)r(c);De()}},i(l){if(!s){for(let a=0;a<i.length;a+=1)P(o[a]);s=!0}},o(l){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)V(o[a]);s=!1},d(l){l&&x(e),st(o,l)}}}function rV(t){let e;function n(o,r){return o[1].listed?aV:lV}let s=n(t,-1),i=s(t);return{c(){e=h("p"),i.c(),m(e,"class","textcenter textgrey")},m(o,r){w(o,e,r),i.m(e,null)},p(o,r){s!==(s=n(o,r))&&(i.d(1),i=s(o),i&&(i.c(),i.m(e,null)))},i:ue,o:ue,d(o){o&&x(e),i.d()}}}function oF(t){let e,n,s,i,o=t[17].gearscore+"",r,l,a,c,f,u,p,g,v,_,b;s=new zs({props:{name:t[17].name,level:t[17].level,pclass:t[17].class,faction:t[17].faction}});function y(...A){return t[8](t[17],...A)}function k(...A){return t[9](t[17],...A)}function S(...A){return t[10](t[17],...A)}return{c(){e=h("tr"),n=h("td"),ne(s.$$.fragment),i=h("td"),r=T(o),l=T(" GS"),a=h("td"),c=T("\u{1F91D}"),u=h("td"),p=T("\u274C"),m(n,"width","50%"),m(i,"width","20%"),m(i,"class","textcenter textcyan"),m(a,"width","15%"),m(a,"class",f="textcenter accept "+(t[17].invited?"active":"")+" svelte-6mz3cb"),m(u,"width","15%"),m(u,"class",g="textcenter deny "+(t[17].denied?"active":"")+" svelte-6mz3cb"),m(e,"class","striped"),qe(e,"cursor","unset")},m(A,F){w(A,e,F),d(e,n),ee(s,n,null),d(e,i),d(i,r),d(i,l),d(e,a),d(a,c),d(e,u),d(u,p),v=!0,_||(b=[X(a,"click",y),X(u,"click",k),X(e,"contextmenu",S)],_=!0)},p(A,F){t=A;let M={};F&2&&(M.name=t[17].name),F&2&&(M.level=t[17].level),F&2&&(M.pclass=t[17].class),F&2&&(M.faction=t[17].faction),s.$set(M),(!v||F&2)&&o!==(o=t[17].gearscore+"")&&G(r,o),(!v||F&2&&f!==(f="textcenter accept "+(t[17].invited?"active":"")+" svelte-6mz3cb"))&&m(a,"class",f),(!v||F&2&&g!==(g="textcenter deny "+(t[17].denied?"active":"")+" svelte-6mz3cb"))&&m(u,"class",g)},i(A){v||(P(s.$$.fragment,A),v=!0)},o(A){V(s.$$.fragment,A),v=!1},d(A){A&&x(e),te(s),_=!1,lt(b)}}}function lV(t){let e;return{c(){e=T("List your party to search for players")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function aV(t){let e;return{c(){e=T("Waiting for players...")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function rF(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[14]}`,e.__value=n=t[16],We(e,e.__value)},m(s,i){w(s,e,i)},p:ue,d(s){s&&x(e)}}}function cV(t){let e,n,s,i,o,r,l,a,c,f,u,p,g,v,_,b,y,k=t[1].listed?"\u{1F441}\uFE0F Unlist":"List",S,A,F,M,D,L,E=[rV,oV],R=[];function z(W,N){return W[1].applications.length===0?0:1}s=z(t,-1),i=R[s]=E[s](t);let q=me(t[3]),j=[];for(let W=0;W<q.length;W+=1)j[W]=rF(sF(t,q,W));return{c(){e=h("div"),n=h("div"),i.c(),o=h("div"),r=h("div"),l=h("div"),a=h("small"),a.textContent="Describe your party",c=h("input"),p=h("div"),g=h("small"),g.textContent="Select an activity",v=h("select");for(let W=0;W<j.length;W+=1)j[W].c();b=h("div"),y=h("div"),S=T(k),A=T(" Party"),m(n,"class","listcontainer scrollbar border grey svelte-6mz3cb"),m(a,"class","textprimary"),m(c,"maxlength",f=40),m(c,"class",u="marg-top "+(t[2].role<2||t[1].listed?"disabled":"")),m(c,"type","text"),m(c,"placeholder","Enter Party Message"),m(l,"class","panel-bright"),m(g,"class","textprimary"),m(v,"class",_="btn grey marg-top "+(t[2].role<2||t[1].listed?"disabled":"")),t[1].activity===void 0&&_n(()=>t[12].call(v)),m(p,"class","panel-bright marg-top"),m(r,"class","panel-black "),m(y,"class",F="btn purp textcenter "+(t[2].role<2||t[0]?"disabled":t[1].listed?"active":"")),m(b,"class","panel-black"),m(o,"class","grid"),qe(o,"grid-template-rows","1fr auto"),m(e,"class","layout svelte-6mz3cb")},m(W,N){w(W,e,N),d(e,n),R[s].m(n,null),d(e,o),d(o,r),d(r,l),d(l,a),d(l,c),We(c,t[1].message),d(r,p),d(p,g),d(p,v);for(let O=0;O<j.length;O+=1)j[O]&&j[O].m(v,null);wn(v,t[1].activity,!0),d(o,b),d(b,y),d(y,S),d(y,A),M=!0,D||(L=[X(c,"input",t[11]),X(v,"change",t[12]),X(y,"click",t[4])],D=!0)},p(W,[N]){let O=s;if(s=z(W,N),s===O?R[s].p(W,N):(Ee(),V(R[O],1,1,()=>{R[O]=null}),De(),i=R[s],i?i.p(W,N):(i=R[s]=E[s](W),i.c()),P(i,1),i.m(n,null)),(!M||N&6&&u!==(u="marg-top "+(W[2].role<2||W[1].listed?"disabled":"")))&&m(c,"class",u),N&2&&c.value!==W[1].message&&We(c,W[1].message),N&8){q=me(W[3]);let se;for(se=0;se<q.length;se+=1){let re=sF(W,q,se);j[se]?j[se].p(re,N):(j[se]=rF(re),j[se].c(),j[se].m(v,null))}for(;se<j.length;se+=1)j[se].d(1);j.length=q.length}(!M||N&6&&_!==(_="btn grey marg-top "+(W[2].role<2||W[1].listed?"disabled":"")))&&m(v,"class",_),N&2&&wn(v,W[1].activity),(!M||N&2)&&k!==(k=W[1].listed?"\u{1F441}\uFE0F Unlist":"List")&&G(S,k),(!M||N&7&&F!==(F="btn purp textcenter "+(W[2].role<2||W[0]?"disabled":W[1].listed?"active":"")))&&m(y,"class",F)},i(W){M||(P(i),M=!0)},o(W){V(i),M=!1},d(W){W&&x(e),R[s].d(),st(j,W),D=!1,lt(L)}}}function fV(t,e,n){let s,i;oe(t,Gs,y=>n(1,s=y)),oe(t,Qn,y=>n(2,i=y));let o=C.ui.party.activities,r,l=!1;md();let a=async()=>{n(0,l=!0),s.listed?(tt(Gs,s.listed=!1,s),await Ot("/api/party/unlistparty",{},()=>{})):(tt(Gs,s.listed=!0,s),await Ot("/api/party/listparty",{message:s.message,activity:s.activity},()=>{})),n(0,l=!1)},c=y=>{xt("partyinvite",y.name),y.invited=!0,y.denied=!1,Gs.set(s)},f=y=>{y.denied=!0,y.invited=!1,tt(Gs,s.applications=s.applications.filter(k=>k.player!==y.player),s),Ot("/api/party/denyapplication",{player:y.player},()=>{})},u=(y,k)=>{bn.set({x:y.pageX,y:y.pageY,opts:[{name:k.name,css:"disabled"},nn.whisper(k.name)]})},p=(y,k)=>{c(y)},g=(y,k)=>{f(y)},v=(y,k)=>u(k,y);function _(){s.message=this.value,Gs.set(s)}function b(){s.activity=ks(this),Gs.set(s)}return[l,s,i,o,a,c,f,u,p,g,v,_,b]}var Ng=class extends Fe{constructor(e){super(),Se(this,e,fV,cV,Oe,{})}},lF=Ng;function aF(t){let e,n;return e=new jt({props:{origin:"center",title:"\u{1F465} Party",$$slots:{default:[mV]},$$scope:{ctx:t}}}),e.$on("close",t[3]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&67&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function uV(t){let e,n;return e=new lF({}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function pV(t){let e,n;return e=new nF({}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function mV(t){let e,n,s,i,o,r,l,a,c,f,u,p=[pV,uV],g=[];function v(_,b){return _[1]===0||_[0].membercount===0?0:1}return l=v(t,-1),a=g[l]=p[l](t),{c(){e=h("div"),n=h("div"),s=h("div"),s.textContent="Party List",i=h("div"),o=T("Your Party"),a.c(),m(s,"class","tab"),Do(s,"active",t[1]===0),m(i,"class",r="tab "+(t[0].membercount===0?"disabled":"")),Do(i,"active",t[1]===1),m(n,"class","tab-bar flex"),m(e,"class","container svelte-6dw5x1")},m(_,b){w(_,e,b),d(e,n),d(n,s),d(n,i),d(i,o),g[l].m(e,null),c=!0,f||(u=[X(s,"click",t[4]),X(i,"click",t[5])],f=!0)},p(_,b){(!c||b&2)&&Do(s,"active",_[1]===0),(!c||b&1&&r!==(r="tab "+(_[0].membercount===0?"disabled":"")))&&m(i,"class",r),(!c||b&3)&&Do(i,"active",_[1]===1);let y=l;l=v(_,b),l!==y&&(Ee(),V(g[y],1,1,()=>{g[y]=null}),De(),a=g[l],a||(a=g[l]=p[l](_),a.c()),P(a,1),a.m(e,null))},i(_){c||(P(a),c=!0)},o(_){V(a),c=!1},d(_){_&&x(e),g[l].d(),f=!1,lt(u)}}}function dV(t){let e,n,s=t[2]&&aF(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[2]?s?(s.p(i,o),o&4&&P(s,1)):(s=aF(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function hV(t,e,n){let s,i;oe(t,Zs,c=>n(2,s=c)),oe(t,Qn,c=>n(0,i=c));let o=0,r=c=>tt(Zs,s=!1,s),l=()=>{n(1,o=0)},a=()=>{n(1,o=1)};return t.$$.update=()=>{t.$$.dirty&1&&i.membercount===0&&n(1,o=0)},[i,o,s,r,l,a]}var jg=class extends Fe{constructor(e){super(),Se(this,e,hV,dV,Oe,{})}},cF=jg;var dd=t=>t.type==="pet"&&t.upgrade>=1?!1:t.stacks===void 0&&t.rolls.length>0&&!Sn[t.type].noupgrade,fF=t=>t<101,hd=t=>{if(!dd(t)||t.type==="pet")return 0;let e=rn[t.type+t.tier];return Math.ceil(((1+e.level*(1+t.upgrade))/Sn[t.type].drop)**(1.2+t.upgrade*.2))+100},uF=t=>{if(dd(t)){let e=[];if(t.type==="pet")e.push({type:"box",tier:2});else for(let n=0;n<Math.max(1,t.upgrade);++n)e.push({type:"rune",tier:n,stacks:Math.max(1,Math.min(2,t.upgrade-n))});return e}else return[]};var pF=(t,e,n,s)=>Math.ceil(t.goldValue||(.4*(t.level**1.3+e*.4))**(1.1+e/100)/Sn[t.type].drop)*(n||1)*(s?8:1);var gd=class{constructor(e){this.dbid=e,this.stats=new Map,this.dirty=!0}hydrate(e){if(this.dirty=!1,this.bound=e.bound,this.type=e.type,this.tier=e.tier,this.logic=rn[this.type+this.tier],this.auction=e.auction?new Date(e.auction):void 0,this.auctionprice=e.auctionprice,this.owner=e.name,this.stash=e.stash?new Date(e.stash):void 0,this.logic===void 0)throw"Unknown item "+e.type+e.tier;if(this.upgrade=e.upgrade,this.stats.clear(),e.rolls){if(this.setRolls(e.rolls),this.quality=this.nextRoll(),this.logic.stats){this.logic.stats.forEach((s,i)=>{this.stats.set(i,{type:"base",qual:this.quality,value:Math.floor(s.min+(s.max-s.min)*(this.quality/100)**2+Of[i]*this.upgrade)})});let n=Math.min(4,Math.round((this.quality/100)**1.5*3.6));for(let s=0;s<n;++s){let i=this.nextRoll(),o=-1;for(;o===-1||this.stats.has(o);)o=parseInt(b1(Wk,i/101)),i=(i+5)%100;let r=(this.nextRoll()+this.quality)/2;this.stats.set(o,{type:"bonus",qual:r,value:Math.ceil(Math.max((Uf[o].min+(Uf[o].max-Uf[o].min)*(r/100)**2)*this.logic.level*Sn[this.type].weight,Of[o])+Of[o]*this.upgrade)})}}this.quality=this.logic.quality||this.quality,this.stacks=void 0}else this.stacks=e.stacks,this.quality=this.logic.quality||0;this.gs=0,this.logic.gs?this.gs=this.logic.gs:this.stats.forEach((n,s)=>{if(s===17)return;let i=n.value/Of[s];this.type=="shield"&&n.type=="base"&&(i*=.5),this.type=="orb"&&n.type=="base"&&(i*=.7),this.gs+=i}),this.gs=Math.round(this.gs)}setRolls(e){this.rolls=e,this.currentRoll=0}nextRoll(){if(this.currentRoll==this.rolls.length)throw"roll maximum reached";return this.rolls[this.currentRoll++]}goldValue(e){if(!this.canBeSold())throw"Item cant have value because it cant be sold";return pF(this.logic,this.quality,this.stacks,e)}storeValue(){return this.logic.storeValue||0}medalValue(){return this.logic.medalValue||0}canEquip(e){return l6(e.level,e.skills.skillIdsActive,e.skills.skillIdsLearned,e.class,this.type,this.tier)}canEquipClass(e){return Qa(e.class,this.type,this.tier)}equipReasons(e){let n=[];return this.logic.level&&n.push(["Lv. "+this.logic.level,!0]),n}canBeDropped(){return!Sn[this.type].undroppable&&!this.bound}canBeTraded(){return!this.bound}canBeSold(){return!this.logic.unsellable}getStashTime(){return this.dirty?0:this.stash!==void 0?this.stash.getTime():0}getEquipSlot(){return Sn[this.type].slot!==void 0?Sn[this.type].slot[0]:void 0}};var Hg={};Xn(Hg,{addExp:()=>Gg,addGold:()=>_d,init:()=>su,onWorldEnter:()=>gV,tick:()=>vV,values:()=>yi});var yi=new Map,Wg=new kt(0,1),vd=0,su=()=>{yi.set("exp",0),yi.set("gold",0),Wg.reset(0),vd=0},gV=su,vV=t=>{Wg.done(I.time)&&(++vd,Wg.reset(I.time),dp.set({gold:yi.get("gold"),gph:yi.get("gold")/vd*60*60}),hp.set({exp:yi.get("exp"),exph:yi.get("exp")/vd*60*60}))},Gg=t=>{yi.set("exp",(yi.get("exp")||0)+t)},_d=t=>{yi.set("gold",(yi.get("gold")||0)+t)};var mF=(t,e,n)=>{if(t&&t.type)switch(e){case 13:t.rolls&&t.quality>=70&&Mt(t.quality<90?98:99);case 1:le.chat[7]&&Wt("inv",C.ui.inventory.pick.replace("$1",hn(t.type,t.tier)),!0),tn(10,100),Mt(Rs[t.type].sound),Ps[12].element="bag"+n,t.type=="book"&&tn(23,100)&&(Ps[24].element="bag"+n);break;case 10:t.rolls&&Uo.update(s=>(oa.set(t.upgrade-s.upgrade),t));break}},dF=(t,e)=>{if(t&&t.type)switch(e){case 7:le.chat[8]&&Wt("inv",C.ui.stash.stashed.replace("$1",hn(t.type,t.tier))),Mt(Rs[t.type].sound);break;case 6:ci.set(),Pr.update(n=>!n),le.chat[8]&&Wt("inv",C.ui.merchant.auctionpost.replace("$1",hn(t.type,t.tier)));break;case 9:le.chat[8]&&Wt("inv",C.ui.inventory.sold.replace("$1",hn(t.type,t.tier))),Mt(Rs[t.type].sound);break;case 2:le.chat[7]&&Wt("inv",C.ui.inventory.throw.replace("$1",hn(t.type,t.tier))),Mt(Rs[t.type].sound);break}},iu=(t,e,n,s)=>{n!=0&&Mt(Rs.gold.sound);let i=s+e;switch(n){case 1:le.chat[9]&&Wt("inv",C.ui.inventory.pick.replace("$1",i),!0),_d(e);break;case 4:Pr.update(o=>!o),le.chat[10]&&Wt("inv",C.ui.merchant.auctionbuy.replace("$1",i),!0);break;case 12:case 3:le.chat[10]&&Wt("inv",C.ui.inventory.spend.replace("$1",i),!0);break;case 11:le.chat[10]&&Wt("inv",C.ui.inventory.death.replace("$1",i),!0);break;case 9:le.chat[10]&&Wt("inv",C.ui.inventory.receive.replace("$1",i),!0),_d(e);break}};var ki=class extends gd{constructor(e){super(e)}hydrate(e){super.hydrate(e),e.store?e.store.set(this):console.error("no store for item",e),mF(this,this.reason,e.slot)}equipReasons(e){let n=[];if(this.logic.class!==void 0&&n.push(["Class: "+C.classes[this.logic.class].name,Qa(e.class,this.type,this.tier)]),this.logic.level&&n.push(["Requires Lv. "+this.logic.level,Ig(e.level,this.type,this.tier)]),this.logic.requiredSkill&&n.push(["Must know: "+C.items.book[this.logic.requiredSkill].name,qg(e.skills.skillIdsActive,this.type,this.tier)]),Qa(e.class,this.type,this.tier)&&this.type=="book"){let s=Lg(e.skills.skillIdsLearned,this.type,this.tier),i=nu(e.skills.skillIdsLearned,this.logic.skillid);n.push([s?"Use book to learn skill":i>=this.logic.skilllevel?"You already know this skill":`Must learn book Lv. ${this.logic.skilllevel} first`,s])}return n}buyReasons(e){let n=[];return this.logic.buyElo!==void 0&&n.push([`Min. Rating: ${Nf(this.logic.buyElo)}`,a6(e.elo,this.type,this.tier)]),n}getBestEquipslot(e){let n=Sn[this.type].slot;return n===void 0?void 0:n.find(i=>e.slots.get(i)===void 0)||n[0]}};function hF(t,e,n){let s=t.slice();return s[18]=e[n],s}function gF(t){let e,n;return e=new jt({props:{origin:"center",title:"Blacksmith",icon:"bag",$$slots:{default:[_V]},$$scope:{ctx:t}}}),e.$on("close",t[13]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&2097661&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function vF(t){let e;return{c(){e=h("div")},m(n,s){w(n,e,s)},p:ue,d(n){n&&x(e)}}}function _F(t){let e,n;return e=new bs({props:{pickable:!1,item:t[18],filter:t[18].filter}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&8&&(o.item=s[18]),i&8&&(o.filter=s[18].filter),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function _V(t){let e,n,s,i=(t[7]||"Place an item into the upgrade slot")+"",o,r,l,a,c,f,u,p,g,v,_,b,y,k,S,A;a=new bs({props:{clearOnMove:!0,invslot:t[0]?t[2]:void 0,pickable:!0,item:Uo,filter:t[5]?!0:""}}),a.$on("discard",t[10]),a.$on("move",t[9]);let F=me(t[3]),M=[];for(let E=0;E<F.length;E+=1)M[E]=_F(hF(t,F,E));let D=E=>V(M[E],1,1,()=>{M[E]=null}),L=null;return F.length||(L=vF(t)),v=new kn({props:{isPrice:!0,amount:t[0]?hd(t[0]):0}}),{c(){e=h("div"),n=h("h3"),n.textContent="Upgrade Item",s=h("span"),o=T(i),l=h("div"),ne(a.$$.fragment),f=h("div"),u=h("span"),u.textContent="Cost:",p=h("div");for(let E=0;E<M.length;E+=1)M[E].c();L&&L.c(),g=h("div"),ne(v.$$.fragment),_=h("div"),b=T("Upgrade"),m(n,"class","textwhite"),m(s,"class",r="panel-black upgradetext "+t[8]+" svelte-1u9u6qj"),m(l,"class",c="upgradeslot "+t[6]+" svelte-1u9u6qj"),m(p,"class","panel-black costgrid svelte-1u9u6qj"),qe(p,"grid-template-columns","repeat("+Math.min(3,t[3].length||1)+", 30px)"),m(_,"class",y="btn primary formatted textcenter upgradebutton "+(t[4]?"":"disabled")+" svelte-1u9u6qj"),m(f,"class","upgrade svelte-1u9u6qj"),m(e,"class","container textcenter svelte-1u9u6qj")},m(E,R){w(E,e,R),d(e,n),d(e,s),d(s,o),d(e,l),ee(a,l,null),d(e,f),d(f,u),d(f,p);for(let z=0;z<M.length;z+=1)M[z]&&M[z].m(p,null);L&&L.m(p,null),d(f,g),ee(v,g,null),d(f,_),d(_,b),k=!0,S||(A=X(_,"click",t[11]),S=!0)},p(E,R){(!k||R&128)&&i!==(i=(E[7]||"Place an item into the upgrade slot")+"")&&G(o,i),(!k||R&256&&r!==(r="panel-black upgradetext "+E[8]+" svelte-1u9u6qj"))&&m(s,"class",r);let z={};if(R&5&&(z.invslot=E[0]?E[2]:void 0),R&32&&(z.filter=E[5]?!0:""),a.$set(z),(!k||R&64&&c!==(c="upgradeslot "+E[6]+" svelte-1u9u6qj"))&&m(l,"class",c),R&8){F=me(E[3]);let j;for(j=0;j<F.length;j+=1){let W=hF(E,F,j);M[j]?(M[j].p(W,R),P(M[j],1)):(M[j]=_F(W),M[j].c(),P(M[j],1),M[j].m(p,null))}for(Ee(),j=F.length;j<M.length;j+=1)D(j);De(),!F.length&&L?L.p(E,R):F.length?L&&(L.d(1),L=null):(L=vF(E),L.c(),L.m(p,null))}(!k||R&8)&&qe(p,"grid-template-columns","repeat("+Math.min(3,E[3].length||1)+", 30px)");let q={};R&1&&(q.amount=E[0]?hd(E[0]):0),v.$set(q),(!k||R&16&&y!==(y="btn primary formatted textcenter upgradebutton "+(E[4]?"":"disabled")+" svelte-1u9u6qj"))&&m(_,"class",y)},i(E){if(!k){P(a.$$.fragment,E);for(let R=0;R<F.length;R+=1)P(M[R]);P(v.$$.fragment,E),k=!0}},o(E){V(a.$$.fragment,E),M=M.filter(Boolean);for(let R=0;R<M.length;R+=1)V(M[R]);V(v.$$.fragment,E),k=!1},d(E){E&&x(e),te(a),st(M,E),L&&L.d(),te(v),S=!1,A()}}}function bV(t){let e,n,s=t[1]&&gF(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[1]?s?(s.p(i,o),o&2&&P(s,1)):(s=gF(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function yV(t,e,n){let s,i,o,r,l;oe(t,oa,F=>n(12,s=F)),oe(t,Uo,F=>n(0,i=F)),oe(t,sa,F=>n(14,o=F)),oe(t,Hs,F=>n(15,r=F)),oe(t,Ni,F=>n(1,l=F));let a=F=>{let{from:M,to:D}=F.detail;M!==D&&M.type=="item"&&(Uo.set(M.item),n(2,f=M.slot))},c=F=>{Uo.set(),n(2,f=void 0)},f,u=[],p=!1,g=!1,v=()=>{let F=dd(i),M=r>=hd(i),D=fF(f);n(4,p=F&&M&&D);let L=uF(i);L.forEach((E,R)=>{let z=u[R]||n(3,u[R]=K(),u),q=new ki;q.hydrate({...E,store:z}),q.stacks!==void 0?z.filter=o[q.type+q.tier]>=q.stacks?"":!0:z.filter=o[q.type+q.tier]>=0?"":!0,z.filter&&n(4,p=!1)}),n(3,u=u.slice(0,L.length)),p||n(7,y="You lack the required materials"),F||n(7,y="This item cannot be upgraded"),M||n(7,y="You do not have enough gold"),D||n(7,y="You must un-equip the item first"),p?(n(8,k="textgreen"),n(7,y="Ready to upgrade")):n(8,k="textred")},_=()=>{i&&p&&!g&&(n(5,g=!0),tt(oa,s=void 0,s),n(7,y="Upgrading..."),n(8,k="textprimary"),Mt(100),setTimeout(()=>xt("itemblacksmithupgrade",`${i.dbid}`),1e3))},b,y,k,S=()=>{Mt(s>0?101:102),n(6,b=s>0?"flash_success":"flash_fail"),n(7,y=(s>0?"Success! ":"Fail! ")+(s<0?"-":"+")+s),n(8,k=s>0?"textgreen":"textred")},A=F=>tt(Ni,l=!1,l);return t.$$.update=()=>{t.$$.dirty&2&&(l||(tt(Uo,i=void 0,i),tt(oa,s=void 0,s))),t.$$.dirty&1&&(n(4,p=!0),i?v():(n(3,u.length=0,u),n(4,p=!1),n(8,k=void 0),n(7,y=void 0)),n(5,g=!1)),t.$$.dirty&4096&&(s!==void 0?S():(n(6,b=""),n(8,k="")))},[i,l,f,u,p,g,b,y,k,a,c,_,s,A]}var Yg=class extends Fe{constructor(e){super(),Se(this,e,yV,bV,Oe,{})}},bF=Yg;function kV(t){let e;return{c(){e=h("span")},m(n,s){w(n,e,s),e.innerHTML=t[0]},p(n,[s]){s&1&&(e.innerHTML=n[0])},i:ue,o:ue,d(n){n&&x(e)}}}function xV(t,e,n){let s,{amount:i}=e;return t.$$set=o=>{"amount"in o&&n(1,i=o.amount)},t.$$.update=()=>{t.$$.dirty&2&&n(0,s=Nf(i))},[s,i]}var Xg=class extends Fe{constructor(e){super(),Se(this,e,xV,kV,Fn,{amount:1})}},bd=Xg;var Qg=Ua({0:{6:2,8:.3},1:{6:4,12:1},2:{14:.5},3:{14:.4,7:.8},4:{16:.3,7:.8},5:{14:.2,18:.3}});var yF=t=>1+t/1e3;function wV(t){let e,n=C.ui.stats.array[t[1]]+"",s,i,o=(t[3]?"+"+ss(t[1],t[0].get(t[2]).get(t[1])):ss(t[1],t[4][t[1]]||0))+"",r,l;return{c(){e=h("span"),s=T(n),i=h("span"),r=T(o),m(i,"class",l="statnumber "+(t[3]?"textgreen":t[0]?"textprimary":"textgreen"))},m(a,c){w(a,e,c),d(e,s),w(a,i,c),d(i,r)},p(a,[c]){c&2&&n!==(n=C.ui.stats.array[a[1]]+"")&&G(s,n),c&31&&o!==(o=(a[3]?"+"+ss(a[1],a[0].get(a[2]).get(a[1])):ss(a[1],a[4][a[1]]||0))+"")&&G(r,o),c&9&&l!==(l="statnumber "+(a[3]?"textgreen":a[0]?"textprimary":"textgreen"))&&m(i,"class",l)},i:ue,o:ue,d(a){a&&(x(e),x(i))}}}function MV(t,e,n){let s,i;oe(t,Oo,a=>n(4,i=a));let{relmap:o}=e,{id:r}=e,{relation:l=void 0}=e;return t.$$set=a=>{"relmap"in a&&n(0,o=a.relmap),"id"in a&&n(1,r=a.id),"relation"in a&&n(2,l=a.relation)},t.$$.update=()=>{t.$$.dirty&7&&n(3,s=l!==void 0&&o.get(l).get(r)!==void 0)},[o,r,l,s,i]}var Zg=class extends Fe{constructor(e){super(),Se(this,e,MV,wV,Oe,{relmap:0,id:1,relation:2})}},yd=Zg;var Co=[4e3,8e3,12e3,16e3,2e4,24e3,28e3,32e3,36e3,4e4,44e3,48e3];var ur=Co.length,Za=t=>{for(let e=0;e<ur;++e)if(Co[e]>t)return e;return Math.max(0,ur)},xd=t=>t===0?0:Co[t-1],Jg=t=>{for(let e=0;e<ur;++e)if(Co[e]>t)return Co[e];return Co[ur-1]},kd=[1,.8,.63,.479,.342,.23,.146,.085,.045,.024,.01,.003,0],_fe=kd.map(t=>1-t);var ou=t=>t===0?"No Bracket":t===kd.length?kd.length+" (Faction Leader)":`${t} (Top ${(kd[t-1]*100).toFixed(1)}%)`;function kF(t,e,n){let s=t.slice();return s[12]=e[n],s[14]=n,s}function xF(t,e,n){let s=t.slice();return s[15]=e[n],s}function wF(t,e,n){let s=t.slice();return s[18]=e[n],s[20]=n,s}function MF(t,e,n){let s=t.slice();return s[15]=e[n],s}function FF(t){let e,n;return e=new jt({props:{title:C.ui.headers.character,icon:"char",origin:"left top",defaultOffset:[3,100],$$slots:{default:[FV]},$$scope:{ctx:t}}}),e.$on("close",t[11]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&8388727&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function CF(t){let e,n,s,i,o,r,l;e=new yd({props:{id:t[15]}});function a(...f){return t[8](t[15],...f)}function c(...f){return t[10](t[15],...f)}return{c(){ne(e.$$.fragment),n=h("img"),at(n.src,s="/data/ui/icons/arrow.svg?v=8593107")||m(n,"src",s),m(n,"class",i="btn "+(t[0][22]>0?"green":"disabled")+" svgicon statbtn svelte-rbq5ku")},m(f,u){ee(e,f,u),w(f,n,u),o=!0,r||(l=[X(n,"pointerenter",a),X(n,"pointerleave",t[9]),X(n,"click",c)],r=!0)},p(f,u){t=f,(!o||u&1&&i!==(i="btn "+(t[0][22]>0?"green":"disabled")+" svgicon statbtn svelte-rbq5ku"))&&m(n,"class",i)},i(f){o||(P(e.$$.fragment,f),o=!0)},o(f){V(e.$$.fragment,f),o=!1},d(f){f&&x(n),te(e,f),r=!1,lt(l)}}}function SF(t){let e,n;return e=new bs({props:{descPos:"left:100%;top:0;",item:t[18],invslot:101+t[20]}}),e.$on("use",DF),e.$on("context",DF),e.$on("move",SV),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&64&&(o.item=s[18]),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function AF(t){let e,n;return e=new yd({props:{id:t[15],relmap:ev,relation:t[1]}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&2&&(o.relation=s[1]),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function PF(t){let e,n,s=me(t[12]),i=[];for(let r=0;r<s.length;r+=1)i[r]=AF(xF(t,s,r));let o=r=>V(i[r],1,1,()=>{i[r]=null});return{c(){e=h("div");for(let r=0;r<i.length;r+=1)i[r].c();m(e,"class","statcol panel-black svelte-rbq5ku")},m(r,l){w(r,e,l);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(e,null);n=!0},p(r,l){if(l&2){s=me(r[12]);let a;for(a=0;a<s.length;a+=1){let c=xF(r,s,a);i[a]?(i[a].p(c,l),P(i[a],1)):(i[a]=AF(c),i[a].c(),P(i[a],1),i[a].m(e,null))}for(Ee(),a=s.length;a<i.length;a+=1)o(a);De()}},i(r){if(!n){for(let l=0;l<s.length;l+=1)P(i[l]);n=!0}},o(r){i=i.filter(Boolean);for(let l=0;l<i.length;l+=1)V(i[l]);n=!1},d(r){r&&x(e),st(i,r)}}}function FV(t){let e,n,s,i,o=t[4].name+"",r,l,a,c=t[4].level+"",f,u,p,g,v,_,b=C.classes[t[4].class].name+"",y,k,S,A,F,M,D,L=C.factions[t[4].faction].name+"",E,R,z,q,j,W,N,O=ht(t[0][20]||0)+"",se,re,ie=t[2]<ur?"/ "+ns(Co[t[2]]):"",ce,ke,ge=C.ui.charpanel.rank+"",Ne,Te,Ce,_e,H,de,Re,Ge,Xe,Ye,pe,ae,Ue,Z,Q,U,fe;Xe=new bd({props:{amount:t[0][21]||0}}),pe=new lr({props:{amount:t[5],isPrice:!1}});let je=me([0,1,2,3,4,5]),Ve=[];for(let ye=0;ye<6;ye+=1)Ve[ye]=CF(MF(t,je,ye));let xe=ye=>V(Ve[ye],1,1,()=>{Ve[ye]=null});Z=new yd({props:{id:22}});let ze=me(t[6].filter(IF)),Be=[];for(let ye=0;ye<ze.length;ye+=1)Be[ye]=SF(wF(t,ze,ye));let mt=ye=>V(Be[ye],1,1,()=>{Be[ye]=null}),wt=me(EF),Ze=[];for(let ye=0;ye<wt.length;ye+=1)Ze[ye]=PF(kF(t,wt,ye));let Et=ye=>V(Ze[ye],1,1,()=>{Ze[ye]=null});return{c(){e=h("div"),n=h("div"),s=h("span"),s.textContent=`${C.ui.charpanel.name}`,i=h("span"),r=T(o),l=h("span"),l.textContent=`${C.ui.charpanel.level}`,a=h("span"),f=T(c),u=h("span"),u.textContent=`${C.ui.charpanel.class}`,p=h("span"),g=h("img"),_=$e(),y=T(b),S=h("span"),S.textContent=`${C.ui.charpanel.faction}`,A=h("span"),F=h("img"),D=$e(),E=T(L),z=h("span"),z.textContent=`${C.ui.stats.array[20]}`,q=h("span"),j=h("img"),N=$e(),se=T(O),re=$e(),ce=T(ie),ke=T(" ("),Ne=T(ge),Te=$e(),Ce=T(t[2]),_e=T("/"),H=T(ur),de=T(")"),Re=h("span"),Re.textContent=`${C.ui.charpanel.rating}`,Ge=h("span"),ne(Xe.$$.fragment),Ye=h("span"),Ye.textContent=`${C.ui.charpanel.medals}`,ne(pe.$$.fragment),ae=h("div");for(let ye=0;ye<6;ye+=1)Ve[ye].c();Ue=be(),ne(Z.$$.fragment),Q=h("div");for(let ye=0;ye<Be.length;ye+=1)Be[ye].c();U=h("div");for(let ye=0;ye<Ze.length;ye+=1)Ze[ye].c();m(i,"class","bold textwhite"),m(a,"class","bold textwhite"),m(g,"class","texticon"),at(g.src,v=Qi(t[4].class))||m(g,"src",v),m(p,"class",k="bold "+("textc"+t[4].class)+" svelte-rbq5ku"),m(F,"class","texticon"),at(F.src,M=S1(t[4].faction))||m(F,"src",M),m(A,"class",R="bold "+("textf"+t[4].faction)+" svelte-rbq5ku"),m(j,"class","texticon"),at(j.src,W=Ba)||m(j,"src",W),m(q,"class","bold textprestige"),m(n,"class","statcol panel-black svelte-rbq5ku"),qe(n,"grid-template-columns","1fr 2fr"),m(ae,"id","statpoints"),m(ae,"class","statcol panel-black svelte-rbq5ku"),qe(ae,"grid-template-columns","1fr auto auto"),m(e,"class","grid"),qe(e,"grid-template-columns","3fr 2fr"),m(Q,"id","equipslots"),m(Q,"class","items svelte-rbq5ku"),m(U,"class","grid three stats2 svelte-rbq5ku")},m(ye,Je){w(ye,e,Je),d(e,n),d(n,s),d(n,i),d(i,r),d(n,l),d(n,a),d(a,f),d(n,u),d(n,p),d(p,g),d(p,_),d(p,y),d(n,S),d(n,A),d(A,F),d(A,D),d(A,E),d(n,z),d(n,q),d(q,j),d(q,N),d(q,se),d(q,re),d(q,ce),d(q,ke),d(q,Ne),d(q,Te),d(q,Ce),d(q,_e),d(q,H),d(q,de),d(n,Re),d(n,Ge),ee(Xe,Ge,null),d(n,Ye),ee(pe,n,null),d(e,ae);for(let yt=0;yt<6;yt+=1)Ve[yt]&&Ve[yt].m(ae,null);d(ae,Ue),ee(Z,ae,null),w(ye,Q,Je);for(let yt=0;yt<Be.length;yt+=1)Be[yt]&&Be[yt].m(Q,null);w(ye,U,Je);for(let yt=0;yt<Ze.length;yt+=1)Ze[yt]&&Ze[yt].m(U,null);fe=!0},p(ye,Je){(!fe||Je&16)&&o!==(o=ye[4].name+"")&&G(r,o),(!fe||Je&16)&&c!==(c=ye[4].level+"")&&G(f,c),(!fe||Je&16&&!at(g.src,v=Qi(ye[4].class)))&&m(g,"src",v),(!fe||Je&16)&&b!==(b=C.classes[ye[4].class].name+"")&&G(y,b),(!fe||Je&16&&k!==(k="bold "+("textc"+ye[4].class)+" svelte-rbq5ku"))&&m(p,"class",k),(!fe||Je&16&&!at(F.src,M=S1(ye[4].faction)))&&m(F,"src",M),(!fe||Je&16)&&L!==(L=C.factions[ye[4].faction].name+"")&&G(E,L),(!fe||Je&16&&R!==(R="bold "+("textf"+ye[4].faction)+" svelte-rbq5ku"))&&m(A,"class",R),(!fe||Je&1)&&O!==(O=ht(ye[0][20]||0)+"")&&G(se,O),(!fe||Je&4)&&ie!==(ie=ye[2]<ur?"/ "+ns(Co[ye[2]]):"")&&G(ce,ie),(!fe||Je&4)&&G(Ce,ye[2]);let yt={};Je&1&&(yt.amount=ye[0][21]||0),Xe.$set(yt);let St={};if(Je&32&&(St.amount=ye[5]),pe.$set(St),Je&131){je=me([0,1,2,3,4,5]);let Pe;for(Pe=0;Pe<6;Pe+=1){let ft=MF(ye,je,Pe);Ve[Pe]?(Ve[Pe].p(ft,Je),P(Ve[Pe],1)):(Ve[Pe]=CF(ft),Ve[Pe].c(),P(Ve[Pe],1),Ve[Pe].m(ae,Ue))}for(Ee(),Pe=6;Pe<6;Pe+=1)xe(Pe);De()}if(Je&64){ze=me(ye[6].filter(IF));let Pe;for(Pe=0;Pe<ze.length;Pe+=1){let ft=wF(ye,ze,Pe);Be[Pe]?(Be[Pe].p(ft,Je),P(Be[Pe],1)):(Be[Pe]=SF(ft),Be[Pe].c(),P(Be[Pe],1),Be[Pe].m(Q,null))}for(Ee(),Pe=ze.length;Pe<Be.length;Pe+=1)mt(Pe);De()}if(Je&2){wt=me(EF);let Pe;for(Pe=0;Pe<wt.length;Pe+=1){let ft=kF(ye,wt,Pe);Ze[Pe]?(Ze[Pe].p(ft,Je),P(Ze[Pe],1)):(Ze[Pe]=PF(ft),Ze[Pe].c(),P(Ze[Pe],1),Ze[Pe].m(U,null))}for(Ee(),Pe=wt.length;Pe<Ze.length;Pe+=1)Et(Pe);De()}},i(ye){if(!fe){P(Xe.$$.fragment,ye),P(pe.$$.fragment,ye);for(let Je=0;Je<6;Je+=1)P(Ve[Je]);P(Z.$$.fragment,ye);for(let Je=0;Je<ze.length;Je+=1)P(Be[Je]);for(let Je=0;Je<wt.length;Je+=1)P(Ze[Je]);fe=!0}},o(ye){V(Xe.$$.fragment,ye),V(pe.$$.fragment,ye),Ve=Ve.filter(Boolean);for(let Je=0;Je<6;Je+=1)V(Ve[Je]);V(Z.$$.fragment,ye),Be=Be.filter(Boolean);for(let Je=0;Je<Be.length;Je+=1)V(Be[Je]);Ze=Ze.filter(Boolean);for(let Je=0;Je<Ze.length;Je+=1)V(Ze[Je]);fe=!1},d(ye){ye&&(x(e),x(Q),x(U)),te(Xe),te(pe),st(Ve,ye),te(Z),st(Be,ye),st(Ze,ye)}}}function CV(t){let e,n,s=t[3]&&t[4].visible&&FF(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[3]&&i[4].visible?s?(s.p(i,o),o&24&&P(s,1)):(s=FF(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}var TF=!1,ev=new Map;Qg.forEach((t,e)=>{let n=new Map;t.forEach((s,i)=>{n.set(i,s)}),ev.set(e,n)});var EF=[[6,8,7,9,12,13],[10,11,17,14,16],[15,19,18,25,26]],SV=t=>{let{from:e,to:n}=t.detail;e!==n&&e.type=="item"&&xt("itemmove",`${e.slot} ${n.slot}`)},DF=t=>{let{item:e}=t.detail;if(e!==void 0){let n=I.player.inventory.getFirstEmptySlot();n>=0&&xt("itemmove",`${t.detail.slot} ${n}`)}},IF=(t,e)=>e>=101;function AV(t,e,n){let s,i,o,r,l,a;oe(t,Oo,_=>n(0,i=_)),oe(t,mo,_=>n(3,o=_)),oe(t,Bi,_=>n(4,r=_)),oe(t,ta,_=>n(5,l=_)),oe(t,na,_=>n(6,a=_)),I&&I.player&&!TF&&(TF=!0,dl.forEach((_,b)=>{b-61==I.player.class&&_.statsConvert&&_.statsConvert.forEach(y=>{let k=Qg.get(y[0])||new Map;k.set(y[2],(k.get(y[2])||0)+y[1]),ev.set(y[0],k)})}));let c,f=_=>{i[22]&&(xt("statincrease",_+" "+(nt.shift.down?10:1)),n(1,c=void 0),tn(18,50))},u=(_,b)=>n(1,c=_),p=_=>n(1,c=void 0),g=(_,b)=>f(_),v=()=>{tt(mo,o=!1,o)};return t.$$.update=()=>{t.$$.dirty&1&&n(2,s=Za(i[20]||0))},[i,c,s,o,r,l,a,f,u,p,g,v]}var Kg=class extends Fe{constructor(e){super(),Se(this,e,AV,CV,Oe,{})}},VF=Kg;function LF(t,e,n){let s=t.slice();return s[16]=e[n],s}function PV(t){let e,n,s=t[4].listed?"\u{1F441}\uFE0F ":"",i,o=t[2].membercount+"",r,l,a,c,f;return{c(){e=h("div"),n=h("span"),i=T(s),r=T(o),l=T("/10"),m(e,"id","partybtn"),m(e,"class",a="btn border black textgreen "+(t[4].flashing?"flashing":"")+" svelte-14vfgvr")},m(u,p){w(u,e,p),d(e,n),d(n,i),d(e,r),d(e,l),c||(f=X(e,"click",t[11]),c=!0)},p(u,p){p&16&&s!==(s=u[4].listed?"\u{1F441}\uFE0F ":"")&&G(i,s),p&4&&o!==(o=u[2].membercount+"")&&G(r,o),p&16&&a!==(a="btn border black textgreen "+(u[4].flashing?"flashing":"")+" svelte-14vfgvr")&&m(e,"class",a)},d(u){u&&x(e),c=!1,f()}}}function TV(t){let e,n,s;return{c(){e=h("div"),e.textContent=`${C.ui.party.noParty}`,m(e,"id","partybtn"),m(e,"class","btn border black textgrey")},m(i,o){w(i,e,o),n||(s=X(e,"click",t[10]),n=!0)},p:ue,d(i){i&&x(e),n=!1,s()}}}function EV(t){let e=t[2].exprate+"",n,s,i=t[2].membercount===0?"":"/"+t[2].nearby,o;return{c(){n=T(e),s=T("% EXP"),o=T(i)},m(r,l){w(r,n,l),w(r,s,l),w(r,o,l)},p(r,l){l&4&&e!==(e=r[2].exprate+"")&&G(n,e),l&4&&i!==(i=r[2].membercount===0?"":"/"+r[2].nearby)&&G(o,i)},d(r){r&&(x(n),x(s),x(o))}}}function DV(t){let e=ht(~~t[1].exph)+"",n,s;return{c(){n=T(e),s=T(" EXP / h")},m(i,o){w(i,n,o),w(i,s,o)},p(i,o){o&2&&e!==(e=ht(~~i[1].exph)+"")&&G(n,e)},d(i){i&&(x(n),x(s))}}}function IV(t){let e=t[2].itemfind+"",n,s;return{c(){n=T(e),s=T("% FIND")},m(i,o){w(i,n,o),w(i,s,o)},p(i,o){o&4&&e!==(e=i[2].itemfind+"")&&G(n,e)},i:ue,o:ue,d(i){i&&(x(n),x(s))}}}function VV(t){let e,n,s;return e=new kn({props:{amount:Math.round(t[0].gph)}}),{c(){ne(e.$$.fragment),n=T(" / h")},m(i,o){ee(e,i,o),w(i,n,o),s=!0},p(i,o){let r={};o&1&&(r.amount=Math.round(i[0].gph)),e.$set(r)},i(i){s||(P(e.$$.fragment,i),s=!0)},o(i){V(e.$$.fragment,i),s=!1},d(i){i&&x(n),te(e,i)}}}function qF(t,e){let n,s,i;return s=new Kf({props:{mode:"party",unit:e[16].unitStore,buffs:e[16].buffStore}}),{key:t,first:null,c(){n=be(),ne(s.$$.fragment),this.first=n},m(o,r){w(o,n,r),ee(s,o,r),i=!0},p(o,r){e=o;let l={};r&256&&(l.unit=e[16].unitStore),r&256&&(l.buffs=e[16].buffStore),s.$set(l)},i(o){i||(P(s.$$.fragment,o),i=!0)},o(o){V(s.$$.fragment,o),i=!1},d(o){o&&x(n),te(s,o)}}}function LV(t){let e,n,s,i,o,r,l,a,c,f=[],u=new Map,p,g,v;function _(R,z){return R[2].membercount===0?TV:PV}let b=_(t,-1),y=b(t);function k(R,z){return R[5]?DV:EV}let S=k(t,-1),A=S(t),F=[VV,IV],M=[];function D(R,z){return R[6]?0:1}r=D(t,-1),l=M[r]=F[r](t);let L=me(t[8]),E=R=>R[16].name;for(let R=0;R<L.length;R+=1){let z=LF(t,L,R),q=E(z);u.set(q,f[R]=qF(q,z))}return{c(){e=h("div"),n=h("div"),s=h("div"),s.textContent=`\u{1F465} ${C.ui.party.name}`,y.c(),i=h("div"),A.c(),o=h("div"),l.c(),a=$e(),c=h("div");for(let R=0;R<f.length;R+=1)f[R].c();m(s,"class","btn party"),m(i,"class","btn border black textexp"),m(o,"class","btn border black textcyan"),m(n,"class","btnbar"),m(c,"class","partyframes svelte-14vfgvr"),qe(c,"width",t[7]+"px"),m(e,"class","l-corner-ul uiscaled")},m(R,z){w(R,e,z),d(e,n),d(n,s),y.m(n,null),d(n,i),A.m(i,null),d(n,o),M[r].m(o,null),d(e,a),d(e,c);for(let q=0;q<f.length;q+=1)f[q]&&f[q].m(c,null);p=!0,g||(v=[X(s,"click",t[9]),X(i,"click",t[12]),X(i,"contextmenu",su),X(o,"click",t[13]),X(o,"contextmenu",su)],g=!0)},p(R,[z]){b===(b=_(R,z))&&y?y.p(R,z):(y.d(1),y=b(R),y&&(y.c(),y.m(n,i))),S===(S=k(R,z))&&A?A.p(R,z):(A.d(1),A=S(R),A&&(A.c(),A.m(i,null)));let q=r;r=D(R,z),r===q?M[r].p(R,z):(Ee(),V(M[q],1,1,()=>{M[q]=null}),De(),l=M[r],l?l.p(R,z):(l=M[r]=F[r](R),l.c()),P(l,1),l.m(o,null)),z&256&&(L=me(R[8]),Ee(),f=us(f,z,E,1,R,L,u,c,Is,qF,null,LF),De()),(!p||z&128)&&qe(c,"width",R[7]+"px")},i(R){if(!p){P(l);for(let z=0;z<L.length;z+=1)P(f[z]);p=!0}},o(R){V(l);for(let z=0;z<f.length;z+=1)V(f[z]);p=!1},d(R){R&&x(e),y.d(),A.d(),M[r].d();for(let z=0;z<f.length;z+=1)f[z].d();g=!1,lt(v)}}}function qV(t,e,n){let s,i,o,r,l,a,c,f,u;oe(t,dp,S=>n(0,s=S)),oe(t,hp,S=>n(1,i=S)),oe(t,Qn,S=>n(2,o=S)),oe(t,Zs,S=>n(3,r=S)),oe(t,Gs,S=>n(4,l=S)),oe(t,Kc,S=>n(5,a=S)),oe(t,Jc,S=>n(6,c=S)),oe(t,Yr,S=>n(7,f=S)),oe(t,Kl,S=>n(8,u=S));let p=S=>{let A=[{name:"Party Panel",fun:()=>{tt(Zs,r=!0,r)}},o.membercount?nn.partyleave():nn.partycreate()];bn.set({x:S.pageX,y:S.pageY,opts:A})},g=()=>{console.log(i)},v=()=>{console.log(s)};return[s,i,o,r,l,a,c,f,u,p,S=>tt(Zs,r=!r,r),S=>tt(Zs,r=!r,r),S=>{tt(Kc,a=!a,a)},S=>{tt(Jc,c=!c,c)}]}var tv=class extends Fe{constructor(e){super(),Se(this,e,qV,LV,Oe,{})}},RF=tv;function RV(t){let e;return{c(){e=h("div"),m(e,"class","pattern svelte-1m0q37p")},m(n,s){w(n,e,s)},p:ue,d(n){n&&x(e)}}}function zV(t){let e,n,s;return n=new vs({props:{size:"0.8em",fract:t[0],barcol:"bgexp",left:t[1],right:`${t[0]}%`,$$slots:{default:[RV]},$$scope:{ctx:t}}}),{c(){e=h("div"),ne(n.$$.fragment),m(e,"id","expbar"),m(e,"class","container svelte-1m0q37p")},m(i,o){w(i,e,o),ee(n,e,null),s=!0},p(i,[o]){let r={};o&1&&(r.fract=i[0]),o&2&&(r.left=i[1]),o&1&&(r.right=`${i[0]}%`),o&8&&(r.$$scope={dirty:o,ctx:i}),n.$set(r)},i(i){s||(P(n.$$.fragment,i),s=!0)},o(i){V(n.$$.fragment,i),s=!1},d(i){i&&x(e),te(n)}}}function BV(t,e,n){let s;oe(t,lp,r=>n(2,s=r));let i,o;return t.$$.update=()=>{t.$$.dirty&4&&(n(0,i=(100*s.current/s.max).toFixed(2)),n(1,o=`${ht(s.current)} / ${ht(s.max)} EXP`))},[i,o,s]}var nv=class extends Fe{constructor(e){super(),Se(this,e,BV,zV,Oe,{})}},zF=nv;function BF(t){let e,n,s=t[5].msg+"",i,o,r,l=t[5].fixed||t[5].step||t[5].fixed?"Skip":"Next",a,c,f,u,p,g=(t[5].fixed||t[5].step||t[5].fixed)&&UF(t);return{c(){e=h("div"),n=h("div"),g&&g.c(),i=h("div"),o=h("div"),o.textContent="Disable tutorial",r=h("div"),a=T(l),m(n,"class","textprimary msgtext svelte-wv9du9"),m(o,"class","btn grey"),m(r,"class","btn green"),m(i,"class","marg-top"),qe(i,"display","flex"),qe(i,"justify-content","space-between"),m(e,"class",c="msg "+(t[5].complete?"complete":"")+" svelte-wv9du9"),qe(e,"cursor","pointer")},m(v,_){w(v,e,_),d(e,n),n.innerHTML=s,g&&g.m(e,null),d(e,i),d(i,o),d(i,r),d(r,a),f=!0,u||(p=[X(o,"click",t[6]),X(e,"click",t[7])],u=!0)},p(v,_){(!f||_&32)&&s!==(s=v[5].msg+"")&&(n.innerHTML=s),v[5].fixed||v[5].step||v[5].fixed?g?(g.p(v,_),_&32&&P(g,1)):(g=UF(v),g.c(),P(g,1),g.m(e,i)):g&&(Ee(),V(g,1,1,()=>{g=null}),De()),(!f||_&32)&&l!==(l=v[5].fixed||v[5].step||v[5].fixed?"Skip":"Next")&&G(a,l),(!f||_&32&&c!==(c="msg "+(v[5].complete?"complete":"")+" svelte-wv9du9"))&&m(e,"class",c)},i(v){f||(P(g),f=!0)},o(v){V(g),f=!1},d(v){v&&x(e),g&&g.d(),u=!1,lt(p)}}}function UF(t){let e,n;return e=new vs({props:{size:"0.8em",fract:t[5].progress,barcol:"bgtut",left:"",right:Math.ceil(t[5].progress)+"%"}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&32&&(o.fract=s[5].progress),i&32&&(o.right=Math.ceil(s[5].progress)+"%"),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function OF(t){let e,n;return{c(){e=h("div"),m(e,"class",n="border skill tut "+(t[5].complete?"complete":"")+" svelte-wv9du9"),qe(e,"top",t[2]+"px"),qe(e,"left",t[1]+"px"),qe(e,"width",t[3]+"px"),qe(e,"height",t[4]+"px")},m(s,i){w(s,e,i)},p(s,i){i&32&&n!==(n="border skill tut "+(s[5].complete?"complete":"")+" svelte-wv9du9")&&m(e,"class",n),i&4&&qe(e,"top",s[2]+"px"),i&2&&qe(e,"left",s[1]+"px"),i&8&&qe(e,"width",s[3]+"px"),i&16&&qe(e,"height",s[4]+"px")},d(s){s&&x(e)}}}function UV(t){let e,n,s,i=t[5]&&t[5].msg&&BF(t),o=t[0]&&OF(t);return{c(){i&&i.c(),e=be(),o&&o.c(),n=be()},m(r,l){i&&i.m(r,l),w(r,e,l),o&&o.m(r,l),w(r,n,l),s=!0},p(r,[l]){r[5]&&r[5].msg?i?(i.p(r,l),l&32&&P(i,1)):(i=BF(r),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Ee(),V(i,1,1,()=>{i=null}),De()),r[0]?o?o.p(r,l):(o=OF(r),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},i(r){s||(P(i),s=!0)},o(r){V(i),s=!1},d(r){r&&(x(e),x(n)),i&&i.d(r),o&&o.d(r)}}}function OV(t,e,n){let s;oe(t,Bo,u=>n(5,s=u));let i=!1,o,r,l,a;return Bo.subscribe(u=>{if(u){let p=document.getElementById(u.element);if(p){n(0,i=!0);let g=p.getBoundingClientRect();n(3,l=g.width+10),n(4,a=g.height+10),n(1,o=g.x-5),n(2,r=g.y-5)}else n(0,i=!1)}else n(0,i=!1)}),[i,o,r,l,a,s,u=>ji.set(1e3),u=>{tn(-1,100)}]}var sv=class extends Fe{constructor(e){super(),Se(this,e,OV,UV,Oe,{})}},$F=sv;function $V(t,e,n){let s=t.slice();return s[7]=e[n],s[9]=n,s}function NF(t){let e,n;return e=new jt({props:{zindex:8,origin:"center",title:"Report a player",$$slots:{default:[GV]},$$scope:{ctx:t}}}),e.$on("close",t[4]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&1031&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function NV(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[7]}`,e.__value=n=t[9],We(e,e.__value)},m(s,i){w(s,e,i)},p:ue,d(s){s&&x(e)}}}function jF(t){let e,n=t[2].info+"",s;return{c(){e=h("p"),s=T(n),m(e,"class","textprimary")},m(i,o){w(i,e,o),d(e,s)},p(i,o){o&4&&n!==(n=i[2].info+"")&&G(s,n)},d(i){i&&x(e)}}}function jV(t){let e,n=(t[0].result==="ok"?"Report submitted.":t[0].result)+"",s,i,o,r,l,a;return{c(){e=h("p"),s=T(n),o=h("div"),r=h("div"),r.textContent="Close",m(e,"class",i=t[0].result==="ok"?"textgreen":"textred"),m(r,"class","btn grey navbtn"),m(o,"class","subnav")},m(c,f){w(c,e,f),d(e,s),w(c,o,f),d(o,r),l||(a=X(r,"click",t[4]),l=!0)},p(c,f){f&1&&n!==(n=(c[0].result==="ok"?"Report submitted.":c[0].result)+"")&&G(s,n),f&1&&i!==(i=c[0].result==="ok"?"textgreen":"textred")&&m(e,"class",i)},d(c){c&&(x(e),x(o)),l=!1,a()}}}function WV(t){let e,n,s,i,o,r,l,a,c;return{c(){e=h("div"),n=h("div"),s=T("Report"),o=h("div"),r=T("Cancel"),m(n,"class",i="btn grey navbtn "+(t[1]?"disabled":"")),m(o,"class",l="btn grey navbtn "+(t[1]?"disabled":"")),m(e,"class","subnav")},m(f,u){w(f,e,u),d(e,n),d(n,s),d(e,o),d(o,r),a||(c=[X(n,"click",t[3]),X(o,"click",t[4])],a=!0)},p(f,u){u&2&&i!==(i="btn grey navbtn "+(f[1]?"disabled":""))&&m(n,"class",i),u&2&&l!==(l="btn grey navbtn "+(f[1]?"disabled":""))&&m(o,"class",l)},d(f){f&&x(e),a=!1,lt(c)}}}function GV(t){let e,n,s,i,o=t[2].name+"",r,l,a,c,f,u,p,g=C.ui.report.info[t[2].reason]+"",v,_,b,y,k,S,A,F,M=me(C.ui.report.reasons),D=[];for(let q=0;q<M.length;q+=1)D[q]=NV($V(t,M,q));let L=t[2].info&&jF(t);function E(q,j){return q[0]?jV:WV}let R=E(t,-1),z=R(t);return{c(){e=h("div"),n=h("p"),s=T("Describe what happened with "),i=h("span"),r=T(o),l=T(" as accurately as you can:"),a=h("div"),c=h("select");for(let q=0;q<D.length;q+=1)D[q].c();u=h("p"),p=h("small"),v=T(g),L&&L.c(),_=h("div"),b=h("textarea"),S=h("p"),S.innerHTML='<small>Please do not file false reports. If you are unsure about a players behavior, refer to our <a href="/terms" target="_blank">Conduct Policy</a>.</small>',z.c(),m(i,"class","textprimary"),m(c,"class",f=t[1]?"disabled":""),t[2].reason===void 0&&_n(()=>t[5].call(c)),m(a,"class","subnav"),m(u,"class","textgrey"),m(b,"maxlength",y=300),m(b,"class",k="scrollbar reportdescription "+(t[1]?"disabled":"")+" svelte-jnzoj3"),m(b,"rows","4"),m(b,"placeholder","Provide additional context, a little description of the situation helps our moderators."),m(_,"class","subnav"),m(S,"class","textgrey"),m(e,"class","card container svelte-jnzoj3")},m(q,j){w(q,e,j),d(e,n),d(n,s),d(n,i),d(i,r),d(n,l),d(e,a),d(a,c);for(let W=0;W<D.length;W+=1)D[W]&&D[W].m(c,null);wn(c,t[2].reason,!0),d(e,u),d(u,p),d(p,v),L&&L.m(e,null),d(e,_),d(_,b),We(b,t[2].description),d(e,S),z.m(e,null),A||(F=[X(c,"change",t[5]),X(b,"input",t[6])],A=!0)},p(q,j){j&4&&o!==(o=q[2].name+"")&&G(r,o),j&2&&f!==(f=q[1]?"disabled":"")&&m(c,"class",f),j&4&&wn(c,q[2].reason),j&4&&g!==(g=C.ui.report.info[q[2].reason]+"")&&G(v,g),q[2].info?L?L.p(q,j):(L=jF(q),L.c(),L.m(e,_)):L&&(L.d(1),L=null),j&2&&k!==(k="scrollbar reportdescription "+(q[1]?"disabled":"")+" svelte-jnzoj3")&&m(b,"class",k),j&4&&We(b,q[2].description),R===(R=E(q,j))&&z?z.p(q,j):(z.d(1),z=R(q),z&&(z.c(),z.m(e,null)))},d(q){q&&x(e),st(D,q),L&&L.d(),z.d(),A=!1,lt(F)}}}function HV(t){let e,n,s=t[2]!==void 0&&NF(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[2]!==void 0?s?(s.p(i,o),o&4&&P(s,1)):(s=NF(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function YV(t,e,n){let s;oe(t,ro,f=>n(2,s=f));let i,o=!1,r=async()=>{n(1,o=!0),n(0,i=await Ot("/api/report/submit",{name:s.name,reason:s.reason,messageId:s.messageId,description:s.description||""}))},l=()=>{tt(ro,s=void 0,s),n(0,i=void 0),n(1,o=void 0)};function a(){s.reason=ks(this),ro.set(s)}function c(){s.description=this.value,ro.set(s)}return[i,o,s,r,l,a,c]}var iv=class extends Fe{constructor(e){super(),Se(this,e,YV,HV,Oe,{})}},WF=iv;var vl=t=>Math.round((10+t*5)**1.85/50)*50,_l=t=>Math.min(100,8+t*2);var GF=(t,e=200)=>{let n;return(s,i)=>{n&&clearTimeout(n),n=setTimeout(o=>t(s),i??e)}};function HF(t,e,n){let s=t.slice();return s[17]=e[n],s[19]=n,s}function YF(t){let e,n,s,i=me(t[1]),o=[];for(let a=0;a<i.length;a+=1)o[a]=QF(HF(t,i,a));let r=a=>V(o[a],1,1,()=>{o[a]=null}),l=null;return i.length||(l=XF(t)),{c(){e=h("div");for(let a=0;a<o.length;a+=1)o[a].c();n=be(),l&&l.c(),m(e,"class","divider")},m(a,c){w(a,e,c);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(a,c);w(a,n,c),l&&l.m(a,c),s=!0},p(a,c){if(c&74){i=me(a[1]);let f;for(f=0;f<i.length;f+=1){let u=HF(a,i,f);o[f]?(o[f].p(u,c),P(o[f],1)):(o[f]=QF(u),o[f].c(),P(o[f],1),o[f].m(n.parentNode,n))}for(Ee(),f=i.length;f<o.length;f+=1)r(f);De(),!i.length&&l?l.p(a,c):i.length?l&&(l.d(1),l=null):(l=XF(a),l.c(),l.m(n.parentNode,n))}},i(a){if(!s){for(let c=0;c<i.length;c+=1)P(o[c]);s=!0}},o(a){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)V(o[c]);s=!1},d(a){a&&(x(e),x(n)),st(o,a),l&&l.d(a)}}}function XF(t){let e;return{c(){e=h("div"),e.textContent="No results",m(e,"class","textgrey result")},m(n,s){w(n,e,s)},p:ue,d(n){n&&x(e)}}}function QF(t){let e,n,s,i,o,r,l=[t[17]],a={};for(let f=0;f<l.length;f+=1)a=Nl(a,l[f]);n=new zs({props:a});function c(...f){return t[14](t[19],...f)}return{c(){e=h("div"),ne(n.$$.fragment),m(e,"class",s="result "+(t[19]===t[3]?"sel":""))},m(f,u){w(f,e,u),ee(n,e,null),i=!0,o||(r=X(e,"mousedown",c),o=!0)},p(f,u){t=f;let p=u&2?np(l,[sp(t[17])]):{};n.$set(p),(!i||u&8&&s!==(s="result "+(t[19]===t[3]?"sel":"")))&&m(e,"class",s)},i(f){i||(P(n.$$.fragment,f),i=!0)},o(f){V(n.$$.fragment,f),i=!1},d(f){f&&x(e),te(n),o=!1,r()}}}function XV(t){let e,n,s,i,o,r,l,a=t[2]&&YF(t);return{c(){e=h("div"),n=h("div"),s=h("input"),a&&a.c(),m(s,"placeholder","Name"),m(s,"type","text"),m(n,"class",i="container input "+(t[2]?"focus":"")),m(e,"class","navbtn finder")},m(c,f){w(c,e,f),d(e,n),d(n,s),t[10](s),We(s,t[0]),a&&a.m(n,null),o=!0,r||(l=[X(s,"input",t[11]),X(s,"input",t[5]),X(s,"focus",t[12]),X(s,"blur",t[13])],r=!0)},p(c,[f]){f&1&&s.value!==c[0]&&We(s,c[0]),c[2]?a?(a.p(c,f),f&4&&P(a,1)):(a=YF(c),a.c(),P(a,1),a.m(n,null)):a&&(Ee(),V(a,1,1,()=>{a=null}),De()),(!o||f&4&&i!==(i="container input "+(c[2]?"focus":"")))&&m(n,"class",i)},i(c){o||(P(a),o=!0)},o(c){V(a),o=!1},d(c){c&&x(e),t[10](null),a&&a.d(),r=!1,lt(l)}}}function QV(t,e,n){let s=GF(async()=>{n(1,a=await Ot("api/playerinfo/search",{[r]:o,order:"name",limit:l})),g(a.findIndex(A=>A.name.toLowerCase()==o.toLowerCase()))}),{id:i}=e,{name:o=""}=e,{type:r="name"}=e,{limit:l=5}=e,a=[],c=!1,f=-1,u,p,g=A=>{n(3,f=A),f>=0&&(u=a[f],n(0,o=u.name),n(7,i=u.id))},v=A=>{A.target==p&&((A.keyCode===38||A.keyCode===40)&&a.length?(g(ba(f+(A.keyCode===38?-1:1),a.length)),A.preventDefault()):(A.keyCode==13||A.keyCode==27)&&p.blur())};Pn(()=>{document.addEventListener("keydown",v)}),Tn(()=>{document.removeEventListener("keydown",v),n(4,p=void 0)});function _(A){Nt[A?"unshift":"push"](()=>{p=A,n(4,p)})}function b(){o=this.value,n(0,o)}let y=A=>n(2,c=!0),k=A=>n(2,c=!1),S=(A,F)=>g(A);return t.$$set=A=>{"id"in A&&n(7,i=A.id),"name"in A&&n(0,o=A.name),"type"in A&&n(8,r=A.type),"limit"in A&&n(9,l=A.limit)},[o,a,c,f,p,s,g,i,r,l,_,b,y,k,S]}var ov=class extends Fe{constructor(e){super(),Se(this,e,QV,XV,Oe,{id:7,name:0,type:8,limit:9})}},wd=ov;function ZF(t,e,n){let s=t.slice();return s[24]=e[n],s[23]=n,s}function JF(t,e,n){let s=t.slice();return s[21]=e[n],s[23]=n,s}function KF(t,e,n){let s=t.slice();return s[26]=e[n],s[23]=n,s}function eC(t){let e,n,s,i,o,r,l,a,c=t[0].tag+"",f,u,p=t[0].name+"",g,v,_,b=C.factions[t[0].faction].name+"",y,k,S=C.ui.clan.heading+"",A,F,M,D,L,E,R,z,q=t[0].level+"",j,W,N,O=_l(t[0].level)+"",se,re,ie,ce,ke=_l(t[0].level+1)-_l(t[0].level)+"",ge,Ne,Te=C.ui.clan.capacity+"",Ce,_e,H,de=t[0].tax+"",Re,Ge,Xe,Ye,pe,ae,Ue=t[0].members.length+"",Z,Q,U,fe=`${t[0].online} (+${t[0].online*60} EXP/h)`,je,Ve,xe,ze,Be,mt,wt=ht(t[0].prestige)+"",Ze,Et,ye,Je,yt,St,Pe,ft,Ut,Le,Ct,Vt,He,Ke;M=new vs({props:{size:"1em",fract:Math.ceil(t[0].exp/vl(t[0].level)*100),barcol:"bgpurp",left:`${ht(t[0].exp)} / ${ht(vl(t[0].level))} EXP`,right:`${Math.ceil(t[0].exp/vl(t[0].level)*100)}% `}}),ye=new kn({props:{amount:t[0].gold}});let Me=t[0].role>-1&&tC(t),ot=t[0].role>0&&nC(t),Qe=t[0].eligibleApply.length>0&&sC(t),ut=t[1]&&oC(t),xn=t[0].role>0&&rC(t),Ci=[JV,ZV],ls=[];function Ds(dt,Lt){return dt[6]=="members"?0:dt[6]=="applications"?1:-1}return~(Le=Ds(t,-1))&&(Ct=ls[Le]=Ci[Le](t)),{c(){e=h("div"),n=h("div"),s=h("div"),i=h("img"),r=h("div"),l=h("div"),a=h("h1"),f=T(c),u=h("h3"),g=T(p),_=h("p"),y=T(b),k=$e(),A=T(S),F=h("div"),ne(M.$$.fragment),D=h("div"),L=h("div"),E=h("div"),R=h("span"),R.textContent=`${C.ui.clan.level}`,z=h("span"),j=T(q),W=h("span"),W.textContent=`${C.ui.clan.capacity}`,N=h("span"),se=T(O),re=h("span"),re.textContent=`${C.ui.clan.nextlevel}`,ie=h("span"),ce=T("+"),ge=T(ke),Ne=$e(),Ce=T(Te),_e=h("span"),_e.textContent=`${C.ui.clan.taxrate}`,H=h("span"),Re=T(de),Ge=T("%"),Xe=h("div"),Ye=h("div"),pe=h("span"),pe.textContent=`${C.ui.clan.members}`,ae=h("span"),Z=T(Ue),Q=h("span"),Q.textContent=`${C.ui.clan.online}`,U=h("span"),je=T(fe),Ve=h("span"),Ve.textContent=`${C.ui.stats.array[20]}`,xe=h("span"),ze=h("img"),mt=$e(),Ze=T(wt),Et=h("span"),Et.textContent=`${C.ui.clan.treasury}`,ne(ye.$$.fragment),Me&&Me.c(),Je=be(),ot&&ot.c(),yt=be(),Qe&&Qe.c(),St=be(),ut&&ut.c(),Pe=h("div"),ft=h("div"),Ut=h("div"),Ut.textContent=`${C.ui.clan.members}`,xn&&xn.c(),Ct&&Ct.c(),m(i,"class","helmet absCentered svelte-6t8hqd"),at(i.src,o="/data/ui/factions/"+t[0].faction+".svg?v=8593107")||m(i,"src",o),m(l,"class",v="textf"+t[0].faction+" svelte-6t8hqd"),m(r,"class","textcenter"),m(s,"class","hero svelte-6t8hqd"),m(F,"class","panel-black svelte-6t8hqd"),m(R,"class","textprimary"),m(W,"class","textprimary"),m(re,"class","textprimary"),m(_e,"class","textprimary"),m(E,"class","panel-black grid two svelte-6t8hqd"),m(pe,"class","textprimary"),m(Q,"class","textprimary"),m(Ve,"class","textprimary"),m(ze,"class","svgicon"),at(ze.src,Be=Ba)||m(ze,"src",Be),m(xe,"class","textprestige"),m(Et,"class","textprimary"),m(Ye,"class","panel-black grid two svelte-6t8hqd"),m(D,"class","marg-top grid two"),m(n,"class","row slim"),m(e,"class","fold fadeIn"),m(Ut,"class","btn navbtn grey"),m(ft,"class","subnav marg-top"),m(Pe,"class","row slim fadeIn")},m(dt,Lt){w(dt,e,Lt),d(e,n),d(n,s),d(s,i),d(s,r),d(r,l),d(l,a),d(a,f),d(l,u),d(u,g),d(r,_),d(_,y),d(_,k),d(_,A),d(n,F),ee(M,F,null),d(n,D),d(D,L),d(L,E),d(E,R),d(E,z),d(z,j),d(E,W),d(E,N),d(N,se),d(E,re),d(E,ie),d(ie,ce),d(ie,ge),d(ie,Ne),d(ie,Ce),d(E,_e),d(E,H),d(H,Re),d(H,Ge),d(D,Xe),d(Xe,Ye),d(Ye,pe),d(Ye,ae),d(ae,Z),d(Ye,Q),d(Ye,U),d(U,je),d(Ye,Ve),d(Ye,xe),d(xe,ze),d(xe,mt),d(xe,Ze),d(Ye,Et),ee(ye,Ye,null),Me&&Me.m(n,null),d(n,Je),ot&&ot.m(n,null),d(n,yt),Qe&&Qe.m(n,null),d(n,St),ut&&ut.m(n,null),w(dt,Pe,Lt),d(Pe,ft),d(ft,Ut),xn&&xn.m(ft,null),~Le&&ls[Le].m(Pe,null),Vt=!0,He||(Ke=X(Ut,"click",t[14]),He=!0)},p(dt,Lt){(!Vt||Lt&1&&!at(i.src,o="/data/ui/factions/"+dt[0].faction+".svg?v=8593107"))&&m(i,"src",o),(!Vt||Lt&1)&&c!==(c=dt[0].tag+"")&&G(f,c),(!Vt||Lt&1)&&p!==(p=dt[0].name+"")&&G(g,p),(!Vt||Lt&1&&v!==(v="textf"+dt[0].faction+" svelte-6t8hqd"))&&m(l,"class",v),(!Vt||Lt&1)&&b!==(b=C.factions[dt[0].faction].name+"")&&G(y,b);let Si={};Lt&1&&(Si.fract=Math.ceil(dt[0].exp/vl(dt[0].level)*100)),Lt&1&&(Si.left=`${ht(dt[0].exp)} / ${ht(vl(dt[0].level))} EXP`),Lt&1&&(Si.right=`${Math.ceil(dt[0].exp/vl(dt[0].level)*100)}% `),M.$set(Si),(!Vt||Lt&1)&&q!==(q=dt[0].level+"")&&G(j,q),(!Vt||Lt&1)&&O!==(O=_l(dt[0].level)+"")&&G(se,O),(!Vt||Lt&1)&&ke!==(ke=_l(dt[0].level+1)-_l(dt[0].level)+"")&&G(ge,ke),(!Vt||Lt&1)&&de!==(de=dt[0].tax+"")&&G(Re,de),(!Vt||Lt&1)&&Ue!==(Ue=dt[0].members.length+"")&&G(Z,Ue),(!Vt||Lt&1)&&fe!==(fe=`${dt[0].online} (+${dt[0].online*60} EXP/h)`)&&G(je,fe),(!Vt||Lt&1)&&wt!==(wt=ht(dt[0].prestige)+"")&&G(Ze,wt);let jn={};Lt&1&&(jn.amount=dt[0].gold),ye.$set(jn),dt[0].role>-1?Me?Me.p(dt,Lt):(Me=tC(dt),Me.c(),Me.m(n,Je)):Me&&(Me.d(1),Me=null),dt[0].role>0?ot?(ot.p(dt,Lt),Lt&1&&P(ot,1)):(ot=nC(dt),ot.c(),P(ot,1),ot.m(n,yt)):ot&&(Ee(),V(ot,1,1,()=>{ot=null}),De()),dt[0].eligibleApply.length>0?Qe?Qe.p(dt,Lt):(Qe=sC(dt),Qe.c(),Qe.m(n,St)):Qe&&(Qe.d(1),Qe=null),dt[1]?ut?ut.p(dt,Lt):(ut=oC(dt),ut.c(),ut.m(n,null)):ut&&(ut.d(1),ut=null),dt[0].role>0?xn?xn.p(dt,Lt):(xn=rC(dt),xn.c(),xn.m(ft,null)):xn&&(xn.d(1),xn=null);let as=Le;Le=Ds(dt,Lt),Le===as?~Le&&ls[Le].p(dt,Lt):(Ct&&(Ee(),V(ls[as],1,1,()=>{ls[as]=null}),De()),~Le?(Ct=ls[Le],Ct?Ct.p(dt,Lt):(Ct=ls[Le]=Ci[Le](dt),Ct.c()),P(Ct,1),Ct.m(Pe,null)):Ct=null)},i(dt){Vt||(P(M.$$.fragment,dt),P(ye.$$.fragment,dt),P(ot),P(Ct),Vt=!0)},o(dt){V(M.$$.fragment,dt),V(ye.$$.fragment,dt),V(ot),V(Ct),Vt=!1},d(dt){dt&&(x(e),x(Pe)),te(M),te(ye),Me&&Me.d(),ot&&ot.d(),Qe&&Qe.d(),ut&&ut.d(),xn&&xn.d(),~Le&&ls[Le].d(),He=!1,Ke()}}}function tC(t){let e,n,s,i=C.ui.clan.roles[t[0].role]+"",o;return{c(){e=h("div"),n=h("span"),n.textContent=`${C.ui.clan.highestrank}: `,s=h("span"),o=T(i),m(n,"class","textprimary"),m(s,"class","textgreen"),m(e,"class","marg-top panel-black svelte-6t8hqd")},m(r,l){w(r,e,l),d(e,n),d(e,s),d(s,o)},p(r,l){l&1&&i!==(i=C.ui.clan.roles[r[0].role]+"")&&G(o,i)},d(r){r&&x(e)}}}function nC(t){let e,n,s,i,o,r,l=C.ui.clan.inviteplayer+"",a,c,f,u,p;function g(_){t[12](_)}let v={};return t[4]!==void 0&&(v.name=t[4]),i=new wd({props:v}),Nt.push(()=>Lo(i,"name",g)),{c(){e=h("div"),n=h("span"),n.textContent=`${C.ui.clan.inviteplayers}`,s=h("div"),ne(i.$$.fragment),r=h("div"),a=T(l),m(n,"class","textgrey"),m(r,"class",c="btn formatted navbtn grey "+(t[3]||!t[4].length?"disabled":"")),m(s,"class","subnav"),m(e,"class","marg-top panel-black svelte-6t8hqd")},m(_,b){w(_,e,b),d(e,n),d(e,s),ee(i,s,null),d(s,r),d(r,a),f=!0,u||(p=X(r,"click",t[8]),u=!0)},p(_,b){let y={};!o&&b&16&&(o=!0,y.name=_[4],Vo(()=>o=!1)),i.$set(y),(!f||b&24&&c!==(c="btn formatted navbtn grey "+(_[3]||!_[4].length?"disabled":"")))&&m(r,"class",c)},i(_){f||(P(i.$$.fragment,_),f=!0)},o(_){V(i.$$.fragment,_),f=!1},d(_){_&&x(e),te(i),u=!1,p()}}}function sC(t){let e,n,s,i,o,r=C.ui.apply+"",l,a,c,f,u=me(t[0].eligibleApply),p=[];for(let g=0;g<u.length;g+=1)p[g]=iC(KF(t,u,g));return{c(){e=h("div"),n=h("span"),n.textContent=`${C.ui.clan.apply}`,s=h("div"),i=h("select");for(let g=0;g<p.length;g+=1)p[g].c();o=h("div"),l=T(r),m(n,"class","textgrey"),m(i,"class","navbtn"),t[5]===void 0&&_n(()=>t[13].call(i)),m(o,"class",a="btn formatted navbtn grey "+(t[3]||!t[5].length?"disabled":"")),m(s,"class","subnav"),m(e,"class","marg-top panel-black svelte-6t8hqd")},m(g,v){w(g,e,v),d(e,n),d(e,s),d(s,i);for(let _=0;_<p.length;_+=1)p[_]&&p[_].m(i,null);wn(i,t[5],!0),d(s,o),d(o,l),c||(f=[X(i,"change",t[13]),X(o,"click",t[9])],c=!0)},p(g,v){if(v&33){u=me(g[0].eligibleApply);let _;for(_=0;_<u.length;_+=1){let b=KF(g,u,_);p[_]?p[_].p(b,v):(p[_]=iC(b),p[_].c(),p[_].m(i,null))}for(;_<p.length;_+=1)p[_].d(1);p.length=u.length}v&33&&wn(i,g[5]),v&41&&a!==(a="btn formatted navbtn grey "+(g[3]||!g[5].length?"disabled":""))&&m(o,"class",a)},d(g){g&&x(e),st(p,g),c=!1,lt(f)}}}function iC(t){let e,n=t[26]+"",s,i,o;return{c(){e=h("option"),s=T(n),e.selected=i=t[5]==t[26],e.__value=o=t[26],We(e,e.__value)},m(r,l){w(r,e,l),d(e,s)},p(r,l){l&1&&n!==(n=r[26]+"")&&G(s,n),l&33&&i!==(i=r[5]==r[26])&&(e.selected=i),l&1&&o!==(o=r[26])&&(e.__value=o,We(e,e.__value))},d(r){r&&x(e)}}}function oC(t){let e,n,s,i,o;return{c(){e=h("div"),n=h("span"),s=T(t[1]),m(n,"class",i="text"+t[2]+" svelte-6t8hqd"),m(e,"class",o="marg-top panel-black border "+t[2]+" svelte-6t8hqd")},m(r,l){w(r,e,l),d(e,n),d(n,s)},p(r,l){l&2&&G(s,r[1]),l&4&&i!==(i="text"+r[2]+" svelte-6t8hqd")&&m(n,"class",i),l&4&&o!==(o="marg-top panel-black border "+r[2]+" svelte-6t8hqd")&&m(e,"class",o)},d(r){r&&x(e)}}}function rC(t){let e,n=C.ui.clan.applications+"",s,i,o=t[0].applications.length+"",r,l,a,c,f;return{c(){e=h("div"),s=T(n),i=T(" ("),r=T(o),l=T(")"),a=$e(),m(e,"class","btn navbtn grey")},m(u,p){w(u,e,p),d(e,s),d(e,i),d(e,r),d(e,l),w(u,a,p),c||(f=X(e,"click",t[15]),c=!0)},p(u,p){p&1&&o!==(o=u[0].applications.length+"")&&G(r,o)},d(u){u&&(x(e),x(a)),c=!1,f()}}}function ZV(t){let e,n,s,i,o,r,l=[],a=new Map,c,f=me(t[0].applications),u=p=>p[24].name;for(let p=0;p<f.length;p+=1){let g=ZF(t,f,p),v=u(g);a.set(v,l[p]=lC(v,g))}return{c(){e=h("div"),e.textContent=`${C.ui.clan.applicationdesc}`,n=h("table"),s=h("thead"),i=h("tr"),o=h("th"),o.textContent=`${C.ui.clan.player}`,r=h("tbody");for(let p=0;p<l.length;p+=1)l[p].c();m(e,"class","marg-top textgrey"),m(o,"width","70%"),m(i,"class","textprimary"),m(n,"class","marg-top panel-black svelte-6t8hqd")},m(p,g){w(p,e,g),w(p,n,g),d(n,s),d(s,i),d(i,o),d(n,r);for(let v=0;v<l.length;v+=1)l[v]&&l[v].m(r,null);c=!0},p(p,g){g&1025&&(f=me(p[0].applications),Ee(),l=us(l,g,u,1,p,f,a,r,Is,lC,null,ZF),De())},i(p){if(!c){for(let g=0;g<f.length;g+=1)P(l[g]);c=!0}},o(p){for(let g=0;g<l.length;g+=1)V(l[g]);c=!1},d(p){p&&(x(e),x(n));for(let g=0;g<l.length;g+=1)l[g].d()}}}function JV(t){let e,n,s,i,o,r,l,a=[],c=new Map,f,u=me(t[0].members),p=g=>g[21].name;for(let g=0;g<u.length;g+=1){let v=JF(t,u,g),_=p(v);c.set(_,a[g]=aC(_,v))}return{c(){e=h("div"),e.textContent=`${C.ui.clan.memberdesc}`,n=h("table"),s=h("thead"),i=h("tr"),o=h("th"),o.textContent=`${C.ui.clan.roles[0]}`,r=h("th"),r.textContent=`${C.ui.clan.rank}`,l=h("tbody");for(let g=0;g<a.length;g+=1)a[g].c();m(e,"class","marg-top textgrey"),m(o,"width","70%"),m(i,"class","textprimary"),m(n,"class","marg-top panel-black svelte-6t8hqd")},m(g,v){w(g,e,v),w(g,n,v),d(n,s),d(s,i),d(i,o),d(i,r),d(n,l);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(l,null);f=!0},p(g,v){v&129&&(u=me(g[0].members),Ee(),a=us(a,v,p,1,g,u,c,l,Is,aC,null,JF),De())},i(g){if(!f){for(let v=0;v<u.length;v+=1)P(a[v]);f=!0}},o(g){for(let v=0;v<a.length;v+=1)V(a[v]);f=!1},d(g){g&&(x(e),x(n));for(let v=0;v<a.length;v+=1)a[v].d()}}}function lC(t,e){let n,s,i,o,r,l;i=new zs({props:{name:e[24].name,pclass:e[24].class,level:e[24].level,faction:e[0].faction}});function a(...c){return e[17](e[24],...c)}return{key:t,first:null,c(){n=h("tr"),s=h("td"),ne(i.$$.fragment),m(n,"class","striped"),this.first=n},m(c,f){w(c,n,f),d(n,s),ee(i,s,null),o=!0,r||(l=X(n,"mousedown",a),r=!0)},p(c,f){e=c;let u={};f&1&&(u.name=e[24].name),f&1&&(u.pclass=e[24].class),f&1&&(u.level=e[24].level),f&1&&(u.faction=e[0].faction),i.$set(u)},i(c){o||(P(i.$$.fragment,c),o=!0)},o(c){V(i.$$.fragment,c),o=!1},d(c){c&&x(n),te(i),r=!1,l()}}}function aC(t,e){let n,s,i,o,r=e[21].online?"\u2B24":"",l,a=e[21].owned?"\u2B50":"",c,f,u=C.ui.clan.roles[e[21].clanrole]+"",p,g,v,_,b;i=new zs({props:{name:e[21].name,pclass:e[21].class,level:e[21].level,faction:e[0].faction}});function y(...k){return e[16](e[21],...k)}return{key:t,first:null,c(){n=h("tr"),s=h("td"),ne(i.$$.fragment),o=h("span"),l=T(r),c=T(a),f=h("td"),p=T(u),m(o,"class","textgreen"),m(n,"class",g="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"),this.first=n},m(k,S){w(k,n,S),d(n,s),ee(i,s,null),d(s,o),d(o,l),d(o,c),d(n,f),d(f,p),v=!0,_||(b=X(n,"mousedown",y),_=!0)},p(k,S){e=k;let A={};S&1&&(A.name=e[21].name),S&1&&(A.pclass=e[21].class),S&1&&(A.level=e[21].level),S&1&&(A.faction=e[0].faction),i.$set(A),(!v||S&1)&&r!==(r=e[21].online?"\u2B24":"")&&G(l,r),(!v||S&1)&&a!==(a=e[21].owned?"\u2B50":"")&&G(c,a),(!v||S&1)&&u!==(u=C.ui.clan.roles[e[21].clanrole]+"")&&G(p,u),(!v||S&1&&g!==(g="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"))&&m(n,"class",g)},i(k){v||(P(i.$$.fragment,k),v=!0)},o(k){V(i.$$.fragment,k),v=!1},d(k){k&&x(n),te(i),_=!1,b()}}}function KV(t){let e,n,s=t[0]&&eC(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[0]?s?(s.p(i,o),o&1&&P(s,1)):(s=eC(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function eL(t,e,n){let{tag:s}=e,i,o,r=async()=>{let L=await Ot("/api/claninfo/info",{tag:s});L.name&&(n(0,i=L),i.eligibleApply.length&&n(5,v=i.eligibleApply[0]),n(0,i.online=i.members.filter(E=>E.online).length,i)),o&&(clearTimeout(o),o=setTimeout(r,5e3))};o=!0,r(),Tn(()=>{clearTimeout(o),o=void 0});let l=(L,E)=>{let R=[];E.owned?R.push({name:C.ui.clan.leave,fun:async()=>{u(await Ot("/api/clan/leave",{name:E.name}),C.ui.clan.left)}}):E.clanrole<i.role&&R.push({name:C.ui.clan.kick,fun:async()=>{u(await Ot("/api/clan/kick",{name:E.name}),C.ui.clan.memberkicked)}});for(let z=0;z<(i.role==3?4:i.role);z++)R.push({name:C.ui.clan.setrank+": "+C.ui.clan.roles[z],fun:async()=>{u(await Ot("/api/clan/setrole",{name:E.name,role:z}),C.ui.clan.setrank+": "+C.ui.clan.roles[z])}});bn.set({x:L.pageX,y:L.pageY,opts:R})},a,c,f=!1,u=async(L,E)=>{L.result!=="ok"?(n(1,a=L.result),n(2,c="red")):(n(1,a=E),n(2,c="green")),await r(),n(3,f=!1)},p="",g=async()=>{n(3,f=!0),u(await Ot("/api/clan/invite",{name:p,tag:s}),C.ui.clan.invited[0]+p+C.ui.clan.invited[1]),n(4,p="")},v="",_=async()=>{n(3,f=!0),u(await Ot("/api/clan/apply",{name:v,tag:s}),C.ui.clan.applied),n(5,v="")},b=(L,E)=>{let R=[];i.role>0&&R.push({name:C.ui.clan.applicationaccept,fun:async()=>{u(await Ot("/api/clan/invite",{tag:s,name:E.name}),C.ui.clan.applicationaccepted)}}),i.role>1&&R.push({name:C.ui.clan.applicationdeny,fun:async()=>{u(await Ot("/api/clan/denyapplication",{id:E.id}),C.ui.clan.applicationdenied)}}),bn.set({x:L.pageX,y:L.pageY,opts:R})},y="members";function k(L){p=L,n(4,p)}function S(){v=ks(this),n(5,v),n(0,i)}let A=L=>n(6,y="members"),F=L=>n(6,y="applications"),M=(L,E)=>l(E,L),D=(L,E)=>b(E,L);return t.$$set=L=>{"tag"in L&&n(11,s=L.tag)},[i,a,c,f,p,v,y,l,g,_,b,s,k,S,A,F,M,D]}var rv=class extends Fe{constructor(e){super(),Se(this,e,eL,KV,Oe,{tag:11})}},cC=rv;function tL(t){let e,n,s,i,o,r,l=C.ui.cost+"",a,c,f,u,p,g,v,_=C.ui.clan.createbutton+"",b,y,k,S,A;return f=new kn({props:{amount:1e5}}),{c(){e=h("h3"),e.textContent=`${C.ui.clan.createheading}`,n=h("label"),n.textContent=`${C.ui.clan.createname}`,s=h("input"),i=h("label"),i.textContent=`${C.ui.clan.createtag}`,o=h("input"),r=h("p"),a=T(l),c=T(": "),ne(f.$$.fragment),p=h("div"),g=T(t[3]),v=h("div"),b=T(_),m(e,"class","textprimary"),m(n,"class","svelte-7uvqsx"),m(s,"type","text"),m(s,"placeholder","Guardians of Guardstone (a-Z)"),m(s,"maxlength","20"),m(i,"class","svelte-7uvqsx"),m(o,"type","text"),m(o,"placeholder","GoG (a-Z !~=#*+-)"),m(o,"maxlength","4"),m(r,"class",u="text"+(t[2]>1e5?"primary":"red")),m(p,"class","textred"),qe(v,"display","inline-block"),m(v,"class",y="btn marg-top formatted "+(t[4]?"blue":"blue disabled"))},m(F,M){w(F,e,M),w(F,n,M),w(F,s,M),We(s,t[0]),w(F,i,M),w(F,o,M),We(o,t[1]),w(F,r,M),d(r,a),d(r,c),ee(f,r,null),w(F,p,M),d(p,g),w(F,v,M),d(v,b),k=!0,S||(A=[X(s,"input",t[7]),X(o,"input",t[8]),X(v,"click",t[5])],S=!0)},p(F,[M]){M&1&&s.value!==F[0]&&We(s,F[0]),M&2&&o.value!==F[1]&&We(o,F[1]),(!k||M&4&&u!==(u="text"+(F[2]>1e5?"primary":"red")))&&m(r,"class",u),(!k||M&8)&&G(g,F[3]),(!k||M&16&&y!==(y="btn marg-top formatted "+(F[4]?"blue":"blue disabled")))&&m(v,"class",y)},i(F){k||(P(f.$$.fragment,F),k=!0)},o(F){V(f.$$.fragment,F),k=!1},d(F){F&&(x(e),x(n),x(s),x(i),x(o),x(r),x(p),x(v)),te(f),S=!1,lt(A)}}}function nL(t,e,n){let s,i;oe(t,Hs,p=>n(2,i=p));let o="",r="",l=!1,a="",c=async()=>{if(l)return;n(6,l=!0);let p=await Ot("/api/clan/create",{name:o,tag:r});p.result!=="ok"&&(n(3,a=p.result),n(6,l=!1))};function f(){o=this.value,n(0,o)}function u(){r=this.value,n(1,r)}return t.$$.update=()=>{t.$$.dirty&71&&n(4,s=!l&&i>=1e5&&o.length<=20&&o.length>=3&&r.length<=4&&r.length>=2)},[o,r,i,a,s,c,l,f,u]}var lv=class extends Fe{constructor(e){super(),Se(this,e,nL,tL,Oe,{})}},fC=lv;function uC(t,e,n){let s=t.slice();return s[4]=e[n],s[6]=n,s}function sL(t){let e,n,s;function i(...o){return t[2](t[4],...o)}return{c(){e=h("div"),e.textContent=`${C.ui.accept}`,m(e,"class","btn blue")},m(o,r){w(o,e,r),n||(s=X(e,"click",i),n=!0)},p(o,r){t=o},d(o){o&&x(e),n=!1,s()}}}function iL(t){let e;return{c(){e=h("div"),e.textContent=`${C.ui.clan.application}`},m(n,s){w(n,e,s)},p:ue,d(n){n&&x(e)}}}function pC(t,e){let n,s,i=e[4].tag+"",o,r,l=e[4].name+"",a,c;function f(g,v){return g[4].request?iL:sL}let u=f(e,-1),p=u(e);return{key:t,first:null,c(){n=h("tr"),s=h("td"),o=T(i),r=h("td"),a=T(l),c=h("td"),p.c(),m(c,"class","textcenter"),m(n,"class","striped"),this.first=n},m(g,v){w(g,n,v),d(n,s),d(s,o),d(n,r),d(r,a),d(n,c),p.m(c,null)},p(g,v){e=g,v&1&&i!==(i=e[4].tag+"")&&G(o,i),v&1&&l!==(l=e[4].name+"")&&G(a,l),u===(u=f(e,v))&&p?p.p(e,v):(p.d(1),p=u(e),p&&(p.c(),p.m(c,null)))},d(g){g&&x(n),p.d()}}}function oL(t){let e,n,s,i,o,r,l,a=[],c=new Map,f=me(t[0]),u=p=>p[4].clan;for(let p=0;p<f.length;p+=1){let g=uC(t,f,p),v=u(g);c.set(v,a[p]=pC(v,g))}return{c(){e=h("table"),n=h("thead"),s=h("tr"),i=h("th"),i.textContent=`${C.ui.clan.createtag}`,o=h("th"),o.textContent=`${C.ui.clan.createname}`,r=h("th"),r.textContent=`${C.ui.clan.action}`,l=h("tbody");for(let p=0;p<a.length;p+=1)a[p].c();m(i,"width","20%"),m(o,"width","60%"),m(r,"class","textcenter"),m(s,"class","textprimary"),m(e,"class","marg-top panel-black")},m(p,g){w(p,e,g),d(e,n),d(n,s),d(s,i),d(s,o),d(s,r),d(e,l);for(let v=0;v<a.length;v+=1)a[v]&&a[v].m(l,null)},p(p,[g]){g&3&&(f=me(p[0]),a=us(a,g,u,1,p,f,c,l,s_,pC,null,uC))},i:ue,o:ue,d(p){p&&x(e);for(let g=0;g<a.length;g+=1)a[g].d()}}}function rL(t,e,n){let s=[];(async()=>{n(0,s=await Ot("/api/clan/invites",{name:I.player.name}))})();let o=async l=>{await Ot("/api/clan/apply",{tag:l,name:I.player.name})};return[s,o,(l,a)=>o(l.tag)]}var av=class extends Fe{constructor(e){super(),Se(this,e,rL,oL,Oe,{})}},mC=av;function dC(t){let e,n;return e=new jt({props:{origin:"center",title:C.ui.clan.heading,icon:"clan",scroll:!0,$$slots:{default:[pL]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&133&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function lL(t){let e,n,s,i,o,r,l;return{c(){e=h("div"),n=h("div"),s=h("h3"),s.textContent=`${C.ui.clan.noclan}`,i=h("div"),i.textContent=`${C.ui.clan.viewinvites}`,o=h("div"),o.textContent=`${C.ui.clan.createheading}`,m(i,"class","btn grey"),m(o,"class","btn grey marg-top"),m(n,"class","panel-black"),m(e,"class","clanInfoBox textcenter svelte-1vwl908")},m(a,c){w(a,e,c),d(e,n),d(n,s),d(n,i),d(n,o),r||(l=[X(i,"click",t[4]),X(o,"click",t[5])],r=!0)},p:ue,i:ue,o:ue,d(a){a&&x(e),r=!1,lt(l)}}}function aL(t){let e,n,s,i,o,r,l,a=[uL,fL],c=[];function f(u,p){return u[0]=="create"?0:u[0]=="invites"?1:-1}return~(s=f(t,-1))&&(i=c[s]=a[s](t)),{c(){e=h("div"),n=h("div"),n.textContent=`${C.ui.back}`,i&&i.c(),qe(n,"display","inline-block"),m(n,"class","btn formatted grey"),m(e,"class","modemenu svelte-1vwl908")},m(u,p){w(u,e,p),d(e,n),~s&&c[s].m(e,null),o=!0,r||(l=X(n,"click",t[3]),r=!0)},p(u,p){let g=s;s=f(u,p),s!==g&&(i&&(Ee(),V(c[g],1,1,()=>{c[g]=null}),De()),~s?(i=c[s],i||(i=c[s]=a[s](u),i.c()),P(i,1),i.m(e,null)):i=null)},i(u){o||(P(i),o=!0)},o(u){V(i),o=!1},d(u){u&&x(e),~s&&c[s].d(),r=!1,l()}}}function cL(t){let e,n,s;return n=new cC({props:{tag:t[2]}}),{c(){e=h("div"),ne(n.$$.fragment),m(e,"class","clanView svelte-1vwl908")},m(i,o){w(i,e,o),ee(n,e,null),s=!0},p(i,o){let r={};o&4&&(r.tag=i[2]),n.$set(r)},i(i){s||(P(n.$$.fragment,i),s=!0)},o(i){V(n.$$.fragment,i),s=!1},d(i){i&&x(e),te(n)}}}function fL(t){let e,n;return e=new mC({}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function uL(t){let e,n;return e=new fC({}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function pL(t){let e,n,s,i,o=[cL,aL,lL],r=[];function l(a,c){return a[2]?0:a[0]?1:2}return n=l(t,-1),s=r[n]=o[n](t),{c(){e=h("div"),s.c(),m(e,"class","container svelte-1vwl908")},m(a,c){w(a,e,c),r[n].m(e,null),i=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(Ee(),V(r[f],1,1,()=>{r[f]=null}),De(),s=r[n],s?s.p(a,c):(s=r[n]=o[n](a),s.c()),P(s,1),s.m(e,null))},i(a){i||(P(s),i=!0)},o(a){V(s),i=!1},d(a){a&&x(e),r[n].d()}}}function mL(t){let e,n,s=t[1]&&dC(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[1]?s?(s.p(i,o),o&2&&P(s,1)):(s=dC(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function dL(t,e,n){let s,i;oe(t,uo,f=>n(1,s=f)),oe(t,gp,f=>n(2,i=f));let o=!1;return[o,s,i,f=>n(0,o=!1),f=>n(0,o="invites"),f=>n(0,o="create"),()=>{tt(uo,s=!1,s)}]}var cv=class extends Fe{constructor(e){super(),Se(this,e,dL,mL,Oe,{})}},hC=cv;var fv=t=>{let e=~~(t/86400),n=~~(t/(60*60)%24),s=~~(t/60%60),i=~~(t%60);return`${e?e+"d ":""}${n?n+"h ":""}${s?s+"m ":""}${i?i+"s":""}`};var ru=t=>~~(1e4+t**1.5*8e3);function gC(t,e,n){let s=t.slice();return s[9]=e[n],s[11]=n,s}function vC(t){let e,n;return e=new jt({props:{origin:"center",title:C.ui.headers.warstats,icon:"pvp",$$slots:{default:[gL]},$$scope:{ctx:t}}}),e.$on("close",t[8]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&4101&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function hL(t){let e,n=ht(t[2].contrib)+"",s,i,o=ht(ru(t[2].level))+"",r,l,a=t[2].level+"",c,f;return{c(){e=h("span"),s=T(n),i=T(" / "),r=T(o),l=T(" (Lv. "),c=T(a),f=T(" War)"),qe(e,"font-size","14px"),m(e,"class","absCentered textprimary")},m(u,p){w(u,e,p),d(e,s),d(e,i),d(e,r),d(e,l),d(e,c),d(e,f)},p(u,p){p&4&&n!==(n=ht(u[2].contrib)+"")&&G(s,n),p&4&&o!==(o=ht(ru(u[2].level))+"")&&G(r,o),p&4&&a!==(a=u[2].level+"")&&G(c,a)},d(u){u&&x(e)}}}function _C(t,e){let n,s,i,o,r=ht(e[9].stats[1])+"",l,a,c=ht(e[9].stats[2])+"",f,u,p=e[9].stats[0]+"",g,v,_=ht(e[9].stats[3])+"",b,y,k;return i=new zs({props:{name:e[9].name,pclass:e[9].class,level:e[9].level,faction:e[9].faction}}),{key:t,first:null,c(){n=h("tr"),s=h("td"),ne(i.$$.fragment),o=h("td"),l=T(r),a=h("td"),f=T(c),u=h("td"),g=T(p),v=h("td"),b=T(_),m(o,"class","textcenter"),m(a,"class","textcenter"),m(u,"class","textcenter"),m(v,"class","textcenter textfame"),m(n,"class",y="striped "+(I&&I.player&&I.player.name===e[9].name?"selected":"")),this.first=n},m(S,A){w(S,n,A),d(n,s),ee(i,s,null),d(n,o),d(o,l),d(n,a),d(a,f),d(n,u),d(u,g),d(n,v),d(v,b),k=!0},p(S,A){e=S;let F={};A&5&&(F.name=e[9].name),A&5&&(F.pclass=e[9].class),A&5&&(F.level=e[9].level),A&5&&(F.faction=e[9].faction),i.$set(F),(!k||A&5)&&r!==(r=ht(e[9].stats[1])+"")&&G(l,r),(!k||A&5)&&c!==(c=ht(e[9].stats[2])+"")&&G(f,c),(!k||A&5)&&p!==(p=e[9].stats[0]+"")&&G(g,p),(!k||A&5)&&_!==(_=ht(e[9].stats[3])+"")&&G(b,_),(!k||A&5&&y!==(y="striped "+(I&&I.player&&I.player.name===e[9].name?"selected":"")))&&m(n,"class",y)},i(S){k||(P(i.$$.fragment,S),k=!0)},o(S){V(i.$$.fragment,S),k=!1},d(S){S&&x(n),te(i)}}}function gL(t){let e,n,s,i,o,r,l,a,c,f=t[2].kills[0]+"",u,p,g,v,_,b,y=ht(t[2].reward)+"",k,S,A=C.ui.war.status+"",F,M,D,L=C.ui.war.statustypes[t[2].status]+"",E,R,z,q=C.ui.war.duration+"",j,W,N,O=fv(t[2].duration)+"",se,re,ie,ce,ke,ge,Ne,Te,Ce=t[2].kills[1]+"",_e,H,de,Re,Ge,Xe,Ye,pe,ae=C.ui.stats.misc.damage+"",Ue,Z,Q,U=C.ui.stats.misc.healing+"",fe,je,Ve,xe=C.ui.stats.misc.kills+"",ze,Be,mt,wt,Ze,Et,ye=C.ui.stats.misc.fame+"",Je,yt,St,Pe=[],ft=new Map,Ut,Le,Ct;H=new vs({props:{size:"1.3em",fract:~~(t[2].contrib/ru(t[2].level)*100),left:"",right:"",barcol:"bgpurp",$$slots:{default:[hL]},$$scope:{ctx:t}}});let Vt=me(t[2].contributors.sort(t[7])),He=Ke=>Ke[9].name;for(let Ke=0;Ke<Vt.length;Ke+=1){let Me=gC(t,Vt,Ke),ot=He(Me);ft.set(ot,Pe[Ke]=_C(ot,Me))}return{c(){e=h("div"),n=h("div"),s=h("div"),i=h("div"),o=h("span"),o.textContent=`${C.factions[0].name}`,r=h("span"),l=h("img"),c=$e(),u=T(f),p=h("div"),g=h("span"),v=h("img"),b=$e(),k=T(y),S=h("span"),F=T(A),M=T(": "),D=h("span"),E=T(L),z=h("span"),j=T(q),W=T(": "),N=h("span"),se=T(O),re=$e(),ie=h("div"),ce=h("span"),ce.textContent=`${C.factions[1].name}`,ke=h("span"),ge=h("img"),Te=$e(),_e=T(Ce),ne(H.$$.fragment),de=h("div"),Re=h("table"),Ge=h("thead"),Xe=h("tr"),Ye=h("th"),Ye.textContent=`${C.ui.war.player}`,pe=h("th"),Ue=T(ae),Q=h("th"),fe=T(U),Ve=h("th"),ze=T(xe),mt=h("th"),wt=h("img"),Et=$e(),Je=T(ye),St=h("tbody");for(let Ke=0;Ke<Pe.length;Ke+=1)Pe[Ke].c();m(o,"class","infosmall textf0 svelte-19s383j"),qe(o,"margin-top","30px"),m(l,"class","svgicon"),at(l.src,a="/data/ui/icons/pvp.svg?v=8593107")||m(l,"src",a),m(r,"class","infobig textprimary svelte-19s383j"),qe(r,"margin-top","10px"),m(v,"class","svgicon"),at(v.src,_=tr)||m(v,"src",_),m(g,"class","infobig textfame svelte-19s383j"),qe(g,"margin-top","20px"),m(D,"class",R="text"+["red","orange","green"][t[2].status]+" svelte-19s383j"),m(S,"class","infosmall svelte-19s383j"),qe(S,"margin-top","10px"),m(N,"class","textprimary"),m(z,"class","infosmall svelte-19s383j"),qe(z,"margin-bottom","20px"),m(ce,"class","infosmall textf1 svelte-19s383j"),qe(ce,"margin-top","30px"),m(ge,"class","svgicon"),at(ge.src,Ne="/data/ui/icons/pvp.svg?v=8593107")||m(ge,"src",Ne),m(ke,"class","infobig textprimary svelte-19s383j"),qe(ke,"margin-top","10px"),m(s,"class","grid three"),m(n,"class","panel-black border grey"),m(Ye,"width","30%"),m(pe,"class",Z="textcenter "+(t[0]==1?"textwhite":"")),m(Q,"class",je="textcenter "+(t[0]==2?"textwhite":"")),m(Ve,"class",Be="textcenter "+(t[0]==0?"textwhite":"")),m(wt,"class","svgicon"),at(wt.src,Ze=tr)||m(wt,"src",Ze),m(mt,"class",yt="textcenter "+(t[0]==3?"textwhite":"")),m(Xe,"class","textprimary"),m(Re,"class","dense panel-black"),m(de,"class","scrollbar"),m(e,"class","layout svelte-19s383j")},m(Ke,Me){w(Ke,e,Me),d(e,n),d(n,s),d(s,i),d(i,o),d(i,r),d(r,l),d(r,c),d(r,u),d(s,p),d(p,g),d(g,v),d(g,b),d(g,k),d(p,S),d(S,F),d(S,M),d(S,D),d(D,E),d(p,z),d(z,j),d(z,W),d(z,N),d(N,se),d(p,re),d(s,ie),d(ie,ce),d(ie,ke),d(ke,ge),d(ke,Te),d(ke,_e),ee(H,n,null),d(e,de),d(de,Re),d(Re,Ge),d(Ge,Xe),d(Xe,Ye),d(Xe,pe),d(pe,Ue),d(Xe,Q),d(Q,fe),d(Xe,Ve),d(Ve,ze),d(Xe,mt),d(mt,wt),d(mt,Et),d(mt,Je),d(Re,St);for(let ot=0;ot<Pe.length;ot+=1)Pe[ot]&&Pe[ot].m(St,null);Ut=!0,Le||(Ct=[X(pe,"click",t[3]),X(Q,"click",t[4]),X(Ve,"click",t[5]),X(mt,"click",t[6])],Le=!0)},p(Ke,Me){(!Ut||Me&4)&&f!==(f=Ke[2].kills[0]+"")&&G(u,f),(!Ut||Me&4)&&y!==(y=ht(Ke[2].reward)+"")&&G(k,y),(!Ut||Me&4)&&L!==(L=C.ui.war.statustypes[Ke[2].status]+"")&&G(E,L),(!Ut||Me&4&&R!==(R="text"+["red","orange","green"][Ke[2].status]+" svelte-19s383j"))&&m(D,"class",R),(!Ut||Me&4)&&O!==(O=fv(Ke[2].duration)+"")&&G(se,O),(!Ut||Me&4)&&Ce!==(Ce=Ke[2].kills[1]+"")&&G(_e,Ce);let ot={};Me&4&&(ot.fract=~~(Ke[2].contrib/ru(Ke[2].level)*100)),Me&4100&&(ot.$$scope={dirty:Me,ctx:Ke}),H.$set(ot),(!Ut||Me&1&&Z!==(Z="textcenter "+(Ke[0]==1?"textwhite":"")))&&m(pe,"class",Z),(!Ut||Me&1&&je!==(je="textcenter "+(Ke[0]==2?"textwhite":"")))&&m(Q,"class",je),(!Ut||Me&1&&Be!==(Be="textcenter "+(Ke[0]==0?"textwhite":"")))&&m(Ve,"class",Be),(!Ut||Me&1&&yt!==(yt="textcenter "+(Ke[0]==3?"textwhite":"")))&&m(mt,"class",yt),Me&5&&(Vt=me(Ke[2].contributors.sort(Ke[7])),Ee(),Pe=us(Pe,Me,He,1,Ke,Vt,ft,St,Is,_C,null,gC),De())},i(Ke){if(!Ut){P(H.$$.fragment,Ke);for(let Me=0;Me<Vt.length;Me+=1)P(Pe[Me]);Ut=!0}},o(Ke){V(H.$$.fragment,Ke);for(let Me=0;Me<Pe.length;Me+=1)V(Pe[Me]);Ut=!1},d(Ke){Ke&&x(e),te(H);for(let Me=0;Me<Pe.length;Me+=1)Pe[Me].d();Le=!1,lt(Ct)}}}function vL(t){let e,n,s=t[1]&&vC(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[1]?s?(s.p(i,o),o&2&&P(s,1)):(s=vC(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function _L(t,e,n){let s,i;oe(t,$i,p=>n(1,s=p)),oe(t,Oi,p=>n(2,i=p));let o=1;return[o,s,i,()=>n(0,o=1),()=>n(0,o=2),()=>n(0,o=0),()=>n(0,o=3),(p,g)=>g.stats[o]-p.stats[o],()=>{tt($i,s=!1,s)}]}var uv=class extends Fe{constructor(e){super(),Se(this,e,_L,vL,Oe,{})}},bC=uv;function yC(t,e,n){let s=t.slice();return s[15]=e[n],s}function kC(t,e,n){let s=t.slice();return s[18]=e[n],s[20]=n,s}function xC(t){let e,n;return e=new jt({props:{origin:"center",title:C.ui.headers.pvp,icon:"pvp",$$slots:{default:[ML]},$$scope:{ctx:t}}}),e.$on("close",t[13]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&2097278&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function wC(t){let e,n,s;function i(){return t[11](t[20])}return{c(){e=h("div"),e.textContent=`${t[18]}`,m(e,"class","tab"),Do(e,"active",t[20]===t[1])},m(o,r){w(o,e,r),n||(s=X(e,"click",i),n=!0)},p(o,r){t=o,r&2&&Do(e,"active",t[20]===t[1])},d(o){o&&x(e),n=!1,s()}}}function bL(t){let e,n,s,i,o,r,l,a,c=t[5].arena_position+"",f,u,p,g,v=t[5].arena_wins_today+"",_,b,y,k,S=t[5].arena_losses_today+"",A,F,M,D,L,E,R,z,q,j,W,N,O,se,re;i=new bd({props:{amount:t[5].arena_rating}});let ie=me(t[8]),ce=[];for(let Te=0;Te<ie.length;Te+=1)ce[Te]=MC(yC(t,ie,Te));L=new lr({props:{amount:Math.ceil(Rf(t[5].arena_rating)/5)}});let ke=[xL,kL],ge=[];function Ne(Te,Ce){return Te[5].arena_wins_today?0:1}return j=Ne(t,-1),W=ge[j]=ke[j](t),se=new lr({props:{amount:t[5].medals}}),{c(){e=h("div"),n=h("h4"),n.textContent="Current Rating",s=h("h2"),ne(i.$$.fragment),o=h("div");for(let Te=0;Te<ce.length;Te+=1)ce[Te].c();r=h("div"),l=h("span"),l.textContent="Arena Position",a=h("span"),f=T(c),u=h("span"),u.textContent="Wins / Loss Today",p=h("span"),g=h("span"),_=T(v),y=T(" - "),k=h("span"),A=T(S),M=h("span"),M.textContent="Medals per win",D=h("span"),ne(L.$$.fragment),E=h("span"),R=T("End of day bonus"),q=h("span"),W.c(),N=h("span"),N.textContent="Total Medals",O=h("span"),ne(se.$$.fragment),m(n,"class","textgreen"),m(e,"class","textcenter panel-black"),m(o,"class","panel-black marg-top grid two textcenter"),m(l,"class","textwhite"),m(a,"class","textgreen statnumber"),m(u,"class","textwhite"),m(g,"class",b=t[5].arena_wins_today?"textgreen":"textgrey"),m(k,"class",F=t[5].arena_losses_today?"textred":"textgrey"),m(p,"class","textgrey statnumber"),m(M,"class","textwhite"),m(D,"class","statnumber"),m(E,"class",z=t[5].arena_wins_today?"textgreen":"textgrey"),m(q,"class","statnumber"),m(N,"class","textwhite"),m(O,"class","statnumber"),m(r,"class","stats panel-black marg-top svelte-voya4q")},m(Te,Ce){w(Te,e,Ce),d(e,n),d(e,s),ee(i,s,null),w(Te,o,Ce);for(let _e=0;_e<ce.length;_e+=1)ce[_e]&&ce[_e].m(o,null);w(Te,r,Ce),d(r,l),d(r,a),d(a,f),d(r,u),d(r,p),d(p,g),d(g,_),d(p,y),d(p,k),d(k,A),d(r,M),d(r,D),ee(L,D,null),d(r,E),d(E,R),d(r,q),ge[j].m(q,null),d(r,N),d(r,O),ee(se,O,null),re=!0},p(Te,Ce){let _e={};if(Ce&32&&(_e.amount=Te[5].arena_rating),i.$set(_e),Ce&832){ie=me(Te[8]);let Ge;for(Ge=0;Ge<ie.length;Ge+=1){let Xe=yC(Te,ie,Ge);ce[Ge]?ce[Ge].p(Xe,Ce):(ce[Ge]=MC(Xe),ce[Ge].c(),ce[Ge].m(o,null))}for(;Ge<ce.length;Ge+=1)ce[Ge].d(1);ce.length=ie.length}(!re||Ce&32)&&c!==(c=Te[5].arena_position+"")&&G(f,c),(!re||Ce&32)&&v!==(v=Te[5].arena_wins_today+"")&&G(_,v),(!re||Ce&32&&b!==(b=Te[5].arena_wins_today?"textgreen":"textgrey"))&&m(g,"class",b),(!re||Ce&32)&&S!==(S=Te[5].arena_losses_today+"")&&G(A,S),(!re||Ce&32&&F!==(F=Te[5].arena_losses_today?"textred":"textgrey"))&&m(k,"class",F);let H={};Ce&32&&(H.amount=Math.ceil(Rf(Te[5].arena_rating)/5)),L.$set(H),(!re||Ce&32&&z!==(z=Te[5].arena_wins_today?"textgreen":"textgrey"))&&m(E,"class",z);let de=j;j=Ne(Te,Ce),j===de?ge[j].p(Te,Ce):(Ee(),V(ge[de],1,1,()=>{ge[de]=null}),De(),W=ge[j],W?W.p(Te,Ce):(W=ge[j]=ke[j](Te),W.c()),P(W,1),W.m(q,null));let Re={};Ce&32&&(Re.amount=Te[5].medals),se.$set(Re)},i(Te){re||(P(i.$$.fragment,Te),P(L.$$.fragment,Te),P(W),P(se.$$.fragment,Te),re=!0)},o(Te){V(i.$$.fragment,Te),V(L.$$.fragment,Te),V(W),V(se.$$.fragment,Te),re=!1},d(Te){Te&&(x(e),x(o),x(r)),te(i),st(ce,Te),te(L),ge[j].d(),te(se)}}}function yL(t){let e,n,s,i,o,r,l,a,c=ht(t[5].prestige)+"",f,u,p,g,v=ll(t[3],C.ui.title.name[I.player.faction][t[3]-1])+"",_,b=ht(Jg(t[5].prestige))+"",y,k,S,A,F,M,D,L=ht(t[5].kills_today)+"",E,R,z,q,j,W,N=ht(t[5].fame_today)+"",O,se,re,ie,ce,ke,ge=ht(t[5].kills_this_week)+"",Ne,Te,Ce,_e,H,de,Re=ht(t[5].fame)+"",Ge,Xe,Ye,pe=t[5].fame_position+"",ae,Ue,Z,Q=ou(t[5].fame_bracket)+"",U,fe,je,Ve,xe,ze,Be=ht(t[5].kills_last_week)+"",mt,wt,Ze,Et,ye,Je,yt=ht(t[5].fame_last_week)+"",St,Pe,ft,Ut=t[5].fame_position_last_week+"",Le,Ct,Vt,He=ou(t[5].fame_bracket_last_week)+"",Ke,Me,ot,Qe,ut,xn,Ci=ht(t[5].kills_lifetime)+"",ls,Ds,dt,Lt,Si,jn,as=ht(t[5].fame_lifetime)+"",_c,Mr,To,Ai=(t[5].rank_lifetime>0?ll(t[5].rank_lifetime,C.ui.title.name[I.player.faction][t[5].rank_lifetime-1]):"Unranked")+"",pn;return n=new vs({props:{size:"1.5em",fract:t[4],barcol:"bgpurp",$$slots:{default:[wL]},$$scope:{ctx:t}}}),{c(){e=h("div"),ne(n.$$.fragment),s=h("div"),i=h("span"),i.textContent=`${C.ui.pvpmenu.currentprestige}`,o=h("span"),r=h("img"),a=$e(),f=T(c),u=h("span"),u.textContent=`${C.ui.pvpmenu.nextrank}`,p=h("span"),g=new Qu(!1),_=T(" ("),y=T(b),k=T(")"),S=h("div"),A=h("small"),A.textContent=`${C.ui.pvpmenu.today}`,F=h("span"),M=h("span"),M.textContent=`${C.ui.stats.misc.kills}`,D=h("span"),E=T(L),R=h("span"),R.textContent=`${C.ui.stats.misc.fame}`,z=h("span"),q=h("img"),W=$e(),O=T(N),se=h("div"),re=h("small"),re.textContent=`${C.ui.pvpmenu.thisweek}`,ie=h("a"),ie.textContent=`${C.ui.pvpmenu.viewbrackets}`,ce=h("span"),ce.textContent=`${C.ui.stats.misc.kills}`,ke=h("span"),Ne=T(ge),Te=h("span"),Te.textContent=`${C.ui.stats.misc.fame}`,Ce=h("span"),_e=h("img"),de=$e(),Ge=T(Re),Xe=h("span"),Xe.textContent=`${C.ui.pvpmenu.fameposition}`,Ye=h("span"),ae=T(pe),Ue=h("span"),Ue.textContent=`${C.ui.pvpmenu.famebracket}`,Z=h("span"),U=T(Q),fe=h("div"),je=h("small"),je.textContent=`${C.ui.pvpmenu.lastweek}`,Ve=h("span"),xe=h("span"),xe.textContent=`${C.ui.stats.misc.kills}`,ze=h("span"),mt=T(Be),wt=h("span"),wt.textContent=`${C.ui.stats.misc.fame}`,Ze=h("span"),Et=h("img"),Je=$e(),St=T(yt),Pe=h("span"),Pe.textContent=`${C.ui.pvpmenu.fameposition}`,ft=h("span"),Le=T(Ut),Ct=h("span"),Ct.textContent=`${C.ui.pvpmenu.famebracket}`,Vt=h("span"),Ke=T(He),Me=h("div"),ot=h("small"),ot.textContent=`${C.ui.pvpmenu.lifetime}`,Qe=h("span"),ut=h("span"),ut.textContent=`${C.ui.stats.misc.kills}`,xn=h("span"),ls=T(Ci),Ds=h("span"),Ds.textContent=`${C.ui.stats.misc.fame}`,dt=h("span"),Lt=h("img"),jn=$e(),_c=T(as),Mr=h("span"),Mr.textContent=`${C.ui.pvpmenu.highestrank}`,To=h("span"),m(i,"class","textwhite"),m(r,"class","svgicon"),at(r.src,l=Ba)||m(r,"src",l),m(o,"class","textprestige statnumber"),m(u,"class","textwhite"),g.a=_,m(p,"class","textprestige statnumber"),m(s,"class","stats marg-top svelte-voya4q"),m(e,"class","panel-black"),m(A,"class","bold textgreen"),m(M,"class","textwhite"),m(D,"class","textprimary statnumber"),m(R,"class","textwhite"),m(q,"class","svgicon"),at(q.src,j=tr)||m(q,"src",j),m(z,"class","textfame statnumber"),m(S,"class","stats panel-black marg-top svelte-voya4q"),m(re,"class","bold textgreen"),m(ie,"class","statnumber"),m(ie,"href","/pvp"),m(ie,"target","_blank"),m(ie,"rel","noopener noreferrer"),m(ce,"class","textwhite"),m(ke,"class","textprimary statnumber"),m(Te,"class","textwhite"),m(_e,"class","svgicon"),at(_e.src,H=tr)||m(_e,"src",H),m(Ce,"class","textfame statnumber"),m(Xe,"class","textwhite"),m(Ye,"class","textgreen statnumber"),m(Ue,"class","textwhite"),m(Z,"class","textprimary statnumber"),m(se,"class","stats panel-black marg-top svelte-voya4q"),m(je,"class","bold textgreen"),m(xe,"class","textwhite"),m(ze,"class","textprimary statnumber"),m(wt,"class","textwhite"),m(Et,"class","svgicon"),at(Et.src,ye=tr)||m(Et,"src",ye),m(Ze,"class","textfame statnumber"),m(Pe,"class","textwhite"),m(ft,"class","textgreen statnumber"),m(Ct,"class","textwhite"),m(Vt,"class","textprimary statnumber"),m(fe,"class","stats panel-black marg-top svelte-voya4q"),m(ot,"class","bold textgreen"),m(ut,"class","textwhite"),m(xn,"class","textprimary statnumber"),m(Ds,"class","textwhite"),m(Lt,"class","svgicon"),at(Lt.src,Si=tr)||m(Lt,"src",Si),m(dt,"class","textfame statnumber"),m(Mr,"class","textwhite"),m(To,"class","textprestige statnumber"),m(Me,"class","stats panel-black marg-top svelte-voya4q")},m(zt,Kt){w(zt,e,Kt),ee(n,e,null),d(e,s),d(s,i),d(s,o),d(o,r),d(o,a),d(o,f),d(s,u),d(s,p),g.m(v,p),d(p,_),d(p,y),d(p,k),w(zt,S,Kt),d(S,A),d(S,F),d(S,M),d(S,D),d(D,E),d(S,R),d(S,z),d(z,q),d(z,W),d(z,O),w(zt,se,Kt),d(se,re),d(se,ie),d(se,ce),d(se,ke),d(ke,Ne),d(se,Te),d(se,Ce),d(Ce,_e),d(Ce,de),d(Ce,Ge),d(se,Xe),d(se,Ye),d(Ye,ae),d(se,Ue),d(se,Z),d(Z,U),w(zt,fe,Kt),d(fe,je),d(fe,Ve),d(fe,xe),d(fe,ze),d(ze,mt),d(fe,wt),d(fe,Ze),d(Ze,Et),d(Ze,Je),d(Ze,St),d(fe,Pe),d(fe,ft),d(ft,Le),d(fe,Ct),d(fe,Vt),d(Vt,Ke),w(zt,Me,Kt),d(Me,ot),d(Me,Qe),d(Me,ut),d(Me,xn),d(xn,ls),d(Me,Ds),d(Me,dt),d(dt,Lt),d(dt,jn),d(dt,_c),d(Me,Mr),d(Me,To),To.innerHTML=Ai,pn=!0},p(zt,Kt){let cs={};Kt&16&&(cs.fract=zt[4]),Kt&2097156&&(cs.$$scope={dirty:Kt,ctx:zt}),n.$set(cs),(!pn||Kt&32)&&c!==(c=ht(zt[5].prestige)+"")&&G(f,c),(!pn||Kt&8)&&v!==(v=ll(zt[3],C.ui.title.name[I.player.faction][zt[3]-1])+"")&&g.p(v),(!pn||Kt&32)&&b!==(b=ht(Jg(zt[5].prestige))+"")&&G(y,b),(!pn||Kt&32)&&L!==(L=ht(zt[5].kills_today)+"")&&G(E,L),(!pn||Kt&32)&&N!==(N=ht(zt[5].fame_today)+"")&&G(O,N),(!pn||Kt&32)&&ge!==(ge=ht(zt[5].kills_this_week)+"")&&G(Ne,ge),(!pn||Kt&32)&&Re!==(Re=ht(zt[5].fame)+"")&&G(Ge,Re),(!pn||Kt&32)&&pe!==(pe=zt[5].fame_position+"")&&G(ae,pe),(!pn||Kt&32)&&Q!==(Q=ou(zt[5].fame_bracket)+"")&&G(U,Q),(!pn||Kt&32)&&Be!==(Be=ht(zt[5].kills_last_week)+"")&&G(mt,Be),(!pn||Kt&32)&&yt!==(yt=ht(zt[5].fame_last_week)+"")&&G(St,yt),(!pn||Kt&32)&&Ut!==(Ut=zt[5].fame_position_last_week+"")&&G(Le,Ut),(!pn||Kt&32)&&He!==(He=ou(zt[5].fame_bracket_last_week)+"")&&G(Ke,He),(!pn||Kt&32)&&Ci!==(Ci=ht(zt[5].kills_lifetime)+"")&&G(ls,Ci),(!pn||Kt&32)&&as!==(as=ht(zt[5].fame_lifetime)+"")&&G(_c,as),(!pn||Kt&32)&&Ai!==(Ai=(zt[5].rank_lifetime>0?ll(zt[5].rank_lifetime,C.ui.title.name[I.player.faction][zt[5].rank_lifetime-1]):"Unranked")+"")&&(To.innerHTML=Ai)},i(zt){pn||(P(n.$$.fragment,zt),pn=!0)},o(zt){V(n.$$.fragment,zt),pn=!1},d(zt){zt&&(x(e),x(S),x(se),x(fe),x(Me)),te(n)}}}function MC(t){let e,n,s=t[15]+"",i,o,r,l;function a(...c){return t[12](t[15],...c)}return{c(){e=h("div"),n=T("Queue "),i=T(s),m(e,"class",o="btn grey "+(t[6].queues&&t[6].queues.includes("arena"+t[15])?"active":""))},m(c,f){w(c,e,f),d(e,n),d(e,i),r||(l=X(e,"click",a),r=!0)},p(c,f){t=c,f&64&&o!==(o="btn grey "+(t[6].queues&&t[6].queues.includes("arena"+t[15])?"active":""))&&m(e,"class",o)},d(c){c&&x(e),r=!1,l()}}}function kL(t){let e;return{c(){e=T("-")},m(n,s){w(n,e,s)},p:ue,i:ue,o:ue,d(n){n&&x(e)}}}function xL(t){let e,n;return e=new lr({props:{amount:Rf(t[5].arena_rating)}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&32&&(o.amount=Rf(s[5].arena_rating)),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function wL(t){let e,n=(t[2]>0?ll(t[2],C.ui.title.name[I.player.faction][t[2]-1]):"Unranked")+"";return{c(){e=h("span"),m(e,"class","absCentered ranktitle svelte-voya4q")},m(s,i){w(s,e,i),e.innerHTML=n},p(s,i){i&4&&n!==(n=(s[2]>0?ll(s[2],C.ui.title.name[I.player.faction][s[2]-1]):"Unranked")+"")&&(e.innerHTML=n)},d(s){s&&x(e)}}}function ML(t){let e,n,s,i,o,r,l=me(t[7]),a=[];for(let p=0;p<l.length;p+=1)a[p]=wC(kC(t,l,p));let c=[yL,bL],f=[];function u(p,g){return p[1]===0?0:p[1]===1?1:-1}return~(i=u(t,-1))&&(o=f[i]=c[i](t)),{c(){e=h("div"),n=h("div");for(let p=0;p<a.length;p+=1)a[p].c();s=h("div"),o&&o.c(),m(n,"class","tab-bar flex"),m(s,"class","panel-bright"),m(e,"class","container svelte-voya4q")},m(p,g){w(p,e,g),d(e,n);for(let v=0;v<a.length;v+=1)a[v]&&a[v].m(n,null);d(e,s),~i&&f[i].m(s,null),r=!0},p(p,g){if(g&130){l=me(p[7]);let _;for(_=0;_<l.length;_+=1){let b=kC(p,l,_);a[_]?a[_].p(b,g):(a[_]=wC(b),a[_].c(),a[_].m(n,null))}for(;_<a.length;_+=1)a[_].d(1);a.length=l.length}let v=i;i=u(p,g),i===v?~i&&f[i].p(p,g):(o&&(Ee(),V(f[v],1,1,()=>{f[v]=null}),De()),~i?(o=f[i],o?o.p(p,g):(o=f[i]=c[i](p),o.c()),P(o,1),o.m(s,null)):o=null)},i(p){r||(P(o),r=!0)},o(p){V(o),r=!1},d(p){p&&x(e),st(a,p),~i&&f[i].d()}}}function FL(t){let e,n,s=t[0]&&xC(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[0]?s?(s.p(i,o),o&1&&P(s,1)):(s=xC(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function CL(t,e,n){let s,i;oe(t,Qn,k=>n(6,s=k)),oe(t,po,k=>n(0,i=k));let o=["Prestige","Arena"],r=0,l=0,a=1,c=0,f={},u=async()=>{n(5,f=await Ot("/api/pvp/getplayerpvpinfo",{name:I.player.name})),n(2,l=Za(f.prestige)),n(3,a=Math.min(l+1,12));let k=xd(a)-xd(l),S=f.prestige-xd(l);n(4,c=~~(S/k*100))},p=0,g=["3v3","5v5"],v=k=>{xt(s.queues.includes(k)?"stopqueue":"startqueue",k)},_=k=>{n(1,r=k)},b=(k,S)=>v("arena"+k),y=()=>{tt(po,i=!1,i)};return t.$$.update=()=>{t.$$.dirty&1025&&(i&&Date.now()-p>3e4||p===0)&&(u(),n(10,p=Date.now()))},[i,r,l,a,c,f,s,o,g,v,p,_,b,y]}var pv=class extends Fe{constructor(e){super(),Se(this,e,CL,FL,Oe,{})}},FC=pv;function CC(t){let e,n,s=t[1].name+"",i,o,r,l=t[1].level!==void 0?`Lv. ${t[1].level} `:"",a,c,f=(t[1].class!==void 0?C.classes[t[1].class].name:"Item")+"",u,p,g,v=(t[1].faction!==void 0?C.factions[t[1].faction].name:"")+"",_,b;return{c(){e=h("div"),n=h("div"),i=T(s),o=h("div"),r=h("span"),a=T(l),c=h("span"),u=T(f),g=h("span"),_=T(v),m(n,"class","textwhite title svelte-1wip79f"),m(c,"class",p=Eo(t[1].class!==void 0?"textc"+t[1].class:"textyellow")+" svelte-1wip79f"),m(g,"class",b=Eo(t[1].faction!==void 0?"textf"+t[1].faction:"")+" svelte-1wip79f"),m(e,"class","panel-black container svelte-1wip79f"),qe(e,"display",t[0]?"block":"none")},m(y,k){w(y,e,k),d(e,n),d(n,i),d(e,o),d(o,r),d(r,a),d(o,c),d(c,u),d(e,g),d(g,_)},p(y,k){k&2&&s!==(s=y[1].name+"")&&G(i,s),k&2&&l!==(l=y[1].level!==void 0?`Lv. ${y[1].level} `:"")&&G(a,l),k&2&&f!==(f=(y[1].class!==void 0?C.classes[y[1].class].name:"Item")+"")&&G(u,f),k&2&&p!==(p=Eo(y[1].class!==void 0?"textc"+y[1].class:"textyellow")+" svelte-1wip79f")&&m(c,"class",p),k&2&&v!==(v=(y[1].faction!==void 0?C.factions[y[1].faction].name:"")+"")&&G(_,v),k&2&&b!==(b=Eo(y[1].faction!==void 0?"textf"+y[1].faction:"")+" svelte-1wip79f")&&m(g,"class",b),k&1&&qe(e,"display",y[0]?"block":"none")},d(y){y&&x(e)}}}function SL(t){let e,n=t[1]&&CC(t);return{c(){n&&n.c(),e=be()},m(s,i){n&&n.m(s,i),w(s,e,i)},p(s,[i]){s[1]?n?n.p(s,i):(n=CC(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ue,o:ue,d(s){s&&x(e),n&&n.d(s)}}}function AL(t,e,n){let s;oe(t,fp,o=>n(0,s=o));let i;return t.$$.update=()=>{t.$$.dirty&1&&s>0&&I.isEntityIdTaken(s)&&n(1,i=I.entity(s))},[s,i]}var mv=class extends Fe{constructor(e){super(),Se(this,e,AL,SL,Oe,{})}},SC=mv;var dv=ra,lu=async t=>{let e=await Ot("/api/account/info");dv.set(e),qo.set(e.storepoints),t&&t(e)};function PL(t){let e,n,s,i,o,r,l,a,c=C.ui.elixir.chatsupport+"",f,u,p,g,v,_=C.ui.elixir.noads+"",b,y,k,S,A,F,M,D,L,E=C.ui.elixir.bagslots+"",R,z,q,j,W,N,O,se,re,ie=C.ui.elixir.stashstorage+"",ce,ke,ge,Ne,Te,Ce,_e,H,de,Re=C.ui.elixir.merchantlimit+"",Ge,Xe,Ye,pe,ae,Ue,Z,Q,U,fe=C.ui.elixir.merchantduration+"",je,Ve;return{c(){e=h("div"),n=h("div"),n.innerHTML='<img class="artwork svelte-cbx1m" src="/data/ui/elixir.svg?v=8593107"/><div class="sparkle svelte-cbx1m" style="font-size:35px; left:30%; top:30%; animation-delay: -1s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:50px; left:40%; top:60%; animation-delay: -2s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:80px; left:60%; top:20%; animation-delay: -3s;">+</div>',s=h("div"),i=h("h1"),i.innerHTML='Hordes <span class="textsub">Elixir</span>',o=h("div"),r=h("img"),a=$e(),f=T(c),u=h("div"),p=h("img"),v=$e(),b=T(_),y=h("div"),k=h("img"),A=$e(),F=h("span"),F.textContent=`${$n[0].inventory}`,M=$e(),D=h("span"),D.textContent=`${$n[1].inventory}`,L=$e(),R=T(E),z=h("div"),q=h("img"),W=$e(),N=h("span"),N.textContent=`${$n[0].stash}`,O=$e(),se=h("span"),se.textContent=`${$n[1].stash}`,re=$e(),ce=T(ie),ke=h("div"),ge=h("img"),Te=$e(),Ce=h("span"),Ce.textContent=`${$n[0].auction}`,_e=$e(),H=h("span"),H.textContent=`${$n[1].auction}`,de=$e(),Ge=T(Re),Xe=h("div"),Ye=h("img"),ae=$e(),Ue=h("span"),Ue.textContent=`${$n[0].auctionHours}h`,Z=$e(),Q=h("span"),Q.textContent=`${$n[1].auctionHours}h`,U=$e(),je=T(fe),Ve=h("div"),Ve.textContent=`${C.ui.elixir.tba}`,m(n,"class","artcontainer svelte-cbx1m"),m(i,"class","textprimary"),m(r,"class","svgicon"),at(r.src,l="/data/ui/icons/gem.svg?v=8593107")||m(r,"src",l),m(o,"class","textwhite"),m(p,"class","svgicon"),at(p.src,g="/data/ui/icons/check.svg?v=8593107")||m(p,"src",g),m(u,"class","textwhite"),m(k,"class","svgicon"),at(k.src,S="/data/ui/icons/check.svg?v=8593107")||m(k,"src",S),m(F,"class","old svelte-cbx1m"),m(D,"class","textsub"),m(y,"class","textwhite"),m(q,"class","svgicon"),at(q.src,j="/data/ui/icons/check.svg?v=8593107")||m(q,"src",j),m(N,"class","old svelte-cbx1m"),m(se,"class","textsub"),m(z,"class","textwhite"),m(ge,"class","svgicon"),at(ge.src,Ne="/data/ui/icons/check.svg?v=8593107")||m(ge,"src",Ne),m(Ce,"class","old svelte-cbx1m"),m(H,"class","textsub"),m(ke,"class","textwhite"),m(Ye,"class","svgicon"),at(Ye.src,pe="/data/ui/icons/check.svg?v=8593107")||m(Ye,"src",pe),m(Ue,"class","old svelte-cbx1m"),m(Q,"class","textsub"),m(Xe,"class","textwhite"),m(Ve,"class","textgrey"),m(e,"class","split svelte-cbx1m")},m(xe,ze){w(xe,e,ze),d(e,n),d(e,s),d(s,i),d(s,o),d(o,r),d(o,a),d(o,f),d(s,u),d(u,p),d(u,v),d(u,b),d(s,y),d(y,k),d(y,A),d(y,F),d(y,M),d(y,D),d(y,L),d(y,R),d(s,z),d(z,q),d(z,W),d(z,N),d(z,O),d(z,se),d(z,re),d(z,ce),d(s,ke),d(ke,ge),d(ke,Te),d(ke,Ce),d(ke,_e),d(ke,H),d(ke,de),d(ke,Ge),d(s,Xe),d(Xe,Ye),d(Xe,ae),d(Xe,Ue),d(Xe,Z),d(Xe,Q),d(Xe,U),d(Xe,je),d(s,Ve)},p:ue,i:ue,o:ue,d(xe){xe&&x(e)}}}var hv=class extends Fe{constructor(e){super(),Se(this,e,null,PL,Oe,{})}},AC=hv;var ct={SECONDS_A_MINUTE:60,SECONDS_A_HOUR:3600,SECONDS_A_DAY:86400,SECONDS_A_WEEK:604800,MILLISECONDS_A_SECOND:1e3,MILLISECONDS_A_MINUTE:6e4,MILLISECONDS_A_HOUR:36e5,MILLISECONDS_A_DAY:864e5,MILLISECONDS_A_WEEK:6048e5,MS:"millisecond",S:"second",MIN:"minute",H:"hour",D:"day",W:"week",M:"month",Q:"quarter",Y:"year",DATE:"date",FORMAT_DEFAULT:"YYYY-MM-DDTHH:mm:ssZ",INVALID_DATE_STRING:"Invalid Date",REGEX_PARSE:/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,REGEX_FORMAT:/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g},gv=(t,e,n)=>{let s=String(t);return!s||s.length>=e?t:`${Array(e+1-s.length).join(n)}${t}`},TL=t=>{let e=-t.utcOffset(),n=Math.abs(e),s=Math.floor(n/60),i=n%60;return`${e<=0?"+":"-"}${gv(s,2,"0")}:${gv(i,2,"0")}`},EL=(t,e)=>{let n=(e.year()-t.year())*12+(e.month()-t.month()),s=t.clone().add(n,ct.M),i=e-s<0,o=t.clone().add(n+(i?-1:1),ct.M);return Number(-(n+(e-s)/(i?s-o:o-s))||0)},DL=t=>t<0?Math.ceil(t)||0:Math.floor(t),IL=t=>({M:ct.M,y:ct.Y,w:ct.W,d:ct.D,h:ct.H,m:ct.MIN,s:ct.S,ms:ct.MS,Q:ct.Q})[t]||String(t||"").toLowerCase().replace(/s$/,""),VL=t=>t===void 0,LL={s:gv,z:TL,m:EL,a:DL,p:IL,u:VL},qL={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},Md="en",bl={};bl[Md]=qL;var vv=t=>t instanceof Ja,Fd=(t,e,n)=>{let s;if(!t)return Md;if(typeof t=="string")bl[t]&&(s=t),e&&(bl[t]=e,s=t);else{let{name:i}=t;bl[i]=t,s=i}return n||(Md=s),s},Hn=(t,e,n)=>{if(vv(t))return t.clone();let s=e?typeof e=="string"?{format:e,pl:n}:e:{};return s.date=t,new Ja(s)},RL=(t,e)=>Hn(t,{locale:e.$L,utc:e.$u,$offset:e.$offset}),ln=LL;ln.l=Fd;ln.i=vv;ln.w=RL;var zL=t=>{let{date:e,utc:n}=t;if(e===null)return new Date(NaN);if(ln.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){let s=e.match(ct.REGEX_PARSE);if(s)return n?new Date(Date.UTC(s[1],s[2]-1,s[3]||1,s[4]||0,s[5]||0,s[6]||0,s[7]||0)):new Date(s[1],s[2]-1,s[3]||1,s[4]||0,s[5]||0,s[6]||0,s[7]||0)}return new Date(e)},Ja=class{constructor(e){this.$L=this.$L||Fd(e.locale,null,!0),this.parse(e)}parse(e){this.$d=zL(e),this.init()}init(){let{$d:e}=this;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()}$utils(){return ln}isValid(){return this.$d.toString()!==ct.INVALID_DATE_STRING}isSame(e,n){let s=Hn(e);return this.startOf(n)<=s&&s<=this.endOf(n)}isAfter(e,n){return Hn(e)<this.startOf(n)}isBefore(e,n){return this.endOf(n)<Hn(e)}$g(e,n,s){return ln.u(e)?this[n]:this.set(s,e)}year(e){return this.$g(e,"$y",ct.Y)}month(e){return this.$g(e,"$M",ct.M)}day(e){return this.$g(e,"$W",ct.D)}date(e){return this.$g(e,"$D",ct.DATE)}hour(e){return this.$g(e,"$H",ct.H)}minute(e){return this.$g(e,"$m",ct.MIN)}second(e){return this.$g(e,"$s",ct.S)}millisecond(e){return this.$g(e,"$ms",ct.MS)}unix(){return Math.floor(this.valueOf()/1e3)}valueOf(){return this.$d.getTime()}startOf(e,n){let s=ln.u(n)?!0:n,i=ln.p(e),o=(u,p)=>{let g=ln.w(this.$u?Date.UTC(this.$y,p,u):new Date(this.$y,p,u),this);return s?g:g.endOf(ct.D)},r=(u,p)=>{let g=[0,0,0,0],v=[23,59,59,999];return ln.w(this.toDate()[u].apply(this.toDate(),(s?g:v).slice(p)),this)},{$W:l,$M:a,$D:c}=this,f=`set${this.$u?"UTC":""}`;switch(i){case ct.Y:return s?o(1,0):o(31,11);case ct.M:return s?o(1,a):o(0,a+1);case ct.W:{let u=this.$locale().weekStart||0,p=(l<u?l+7:l)-u;return o(s?c-p:c+(6-p),a)}case ct.D:case ct.DATE:return r(`${f}Hours`,0);case ct.H:return r(`${f}Minutes`,1);case ct.MIN:return r(`${f}Seconds`,2);case ct.S:return r(`${f}Milliseconds`,3);default:return this.clone()}}endOf(e){return this.startOf(e,!1)}$set(e,n){let s=ln.p(e),i=`set${this.$u?"UTC":""}`,o={[ct.D]:`${i}Date`,[ct.DATE]:`${i}Date`,[ct.M]:`${i}Month`,[ct.Y]:`${i}FullYear`,[ct.H]:`${i}Hours`,[ct.MIN]:`${i}Minutes`,[ct.S]:`${i}Seconds`,[ct.MS]:`${i}Milliseconds`}[s],r=s===ct.D?this.$D+(n-this.$W):n;if(s===ct.M||s===ct.Y){let l=this.clone().set(ct.DATE,1);l.$d[o](r),l.init(),this.$d=l.set(ct.DATE,Math.min(this.$D,l.daysInMonth())).toDate()}else o&&this.$d[o](r);return this.init(),this}set(e,n){return this.clone().$set(e,n)}get(e){return this[ln.p(e)]()}add(e,n){e=Number(e);let s=ln.p(n),i=l=>{let a=Hn(this);return ln.w(a.date(a.date()+Math.round(l*e)),this)};if(s===ct.M)return this.set(ct.M,this.$M+e);if(s===ct.Y)return this.set(ct.Y,this.$y+e);if(s===ct.D)return i(1);if(s===ct.W)return i(7);let o={[ct.MIN]:ct.MILLISECONDS_A_MINUTE,[ct.H]:ct.MILLISECONDS_A_HOUR,[ct.S]:ct.MILLISECONDS_A_SECOND}[s]||1,r=this.$d.getTime()+e*o;return ln.w(r,this)}subtract(e,n){return this.add(e*-1,n)}format(e){if(!this.isValid())return ct.INVALID_DATE_STRING;let n=e||ct.FORMAT_DEFAULT,s=ln.z(this),i=this.$locale(),{$H:o,$m:r,$M:l}=this,{weekdays:a,months:c,meridiem:f}=i,u=(_,b,y,k)=>_&&(_[b]||_(this,n))||y[b].substr(0,k),p=_=>ln.s(o%12||12,_,"0"),g=f||((_,b,y)=>{let k=_<12?"AM":"PM";return y?k.toLowerCase():k}),v={YY:String(this.$y).slice(-2),YYYY:this.$y,M:l+1,MM:ln.s(l+1,2,"0"),MMM:u(i.monthsShort,l,c,3),MMMM:c[l]||c(this,n),D:this.$D,DD:ln.s(this.$D,2,"0"),d:String(this.$W),dd:u(i.weekdaysMin,this.$W,a,2),ddd:u(i.weekdaysShort,this.$W,a,3),dddd:a[this.$W],H:String(o),HH:ln.s(o,2,"0"),h:p(1),hh:p(2),a:g(o,r,!0),A:g(o,r,!1),m:String(r),mm:ln.s(r,2,"0"),s:String(this.$s),ss:ln.s(this.$s,2,"0"),SSS:ln.s(this.$ms,3,"0"),Z:s};return n.replace(ct.REGEX_FORMAT,(_,b)=>b||v[_]||s.replace(":",""))}utcOffset(){return-Math.round(this.$d.getTimezoneOffset()/15)*15}diff(e,n,s){let i=ln.p(n),o=Hn(e),r=(o.utcOffset()-this.utcOffset())*ct.MILLISECONDS_A_MINUTE,l=this-o,a=ln.m(this,o);return a={[ct.Y]:a/12,[ct.M]:a,[ct.Q]:a/3,[ct.W]:(l-r)/ct.MILLISECONDS_A_WEEK,[ct.D]:(l-r)/ct.MILLISECONDS_A_DAY,[ct.H]:l/ct.MILLISECONDS_A_HOUR,[ct.MIN]:l/ct.MILLISECONDS_A_MINUTE,[ct.S]:l/ct.MILLISECONDS_A_SECOND}[i]||l,s?a:ln.a(a)}daysInMonth(){return this.endOf(ct.M).$D}$locale(){return bl[this.$L]}locale(e,n){if(!e)return this.$L;let s=this.clone();return s.$L=Fd(e,n,!0),s}clone(){return ln.w(this.$d,this)}toDate(){return new Date(this.valueOf())}toJSON(){return this.isValid()?this.toISOString():null}toISOString(){return this.$d.toISOString()}toString(){return this.$d.toUTCString()}};Hn.prototype=Ja.prototype;Hn.extend=(t,e)=>(t(e,Ja,Hn),Hn);Hn.locale=Fd;Hn.isDayjs=vv;Hn.unix=t=>Hn(t*1e3);Hn.en=bl[Md];Hn.Ls=bl;var au=Hn;function PC(t,e,n){let s=t.slice();return s[13]=e[n],s[15]=n,s}function BL(t){let e=C.ui.elixir.notactive+"",n;return{c(){n=T(e)},m(s,i){w(s,n,i)},p:ue,d(s){s&&x(n)}}}function UL(t){let e,n,s,i=au(t[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"",o;return{c(){e=h("img"),s=$e(),o=T(i),m(e,"class","svgicon"),at(e.src,n="/data/ui/icons/check.svg?v=8593107")||m(e,"src",n)},m(r,l){w(r,e,l),w(r,s,l),w(r,o,l)},p(r,l){l&2&&i!==(i=au(r[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"")&&G(o,i)},d(r){r&&(x(e),x(s),x(o))}}}function TC(t){let e,n=t[13].name+"",s,i,o,r,l,a,c;o=new ar({props:{amount:t[13].price}});function f(...u){return t[9](t[15],...u)}return{c(){e=h("btn"),s=T(n),i=$e(),ne(o.$$.fragment),m(e,"class",r="btn black navbtn textwhite "+(t[5]==t[15]?"active":"")+" big")},m(u,p){w(u,e,p),d(e,s),d(e,i),ee(o,e,null),l=!0,a||(c=X(e,"click",f),a=!0)},p(u,p){t=u,(!l||p&32&&r!==(r="btn black navbtn textwhite "+(t[5]==t[15]?"active":"")+" big"))&&m(e,"class",r)},i(u){l||(P(o.$$.fragment,u),l=!0)},o(u){V(o.$$.fragment,u),l=!1},d(u){u&&x(e),te(o),a=!1,c()}}}function EC(t){let e,n=C.ui.elixir.sendgift+"",s,i,o,r;return{c(){e=h("btn"),s=T(n),m(e,"class",i="btn navbtn "+(t[6]?"active white":"textprimary")+" big")},m(l,a){w(l,e,a),d(e,s),o||(r=X(e,"click",t[10]),o=!0)},p(l,a){a&64&&i!==(i="btn navbtn "+(l[6]?"active white":"textprimary")+" big")&&m(e,"class",i)},d(l){l&&x(e),o=!1,r()}}}function OL(t){let e;function n(o,r){return o[0]=="addsubscription"?jL:NL}let s=n(t,-1),i=s(t);return{c(){e=h("div"),i.c(),m(e,"class","fadeIn card marg-top")},m(o,r){w(o,e,r),i.m(e,null)},p(o,r){s!==(s=n(o,r))&&(i.d(1),i=s(o),i&&(i.c(),i.m(e,null)))},i:ue,o:ue,d(o){o&&x(e),i.d()}}}function $L(t){let e,n,s=(t[6]?C.ui.elixir.willgift:C.ui.elixir.willadd)+"",i,o,r,l=C.ui.elixir.subduration[t[5]]+"",a,c,f,u,p=C.ui.elixir.willcost+"",g,v,_,b,y,k,S,A,F=(t[6]?C.ui.elixir.send:t[1].subscribed_until?C.ui.elixir.extend:C.ui.elixir.activate)+"",M,D,L,E,R;v=new ar({props:{amount:t[8].price}});let z=[GL,WL],q=[];function j(O,se){return O[6]?1:0}b=j(t,-1),y=q[b]=z[b](t);let W=t[0]=="addsubscription"&&t[2]&&DC(t),N=t[1].storepoints<t[8].price&&IC(t);return{c(){e=h("div"),n=h("div"),i=T(s),o=$e(),r=h("span"),a=T(l),c=$e(),f=h("span"),f.textContent=`${C.ui.elixir.subscription}`,u=T("? "),g=T(p),ne(v.$$.fragment),_=T("."),y.c(),k=be(),W&&W.c(),S=h("div"),A=h("div"),M=T(F),N&&N.c(),m(r,"class","bold textwhite"),m(f,"class","textsub"),m(n,"class","textgrey"),m(A,"class",D="btn grey formatted "+(t[3]=="addsubscription"||t[1].storepoints<t[8].price?"disabled":"")),m(S,"class","subnav"),m(e,"class","fadeIn card marg-top"),qe(e,"padding","18px")},m(O,se){w(O,e,se),d(e,n),d(n,i),d(n,o),d(n,r),d(r,a),d(n,c),d(n,f),d(n,u),d(n,g),ee(v,n,null),d(n,_),q[b].m(e,null),d(e,k),W&&W.m(e,null),d(e,S),d(S,A),d(A,M),N&&N.m(e,null),L=!0,E||(R=X(A,"click",t[12]),E=!0)},p(O,se){(!L||se&64)&&s!==(s=(O[6]?C.ui.elixir.willgift:C.ui.elixir.willadd)+"")&&G(i,s),(!L||se&32)&&l!==(l=C.ui.elixir.subduration[O[5]]+"")&&G(a,l);let re={};se&256&&(re.amount=O[8].price),v.$set(re);let ie=b;b=j(O,se),b===ie?q[b].p(O,se):(Ee(),V(q[ie],1,1,()=>{q[ie]=null}),De(),y=q[b],y?y.p(O,se):(y=q[b]=z[b](O),y.c()),P(y,1),y.m(e,k)),O[0]=="addsubscription"&&O[2]?W?W.p(O,se):(W=DC(O),W.c(),W.m(e,S)):W&&(W.d(1),W=null),(!L||se&66)&&F!==(F=(O[6]?C.ui.elixir.send:O[1].subscribed_until?C.ui.elixir.extend:C.ui.elixir.activate)+"")&&G(M,F),(!L||se&266&&D!==(D="btn grey formatted "+(O[3]=="addsubscription"||O[1].storepoints<O[8].price?"disabled":"")))&&m(A,"class",D),O[1].storepoints<O[8].price?N||(N=IC(O),N.c(),N.m(e,null)):N&&(N.d(1),N=null)},i(O){L||(P(v.$$.fragment,O),P(y),L=!0)},o(O){V(v.$$.fragment,O),V(y),L=!1},d(O){O&&x(e),te(v),q[b].d(),W&&W.d(),N&&N.d(),E=!1,R()}}}function NL(t){let e;return{c(){e=h("p"),e.textContent="Please Select an option above!",m(e,"class","fadeIn textgrey")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function jL(t){let e;return{c(){e=h("p"),e.textContent=`${C.ui.elixir.thankyou}`,m(e,"class","fadeIn textsub")},m(n,s){w(n,e,s)},d(n){n&&x(e)}}}function WL(t){let e,n,s,i;function o(l){t[11](l)}let r={};return t[7]!==void 0&&(r.name=t[7]),n=new wd({props:r}),Nt.push(()=>Lo(n,"name",o)),{c(){e=h("div"),ne(n.$$.fragment),m(e,"class","subnav")},m(l,a){w(l,e,a),ee(n,e,null),i=!0},p(l,a){let c={};!s&&a&128&&(s=!0,c.name=l[7],Vo(()=>s=!1)),n.$set(c)},i(l){i||(P(n.$$.fragment,l),i=!0)},o(l){V(n.$$.fragment,l),i=!1},d(l){l&&x(e),te(n)}}}function GL(t){let e,n=C.ui.elixir.enable+"",s,i,o,r=au(t[1].subscribed_until||void 0).add(t[8].days,"day").format("MMM DD, YYYY HH:mm")+"",l,a;return{c(){e=h("p"),s=T(n),i=$e(),o=h("span"),l=T(r),a=T("."),m(o,"class","textwhite"),m(e,"class","bold textsub")},m(c,f){w(c,e,f),d(e,s),d(e,i),d(e,o),d(o,l),d(e,a)},p(c,f){f&258&&r!==(r=au(c[1].subscribed_until||void 0).add(c[8].days,"day").format("MMM DD, YYYY HH:mm")+"")&&G(l,r)},i:ue,o:ue,d(c){c&&x(e)}}}function DC(t){let e,n;return{c(){e=h("p"),n=T(t[2]),m(e,"class","fadeIn textred")},m(s,i){w(s,e,i),d(e,n)},p(s,i){i&4&&G(n,s[2])},d(s){s&&x(e)}}}function IC(t){let e,n,s=C.ui.elixir.pointserror+"",i,o,r;return{c(){e=h("p"),n=h("small"),i=T(s),o=$e(),r=h("a"),r.textContent=`${C.ui.elixir.buypoints} ${C.ui.elixir.currency}`,m(r,"class","textprimary"),m(r,"href","/store")},m(l,a){w(l,e,a),d(e,n),d(n,i),d(n,o),d(n,r)},d(l){l&&x(e)}}}function HL(t){let e,n,s,i,o,r,l,a,c,f,u,p,g,v,_,b;n=new AC({});function y(z,q){return z[1].subscribed_until?UL:BL}let k=y(t,-1),S=k(t);a=new ar({props:{amount:t[1].storepoints}});let A=me(pd),F=[];for(let z=0;z<A.length;z+=1)F[z]=TC(PC(t,A,z));let M=z=>V(F[z],1,1,()=>{F[z]=null}),D=t[5]!==void 0&&EC(t),L=[$L,OL],E=[];function R(z,q){return z[5]!==void 0?0:1}return v=R(t,-1),_=E[v]=L[v](t),{c(){e=h("div"),ne(n.$$.fragment),s=h("small"),s.textContent=`${C.ui.elixir.subscription}`,i=h("div"),S.c(),r=h("small"),r.textContent=`${C.ui.elixir.currency}`,l=h("div"),ne(a.$$.fragment),c=$e(),f=h("a"),f.textContent=`${C.ui.elixir.buypoints} ${C.ui.elixir.currency}`,u=h("p"),u.textContent=`${C.ui.elixir.support}`,p=h("div");for(let z=0;z<F.length;z+=1)F[z].c();g=be(),D&&D.c(),_.c(),m(s,"class","textgrey"),m(i,"class",o="cardinfo "+(t[1].subscribed_until?"textsub":"textgrey")),m(r,"class","textgrey"),m(f,"class","textwhite"),m(f,"href","/store"),m(l,"class","cardinfo"),m(u,"class","textgrey"),m(p,"class","subnav"),m(e,"class","card")},m(z,q){w(z,e,q),ee(n,e,null),d(e,s),d(e,i),S.m(i,null),d(e,r),d(e,l),ee(a,l,null),d(l,c),d(l,f),d(e,u),d(e,p);for(let j=0;j<F.length;j+=1)F[j]&&F[j].m(p,null);d(p,g),D&&D.m(p,null),E[v].m(e,null),b=!0},p(z,[q]){k===(k=y(z,q))&&S?S.p(z,q):(S.d(1),S=k(z),S&&(S.c(),S.m(i,null))),(!b||q&2&&o!==(o="cardinfo "+(z[1].subscribed_until?"textsub":"textgrey")))&&m(i,"class",o);let j={};if(q&2&&(j.amount=z[1].storepoints),a.$set(j),q&32){A=me(pd);let N;for(N=0;N<A.length;N+=1){let O=PC(z,A,N);F[N]?(F[N].p(O,q),P(F[N],1)):(F[N]=TC(O),F[N].c(),P(F[N],1),F[N].m(p,g))}for(Ee(),N=A.length;N<F.length;N+=1)M(N);De()}z[5]!==void 0?D?D.p(z,q):(D=EC(z),D.c(),D.m(p,null)):D&&(D.d(1),D=null);let W=v;v=R(z,q),v===W?E[v].p(z,q):(Ee(),V(E[W],1,1,()=>{E[W]=null}),De(),_=E[v],_?_.p(z,q):(_=E[v]=L[v](z),_.c()),P(_,1),_.m(e,null))},i(z){if(!b){P(n.$$.fragment,z),P(a.$$.fragment,z);for(let q=0;q<A.length;q+=1)P(F[q]);P(_),b=!0}},o(z){V(n.$$.fragment,z),V(a.$$.fragment,z),F=F.filter(Boolean);for(let q=0;q<F.length;q+=1)V(F[q]);V(_),b=!1},d(z){z&&x(e),te(n),S.d(),te(a),st(F,z),D&&D.d(),E[v].d()}}}function YL(t,e,n){let s,i,o=!1,r,{user:l}=e,{flash:a=void 0}=e,{flashmsg:c=void 0}=e,{action:f=void 0}=e,{apiCall:u}=e,p=(b,y)=>n(5,i=b),g=b=>n(6,o=!o);function v(b){r=b,n(7,r)}let _=b=>u("addsubscription","/api/account/addsubscription",{value:i,gift:o?r:void 0},!0,y=>{y.result=="ok"&&(n(5,i=void 0),n(0,a="addsubscription"))});return t.$$set=b=>{"user"in b&&n(1,l=b.user),"flash"in b&&n(0,a=b.flash),"flashmsg"in b&&n(2,c=b.flashmsg),"action"in b&&n(3,f=b.action),"apiCall"in b&&n(4,u=b.apiCall)},t.$$.update=()=>{t.$$.dirty&32&&n(8,s=pd[i])},[a,l,c,f,u,i,o,r,s,p,g,v,_]}var _v=class extends Fe{constructor(e){super(),Se(this,e,YL,HL,Oe,{user:1,flash:0,flashmsg:2,action:3,apiCall:4})}},VC=_v;function LC(t){let e,n;return e=new jt({props:{origin:"center",title:"Store / Elixir",icon:"gem",$$slots:{default:[XL]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},p(s,i){let o={};i&316&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function XL(t){let e,n,s;return n=new VC({props:{user:t[5],flash:t[2],flashmsg:t[3],action:t[4],apiCall:t[0]}}),{c(){e=h("div"),ne(n.$$.fragment),m(e,"class","container svelte-1lv1z23")},m(i,o){w(i,e,o),ee(n,e,null),s=!0},p(i,o){let r={};o&32&&(r.user=i[5]),o&4&&(r.flash=i[2]),o&8&&(r.flashmsg=i[3]),o&16&&(r.action=i[4]),n.$set(r)},i(i){s||(P(n.$$.fragment,i),s=!0)},o(i){V(n.$$.fragment,i),s=!1},d(i){i&&x(e),te(n)}}}function QL(t){let e,n,s=t[1]&&t[5]&&LC(t);return{c(){s&&s.c(),e=be()},m(i,o){s&&s.m(i,o),w(i,e,o),n=!0},p(i,[o]){i[1]&&i[5]?s?(s.p(i,o),o&34&&P(s,1)):(s=LC(i),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Ee(),V(s,1,1,()=>{s=null}),De())},i(i){n||(P(s),n=!0)},o(i){V(s),n=!1},d(i){i&&x(e),s&&s.d(i)}}}function ZL(t,e,n){let s,i;oe(t,Ls,u=>n(1,s=u)),oe(t,dv,u=>n(5,i=u));let o,r,l,a,c=async(u,p,g,v,_)=>{n(4,a=u);let b=await Ot(p,g);n(4,a=void 0),b.result==="ok"?n(2,r=void 0):(n(2,r=u),n(3,l=b.result)),v&&lu(),_&&_(b)},f=u=>tt(Ls,s=!1,s);return t.$$.update=()=>{t.$$.dirty&2&&s&&lu()},[c,s,r,l,a,i,f]}var bv=class extends Fe{constructor(e){super(),Se(this,e,ZL,QL,Oe,{apiCall:0})}get apiCall(){return this.$$.ctx[0]}},qC=bv;function RC(t){let e,n;return{c(){e=h("ins"),n=h("script"),n.textContent="(adsbygoogle = window.adsbygoogle || []).push({});",m(e,"class","adsbygoogle"),qe(e,"display","inline-block"),qe(e,"width","728px"),qe(e,"height","90px"),m(e,"data-ad-client","ca-pub-6128207871826113"),m(e,"data-ad-slot","2385450998")},m(s,i){w(s,e,i),w(s,n,i)},d(s){s&&(x(e),x(n))}}}function JL(t){let e,n,s,i,o,r,l,a=t[1]%2==0&&RC(t);return{c(){e=h("div"),n=h("h3"),s=T("Hordes.io is free! Buy "),i=h("span"),i.innerHTML='<span class="textwhite">Hordes</span> <img class="svgicon texticon" src="/data/ui/icons/gem.svg?v=8593107"/>  Elixir',o=T(" to hide this window and support development."),a&&a.c(),m(i,"class","btn textsub"),m(n,"class","textgrey blocktext svelte-svpjti"),m(e,"class","container panel-black svelte-svpjti")},m(c,f){w(c,e,f),d(e,n),d(n,s),d(n,i),d(n,o),a&&a.m(e,null),r||(l=X(i,"click",t[2]),r=!0)},p(c,[f]){c[1]%2==0?a||(a=RC(c),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:ue,o:ue,d(c){c&&x(e),a&&a.d(),r=!1,l()}}}function KL(t,e,n){let s,i;return oe(t,Ls,r=>n(0,s=r)),oe(t,Tr,r=>n(1,i=r)),[s,i,r=>tt(Ls,s=!0,s)]}var yv=class extends Fe{constructor(e){super(),Se(this,e,KL,JL,Oe,{})}},zC=yv;function BC(t,e,n){let s=t.slice();return s[4]=e[n],s}function UC(t){let e,n,s=ns(t[4].viewers)+"",i;return{c(){e=h("div"),n=h("span"),i=T(s),m(n,"class","textgreen"),m(e,"class","bold viewcount textbox svelte-13wcf6i")},m(o,r){w(o,e,r),d(e,n),d(n,i)},p(o,r){r&2&&s!==(s=ns(o[4].viewers)+"")&&G(i,s)},d(o){o&&x(e)}}}function OC(t){let e,n,s,i=t[4].name+"",o,r,l,a,c=t[4].viewers&&UC(t);return{c(){e=h("a"),n=h("div"),c&&c.c(),s=h("div"),o=T(i),m(s,"class","name textbox svelte-13wcf6i"),m(n,"class","border black preview svelte-13wcf6i"),m(n,"style",r=(t[4].preview?"background-image:url("+t[4].preview+");":"")+"); "+(t[0]?"margin-top:2px;":"")),m(e,"class","fadeIn stream svelte-13wcf6i"),m(e,"target","_blank"),m(e,"rel","noopener noreferrer"),m(e,"href",l=t[4].url),m(e,"style",a=t[0]?"":"width:calc(100%/6);")},m(f,u){w(f,e,u),d(e,n),c&&c.m(n,null),d(n,s),d(s,o)},p(f,u){f[4].viewers?c?c.p(f,u):(c=UC(f),c.c(),c.m(n,s)):c&&(c.d(1),c=null),u&2&&i!==(i=f[4].name+"")&&G(o,i),u&3&&r!==(r=(f[4].preview?"background-image:url("+f[4].preview+");":"")+"); "+(f[0]?"margin-top:2px;":""))&&m(n,"style",r),u&2&&l!==(l=f[4].url)&&m(e,"href",l),u&1&&a!==(a=f[0]?"":"width:calc(100%/6);")&&m(e,"style",a)},d(f){f&&x(e),c&&c.d()}}}function eq(t){let e,n,s=me(t[1]),i=[];for(let o=0;o<s.length;o+=1)i[o]=OC(BC(t,s,o));return{c(){e=h("div");for(let o=0;o<i.length;o+=1)i[o].c();m(e,"style",n="pointer-events: all; "+(t[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))},m(o,r){w(o,e,r);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(e,null)},p(o,[r]){if(r&3){s=me(o[1]);let l;for(l=0;l<s.length;l+=1){let a=BC(o,s,l);i[l]?i[l].p(a,r):(i[l]=OC(a),i[l].c(),i[l].m(e,null))}for(;l<i.length;l+=1)i[l].d(1);i.length=s.length}r&1&&n!==(n="pointer-events: all; "+(o[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))&&m(e,"style",n)},i:ue,o:ue,d(o){o&&x(e),st(i,o)}}}function tq(t,e,n){let{vertical:s=!1}=e,i=[],o,r=async()=>{o=setTimeout(r,2e4),n(1,i=await Ot("/api/twitch/streams",{max:6}))};return Pn(r),Tn(l=>{o&&clearTimeout(o)}),t.$$set=l=>{"vertical"in l&&n(0,s=l.vertical)},[s,i]}var kv=class extends Fe{constructor(e){super(),Se(this,e,tq,eq,Oe,{vertical:0})}},$C=kv;function NC(t){let e,n,s=t[1][3]+"",i,o,r=t[1][1]+"",l,a,c,f=t[1][0]+"",u,p,g,v=t[1][2]+"",_,b,y,k=t[1][4]+"",S,A;return{c(){e=h("small"),n=h("div"),i=T(s),o=h("div"),l=T(r),a=T(" fps"),c=h("div"),u=T(f),p=T(" ms"),g=h("div"),_=T(v),b=T(" KBs"),y=h("div"),S=T(k),A=T(" BFR"),m(n,"class","textyellow"),m(o,"class","textgreen"),m(c,"class","textcyan"),m(g,"class","textorange"),m(y,"class","textpurp"),m(e,"class","marg-top bar btn black grey svelte-nijy6x")},m(F,M){w(F,e,M),d(e,n),d(n,i),d(e,o),d(o,l),d(o,a),d(e,c),d(c,u),d(c,p),d(e,g),d(g,_),d(g,b),d(e,y),d(y,S),d(y,A)},p(F,M){M&2&&s!==(s=F[1][3]+"")&&G(i,s),M&2&&r!==(r=F[1][1]+"")&&G(l,r),M&2&&f!==(f=F[1][0]+"")&&G(u,f),M&2&&v!==(v=F[1][2]+"")&&G(_,v),M&2&&k!==(k=F[1][4]+"")&&G(S,k)},d(F){F&&x(e)}}}function nq(t){let e,n=t[0]&&NC(t);return{c(){n&&n.c(),e=be()},m(s,i){n&&n.m(s,i),w(s,e,i)},p(s,[i]){s[0]?n?n.p(s,i):(n=NC(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ue,o:ue,d(s){s&&x(e),n&&n.d(s)}}}function sq(t,e,n){let s,i;return oe(t,ha,o=>n(0,s=o)),oe(t,up,o=>n(1,i=o)),[s,i]}var xv=class extends Fe{constructor(e){super(),Se(this,e,sq,nq,Oe,{})}},jC=xv;var l2={};Xn(l2,{canvas:()=>ys,changeCanvas:()=>l0,init:()=>fR,onWorldDestroy:()=>dR,onWorldEnter:()=>mR,postTick:()=>uR});var Mv=0,si=0,Fv=0,Cv=5,cu=10,fu=10,HC=0,iq,Sv=0,Av=0,Pv=0,Tv=0,YC=(t,e)=>{t=Math.max(150,Math.min(1500,t)),si=t*.8,Fv=Math.min(si,150),Mv=20,Sv=si,Tv=si**2,Av=Math.min(si,50),Pv=Math.min(si/32,150/32)**2,gt.far=HC=t,iq=t**2,Oc(gt),fu=Math.min(si,100+e*50),cu=Math.min(si,40+e*10),Cv=(fu+cu)/2,Nn=Math.ceil(t*2/32),Nn+=Nn%2,mr=Nn/2,mr+=mr%2,oq()},wv=[],pr=[],Cd=[],Ev=0,Dv=0,Iv=-1/0,Vv=-1/0,Lv=-1/0,qv=-1/0,dr=-1/0,uu=-1/0,hr=-1/0,pu=-1/0,Nn=0,mr=0,oq=()=>{let t=mr,e=(Math.min(si*.7,250)/32)**2,n=(Math.max(e,si)/32)**2,s=(HC/32)**2;wv.length=0,pr.length=0;for(let i=0;i<Nn;++i)for(let o=0;o<Nn;++o){let r=(t-o)**2+(t-i)**2,l=0;r>s?l=3:r>n?l=2:r>e&&(l=1),wv.push(r),pr.push(l)}Cd.length=0;for(let i=0;i<Nn;++i)for(let o=0;o<Nn;++o){let r=o%2,a=i%2*2+r,c=Math.min(pr[o+i*Nn],2);if(c<2){let f=pr[Math.min(Nn-1,o+1)+i*Nn]>c,u=pr[Math.max(0,o-1)+i*Nn]>c,p=pr[o+Math.max(0,i-1)*Nn]>c,g=pr[o+Math.min(Nn-1,i+1)*Nn]>c,v=a*33+c*16+((u?1:0)|(p?2:0)|(f?4:0)|(g?8:0));Cd.push(v)}else Cd.push(a*33+c*16)}},Rv=(t,e)=>{if(t<dr||t>=uu||e<hr||e>=pu)return 3;let n=t-dr,s=e-hr;return pr[n+s*Nn]},XC=(t,e)=>{if(t<dr||t>=uu||e<hr||e>=pu)return 1/0;let n=t-dr,s=e-hr;return wv[n+s*Nn]},QC=(t,e)=>{if(t<dr||t>=uu||e<hr||e>=pu)return 2*16;let n=t-dr,s=e-hr;return Cd[n+s*Nn]},WC=-1/0,GC=-1/0,rq=(t,e)=>(t=Math.floor(t/64)*2,e=Math.floor(e/64)*2,t!==WC||e!==GC?(dr=t-mr,uu=t+mr,hr=e-mr,pu=e+mr,Iv=Math.floor(dr/2),Vv=Math.ceil(uu/2),Lv=Math.floor(hr/2),qv=Math.ceil(pu/2),Ev=Math.floor(t/2),Dv=Math.floor(e/2),WC=t,GC=e,!0):!1),zv=!0,ZC=t=>{zv=rq(Gt.position[0],Gt.position[2])};var lq=0,KC=(t,e,n,s=0,i=!1,o=!1)=>{let r={id:lq++,geometry:Cn({}),program:t,shadowProgram:s,mode:e,uniformData:{},individualFrustums:o,dynamic:i,needsUpdate:!1,lastUpdateCamPos:[0,0,0],drawCount:0,cullFace:1029,instances:[],instancedAttributeNames:[],instancedAttributes:[],instancedData:[]};for(let l=0;l<n.length;++l){let a=n[l];JC(r,a.name,a.size)}return JC(r,"worldMatrix",16),r},JC=(t,e,n)=>{t.instancedAttributes.push({name:e,instanced:!0,bufferMode:t.dynamic?35048:35044,size:n,data:new Float32Array(n)}),t.instancedAttributeNames.push(e),t.instancedData.push([])},Bv=t=>{let e=on();e.geometry=t.geometry,e.data.multi=t,t.instances.push(e);for(let n=0;n<t.instancedAttributes.length;++n){let s=t.instancedAttributes[n],i=t.instancedAttributeNames[n];t.instancedData[n].push(e.data[i]=i==="worldMatrix"?e.worldMatrix:Array(s.size).fill(1))}return t.needsUpdate=!0,e},eS=(t,e,n,s)=>{let i=t.instances.indexOf(e),o=t.instancedAttributeNames.indexOf(n);o>=0&&(t.instancedData[o][i]=s,e.data[n]=s)},xi=(t,e)=>{let n=t.instances.indexOf(e);t.instances.splice(n,1);for(let s=0;s<t.instancedAttributes.length;++s)t.instancedData[s].splice(n,1);t.needsUpdate=!0,ui(e)},tS=t=>{for(let e=0;e<t.instances;++e)ui(t[e]);for(let e=0;e<t.instancedAttributes.length;++e)t.instancedData[e].length=0;t.instances.length=0,t.needsUpdate=!0},aq=(t,e)=>{t.needsUpdate=t.dynamic;for(let l=0;l<t.instancedAttributes.length;++l){let a=t.instancedAttributes[l];cq(a,a.size,t.instances.length)}let n=t.dynamic,s=t.individualFrustums,i=t.instancedData,o=t.instances,r=0;for(let l=0;l<o.length;++l){let a=o[l];if(a.visible&&(!n||!s||x_(e,a.geometry,a))){for(let f=0;f<t.instancedAttributes.length;++f){let u=t.instancedAttributes[f],p=u.data,g=i[f][l],v=r*u.size,_=v+u.size;for(let b=v,y=0;b<_;++b,++y)p[b]=g[y]}r++}}if(t.drawCount=r,xm(t.geometry,t.drawCount),t.drawCount!==0)for(let l=0;l<t.instancedAttributes.length;++l){let a=t.instancedAttributes[l];km(t.geometry,a,r)}},Ka=(t,e,n,s)=>{if(n&&t.needsUpdate&&aq(t,s),e.active&&t.drawCount>0){e.cullFace=t.cullFace;for(let i=0;i<e.autoUniforms.length;++i){let o=e.autoUniforms[i];e.uniforms[o].value=t.uniformData[o]}wm(t.uniformData,e),Ca(e,et.currentProgram===e.id),Fa(t.geometry,e,t.mode)}},nS=(t,e)=>{let n={...e};for(let s=0;s<t.instancedAttributeNames.length;++s)n[t.instancedAttributeNames[s]]=t.instancedAttributes[s];Kh(t.geometry,n)},cq=(t,e,n)=>{t.data=t.data.byteLength>=e*n*4?t.data:new Float32Array(e*(n+5))};var So=[],sS=(10+1)*6,kl=new Uint32Array(sS);for(let t=0,e=0;t<sS;t+=6,e+=2)kl[t+0]=e,kl[t+1]=e+1,kl[t+2]=e+3,kl[t+3]=e,kl[t+4]=e+3,kl[t+5]=e+2;var Sd=new Map,iS=(t,e,n,s,i,o)=>{let r=o1.get(t),l=Sd.get(r.steps),a;return!l||l.length===0?a=new Uv(r):a=l.pop(),a.reset(r,e,n,s,i,o),So.push(a),a},oS=(t,e)=>{for(let n=0;n<So.length;n++)if(So[n].tick(t,e),So[n].remove){let s=So.splice(n--,1)[0];rS(s)}},rS=t=>{Sd.has(t.maxSteps)||Sd.set(t.maxSteps,[]),Sd.get(t.maxSteps).push(t),t.onCache()},lS=t=>{So.forEach(rS),So.length=0},aS=()=>{for(let t=0;t<So.length;++t){let e=So[t];e.mesh.transform.visible&&Ks(e.mesh,pt[e.mesh.program])}},Uv=class{constructor(e){this.maxSteps=e.steps,this.stepTimer=new kt(0,1),this.duration=new kt(0,1),this.remove=!1,this.a=[0,0,0],this.b=[0,0,0],this.timeoutSteps=0;let n=this.maxSteps+1;this.uv=new Float32Array(n*4),this.positions=new Float32Array(n*6);for(let s=0,i=0;s<n;++s,i+=4)this.uv[i]=s/this.maxSteps,this.uv[i+2]=s/this.maxSteps,this.uv[i+1]=1,this.uv[i+3]=0;this.geometry=Cn({position:{size:3,data:this.positions},uv:{size:2,data:this.uv},index:{type:$.UNSIGNED_INT,data:kl.subarray(0,6*this.maxSteps)}}),km(this.geometry,this.geometry.attributes.uv,n),this.mesh=qs(this.geometry,19,$.TRIANGLES),this.mesh.uniformData.offset=[0,0],this.waitingForTexture=!1,this.parent=null}reset(e,n,s,i,o,r){this.stepTimer.reset(0,e.interval),this.duration.reset(r,o),this.currentStep=0,this.a=it(this.a,s),this.b=it(this.b,i),this.mesh.uniformData.offset[1]=1/(this.maxSteps+1),this.remove=!1,this.timeoutSteps=0,this.geometry.drawRangeCount=0,this.mesh.uniformData.colStart=e.colStart,this.mesh.uniformData.colEnd=e.colEnd,e.texture>0?(this.waitingForTexture=!0,this.mesh.program=19,gs(e.texture,l=>{this.mesh.uniformData.diffuse=l,this.waitingForTexture=!1})):(this.waitingForTexture=!1,this.mesh.program=18,this.mesh.uniformData.diffuse=void 0),this.parent=n}tick(e,n){if(this.waitingForTexture){this.mesh.transform.visible=!1;return}if(this.duration.duration>0&&this.duration.done(n)){this.remove=!0;return}if(this.parent!==null){if(this.mesh.transform.visible=this.parent.visible&&(!this.parent.parent||this.parent.parent.visible),!this.mesh.transform.visible)return;this.mesh.transform.visible&&this.timeoutSteps==0&&(this.positions.set(Ms(bt,this.a,this.parent.worldMatrix),0),this.positions.set(Ms(bt,this.b,this.parent.worldMatrix),3))}this.stepTimer.done(n)&&(this.stepTimer.reset(n),this.step()),hs(this.geometry,this.geometry.attributes.position);let s=this.stepTimer.fraction(n);this.mesh.uniformData.offset[0]=(1-s)/this.maxSteps}detach(){this.timeoutSteps=Math.max(1,this.currentStep),this.parent=null}step(){this.currentStep=Math.min(this.maxSteps,this.currentStep+1),this.positions.copyWithin(6,0),this.geometry.drawRangeCount=this.currentStep*6,this.timeoutSteps>0&&(this.timeoutSteps--,this.timeoutSteps==0&&(this.remove=!0))}onCache(){this.mesh.transform.visible=!1,this.parent=null}};var Ad=[],xl=1e3,uq=500,ec=uq,_r=[],fS=()=>{gq();for(let t=0;t<xl;++t)Ad.push({pos:[-0,-0,-0],vel:[-0,-0,-0],info:Cm.get(1),distance:0,start:0,end:1.01,forced:!1,scaleRota:[0,0,0,0],infoVec:[0,0,0,0],progVec:[0,0]})},Pd=(t,e,n,s)=>{let i=e,o=n,r=!0,l=n;for(;e-n<0;)r?t[l].distance>t[e].distance?(cS(t,l,e),l=e,n--,r=!r):e++:t[l].distance>=t[n].distance?n--:(cS(t,l,n),e++,l=n,r=!r);l-1>i&&Pd(t,i,l-1,s),l+1<o&&Pd(t,l+1,o,s)},cS=(t,e,n)=>{let s=t[e];t[e]=t[n],t[n]=s},pq=(t,e,n)=>{let s=[[],[]],i=0,o=0;for(;i<_r.length;){let r=_r[i];if(r.start<0||r.end>t){if(_r[o]=r,o++,r.pos[0]>-1e3){let l=r.pos,a=r.vel,c=r.info.acc;if(l[0]+=(a[0]+=c[0]*e)*e,l[1]+=(a[1]+=c[1]*e)*e,l[2]+=(a[2]+=c[2]*e)*e,r.info.friction>0){let f=1-r.info.friction;a[0]*=f,a[1]*=f,a[2]*=f}if(r.distance=mn(n.frustum[5],l)+n.frustumConstants[5],r.distance<Av&&r.distance>0){let f=r.start<0?(Math.sin(t/r.info.duration)+1)*.5:(t-r.start)/r.info.duration;r.progVec[0]=f,r.progVec[1]=ya[r.info.interp](f),s[r.info.blend].push(r)}}}else ec+=r.forced?1:0,Ad.push(r);++i}return _r.length=o,Pd(s[0],0,s[0].length-1,s[0].length),Pd(s[1],0,s[1].length-1,s[1].length),s},mq=t=>{for(let e=0;e<2;++e)hq(t[e],mu[e]),dq(t[e],mu[e],wl[e])},dq=(t,e,n)=>{t.length>0?(n.transform.visible=!0,I3(e,0,t.length),hs(e,e.attributes.position),hs(e,e.attributes.info),hs(e,e.attributes.progress),hs(e,e.attributes.scaleRota),hs(e,e.attributes.colStart),hs(e,e.attributes.colEnd)):n.transform.visible=!1},hq=(t,e)=>{let n=e.attributes.position.data,s=e.attributes.progress.data,i=e.attributes.info.data,o=e.attributes.scaleRota.data,r=e.attributes.colStart.data,l=e.attributes.colEnd.data;for(let a=0;a<t.length;++a){let c=t[a],f=c.pos,u=c.infoVec,p=c.progVec,g=c.scaleRota,v=c.info.colStart,_=c.info.colEnd,b=a*2,y=a*3,k=a*4;n[y]=f[0],n[y+1]=f[1],n[y+2]=f[2],i[k]=u[0],i[k+1]=u[1],i[k+2]=u[2],i[k+3]=u[3],s[b]=p[0],s[b+1]=p[1],o[k]=g[0],o[k+1]=g[1],o[k+2]=g[2],o[k+3]=g[3],r[k]=v[0],r[k+1]=v[1],r[k+2]=v[2],r[k+3]=v[3],l[k]=_[0],l[k+1]=_[1],l[k+2]=_[2],l[k+3]=_[3]}},uS=t=>{let e=pq(_o,t,gt);mq(e)},vr=[0,0,0],Zi=(t,e,n=0,s=0,i=0,o=0,r=0,l=0,a=!1)=>{if(e?Ir(vr,n,s,i,e):Y(vr,n,s,i),a){if(ec<=0)return}else{if(mn(gt.frustum[0],vr)+gt.frustumConstants[0]<0||mn(gt.frustum[1],vr)+gt.frustumConstants[1]<0)return;let v=mn(gt.frustum[5],vr)+gt.frustumConstants[5];if(v<0||v*10>Ad.length)return}let c=Ad.pop();if(!c){let v=_r.length-1;for(;v>=0&&_r[v].forced;)--v;v>=0&&(c=_r.splice(v,1)[0])}if(!c)return;let f=1;if(e){let v=e[0],_=e[1],b=e[2];f=Math.sqrt(v*v+_*_+b*b),xp(c.vel,o,r,l,e)}else Y(c.vel,o,r,l);c.pos[0]=vr[0],c.pos[1]=vr[1],c.pos[2]=vr[2];let u=Cm.get(t);c.info=u,c.start=a?-1:_o,c.end=c.start+c.info.duration;let p=Math.random()*u.randomRota,g=p+u.rota;return Math.random()<.5&&(p*=-1,g*=-1),es(c.scaleRota,u.scaleStart*f,u.scaleEnd*f,p,g),es(c.infoVec,u.idLoop,0,u.idStart,u.idEnd+1),ds(c.progVec,0,0),c.forced=a,_r.push(c),a&&ec--,c},wl=[],mu=[],gq=()=>{for(let t=0;t<2;++t)mu[t]=Cn({position:{size:3,data:new Float32Array(3*xl)},progress:{size:2,data:new Float32Array(2*xl)},info:{size:4,data:new Float32Array(4*xl)},scaleRota:{size:4,data:new Float32Array(4*xl)},colStart:{size:4,data:new Float32Array(4*xl)},colEnd:{size:4,data:new Float32Array(4*xl)}});wl[0]=qs(mu[0],17,$.POINTS),wl[1]=qs(mu[1],16,$.POINTS),gs(1215,t=>{Vn("particleDiffuse",t,0,pt[17]),Vn("particleDiffuse",t,0,pt[16])})};var pS=()=>{let t=pt[17];t.active&&wl[0].transform.visible&&Ks(wl[0],t)},mS=()=>{let t=pt[16];t.active&&wl[1].transform.visible&&Ks(wl[1],t)};var hu=[],Td,du,dS,hS=()=>{du=Ht.pointlights.data.lightCols,Td=Ht.pointlights.data.lightPos,dS=Ht.pointlights.data.lightCount},gS=t=>{let e=[0,0,0],n=[];for(let i=0,o=hu.length;i<o;++i){let r=hu[i];r.remove?(hu.splice(i,1),--i,--o):r.transform.visible&&(Y(e,r.transform.worldMatrix[12],r.transform.worldMatrix[13],r.transform.worldMatrix[14]),r.distance=Kn(gt.worldPosition,e),r.distance<Tv&&n.push(r))}n.sort((i,o)=>i.distance-o.distance);let s=Math.min(n.length,16);for(let i=0;i<s;++i){let o=n[i],r=i*4,l=i*3;Td[l]=o.transform.worldMatrix[12],Td[l+1]=o.transform.worldMatrix[13],Td[l+2]=o.transform.worldMatrix[14],du[r]=o.value[0],du[r+1]=o.value[1],du[r+2]=o.value[2],du[r+3]=o.value[3]}dS[0]=s,is(Ht.pointlights)},vS=(t,e,n)=>{let s={transform:n,distance:0,remove:!1,value:[...t,e]};return hu.push(s),s},_S=t=>{hu.length=0};var Ml=[Uc(1,1),Uc(1,1)],tc=!1,bS=0,yS=t=>{bS=t},gu=t=>{tc=t},kS=t=>{let n=[cu,fu],s=[5,20,20];for(let i=0;i<Ml.length;++i){let o=Ml[i],r=n[i],l=[0,0,0];xp(l,1,1,1,o.transform.worldMatrix);let a=[...Gt.position],c=s[i];for(let g=0;g<3;++g)a[g]=Math.floor(a[g]/c)*c;let f=(Math.abs(Math.cos(-1))+Math.abs(Math.sin(-1)))*r,u=r,p=[u,f,f];for(let g=0;g<3;++g){let v=p[g]*2/bS,_=a[g]*l[g];_=_-_%v,_=_/l[g],a[g]=_}g_(o.transform.position,a)||(it(o.transform.position,a),Y(o.transform.rotation,-1,0,0),o.far=f,o.near=-1e3,k_(o,-u,u,-f,f),fa(o,!0),Sp(o),tc=!0)}if(tc){let i=Ht.shadows.data;Mo(i.shadowRange,[cu,Cv,fu],0),Mo(i.shadowPVMatrix,Ml[0].projectionViewMatrix,0),Mo(i.shadowPVMatrix,Ml[1].projectionViewMatrix,16),is(Ht.shadows)}return tc?1:0};var Ed=new Map,Dd=[],Id=[],Vd=[],Ld=[],qd=[],Ji=(t,e,n,s)=>{let i=t<<1|e;if(i=i<<1|n,i=i<<1|s,Ed.has(i))return Bv(Ed.get(i));{let o=bq(t,e,n,s);return Ed.set(i,o),Bv(o)}},wS=(t,e,n,s)=>{t?e?Id.push(s):Vd.push(s):Dd.push(s),n===2?(gu(!0),Ld.push(s)):n===1&&(gu(!0),qd.push(s))},bq=(t,e,n,s)=>{let i=_i.get(t),o=J1[i.shader],r=pt[o],l=le.shadows&&e?i.texture?1:2:0,a=KC(o,$.TRIANGLES,r.instancedAttributes,l,n,s);a.cullFace=i.cull?$.BACK:$.NONE;let c=!1,f=!1;return i.texture?gs(i.texture,u=>{f=!0,a.uniformData.diffuse=u,c&&wS(r.transparent,r.depthWrite,le.shadows&&e?n?2:1:0,a)}):f=!0,Qo(i.geometry,u=>{nS(a,u),c=!0,f&&wS(r.transparent,r.depthWrite,le.shadows&&e?n?2:1:0,a)}),a},MS=()=>{Ed.forEach(tS)};var FS=[{fun:(t,e,n)=>{Zi(e[0],t.transform.worldMatrix,e[1],e[2],e[3],e[4],e[5],e[6],!1)}},{fun:(t,e,n)=>{let s=e[1],i=Math.PI*2/s;for(let o=0;o<s;++o){let r=Math.sin(o*i),l=Math.cos(o*i);Zi(e[0],t.transform.worldMatrix,r*e[6]+e[2],e[3],l*e[6]+e[4],r*e[5],0,l*e[5],!1)}}},{fun:(t,e,n)=>{for(let s=0;s<e[1];++s)Zi(e[0],t.transform.worldMatrix,e[2],e[3],e[4],Zt(e[5],e[6]),Zt(e[7],e[8]),Zt(e[9],e[10]),!1)}},{fun:(t,e,n)=>{Xi(e[0],t.transform,t.priority,!1,1)}}];var $v=[{create:(t,e)=>vS([e[0],e[1],e[2]],e[3],t.transform),tick:(t,e,n,s,i)=>{},end:(t,e,n)=>{n.remove=!0},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,s,i)=>{let o=ya[e[2]](i);n.value[3]=e[0]+o*(e[1]-e[0])}]},{create:(t,e)=>[0,0,0,0],tick:(t,e,n,s,i)=>{n[0]>=e[1]&&(n[0]=0,Zi(e[0],t.transform.worldMatrix,Zt(e[2],e[3])+n[1],Zt(e[4],e[5])+n[2],Zt(e[6],e[7])+n[3],Zt(e[8],e[9]),Zt(e[10],e[11]),Zt(e[12],e[13]),!1)),n[0]+=~~(s*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,s,i)=>{let o=e[1]*i;n[1]=Math.sin(o)*e[0],n[3]=Math.cos(o)*e[0]}]},{create:(t,e)=>{if(ec>0)return Zi(e[0],t.transform.worldMatrix,0,0,0,0,0,0,!0)},tick:(t,e,n,s,i)=>{},end:(t,e,n)=>{n.start=1,n.end=1},show:(t,e,n)=>{},hide:(t,e,n)=>{n.pos[0]=-1e3},modifiers:[(t,e,n,s,i)=>{let o=e[1]*i;Ir(n.pos,Math.sin(o)*e[0],0,Math.cos(o)*e[0],t.transform.worldMatrix)},(t,e,n,s,i)=>{Ir(n.pos,e[0],e[1],e[2],t.transform.worldMatrix)}]},{create:(t,e)=>Xi(e[0],t.transform,t.priority,!0,1),tick:(t,e,n,s,i)=>{},end:(t,e,n)=>{n.stop()},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>{let n=Ji(e[0],!1,!0,!0);return Y(n.position,e[1],e[2],e[3]),Y(n.scale,e[4],e[5],e[6]),Y(n.rotation,e[7],e[8],e[9]),Mn(n,t.transform),qt(n,!1),n},tick:(t,e,n,s,i)=>{},end:(t,e,n)=>{xi(n.data.multi,n)},show:(t,e,n)=>{n.visible=!0},hide:(t,e,n)=>{n.visible=!1},modifiers:[(t,e,n,s,i)=>{let o=e[1]*i;n.rotation[1]=e[2]+o,n.position[0]=Math.sin(o)*e[0],n.position[2]=Math.cos(o)*e[0],n.matrixNeedsUpdate=!0,qt(n,!1)},(t,e,n,s,i)=>{let o=n.data.multi.instancedAttributes[e[0]];for(let r=0;r<o.size;++r)n.data[o.name][r]=e[1+r]},(t,e,n,s,i)=>{let o=n.data.multi.instancedAttributes[e[0]];for(let r=0;r<o.size;++r){let l=e[1+r],a=e[5+r];n.data[o.name][r]=l+i*(a-l)}},(t,e,n,s,i)=>{let o=ya[e[6]](i);n.scale[0]=e[0]+o*(e[3]-e[0]),n.scale[1]=e[1]+o*(e[4]-e[1]),n.scale[2]=e[2]+o*(e[5]-e[2]),n.matrixNeedsUpdate=!0},(t,e,n,s,i)=>{let o=ya[e[6]](i);n.rotation[0]=e[0]+o*(e[3]-e[0]),n.rotation[1]=e[1]+o*(e[4]-e[1]),n.rotation[2]=e[2]+o*(e[5]-e[2]),n.matrixNeedsUpdate=!0}]},{create:(t,e)=>iS(e[0],t.transform,[e[1],e[2],e[3]],[e[4],e[5],e[6]],0,0),tick:(t,e,n,s,i)=>{},end:(t,e,n)=>{n.detach()},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,s,i)=>{let o=e[1]*i;n.b[0]=n.a[0]=Math.sin(o)*e[0],n.b[2]=n.a[2]=Math.cos(o)*e[0]}]},{create:(t,e)=>{if(ec<e[1])return;let n=[];for(let s=0;s<e[1];++s)n.push(Zi(e[0],t.transform.worldMatrix,0,0,0,0,0,0,!0));return n},tick:(t,e,n,s,i)=>{},end:(t,e,n)=>{for(let s=0;s<n.length;++s){let i=n[s];i.start=i.end=1}},show:(t,e,n)=>{},hide:(t,e,n)=>{for(let s=0;s<n.length;++s){let i=n[s];i.pos[0]=-1e3}},modifiers:[(t,e,n,s,i)=>{let o=n.length,r=6.283/o,l=e[0],a=e[1]*i;for(let c=0;c<o;++c){let f=n[c],u=r*c+a;Ir(f.pos,Math.sin(u)*l,0,Math.cos(u)*l,t.transform.worldMatrix)}}]},{create:(t,e)=>[0,0],tick:(t,e,n,s,i)=>{if(n[0]>=e[6]){n[0]=0;let o=e[1],r=Math.PI*2/o;for(let l=0;l<o;++l)Zi(e[0],t.transform.worldMatrix,e[2],e[3],e[4],Math.sin(l*r+n[1])*e[5],0,Math.cos(l*r+n[1])*e[5],!1)}n[0]+=~~(s*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,s,i)=>{n[1]=e[0]*i}]},{create:(t,e)=>[0],tick:(t,e,n,s,i)=>{if(n[0]>=e[1]){n[0]=0;let o=on();Y(o.rotation,Zt(e[8],e[9]),Zt(e[10],e[11]),Zt(e[12],e[13])),Ov(e[0],o,t.priority,!0),Ir(o.position,Zt(e[2],e[3]),Zt(e[4],e[5]),Zt(e[6],e[7]),t.transform.worldMatrix),lo(o,!1)}n[0]+=~~(s*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>{let n=Math.sin(t.transform.rotation[1])*Math.cos(t.transform.rotation[0])*e[0],s=-Math.sin(t.transform.rotation[0])*e[0],i=Math.cos(t.transform.rotation[1])*Math.cos(t.transform.rotation[0])*e[0],o=t.info.duration,r=o;if(e[1]){let l=I.raycastEnvironmentClosest(t.transform.position[0],t.transform.position[1],t.transform.position[2],n*o,s*o,i*o);l<1&&(r=o*l)}return[n,s,i,r]},tick:(t,e,n,s,i)=>{if(e[1]&&(n[3]-=s,n[3]<=0)){t.done=!0;return}t.transform.position[0]+=n[0]*s,t.transform.position[1]+=n[1]*s,t.transform.position[2]+=n[2]*s,t.transform.matrixNeedsUpdate=!0,qt(t.transform,!1)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>[],tick:(t,e,n,s,i)=>{},end:(t,e,n)=>{let s=on();it(s.position,t.transform.position),it(s.rotation,t.transform.rotation),Ov(e[0],s,t.priority,!0),lo(s,!1)},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]}],Ov,CS=t=>{Ov=t};var Es=[],Fl=[],Cl=[],vu=[],SS=(t,e)=>{let n=Sv;Mq(t,e,n),Fq(t,e,n),Cq(t,e,n),Sq(t,e),Aq(t,e),Pq(t,e);for(let s=0;s<Es.length;++s){let i=Es[s],o=i.visible!==i.transform.visible;if(i.visible=i.transform.visible,i.visible)for(let r=0;r<i.info.events.length;++r){let l=i.info.events[r];(i.loops===0||l.fraction>0)&&i.fractionLast<=l.fraction&&i.fractionNow>l.fraction&&FS[l.id].fun(i,l.params,t)}for(let r=0;r<i.info.periods.length;++r){let l=i.info.periods[r],a=$v[l.id],c=i.periodData[r]!==void 0,f=i.fractionNow>=l.fractionStart&&i.fractionNow<=l.fractionEnd,u=!1;if(i.visible&&f&&!c&&i.fractionLast<=l.fractionStart&&(c=(i.periodData[r]=a.create(i,l.params,t))!==void 0,u=c),f&&c&&(o&&(i.visible?a.show(i,l.params,i.periodData[r]):a.hide(i,l.params,i.periodData[r])),i.visible)){let p=i.periodData[r],g=(i.fractionNow-l.fractionStart)/(l.fractionEnd-l.fractionStart);a.tick(i,l.params,p,t,g);for(let v=0;v<l.modifiers.length;++v){let _=l.modifiers[v];(u||o||_.mode===1)&&a.modifiers[_.id](i,_.params,p,t,g)}}!f&&c&&(a.end(i,l.params,i.periodData[r]),i.periodData[r]=void 0)}i.visible&&i.returnTransform&&i.transform.parent===null&&qt(i.transform,!1)}},Nv=[],jv=(t,e,n,s)=>Nv.length>0?xq(Nv.pop(),t,e,n,s):kq(t,e,n,s),kq=(t,e,n,s)=>({info:t,priority:n,transform:e,returnTransform:s,visible:!0,fractionNow:0,fractionLast:0,timeEnd:0,periodData:[],done:!1,loops:0}),xq=(t,e,n,s,i)=>(t.info=e,t.priority=s,t.transform=n,t.returnTransform=i,t),wq=t=>(t.visible=!0,t.fractionNow=0,t.fractionLast=0,t.timeEnd=0,t.periodData.length=0,t.done=!1,t.loops=0,t),Rd=t=>{Tq(t),t.returnTransform&&ui(t.transform),Nv.push(wq(t))},wi=(t,e,n,s)=>{let i=Sf.get(t),o=jv(i,e,n,s);return Es.push(o),Fl.push(o),o},Bs=(t,e,n,s)=>{let i=Sf.get(t),o=jv(i,e,n,s);return Es.push(o),Cl.push(o),o},AS=(t,e,n,s)=>{let i=Sf.get(t),o=jv(i,e,n,s);return Es.push(o),vu.push(o),o},Mq=(t,e,n)=>{for(let s=0;s<Fl.length;++s){let i=Fl[s];i.info.duration===0?i.timeEnd===0?(i.timeEnd=e+i.info.duration,i.fractionLast=0,i.fractionNow=.999):(i.fractionLast=0,i.fractionNow=1):(i.timeEnd===0&&(i.timeEnd=e+i.info.duration),i.fractionLast=i.fractionNow,i.fractionNow=vt(1-(i.timeEnd-e)/i.info.duration,0,1))}},Fq=t=>{for(let e=0;e<Cl.length;++e){let n=Cl[e];n.fractionLast=n.fractionNow,n.fractionNow=(n.fractionNow+t/n.info.duration)%1,n.fractionLast>n.fractionNow&&(n.fractionLast=0,n.loops++)}},Cq=(t,e,n)=>{},Sq=(t,e,n)=>{let s=Fl.length;for(;s--;){let i=Fl[s];(i.fractionNow===1||i.done)&&(Fl.splice(s,1),Es.splice(Es.indexOf(i),1),Rd(i))}},Aq=(t,e,n)=>{let s=Cl.length;for(;s--;){let i=Cl[s];i.done&&(Cl.splice(s,1),Es.splice(Es.indexOf(i),1),Rd(i))}},Pq=(t,e,n)=>{let s=vu.length;for(;s--;){let i=vu[s];i.done&&(vu.splice(s,1),Es.splice(Es.indexOf(i),1),Rd(i))}},Tq=t=>{for(let e=0;e<t.info.periods.length;++e){let n=t.info.periods[e],s=$v[n.id];t.periodData[e]!==void 0&&(s.end(t,n.params,t.periodData[e]),t.periodData[e]=void 0)}},PS=t=>{for(let e=0;e<Es.length;++e)Rd(Es[e]);Es.length=0,Fl.length=0,Cl.length=0,vu.length=0};CS(wi);var nc=[0,2,2.3],sc=[0,0,0];Zn(nc,nc);var an={},Ud=["fog","sun","direct","ambient","skytop","skymid","skybot","horizon","water","clouds"],Od=["bloom"];for(let t=0;t<Ud.length;++t)an[Ud[t]]=[[.5,.5,.5],[.5,.5,.5],[.5,.5,.5]];for(let t=0;t<Od.length;++t)an[Od[t]]=[0,0,0];var TS=(t,e,n,s)=>{Vq(),Rq(t,n,e),Lq(),e>0&&qq(e,s),is(Ht.sky),is(Ht.environment);let i=Ht.environment.data;$.clearColor(i.fog[0],i.fog[1],i.fog[2],1)},Dq=(t,e,n,s,i,o,r)=>{let l=[0,0,0],a=[0,0,0];ca(l,e,n,o),ca(a,s,i,o),ca(t,l,a,r)},Iq=(t,e,n,s,i,o)=>{let r=bf(i,t,e),l=bf(i,n,s);return bf(o,r,l)},Ki=(t,e,n,s,i)=>{let o=[0,0,0],r=[0,0,0];dn(o,n,1-i),dn(r,s,i),t[e]=o[0]+r[0],t[e+1]=o[1]+r[1],t[e+2]=o[2]+r[2]},Vq=()=>{let t=Gt.position[0],e=Gt.position[2],n=t,s=e,i=t+32,o=e+32,r=Da.get(I.getEnvironmentId(n,s)),l=Da.get(I.getEnvironmentId(i,s)),a=Da.get(I.getEnvironmentId(n,o)),c=Da.get(I.getEnvironmentId(i,o));if(!r||!l||!a||!c)return;let f=t/32%1,u=e/32%1;for(let p=0;p<Ud.length;++p){let g=Ud[p];for(let v=0;v<3;++v)Dq(an[g][v],r[g][v],l[g][v],a[g][v],c[g][v],f,u)}for(let p=0;p<Od.length;++p){let g=Od[p];for(let v=0;v<3;++v)an[g][v]=Iq(r[g][v],l[g][v],a[g][v],c[g][v],f,u)}},Lq=()=>{let t=Ht.environment.data.watercolors;for(let e=0;e<9;++e)t[e]=an.water[Math.floor(e/3)][e%3]},qq=(t,e)=>{let n=Ht.environment.data.worldlight,s=[0,0,0],i=Math.max(0,1-t/80),o=Math.min(1,1-i);Ki(s,0,an.water[1],an.water[2],o);let r=[0,0,0];r[0]=(n[0]+n[3])*s[0]*1.5,r[1]=(n[1]+n[4])*s[1]*1.5,r[2]=(n[2]+n[5])*s[2]*1.5;let l=Ht.sky.data.skycolors,a=Ht.sky.data.suncolor,c=Ht.environment.data.worldlight,f=Ht.environment.data.fog,u=Math.max(.2,.5*i),p=Math.min(.4,Math.max(.1,.5*i)),g=Math.max(.3,.7*i);for(let v=0;v<15;++v)l[v]=u*r[v%3];Y(f,u*r[0],u*r[1],u*r[2]),it(a,f);for(let v=0;v<9;++v)Ht.environment.data.watercolors[v]=p;for(let v=0;v<6;++v)c[v]=g*r[v%3]},zd=0,Ao=1,Bd=2,$d=[{from:Ao,to:zd,start:0,end:0,dur:0},{from:zd,to:zd,start:0,end:0,dur:0},{from:zd,to:Ao,start:0,end:0,dur:0},{from:Ao,to:Ao,start:0,end:0,dur:0},{from:Ao,to:Bd,start:0,end:0,dur:0},{from:Bd,to:Bd,start:0,end:0,dur:0},{from:Bd,to:Ao,start:0,end:0,dur:0},{from:Ao,to:Ao,start:0,end:0,dur:0}],ES=0;$d.forEach(t=>{let e=t.from!==t.to,n=!e&&t.from!==Ao;e?t.dur=.5:n?t.dur=5:t.dur=1.5,ES+=t.dur});var Wv=0;$d.forEach(t=>{t.start=Wv,Wv=t.end=Wv+1/ES*t.dur});var Rq=(t,e,n)=>{t=vt(t,0,1);let s=.5,i=0,o=0;for(let a=0;a<$d.length;++a){let c=$d[a];if(c.end>=t){s=_f(c.start,c.end,t),i=c.from,o=c.to;break}}let r=Ht.sky.data;Ki(r.skycolors,0,an.skytop[i],an.skytop[o],s),Ki(r.skycolors,3,an.skymid[i],an.skymid[o],s),Ki(r.skycolors,6,an.skybot[i],an.skybot[o],s),Ki(r.skycolors,9,an.horizon[i],an.horizon[o],s),Ki(r.skycolors,12,an.clouds[i],an.clouds[o],s),Ki(r.suncolor,0,an.sun[i],an.sun[o],s),it(sc,nc),sc[1]=Math.abs(Math.sin(t*6.282)),Zn(sc,sc);let l=Ht.environment.data;Ki(l.worldlight,0,an.direct[i],an.direct[o],s),Ki(l.worldlight,3,an.ambient[i],an.ambient[o],s),l.worldlight[6]=nc[0],l.worldlight[7]=nc[1],l.worldlight[8]=nc[2],Ki(l.fog,0,an.fog[i],an.fog[o],s),l.fog[3]=n>0?-100:Mv,l.fog[4]=n>0?Fv:si,l.daycycle[0]=t,l.time[0]=e%3600,pt[31].uniforms.amount.value=bf(s,an.bloom[i],an.bloom[o])};var zq=[],Bq=[],IS=(t,e)=>{if(gn===void 0||gn.suspended)return;let n=gn.currentTime,s=Af.get(I.getAreaId(Gt.position[0],Gt.position[2])),o=t>.5?s.ambientnight:s.ambientday,r=5;e>0&&(o=167,r=.5),DS(zq,n,r,o,!1),DS(Bq,n,5,s.music,!0)},DS=(t,e,n,s,i)=>{let o=!1;for(let r=t.length-1;r>=0;--r){let l=t[r],a=l.sound,c=a.gain.gain;l.id===s&&!a.ended?(o=!0,l.fade!==1&&(l.fade=1,c.setTargetAtTime(1,e,n))):c.value<.02||a.ended?(a.stop(),t.splice(r,1)):l.fade!==0&&(l.fade=0,c.setTargetAtTime(0,e,l.fadeDuration))}if(!o&&s!==0){let r=i?ry(s,3):oy(s,2);r&&(r.gain.gain.setValueAtTime(0,e),t.push({id:s,sound:r,fade:0,fadeDuration:n}))}};var Po=[0,0,0,0],VS=(t,e,n,s)=>{if(I.player&&I.player.buffs.buffs.has(128))Po[0]=.2,Po[1]=.4,Po[2]=.4,Po[3]=.7,s.add(33),pt[33].uniforms.warp.value=.1,pt[31].uniforms.amount.value=3;else if(e>0){let i=Ht.environment.data.fog;Po[0]=i[0],Po[1]=i[1],Po[2]=i[2],Po[3]=.5,s.add(33),pt[33].uniforms.warp.value=.3,pt[31].uniforms.amount.value=Math.min(3,Math.max(.3,e/10))}pt[33].uniforms.tint.value=Po};var LS=()=>{},Nd=0,jd=t=>Nd=t,qS=(t,e,n)=>{let s=(e/3600+.9)%1;s<.7?s=_f(0,.7,s)*.4:s=.4+_f(.7,1,s)*.6,TS(s,Nd,e,n),VS(s,Nd,e,n),IS(s,Nd)};var _u=()=>[-0,-0,-0,-0,-0,-0],eo=_u();var RS=(t,e)=>!(t[3]<e[0]||t[0]>e[3]||t[4]<e[1]||t[1]>e[4]||t[5]<e[2]||t[2]>e[5]),Oq=(t,e,n,s,i)=>(t[0]=e[0],t[3]=e[0]+n,t[1]=e[1],t[4]=e[1]+s,t[2]=e[2],t[5]=e[2]+i,t);var zS=(t,e)=>{t[0]=t[1]=t[2]=1/0,t[3]=t[4]=t[5]=-1/0;for(let n=0;n<e.length;++n){let s=e[n];t[0]=Math.min(t[0],s[0]),t[3]=Math.max(t[3],s[0]),t[1]=Math.min(t[1],s[1]),t[4]=Math.max(t[4],s[1]),t[2]=Math.min(t[2],s[2]),t[5]=Math.max(t[5],s[2])}return t};var Wd=(t,e,n,s,i)=>(Y(bt,e[0]-n/2,e[1]-s/2,e[2]-i/2),Oq(t,bt,n,s,i));var BS=(t,e,n,s,i)=>{let o=(t[0]-e[0])*n[0],r=(t[1]-e[1])*n[1],l=(t[2]-e[2])*n[2],a=(t[3]-e[0])*n[0],c=(t[4]-e[1])*n[1],f=(t[5]-e[2])*n[2],u=Math.max(s,Math.min(o,a),Math.min(r,c),Math.min(l,f)),p=Math.min(i,Math.max(o,a),Math.max(r,c),Math.max(l,f));return!(p<0||u>p)};var US=(t,e,n)=>{let s=[0,0,0];for(let i=0;i<6;++i){let o=e[i],r=n[i];if(o[0]>0?s[0]=t[3]:s[0]=t[0],o[1]>0?s[1]=t[4]:s[1]=t[1],o[2]>0?s[2]=t[5]:s[2]=t[2],mn(o,s)+r<0)return!1}return!0};var Gd=class{constructor(){this.id=0,this.pos=[-0,-0,-0],this.rot=[-0,-0,-0],this.scale=1,this.matrix=void 0,this.loaded=!1}setWorldMatrix(e,n){this.matrix=e,Rn(bt,n,this.pos),ms(yn,this.scale),wp(vo,this.rot),yp(this.matrix,vo,bt,yn)}loadGeometry(e,n){if(!this.loaded){let s=_i.get(this.id);this.loaded=!0,s.geometry===0?this.postGeometryLoad(e,n):Qo(s.geometry,(i,o)=>{let r=!e.finishedLoadingChunks.has(n.id);this.addMesh(e,n),r&&this.addCollider(e,n,i,o),this.postGeometryLoad(e,n)})}}onUpdate(e,n,s){}addMesh(){}postGeometryLoad(e,n){n.loadingProps--}handleColliderGeometry(e,n,s,i){let o=this.matrix,r=s.position,l=s.color,a=s.flags;for(let c=0,f=n.length;c<f;c+=3){let u=n[c],p=n[c+1],g=n[c+2],v=Gv(u*3,i,r,o),_=Gv(p*3,i,r,o),b=Gv(g*3,i,r,o),y=[v,_,b],k=zS(_u(),y);if(a[u]&1&&a[p]&1&&a[g]&1){if(y.push(Lf([0,0,0],v,_,b)),l.length){let S=[(l[u*4+0]+l[p*4+0]+l[g*4+0])/3,(l[u*4+1]+l[p*4+1]+l[g*4+1])/3,(l[u*4+2]+l[p*4+2]+l[g*4+2])/3,(l[u*4+3]+l[p*4+3]+l[g*4+3])/3];y.push(S)}e.triangleGrid.add(y,k)}}}addCollider(e,n,s,i){let o=new Map;this.handleColliderGeometry(e,i.index,i,o),this.handleColliderGeometry(e,i.indexInvisible,i,o)}onRemove(){}},Gv=(t,e,n,s)=>{if(e.has(t))return e.get(t);{let i=[n[t],n[t+1],n[t+2]];return Ms(i,i,s),e.set(t,i),i}};var Hd=class extends Gd{constructor(){super(),this.mesh=void 0,this.effects=[],this.isEffectProp=!1,this.effectsCreated=!1}onUpdate(e,n,s){this.mesh!==void 0&&this.updateMesh(n),super.onUpdate(e,n,s)}updateMesh(e){this.setWorldMatrix(this.mesh.worldMatrix,e),Rn(this.mesh.position,e,this.pos),Y(this.mesh.rotation,this.rot[0],this.rot[1],this.rot[2]),ms(this.mesh.scale,this.scale),this.mesh.data.multi&&(this.mesh.data.multi.needsUpdate=!0)}onRemove(e){super.onRemove(e),_i.get(this.id).effects.length&&this.deleteEffects(),this.mesh&&(this.mesh.data.multi?xi(this.mesh.data.multi,this.mesh):ui(this.mesh),this.mesh=void 0)}addMesh(e,n){if(this.mesh===void 0){let s=_i.get(this.id);this.mesh=Ji(this.id,s.shadow,!1,!0),this.mesh.visible=!1,this.updateMesh(n.origin),s.effects.length&&(this.isEffectProp=!0)}}onChunkRebuild(e){this.mesh&&this.mesh.data&&this.mesh.data.interiorlight&&I.getInteriorLight(this.mesh.data.interiorlight,Wd(eo,this.mesh.position,3,3,3))}createEffects(){if(this.isEffectProp=!0,!this.effectsCreated){let e=_i.get(this.id).effects;for(let n=0;n<e.length;++n){let s=e[n],i=on();it(i.position,s.pos),it(i.scale,s.scale),it(i.rotation,s.rot),Mn(i,this.mesh),qt(i,!0);let o=Bs(s.id,i,0,!0);this.effects.push(o)}this.effectsCreated=!0}}deleteEffects(){if(this.effectsCreated){for(let e=0;e<this.effects.length;++e)this.effects[e].done=!0;this.effects.length=0,this.effectsCreated=!1}}setVisible(e){this.mesh.visible!==e&&(this.mesh.visible=!0,this.mesh.data.multi.needsUpdate=!0)}setEffectVisible(e){this.isEffectProp&&this.effectsCreated!==e&&(e?this.createEffects():this.deleteEffects())}};var $S=(t,e,n)=>{e[n]=(t&31)*8,e[n+1]=(t>>5&31)*8,e[n+2]=(t>>10&31)*8},OS=65536/64,$q=2147483647/2e3,Hv=65536/(Math.PI*2),Nq=65536/100;var NS=(t,e)=>(t.id=e.id,Y(t.pos,e.x/OS,e.y/$q,e.z/OS),Y(t.rot,e.rx/Hv,e.ry/Hv,e.rz/Hv),t.scale=Math.max(e.scale,100)/Nq,t);var jS=(t,e,n,s)=>{t.id=e,t.x=n,t.z=s,t.origin[0]=n*64,t.origin[2]=s*64,t.deserialized=!1,t.props.length=0,t.data=void 0,t.loadingProps=0},WS=(t,e)=>{t.data=e,GS(t),jq(t,!0),t.deserialized=!0},Mi=(t,e,n)=>{e/=2.6666666666666665,n/=2.6666666666666665;let s=e%1,i=n%1;if(s===0&&i===0)return t.data.terrain[e+25*n]*.030517578125;{let o=Math.floor(e),r=Math.floor(n),l=s+i<1,a=t.data.terrain[o+25*r+(l?0:1)],c=t.data.terrain[o+25*Math.min(24,r+1)],f=t.data.terrain[o+1+25*(r+(l?0:1))],u=l?-(s-1+i):-(i-1),p=l?i:-(s-1),g=1-u-p;return(u*a+p*c+g*f)*.030517578125}},yu=(t,e,n)=>{if(t.data.holes.length===0)return!1;e/=2.6666666666666665,n/=2.6666666666666665;let s=Math.floor(e)+Math.floor(n)*24;return t.data.holes.indexOf(s)>=0},ku=(t,e,n)=>{if(t.data.water.length===0)return-1;e/=64,n/=64;let s=e%1,i=n%1;if(s===0&&i===0)return t.data.water[e+2*n]*.030517578125;{let o=Math.floor(e),r=Math.floor(n),l=s+i<1,a=t.data.water[o+2*r+(l?0:1)],c=t.data.water[o+2*Math.min(2-1,r+1)],f=t.data.water[o+1+2*(r+(l?0:1))],u=l?-(s-1+i):-(i-1),p=l?i:-(s-1),g=1-u-p;return(u*a+p*c+g*f)*.030517578125}};var Yv=(t,e,n)=>{e/=16,n/=16;let i=Math.floor(e)+Math.floor(n)*4;return t.data.area[i]||0},Xv=(t,e,n)=>{e/=32,n/=32;let i=Math.floor(e)+Math.floor(n)*2;return t.data.environment[i]||0},GS=t=>{let e=[-0,-0,-0];for(let n=0;n<24;++n)for(let s=0;s<24;++s){let i=(s*2+24*n*2)*3,o=s*2.6666666666666665,r=n*2.6666666666666665;Y(mi,o,Mi(t,o,r),r),Y(mm,o,Mi(t,o,r+2.6666666666666665),r+2.6666666666666665),Y(vf,o+2.6666666666666665,Mi(t,o+2.6666666666666665,r),r),Lf(e,mi,mm,vf),t.normals[i]=e[0],t.normals[i+1]=e[1],t.normals[i+2]=e[2],Y(mi,o+2.6666666666666665,Mi(t,o+2.6666666666666665,r),r),Y(vf,o+2.6666666666666665,Mi(t,o+2.6666666666666665,r+2.6666666666666665),r+2.6666666666666665),Lf(e,mi,mm,vf),t.normals[i+3]=e[0],t.normals[i+4]=e[1],t.normals[i+5]=e[2]}};var jq=(t,e)=>{for(let n=0,s=t.data.props.length;n<s;++n){let i=t.data.props[n],o=NS(new Hd,i);t.props.push(o),e&&t.loadingProps++}for(let n=0;n<t.props.length;++n){let s=t.props[n];s.onUpdate(I,t.origin,I.bounds),s.loadGeometry(I,t)}},Wq=t=>{for(let e=0;e<t.props.length;++e)t.props[e].onRemove(t);t.props.length=0},HS=t=>{Wq(t)},YS=(t,e)=>Math.floor(t%64/32)+Math.floor(e%64/32)*2,XS=(t,e)=>Math.floor(t%32*3)+Math.floor(e%32*3)*96;var xu=1,Yd=t=>{xu=t%2147483647,xu<=0&&(xu+=2147483646),Sl(),Sl()},Sl=()=>xu=xu*16807%2147483647,wu=()=>(Sl()-1)/2147483647,ic=(t,e)=>wu()*(e-t)+t;var Qd,Zd,Jd,Us=[0,0,0],oc,rc,lc,Gq=[21,56,50,44,13,19,7,42],Zv=3758102380,Jv=(t,e)=>t>>e&1,br=(t,e,n,s)=>Gq[Jv(t,s)<<2|Jv(e,s)<<1|Jv(n,s)],Xd=t=>{let e=(Us[0]+Us[1]+Us[2])/6,n=oc-Us[0]+e,s=rc-Us[1]+e,i=lc-Us[2]+e,o=.6-n*n-s*s-i*i,r=Hq(Qd+Us[0],Zd+Us[1],Jd+Us[2]);if(Us[t]++,o<0)return 0;let l=r>>5&1,a=r>>4&1,c=r>>3&1,f=r>>2&1,u=r&3,p=u===1?n:u===2?s:i,g=u===1?s:u===2?i:n,v=u===1?i:u===2?n:s;return p=l===c?-p:p,g=l===a?-g:g,v=l!==(a^c)?-v:v,o*=o,8*o*o*(p+(u===0?g+v:f===0?g:v))},Hq=(t,e,n)=>br(t,e,n,0)+br(e,n,t,1)+br(n,t,e,2)+br(t,e,n,3)+br(e,n,t,4)+br(n,t,e,5)+br(t,e,n,6)+br(e,n,t,7),ZS=(t,e,n)=>{let s=t+Zv,i=e+Zv,o=n+Zv,r=(s+i+o)/3;Qd=Math.floor(s+r),Zd=Math.floor(i+r),Jd=Math.floor(o+r),r=(Qd+Zd+Jd)/6,oc=s-Qd+r,rc=i-Zd+r,lc=o-Jd+r,Us[0]=Us[1]=Us[2]=0;let l=oc>=lc?oc>=rc?0:1:rc>=lc?1:2,a=oc<lc?oc<rc?0:1:rc<lc?1:2;return Xd(l)+Xd(3-l-a)+Xd(a)+Xd(0)};var JS=t=>{let e=0,n=0,s=0;for(let u=0;u<t.nodes.length;++u){let p=t.nodes[u],g=p.leafCount,v=p.points.length/2;e+=v*3*g,n+=v*2*g,s+=Math.max(0,(v-2)*3)*g,p.geotype===1&&(s+=3*g*Math.min(1,p.points.length))}let i=new Float32Array(e),o=new Float32Array(n),r=new Uint32Array(s);Yd(t.seed);let l=0,a=0,c=0,f=0;for(let u=0;u<t.nodes.length;++u){let p=t.nodes[u],g=p.start,v=p.end,_=Math.atan2(v[1]-g[1],v[0]-g[0]),{geotype:b,leafCount:y,y:k,radius:S,slant:A,size:F,arc:M,jitter_slant:D,jitter_size:L,jitter_rotation:E,jitter_radius:R,jitter_y:z}=p,q=p.points.length/2,j=Math.PI*2/(y===2?4:y);for(let W=0;W<y;++W){let N=W*j+ic(-E,E),O=A+ic(-D,D),se=F*ic(1-L,1),re=S*ic(1-R,1),ie=k*ic(1-z,1);for(let ce=0;ce<q;++ce){let ke=p.points[ce*2],ge=p.points[ce*2+1],Ne=ke-g[0],Te=ge-g[1],Ce=Ne*Math.cos(-_)-Te*Math.sin(-_),_e=Ne*Math.sin(-_)+Te*Math.cos(-_),H=0,de=0,Re=0;if(p.geotype===0){let Ye=O+M*Ce;H=Math.sin(Ye)*Ce,de=Math.cos(Ye)*Ce,Re=_e}else H=Ce,de=M*(Math.abs(Ce)+Math.abs(_e)),Re=_e;let Ge=H*Math.cos(N)-Re*Math.sin(N),Xe=H*Math.sin(N)+Re*Math.cos(N);i[l]=Ge*se+Math.cos(N)*re,i[l+1]=ie+de*se,i[l+2]=Xe*se+Math.sin(N)*re,o[a]=ke,o[a+1]=1-ge,l+=3,a+=2}if(b===0)for(let ce=0;ce<q-2;++ce)r[c]=f+ce,r[c+1]=f+ce+1,r[c+2]=f+ce+2,c+=3;else for(let ce=0;ce<q-1;++ce){let ke=ce===q-2;r[c]=f,r[c+1]=ke?f+q-1:f+ce+1,r[c+2]=ke?f+1:f+ce+2,c+=3}f+=q}}return Cn({position:{size:3,data:i},uv:{size:2,data:o},index:{type:5125,data:r}})};var e8=Math.floor(64**2*(le.foliage/100)),t8=[],Kd=[],n8=[];for(let t=0;t<64*64;++t){let e=Math.max(0,ZS(Math.floor(t/64)/7,t%64/7,1));n8.push(e)}for(let t=0;t<8;++t)t8.push(new Float32Array(7*e8)),Kd.push([]);var s8=(t,e)=>{if(le.foliage===0||!e)return;Qq(t,$),Yd(t.id+1e3);let n=t.geometry.foliage.folIds,s=[],i=t.geometry.foliage.instances,o=[];for(let c=0;c<n.length;++c)s.push(Ea.get(n[c])),o.push(0);let r=le.foliage,l=!1;t.data.holes.length>0&&(l=!0);let a=[-1,-1,-1,-1];for(let c=0;c<4;++c){let f=t.data.textureid[c];for(let u=0;u<4;++u)f[u]===27&&(a[c]=u)}for(let c=0;c<64;++c)for(let f=0;f<64;++f){if(Sl()%100>r)continue;let u=c+t.origin[0],p=f+t.origin[2],g=I.getNormal(u,p);if(g[1]<.6||l&&yu(t,c,f)||ku(t,c,f)>Mi(t,c,f)+80)continue;let v=YS(c,f),_=XS(c,f),b=t.data.texture[v][_],y=b&31,k=b>>5&31,S=b>>10&31,A=a[v];A>=0&&(A===0&&y>0?y=255:A===1&&k>0?k=255:A===2&&S>0&&(S=255));let F=Sl()%Math.max(32,y+k+S),M=3;F<y?M=0:F<y+k?M=1:F<y+k+S&&(M=2);let D=t.data.textureid[v][M],L=Ta.get(D).foliage,E=n8[u%64+p%64*64];for(let R=0;R<L.length;++R){let z=L[R],q=z[1];if(Sl()%255>q||z[2]&&E<=0)continue;let j=z[0],W=n.indexOf(j);if(o[W]>=e8||W<0)continue;let N=i[W].attributes.inst.data,O=o[W]*7,se=Math.max(0,Math.min(64,c-.25+wu()*.5)),re=Math.max(0,Math.min(64,f-.25+wu()*.5)),ie=Mi(t,se,re);N[O]=se+t.origin[0],N[O+1]=ie,N[O+2]=re+t.origin[2],N[O+3]=z[2]?.5+Math.min(1.4,E*1.5):.5+wu(),N[O+4]=g[0]+.001,N[O+5]=g[1],N[O+6]=g[2],o[W]++}}for(let c=0;c<n.length;++c){let f=i[c],u=o[c];xm(f,u),hs(f,f.attributes.inst),f.bounds=t.geometry.terrain.bounds}},e0=new Map,Kv=new Map,KS=new Set,Yq=t=>Kd[t].length<1?Cn({inst:{instanced:!0,size:7,data:t8[t]}}):Kd[t].pop(),Xq=(t,e)=>{Kd[t].push(e)},Qq=(t,e)=>{if(!t.geometry.foliage){let n=t.geometry.foliage={instances:[],folIds:[]};for(let s=0;s<4;++s){let i=t.data.textureid[s];for(let o=0;o<4;++o){let r=Ta.get(i[o]).foliage;for(let l=0;l<r.length;++l)n.folIds.indexOf(r[l][0])<0&&n.folIds.push(r[l][0])}}n.folIds.length>8&&(n.folIds.length=8);for(let s=0;s<n.folIds.length;++s){let i=n.folIds[s];n.instances.push(Yq(s));let o=Ea.get(i);e0.has(o.id)||e0.set(o.id,JS(o)),KS.has(o.texture)||(KS.add(o.texture),gs(o.texture,r=>{Mm(r,16),ei(r),Kv.set(o.texture,r)}))}}},i8=t=>{if(t.geometry.foliage){for(let e=0;e<t.geometry.foliage.instances.length;++e)Xq(e,t.geometry.foliage.instances[e]);t.geometry.foliage=void 0}},o8=(t,e)=>{},r8=t=>{if(!le.foliage)return;let e=3,n=2,s=[],i=[],o=[];for(let r=0,l=t.length;r<l;++r){let a=t[r];if(XC(a.x*2,a.z*2)<Pv){let c=a.geometry.foliage;for(let f=0;f<c.folIds.length;++f){let u=c.folIds[f],p=s.indexOf(u);p<0&&(s.push(u),i.push([]),o.push(Ea.get(u).type===0?13:14),p=s.length-1),i[p].push(c.instances[f])}}}for(let r=0;r<s.length;++r){let l=Ea.get(s[r]);if(e0.has(l.id)&&Kv.has(l.texture)){let a=o[r],c=pt[a];et.currentProgram!==c.id&&($.useProgram(c.program),et.currentProgram=c.id,Aa(c),Sa(c),t1(c.uniformArray));let f=e0.get(l.id);Ma(f,c),Vn("foliageDiffuse",Kv.get(l.texture),0,c),Mf(c);let u=i[r];for(let p=0;p<u.length;++p){let g=u[p];$.bindBuffer($.ARRAY_BUFFER,g.attributes.inst.buffer),$.vertexAttribPointer(e,3,$.FLOAT,!1,7*4,4*4),$.enableVertexAttribArray(e),ua(e,1),$.vertexAttribPointer(n,4,$.FLOAT,!1,7*4,0),$.enableVertexAttribArray(n),ua(n,1),et.boundBuffer=g.attributes.inst.id,$.drawElementsInstanced($.TRIANGLES,f.drawRangeCount,f.attributes.index.type,f.drawRangeStart,g.instancedCount)}}}};var ac=[],cc=[],yr=new Map,l8=(t,e,n,s,i)=>{let o=I.entity(t),r=I.entity(e);if(n.fx.effectMissile&&o!==void 0&&r!==void 0&&(!o.visual.inFog||!r.visual.inFog)){let l={mId:s,targetid:e,timer:i,effect:Bs(n.fx.effectMissile,on(),o===I.playerId?1:0,!0),start:Rn([0,0,0],Vr(bt,[0,0,o.radius],o.rot),o.visualPosition)};l.effect.transform.matrixAutoUpdate=!0,ac.push(l),yr.set(s,l),c8(l,ac.length-1)}},a8=(t,e,n,s,i,o)=>{if(s.fx.effectMissile){let r={mId:i,timer:o,path:e,fractions:n,currentIndex:0,effect:Bs(s.fx.effectMissile,on(),t===I.playerId?1:0,!0)};r.effect.transform.matrixAutoUpdate=!0,cc.push(r),yr.set(i,r),f8(r,cc.length-1)}},c8=(t,e)=>{if(!I.isEntityIdTaken(t.targetid)||t.timer.done(I.smoothtime)){ac.splice(e,1),t.effect.done=!0,yr.delete(t.mId);return}let n=I.entity(t.targetid),s=Xt(t.effect.transform.position,n.visualPosition,t.start);sn(t.effect.transform.position,t.start,s,t.timer.fraction(I.smoothtime));let i=I.getHeight(t.effect.transform.position[0],t.effect.transform.position[2])+.3;i>t.effect.transform.position[1]&&(t.effect.transform.position[1]=i),qr(t.effect.transform,n.visualPosition,!1,pm),t.timer.passed(I.smoothtime)>.5&&(it(t.start,t.effect.transform.position),t.timer.reset(I.smoothtime,t.timer.end-I.smoothtime)),qt(t.effect.transform,!1)},f8=(t,e)=>{if(t.timer.done(I.smoothtime)){cc.splice(e,1),t.effect.done=!0,yr.delete(t.mId);return}let n=Math.max(0,Math.min(1,t.timer.fraction(I.smoothtime)));t.currentIndex=fy(t.effect.transform.position,t.path,n,t.fractions),qt(t.effect.transform,!1)},u8=()=>{ac.forEach(c8),cc.forEach(f8)},p8=t=>{ac.forEach(e=>{e.effect.done=!0}),cc.forEach(e=>{e.effect.done=!0}),ac.length=0,cc.length=0,yr.clear()};var ii,m8=()=>{ii=qs(void 0,11,$.TRIANGLES),ms(ii.transform.scale,40),ii.transform.visible=!1,ii.transform.matrixAutoUpdate=!0,Qo(1456,t=>{let e=Cn(t);ii.geometry=e;let n=ko(1024,1024,1,!1,$.NONE,$.REPEAT,$.REPEAT);V_(n),Ks(Vf,pt[34]);let s=n.colorTexture;Vn("skyDiffuse",s,0,pt[11]),gs(1748,i=>{ii.transform.visible=!0,Vn("cloudDiffuse",i,0,pt[11])})})},d8=()=>{Y(ii.transform.position,gt.transform.worldMatrix[12],gt.transform.worldMatrix[13],gt.transform.worldMatrix[14]),qt(ii.transform,!1)},h8=()=>{ii.transform.visible&&Ks(ii,pt[11])};var Os,g8=()=>{Os=qs(void 0,12,$.TRIANGLES),ms(Os.transform.scale,.1),Mn(Os.transform,ii.transform),Os.transform.visible=!1,Qo(1455,t=>{Os.geometry=Cn(t),Os.transform.visible=!0})},v8=()=>{it(Os.transform.position,sc),dn(Os.transform.position,Os.transform.position,.45),qr(Os.transform,q_,!1,L_),Os.transform.matrixNeedsUpdate=!0},_8=()=>{Os.transform.visible&&Ks(Os,pt[12])};var n0=24,At=n0+1,x8=At**2,e2=new Map,kr=96,b8=96/12,fc=8,Mu=new Uint8Array(3*kr**2),t2=new Map,t0=n0/2,y8=3,k8=[1,2,4,8],Al=[0],Jt=[],tR=(t,e,n,s)=>{let i=e+n*At,o=e+(n+s)*At,r=e+(n+s)*At+s,l=e+n*At+s;Jt.push(i),Jt.push(o),Jt.push(l),Jt.push(o),Jt.push(r),Jt.push(l)};for(let t=0;t<2;++t)for(let e=0;e<2;++e)for(let n=0;n<y8;++n){let s=k8[n],i=k8[n+1],o=e*t0,r=(e+1)*t0,l=t*t0,a=(t+1)*t0;for(let c=0;c<(n===y8-1?1:16);++c){let f=1&c,u=2&c,p=4&c,g=8&c,v=o+(f?s:0),_=r-(p?s:0),b=l+(u?s:0),y=a-(g?s:0);for(let k=b;k<y;k+=s)for(let S=v;S<_;S+=s)tR(Jt,S,k,s);if(f){for(let k=l;k<a;k+=i){let S=o+k*At,A=o+(k+i)*At,F=o+(k+s)*At+s;if(Jt.push(S,A,F),k<a-i){let M=F+s*At,D=M+s*At;Jt.push(F,A,M),Jt.push(M,A,D)}}u||Jt.push(o+l*At,o+(l+s)*At+s,o+l*At+s),g||Jt.push(o+a*At,o+a*At+s,o+(a-s)*At+s)}if(u){for(let k=o;k<r;k+=i){let S=k+l*At,A=k+l*At+i,F=k+(l+s)*At+s;if(Jt.push(S,F,A),k<r-i){let M=F+s;Jt.push(F,M,A),Jt.push(M,M+s,A)}}f||Jt.push(o+l*At,o+(l+s)*At,o+(l+s)*At+s),p||Jt.push(r+l*At,r+(l+s)*At-s,r+(l+s)*At)}if(p){for(let k=l;k<a;k+=i){let S=r+k*At,A=r+(k+i)*At,F=r+(k+s)*At-s;if(Jt.push(S,F,A),k<a-i){let M=F+s*At,D=M+s*At;Jt.push(F,M,A),Jt.push(M,D,A)}}u||Jt.push(r+l*At,r+l*At-s,r+(l+s)*At-s),g||Jt.push(r+a*At,r+(a-s)*At-s,r+a*At-s)}if(g){for(let k=o;k<r;k+=i){let S=k+a*At,A=k+a*At+i,F=k+(a-s)*At+s;if(Jt.push(S,A,F),k<r-i){let M=F+s,D=M+s;Jt.push(F,A,M),Jt.push(M,A,D)}}f||Jt.push(o+a*At,o+(a-s)*At+s,o+(a-s)*At),p||Jt.push(r+a*At,r+(a-s)*At,r+(a-s)*At-s)}Al.push(Jt.length)}}var nR={type:$.UNSIGNED_INT,data:new Uint32Array(Jt)},n2=new Float32Array(x8*3),sR=new Float32Array(x8*3);for(let t=0,e=0;t<=n0;++t)for(let n=0;n<=n0;++n,++e)n2[e*3+0]=n*2.6666666666666665,n2[e*3+2]=t*2.6666666666666665;var w8=()=>{},M8=(t,e,n)=>{if(oR(t),e){let s=t.geometry.terrain,i=s.attributes.position.data,o=s.attributes.normal.data;for(let l=0;l<25;++l)for(let a=0;a<25;++a){let c=a+25*l,f=t.data.terrain[c]*.030517578125;i[c*3+1]=f}let r=t.normals;for(let l=0;l<25*25*3;++l)o[l]=0;for(let l=0;l<24;++l)for(let a=0;a<24;++a){let c=(a*2+24*l*2)*3,f=r[c],u=r[c+1],p=r[c+2],g=r[c+3],v=r[c+4],_=r[c+5],b=(a+25*l)*3,y=(a+25*(l+1))*3,k=(a+1+25*l)*3,S=(a+1+25*(l+1))*3;o[b]+=f,o[b+1]+=u,o[b+2]+=p,o[y]+=f+g,o[y+1]+=u+v,o[y+2]+=p+_,o[k]+=f+g,o[k+1]+=u+v,o[k+2]+=p+_,o[S]+=g,o[S+1]+=v,o[S+2]+=_}if(t.z>0){let a=I.getChunk(t.x,t.z-1).normals,c=24-1;for(let f=0;f<24;++f){let u=(f*2+24*c*2)*3,p=a[u],g=a[u+1],v=a[u+2],_=a[u+3],b=a[u+4],y=a[u+5],k=(f+1)*3,S=f*3;o[S]+=p+_,o[S+1]+=g+b,o[S+2]+=v+y,o[k]+=_,o[k+1]+=b,o[k+2]+=y}}if(t.z+1<I.chunkAmount){let a=I.getChunk(t.x,t.z+1).normals,c=0,f=25-1;for(let u=0;u<24;++u){let p=(u*2+24*c*2)*3,g=a[p],v=a[p+1],_=a[p+2],b=a[p+3],y=a[p+4],k=a[p+5],S=(u+25*f)*3,A=(u+1+25*f)*3;o[S]+=g,o[S+1]+=v,o[S+2]+=_,o[A]+=g+b,o[A+1]+=v+y,o[A+2]+=_+k}}if(t.x>0){let a=I.getChunk(t.x-1,t.z).normals,c=24-1;for(let f=0;f<24;++f){let u=(c*2+24*f*2)*3,p=a[u],g=a[u+1],v=a[u+2],_=a[u+3],b=a[u+4],y=a[u+5],k=25*f*3,S=25*(f+1)*3;o[k]+=p+_,o[k+1]+=g+b,o[k+2]+=v+y,o[S]+=_,o[S+1]+=b,o[S+2]+=y}}if(t.x+1<I.chunkAmount){let a=I.getChunk(t.x+1,t.z).normals,c=0,f=25-1;for(let u=0;u<24;++u){let p=(c*2+24*u*2)*3,g=a[p],v=a[p+1],_=a[p+2],b=a[p+3],y=a[p+4],k=a[p+5],S=(f+25*u)*3,A=(f+25*(u+1))*3;o[A]+=g+b,o[A+1]+=v+y,o[A+2]+=_+k,o[S]+=g,o[S+1]+=v,o[S+2]+=_}}for(let l=0;l<25;++l)for(let a=0;a<25;++a){let c=(a+25*l)*3,f=o[c],u=o[c+1],p=o[c+2],g=1/Math.sqrt(f*f+u*u+p*p);o[c]=f*g,o[c+1]=u*g,o[c+2]=p*g}hs(s,s.attributes.position),hs(s,s.attributes.normal)}if(n){let s=t.x*2%fc*2+t.z*2%fc*fc;t.meshes.atlas=rR(t),t.meshes.texSet=t.data.textureid.map(lR);let i=t.data.holes.length>0;for(let o=0;o<2;++o)for(let r=0;r<2;++r){let l=r*2+o,a=t.data.texture[l];for(let f=0;f<kr;++f)for(let u=0;u<kr;++u){let p=f*kr+u,g=p*3;if($S(a[p],Mu,g),i){let v=o*12+Math.floor(u/b8)+(Math.floor(f/b8)+r*12)*24;t.data.holes.indexOf(v)>=0&&(Mu[g+0]=255,Mu[g+1]=255,Mu[g+2]=255)}}N3(t.meshes.atlas,s+l,kr,kr,Mu);let c=t.meshes.quadrantUbos[l];c.data.quadrant[0]=s+l,c.data.terrainInfo=t.meshes.texSet[l].info,Um(c),is(c)}}},iR={min:[0,0,0],max:[64,64,64],center:[32,32,32],scale:[64,64,64],radius:60,initiated:!0},oR=t=>{if(t.geometry.terrain||(t.geometry.terrain=Cn({position:{size:3,data:n2},normal:{size:3,data:sR},index:nR}),Object.assign(t.geometry.terrain.bounds,iR)),!t.meshes.terrain){let e=qs(t.geometry.terrain,8,$.TRIANGLES);t.meshes.terrain=e,t.meshes.quadrantUbos=[];for(let n=0;n<4;++n){let s=Oa(Qf.meshterrain);s.data.modelMatrix=e.transform.matrix,t.meshes.quadrantUbos.push(s)}}it(t.meshes.terrain.transform.position,t.origin),t.meshes.terrain.transform.matrixNeedsUpdate=!0,qt(t.meshes.terrain.transform,!1),t.state=Math.max(t.state,5)},rR=t=>{let e=Math.floor(t.x*2/fc),n=Math.floor(t.z*2/fc),s=e+1e3*n;if(!e2.has(s)){let i=Xo({width:kr,height:kr,target:$.TEXTURE_2D_ARRAY,format:$.RGB,internalFormat:$.RGB565,depth:fc**2,flipY:!1,generateMipmaps:!1});Mm(i,4),ei(i),e2.set(s,i)}return e2.get(s)},lR=t=>{let e=t.join(",");if(!t2.has(e)){let n={info:[],diffuse:[],loaded:0};t.forEach((s,i)=>{let o=Ta.get(s);n.info[i*4+0]=o.scale/127,n.info[i*4+1]=o.darkest/255*3,n.info[i*4+2]=o.brightest/255*3,n.info[i*4+3]=o.spec/255,gs(o.texture,r=>{n.diffuse[i]=r,n.loaded++})}),t2.set(e,n)}return t2.get(e)},F8=t=>{},C8=(t,e)=>{},S8=()=>{},A8=t=>{let e=pt[8];if(!e.active)return;$.useProgram(e.program),et.currentProgram=e.id,Aa(e),Sa(e);let n,s,i=1;for(let r=0;r<t.length;++r){let l=t[r],a=l.meshes.terrain,c=a.geometry;n!==l.meshes.atlas&&(Vn("atlas",l.meshes.atlas,0,e),n=l.meshes.atlas),Ma(c,e);for(let f=0;f<4;++f)if(l.quadrantlod[f]<=i){let u=l.meshes.texSet[f];if(u.loaded<4)continue;let p=l.meshes.quadrantUbos[f];if(al(p),s!==u){for(let b=0;b<4;++b)Vn("diffuse",u.diffuse[b],b,e);s=u}Mf(e);let g=l.quadrantmask[f],v=Al[g]*4,_=Al[g+1]-Al[g];$.drawElements(a.mode,_,c.attributes.index.type,v)}}let o=pt[9];if(o.active){$.useProgram(o.program),et.currentProgram=o.id,Aa(o),Sa(e);for(let r=0;r<t.length;++r){let l=t[r],a=l.meshes.terrain,c=a.geometry,f=l.meshes.quadrantUbos[0];al(f),Ma(c,o);for(let u=0;u<4;++u)if(l.quadrantlod[u]>i){let p=l.quadrantmask[u],g=Al[p]*4,v=Al[p+1]-Al[p];$.drawElements(a.mode,v,c.attributes.index.type,g)}}}};var P8,T8=()=>{P8=Cn({position:{size:3,data:new Float32Array([0,0,0,64,0,0,0,0,64,64,0,64])},index:{type:$.UNSIGNED_INT,data:new Uint32Array([0,2,1,2,3,1])}}),gs(1748,t=>Vn("waterNoise",t,0,pt[20])),gs(1243,t=>Vn("waterLines",t,0,pt[20])),Vn("bufferPongColor",Fo.colorTexture,0,pt[20]),Vn("bufferPongDepth",Fo.depthTexture,0,pt[20])},E8=(t,e)=>{if(!e||t.data.water.length===0)return;t.meshes.waterubo||(t.meshes.waterubo=Oa(Qf.water));let n=t.origin[0],s=t.origin[2],i=t.meshes.waterubo.data.verts;for(let o=0;o<4;++o){let r=t.data.water[o]*.030517578125;i[o*3]=n+o%2*64,i[o*3+1]=r,i[o*3+2]=s+Math.floor(o/2)*64}Um(t.meshes.waterubo),is(t.meshes.waterubo)},D8=t=>{},I8=t=>{let e=pt[20];Ca(e,et.currentProgram===e.id);for(let n=0,s=t.length;n<s;++n){let i=t[n];i.data.water.length!==0&&(al(i.meshes.waterubo),Fa(P8,e,$.TRIANGLES))}};var V8=t=>{G3(),Cw(),yS(t),LS(),T8(),fS(),hS(),m8(),g8(),S8()},L8=(t,e,n)=>{qS(t,e,n),w8(),kS(e),u8(),SS(t,e),uS(t),gS(t),oS(t,e),d8(),v8(),J3(t)},q8=(t,e)=>{sy(t,e),C8(t,e),o8(t,e)},R8=t=>{p8(t),PS(t),_S(t),lS(t),iy(t)},uc=[],z8=t=>{uc.push(t)},s2=t=>{uc.splice(uc.indexOf(t),1)},B8=t=>{A8(t),pS(),h8(),r8(t)},U8=t=>{_8()},O8=t=>{I8(t),mS(),aS()},$8=(t,e,n,s,i,o,r)=>{if(t.state!==8&&(M8(t,e,n),s8(t,s),E8(t,o),i))for(let l=0;l<t.props.length;++l)t.props[l].onChunkRebuild(t)},N8=t=>{F8(t),i8(t),D8(t)};var pc={neticons:[],npcs:[]},xr=.6,i0=!1,Pl=200,Tl=200,r2=!1,o0=0,r0=0,ys=document.createElement("canvas");ys.className="border black minimap";var Fi=ys.getContext("2d"),i2=new Map,Cu=new Map;ys.addEventListener("wheel",t=>{xr=vt(xr+(t.deltaY<0?.07:-.07),.25,1.5)},{passive:!0});ys.addEventListener("mousedown",t=>{r2=!0});ys.addEventListener("mouseup",t=>{r2=!1});ys.addEventListener("mousemove",t=>{if(r2){let e=t.movementX,n=t.movementY;o0-=e/xr,r0-=n/xr}});var Fu={player:"#fff",monster:"#D53434",pvp:Dt("pvp"),friendly:Dt("health"),party:Dt("party"),black:Dt("black")},fR=()=>{nt.map.onPress(()=>{l0(i0=!i0)}),Un(Ft.serverMapUpdate.header,t=>{pc.neticons=Ft.serverMapUpdate.decode(t).icons})},l0=t=>{o0=r0=0,t?(document.body.appendChild(ys),Pl=~~Math.min(Math.max(200,window.innerWidth*.7),1e3),Tl=~~Math.min(Math.max(200,window.innerHeight*.7),800),Pl%2!==0&&(Pl+=1),Tl%2!==0&&(Tl+=1),ys.width=Pl,ys.height=Tl,ys.className="border black minimap enlarged"):(document.getElementById("minimapcontainer").appendChild(ys),ys.className="border black minimap",Pl=ys.width=200,Tl=ys.height=200)},H8=function(){this.loaded=!0},W8=0,uR=t=>{W8++;let e=I.player;if(!e||le.mapLowQuality&&W8%10!==0)return;let n=Fi;n.globalAlpha=1,n.clearRect(0,0,Pl,Tl);let s=e,i=s.pos[0]+o0,o=s.pos[2]+r0,r=xr<.4?16:4,l=r*64,a=I.chunkAmount,c=Math.round(l*xr),f=Pl,u=Tl,p=f*(l/c),g=u*(l/c),v=Math.ceil(p/l),_=Math.ceil(g/l),b=i-p/2,y=o-g/2,k=Math.floor(b/l),S=Math.floor(y/l),A=k+v,F=S+_;(A*l-b)*(c/l)<f&&A++,(F*l-y)*(c/l)<u&&F++,k=Math.max(0,k),S=Math.max(0,S),A=Math.min(a/r,A),F=Math.min(a/r,F);for(let O=k;O<A;++O)for(let se=S;se<F;++se){let re=O*r+se*a*r,ie=r+"-"+re;if(Cu.has(ie)){let ce=Cu.get(ie);if(ce.loaded){let ke=(O*l-b)*(c/l),ge=(se*l-y)*(c/l);n.drawImage(ce,ke,ge,c,c)}}else{let ce=new Image;ce.src=zk(I.file,r,re),ce.onload=H8,Cu.set(ie,ce)}}let M=!1;if(pc.neticons.forEach(O=>{M=M||O.blink;let se=s0(O.pos[0],O.pos[1],i,o,c,l,f,u);o2(se,O.id,O.blink)}),M&&(n.globalAlpha=1),pc.npcs.forEach(O=>{let se=pR(O.pos[0],O.pos[1],i,o,c,l,f,u);se[0]>0&&se[1]>0&&se[0]<f&&se[1]<u&&o2(se,O.img,!1)}),I.entities.array.forEach(O=>{if(!O.stats||!O.stats.alive||O===e)return;let se=s0(O.pos[0],O.pos[2],i,o,c,l,f,u);G8(se,O.type,e.hostility(O),O.party>0&&O.party===e.party)}),en.forEach(O=>{if(O.local&&O.pos!==void 0&&!I.isEntityIdTaken(O.id)){let se=s0(O.pos[0],O.pos[1],i,o,c,l,f,u);G8(se,0,0,e.party)}}),e.buffs.buffs.has(128)){let O=e.buffs.buffs.get(128).get(e.id);if(O.data){let se=s0(O.data[0],O.data[1],i,o,c,l,f,u);o2(se,2100,!1)}}n.globalAlpha=i0&&I.smoothtime%1<.5?.5:1;let D=I.player.visual.transform.rotation[1],L=Math.sin(D)*6,E=Math.cos(D)*6,R=Math.sin(D+2.4)*6,z=Math.cos(D+2.4)*6,q=Math.sin(D-2.4)*6,j=Math.cos(D-2.4)*6,W=f/2-o0*xr,N=u/2-r0*xr;n.fillStyle="#C1DAE2",n.strokeStyle="#1A293A",n.lineWidth=1,n.beginPath(),n.moveTo(W+L,N+E),n.lineTo(W+R,N+z),n.lineTo(W+q,N+j),n.closePath(),n.fill(),n.stroke()},o2=(t,e,n)=>{if(i2.has(e)){let s=i2.get(e);if(s.loaded===!0){!n||I.smoothtime%1<.5?Fi.globalAlpha=n?.6:.8:Fi.globalAlpha=1;let i=s.width,o=s.height;Fi.drawImage(s,t[0]-i/2,t[1]-o/2,~~i,~~o)}}else{let s=document.createElement("img");s.src="data/assets/"+Pm(e)+"?v=8593107",s.onload=H8,i2.set(e,s)}},G8=(t,e,n,s)=>{if(!(!le.mapShowMonsters&&e===1))if(e===0){if(i0&&s&&I.smoothtime%1>.5)return;n===0?Fi.fillStyle=s?Fu.party:Fu.friendly:Fi.fillStyle=Fu.pvp,Fi.fillRect(...t,6,6),Fi.strokeRect(...t,6,6)}else Fi.fillStyle=n>0?Fu.monster:Fu.friendly,Fi.fillRect(...t,4,4),Fi.strokeRect(...t,4,4)},pR=(t,e,n,s,i,o,r,l)=>{let a=t-n,c=e-s,f=a/o*i,u=c/o*i,p=r/2+f,g=l/2+u;return[p,g]},s0=(t,e,n,s,i,o,r,l)=>{let a=t-n,c=e-s,f=a/o*i,u=c/o*i,p=Math.min(r-3,Math.max(0,r/2+f)),g=Math.min(l-3,Math.max(0,l/2+u));return[p,g]},mR=t=>{Cu.clear();for(let e=0;e<Ef.length;++e)Ef[e].world===t.idInt&&pc.npcs.push(Ef[e])},dR=t=>{Cu.clear(),pc.neticons.length=0,pc.npcs.length=0};function Y8(t){let e,n,s,i;return{c(){e=h("img"),m(e,"class","btn border black bgblack round warIcon svelte-1khf45q"),at(e.src,n="/data/ui/icons/war0."+On+"?v=8593107")||m(e,"src",n)},m(o,r){w(o,e,r),s||(i=X(e,"click",t[2]),s=!0)},p:ue,d(o){o&&x(e),s=!1,i()}}}function hR(t){let e,n=t[0]!==void 0&&Y8(t);return{c(){e=h("div"),n&&n.c(),m(e,"id","minimapcontainer"),m(e,"class","marg-top minimapcontainer svelte-1khf45q")},m(s,i){w(s,e,i),n&&n.m(e,null)},p(s,[i]){s[0]!==void 0?n?n.p(s,i):(n=Y8(s),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},i:ue,o:ue,d(s){s&&x(e),n&&n.d()}}}function gR(t,e,n){let s,i;return oe(t,Oi,r=>n(0,s=r)),oe(t,$i,r=>n(1,i=r)),Pn(()=>{l0(!1)}),[s,i,r=>tt($i,i=!i,i)]}var a2=class extends Fe{constructor(e){super(),Se(this,e,gR,hR,Oe,{})}},X8=a2;function Q8(t){let e,n;return e=new zC({}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function Z8(t){let e,n;return e=new $C({props:{vertical:!0}}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function vR(t){let e,n,s,i,o,r,l,a,c,f,u,p,g,v,_,b,y,k,S,A,F,M,D,L,E,R,z,q,j,W,N,O,se,re,ie,ce,ke,ge,Ne,Te;e=new BM({}),s=new B_({});let Ce=t[0]&&!t[0].subscribed_until&&(t[1]||t[2]||t[3]||t[4]||t[5])&&Q8(t);r=new $F({}),l=new WF({}),a=new Rb({}),c=new cF({}),f=new NM({}),u=new vx({}),g=new RF({}),v=new ax({}),_=new EM({}),b=new qM({}),y=new GM({}),k=new r6({}),S=new VF({}),A=new x6({}),F=new L6({}),M=new W6({}),D=new X6({}),L=new bF({}),E=new bC({}),R=new FC({}),z=new hC({}),q=new qC({}),W=new QM({}),N=new X8({}),O=new jC({});let _e=t[6]&&Z8(t);return ce=new zw({}),ke=new FM({}),ge=new SC({}),Ne=new zF({}),{c(){ne(e.$$.fragment),n=h("div"),ne(s.$$.fragment),i=h("div"),Ce&&Ce.c(),o=be(),ne(r.$$.fragment),ne(l.$$.fragment),ne(a.$$.fragment),ne(c.$$.fragment),ne(f.$$.fragment),ne(u.$$.fragment),p=$e(),ne(g.$$.fragment),ne(v.$$.fragment),ne(_.$$.fragment),ne(b.$$.fragment),ne(y.$$.fragment),ne(k.$$.fragment),ne(S.$$.fragment),ne(A.$$.fragment),ne(F.$$.fragment),ne(M.$$.fragment),ne(D.$$.fragment),ne(L.$$.fragment),ne(E.$$.fragment),ne(R.$$.fragment),ne(z.$$.fragment),ne(q.$$.fragment),j=h("div"),ne(W.$$.fragment),ne(N.$$.fragment),ne(O.$$.fragment),_e&&_e.c(),se=h("div"),re=h("div"),ie=h("div"),ne(ce.$$.fragment),ne(ke.$$.fragment),ne(ge.$$.fragment),ne(Ne.$$.fragment),m(j,"class","l-corner-ur uiscaled"),m(i,"class","container svelte-k3qmu8"),m(ie,"class","actionbarcontainer svelte-k3qmu8"),m(re,"class","uiscaled"),m(se,"class","container svelte-k3qmu8"),m(n,"class","l-ui layout svelte-k3qmu8")},m(H,de){ee(e,H,de),w(H,n,de),ee(s,n,null),d(n,i),Ce&&Ce.m(i,null),d(i,o),ee(r,i,null),ee(l,i,null),ee(a,i,null),ee(c,i,null),ee(f,i,null),ee(u,i,null),d(i,p),ee(g,i,null),ee(v,i,null),ee(_,i,null),ee(b,i,null),ee(y,i,null),ee(k,i,null),ee(S,i,null),ee(A,i,null),ee(F,i,null),ee(M,i,null),ee(D,i,null),ee(L,i,null),ee(E,i,null),ee(R,i,null),ee(z,i,null),ee(q,i,null),d(i,j),ee(W,j,null),ee(N,j,null),ee(O,j,null),_e&&_e.m(j,null),d(n,se),d(se,re),d(re,ie),ee(ce,ie,null),ee(ke,ie,null),ee(ge,se,null),ee(Ne,n,null),Te=!0},p(H,[de]){H[0]&&!H[0].subscribed_until&&(H[1]||H[2]||H[3]||H[4]||H[5])?Ce?de&63&&P(Ce,1):(Ce=Q8(H),Ce.c(),P(Ce,1),Ce.m(i,o)):Ce&&(Ee(),V(Ce,1,1,()=>{Ce=null}),De()),H[6]?_e?de&64&&P(_e,1):(_e=Z8(H),_e.c(),P(_e,1),_e.m(j,null)):_e&&(Ee(),V(_e,1,1,()=>{_e=null}),De())},i(H){Te||(P(e.$$.fragment,H),P(s.$$.fragment,H),P(Ce),P(r.$$.fragment,H),P(l.$$.fragment,H),P(a.$$.fragment,H),P(c.$$.fragment,H),P(f.$$.fragment,H),P(u.$$.fragment,H),P(g.$$.fragment,H),P(v.$$.fragment,H),P(_.$$.fragment,H),P(b.$$.fragment,H),P(y.$$.fragment,H),P(k.$$.fragment,H),P(S.$$.fragment,H),P(A.$$.fragment,H),P(F.$$.fragment,H),P(M.$$.fragment,H),P(D.$$.fragment,H),P(L.$$.fragment,H),P(E.$$.fragment,H),P(R.$$.fragment,H),P(z.$$.fragment,H),P(q.$$.fragment,H),P(W.$$.fragment,H),P(N.$$.fragment,H),P(O.$$.fragment,H),P(_e),P(ce.$$.fragment,H),P(ke.$$.fragment,H),P(ge.$$.fragment,H),P(Ne.$$.fragment,H),Te=!0)},o(H){V(e.$$.fragment,H),V(s.$$.fragment,H),V(Ce),V(r.$$.fragment,H),V(l.$$.fragment,H),V(a.$$.fragment,H),V(c.$$.fragment,H),V(f.$$.fragment,H),V(u.$$.fragment,H),V(g.$$.fragment,H),V(v.$$.fragment,H),V(_.$$.fragment,H),V(b.$$.fragment,H),V(y.$$.fragment,H),V(k.$$.fragment,H),V(S.$$.fragment,H),V(A.$$.fragment,H),V(F.$$.fragment,H),V(M.$$.fragment,H),V(D.$$.fragment,H),V(L.$$.fragment,H),V(E.$$.fragment,H),V(R.$$.fragment,H),V(z.$$.fragment,H),V(q.$$.fragment,H),V(W.$$.fragment,H),V(N.$$.fragment,H),V(O.$$.fragment,H),V(_e),V(ce.$$.fragment,H),V(ke.$$.fragment,H),V(ge.$$.fragment,H),V(Ne.$$.fragment,H),Te=!1},d(H){H&&x(n),te(e,H),te(s),Ce&&Ce.d(),te(r),te(l),te(a),te(c),te(f),te(u),te(g),te(v),te(_),te(b),te(y),te(k),te(S),te(A),te(F),te(M),te(D),te(L),te(E),te(R),te(z),te(q),te(W),te(N),te(O),_e&&_e.d(),te(ce),te(ke),te(ge),te(Ne)}}}function _R(t,e,n){let s,i,o,r,l,a,c;return oe(t,ra,f=>n(0,s=f)),oe(t,Tr,f=>n(1,i=f)),oe(t,ai,f=>n(2,o=f)),oe(t,Ni,f=>n(3,r=f)),oe(t,Ys,f=>n(4,l=f)),oe(t,Vs,f=>n(5,a=f)),oe(t,da,f=>n(6,c=f)),lu(),[s,i,o,r,l,a,c]}var c2=class extends Fe{constructor(e){super(),Se(this,e,_R,vR,Oe,{})}},J8=c2;function K8(t){let e,n;return e=new J8({}),{c(){ne(e.$$.fragment)},m(s,i){ee(e,s,i),n=!0},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function bR(t){let e,n,s,i;e=new c_({props:{active:t[0]}});let o=t[1]&&!t[0]&&t[2]&&K8(t);return s=new R_({}),{c(){ne(e.$$.fragment),o&&o.c(),n=be(),ne(s.$$.fragment)},m(r,l){ee(e,r,l),o&&o.m(r,l),w(r,n,l),ee(s,r,l),i=!0},p(r,[l]){let a={};l&1&&(a.active=r[0]),e.$set(a),r[1]&&!r[0]&&r[2]?o?l&7&&P(o,1):(o=K8(r),o.c(),P(o,1),o.m(n.parentNode,n)):o&&(Ee(),V(o,1,1,()=>{o=null}),De())},i(r){i||(P(e.$$.fragment,r),P(o),P(s.$$.fragment,r),i=!0)},o(r){V(e.$$.fragment,r),V(o),V(s.$$.fragment,r),i=!1},d(r){r&&x(n),te(e,r),o&&o.d(r),te(s,r)}}}function yR(t,e,n){let s,i,o;return oe(t,xs,r=>n(0,s=r)),oe(t,op,r=>n(1,i=r)),oe(t,Lc,r=>n(2,o=r)),[s,i,o]}var f2=class extends Fe{constructor(e){super(),Se(this,e,yR,bR,Oe,{})}},eA=f2;var nA=[],Su=0,a0=0,tA=()=>{let t=nA.shift();t[0](...t[1]),a0--},sA=(t,e,n)=>{if(n)for(;Su>0;)Su--,a0++,tA();else Su>0&&a0<5&&(Su--,a0++,requestIdleCallback(tA,{timeout:5e3}))},u2=(t,e,n)=>{nA.push([t,e]),Su++};var iA=()=>({id:0,x:0,z:0,origin:[0,0,0],deserialized:!1,props:[],normals:new Float32Array(3456),data:void 0,loadingProps:0,center2d:[0,0],geometry:{},meshes:{},state:0,neighbors:[],quadrantlod:[0,0,0,0],quadrantmask:[0,49,98,147],inRange:!1,isMeshVisible:!1,isEffectsVisible:!1}),p2=(t,e,n,s,i)=>{jS(t,e,n,s),t.center2d[0]=t.origin[0]+64/2,t.center2d[1]=t.origin[2]+64/2,t.neighbors.length=0;for(let o=Math.max(0,n-1);o<=Math.min(i-1,n+1);o++)for(let r=Math.max(0,s-1);r<=Math.min(i-1,s+1);r++){let l=o+r*i;l!==t.id&&t.neighbors.push(l)}t.state=0},oA=t=>t.state>=2?!1:(t.state=2,kR(t),!0),kR=async t=>{try{let n=await(await fetch(`data/world/${I.file}/${t.id}?v=8593107`,{cache:"default"})).arrayBuffer();u2(xR,[new Uint8Array(n),t])}catch{console.log(`failed to load chunk ${t.id}, retrying`),t.state=2-1,oA(t)}},xR=(t,e)=>{e.state=3,WS(e,_a.chunk.decode(t)),m2(e)},m2=t=>{if(t.inRange=Rv(t.x*2,t.z*2)<3,t.inRange)for(let e=0;e<2;++e)for(let n=0;n<2;++n){let s=n*2+e,i=Math.min(2,Rv(t.x*2+e,t.z*2+n)),o=QC(t.x*2+e,t.z*2+n);t.quadrantlod[s]=i,t.quadrantmask[s]=o}},rA=(t,e)=>{let n=t.state;if(n===0||n===3){if(t.inRange){n===0&&(t.state=1);let s=t.loadingProps===0;for(let i=0;i<t.neighbors.length;++i){let o=e.chunksMap.get(t.neighbors[i]);o?o.state<3&&(o.state===0&&(o.state=1),s=!1):s=!1}n===3&&s&&(t.state=4,wR(t,!0,!0,!0,!0,!0,!0))}}else n>=5?t.inRange&&t.state<7?(z8(t),t.state=7):!t.inRange&&t.state===7&&(s2(t),Au(t,!1,!1),t.state=6):n===1&&oA(t)&&(t.state=2)},Au=(t,e,n)=>{if(t.isMeshVisible!==e){t.isMeshVisible=e;for(let s=0;s<t.props.length;++s)t.props[s].setVisible(e)}if(!n&&t.isEffectsVisible!==e){t.isEffectsVisible=e;for(let s=0;s<t.props.length;++s)t.props[s].setEffectVisible(e)}},wR=(t,e,n,s,i,o,r)=>{u2($8,[t,e,n,s,i,o])},d2=t=>{HS(t),t.state===7&&(s2(t),Au(t,!1,!1),t.state=6),N8(t),t.state=8};var aA=(t,e,n)=>{let s=[];for(let i=0;i<t.length;++i){let o=t[i];US(o.data.aabb,e.frustum,e.frustumConstants)?(s.push(o),Au(o,!0,n)):Au(o,!1,n)}return s},MR=()=>{let t=uc;if($.enable($.POLYGON_OFFSET_FILL),$.polygonOffset(1.3,3),tc){for(let e=1;e>=0;--e){let n=$a[e],s=Ml[e];ed(s,!0),Pu(n),Th(n),t=aA(t,s,!0);for(let i=0,o=qd.length;i<o;++i){let r=qd[i];Ka(r,pt[r.shadowProgram],!0,s)}}gu(!1)}ed(Ml[0],!0),c0($a[0],Na,$.DEPTH_BUFFER_BIT),Pu(Na);for(let e=0,n=Ld.length;e<n;++e){let s=Ld[e];Ka(s,pt[s.shadowProgram],!1,gt)}$.disable($.POLYGON_OFFSET_FILL)},FR=t=>{ed(gt,!0),Pu(bi),Th(bi);for(let e=0,n=Dd.length;e<n;++e){let s=Dd[e];Ka(s,pt[s.program],!0,gt)}B8(t)},CR=t=>{U8(t);for(let e=0,n=Id.length;e<n;++e){let s=Id[e];Ka(s,pt[s.program],!0,gt)}c0(bi,Fo,$.DEPTH_BUFFER_BIT),c0(bi,Fo,$.COLOR_BUFFER_BIT),Pu(bi),O8(t);for(let e=0,n=Vd.length;e<n;++e){let s=Vd[e];Ka(s,pt[s.program],!0,gt)}},mc=(t,e,n,s,i)=>{let o=pt[t];n&&Vn("inputA",n.colorTexture,0,o),s&&Vn("inputB",s.colorTexture,0,o);for(let r=0;r<i.length;++r){let l=o.uniforms[i[r][0]];l.value=i[r][1]}Pu(e),Ks(Vf,o)},SR=t=>{let e=Fo,n=bi;if(t.has(32)&&(t.delete(32),mc(32,e,n,null,[]),[e,n]=[n,e]),t.has(33)&&(t.delete(33),mc(33,e,n,null,[]),[e,n]=[n,e]),t.has(30)){t.delete(30);let s=.5/fl.width,i=.5/fl.height;mc(30,ul,n,null,[["offset",[-s,-i,s,-i,s,i,-s,i]],["amount",[.25,.25,.25,.25]]]);let o=["amount",[.125,.375,.375,.125]];s*=2,i*=2,mc(30,fl,ul,null,[["offset",[-s*2,0,-s,0,s,0,s*2,0]],o]),mc(30,ul,fl,null,[["offset",[0,-i*2,0,-i,0,i,0,i*2]],o]),mc(31,null,n,ul,[])}else c0(n,null,$.COLOR_BUFFER_BIT)},c0=(t,e,n,s=$.NEAREST)=>{let i=t.width,o=t.height,r=e!==null?e.width:bi.width,l=e!==null?e.height:bi.height;$.bindFramebuffer($.READ_FRAMEBUFFER,t.buffer),$.bindFramebuffer($.DRAW_FRAMEBUFFER,e!==null?e.buffer:null),$.blitFramebuffer(0,0,i,o,0,0,r,l,n,s)},Pu=t=>{t?($.bindFramebuffer($.FRAMEBUFFER,t.buffer),$c(t.width,t.height)):($.bindFramebuffer($.FRAMEBUFFER,null),$c(et.width,et.height))},cA=t=>{Fx(t)},fA=t=>{MR();let e=aA(uc,gt,!1);FR(e),CR(e),SR(t)};var dc=le.resolution/100,pA=!1,uA=[256,512,1024,2048][le.shadowmapResolution]||1024,mA=()=>{$||(alert("WebGL2 problem found."),window.location.href="/technical"),dA(),cA(uA),V8(uA),gA(et.width,et.height),In.className="l-canvas",Fs.className="l-canvas",Fs.style.pointerEvents="all",window.addEventListener("resize",hA,!1)};zr.subscribe(t=>{YC(t**2/10,le.shadowmapResolution)});Br.subscribe(t=>{gt.fov=t,Oc(gt)});xs.subscribe(t=>{pA=!t});var dA=()=>{let t=window.innerWidth*dc,e=window.innerHeight*dc;A_(t,e)},hA=()=>{let t=window.innerWidth*dc,e=window.innerHeight*dc;dA(),Cx(t,e),gA(t,e)},gA=(t,e)=>{gt.aspect=t/e,Oc(gt),Sw(t,e)};Ur.subscribe(t=>{let e=t/100,n=dc!==e;dc=e,le.resolutionScale=e,n&&hA()});var vA=(t,e)=>{Sp(gt);let n=new Set;le.fxaa&&n.add(32),le.bloom&&n.add(30),pA&&(L8(t,e.smoothtime,n),fA(n))},_A=(t,e)=>{q8(t,e)},bA=t=>{R8(t),MS()};bo.report.fun=t=>{t.length>=3?ro.set({name:t,reason:0,reasonfixed:!1}):Wt("error","Enter a player name to report",!0)};var b2={};Xn(b2,{init:()=>LR,postTick:()=>qR});var Tu=[],to=0,yA=t=>{to+=t;let e=[];for(let s=0;s<Tu.length;s++){let i=Tu[s];if(i.timer.done(to))TR(i),Tu.splice(s--,1);else if(to>=i.timer.start){let o=i.timer.fraction(to);it(i.screenPos,i.pos);let r=gl(i.screenPos,i.screenPos,i.flat);if(r){let l=i.timer.remaining(to);if(i.alpha=l<.3?l/.3:1,i.crit){let a=Math.min(1,o*6);i.scale=1+(a>.5?2-a*2:a*2)*1.6}else r[1]-=50-(1-o)**2*50,i.scale=1;e.push(i)}}}if(e.sort((s,i)=>i.timer.start-s.timer.start),le.combatTextPush){let s=0,i=!0,o=[0,0],r=[0,0];for(;s<10&&i;){++s,i=!1;for(let l=0;l<e.length;++l){let a=e[l],c=a.width*a.scale,f=a.height*a.scale;o[0]=a.screenPos[0]+a.screenOffset[0],o[1]=a.screenPos[1]+a.screenOffset[1];for(let u=0;u<e.length;++u){if(u===l)continue;let p=e[u],g=p.width*p.scale;if(p.flat!==a.flat||g<c||g===c&&l<u)continue;let v=p.height*p.scale;r[0]=p.screenPos[0]+p.screenOffset[0],r[1]=p.screenPos[1]+p.screenOffset[1];let _=r[0]-o[0],b=r[1]-o[1],y=g/2+c/2,k=v/2+f/2;if(Math.abs(_)<y&&Math.abs(b)<k){let S=_<0?_+y:_-y,A=b<0?b+k:b-k;Math.abs(S)<Math.abs(A)*1.2?a.screenOffset[0]+=S:a.screenOffset[1]+=A,i=!0,o[0]=a.screenPos[0]+a.screenOffset[0],o[1]=a.screenPos[1]+a.screenOffset[1]}}}}}let n=[0,0];for(let s=0;s<e.length;++s){let i=e[s];i.screenOffset[0]*=Math.max(0,1-t*3),i.screenOffset[1]*=Math.max(0,1-t*3),n[0]=i.screenPos[0]+i.screenOffset[0],n[1]=i.screenPos[1]+i.screenOffset[1],bM(n,i.img,i.alpha,i.scale)}},g2=(t,e,n,s,i=!1,o)=>{let r=n===3;Eu(t,i,r,i||!r,n===0?"Miss":ht(e)+(n===1?"\u{1F6E1}\uFE0F":""),i?It.pdmg:s===1?r?It.spellCrit:It.spell:r?It.physCrit:It.phys,o,to,r?1.2:.9)},v2=(t,e,n,s=!1,i)=>{Eu(t,s,n===3,s||n!==3,ht(e),s?It.pheal:It.heal,i,to,1.3)},kA=(t,e,n)=>{Eu(t,n,!1,!0,"Immune",n?It.mana:It.spell,e,to,2)},xA=(t,e,n,s=!1)=>{Eu(t,s,n===3,s||n!==3,e,It.mana,0,to,1.3)};var wA=(t,e)=>{Eu(t,!1,!1,!0,`+${e} Fame`,It.fame,5.5,to,1.5)},Eu=(t,e=!1,n=!1,s=!1,i,o,r,l,a)=>{let c=PR();it(c.pos,t),c.pos[1]+=r||0,c.side=Math.sin(Tu.length*2.3),c.flat=e,c.crit=n,c.float=s,c.timer.reset(l,a),Y(c.screenPos,0,0,0),ds(c.screenOffset,0,0,0),c.scale=0,c.alpha=0,c.img=tu(i,o),c.width=c.img.width,c.height=c.img.height,Tu.push(c)},h2=[],PR=()=>h2.length?h2.pop():{pos:[0,0,0],flat:!0,crit:!0,float:!0,yoffset:0,timer:new kt(0,1),screenPos:[0,0,0],screenOffset:[0,0],scale:0,alpha:0,img:void 0,width:0,height:0},TR=t=>{h2.push(t)};var _2=le.itemTypeFilter.toLowerCase().replace(/\s/g,"").split(","),hc=new Set,ER=(t,e,n)=>{for(let s=n.length-1;s>=0;s--){let i=n[s];(i==e||Kn(e.pos,i.pos)<5**2)&&(t.push(i),Rn(t.pos,t.pos,i.pos),n.splice(s,1))}},MA=(t,e)=>{it(t.hudPos,t.visualPosition||t.pos),gl(t.hudPos,t.hudPos)&&t.hudPos[2]<.997&&e.push(t)},FA=t=>{let e=[];I.entities.array.forEach(i=>{i.type!==3||!i.visual.transform.visible||i.quality<le.itemQualityFilter||_2.includes(i.droptype)||MA(i,e)}),hc.forEach(i=>{i.uiTimeout<I.time?hc.delete(i):MA(i,e)}),e=e.sort((i,o)=>o.id-i.id);let n=new Set;for(;e.length;){let i=e[0],o=[];o.pos=[0,0,0],ER(o,i,e),dn(o.pos,o.pos,1/o.length),Y(o.pos,Math.round(o.pos[0]),Math.round(o.pos[1]),Math.round(o.pos[2])),gl(o.pos,o.pos)?n.add(o.sort((r,l)=>r.hudPos[2]-l.hudPos[2])):n.delete(o)}let s=0;Array.from(n).sort((i,o)=>o.pos[2]-i.pos[2]).forEach(i=>{let o=i.length/5*100,r=0,l=0;i.forEach((a,c)=>{a.hudTextImg||(a.hudTextImg=tu(a.name,It[a.color]));let f=a.hudTextImg.width,u=Math.round(i.pos[0]+l-o*.5)-2,p=Math.round(i.pos[1]-r*20)-8;if(a.uiTimeout===0){let g=a.canBePickedUpBy(I.player),v=a.partyTimeoutCheck(I.player);g&&!(qa[0]>u+f||qa[1]>p+20||qa[0]<u||qa[1]<p)?(s=a.id,Cs.globalAlpha=1):Cs.globalAlpha=g?.4:.1,Cs.fillStyle="#000000",Cs.beginPath(),Cs.rect(u,p,f,20),Cs.fill(),fr(ds(Bn,u+2,p+8),a.name,v?It[a.color]:It.itemgrey,g?1:.8,1,0,0,0)}l+=f+3,l>o&&(r++,l=0)})}),s!==vn&&Zf(s)};var Yn=[],CA,SA,$s=2,AA=()=>{let n=Math.ceil(100),s=Math.max(7,Math.ceil(9*1)),i=Math.max(1,Math.ceil($s*1)),o=n-$s*2,r=s-$s*2;Yn.push(Ts(null,Dt("panel"),n,s,0,0,i)),Ts(Yn[0],Dt("grey"),o,r,$s,$s,1),Yn.push(Ts(null,Dt("health"),o,r,0,0,1)),Yn.push(Ts(null,"#ffbc00",o,r,0,0,1)),Yn.push(Ts(null,Dt("enemy"),o,r,0,0,1)),Yn.push(Ts(null,Dt("party"),o,r,0,0,1)),Yn.push(Ts(null,Dt("pvp"),o,r,0,0,1)),Yn.push(Ts(null,"#555555",o,r,0,0,1)),Yn.push(Ts(null,Dt("spell"),o,r,0,0,1));for(let l=0;l<=3;++l)Yn.push(Ts(null,Dt("c"+l),o,r,0,0,1));CA=Ts(null,"#ffffff",100+$s*2,9+$s*2,0,0,3),SA=Ts(null,"#ffffff",100+$s*2,16+$s*2,0,0,3)},DR=()=>{let t=[];return I.entities.array.forEach((e,n)=>{!e.visual||!e.visual.transform.visible||e.stats&&!e.stats.alive||e.id!==qn&&e.visual.cDist&&e.visual.cDist>60||e.type===3&&e.id!==vn||(it(e.hudPos,e.visualPosition||e.pos),e.type!==3&&(e.hudPos[1]+=e.visual.getTopAbsolute(),e.mount!==void 0&&(e.hudPos[1]+=1)),gl(e.hudPos,e.hudPos)&&(e.id===I.playerId&&(e.hudPos[0]=Math.round(.5*In.width),e.hudPos[1]=Math.round(.5*In.height)),t.push(e)))}),t.sort((e,n)=>n.hudPos[2]-e.hudPos[2])},IR=(t,e,n)=>e?4:n===0?le.classColorBars&&t.type===0?8+t.class:1:I.player.canCombatInteract(t)?n===2?le.classColorBars?8+t.class:5:t.type===1&&t.aggroMode===0?2:3:6,VR=(t,e)=>{let n=t.visual&&t.visual.cDist;if(n>le.nameplateViewRange)return;n?n/=70:n=0;let s=t.party>0&&t.party===I.player.party,i=t.faction!==void 0?I.player.hostility(t):0,o=I.player.clan,r=I.player.level,l=t.id===qn,a=t.id===I.playerId,c=t.id===vn;if(t.type!==3&&t.stats&&t.stats.alive){t.namePlateScale=vt(t.namePlateScale+((l?1:0)-t.namePlateScale)*.25,.5,1);let p=l?1:Math.max(.1,Math.min(1,1-n))*.7,g=l||s?1:Math.min(.8,c?.9:p*.75+.2),v=t.skills.timedSkill!==void 0;!a&&l&&cr(v?SA:CA,t.hudPos,1,t.namePlateScale,1,v?2:1,0,v?4:0);let _=l||i===0&&le.nameplateShowFriendlyPlayers||i===1&&le.nameplateShowMonsters||i===2&&le.nameplateShowEnemyPlayers;if(v&&_){let b=Yn[0].height-$s,y=vt(t.skills.timedCast.fraction(I.smoothtime),0,1);cr(Yn[0],t.hudPos,g,t.namePlateScale,1,1,0,b),y>0&&cr(Yn[7],t.hudPos,g,t.namePlateScale,y,1,0,b)}if(!a&&_&&(cr(Yn[0],t.hudPos,g,t.namePlateScale,1,v?2:1),cr(Yn[IR(t,s,i)],t.hudPos,g,t.namePlateScale,t.stats.getResource(6)/t.stats.getStat(6),1),t.clan&&fr(ds(Bn,t.hudPos[0]-(Yn[0].width/2+$s)*t.namePlateScale,t.hudPos[1]),t.clan,t.clan==o?It.clan:t.faction===0?It.faction0small:It.faction1small,g,1,2,0,1),t.level&&(le.alwaysShowLevel||l))){let b=It.lev1;i!==0&&(t.level-r>4?b=It.lev3:t.level-r>1?b=It.lev2:t.level-r<-5&&(b=It.lev0)),fr(ds(Bn,t.hudPos[0]+(Yn[0].width/2+$s)*t.namePlateScale,t.hudPos[1]),t.level,b,g,1,0,0,0)}}let f,u=!1;if(t.type===3?(f=t.partyTimeoutCheck(I.player)?It[t.color]:It.itemgrey,u=!0):i===0?(f=l?It.name:It.nameSmall,u=le.nameShowFriendlyPlayers):i===1?(f=l?It.enemy:It.enemySmall,u=le.nameShowMonsters):i===2&&(f=l?It.pvp:It.pvpSmall,u=le.nameShowEnemyPlayers),l||u){let p=t.type===3&&c&&!t.canBePickedUpBy(I.player)?.5:l||t.type===3?1:c?.9:Math.max(.1,Math.min(1,1-n))*.7,g=l?-16:-9,v=a&&t.clan?t.clan.length*5:0,_=fr(t.hudPos,t.name,f,p,1,v,g);t.clan&&a&&fr(ds(Bn,t.hudPos[0]-_/2+$s,t.hudPos[1]),t.clan,t.faction===0?l?It.faction0:It.faction0small:l?It.faction1:It.faction1small,p,1,t.clan.length*5,g,1)}t.speechText&&fr(t.hudPos,t.speechText,t.speechStyle,1,1,0,l?-30:-20,.5,1)},PA=t=>{hc.clear();let e=DR();og(e),e=e.sort((n,s)=>n.id===qn||n.id===vn?1:s.id===qn||s.id===vn?-1:s.hudPos[2]-n.hudPos[2]),es(vo,0,0,0,0),e.forEach(VR)};var LR=()=>{_M(),AA()},qR=t=>{Cs.clearRect(0,0,In.width,In.height),nt.shift.down?FA(t):PA(t),yA(t)};var y2={};Xn(y2,{onWorldEnter:()=>RR});var RR=()=>{xt("petlootsettings",_2.join(",")+" "+le.itemQualityFilter)};var k2={};Xn(k2,{init:()=>zR});var zR=()=>{Un(Ft.serverWarUpdate.header,t=>{let e=Ft.serverWarUpdate.decode(t);Oi.update(n=>(n===void 0||e.contributors.length===0&&(e.contributors=n.contributors),e))})};var gc=[b2,rg,Fg,Hg,l2,P1,Wh,z1,Qh,y2,bg,_m,k2],x2=!1,TA=()=>{gc.forEach(t=>{t.init&&t.init()})},EA=t=>{gc.forEach(e=>{e.preTick&&e.preTick(t)})},DA=t=>{gc.forEach(e=>{e.tick&&e.tick(t)})},IA=(t,e)=>{gc.forEach(n=>{n.postTick&&n.postTick(t,e)})},VA=t=>{gc.forEach(e=>{e.onWorldEnter&&e.onWorldEnter(t)}),x2=!0},LA=t=>{x2&&gc.forEach(e=>{e.onWorldDestroy&&e.onWorldDestroy(t)}),x2=!1};var RA=async t=>{let n=await(await fetch("api/user/join",{method:"POST",body:JSON.stringify({id:t})})).json();if(n.world)Rr.set(n.world),Wc.set(t);else throw Rr.set(void 0),Wc.set(void 0),n.result||"Unknown Error";return!0};var zA=0,f0=!1,BA=new kt(0,2e4),UA=2,OA=t=>{BA.done(t)&&(t>1e5&&!f0&&t-zA>60*1e3*3?(f0=!0,zA=t,Tr.set(UA),UA++):f0&&(f0=!1,Tr.set(0)),BA.reset(t))};var w2={arena3v3:{port:5006},arena5v5:{port:5007},main:{port:5009},dev2:{port:5010},dev_default:{port:5010},dev_pathfind:{port:5011},arena_big_swamp:{port:5012},arena_cage:{port:5013},arena_cove:{port:5014},arena_lava:{port:5015},arena_ruins:{port:5016},arena_small_swamp:{port:5017}};var M2=t=>{w2[le.activeWorld]===void 0?window.location.href="/":(console.log("Connecting to "+le.activeWorld),t&&xs.set("Connecting"),k3(w2[le.activeWorld].port))},$A=t=>{I.load(t.world,t.file,t.playerId),I.setTimeFromTickId(t.tickId),Du=0},Du=0,NA=async t=>{if(t===4002)xs.set("Connecting"),I.destroy();else try{if(Du<10?xs.set("Connecting"):xs.set(`Connecting (${t})`),t===1006&&(Du++,Du>=20)||t>=4008)throw!0;I.destroy();let e=Du>1?_1(500,1e3):_1(1200,1600);for(await new Promise(n=>setTimeout(n,e));document.visibilityState==="hidden";)xs.set("Browser is idle"),await new Promise(n=>setTimeout(n,e));await RA(le.lastConnectedChar)}catch{return window.location.href="/",!1}M2(!1)},jA=(t,e)=>{d3(e),sA(t,e,I.state<=2),OA(e),I&&I.player?(my(t),EA(t),I.tick(t),DA(t),vA(t,I),IA(t,I)):I&&I.tick(t)};var u0=class{constructor(){this.nodes=new Map,this.width=-0,this.height=-0,this.depth=-0,this.yd=-0,this.zd=-0,this.xm=-0,this.ym=-0,this.zm=-0,this.xs=-0,this.ys=-0,this.zs=-0,this.dirty=!1}setDimensions(e,n,s,i,o,r){this.clear(),this.dirty=!0;let l=Math.floor(e/i),a=Math.floor(n/o),c=Math.floor(s/r);this.width=e,this.height=n,this.depth=s,this.yd=a,this.zd=c,this.xm=l-1,this.ym=a-1,this.zm=c-1,this.xs=e/l,this.ys=n/a,this.zs=s/c}clear(){this.nodes.clear()}add(e,n){let s=Math.max(0,Math.min(this.xm,~~(n[0]/this.xs))),i=Math.max(0,Math.min(this.ym,~~(n[1]/this.ys))),o=Math.max(0,Math.min(this.zm,~~(n[2]/this.zs))),r=Math.max(0,Math.min(this.xm,~~(n[3]/this.xs))),l=Math.max(0,Math.min(this.ym,~~(n[4]/this.ys))),a=Math.max(0,Math.min(this.zm,~~(n[5]/this.zs)));for(let c=s;c<=r;++c)for(let f=i;f<=l;++f)for(let u=o;u<=a;++u){let p=c*this.yd*this.zd+f*this.zd+u;this.nodes.has(p)||this.nodes.set(p,{aabbs:[],content:[],count:0});let g=this.nodes.get(p);g.content.push(e),g.aabbs.push(n),g.count++}}queryAABB(e){let n=Math.max(0,Math.min(this.xm,~~(e[0]/this.xs))),s=Math.max(0,Math.min(this.ym,~~(e[1]/this.ys))),i=Math.max(0,Math.min(this.zm,~~(e[2]/this.zs))),o=Math.max(0,Math.min(this.xm,~~(e[3]/this.xs))),r=Math.max(0,Math.min(this.ym,~~(e[4]/this.ys))),l=Math.max(0,Math.min(this.zm,~~(e[5]/this.zs))),a=[];for(let c=n;c<=o;++c)for(let f=s;f<=r;++f)for(let u=i;u<=l;++u){let p=c*this.yd*this.zd+f*this.zd+u;if(this.nodes.has(p)){let g=this.nodes.get(p);for(let v=0;v<g.count;++v){let _=g.content[v];RS(g.aabbs[v],e)&&!a.includes(_)&&a.push(_)}}}return a}queryRay(e,n,s){let i=e[0]+n[0],o=e[1]+n[1],r=e[2]+n[2],l=Math.max(0,Math.min(this.xm,~~(Math.min(e[0],i)/this.xs))),a=Math.max(0,Math.min(this.ym,~~(Math.min(e[1],o)/this.ys))),c=Math.max(0,Math.min(this.zm,~~(Math.min(e[2],r)/this.zs))),f=Math.max(0,Math.min(this.xm,~~(Math.max(e[0],i)/this.xs))),u=Math.max(0,Math.min(this.ym,~~(Math.max(e[1],o)/this.ys))),p=Math.max(0,Math.min(this.zm,~~(Math.max(e[2],r)/this.zs))),g=[];for(let v=l;v<=f;++v)for(let _=a;_<=u;++_)for(let b=c;b<=p;++b){let y=v*this.yd*this.zd+_*this.zd+b;if(this.nodes.has(y)){let k=this.nodes.get(y);for(let S=0;S<k.count;++S){let A=k.content[S];BS(k.aabbs[S],e,s,0,1)&&!g.includes(A)&&g.push(A)}}}return g}queryNodeContents(e,n,s){e=Math.max(0,Math.min(this.xm,~~(e/this.xs))),n=Math.max(0,Math.min(this.ym,~~(n/this.ys))),s=Math.max(0,Math.min(this.zm,~~(s/this.zs)));let i=e*this.yd*this.zd+n*this.zd+s;return this.nodes.has(i)?this.nodes.get(i).content:[]}};var os={origin:[0,0,0],dir:[0,-1,0],invDir:[0,0,0]},p0=(t,e,n,s,i,o,r)=>{Y(t.origin,e,n,s),Y(t.dir,i,o,r),kp(t.invDir,t.dir)};var m0=class{constructor(e){this.entity=e,this.buffs=new Map,this.casters=new Map,eu.forEach(n=>{this[n]=new Set}),this.tags=new Map;for(let n=0;n<13;++n)this.tags.set(n,new Set)}tick(e,n,s){}setBuff(e,n,s,i,o,r){s<=0&&console.error("buff with zero or less stacks");let l=this.buffs.get(e)||this.buffs.set(e,new Map).get(e),a=l.get(n)||{};if(a.caster=n,a.id=e,a.level=r,a.stacks=s,a.logic=dl.get(e),a.timer=new kt(i,o),a.active=!0,a.uniqueInstances=0,a.remove=!1,a.logic.intervalDuration!==void 0){let f=i;a.interval&&(f=a.interval.start);let u=I.entity(n);a.interval=new kt(f,a.logic.intervalHaste&&u!==void 0?a.logic.intervalDuration/yF(u.stats.getStat(16)):a.logic.intervalDuration)}else a.interval=new kt(0,0);return l.set(n,a),a.logic.onSet(a,n,this),(this.casters.get(n)||this.casters.set(n,new Map).get(n)).set(e,a),a.logic.unique&&this.updateUniqueState(e),a}removeBuff(e,n){let s=this.buffs.get(e);if(s){let i=s.get(n);if(i){i.logic.onRemove(i,n,this),s.delete(n),s.size===0&&this.buffs.delete(e);let o=this.casters.get(n);return o.delete(e),o.size===0&&this.casters.delete(n),i.logic.unique&&this.updateUniqueState(e),i}}}updateUniqueState(e){let n=this.buffs.get(e);if(n){let s;n.forEach((i,o)=>{(!s||i.level>s.level)&&(s=i),i.active=!1,i.uniqueInstances=n.size}),s.active=!0}}clear(e,n=!1){this.buffs.forEach((s,i)=>{s.forEach((o,r)=>{(!n||r!==this.entity.id)&&o.logic.passive==e&&o.logic.clearOnDeath&&this.removeBuff(i,r)})})}clearTempBuffs(){this.clear(!1)}clearPassiveBuffs(){this.clear(!0)}onDeath(){this.clearTempBuffs()}hasAnyWithTag(e){return this.tags.get(e).size>0}};var js=[5,4,0,2,3,8,9],Ws=(t,e,n,s)=>{let i=t.entity.mount!==void 0;t.walking=!i&&t.walking,$R(t,i),NR(t,i),OR(t,i),UR(t,e,n,s,i),BR(t,e,n,s,i)},BR=(t,e,n,s)=>{if(t.body[0].visible&&t.entity.buffs.visualIncapacitate>0){Jn(t.body[0].rotation,(Math.sin(n*2.2)+Math.sin(n*2.1)*.3)*.3+1,(Math.sin(n*2.1)+Math.sin(n*2)*.6)*.3,(Math.sin(n*.8)+Math.sin(n*2.3)*.5)*.3);for(let i=2;i<=3;++i)t.body[i].position[1]-=.2}},UR=(t,e,n,s,i)=>{let o=t.body[2];if(o.visible&&(t.body[6]!==void 0&&(t.sheathed||(i?Ns(t,!0):t.entity.target&&!t.walking&&!t.falling?(o.rotation[0]+=1,o.rotation[2]+=.6,o.position[2]-=.3,o.position[1]-=.2,o.position[0]-=.1,t.body[4].position[0]-=.05,t.body[5].position[0]+=.05,t.body[4].position[2]-=.2,t.body[0].position[1]+=-.05+Math.sin(n*3)*.05,t.body[0].rotation[1]-=Math.cos(n*3)*.05):(o.rotation[0]+=.5,o.position[1]-=.2,o.position[0]-=.1))),t.currentAnim&&t.currentAnim.info.movement!==13)){let l=Qt.easeInOutCubic(t.currentAnim.fract),a=-Math.sin(l*7.5-1.5),c=-Math.sin(l*6.28),f=-Math.sin(l*3.14),u=Qt.easeOutExpo(-f);switch(dn(o.rotation,o.rotation,1-u),t.currentAnim.info.movement){case 0:if(t.body[6]!==void 0)Ns(t,!1),Jn(o.rotation,f*1.7,u*1.5,a*u+u*.5),o.position[2]-=f-l*u,o.position[1]+=Math.sin(l*13+3)*u*.5,o.position[0]+=(-.5+l*1.5)*u,t.body[0].rotation[1]+=c*1.5;else{let p=Math.cos(l*6.28);t.body[0].position[2]+=(.3+Math.sin(l*6.28-3.14)*.2)*u,t.body[0].rotation[0]+=Math.sin(l*3.28)*.5*u;for(let g=0;g<=1;++g){let v=t.body[2+g];v.visible&&(dn(v.position,v.position,1-u),v.position[2]+=(1-p*.5)*u,v.position[1]+=Math.sin(l*6.28)*(l>.5?.7:1),v.position[0]+=(g?.5+f*.2:-.5-f*.2)*u,Y(v.rotation,0,1.5,0))}}break;case 1:Ns(t,!1),o.rotation[0]-=f*1.7,o.rotation[1]+=u*1.5-u,o.rotation[2]+=a*u+u*.5,o.position[2]+=u,o.position[0]-=u*.5,t.body[0].rotation[1]-=c*1.5-u*.5;break;case 12:Ns(t,!1),o.rotation[0]=1.7,o.rotation[1]=0,o.rotation[2]=.5,o.position[2]=1.3,o.position[1]=.2,o.position[0]=-.5;break;case 4:Ns(t,!1),o.rotation[0]+=f*1.7,o.rotation[1]-=f*1.5,o.position[0]-=u*.5,t.body[0].rotation[1]=l*2*Math.PI+u*3;break;case 3:{Ns(t,!0),Y(t.body[0].rotation,f,0,0),Y(o.position,-.3,0,.7);break}case 11:{Ns(t,!1),Y(t.body[0].rotation,f*.4,0,f*.3),o.rotation[0]-=f*.8,o.rotation[1]+=f*.4;break}case 9:{Ns(t,!1),Y(o.rotation,0,0,0);break}case 5:{Ns(t,!0);break}}}let r=t.body[3];t.body[7]!==void 0&&r.visible&&(t.entity.target&&!t.walking&&!t.falling?(r.rotation[2]-=.2,r.rotation[1]-=1,r.position[1]+=.1,r.position[2]+=.4):(r.rotation[2]-=.1,r.position[1]+=.1))},OR=(t,e)=>{for(let n=0;n<=1;++n){let s=t.body[4+n];if(s.visible)if(e)Y(s.rotation,-.9,n?.2:-.2,n?.4:-.4),Y(s.position,n?.6:-.6,-.4,.5);else{let i=il(t.entity.steer);if(t.currentAnim&&t.currentAnim.info.movement===10){Y(s.position,0,0,0);continue}if(t.falling)if(t.flip==0){let o=Math.max(-1,Math.min(0,t.entity.vel[1]*.2))*.1,r=n?t.cycle(0)*.3-o:t.cycle(.5)*.3+o;Y(bt,n?.3-o:-.3+o,-.65,r),Vr(s.position,bt,0),Y(s.rotation,-r,i,0)}else Y(s.position,n?.3:-.3,-.3,0),Y(s.rotation,0,0,0);else if(t.entity.inWater>t.entity.radius)t.walking?(Y(s.rotation,1.3,n?.1:-.1,0),Y(s.position,n?.3:-.3,Math.cos(t.cycleRad+n*Math.PI)*.4,-1.1)):(Y(s.rotation,1,n?.1:-.1,0),Y(s.position,n?.3:-.3,-.7,Math.cos(t.cycleRad+n*Math.PI)*.4));else{if(t.walking){let o=t.entity.steer[1]<0?.4:.6,r=t.cycle(0)*o*1.3;Y(bt,n?.3:-.3,Math.max(0,Math.cos(t.cycleRad+(n?0:Math.PI))*.6)-.55,t.cycle(n?0:.5)*o),Vr(s.position,bt,i),Y(s.rotation,n?-r:r,i,0)}else Y(s.rotation,0,n?.1:-.1,0),Y(s.position,n?.45:-.45,-.65,0);t.currentAnim&&!t.walking&&(t.currentAnim.info.movement==5||t.currentAnim.info.movement==13||t.currentAnim.info.movement==6||t.currentAnim.info.movement==9)&&Y(s.position,n?.4:-.55,-.65,n?.2:-.3)}}}},$R=(t,e)=>{let n=t.body[0],s=n.position,i=n.rotation;if(n.visible){if(!t.falling||e?(t.walking?t.entity.inWater>t.entity.radius?Y(s,0,-.1,0):Y(s,0,Math.cos(t.cycleRad*2)*.1+.4,0):t.entity.inWater>t.entity.radius?Y(s,0,.3,0):Y(s,0,e?.5:t.cycle(0)*.1+.4,0),t.transform.rotation[0]!==0&&(t.transform.rotation[0]=0)):(t.transform.rotation[0]=t.cycleRad*t.flip,Y(s,0,t.flip!=0?.3:.5,0)),t.entity.inWater>t.entity.radius)t.walking?Y(i,1.2,0,Math.sin(t.cycleRad)*.1):Y(i,Math.sin(t.cycleRad)*.1-.1,0,Math.cos(t.cycleRad)*.05);else{Y(i,-t.pushBack[1]*5+t.movementPushback[2],0,t.pushBack[0]*5-t.movementPushback[0]),Lm(s,s,t.pushBackOffset),sn(s,s,t.movementPushback,1);let o=-t.movementPushback[1]*.5;Y(n.scale,1+o,1-o,1+o)}if(t.currentAnim!==void 0){let o=t.currentAnim.info.movement;if((o==5||o==6)&&(i[1]-=.3+.05*t.cycle(.2),i[0]+=.3+.02*t.cycle(.4),s[1]-=.1+.05*t.cycle(.6),s[0]-=.05),o==6)i[1]*=1-t.currentAnim.fract;else if(o==10)Y(s,0,.2+Math.sin(t.currentAnim.fract*Math.PI)*.5,0),i[0]+=t.currentAnim.fract*sl,i[1]+=il(t.entity.steer);else if(o==9){let r=Qt.easeOutQuad(vt(t.currentAnim.fract*2,0,1));s[1]+=Math.sin(3+r*5)*.2,i[0]+=.5-r*.5}else o==12?i[1]=t.currentAnim.fract*Math.PI*2:o==13&&(s[2]-=.2+t.cycle(.4)*.05,i[0]=-.2+t.cycle(.8)*.12,i[1]=-.2,i[2]=.2+t.cycle(.15)*.05)}}},NR=(t,e)=>{for(let n=0;n<=1;++n){let s=t.body[2+n];if(s.visible){if(!t.falling||e)if(t.entity.inWater>t.entity.radius)if(t.walking){let i=t.cycle(0),o=t.entity.steer[1]<0?.3:.5,r=Math.sin(t.cycleRad*2+5);Y(s.rotation,0,i*o*1.3+(n?Math.PI:0),0),Y(s.position,(n?.7:-.7)+r*(n?-.2:.2),.2+i*o*(n?-1.5:1.5),-.2+i*(n?-.3:.3))}else{let i=Math.cos(t.cycleRad+n*2);Y(s.rotation,0,(n?-.43+Math.PI:.43)+i*.15*(n?1:-1),.3),Y(s.position,n?.7:-.7,i*.05-.2,.6-i*.2)}else if(t.walking){let i=t.cycle(0),o=t.entity.steer[1]<0?.3:.5,r=Math.sin(t.cycleRad*2+5);Y(s.rotation,0,i*o*1.3+(n?Math.PI:0),0),Y(s.position,(n?.7:-.7)+r*(n?-.2:.2),-.2+i*(n?.3:-.3),.2+i*o*(n?-1.5:1.5)),s.position[0]=n?Math.max(.5,s.position[0]):Math.min(-.5,s.position[0])}else if(e)Y(s.rotation,0,n?-1.3+Math.PI:1.3,.3),Y(s.position,n?.3:-.3,-.5,.7);else{let i=t.cycle(0);Y(s.rotation,0,(n?-.43+Math.PI:.43)+i*.15*(n?1:-1),.3),Y(s.position,n?.7:-.7,-.3+i*.08,.15-i*.1)}else Y(s.position,n?.6:-.6,-vt(t.entity.vel[1],-5,5)/20,0),s.position[0]+=(n?1:-1)*Math.sin(s.position[1]*3.1+.8)*.3,Y(s.rotation,0,n?Math.PI:0,-.3-s.position[1]);if(t.currentAnim){let i=t.currentAnim.info.movement;if(i==5||i==6)n==0?(s.position[0]-=.2,s.position[1]-=.2,i==6&&(dn(s.position,s.position,1-t.currentAnim.fract),s.position[0]+=-t.currentAnim.fract*.3,s.position[2]+=Math.sin(Math.min(.5,t.currentAnim.fract)*7+4)*.8+.4)):(s.position[0]-=.4,s.position[2]+=.5-t.cycle(.3)*.2,s.rotation[1]+=.6+t.cycle(.4)*.2,s.rotation[0]-=.8,i==6&&(dn(s.position,s.position,1-t.currentAnim.fract),s.position[0]+=t.currentAnim.fract*.3,s.position[2]+=Math.sin(Math.min(.5,t.currentAnim.fract)*7+4)*.7+.3));else if(i===9){let o=Qt.easeInOutCubic(vt(t.currentAnim.fract*2,0,1));Y(s.rotation,1-o,0,0);let r=Math.sin(o*3);n==0?Y(s.position,-.12-r*.35,-.1+o*1.2,.3+r):Y(s.position,.12+r*.35,o*1.2,.3+r)}else if(i===11){let o=Math.sin(Qt.easeInOutCubic(t.currentAnim.fract)*3);s.position[0]+=o*(n?.3:0),s.position[1]=o*(n?-.2:1)-.3,s.position[2]=o*(n?-.3:1)}else i===13&&(s.position[0]=n?.6:0,s.position[1]=n?.7:1,s.position[2]=.8,s.rotation[0]=n?t.cycle(.4)*.2:t.cycle(.2)*.2,s.rotation[1]=n?2:1,s.rotation[2]=n?2:1)}if(t.body[8+n]){let i=t.body[8+n];i.visible&&(qr(i,s.position,!1,pm),dn(i.rotation,i.rotation,.5),i.rotation[1]-=n?.8:-.8,i.rotation[2]-=n?.5:-.5)}}}},Ns=(t,e)=>{t.sheathed!==e&&(t.sheathed=e,t.body[6]!==void 0&&(Mn(t.body[6],e?t.body[0]:t.body[2]),t.sheathed?it(t.body[6].position,t.skin.sheathedPos):it(t.body[6].position,t.skin.unsheathedPos),t.body[6].matrixNeedsUpdate=!0),t.body[7]!==void 0&&(Mn(t.body[7],e?t.body[0]:t.body[3]),t.sheathed?(Y(t.body[7].position,0,-.2,-.65),Y(t.body[7].rotation,0,-1.57,0)):(Y(t.body[7].position,-.2,0,0),Y(t.body[7].rotation,0,0,0)),t.body[7].matrixNeedsUpdate=!0))};var F2=[5,4,0,2,3],C2=(t,e,n,s)=>{let i=t.body[3];if(i.visible&&(Y(i.rotation,.2,1.7+t.cycleSin*.15,.4),Y(i.position,.1+t.cycleSin*.2,-.3,.9),t.entity.target>0&&(i.position[0]=.2,i.position[1]+=.15,i.position[2]+=.1,i.rotation[0]+=.2,i.rotation[1]=1.8,i.rotation[2]-=.2),t.currentAnim))switch(t.currentAnim.info.movement){case 5:{Ns(t,!1);let o=Qt.easeOutQuad(vt(t.currentAnim.fract*2,0,1));Y(i.rotation,1.2,2,.3),Y(i.position,.2,0,.8+o*.8),Y(t.body[2].position,-.1-Math.sin(o*2)*.6,o*.1,.8-o*.8),Y(t.body[0].position,0,.6-o*.2,0),Y(t.body[0].rotation,.2-o*.2,-.4+o*.3,0);break}case 7:{Ns(t,!1);let o=Qt.easeOutFlick(vt((t.currentAnim.fract-.5)*2,0,1));Y(i.rotation,1.2,2,.3+o*.1),Y(i.position,.2,o*.3,1.6),Y(t.body[2].position,-.7,.1,-o*.7),Y(t.body[0].position,0,.4,0),Y(t.body[0].rotation,0,-.1,0);break}case 8:{Ns(t,!1);let o=Qt.easeOutQuad(vt(t.currentAnim.fract*2,0,1));Y(t.body[2].position,-.5-o*.3,-.3+o*.3,Math.sin(o*6.28)*.6),Y(i.rotation,.2+.5*o,2,.3),Y(i.position,.2,-.4+o*.3,.8+o*.8),t.body[0].rotation[1]=0,t.body[0].rotation[0]=-.2+o*.2}break}!t.walking&&t.body[4].visible&&(t.body[4].position[2]-=.3,t.body[5].position[2]+=.1)};var WA=[2],GA=(t,e,n,s)=>{let i=t.body[2];Jn(i.rotation,.9,-.4,0),i.position[2]-=.1};var HA=[0,16,17],YA=(t,e,n,s)=>{let i=t.cycle(.5);if(Y(t.body[0].scale,i*.1+1,1+t.cycleSin*.1,i*.1+1),Y(t.body[0].position,0,-.2+t.cycleSin*.1,0),Y(t.body[0].rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5),Lm(t.body[0].position,t.body[0].position,t.pushBackOffset),t.currentAnim){let o=Qt.easeOutExpo(t.currentAnim.fract**3);switch(t.currentAnim.info.movement){case 0:t.body[0].position[2]+=Math.sin(o*6.28-3.14);break}}for(let o=0;o<2;++o){let r=t.body[16+o];if(r.visible=t.transform.visible,!r.visible)continue;for(let c=0;c<r.children.length;++c)r.children[c].visible=!0;let l=o==0?t.transform:t.body[16+o-1];Xt(bt,l.position,r.position),Y(Qr,0,0,-l.scale[0]*.7),Vr(yn,Qr,l.rotation[1]),Rn(bt,bt,yn);let a=ps(bt);a>30*t.entity.size?it(r.position,t.entity.pos):sn(r.position,r.position,bt,Math.max(0,Math.min(.5,20*e*(a-r.scale[1]*.7)))),Y(r.rotation,0,Im(Xt(bt,l.position,r.position)),0),ms(r.scale,(3-o)*.3*(.8+t.cycle(o*.3)*.1)*t.transform.scale[0]),r.position[1]=Math.max(t.entity.pos[1]+r.scale[1]*.5,r.position[1]-e*2.5),qt(r,!1)}};var XA=[2,3],QA=(t,e,n,s)=>{if(!t.currentAnim)for(let i=0;i<2;++i){let o=t.body[2+i];if(!o.visible)continue;let r=t.cycle(1.3);Y(o.rotation,.78,0,i?r*.2:-r*.2),Y(o.position,i?.2:-.2,-.4,.6)}};var ZA=[0,4,5],JA=(t,e,n,s)=>{let i=t.body[0],o=t.body[4],r=t.body[5];if(t.walking&&!t.falling){t.speed=t.entity.speed*(t.entity.steer[1]===-1?-1.2:1)*.04/(.6+t.entity.size*.6);let l=Math.cos(t.cycleRad);Y(o.rotation,0,t.cycleSin*.2,t.cycleSin*.2),Y(o.position,0,Math.abs(l)*.3+.2,0),Y(r.rotation,0,Math.PI+l*.2,l*.2),Y(r.position,0,Math.abs(t.cycleSin)*.3,0),Y(i.position,t.cycle(.3)*.01,t.cycleSin*.02,0),Y(i.rotation,0,t.cycleSin*.01,Math.sin(t.cycleRad*2)*.01),t.entity.target>0&&Math.random()<.3&&t.fraction(.1,e)&&t.playSound(t.stepset[0],!1)}else{if(t.speed=.5,t.currentAnim){let l=Qt.easeOutExpo(t.currentAnim.fract**3);switch(t.currentAnim.info.movement){case 0:{let a=Math.sin(l*6.28-3.14);Y(i.position,0,Math.max(0,-a),a*.5);for(let c=0;c<2;++c){let f=c==0?o:r,u=c==0?1:-1,p=c==1?Math.PI:0;Y(f.rotation,u*Math.min(a,0),p+a*.1*u,0),Y(f.position,0,Math.max(0,-a),a*.5)}break}}}else{let l=t.cycle(-.1)*.05;Y(i.position,0,t.cycle(-.1)*.1,0);for(let a=0;a<2;++a){let c=a==0?o:r;Y(c.rotation,0,a==1?Math.PI:0,t.falling?.4:l*.5),Y(c.position,0,0,0)}}Y(i.rotation,0,0,0)}Jn(i.rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5)};var KA=[],eP=(t,e,n,s)=>{Y(t.transform.rotation,-t.pushBack[1]*2,t.entity.rot,t.pushBack[0]*2)};var tP=[0,2,3,16],nP=(t,e,n,s)=>{let i=t.body[0],o=t.body[2],r=t.body[3],l=25/o.scale[0],a=n+t.entity.id;if(Y(i.rotation,Math.sin(a*l/8)*.15,0,Math.sin(a*l/10)*.07),Jn(i.rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5),Y(i.position,0,1+Math.sin(a*18)*.1,0),t.body[16]!==void 0){let f=t.body[16];f.position[1]=f.data.skin.pos[1]+Math.sin(a*18+2.75)*.1}let c=Math.sin(a*l)*.7;for(let f=0;f<2;++f){let u=f==0,p=u?o:r;p.rotation[2]=p.data.skin.rot[2]+(u?Math.PI-c:c)}if(t.currentAnim&&t.currentAnim.info.movement===0){let f=t.currentAnim.fract,u=Math.sin(Yo(f,.2,-.4)*3.14)*1.5;if(i.position[2]+=u,i.rotation[0]+=u*.4,f>.65){let p=Qt.easeOutQuad(di(f,.65,1,0,1));i.rotation[0]-=p*Math.PI*2,i.position[1]+=Math.sin(p*Math.PI)*1.5}}};var sP=[0,2,3],iP=(t,e,n,s)=>{for(let i=0;i<2;++i){let o=t.body[2+i];o.position[1]*=.8,o.position[2]*=.8,o.position[1]+=.5;let r=t.body[4+i];r.position[1]-=0,r.position[0]+=i?.4:-.4}Y(t.body[0].scale,1.8,2,1.8),t.body[0].position[1]+=1};var oP=[2],rP=(t,e,n,s)=>{Y(t.body[2].position,-.8,-.2,.7),Y(t.body[2].rotation,1.8+t.cycleSin*.1,0,0)};var lP=[17,0,16,21,2,3,4,5],aP=(t,e,n,s)=>{let i=t.body[4].scale[1];t.currentAnim&&t.currentAnim.info.movement===0?sz(t,i):ez(t,i)},ez=(t,e)=>{let n=di(t.entity.speed/20/(.2+t.entity.size*.8),3,10,0,1),s=di(n,0,1,.6,.4),i=di(n,0,1,.5,.2);t.speedMultiplier=di(n,0,1,1,.5),tz(t,i,s,e),nz(t,i,s,e)},tz=(t,e,n,s)=>{let i=0,o=0,r=0,l=0,a=0,c=0,f=0,u=di(e,.2,.5,.5,1);t.walking?(i=Math.sin(t.cycleRad*2-1)*.07,r=Math.sin(t.cycleRad*2)*.07,o=-t.cycle(0)*.1*u,a=Math.sin(t.cycleRad*2+n)*.05,l=-t.cycle(n)*.07*u,c=t.cycle(n+.2)*.3,f=0):(i=t.cycle(.3)*.03,r=t.cycle(.35)*.02,a=t.cycle(0)*.02-.05,c=Math.sin(t.cycleRad*2)*.07,f=t.cycle(.3)*.1);let p=t.body[17];Y(p.position,0,s*.8+i-.15,1.2),Y(p.rotation,.1,f,0);let g=t.body[0];Y(g.position,0,s*.7+r-.15,.5),Y(g.rotation,-.06,o*1.3,o);let v=t.body[16];Y(v.position,0,s*.75+a-.15,-.35),Y(v.rotation,.04,l*1.3,l);let _=t.body[21];Y(_.position,-c*.35,-.18+i*.5,-.67),Y(_.rotation,.6,c,0)},nz=(t,e,n,s)=>{let i=[2,3,4,5];for(let o=0;o<4;++o){let r=i[o],l=t.body[r],a=o%2==0,c=o<2,f=-.75+s*.5,u=c?.8:-.6,p=c?.35:.26,g=t.entity.steer[1]<0?-.5:1;if(t.walking){let v=(a?0:e)+(c?0:n),_=t.cycleScaled(v,g),b=Math.max(0,t.cycleScaled(v-Math.PI,g)*.3);u-=_*.4,Y(l.rotation,_,0,0),Y(l.position,a?-p:p,f+b,u)}else Y(l.rotation,0,a?-.2:.2,0),Y(l.position,a?-p:p,f,u)}},sz=(t,e)=>{let n=t.currentAnim.fract,s=Math.sin(Yo(n,.2,-.4)*3.14)*1.5,i=[2,3,4,5];for(let f=0;f<4;++f){let u=i[f],p=t.body[u],g=f%2==0,v=f<2,_=-.75+e*.5,b=(v?.8:-.6)+s*.2,y=v?.35:.26;Y(p.rotation,s*.5,0,0),Y(p.position,g?-y:y,_,b)}let o=t.body[17];Y(o.position,0,.8*e-.15,1.2+s*.4),Y(o.rotation,s*.4,0,Math.sin(s*3)*.5);let r=t.body[0];Y(r.position,0,.7*e-.15,.5+s*.4),Y(r.rotation,-.06,0,0);let l=t.body[16];Y(l.position,0,.75*e-.15,-.35+s*.4),Y(l.rotation,.04,0,0);let a=t.body[21],c=Math.max(s,0);Y(a.position,0,-.18*.5+c*.3,-.67),Y(a.rotation,.6+c,0,0)};var cP=[2,3,4,5],fP=[[-.6,-.5,.5],[.6,-.5,.5],[-.6,-.5,-.5],[.6,-.5,-.5]],uP=[2,3,4,5,0,16,21,17,19,20],pP=(t,e,n,s)=>{let i=t.body[4].scale[1];t.currentAnim&&t.currentAnim.info.movement===0?oz(t,i):rz(t,i)},oz=(t,e)=>{fz(t,e),uz(t,e),pz(t,e)},rz=(t,e)=>{t.speedMultiplier=.8,lz(t,e),az(t,e),cz(t,e)},lz=(t,e)=>{let n=t.body[0],s=t.body[16],i=t.body[21],o=e-.9+n.scale[1]*.5;if(t.walking){let r=t.cycle(0)*.2;n.position[1]=o+Math.sin(t.cycleRad*2)*.05,s.position[1]=o+Math.sin(t.cycleRad*2+.5)*.05,Y(n.rotation,0,r,0),Y(s.rotation,0,-r,0),i&&(i.position[1]=i.data.skin.pos[1]+o+Math.sin(t.cycleRad*2)*.05)}else n.position[1]=o,s.position[1]=o,Y(n.rotation,0,0,0),Y(s.rotation,0,0,0),i&&(i.position[1]=i.data.skin.pos[1]+o+Math.sin(t.cycleRad)*.05);n.matrixNeedsUpdate=!0,s.matrixNeedsUpdate=!0,lo(n),lo(s)},az=(t,e)=>{let n=t.walking?.2:.08,s=t.body[17];s!==void 0&&Y(s.rotation,0,t.cycle(.4)*n,0);let i=t.body[19];i!==void 0&&Y(i.rotation,0,t.cycle(.2)*n,0);let o=t.body[20];o!==void 0&&Y(o.rotation,0,t.cycle(t.walking?.1:.9)*n,0)},cz=(t,e)=>{let n=t.walking,s=n?t.cycle(0)*.5:0,i=n?t.cycle(.25)*.5:0,o=n?t.cycle(.75)*.5:0,r=t.entity.steer[1]<0?-.5:1;for(let l=0;l<4;++l){let a=cP[l],c=t.body[a],f=l%2==0,u=l<2,p=t.body[u?0:16],g=fP[l];Ms(c.position,g,p.matrix);let v=0,_=0;f&&u||!u&&!f?(v=i,_=s):(v=o,_=-s),c.position[1]+=Math.max(0,v*.5),c.position[2]+=_*r*.4,c.rotation[0]=-_*r}},fz=(t,e)=>{let n=t.currentAnim.fract,s=Math.sin(Yo(n,.2,-.4)*3.14)*1.5,i=t.body[0],o=t.body[16],r=t.body[21],l=e-1+i.scale[1]*.5;Y(i.position,0,l,i.data.skin.pos[2]+s*.4),Y(i.rotation,0,s*.2,0),Y(o.position,0,l,o.data.skin.pos[2]+s*.4),Y(o.rotation,0,-s*.2,0),r!==void 0&&(Y(r.position,0,r.data.skin.pos[1]+l,r.data.skin.pos[2]+s*.4),Y(r.rotation,0,0,0)),i.matrixNeedsUpdate=!0,o.matrixNeedsUpdate=!0,lo(i),lo(o)},uz=(t,e)=>{let n=t.currentAnim.fract,s=Math.sin(Yo(n,.2,-.4)*3.14)*1.5,i=t.body[17];i!==void 0&&Y(i.rotation,s*.4,0,Math.sin(s*3)*.5);let o=t.body[19];o!==void 0&&Y(o.rotation,0,s*.5,0);let r=t.body[20];r!==void 0&&Y(r.rotation,0,s*.5,0)},pz=(t,e)=>{let n=t.currentAnim.fract,s=Math.sin(Yo(n,.2,-.4)*3.14)*1.5;for(let i=0;i<4;++i){let o=cP[i],r=t.body[o],l=i<2,a=t.body[l?0:16],c=fP[i];Ms(r.position,c,a.matrix),Y(r.rotation,s*.5,0,0)}};var mP=[18,3],dP=(t,e,n,s)=>{Y(t.body[18].rotation,0,0,n*.3),Y(t.body[3].position,.8,-.2,.7),Y(t.body[3].rotation,1.8,0,0)};var d0=[5,4,0,2,3],h0=(t,e,n,s)=>{Jn(t.body[0].rotation,(Math.sin(n*1.8)*Math.cos(n*12)*.3+Math.sin(n*1.4)*.3)*.1-.2,(Math.sin(n*1.3)+Math.sin(n*2.4)*.6)*.15,(Math.sin(n*.2)+Math.sin(n*1.9)*.5)*.2);for(let i=0;i<=1;++i){let o=t.body[2+i];o.visible&&Jn(o.rotation,(Math.sin(n*2)*Math.cos(n*9)+Math.sin(n*1.3))*.2,(Math.sin(n*2-2)*Math.cos(n*7)+Math.sin(n*.8))*.3,0);let r=t.body[4+i];r.visible&&(r.rotation[1]+=Math.sin(n*.2-i)*.3,r.position[0]+=i?.15:-.15)}};var hP=[2],gP=(t,e,n,s)=>{t.body[2].position[2]+=.6,Jn(t.body[2].rotation,-2.1,-4.1,-.2)};var vP=[2,3,0],_P=(t,e,n,s)=>{if(t.currentAnim===void 0||t.currentAnim.info.movement===0)for(let i=0;i<2;++i){let o=t.body[2+i],r=Math.sin(n*4+i);Y(o.position,i?.5:-.5,r*.2,1),Y(o.rotation,0,1.5,-r*.2)}Jn(t.body[0].rotation,(Math.sin(n*1.8)*Math.cos(n*2)*.3+Math.sin(n*1.4)*.3)*.1+.2,(Math.sin(n*1.3)+Math.sin(n*2.4)*.6)*.1,(Math.sin(n*.4)+Math.sin(n*1.9)*.5)*.1)};var bP=[[Ws,C2],[Ws,GA],[YA],[Ws,QA],[JA],[eP],[Ws,iP],[Ws],[],[Ws,rP],[Ws,dP],[Ws,h0],[Ws,C2,h0],[Ws,h0],[Ws,gP],[Ws,_P],[aP],[pP],[nP]],yP=[new Set([...js,...F2]),new Set([...js,...WA]),new Set([...HA]),new Set([...js,...XA]),new Set([...ZA]),new Set([...KA]),new Set([...js,...sP]),new Set([...js]),new Set,new Set([...js,...oP]),new Set([...js,...mP]),new Set([...js,...d0]),new Set([...js,...F2,...d0]),new Set([...js,...d0]),new Set([...js,...hP]),new Set([...js,...vP]),new Set([...lP]),new Set([...uP]),new Set([...tP])];var vc=class{constructor(e){this.transform=on(),this.transform.matrixAutoUpdate=!0,this.soundPrio=e.radius>3?1:0,this.doesYell=e.type!==0,this.entity=e,this.cycleOne=0,this.cycleRad=Zt(0,1),this.cycleSin=0,this.speed=1,this.speedMultiplier=1,this.lastFlags=0,this.deathTimer=new kt(0,0),this.hurtSoundTimer=new kt(0,5),this.pushBack=[0,0],this.pushBackVel=[0,0],this.pushBackOffset=[0,0],this.movementPushback=[0,0,0],this.movementPushbackVel=[0,0,0],this.groundNormal=[0,0,0],this.cDist=1/0,this.cDistLast=1/0,this.inFog=!0,this.animQueue=[],this.currentAnim=void 0,this.eyesBlink=0,this.capeoffset=0,this.walking=!0,this.falling=!1,this.hasDied=!1,this.flip=0,this.hasJustJumped=!1,this.hasJustLanded=!0,this.sheathed=!1,this.interiorlight=[0,0,0,0],this.needsColorUpdate=!1,this.colors=new Set,this.alphas=new Set,this.currentAlpha=0,this.goalAlpha=1,this.body=[],this.meshes=[],this.effects=[],this.skin=void 0,this.soundset=void 0,this.stepset=void 0,this.skeleton=void 0,this.animset=void 0,this.colPrim=void 0,this.colSec=void 0}setSkin(e,n,s){this.skin!==void 0&&(this.removeSkin(),this.cDistLast=0,this.hasDied=!1,this.deathTimer.reset(0,0),this.removeColor(Ln.death)),this.skin=r1.get(e);let i=s1.get(this.skin.soundset);this.soundset=i.sounds,this.stepset=i1.get(i.steps).steps,this.skeleton=l1.get(this.skin.skeleton),this.animset=bP[this.skin.animset],this.colPrim=n||this.skin.colPrim,this.colSec=s||this.skin.colSec;let o=yP[this.skin.animset];for(let r=0;r<this.skin.body.length;++r){let l=this.skin.body[r],a=l.col;l.colMode===1?a=this.colPrim:l.colMode===2&&(a=this.colSec);let c=this.mesh(l.bid,l.pid,o.has(l.bid),l.mid,l.lod,a,l.ts===1);c&&(it(c.position,l.pos),it(c.scale,l.scl),it(c.rotation,l.rot),c.data.skin=l)}for(let r=0;r<this.skin.effects.length;++r){let l=this.skin.effects[r];this.effects.push(Bs(l.id,this.body[l.bid],0,!1))}}removeSkin(){this.clearAnims(),this.clearMeshes(),this.clearEffects()}cycle(e){return e==0?this.cycleSin:Math.sin(this.cycleRad+2*e*Math.PI)}cycleScaled(e,n){return Math.sin(this.cycleRad*Math.sign(n)+2*e*Math.PI)*n}checkCycleReset(){let e=this.falling<<1|(!this.falling&&this.walking)<<2;e!=this.lastFlags&&(this.cycleOne=0,this.lastFlags=e)}addPushBack(e,n,s){this.cDist<50&&(this.pushBackVel[0]-=e*s/this.entity.size,this.pushBackVel[1]-=n*s/this.entity.size)}addRandomPushback(e){this.cDist<50&&(this.pushBackVel[0]-=Zt(-1,1)*e/this.entity.size,this.pushBackVel[1]-=Zt(-1,1)*e/this.entity.size)}tickPushBack(e,n,s){this.cDist<50&&(Jh(this.pushBackVel,this.pushBackVel,this.pushBack,-e*1500/this.entity.size),wf(this.pushBackVel,this.pushBackVel,1-e*30),Jh(this.pushBack,this.pushBack,this.pushBackVel,e),P3(this.pushBackOffset,this.pushBack,-this.entity.rot)),this.cDist<25&&(sn(this.movementPushback,this.movementPushback,this.movementPushbackVel,e*60),sn(this.movementPushbackVel,this.movementPushbackVel,this.movementPushbackVel,-(e*20)),sn(this.movementPushbackVel,this.movementPushbackVel,this.movementPushback,-(e*10)),this.movementPushbackVel[2]+=this.entity.steer[1]*.01,this.movementPushbackVel[0]-=this.entity.steer[0]*.01)}disableVis(e){for(let n=0,s=e.children.length;n<s;++n){let i=e.children[n];i.visible=!1,this.disableVis(i)}}checkVis(e,n,s){for(let i=0,o=e.children.length;i<o;++i){let r=e.children[i];this.meshes.indexOf(r)<0||(r.visible=r.data.lod*n/this.cDist>s,r.visible?this.checkVis(r,n,s):this.disableVis(r))}}updateVisibility(){let e=this.entity.mount!==void 0?1/0:Math.max(60,Math.min(150,gt.far*.7));return this.cDist=Dr(this.transform.position,gt.worldPosition),this.inFog=this.cDist>e,!this.inFog&&(!le.disableoffscreen||Sh(gt,this.entity.visualPosition,this.transform.scale[1]))?(!this.hasDied&&Math.abs(this.cDistLast-this.cDist)>1&&(this.cDistLast=this.cDist,this.checkVis(this.transform,Math.max(1,this.transform.scale[1]),1.5/(45+e))),this.transform.visible=!0,!0):(this.cDistLast=0,this.transform.visible&&(this.transform.visible=!1,this.meshes.forEach(n=>n.visible=!1),this.clearAnims()),!1)}tick(e,n,s){this.updateVisibility()?(this.needsColorUpdate&&this.colorUpdate(),this.alphaUpdate(e),this.entity.stats===void 0||this.entity.stats.alive?this.entity.buffs.visualFreeze===0&&(this.cycleOne=(this.cycleOne+this.speed*e)%1,this.cycleRad=this.cycleOne*Math.PI*2,this.cycleSin=Math.sin(this.cycleRad),this.tickAnimations(e),this.falling=this.entity.inWater<this.entity.radius&&(this.falling&&!this.entity.onGround||!this.falling&&!this.entity.onGround&&Math.abs(this.entity.vel[1])>6),this.walking=this.entity.steer[0]!=0||this.entity.steer[1]!=0,this.tickVisuals(e,n,s)):this.tickDeath(e,n,s),qt(this.transform,!1)):this.alphaUpdate(100)}tickVisuals(e,n,s){this.checkCycleReset(),this.calculateCycleSpeed(),this.body[1]!==void 0&&this.tickEyes(e,this.body[1]),this.body[10]!==void 0&&this.tickCape(e,this.body[10]),this.tickWalking(e),this.tickLanding();for(let i=0;i<this.animset.length;++i)this.animset[i](this,e,n,s);if(this.skeleton.groundNormal||this.entity.mount&&this.entity.mount.skeleton.groundNormal){let i=Math.min(1,e*10);this.groundNormal[0]+=(this.entity.groundNormal[0]-this.groundNormal[0])*i,this.groundNormal[2]+=(this.entity.groundNormal[2]-this.groundNormal[2])*i,Dm(this.transform.rotation,this.groundNormal)}else this.flip||(this.transform.rotation[0]=this.transform.rotation[2]=0)}tickFixed(e,n,s){this.hasDied||this.tickPushBack(e,n,s)}tickAnimations(e){let n=this.currentAnim=this.animQueue[0];if(n){let s=n.info,i=n.fract;if(this.animQueue.length>1&&s.priority===0?n.fract>.6?n.time+=e*5:n.time=n.info.duration:n.time+=e,n.fract=n.time/s.duration,n.time>s.duration)if(n.loop)n.fract%=1,n.time=0;else{n.fract=1,this.onAnimEnd(n),this.animQueue.shift();return}for(let o=0;o<s.sounds.length;++o){let r=s.sounds[o];r.end>0?n.fract>=r.start&&n.fract<=r.end?n.activeSounds[o]===void 0&&(n.activeSounds[o]=Xi(r.id,this.transform,this.soundPrio,!0,1)):n.activeSounds[o]!==void 0&&(n.activeSounds[o].stop(),n.activeSounds[o]=void 0):n.fract>=r.start&&(i<r.start||r.start===0&&i===0)&&(n.id===4&&r.id===50?Xi(this.soundset[4],this.transform,this.soundPrio,!1,1):Xi(r.id,this.transform,this.soundPrio,!1,1))}for(let o=0;o<s.effects.length;++o){let r=s.effects[o];if(r.type===0&&n.fract>r.start&&i<=r.start){let l,a=!1;if(r.body===99){let c=I.entity(n.dirImpactTarget);c&&c.visual&&(l=on(),Fp(l,c.visual.transform,this.transform,c.radius),qt(l,!1),c.visual.addPushBack(this.transform.position[0]-c.visual.transform.position[0],this.transform.position[2]-c.visual.transform.position[2],2)),a=!0}else r.body===101?(l=on(),it(l.position,this.transform.position),it(l.scale,this.transform.scale),it(l.rotation,this.transform.rotation),qt(l,!1),a=!0):l=r.body===100?this.transform:this.body[r.body];if(l===void 0)continue;wi(r.id,l,this.soundPrio,a)}else if(r.type>0)if(n.fract>=r.start&&n.fract<=r.end)if(n.activeEffects[o]===void 0){let l=r.body===100?this.transform:this.body[r.body];l&&(n.activeEffects[o]=r.type===1?Bs(r.id,l,this.soundPrio,!1):AS(r.id,l,this.soundPrio,!1))}else{let l=n.activeEffects[o];r.type===1||(l.fractionLast=l.fractionNow,l.fractionNow=Math.min(1,Math.max(0,1-(r.end-n.fract)/(r.end-r.start))))}else n.activeEffects[o]!==void 0&&(n.activeEffects[o].done=!0,n.activeEffects[o]=void 0)}}}tickEyes(e,n){if(n.visible){let s=0;this.eyesBlink>0?s=this.eyesBlink-e:Math.random()<.006?s=.1:s=this.eyesBlink,(this.eyesBlink>0&&s<0||s>0&&this.eyesBlink<0)&&(n.scale[1]=s>0?.1:n.scale[0],n.matrixNeedsUpdate=!0),this.eyesBlink=s}}tickCape(e,n){n.visible&&this.skin.capeswing&&((this.entity.steer[1]>0||this.falling)&&(this.capeoffset+=ps(this.entity.vel)*.5*e),this.capeoffset=Math.max(0,Math.min(2,this.capeoffset*(1-e*3))),Y(n.rotation,this.capeoffset,0,0))}tickLanding(){this.entity.inWater>this.entity.radius||(this.hasJustJumped&&this.entity.onGround&&(this.cDist<20&&this.entity.vel[1]<-4&&(this.soundPrio===1&&this.playSound(56,!0),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.15,this.eyesBlink=.3),this.hasJustLanded=!0,this.hasJustJumped=!1,this.flip=0),this.hasJustLanded&&!this.entity.onGround&&(this.entity.vel[1]>5&&(this.soundPrio===1&&this.playSound(57,!0),Math.random()<.5&&(this.flip=this.entity.steer[1]),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.1,this.eyesBlink=.3),this.hasJustJumped=!0,this.hasJustLanded=!1))}tickWalking(e){if((this.cDist<20||this.transform.scale[1]>2)&&!this.falling){let n=this.transform.scale[1]>2||this.body[0].scale[1]>2,s=this.fraction(.2,e),i=this.fraction(.7,e);if(this.entity.inWater>0){if(this.entity.inWater<this.entity.radius*2)this.walking?this.entity.inWater<this.entity.radius?(s||i)&&(this.playSound(n?55:this.entity.inWater>this.entity.radius/2?127:128,!1),this.watersplash(92)):(s||i)&&(s&&this.playSound(129,!1),this.watersplash(93)):(s||i)&&this.watersplash(93);else if(this.entity.inWater>3&&(s||i)&&Math.random()<.5){let o=this.transform.position;Zi(153,void 0,o[0],o[1],o[2],0,0,0,!1)}}else this.walking&&(n||this.soundPrio===1)&&(s||i)&&this.playSound(n?55:this.stepset[0],!n)}}calculateCycleSpeed(){this.falling?this.speed=1.5:this.walking?this.entity.inWater<this.entity.radius?this.speed=this.entity.speed/20*(this.entity.steer[1]===-1?1.3:1)*.45/(.4+this.entity.size*.6):this.speed=this.entity.speed/20*.2:this.speed=.5,this.speed*=this.speedMultiplier}fraction(e,n,s=this.cycleOne){return s>=e&&s-this.speed*n<e}mesh(e,n,s,i,o,r,l=!1){let a=Ji(i,l,!0,!1);if(a.data.lod=o,eS(a.data.multi,a,"interiorlight",this.interiorlight),a.visible=!1,a.matrixAutoUpdate=s,r!==void 0&&this.changeMeshBaseColor(a,r),a.data.basealpha=1,a.data.alpha[0]=this.currentAlpha,n>=0){if(!this.body[n])return;Mn(a,this.body[n]),a.parent.data.lod=Math.max(o,a.parent.data.lod||1)}else n===-1&&Mn(a,this.transform);return this.meshes.push(a),this.body[e]=a,a}removeMesh(e){let n=this.body[e];n!==void 0&&(xi(n.data.multi,n),this.meshes.splice(this.meshes.indexOf(n),1),this.body[e]=void 0)}clearMeshes(){for(let e=0;e<this.meshes.length;++e){let n=this.meshes[e];xi(n.data.multi,n)}this.meshes.length=0,this.body.length=0}clearEffects(){for(let e=0;e<this.effects.length;++e){let n=this.effects[e];n.done=!0}this.effects.length=0}onRemove(){this.removeSkin(),ui(this.transform)}anim(e,n,s){if(this.transform.visible&&this.animQueue.length<=2){let i=Pf.get(e),o={id:e,info:i,loop:n,dirImpactTarget:s,activeSounds:[],activeEffects:[],time:0,fract:0};this.animQueue.push(o)}}clearAnims(){for(let e=0;e<this.animQueue.length;++e)this.onAnimEnd(this.animQueue[e]);this.animQueue.length=0}onAnimEnd(e){for(let n=0;n<e.activeEffects.length;++n){let s=e.activeEffects[n];s&&(s.done=!0)}e.activeEffects.length=0;for(let n=0;n<e.activeSounds.length;++n){let s=e.activeSounds[n];s&&s.stop()}e.activeSounds.length=0}playSound(e,n){return e===0||this.inFog?!1:(Xi(e,this.transform,this.soundPrio,!1,n?this.getAudioPitch():1),!0)}onHurt(e){(e>.2||this.hurtSoundTimer.done(I.time))&&this.playSound(this.soundset[1],!0)&&this.hurtSoundTimer.reset(I.time)}onYell(){this.doesYell&&Zt(0,1)<.3&&this.playSound(this.soundset[0],!0)}onAggro(){this.playSound(this.soundset[3],!0)}onDeath(){this.hasDied=!0,this.playSound(this.soundset[2],!0),this.body[1]&&this.removeMesh(1),this.addColor(Ln.death),this.deathTimer.reset(I.time,3);let e=this.meshes.length;for(;e--;){let n=this.meshes[e];n.data.deathSize=(n.geometry.bounds.initiated?n.geometry.bounds.radius:1)*(n.scale[0]+n.scale[1]+n.scale[2])/3,Mn(n,null),aa(n.position,n.worldMatrix),u_(n.scale,n.worldMatrix),bp(n.quaternion,n.worldMatrix),n.data.deathVel=[Zt(-.5,.5),1,Zt(-.5,.5)],n.matrixAutoUpdate=!0}}tickDeath(e,n,s){this.deathTimer.done(n)?(this.clearMeshes(),this.clearEffects()):this.meshes.forEach(i=>{if(!i.visible||i.data.deathVel===void 0)return;let o=i.data.deathVel,r=i.data.deathSize;sn(i.position,i.position,o,e),dn(o,o,1-e*3);let l=s.getHeight(i.position[0],i.position[2])+r*.5;o[1]<0&&i.position[1]<l?o[1]<-1?(o[1]=Math.abs(o[1])*.7,o[0]+=Zt(-1,1)/r,o[2]+=Zt(-1,1)/r):o[1]=-.5:o[1]-=e*50,Xs(bt,o,[0,1,0]),sn(i.rotation,i.rotation,bt,-e*5),qt(i,!1)})}mountPosition(e){Ms(e,this.skin.mountPos,this.body[this.skin.mountPart].worldMatrix)}getAudioPitch(){return Math.max(.6,Math.min(1,.5/this.entity.radius))}getTopAbsolute(){return this.entity.radius*this.skeleton.height}addColor(e){this.colors.add(e),this.needsColorUpdate=!0}removeColor(e){this.colors.delete(e),this.needsColorUpdate=!0}colorUpdate(){this.needsColorUpdate=!1;for(let e=0;e<this.meshes.length;++e)this.updateMeshColor(this.meshes[e])}changeMeshBaseColor(e,n){e.data.basecolor=n,this.updateMeshColor(e)}updateMeshColor(e){let n=e.data.color;Lr(n,e.data.basecolor),this.colors.forEach(s=>{let i=s[3],o=1-i;n[0]=n[0]*o+s[0]*i,n[1]=n[1]*o+s[1]*i,n[2]=n[2]*o+s[2]*i})}addAlpha(e){this.alphas.add(e),this.updateGoalAlpha()}removeAlpha(e){this.alphas.delete(e),this.updateGoalAlpha()}updateGoalAlpha(){this.goalAlpha=1,this.alphas.forEach(e=>{this.goalAlpha=Math.min(this.goalAlpha,e)})}alphaUpdate(e){if(this.currentAlpha!==this.goalAlpha){Math.abs(this.goalAlpha-this.currentAlpha)<.1?this.currentAlpha=this.goalAlpha:(e=Math.min(e,2),this.currentAlpha<this.goalAlpha?this.currentAlpha=Math.min(this.goalAlpha,this.currentAlpha+e*.5):this.currentAlpha=Math.max(this.goalAlpha,this.currentAlpha-e*.5));for(let n=0;n<this.meshes.length;++n){let s=this.meshes[n];s.data.alpha[0]=s.data.basealpha*this.currentAlpha}}}changeMeshBaseAlpha(e,n){e.data.basealpha=n}setShoulders(e,n=1,s=!1){if(!(this.hasDied||!this.skeleton.shoulders)){if(e===!1){for(let i=8;i<=9;++i)this.removeMesh(i);for(let i=14;i<=15;++i)this.body[i]&&this.removeMesh(i)}else for(let i=0;i<=1;++i)if(!this.body[8+i]){let o=this.mesh(8+i,0,!0,1,.6);Y(o.position,i?.5:-.5,-.4+n*.4,-.05),Y(o.scale,.8*n,.5*n,.5*n),this.changeMeshBaseColor(o,e)}if(s!==!1)for(let i=0;i<=1;++i){this.body[14+i]||this.mesh(14+i,8+i,!1,7,.3);let o=this.body[14+i];Y(o.rotation,0,3.14,0),Y(o.position,i?.2:-.2,0,-.5),Y(o.scale,.35,.55,.2),this.changeMeshBaseColor(o,s)}else for(let i=14;i<=15;++i)this.body[i]&&this.removeMesh(i)}}setCape(e,n){if(!(this.hasDied||!this.skeleton.cape))if(e===!1)this.body[10]!==void 0&&this.removeMesh(10);else{if(this.body[10]===void 0){let s=this.mesh(10,0,!0,8,.7);Y(s.position,0,.2,-.55)}Y(this.body[10].scale,n,n,n),this.changeMeshBaseColor(this.body[10],e)}}setHeadgear(e){this.hasDied||!this.skeleton.helmet||(e===!1?this.body[11]!==void 0&&this.removeMesh(11):(this.body[11]===void 0&&this.mesh(11,0,!1,9,.5),this.changeMeshBaseColor(this.body[11],e)))}setGem(e,n=1){if(!(this.hasDied||!this.skeleton.helmet))if(e===!1)this.body[12]!==void 0&&this.removeMesh(12);else{if(this.body[12]===void 0){let s=this.mesh(12,0,!1,7,.5);Y(s.position,0,.4,.54),Y(s.scale,.3*n,.3*n,.08*n)}this.changeMeshBaseColor(this.body[12],e)}}setCrown(e){this.hasDied||!this.skeleton.helmet||(e===!1?this.body[13]!==void 0&&this.removeMesh(13):(this.body[13]===void 0&&(this.mesh(13,0,!1,10,.8),this.body[13].position[1]=.8),this.changeMeshBaseColor(this.body[13],e)))}watersplash(e){let n=on();it(n.position,this.entity.pos),n.position[1]=this.entity.pos[1]+this.entity.inWater+.05,qt(n),wi(e,n,this.soundPrio,!0)}};var g0=class extends m0{constructor(e){super(e),this.stickEffects=new Map,this.effects=new Set,this.visualFreeze=0,this.visualIncapacitate=0}addEffectBuff(e,n,s){if(n.logic.fx.stick&&(!(n.logic.incapacitated||n.logic.tags.has(4))||this.immuneCC.size<=0)&&!this.stickEffects.has(e)){let i=Bs(n.logic.fx.stick,this.entity.visual.transform,this.entity.id===I.playerId||n.caster===I.playerId?1:0,!1);this.stickEffects.set(e,i)}if(!this.effects.has(e))n.logic.fx.visual&&this.entity.visual.skin.id!==n.logic.fx.visual&&this.changeEntityVisual(n.logic.fx.visual),n.logic.fx.mount&&this.changeEntityMount(n.logic.fx.mount(n)),n.logic.fx.color&&this.entity.visual.addColor(n.logic.fx.color),n.logic.fx.alpha&&this.entity.visual.addAlpha(n.logic.fx.alpha),n.logic.fx.anim&&(this.entity.visual.clearAnims(),this.entity.visual.anim(n.logic.fx.anim,!0,0)),this.visualFreeze+=n.visualFreeze,this.visualIncapacitate+=n.visualIncapacitate,this.effects.add(e);else if(s&&this.stickEffects.has(e)){let i=this.stickEffects.get(e);i.loops=0,i.fractionNow=0}n.logic.fx.apply&&s&&wi(n.logic.fx.apply,this.entity.visual.transform,this.entity.id===I.playerId||n.caster===I.playerId?1:0,!1)}removeEffectBuff(e,n,s){if(this.stickEffects.has(e)){let i=this.stickEffects.get(e);this.buffs.has(e)||(i.done=!0,this.stickEffects.delete(e))}this.effects.has(e)&&(n.fx.visual&&this.entity.visual.skin.id===n.fx.visual&&this.changeEntityVisual(),n.fx.mount&&this.changeEntityMount(),n.fx.color&&this.entity.visual.removeColor(n.fx.color),n.fx.alpha&&this.entity.visual.removeAlpha(n.fx.alpha),n.fx.anim&&this.entity.visual.clearAnims(),this.visualFreeze-=s.visualFreeze,this.visualIncapacitate-=s.visualIncapacitate,this.effects.delete(e))}setBuff(e,n,s,i,o,r,l,a){let c=super.setBuff(e,n,s,i,o,r);c.data=a,c.visualFreeze=c.visualIncapacitate=0,this.immuneCC.size===0&&(c.logic.fx.frozen&&c.visualFreeze++,c.logic.fx.incapacitated&&c.visualIncapacitate++),this.entity.buffDisplayDirty=!0,this.entity.visual&&this.addEffectBuff(e,c,l)}removeBuff(e,n){let s=super.removeBuff(e,n);s&&(this.entity.buffDisplayDirty=!0,this.removeEffectBuff(e,s.logic,s),s.logic.fx.endSound!==void 0&&I.player!==void 0&&Xi(s.logic.fx.endSound,this.entity.visual.transform,this.entity.id===I.playerId||n===I.playerId?1:0,0,1))}changeEntityVisual(e){this.entity.remakeTransform(e),this.stickEffects.forEach((n,s)=>{let i=Bs(n.info.id,this.entity.visual.transform,n.priority,!1);i.loops=1,n.done=!0,this.stickEffects.set(s,i)})}changeEntityMount(e){this.entity.mount&&(this.entity.mount.onRemove(),this.entity.mount=void 0,this.entity.updateVisualPosition(0,I.time,I,!0)),e&&(this.entity.mount=new vc(this.entity),this.entity.mount.setSkin(e),this.entity.updateTransformScale(),this.entity.updateVisualPosition(0,I.time,I,!0),this.entity.updateTransformRotation(.016),this.entity.updateMountRotation(.016))}};var v0=class{constructor(e){this.id=e.id||0,this.type=e.type,this.pos=[0,0,0],this.vel=[0,0,0],this.rot=0,this.radius=0,this.size=0,this.name=e.name,this.setSize(e.size||1)}async init(e){this.name=e.name||""}preFixed(e,n,s){}tickFixed(e,n,s){}postFixed(e,n,s){}preDelta(e,n,s){}tickDelta(e,n,s){}postDelta(e,n,s){}onRemove(){}setPos(e){this.pos[0]=e[0],this.pos[1]=e[1],this.pos[2]=e[2]}setRot(e){this.rot=Ia(e)}onTarget(e){return!0}setName(e){this.name=e}setSize(e){this.size=e,this.radius=e/2}hSquaredDistanceV3(e){let n=e[0]-this.pos[0],s=e[2]-this.pos[2];return n*n+s*s}distanceV2(e){return xa(Bn,e,Va(Hi,this.pos)),wa(Bn)}distanceV3(e){return Xt(bt,e,this.pos),ps(bt)}squaredDistanceV2(e){return xa(Bn,e,Va(Hi,this.pos)),A3(Bn)}squaredDistance(e){return Xt(bt,e,this.pos),Bc(bt)}rotationToV2(e){return xa(Bn,e,Va(Hi,this.pos)),bm(Bn,Bn),il(Bn)}rotationToV3(e){return Xt(bt,e,this.pos),Zn(bt,bt),Im(bt)}};var wr=class extends v0{constructor(e){super(e),this.hudPos=[0,0,0],this.netDeletion=new kt(0,0)}handleMovementData(e,n){it(this.pos,e.pos),it(this.vel,e.vel)}onRemove(){this.visual&&this.visual.onRemove()}};var _0=class{constructor(e){this.entity=e,this.skills=new Map,this.skillIdsLearned=[],this.skillIdsActive=[],this.timedCast=new kt,this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0,this.gcdEnd=0}add(e,n=0,s=0,i){let o=this.skills.get(e);return o=Object.assign(o||{},{level:i!==void 0?i:o?o.level+1:1,logic:Pt.get(e),cd:new kt(n,s-n),preGcdEnd:0}),this.skills.set(e,o),o}updateSkillsLearned(e){this.skillIdsLearned.length=0,this.skillIdsLearned.push(...e)}remove(e){this.skills.delete(e)}compileActiveSkillIds(){this.skillIdsActive.length=0,this.skills.forEach((e,n)=>{if(!e.logic.engineOnly)for(let s=0;s<e.level;++s)this.skillIdsActive.push(n)})}globalCd(e,n){this.skills.forEach(s=>{!s.logic.auto&&!s.logic.ignoreGcd&&(s.cd.end<e&&(s.cd.start=e),s.cd.end<n&&(s.preGcdEnd=s.cd.end,s.cd.end=n),s.cd.duration=s.cd.end-s.cd.start)}),this.gcdEnd=n}clearGlobalCd(){this.skills.forEach(e=>{!e.logic.auto&&!e.logic.ignoreGcd&&e.cd.end===this.gcdEnd&&(e.cd.end=e.preGcdEnd,e.cd.duration=e.preGcdEnd-e.cd.start)})}startTimedCast(e,n,s,i){this.timedCast.reset(n,i),this.timedSkill=e,this.timedTarget=s,this.entity.steer[0]=0,this.entity.steer[1]=0,this.pvpBoundModifier=Pt.get(e.id).pvpBoundsAdd}interruptTimedCast(e,n){this.timedCast.reset(0,0),this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0,n&&this.clearGlobalCd()}finishTimedCast(e){return this.interruptTimedCast(!1,!1)}onDeath(){this.interruptTimedCast(!0,!1)}clear(){}hasInstantCast(e){return this.entity.buffs.instantCast.size>0&&Array.from(this.entity.buffs.instantCast).some(n=>n.logic.instantCast.has(e))}};var kP=new Map,b0=class extends _0{constructor(e){super(e)}tick(e,n,s){if(this.isPlayer){let i=this.entity.buffs.incapacitated.size>0;this.skills.forEach((o,r)=>{let l=kP.get(r)||kP.set(r,new Map).get(r),a=new Map,c=0;if(i&&!o.logic.ignoreIncapacitated?c=9:(c=o.logic.can(this.entity,o.level,this.entity.target,!0),(c===3||c===4)&&(c=o.logic.can(this.entity,o.level,this.entity.id,!0))),c!==o.status&&(o.status=c,l.get("status")!==c&&a.set("status",c)),o.cd.done(s.smoothtime))o.cd.icondone||(o.cd.icondone=!0,l.get("cd")!==void 0&&a.set("cd",void 0),l.get("remaining")!==void 0&&a.set("remaining",void 0));else{o.cd.icondone=!1;let f=Math.round(100-o.cd.fraction(s.smoothtime)*100),u;o.cd.duration>1.5&&(u=o.cd.remaining(s.smoothtime),u<=3?u=Math.ceil(u*10)/10:u=Math.ceil(u)),l.get("cd")!==f&&a.set("cd",f),l.get("remaining")!==u&&a.set("remaining",u)}a.size>0&&Ro.update(f=>(a.forEach((u,p)=>{l.set(p,u),f[o.logic.id][p]=u}),f))})}if(this.timedSkill&&this.entity.visual){let i=this.timedSkill.fx;if(i){let o=this.entity.visual.animQueue[0],r=this.timedCast.remaining(n);if(i.animCast){let l=Pf.get(i.animCast);r-=Math.min(.3,l.duration/2)}r>0?i.animChannel&&(!o||i.animChannel!==o.id)&&(this.entity.visual.clearAnims(),this.entity.visual.anim(i.animChannel,!0,0)):i.animCast&&(!o||i.animCast!==o.id)&&(this.entity.visual.clearAnims(),this.entity.visual.anim(i.animCast,!1,0))}}}add(e,n=0,s=0,i){super.add(e,n,s,i),this.isPlayer&&(this.compileActiveSkillIds(),Ro.update(r=>(r[e]={},r)),this.skills.get(e).logic.id<100&&zo.update(r=>(r.set(e,i),r)))}remove(e){this.isPlayer&&(this.compileActiveSkillIds(),Ro.update(s=>(s[e]=void 0,s)),this.skills.get(e)&&zo.update(s=>(s.delete(e),s))),super.remove(e)}updateSkillsLearned(e){super.updateSkillsLearned(e),qc.update(n=>{n.clear();for(let s=0;s<e.length;++s){let i=e[s];n.has(i)||n.set(i,nu(e,i))}return n})}cd(e,n,s){this.skills.get(e).cd.set(n,s)}clearSkillInfo(){zo.update(e=>(e.clear(),e)),qc.update(e=>(e.clear(),e))}startTimedCast(e,n,s,i){super.startTimedCast(e,n,s,i),this.entity.uiFrameDirty=!0}interruptTimedCast(e,n){super.interruptTimedCast(e,n),this.entity.uiFrameDirty=!0,e&&this.entity.visual&&this.entity.visual.clearAnims()}};var y0=class extends Xa{constructor(e){super(e)}setStat(e,n){this.stat.set(e,n),this.entity.statsDirty=!0,e==20?this.entity.setPrestige(n):e==21?this.entity.setElo(n):e==6||e==7?this.entity.uiFrameDirty=!0:e==19&&this.entity.inventory&&this.entity.inventory.setSize(n)}setResource(e,n){super.setResource(e,n),this.entity.uiFrameDirty=!0}die(){super.die(),this.entity.uiFrameDirty=!0,this.entity.visual&&this.entity.visual.onDeath()}respawn(){super.respawn(),this.entity.uiFrameDirty=!0,this.entity.visual&&this.entity.remakeTransform()}refreshCombatTimer(e,n){super.refreshCombatTimer(e,n),this.entity.uiFrameDirty=!0}onCombatEnd(){super.onCombatEnd(),this.entity.uiFrameDirty=!0}};var k0=class extends wr{constructor(e){e.creature&&(e.skin=e.creature.skin,e.name=e.creature.name),super(e),this.creatureId=e.creature?e.creature.id:-1,this.stats=new y0(this),this.buffs=new g0(this),this.skills=new b0(this),this.steer=[0,0],this.speed=1,this.static=!1,this.jump=0,this.onGround=!0,this.belowGround=!1,this.inWater=0,this.groundNormal=[0,0,0],this.target=0,this.level=0,this.faction=0,this.posLock=[0,0],this.posLockRadius=0,this.aabb=_u()}setAABB(){Wd(this.aabb,this.pos,this.size,this.size,this.size)}preFixed(e,n,s){super.preFixed(e,n,s),this.buffs.tick(e,n,s),this.stats.tick(e,n),this.skills.tick(e,n,s),this.setSize((this.stats.getStat(31)||100)/100)}getStatBasedMoveSpeed(){return Math.max(Math.min(65534,this.stats.getStat(15)))}postFixed(e,n,s){this.handlePosLock()}handlePosLock(){if(this.posLockRadius>0){xa(Hi,Va(Bn,this.pos),this.posLock);let e=wa(Hi);if(e>this.posLockRadius){let n=S3(Hi,this.posLock,wf(Hi,Hi,this.posLockRadius/e));Y(this.pos,n[0],this.pos[1],n[1])}}}hasMovementOverride(){return this.buffs.movementOverride.size>0}buffMovementOverride(e,n,s){this.hasMovementOverride()&&this.buffs.movementOverride.forEach(i=>{i.logic.movementOverride(e,n,s,this,i)})}combatRangeCheck(e,n){let s=this.pos[0]-e.pos[0],i=Math.max(0,Math.abs(this.pos[1]-e.pos[1])-this.size),o=this.pos[2]-e.pos[2];return s*s+i*i+o*o<(n+(e.size+this.size))**2}combatCylinderCheck(e,n,s){return!(this.aabb[1]>e[1]+n||this.aabb[4]<e[1]-n||Math.sqrt((e[0]-this.pos[0])**2+(e[2]-this.pos[2])**2)>s+this.radius)}tickHoles(e){let n=I.getHole(this.pos[0],this.pos[2]),s=this.pos[1]-I.getHeight(this.pos[0],this.pos[2]);return this.belowGround=n&&s<=0,n}horizontalSteer(e,n,s){if(this.stats.alive){this.rot=s;let i=bm(Bn,n);n[1]<0&&(i[1]*=.5),wf(i,i,e/20),v_(this.vel,i,s)}else this.vel[0]=0,this.vel[2]=0}setSteer(e,n){this.steer[0]=e,this.steer[1]=n}setJump(e){this.jump=e}setRot(e){super.setRot(e)}setSpeed(e){this.speed=e}setTarget(e){let n=e>0&&this.canTarget(I.getEntityById(e));return n!==!1&&n!==void 0?n.onTarget(this.id):this.target!==(this.target=0)}onTarget(e){let n=I.getEntityById(e);return n.target=this.id,super.onTarget(e)}getTargetEntity(){return I.getEntityById(this.target)}canTarget(e){return e}setFaction(e){this.faction=e}setLevel(e){this.level=e}setClass(e){this.class=e}onRemove(){this.stats.clear(),this.buffs.clearTempBuffs(),this.buffs.clearPassiveBuffs(),this.skills.clear(),super.onRemove()}hostility(e){return e.faction!==this.faction?1:0}canCombatInteract(e){return!0}canSupportInteract(e){return!0}die(e,n,s){}setPosLock(e,n,s){this.posLock[0]=~~e,this.posLock[1]=~~n,this.posLockRadius=~~s}tickWaterCollisions(e){let n=this.inWater;return this.inWater=Math.max(0,e.getWaterHeight(this.pos[0],this.pos[2])-this.pos[1]),!n&&this.inWater>0&&this.vel[1]<-3&&this.onEnterWater(),this.inWater>0}onEnterWater(){}};var oi=class extends k0{constructor(e){super(e),this.uiFrameDirty=!0,this.uiRange=!0,this.buffDisplayDirty=!0,this.visualPosition=[0,0,0],this.speechTimer=new kt(0,5),this.mount=void 0,this.mountRotAdd=0,this.namePlateScale=.5,e.creature&&(e.creature.col1[0]!==0&&(e.colPrim=e.creature.col1),e.creature.col2[0]!==0&&(e.colSec=e.creature.col2)),this.skin=e.skin,this.colPrim=e.colPrim,this.colSec=e.colSec,this.interiorlightTarget=[0,0,0,0],this.interiorlightTimer=new kt(0,.5),this.conciliator=[0,0,0],this.visual=new vc(this),this.skin>0&&this.remakeTransform()}handleMovementData(e,n){let s=Rn([0,0,0],this.pos,this.conciliator),i=Xt([0,0,0],s,e.pos);Bc(i)>1?(Y(this.conciliator,0,0,0),it(this.pos,e.pos)):Rn(this.conciliator,this.conciliator,i),it(this.vel,e.vel)}makeVisual(e,n,s){this.visual.setSkin(e||this.skin,n||this.colPrim,s||this.colSec)}remakeTransform(e,n,s){this.makeVisual(e,n,s),this.updateTransformScale(),this.updateTransformRotation(1),this.updateVisualPosition(0,0,I,!0)}onRemove(){super.onRemove(),this.mount!==void 0&&this.mount.onRemove()}updateVisualPosition(e,n,s,i=!1){e>0&&(sn(this.pos,this.pos,this.conciliator,-e*10),dn(this.conciliator,this.conciliator,1-e*10));let o=Kn(this.pos,this.visualPosition);(i||o>1e-5)&&(it(this.visualPosition,this.pos),this.visualPosition[1]+=this.radius,this.mount===void 0?it(this.visual.transform.position,this.visualPosition):(it(this.mount.transform.position,this.visualPosition),this.mount.transform.position[1]+=this.mount.skin.size*.5-this.radius)),this.interiorlightTimer.done(n)&&(this.interiorlightTimer.reset(n),s.getInteriorLight(this.interiorlightTarget,this.aabb));let r=Math.min(1,e),l=this.interiorlightTarget,a=this.visual.interiorlight;a[0]+=Math.sign(l[0]-a[0])*r,a[1]+=Math.sign(l[1]-a[1])*r,a[2]+=Math.sign(l[2]-a[2])*r,a[3]+=Math.sign(l[3]-a[3])*r}updateTransformScale(){ms(this.visual.transform.scale,this.size*.7),this.mount!==void 0&&ms(this.mount.transform.scale,this.mount.skin.size*.7)}updateTransformRotation(e){if(this.stats.alive&&this.buffs.visualFreeze===0){this.updateMountRotation(e);let n=ol(this.rot+this.mountRotAdd,this.visual.transform.rotation[1]);Math.abs(n)>.01&&(this.visual.transform.rotation[1]=ba(this.visual.transform.rotation[1]-n*Math.min(1,e*20),Math.PI*2))}}updateMountRotation(e){if(this.mount!==void 0){if((this.onGround||this.inWater>0)&&(this.steer[0]!==0||this.steer[1]!==0)){let n=this.steer[0]*1.5;this.steer[1]!=0&&(n*=.5*this.steer[1]),this.mountRotAdd-=(this.mountRotAdd-n)*Math.min(1,e*10)}this.mount.transform.rotation[1]=this.visual.transform.rotation[1]}else this.mountRotAdd=0}postFixed(e,n,s){super.postFixed(e,n,s),this.visual.tickFixed(e,n,s),this.mount!==void 0&&this.mount.tickFixed(e,n,s)}postDelta(e,n,s){super.postDelta(e,n,s),this.updateVisuals(e,n,s),this.updateUiParts(n)}updateVisuals(e,n,s){this.updateTransformRotation(e),this.updateTransformScale(),this.updateVisualPosition(e,n,s),this.mount!==void 0&&(this.mount.tick(e,n,s),this.mount.mountPosition(this.visual.transform.position)),this.visual.tick(e,n,s)}updateUiParts(e){let n=this.id===I.playerId,s=qn===this.id,i=en.has(this.name);if(s||i){let o=this.squaredDistance(I.player.pos)<900;o!=this.uiRange&&(this.uiFrameDirty=!0),this.uiRange=o}(this.uiFrameDirty||this.skills.timedSkill!==void 0)&&(s&&this.hydrateUnitStore(Ui),n?this.hydrateUnitStore(Bi):i&&this.hydrateUnitStore(en.get(this.name).unitStore)),(this.buffDisplayDirty||n||s)&&(s&&this.hydrateBuffStore(n,Vc,le.buffcountUnitframes),n?this.hydrateBuffStore(n,ea,le.buffcountUnitframes):(this.buffDisplayDirty||s)&&i&&this.hydrateBuffStore(n,en.get(this.name).buffStore,le.buffcountParty)),this.speechText!==void 0&&this.speechTimer.done(e)&&(this.speechText=void 0)}setTarget(e){let n=this.target,s=super.setTarget(e);if(n!=this.target&&this==I.player&&s){let i=I.getEntityById(e);i?(i.hydrateUnitStore(Ui,le.buffcountUnitframes),i.hydrateBuffStore(!1,Vc,le.buffcountUnitframes)):Ui.update(o=>(o.visible=!1,o))}return s}hydrateUnitStore(e){e.update(n=>(n.visible=!0,n.name=this.name,n.alive=this.stats.alive,n.hp=this.stats.getResource(6),n.hpMax=this.stats.getStat(6),n.mp=this.stats.getResource(7),n.mpMax=this.stats.getStat(7),n.level=this.level,n.class=this.class,n.id=this.id,n.clan=this.clan,n.faction=this.faction,n.party=this.party,n.role=this.partyrole,n.type=this.type,n.combat=!this.stats.combatTimer.done(I.time),n.range=this.uiRange,n.rarity=this.faction===2&&(this.rarity||!1),n.timedSkill=this.skills.timedSkill,n.timedCast=this.skills.timedCast,n)),this.uiFrameDirty=!1}hydrateBuffStore(e,n,s){n.update(i=>_z(i,this.buffs,s,e)),this.buffDisplayDirty=!1}speech(e,n){this.speechText=e,this.speechStyle=n,this.speechTimer.reset(I.time)}},_z=(t,e,n,s)=>{let i=[];e.buffs.forEach((r,l)=>{r.forEach((a,c)=>{!a.logic.passive&&a.logic.icon!==void 0&&(!le.buffsHideIrrelevant||c===I.playerId||c===e.entity.id&&e.entity.faction===2||e.entity===I.player&&a.logic.type==1)&&(!a.logic.unique||i.reduce((f,u)=>f+(u.id===a.id?1:0),0)===0)&&i.push(a)})});let o=i.sort((r,l)=>l.time-r.time).sort((r,l)=>r.type-l.type).slice(0,n);if(t.length<o.length)for(;t.length<o.length;)t.push(yz());else if(t.length>o.length)for(;t.length>o.length;)kz(t.pop());return o.forEach((r,l)=>{xz(I.smoothtime,r,t[l],s)}),t},bz=0,xP=[],yz=()=>xP.pop()||{id:bz++,icon:"",type:1,time:0,duration:10,stacks:0,cancel:-1},kz=t=>{xP.push(t)},xz=(t,e,n,s)=>{e.logic.customIcon===void 0?n.icon=`/data/${e.logic.icon}.${Gn}?v=8593107`:n.icon=`/data/${e.logic.customIcon(e)}.${Gn}?v=8593107`,n.cancel=s&&e.logic.tags.has(12)?e.logic.id:-1,n.type=e.logic.type,n.time=Math.min(e.timer.duration,e.timer.passed(t)),n.duration=e.timer.duration,n.stacks=e.uniqueInstances>1?e.uniqueInstances:e.stacks};var rs=class extends oi{constructor(e){super(e),this.static=!0,this.interactions=e.interactions,this.interactions.length&&this.setDialogue(this.interactions[0].text,this.interactions[0].choices)}interact(e){this.createInteraction()}createInteraction(){zi.set({title:this.name,text:this.text,choices:this.choices})}setDialogue(e,n){this.text=e,this.choices=n}};var x0=class extends rs{constructor(e){super({type:6,...e})}};var w0=class extends x0{constructor(e){super({...e,...C.npcs.blacksmith})}};var M0=class extends rs{constructor(e){super({type:2,...e})}};var no=(t,e)=>{let n=t.length-e,s="",i=e+n;for(;e<i;){let o=t[e++];if(o<128)s+=String.fromCharCode(o);else if(o>191&&o<224){let r=t[e++];s+=String.fromCharCode((o&31)<<6|r&63)}else if(o>239&&o<365){let r=t[e++],l=t[e++],a=t[e++],c=((o&7)<<18|(r&63)<<12|(l&63)<<6|a&63)-65536;s+=String.fromCharCode(55296+(c>>10)),s+=String.fromCharCode(56320+(c&1023))}else{let r=t[e++],l=t[e++];s+=String.fromCharCode((o&15)<<12|(r&63)<<6|l&63)}}return s};var F0=class extends M0{constructor(e){super({...e,...C.npcs.conjurer})}interact(e){let n=no(e,1).split("#");n[0]!==""?this.setDialogue(this.interactions[0].text,Array.from(n,s=>{let i=s.split("~");return this.interactions[0].choices[0].replace("$1",i[0])+(i[1]>0?` (Lv. ${i[1]}+)`:"")})):this.setDialogue(this.interactions[0].text,[]),super.interact(e)}};var C0=class extends wr{constructor(e){super({type:3,...e}),this.partytimeout=0,this.party=0,this.droptype="",this.tier=0,this.quality=0}partyTimeoutCheck(e){return this.party===0||e.id===this.party||e.party===this.party||I.time>this.partytimeout}canBePickedUpBy(e,n=30){return this.partyTimeoutCheck(e)&&e.stats.alive&&!e.buffs.buffs.has(128,e.id)&&e.squaredDistance(this.pos)<n}};var S0=class extends C0{constructor(e){super(e),this.visual={transform:Ji(1561,!1,!1,!0)},this.visual.transform.data.multi.needsUpdate=!1,this.setSize(.2),this.visual.transform.visible=!1,this.uiTimeout=0,this.dirty=!1,this.hasInfo=!1,this.hasPos=!1,this.hasRot=!1,this.color="misc"}postDelta(e,n,s){if(this.visual.transform.visible&&this.dirty){let i=s.getChunkFromWorld(this.pos[0],this.pos[2]);i!==void 0&&i.deserialized&&(this.pos[1]=s.getHeight(this.pos[0],this.pos[2])+Math.random()*.1+.1,this.visual.transform.rotation[1]=Math.random()*Math.PI*2,Dm(this.visual.transform.rotation,s.getNormal(this.pos[0],this.pos[2])),it(this.visual.transform.position,this.pos),this.visual.transform.data.multi.needsUpdate=!0,qt(this.visual.transform,!1),this.dirty=!1)}}setDropInfo(e,n,s,i,o){this.hasInfo=!0,this.party=i,this.partytimeout=o,this.droptype=jk[e],this.tier=n,this.quality=s,this.lootquality=s;let r,l;this.droptype=="gold"?(this.name=this.tier+"c",this.setSize(.1),r="gold",this.color="gold",this.quality=100):(r=this.droptype+this.tier,l=rn[r],l&&(this.name=hn(this.droptype,this.tier)),this.droptype!=="misc"&&this.droptype!=="rune"&&this.droptype!=="book"?(this.color=Yt(s)[1],le.itemQualityPercent&&(this.name+=` ${this.quality}%`)):(this.color=this.droptype,this.quality=100,this.droptype==="rune"&&(this.lootquality=90)));let a=l&&l.art||r;Lr(this.visual.transform.data.uvshift,xo[a]),Y(this.visual.transform.scale,xo[a][0]*20,1,xo[a][1]*20),this.visual.transform.data.shine[0]=Math.random()*6.1,this.dirty=!0,this.visual.transform.visible=!0}onRemove(){xi(this.visual.transform.data.multi,this.visual.transform),nt.shift.down&&(hc.add(this),this.uiTimeout=Math.round(I.time/5)*5+10)}};var A0=class extends oi{constructor(e){super({type:7,...e}),this.static=!0,this.class=5}};var P0=class extends A0{};var T0=class extends rs{constructor(e){super({type:12,...e})}};var E0=class extends T0{constructor(e){super({...e,interactions:[]})}};var D0=class extends rs{constructor(e){super({type:4,...e})}};var I0=class extends D0{constructor(e){super({...e,...C.npcs.merchant})}};var V0=class extends oi{constructor(e){super({type:1,...e}),this.groundHeight=0;let n=c1.get(e.creature.id);this.aggroMode=n.aggroMode,this.rarity=n.rarity}tickFixed(e,n,s){this.horizontalSteer(this.speed,this.steer,this.rot),super.tickFixed(e,n,s),this.tickHoles(e),this.stats.alive&&(sn(this.pos,this.pos,this.vel,e),this.groundHeight=s.raycastEnvironmentHeight(this.pos[0],this.pos[2],this.pos[1]+1,this.pos[1]-1,this.groundNormal),this.belowGround||(this.groundHeight=Math.max(this.groundHeight,s.getHeight(this.pos[0],this.pos[2])))),this.setAABB(),this.tickWaterCollisions(s),this.inWater>this.radius||(this.pos[1]-=10*e),this.pos[1]=Math.max(this.groundHeight,this.pos[1])}};var L0=class extends V0{};var q0=class extends wr{constructor(e){super({type:11,...e})}};var R0=class extends q0{constructor(e){super(e),this.meshId=0,this.scale=0,this.effects=[],this.dirty=!1,this.rot=Math.random()*3.14}postDelta(e,n,s){if(this.dirty){it(this.mesh.position,this.pos),this.mesh.rotation[1]=this.rot,ms(this.mesh.scale,this.scale),this.mesh.matrixNeedsUpdate=!0,qt(this.mesh,!0);for(let i=0;i<this.effects.length;++i){let o=this.effects[i];qt(o.transform,!0)}this.mesh.data.multi&&(this.mesh.data.multi.needsUpdate=!0),this.dirty=!1}}setNodeInfo(e,n){e!==this.meshId&&(this.meshId>0&&this.removeMesh(),this.meshId=e,this.makeMesh(),this.dirty=!0),this.scale!==n&&(this.scale=n,this.dirty=!0)}makeMesh(){let e=_i.get(this.meshId);e.geometry>0?(this.mesh=Ji(this.meshId,!0,!1,!0),es(this.mesh.data.interiorlight,0,0,0,0)):this.mesh=on();for(let n=0;n<e.effects.length;++n){let s=e.effects[n],i=on();it(i.position,s.pos),it(i.scale,s.scale),it(i.rotation,s.rot),Mn(i,this.mesh);let o=Bs(s.id,i,0,!0);this.effects.push(o)}}removeMesh(){this.mesh!==void 0&&(this.mesh.data.multi?xi(this.mesh.data.multi,this.mesh):ui(this.mesh)),this.mesh=void 0;for(let e=0;e<this.effects.length;++e)this.effects[e].done=!0;this.effects.length=0}onRemove(){this.removeMesh()}};var z0=class extends oi{constructor(e){super({type:10,...e}),this.groundHeight=0}tickFixed(e,n,s){this.horizontalSteer(this.speed,this.steer,this.rot),super.tickFixed(e,n,s),this.tickHoles(e),this.stats.alive&&(sn(this.pos,this.pos,this.vel,e),this.groundHeight=s.raycastEnvironmentHeight(this.pos[0],this.pos[2],this.pos[1]+1,this.pos[1]-1,this.groundNormal)),this.setAABB(),this.tickWaterCollisions(s),this.inWater>this.radius||(this.pos[1]-=10*e),this.pos[1]=Math.max(this.groundHeight,this.pos[1])}};var B0=class extends z0{};var U0=class extends oi{constructor(e){super({type:0,size:.9,...e}),this.exp=0,this.party=0,this.partyrole=0,this.prestige=0,this.prestigeRank=0,this.elo=0,this.eloRank=0,this.clan=void 0,this.clanRole=0,this.jumpLast=0}tickVelocity(e,n,s,i,o){this.inWater>this.radius?(this.onGround&&(this.vel[1]=Math.max(0,this.vel[1])),this.inWater<this.radius+.1&&(this.jump>0||this.vel[1]===0)?this.vel[1]=this.jumpLast===0&&i>0?7:0:(this.vel[1]+=i?e*8:e*-4,this.vel[1]=Math.max(Math.min(this.vel[1],4),-3)),this.horizontalSteer(o*.5,n,s)):this.onGround?(this.stats.alive&&i>0&&o>0&&(this.vel[1]=9,this.onGround=!1),this.horizontalSteer(o,n,s)):(this.vel[1]=Math.max(-60,this.vel[1]-25*e),this.stats.alive&&this.vel[0]===0&&this.vel[2]===0&&this.horizontalSteer(o*.5,n,s)),this.jumpLast=this.vel[1]<0?this.jumpLast:this.jump}tickMovement(e,n,s,i,o){this.tickVelocity(e,n,s,i,o);let r=this.tickHoles(e);this.setWorldCollAABB(this.vel[0]*e,this.vel[1]*e,this.vel[2]*e);let l=I.triangleGrid.queryAABB(this.aabb),a=[],c=[],f=[];for(let v=0;v<l.length;++v){let _=l[v],b=_[3][1];b>.6?c.push(_):b<-.6?f.push(_):a.push(_)}let u=ps(this.vel)*e,p=Math.floor(Math.max(1,u/.1)),g=e/p;for(let v=0;v<p;++v)this.tickCollisions(g,a,c,f,r);this.setAABB(),this.tickWaterCollisions(I),I.clampV3(this.pos)}setWorldCollAABB(e,n,s){let i=this.aabb,o=this.radius+.5;i[0]=this.pos[0]-Math.min(0,e)-o,i[3]=this.pos[0]+Math.max(0,e)+o,i[1]=this.pos[1]-Math.min(0,n)-o,i[4]=this.pos[1]+Math.max(0,n)+o*2,i[2]=this.pos[2]-Math.min(0,s)-o,i[5]=this.pos[2]+Math.max(0,s)+o}tickCollisions(e,n,s,i,o){let r=[...this.pos];sn(this.pos,this.pos,this.vel,e);let l=this.belowGround||o?0:I.getHeight(this.pos[0],this.pos[2]),a=I.getNormal(this.pos[0],this.pos[2]);this.tickWallCollisions(n,l,a),l=this.belowGround||o?0:I.getHeight(this.pos[0],this.pos[2]),a=I.getNormal(this.pos[0],this.pos[2]),this.tickFloorCollisions(s,l,a),this.tickCeilCollisions(i,r),this.belowGround||(this.pos[1]=Math.max(this.pos[1],I.getHeight(this.pos[0],this.pos[2])))}tickWallCollisions(e,n,s){if(s[1]<.6&&this.pos[1]<n){let c=-(ay(...this.pos,this.pos[0],n,this.pos[2],...s)+.05);this.pos[0]-=s[0]*c,this.pos[2]-=s[2]*c}let i=this.radius,o=this.radius*1.5,r=this.pos[0],l=this.pos[1]+o,a=this.pos[2];for(let c=0;c<e.length;++c){let f=e[c];if(Em(f[0],f[1],f[2],r,l,a)){let u=ly(r,l,a,...f[0],...f[3]);if(u<i&&u>-.5){let p=u-i;this.pos[0]-=f[3][0]*p,this.pos[2]-=f[3][2]*p}}}}tickFloorCollisions(e,n,s){let o=this.vel[1]>0||this.inWater>this.radius?0:.1,r=this.radius*1.5,l=1/0,a=!1;for(let f=0;f<e.length;++f){let u=e[f];if(Em(u[0],u[1],u[2],...this.pos)){let p=x1(...this.pos,...u[0],...u[3]);p<l&&p<o&&p>-r&&(l=p,a=!0,it(this.groundNormal,u[3]))}}let c=-(n-this.pos[1]);s[1]>.6&&this.pos[1]<n+o&&c<l&&c<o&&c>-r&&(l=c,a=!0,it(this.groundNormal,s)),a?(this.pos[1]-=l,this.onGround||(this.onGround=!0,this.onFallLanding(-this.vel[1]),this.vel[1]=Math.max(0,this.vel[1]))):(this.onGround=!1,Y(this.groundNormal,0,1,0))}tickCeilCollisions(e,n){let s=this.radius*1.5;for(let i=0;i<e.length;++i){let o=e[i],r=this.pos[0],l=this.pos[1],a=this.pos[2];if(Em(o[0],o[1],o[2],r,l,a)){let c=x1(...this.pos,...o[0],...o[3]);c<0&&c>-s&&(this.pos[1]>=n[1]&&(this.pos[0]=n[0],this.pos[2]=n[2]),this.vel[1]=Math.min(0,this.vel[1]),this.vel[0]=0,this.vel[2]=0)}}}setExp(e){this.exp=e}setParty(e,n){this.party=e,this.partyrole=n}setPrestige(e){return e!==this.prestige?(this.prestige=e,this.prestigeRank=Za(e),!0):!1}setElo(e){return e!==this.elo?(this.elo=e,this.eloRank=za(e),!0):!1}setClan(e,n=0){this.clan=e,this.clanRole=n}getNearbyPartyMembers(e){let n=[];return this.stats.alive&&n.push(this),this.party>0&&I.entities.type[0].forEach(s=>{s.party==this.party&&s!=this&&s.stats.alive&&Kn(e,s.pos)<1e3&&n.push(s)}),n}hostility(e){return(I.mode.partyBasedHostility===!0?e.party!==this.party:e.faction!==this.faction)?e.type===0?e.stats.stat.get(26)===0&&this.stats.stat.get(26)===0?0:2:1:0}canCombatInteract(e){return e.type===0?e.buffs.buffs.has(128,e.id)?!1:!I.mode.pvpprotect||this.hostility(e)<2?!0:!(this.stats.stat.get(26)===0||e.stats.stat.get(26)===0)&&Math.abs(this.stats.stat.get(26)-e.stats.stat.get(26))<=5+Math.max(this.skills.pvpBoundModifier,e.skills.pvpBoundModifier):e.type===1||e.type===10||e.type===12?e.stats.stat.get(26)>0:!0}canSupportInteract(e){return this.hostility(e)===0&&(!I.mode.pvpprotect||(e.type===0?Math.abs(this.stats.stat.get(26)-e.stats.stat.get(26))<=5:!0))}onFallLanding(e){}};var wz=[1,2,3,4],El=class extends U0{constructor(e){e.skin=0,super(e)}tickFixed(e,n,s){super.tickFixed(e,n,s),this.tickMovement(e,this.steer,this.rot,this.jump,this.speed)}setClass(e){e!==this.class&&(super.setClass(e),this.skin=wz[this.class],this.remakeTransform())}makeVisual(e,n){super.makeVisual(e,n),this.prestige>0&&this.setPrestige(this.prestige,!0),this.level>=10&&this.setLevel(this.level),this.elo>1500&&this.setElo(this.elo,!0)}setPrestige(e,n){if(super.setPrestige(e)||n){let s=Math.min(this.prestigeRank,10),i=this.prestigeRank-11;s<1?(this.visual.setCrown(!1),this.visual.setHeadgear(!1)):(this.visual.setHeadgear(i<0?K1[Math.min(4,s-1)]:Ln.darkgold),s>5?this.visual.setCrown(K1[s-6]):this.visual.setCrown(!1)),i<0?this.visual.setGem(!1):this.visual.setGem(Aw[i],i>0?1:.8)}}setElo(e,n){if(super.setElo(e)||n){let s=za(e);this.visual.setShoulders(eg[Math.min(s,1)],.65+s*.08,s>0&&eg[s])}}setLevel(e){super.setLevel(e),e>=15?this.visual.setCape(this.faction===0?Ln.vanguard:Ln.bloodlust,e>=25?1:.5):this.visual.setCape(!1)}setParty(e,n){this.uiFrameDirty=!0,this.buffDisplayDirty=!0,super.setParty(e,n)}onEnterWater(){this.visual.playSound(130,!1),this.visual.watersplash(94)}};var O0=class extends rs{constructor(e){super({type:9,...e})}};var $0=class extends O0{constructor(e){super({...e,...C.npcs.sage})}interact(e){this.interactions[0].choices[0]=this.interactions[0].choices[0].replace("$1",I.player.level*10),super.interact(e)}};var N0=class extends rs{constructor(e){super({type:5,...e})}};var j0=class extends N0{constructor(e){super({...e,...C.npcs.stash})}};var W0=class extends rs{constructor(e){super({type:8,...e})}};var G0=class extends W0{constructor(e){super({...e,...C.npcs.trader});let n=f1.get(e.creature.id);this.items=[],Tf.forEach(s=>{if(s.shop===n.shop){let i=new ki,o=K();i.hydrate({type:s.type,tier:s.tier,stacks:s.stacks===0?void 0:s.stacks,upgrade:s.upgrade,store:o}),i.buyid=s.id,this.items.push([i,o])}})}};var H0=class{constructor(e){this.entity=e,this.slots=new Map,this.gold=0,this.medals=0,this.size=0,this.firstEmptySlot=0,this.firstEmptySlotDirty=!0,this.setSize(0)}tickFixed(e,n,s){}setSize(e){this.size=Math.min(100,e)}setGold(e){this.gold=e}setMedals(e){this.medals=e}setItem(e,n){let s=new ki(n);return this.slots.set(e,s),e===this.firstEmptySlot&&(this.firstEmptySlotDirty=!0),s}removeItem(e){let n=this.slots.get(e);return this.slots.delete(e),(e<this.firstEmptySlot||this.firstEmptySlot===-1)&&(this.firstEmptySlot=e),n}async hydrateItems(e=!1){let n=[],s=[];if(this.slots.forEach((i,o)=>{i.dirty&&(i.dirty=!1,n.push(i.dbid),s.push(o))}),n.length){let i=await this.fetchData(n);this.compareData(i,s,0),this.postHydrate(s,e)}else e&&this.postHydrate(s,e)}hydrate(e){this.slots.has(e.slot)?this.slots.get(e.slot).hydrate(e):console.error("received hydration of unknown item")}postHydrate(e){}compareData(e,n,s){e.forEach(i=>{i.slot!==null&&(this.hydrate(i),n=n.filter(o=>o!==i.slot))}),n.forEach(i=>this.removeItem(i,s))}findFirstItemOfType(e,n){for(let s of this.slots)if(s[1].type==e&&s[1].tier==n)return s[1]}findFirstSlotOfType(e,n){let s=-1,i=0;for(let o of this.slots){let r=o[0],l=o[1];l.type==e&&l.tier==n&&r>s&&l.bound>=i&&(s=r,i=l.bound)}return s>=0?s:void 0}getFirstEmptySlot(){if(this.firstEmptySlotDirty){this.firstEmptySlotDirty=!1;for(let e=0;e<this.size;++e)if(!this.slots.has(e))return this.firstEmptySlot=e;this.firstEmptySlot=-1}return this.firstEmptySlot}findFirstUnmaxedStackableOfType(e,n){for(let s of this.slots)if(s[1].type==e&&s[1].tier==n&&s[1].stacks<50)return s[1];return-1}};var Y0,X0=class extends H0{constructor(e){super(e),this.dirty=!1}tickFixed(e,n,s){super.tickFixed(e,n,s),this.dirty&&(this.hydrateItems(),this.dirty=!1)}setGold(e,n,s){super.setGold(e),iu(e,n,s,"$g"),Hs.set(e)}setMedals(e,n,s){super.setMedals(e),iu(e,n,s,"$m"),ta.set(e)}setItem(e,n,s){let i=super.setItem(e,n);i.reason=s,this.dirty=!0}removeItem(e,n){dF(super.removeItem(e),n),Y0[e]!==void 0&&(Y0[e].set(void 0),this.dirty=!0,this.updateInventoryCounts())}hydrate(e){e.store=Y0[e.slot],super.hydrate(e)}postHydrate(e){super.postHydrate(e),this.updateInventoryCounts()}updateInventoryCounts(){let e={};this.slots.forEach(n=>{let s=n.type+n.tier;e[s]=(e[s]||0)+(n.stacks?n.stacks:1)}),sa.set(e)}async fetchData(e){let s=await(await fetch("/api/item/get",{method:"POST",body:JSON.stringify({ids:e})})).json();if(s.fail)console.error(s);else return s}setSize(e){super.setSize(e),na.update(n=>{for(let s=111;s>=0;--s)s>=101?n[s]||(n[s]=K(void 0)):s>=this.size?n[s]&&delete n[s]:n[s]||(n[s]=K(void 0));return Y0=n,n})}};var Q0=class extends El{constructor(e){super(e),I.setPlayer(this),this.skills.isPlayer=!0,this.skills.clearSkillInfo(),this.inventory=new X0(this),this.partyInfoUpdateTimer=new kt(0,1),this.heartBeatTimer=new kt(0,1),this.secondlyUpdates=new kt(0,1),this.lastNetRot=this.rot,this.inputTicksPassed=0,this.inputTicksSinceLastPosUpdate=0,this.inputTicksSinceLastRotUpdate=0,ts[1]=.7,this.smoothZoom=0,this.areaid=-1}makeVisual(e,n){super.makeVisual(e,n),this.visual.soundPrio=1}tickFixed(e,n,s){super.tickFixed(e,n,s),this.inventory.tickFixed(e,n,s)}preFixed(e,n,s){super.preFixed(e,n,s),(nt.turnright.down||nt.turnleft.down)&&(ts[0]=Ia(ts[0]+le.mouseSensitivity*3*e*((nt.turnleft.down?1:0)-(nt.turnright.down?1:0)))),this.handleInput(e,n,s)}postFixed(e,n,s){super.postFixed(e,n,s)}handleInput(e,n,s){this.inputTicksPassed++;let i=!1,o=!1,r=!1,l=!1,a=!1,c=!1,f=this.steer[0],u=this.steer[1],p=this.jump,g=this.rot,v=f,_=u,b=p,y=g;this.hasMovementOverride()?(this.buffMovementOverride(e,n,s),f=this.steer[0],u=this.steer[1],p=this.jump,g=this.rot):(f=(nt.left.down?1:0)+(nt.right.down?-1:0),u=(nt.fwd.down||nt.lmb.down&&nt.rmb.down?1:0)+(nt.back.down?-1:0),p=nt.jump.down?1:0,g=le.lockedcamera&&nt.lmb.down||nt.rmb.down||nt.turnleft.down||nt.turnright.down?ts[0]:this.rot),(f!==v||u!==_)&&(o=f!==v,r=u!==_,this.setSteer(f,u)),p!==b&&(this.setJump(p),a=!0);let k=ol(g,this.lastNetRot);this.inputTicksSinceLastRotUpdate++,g!==y&&this.setRot(g),g!==this.lastNetRot&&((this.steer[0]!==0||this.steer[1]!==0)&&Math.abs(k)>.1||this.inputTicksSinceLastRotUpdate>10||r||o||Math.abs(k)>.2)&&(this.lastNetRot=y,i=!0);let S=this.getStatBasedMoveSpeed();S!=this.speed&&(this.setSpeed(S),l=!0),this.inputTicksSinceLastPosUpdate++,this.inputTicksSinceLastPosUpdate>600?c=!0:this.inputTicksSinceLastPosUpdate>40?(this.steer[0]!==0||this.steer[1]!==0)&&(c=!0):this.inputTicksSinceLastPosUpdate>20&&(this.steer[0]!==0||this.steer[1]!==0)&&(i||o||r)&&(c=!0),(i||o||r||l||a||c)&&this.sendInput(i,o,r,l,a,c)}sendInput(e,n,s,i,o,r){let l={uint8s:[],int8s:[],uint16s:[],doubles:[]};l.uint8s.push(Math.min(254,this.inputTicksPassed)),o&&l.uint8s.push(this.jump),n&&!s?l.int8s.push(this.steer[0]):(n||s)&&l.int8s.push(this.steer[0],this.steer[1]),e&&(this.inputTicksSinceLastRotUpdate=0,l.doubles.push(this.rot)),r&&(this.inputTicksSinceLastPosUpdate=0,l.doubles.push(this.pos[0],this.pos[1],this.pos[2])),i&&l.uint16s.push(this.speed),Ss(Ft.clientPlayerInput.packData(l)),this.inputTicksPassed=0}updateCharPanel(){(le.charpanelOpen||le.skillmenuOpen)&&this.statsDirty&&(this.statsDirty=!1,Oo.update(e=>(Array.from(this.stats.stat).forEach(s=>e[s[0]]=s[1]),e)))}updatePartyInfo(e){if(this.partyInfoUpdateTimer.done(e)){this.partyInfoUpdateTimer.reset(e);let n=this.getNearbyPartyMembers(this.pos),s=M1(n.length);Qn.update(i=>(i.role=this.partyrole,i.nearby=n.length,i.exprate=Math.round(s*100),i.itemfind=Math.min(10*100,Math.round(s*100+vy(n)*100)),i))}}handleCamera(e){if(it(Gt.position,this.mount?this.mount.transform.position:this.visual.transform.position),Gt.position[1]+=1.25,Gt.rotation[0]=ts[1],!nt.lmb.down&&!nt.rmb.down&&(this.steer[0]!==0||this.steer[1]!==0)){let u=ol(this.rot,ts[0])*Math.min(1,e*2);u!==0&&(Math.abs(u)>.03*e?(u=u>0?Math.max(u,Math.min(1,.6*e)):Math.min(u,Math.max(1,-.6*e)),ts[0]-=u):ts[0]=this.rot)}Gt.rotation[1]=ts[0],qt(Gt,!1);let n=le.cameraZoom;Y(gt.transform.position,0,0,-n),fa(gt,!1);let s=[0,0,0],i=[0,0,0],o=[0,0,0];ao(gt,o,[0,0]),Xt(s,o,Gt.position),kp(i,s);let r=ps(s),l=[0,0,0],a=[0,0,0],c=[[-1,1],[1,1],[-1,-1],[1,-1]];for(let u=0;u<c.length;++u){let p=c[u];ao(gt,l,p),Xt(a,l,o),Rn(l,Gt.position,a);let g=I.triangleGrid.queryRay(l,s,i),v=1;for(let _=0;_<g.length;++_){let b=g[_];v=Math.min(v,La(b[0],b[1],b[2],l,s,!0))}v<1&&(n=Math.min(r*v,n))}if(this.smoothZoom=Math.max(0,Math.min(this.smoothZoom+e*20,n)),Y(gt.transform.position,0,0,-this.smoothZoom),Ch(gt),!this.belowGround){ao(gt,l,[0,-1]);let u=I.getHeight(l[0],l[2]);u>l[1]&&(Gt.position[1]+=u-l[1])}qt(Gt,!1),fa(gt,!1),ao(gt,l,[0,-1]);let f=I.getWaterHeight(l[0],l[2]);if(f>l[1]){let u=f-l[1];jd(u);let p=l[1]-f;if(ao(gt,l,[0,1]),f<l[1]){let g=l[1]-f;Math.abs(g)>Math.abs(p)?(Gt.position[1]-=p,jd(0)):Gt.position[1]-=g,qt(Gt,!1),fa(gt,!1)}}else jd(0)}handleAreaCheck(e){let n=e.getAreaId(this.pos[0],this.pos[2]);if(n!==this.areaid){this.areaid=n;let s=Af.get(n);s!==void 0&&Ar.set({type:"area",text:s.name,time:5e3})}}handleHeartBeat(e){let n=this.stats.getResource(6)/(this.stats.getStat(6)*.5);n>0&&n<1&&(n=(Math.max(0,Math.min(1,n))+.5)/1.5,Mt(103),this.heartBeatTimer.reset(e,n))}postDelta(e,n,s){this.updateCharPanel(),this.updatePartyInfo(n),super.postDelta(e,n,s),this.handleCamera(e),this.secondlyUpdates.done(n)&&this.handleAreaCheck(s),this.heartBeatTimer.done(n)&&this.handleHeartBeat(n)}updateTransformRotation(e){this.stats.alive&&this.buffs.visualFreeze===0&&(this.updateMountRotation(e),this.buffs.movementOverride.size||!nt.rmb.down&&!(le.lockedcamera&&nt.lmb.down)?this.visual.transform.rotation[1]=this.rot:this.visual.transform.rotation[1]=ts[0],this.visual.transform.rotation[1]+=this.mountRotAdd)}setLevel(e){super.setLevel(e),this.uiFrameDirty=!0}onRemove(){super.onRemove(),I.removePlayer(this)}setExp(e){super.setExp(e),lp.update(n=>(n.current=e,n.max=er(this.level),n))}setClan(e,n=0){super.setClan(e,n),gp.set(e)}setRot(e,n=!1){super.setRot(e),n&&(ts[0]=e)}};var S2=new Map([[6,w0],[2,F0],[7,P0],[4,I0],[0,El],[9,$0],[12,E0],[5,j0],[8,G0],[3,S0],[1,L0],[10,B0],[11,R0]]),wP=(t,e)=>t==0?e==I.playerId?Q0:El:S2.get(t);var A2=[-0,-1,-0],Z0=class{constructor(){this.id="",this.idInt=0,this.file="",this.bounds=0,this.chunkAmount=0,this.entities={array:[],map:new Map,type:{}},S2.forEach((e,n)=>this.entities.type[n]=[]),this.mode=gm.normal,this.chunksMap=new Map,this.chunksArray=[],this.finishedLoadingChunks=new Set,this.time=this.accum=-0,this.timestep=1/60,this.tickId=0,this.data=void 0,this.triangleGrid=new u0}load(e,n){this.id=e,this.file=n,u1.forEach(s=>{s.name===n&&(this.data=s,this.idInt=s.id)}),this.parse(!1)}tickIdToTimestamp(e){return e*this.timestep}setTimeFromTickId(e){return this.tickId=e,this.time=this.tickIdToTimestamp(e),this.tickId}createEntity(e,n,s){return s=s||{},s.id=n,new(wP(e,n))(s)}addEntity(e){if(e===void 0||e.type===void 0){console.log("Error: tried adding an entity of unknown type to the world");return}if(this.entities.array.length>=32766){console.log("Error: tried addint entity but we already are at the maximum");return}if(this.isEntityInWorld(e)||this.isEntityIdTaken(e.id)){console.log("Error: Entity in world or entity id taken"),console.log(e),console.log(this.getEntityById(e.id));return}return this.entities.array.push(e),this.entities.map.set(e.id,e),this.entities.type[e.type].push(e),e}removeEntity(e){if(e===void 0)return!1;this.entities.map.delete(e.id);let n=this.entities.array.indexOf(e);return n>-1&&this.entities.array.splice(n,1),n=this.entities.type[e.type].indexOf(e),n>-1&&this.entities.type[e.type].splice(n,1),e.onRemove(),e}isEntityIdTaken(e){return this.entities.map.has(e)}isEntityIdAllowed(e){return!0}isEntityInWorld(e){return this.entities.array.indexOf(e)>=0}entity(e){return this.entities.map.get(e)}getEntityById(e){return this.entities.map.get(e)}getPlayerByName(e){let n=e.toLowerCase();return this.entities.type[0].find(s=>s.name&&s.name.toLowerCase()===n)}getMonsterByName(e){let n=e.toLowerCase();return this.entities.array.find(s=>s.name&&s.name.toLowerCase()===n)}setMode(){this.mode=gm[this.id]||gm.normal}getHeight(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let s=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!s||!s.deserialized?-0:Mi(s,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getHole(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let s=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!s||!s.deserialized?-0:yu(s,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getWaterHeight(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let s=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!s||!s.deserialized?-1:ku(s,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getAreaId(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let s=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!s||!s.deserialized?-0:Yv(s,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getEnvironmentId(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let s=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!s||!s.deserialized?-0:Xv(s,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getNormal(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let s=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);if(!s||!s.deserialized)Y(A2,0,0,0);else{e=e>=this.bounds?63:e%64,n=n>=this.bounds?63:n%64,e/=2.6666666666666665,n/=2.6666666666666665;let i=Math.floor(e)*2+24*Math.floor(n)*2;e%1+n%1>1&&i++,i*=3,Y(A2,s.normals[i],s.normals[i+1],s.normals[i+2])}return A2}clampV3(e){return e[0]=vt(e[0],0,this.bounds),e[1]=vt(e[1],0,2e3),e[2]=vt(e[2],0,this.bounds),e}getChunkFromWorld(e,n){return e=vt(e,0,this.bounds),n=vt(n,0,this.bounds),e=Math.min(Math.floor(e/64),this.chunkAmount-1),n=Math.min(Math.floor(n/64),this.chunkAmount-1),this.chunksMap.get(e+n*this.chunkAmount)}getChunk(e,n){if(!(e<0||n<0||e>=this.chunkAmount||n>=this.chunkAmount))return this.chunksMap.get(e+n*this.chunkAmount)}parse(e){this.setMode(),e||(this.chunkAmount=this.data.chunkAmount,this.bounds=64*this.chunkAmount,this.setGrids(),this.finishedLoadingChunks.clear(),this.createChunks())}setGrids(){this.triangleGrid.setDimensions(this.bounds,this.bounds,this.bounds,15,15,15)}rebuildTriangleOctree(){this.triangleGrid.clear(),this.chunksMap.forEach(e=>{for(let n=0;n<e.props.length;++n){let s=e.props[n];s.loaded=!1,s.loadGeometry(this,e)}})}triangleRaycastClosest(e,n,s,i,o,r){p0(os,e,n,s,i,o,r);let l=1,a=this.triangleGrid.queryRay(os.origin,os.dir,os.invDir);for(let c=0;c<a.length;++c){let f=a[c];l=Math.min(l,La(f[0],f[1],f[2],os.origin,os.dir,!1))}return l}triangleRaycastAny(e,n,s,i,o,r,l){p0(os,e,n,s,i,o,r);let a=this.triangleGrid.queryRay(os.origin,os.dir,os.invDir);for(let c=0;c<a.length;++c){let f=a[c];if(La(f[0],f[1],f[2],os.origin,os.dir,l)<1)return!0}return!1}raycastEnvironmentClosest(e,n,s,i,o,r){let l=this.getHeight(e,s)>n,a=this.triangleRaycastClosest(e,n,s,i,o,r);a<1&&(i*=a,o*=a,r*=a);let c=0,f=0,u=.1;if(l)f=1;else for(;c<100&&f<1;){let p=f+u,g=e+i*p,v=n+o*p,_=s+r*p,b=this.getHole(e,s)?0:this.getHeight(g,_),y=v-b;y<0?y>-.05?(f+=u,c=100):u*=.5:f+=u,c++}return Math.min(f,a,1)}raycastEnvironmentAny(e,n,s,i,o,r,l){let a=Math.sqrt(i*i+o*o+r*r),c=3/a,f=i*c,u=o*c,p=r*c,g=e,v=n+l,_=s,b=Math.floor(a/3),y=0;for(;y<b;)if(++y,g+=f,v+=u,_+=p,this.getHeight(g,_)>v)return!0;return this.triangleRaycastAny(e,n,s,i,o,r,!0)}raycastEnvironmentHeight(e,n,s,i,o){let l=this.getHole(e,n)?0:this.getHeight(e,n),a=0;s>l&&(o!==void 0&&it(o,this.getNormal(e,n)),a=l);let c=s-i;eo[0]=eo[3]=e,eo[5]=eo[2]=n,eo[4]=s,eo[1]=i;let f=this.triangleGrid.queryAABB(eo);if(f.length>0){let u=1/0;p0(os,e,s,n,0,-c,0);for(let p=0;p<f.length;++p){let g=f[p],v=La(g[0],g[1],g[2],os.origin,os.dir,!1);if(v<u){u=v;let _=s-v*c;_>a&&(a=_,o!==void 0&&it(o,g[3]))}}}return a}addChunk(e){this.chunksMap.set(e.id,e),this.chunksArray.push(e)}removeChunk(e){this.chunksMap.delete(e.id),this.chunksArray.splice(this.chunksArray.indexOf(e),1)}};var MP=(t,e,n="")=>{Dc.update(s=>(s.push({text:t,icon:e,css:n}),s))};var Mz={2:"On cooldown.",3:"Can only be cast on enemy.",4:"Can only be cast on ally.",5:"Not enough mana.",6:"Out of range.",10:"Target is dead.",7:"Can't do that during movement.",8:"Can't cast while busy.",9:"You are incapacitated.",11:"Can't do that in combat.",12:"Can't cast this right now.",13:"Level difference is too big.",14:"Target is not in line of sight."},FP=new Map;FP.set(16,t=>{if(Wt("system",`You have learned ${C.items.book[t[0]].name} Lv. ${t[1]}`,!0),Mt(89),tn(24,100),t[1]===0&&Pt.get(t[0]).autoSkillbar){let e=le.skillbarsettings[I.player.name].findIndex(n=>n.id===-1);e>=0&&ws[e].update(n=>(n.id=t[0],n))}}).set(15,t=>{I.player.skills.add(t[0],_s(t[2]),_s(t[3]),t[1])}).set(17,t=>{I.player.skills.remove(t[0])}).set(18,t=>{I.player.skills.updateSkillsLearned(t)}).set(19,t=>{Rc.set(no(t,0))}).set(1,t=>{Ar.set({type:"error",text:Mz[t[0]]})}).set(20,t=>{I.player.setExp(t[1]),le.chat[0]&&Wt("exp",`Gained ${t[0]} experience. ${I.player.exp}/${er(I.player.level)}`,!0),Gg(t[0])}).set(21,t=>{I.player.setExp(t[1]),Wt("error",`Lost ${t[0]} experience. ${I.player.exp}/${er(I.player.level)}`,!0)}).set(22,t=>{I.player.setExp(t[0])}).set(45,t=>{let e=I.entity(t[1]);Mt(104),e&&wA(it([0,0,0],e.visualPosition),t[0]),le.chat[11]&&Wt("fame",`Gained $fm${t[0]} fame ${e?"from "+e.name:""}`,!0)}).set(46,t=>{le.chat[11]&&Wt("fame",`Lost $fm${t[0]} fame.`,!0)}).set(47,t=>{Mt(104),le.chat[11]&&Wt("fame",`Gained $fm${t[0]} salary from the war.`,!0)}).set(48,t=>{Mt(105),le.chat[11]&&Wt("fame",`War: Gained $fm${t[0]} spoils of war (Fight ${t[1]>0?"Victory!":"Loss!"}).`,!0)}).set(49,t=>{Mt(105),le.chat[11]&&Wt("fame",`Obelisk: Captured obelisk for $fm${t[0]} and $m${t[2]}.`,!0),I.player.inventory.setMedals(t[1],t[2],1)}).set(50,t=>{Oi.set(),$i.set(!1),t[0]===1&&Wt("system","War: You have left the war due to inactivity.",!0)}).set(23,t=>{let e=I.getEntityById(t[0]);e&&e.interact(t)}).set(24,t=>{zi.set(void 0)}).set(25,t=>{Wt("system",no(t,0),!0)}).set(26,t=>{Wt("error",no(t,0),!0)}).set(52,t=>{let e=no(t,1);ka(C.ui.party.summon,C.ui.party.onSummon.replace("$1",e),[{text:C.ui.accept,nocombat:!0,remaining:20,fun:()=>{xt("summonaccept",e)}},{text:C.ui.decline,fun:()=>{}}])}).set(27,t=>{let e=no(t,1);ka(C.ui.party.invite,C.ui.party.onInvite.replace("$1",e),[{text:C.ui.accept,fun:()=>{xt("partyaccept",t[0]+"")}},{text:C.ui.decline,fun:()=>{xt("partydecline",t[0]+"")}}])}).set(29,t=>{I.player.inventory.setItem(t[0],t[1],t[2])}).set(30,t=>{I.player.inventory.removeItem(t[0],t[1])}).set(31,t=>{I.player.inventory.setGold(t[0],t[1],t[2])}).set(32,t=>{I.player.inventory.setMedals(t[0],t[1],t[2])}).set(33,t=>{qo.set(t[0]),iu(t[0],t[1],12,"$sp")}).set(34,t=>{ap.set(t[0]==0?void 0:t[0]-1)}).set(51,t=>{cp.set(t[0]==0?void 0:t[0]-1)}).set(35,t=>{ai.set(t[0]),t[0]&&Mt(106)}).set(36,t=>{pp.set(t.pop()),Fz(t,ia)}).set(37,t=>{Pr.update(e=>!e),Wt("inv",C.ui.merchant.auctioncancel,!0)}).set(38,t=>{let e=t.slice(2),n=[],s=[],i=[],o=[],r=[n,i,s],l=0,a=0,c=n;for(let f=0;f<e.length;f++)if(a===0)a=e[f],c=r[l],++l;else{let u=new ki(e[f]);o.push(u),c.push(u),--a}mp.set({self:n,other:s,nonOrAcc:i,all:o}),t[0]&&Mt(107),Vs.set({gold:t[1]})}).set(39,t=>{Vs.set({gold:t[0]})}).set(40,t=>{Vs.set(!1)}).set(41,t=>{Ys.set(!0),Mt(108),tn(22,100)}).set(42,t=>{Ys.set(!1)}).set(43,t=>{Ni.set(!0)}).set(44,t=>{Ni.set(!1)}).set(54,t=>{let e=I.entity(t[0]);e!==void 0&&(e.party=1)}).set(55,t=>{window.open("/leaderboards?mode=1&kill="+t[0],"_blank")}).set(56,t=>{md()}).set(53,t=>{let e=t[0];e<1e3&&e>0&&Ar.set({type:"error",timer:500,text:e}),e<=5&&e>0?Mt(109):e===0?Mt(110):e===1e3?Mt(111):e===2e3&&Mt(112)});var Fz=(t,e)=>{e.update(n=>(n.length=0,t.forEach(s=>{n.push(new ki(s))}),n))},CP=(t,e)=>{I.player&&FP.get(t)(e)},SP=new Map;SP.set(0,(t,e,n)=>{}).set(1,(t,e,n)=>{I.removeEntity(t)}).set(2,(t,e,n)=>{e[1]>0&&e[1]!==t.target&&t.visual&&t.type!==0&&t.visual.onAggro(),t===I.player&&ig(e[1])}).set(3,(t,e,n)=>{for(let s=1;s<e.length;s+=2)t.stats.setResource(e[s],e[s+1])}).set(6,(t,e,n)=>{for(let s=1;s<e.length;s+=2)t.stats.setResource(e[s],e[s+1])}).set(4,(t,e,n)=>{for(let s=1;s<e.length;s+=2)t.stats.setStat(e[s],e[s+1])}).set(5,(t,e,n)=>{if(t==I.player&&(tn(6,100),t.skills.cd(e[1],I.time,_s(e[2])),e[5]>0&&t.skills.globalCd(_s(e[4]),_s(e[5]))),!n&&t.visual&&!t.visual.inFog){let i=Pt.get(e[1]);(!i.castLen||!t.visual.currentAnim)&&i.fx.animCast&&t.visual.anim(i.fx.animCast),t.visual.onYell()}}).set(22,(t,e,n)=>{t.skills.startTimedCast(Pt.get(e[1]),_s(e[2]),e[3],_s(e[4])),e[5]>0&&t.skills.globalCd(_s(e[2]),_s(e[5]))}).set(23,(t,e,n)=>{t.skills.interruptTimedCast(!0,e[1]===1)}).set(24,(t,e,n)=>{t.skills.finishTimedCast(_s(e[1]))}).set(7,(t,e,n)=>{let s=e[1],i=e[2],o=I.getEntityById(e[3]),r=e[4],l=e[5],a=e[6],c=e[7];o!==void 0&&le.dpsmeterMode===0&&ud(o,s,i);let f=t===I.player,u=o===I.player;f?le.showIncomingDamage&&g2([-.3,-.3,.5],s,l,a,!0,0):u&&g2(t.visualPosition,s,l,a,!1,2),l>0&&t.stats.changeResource(6,-s),c>0&&(t.stats.refreshCombatTimer(I.time,c),o&&o.stats.refreshCombatTimer(I.time,c));let p=Pt.get(i);if(!n&&l>0&&t.visual&&!t.visual.inFog){let g=r>0&&yr.has(r)?yr.get(r).effect.transform:o&&o.visual&&o.visual.transform,v=t.visual.transform;o&&o.visual&&p.fx.animImpact&&o.visual.anim(p.fx.animImpact,!1,t.id),l!==1?(t.visual.onHurt(s/t.stats.getStat(6),l),g&&P2(p,g,v,t.radius,u?1:0)):g&&(p.fx.effectDirImpact||p.fx.animImpact)&&PP(13,g,v,t.radius,u?1:0)}}).set(8,(t,e,n)=>{let s=I.getEntityById(e[3]);s!==void 0&&le.dpsmeterMode===1&&ud(s,e[1],e[2]),s&&e[5]>0&&s.stats.refreshCombatTimer(I.time,e[5]);let i=t===I.player,o=s===I.player;i?le.showIncomingHeal&&v2([.3,-.3,.5],e[1],e[4],!0,0):o&&v2(t.visualPosition,e[1],e[4],!1,2),t.stats.changeResource(6,e[1]);let r=Pt.get(e[2]);!n&&s&&s.visual&&t.visual&&!t.visual.inFog&&P2(r,s.visual.transform,t.visual.transform,t.radius,i||o?1:0)}).set(9,(t,e,n)=>{t.stats.changeResource(7,e[1]);let s=I.getEntityById(e[3]),i=t===I.player;i&&le.showIncomingHeal&&xA([.35,-.2,.5],e[1],e[4],!0,0);let o=Pt.get(e[2]);!n&&s&&s.visual&&t.visual&&!t.visual.inFog&&!s.visual.inFog&&P2(o,s.visual.transform,t.visual.transform,t.radius,i?1:0)}).set(10,(t,e,n)=>{e[1]==0?t.stats.alive&&(t.stats.die(),t==I.player?ka(C.ui.death.death,C.ui.death.deathmsg,[{text:C.ui.death.respawn,blockedTime:Math.max(0,Math.ceil(e[2]-I.time)+1),fun:()=>{xt("respawn","")}}]):I.player&&t.id==qn&&tn(7,100)):t.stats.alive||t.stats.respawn()}).set(11,(t,e,n)=>{t.setFaction(e[1])}).set(14,(t,e,n)=>{t.setLevel(e[1])}).set(16,(t,e,n)=>{t.setClass(e[1])}).set(12,(t,e,n)=>{t.setName(no(e,1))}).set(13,(t,e,n)=>{t.setClan(e.length>2?no(e,2):void 0,e[1])}).set(15,(t,e,n)=>{if(t.setLevel(e[1]),le.chat[6]){let s=`${t==I.player?"You":Cz(e[0])} leveled up to ${e[1]}!`;Wt("lvlup",s),t==I.player&&(tn(16,100),Pt.forEach(i=>{i.class===I.player.class&&i.minlevel===e[1]&&(tn(19,100),MP(`<span class=textprimary><b class=textgreen>${C.items.book[i.id].name}</b><br>Skill book available at the Trader!</span>`,`skills/${i.id}.${Gn}`,"border primary"))}))}t.visual&&!t.visual.inFog&&wi(26,t.visual.transform,t==I.player?1:0,!1)}).set(17,(t,e,n)=>{t.buffs.setBuff(e[1],e[2],e[3],_s(e[4]),_s(e[5]),e[6],e[7],e.length>8?e.slice(8):void 0)}).set(19,(t,e,n)=>{e[2]===I.playerId&&kA(t.visualPosition,2,!1)}).set(18,(t,e,n)=>{t.buffs.removeBuff(e[1],e[2])}).set(20,(t,e,n)=>{let s=Pt.get(e[1]),i=new kt(I.time,_s(e[4])-I.time+.2);l8(e[0],e[2],s,e[3],i)}).set(21,(t,e,n)=>{let s=Pt.get(e[1]),i=e[2],o=_s(e[3])-I.time,r=new kt(I.time,o),l=4,a=e.length-l,c=a>6?2+(a-6)/4:2,f=[],u=[];for(let p=l;p<l+c*3;p+=3)f.push([od(e[p],6400),od(e[p+1],6400),od(e[p+2],6400)]);if(c>2)for(let p=l+c*3;p<e.length;++p)u.push(e[p]/65535);a8(t.id,f,u,s,i,r)}).set(25,(t,e,n)=>{t.setParty(e[1],e[2])}).set(26,(t,e,n)=>{t.hasInfo===!1&&t.setDropInfo(e[1],e[2],e[3],e[4],e[5])}).set(27,(t,e,n)=>{t.setNodeInfo(e[1],e[2],e[3])}).set(28,(t,e,n)=>{t.setPosLock(e[1],e[2],e[3])});var AP=(t,e,n)=>{let s=I.getEntityById(e[0]);s===void 0||SP.get(t)(s,e,n)},Cz=t=>{let e=I.getEntityById(t);return`${t>0?e?e.name:"unknown":"nobody"}`},PP=(t,e,n,s,i)=>{let o=wi(t,on(),i,!0);Fp(o.transform,n,e,s),qt(o.transform,!1)},P2=(t,e,n,s,i)=>{if(t.fx.effectDirImpact&&PP(t.fx.effectDirImpact,e,n,s,i),t.fx.effectImpact){let o=wi(t.fx.effectImpact,on(),i,!0);it(o.transform.position,n.position),qt(o.transform,!1)}t.fx.effectTarget&&wi(t.fx.effectTarget,n,i,!1)};var Sz=[zi,ai,Vs,Ni,Ys],Az=[Kl,ia,oo],Pz=[Bi,Ui],TP=()=>{Pz.forEach(t=>t.update(e=>(e.visible=!1,e))),Qn.update(t=>(t.membercount=0,t.role=0,le.partyinfo=t,t)),Sz.forEach(t=>t.set()),Az.forEach(t=>t.set([]))};var J0=class extends Z0{constructor(){super(),this.smoothtime=0,this.state=0,this.playerId=0,this.removePlayer(),this.netTimeoutTimer=new kt,this.chunkCache=[],Un("close",()=>{this.onDisconnect()}),this.netData=[],Un(Ft.serverEntityDelta.header,e=>{this.netData.push(Ft.serverEntityDelta.decode(e))}),Un(Ft.ping.header,e=>{w3(Ft.ping.decode(e))}),Un(Ft.serverChangeWorld.header,e=>{Rr.set(Ft.serverChangeWorld.decode(e).world)}),Un(Ft.serverQueue.header,e=>{this.setState(1,"Queue Position: "+Ft.serverQueue.decode(e).pos)})}setState(e,n=""){this.state===2&&e===4&&VA(this),this.state=e,xs.set(e!==4?n:!1)}handleEntityCreation(e){for(let n=0,s=e.log.length;n<s;++n){let i=e.log[n];i.type===0&&(this.isEntityIdTaken(i.data[0])||this.addEntity(this.createEntity(i.data[1],i.data[0],{creature:a1.get(i.data[2])})))}}handleEntityInput(e){for(let n=0;n<e.inputs.length;++n){let s=e.inputs[n],i=this.entity(s.id);i!==void 0&&(C3(i.steer,s.steer),i.setRot(s.rot,!0),i.setJump(s.jump),i.setSpeed(s.speed))}}handleEntityMovements(e){for(let n=0;n<e.movements.length;++n){let s=e.movements[n],i=this.entity(s.id);if(i!==void 0){let o=e.inputs[n];i.handleMovementData(s,o)}}}handleEntityLog(e){for(let s=0,i=e.log.length;s<i;++s)AP(e.log[s].type,e.log[s].data,!1)}handlePersonalLog(e){for(let n=0,s=e.logPersonal.length;n<s;++n)CP(e.logPersonal[n].type,e.logPersonal[n].data)}pollNetData(e){let n=this.netData[0];if(n!==void 0)return Math.abs(n.tickId-e)>1&&(e=this.setTimeFromTickId(n.tickId)),n.tickId<=e?(this.netData.shift(),n):void 0}tickDelta(e,n){let s=this.time+n;for(let i=this.entities.array.length-1;i>=0;--i){let o=this.entities.array[i];o.preDelta(e,s,this),o.tickDelta(e,s,this),o.postDelta(e,s,this)}}tickFixed(e,n){let s=this.pollNetData(n);if(s!==void 0&&(this.handleEntityCreation(s),this.handleEntityInput(s),this.handleEntityLog(s),this.handlePersonalLog(s),this.handleEntityMovements(s)),this.state>2)for(let i=this.entities.array.length-1;i>=0;--i){let o=this.entities.array[i],r=this.getChunkFromWorld(o.pos[0],o.pos[2]);r!==void 0&&r.state>=5&&(o.preFixed(e,this.time,this,1),o.tickFixed(e,this.time,this,1),o.postFixed(e,this.time,this,1))}this.handleNetTimeouts()}tick(e){for(this.netData.length>5&&(this.accum+=(this.netData.length-5)*this.timestep),e=Math.min(e,1),this.accum+=e;this.accum>this.timestep;)this.accum-=this.timestep,this.setTimeFromTickId(this.tickId+1),this.tickFixed(this.timestep,this.tickId);this.setSmoothTime(e),this.state>2?(this.tickDelta(e,this.accum),x3()):this.player&&it(Gt.position,this.player.pos),this.player&&this.manageChunks(e)}handleNetTimeouts(){if(this.player&&(this.netTimeoutTimer.done(this.time)||this.time<this.netTimeoutTimer.start)){this.netTimeoutTimer.reset(this.time-.5,1);for(let e=this.entities.array.length-1;e>=0;e--){let n=this.entities.array[e];n!==this.player&&(Kn(n.pos,this.player.pos)<14400?n.netDeletion.reset(this.time,2):n.netDeletion.end>0&&n.netDeletion.done(this.time)&&(this.removeEntity(n),n.id===this.player.target&&this.player.setTarget(0)))}}}removeEntity(e){let n=super.removeEntity(e);return n&&this.state>2&&Zh(e),n}load(e,n,s){this.destroy(),super.load(e,n),this.playerId=s,this.setState(2,"Loading World")}parse(e){super.parse(e),_A(this,!e)}onDisconnect(){_g(),this.netData.length=0,this.setState(0,"Loading World")}destroy(){this.setState(0,"Loading World");for(let e=0;e<this.chunksArray.length;e++){let n=this.chunksArray[e];this.returnCachedChunk(n),d2(n)}this.chunksMap.clear(),this.chunksArray.length=0;for(let e=this.entities.array.length-1;e>=0;e--)this.removeEntity(this.entities.array[e]);this.data=void 0,this.bounds=1,this.triangleGrid.clear(),bA(this),LA(this)}setPlayer(e){this.player=e,Lc.set(!0),TP()}removePlayer(e){this.player===e&&(this.player=void 0,this.playerId=0,Lc.set(!1),Oi.set(),$i.set(!1))}setSmoothTime(e){let n=this.smoothtime-this.time;Math.abs(n)>1?this.smoothtime=this.time:n>.05?this.smoothtime+=e*.5:n<-.05?this.smoothtime+=e*2:this.smoothtime+=e}getInteriorLight(e,n){let s=this.triangleGrid.queryAABB(n);for(let i=0;i<s.length;++i)if(s[i].length>4){Lr(e,s[i][4]);return}es(e,0,0,0,0)}createChunks(){}createCachedChunk(e,n,s){if(this.chunkCache.length){let i=this.chunkCache.pop();return p2(i,e,n,s,this.chunkAmount),i}else{let i=iA();return p2(i,e,n,s,this.chunkAmount),i}}returnCachedChunk(e){this.chunkCache.push(e)}manageChunks(e){ZC(e);let n=Math.min(Math.max(0,Iv),this.chunkAmount-1),s=Math.min(Math.max(0,Vv),this.chunkAmount-1),i=Math.min(Math.max(0,Lv),this.chunkAmount-1),o=Math.min(Math.max(0,qv),this.chunkAmount-1),r=[];for(let u=n;u<=s;++u)for(let p=i;p<=o;++p){let g=this.chunkAmount*p+u,v=(u-Ev)**2+(p-Dv)**2;r.push({x:u,z:p,id:g,priority:v})}r.sort((u,p)=>u.priority-p.priority);let l=0,a=!1,c=0;for(;l<r.length;){let u=r[l];if(c>10)break;if(this.chunksMap.has(u.id))this.chunksMap.get(u.id).state<3&&(u.priority<9&&(a=!0),c++);else{let p=this.createCachedChunk(u.id,u.x,u.z);this.addChunk(p),p.state=1,u.priority<9&&(a=!0),c++}++l}let f=[];for(let u=0;u<this.chunksArray.length;++u){let p=this.chunksArray[u];zv&&(p.x+5<n||p.z+5<i||p.x-5>s||p.z-5>o?f.push(p):m2(p)),rA(p,this)}for(let u=f.length-1;u>=0;u--){let p=f[u];this.returnCachedChunk(p),this.removeChunk(p),d2(p)}a!==(this.state!==4)&&this.setState(a?3:4,"Loading World")}};window.onload=async()=>{console.log("Hordes 0.50.8593 Live"),await m1();let t=await fetch("data/game/game.bin?v=8593107");n1(_a.gamedata.decode(new Uint8Array(await t.arrayBuffer()))),py(),mA(),TA(),new eA({target:document.querySelector("body")}),y3($A,NA),m3(new J0({})),M2(!0),DP()};var EP=0,DP=()=>{let t=yf(),e=(t-(EP||1e3/60))/1e3;EP=t,jA(e,t),requestAnimationFrame(DP)};})();
