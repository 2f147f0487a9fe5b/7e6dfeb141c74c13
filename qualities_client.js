(()=>{var m7=Object.defineProperty;var Kn=(t,e)=>{for(var n in e)m7(t,n,{get:e[n],enumerable:!0})};function ae(){}var Er=t=>t;function Zl(t,e){for(let n in e)t[n]=e[n];return t}function Ch(t){return t()}function sm(){return Object.create(null)}function rt(t){t.forEach(Ch)}function Os(t){return typeof t=="function"}function Be(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}var om;function at(t,e){return t===e?!0:(om||(om=document.createElement("a")),om.href=e,t===om.href)}function yn(t,e){return t!=t?e==e:t!==e}function o2(t){return Object.keys(t).length===0}function us(t,...e){if(t==null){for(let o of e)o(void 0);return ae}let n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function re(t,e,n){t.$$.on_destroy.push(us(e,n))}function Jl(t,e,n,o){if(t){let s=s2(t,e,n,o);return t[0](s)}}function s2(t,e,n,o){return t[1]&&o?Zl(n.ctx.slice(),t[1](o(e))):n.ctx}function Kl(t,e,n,o){if(t[2]&&o){let s=t[2](o(n));if(e.dirty===void 0)return s;if(typeof s=="object"){let i=[],r=Math.max(e.dirty.length,s.length);for(let l=0;l<r;l+=1)i[l]=e.dirty[l]|s[l];return i}return e.dirty|s}return e.dirty}function ea(t,e,n,o,s,i){if(s){let r=s2(e,n,o,i);t.p(r,s)}}function ta(t){if(t.ctx.length>32){let e=[],n=t.ctx.length/32;for(let o=0;o<n;o++)e[o]=-1;return e}return-1}function Bi(t){return t??""}function Xe(t,e,n){return t.set(n),e}var i2=typeof window<"u",im=i2?()=>window.performance.now():()=>Date.now(),Lc=i2?t=>requestAnimationFrame(t):ae;var na=new Set;function r2(t){na.forEach(e=>{e.c(t)||(na.delete(e),e.f())}),na.size!==0&&Lc(r2)}function rm(t){let e;return na.size===0&&Lc(r2),{promise:new Promise(n=>{na.add(e={c:t,f:n})}),abort(){na.delete(e)}}}var qc=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var lm=class t{_listeners="WeakMap"in qc?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,n){return this._listeners.set(e,n),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(e=>{for(let n of e)t.entries.set(n.target,n),this._listeners.get(n.target)?.(n)}))}};lm.entries="WeakMap"in qc?new WeakMap:void 0;var l2=!1;function a2(){l2=!0}function c2(){l2=!1}function d(t,e){t.appendChild(e)}function Sh(t){if(!t)return document;let e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function f2(t){let e=h("style");return e.textContent="/* empty */",d7(Sh(t),e),e.sheet}function d7(t,e){return d(t.head||t,e),e.sheet}function w(t,e,n){t.insertBefore(e,n||null)}function x(t){t.parentNode&&t.parentNode.removeChild(t)}function ot(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function h7(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function T(t){return document.createTextNode(t)}function Ne(){return T(" ")}function de(){return T("")}function H(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function u2(t){return function(e){e.target===this&&t.call(this,e)}}function p(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Gt(t){return t===""?null:+t}function m2(t){return Array.from(t.childNodes)}function G(t,e){e=""+e,t.data!==e&&(t.data=e)}function je(t,e){t.value=e??""}function Le(t,e,n,o){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,o?"important":"")}function Mn(t,e,n){for(let o=0;o<t.options.length;o+=1){let s=t.options[o];if(s.__value===e){s.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Co(t){let e=t.querySelector(":checked");return e&&e.__value}function $i(t,e,n){t.classList.toggle(e,!!n)}function Rc(t,e,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:o})}var am=class{is_svg=!1;e=void 0;n=void 0;t=void 0;a=void 0;constructor(e=!1){this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,n,o=null){this.e||(this.is_svg?this.e=h7(n.nodeName):this.e=h(n.nodeType===11?"TEMPLATE":n.nodeName),this.t=n.tagName!=="TEMPLATE"?n:n.content,this.c(e)),this.i(o)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)w(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(x)}};function p2(t){let e={};return t.childNodes.forEach(n=>{e[n.slot||"default"]=!0}),e}var cm=new Map,fm=0;function g7(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function v7(t,e){let n={stylesheet:f2(e),rules:{}};return cm.set(t,n),n}function zc(t,e,n,o,s,i,r,l=0){let a=16.666/o,c=`{
`;for(let b=0;b<=1;b+=a){let k=e+(n-e)*i(b);c+=b*100+`%{${r(k,1-k)}}
`}let f=c+`100% {${r(n,1-n)}}
}`,u=`__svelte_${g7(f)}_${l}`,m=Sh(t),{stylesheet:g,rules:v}=cm.get(m)||v7(m,t);v[u]||(v[u]=!0,g.insertRule(`@keyframes ${u} ${f}`,g.cssRules.length));let _=t.style.animation||"";return t.style.animation=`${_?`${_}, `:""}${u} ${o}ms linear ${s}ms 1 both`,fm+=1,u}function um(t,e){let n=(t.style.animation||"").split(", "),o=n.filter(e?i=>i.indexOf(e)<0:i=>i.indexOf("__svelte")===-1),s=n.length-o.length;s&&(t.style.animation=o.join(", "),fm-=s,fm||_7())}function _7(){Lc(()=>{fm||(cm.forEach(t=>{let{ownerNode:e}=t.stylesheet;e&&x(e)}),cm.clear())})}var Ui;function ai(t){Ui=t}function oa(){if(!Ui)throw new Error("Function called outside component initialization");return Ui}function Ph(t){oa().$$.before_update.push(t)}function Fn(t){oa().$$.on_mount.push(t)}function Bc(t){oa().$$.after_update.push(t)}function Tn(t){oa().$$.on_destroy.push(t)}function ci(){let t=oa();return(e,n,{cancelable:o=!1}={})=>{let s=t.$$.callbacks[e];if(s){let i=Rc(e,n,{cancelable:o});return s.slice().forEach(r=>{r.call(t,i)}),!i.defaultPrevented}return!0}}function fi(t,e){let n=t.$$.callbacks[e.type];n&&n.slice().forEach(o=>o.call(this,e))}var Ir=[];var qt=[],ia=[],Th=[],d2=Promise.resolve(),Eh=!1;function Ih(){Eh||(Eh=!0,d2.then(mm))}function Dh(){return Ih(),d2}function bn(t){ia.push(t)}function ms(t){Th.push(t)}var Ah=new Set,sa=0;function mm(){if(sa!==0)return;let t=Ui;do{try{for(;sa<Ir.length;){let e=Ir[sa];sa++,ai(e),b7(e.$$)}}catch(e){throw Ir.length=0,sa=0,e}for(ai(null),Ir.length=0,sa=0;qt.length;)qt.pop()();for(let e=0;e<ia.length;e+=1){let n=ia[e];Ah.has(n)||(Ah.add(n),n())}ia.length=0}while(Ir.length);for(;Th.length;)Th.pop()();Eh=!1,Ah.clear(),ai(t)}function b7(t){if(t.fragment!==null){t.update(),rt(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(bn)}}function h2(t){let e=[],n=[];ia.forEach(o=>t.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),ia=e}var $c;function g2(){return $c||($c=Promise.resolve(),$c.then(()=>{$c=null})),$c}function Uc(t,e,n){t.dispatchEvent(Rc(`${e?"intro":"outro"}${n}`))}var pm=new Set,Ns;function we(){Ns={r:0,c:[],p:Ns}}function Me(){Ns.r||rt(Ns.c),Ns=Ns.p}function S(t,e){t&&t.i&&(pm.delete(t),t.i(e))}function E(t,e,n,o){if(t&&t.o){if(pm.has(t))return;pm.add(t),Ns.c.push(()=>{pm.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}else o&&o()}var v2={duration:0};function _2(t,e,n){let o={direction:"out"},s=e(t,n,o),i=!0,r,l=Ns;l.r+=1;let a;function c(){let{delay:f=0,duration:u=300,easing:m=Er,tick:g=ae,css:v}=s||v2;v&&(r=zc(t,1,0,u,f,m,v));let _=im()+f,b=_+u;bn(()=>Uc(t,!1,"start")),"inert"in t&&(a=t.inert,t.inert=!0),rm(k=>{if(i){if(k>=b)return g(0,1),Uc(t,!1,"end"),--l.r||rt(l.c),!1;if(k>=_){let y=m((k-_)/u);g(1-y,y)}}return i})}return Os(s)?g2().then(()=>{s=s(o),c()}):c(),{end(f){f&&"inert"in t&&(t.inert=a),f&&s.tick&&s.tick(1,0),i&&(r&&um(t,r),i=!1)}}}function Vh(t,e,n,o){let i=e(t,n,{direction:"both"}),r=o?0:1,l=null,a=null,c=null,f;function u(){c&&um(t,c)}function m(v,_){let b=v.b-r;return _*=Math.abs(b),{a:r,b:v.b,d:b,duration:_,start:v.start,end:v.start+_,group:v.group}}function g(v){let{delay:_=0,duration:b=300,easing:k=Er,tick:y=ae,css:F}=i||v2,A={start:im()+_,b:v};v||(A.group=Ns,Ns.r+=1),"inert"in t&&(v?f!==void 0&&(t.inert=f):(f=t.inert,t.inert=!0)),l||a?a=A:(F&&(u(),c=zc(t,r,v,b,_,k,F)),v&&y(0,1),l=m(A,b),bn(()=>Uc(t,v,"start")),rm(C=>{if(a&&C>a.start&&(l=m(a,b),a=null,Uc(t,l.b,"start"),F&&(u(),c=zc(t,r,l.b,l.duration,0,k,i.css))),l){if(C>=l.end)y(r=l.b,1-r),Uc(t,l.b,"end"),a||(l.b?u():--l.group.r||rt(l.group.c)),l=null;else if(C>=l.start){let M=C-l.start;r=l.a+l.d*k(M/l.duration),y(r,1-r)}}return!!(l||a)}))}return{run(v){Os(i)?g2().then(()=>{i=i({direction:v?"in":"out"}),g(v)}):g(v)},end(){u(),l=a=null}}}function me(t){return t?.length!==void 0?t:Array.from(t)}function b2(t,e){t.d(1),e.delete(t.key)}function Hn(t,e){E(t,1,1,()=>{e.delete(t.key)})}function En(t,e,n,o,s,i,r,l,a,c,f,u){let m=t.length,g=i.length,v=m,_={};for(;v--;)_[t[v].key]=v;let b=[],k=new Map,y=new Map,F=[];for(v=g;v--;){let D=u(s,i,v),$=n(D),V=r.get($);V?o&&F.push(()=>V.p(D,e)):(V=c($,D),V.c()),k.set($,b[v]=V),$ in _&&y.set($,Math.abs(v-_[$]))}let A=new Set,C=new Set;function M(D){S(D,1),D.m(l,f),r.set(D.key,D),f=D.first,g--}for(;m&&g;){let D=b[g-1],$=t[m-1],V=D.key,z=$.key;D===$?(f=D.first,m--,g--):k.has(z)?!r.has(V)||A.has(V)?M(D):C.has(z)?m--:y.get(V)>y.get(z)?(C.add(V),M(D)):(A.add(z),m--):(a($,r),m--)}for(;m--;){let D=t[m];k.has(D.key)||a(D,r)}for(;g;)M(b[g-1]);return rt(F),b}function dm(t,e){let n={},o={},s={$$scope:1},i=t.length;for(;i--;){let r=t[i],l=e[i];if(l){for(let a in r)a in l||(o[a]=1);for(let a in l)s[a]||(n[a]=l[a],s[a]=1);t[i]=l}else for(let a in r)s[a]=1}for(let r in o)r in n||(n[r]=void 0);return n}function hm(t){return typeof t=="object"&&t!==null?t:{}}var y7=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],k7=new Set([...y7]);function ps(t,e,n){let o=t.$$.props[e];o!==void 0&&(t.$$.bound[o]=n,n(t.$$.ctx[o]))}function J(t){t&&t.c()}function Q(t,e,n){let{fragment:o,after_update:s}=t.$$;o&&o.m(e,n),bn(()=>{let i=t.$$.on_mount.map(Ch).filter(Os);t.$$.on_destroy?t.$$.on_destroy.push(...i):rt(i),t.$$.on_mount=[]}),s.forEach(bn)}function Z(t,e){let n=t.$$;n.fragment!==null&&(h2(n.after_update),rt(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function w7(t,e){t.$$.dirty[0]===-1&&(Ir.push(t),Ih(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Pe(t,e,n,o,s,i,r=null,l=[-1]){let a=Ui;ai(t);let c=t.$$={fragment:null,ctx:[],props:i,update:ae,not_equal:s,bound:sm(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:sm(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};r&&r(c.root);let f=!1;if(c.ctx=n?n(t,e.props||{},(u,m,...g)=>{let v=g.length?g[0]:m;return c.ctx&&s(c.ctx[u],c.ctx[u]=v)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](v),f&&w7(t,u)),m}):[],c.update(),f=!0,rt(c.before_update),c.fragment=o?o(c.ctx):!1,e.target){if(e.hydrate){a2();let u=m2(e.target);c.fragment&&c.fragment.l(u),u.forEach(x)}else c.fragment&&c.fragment.c();e.intro&&S(t.$$.fragment),Q(t,e.target,e.anchor),c2(),mm()}ai(a)}var M7;typeof HTMLElement=="function"&&(M7=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(t,e,n){super(),this.$$ctor=t,this.$$s=e,n&&this.attachShadow({mode:"open"})}addEventListener(t,e,n){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let o=this.$$c.$on(t,e);this.$$l_u.set(e,o)}super.addEventListener(t,e,n)}removeEventListener(t,e,n){if(super.removeEventListener(t,e,n),this.$$c){let o=this.$$l_u.get(e);o&&(o(),this.$$l_u.delete(e))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(s){return()=>{let i;return{c:function(){i=h("slot"),s!=="default"&&p(i,"name",s)},m:function(a,c){w(a,i,c)},d:function(a){a&&x(i)}}}};if(await Promise.resolve(),!this.$$cn)return;let e={},n=p2(this);for(let s of this.$$s)s in n&&(e[s]=[t(s)]);for(let s of this.attributes){let i=this.$$g_p(s.name);i in this.$$d||(this.$$d[i]=Lh(i,s.value,this.$$p_d,"toProp"))}for(let s in this.$$p_d)!(s in this.$$d)&&this[s]!==void 0&&(this.$$d[s]=this[s],delete this[s]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});let o=()=>{this.$$r=!0;for(let s in this.$$p_d)if(this.$$d[s]=this.$$c.$$.ctx[this.$$c.$$.props[s]],this.$$p_d[s].reflect){let i=Lh(s,this.$$d[s],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[s].attribute||s):this.setAttribute(this.$$p_d[s].attribute||s,i)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(let s in this.$$l)for(let i of this.$$l[s]){let r=this.$$c.$on(s,i);this.$$l_u.set(i,r)}this.$$l={}}}attributeChangedCallback(t,e,n){this.$$r||(t=this.$$g_p(t),this.$$d[t]=Lh(t,n,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{this.$$cn||(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function Lh(t,e,n,o){let s=n[t]?.type;if(e=s==="Boolean"&&typeof e!="boolean"?e!=null:e,!o||!n[t])return e;if(o==="toAttribute")switch(s){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(s){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var Ce=class{$$=void 0;$$set=void 0;$destroy(){Z(this,1),this.$destroy=ae}$on(e,n){if(!Os(n))return ae;let o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{let s=o.indexOf(n);s!==-1&&o.splice(s,1)}}$set(e){this.$$set&&!o2(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var y2="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(y2);var ra=[];function te(t,e=ae){let n,o=new Set;function s(l){if(Be(t,l)&&(t=l,n)){let a=!ra.length;for(let c of o)c[1](),ra.push(c,t);if(a){for(let c=0;c<ra.length;c+=2)ra[c][0](ra[c+1]);ra.length=0}}}function i(l){s(l(t))}function r(l,a=ae){let c=[l,a];return o.add(c),o.size===1&&(n=e(s,i)||ae),l(t),()=>{o.delete(c),o.size===0&&n&&(n(),n=null)}}return{set:s,update:i,subscribe:r}}var Oc=te([]),eo=te({role:0,nearby:0,exprate:1,itemfind:1,queues:[],membercount:0}),la=te({parties:[],filterActivity:-1,showFull:!0,showAuto:!0}),Qo=te({flashing:!1,message:"",activity:0,listed:!1,applications:[]}),aa=te([]),dn=te(),ui=te([]),Dr=te({}),js=te(),gm=te(!1),k2=te(),x2=te(!1),So=te("Loading World"),Nc=te([]),Ro=te(""),Ws=te({}),Gs=te({}),jc=te([]),ca=te([]),In=te(),vm=te("auto"),Zo=te(0),fa=te(0),Oi=te(0),ua=te([]),ma=te({}),Ni=te({}),_m=te({current:0,max:1}),bm=te(),ym=te(),Wc=te(!1),km=te(0),xm=te([0,0]),mi=te(),Hs=te(),Ys=te(!1),Gc=te(new Map),ji=te(new Map),Hc=te(),Wi=te(),ds=te(),pa=te([]),hs=te(),wm=te(0),Vr=te(!1),Yc=te(!1),zo=te(),Mm=te({self:[],other:[],nonOrAcc:[],all:[]}),Jo=te(),Xs=te(),Gi=te(),da=te(),Hi=te({}),Xc=te({}),Fm=te({}),Cm=te({}),Sm=te(),ha=te(),Po=[],Lr=te(),pi=te(!1);function F7(t){let e;return{c(){e=h("div"),e.innerHTML='<div class="bounce1 svelte-twvoek"></div><div class="bounce2 svelte-twvoek"></div><div class="bounce3 svelte-twvoek"></div>',p(e,"class","spinner svelte-twvoek")},m(n,o){w(n,e,o)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}var qh=class extends Ce{constructor(e){super(),Pe(this,e,null,F7,yn,{})}},w2=qh;function Pm(t,{delay:e=0,duration:n=400,easing:o=Er}={}){let s=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:o,css:i=>`opacity: ${i*s}`}}function M2(t){let e,n,o,s,i,r;return n=new w2({}),{c(){e=h("div"),J(n.$$.fragment),o=h("h2"),s=T(t[0]),i=h("small"),i.innerHTML='<img alt="Hordes.io" class="svgicon" src="/data/ui/icon.svg?v=8738303"/> 0.51.8738 Live',Le(o,"margin-top","100px"),p(i,"class","version textgrey textcenter svelte-aoht7k"),p(e,"class","l-ui container svelte-aoht7k")},m(l,a){w(l,e,a),Q(n,e,null),d(e,o),d(o,s),d(e,i),r=!0},p(l,a){(!r||a&1)&&G(s,l[0])},i(l){r||(S(n.$$.fragment,l),r=!0)},o(l){E(n.$$.fragment,l),r=!1},d(l){l&&x(e),Z(n)}}}function C7(t){let e,n,o=t[0]&&M2(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[0]?o?(o.p(s,i),i&1&&S(o,1)):(o=M2(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function S7(t,e,n){let{active:o}=e;return t.$$set=s=>{"active"in s&&n(0,o=s.active)},[o]}var Rh=class extends Ce{constructor(e){super(),Pe(this,e,S7,C7,Be,{active:0})}},F2=Rh;function gs(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function C2(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function zh(t,e){let n=e[0],o=e[1],s=e[2],i=e[3],r=e[4],l=e[5],a=e[6],c=e[7],f=e[8],u=e[9],m=e[10],g=e[11],v=e[12],_=e[13],b=e[14],k=e[15],y=n*l-o*r,F=n*a-s*r,A=n*c-i*r,C=o*a-s*l,M=o*c-i*l,D=s*c-i*a,$=f*_-u*v,V=f*b-m*v,z=f*k-g*v,q=u*b-m*_,L=u*k-g*_,U=m*k-g*b,W=y*U-F*L+A*q+C*z-M*V+D*$;return W?(W=1/W,t[0]=(l*U-a*L+c*q)*W,t[1]=(s*L-o*U-i*q)*W,t[2]=(_*D-b*M+k*C)*W,t[3]=(m*M-u*D-g*C)*W,t[4]=(a*z-r*U-c*V)*W,t[5]=(n*U-s*z+i*V)*W,t[6]=(b*A-v*D-k*F)*W,t[7]=(f*D-m*A+g*F)*W,t[8]=(r*L-l*z+c*$)*W,t[9]=(o*z-n*L-i*$)*W,t[10]=(v*M-_*A+k*y)*W,t[11]=(u*A-f*M-g*y)*W,t[12]=(l*V-r*q-a*$)*W,t[13]=(n*q-o*V+s*$)*W,t[14]=(_*F-v*C-b*y)*W,t[15]=(f*C-u*F+m*y)*W,t):null}function Am(t,e,n){let o=e[0],s=e[1],i=e[2],r=e[3],l=e[4],a=e[5],c=e[6],f=e[7],u=e[8],m=e[9],g=e[10],v=e[11],_=e[12],b=e[13],k=e[14],y=e[15],F=n[0],A=n[1],C=n[2],M=n[3];return t[0]=F*o+A*l+C*u+M*_,t[1]=F*s+A*a+C*m+M*b,t[2]=F*i+A*c+C*g+M*k,t[3]=F*r+A*f+C*v+M*y,F=n[4],A=n[5],C=n[6],M=n[7],t[4]=F*o+A*l+C*u+M*_,t[5]=F*s+A*a+C*m+M*b,t[6]=F*i+A*c+C*g+M*k,t[7]=F*r+A*f+C*v+M*y,F=n[8],A=n[9],C=n[10],M=n[11],t[8]=F*o+A*l+C*u+M*_,t[9]=F*s+A*a+C*m+M*b,t[10]=F*i+A*c+C*g+M*k,t[11]=F*r+A*f+C*v+M*y,F=n[12],A=n[13],C=n[14],M=n[15],t[12]=F*o+A*l+C*u+M*_,t[13]=F*s+A*a+C*m+M*b,t[14]=F*i+A*c+C*g+M*k,t[15]=F*r+A*f+C*v+M*y,t}function va(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function S2(t,e){let n=e[0],o=e[1],s=e[2],i=e[4],r=e[5],l=e[6],a=e[8],c=e[9],f=e[10];return t[0]=Math.sqrt(n*n+o*o+s*s),t[1]=Math.sqrt(i*i+r*r+l*l),t[2]=Math.sqrt(a*a+c*c+f*f),t}function P2(t){let e=t[0],n=t[1],o=t[2],s=t[4],i=t[5],r=t[6],l=t[8],a=t[9],c=t[10],f=e*e+n*n+o*o,u=s*s+i*i+r*r,m=l*l+a*a+c*c;return Math.sqrt(Math.max(f,u,m))}function Tm(t,e){let n=e[0]+e[5]+e[10],o=0;return n>0?(o=Math.sqrt(n+1)*2,t[3]=.25*o,t[0]=(e[6]-e[9])/o,t[1]=(e[8]-e[2])/o,t[2]=(e[1]-e[4])/o):e[0]>e[5]&&e[0]>e[10]?(o=Math.sqrt(1+e[0]-e[5]-e[10])*2,t[3]=(e[6]-e[9])/o,t[0]=.25*o,t[1]=(e[1]+e[4])/o,t[2]=(e[8]+e[2])/o):e[5]>e[10]?(o=Math.sqrt(1+e[5]-e[0]-e[10])*2,t[3]=(e[8]-e[2])/o,t[0]=(e[1]+e[4])/o,t[1]=.25*o,t[2]=(e[6]+e[9])/o):(o=Math.sqrt(1+e[10]-e[0]-e[5])*2,t[3]=(e[1]-e[4])/o,t[0]=(e[8]+e[2])/o,t[1]=(e[6]+e[9])/o,t[2]=.25*o),t}function Em(t,e,n,o){let s=e[0],i=e[1],r=e[2],l=e[3],a=s+s,c=i+i,f=r+r,u=s*a,m=s*c,g=s*f,v=i*c,_=i*f,b=r*f,k=l*a,y=l*c,F=l*f,A=o[0],C=o[1],M=o[2];return t[0]=(1-(v+b))*A,t[1]=(m+F)*A,t[2]=(g-y)*A,t[3]=0,t[4]=(m-F)*C,t[5]=(1-(u+b))*C,t[6]=(_+k)*C,t[7]=0,t[8]=(g+y)*M,t[9]=(_-k)*M,t[10]=(1-(u+v))*M,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function A2(t,e,n,o,s){let i=1/Math.tan(e/2),r=1/(o-s);return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(s+o)*r,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*s*o*r,t[15]=0,t}function T2(t,e,n,o,s,i,r){let l=1/(e-n),a=1/(o-s),c=1/(i-r);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*l,t[13]=(s+o)*a,t[14]=(r+i)*c,t[15]=1,t}function Bh(t,e,n,o){let s=e[0],i=e[1],r=e[2],l=o[0],a=o[1],c=o[2],f=s-n[0],u=i-n[1],m=r-n[2],g=f*f+u*u+m*m;g>0&&(g=1/Math.sqrt(g),f*=g,u*=g,m*=g);let v=a*m-c*u,_=c*f-l*m,b=l*u-a*f;return g=v*v+_*_+b*b,g>0&&(g=1/Math.sqrt(g),v*=g,_*=g,b*=g),t[0]=v,t[1]=_,t[2]=b,t[3]=0,t[4]=u*b-m*_,t[5]=m*v-f*b,t[6]=f*_-u*v,t[7]=0,t[8]=f,t[9]=u,t[10]=m,t[11]=0,t[12]=s,t[13]=i,t[14]=r,t[15]=1,t}function E2(t,e){return t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0),t}function ho(t){let e=t[0],n=t[1],o=t[2];return Math.sqrt(e*e+n*n+o*o)}function st(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function X(t,e,n,o){return t[0]=e,t[1]=n,t[2]=o,t}function go(t,e){return t[0]=e,t[1]=e,t[2]=e,t}function Bn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function no(t,e,n,o){return t[0]+=e,t[1]+=n,t[2]+=o,t}function Zt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function gn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function on(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t}function Rr(t,e){let n=e[0]-t[0],o=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(n*n+o*o+s*s)}function oo(t,e){let n=e[0]-t[0],o=e[1]-t[1],s=e[2]-t[2];return n*n+o*o+s*s}function Qc(t){let e=t[0],n=t[1],o=t[2];return e*e+n*n+o*o}function Im(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function to(t,e){let n=e[0],o=e[1],s=e[2],i=n*n+o*o+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function hn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ko(t,e,n){let o=e[0],s=e[1],i=e[2],r=n[0],l=n[1],a=n[2];return t[0]=s*a-i*l,t[1]=i*r-o*a,t[2]=o*l-s*r,t}function _a(t,e,n,o){let s=e[0],i=e[1],r=e[2];return t[0]=s+o*(n[0]-s),t[1]=i+o*(n[1]-i),t[2]=r+o*(n[2]-r),t}function Ao(t,e,n){let o=e[0],s=e[1],i=e[2],r=n[3]*o+n[7]*s+n[11]*i+n[15];return r=r||1,t[0]=(n[0]*o+n[4]*s+n[8]*i+n[12])/r,t[1]=(n[1]*o+n[5]*s+n[9]*i+n[13])/r,t[2]=(n[2]*o+n[6]*s+n[10]*i+n[14])/r,t}function zr(t,e,n,o,s){return t[0]=s[0]*e+s[4]*n+s[8]*o+s[12],t[1]=s[1]*e+s[5]*n+s[9]*o+s[13],t[2]=s[2]*e+s[6]*n+s[10]*o+s[14],t}function Dm(t,e,n,o,s){return t[0]=s[0]*e+s[4]*n+s[8]*o,t[1]=s[1]*e+s[5]*n+s[9]*o,t[2]=s[2]*e+s[6]*n+s[10]*o,t}function $h(t,e,n){let o=e[0],s=e[1],i=e[2],r=n[0],l=n[1],a=n[2],c=n[3],f=l*i-a*s,u=a*o-r*i,m=r*s-l*o,g=l*m-a*u,v=a*f-r*m,_=r*u-l*f,b=c*2;return f*=b,u*=b,m*=b,g*=2,v*=2,_*=2,t[0]=o+f+g,t[1]=s+u+v,t[2]=i+m+_,t}var UU=function(){let t=[0,0,0],e=[0,0,0];return function(n,o){st(t,n),st(e,o),to(t,t),to(e,e);let s=hn(t,e);return s>1?0:s<-1?Math.PI:Math.acos(s)}}();function I2(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Br(t,e,n){let o=Math.sin(n),s=Math.cos(n);return t[0]=e[2]*o+e[0]*s,t[1]=e[1],t[2]=e[2]*s-e[0]*o,t}function D2(t,e,n){let o=Math.sin(n),s=Math.cos(n);return t[0]=e[1]*o+e[0]*s,t[2]=e[1]*s-e[0]*o,t}function $r(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function so(t,e,n,o,s){return t[0]=e,t[1]=n,t[2]=o,t[3]=s,t}function V2(t,e){let n=e[0],o=e[1],s=e[2],i=e[3],r=n*n+o*o+s*s+i*i;return r>0&&(r=1/Math.sqrt(r)),t[0]=n*r,t[1]=o*r,t[2]=s*r,t[3]=i*r,t}function A7(t,e,n){n=n*.5;let o=Math.sin(n);return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=Math.cos(n),t}function Uh(t,e,n,o){let s=e[0],i=e[1],r=e[2],l=e[3],a=n[0],c=n[1],f=n[2],u=n[3],m,g,v,_,b;return g=s*a+i*c+r*f+l*u,g<0&&(g=-g,a=-a,c=-c,f=-f,u=-u),1-g>1e-6?(m=Math.acos(g),v=Math.sin(m),_=Math.sin((1-o)*m)/v,b=Math.sin(o*m)/v):(_=1-o,b=o),t[0]=_*s+b*a,t[1]=_*i+b*c,t[2]=_*r+b*f,t[3]=_*l+b*u,t}function T7(t,e){let n=e[0]+e[4]+e[8],o;if(n>0)o=Math.sqrt(n+1),t[3]=.5*o,o=.5/o,t[0]=(e[5]-e[7])*o,t[1]=(e[6]-e[2])*o,t[2]=(e[1]-e[3])*o;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);let i=(s+1)%3,r=(s+2)%3;o=Math.sqrt(e[s*3+s]-e[i*3+i]-e[r*3+r]+1),t[s]=.5*o,o=.5/o,t[3]=(e[i*3+r]-e[r*3+i])*o,t[i]=(e[i*3+s]+e[s*3+i])*o,t[r]=(e[r*3+s]+e[s*3+r])*o}return t}function Vm(t,e){let n=Math.sin(e[0]*.5),o=Math.cos(e[0]*.5),s=Math.sin(e[1]*.5),i=Math.cos(e[1]*.5),r=Math.sin(e[2]*.5),l=Math.cos(e[2]*.5);return t[0]=n*i*l+o*s*r,t[1]=o*s*l-n*i*r,t[2]=o*i*r-n*s*l,t[3]=o*i*l+n*s*r,t}var L2=V2;var QU=function(){let t=[0,0,0],e=[1,0,0],n=[0,1,0];return function(o,s,i){let r=hn(s,i);return r<-.999999?(Ko(t,e,s),ho(t)<1e-6&&Ko(t,n,s),to(t,t),A7(o,t,Math.PI),o):r>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(Ko(t,s,i),o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=1+r,L2(o,o))}}(),ZU=function(){let t=[0,0,0,1],e=[0,0,0,1];return function(n,o,s,i,r,l){return Uh(t,o,r,l),Uh(e,s,i,l),Uh(n,t,e,2*l*(1-l)),n}}(),JU=function(){let t=[1,0,0,0,1,0,0,0,1];return function(e,n,o,s){return t[0]=o[0],t[3]=o[1],t[6]=o[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],L2(e,T7(e,t))}}();var Oh=gs(),E7=()=>({parent:null,children:[],visible:!0,geometry:void 0,matrix:gs(),worldMatrix:gs(),position:[0,0,0],scale:[1,1,1],quaternion:[-0,-0,-0,1],rotation:[-0,-0,-0],matrixAutoUpdate:!1,matrixNeedsUpdate:!0,data:{}}),Cn=(t,e,n=!0)=>{n&&t.parent!==null&&e!==t.parent&&D7(t.parent,t,!1),t.parent=e,t.matrixNeedsUpdate=!0,n&&e&&I7(e,t,!1)},I7=(t,e,n=!0)=>{~t.children.indexOf(e)||t.children.push(e),n&&Cn(e,t,!1)},D7=(t,e,n=!0)=>{~t.children.indexOf(e)&&t.children.splice(t.children.indexOf(e),1),n&&Cn(e,null,!1)},Bt=(t,e)=>{if(!t.visible)return;let n=di(t),o=V7(t,e,n);t.children.forEach(s=>{s.visible&&Bt(s,o)})},di=t=>!t.matrixAutoUpdate&&!t.matrixNeedsUpdate?!1:(t.matrixNeedsUpdate=!1,Vm(t.quaternion,t.rotation),Em(t.matrix,t.quaternion,t.position,t.scale),!0),V7=(t,e,n)=>t.parent!==null?e||n?(Am(t.worldMatrix,t.parent.worldMatrix,t.matrix),!0):!1:n?(C2(t.worldMatrix,t.matrix),!0):!1,qm=(t,e,n,o)=>{let s=Zt([0,0,0],n.position,e.position);to(s,s),on(t.position,e.position,s,o),t.rotation[0]=0,t.rotation[1]=Math.atan2(s[0],s[2])+1.5,t.rotation[2]=Math.sin(-s[1])+1.5,Bt(t,!1)},Ur=(t,e,n=!1,o)=>{n?Bh(Oh,t.position,e,o):Bh(Oh,e,t.position,o),E2(t.rotation,Oh)},Lm=[],sn=()=>Lm.length>0?Lm.pop():E7(),vs=t=>{L7(t),Lm.indexOf(t)<0?Lm.push(t):console.log("tried returning transform that is already known")},L7=t=>{t.data={},t.geometry=void 0,t.visible=!0,t.matrixAutoUpdate=!1,X(t.position,0,0,0),X(t.scale,1,1,1),X(t.rotation,0,0,0),Cn(t,null,!0);for(let e=0;e<t.children.length;++e)Cn(t.children[e],null);t.children.length=0};var Rm=[0,0,0],Zc=(t=.1,e=100,n=45,o=1)=>{let s={near:t,far:e,fov:n,aspect:o,transform:sn(),projectionMatrix:gs(),viewMatrix:gs(),unprojectionViewMatrix:gs(),projectionViewMatrix:gs(),worldPosition:[0,0,0],frustum:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],frustumConstants:[0,0,0,0,0,0]};return s.transform.matrixAutoUpdate=!0,s},Jc=t=>{A2(t.projectionMatrix,t.fov*(Math.PI/180),t.aspect,t.near,t.far)},R2=(t,e,n,o,s)=>{T2(t.projectionMatrix,e,n,o,s,t.near,t.far)},Nh=t=>{va(t.worldPosition,t.transform.worldMatrix)},ba=(t,e)=>{Bt(t.transform,e),zh(t.viewMatrix,t.transform.worldMatrix),Am(t.projectionViewMatrix,t.projectionMatrix,t.viewMatrix),zh(t.unprojectionViewMatrix,t.projectionViewMatrix),Nh(t)};var hi=(t,e,n)=>{let o=t.unprojectionViewMatrix,s=n[0],i=n[1],r=o[3]*s+o[7]*i+o[11]*-1+o[15];return e[0]=(o[0]*s+o[4]*i+o[8]*-1+o[12])/r,e[1]=(o[1]*s+o[5]*i+o[9]*-1+o[13])/r,e[2]=(o[2]*s+o[6]*i+o[10]*-1+o[14])/r,e},zm=t=>{let e=t.projectionViewMatrix;X(t.frustum[0],e[3]-e[0],e[7]-e[4],e[11]-e[8]),X(t.frustum[1],e[3]+e[0],e[7]+e[4],e[11]+e[8]),X(t.frustum[2],e[3]+e[1],e[7]+e[5],e[11]+e[9]),X(t.frustum[3],e[3]-e[1],e[7]-e[5],e[11]-e[9]),X(t.frustum[4],e[3]-e[2],e[7]-e[6],e[11]-e[10]),X(t.frustum[5],e[3]+e[2],e[7]+e[6],e[11]+e[10]),t.frustumConstants[0]=e[15]-e[12],t.frustumConstants[1]=e[15]+e[12],t.frustumConstants[2]=e[15]+e[13],t.frustumConstants[3]=e[15]-e[13],t.frustumConstants[4]=e[15]-e[14],t.frustumConstants[5]=e[15]+e[14];for(let n=0;n<6;n++){let o=t.frustum[n],s=1/ho(o);gn(o,o,s),t.frustumConstants[n]*=s}},z2=(t,e,n)=>{st(Rm,e.bounds.center),Ao(Rm,Rm,n.worldMatrix);let o=e.bounds.radius*P2(n.worldMatrix);return jh(t,Rm,o)},jh=(t,e,n)=>{for(let o=0;o<6;o++)if(hn(t.frustum[o],e)+t.frustumConstants[o]<-n)return!1;return!0};var To=document.createElement("canvas"),j=To.getContext("webgl2",{depth:!0,stencil:!1,premultipliedAlpha:!1,alpha:!1,antialias:!1,powerPreference:"high-performance",preserveDrawingBuffer:!0}),Vn=document.createElement("canvas"),Eo=Vn.getContext("2d",{alpha:!0}),ya=j.vertexAttribDivisor.bind(j),$2=j.drawArraysInstanced.bind(j),U2=j.drawElementsInstanced.bind(j),O2=j.createVertexArray.bind(j),Bm=j.bindVertexArray.bind(j),q7=j.deleteVertexArray.bind(j),Wh=j.getExtension("EXT_texture_filter_anisotropic"),N2=j.getExtension("WEBGL_compressed_texture_s3tc"),tt={maxTextureUnits:j.getParameter(j.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxAnisotropy:j.getParameter(Wh.MAX_TEXTURE_MAX_ANISOTROPY_EXT),blendFunc:{src:j.ONE,dst:j.ZERO,srcAlpha:0,dstAlpha:0},blendEquation:{modeRGB:j.FUNC_ADD,modeAlpha:0},frontFace:j.CCW,depthFunc:j.LESS,cullFace:null,depthMask:!0,flipY:!1,framebuffer:null,viewport:{width:-1,height:-1},textureUnits:[],activeTextureUnit:0,width:0,height:0,currentGeometry:-1,currentProgram:-1},j2=(t,e)=>{tt.width=t,tt.height=e,To.width=t,To.height=e,Vn.width=t,Vn.height=e},Kc=(t,e)=>{tt.viewport.width===t&&tt.viewport.height===e||(tt.viewport.width=t,tt.viewport.height=e,j.viewport(0,0,t,e))},ef=t=>{tt[t]!==!0&&(j.enable(t),tt[t]=!0)},$m=t=>{tt[t]!==!1&&(j.disable(t),tt[t]=!1)},W2=(t,e,n,o)=>{tt.blendFunc.src===t&&tt.blendFunc.dst===e&&tt.blendFunc.srcAlpha===n&&tt.blendFunc.dstAlpha===o||(tt.blendFunc.src=t,tt.blendFunc.dst=e,tt.blendFunc.srcAlpha=n,tt.blendFunc.dstAlpha=o,n!==void 0?j.blendFuncSeparate(t,e,n,o):j.blendFunc(t,e))},G2=(t,e)=>{tt.blendEquation.modeRGB===t&&tt.blendEquation.modeAlpha===e||(tt.blendEquation.modeRGB=t,tt.blendEquation.modeAlpha=e,e!==void 0?j.blendEquationSeparate(t,e):j.blendEquation(t))},H2=t=>{tt.cullFace!==t&&(tt.cullFace=t,j.cullFace(t))},Y2=t=>{tt.frontFace!==t&&(tt.frontFace=t,j.frontFace(t))},Gh=t=>{tt.depthMask!==t&&(tt.depthMask=t,j.depthMask(t))},X2=t=>{tt.depthFunc!==t&&(tt.depthFunc=t,j.depthFunc(t))},tf=t=>{tt.activeTextureUnit!==t&&(tt.activeTextureUnit=t,j.activeTexture(j.TEXTURE0+t))},B2=({target:t=j.FRAMEBUFFER,buffer:e=null}={})=>{tt.framebuffer!==e&&(tt.framebuffer=e,j.bindFramebuffer(t,e))},Q2=t=>{t?(B2(t),Kc(t.width,t.height)):(B2(),Kc(tt.width,tt.height))},Hh=t=>{(!t||!t.depth)&&(ef(j.DEPTH_TEST),Gh(!0)),j.clear(j.COLOR_BUFFER_BIT|j.DEPTH_BUFFER_BIT)};var ka=`#version 300 es
in vec2 uv;
in vec2 position;
out vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = vec4(position, 0.0, 1.0);
}`;var Z2=[0,1,0],J2=[0,0,0],ht=Zc(.3,500,70),Yt=sn();Cn(ht.transform,Yt);X(ht.transform.position,0,0,-1);ht.transform.rotation[1]=Math.PI;Yt.matrixAutoUpdate=!0;function R7(t){let e;return{c(){e=h("div"),Le(e,"cursor",t[1])},m(n,o){w(n,e,o),t[2](e)},p(n,[o]){o&2&&Le(e,"cursor",n[1])},i:ae,o:ae,d(n){n&&x(e),t[2](null)}}}function z7(t,e,n){let o;re(t,vm,r=>n(1,o=r));let s;Fn(()=>{s.appendChild(To),s.appendChild(Vn)});function i(r){qt[r?"unshift":"push"](()=>{s=r,n(0,s)})}return[s,o,i]}var Yh=class extends Ce{constructor(e){super(),Pe(this,e,z7,R7,Be,{})}},K2=Yh;function eb(t){let e,n,o,s,i;return{c(){e=h("div"),n=h("img"),p(n,"class",o=Bi(t[2].css)+" svelte-fc7xg3"),at(n.src,s=t[2].img)||p(n,"src",s),p(e,"class",i="container border "+t[2].border+" svelte-fc7xg3"),Le(e,"top",t[1]+"px"),Le(e,"left",t[0]+"px")},m(r,l){w(r,e,l),d(e,n)},p(r,l){l&4&&o!==(o=Bi(r[2].css)+" svelte-fc7xg3")&&p(n,"class",o),l&4&&!at(n.src,s=r[2].img)&&p(n,"src",s),l&4&&i!==(i="container border "+r[2].border+" svelte-fc7xg3")&&p(e,"class",i),l&2&&Le(e,"top",r[1]+"px"),l&1&&Le(e,"left",r[0]+"px")},d(r){r&&x(e)}}}function B7(t){let e,n=t[2]&&t[0]&&t[1]&&eb(t);return{c(){n&&n.c(),e=de()},m(o,s){n&&n.m(o,s),w(o,e,s)},p(o,[s]){o[2]&&o[0]&&o[1]?n?n.p(o,s):(n=eb(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(o){o&&x(e),n&&n.d(o)}}}function $7(t,e,n){let o;re(t,In,l=>n(2,o=l));let s,i,r=l=>{(o||s||i)&&(o?(n(0,s=l.clientX-10),n(1,i=l.clientY-10)):(n(0,s=0),n(1,i=0)))};return Fn(()=>{document.addEventListener("mousemove",r,!1)}),Tn(()=>{document.removeEventListener("mousemove",r)}),[s,i,o]}var Xh=class extends Ce{constructor(e){super(),Pe(this,e,$7,B7,Be,{})}},tb=Xh;var nb=(t,e,n)=>n.items[t][t=="book"?Math.floor(e/5):e],ob=(t,e,n)=>nb(t,e,n).name+(t=="book"?" Lv. "+(e%5+1):""),sb=(t,e,n)=>nb(t,e,n).description;var Zs={};Kn(Zs,{activeWorld:()=>Or,alwaysShowLevel:()=>tp,ambienceVolume:()=>lf,anisotropy:()=>rf,audioVolume:()=>Gr,audioVolumeLowered:()=>Hr,bloom:()=>jm,buffCdFlashingDuration:()=>kf,buffCdFlashingInterval:()=>yf,buffcountParty:()=>wf,buffcountUnitframes:()=>xf,buffsHideIrrelevant:()=>wp,cameraZoom:()=>Hm,cdTextBuffs:()=>bp,cdTextSkills:()=>_p,charpanelOpen:()=>ki,chatbubbles:()=>rp,clanOpen:()=>_i,classColorBars:()=>op,combatTextPush:()=>np,command:()=>Qs,current:()=>fe,disableoffscreen:()=>Om,dpsmeterMode:()=>pf,dpsmeterOpen:()=>Zr,dpsmeterParty:()=>mf,dpsmeterTarget:()=>Jr,expmeterOpen:()=>uf,filteredChannels:()=>hf,fogpattern:()=>Gm,foliage:()=>of,fov:()=>jr,fxaa:()=>Um,inventoryCols:()=>Xr,inventoryOpen:()=>gi,invertMouseX:()=>Mp,invertMouseY:()=>Fp,itemProtectQuality:()=>_f,itemQualityFilter:()=>vf,itemQualityPercent:()=>fp,itemTypeFilter:()=>gf,itemmeterOpen:()=>ff,kbAltBack:()=>cb,kbAltForward:()=>ab,kbBack:()=>ub,kbCharacter:()=>_b,kbClan:()=>yb,kbForward:()=>ib,kbInventory:()=>bb,kbLeft:()=>fb,kbMap:()=>gb,kbNextParty:()=>db,kbNextTarget:()=>pb,kbParty:()=>xb,kbPvp:()=>kb,kbRight:()=>mb,kbSkillbar1:()=>Mb,kbSkillbar10:()=>Db,kbSkillbar11:()=>Vb,kbSkillbar12:()=>Lb,kbSkillbar13:()=>qb,kbSkillbar14:()=>Rb,kbSkillbar15:()=>zb,kbSkillbar16:()=>Bb,kbSkillbar17:()=>$b,kbSkillbar18:()=>Ub,kbSkillbar19:()=>Ob,kbSkillbar2:()=>Fb,kbSkillbar20:()=>Nb,kbSkillbar21:()=>jb,kbSkillbar22:()=>Wb,kbSkillbar23:()=>Gb,kbSkillbar24:()=>Hb,kbSkillbar3:()=>Cb,kbSkillbar4:()=>Sb,kbSkillbar5:()=>Pb,kbSkillbar6:()=>Ab,kbSkillbar7:()=>Tb,kbSkillbar8:()=>Eb,kbSkillbar9:()=>Ib,kbSkills:()=>vb,kbSocial:()=>wb,kbTurnLeft:()=>rb,kbTurnRight:()=>lb,kbUntarget:()=>hb,lang:()=>Yr,lastConnectedChar:()=>nf,leaveEmptyParty:()=>xp,lockedcamera:()=>Cp,mapLowQuality:()=>ip,mapShowMonsters:()=>sp,mouseSensitivity:()=>Ff,msgExpGain:()=>up,msgFame:()=>mp,msgFriendOnlineStatus:()=>vp,msgGoldPickUp:()=>gp,msgItemPartyPickUp:()=>hp,msgItemPartyRoll:()=>dp,msgItemPickup:()=>pp,musicVolume:()=>af,nameShowEnemyPlayers:()=>Km,nameShowFriendlyPlayers:()=>Jm,nameShowMonsters:()=>Zm,nameplateShowEnemyPlayers:()=>Qm,nameplateShowFriendlyPlayers:()=>Xm,nameplateShowMonsters:()=>Ym,nameplateShowTransparency:()=>ep,nameplateViewRange:()=>df,nextFriendlyTargetAllowNonParty:()=>Pp,nextFriendlyTargetCycle:()=>Cf,particles:()=>Wm,partyBuffLimitUpdateRate:()=>yp,partyOpen:()=>es,partyWidth:()=>Kr,pointerlock:()=>Sp,pvpOpen:()=>yi,registerSetting:()=>Yb,resolution:()=>Wr,settingsOpen:()=>Qr,shadowmapResolution:()=>sf,shadows:()=>Nm,showFpsPing:()=>Ma,showIncomingDamage:()=>ap,showIncomingHeal:()=>lp,showIncomingMana:()=>cp,showPartyMana:()=>Fa,showSelfInParty:()=>kp,skillConfigs:()=>Ca,skillPresetVisible:()=>Mf,skillbarAmount:()=>el,skillbarsettings:()=>xi,skillmenuOpen:()=>vi,socialOpen:()=>bi,stashCols:()=>Qi,stashHeight:()=>Zi,stashShowGroups:()=>xa,stashShowSettings:()=>cf,subscriptionOpen:()=>Bo,tutprogress:()=>wi,twitchOpen:()=>wa,viewRange:()=>Nr,windowSettings:()=>bf});var Qh={};Kn(Qh,{activeWorld:()=>Or,alwaysShowLevel:()=>tp,ambienceVolume:()=>lf,anisotropy:()=>rf,audioVolume:()=>Gr,audioVolumeLowered:()=>Hr,bloom:()=>jm,buffCdFlashingDuration:()=>kf,buffCdFlashingInterval:()=>yf,buffcountParty:()=>wf,buffcountUnitframes:()=>xf,buffsHideIrrelevant:()=>wp,cameraZoom:()=>Hm,cdTextBuffs:()=>bp,cdTextSkills:()=>_p,charpanelOpen:()=>ki,chatbubbles:()=>rp,clanOpen:()=>_i,classColorBars:()=>op,combatTextPush:()=>np,command:()=>Qs,disableoffscreen:()=>Om,dpsmeterMode:()=>pf,dpsmeterOpen:()=>Zr,dpsmeterParty:()=>mf,dpsmeterTarget:()=>Jr,expmeterOpen:()=>uf,filteredChannels:()=>hf,fogpattern:()=>Gm,foliage:()=>of,fov:()=>jr,fxaa:()=>Um,inventoryCols:()=>Xr,inventoryOpen:()=>gi,invertMouseX:()=>Mp,invertMouseY:()=>Fp,itemProtectQuality:()=>_f,itemQualityFilter:()=>vf,itemQualityPercent:()=>fp,itemTypeFilter:()=>gf,itemmeterOpen:()=>ff,kbAltBack:()=>cb,kbAltForward:()=>ab,kbBack:()=>ub,kbCharacter:()=>_b,kbClan:()=>yb,kbForward:()=>ib,kbInventory:()=>bb,kbLeft:()=>fb,kbMap:()=>gb,kbNextParty:()=>db,kbNextTarget:()=>pb,kbParty:()=>xb,kbPvp:()=>kb,kbRight:()=>mb,kbSkillbar1:()=>Mb,kbSkillbar10:()=>Db,kbSkillbar11:()=>Vb,kbSkillbar12:()=>Lb,kbSkillbar13:()=>qb,kbSkillbar14:()=>Rb,kbSkillbar15:()=>zb,kbSkillbar16:()=>Bb,kbSkillbar17:()=>$b,kbSkillbar18:()=>Ub,kbSkillbar19:()=>Ob,kbSkillbar2:()=>Fb,kbSkillbar20:()=>Nb,kbSkillbar21:()=>jb,kbSkillbar22:()=>Wb,kbSkillbar23:()=>Gb,kbSkillbar24:()=>Hb,kbSkillbar3:()=>Cb,kbSkillbar4:()=>Sb,kbSkillbar5:()=>Pb,kbSkillbar6:()=>Ab,kbSkillbar7:()=>Tb,kbSkillbar8:()=>Eb,kbSkillbar9:()=>Ib,kbSkills:()=>vb,kbSocial:()=>wb,kbTurnLeft:()=>rb,kbTurnRight:()=>lb,kbUntarget:()=>hb,lang:()=>Yr,lastConnectedChar:()=>nf,leaveEmptyParty:()=>xp,lockedcamera:()=>Cp,mapLowQuality:()=>ip,mapShowMonsters:()=>sp,mouseSensitivity:()=>Ff,msgExpGain:()=>up,msgFame:()=>mp,msgFriendOnlineStatus:()=>vp,msgGoldPickUp:()=>gp,msgItemPartyPickUp:()=>hp,msgItemPartyRoll:()=>dp,msgItemPickup:()=>pp,musicVolume:()=>af,nameShowEnemyPlayers:()=>Km,nameShowFriendlyPlayers:()=>Jm,nameShowMonsters:()=>Zm,nameplateShowEnemyPlayers:()=>Qm,nameplateShowFriendlyPlayers:()=>Xm,nameplateShowMonsters:()=>Ym,nameplateShowTransparency:()=>ep,nameplateViewRange:()=>df,nextFriendlyTargetAllowNonParty:()=>Pp,nextFriendlyTargetCycle:()=>Cf,particles:()=>Wm,partyBuffLimitUpdateRate:()=>yp,partyOpen:()=>es,partyWidth:()=>Kr,pointerlock:()=>Sp,pvpOpen:()=>yi,resolution:()=>Wr,settingsOpen:()=>Qr,shadowmapResolution:()=>sf,shadows:()=>Nm,showFpsPing:()=>Ma,showIncomingDamage:()=>ap,showIncomingHeal:()=>lp,showIncomingMana:()=>cp,showPartyMana:()=>Fa,showSelfInParty:()=>kp,skillConfigs:()=>Ca,skillPresetVisible:()=>Mf,skillbarAmount:()=>el,skillbarsettings:()=>xi,skillmenuOpen:()=>vi,socialOpen:()=>bi,stashCols:()=>Qi,stashHeight:()=>Zi,stashShowGroups:()=>xa,stashShowSettings:()=>cf,subscriptionOpen:()=>Bo,tutprogress:()=>wi,twitchOpen:()=>wa,viewRange:()=>Nr,windowSettings:()=>bf});var Or=te(""),nf=te(0),Nr=te(60),jr=te(70),Wr=te(100),of=te(100),sf=te(2),Um=te(!0),Om=te(!0),Nm=te(!0),jm=te(!0),Wm=te(!0),rf=te(4),Gm=te(!0),lf=te(40),Gr=te(70),Hr=te(80),af=te(30),Yr=te("en"),Qs=te("faction"),Qi=te(8),Zi=te(300),xa=te(2),cf=te(!1),Xr=te(5),gi=te(!1),Qr=te(!1),vi=te(!1),Zr=te(!1),ff=te(!0),uf=te(!0),wa=te(!0),Bo=te(!1),es=te(!1),_i=te(!1),bi=te(!1),yi=te(!1),mf=te(!0),pf=te(0),Jr=te(0),ki=te(!1),xi=te({}),Hm=te(7),df=te(100),Ym=te(!0),Xm=te(!0),Qm=te(!0),Zm=te(!0),Jm=te(!0),Km=te(!0),ep=te(!0),tp=te(!1),np=te(!0),op=te(!1),sp=te(!0),ip=te(!1),wi=te(0),rp=te(!0),lp=te(!0),ap=te(!0),cp=te(!0),hf=te([]),gf=te(""),vf=te(0),fp=te(!1),Ma=te(!1),_f=te(70),bf=te([]),up=te(!1),mp=te(!0),pp=te(!0),dp=te(!0),hp=te(!0),gp=te(!0),vp=te(!0),_p=te(!0),bp=te(!0),yf=te(.5),kf=te(3),yp=te(!0),Kr=te(200),kp=te(!0),xp=te(!0),Fa=te(!1),xf=te(14),wf=te(8),wp=te(!1),Ca=te([]),Mf=te(!1),Ff=te(1),Mp=te(!1),Fp=te(!1),Cp=te(!0),Sp=te(!0),Pp=te(!0),Cf=te(10),ib=te("w"),rb=te("arrowleft"),lb=te("arrowright"),ab=te("arrowup"),cb=te("arrowdown"),fb=te("a"),ub=te("s"),mb=te("d"),pb=te("tab"),db=te("x"),hb=te("escape"),gb=te("m"),vb=te("k"),_b=te("c"),bb=te("b"),yb=te("g"),kb=te("v"),xb=te("p"),wb=te("i"),Mb=te("1"),Fb=te("2"),Cb=te("3"),Sb=te("4"),Pb=te("5"),Ab=te("6"),Tb=te("7"),Eb=te("8"),Ib=te("9"),Db=te("0"),Vb=te(""),Lb=te(""),qb=te(""),Rb=te(""),zb=te(""),Bb=te(""),$b=te(""),Ub=te(""),Ob=te(""),Nb=te(""),jb=te(""),Wb=te(""),Gb=te(""),Hb=te(""),el=te(12);var Zh;Zh={...Qh};var Yb=(t,e)=>{{let n=localStorage.getItem(t),o=JSON.parse(n=="undefined"?null:n);o!==null&&e.set(o)}e.subscribe(n=>{fe[t]=n,localStorage.setItem(t,JSON.stringify(n))})},fe={};for(let t in Zh)Yb(t,Zh[t]);var P;Yr.subscribe(async t=>{await fetch(`/data/loc/${t}.json?v=8738303`).then(async e=>{P=await e.json(),gm.set(!0)})});var nn=(t,e)=>ob(t,e,P),Jh=(t,e)=>sb(t,e,P);function Xb(t,e,n){let o=t.slice();return o[8]=e[n],o}function Qb(t){let e,n=me(t[1].opts),o=[];for(let i=0;i<n.length;i+=1)o[i]=Kb(Xb(t,n,i));let s=null;return n.length||(s=Zb(t)),{c(){e=h("div");for(let i=0;i<o.length;i+=1)o[i].c();s&&s.c(),p(e,"class","panel context border grey"),Le(e,"left",t[1].x+(t[4]&&t[1].xFlip||0)+"px"),Le(e,"top",t[1].y-(t[3]&&t[1].yFlip||0)+"px"),Le(e,"transform","translate("+(t[4]?"-100%":"0%")+","+(t[3]?"-100%":"0%")+")")},m(i,r){w(i,e,r);for(let l=0;l<o.length;l+=1)o[l]&&o[l].m(e,null);s&&s.m(e,null),t[6](e)},p(i,r){if(r&3){n=me(i[1].opts);let l;for(l=0;l<n.length;l+=1){let a=Xb(i,n,l);o[l]?o[l].p(a,r):(o[l]=Kb(a),o[l].c(),o[l].m(e,null))}for(;l<o.length;l+=1)o[l].d(1);o.length=n.length,!n.length&&s?s.p(i,r):n.length?s&&(s.d(1),s=null):(s=Zb(i),s.c(),s.m(e,null))}r&18&&Le(e,"left",i[1].x+(i[4]&&i[1].xFlip||0)+"px"),r&10&&Le(e,"top",i[1].y-(i[3]&&i[1].yFlip||0)+"px"),r&24&&Le(e,"transform","translate("+(i[4]?"-100%":"0%")+","+(i[3]?"-100%":"0%")+")")},d(i){i&&x(e),ot(o,i),s&&s.d(),t[6](null)}}}function Zb(t){let e;return{c(){e=h("div"),e.textContent=`${P.ui.noOptions}`,p(e,"class","choice disabled")},m(n,o){w(n,e,o)},p:ae,d(n){n&&x(e)}}}function Jb(t){let e,n;return{c(){e=h("img"),p(e,"class","svgicon"),at(e.src,n="/data/ui/icons/"+t[8].icon+".svg?v=8738303")||p(e,"src",n)},m(o,s){w(o,e,s)},p(o,s){s&2&&!at(e.src,n="/data/ui/icons/"+o[8].icon+".svg?v=8738303")&&p(e,"src",n)},d(o){o&&x(e)}}}function Kb(t){let e,n=t[8].name+"",o,s,i,r,l=t[8].icon&&Jb(t);function a(...c){return t[5](t[8],...c)}return{c(){e=h("div"),l&&l.c(),o=T(n),p(e,"class",s="choice "+(t[8].css||""))},m(c,f){w(c,e,f),l&&l.m(e,null),d(e,o),i||(r=H(e,"mouseup",a),i=!0)},p(c,f){t=c,t[8].icon?l?l.p(t,f):(l=Jb(t),l.c(),l.m(e,o)):l&&(l.d(1),l=null),f&2&&n!==(n=t[8].name+"")&&G(o,n),f&2&&s!==(s="choice "+(t[8].css||""))&&p(e,"class",s)},d(c){c&&x(e),l&&l.d(),i=!1,r()}}}function U7(t){let e,n=t[1]&&Qb(t);return{c(){n&&n.c(),e=de()},m(o,s){n&&n.m(o,s),w(o,e,s)},p(o,[s]){o[1]?n?n.p(o,s):(n=Qb(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(o){o&&x(e),n&&n.d(o)}}}function O7(t,e,n){let o,s,i;re(t,dn,u=>n(1,i=u));let r,l=u=>{u.target!=r&&u.target.parentNode!=r&&i&&dn.set(void 0)},a=(u,m)=>{m.fun(u),dn.set(void 0)};Fn(()=>{document.addEventListener("pointerdown",l,!1)}),Tn(()=>{document.removeEventListener("pointerdown",l)});let c=(u,m)=>a(m,u);function f(u){qt[u?"unshift":"push"](()=>{r=u,n(2,r)})}return t.$$.update=()=>{t.$$.dirty&2&&n(4,o=i&&i.x>window.innerWidth-100),t.$$.dirty&2&&n(3,s=i&&i.y>window.innerHeight-130)},[a,i,r,s,o,c,f]}var Kh=class extends Ce{constructor(e){super(),Pe(this,e,O7,U7,Be,{opt:0})}get opt(){return this.$$.ctx[0]}},e3=Kh;var B=0,t3={string:t=>{let e=r3(t);return ts(e)+e},varuint:t=>ts(t),varint:t=>N7(t),buffer8:t=>{let e=t.length;return ts(e)+e},buffer16:(t,e)=>{let n=t.length*2,o=ts(n);return(e+o)%2==1&&o++,o+n}};var ke=t=>{let e=0,n=0,o=0;do o=t[B++],e|=(o&127)<<7*n,n++;while(o&128);return e};var Ji=(t,e)=>{for(;e>127;)t[B++]=e&127|128,e>>=7;t[B++]=e&127},ts=t=>t<=0?1:Math.floor(Math.log(t)/Math.log(128))+1,N7=t=>ts(t<<1^t>>31),_s=t=>t[B]&128?(255-t[B]+1)*-1:t[B],j7=(t,e)=>{e<0&&(e=255+e+1),t[B]=e&255,B+=1},qe=t=>t[B],Js=(t,e)=>{t[B]=e,B+=1},Ap=t=>{let e=t[B]|t[B+1]<<8;return e&32768?e|4294901760:e},e1=(t,e)=>{t[B]=e&255,t[B+1]=e>>>8,B+=2},Ot=t=>t[B]|t[B+1]<<8;var vo=t=>(t[B]|t[B+1]<<8|t[B+2]<<16)+t[B+3]*16777216,t1=(t,e)=>{t[B]=e&255,t[B+1]=e>>>8,t[B+2]=e>>>16,t[B+3]=e>>>24,B+=4},n1=new ArrayBuffer(8),Ki=new Uint8Array(n1),s3=new Float32Array(n1),AO=new Float64Array(n1),lt=t=>(Ki[0]=t[B],Ki[1]=t[B+1],Ki[2]=t[B+2],Ki[3]=t[B+3],s3[0]),i3=(t,e)=>{s3[0]=e,t[B]=Ki[0],t[B+1]=Ki[1],t[B+2]=Ki[2],t[B+3]=Ki[3],B+=4};var n3=t=>{let e=ke(t);B%2==1&&B++;let n=new Uint16Array(t.buffer,B,e/2);return B+=e,n},r3=t=>{let e=t.length;for(let n=t.length-1;n>=0;n--){let o=t.charCodeAt(n);o>127&&o<=2047?e++:o>2047&&o<=65535&&(e+=2),o>=56320&&o<=57343&&n--}return e},o3=(t,e)=>{let n=r3(e);Ji(t,n);for(let o=0;o<e.length;o++){let s=e.charCodeAt(o);s<128?t[B++]=s:s<2048?(t[B++]=s>>6|192,t[B++]=s&63|128):(s&64512)==55296&&o+1<e.length&&(e.charCodeAt(o+1)&64512)==56320?(s=65536+((s&1023)<<10)+(e.charCodeAt(++o)&1023),t[B++]=s>>18|240,t[B++]=s>>12&63|128,t[B++]=s>>6&63|128,t[B++]=s&63|128):(t[B++]=s>>12|224,t[B++]=s>>6&63|128,t[B++]=s&63|128)}},Ln=t=>{let e=ke(t),n="",o=B+e;for(;B<o;){let s=t[B++];if(s<128)n+=String.fromCharCode(s);else if(s>191&&s<224){let i=t[B++];n+=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){let i=t[B++],r=t[B++],l=t[B++],a=((s&7)<<18|(i&63)<<12|(r&63)<<6|l&63)-65536;n+=String.fromCharCode(55296+(a>>10)),n+=String.fromCharCode(56320+(a&1023))}else{let i=t[B++],r=t[B++];n+=String.fromCharCode((s&15)<<12|(i&63)<<6|r&63)}}return n},l3={encode:t=>{let e=t,n=e.doubles,o=e.int8s,s=e.uint16s,i=e.uint8s,r=0;r+=1,r+=ts(n.length);for(let a=0;a<n.length;a++)r+=4;r+=ts(o.length);for(let a=0;a<o.length;a++)r+=1;r+=ts(s.length);for(let a=0;a<s.length;a++)r+=2;r+=ts(i.length);for(let a=0;a<i.length;a++)r+=1;let l=new Uint8Array(r);B=0,Js(l,e._header),Ji(l,n.length);for(let a=0;a<n.length;a++)i3(l,n[a]);Ji(l,o.length);for(let a=0;a<o.length;a++)j7(l,o[a]);Ji(l,s.length);for(let a=0;a<s.length;a++)e1(l,s[a]);Ji(l,i.length);for(let a=0;a<i.length;a++)Js(l,i[a]);return l}},a3={encode:t=>{let e=t,n=0;n+=1,n+=4;let o=new Uint8Array(n);return B=0,Js(o,e._header),t1(o,e.target),o}},c3={encode:t=>{let e=t,n=e.info,o=0;o+=1,o+=2,o+=ts(n.length);for(let i=0;i<n.length;i++)o+=4;let s=new Uint8Array(o);B=0,Js(s,e._header),e1(s,e.id),Ji(s,n.length);for(let i=0;i<n.length;i++)t1(s,n[i]);return s}},f3={encode:t=>{let e=t,n=e.info,o=e.pos,s=0;s+=1,s+=2,s+=ts(n.length);for(let r=0;r<n.length;r++)s+=4;s+=ts(o.length);for(let r=0;r<o.length;r++)s+=4;let i=new Uint8Array(s);B=0,Js(i,e._header),e1(i,e.id),Ji(i,n.length);for(let r=0;r<n.length;r++)t1(i,n[r]);Ji(i,o.length);for(let r=0;r<o.length;r++)i3(i,o[r]);return i}},u3={encode:t=>{let e=t,n=0;n+=1,n+=1;let o=new Uint8Array(n);return B=0,Js(o,e._header),Js(o,e.id),o}},m3={encode:t=>{let e=t,n=0;n+=1,n+=t3.string(e.command,n),n+=t3.string(e.string,n);let o=new Uint8Array(n);return B=0,Js(o,e._header),o3(o,e.command),o3(o,e.string),o}},p3={decode:t=>{let e=t,n={};B=0,n._header=qe(e),B+=1;let o=[];n.inputs=o;let s=ke(e);for(let u=0;u<s;u++){let m={};o[u]=m,m.id=vo(e),B+=4,m.jump=qe(e),B+=1,m.rot=lt(e),B+=4,m.speed=Ot(e),B+=2;let g=[];m.steer=g,g[0]=_s(e),B+=1;let v=ke(e);for(let _=1;_<v;_++)g[_]=_s(e),B+=1}let i=[];n.log=i;let r=ke(e);for(let u=0;u<r;u++){let m={};i[u]=m;let g=[];m.data=g;let v=ke(e);for(let _=0;_<v;_++)g[_]=ke(e);m.type=qe(e),B+=1}let l=[];n.logPersonal=l;let a=ke(e);for(let u=0;u<a;u++){let m={};l[u]=m;let g=[];m.data=g;let v=ke(e);for(let _=0;_<v;_++)g[_]=ke(e);m.type=qe(e),B+=1}let c=[];n.movements=c;let f=ke(e);for(let u=0;u<f;u++){let m={};c[u]=m,m.id=vo(e),B+=4;let g=[];m.pos=g,g[0]=lt(e),B+=4,g[1]=lt(e),B+=4;let v=ke(e);for(let k=2;k<v;k++)g[k]=lt(e),B+=4;let _=[];m.vel=_,_[0]=lt(e),B+=4,_[1]=lt(e),B+=4;let b=ke(e);for(let k=2;k<b;k++)_[k]=lt(e),B+=4}return n.tickId=vo(e),B+=4,n}},d3={decode:t=>{let e=t,n={};B=0,n._header=qe(e),B+=1;let o=[];n.members=o;let s=ke(e);for(let l=0;l<s;l++){let a={};o[l]=a,a.class=qe(e),B+=1,a.entityid=vo(e),B+=4,a.level=qe(e),B+=1,a.name=Ln(e),a.role=Ot(e),B+=2,a.world=Ln(e)}let i=[];n.queues=i;let r=ke(e);for(let l=0;l<r;l++)i[l]=Ln(e);return n}},h3={decode:t=>{let e=t,n={};B=0,n._header=qe(e),B+=1,n.contrib=ke(e);let o=[];n.contributors=o;let s=ke(e);for(let l=0;l<s;l++){let a={};o[l]=a,a.class=qe(e),B+=1,a.faction=qe(e),B+=1,a.level=qe(e),B+=1,a.name=Ln(e);let c=[];a.stats=c;let f=ke(e);for(let u=0;u<f;u++)c[u]=ke(e)}n.duration=ke(e);let i=[];n.kills=i,i[0]=ke(e);let r=ke(e);for(let l=1;l<r;l++)i[l]=ke(e);return n.level=ke(e),n.reward=ke(e),n.status=qe(e),B+=1,n}},g3={decode:t=>{let e=t,n={};B=0,n._header=qe(e),B+=1;let o=[];n.members=o;let s=ke(e);for(let i=0;i<s;i++){let r={};o[i]=r,r.entityid=vo(e),B+=4;let l=[];r.pos=l;let a=ke(e);for(let c=0;c<a;c++)l[c]=Ot(e),B+=2}return n}},v3={decode:t=>{let e=t,n={};B=0,n._header=qe(e),B+=1;let o=[];n.icons=o;let s=ke(e);for(let i=0;i<s;i++){let r={};o[i]=r,r.blink=!!_s(e),B+=1,r.id=Ot(e),B+=2;let l=[];r.pos=l,l[0]=Ot(e),B+=2;let a=ke(e);for(let c=1;c<a;c++)l[c]=Ot(e),B+=2}return n}},_3={decode:t=>{let e=t,n={};B=0,n._header=qe(e),B+=1,n.channel=Ln(e),n.clan=Ln(e),n.class=qe(e),B+=1,n.faction=qe(e),B+=1,n.from=Ln(e),n.id=vo(e),B+=4;let o=[];n.items=o;let s=ke(e);for(let i=0;i<s;i++){let r={};o[i]=r,r.id=vo(e),B+=4,r.index=Ot(e),B+=2;let l=[];r.rolls=l;let a=ke(e);for(let c=0;c<a;c++)l[c]=Ot(e),B+=2;r.stacks=qe(e),B+=1,r.tier=Ot(e),B+=2,r.type=Ln(e),r.upgrade=Ot(e),B+=2}return n.level=qe(e),B+=1,n.message=Ln(e),n.subscribed=qe(e),B+=1,n}},b3={decode:t=>{let e=t,n={};return B=0,n._header=qe(e),B+=1,n.world=Ln(e),n}},y3={decode:t=>{let e=t,n={};B=0,n._header=qe(e),B+=1;let o=[];n.messages=o;let s=ke(e);for(let i=0;i<s;i++){let r={};o[i]=r,r.message=Ln(e),r.type=Ln(e)}return n}},k3={decode:t=>{let e=t,n={};return B=0,n._header=qe(e),B+=1,n.file=Ln(e),n.playerId=vo(e),B+=4,n.tickId=vo(e),B+=4,n.world=Ln(e),n}},x3={decode:t=>{let e=t,n={};return B=0,n._header=qe(e),B+=1,n.pos=Ot(e),B+=2,n}},w3={decode:t=>{let e=t,n={};return B=0,n._header=qe(e),B+=1,n.id=qe(e),B+=1,n},encode:t=>{let e=t,n=0;n+=1,n+=1;let o=new Uint8Array(n);return B=0,Js(o,e._header),Js(o,e.id),o}};var M3={decode:t=>{let e=t,n={};B=0;let o=[];n.aabb=o;let s=ke(e);for(let C=0;C<s;C++)o[C]=lt(e),B+=4;let i=[];n.area=i;let r=ke(e);for(let C=0;C<r;C++)i[C]=Ot(e),B+=2;let l=[];n.environment=l;let a=ke(e);for(let C=0;C<a;C++)l[C]=Ot(e),B+=2;let c=[];n.holes=c;let f=ke(e);for(let C=0;C<f;C++)c[C]=Ot(e),B+=2;let u=[];n.props=u;let m=ke(e);for(let C=0;C<m;C++){let M={};u[C]=M,M.id=vo(e),B+=4,M.rx=Ap(e),B+=2,M.ry=Ap(e),B+=2,M.rz=Ap(e),B+=2,M.scale=Ot(e),B+=2,M.x=Ot(e),B+=2,M.y=vo(e),B+=4,M.z=Ot(e),B+=2}let g=[];n.shore=g;let v=ke(e);for(let C=0;C<v;C++)g[C]=Ot(e),B+=2;n.terrain=n3(e);let _=[];n.texture=_;let b=ke(e);for(let C=0;C<b;C++)_[C]=n3(e);let k=[];n.textureid=k;let y=ke(e);for(let C=0;C<y;C++){let M=[];k[C]=M;let D=ke(e);for(let $=0;$<D;$++)M[$]=Ot(e),B+=2}let F=[];n.water=F;let A=ke(e);for(let C=0;C<A;C++)F[C]=Ot(e),B+=2;return n}},F3={decode:t=>{let e=t,n={};B=0;let o=[];n.color=o;let s=ke(e);for(let k=0;k<s;k++)o[k]=qe(e),B+=1;let i=[];n.flags=i;let r=ke(e);for(let k=0;k<r;k++)i[k]=qe(e),B+=1;let l=[];n.index=l;let a=ke(e);for(let k=0;k<a;k++)l[k]=ke(e);let c=[];n.indexInvisible=c;let f=ke(e);for(let k=0;k<f;k++)c[k]=ke(e);let u=[];n.normal=u;let m=ke(e);for(let k=0;k<m;k++)u[k]=_s(e),B+=1;let g=[];n.position=g;let v=ke(e);for(let k=0;k<v;k++)g[k]=Ap(e),B+=2;n.sx=vo(e),B+=4,n.sy=vo(e),B+=4,n.sz=vo(e),B+=4;let _=[];n.uv=_;let b=ke(e);for(let k=0;k<b;k++)_[k]=Ot(e),B+=2;return n}},C3={decode:t=>{let e=t,n={};B=0;let o=[];n.animations=o;let s=ke(e);for(let ee=0;ee<s;ee++){let O={};o[ee]=O,O.duration=lt(e),B+=4;let ue=[];O.effects=ue;let We=ke(e);for(let $e=0;$e<We;$e++){let Ue={};ue[$e]=Ue,Ue.body=qe(e),B+=1,Ue.end=lt(e),B+=4,Ue.id=qe(e),B+=1,Ue.priority=qe(e),B+=1,Ue.start=lt(e),B+=4,Ue.type=qe(e),B+=1}O.id=qe(e),B+=1,O.movement=qe(e),B+=1,O.priority=qe(e),B+=1;let ze=[];O.sounds=ze;let Ae=ke(e);for(let $e=0;$e<Ae;$e++){let Ue={};ze[$e]=Ue,Ue.end=qe(e),B+=1,Ue.id=qe(e),B+=1,Ue.start=lt(e),B+=4}}let i=[];n.areas=i;let r=ke(e);for(let ee=0;ee<r;ee++){let O={};i[ee]=O,O.ambientday=qe(e),B+=1,O.ambientnight=qe(e),B+=1,O.id=qe(e),B+=1,O.music=qe(e),B+=1,O.name=Ln(e)}let l=[];n.arenas=l;let a=ke(e);for(let ee=0;ee<a;ee++){let O={};l[ee]=O,O.group=qe(e),B+=1,O.id=qe(e),B+=1;let ue=[];O.pos=ue;let We=ke(e);for(let ze=0;ze<We;ze++)ue[ze]=lt(e),B+=4;O.radius=qe(e),B+=1,O.rot=lt(e),B+=4,O.type=qe(e),B+=1,O.world=qe(e),B+=1}let c=[];n.classes=c;let f=ke(e);for(let ee=0;ee<f;ee++){let O={};c[ee]=O;let ue=[];O.baseStats=ue;let We=ke(e);for(let Je=0;Je<We;Je++){let Et=[];ue[Je]=Et;let xe=ke(e);for(let Ke=0;Ke<xe;Ke++)Et[Ke]=qe(e),B+=1}let ze=[];O.engineSkills=ze;let Ae=ke(e);for(let Je=0;Je<Ae;Je++)ze[Je]=qe(e),B+=1;O.id=qe(e),B+=1;let $e=[];O.startSkills=$e;let Ue=ke(e);for(let Je=0;Je<Ue;Je++)$e[Je]=qe(e),B+=1;let mt=[];O.statPerLevel=mt;let wt=ke(e);for(let Je=0;Je<wt;Je++){let Et=[];mt[Je]=Et;let xe=ke(e);for(let Ke=0;Ke<xe;Ke++)Et[Ke]=qe(e),B+=1}}let u=[];n.creatures=u;let m=ke(e);for(let ee=0;ee<m;ee++){let O={};u[ee]=O;let ue=[];O.col1=ue;let We=ke(e);for(let $e=0;$e<We;$e++)ue[$e]=lt(e),B+=4;let ze=[];O.col2=ze;let Ae=ke(e);for(let $e=0;$e<Ae;$e++)ze[$e]=lt(e),B+=4;O.drProtection=!!_s(e),B+=1,O.faction=qe(e),B+=1,O.id=Ot(e),B+=2,O.level=qe(e),B+=1,O.name=Ln(e),O.skin=qe(e),B+=1,O.type=qe(e),B+=1}let g=[];n.creaturesConjurer=g;let v=ke(e);for(let ee=0;ee<v;ee++){let O={};g[ee]=O,O.id=Ot(e),B+=2,O.war=!!_s(e),B+=1}let _=[];n.creaturesMonster=_;let b=ke(e);for(let ee=0;ee<b;ee++){let O={};_[ee]=O,O.aggroMode=qe(e),B+=1,O.id=Ot(e),B+=2,O.rarity=qe(e),B+=1}let k=[];n.creaturesTrader=k;let y=ke(e);for(let ee=0;ee<y;ee++){let O={};k[ee]=O,O.id=Ot(e),B+=2,O.shop=qe(e),B+=1}let F=[];n.effects=F;let A=ke(e);for(let ee=0;ee<A;ee++){let O={};F[ee]=O,O.duration=lt(e),B+=4;let ue=[];O.events=ue;let We=ke(e);for(let $e=0;$e<We;$e++){let Ue={};ue[$e]=Ue,Ue.fraction=lt(e),B+=4,Ue.id=qe(e),B+=1;let mt=[];Ue.params=mt;let wt=ke(e);for(let Je=0;Je<wt;Je++)mt[Je]=lt(e),B+=4}O.id=qe(e),B+=1;let ze=[];O.periods=ze;let Ae=ke(e);for(let $e=0;$e<Ae;$e++){let Ue={};ze[$e]=Ue,Ue.fractionEnd=lt(e),B+=4,Ue.fractionStart=lt(e),B+=4,Ue.id=qe(e),B+=1;let mt=[];Ue.modifiers=mt;let wt=ke(e);for(let xe=0;xe<wt;xe++){let Ke={};mt[xe]=Ke,Ke.id=qe(e),B+=1,Ke.mode=qe(e),B+=1;let bt=[];Ke.params=bt;let Ct=ke(e);for(let Ve=0;Ve<Ct;Ve++)bt[Ve]=lt(e),B+=4}let Je=[];Ue.params=Je;let Et=ke(e);for(let xe=0;xe<Et;xe++)Je[xe]=lt(e),B+=4}}let C=[];n.environments=C;let M=ke(e);for(let ee=0;ee<M;ee++){let O={};C[ee]=O;let ue=[];O.ambient=ue;let We=ke(e);for(let Ee=0;Ee<We;Ee++){let it=[];ue[Ee]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let ze=[];O.bloom=ze;let Ae=ke(e);for(let Ee=0;Ee<Ae;Ee++)ze[Ee]=lt(e),B+=4;let $e=[];O.clouds=$e;let Ue=ke(e);for(let Ee=0;Ee<Ue;Ee++){let it=[];$e[Ee]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let mt=[];O.direct=mt;let wt=ke(e);for(let Ee=0;Ee<wt;Ee++){let it=[];mt[Ee]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let Je=[];O.fog=Je;let Et=ke(e);for(let Ee=0;Ee<Et;Ee++){let it=[];Je[Ee]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let xe=[];O.horizon=xe;let Ke=ke(e);for(let Ee=0;Ee<Ke;Ee++){let it=[];xe[Ee]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}O.id=qe(e),B+=1;let bt=[];O.skybot=bt;let Ct=ke(e);for(let Ee=0;Ee<Ct;Ee++){let it=[];bt[Ee]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let Ve=[];O.skymid=Ve;let ye=ke(e);for(let Ee=0;Ee<ye;Ee++){let it=[];Ve[Ee]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let Vt=[];O.skytop=Vt;let Ht=ke(e);for(let Ee=0;Ee<Ht;Ee++){let it=[];Vt[Ee]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let Lt=[];O.sun=Lt;let Rt=ke(e);for(let Ee=0;Ee<Rt;Ee++){let it=[];Lt[Ee]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}let He=[];O.water=He;let et=ke(e);for(let Ee=0;Ee<et;Ee++){let it=[];He[Ee]=it;let Ze=ke(e);for(let ft=0;ft<Ze;ft++)it[ft]=lt(e),B+=4}}let D=[];n.files=D;let $=ke(e);for(let ee=0;ee<$;ee++){let O={};D[ee]=O,O.ext=qe(e),B+=1,O.id=Ot(e),B+=2,O.type=qe(e),B+=1}let V=[];n.filesExt=V;let z=ke(e);for(let ee=0;ee<z;ee++)V[ee]=Ln(e);let q=[];n.foliages=q;let L=ke(e);for(let ee=0;ee<L;ee++){let O={};q[ee]=O,O.id=qe(e),B+=1;let ue=[];O.nodes=ue;let We=ke(e);for(let ze=0;ze<We;ze++){let Ae={};ue[ze]=Ae,Ae.arc=lt(e),B+=4;let $e=[];Ae.end=$e;let Ue=ke(e);for(let xe=0;xe<Ue;xe++)$e[xe]=lt(e),B+=4;Ae.geotype=qe(e),B+=1,Ae.jitter_radius=lt(e),B+=4,Ae.jitter_rotation=lt(e),B+=4,Ae.jitter_size=lt(e),B+=4,Ae.jitter_slant=lt(e),B+=4,Ae.jitter_y=lt(e),B+=4,Ae.leafCount=qe(e),B+=1;let mt=[];Ae.points=mt;let wt=ke(e);for(let xe=0;xe<wt;xe++)mt[xe]=lt(e),B+=4;Ae.radius=lt(e),B+=4,Ae.size=lt(e),B+=4,Ae.slant=lt(e),B+=4;let Je=[];Ae.start=Je;let Et=ke(e);for(let xe=0;xe<Et;xe++)Je[xe]=lt(e),B+=4;Ae.y=lt(e),B+=4}O.seed=vo(e),B+=4,O.texture=Ot(e),B+=2,O.type=qe(e),B+=1}let U=[];n.meshes=U;let W=ke(e);for(let ee=0;ee<W;ee++){let O={};U[ee]=O,O.cull=qe(e),B+=1;let ue=[];O.effects=ue;let We=ke(e);for(let ze=0;ze<We;ze++){let Ae={};ue[ze]=Ae,Ae.id=qe(e),B+=1;let $e=[];Ae.pos=$e;let Ue=ke(e);for(let xe=0;xe<Ue;xe++)$e[xe]=lt(e),B+=4;let mt=[];Ae.rot=mt;let wt=ke(e);for(let xe=0;xe<wt;xe++)mt[xe]=lt(e),B+=4;let Je=[];Ae.scale=Je;let Et=ke(e);for(let xe=0;xe<Et;xe++)Je[xe]=lt(e),B+=4}O.geometry=Ot(e),B+=2,O.id=Ot(e),B+=2,O.shader=qe(e),B+=1,O.shadow=qe(e),B+=1,O.texture=Ot(e),B+=2}let R=[];n.minimap=R;let N=ke(e);for(let ee=0;ee<N;ee++){let O={};R[ee]=O,O.img=Ot(e),B+=2;let ue=[];O.pos=ue;let We=ke(e);for(let ze=0;ze<We;ze++)ue[ze]=Ot(e),B+=2;O.world=qe(e),B+=1}let Y=[];n.particles=Y;let _e=ke(e);for(let ee=0;ee<_e;ee++){let O={};Y[ee]=O;let ue=[];O.acc=ue;let We=ke(e);for(let mt=0;mt<We;mt++)ue[mt]=lt(e),B+=4;O.blend=qe(e),B+=1;let ze=[];O.colEnd=ze;let Ae=ke(e);for(let mt=0;mt<Ae;mt++)ze[mt]=lt(e),B+=4;let $e=[];O.colStart=$e;let Ue=ke(e);for(let mt=0;mt<Ue;mt++)$e[mt]=lt(e),B+=4;O.duration=lt(e),B+=4,O.friction=lt(e),B+=4,O.id=qe(e),B+=1,O.idEnd=qe(e),B+=1,O.idLoop=qe(e),B+=1,O.idStart=qe(e),B+=1,O.interp=qe(e),B+=1,O.randomRota=lt(e),B+=4,O.rota=lt(e),B+=4,O.rotaEnd=lt(e),B+=4,O.scaleEnd=lt(e),B+=4,O.scaleStart=lt(e),B+=4}let Fe=[];n.ribbons=Fe;let he=ke(e);for(let ee=0;ee<he;ee++){let O={};Fe[ee]=O;let ue=[];O.colEnd=ue;let We=ke(e);for(let $e=0;$e<We;$e++)ue[$e]=lt(e),B+=4;let ze=[];O.colStart=ze;let Ae=ke(e);for(let $e=0;$e<Ae;$e++)ze[$e]=lt(e),B+=4;O.id=qe(e),B+=1,O.interval=lt(e),B+=4,O.steps=qe(e),B+=1,O.texture=Ot(e),B+=2}let ie=[];n.skeletons=ie;let le=ke(e);for(let ee=0;ee<le;ee++){let O={};ie[ee]=O,O.cape=!!_s(e),B+=1,O.groundNormal=!!_s(e),B+=1,O.height=lt(e),B+=4,O.helmet=!!_s(e),B+=1,O.id=qe(e),B+=1,O.shoulders=!!_s(e),B+=1}let ge=[];n.skins=ge;let be=ke(e);for(let ee=0;ee<be;ee++){let O={};ge[ee]=O,O.animset=qe(e),B+=1;let ue=[];O.body=ue;let We=ke(e);for(let Ve=0;Ve<We;Ve++){let ye={};ue[Ve]=ye,ye.bid=qe(e),B+=1;let Vt=[];ye.col=Vt;let Ht=ke(e);for(let Ze=0;Ze<Ht;Ze++)Vt[Ze]=lt(e),B+=4;ye.colMode=qe(e),B+=1,ye.lod=qe(e),B+=1,ye.mid=Ot(e),B+=2,ye.pid=_s(e),B+=1;let Lt=[];ye.pos=Lt;let Rt=ke(e);for(let Ze=0;Ze<Rt;Ze++)Lt[Ze]=lt(e),B+=4;let He=[];ye.rot=He;let et=ke(e);for(let Ze=0;Ze<et;Ze++)He[Ze]=lt(e),B+=4;let Ee=[];ye.scl=Ee;let it=ke(e);for(let Ze=0;Ze<it;Ze++)Ee[Ze]=lt(e),B+=4;ye.ts=qe(e),B+=1}O.capeswing=qe(e),B+=1;let ze=[];O.colPrim=ze;let Ae=ke(e);for(let Ve=0;Ve<Ae;Ve++)ze[Ve]=lt(e),B+=4;let $e=[];O.colSec=$e;let Ue=ke(e);for(let Ve=0;Ve<Ue;Ve++)$e[Ve]=lt(e),B+=4;let mt=[];O.effects=mt;let wt=ke(e);for(let Ve=0;Ve<wt;Ve++){let ye={};mt[Ve]=ye,ye.bid=qe(e),B+=1,ye.id=qe(e),B+=1}O.id=qe(e),B+=1,O.mountPart=qe(e),B+=1;let Je=[];O.mountPos=Je;let Et=ke(e);for(let Ve=0;Ve<Et;Ve++)Je[Ve]=lt(e),B+=4;let xe=[];O.sheathedPos=xe;let Ke=ke(e);for(let Ve=0;Ve<Ke;Ve++)xe[Ve]=lt(e),B+=4;O.size=lt(e),B+=4,O.skeleton=qe(e),B+=1,O.soundset=qe(e),B+=1;let bt=[];O.unsheathedPos=bt;let Ct=ke(e);for(let Ve=0;Ve<Ct;Ve++)bt[Ve]=lt(e),B+=4}let Te=[];n.sounds=Te;let se=ke(e);for(let ee=0;ee<se;ee++){let O={};Te[ee]=O,O.distance=lt(e),B+=4;let ue=[];O.files=ue;let We=ke(e);for(let ze=0;ze<We;ze++)ue[ze]=Ot(e),B+=2;O.id=qe(e),B+=1}let Ie=[];n.soundsetSteps=Ie;let K=ke(e);for(let ee=0;ee<K;ee++){let O={};Ie[ee]=O,O.id=qe(e),B+=1;let ue=[];O.steps=ue;let We=ke(e);for(let ze=0;ze<We;ze++)ue[ze]=qe(e),B+=1}let Re=[];n.soundsets=Re;let Ge=ke(e);for(let ee=0;ee<Ge;ee++){let O={};Re[ee]=O,O.id=qe(e),B+=1;let ue=[];O.sounds=ue;let We=ke(e);for(let ze=0;ze<We;ze++)ue[ze]=qe(e),B+=1;O.steps=qe(e),B+=1}let Qe=[];n.terrains=Qe;let Ye=ke(e);for(let ee=0;ee<Ye;ee++){let O={};Qe[ee]=O,O.brightest=qe(e),B+=1,O.darkest=qe(e),B+=1;let ue=[];O.foliage=ue;let We=ke(e);for(let ze=0;ze<We;ze++){let Ae=[];ue[ze]=Ae;let $e=ke(e);for(let Ue=0;Ue<$e;Ue++)Ae[Ue]=qe(e),B+=1}O.id=qe(e),B+=1,O.scale=qe(e),B+=1,O.spec=qe(e),B+=1,O.texture=Ot(e),B+=2}let pe=[];n.traderShopItems=pe;let ce=ke(e);for(let ee=0;ee<ce;ee++){let O={};pe[ee]=O,O.bind=qe(e),B+=1,O.id=qe(e),B+=1,O.shop=qe(e),B+=1,O.stacks=qe(e),B+=1,O.tier=Ot(e),B+=2,O.type=Ln(e),O.upgrade=qe(e),B+=1}let Oe=[];n.worlds=Oe;let oe=ke(e);for(let ee=0;ee<oe;ee++){let O={};Oe[ee]=O,O.chunkAmount=qe(e),B+=1,O.id=qe(e),B+=1,O.minlevel=qe(e),B+=1,O.music=qe(e),B+=1,O.name=Ln(e)}return n}};var Mt={clientPlayerInput:l3,clientPlayerChangeTarget:a3,clientPlayerSkill:c3,clientPlayerEnvSkill:f3,clientPlayerInteract:u3,clientCommand:m3,serverOnClientConnect:k3,serverEntityDelta:p3,serverPartyUpdate:d3,serverWarUpdate:h3,serverPartyPositions:g3,serverChangeWorld:b3,serverMapUpdate:v3,serverChat:_3,serverSystemMessage:y3,serverQueue:x3,ping:w3},Sa={chunk:M3,gamedata:C3,modelformat:F3},S3=[],G7=0;for(let t in Mt)Mt[t]&&(Mt[t].header=G7++,Mt[t].packData=function(e){return e._header=this.header,this.encode(e)},S3.push(Mt[t]));var P3=t=>{if(t.length===0)return;let e=S3[t[0]];if(!(e&&e.maxSize<t.length))return e};var I,Tp=[0,1,0];var _t=[0,0,0],kn=[0,0,0],tl=[0,0,0],bs=[0,0,0],Ep=[0,0,0],Sf=[0,0,0];var Mi=[0,0,0,0];var $n=[0,0],Ks=[0,0];var EO=gs(),A3=t=>{I=t},Fi=0,T3=t=>Fi=t;var f1={};Kn(f1,{onWorldEnter:()=>Y7,parseBandwidth:()=>a1,parseFrameDelta:()=>E3,parseLatency:()=>c1,tick:()=>H7});var gt=(t,e,n)=>Math.min(Math.max(t,e),n),Pa=(t,e)=>(t%e+e)%e,Pf=(t,e,n)=>{let o=gt((n-t)/(e-t),0,1);return o*o*(3-2*o)},ys=(t,e,n,o,s)=>o+(gt(t,e,n)-e)/(n-e)*(s-o),Af=(t,e,n)=>e+gt(t,0,1)*(n-e),Jt={linear:t=>t,easeInQuad:t=>t*t,easeInQuart:t=>t**4,easeOutQuad:t=>t*(2-t),easeOutExpo:t=>-Math.pow(2,-10*t)+1,easeOutFlick:t=>1-Math.pow(1-t,10),sin:t=>Math.sin(t*3.14),sinReverse:t=>1-Math.sin(t*3.14),easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeBounce:t=>t<.36363636363636365?7.5625*t*t:t<.7272727272727273?7.5625*(t-=.5454545454545454)*t+.75:t<.9090909090909091?7.5625*(t-=.8181818181818182)*t+.9375:7.5625*(t-=.9545454545454546)*t+.984375,anticipate:t=>-1/(1+Math.exp((t-.5)*50))+Math.sin((t-.5)*6.2)*1.4*(1-t*.5)+1,flicker:t=>Math.sin(t*3.14)*(1+Math.sin(t*38)*.3)},er=(t,e,n)=>t<e?ys(t,0,e,0,n):ys(Jt.easeInOutCubic(ys(t,e,1,0,1)),0,1,n,1),Aa=[Jt.linear,Jt.easeInQuad,Jt.easeInQuart,Jt.easeOutQuad,Jt.easeOutExpo,Jt.easeOutFlick,Jt.sin,Jt.sinReverse,Jt.easeInOutCubic,Jt.easeInOutQuint,Jt.easeBounce,Jt.anticipate,Jt.flicker];var kt=class{constructor(e=0,n=0){this.start=e,this.end=e+n,this.duration=n}done(e){return e>this.end}fraction(e){return gt(1-(this.end-e)/this.duration,0,1)}remaining(e){return this.end-e}passed(e){return e-this.start}reset(e,n=this.duration){return this.start=e,this.end=e+n,this.duration=n,!0}set(e,n){return this.start=e,this.end=n,this.duration=this.end-this.start,!0}};var i1=.016,E3=t=>{i1=(i1*10+t)/11},I3=0,o1=0,a1=t=>{I3=t},r1=0,c1=t=>{r1=(r1*2+t)/3},s1=0,l1=new kt(0,.05),H7=t=>{E3(t),fe.showFpsPing&&l1.done(I.time)&&(o1=(o1*10+I3)/11,s1=(s1*5+I.netData.length)/6,l1.reset(I.time),xm.update(e=>(e[0]=gt(r1>>0,1,999),e[1]=(1/i1).toFixed(1),e[2]=(o1/1e3).toFixed(1),e[3]=I.player?`${~~I.player.pos[0]} ${~~I.player.pos[1]} ${~~I.player.pos[2]}`:"-",e[4]=s1.toFixed(1),e)))},Y7=t=>{l1.reset(t.time)};var X7=performance,Tf=()=>X7.now();var ks,m1=0,D3=0,q3=(t,e)=>{Un(Mt.serverOnClientConnect.header,n=>{t(Mt.serverOnClientConnect.decode(n))}),Un("close",n=>{e(n.code)})},nl={open:[],close:[]};for(let t in Mt)nl[Mt[t].header]=[];var Q7=t=>{},Z7=t=>{console.log("Connected"),m1=1;for(let e=0,n=nl.open.length;e<n;++e)nl.open[e](t)},J7=t=>{console.log("Connection closed:",t.reason,t.code),m1=0,ks.close(),ks=void 0;for(let e=0,n=nl.close.length;e<n;++e)nl.close[e](t)},K7=t=>{eT(t.data.byteLength),t=new Uint8Array(t.data);let e=P3(t),n=e&&nl[e.header];if(n)for(let o=0,s=n.length;o<s;++o)n[o](t)},Un=(t,e)=>{nl[t].push(e)},Io=t=>{ks===void 0||m1!==1||ks.send(t)},R3=t=>{if(ks!==void 0)return;let e="game1.hordes.io";ks=new WebSocket(`wss://${e}:`+t+"/play"),ks.binaryType="arraybuffer",ks.onerror=Q7,ks.onopen=Z7,ks.onclose=J7,ks.onmessage=K7};var V3=0,u1=0,eT=t=>{u1+=t,Fi-V3>1e3/4&&(D3=u1*4,u1=0,V3=Fi,a1(D3))},z3=()=>{fe.showFpsPing&&Fi-L3>(If.length<10?100:2e3)&&(L3=Fi,tT())},B3=t=>{if(If[t.id]){let e=Tf();if(If[t.id]<=e){let n=e-If[t.id];c1(n)}}},Ef=0,L3=0,If=[],tT=()=>{Ef>254&&(Ef=0),If[Ef]=Tf(),Io(Mt.ping.packData({id:Ef})),Ef++};var yt=(t,e="")=>{Io(Mt.clientCommand.packData({command:t,string:e+""}))};var sl={report:{client:!0},partyleave:{},partyinvite:{a:1},partycreate:{},time:{},bosslog:{},party:{a:1,chat:!0},clan:{a:1,chat:!0},faction:{a:1,chat:!0}},Ci={itemmove:{a:2},itemdrop:{a:1},itemauctionpost:{a:2},itemauctionfind:{a:5},itemauctionbuy:{a:1},itemauctioncancel:{a:1},itemstash:{a:1},itemunstash:{a:1},itemsplithalf:{a:1},itemsplitone:{a:1},goldstash:{a:1},itemtradersell:{a:1},itemtraderbuy:{a:1},itemblacksmithupgrade:{a:1},tutstep:{a:2},petlootsettings:{a:2},statincrease:{a:2},skillconfig:{a:1},cancelbuff:{a:1},respawn:{},startqueue:{a:1},stopqueue:{a:1},partyaccept:{a:1},partydecline:{a:1},partykick:{a:1},partysetrole:{a:2},summonaccept:{a:1},whisper:{a:2,chat:!0},global:{a:1},...sl};var $3=t=>{navigator.clipboard.writeText(t)};var h1={};Kn(h1,{addRequest:()=>Ta,confirmationBasedCallback:()=>Dp,onWorldDestroy:()=>sT,onWorldEnter:()=>oT,postTick:()=>nT,removeTopRequest:()=>d1});var p1=new kt(0,1),ei=[],nT=(t,e)=>{p1.done(e.time)&&(p1.reset(e.time),ei.length&&(ei.forEach(n=>{U3(n,1)}),ui.set(ei)))},oT=t=>{p1.reset(0)},sT=t=>{ei.length=0,ui.set(ei)},Ta=(t,e,n)=>{let o={title:t,text:e,choices:n};ei.push(o),U3(o,0),ui.set(ei)},U3=(t,e)=>{for(let n=0;n<t.choices.length;++n){let o=t.choices[n];if(o.blockedTime!==void 0)o.blockedTime>1?(o.blockedTime-=e,o.unavailable=`(${o.blockedTime} s)`):o.unavailable=void 0;else if(o.nocombat&&I&&I.player&&I.player.stats){let s=~~I.player.stats.combatTimer.remaining(I.time);s>0?o.unavailable=`(Combat - ${s}s)`:o.unavailable=void 0}o.remaining!==void 0&&(o.remaining>1?(o.remaining-=e,o.additional=`(${~~o.remaining}s remaining)`):(o.additional=void 0,o.unavailable="(Timed out)"))}},d1=()=>{ei.length&&(ei.shift(),ui.set(ei))},Ip=!0,Dp=(t,e,n,o)=>{t?Ip&&(Ta(n,o,[{text:n,fun:()=>{Ip=!0,e()}},{text:P.ui.decline,fun:()=>{Ip=!0}}]),Ip=!1):e()};var Lp={};Kn(Lp,{init:()=>rT,onRemoveEntity:()=>v1,onWorldDestroy:()=>aT,party:()=>Xt,postTick:()=>lT,setListed:()=>g1});var Vp,iT=0,Df=0,O3=!1,g1=t=>{O3=t},Xt=new Map,rT=()=>{Un(Mt.serverPartyUpdate.header,t=>{Vp=t}),Un(Mt.serverPartyPositions.header,t=>{t=Mt.serverPartyPositions.decode(t).members,Xt.forEach(e=>{let n=t.find(o=>o.entityid===e.id);n&&(e.pos[0]=n.pos[0],e.pos[1]=n.pos[1])})})},lT=(t,e)=>{if(e.player!==void 0){if(Vp){Xt.forEach(o=>{o.found=!1});let n=Mt.serverPartyUpdate.decode(Vp);n.members.forEach(o=>{if(!Xt.has(o.name))Xt.set(o.name,{id:o.entityid,found:!0,pos:[0,0],local:o.world===e.id,name:o.name,buffStore:o.entityid===e.playerId?ca:te([]),unitStore:o.entityid===e.playerId?Ws:te({id:o.entityid,name:o.name,level:o.level,class:o.class,world:o.world,role:o.role,party:e.player.party,faction:e.player.faction,type:0,visible:!0,alive:!0,rarity:!1,range:!1})});else{let s=Xt.get(o.name);o.entityid!==e.playerId&&(s.local=o.world===e.id,s.unitStore.update(i=>(i.id=o.entityid,i.name=o.name,i.level=o.level,i.class=o.class,i.world=o.world,i.party=e.player.party,i.faction=e.player.faction,i.role=o.role,i))),s.id=o.entityid,s.found=!0}}),Xt.forEach((o,s)=>{o.found||Xt.delete(s)}),aa.set(Array.from(Xt.values()).filter(o=>fe.showSelfInParty||o.id!==e.playerId)),eo.update(o=>(o.membercount=n.members.length,o.queues=n.queues,fe.partyinfo=o,o)),Vp=void 0}if(e.player.party>0)if(!fe.partyBuffLimitUpdateRate)e.entities.type[0].forEach(n=>{n.party===e.player.party&&(n.buffDisplayDirty=!0)});else{let n=Array.from(Xt.values())[iT++%Xt.size];if(n){let o=e.entity(n.id);o!==void 0&&o.id!==e.playerId&&(o.buffDisplayDirty=!0)}}}fe.leaveEmptyParty&&(Xt.size!==1||O3?Df=0:(Df+=t,Df>35&&(yt("partyleave"),Df=0)))},v1=t=>{if(Xt.has(t.name)){let e=Xt.get(t.name);e.unitStore.update(n=>(n.timedSkill=void 0,n.timedCast=void 0,n.alive=!0,n.range=!1,n.mp=n.hp=n.hpMax=n.mpMax=0,n)),e.buffStore.set([])}},aT=()=>{Xt.clear(),Df=0};var X1={};Kn(X1,{onWorldEnter:()=>L9,postTick:()=>q9,steps:()=>ko,tut:()=>an});function N3(t,e){return t[0]=e[0],t[1]=e[1],t}function _o(t,e,n){return t[0]=e,t[1]=n,t}function j3(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function Ea(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Vf(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function _1(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t}function Ia(t){let e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function W3(t){let e=t[0],n=t[1];return e*e+n*n}function qp(t,e){let n=e[0],o=e[1],s=n*n+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t}function G3(t,e,n){let o=Math.sin(n),s=Math.cos(n);return t[0]=e[1]*o+e[0]*s,t[1]=e[1]*s-e[0]*o,t}var Rp=[0,0,0],H3=(t,e,n,o,s)=>{if(t.length>0){X(e,1/0,1/0,1/0),X(n,-1/0,-1/0,-1/0);for(let i=0,r=t.length;i<r;i+=3){let l=t[i],a=t[i+1],c=t[i+2];e[0]=Math.min(l,e[0]),e[1]=Math.min(a,e[1]),e[2]=Math.min(c,e[2]),n[0]=Math.max(l,n[0]),n[1]=Math.max(a,n[1]),n[2]=Math.max(c,n[2])}}else X(e,0,0,0),X(n,-0,-0,-0);Zt(s,n,e),gn(o,Bn(o,e,n),.5)},cT=t=>{H3(t.attributes.position.data,t.bounds.min,t.bounds.max,t.bounds.center,t.bounds.scale),t.bounds.initiated=!0},fT=t=>{let e=0;for(let n=0,o=t.attributes.position.data.length;n<o;n+=3)Rp[0]=t.attributes.position.data[n],Rp[1]=t.attributes.position.data[n+1],Rp[2]=t.attributes.position.data[n+2],e=Math.max(e,oo(t.bounds.center,Rp));t.bounds.radius=Math.sqrt(e)},Y3=t=>{t.bounds.initiated||cT(t),fT(t)};var uT=1,mT=1,Sn=t=>{let e={id:uT++,vao:O2(),vaoNeedsUpdate:!0,attributes:t,drawRangeStart:0,drawRangeCount:0,attrRange:0,instancedCount:0,isInstanced:!1,bounds:{min:[0,0,0],max:[0,0,0],center:[0,0,0],scale:[0,0,0],radius:1/0,initiated:!1}};return b1(e,e.attributes),e},bo=(t,e)=>{tt.boundBuffer!==e.id&&(j.bindBuffer(e.target,e.buffer),tt.boundBuffer=e.id),e.bufferLen<e.data.length?(e.bufferLen=e.data.length,j.bufferData(e.target,e.data,e.bufferMode,0,e.data.length)):j.bufferSubData(e.target,0,e.data,0,e.data.length)},zp=(t,e,n)=>{tt.boundBuffer!==e.id&&(j.bindBuffer(e.target,e.buffer),tt.boundBuffer=e.id);let o=n*e.size;e.bufferLen<o?(e.bufferLen=o,j.bufferData(e.target,e.data,e.bufferMode,0,o)):j.bufferSubData(e.target,0,e.data,0,o)},pT=(t,e,n)=>{n.id=mT++,n.size=n.size||1,n.type=n.type||(n.data.constructor===Float32Array?j.FLOAT:n.data.constructor===Uint16Array?j.UNSIGNED_SHORT:j.UNSIGNED_INT),n.target=e==="index"?j.ELEMENT_ARRAY_BUFFER:j.ARRAY_BUFFER,n.normalize=n.normalize||!1,n.count=n.data.length/n.size,n.divisor=n.instanced?typeof n.instanced=="number"?n.instanced:1:0,n.bufferMode=n.bufferMode||j.STATIC_DRAW,n.bufferLen=0,n.buffer||(n.buffer=j.createBuffer()),bo(t,n)},dT=(t,e,n)=>{if(t.attributes[e]=n,n.divisor){if(t.isInstanced=!0,t.instancedCount&&t.instancedCount!==n.count*n.divisor)return t.instancedCount=Math.min(t.instancedCount,n.count*n.divisor);t.instancedCount=n.count*n.divisor}else e==="index"?t.drawRangeCount=n.count:t.attributes.index||(t.drawRangeCount=Math.max(t.drawRangeCount,n.count))},b1=(t,e)=>{Bm(null),tt.currentGeometry=-1;for(let n in e)e[n].id===void 0&&pT(t,n,e[n]),dT(t,n,e[n]);t.attributes.position&&Y3(t)},Q3=(t,e,n)=>{t.attrRange=n,t.drawRangeStart=e,t.drawRangeCount=n},Bp=(t,e)=>{t.instancedCount=e},hT=(t,e)=>{Bm(t.vao);for(let n=0;n<e.attributeLocations.length;++n){let o=e.attributeLocations[n];if(!t.attributes[o])continue;let s=t.attributes[o];if(j.bindBuffer(j.ARRAY_BUFFER,s.buffer),tt.boundBuffer=s.id,s.size>4){let i=s.size/4,r=i*4,l=r*4;for(let a=0;a<i;++a)j.vertexAttribPointer(n+a,i,j.FLOAT,!1,l,r*a),j.enableVertexAttribArray(n+a),ya(n+a,1)}else j.vertexAttribPointer(n,s.size,s.type,s.normalize,0,0),j.enableVertexAttribArray(n),ya(n,s.divisor)}t.attributes.index&&j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,t.attributes.index.buffer),t.vaoNeedsUpdate=!1},Da=(t,e)=>{tt.currentGeometry!==t.id&&(t.vaoNeedsUpdate&&hT(t,e),Bm(t.vao),tt.currentGeometry=t.id)},Va=(t,e,n)=>{Da(t,e),t.isInstanced?t.attributes.index?U2(n,t.drawRangeCount,t.attributes.index.type,t.drawRangeStart,t.instancedCount):$2(n,t.drawRangeStart,t.drawRangeCount,t.instancedCount):t.attributes.index?j.drawElements(n,t.drawRangeCount,t.attributes.index.type,t.drawRangeStart):j.drawArrays(n,t.drawRangeStart,t.drawRangeCount)};var gT=1,un=({vertex:t,fragment:e,uniforms:n={},instanced:o=[],active:s=!0,transparent:i=!1,cullFace:r=j.BACK,frontFace:l=j.CCW,depthTest:a=!0,depthWrite:c=!0,depthFunc:f=j.LESS,globalUniforms:u={},attributeLocations:m})=>{let g={id:gT++,program:j.createProgram(),active:s,transparent:i,cullFace:r,frontFace:l,depthTest:a,depthWrite:c,depthFunc:f,blendFunc:{},blendEquation:{},uniforms:n,autoUniforms:[],uniformArray:[],samplerNames:[],samplerTexUnits:[],samplerTexArray:[],samplerTextures:[],globalUniforms:u,instancedAttributes:o,attributeLocations:m};g.transparent&&!g.blendFunc.src&&qf(g,j.SRC_ALPHA,j.ONE_MINUS_SRC_ALPHA);let v=Z3(t,j.VERTEX_SHADER),_=Z3(e,j.FRAGMENT_SHADER);for(let b=0;b<m.length;++b)j.bindAttribLocation(g.program,b,m[b]);return j.attachShader(g.program,v),j.attachShader(g.program,_),j.linkProgram(g.program),j.deleteShader(v),j.deleteShader(_),g},J3=(t,e)=>{j.useProgram(t.program),tt.currentProgram=t.id;let n=j.getProgramParameter(t.program,j.ACTIVE_UNIFORMS),o=0,s=2;for(let i=0;i<n;i++){let r=j.getActiveUniform(t.program,i),l=j.getUniformLocation(t.program,r.name);if(l===null)continue;let a=r.name.match(/(\w+)/g)[0],c=r.type,f=c===35678||c===35682||c===36289,u=c===35682;if(f){let m=r.size,g=[];for(let v=0;v<m;++v){let _=u?o++:s++;g.push(_),t.samplerNames.push(a),t.samplerTexUnits.push(_),t.samplerTexArray.push(m===1?-1:v)}m===1?j.uniform1i(l,g[0]):j.uniform1iv(l,g)}else{e[a]?t.uniforms[a]||(t.uniforms[a]=e[a]):t.uniforms[a]||(bT.has(a)||t.autoUniforms.push(a),t.uniforms[a]={value:void 0});let m={name:a,location:l,type:c,data:t.uniforms[a],fun:_T(c,t.uniforms[a].value)};t.uniformArray.push(m)}}},K3=(t,e)=>{for(let n=0;n<e.length;++n){let o=e[n],s=j.getUniformBlockIndex(t.program,o.name);s!==j.INVALID_INDEX&&o.index>=0&&j.uniformBlockBinding(t.program,s,o.index)}},La=(t,e)=>{e||(j.useProgram(t.program),tt.currentProgram=t.id),qa(t),k1(t.uniformArray),Lf(t),Ra(t)},qn=(t,e,n,o)=>{let s=o.samplerNames.indexOf(t);s>=0?o.samplerTextures[s+n]=e:console.log("unknown texture type",t,o)},qa=t=>{for(let e=0;e<t.samplerNames.length;++e){let n=t.samplerNames[e],o=t.samplerTexArray[e];t.globalUniforms[n]&&t.globalUniforms[n].value&&(o<0?t.samplerTextures[e]=t.globalUniforms[n].value:t.samplerTextures[e]=t.globalUniforms[n].value[o])}},$p=(t,e)=>{for(let n=0;n<e.samplerNames.length;++n){let o=e.samplerNames[n],s=e.samplerTexArray[n];t[o]&&(s<0?e.samplerTextures[n]=t[o]:e.samplerTextures[n]=t[o][s])}},Lf=t=>{for(let e=0;e<t.samplerTexUnits.length;++e){let n=t.samplerTexUnits[e],o=t.samplerTextures[e];o&&tt.textureUnits[n]!==o.id&&(tf(n),j.bindTexture(o.target,o.texture),tt.textureUnits[n]=o.id)}},qf=(t,e,n,o,s)=>{t.blendFunc.src=e,t.blendFunc.dst=n,t.blendFunc.srcAlpha=o,t.blendFunc.dstAlpha=s,e&&(t.transparent=!0)},y1={},Z3=(t,e)=>{if(y1[t]!==void 0)return y1[t];let n=y1[t]=j.createShader(e);return j.shaderSource(n,t),j.compileShader(n),n},Ra=t=>{t.depthTest?ef(j.DEPTH_TEST):$m(j.DEPTH_TEST),t.cullFace?ef(j.CULL_FACE):$m(j.CULL_FACE),t.blendFunc.src?ef(j.BLEND):$m(j.BLEND),t.cullFace&&H2(t.cullFace),Y2(t.frontFace),Gh(t.depthWrite),X2(t.depthFunc),t.blendFunc.src&&W2(t.blendFunc.src,t.blendFunc.dst,t.blendFunc.srcAlpha,t.blendFunc.dstAlpha),t.blendEquation.modeRGB&&G2(t.blendEquation.modeRGB,t.blendEquation.modeAlpha)},k1=t=>{for(let e=0;e<t.length;++e){let n=t[e];vT(j,n.fun,n.location,n.data.value)}};var vT=(t,e,n,o)=>{switch(e){case 12:return t.uniformMatrix4fv(n,!1,o);case 9:return t.uniform4fv(n,o);case 8:return t.uniform3fv(n,o);case 5:return t.uniform1f(n,o);case 0:return t.uniform1i(n,o);case 1:return t.uniform1iv(n,o);case 2:return t.uniform2iv(n,o);case 3:return t.uniform3iv(n,o);case 4:return t.uniform4iv(n,o);case 6:return t.uniform1fv(n,o);case 7:return t.uniform2fv(n,o);case 10:return t.uniformMatrix2fv(n,!1,o);case 11:return t.uniformMatrix3fv(n,!1,o)}},_T=(t,e)=>{switch(t){case 5126:return Array.isArray(e)?6:5;case 35664:return 7;case 35665:return 8;case 35666:return 9;case 35670:case 5124:case 35678:case 35682:case 36289:case 35680:return Array.isArray(e)?1:0;case 35671:case 35667:return 2;case 35672:case 35668:return 3;case 35673:case 35669:return 4;case 35674:return 10;case 35675:return 11;case 35676:return 12}};var bT=new Set(["projectionViewMatrix","shadowPVMatrix","modelMatrix","viewMatrix","projectionMatrix","cameraPosition"]);var yT=0,$o=(t,e,n,o=sn(),s=0)=>({id:yT++,uniformData:{},transform:o,geometry:t,program:e,shadowProgram:s,mode:n}),ns=(t,e)=>{e.uniforms.modelMatrix&&(e.uniforms.modelMatrix.value=t.transform.worldMatrix);for(let n=0;n<e.autoUniforms.length;++n){let o=e.autoUniforms[n];e.uniforms[o].value=t.uniformData[o]}$p(t.uniformData,e),La(e,tt.currentProgram===e.id),Va(t.geometry,e,t.mode)};function ey(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function ty(t,e,n){switch(t){case ny:return(e+3>>2)*(n+3>>2)*8;case oy:return(e+3>>2)*(n+3>>2)*16;default:return 0}}var ny=33777,oy=33778,kT=131072,xT=31,wT=1,MT=2,FT=3,CT=4,ST=7,PT=21,AT=ey("DXT1"),TT=ey("DXT3");function sy(t){let e=new Int32Array(t,0,xT),n=e[PT],o;switch(n){case AT:o=ny;break;case TT:o=oy;break;default:console.error("Unsupported texture"+n)}let s=1;e[MT]&kT&&(s=Math.max(1,e[ST]));let i=e[CT],r=e[FT],l=e[wT]+4;return{data:new Uint8Array(t,l),width:i,height:r,levels:s,internalFormat:o}}var IT=1,tr=function({image:t,buffer:e,target:n=j.TEXTURE_2D,type:o=j.UNSIGNED_BYTE,format:s=j.RGBA,internalFormat:i=s,wrapS:r=j.CLAMP_TO_EDGE,wrapT:l=j.CLAMP_TO_EDGE,generateMipmaps:a=!0,minFilter:c=a?j.LINEAR_MIPMAP_LINEAR:j.LINEAR,magFilter:f=j.LINEAR,flipY:u=!0,width:m,depth:g=0,height:v=m,compareMode:_=j.NONE,compareFunc:b=j.LEQUAL,anisotropy:k=1}){return{id:IT++,image:t,buffer:e,target:n,type:o,format:s,internalFormat:i,minFilter:c,magFilter:f,wrapS:r,wrapT:l,generateMipmaps:a,flipY:u,width:m,height:v,depth:g,compareMode:_,texture:j.createTexture(),anisotropy:Math.min(Math.max(1,k),tt.maxAnisotropy),needsUpdate:!0,state:{flipY:!1,minFilter:j.NEAREST_MIPMAP_LINEAR,magFilter:j.LINEAR,wrapS:j.REPEAT,wrapT:j.REPEAT,compareMode:j.NONE,anisotropy:1,image:void 0}}},iy=t=>{tt.textureUnits[tt.activeTextureUnit]!==t.id&&(j.bindTexture(t.target,t.texture),tt.textureUnits[tt.activeTextureUnit]=t.id)},os=(t,e=0)=>{let n=!(t.image===t.state.image&&!t.needsUpdate);if((n||tt.textureUnits[e]!==t.id)&&(tf(e),iy(t)),!!n){if(t.needsUpdate=!1,t.flipY!==tt.flipY&&(j.pixelStorei(j.UNPACK_FLIP_Y_WEBGL,t.flipY),tt.flipY=t.flipY),t.minFilter!==t.state.minFilter&&(j.texParameteri(t.target,j.TEXTURE_MIN_FILTER,t.minFilter),t.state.minFilter=t.minFilter),t.magFilter!==t.state.magFilter&&(j.texParameteri(t.target,j.TEXTURE_MAG_FILTER,t.magFilter),t.state.magFilter=t.magFilter),t.wrapS!==t.state.wrapS&&(j.texParameteri(t.target,j.TEXTURE_WRAP_S,t.wrapS),t.state.wrapS=t.wrapS),t.wrapT!==t.state.wrapT&&(j.texParameteri(t.target,j.TEXTURE_WRAP_T,t.wrapT),t.state.wrapT=t.wrapT),t.anisotropy!==t.state.anisotropy&&(j.texParameterf(t.target,Wh.TEXTURE_MAX_ANISOTROPY_EXT,t.anisotropy),t.state.anisotropy=t.anisotropy),t.compareMode!==t.state.compareMode&&(j.texParameteri(t.target,j.TEXTURE_COMPARE_MODE,t.compareMode),t.state.compareMode=t.compareMode),t.image)t.image.width&&(t.width=t.image.width,t.height=t.image.height),j.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.type,t.image),t.generateMipmaps&&j.generateMipmap(t.target);else if(t.buffer){let o=0,s=t.height,i=t.width,r=t.buffer.data;for(let l=0;l<t.buffer.levels;++l){let a=ty(t.internalFormat,s,s),c=new Uint8Array(r.buffer,r.byteOffset+o,a);j.compressedTexImage2D(t.target,l,t.internalFormat,i,s,0,c),i=i>>1,s=s>>1,o+=a}}else t.target!==j.TEXTURE_2D_ARRAY?j.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.type,null):j.texImage3D(t.target,0,t.internalFormat,t.width,t.height,t.depth,0,t.format,t.type,null);t.state.image=t.image}},Up=(t,e)=>{t.anisotropy=Math.min(Math.max(1,e),tt.maxAnisotropy),t.needsUpdate=!0};var ry=(t,e,n,o,s)=>{tf(0),iy(t),t.flipY!==tt.flipY&&(j.pixelStorei(j.UNPACK_FLIP_Y_WEBGL,t.flipY),tt.flipY=t.flipY),j.texSubImage3D(t.target,0,0,0,e,n,o,1,t.format,t.type,s),t.generateMipmaps&&j.generateMipmap(t.target)};var Pi=(t=j.canvas.width,e=j.canvas.height,n=1,o=!1,s=j.NONE,i=j.CLAMP_TO_EDGE,r=j.CLAMP_TO_EDGE)=>{let l=j.LINEAR,a=j.LINEAR,c={width:t,height:e,target:j.FRAMEBUFFER,buffer:j.createFramebuffer()};if(j.bindFramebuffer(c.target,c.buffer),n&&(c.colorTexture=tr({width:t,height:e,wrapS:i,wrapT:r,minFilter:l,magFilter:a,flipY:!1,generateMipmaps:!1,internalFormat:j.RGBA8}),os(c.colorTexture),j.framebufferTexture2D(c.target,j.COLOR_ATTACHMENT0,j.TEXTURE_2D,c.colorTexture.texture,0)),o){let f=s===j.COMPARE_REF_TO_TEXTURE?j.LINEAR:j.NEAREST;c.depthTexture=tr({width:t,height:e,wrapS:i,wrapT:r,minFilter:f,magFilter:f,flipY:!1,format:j.DEPTH_COMPONENT,internalFormat:j.DEPTH_COMPONENT24,type:j.UNSIGNED_INT,generateMipmaps:!1,compareMode:s}),os(c.depthTexture),j.framebufferTexture2D(c.target,j.DEPTH_ATTACHMENT,j.TEXTURE_2D,c.depthTexture.texture,0)}return j.bindFramebuffer(c.target,null),c},Rf=(t,e,n)=>{t.colorTexture.width=e,t.colorTexture.height=n,t.colorTexture.needsUpdate=!0,os(t.colorTexture),t.depthTexture&&(t.depthTexture.width=e,t.depthTexture.height=n,t.depthTexture.needsUpdate=!0,os(t.depthTexture)),t.width=e,t.height=n};var Ft=async(t,e,n)=>{let o=await fetch(t,{method:e!==void 0?"POST":"GET",body:e?JSON.stringify(e):void 0});return o.status===500?n(await o.text()):await o.json()};var Np=new Map,zf=new Map,jp=new Map,w1=new Map,M1=new Map,za=new Map,Ms=new Map,F1=new Map,Ba=new Map,$a=new Map,Bf=new Map,Ua=new Map,$f=new Map,C1=new Map,S1=new Map,P1=new Map,A1=new Map,DT=new Map,T1=new Map,Uf=new Map,Of=[],Nf=[],E1=new Map,Wp=new Map;var x1=t=>{t.classes.forEach(e=>Wp.set(e.id,e)),t.files.forEach(e=>za.set(e.id,e)),t.particles.forEach(e=>Np.set(e.id,e)),t.effects.forEach(e=>zf.set(e.id,e)),t.sounds.forEach(e=>jp.set(e.id,e)),t.soundsets.forEach(e=>w1.set(e.id,e)),t.soundsetSteps.forEach(e=>M1.set(e.id,e)),t.meshes.forEach(e=>Ms.set(e.id,e)),t.ribbons.forEach(e=>F1.set(e.id,e)),t.areas.forEach(e=>Bf.set(e.id,e)),t.terrains.forEach(e=>Ba.set(e.id,e)),t.foliages.forEach(e=>$a.set(e.id,e)),t.environments.forEach(e=>Ua.set(e.id,e)),t.animations.forEach(e=>$f.set(e.id,e)),t.skins.forEach(e=>C1.set(e.id,e)),t.skeletons.forEach(e=>S1.set(e.id,e)),t.creatures.forEach(e=>P1.set(e.id,e)),t.creaturesMonster.forEach(e=>A1.set(e.id,e)),t.creaturesConjurer.forEach(e=>DT.set(e.id,e)),t.creaturesTrader.forEach(e=>T1.set(e.id,e)),t.traderShopItems.forEach(e=>Uf.set(e.id,e)),t.worlds.forEach(e=>{E1.set(e.id,e)});for(let e=0;e<t.filesExt.length;++e)Nf.push(t.filesExt[e]);for(let e=0;e<t.minimap.length;++e)Of.push(t.minimap[e])};var Gp=(t,e)=>{if(!za.has(t))return console.log("unknown file id: "+t),"";let n=za.get(t);return`${t}.${e||Nf[n.ext]}`};var On="webp",Yn="webp",I1="webp",D1=()=>new Promise((t,e)=>{let n=new Image;n.onerror=()=>{e()},n.onload=()=>{On=Yn=I1="avif",t(!0)},n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="}).catch(()=>{console.log("Avif not supported",navigator.userAgent)});D1();var VT=127,LT=254,V1=2**15-1,qT=2**16-1,L1=2**32-1;var ay=t=>{let e=Sa.modelformat.decode(t),n=V1/(L1/e.sx),o=V1/(L1/e.sy),s=V1/(L1/e.sz);for(let i=0;i<e.position.length;i+=3)e.position[i+0]=e.position[i+0]/n,e.position[i+1]=e.position[i+1]/o,e.position[i+2]=e.position[i+2]/s;for(let i=0;i<e.uv.length;++i)e.uv[i]/=qT;for(let i=0;i<e.color.length;++i)e.color[i]/=LT;for(let i=0,r=e.normal.length;i<r;i++)e.normal[i]=e.normal[i]/VT;return e};var q1=async(t,e,n,o,s,i=3)=>{switch(e.split(".").pop()){case"jpg":case"png":case"avif":case"webp":{let r=new Image;r.onload=()=>{n[e]=o(r),s(n[e],t+e),r.onload=void 0},r.src=t+e+"?v=8738303";break}default:{fetch(t+e+"?v=8738303").then(r=>{if(!r.ok)throw new Error;r.arrayBuffer().then(async l=>{n[e]=await o(l),s(n[e],t+e)})}).catch(r=>{console.log(e+" fetch failed"),i>1&&q1(t,e,n,o,s,--i)});break}}};var rl={},zT=(t,e)=>{for(let n=0,o=rl[e].length;n<o;++n)rl[e][n](...t);rl[e]=void 0},jf=async(t,e,n,o,s)=>{n[e]?s(...n[e]):rl[t+e]?rl[t+e].push(s):(rl[t+e]=[],rl[t+e].push(s),q1(t,e,n,o,zT))},BT=t=>{let e=ay(new Uint8Array(t));return[{index:{type:5125,data:new Uint32Array(e.index)},position:{size:3,data:new Float32Array(e.position)},normal:{size:3,data:new Float32Array(e.normal)},uv:{size:2,data:new Float32Array(e.uv)},color:{size:4,data:new Float32Array(e.color)}},e]},$T={},nr=(t,e)=>{jf("data/assets/",Gp(t),$T,BT,e)};var Wf,Ai,cy=()=>{Wf=$o(Sn({position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),0,j.TRIANGLES),fetch("/data/items/atlas.json?v=8738303").then(async t=>{Ai=await t.json();for(let e in Ai)e!="s"&&(Ai[e]=Ai[e].map(n=>n/Ai.s))})},UT=t=>{let e=tr({image:t,wrapS:j.REPEAT,wrapT:j.REPEAT,minFilter:j.LINEAR_MIPMAP_LINEAR,anisotropy:2**fe.anisotropy});return os(e),[e]},OT=t=>{let e=sy(t),n=tr({buffer:e,minFilter:j.LINEAR_MIPMAP_LINEAR,wrapS:j.REPEAT,wrapT:j.REPEAT,width:e.width,height:e.height,anisotropy:2**fe.anisotropy,format:e.internalFormat,internalFormat:e.internalFormat});return os(n),[n]},R1={},yo=(t,e)=>{za.has(t)||console.log("unknown file id: "+t);let n=za.get(t);n.ext===3&&N2?jf("data/assets/",`${t}.${Nf[n.ext]}`,R1,OT,e):jf("data/assets/",`${t}.${I1||Nf[n.ext]}`,R1,UT,e)},fy,uy=(t,e,n)=>{fy=e,jf("data/assets/",t+".ogg",R1,NT,n)},NT=async t=>[await fy.decodeAudioData(t)];var Kt=(t,e)=>t+Math.random()*(e-t),z1=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;var my=t=>B1(t,Math.random()),B1=(t,e)=>t[Math.floor(e*t.length)];var vn,sr=[],or=new Map,Ti=new Map,Hp=new Set,hy=t=>{vn&&(jT(),WT(t),Hp.clear())},jT=()=>{gy(vn.listener,ht.transform.worldMatrix),Tm(Mi,Yt.worldMatrix),X(_t,0,0,1),$h(_t,_t,Mi),X(kn,0,1,0),$h(kn,kn,Mi),vn.listener.setOrientation(_t[0],_t[1],_t[2],kn[0],kn[1],kn[2])},WT=t=>{let e=0,n=0;for(;n<sr.length;){let o=sr[n];o.ended?GT(o.id):(sr[e]=o,e++),++n}sr.length=e},gy=(t,e)=>{t.setPosition(e[12],e[13],e[14])},vy=function(){this.ended=!0},GT=t=>{Ti.set(t,Math.max(0,Ti.get(t)-1))},py=(t,e)=>{if(!Ti.has(t))Ti.set(t,1);else{if(Ti.get(t)>=e)return!1;Ti.set(t,Ti.get(t)+1)}return!0},$1={},_y=(t,e)=>{let n=my(t);$1[n]!==void 0?e.buffer=$1[n]:uy(n,vn,o=>{$1[n]=o,e.buffer=o})},ti=(t,e,n,o,s)=>{if(vn===void 0||vn.state=="suspended"||Hp.has(t))return;if(n===0){if(sr.length>35||(X(_t,e.worldMatrix[12],e.worldMatrix[13],e.worldMatrix[14]),1/((Ti.get(t)||0)+10+Rr(Yt.position,_t))*1e3/(sr.length+20)**1.2<.4)||!py(t,2))return}else if(n===1&&!py(t,5))return;let i=jp.get(t);if(!i){console.log("unknown sound id:"+t);return}Hp.add(t);let r=vn.createBufferSource();r.id=t,r.loop=o,r.playbackRate.value=s,_y(i.files,r);let l=or.get(n).in;return r.panner=vn.createPanner(),r.panner.distanceModel="exponential",r.panner.refDistance=i.distance,r.panner.rolloffFactor=1,gy(r.panner,e.worldMatrix),r.connect(r.panner),r.panner.connect(l),r.start(0,0),r.onended=vy,sr.push(r),r},by=t=>{vn=new(window.AudioContext||window.webkitAudioContext),["ambience","music"].forEach((i,r)=>{let l=vn.createGain();l.connect(vn.destination),or.set(2+r,{gain:l,in:l}),Zs[i+"Volume"].subscribe(a=>{or.get(2+r).gain.gain.value=(a/100)**2})});let e=vn.createDynamicsCompressor(),n=vn.createGain();e.threshold.value=0,e.knee.value=0,e.ratio.value=15,e.attack.value=.005,e.release.value=.05,e.connect(n),n.connect(vn.destination);let o=vn.createGain();o.gain.value=2,o.connect(e);let s=vn.createGain();s.gain.value=.4,s.connect(e),or.set(1,{gain:n,in:o}),or.set(0,{gain:n,in:s}),Gr.subscribe(i=>{or.get(1).gain.gain.value=(i/150)**2}),Hr.subscribe(i=>{or.get(0).in.gain.value=i/100}),x2.set(!0),document.removeEventListener("click",by)},dy=!1,yy=(t,e)=>{dy||(dy=!0,document.addEventListener("click",by))},ky=t=>{sr.length=0,Ti.clear(),Hp.clear()},U1=(t,e,n,o)=>{if(vn===void 0||vn.state=="suspended")return;let s=jp.get(t);if(!s)return;let i=vn.createBufferSource();i.id=t,i.loop=n,_y(s.files,i);let r=or.get(e).in;return o&&(i.gain=vn.createGain(),i.gain.connect(r),r=i.gain),i.connect(r),i.start(0,n?Kt(0,1):0),i.onended=vy,i},xt=(t,e)=>{let n=U1(t,1,!1,e!==void 0);e!==void 0&&n&&(n.gain.gain.value=e)},xy=(t,e)=>U1(t,e,!0,!0),wy=(t,e)=>U1(t,e,!1,!0);var al=Math.PI*2,YT=Math.PI*3,Oa=t=>t<0||t>al?(t%al+al)%al:t,Gf=(t,e,n,o)=>(Zt(kn,o,n),Zt(_t,e,n),Ko(kn,kn,_t),to(t,kn));var Yp=(t,e,n,o,s,i)=>{let r=[n[0]-t[0],n[1]-t[1],n[2]-t[2]],l=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],a=[o-t[0],s-t[1],i-t[2]],c=hn(r,r),f=hn(r,l),u=hn(r,a),m=hn(l,l),g=hn(l,a),v=1/(c*m-f*f),_=(m*u-f*g)*v,b=(c*g-f*u)*v;return _>=0&&b>=0&&_+b<=1},Xp=(t,e)=>{let n=Math.sin(t[1]),o=Math.cos(t[1]);t[0]=e[2]*o+e[0]*n,t[2]=e[2]*n-e[0]*o},cl=t=>{let e=Math.atan2(t[0],t[1]);return e<0&&(e+=2*Math.PI),e},Qp=t=>{let e=Math.atan2(t[0],t[2]);return e<0&&(e+=2*Math.PI),e},fl=(t,e)=>(e-t+YT)%al-Math.PI;var Zp=(t,e,n)=>{Zt(_t,n,t);let o=hn(_t,e);return on(_t,t,e,o)},My=(t,e,n,o,s,i,r,l,a)=>{let c=-(r*o+l*s+a*i);return r*t+l*e+a*n+c},O1=(t,e,n,o,s,i,r,l,a)=>{let c=-(r*o+l*s+a*i);return e+(r*t+a*n+c)/l},Fy=(t,e,n,o,s,i,r,l,a)=>{let c=(r*(o-t)+l*(s-e)+a*(i-n))/(r*r+l*l+a*a),f=t+c*r,u=n+c*a;return Math.sqrt(Math.pow(f-t,2)+Math.pow(u-n,2))};var Na=(t,e)=>(t[0]=e[0],t[1]=e[2],t);var Jp=(t,e,n)=>(t[0]=e[0]+n[0],t[2]=e[2]+n[1],t);var Cy=(t,e,n,o,s)=>{Zt(_t,e,o);let i=2*hn(n,_t),r=hn(_t,_t)-s*s,l=i*i-4*r;l>0?(t[0]=(-i-Math.sqrt(l))/2,t[1]=(-i+Math.sqrt(l))/2):t[0]=t[1]=-1},ja=(t,e,n,o,s,i)=>{Zt(_t,e,t),Zt(kn,n,t),Ko(tl,_t,kn);let r=hn(s,tl),l;if(r>0){if(!i)return 1/0;l=1}else if(r<0)l=-1,r=-r;else return 1/0;Zt(bs,o,t);let a=l*hn(s,Ko(kn,bs,kn));if(a<0)return 1/0;let c=l*hn(s,Ko(_t,_t,bs));if(c<0||a+c>r)return 1/0;let f=-l*hn(bs,tl);return f<0?1/0:f/r};var Sy=(t,e,n,o)=>{let s=0,i=0,r=1;e.length>2&&(s=o.findIndex(f=>f>=n),s<0&&(s=o.length),i=s>0?o[s-1]:0,r=s>=o.length?1:o[s]);let l=e[s],a=e[s+1],c=(n-i)/(r-i);return _a(t,l,a,c),s};var Kp=[0,0],Wa=[0,0],io=[0,0],nt={},Py={},XT=function(t){return this.press.push(t),t},QT=function(t){return this.release.push(t),t},rn=(t,e)=>(e.press||(e.down=!1,e.onPress=XT,e.onRelease=QT,e.press=[],e.release=[],e.mappings=[],e.store||(e.store=te(!1))),t=Array.isArray(t)?t:[t],t.forEach(n=>{Py[n]=e,e.mappings.push(n)}),k2.set(nt),e),Ay=()=>{rn(fe.kbForward,nt.fwd={}),rn(fe.kbLeft,nt.left={}),rn(fe.kbBack,nt.back={}),rn(fe.kbRight,nt.right={}),rn(fe.kbNextTarget,nt.nextTarget={}),rn(fe.kbNextParty,nt.nextParty={}),rn(fe.kbUntarget,nt.untarget={}),rn(" ",nt.jump={}),rn(fe.kbAltForward,nt.fwd),rn(fe.kbAltBack,nt.back),rn(fe.kbTurnRight,nt.turnright={}),rn(fe.kbTurnLeft,nt.turnleft={}),rn("shift",nt.shift={}),rn("m0",nt.lmb={}),rn("m2",nt.rmb={}),rn("control",nt.ctrl={}),rn("alt",nt.alt={}),rn(fe.kbMap,nt.map={}),rn(fe.kbSkills,nt.skills={}).onPress(()=>{vi.update(t=>!t),xt(89)}),rn(fe.kbCharacter,nt.char={}).onPress(()=>{ki.update(t=>!t),xt(89)}),rn(fe.kbInventory,nt.inventory={}).onPress(()=>{gi.update(t=>!t),xt(90)}),rn(fe.kbClan,nt.clan={}).onPress(()=>{_i.update(t=>!t),xt(90)}),rn(fe.kbSocial,nt.clan={}).onPress(()=>{bi.update(t=>!t),xt(90)}),rn(fe.kbPvp,nt.pvp={}).onPress(()=>{yi.update(t=>!t),xt(90)}),rn(fe.kbParty,nt.party={}).onPress(()=>{es.update(t=>!t),xt(90)}),document.addEventListener("wheel",e9,{passive:!0}),document.addEventListener("keydown",n9,!1),document.addEventListener("keyup",o9,!1),document.addEventListener("contextmenu",t9,!1),document.addEventListener("mousedown",JT,!1),document.addEventListener("mouseup",KT,!1),document.addEventListener("mousemove",ZT,!1)},Ty=t=>{N1&&(N1=!1,fe.pointerlock&&!(nt.lmb.down||nt.rmb.down)&&(document.exitPointerLock(),ed=!1))},Hf=0,ZT=t=>{if(_o(Kp,2*(t.x*fe.resolutionScale/To.width)-1,2*(1-t.y*fe.resolutionScale/To.height)-1),_o(Wa,~~(t.x*fe.resolutionScale),~~(t.y*fe.resolutionScale)),nt.rmb.down||nt.lmb.down){let e=gt(t.movementX,-100,100),n=gt(t.movementY,-100,100);io[1]=gt(io[1]+n*.0028*(fe.invertMouseY?-fe.mouseSensitivity:fe.mouseSensitivity),-Math.PI/2,Math.PI/2),io[0]=Oa(io[0]-e*.005*(fe.invertMouseX?-fe.mouseSensitivity:fe.mouseSensitivity)),Hf+=Math.abs(n)+Math.abs(e)}},Ey=!1;In.subscribe(t=>{Ey=t!==void 0});var ed=!1,N1=!1,JT=t=>{(t.target==To||t.target.id=="chat")&&(fe.pointerlock&&(ed=!0,To.requestPointerLock()),ir("m"+t.button,!0),Ey&&In.update(e=>{e&&e.discard&&e.discard()}))},KT=t=>{ir("m"+t.button,!1),Hf=0,N1=!0},e9=t=>{t.target==To&&Hm.update(e=>gt(e+(t.deltaY>0?1:-1),2,18))},t9=t=>{t.preventDefault()},ir=(t,e,n)=>{let o=Py[t];return o!==void 0?(o.down!=e&&(o.down=e,o[e?"press":"release"].forEach(s=>{s(n)}),o.store.set(o.down)),n&&n.preventDefault(),!0):!1},n9=t=>{if(!Iy(t))return;let e=t.key.toLowerCase();t.ctrlKey&&ir("ctrl+"+e,!0,t)||t.shiftKey&&ir("shift+"+e,!0,t)||ir(e,!0,t)},o9=t=>{if(!Iy(t))return;let e=t.key.toLowerCase();ir("ctrl+"+e,!1),ir("shift+"+e,!1),ir(e,!1)},Iy=t=>{let e=t.target.tagName.toLowerCase();return e!=="input"&&e!=="textarea"};var j1=t=>1+(t-1)*.23,Dy=t=>{let e=0;return t.forEach(n=>{e+=n.stats.getStat(18)}),i9(e,t.length)},i9=(t,e)=>t/Math.max(1,e)/100;var r9=[300,600,1e3,1600,2400,3300,4300,5300,6400,7600,9e3,10300,11700,13200,14800,16600,18900,21300,23800,26500,29300,32200,35300,38700,42200,46e3,49800,53800,58e3,62800,67800,73e3,78400,84500,90900,97400,104200,111800,119600,128300,137400,146600,156200,166e3,176100],rr=t=>r9[gt(t,1,45)-1];var td=class{constructor(e){this.id=e.id,this.cd=e.cd!==void 0?e.cd:0,this.costMp=e.costMp,this.targetMode=e.targetMode||0,this.onCast=e.onCast,this.onPermanent=e.onPermanent,this.range=e.range||0,this.graceRange=this.range+Math.min(this.range*.2,10),this.auto=e.auto||!1,this.engineOnly=e.engineOnly||!1,this.minlevel=e.minlevel||0,this.castLen=e.castLen||0,this.gcd=e.gcd!==void 0?e.gcd:1.5,this.custom=e.custom,this.skilllevels=Math.min(5,e.skilllevels||5),this.goldValue=e.goldValue||0,this.noReward=e.noReward||!1,this.outOfCombat=e.outOfCombat||!1,this.pvpBoundsAdd=e.pvpBoundsAdd||0,this.ignoreGcd=e.ignoreGcd||!1,this.ignoreIncapacitated=e.ignoreIncapacitated||!1,this.disablingBuffs=e.disablingBuffs||[],this.hasteAffected=e.hasteAffected!==void 0?e.hasteAffected:!0,this.skillpoints=e.skillpoints!==void 0?e.skillpoints:1,this.envCast=e.envCast||0}can(e,n,o=0,s){if(this.outOfCombat&&!e.stats.combatTimer.done(I.time))return 11;if(this.costMp!==void 0&&e.stats.getResource(7)<this.costMp(n))return 5;if(this.targetMode!==1){let i=I.getEntityById(o),r=i===void 0||i.stats.alive,l=i===void 0?-1:e.hostility(i);if(this.targetMode===4096){if((l===-1||l===0)&&r)return 3;if(!e.canCombatInteract(i))return 13}else if(this.targetMode===256){if((l===-1||l!==0)&&r)return 4}else if(this.targetMode===16)i=e;else if(this.targetMode===17&&(i===void 0||i===e))return 3;if(i!==void 0&&!i.stats.alive)return 10;if(i&&o!==e.id&&i!==e&&this.range>0&&!e.combatRangeCheck(i,s?this.range:this.graceRange))return 6}return this.disablingBuffs.some(i=>e.buffs.hasAnyWithTag(i))?12:0}};var Se=class extends td{constructor(e){super(e),this.fx=e.fx||{},this.autoSkillbar=e.autoSkillBar!==!1}};var Ga=(t,e,n,o)=>({id:t,minlevel:n,engineOnly:!1,cd:0,custom:o,autoSkillBar:!1,onPermanent:()=>e}),Do=(t,e,n,o,s,i,r,l)=>({id:t,targetMode:16,minlevel:n,cd:s,costMp:r,fx:l,onCast:(a,c,f)=>({id:e,mode:4,stacks:1,duration:o,caster:a.id,target:a.id,aoe:{faction:!0,limit:i,circleRadius:30,circleHeight:20},level:c})}),nd=(t,e,n,o,s,i,r,l=5,a)=>({id:t,targetMode:256,range:30,minlevel:n,cd:s,castLen:o,costMp:r,fx:a,onCast:(c,f,u)=>({id:e,mode:l,stacks:1,caster:c.id,target:u,refresh:!0,duration:i,level:f})}),ul=(t,e,n=0,o=!0,s,i=!1,r=!1,l)=>({id:t,targetMode:16,cd:e,gcd:0,hasteAffected:!1,ignoreIncapacitated:i,ignoreGcd:!0,castLen:n,engineOnly:!0,outOfCombat:s,fx:l});var Vy=new Se(Ga(21,77,1));var Ly=new Se({id:2,targetMode:16,minlevel:5,cd:30,gcd:0,costMp:t=>3+t*5,fx:{animCast:6},custom:[[t=>7+t*12," heal on block"]],onCast:(t,e,n)=>({id:59,mode:4,stacks:1,duration:9,caster:t.id,target:t.id,level:e})});var qy=t=>.7+t*.2,l9=t=>qy(t)+30/(250/20),Ry=new Se({id:33,targetMode:17,skilllevels:1,minlevel:11,cd:15,range:30,disablingBuffs:[4],costMp:t=>12,custom:[[qy,"s stunned at min range"],[l9,"s stunned at max range"]],onCast:(t,e,n)=>{}});var zy=new Se(Do(20,76,15,300,150,20,t=>t*8,{animCast:6}));var By=new Se({id:18,cd:0,minlevel:8,autoSkillBar:!1,fx:{},onPermanent:()=>73});var $y=new Se({id:3,targetMode:1,minlevel:3,cd:6,costMp:t=>2+t*2,fx:{animCast:5,effectDirImpact:9},onCast:(t,e,n)=>({id:3,mode:0,caster:t.id,dmg:t.stats.getDamageRoll()*(1+e*.18),type:1,aoe:{faction:!1,circleRadius:2+5*t.size}})});var Uy=new Se({id:17,targetMode:16,minlevel:13,cd:50,gcd:0,costMp:t=>t*8,fx:{animCast:6},onCast:(t,e,n)=>({id:72,mode:4,stacks:1,duration:17,caster:t.id,target:t.id,level:e})});var Oy=new Se({id:50,targetMode:1,minlevel:7,cd:30,costMp:t=>t*4,fx:{animCast:40},custom:[[t=>20+t*5," % missing + 100 HP recovered"]],onCast:(t,e,n)=>({id:121,mode:4,stacks:1,caster:t.id,buffdata:[0],sendBuffData:!0,duration:1+e,level:e,aoe:{faction:!1,circleRadius:8}})});var a9=t=>t*8,Ny=new Se({id:1,targetMode:4096,minlevel:1,cd:1,range:2,custom:[[a9,"% chance to daze target for 3 seconds"]],costMp:t=>1+t,fx:{animImpact:3},onCast:(t,e,n)=>{let o=5+t.stats.getDamageRoll()*(.38+e*.39);return{id:1,mode:0,caster:t.id,target:n,dmg:o,type:1}}});var jy=t=>1e4+t*1e4,c9=(t,e)=>{if(e.type===1){let n=0;e.aggroValues.forEach((o,s)=>{o>n&&(n=o)}),e.aggroValues.set(t.caster,n+jy(t.level)),e.buffs.buffs.has(122)&&add({id:125,mode:5,stacks:t.level,caster:e.id,target:t.caster,refresh:!0,duration:60,level:1})}},Wy=new Se({id:34,targetMode:1,minlevel:6,cd:15,costMp:t=>t*4,fx:{animCast:7},custom:[[jy," aggro generation"]],onCast:(t,e,n)=>({custom:c9,id:89,mode:4,stacks:1,caster:t.id,duration:2+e,level:e,aoe:{faction:!1,circleRadius:10}})});var Gy=new Se({id:41,targetMode:16,minlevel:25,cd:30,skilllevels:1,gcd:0,costMp:t=>3+t*5,onCast:(t,e,n)=>{}});var Hy=new Se(Do(19,75,18,300,150,20,t=>t*8,{animCast:6}));var Yy=new Se({id:46,targetMode:1,range:30,minlevel:4,cd:30,castLen:0,costMp:t=>10+t*3,fx:{effectTarget:106},onCast:(t,e,n)=>{}});var Xy=new Se(Do(22,78,17,300,120,20,t=>5+t*10,{animCast:6}));var Qy=new Se(nd(24,80,15,1.5,0,300,t=>2+t*3,4,{animCast:9,animChannel:18}));var Zy=new Se({id:52,targetMode:1,minlevel:7,envCast:7,cd:6,range:25,costMp:t=>t*2,fx:{effectMissile:107,effectTarget:111},onCast:(t,e,n,o,s,i)=>{}});var Jy=new Se({id:14,targetMode:1,minlevel:3,cd:25,costMp:t=>t*4,fx:{animCast:31},onCast:(t,e,n)=>({id:69,mode:4,stacks:1,caster:t.id,duration:5.5+e*.5,level:e,aoe:{faction:!1,circleRadius:8}})});var Ky=new Se({id:16,targetMode:16,minlevel:13,cd:45,gcd:0,fx:{animCast:6},onCast:(t,e,n)=>({id:71,mode:4,stacks:1,duration:12,caster:t.id,target:t.id,level:e})});var ek=new Se({id:53,targetMode:16,minlevel:9,cd:80,gcd:0,ignoreIncapacitated:!0,ignoreGcd:!0,costMp:t=>t*5,onCast:(t,e,n)=>({id:117,mode:4,duration:5,stacks:1,caster:t.id,target:t.id,level:e})});var tk=new Se({id:4,targetMode:4096,range:30,minlevel:1,cd:0,castLen:1.5,custom:[[t=>100+t*10,"% frozen buff multiplier"]],costMp:t=>1+t*2,fx:{animCast:29,effectDirImpact:30,animChannel:30,effectMissile:27},onCast:(t,e,n)=>({id:4,mode:6,speed:25,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.3+e*.32),type:1}),onPermanent:()=>100});var nk=t=>2+t*2,ok=new Se({id:23,targetMode:16,minlevel:5,cd:60,gcd:0,costMp:t=>t*5,custom:[[nk," attacks blocked"]],fx:{animCast:6},onCast:(t,e,n)=>({id:79,mode:4,stacks:nk(e),duration:60,caster:t.id,target:t.id,level:e})});var sk=new Se({id:15,targetMode:1,range:30,minlevel:8,cd:8,castLen:1.5,costMp:t=>5+t*5,fx:{animCast:29,animChannel:30,effectDirImpact:31,effectMissile:28},onCast:(t,e,n)=>({id:15,mode:6,speed:10,timeout:2.5,caster:t.id,rot:t.rot,dmg:10+t.stats.getDamageRoll()*(.56+e*.6),type:1,aoe:{circleRadius:4+e*.5,faction:!1,onlyOnce:[]}})});var ik=new Se({id:51,targetMode:4096,range:30,minlevel:4,cd:10,castLen:2.8,costMp:t=>1+t*2,fx:{animCast:37,effectDirImpact:119,animChannel:30,effectMissile:118},onCast:(t,e,n)=>({id:51,mode:6,speed:20,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(1.25+e*1.33),type:1,noBlock:!0})});var f9=()=>12,rk=new Se({id:32,targetMode:1,skilllevels:1,minlevel:5,gcd:.7,cd:12,disablingBuffs:[4],costMp:t=>t*4,fx:{animCast:32},custom:[[f9,"m distance"]],onCast:(t,e,n)=>{}});var lk=new Se({id:37,targetMode:4096,range:30,minlevel:15,cd:40,castLen:2.3,costMp:t=>5+t*5,fx:{animCast:9,effectImpact:50,animChannel:16},onCast:(t,e,n)=>({id:91,mode:4,stacks:1,caster:t.id,target:n,duration:2.4+e*1,level:e})});var ak=new Se(Do(28,84,12,15,60,15,t=>1+t*3,{animCast:6}));var ck=new Se({id:12,targetMode:4096,range:30-5,minlevel:1,castLen:0,cd:3,costMp:t=>Math.round(1+t*4.5),fx:{animCast:10,effectMissile:48},onCast:(t,e,n)=>({id:12,mode:6,dmg:5+t.stats.getDamageRoll()*(.03+e*.13),type:1,speed:15,caster:t.id,target:n,level:e})});var fk=new Se({id:30,targetMode:1,range:30,minlevel:18,cd:60,castLen:2.3,costMp:t=>10+t*8,fx:{effectImpact:70,animCast:14,animChannel:15,effectMissile:69},onCast:(t,e,n)=>({id:30,mode:6,speed:0,timeout:30,caster:t.id,rot:t.rot,interval:new kt(0,2),heal:t.stats.getDamageRoll()*(.08+e*.05),type:1,aoe:{circleRadius:30,circleHeight:30,faction:!0,limit:15}})});var uk=new Se(Do(13,68,6,15,90,15,void 0,{animCast:22}));var mk=new Se({id:6,targetMode:256,range:30,minlevel:8,cd:0,castLen:1.7,costMp:t=>4+t*4,fx:{animCast:11,effectImpact:36,animChannel:12},onCast:(t,e,n)=>({id:6,mode:2,caster:t.id,target:n,heal:15+t.stats.getDamageRoll()*(.2+e*.18)})});var pk=new Se({id:47,targetMode:256,range:30,minlevel:14,cd:12,castLen:0,costMp:t=>4+t*4,fx:{animCast:9,effectTarget:112},custom:[[t=>t," effects removed"]],onCast:(t,e,n)=>{let o=0;return{id:47,mode:2,caster:t.id,target:n,heal:(1+o)*(15+t.stats.getDamageRoll()*.25)}}});var u9=t=>1+t*2,m9=t=>1+t*2,dk=new Se(Ga(43,106,3,[[u9,"% haste per stack"],[m9," jumps"]]));var hk=new Se(nd(7,60,3,0,0,12,t=>2+t*2,5,{animCast:9}));var p9=t=>Math.round(t*1.3),d9=t=>t*2,gk=new Se({id:42,targetMode:1,minlevel:8,cd:8,castLen:0,range:30-5,custom:[[p9," mana gained per soul"],[d9," extended Decay duration"]],costMp:t=>1+t*3,fx:{animCast:13,effectImpact:46},onCast:(t,e,n)=>({id:42,mode:1,caster:t.id,target:0,type:1,dmg:4+t.stats.getDamageRoll()*(.25+e*.4),level:e})});var vk=new Se({id:105,engineOnly:!0,cd:0,fx:{effectImpact:47,effectMissile:45}});var _k=new Se({id:36,targetMode:16,minlevel:10,cd:30,gcd:0,costMp:t=>8+t*2,onCast:(t,e,n)=>({id:90,mode:4,stacks:1,duration:5+e*5,caster:t.id,target:t.id,level:e})});var bk=new Se({id:35,targetMode:1,skilllevels:1,minlevel:5,cd:120,skillpoints:0,castLen:5,outOfCombat:!0,hasteAffected:!1,pvpBoundsAdd:5,costMp:t=>20+t*5,fx:{animCast:20,animChannel:21},onCast:(t,e,n)=>{}});var yk=new Se({id:49,targetMode:4096,range:30,minlevel:13,cd:25,costMp:t=>1+t*1,fx:{animCast:38,effectMissile:123,animChannel:28},onCast:(t,e,n)=>({id:49,buffid:119,mode:7,speed:60,caster:t.id,level:e,stacks:1,duration:1+e*2,refresh:!0,target:n})});var kk=new Se({id:54,targetMode:4096,range:30,minlevel:8,cd:10,castLen:2.8,costMp:t=>8+t*3,fx:{animCast:39,effectDirImpact:121,animChannel:25,effectMissile:114},onCast:(t,e,n)=>({id:54,mode:6,speed:60,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(1.25+e*1.33),type:1,noBlock:!0})});var xk=new Se(Ga(26,82,15));var h9=t=>3+t*5,wk=new Se({id:11,targetMode:16,minlevel:7,cd:50,gcd:0,fx:{animCast:6},custom:[[h9,"% of max mp recovered"]],onCast:(t,e,n)=>({id:66,mode:4,stacks:1,duration:17,caster:t.id,target:t.id,level:e})});var Mk=new Se(Do(27,83,12,10,80,20,t=>5+t*7,{animCast:6}));var Fk=new Se({id:29,cd:0,minlevel:9,autoSkillBar:!1,onPermanent:()=>85});var Ck=new Se({id:9,targetMode:4096,range:30,minlevel:3,cd:6,castLen:1.7,costMp:t=>2+t*3,fx:{animCast:24,effectDirImpact:85,animChannel:25,effectMissile:33},onCast:(t,e,n)=>({id:9,mode:6,speed:120,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.53+e*.45),type:1})});var Sk=new Se({id:10,targetMode:16,minlevel:5,cd:0,autoSkillBar:!1,skillpoints:0,onPermanent:()=>65});var Pk=new Se({id:38,targetMode:16,minlevel:5,skilllevels:1,cd:10,gcd:0,disablingBuffs:[4],costMp:t=>6,fx:{animCast:23},onCast:(t,e,n)=>!0});var Ak=new Se({id:31,targetMode:4096,range:30,minlevel:1,cd:0,castLen:1.5,costMp:t=>1+t*1,fx:{animCast:27,effectDirImpact:84,effectMissile:34,animChannel:28},onCast:(t,e,n)=>({id:31,mode:6,speed:60,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.24+e*.25),type:1})});var Tk=new Se(Do(25,81,18,300,120,20,t=>5+t*5,{animCast:6}));var Ek=new Se({id:48,targetMode:4096,range:30,minlevel:6,cd:20,ignoreGcd:!0,costMp:t=>1+t*1,fx:{animCast:36,effectDirImpact:115,effectMissile:113,animChannel:28},custom:[[t=>t*120," HP recovered"]],onCast:(t,e,n)=>({id:48,mode:6,speed:80,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.28+e*.28),type:1})});var Ik=new Se({id:106,engineOnly:!0,cd:0,fx:{effectMissile:116,effectImpact:117}});var Dk=new Se({id:45,targetMode:1,range:30,minlevel:4,cd:25,castLen:0,costMp:t=>18+t*3,fx:{effectDirImpact:11,effectMissile:103},onCast:(t,e,n)=>{}});var g9={medalValue:1e3,goldValue:5e4,buyElo:1600,quality:90,level:45,gs:30,uniqueEquipped:!0},W1=[{id:0,custom:["Use: Removes all movement limiting effects."],useCd:60,incap:!0,animCast:45},{id:1,custom:["Use: Protects you against 30% of incoming damage for 10 seconds."],useCd:60,animCast:6,incap:!1},{id:2,custom:["Use: Increases your damage by 20% for 10 seconds."],useCd:80,incap:!1,animCast:6},{id:3,custom:["Use: Speeds up your movement by 45 for 8 seconds."],useCd:50,incap:!1,animCast:6},{id:4,custom:["Use: Attacks made against you grant 20 MP (up to 200) for 20 seconds."],useCd:60,incap:!1,animCast:6}],Vk=t=>{W1.forEach((e,n)=>{t["charm"+e.id]={...g9,...e,type:"charm",tier:e.id,useSkill:107+n}})};var Lk=new Se(ul(100,30,0,!0,!0,!1,!1,{animCast:17})),qk=new Se(ul(101,1.5,0,!0,!1,!1,!1)),Rk=new Se(ul(104,1.5,0,!1,!1,!1,!1,{animCast:6})),zk=new Se(ul(103,1.5,3,!0,!1,!1,!1,{animCast:19,animChannel:18})),Bk=new Se(ul(102,1.5,1.5,!1,!0,!1,!1,{animCast:9,animChannel:18})),$k=W1.map((t,e)=>new Se(ul(107+e,t.useCd,0,!1,!1,t.incap,!0,{animCast:t.animCast}))).reduce((t,e)=>({...t,["charm"+e.id]:e}),{});var Uk=new Se({id:5,targetMode:4096,range:30,engineOnly:!0,auto:!0,cd:t=>100/t.stats.getStat(17),fx:{animCast:26,effectDirImpact:11,effectMissile:32},onCast:(t,e,n)=>({id:5,mode:6,speed:15*3,caster:t.id,target:n,dmg:t.stats.getDamageRoll(),type:0})});var Ok=new Se({id:56,targetMode:1,range:50,cd:10,engineOnly:!0,castLen:2,fx:{animCast:41,animChannel:42}});var Nk=new Se({id:44,targetMode:1,range:50,minlevel:3,cd:5,engineOnly:!0,castLen:1.5,costMp:t=>t*4});var jk=new Se({id:55,targetMode:1,range:50,minlevel:3,cd:20,engineOnly:!0,castLen:2,fx:{effectMissile:131,animCast:43,animChannel:42}});var Wk=new Se({id:58,targetMode:1,range:10,cd:2,engineOnly:!0,hasteAffected:!1,castLen:30,fx:{animCast:9,animChannel:44}});var Gk=new Se({id:57,targetMode:4096,engineOnly:!0,fx:{effectMissile:153,effectDirImpact:154}});var Hk=new Se({id:0,targetMode:4096,engineOnly:!0,auto:!0,range:2,cd:t=>100/t.stats.getStat(17),fx:{animImpact:4},onCast:(t,e,n)=>({id:0,mode:0,caster:t.id,target:n,dmg:t.stats.getDamageRoll(),type:0})});var Yk=new Se({id:39,engineOnly:!1,skilllevels:1,minlevel:30,cd:0,goldValue:25e3,skillpoints:0,noReward:!0,autoSkillBar:!1});var Xk=new Se({id:40,targetMode:1,engineOnly:!0,cd:300,castLen:5,outOfCombat:!0,hasteAffected:!1,costMp:t=>20+t*5,fx:{animCast:9,animChannel:8},onCast:(t,e,n)=>{}});var Qk=new Se({id:8,engineOnly:!0,cd:0,onPermanent:t=>t.class+61});var v9={...$k,hellspawn_missile:Gk,conjurer_obeliskport:Wk,boss_bigaoe:Ok,boss_puddledot:jk,recall:Xk,arrow:Uk,melee:Hk,potion:Lk,book:qk,specialization:Qk,mount:Yk,activatemount:Bk,container:zk,boss_flamepits:Nk,useGeneric:Rk},_9={relentlessCry:Oy,whirlwind:Yy,temper:Gy,taunt:Wy,charge:Ry,warcry:Hy,courage:zy,armorreinforcement:Vy,enrage:Uy,slash:Ny,blockBuff:Ly,crescentStrike:$y,crescentBleed:By},b9={frostcall:Zy,iceblock:ek,shatterfrost:ik,teleport:rk,enchantment:Qy,arcticaura:Xy,iceshield:ok,hypothermic:Ky,frostnova:Jy,icebolt:tk,icicle:sk},y9={vampiricarrowReturn:Ik,boneshot:kk,blindingshot:yk,vampiricarrow:Ek,volley:Dk,snipe:Pk,poisonarrows:Fk,temporaldilation:Tk,pathfinding:Mk,preciseShot:Ck,serpentArrows:Sk,invigorate:wk,swiftshot:Ak,cranialpunctures:xk},k9={mimirscleanse:pk,soulharvestReturn:vk,plaguespreader:dk,soulharvest:gk,agonize:lk,caninehowl:ak,mana:uk,mend:mk,revitalize:hk,decay:ck,healingtotem:fk,summon:bk,spiritanimal:_k},At=new Map;[_9,b9,y9,k9,v9].forEach((t,e)=>{for(let n in t)e<=3&&(t[n].class=e),At.set(t[n].id,t[n])});At.set(60,new Se({id:60,engineOnly:!0}));var Jk=[1600,1800,2e3,2200],Zk=Jk.length,Ha=t=>{for(let e=0;e<Zk;++e)if(Jk[e]>t)return e;return Math.max(0,Zk)},x9=10,w9=30,M9=240,F9=-.0015,C9=930,S9=100,Yf=t=>x9+Math.round(Math.max(t/w9,M9*(1-Math.exp(F9*(t-C9)))-S9));var P9=[0,0,1,1,2,3],G1=(t,e)=>"book"+(e!==void 0?e:"")+P9[t%5],Xf=(t,e,n,o)=>`https://raw.githubusercontent.com/2f147f0487a9fe5b/cb2e2197348007b8/main/${t}/${t=="book"?G1(e,n):t+e}_q${o}.webp?v=8738303`,Qf=t=>`/data/ui/skills/${t}.${Yn}?v=8738303`,Kk=t=>`/data/ui/slotbg/${t}.${On}?v=8738303`,ex=(t,e,n)=>`/data/world/${t}/map/${e}/${n}.${Yn}?v=8738303`,ni=t=>`/data/ui/classes/${t}.${On}?v=8738303`,H1=t=>`/data/ui/factions/${t}.${On}?v=8738303`,tx=t=>`/data/ui/elo/${Ha(t)}.svg?v=8738303`,nx="/data/ui/currency/medal.svg?v=8738303",Ya="/data/ui/currency/prestige.svg?v=8738303",lr="/data/ui/currency/fame.svg?v=8738303",ox=t=>`/data/ui/rank/rank${t}.svg?v=8738303`;var sx=t=>{At.forEach(e=>{if(!e.engineOnly)for(let n=0;n<e.skilllevels;++n){let o=e.id*5+n;t[`book${o}`]={type:"book",tier:o,level:e.minlevel+n*8,skillid:e.id,skilllevel:n,class:e.class,noReward:e.noReward||!1,goldValue:e.goldValue||(e.minlevel+n*5<5?4:0),quality:Math.round(Math.min(99,30+70*(n/5))),art:G1(o,e.class),useSkill:101}}})};var A9=[{id:0,storeValue:300,quality:90,level:1,custom:["Contains random mount (account bound) of rare or epic quality"],bindOnPurchase:1,useSkill:103},{id:1,storeValue:900,quality:90,level:1,custom:["Adds one month of Elixir to your account"],bindOnMerchant:1,useSkill:103},{id:2,storeValue:700,quality:90,level:1,bindOnMerchant:1,custom:["Used to upgrade rare pets, allowing them to pick up items."]}],ix=t=>{A9.forEach(e=>{t["box"+e.id]={...e,type:"box",tier:e.id,unsellable:!0}})};var Uo={hammer:{sound:119,rot:1},bow:{sound:120,rot:1},staff:{sound:120,rot:1},sword:{sound:119,rot:1},armlet:{sound:121},armor:{sound:122},bag:{sound:121},boot:{sound:121},glove:{sound:121},ring:{sound:123},amulet:{sound:123},quiver:{sound:121,rot:1},shield:{sound:122},totem:{sound:122,rot:1},orb:{sound:122},rune:{sound:123,rot:0},misc:{sound:124,rot:1},book:{sound:121},mount:{sound:121,rot:0},pet:{sound:121,rot:0},box:{sound:125,rot:0},gold:{sound:126},charm:{sound:123}},Pn={hammer:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:3,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:15,min:.05,max:.1}},stackable:!1},bow:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:2,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}},stackable:!1},staff:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:1,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}},stackable:!1},sword:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:0,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:20,min:.05,max:.1}},stackable:!1},armlet:{baselvl:1,slot:[102],tiers:13,drop:1,weight:.3,stats:{6:{base:10,min:.5,max:.9},12:{base:7,min:.5,max:.8}},stackable:!1},armor:{baselvl:2,slot:[103],tiers:11,drop:1,weight:1,stats:{12:{base:10,min:1.4,max:2.8},6:{base:20,min:1,max:2}},stackable:!1},bag:{baselvl:5,slot:[104],tiers:5,drop:1,weight:.1,stats:{19:{base:1,min:.1,max:.3}},stackable:!1},boot:{baselvl:2,slot:[105],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.6,max:1.1},15:{base:3,min:.03,max:.1}},stackable:!1},glove:{baselvl:2,slot:[106],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.7,max:1.1},14:{base:1,min:.1,max:1.5}},stackable:!1},ring:{baselvl:5,slot:[107],tiers:12,drop:.8,weight:.2,stats:{6:{base:10,min:.5,max:.9},7:{base:5,min:.6,max:1}},stackable:!1},amulet:{baselvl:7,slot:[108],tiers:12,drop:.8,weight:.3,stats:{7:{base:10,min:1,max:1.8},9:{base:1,min:.2,max:.3}},stackable:!1},quiver:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:2,stats:{14:{base:5,min:.1,max:.9},9:{base:1,min:.1,max:.3}},stackable:!1},shield:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:0,stats:{12:{base:20,min:.8,max:1.4},13:{base:4,min:1,max:2.8}},stackable:!1},totem:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:3,stats:{12:{base:10,min:.4,max:.9},9:{base:1,min:.1,max:.4}},stackable:!1},orb:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:1,stats:{3:{base:10,min:.3,max:.7},9:{base:1,min:.1,max:.3}},stackable:!1},rune:{baselvl:1,tiers:11,drop:.8,quality:70,stackable:!0},misc:{drop:8,weight:.1,stackable:!0},book:{drop:1.6,weight:.5,stackable:!0},charm:{slot:[110,111],noupgrade:!0,undroppable:!0,drop:0,stackable:!1},mount:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},box:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},pet:{undroppable:!0,drop:0,stackable:!1},gold:{drop:24}},rx=Object.keys(Pn),Zf={6:{min:.2,max:.8,round:!0},7:{min:.2,max:.5,round:!0},8:{min:.1,max:1},9:{min:.1,max:.5},10:{min:.03,max:.13,round:!0},11:{min:.1,max:.2,round:!0},12:{min:.1,max:.8,round:!0},13:{min:.1,max:.4},14:{min:.1,max:.5},16:{min:.1,max:.4},2:{min:.08,max:.45,round:!0},0:{min:.08,max:.45,round:!0},3:{min:.08,max:.45,round:!0},4:{min:.08,max:.45,round:!0},1:{min:.08,max:.45,round:!0},5:{min:.08,max:.45,round:!0},18:{min:.01,max:.15,round:!0}},lx=Object.keys(Zf),Jf={6:4,7:3,8:5,9:4,10:1,11:1,12:5,13:5,14:5,15:.3,16:5,17:0,2:2,0:2,3:2,4:2,1:2,5:2,19:1,18:2.5};var ax=t=>{for(let e in Pn)if(Pn[e].tiers){let n=Pn[e];for(let o=0;o<n.tiers;++o)E9({type:e,tier:o,stats:n.stats,level:T9(e,o),class:n.class,quality:n.quality},t)}},T9=(t,e)=>Pn[t].baselvl+Math.floor(e/Pn[t].tiers*100),E9=(t,e)=>{let n={level:t.level,type:t.type,tier:t.tier,stats:t.stats?new Map:void 0,class:t.class,quality:t.quality};t.stats&&Object.keys(t.stats).sort((o,s)=>o-s).forEach(o=>{let s=t.stats[o];n.stats.set(parseInt(o),{min:s.base+t.level*s.min,max:s.base+(t.level+10)*s.max})}),e[t.type+t.tier]=n};var I9=[250,100,500,200,1e3,300],cx=t=>{for(let e=0;e<6;++e){let n=Math.floor(e/2),o=e%2==0;t["misc"+e]={type:"misc",tier:e,level:1+n*20,goldvalue:5**n,quality:15,custom:[""+I9[e]+(o?" HP recovered":" MP recovered")],useSkill:100}}};var D9=[{lvl:30,g:1e4,qual:50,store:0,skin:6},{lvl:30,g:2e4,qual:50,store:0,skin:21},{lvl:30,g:5e4,qual:80,store:300,skin:51},{lvl:30,g:5e4,qual:80,store:300,skin:52},{lvl:30,g:5e4,qual:95,store:1200,skin:22},{lvl:30,g:5e4,qual:90,store:600,skin:23},{lvl:30,g:5e4,qual:80,store:300,skin:24},{lvl:30,g:5e4,qual:90,store:600,skin:25},{lvl:30,g:5e4,qual:95,store:1200,skin:27},{lvl:30,g:5e4,qual:95,store:1200,skin:28},{lvl:30,g:5e4,qual:80,store:300,skin:30},{lvl:30,g:5e4,qual:95,store:1200,skin:31},{lvl:30,g:5e4,qual:95,store:1200,skin:32},{lvl:30,g:5e4,qual:85,store:400,skin:29},{lvl:30,g:5e4,qual:95,store:1200,skin:33},{lvl:30,g:5e4,qual:95,store:0,skin:94},{lvl:30,g:5e4,qual:95,store:0,skin:95},{lvl:30,g:5e4,qual:95,store:0,skin:96},{lvl:30,g:5e4,qual:95,store:0,skin:97},{lvl:30,g:5e4,qual:95,store:0,skin:98},{lvl:30,g:5e4,qual:95,store:0,skin:100},{lvl:30,g:5e4,qual:95,store:0,skin:101},{lvl:30,g:5e4,qual:95,store:0,skin:93},{lvl:30,g:5e4,qual:95,store:0,skin:91},{lvl:30,g:5e4,qual:95,store:0,skin:99},{lvl:30,g:5e4,qual:95,store:0,skin:92}].map(t=>({level:t.lvl,goldValue:t.g,storeValue:t.store,bindOnUse:1,bindOnMerchant:t.store>0?1:0,quality:t.qual,skin:t.skin})),fx=t=>{D9.forEach((e,n)=>{t["mount"+n]={...e,type:"mount",tier:n,requiredSkill:39,useSkill:102}})};var V9=[1919,1920,1944,1945,1946,1947,1948,1960,1968,1969,1970,1971,1972,1973,1974,1975],ux=t=>{V9.forEach((e,n)=>{t["pet"+n]={level:10,unsellable:!0,storeValue:e>1920?0:900,quality:90,bindOnUse:1,bindOnMerchant:e>=1968?0:1,type:"pet",tier:n,useSkill:104,skin:e}})};var ln={};ax(ln);cx(ln);sx(ln);fx(ln);Vk(ln);ux(ln);ix(ln);var cr=Object.values(ln);cr.forEach((t,e)=>t.id=e);var ko=[{step:10,fun:()=>nt.fwd.down||nt.left.down||nt.right.down},{step:10,fun:()=>nt.lmb.down||nt.rmb.down},{element:"uftarget"},{element:"sk1"},{click:!0},{click:!0},{element:"expbar",click:!0},{},{element:"sysbag",fun:()=>fe.inventoryOpen},{element:"bag2",click:!0},{click:!0},{element:"syschar",fun:()=>fe.charpanelOpen},{element:"equipslots",click:!0},{fixed:()=>I.player.level>1&&I.player.stats.getStat(22)>0?100:Math.round(I.player.exp/rr(I.player.level)*100)},{element:"syschar",fun:()=>fe.charpanelOpen},{element:"statpoints"},{step:100,fixed:()=>Math.round(I.player.exp/rr(I.player.level)*100),fun:()=>I.player.level>3},{click:!0},{fixed:()=>Math.round(I.player.inventory.gold/32*100)},{fun:()=>fe.traderWindow},{element:()=>{let t=0;return Uf.forEach(e=>{let n=ln[e.type+e.tier];n.type==="book"&&n.level===3&&n.class===I.player.class&&(t=e.id)}),"trader"+t}},{element:"bag0",click:!0},{element:"sysbook",fun:()=>fe.skillmenuOpen},{element:"skilllist",click:!0},{element:"tutsetskillpoint",click:!0},{element:"tutapplyskills",click:!0},{element:"skillbar",click:!0},{click:!0},{element:"partybtn",fun:()=>fe.partyOpen},{element:"partyapply"},{click:!0,gate:()=>I.player.party>0},{click:!0,gate:()=>I.player.level>=9},{click:!0,gate:()=>I.player.level>=11},{click:!0,gate:()=>I.player.level>=12},{click:!0,gate:()=>I.player.level>=13},{click:!0,gate:()=>I.player.level>=15},{click:!0,gate:()=>I.player.level>=16},{click:!0,element:"chat",gate:()=>I.player.level>=17},{click:!0,gate:()=>I.player.level>=18},{click:!0,gate:()=>I.player.level>=18},{click:!0,gate:()=>I.player.level>=20},{click:!0,gate:()=>I.player.level>=25},{click:!0,gate:()=>I.player.level>=26},{click:!0,gate:()=>I.player.level>=29},{click:!0,gate:()=>I.player.level>=30},{click:!0,gate:()=>I.player.level>=34},{click:!0,gate:()=>I.player.level>=36},{click:!0,gate:()=>I.player.level>=41},{click:!0,gate:()=>I.player.level>=45}],mx=!1,L9=()=>{Y1.reset(I.smoothtime),mx||(mx=!0,wi.subscribe(t=>{let e=ko[t];e&&(e.gate===void 0||e.gate())?Wi.set(px(t)):Wi.set()}))},px=t=>(xt(91),{...ko[t],msg:P.ui.tutorial.msg[t],progress:0}),Y1=new kt(0,.2),q9=()=>{let t=ko[fe.tutprogress];t&&Y1.done(I.smoothtime)&&(Y1.reset(I.smoothtime),!t.closing&&(t.gate===void 0||t.gate())&&(t.gate&&t.gate()&&an(fe.tutprogress,void 0,1),t.fun&&t.fun()&&an(fe.tutprogress,t.step||100),t.fixed&&an(fe.tutprogress,void 0,t.fixed())))},an=(t,e,n)=>{if(t===1e3){wi.set(1e3),yt("tutstep",`${t} ${e===1e4?1:0}`);return}return(n||e>0)&&(t===-1||fe.tutprogress===t)?(Wi.update(o=>o?(o.progress=Math.min(100,n||o.progress+e),o.complete=o.progress>=100,o.complete&&!o.closing&&(o.closing=!0,ko[fe.tutprogress].closing=!0,xt(92),setTimeout(()=>{Wi.set(),setTimeout(()=>{wi.update(s=>(yt("tutstep",`${s} ${e===1e4?1:0}`),ko[s+1]&&ko[s+1].element&&typeof ko[s+1].element!="string"&&(ko[s+1].element=ko[s+1].element()),s+1))},100)},200)),o):px(t)),!0):!1};var Wt={friendrequest:t=>({name:"Friend request",fun:()=>{Ft("/api/social/friendRequest",{name:t})}}),blockplayer:t=>({name:"Block",fun:()=>{Ft("/api/social/blockPlayer",{name:t})}}),partyleave:t=>({name:P.ui.party.leave,fun:()=>{yt("partyleave")}}),partyinvite:t=>({name:P.ui.party.invite,fun:()=>{yt("partyinvite",t)}}),partykick:t=>({name:P.ui.party.kick,fun:()=>{yt("partykick",t)}}),partygiveassistant:t=>({name:P.ui.party.giveAssistant,fun:()=>{yt("partysetrole",t+" 1")}}),partygiveleader:t=>({name:P.ui.party.giveLeader,fun:()=>{yt("partysetrole",t+" 2")}}),partyremoveassistant:t=>({name:P.ui.party.removeAssistant,fun:()=>{yt("partysetrole",t+" 0")}}),partycreate:t=>({name:P.ui.party.create,fun:()=>{yt("partycreate")}}),whisper:t=>({name:P.ui.chat.whisper,fun:()=>{Ro.set(`/${t} `)}}),itemdrop:(...t)=>({name:P.ui.inventory.drop,fun:()=>Q1(...t)}),itemsell:(...t)=>({name:P.ui.inventory.sell,fun:()=>Kf(...t)}),itemstash:t=>({name:P.ui.stash.stash,fun:()=>{yt("itemstash",t)}}),itemmove:(t,e)=>({name:P.ui.inventory.equip,fun:()=>{an(10,100),yt("itemmove",`${t} ${e}`)}}),itemsplithalf:t=>({name:P.ui.inventory.splithalf,fun:()=>{yt("itemsplithalf",t)}}),itemsplitone:t=>({name:P.ui.inventory.splitone,fun:()=>{yt("itemsplitone",t)}}),itemuse:(t,e,n,o)=>({name:P.ui.inventory.use,fun:()=>{Dp(n<o,()=>Io(Mt.clientPlayerSkill.packData({id:e,info:[t]})),"Bind Item","Using this item will bind it to you. Continue?")}}),itemcopyid:t=>({name:P.ui.inventory.copyitemid,fun:()=>{$3(t)}}),report:(t,e,n)=>({name:"Report",fun:o=>{mi.set({name:t,reason:0,messageId:e,info:n})}})},dx=(t,e)=>{let n=[{name:e.name,css:"disabled"}];e.type===0&&(e.id==I.playerId?fe.partyinfo.membercount>0?n.push(Wt.partyleave()):n.push(Wt.partycreate()):(e.faction===I.player.faction&&(Xt.has(e.name)?fe.partyinfo.role>e.role&&(fe.partyinfo.role==2&&n.push(Wt.partykick(e.name)),e.role==0?n.push(Wt.partygiveassistant(e.name)):e.role==1&&n.push(Wt.partyremoveassistant(e.name)),fe.partyinfo.role>1&&n.push(Wt.partygiveleader(e.name))):n.push(Wt.partyinvite(e.name))),n.push(Wt.friendrequest(e.name)),n.push(Wt.blockplayer(e.name)),n.push(Wt.report(e.name)),n.push(Wt.whisper(e.name)))),dn.set({x:t.pageX,y:t.pageY,opts:n})},hx=(t,e,n,o,s,i,r,l)=>{Dp(e>=fe.itemProtectQuality||n>0,()=>{yt(t,`${o}`)},r,`${l} ${nn(s,i)}?`)},Kf=(t,e,n,o,s)=>{hx("itemtradersell",t,e,n,o,s,"Sell item","Really sell")},Q1=(t,e,n,o,s)=>{hx("itemdrop",t,e,n,o,s,"Drop item","Really drop")};function gx(t){let e,n;return{c(){e=h("img"),p(e,"class","icon svelte-erbdzy"),at(e.src,n="/data/ui/icons/gem.svg?v=8738303")||p(e,"src",n)},m(o,s){w(o,e,s)},d(o){o&&x(e)}}}function R9(t){let e,n,o,s,i,r,l,a,c=t[4]&&gx(t);return{c(){e=h("span"),c&&c.c(),n=h("img"),s=T(t[1]),i=Ne(),r=h("span"),l=T(t[0]),p(n,"class","icon svelte-erbdzy"),at(n.src,o=ni(t[2]))||p(n,"src",o),p(e,"class","textwhite"),p(r,"class",a="name textf"+t[3]+" svelte-erbdzy")},m(f,u){w(f,e,u),c&&c.m(e,null),d(e,n),d(e,s),d(e,i),w(f,r,u),d(r,l)},p(f,[u]){f[4]?c||(c=gx(f),c.c(),c.m(e,n)):c&&(c.d(1),c=null),u&4&&!at(n.src,o=ni(f[2]))&&p(n,"src",o),u&2&&G(s,f[1]),u&1&&G(l,f[0]),u&8&&a!==(a="name textf"+f[3]+" svelte-erbdzy")&&p(r,"class",a)},i:ae,o:ae,d(f){f&&(x(e),x(r)),c&&c.d()}}}function z9(t,e,n){let{name:o}=e,{level:s}=e,{pclass:i}=e,{faction:r}=e,{sub:l=!1}=e;return t.$$set=a=>{"name"in a&&n(0,o=a.name),"level"in a&&n(1,s=a.level),"pclass"in a&&n(2,i=a.pclass),"faction"in a&&n(3,r=a.faction),"sub"in a&&n(4,l=a.sub)},[o,s,i,r,l]}var Z1=class extends Ce{constructor(e){super(),Pe(this,e,z9,R9,Be,{name:0,level:1,pclass:2,faction:3,sub:4})}},Xn=Z1;var cg={};Kn(cg,{addMessage:()=>Nt,hydratorItem:()=>ss,init:()=>K9,onWorldDestroy:()=>nE,postTick:()=>eE,wipeChatData:()=>ag});var vx=t=>{let e=(t||0).toString().split(""),n=e.splice(-2).join(""),o=e.splice(-2).join(""),s=e.join("");return{c:n,s:o,g:s}};var Xa=(t,e=!0)=>{let n=Object.entries(t);return n.forEach(o=>{o[0]=parseInt(o[0]),e&&typeof o[1]=="object"&&(o[1]=Xa(o[1]))}),new Map(n)};var ro=t=>t>=1e4?(t/1e3).toFixed(1)+"k":dt(t);var dt=t=>t<1e3?t+"":dt(~~(t/1e3))+","+("00"+~~(t%1e3)).substr(-3,3),bx=(t,e)=>t.length>e?`${t.slice(0,e-2)}...`:t,_x=Xa({14:.1,13:.1,9:.1,8:.1,16:.1}),B9=Xa({14:"%",13:"%",16:"%",18:"%"}),Qn=(t,e)=>(_x.has(t)&&(e*=_x.get(t),e=e.toFixed(e>=.1?1:2)),e+(B9.get(t)||""));var $9=t=>t.replace(/\$c(\d)/g,(e,n)=>`<img class=texticon src='${ni(n)}'>`),U9=t=>t.replace(/\$l(\d+)/g,(e,n)=>`<span class=textwhite>${n}</span>`),O9=t=>t.replace(/\$f(\d)(\w*)/g,(e,n,o)=>`<span class=textf${n}>${o}</span>`),N9=t=>t.replace(/\$gt/g,(e,n)=>'<img class="svgicon" src="/data/ui/icons/check.svg?v=8738303">'),j9=t=>t.replace(/\$e(\d+)/g,(e,n)=>eu(n,!1)),W9=t=>t.replace(/\$g(\d+)/g,(e,n)=>J1(n,!1)),G9=t=>t.replace(/\$m(\d+)/g,(e,n)=>K1(n,!1)),H9=t=>t.replace(/\$sp(\d+)/g,(e,n)=>"<img class=texticon src=/data/ui/icons/gem.svg?v=8738303/>"+n),Y9=t=>t.replace(/\$fm(\d+)/g,(e,n)=>`<span class=textfame><img class=svgicon src='/data/ui/currency/fame.svg?v=8738303'> ${n}</span>`),J1=(t,e=!1)=>{let{c:n,s:o,g:s}=vx(t),i="<span/>";return s!=""&&(i+=`<span class=${e?"textred":"textgold"}>${s}</span> <img class=texticon src='/data/ui/currency/gold.${On}?v=8738303'/>`),o!=""&&(i+=`<span class=${e?"textred":"textsilver"}>${o}</span> <img class=texticon src='/data/ui/currency/silver.${On}?v=8738303'/>`),n!=""&&(i+=`<span class=${e?"textred":"textcopper"}>${n}</span> <img class=texticon src='/data/ui/currency/copper.${On}?v=8738303'/>`),i+"</span>"};var K1=(t,e=!1)=>`<span class='${e?"textred":"textgold"}'><img class='svgicon' src='${nx}'> ${dt(t)}</span>`,eu=t=>`<span class='bold textpvp'><img class='svgicon' src='${tx(t)}'> ${dt(t)}</span>`,ml=(t,e)=>`<span class='bold textprimary'><img class='svgicon' src='${ox(t)}'> ${e}</span>`,X9=[$9,U9,O9,W9,Y9,N9,H9,G9,j9],tu=t=>X9.reduce((e,n)=>n(e),t);var eg,tg={},It=t=>(eg===void 0&&(eg=getComputedStyle(document.body)),tg[t]!==void 0?tg[t]:tg[t]=eg.getPropertyValue("--"+t));var yx=()=>{Eo.font="bold 18px hordes",Eo.fillText("Hordes",0,0)},fr=(t,e,n=1,o=1,s=1,i=1,r=0,l=0,a=.5,c=.5)=>{Eo.globalAlpha=fe.nameplateShowTransparency?n:1;let f=t.width*o,u=t.height*o,m=Math.round(f*s),g=Math.round(u*i);return m===0||g===0||Eo.drawImage(t,0,0,Math.round(t.width*s),Math.round(t.height*i),Math.round(e[0]-f*a+r*o),Math.round(e[1]-u*c+l*o),m,g),m},ur=(t,e,n,o,s,i=0,r=0,l=.5,a=.5)=>fr(nu(e,n),t,o,s,1,1,i,r,l,a),kx=(t,e,n,o,s=0,i=0,r=.5,l=.5)=>fr(e,t,n,o,1,1,s,i,r,l),pl=(t,e,n=!1)=>(n?(e[0]=t[0],e[1]=t[1]):Ao(e,t,ht.projectionViewMatrix),n||e[2]<1&&e[0]>-1&&e[0]<1?(e[1]=Math.max(-1,Math.min(e[1],1)),e[0]=Math.round((e[0]*.5+.5)*Vn.width),e[1]=Math.round((e[1]*-.5+.5)*Vn.height),e[1]=Math.max(30,e[1]),e):!1),xx=(t,e,n)=>{t.font="bold "+e+"px hordes",t.shadowColor="#000",t.shadowOffsetX=1,t.shadowOffsetY=1,t.fillStyle=n},Dt={name:{fill:It("name"),size:17},enemy:{fill:It("enemy"),size:17},pvp:{fill:It("pvp"),size:17},nameSmall:{fill:It("name"),size:13},enemySmall:{fill:It("enemy"),size:13},pvpSmall:{fill:It("pvp"),size:13},chatGlobal:{fill:It("global"),size:13,wrap:150},chatClan:{fill:It("clan"),size:13,wrap:150},chatParty:{fill:It("party"),size:13,wrap:150},chatWhisper:{fill:It("pvp"),size:13,wrap:150},chatYell:{fill:It("yell"),size:13,wrap:150},lev0:{fill:"#919191",size:13},lev1:{fill:It("name"),size:13},lev2:{fill:"#EEA303",size:13},lev3:{fill:It("enemy"),size:13},clan:{fill:It("clan"),size:17},faction0:{fill:It("f0"),size:17},faction1:{fill:It("f1"),size:17},faction0small:{fill:It("f0"),size:13},faction1small:{fill:It("f1"),size:13},phys:{fill:It("name"),size:18},physCrit:{fill:It("name"),size:24},spell:{fill:"#FFE404",size:28},spellCrit:{fill:"#FFE404",size:40},heal:{fill:"#12F027",size:28},mana:{fill:It("mana"),size:20},exp:{fill:It("exp"),size:20},fame:{fill:It("fame"),size:20},gold:{fill:"#EEDDA3",size:16},misc:{fill:"#A6EBFA",size:16},book:{fill:"#749DEF",size:20},rune:{fill:"#DC9A4D",size:20},itemgrey:{fill:"#747474",size:16},common:{fill:"#dddddd",size:20},uncommon:{fill:It("green"),size:20},rare:{fill:It("blue"),size:20},epic:{fill:It("purp"),size:20},legendary:{fill:"#EE960B",size:20},mythical:{fill:"#a72929",size:20},pheal:{fill:"#12F027",size:20},pdmg:{fill:It("enemy"),size:20}},ng={},nu=(t,{fill:e,size:n,wrap:o=0})=>{let s=t+e+n;if(ng[s])return ng[s];let i=document.createElement("canvas"),r=i.getContext("2d");return r.font="bold "+n+"px hordes",o>0?Q9(i,r,t,0,0,o,n,e):(i.width=Math.max(1,Math.ceil(r.measureText(t).width))+5,i.height=Math.ceil(n*1.2+5),xx(r,n,e),r.fillText(t,0,i.height-6)),ng[s]=i,i},Vo=(t,e,n,o,s,i,r)=>{t||(t=document.createElement("canvas"),t.width=n,t.height=o);let l=t.getContext("2d");return l.fillStyle=e,l.beginPath(),l.moveTo(s+r,i),l.arcTo(s+n,i,s+n,i+o,r),l.arcTo(s+n,i+o,s,i+o,r),l.arcTo(s,i+o,s,i,r),l.arcTo(s,i,s+n,i,r),l.closePath(),l.fill(),t},Q9=(t,e,n,o,s,i,r,l)=>{let a=n.split(" "),c=[],f=0,u="";for(let m=0;m<a.length;++m){let g=u+a[m]+" ",v=e.measureText(g);v.width>i?(c.push(u),u=a[m]+" "):(f=Math.max(f,v.width),u=g)}c.push(u),t.width=Math.ceil(f+5),t.height=Math.ceil(c.length*r+10),Vo(t,"#00000099",t.width,t.height,0,0,5),xx(e,r,l);for(let m=0;m<c.length;++m)e.fillText(c[m],o+5,(m+1)*r+3)};var wx=(t,e,n,o,s,i)=>og(t,s,i)&&Qa(o,s,i)&&ig(n,s,i)&&rg(e,s,i),og=(t,e,n)=>ln[e+n]===void 0?(console.log("Error: Item can EQUIP type not found: "+e+n),console.trace(),!1):t>=ln[e+n].level,Qa=(t,e,n)=>ln[e+n].class===void 0||t===ln[e+n].class,Z9=(t,e)=>t+At.get(e).skillpoints,sg=t=>t.reduce(Z9,0),ig=(t,e,n)=>e!=="book"||ou(t,ln[e+n].skillid)===ln[e+n].skilllevel;var ou=(t,e)=>t.reduce((n,o)=>n+(o===e),0);var rg=(t,e,n)=>ln[e+n].requiredSkill===void 0||t.indexOf(ln[e+n].requiredSkill)>0;var Mx=(t,e,n)=>ln[e+n].buyElo===void 0||t>=ln[e+n].buyElo;var Fx=(t,e,n,o)=>Math.ceil(t.goldValue||(.4*(t.level**1.3+e*.4))**(1.1+e/100)/Pn[t.type].drop)*(n||1)*(o?8:1);var mr=class{constructor(e){this.dbid=e,this.stats=new Map,this.dirty=!0}hydrate(e){if(this.dirty=!1,this.bound=e.bound,this.type=e.type,this.tier=e.tier,this.logic=ln[this.type+this.tier],this.auction=e.auction?new Date(e.auction):void 0,this.auctionprice=e.auctionprice,this.owner=e.name,this.stash=e.stash?new Date(e.stash):void 0,this.logic===void 0)throw"Unknown item "+e.type+e.tier;if(this.upgrade=e.upgrade,this.stats.clear(),e.rolls){if(this.setRolls(e.rolls),this.quality=this.nextRoll(),this.logic.stats){this.logic.stats.forEach((o,s)=>{this.stats.set(s,{type:"base",qual:this.quality,value:Math.floor(o.min+(o.max-o.min)*(this.quality/100)**2+Jf[s]*this.upgrade)})});let n=Math.min(4,Math.round((this.quality/100)**1.5*3.6));for(let o=0;o<n;++o){let s=this.nextRoll(),i=-1;for(;i===-1||this.stats.has(i);)i=parseInt(B1(lx,s/101)),s=(s+5)%100;let r=(this.nextRoll()+this.quality)/2;this.stats.set(i,{type:"bonus",qual:r,value:Math.ceil(Math.max((Zf[i].min+(Zf[i].max-Zf[i].min)*(r/100)**2)*this.logic.level*Pn[this.type].weight,Jf[i])+Jf[i]*this.upgrade)})}}this.quality=this.logic.quality||this.quality,this.stacks=void 0}else this.stacks=e.stacks,this.quality=this.logic.quality||0,this.setRolls();this.gs=0,this.logic.gs?this.gs=this.logic.gs:this.stats.forEach((n,o)=>{if(o===17)return;let s=n.value/Jf[o];this.type=="shield"&&n.type=="base"&&(s*=.5),this.type=="orb"&&n.type=="base"&&(s*=.7),this.gs+=s}),this.gs=Math.round(this.gs)}setRolls(e){this.rolls=e,this.currentRoll=0}nextRoll(){if(this.currentRoll==this.rolls.length)throw"roll maximum reached";return this.rolls[this.currentRoll++]}goldValue(e){if(!this.canBeSold())throw"Item cant have value because it cant be sold";return Fx(this.logic,this.quality,this.stacks,e)}storeValue(){return this.logic.storeValue||0}medalValue(){return this.logic.medalValue||0}canEquip(e){return wx(e.level,e.skills.skillIdsActive,e.skills.skillIdsLearned,e.class,this.type,this.tier)}canEquipClass(e){return Qa(e.class,this.type,this.tier)}equipReasons(e){let n=[];return this.logic.level&&n.push(["Lv. "+this.logic.level,!0]),n}canBeDropped(){return!Pn[this.type].undroppable&&!this.bound}canBeTraded(){return!this.bound}canBeSold(){return!this.logic.unsellable}getStashTime(){return this.dirty?0:this.stash!==void 0?this.stash.getTime():0}getEquipSlot(){return Pn[this.type].slot!==void 0?Pn[this.type].slot[0]:void 0}};var ss=new mr,J9=0,Cx=new kt(0,10),od=[],sd=[],K9=()=>{Un(Mt.serverChat.header,t=>{od.push(t)}),Un(Mt.serverSystemMessage.header,t=>{sd.push(t)})},lg=0,eE=(t,e)=>{od.forEach(n=>{let o=Mt.serverChat.decode(n);for(let s=0;s<o.items.length;++s){let i=o.items[s];i.rolls.length>0?i.stacks=null:i.rolls=void 0}if(o.from==""){let s=o.message.split(" "),i=s[0];if(i==="partyLootQueueResolve"&&!fe.msgItemPartyPickUp)return;P&&P.ui.messages[i]&&(o.message=P.ui.messages[i],s.splice(1).forEach((r,l)=>{o.message=o.message.replace("$"+(l+1),r)})),o.channel="notice"}else if(fe.chatbubbles&&lg>5){let s=o.channel=="to"?e.player.name:o.from,i=e.getPlayerByName(s);if(i){let r;switch(o.channel){case"from":case"to":r=Dt.chatWhisper;break;case"clan":r=Dt.chatClan;break;case"party":r=Dt.chatParty;break;case"yell":r=Dt.chatYell;break;default:case"global":r=Dt.chatGlobal;break}let l="",a=0;for(let c=0;c<o.items.length;++c){let f=o.items[c];l+=o.message.slice(a,f.index)+nn(f.type,f.tier),a=f.index}l+=o.message.slice(a),i.speech(s+": "+l,r)}}o.clan==="GM"&&o.channel==="global"&&(o.channel="GM"),Nt(o.channel,o.message,o.channel=="system"||o.channel=="notice",o.from,o.faction,o.class,o.level,o.subscribed,o.id,o.items)}),sd.forEach(n=>{n=Mt.serverSystemMessage.decode(n),n.messages.forEach(o=>{Nt(o.type,o.message,!0)})}),od.length=0,sd.length=0,lg++},tE=["faction","GM","clan","party","yell","to","from","global","pvp"],Nt=(t,e,n=!1,o,s,i,r,l,a=0,c)=>{Nc.update(f=>{f.length>100&&f.shift(),n&&(e=tu(e)),t==="from"&&(Cx.done(I.time)&&xt(97),Cx.reset(I.time));let u=tE.includes(t),m=new Date;return f.push({channel:t,time:`${String(m.getHours()).padStart(2,"0")}.${String(m.getMinutes()).padStart(2,"0")}`,text:e,key:++J9,sender:o,sub:l,faction:s,cclass:i,level:r,interpolate:n,id:a,items:c,showChannel:u}),f})},ag=()=>{Nc.set([]),lg=0},nE=()=>{od.length=0,sd.length=0};var oE=[["white","common","grey"],["green","uncommon","green-l"],["blue","rare","blue-l"],["purp","epic","purp-l"],["orange", "legendary","orange-l"],["red", "mythical","red-l"]],Za=t=>t>=110?5:t>=99?4:t>=90?3:t>=70?2:t>=50?1:0,jt=t=>oE[Za(t)];function Sx(t){let e,n=t[0].channel+"",o,s;return{c(){e=h("span"),o=T(n),s=Ne(),p(e,"class","capitalize channel")},m(i,r){w(i,e,r),d(e,o),w(i,s,r)},p(i,r){r&1&&n!==(n=i[0].channel+"")&&G(o,n)},d(i){i&&(x(e),x(s))}}}function Px(t){let e,n,o,s,i;return n=new Xn({props:{name:t[0].sender,pclass:t[0].cclass,level:t[0].level,faction:t[0].faction,sub:t[0].sub}}),{c(){e=h("span"),J(n.$$.fragment),p(e,"class","sender svelte-7c1tlw")},m(r,l){w(r,e,l),Q(n,e,null),o=!0,s||(i=[H(e,"contextmenu",t[3]),H(e,"dblclick",t[4])],s=!0)},p(r,l){let a={};l&1&&(a.name=r[0].sender),l&1&&(a.pclass=r[0].cclass),l&1&&(a.level=r[0].level),l&1&&(a.faction=r[0].faction),l&1&&(a.sub=r[0].sub),n.$set(a)},i(r){o||(S(n.$$.fragment,r),o=!0)},o(r){E(n.$$.fragment,r),o=!1},d(r){r&&x(e),Z(n),s=!1,rt(i)}}}function sE(t){let e,n,o,s=t[0].time+"",i,r,l,a,c,f,u,m=t[0].showChannel&&Sx(t),g=t[0].sender&&Px(t);return{c(){e=h("article"),n=h("div"),o=h("span"),i=T(s),r=h("span"),m&&m.c(),l=de(),g&&g.c(),c=h("span"),p(o,"class","time svelte-7c1tlw"),p(r,"class",a="text"+t[0].channel+" content svelte-7c1tlw"),p(c,"class",f="text"+t[0].channel+" svelte-7c1tlw"),p(n,"class","linewrap svelte-7c1tlw"),p(e,"class","line svelte-7c1tlw")},m(v,_){w(v,e,_),d(e,n),d(n,o),d(o,i),d(n,r),m&&m.m(r,null),d(r,l),g&&g.m(r,null),d(n,c),t[5](c),u=!0},p(v,[_]){(!u||_&1)&&s!==(s=v[0].time+"")&&G(i,s),v[0].showChannel?m?m.p(v,_):(m=Sx(v),m.c(),m.m(r,l)):m&&(m.d(1),m=null),v[0].sender?g?(g.p(v,_),_&1&&S(g,1)):(g=Px(v),g.c(),S(g,1),g.m(r,null)):g&&(we(),E(g,1,1,()=>{g=null}),Me()),(!u||_&1&&a!==(a="text"+v[0].channel+" content svelte-7c1tlw"))&&p(r,"class",a),(!u||_&1&&f!==(f="text"+v[0].channel+" svelte-7c1tlw"))&&p(c,"class",f)},i(v){u||(S(g),u=!0)},o(v){E(g),u=!1},d(v){v&&x(e),m&&m.d(),g&&g.d(),t[5](null)}}}function iE(t,e,n){let o;re(t,Lr,u=>n(6,o=u));let{line:s=void 0}=e,i,r=ci(),l=u=>{let m=[{name:s.sender,css:"disabled"}];I.player.name!==s.sender&&(s.faction==I.player.faction&&!Xt.has(s.sender)&&m.push(Wt.partyinvite(s.sender)),m.push(Wt.friendrequest(s.sender)),m.push(Wt.blockplayer(s.sender)),s.channel!=="to"&&m.push(Wt.report(s.sender,s.id,`Message: \u201C${s.text.length>40?s.text.substring(0,37)+"...":s.text}\u201D`)),m.push(Wt.whisper(s.sender))),dn.set({x:u.pageX,y:u.pageY,opts:m}),u.preventDefault()},a=u=>{if(u.altKey)Ro.update(m=>m+`>${u.currentTarget.item.id}`);else{let m=o?o.dbid:void 0;if(Xe(Lr,o=void 0,o),m!==u.currentTarget.item.id){let g=new mr(u.currentTarget.item.id);g.hydrate(u.currentTarget.item),Xe(Lr,o=g,o)}}};Fn(()=>{if(s.interpolate){let u=document.createElement("span");u.innerHTML=s.text,i.appendChild(u)}else{let u=document.createDocumentFragment(),m=0;s.items&&s.items.forEach(g=>{let v=s.text.substring(m,g.index);v.length>0&&u.appendChild(document.createTextNode(v)),m=g.index,ss.hydrate(g);let _=document.createElement("span"),b=jt(ss.quality);_.classList.add("chatItem","text"+b[0]),_.textContent=nn(ss.type,ss.tier);let k=_.innerHTML;ss.logic.stats&&(k+=`<span class=text${b[2]}> ${ss.quality}%</span>`),ss.upgrade&&(k+=`<span class=textprimary> +${ss.upgrade}</span>`),ss.stacks&&(k=`<span class=textsecondary>${ss.stacks}</span><span class='textgrey'>\xD7</span>${k}`),_.innerHTML="["+k+"]",_.item=g,_.addEventListener("click",a),u.appendChild(_)}),m<s.text.length&&u.appendChild(document.createTextNode(s.text.substring(m))),i.appendChild(u)}});let c=u=>{r("focuschat",s.sender)};function f(u){qt[u?"unshift":"push"](()=>{i=u,n(1,i)})}return t.$$set=u=>{"line"in u&&n(0,s=u.line)},[s,i,r,l,c,f]}var fg=class extends Ce{constructor(e){super(),Pe(this,e,iE,sE,yn,{line:0})}},Ax=fg;var{Map:rE}=qc;function Tx(t,e,n){let o=t.slice();return o[28]=e[n],o}function Ex(t,e,n){let o=t.slice();return o[31]=e[n],o}function Ix(t,e,n){let o=t.slice();return o[34]=e[n],o}function Dx(t,e){let n,o,s;return o=new Ax({props:{line:e[34]}}),o.$on("focuschat",e[8]),{key:t,first:null,c(){n=de(),J(o.$$.fragment),this.first=n},m(i,r){w(i,n,r),Q(o,i,r),s=!0},p(i,r){e=i;let l={};r[0]&64&&(l.line=e[34]),o.$set(l)},i(i){s||(S(o.$$.fragment,i),s=!0)},o(i){E(o.$$.fragment,i),s=!1},d(i){i&&x(n),Z(o,i)}}}function Vx(t){let e,n,o=t[31]+"",s,i,r,l;function a(...c){return t[14](t[31],...c)}return{c(){e=h("div"),n=T("/"),s=T(o),p(e,"class",i="choice textsystem text"+t[31]+" svelte-c6ga6k")},m(c,f){w(c,e,f),d(e,n),d(e,s),r||(l=H(e,"click",a),r=!0)},p(c,f){t=c},d(c){c&&x(e),r=!1,l()}}}function Lx(t){let e,n=t[28]+"",o,s,i,r;function l(...a){return t[18](t[28],...a)}return{c(){e=h("small"),o=T(n),p(e,"class",s="btn border black text"+(t[0].indexOf(t[28])<0?t[28]:"grey")+" svelte-c6ga6k")},m(a,c){w(a,e,c),d(e,o),i||(r=H(e,"click",l),i=!0)},p(a,c){t=a,c[0]&1&&s!==(s="btn border black text"+(t[0].indexOf(t[28])<0?t[28]:"grey")+" svelte-c6ga6k")&&p(e,"class",s)},d(a){a&&x(e),i=!1,r()}}}function lE(t){let e,n,o=[],s=new rE,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A=me(t[6]),C=z=>z[34].key;for(let z=0;z<A.length;z+=1){let q=Ix(t,A,z),L=C(q);s.set(L,o[z]=Dx(L,q))}let M=me(Object.keys(sl)),D=[];for(let z=0;z<M.length;z+=1)D[z]=Vx(Ex(t,M,z));let $=me(t[11]),V=[];for(let z=0;z<$.length;z+=1)V[z]=Lx(Tx(t,$,z));return{c(){e=h("div"),n=h("section");for(let z=0;z<o.length;z+=1)o[z].c();i=h("div"),r=h("section"),l=h("div"),a=h("div");for(let z=0;z<D.length;z+=1)D[z].c();c=h("div"),c.textContent="/[playername]",f=h("div"),u=T(t[7]),g=h("input"),_=h("div");for(let z=0;z<V.length;z+=1)V[z].c();p(n,"id","chat"),p(n,"class","panel frame scrollbar svelte-c6ga6k"),p(c,"class","choice textwhisper"),p(a,"class","panel context commandlist textsystem svelte-c6ga6k"),Le(a,"display",t[5]?"block":"none"),p(f,"class",m="command btn black text"+(Ci[t[7]]?Ci[t[7]].chat?t[7]:"system":"whisper")+" svelte-c6ga6k"),p(g,"id","chatinputelement"),p(g,"maxlength","480"),p(g,"type","text"),p(g,"autocomplete","off"),p(g,"class","svelte-c6ga6k"),p(l,"id","chatinput"),p(l,"class","inputcontainer panel-black border black svelte-c6ga6k"),p(r,"class",v="chatsection "+(t[4]?"":"hidden")+" svelte-c6ga6k"),p(_,"class",b="channelselect "+(t[4]?"hidden":"")+" svelte-c6ga6k"),p(i,"class","lowercontainer svelte-c6ga6k"),p(e,"class","l-corner-ll container uiscaled svelte-c6ga6k")},m(z,q){w(z,e,q),d(e,n);for(let L=0;L<o.length;L+=1)o[L]&&o[L].m(n,null);t[13](n),d(e,i),d(i,r),d(r,l),d(l,a);for(let L=0;L<D.length;L+=1)D[L]&&D[L].m(a,null);d(a,c),d(l,f),d(f,u),d(l,g),je(g,t[1]),t[17](g),d(i,_);for(let L=0;L<V.length;L+=1)V[L]&&V[L].m(_,null);k=!0,y||(F=[H(f,"click",t[15]),H(g,"input",t[16])],y=!0)},p(z,q){if(q[0]&320&&(A=me(z[6]),we(),o=En(o,q,C,1,z,A,s,n,Hn,Dx,null,Ix),Me()),q[0]&512){M=me(Object.keys(sl));let L;for(L=0;L<M.length;L+=1){let U=Ex(z,M,L);D[L]?D[L].p(U,q):(D[L]=Vx(U),D[L].c(),D[L].m(a,c))}for(;L<D.length;L+=1)D[L].d(1);D.length=M.length}if((!k||q[0]&32)&&Le(a,"display",z[5]?"block":"none"),(!k||q[0]&128)&&G(u,z[7]),(!k||q[0]&128&&m!==(m="command btn black text"+(Ci[z[7]]?Ci[z[7]].chat?z[7]:"system":"whisper")+" svelte-c6ga6k"))&&p(f,"class",m),q[0]&2&&g.value!==z[1]&&je(g,z[1]),(!k||q[0]&16&&v!==(v="chatsection "+(z[4]?"":"hidden")+" svelte-c6ga6k"))&&p(r,"class",v),q[0]&3073){$=me(z[11]);let L;for(L=0;L<$.length;L+=1){let U=Tx(z,$,L);V[L]?V[L].p(U,q):(V[L]=Lx(U),V[L].c(),V[L].m(_,null))}for(;L<V.length;L+=1)V[L].d(1);V.length=$.length}(!k||q[0]&16&&b!==(b="channelselect "+(z[4]?"hidden":"")+" svelte-c6ga6k"))&&p(_,"class",b)},i(z){if(!k){for(let q=0;q<A.length;q+=1)S(o[q]);k=!0}},o(z){for(let q=0;q<o.length;q+=1)E(o[q]);k=!1},d(z){z&&x(e);for(let q=0;q<o.length;q+=1)o[q].d();t[13](null),ot(D,z),t[17](null),ot(V,z),y=!1,rt(F)}}}function aE(t,e,n){let o,s,i,r,l;re(t,hf,R=>n(0,s=R)),re(t,Nc,R=>n(12,i=R)),re(t,Qs,R=>n(7,r=R)),re(t,Ro,R=>n(1,l=R));let a,c=!0;Ph(()=>{c=a&&(a.offsetHeight+a.scrollTop>a.scrollHeight-20||a.scrollTop==0)}),Bc(()=>{c!==!1&&a.scrollTo(0,a.scrollHeight)});let f,u=!1,m=[],g=0,v=!1,_="faction",b=new Map([["c","clan"],["p","party"],["f","faction"]]),k=R=>Ci[R]&&Ci[R].chat,y=R=>{let N=l;if(R.keyCode===13)if(R.target===f){if(R.target.value!=""){let Fe=R.target.value.match(/^\/[a-zA-Z0-9]+/g);Fe&&(Xe(Qs,r=Fe[0].substring(1),r),N=""),sl[r]!==void 0&&sl[r].client?sl[r].fun(N):yt(r,N),N="",f.blur(),n(4,u=!1)}else k(r)||yt(r,N),f.blur(),n(4,u=!1);let Y=`/${r} `,_e=m.indexOf(Y);_e>=0&&m.splice(_e,1),m.length>10&&m.splice(0,1),m.push(Y),k(r)?_=r:(Xe(Qs,r=_,r),g=m.length)}else document.activeElement==document.body&&A();else(R.keyCode===38||R.keyCode===40)&&m.length?R.target===f&&(g+=R.keyCode===38?-1:1,g=gt(g,0,m.length-1),N=m[g],R.preventDefault()):R.keyCode===27&&(f.blur(),n(4,u=!1));Xe(Ro,l=N,l)},F=R=>{f.focus()},A=R=>{R&&Xe(Qs,r=R.detail,r),n(4,u=!0),Dh().then(F)},C=R=>{Xe(Qs,r=R,r),n(5,v=!1),f.focus()};Fn(()=>{document.addEventListener("keydown",y)}),Tn(()=>{document.removeEventListener("keydown",y)});let M=R=>{let N=s.indexOf(R);hf.update(Y=>(N>=0?Y.splice(N,1):Y.push(R),Y))},D=["faction","party","clan","pvp","inv","yell"],$;function V(R){qt[R?"unshift":"push"](()=>{a=R,n(2,a)})}let z=(R,N)=>C(R),q=R=>n(5,v=!v);function L(){l=this.value,Ro.set(l)}function U(R){qt[R?"unshift":"push"](()=>{f=R,n(3,f)})}let W=(R,N)=>M(R);return t.$$.update=()=>{if(t.$$.dirty[0]&4098){let R=l,N=R.match(/^\/[a-zA-Z0-9]+ /g);if(N){let Y=N[0].substring(1,N[0].length-1);if(Y==="r"||Y==="w")for(let _e=i.length-1;_e>0;--_e){let Fe=i[_e];Fe.channel=="from"&&(Xe(Qs,r=Fe.sender,r),_e=0)}else Xe(Qs,r=b.has(Y)?b.get(Y):Y,r);Xe(Ro,l=R.substring(N[0].length),l),A()}R.length>0&&A()}t.$$.dirty[0]&4097&&n(6,o=i.filter(R=>s.indexOf(R.channel)<0))},[s,l,a,f,u,v,o,r,A,C,M,D,i,V,z,q,L,U,W]}var ug=class extends Ce{constructor(e){super(),Pe(this,e,aE,lE,Be,{},null,[-1,-1])}},qx=ug;function Rx(t){let e,n;return{c(){e=h("img"),at(e.src,n="/data/ui/icons/"+t[1]+".svg?v=8738303")||p(e,"src",n),p(e,"class","titleicon svgicon svelte-1f1v3u3")},m(o,s){w(o,e,s)},p(o,s){s[0]&2&&!at(e.src,n="/data/ui/icons/"+o[1]+".svg?v=8738303")&&p(e,"src",n)},d(o){o&&x(e)}}}function zx(t){let e,n,o,s;return{c(){e=h("img"),at(e.src,n="/data/ui/icons/cog.svg?v=8738303")||p(e,"src",n),p(e,"class","btn black svgicon")},m(i,r){w(i,e,r),o||(s=H(e,"click",t[13]),o=!0)},p:ae,d(i){i&&x(e),o=!1,s()}}}function Bx(t){let e,n,o,s;return{c(){e=h("img"),at(e.src,n="/data/ui/icons/cross.svg?v=8738303")||p(e,"src",n),p(e,"class","btn black svgicon")},m(i,r){w(i,e,r),o||(s=H(e,"click",t[20]),o=!0)},p:ae,d(i){i&&x(e),o=!1,s()}}}function cE(t){let e,n,o,s,i,r,l,a,c,f,u,m,g,v,_=t[1]&&Rx(t),b=t[3]&&zx(t),k=t[2]&&Bx(t),y=t[19].default,F=Jl(y,t,t[18],null);return{c(){e=h("div"),n=h("div"),o=h("div"),_&&_.c(),s=h("div"),i=h("div"),r=T(t[0]),b&&b.c(),l=de(),k&&k.c(),c=h("div"),F&&F.c(),p(s,"class","textprimary title svelte-1f1v3u3"),p(o,"class","titleframe svelte-1f1v3u3"),p(o,"style",a=t[7]?"":"cursor: pointer;"),p(c,"class",f="slot "+(t[4]?"scrollbar":"")+" svelte-1f1v3u3"),p(n,"class","window panel-black svelte-1f1v3u3"),p(e,"class","window-pos"),p(e,"style",u="z-index: "+t[5]+"; position: absolute; "+t[10]+": "+Math.round(t[8][0])+"px; "+t[11]+": "+Math.round(t[8][1])+"px;")},m(A,C){w(A,e,C),d(e,n),d(n,o),_&&_.m(o,null),d(o,s),d(s,i),d(i,r),b&&b.m(o,null),d(o,l),k&&k.m(o,null),d(n,c),F&&F.m(c,null),t[21](n),m=!0,g||(v=H(o,"mousedown",u2(t[12])),g=!0)},p(A,C){A[1]?_?_.p(A,C):(_=Rx(A),_.c(),_.m(o,s)):_&&(_.d(1),_=null),(!m||C[0]&1)&&G(r,A[0]),A[3]?b?b.p(A,C):(b=zx(A),b.c(),b.m(o,l)):b&&(b.d(1),b=null),A[2]?k?k.p(A,C):(k=Bx(A),k.c(),k.m(o,null)):k&&(k.d(1),k=null),(!m||C[0]&128&&a!==(a=A[7]?"":"cursor: pointer;"))&&p(o,"style",a),F&&F.p&&(!m||C[0]&262144)&&ea(F,y,A,A[18],m?Kl(y,A[18],C,null):ta(A[18]),null),(!m||C[0]&16&&f!==(f="slot "+(A[4]?"scrollbar":"")+" svelte-1f1v3u3"))&&p(c,"class",f),(!m||C[0]&288&&u!==(u="z-index: "+A[5]+"; position: absolute; "+A[10]+": "+Math.round(A[8][0])+"px; "+A[11]+": "+Math.round(A[8][1])+"px;"))&&p(e,"style",u)},i(A){m||(S(F,A),m=!0)},o(A){E(F,A),m=!1},d(A){A&&x(e),_&&_.d(),b&&b.d(),k&&k.d(),F&&F.d(A),t[21](null),g=!1,v()}}}function fE(t,e,n){let o;re(t,bf,ie=>n(26,o=ie));let{$$slots:s={},$$scope:i}=e,r=ci(),{title:l="Title"}=e,{icon:a=void 0}=e,{close:c=!0}=e,{cog:f=!0}=e,{scroll:u=!1}=e,{permanent:m=!0}=e,{settings:g=[]}=e,{origin:v="right bottom"}=e,{defaultOffset:_=[3,3]}=e,{zindex:b=9}=e,k,y,F=v==="center"?"left":v.split(" ")[0],A=v==="center"?"top":v.split(" ")[1],C=F==="right"?1:-1,M=A==="bottom"?1:-1,D=0,$=0,V=!1,z=[..._],q=[0,0],L=ie=>{ie.button!==0||V||(q=[ie.clientX,ie.clientY],document.addEventListener("mousemove",U),document.addEventListener("mouseup",W))},U=ie=>{n(8,z=[z[0]-(ie.clientX-q[0])*C,z[1]-(ie.clientY-q[1])*M]),q=[ie.clientX,ie.clientY],R()},W=()=>{document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",W)},R=()=>{let[ie,le,ge]=[k.offsetWidth,k.offsetHeight,30];n(8,z[0]=Math.max(-ie+ge,Math.min(z[0],D-ge)),z),n(8,z[1]=A==="bottom"?Math.max(-le+ge,Math.min(z[1],$-le)):Math.max(0,Math.min(z[1],$-ge)),z),N()};Fn(()=>{let ie=k.parentElement.parentElement;D=ie.clientWidth,$=ie.clientHeight;let le=o.find(ge=>ge.id===l);le?(n(8,z=le.offset),n(7,V=le.locked)):Y(),y=new ResizeObserver(ge=>{let{width:be,height:Te}=ge[0].contentRect;v==="center"&&(n(8,z[0]+=(be-D)/2,z),n(8,z[1]+=(Te-$)/2,z)),D=be,$=Te,R()}),y.observe(k.parentElement.parentElement)}),Tn(()=>{document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",W),y.disconnect(),n(6,k=y=void 0)});let N=()=>{m&&bf.update(ie=>{let le=ie.find(ge=>ge.id===l);return le||(le={id:l},ie.push(le)),le.offset=z,le.locked=V,ie})},Y=()=>{if(v==="center"){let[ie,le]=[k.offsetWidth,k.offsetHeight];n(8,z=[D/2-ie/2,$/2-le/2])}else n(8,z=[..._])},_e=ie=>{let le=[{name:l,css:"disabled"},{name:(V?"Unlock":"Lock")+" Window",fun:()=>{n(7,V=!V),N()}},{name:"Reset Window",fun:()=>{Y(),N()}},...g];dn.set({x:ie.pageX,y:ie.pageY,right:!0,opts:le})},Fe=()=>r("close");function he(ie){qt[ie?"unshift":"push"](()=>{k=ie,n(6,k)})}return t.$$set=ie=>{"title"in ie&&n(0,l=ie.title),"icon"in ie&&n(1,a=ie.icon),"close"in ie&&n(2,c=ie.close),"cog"in ie&&n(3,f=ie.cog),"scroll"in ie&&n(4,u=ie.scroll),"permanent"in ie&&n(14,m=ie.permanent),"settings"in ie&&n(15,g=ie.settings),"origin"in ie&&n(16,v=ie.origin),"defaultOffset"in ie&&n(17,_=ie.defaultOffset),"zindex"in ie&&n(5,b=ie.zindex),"$$scope"in ie&&n(18,i=ie.$$scope)},[l,a,c,f,u,b,k,V,z,r,F,A,L,_e,m,g,v,_,i,s,Fe,he]}var mg=class extends Ce{constructor(e){super(),Pe(this,e,fE,cE,Be,{title:0,icon:1,close:2,cog:3,scroll:4,permanent:14,settings:15,origin:16,defaultOffset:17,zindex:5},null,[-1,-1])}},$t=mg;function $x(t,e,n){let o=t.slice();return o[4]=e[n],o[6]=n,o}function Ux(t){let e,n;return e=new $t({props:{zindex:5,origin:"center",title:P.ui.headers.interaction,$$slots:{default:[uE]},$$scope:{ctx:t}}}),e.$on("close",t[3]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&129&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function Ox(t){let e,n,o=tu(t[4])+"",s,i,r;function l(...a){return t[2](t[6],...a)}return{c(){e=h("div"),n=h("span"),p(e,"class","btn border black textgreen"),p(e,"value",s=t[6])},m(a,c){w(a,e,c),d(e,n),n.innerHTML=o,i||(r=H(e,"click",l),i=!0)},p(a,c){t=a,c&1&&o!==(o=tu(t[4])+"")&&(n.innerHTML=o)},d(a){a&&x(e),i=!1,r()}}}function uE(t){let e,n,o=t[0].title+"",s,i,r=t[0].text+"",l,a=me(t[0].choices),c=[];for(let f=0;f<a.length;f+=1)c[f]=Ox($x(t,a,f));return{c(){e=h("div"),n=h("h3"),s=T(o),i=h("p"),l=T(r);for(let f=0;f<c.length;f+=1)c[f].c();p(n,"class","textprimary name svelte-k1vie9"),p(e,"class","container svelte-k1vie9")},m(f,u){w(f,e,u),d(e,n),d(n,s),d(e,i),d(i,l);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(e,null)},p(f,u){if(u&1&&o!==(o=f[0].title+"")&&G(s,o),u&1&&r!==(r=f[0].text+"")&&G(l,r),u&3){a=me(f[0].choices);let m;for(m=0;m<a.length;m+=1){let g=$x(f,a,m);c[m]?c[m].p(g,u):(c[m]=Ox(g),c[m].c(),c[m].m(e,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=a.length}},d(f){f&&x(e),ot(c,f)}}}function mE(t){let e,n,o=t[0]&&Ux(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[0]?o?(o.p(s,i),i&1&&S(o,1)):(o=Ux(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function pE(t,e,n){let o;re(t,js,l=>n(0,o=l));function s(l){Io(Mt.clientPlayerInteract.packData({id:l})),Xe(js,o=void 0,o)}return[o,s,(l,a)=>s(l),()=>{Xe(js,o=void 0,o)}]}var pg=class extends Ce{constructor(e){super(),Pe(this,e,pE,mE,Be,{})}},Nx=pg;function dE(t){let e,n,o,s,i,r,l,a,c,f=t[7].default,u=Jl(f,t,t[6],null);return{c(){e=h("div"),n=h("div"),o=h("span"),s=T(t[0]),i=h("span"),r=T(t[1]),u&&u.c(),p(o,"class","left svelte-i7i7g5"),p(i,"class","right svelte-i7i7g5"),p(n,"class",l="progressBar "+t[3]+" svelte-i7i7g5"),Le(n,"width",t[2]+"%"),Le(n,"font-size",t[4]),p(e,"class",a="bar "+(t[5]?"dark":"")+" svelte-i7i7g5"),Le(e,"z-index",t[3]=="hp"?"1":"0")},m(m,g){w(m,e,g),d(e,n),d(n,o),d(o,s),d(n,i),d(i,r),u&&u.m(e,null),c=!0},p(m,[g]){(!c||g&1)&&G(s,m[0]),(!c||g&2)&&G(r,m[1]),(!c||g&8&&l!==(l="progressBar "+m[3]+" svelte-i7i7g5"))&&p(n,"class",l),(!c||g&4)&&Le(n,"width",m[2]+"%"),(!c||g&16)&&Le(n,"font-size",m[4]),u&&u.p&&(!c||g&64)&&ea(u,f,m,m[6],c?Kl(f,m[6],g,null):ta(m[6]),null),(!c||g&32&&a!==(a="bar "+(m[5]?"dark":"")+" svelte-i7i7g5"))&&p(e,"class",a),(!c||g&8)&&Le(e,"z-index",m[3]=="hp"?"1":"0")},i(m){c||(S(u,m),c=!0)},o(m){E(u,m),c=!1},d(m){m&&x(e),u&&u.d(m)}}}function hE(t,e,n){let{$$slots:o={},$$scope:s}=e,{left:i=""}=e,{right:r=""}=e,{fract:l}=e,{barcol:a}=e,{size:c}=e,{darken:f}=e;return t.$$set=u=>{"left"in u&&n(0,i=u.left),"right"in u&&n(1,r=u.right),"fract"in u&&n(2,l=u.fract),"barcol"in u&&n(3,a=u.barcol),"size"in u&&n(4,c=u.size),"darken"in u&&n(5,f=u.darken),"$$scope"in u&&n(6,s=u.$$scope)},[i,r,l,a,c,f,s,o]}var dg=class extends Ce{constructor(e){super(),Pe(this,e,hE,dE,yn,{left:0,right:1,fract:2,barcol:3,size:4,darken:5})}},xo=dg;var hg={};Kn(hg,{init:()=>gE,updateCd:()=>iu});var su=new Map,jx=!1,gE=()=>{fetch("/data/ui/circlecooldowns/circlecooldowns.txt?v=8738303").then(async t=>{let e=(await t.text()).split(`
`);for(let n=0;n<3;++n){let o=[];for(let s=0;s<101;++s){let i=new Image;i.src=e.shift(),o.push([i])}su.set([40,31,23][n],o)}jx=!0})},iu=(t,e,n)=>{jx&&e&&t!==e.step&&(e.cdimg!==void 0&&(su.get(n)[e.step].push(e.removeChild(e.cdimg)),e.cdimg=void 0),(e.step=t)>0&&(su.get(n)[e.step].length===1?e.cdimg=su.get(n)[e.step][0].cloneNode():e.cdimg=su.get(n)[e.step].pop(),e.appendChild(e.cdimg)))};function Wx(t){let e,n;return{c(){e=h("div"),n=T(t[0]),p(e,"class","stacks slottext svelte-1nn7wcb")},m(o,s){w(o,e,s),d(e,n)},p(o,s){s&1&&G(n,o[0])},d(o){o&&x(e)}}}function Gx(t){let e,n=(t[5]>99?Math.round(t[5]/60)+"'":Math.ceil(t[5]))+"",o;return{c(){e=h("div"),o=T(n),p(e,"class","time absCentered slottext svelte-1nn7wcb")},m(s,i){w(s,e,i),d(e,o)},p(s,i){i&32&&n!==(n=(s[5]>99?Math.round(s[5]/60)+"'":Math.ceil(s[5]))+"")&&G(o,n)},d(s){s&&x(e)}}}function vE(t){let e,n,o,s,i,r,l,a,c,f,u=t[0]>1&&Wx(t),m=t[3]>30&&fe.cdTextBuffs&&t[5]>0&&Gx(t);return{c(){e=h("div"),n=h("div"),o=h("img"),i=h("div"),u&&u.c(),r=de(),m&&m.c(),p(o,"class","icon svelte-1nn7wcb"),at(o.src,s=t[1])||p(o,"src",s),Le(o,"max-width",t[3]+"px"),p(i,"class","overlay svelte-1nn7wcb"),p(n,"class",l="slot border "+(t[2]===1?"negative":"positive")+" svelte-1nn7wcb"),p(e,"class",a="container "+(t[5]<fe.buffCdFlashingDuration&&t[5]%fe.buffCdFlashingInterval*2>fe.buffCdFlashingInterval?"soon":"")+" svelte-1nn7wcb")},m(g,v){w(g,e,v),d(e,n),d(n,o),d(n,i),t[10](i),u&&u.m(n,null),d(n,r),m&&m.m(n,null),c||(f=H(e,"contextmenu",t[6]),c=!0)},p(g,[v]){v&2&&!at(o.src,s=g[1])&&p(o,"src",s),v&8&&Le(o,"max-width",g[3]+"px"),g[0]>1?u?u.p(g,v):(u=Wx(g),u.c(),u.m(n,r)):u&&(u.d(1),u=null),g[3]>30&&fe.cdTextBuffs&&g[5]>0?m?m.p(g,v):(m=Gx(g),m.c(),m.m(n,null)):m&&(m.d(1),m=null),v&4&&l!==(l="slot border "+(g[2]===1?"negative":"positive")+" svelte-1nn7wcb")&&p(n,"class",l),v&32&&a!==(a="container "+(g[5]<fe.buffCdFlashingDuration&&g[5]%fe.buffCdFlashingInterval*2>fe.buffCdFlashingInterval?"soon":"")+" svelte-1nn7wcb")&&p(e,"class",a)},i:ae,o:ae,d(g){g&&x(e),t[10](null),u&&u.d(),m&&m.d(),c=!1,f()}}}function _E(t,e,n){let{stacks:o}=e,{duration:s}=e,{time:i}=e,{icon:r}=e,{type:l}=e,{size:a}=e,{cancel:c}=e,f=1,u=0,m,g=()=>{c>=0&&yt("cancelbuff",c)};function v(_){qt[_?"unshift":"push"](()=>{m=_,n(4,m)})}return t.$$set=_=>{"stacks"in _&&n(0,o=_.stacks),"duration"in _&&n(7,s=_.duration),"time"in _&&n(8,i=_.time),"icon"in _&&n(1,r=_.icon),"type"in _&&n(2,l=_.type),"size"in _&&n(3,a=_.size),"cancel"in _&&n(9,c=_.cancel)},t.$$.update=()=>{t.$$.dirty&408&&(n(5,u=s-i),iu(Math.round(i/s*100),m,a))},[o,r,l,a,m,u,g,s,i,c,v]}var gg=class extends Ce{constructor(e){super(),Pe(this,e,_E,vE,yn,{stacks:0,duration:7,time:8,icon:1,type:2,size:3,cancel:9})}},Hx=gg;var Rg={};Kn(Rg,{envSkillId:()=>hr,findEnvironmentTarget:()=>t4,hoverinteractive:()=>wd,hovertarget:()=>_n,init:()=>CI,onWorldDestroy:()=>DI,parseHudTargets:()=>qg,playertarget:()=>zn,preTick:()=>TI,ray:()=>pr,setEnvCast:()=>uu,setHoverTarget:()=>fu,setTarget:()=>dr,targetSwitchConciliate:()=>Lg,targetSwitchNetTimer:()=>_l,tick:()=>EI});var Xx=(t,e,n)=>{let o=j.getUniformBlockIndex(t,e),s=j.getActiveUniformBlockParameter(t,o,j.UNIFORM_BLOCK_DATA_SIZE),i={name:e,size:s,uniforms:[],index:n},r=j.getActiveUniformBlockParameter(t,o,j.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES),l=j.getActiveUniforms(t,r,j.UNIFORM_OFFSET);for(let a=0;a<r.length;++a){let c=r[a],f=j.getActiveUniform(t,c),u=l[a],m=f.size,g=0,v=0,_=!1;f.type===j.FLOAT_VEC3?(g=3,v=m>1?4:3):f.type===j.FLOAT_VEC2?(g=2,v=m>1?4:2):f.type===j.FLOAT_VEC4?(g=4,v=4):f.type===j.FLOAT_MAT4?(g=16,v=16):f.type===j.FLOAT?(g=1,v=1):f.type===j.INT&&(g=1,v=1,_=!0),m*=g;let b={name:f.name.replace("[0]",""),size:m,offset:u,divisor:v,elements:g,isInt:_};i.uniforms.push(b)}return i.uniforms.sort((a,c)=>a.offset-c.offset),i},Ja=t=>{let e={layout:t,buffer:j.createBuffer(),data:{},dataArray:[]};j.bindBuffer(j.UNIFORM_BUFFER,e.buffer),j.bufferData(j.UNIFORM_BUFFER,t.size,j.DYNAMIC_DRAW),j.bindBuffer(j.UNIFORM_BUFFER,null);for(let n=0;n<t.uniforms.length;++n){let o=t.uniforms[n],s=[];for(let i=0;i<o.size;++i)s.push(0);e.data[o.name]=s,e.dataArray.push(s)}return e},dl=t=>{j.bindBufferBase(j.UNIFORM_BUFFER,t.layout.index,t.buffer)},Ei=(t,e,n,o=0)=>{o===0&&(o=e.length);for(let s=0;s<o;++s)t[s+n]=e[s]},Qx=new ArrayBuffer(1e3),bE=new Int32Array(Qx),Yx=new Float32Array(Qx),id=t=>{for(let e=0;e<t.layout.uniforms.length;++e){let n=t.layout.uniforms[e];t.data[n.name]!==t.dataArray[e]&&(t.dataArray[e]=t.data[n.name])}},lo=t=>{let e=0;for(let n=0;n<t.layout.uniforms.length;++n){let o=t.layout.uniforms[n],s=t.dataArray[n],i=o.isInt?bE:Yx,r=0;for(;r<s.length;)for(let l=0;l<o.divisor;++l)l<o.elements&&(i[e]=s[r],r++),e++}j.bindBuffer(j.UNIFORM_BUFFER,t.buffer),j.bufferSubData(j.UNIFORM_BUFFER,0,Yx,0,t.layout.size/4),j.bindBuffer(j.UNIFORM_BUFFER,null)};var Ka=[],ec,Fs,Ii,gl,vl,Zx=t=>{let e=tt.width,n=tt.height;for(let o=0;o<2;++o)Ka.push(Pi(t,t,0,!0,j.COMPARE_REF_TO_TEXTURE));ec=Pi(t,t,0,!0,j.COMPARE_REF_TO_TEXTURE),Fs=Pi(e,n,1,!0),Ii=Pi(e,n,1,!0),gl=Pi(Math.ceil(e/4),Math.ceil(n/4)),vl=Pi(Math.ceil(e/4),Math.ceil(n/4))},Jx=(t,e)=>{Rf(Fs,t,e),Rf(Ii,t,e),Rf(gl,Math.ceil(t/4),Math.ceil(e/4)),Rf(vl,Math.ceil(t/4),Math.ceil(e/4))};var _d={};Kn(_d,{bloom:()=>yg,bloomMerge:()=>kg,drop:()=>rd,foliagePlant:()=>ld,foliageStatic:()=>ad,fxaa:()=>xg,multimeshEffect:()=>cd,multimeshFlat:()=>fd,multimeshSimple:()=>ud,multimeshTextured:()=>ru,multimeshTexturedVcol:()=>md,multimeshTree:()=>vg,particles:()=>pd,particles_additive:()=>_g,particles_normal:()=>bg,ribbon:()=>lu,ribbonTextured:()=>Mg,shadowInstanced:()=>au,shadowInstancedAlpha:()=>Fg,simple:()=>dd,simpleTextured:()=>vI,simpleVcol:()=>_I,sky:()=>Cg,skyStarTex:()=>Sg,sun:()=>Pg,terrain:()=>hd,terrainEditorAreas:()=>bI,terrainEditorGrid:()=>yI,terrainEditorHeights:()=>kI,terrainEditorTiles:()=>xI,terrainFog:()=>gd,tint:()=>wg,water:()=>vd,waterEditorGrid:()=>wI});var ew=`#version 300 es
precision highp float;precision highp int;out vec4 fragColor;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D diffuse;in vec2 vUv;in float vShine;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 a=texture(diffuse,vUv);if(a.a<0.5)discard;a.rgb=mix(a.rgb*worldlight[1],a.rgb*1.1,smoothstep(-0.7,0.7,sin(time*6.0+vShine)));float b=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);a.rgb=mix(fog[0],a.rgb,b);fragColor=a;}`;var tw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in mat4 worldMatrix;in vec4 uvshift;in float shine;out float vShine;out vec2 vUv;void main(){vShine=shine;vWorldPos=worldMatrix*vec4(position,1.0);vUv=uvshift.zw-uv*uvshift.xy;vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);}`;var nw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform sampler2D foliageDiffuse;in vec3 vLight;in vec3 vLightAmb;in vec3 vLightDir;in vec2 vUv;out vec4 fragColor;void main(){vec4 b=texture(foliageDiffuse,vUv);float c=0.1;b.a=b.a*smoothstep(1.0,0.0,(vCameraDistance-110.0)/20.0);if(b.a<c){discard;};float d=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float e=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 f=shadowPVMatrix[1]*(vWorldPos);vec3 g=(f.xyz/f.w)*0.5+0.5;d=texture(shadowMaps[1],g);}else{vec4 f=shadowPVMatrix[0]*(vWorldPos);vec3 g=(f.xyz/f.w)*0.5+0.5;d=texture(shadowMaps[0],g);}d=d;d=max(d,e);}b.rgb=b.rgb*(vLight+vLightAmb+vLightDir*d);float h=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,h);fragColor=b;}`;var ow=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec4 instPos;in vec3 instNorm;in vec3 position;in vec2 uv;out vec3 vLightAmb;out vec3 vLightDir;out vec2 vUv;void main(){vUv=uv;vec3 b=vec3(0.0);for(int c=0;c<lightCount;++c){vec3 d=lightPos[c]-instPos.xyz;float e=lightCols[c].w-dot(d,d);if(e>0.0){e/=(lightCols[c].w);e=e*e;b+=0.3*lightCols[c].rgb*e;;}};vLight=b;vLightAmb=worldlight[1];vLightDir=worldlight[0]*max(0.0,dot(instNorm.xyz,worldlight[2]));vec3 f=position;float e=sin(time+instPos.x+f.x)*0.1*f.y;f.xz+=e;mat3 g;g[1]=instNorm.xyz;g[2]=normalize(cross(vec3(sin(instPos.x*100.0),0.0,cos(instPos.z*100.0)),g[1]));g[0]=normalize(cross(g[1],g[2]));vec3 h=g*f;vWorldPos=vec4(h*instPos.w+instPos.xyz,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var sw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform sampler2D foliageDiffuse;in vec3 vLightAmb;in vec3 vLightDir;in vec3 vLight;in vec2 vUv;out vec4 fragColor;void main(){vec4 b=texture(foliageDiffuse,vUv);b.a=b.a*smoothstep(1.0,0.0,(vCameraDistance-110.0)/20.0);if(b.a<0.5){discard;};float c=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float d=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 e=shadowPVMatrix[1]*(vWorldPos);vec3 f=(e.xyz/e.w)*0.5+0.5;c=texture(shadowMaps[1],f);}else{vec4 e=shadowPVMatrix[0]*(vWorldPos);vec3 f=(e.xyz/e.w)*0.5+0.5;c=texture(shadowMaps[0],f);}c=c;c=max(c,d);}b.rgb=b.rgb*(vLight+vLightAmb+vLightDir*c);float g=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,g);fragColor=b;}`;var iw=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec4 instPos;in vec3 instNorm;in vec3 position;in vec2 uv;out vec2 vUv;out vec3 vLightAmb;out vec3 vLightDir;void main(){vUv=uv;vec3 b=vec3(0.0);for(int c=0;c<lightCount;++c){vec3 d=lightPos[c]-instPos.xyz;float e=lightCols[c].w-dot(d,d);if(e>0.0){e/=(lightCols[c].w);e=e*e;b+=0.3*lightCols[c].rgb*e;;}}vLight=b;vLightAmb=worldlight[1];vLightDir+=worldlight[0]*max(0.0,dot(instNorm.xyz,worldlight[2]));vec3 f=position;mat3 g;g[1]=instNorm.xyz;g[2]=normalize(cross(vec3(sin(instPos.x*100.0),0.0,cos(instPos.z*100.0)),g[1]));g[0]=normalize(cross(g[1],g[2]));vec3 h=g*f;vWorldPos=vec4(h*instPos.w+instPos.xyz,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var rw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vCol;in vec2 vYcutoff;in vec4 vUvshift;out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec2 a=vec2((vUv.x+vUvshift.x)*vUvshift.z,(vUv.y+vUvshift.y)*vUvshift.w);vec4 b=vec4(1.0,1.0,1.0,texture(diffuse,a).r)*vCol;b.a*=min(1.0,max(0.0,vUv.y/vYcutoff[0]));b.a*=min(1.0,max(0.0,(vYcutoff[1]-vUv.y)/(1.0-vYcutoff[1])));if(b.a<0.01){discard;}float c=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,c);fragColor=b;fragColor.rgb*=fragColor.a;}`;var lw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in mat4 worldMatrix;in vec4 uvshift;in vec2 ycutoff;in vec4 color;out vec3 vNormal;out vec2 vUv;out vec4 vCol;out vec2 vYcutoff;out vec4 vUvshift;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vUvshift=uvshift;vCol=color;vYcutoff=ycutoff;vWorldPos=worldMatrix*vec4(position,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var aw=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 vLight;in vec4 vColor;in vec3 vNormal;in vec4 vInteriorlight;in float vAlpha;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}float o=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float p=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 q=shadowPVMatrix[1]*(vWorldPos);vec3 r=(q.xyz/q.w)*0.5+0.5;o=texture(shadowMaps[1],r);}else{vec4 q=shadowPVMatrix[0]*(vWorldPos);vec3 r=(q.xyz/q.w)*0.5+0.5;o=texture(shadowMaps[0],r);}o=o;o=max(o,p);}vec3 s=worldlight[1];vec3 t=worldlight[0];s=mix(s,vInteriorlight.rgb*0.5,vInteriorlight.a);t=mix(t,vInteriorlight.rgb,vInteriorlight.a);float u=max(0.0,min(1.0,vColor[3]*0.2));vec4 v=vec4(b(s,t,vColor.rgb,vNormal,o,vLight,u),vAlpha);float w=max(0.0,min(1.0,-vColor[3]));v.rgb=mix(v.rgb,vColor.rgb,w);float x=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);v.rgb=mix(fog[0],v.rgb,x);fragColor=v;}`;var cw=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 position;in vec3 normal;in vec4 color;in vec4 interiorlight;in float alpha;in mat4 worldMatrix;out vec4 vColor;out vec3 vNormal;out vec4 vInteriorlight;out float vAlpha;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vWorldPos=worldMatrix*vec4(position,1.0);vColor=color;vAlpha=alpha;vInteriorlight=interiorlight;vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var fw=`#version 300 es
precision highp float;precision highp int;in vec4 vColor;out vec4 fragColor;void main(){fragColor=vColor;fragColor.a=1.0;}`;var uw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 position;in vec4 color;in mat4 worldMatrix;out vec4 vColor;void main(){vColor=color;gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);;}`;var mw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Circle{vec4 circlePos;vec4 circleInfo;};in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vInteriorlight;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 o=texture(diffuse,vUv);if(o.a<0.5)discard;float p=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float q=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 r=shadowPVMatrix[1]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[1],s);}else{vec4 r=shadowPVMatrix[0]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[0],s);}p=p;p=max(p,q);}vec3 t=worldlight[1];vec3 u=worldlight[0];t=mix(t,vInteriorlight.rgb*0.5,vInteriorlight.a);u=mix(u,vInteriorlight.rgb,vInteriorlight.a);o.rgb=b(t,u,o.rgb,vNormal,p,vLight,0.0);o.rgb/=o.a;float v=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,v);float w=distance(vWorldPos.xz,circlePos.xz);float x=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(w<circlePos.w+0.1&&x>0.0){o.rgb=mix(o.rgb,circleInfo.rgb,x*circleInfo.a*((w<circlePos.w?w/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-w))/0.1)));}fragColor=o;}`;var pw=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in vec4 interiorlight;in mat4 worldMatrix;out vec3 vNormal;out vec2 vUv;out vec4 vInteriorlight;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vWorldPos=worldMatrix*vec4(position,1.0);vInteriorlight=interiorlight;vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var dw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Circle{vec4 circlePos;vec4 circleInfo;};in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vCol;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 o=texture(diffuse,vUv);if(o.a<0.5)discard;float p=(float(gl_FrontFacing)*2.0-1.0);float q=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float r=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 s=shadowPVMatrix[1]*(vWorldPos);vec3 t=(s.xyz/s.w)*0.5+0.5;q=texture(shadowMaps[1],t);}else{vec4 s=shadowPVMatrix[0]*(vWorldPos);vec3 t=(s.xyz/s.w)*0.5+0.5;q=texture(shadowMaps[0],t);}q=q;q=max(q,r);}vec3 u=mix(worldlight[1],vCol.rgb,vCol.a);vec3 v=worldlight[0]*(1.0-vCol.a);o.rgb=b(u,v,o.rgb,vNormal,q,vLight,0.0);float w=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,w);float x=distance(vWorldPos.xz,circlePos.xz);float y=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(x<circlePos.w+0.1&&y>0.0){o.rgb=mix(o.rgb,circleInfo.rgb,y*circleInfo.a*((x<circlePos.w?x/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-x))/0.1)));}fragColor=o;}`;var hw=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in vec4 color;in mat4 worldMatrix;out vec3 vNormal;out vec2 vUv;out vec4 vCol;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vCol=color;vWorldPos=worldMatrix*vec4(position,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var gw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){vec4 o=texture(diffuse,vUv);if(o.a<0.7)discard;if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}float p=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float q=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 r=shadowPVMatrix[1]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[1],s);}else{vec4 r=shadowPVMatrix[0]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[0],s);}p=p;p=max(p,q);}o.rgb=b(worldlight[1],worldlight[0],o.rgb,vNormal,p,vLight,0.0);o.rgb/=o.a;float t=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,t);fragColor=o;}`;var vw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec3 position;in vec4 info;in vec2 progress;in vec4 scaleRota;in vec4 colStart;in vec4 colEnd;out vec4 vCol;out float vRotationCos;out float vRotationSin;out vec2 vOffset;void main(){float a=min(info[3]-1.0,floor(mix(info[2],info[3],mod(info[0]*progress[0],1.0))));vOffset=vec2(fract(a*0.125),-floor(a/8.0)*0.125);vCol=mix(colStart,colEnd,progress[1]);float b=mix(scaleRota[2],scaleRota[3],progress[0]);vRotationCos=cos(b);vRotationSin=sin(b);float c=mix(scaleRota[0],scaleRota[1],progress[1])*(abs(vRotationSin)+abs(vRotationCos));vec4 d=viewMatrix*vec4(position,1.0);gl_PointSize=c*resolution[1]*projectionMatrix[1][1]/length(d.xyz);gl_Position=projectionMatrix*d;}`;var _w=`#version 300 es
precision highp float;precision highp int;uniform sampler2D particleDiffuse;in vec4 vCol;in vec2 vOffset;in float vRotationCos;in float vRotationSin;out vec4 fragColor;const float a=1.0/(1024.0/8.0);void main(){float b=0.5;float c=abs(vRotationSin)+abs(vRotationCos);vec2 d=vec2(gl_PointCoord.x-b,gl_PointCoord.y-b)*c;vec2 e=d*vRotationCos;vec2 f=d*vRotationSin;d=vec2(e.x+f.y+b,e.y-f.x+b);if(d.x<a||d.x>1.0-a||d.y>1.0-a||d.y<a){discard;}d.x*=0.125;d.y=1.0-d.y*0.125;vec4 g=vec4(1.0,1.0,1.0,texture(particleDiffuse,d+vOffset).r);g*=vCol;if(g.a<0.01){discard;}fragColor=g;fragColor.rgb*=fragColor.a;fragColor.a*=0.33;}`;var bw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D particleDiffuse;in vec4 vCol;in vec2 vOffset;in float vRotationCos;in float vRotationSin;out vec4 fragColor;const float a=1.0/(1024.0/8.0);void main(){float b=0.5;float c=abs(vRotationSin)+abs(vRotationCos);vec2 d=vec2(gl_PointCoord.x-b,gl_PointCoord.y-b)*c;vec2 e=d*vRotationCos;vec2 f=d*vRotationSin;d=vec2(e.x+f.y+b,e.y-f.x+b);if(d.x<a||d.x>1.0-a||d.y>1.0-a||d.y<a){discard;}d.x*=0.125;d.y=1.0-d.y*0.125;vec3 g=texture(particleDiffuse,d+vOffset).rgb;if((g.r+g.g+g.b)<0.1){discard;}fragColor=vec4(g.rgb,1.0);}`;var yw=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;uniform vec2 offset[4];uniform vec4 amount;in vec2 vUv;out vec4 fragColor;void main(){vec3 a=texture(inputA,vUv+offset[0]).rgb*amount[0];a+=texture(inputA,vUv+offset[1]).rgb*amount[1];a+=texture(inputA,vUv+offset[2]).rgb*amount[2];a+=texture(inputA,vUv+offset[3]).rgb*amount[3];fragColor=vec4(a,1.0);}`;var kw=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;uniform sampler2D inputB;uniform float amount;in vec2 vUv;out vec4 fragColor;void main(){vec4 a=texture(inputA,vUv);vec3 b=texture(inputB,vUv).rgb;b=b*b;fragColor.w=a.w;fragColor.xyz=b*amount+a.xyz;}`;var xw=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;in vec2 vUv;out vec4 fragColor;
#define a  4.0
#define b (1.0/a)
#define c (1.0/128.0)
#define d (1.0/8.0)
vec3 e(vec4 f,sampler2D g,vec2 h){vec3 i=textureLod(g,f.zw,0.0).xyz;vec3 j=textureLod(g,f.zw+vec2(1,0)*h.xy,0.0).xyz;vec3 k=textureLod(g,f.zw+vec2(0,1)*h.xy,0.0).xyz;vec3 l=textureLod(g,f.zw+vec2(1,1)*h.xy,0.0).xyz;vec3 m=textureLod(g,f.xy,0.0).xyz;vec3 n=vec3(0.299,0.587,0.114);float o=dot(i,n);float p=dot(j,n);float q=dot(k,n);float r=dot(l,n);float s=dot(m,n);float t=min(s,min(min(o,p),min(q,r)));float u=max(s,max(max(o,p),max(q,r)));vec2 v;v.x=-((o+p)-(q+r));v.y=((o+q)-(p+r));float w=max((o+p+q+r)*(0.25*b),c);float x=1.0/(min(abs(v.x),abs(v.y))+w);v=min(vec2(a,a),max(vec2(-a,-a),v*x))*h.xy;vec3 y=(1.0/2.0)*(textureLod(g,f.xy+v*(1.0/3.0-0.5),0.0).xyz+textureLod(g,f.xy+v*(2.0/3.0-0.5),0.0).xyz);vec3 az=y*(1.0/2.0)+(1.0/4.0)*(textureLod(g,f.xy+v*(0.0/3.0-0.5),0.0).xyz+textureLod(g,f.xy+v*(3.0/3.0-0.5),0.0).xyz);float aa=dot(az,n);if((aa<t)||(aa>u))return y;return az;}void main(){vec2 h=1.0/resolution;vec4 f=vec4(vUv,vUv-(h*(0.5+d)));vec3 ab=e(f,inputA,1.0/resolution);fragColor=vec4(ab,1.);}`;var ww=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D inputA;uniform vec4 tint;uniform float warp;in vec2 vUv;out vec4 fragColor;void main(){float a=0.01;float b=5.0;vec2 c;c.x=sin(vUv.y*10.0+time)*a;c.y=cos(vUv.x*10.0+time)*a;vec4 d=texture(inputA,vUv);vec4 e=texture(inputA,vUv+c);vec4 f=mix(d,e,warp);f.rgb=mix(f.rgb,tint.rgb*0.2+0.8*tint.rgb*length(f.rgb),tint.a);fragColor=f;}`;var Mw=`#version 300 es
precision highp float;precision highp int;uniform vec4 colStart;uniform vec4 colEnd;uniform vec2 offset;in vec2 vUv;out vec4 fragColor;void main(){fragColor=mix(colStart,colEnd,vUv.x);if(fragColor.a<0.01){discard;}fragColor.rgb*=fragColor.a;fragColor.a*=0.5;}`;var Fw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform vec2 offset;in vec3 position;in vec2 uv;out vec2 vUv;void main(){vUv=vec2(uv.x-min(uv.x/offset.y,1.0)*offset.x,uv.y);gl_Position=projectionViewMatrix*vec4(position,1.0);}`;var Cw=`#version 300 es
precision highp float;precision highp int;uniform vec4 colStart;uniform vec4 colEnd;uniform vec2 offset;uniform sampler2D diffuse;in vec2 vUv;out vec4 fragColor;void main(){fragColor=texture(diffuse,vUv);fragColor*=mix(colStart,colEnd,vUv.x);if(fragColor.a<0.01){discard;}}`;var Sw=`#version 300 es
precision highp float;precision highp int;void main(){}`;var Pw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in mat4 worldMatrix;in vec3 position;in vec2 uv;out vec2 vUv;void main(){vUv=uv;gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);}`;var Aw=`#version 300 es
precision highp float;precision highp int;in vec2 vUv;uniform sampler2D diffuse;void main(){if(texture(diffuse,vUv).a<0.7)discard;}`;var Tw=`#version 300 es
precision highp float;precision highp int;uniform vec4 color;out vec4 fragColor;void main(){fragColor=color;}`;var Ew=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 position;in vec2 uv;in vec3 normal;out vec2 vUv;out vec3 vNormal;out vec3 vPos;void main(){vUv=uv;vNormal=normal;vPos=position;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var Iw=`#version 300 es
precision highp float;precision highp int;uniform sampler2D diffuse;in vec2 vUv;out vec4 fragColor;void main(){vec4 a=texture(diffuse,vUv);vec3 b=normalize(vec3(1.0,1.0,0.3));fragColor=a;if(fragColor.a<0.2)discard;}`;var Dw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec2 uv;in vec3 position;in vec3 normal;out vec2 vUv;out vec3 vNormal;void main(){vUv=uv;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var Vw=`#version 300 es
precision highp float;precision highp int;in vec4 vColor;out vec4 fragColor;void main(){fragColor=vColor;}`;var Lw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 position;in vec4 color;out vec4 vColor;void main(){vColor=color;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var qw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Sky{vec3 skycolors[5];vec3 suncolor;};uniform sampler2D skyDiffuse;uniform sampler2D cloudDiffuse;in vec2 vUv;in vec3 vPos;out vec4 fragColor;void main(){gl_FragDepth=0.999999;vec3 a=vec3(0.0);float b=vPos.y/0.5;if(b>0.4){a=mix(skycolors[1],skycolors[0],smoothstep(0.4,1.0,b));}else if(b>0.25){a=mix(skycolors[2],skycolors[1],smoothstep(0.25,0.4,b));}else if(b>0.06){a=mix(skycolors[3],skycolors[2],smoothstep(0.06,0.25,b));}else{a=mix(fog[0],skycolors[3],smoothstep(0.0,0.06,b));}float c=1.0-sin(daycycle*6.28)+0.02;float d=smoothstep(0.1,0.5,b)*smoothstep(0.9,0.6,b);a+=texture(skyDiffuse,vUv*vec2(4.0,1.0)).rgb*c*d;float e=texture(cloudDiffuse,vec2(vUv.x+time/80.0,vUv.y*0.6+time/120.0)).r*texture(cloudDiffuse,vec2(vUv.x*2.0+time/300.0,vUv.y*0.6)).r;e=e*smoothstep(0.0,0.1,b)*smoothstep(0.9,0.6,b);e=smoothstep(0.25,0.7,e);a=mix(a,skycolors[4],e);fragColor=vec4(a,1.0);}`;var Rw=`#version 300 es
precision highp float;precision highp int;in vec2 vUv;uniform float seed;float a(in vec2 uv,float scale){uv*=scale;vec2 b=floor(uv),f=fract(uv),p;float c=3.,d;p=.5+.35*sin(11.*fract(sin((b+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);c=min(d,c);return smoothstep(0.,c,sin(f.x+f.y)*0.003);}vec2 d(vec2 e){e=vec2(dot(e,vec2(127.1,311.7)),dot(e,vec2(269.5,183.3)));return-1.0+2.0*fract(sin(e)*43758.5453123);}float f(in vec2 e){const float g=0.366025404;const float h=0.211324865;vec2 i=floor(e+(e.x+e.y)*g);vec2 j=e-i+(i.x+i.y)*h;vec2 l=(j.x>j.y)?vec2(1.0,0.0):vec2(0.0,1.0);vec2 m=j-l+h;vec2 n=j-1.0+2.0*h;vec3 q=max(0.5-vec3(dot(j,j),dot(m,m),dot(n,n)),0.0);vec3 r=q*q*q*vec3(dot(j,d(i+0.0)),dot(m,d(i+l)),dot(n,d(i+1.0)));float t=dot(r,vec3(70.0));return smoothstep(-1.0,1.0,t);}out vec4 fragColor;void main(){vec2 u=vec2(vUv.x+seed,vUv.y);float r=a(vUv,10.0);r+=a(vUv,20.0)*0.5;r+=a(vUv,30.0)*0.2;r*=f(vUv*20.0);fragColor.rgb+=r*4.0;}`;var zw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Sky{vec3 skycolors[5];vec3 suncolor;};in vec2 vUv;in vec3 vPos;out vec4 fragColor;void main(){gl_FragDepth=0.999998;float a=length(vec2(0.5,0.5)-vUv);float b=smoothstep(0.3,0.2,a)*2.0;b+=smoothstep(0.5,0.1,a);b*=smoothstep(0.08,0.15,(vPos.y+0.2)*0.2+abs(sin(daycycle*6.282)));fragColor.rgba=vec4(suncolor,b);}`;var Bw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;vec3 f(vec3 g,vec3 h,vec3 i,vec3 j,float k,vec3 l,float m){float n=clamp(dot(j,worldlight[2]),0.0,k);vec3 o=g*mix(0.7,1.1,0.5+(0.5*n));vec3 p=normalize(worldlight[2]+vViewDir);vec3 q=h*pow(max(0.0,dot(p,j)),20.0)*m*max(k*0.7+0.2,0.2)*20.0;vec3 r=o+h*n+l;return r*i+q;}void s(vec4 t,float u,vec4 v){float w=t.x+t.y+t.z;e+=v[3]*smoothstep(v[1],v[2],w)*u;t.a=u;t.rgb*=u;d+=t;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 x=texture(atlas,vUvChannel);x[3]=max(0.0,min(1.0,1.0-(x.r+x.g+x.b)));if(x[0]==1.0&&x[1]==1.0&&x[2]==1.0)discard;s(texture(diffuse[0],vUvTexture[0]),x[0],terrainInfo[0]);s(texture(diffuse[1],vUvTexture[1]),x[1],terrainInfo[1]);s(texture(diffuse[2],vUvTexture[2]),x[2],terrainInfo[2]);s(texture(diffuse[3],vUvTexture[3]),x[3],terrainInfo[3]);d.rgb/=d.a;e/=d.a;d.a=1.0;float y=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float az=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 aa=shadowPVMatrix[1]*(vWorldPos);vec3 ab=(aa.xyz/aa.w)*0.5+0.5;y=texture(shadowMaps[1],ab);}else{vec4 aa=shadowPVMatrix[0]*(vWorldPos);vec3 ab=(aa.xyz/aa.w)*0.5+0.5;y=texture(shadowMaps[0],ab);}y=y;y=max(y,az);}d.rgb=f(worldlight[1],worldlight[0],d.rgb,vNormal,y,vLight,e);float ac=distance(vWorldPos.xz,circlePos.xz);float ad=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(ac<circlePos.w+0.1&&ad>0.0){d.rgb=mix(d.rgb,circleInfo.rgb,ad*circleInfo.a*((ac<circlePos.w?ac/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-ac))/0.1)));}float ae=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,ae);fragColor=d;}`;var $w=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float a=256.0;const float b=4.0;in vec3 position;in vec3 normal;out vec3 vNormal;out vec3 vUvChannel;out vec2 vUvTexture[4];out vec3 vViewDir;void main(){vNormal=normal;vWorldPos=modelMatrix*vec4(position,1.0);vUvChannel=vec3(position[0],position[2],0.0)/32.0;int c=quadrant%2;int d=int(quadrant%4);if(c==1)vUvChannel.x-=1.0;if(d>1)vUvChannel.y-=1.0;vUvChannel.z=float(quadrant);vec2 e=vec2(-vWorldPos[0],vWorldPos[2])/4.0;vUvTexture[0]=e*terrainInfo[0][0];vUvTexture[1]=e*terrainInfo[1][0];vUvTexture[2]=e*terrainInfo[2][0];vUvTexture[3]=e*terrainInfo[3][0];for(int f=0;f<lightCount;++f){vec3 g=lightPos[f]-vWorldPos.xyz;float h=lightCols[f].w-dot(g,g);if(h>0.0){h/=(lightCols[f].w);h=h*h;vLight+=0.2*lightCols[f].rgb*h;}}vViewDir=-normalize(vWorldPos.xyz-cameraPosition);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var Uw=`#version 300 es
precision highp float;precision highp int;in vec4 vWorldPos;out vec4 fragColor;uniform vec4 colors[576];uniform int divider;void main(){float a=64.0/float(divider);int b=int(floor(mod(vWorldPos.x,64.0)/a)+floor(mod(vWorldPos.z,64.0)/a)*float(divider));fragColor.rgba=colors[b];}`;var Ow=`#version 300 es
precision highp float;precision highp int;in vec3 vPos;in vec3 vNormal;out vec4 fragColor;void main(){float a=0.0;if(vNormal.y<0.93){a=1.0;}fragColor=vec4(0.0,0.0,a,0.4+a*0.6);if(abs(vPos.x-0.0)<0.001||abs(vPos.x-64.0)<0.001||abs(vPos.z-0.0)<0.001||abs(vPos.z-64.0)<0.001)fragColor=vec4(1.0,1.0,0.0,1.0);if((abs(vPos.x-32.0)<0.001&&mod(vPos.z,1.0)<0.5)||(abs(vPos.z-32.0)<0.001&&mod(vPos.x,1.0)<0.5))fragColor=vec4(1.0,1.0,0.0,1.0);}`;var Nw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 normal;in vec3 position;out vec3 vPos;out vec3 vNormal;void main(){vNormal=normal;vPos=position;gl_Position=projectionViewMatrix*modelMatrix*vec4(position[0],position[1]+0.05,position[2],1.0);}`;var jw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;void f(vec4 g,float h,vec4 i){float j=g.x+g.y+g.z;e+=i[3]*smoothstep(i[1],i[2],j)*h;g.a=h;g.rgb*=h;d+=g;}out vec4 fragColor;void main(){vec4 k=texture(atlas,vUvChannel);k[3]=max(0.0,min(1.0,1.0-(k.r+k.g+k.b)));if(k[0]==1.0&&k[1]==1.0&&k[2]==1.0)discard;f(texture(diffuse[0],vUvTexture[0]),k[0],terrainInfo[0]);f(texture(diffuse[1],vUvTexture[1]),k[1],terrainInfo[1]);f(texture(diffuse[2],vUvTexture[2]),k[2],terrainInfo[2]);f(texture(diffuse[3],vUvTexture[3]),k[3],terrainInfo[3]);d.rgb/=d.a;e/=d.a;d.a=1.0;if(mod(vWorldPos.y,2.0)<0.2){d.rgb=mix(d.rgb,vec3(0.8),0.5);}else{d.rgb=mix(d.rgb,vec3(0.2),0.5);}vec3 l=worldlight[2];l.y*=0.5;l=normalize(l);d.rgb*=max(0.3,min(1.0,dot(l,vNormal)*0.5+0.5));float m=distance(vWorldPos.xz,circlePos.xz);if(m<circlePos.w+0.1){d.rgb=mix(d.rgb,circleInfo.rgb,circleInfo.a*(max(0.,(0.3-abs(circlePos.w-m))/0.3)));}float n=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,n);fragColor=d;}`;var Ww=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;void f(vec4 g,float h,vec4 i){float j=g.x+g.y+g.z;e+=i[3]*smoothstep(i[1],i[2],j)*h;g.a=h;g.rgb*=h;d+=g;}out vec4 fragColor;void main(){vec4 k=texture(atlas,vUvChannel);k[3]=max(0.0,min(1.0,1.0-(k.r+k.g+k.b)));if(k[0]==1.0&&k[1]==1.0&&k[2]==1.0)discard;d.rgb=texture(diffuse[0],vUvTexture[0]).rgb;float l=64.0/12.0;float m=l/2.0;bool n=mod(vWorldPos.z,l)>m;if(mod(vWorldPos.x,l)<m){if(n){d.rgb=vec3(0.45);}else{d.rgb=vec3(0.55);}}else{if(n){d.rgb=vec3(0.55);}else{d.rgb=vec3(0.45);}}vec3 o=worldlight[2];o.y*=0.5;o=normalize(o);d.rgb*=max(0.3,min(1.0,dot(o,vNormal)*0.5+0.5));float p=distance(vWorldPos.xz,circlePos.xz);if(p<circlePos.w+0.1){d.rgb=mix(d.rgb,circleInfo.rgb,circleInfo.a*(max(0.,(0.3-abs(circlePos.w-p))/0.3)));}float q=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,q);fragColor=d;}`;var Gw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;out vec4 fragColor;void main(){fragColor.rgb=fog[0];}`;var Hw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};in vec3 position;void main(){vec4 a=modelMatrix*vec4(position,1.0);gl_Position=projectionViewMatrix*a;}`;var Yw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};uniform sampler2D waterLines;uniform sampler2D waterNoise;uniform sampler2D bufferPongColor;uniform sampler2D bufferPongDepth;in vec2 vUv;out vec4 fragColor;void main(){float a=length(cameraPosition-vWorldPos.xyz);float b=(texture(waterNoise,vUv.yx/4.0+time*0.1).r-0.5);float c=gl_FragCoord.z;c=c*2.0-1.0;c=projectionMatrix[3][2]/(c+projectionMatrix[2][2]);if(a>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec2 d=gl_FragCoord.xy/resolution;float e=texture(bufferPongDepth,d.xy).r;e=e*2.0-1.0;e=projectionMatrix[3][2]/(e+projectionMatrix[2][2]);float f=e-c;vec2 g=vec2(b*0.05,0.0);float h=f;float i=1.0-clamp(h/0.1,0.0,1.0);float j=1.0-clamp(h/0.6,0.0,1.0);float k=1.0-clamp(h/2.0,0.0,1.0);float l=1.0-clamp(h/10.0,0.0,1.0);float m=1.0-clamp(h/100.0+0.5,0.0,1.0);float n=texture(waterLines,vUv.yx+b*0.15).r;vec3 o=mix(watercolors[2],watercolors[1],l);vec3 p=texture(bufferPongColor,d.xy+g).rgb;vec3 q=(worldlight[0]+worldlight[1]);vec3 r=mix(o,p*o,m)+n*watercolors[0]*(0.05+k*0.3);r=mix(r,watercolors[0],j)*q;vec4 s=vec4(r,1.0-i);float t=min(1.0,max(0.0,(n*(b+0.3)*0.5)));s.rgb+=t*worldlight[0];float u=clamp((fog[1][1]-a)/(fog[1][1]-fog[1][0]),0.0,1.0);s.rgb=mix(fog[0],s.rgb,u);fragColor=s;}`;var Xw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Water{vec3 verts[4];};in vec3 position;in vec3 color;in vec3 colorFoam;in vec3 colorShallow;out vec2 vUv;void main(){vWorldPos.xyz=verts[gl_VertexID];vWorldPos.w=1.0;vUv=vWorldPos.xz/2.0;gl_Position=projectionViewMatrix*vWorldPos;}`;var Qw=`#version 300 es
precision highp float;precision highp int;in vec4 vWorldPos;out vec4 fragColor;void main(){fragColor.rgba=vec4(1.0,mod(vWorldPos.y+0.001,1.0),0.0,0.5);}`;var rd={frag:ew,vert:tw},ld={frag:nw,vert:ow},ad={frag:sw,vert:iw},cd={frag:rw,vert:lw},fd={frag:aw,vert:cw},ud={frag:fw,vert:uw},ru={frag:mw,vert:pw},md={frag:dw,vert:hw},vg={frag:gw},pd={vert:vw},_g={frag:_w},bg={frag:bw},yg={frag:yw},kg={frag:kw},xg={frag:xw},wg={frag:ww},lu={frag:Mw,vert:Fw},Mg={frag:Cw},au={frag:Sw,vert:Pw},Fg={frag:Aw},dd={frag:Tw,vert:Ew},vI={frag:Iw,vert:Dw},_I={frag:Vw,vert:Lw},Cg={frag:qw},Sg={frag:Rw},Pg={frag:zw},hd={frag:Bw,vert:$w},bI={frag:Uw},yI={frag:Ow,vert:Nw},kI={frag:jw},xI={frag:Ww},gd={frag:Gw,vert:Hw},vd={frag:Yw,vert:Xw},wI={frag:Qw};var ut=[],Ag=[],mn={},Qt={},cu={},Jw=()=>{mn={shadowMaps:{value:[ec.depthTexture,Ka[1].depthTexture]}};for(let e in _d){let n=_d[e];n.vert&&(n.vert=n.vert.replace("#SHADOWS",fe.shadows?1:0)),n.frag&&(n.frag=n.frag.replace("#SHADOWS",fe.shadows?1:0))}let t={mesh:["position","uv","normal","color","interiorlight","alpha","worldMatrix"],effect:["position","uv","normal","color","uvshift","ycutoff","worldMatrix"],drop:["position","shine","uv","uvshift","worldMatrix"],particle:["position","info","progress","scaleRota","colStart","colEnd"],ribbon:["position","uv"],foliage:["position","uv","instPos","instNorm"],post:["position","uv"]};ut[13]=un({vertex:ld.vert,fragment:ld.frag,cullFace:null,instanced:[{name:"instPos",size:4},{name:"instNorm",size:3}],globalUniforms:mn,transparent:!0,attributeLocations:t.foliage}),ut[14]=un({vertex:ad.vert,fragment:ad.frag,cullFace:null,instanced:[{name:"instPos",size:4},{name:"instNorm",size:3}],globalUniforms:mn,transparent:!0,attributeLocations:t.foliage}),ut[3]=un({vertex:fd.vert,fragment:fd.frag,instanced:[{name:"color",size:4},{name:"alpha",size:1},{name:"interiorlight",size:4}],globalUniforms:mn,attributeLocations:t.mesh,transparent:!0}),ut[4]=un({vertex:ru.vert,fragment:ru.frag,instanced:[{name:"interiorlight",size:4}],globalUniforms:mn,attributeLocations:t.mesh}),ut[5]=un({vertex:md.vert,fragment:md.frag,globalUniforms:mn,attributeLocations:t.mesh}),ut[15]=un({vertex:cd.vert,fragment:cd.frag,globalUniforms:mn,transparent:!0,depthWrite:!1,instanced:[{name:"color",size:4},{name:"uvshift",size:4},{name:"ycutoff",size:2}],attributeLocations:t.effect}),ut[6]=un({vertex:ru.vert,fragment:vg.frag,globalUniforms:mn,instanced:[{name:"interiorlight",size:4}],attributeLocations:t.mesh}),ut[7]=un({vertex:ud.vert,fragment:ud.frag,instanced:[{name:"color",size:4}],globalUniforms:mn,attributeLocations:t.mesh}),ut[10]=un({vertex:rd.vert,fragment:rd.frag,instanced:[{name:"uvshift",size:4},{name:"shine",size:1}],globalUniforms:mn,attributeLocations:t.drop}),ut[8]=un({vertex:hd.vert,fragment:hd.frag,globalUniforms:mn,attributeLocations:t.mesh}),ut[9]=un({vertex:gd.vert,fragment:gd.frag,globalUniforms:mn,attributeLocations:t.mesh}),ut[12]=un({vertex:dd.vert,fragment:Pg.frag,transparent:!0,globalUniforms:mn,attributeLocations:t.mesh}),ut[20]=un({vertex:vd.vert,fragment:vd.frag,transparent:!0,cullFace:!1,globalUniforms:mn,attributeLocations:t.mesh}),ut[11]=un({vertex:dd.vert,fragment:Cg.frag,cullFace:null,depthTest:!0,globalUniforms:mn,attributeLocations:t.mesh}),ut[1]=un({cullFace:null,vertex:au.vert,fragment:Fg.frag,globalUniforms:mn,attributeLocations:t.mesh}),ut[2]=un({vertex:au.vert,fragment:au.frag,globalUniforms:mn,attributeLocations:t.mesh}),ut[16]=un({vertex:pd.vert,fragment:_g.frag,transparent:!0,depthWrite:!1,globalUniforms:mn,attributeLocations:t.particle}),ut[17]=un({vertex:pd.vert,fragment:bg.frag,transparent:!1,globalUniforms:mn,attributeLocations:t.particle}),ut[18]=un({vertex:lu.vert,fragment:lu.frag,transparent:!0,cullFace:null,depthWrite:!1,globalUniforms:mn,attributeLocations:t.ribbon}),ut[19]=un({vertex:lu.vert,fragment:Mg.frag,transparent:!0,cullFace:null,depthWrite:!1,globalUniforms:mn,attributeLocations:t.ribbon}),ut[32]=un({vertex:ka,fragment:xg.frag,depthWrite:!1,depthTest:!1,globalUniforms:mn,uniforms:{inputA:{value:null}},attributeLocations:t.post}),ut[30]=un({vertex:ka,fragment:yg.frag,depthWrite:!1,depthTest:!1,uniforms:{inputA:{value:null},offset:{value:[0,0,0,0,0,0,0,0]},amount:{value:[0,0,0,0]}},globalUniforms:mn,attributeLocations:t.post}),ut[31]=un({vertex:ka,fragment:kg.frag,depthWrite:!1,depthTest:!1,uniforms:{inputA:{value:null},inputB:{value:null},amount:{value:1}},globalUniforms:mn,attributeLocations:t.post}),ut[33]=un({vertex:ka,fragment:wg.frag,depthWrite:!1,depthTest:!1,globalUniforms:mn,uniforms:{inputA:{value:null},tint:{value:[0,0,0,0]},warp:{value:.5}},attributeLocations:t.post}),ut[34]=un({vertex:ka,fragment:Sg.frag,uniforms:{seed:{value:Date.now()%1e3}},attributeLocations:["position","uv"]}),MI(ut,mn),qf(ut[18],j.ONE,j.ONE_MINUS_SRC_ALPHA),qf(ut[16],j.ONE,j.ONE_MINUS_SRC_ALPHA),qf(ut[15],j.ONE,j.ONE_MINUS_SRC_ALPHA),Ag.push(3,4,6,7,10,15,5)},MI=(t,e)=>{let n=t[4].program,o=["Environment","Camera","Pointlights","Shadows","Circle","Screen","Sky","MeshTerrain","Water"],s=[n,n,n,n,n,t[32].program,t[11].program,t[8].program,t[20].program],i=[!0,!0,!0,!0,!0,!0,!0,!1,!1],r=[];for(let l=0;l<o.length;++l){let a=o[l],c=Xx(s[l],a,l),f=a.toLowerCase();if(cu[f]=c,r.push(c),i[l]){let u=Ja(c);dl(u),Qt[f]=u}}for(let l=0;l<t.length;++l){let a=t[l];a&&(J3(a,e),K3(a,r))}},Zw,bd=(t,e)=>{if(t!==Zw||e){let n=Qt.camera.data;Zw=t,Ei(n.cameraPosition,t.worldPosition,0),Ei(n.viewMatrix,t.viewMatrix,0),Ei(n.projectionMatrix,t.projectionMatrix,0),Ei(n.projectionViewMatrix,t.projectionViewMatrix,0),lo(Qt.camera)}},Kw=(t,e)=>{_o(Qt.screen.data.resolution,t,e),lo(Qt.screen)};var Tt=(t,e)=>{let n=t>>16&255,o=t>>8&255,s=t&255,i=[n/255,o/255,s/255];return e!==void 0&&i.push(e),i};var Rn={black:Tt(0,0),white:Tt(16777215,0),deadgrey:Tt(3355443,0),teal:Tt(3384995,0),magicblue:Tt(3362252,0),paleskin:Tt(14267315,0),darkskin:Tt(8411481,0),slimegreen:Tt(2542694,0),mushgreen:Tt(2077529,0),linen:Tt(13408614,0),woodbrown:Tt(4859433,0),woodbrown2:Tt(10250315,0),tealsteel:Tt(3358797,.5),darksteel:Tt(3355443,.5),greysteel:Tt(5066061,.5),blacksteel:Tt(988178,.5),leather:Tt(4337198,0),emerald:Tt(22866,-.1),gold:Tt(16751616,.9),darkgold:Tt(16747008,.9),paper:Tt(15129011,0),richpurple:Tt(7484623,0),fireorange:Tt(14715686,-.7),archergreen:Tt(10471258,0),warbrown:Tt(15172191,0),bronze:Tt(9258571,.5),silver:Tt(11583679,.6),shamanblue:Tt(3687924,0),mageblue:Tt(6607340,0),bone:Tt(14535066,.2),bone2:Tt(11836267,.2),ice:Tt(14610164,-.2),vanguard:Tt(2848511,0),bloodlust:Tt(14289947,0),pink:Tt(16711935,0),warden:Tt(14755623,0),evilred:Tt(13239043,0),ruby:Tt(15733030,1),moss:Tt(2925637,.2),rock:Tt(5006687,.4),death:Tt(3750201,.8),diamond:Tt(3076559,.9)},Tg=[Rn.woodbrown,Rn.bronze,Rn.greysteel,Rn.silver,Rn.gold],e4=[Rn.diamond,Rn.ruby],Eg=[Rn.leather,Rn.greysteel,Rn.silver,Rn.gold,Rn.diamond];var pr=[0,0,0],yd={enemy:[1,0,0],friendly:[0,1,0],dead:[.6,.6,.6]},dr=t=>{if(I&&I.player){let e=Mt.clientPlayerChangeTarget.packData({target:t});if(t!==zn)if(t>0){let n=I.entity(t);n!==void 0&&(n.type===3?n.canBePickedUpBy(I.player)&&xt(95):(xt(93),n.faction===2&&an(2,100)))}else t===0&&xt(94);oc=zn,_l.reset(I.time),I.player.setTarget(t),Io(e)}zn=t},zn=0,_n=0,wd=!1,_l=new kt(0,1),oc=0,Lg=t=>{oc!==t&&(oc=t,_l.done(I.time)?(I.player.setTarget(t),zn=t):_l.reset(I.time,gt(_l.passed(I.time)+.5,.5,2)))},Dg=0,CI=()=>{nt.lmb.onPress(t=>{Dg=I.time}),nt.lmb.onRelease(t=>{hr>0?II():_n>0&&Hf<20&&I.time-Dg<.3&&dr(_n)}),nt.nextTarget.onPress(t=>{nc=t.shiftKey?2:1}),nt.nextParty.onPress(t=>{nc=2}),nt.untarget.onPress(t=>{dr(0)})},fu=(t,e=!0)=>{_n=t,wd=e&&_n>0,vm.set(wd?"pointer":"auto"),km.set(_n)},SI=(t,e,n,o)=>{let s=[0,0,0];for(let i=0,r=o.length;i<r;++i){let l=o[i],[a,c,f]=l.hudPos;if(a>0&&a<e&&c>0&&c<n&&f<1){st(s,l.pos),s[1]+=l.size*.3;let u=oo(s,Zp(ht.worldPosition,pr,s));u<t&&u<(l.size+.7)**2&&l.stats.alive&&(t=u,_n=l.id)}}return t},PI=(t,e,n,o)=>{let s=!1;for(let i=0,r=o.length;i<r;++i){let l=o[i];if(l.hudPos[2]<1){let a=oo(l.pos,Zp(ht.worldPosition,pr,l.pos));a<t&&(t=a,_n=l.id,s=!0)}}return s},AI=()=>{hi(ht,pr,Kp),Zt(pr,pr,ht.worldPosition),to(pr,pr);let t=Vn.width,e=Vn.height,n=_n,o=20,s=!1;_n=0;for(let i=0;i<=12;++i)i!==3&&i!==11&&(o=SI(o,t,e,I.entities.type[i]));s=_n!==0,PI(Math.min(o,.7),t,e,I.entities.type[3])&&(s=I.entity(_n).canBePickedUpBy(I.player)),(n!=_n||s!==wd)&&fu(_n,s)},t4=t=>{let e=[0,0,0];va(An,ht.transform.worldMatrix),hi(ht,e,Kp),Zt(e,e,An),to(e,e);let n=[0,0];Cy(n,An,e,I.player.pos,xd);let o=999;if(t)if(o=n[1]-Math.max(0,n[0]),o<5||n[0]===-1&&n[0]===-1){let i=Zp(An,e,I.player.pos),r=i[0]-I.player.pos[0],l=i[2]-I.player.pos[2],a=1/Math.sqrt(r*r+l*l);st(An,I.player.pos),An[0]+=r*a*xd,An[1]+=10,An[2]+=l*a*xd,X(e,0,-1,0),o=20}else n[0]>0&&on(An,An,e,n[0]);gn(e,e,o);let s=I.raycastEnvironmentClosest(An[0],An[1],An[2],e[0],e[1],e[2]);return on(An,An,e,s),s===1&&(An[1]=I.getHeight(An[0],An[2])),An},TI=t=>{if(_l.done(I.time)&&zn!==oc&&I.player.setTarget(oc),!nt.shift.down){if(ed){_n>0&&(Hf>=20||I.time-Dg>.3)&&fu(0,!1);return}AI()}},is,Vg=0,tc=0,Ig=[1,1,1,.3],EI=t=>{let e=zn,n=_n>0?I.getEntityById(_n):void 0;n!==void 0?n!==is&&(is!==void 0&&is.visual!==void 0&&is.type!==3&&is.visual.removeColor(Ig),n.visual!==void 0&&n.type!==3&&n.visual.addColor(Ig),is=n):is!==void 0&&is.visual!==void 0&&(is.type!==3&&is.visual.removeColor(Ig),is=void 0);let o=Qt.circle.data;if(hr>0){let s=t4(!0);so(o.circleInfo,...yd.friendly,1),so(o.circlePos,s[0],s[1],s[2],n4)}else if(e!==Vg?(Vg=e,tc=1):tc=Math.max(tc*(1-t*10),0),e>0){let s=I.getEntityById(e);if(s!==void 0){so(o.circlePos,s.pos[0],s.pos[1]-s.radius,s.pos[2],s.size+tc);let i=s.stats&&s.stats.alive?I.player.hostility(s)>0?yd.enemy:yd.friendly:yd.dead;so(o.circleInfo,...i,1-tc)}}else so(o.circlePos,0,0,0,0);lo(Qt.circle)},kd=[],nc=0,qg=t=>{if(I.player){if(nc===1){let e=0,n=0;t=t.filter(s=>s.visual!==void 0&&s.stats!==void 0&&s.stats.alive&&s!==I.player&&I.player.hostility(s)>0&&I.player.canCombatInteract(s)&&Math.abs(fl(I.player.rot,I.player.rotationToV3(s.pos)))<.7);let o=zn===0;for(let s=t.length-1;s>=0;--s){let i=t[s];o&&(e=i.id),zn===i.id&&(o=!0),n||(n=i.id),e!==0&&(s=0)}e===0&&n!==0&&(e=n),dr(e),nc=0}else if(nc===2){let e=I.entities.type[0].filter(s=>!fe.nextFriendlyTargetAllowNonParty&&!Xt.has(s.name)?!1:s.stats&&s.stats.alive&&s.faction===I.player.faction&&Rr(s.pos,I.player.pos)<30).sort((s,i)=>{let r=Xt.has(s.name),l=Xt.has(i.name);return r&&!l?-1:!r&&l?1:0}),n=e.length;if(e=e.filter(s=>kd.indexOf(s.id)<0),e.length===0)dr(I.playerId);else{let s=e[0];dr(s.id)}kd.push(zn);let o=Math.min(10,fe.nextFriendlyTargetCycle||10,n);for(;o>0&&kd.length>=o;)kd.shift();nc=0}}},hr=0,xd=0,n4=0,An=[0,0,0],uu=(t,e,n)=>{hr=t,xd=e,n4=n},II=()=>{hr!==0&&(Io(Mt.clientPlayerEnvSkill.packData({id:hr,info:[],pos:An})),uu(0,0,0))},DI=()=>{oc=0,_l.reset(0),is=void 0,Vg=0,tc=0};function o4(t,e,n){let o=t.slice();return o[26]=e[n],o}function s4(t){let e,n,o,s,i,r,l,a,c,f,u,m=[],g=new Map,v,_,b,k,y,F,A=t[2]=="default"&&i4(t);a=new xo({props:{size:"1.3em",fract:t[8],barcol:t[13],left:t[10],right:t[6],darken:!1,$$slots:{default:[VI]},$$scope:{ctx:t}}});let C=(t[2]=="default"||t[18])&&l4(t);function M(L,U){return L[5].role>=1?RI:qI}let D=M(t,-1),$=D(t),V=t[2]=="default"&&t[5].combat&&t[5].alive&&a4(t),z=me(t[19]),q=L=>L[26].id;for(let L=0;L<z.length;L+=1){let U=o4(t,z,L),W=q(U);g.set(W,m[L]=c4(W,U))}return{c(){e=h("div"),n=h("div"),A&&A.c(),o=h("img"),r=h("div"),l=h("div"),J(a.$$.fragment),C&&C.c(),$.c(),f=de(),V&&V.c(),u=h("div");for(let L=0;L<m.length;L+=1)m[L].c();p(o,"class",s="pclass icon border black bgc"+t[5].class+" svelte-g292qg"),at(o.src,i=(t[5].rarity!==!1?"/data/ui/mobpower/"+t[5].rarity:"/data/ui/classes/"+t[5].class)+"."+On+"?v=8738303")||p(o,"src",i),p(n,"class","iconcontainer svelte-g292qg"),p(l,"class",c="panel-black barsInner "+(t[5].id&&t[5].range?"targetable":"")+" svelte-g292qg"),p(u,"class",v="buffarray "+t[2]+" svelte-g292qg"),p(r,"class",_="bars "+(t[17]&&t[5].id==t[17].id&&t[2]=="party"?"target":"")+" svelte-g292qg"),p(e,"id",t[4]),p(e,"class",b="grid "+(t[3]?"right":"left")+" svelte-g292qg"),Le(e,"font-size",t[15]+"%"),Le(e,"opacity",t[5].range?"":.6)},m(L,U){w(L,e,U),d(e,n),A&&A.m(n,null),d(n,o),d(e,r),d(r,l),Q(a,l,null),C&&C.m(l,null),$.m(r,null),d(r,f),V&&V.m(r,null),d(r,u);for(let W=0;W<m.length;W+=1)m[W]&&m[W].m(u,null);k=!0,y||(F=[H(l,"click",t[20]),H(l,"contextmenu",t[25])],y=!0)},p(L,U){L[2]=="default"?A||(A=i4(L),A.c(),A.m(n,o)):A&&(A.d(1),A=null),(!k||U&32&&s!==(s="pclass icon border black bgc"+L[5].class+" svelte-g292qg"))&&p(o,"class",s),(!k||U&32&&!at(o.src,i=(L[5].rarity!==!1?"/data/ui/mobpower/"+L[5].rarity:"/data/ui/classes/"+L[5].class)+"."+On+"?v=8738303"))&&p(o,"src",i);let W={};U&256&&(W.fract=L[8]),U&8192&&(W.barcol=L[13]),U&1024&&(W.left=L[10]),U&64&&(W.right=L[6]),U&536895748&&(W.$$scope={dirty:U,ctx:L}),a.$set(W),L[2]=="default"||L[18]?C?(C.p(L,U),U&262148&&S(C,1)):(C=l4(L),C.c(),S(C,1),C.m(l,null)):C&&(we(),E(C,1,1,()=>{C=null}),Me()),(!k||U&32&&c!==(c="panel-black barsInner "+(L[5].id&&L[5].range?"targetable":"")+" svelte-g292qg"))&&p(l,"class",c),D===(D=M(L,U))&&$?$.p(L,U):($.d(1),$=D(L),$&&($.c(),$.m(r,f))),L[2]=="default"&&L[5].combat&&L[5].alive?V||(V=a4(L),V.c(),V.m(r,u)):V&&(V.d(1),V=null),U&524292&&(z=me(L[19]),we(),m=En(m,U,q,1,L,z,g,u,Hn,c4,null,o4),Me()),(!k||U&4&&v!==(v="buffarray "+L[2]+" svelte-g292qg"))&&p(u,"class",v),(!k||U&131108&&_!==(_="bars "+(L[17]&&L[5].id==L[17].id&&L[2]=="party"?"target":"")+" svelte-g292qg"))&&p(r,"class",_),(!k||U&16)&&p(e,"id",L[4]),(!k||U&8&&b!==(b="grid "+(L[3]?"right":"left")+" svelte-g292qg"))&&p(e,"class",b),(!k||U&32768)&&Le(e,"font-size",L[15]+"%"),(!k||U&32)&&Le(e,"opacity",L[5].range?"":.6)},i(L){if(!k){S(a.$$.fragment,L),S(C);for(let U=0;U<z.length;U+=1)S(m[U]);k=!0}},o(L){E(a.$$.fragment,L),E(C);for(let U=0;U<m.length;U+=1)E(m[U]);k=!1},d(L){L&&x(e),A&&A.d(),Z(a),C&&C.d(),$.d(),V&&V.d();for(let U=0;U<m.length;U+=1)m[U].d();y=!1,rt(F)}}}function i4(t){let e;return{c(){e=h("div"),p(e,"class","deco svelte-g292qg")},m(n,o){w(n,e,o)},d(n){n&&x(e)}}}function r4(t){let e,n,o;return{c(){e=h("div"),p(e,"class",n="progressBar "+t[13]+" hpdelta svelte-g292qg"),p(e,"style",o=(t[14]?"transition:none;":"")+"width:"+t[8]+"%;")},m(s,i){w(s,e,i)},p(s,i){i&8192&&n!==(n="progressBar "+s[13]+" hpdelta svelte-g292qg")&&p(e,"class",n),i&16640&&o!==(o=(s[14]?"transition:none;":"")+"width:"+s[8]+"%;")&&p(e,"style",o)},d(s){s&&x(e)}}}function VI(t){let e,n=t[2]=="default"&&r4(t);return{c(){n&&n.c(),e=de()},m(o,s){n&&n.m(o,s),w(o,e,s)},p(o,s){o[2]=="default"?n?n.p(o,s):(n=r4(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(o){o&&x(e),n&&n.d(o)}}}function l4(t){let e,n;return e=new xo({props:{size:"0.7em",fract:t[9],barcol:t[16],left:t[11],right:t[7],darken:!0,$$slots:{default:[LI]},$$scope:{ctx:t}}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&512&&(i.fract=o[9]),s&65536&&(i.barcol=o[16]),s&2048&&(i.left=o[11]),s&128&&(i.right=o[7]),s&536875008&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function LI(t){let e;return{c(){e=h("div"),p(e,"class","progressBar bgspell castbar svelte-g292qg"),Le(e,"width",t[12]+"%"),Le(e,"display",t[12]>0?"inherit":"none")},m(n,o){w(n,e,o)},p(n,o){o&4096&&Le(e,"width",n[12]+"%"),o&4096&&Le(e,"display",n[12]>0?"inherit":"none")},d(n){n&&x(e)}}}function qI(t){let e,n,o;return{c(){e=h("img"),p(e,"class",n="tag icon border black bgf"+t[5].faction+" round svelte-g292qg"),at(e.src,o="/data/ui/factions/"+t[5].faction+"."+On+"?v=8738303")||p(e,"src",o)},m(s,i){w(s,e,i)},p(s,i){i&32&&n!==(n="tag icon border black bgf"+s[5].faction+" round svelte-g292qg")&&p(e,"class",n),i&32&&!at(e.src,o="/data/ui/factions/"+s[5].faction+"."+On+"?v=8738303")&&p(e,"src",o)},d(s){s&&x(e)}}}function RI(t){let e,n;return{c(){e=h("img"),p(e,"class","tag icon border black bgblack round svelte-g292qg"),at(e.src,n="/data/ui/icons/"+(t[5].role==2?"star":"starsilver")+"."+On+"?v=8738303")||p(e,"src",n)},m(o,s){w(o,e,s)},p(o,s){s&32&&!at(e.src,n="/data/ui/icons/"+(o[5].role==2?"star":"starsilver")+"."+On+"?v=8738303")&&p(e,"src",n)},d(o){o&&x(e)}}}function a4(t){let e;return{c(){e=h("div"),p(e,"class","tag icon border black round combat svelte-g292qg")},m(n,o){w(n,e,o)},d(n){n&&x(e)}}}function c4(t,e){let n,o,s,i=[e[26],{size:e[2]=="default"?31:23}],r={};for(let l=0;l<i.length;l+=1)r=Zl(r,i[l]);return o=new Hx({props:r}),{key:t,first:null,c(){n=de(),J(o.$$.fragment),this.first=n},m(l,a){w(l,n,a),Q(o,l,a),s=!0},p(l,a){e=l;let c=a&524292?dm(i,[a&524288&&hm(e[26]),a&4&&{size:e[2]=="default"?31:23}]):{};o.$set(c)},i(l){s||(S(o.$$.fragment,l),s=!0)},o(l){E(o.$$.fragment,l),s=!1},d(l){l&&x(n),Z(o,l)}}}function zI(t){let e,n,o=t[5].visible&&s4(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[5].visible?o?(o.p(s,i),i&32&&S(o,1)):(o=s4(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function BI(t,e,n){let o,s,i,r,l=ae,a=()=>(l(),l=us(v,Y=>n(5,r=Y)),v),c,f,u,m=ae,g=()=>(m(),m=us(_,Y=>n(19,u=Y)),_);re(t,Gs,Y=>n(17,c=Y)),re(t,Fa,Y=>n(18,f=Y)),t.$$.on_destroy.push(()=>l()),t.$$.on_destroy.push(()=>m());let{unit:v}=e;a();let{buffs:_}=e;g();let{mode:b="default"}=e,{order:k=0}=e,{id:y=""}=e,F,A,C,M,D,$,V,z,q,L,U=!1,W=0,R=Y=>{r.id&&dr(r.id)},N=Y=>dx(Y,r);return t.$$set=Y=>{"unit"in Y&&a(n(0,v=Y.unit)),"buffs"in Y&&g(n(1,_=Y.buffs)),"mode"in Y&&n(2,b=Y.mode),"order"in Y&&n(3,k=Y.order),"id"in Y&&n(4,y=Y.id)},t.$$.update=()=>{t.$$.dirty&32&&n(24,o=r.world==I.id?r.alive?!1:"Dead":r.world),t.$$.dirty&18874404&&(n(21,F=r.hpMax?b=="default"?ro(r.hp)+"/"+ro(r.hpMax):ro(r.hp):"?"),n(6,C=o||F),n(8,D=o!="offline"?~~(r.hpMax?r.hp/r.hpMax*100:100):0),n(13,L=o?"bggrey":(I.mode.partyBasedHostility?r.party===I.player.party:r.faction===I.player.faction)?"bghealth":"bgenemy")),t.$$.dirty&36&&n(22,A=r.mpMax?b=="default"?ro(r.mp)+"/"+ro(r.mpMax):ro(r.mp):"?"),t.$$.dirty&32&&n(10,V=r.name?bx(r.name,10):""),t.$$.dirty&32&&n(11,z=r.timedSkill?(P.ui.hiddenskills[r.timedSkill.id]||P.items.book[r.timedSkill.id]).name:`Lv. ${r.level}`),t.$$.dirty&20971552&&n(7,M=o||(r.timedSkill?r.timedCast.remaining(I.smoothtime).toFixed(1):A)),t.$$.dirty&16777248&&n(9,$=o!="offline"?~~(r.mpMax?r.mp/r.mpMax*100:100):0),t.$$.dirty&16777248&&n(12,q=o!="offline"&&r.timedSkill?r.timedCast.fraction(I.smoothtime)*100:0),t.$$.dirty&16777216&&n(16,s=o?"bggrey":"bgmana"),t.$$.dirty&4&&n(15,i=Math.round(b=="default"?100:85)),t.$$.dirty&8388640&&(n(14,U=W!=r.id),n(23,W=r.id))},[v,_,b,k,y,r,C,M,D,$,V,z,q,L,U,i,s,c,f,u,R,F,A,W,o,N]}var zg=class extends Ce{constructor(e){super(),Pe(this,e,BI,zI,Be,{unit:0,buffs:1,mode:2,order:3,id:4})}},mu=zg;function $I(t){let e,n,o,s;return n=new mu({props:{id:"ufplayer",order:0,unit:Ws,buffs:ca}}),o=new mu({props:{id:"uftarget",order:1,unit:Gs,buffs:jc}}),{c(){e=h("div"),J(n.$$.fragment),J(o.$$.fragment),p(e,"class","targetframes svelte-17up9g6")},m(i,r){w(i,e,r),Q(n,e,null),Q(o,e,null),s=!0},p:ae,i(i){s||(S(n.$$.fragment,i),S(o.$$.fragment,i),s=!0)},o(i){E(n.$$.fragment,i),E(o.$$.fragment,i),s=!1},d(i){i&&x(e),Z(n),Z(o)}}}var Bg=class extends Ce{constructor(e){super(),Pe(this,e,null,$I,yn,{})}},f4=Bg;function u4(t){let e,n;return{c(){e=h("span"),n=T(t[1]),p(e,"class","slottext key svelte-17ebtat")},m(o,s){w(o,e,s),d(e,n)},p(o,s){s[0]&2&&G(n,o[1])},d(o){o&&x(e)}}}function m4(t){let e,n;return{c(){e=h("span"),n=T(t[2]),p(e,"class","slottext stacks svelte-17ebtat")},m(o,s){w(o,e,s),d(e,n)},p(o,s){s[0]&4&&G(n,o[2])},d(o){o&&x(e)}}}function p4(t){let e,n=(t[4]>99?Math.round(t[4]/60)+"'":t[4]<=3?t[4].toFixed(1):Math.ceil(t[4]))+"",o;return{c(){e=h("div"),o=T(n),p(e,"class","time absCentered slottext svelte-17ebtat")},m(s,i){w(s,e,i),d(e,o)},p(s,i){i[0]&16&&n!==(n=(s[4]>99?Math.round(s[4]/60)+"'":s[4]<=3?s[4].toFixed(1):Math.ceil(s[4]))+"")&&G(o,n)},d(s){s&&x(e)}}}function d4(t){let e;return{c(){e=h("div"),p(e,"class","autocast svelte-17ebtat")},m(n,o){w(n,e,o)},d(n){n&&x(e)}}}function h4(t){let e,n,o,s=t[31].default,i=Jl(s,t,t[30],null);return{c(){e=h("div"),i&&i.c(),p(e,"class",n="border "+t[5]+" slotdescription svelte-17ebtat"),p(e,"style",t[9])},m(r,l){w(r,e,l),i&&i.m(e,null),t[33](e),o=!0},p(r,l){i&&i.p&&(!o||l[0]&1073741824)&&ea(i,s,r,r[30],o?Kl(s,r[30],l,null):ta(r[30]),null),(!o||l[0]&32&&n!==(n="border "+r[5]+" slotdescription svelte-17ebtat"))&&p(e,"class",n),(!o||l[0]&512)&&p(e,"style",r[9])},i(r){o||(S(i,r),o=!0)},o(r){E(i,r),o=!1},d(r){r&&x(e),i&&i.d(r),t[33](null)}}}function UI(t){let e,n,o,s,i,r,l,a,c,f,u,m,g=t[1]!==void 0&&u4(t),v=t[2]!==void 0&&m4(t),_=fe.cdTextSkills&&t[4]!==void 0&&p4(t),b=t[10]&&d4(t),k=t[8]&&t[11]&&!t[15]&&h4(t);return{c(){e=h("div"),g&&g.c(),n=de(),v&&v.c(),o=de(),_&&_.c(),s=h("div"),b&&b.c(),r=h("img"),k&&k.c(),p(s,"class",i="overlay "+t[16]+" "+(!t[14]||t[3]>0&&t[3]<10?"":"offCd")+" svelte-17ebtat"),p(r,"class",l="icon "+t[6]+" svelte-17ebtat"),at(r.src,a=t[17])||p(r,"src",a),p(e,"id",t[7]),p(e,"class",c="border "+t[5]+" "+(t[15]&&t[15].data==t[0]?"grey":"")+" slot "+(t[11]?"hover":"")+" "+(t[0]!==void 0||t[15]?"filled":"")+" svelte-17ebtat")},m(y,F){w(y,e,F),g&&g.m(e,null),d(e,n),v&&v.m(e,null),d(e,o),_&&_.m(e,null),d(e,s),t[32](s),b&&b.m(e,null),d(e,r),k&&k.m(e,null),f=!0,u||(m=[H(e,"pointerenter",t[20]),H(e,"pointerleave",t[21]),H(e,"pointerdown",t[18]),H(e,"pointerup",t[19])],u=!0)},p(y,F){y[1]!==void 0?g?g.p(y,F):(g=u4(y),g.c(),g.m(e,n)):g&&(g.d(1),g=null),y[2]!==void 0?v?v.p(y,F):(v=m4(y),v.c(),v.m(e,o)):v&&(v.d(1),v=null),fe.cdTextSkills&&y[4]!==void 0?_?_.p(y,F):(_=p4(y),_.c(),_.m(e,s)):_&&(_.d(1),_=null),(!f||F[0]&81928&&i!==(i="overlay "+y[16]+" "+(!y[14]||y[3]>0&&y[3]<10?"":"offCd")+" svelte-17ebtat"))&&p(s,"class",i),y[10]?b||(b=d4(y),b.c(),b.m(e,r)):b&&(b.d(1),b=null),(!f||F[0]&64&&l!==(l="icon "+y[6]+" svelte-17ebtat"))&&p(r,"class",l),(!f||F[0]&131072&&!at(r.src,a=y[17]))&&p(r,"src",a),y[8]&&y[11]&&!y[15]?k?(k.p(y,F),F[0]&35072&&S(k,1)):(k=h4(y),k.c(),S(k,1),k.m(e,null)):k&&(we(),E(k,1,1,()=>{k=null}),Me()),(!f||F[0]&128)&&p(e,"id",y[7]),(!f||F[0]&34849&&c!==(c="border "+y[5]+" "+(y[15]&&y[15].data==y[0]?"grey":"")+" slot "+(y[11]?"hover":"")+" "+(y[0]!==void 0||y[15]?"filled":"")+" svelte-17ebtat"))&&p(e,"class",c)},i(y){f||(S(k),f=!0)},o(y){E(k),f=!1},d(y){y&&x(e),g&&g.d(),v&&v.d(),_&&_.d(),t[32](null),b&&b.d(),k&&k.d(),u=!1,rt(m)}}}function OI(t,e,n){let o,s,i,r;re(t,In,se=>n(15,r=se));let{$$slots:l={},$$scope:a}=e,{data:c=void 0}=e,{key:f}=e,{stacks:u}=e,{cd:m}=e,{remaining:g}=e,{border:v="grey"}=e,{img:_}=e,{meta:b}=e,{css:k=""}=e,{id:y=""}=e,{describe:F=!0}=e,{queued:A=!1}=e,{pickable:C=!0}=e,{descRoot:M}=e,{descPos:D="bottom: 100%; right: 100%;"}=e,{auto:$=!1}=e,{status:V=0}=e,{clickToUse:z=!1}=e,{shift:q=!1}=e,L=!1,U=!1,W=(se,Ie)=>se?"queued":Ie==5?"oom":Ie==6?"range":Ie==11||Ie==9?"combat":"",R,N=se=>{se.altKey||(z&&!q?le("use",{e:se,...b}):(U=!0,n(11,L=!1),le("click",b)))},Y=se=>{se.button==2?q?le("use",{e:se,...b}):le("context",{e:se,...b}):r?(r.data.type&&xt(Uo[r.data.type].sound),le("move",{from:r.meta,to:b}),r.meta&&r.meta.store&&r.meta.store.set(),Xe(In,r=void 0,r)):z?q&&ie():se.altKey?b.item&&b.item.dbid&&Ro.update(Ie=>Ie+`>${b.item.dbid}`):ie(),U=!1},_e=se=>{n(11,L=!0)},Fe=()=>{le("discard")},he=se=>{n(11,L=!1),c&&U&&(U=!1,ie())},ie=()=>{!c||C===!1||(c.moving||Xe(In,r={data:c,img:_,meta:b,border:v,css:k,discard:Fe},r),c.type&&xt(Uo[c.type].sound))},le=ci(),ge;function be(se){qt[se?"unshift":"push"](()=>{ge=se,n(13,ge)})}function Te(se){qt[se?"unshift":"push"](()=>{R=se,n(12,R)})}return t.$$set=se=>{"data"in se&&n(0,c=se.data),"key"in se&&n(1,f=se.key),"stacks"in se&&n(2,u=se.stacks),"cd"in se&&n(3,m=se.cd),"remaining"in se&&n(4,g=se.remaining),"border"in se&&n(5,v=se.border),"img"in se&&n(22,_=se.img),"meta"in se&&n(23,b=se.meta),"css"in se&&n(6,k=se.css),"id"in se&&n(7,y=se.id),"describe"in se&&n(8,F=se.describe),"queued"in se&&n(24,A=se.queued),"pickable"in se&&n(25,C=se.pickable),"descRoot"in se&&n(26,M=se.descRoot),"descPos"in se&&n(9,D=se.descPos),"auto"in se&&n(10,$=se.auto),"status"in se&&n(27,V=se.status),"clickToUse"in se&&n(28,z=se.clickToUse),"shift"in se&&n(29,q=se.shift),"$$scope"in se&&n(30,a=se.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&16392&&n(14,o=o||m>0),t.$$.dirty[0]&138446856&&n(17,s=_?r&&L||m>0||V==-1?_.replace(/(?<!githubusercontent)\.(?!githubusercontent)/,"_grey.").replace(/_q[0-9]/g,""):_:`/data/ui/slotbg/bg.${Yn}?v=8738303`),t.$$.dirty[0]&150995968&&n(16,i=W($||A,V)),t.$$.dirty[0]&67112960&&R&&M&&M.appendChild(R),t.$$.dirty[0]&8200&&iu(Math.floor(m||0),ge,40)},[c,f,u,m,g,v,k,y,F,D,$,L,R,ge,o,r,i,s,N,Y,_e,he,_,b,A,C,M,V,z,q,a,l,be,Te]}var $g=class extends Ce{constructor(e){super(),Pe(this,e,OI,UI,yn,{data:0,key:1,stacks:2,cd:3,remaining:4,border:5,img:22,meta:23,css:6,id:7,describe:8,queued:24,pickable:25,descRoot:26,descPos:9,auto:10,status:27,clickToUse:28,shift:29},null,[-1,-1])}},bl=$g;var g4=(t,e)=>typeof t=="function"?t(e):t;var pu=Object.keys({onBlock:0,statsStatic:0,statsConvert:0,statsOverride:0,onInterval:0,multiplyIncomingHeal:0,multiplyIncomingDamage:0,addIncomingHeal:0,addIncomingDamage:0,addIncomingCrit:0,afterDamageEnemy:0,afterHealAlly:0,beforeDamageEnemy:0,beforeIncomingDamage:0,afterIncomingDamage:0,movementOverride:0,incapacitated:0,breakOnMove:0,breakOnCast:0,instantCast:0,onCast:0,onEnd:0,immuneAll:0,immuneCC:0,breakAfterPercentDamage:0}),ve=class{constructor(e){this.id=e.id,this.intervalHaste=e.intervalHaste!==!1,this.intervalDuration=e.intervalDuration,this.intervalOnApply=e.intervalOnApply||!1,this.maxStacks=e.maxStacks,this.passive=e.passive||!1,this.clearOnDeath=e.clearOnDeath!==!1,this.custom=e.custom,this.unique=e.unique||!1,this.dr=e.dr||0,this.type=e.type||0,this.tags=e.tags||new Set,this.immuneAll=e.immuneAll||!1,this.immuneCC=e.immuneCC||!1,pu.forEach(n=>{this[n]=e[n]}),this.customIcon=e.customIcon,this.icon=e.icon,this.fx=e.fx||{}}onSet(e,n,o){this.tags.forEach(s=>{o.tags.get(s).add(e)}),pu.forEach(s=>{this[s]&&(s!=="incapacitated"&&s!=="movementOverride"||o.immuneCC.size<=0)&&o[s].add(e)})}onRemove(e,n,o){this.tags.forEach(s=>{o.tags.get(s).delete(e)}),pu.forEach(s=>{this[s]&&o[s].delete(e)})}};var v4=new ve({id:77,passive:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(t.level*40)),e.addStat(28,Math.round(t.level*200))}});var _4=new ve({id:59,tags:new Set([11]),icon:"ui/skills/2",fx:{stick:15},statsStatic:(t,e)=>{e.addStat(13,300+t.level*40)}});var Md=(t,e)=>t*e/65535;var b4=(t,e)=>{let n=e/65535;return[(t>>>16)*n,(t&65535)*n]};var wo=t=>t/60;var sc=(t,e)=>{if(t.static||!e.data)return!1;let n=b4(e.data[0]*2,6400),o=[n[0]-t.pos[0],n[1]-t.pos[2]];return Ia(o)>t.size?(t.setSteer(0,1),t.setRot(cl(o)),t.setJump(0),!0):(t.setSteer(0,0),!1)};var y4=new ve({id:87,incapacitated:!0,icon:"ui/skills/33",fx:{stick:74,endSound:65},statsOverride:(t,e)=>{e.stat.set(15,250)},movementOverride:(t,e,n,o,s)=>{sc(o,s)||o.buffs.removeBuff(s.id,o.id)}});var k4=new ve({id:76,icon:"ui/skills/20",fx:{stick:53},unique:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(t.level*30)),e.addStat(9,Math.round(t.level*22))}});var x4=new ve({id:73,passive:!0,icon:"ui/skills/17",custom:[[t=>93+t*32,"% as additional damage over 10 seconds"]],afterDamageEnemy:{3:(t,e,n)=>{}}});var w4=new ve({id:74,type:1,tags:new Set([1]),maxStacks:3,icon:"ui/skills/18",fx:{stick:38,color:[.7,.1,.1,.5]},intervalDuration:1.5,onInterval:(t,e,n)=>({id:18,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,noDaze:!0,type:1})});var M4=new ve({id:72,icon:"ui/skills/17",fx:{stick:18,color:[.9,.3,.1,.7]},custom:[[t=>t*12,"% increased damage"]]});var F4=new ve({id:121,incapacitated:!0,type:1,tags:new Set([7]),dr:3,breakAfterPercentDamage:.1,icon:"ui/skills/50",fx:{stick:86,incapacitated:!0},statsOverride:(t,e)=>{e.stat.get(15)>100&&e.stat.set(15,100)},movementOverride:(t,e,n,o,s)=>{sc(o,s)},intervalDuration:1});var C4=new ve({id:61,passive:!0,icon:"ui/skills/8",statsConvert:[[0,.3,10],[0,.3,11],[0,.3,8]]});var S4=new ve({id:89,type:1,tags:new Set([3]),icon:"ui/skills/34",statsStatic:(t,e)=>{e.maxStat(29,10+t.level*10)}});var P4=new ve({id:105,maxStacks:3,icon:"ui/skills/temperBoostBuff",fx:{stick:24,color:[.2,.2,.25,.95]},statsStatic:(t,e)=>{e.addStat(15,20)}});var A4=new ve({id:104,maxStacks:3,tags:new Set([3,4]),icon:"ui/skills/41",fx:{stick:23,color:[.1,.1,.1,.92]},intervalDuration:.5,onInterval:(t,e,n)=>!0});var T4=new ve({id:75,icon:"ui/skills/19",fx:{stick:54},unique:!0,statsStatic:(t,e)=>{e.addStat(10,t.level*3),e.addStat(11,t.level*4),e.addStat(6,t.level*50)}});var E4=new ve({id:115,incapacitated:!0,tags:new Set([8]),immuneCC:!0,icon:"ui/skills/46",fx:{anim:34},statsStatic:(t,e)=>{e.maxStat(29,40)},statsOverride:(t,e)=>{e.stat.set(13,0)},intervalDuration:.5,onInterval:(t,e,n)=>!0});var I4=new ve({id:91,type:1,tags:new Set([6]),incapacitated:!0,dr:3,icon:"ui/skills/37",fx:{visual:20,stick:88,endSound:69},statsStatic:(t,e)=>{e.maxStat(29,30+t.level*7),e.maxStat(30,20+t.level*5)}});var D4=new ve({id:84,icon:"ui/skills/28",fx:{stick:65},unique:!0,statsStatic:(t,e)=>{e.addStat(16,100+t.level*60)}});var V4=new ve({id:67,type:1,tags:new Set([3,1]),icon:"ui/skills/12",fx:{apply:50,stick:49,color:[.5,.4,.05,.5]},statsStatic:(t,e)=>{e.maxStat(29,20+t.level*3)},intervalDuration:1.5,onInterval:(t,e,n)=>({id:12,mode:1,caster:t.caster,target:e.id,dmg:1+n.stats.getDamageRoll()*(.1+t.level*.08),type:1,noDaze:!0})});var L4=new ve({id:68,icon:"ui/skills/13",fx:{stick:52},intervalDuration:1,custom:[[t=>30+40*t,"MP recovered"]],onInterval:(t,e,n)=>{}});var q4=new ve({id:107,maxStacks:5,icon:"ui/skills/43",fx:{stick:20}});var R4=new ve({id:106,passive:!0});var z4=new ve({id:60,maxStacks:3,icon:"ui/skills/7",fx:{stick:37},intervalDuration:1,multiplyIncomingHeal:{6:t=>1+t.stacks*.3,7:t=>1+(t.stacks-1)*.3},onInterval:(t,e,n)=>({id:7,mode:2,caster:t.caster,target:e.id,heal:6+n.stats.getDamageRoll()*(.028+t.level*.024)})});var B4=new ve({id:64,passive:!0,icon:"ui/skills/8",statsConvert:[[4,.4,10],[4,.4,11]]});var $4=new ve({id:90,breakOnCast:!0,icon:"ui/skills/36",fx:{visual:26,apply:76,endSound:69},statsStatic:(t,e)=>{e.addStat(15,8+t.level*12)}});var U4=new ve({id:119,incapacitated:!0,type:1,tags:new Set([7]),dr:3,breakAfterPercentDamage:.1,icon:"ui/skills/49",fx:{incapacitated:!0,apply:122,stick:124},statsOverride:(t,e)=>{e.stat.get(15)>50&&e.stat.set(15,50)},movementOverride:(t,e,n,o,s)=>{sc(o,s)}});var O4=new ve({id:120,passive:!0});var N4=new ve({id:82,passive:!0,statsStatic:(t,e)=>{e.addStat(14,Math.round(t.level*30))}});var j4=new ve({id:66,icon:"ui/skills/11",fx:{stick:39,endSound:69},custom:[[t=>t*9,"% increased damage"]]});var W4=new ve({id:83,icon:"ui/skills/27",fx:{stick:63},unique:!0,statsStatic:(t,e)=>{e.addStat(15,5+t.level*13)}});var G4=new ve({id:85,passive:!0,icon:"ui/skills/29",custom:[[t=>40+t*21,"% per stack as additional damage over 10 seconds"]],afterDamageEnemy:{9:(t,e,n)=>{}}});var H4=new ve({id:86,type:1,maxStacks:3,tags:new Set([3,1]),icon:"ui/skills/29",fx:{apply:51,stick:66,color:[.1,1,.3,.3]},statsStatic:(t,e)=>{e.maxStat(29,30)},intervalDuration:1.5,onInterval:(t,e,n)=>({id:29,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,type:1,noDaze:!0})});var Y4=new ve({id:95,maxStacks:4,icon:"ui/skills/31",instantCast:new Set([31]),beforeDamageEnemy:{31:(t,e,n,o)=>{}}});var X4=new ve({id:65,passive:!0,icon:"ui/skills/10",custom:[[t=>2+t*1," Jumps"],[t=>15+t*12.5,"% damage per Jump"]],afterDamageEnemy:{9:(t,e,n)=>{}}});var Q4=new ve({id:92,icon:"ui/skills/38",fx:{stick:77},statsStatic:(t,e)=>{e.addStat(15,30)},instantCast:new Set([9]),onCast:{9:(t,e)=>{}}});var Z4=new ve({id:96,passive:!1,incapacitated:!0,icon:"ui/skills/38",statsOverride:(t,e)=>{e.stat.set(15,400)},movementOverride:(t,e,n,o,s)=>{o.setSteer(s.data[0]-1,s.data[1]-1)}});var J4=new ve({id:63,passive:!0,icon:"ui/skills/8",statsConvert:[[2,.4,10],[2,.4,11]]});var K4=new ve({id:81,icon:"ui/skills/25",fx:{stick:64},unique:!0,statsStatic:(t,e)=>{e.addStat(16,t.level*30)}});var e5=new ve({id:118,passive:!0});var t5=new ve({id:114,incapacitated:!0,tags:new Set([8]),icon:"ui/skills/45",fx:{anim:33},intervalHaste:!1,intervalDuration:.25,statsStatic:(t,e)=>{e.maxStat(29,15)},onInterval:(t,e,n)=>!0});var n5=new ve({id:78,icon:"ui/skills/22",fx:{stick:60},unique:!0,statsStatic:(t,e)=>{e.addStat(14,t.level*30)}});var o5=new ve({id:101,type:1,tags:new Set([5]),incapacitated:!0,dr:1,icon:"ui/skills/deepFrozen",fx:{stick:57,color:[.1,.9,.8,.9],frozen:!0},statsStatic:(t,e)=>{e.maxStat(29,100)},multiplyIncomingDamage:{4:t=>1+t.level*.1,15:t=>1+t.level*.1,51:t=>1+t.level*.1}});var s5=new ve({id:80,icon:"ui/skills/24",fx:{stick:91},unique:!0,statsStatic:(t,e)=>{e.addStat(10,Math.floor(2+t.level*1.5)),e.addStat(11,Math.floor(3+t.level*3.5))}});var i5=new ve({id:108,icon:"ui/skills/extraBolt",fx:{stick:22}});var r5=new ve({id:116,incapacitated:!0,tags:new Set([8,10]),breakOnMove:!0,icon:"ui/skills/52",fx:{anim:35},intervalDuration:1,intervalOnApply:1,onInterval:(t,e,n)=>!0});var l5=new ve({id:69,type:1,tags:new Set([4]),dr:2,icon:"ui/skills/14",fx:{stick:56,color:[.7,.7,1,.4]},statsStatic:(t,e)=>{e.maxStat(29,100)},addIncomingCrit:{4:t=>10+t.level*30,15:t=>20+t.level*30},intervalDuration:1.5,onInterval:(t,e,n)=>({id:14,mode:1,caster:t.caster,target:e.id,dmg:n.stats.getDamageRoll()*(.09+t.level*.27),type:1,noDaze:!0})});var a5=new ve({id:99,type:1,tags:new Set([3]),maxStacks:4,icon:"ui/skills/frozenBuff",fx:{stick:58,color:[.1,.1,.8,.5]},statsStatic:(t,e)=>{e.maxStat(29,20)}});var c5=new ve({id:71,icon:"ui/skills/16",fx:{stick:40,endSound:69},statsStatic:(t,e)=>{e.addStat(16,30+t.level*70),e.addStat(27,2+t.level*8)}});var f5=new ve({id:117,incapacitated:!0,tags:new Set([9,11,12]),immuneAll:!0,intervalDuration:1,intervalHaste:!1,icon:"ui/skills/53",fx:{stick:120,frozen:!0},statsStatic:(t,e)=>{e.maxStat(29,100)},onInterval:(t,e,n)=>({id:53,mode:2,caster:t.caster,target:n.id,heal:t.level*50,nocrit:!0})});var u5=new ve({id:100,passive:!0});var m5=new ve({id:79,icon:"ui/skills/23",fx:{stick:17}});var p5=new ve({id:70,passive:!0});var d5=new ve({id:62,passive:!0,icon:"ui/skills/8",statsConvert:[[3,.4,10],[3,.4,11]]});var h5=new ve({id:112,type:0,icon:"ui/skills/charm4",fx:{stick:42,color:[0,0,1,.7]}});var g5=new ve({id:113,type:1,tags:new Set([1]),maxStacks:10,icon:"ui/skills/firebuff",fx:{stick:67,color:[2,1,.3,1]}});var v5=new ve({id:126,type:1,tags:new Set([1]),maxStacks:5,icon:"ui/skills/firebuff",fx:{stick:132,apply:135,color:[.7,.1,1.5,1]}});var _5=new ve({id:94,type:1,tags:new Set([3]),icon:"ui/skills/dazedBuff",fx:{stick:73},statsStatic:(t,e)=>{e.maxStat(29,30)}});var b5=new ve({id:110,type:0,icon:"ui/skills/charm2",fx:{stick:21,color:[1,0,0,.8]},statsStatic:(t,e)=>{e.addStat(27,t.level)}});var y5=new ve({id:124,passive:!1,icon:"ui/skills/hellspawn",fx:{stick:160}});var k5=new ve({id:109,type:0,icon:"ui/skills/charm1",fx:{stick:61,color:[.3,.3,.3,.9]},statsStatic:(t,e)=>{e.addStat(31,50)},beforeIncomingDamage:(t,e,n,o)=>n*(t.level/100)});var x5=new ve({id:123,passive:!0});var w5=new ve({id:93,breakOnCast:!0,tags:new Set([12]),icon:"ui/skills/39",customIcon:t=>"items/mount/mount"+cr[t.data[0]].tier+"_q1",fx:{mount:t=>cr[t.data[0]].skin,apply:76,endSound:69},statsStatic:(t,e)=>{e.addStat(15,60)}});var M5=new ve({id:130,clearOnDeath:!1,tags:new Set([12]),icon:"ui/skills/39",customIcon:t=>"items/pet/pet"+cr[t.data[0]].tier+"_q1"});var F5=new ve({id:111,type:0,icon:"ui/skills/charm3",fx:{stick:62,color:[.3,0,.6,.8]},statsStatic:(t,e)=>{e.addStat(15,t.level)}});var C5=new ve({id:127,type:0,maxStacks:8,clearOnDeath:!1,icon:"ui/skills/obeliskbuff"});var S5=new ve({id:125,maxStacks:25,type:1,icon:"ui/skills/pierce",multiplyIncomingDamage:{0:t=>1+t.stacks*.2,60:t=>1+t.stacks*.2}});var P5=new ve({id:103,icon:"ui/skills/postsummon",fx:{stick:80},unique:!0,statsStatic:(t,e)=>{e.addStat(15,20)}});var Ug=["potionhp","potionMp"].map((t,e)=>new ve({id:[97,98][e],maxStacks:1,icon:"ui/skills/"+t,fx:{stick:[43,83][e]},intervalHaste:!1,intervalDuration:.5,onInterval:(n,o,s)=>({id:100,mode:[2,3][e],caster:n.caster,target:o.id,heal:e==1?void 0:n.level,mprec:e==0?void 0:n.level,nocrit:!0})}));var A5=new ve({id:88,type:1,tags:new Set([5]),dr:1,incapacitated:!0,icon:"ui/skills/stunBuff",fx:{stick:86,incapacitated:!0},movementOverride:(t,e,n,o,s)=>{o.setSteer(0,0),o.setJump(0)}});var T5=new ve({id:102,maxStacks:99,icon:"ui/skills/suddenDeath",statsStatic:(t,e)=>{e.maxStat(30,t.stacks)}});var E5=new ve({id:122,passive:!1,immuneCC:!0,icon:"ui/skills/21",statsStatic:(t,e)=>{e.addStat(6,t.stacks*5e5),t.level>1&&(e.addStat(17,30),e.addStat(16,1e3),e.addStat(15,200),e.addStat(10,500),e.addStat(11,500))},onCast:{0:(t,e,n,o,s)=>{}}});var I5=new ve({id:131,passive:!0});var D5=new ve({id:132,passive:!0});var V5=new ve({id:128,type:0,tags:new Set([12]),icon:"ui/skills/ghost",fx:{color:[.9,1.2,.8,.8],alpha:[.3]}});var L5=new ve({id:129,type:0,icon:"ui/skills/moderator",fx:{color:[.3,1.2,.9,.7],alpha:[.3]}});var yl=new Map;[V5,L5,C5,v5,S5,I5,x5,y5,E5,g5,h5,F5,b5,k5,P5,T5,Ug[0],Ug[1],A5,w5,M5,_5,F4,E4,P4,A4,S4,y4,T4,k4,v4,w4,x4,M4,_4,C4,q4,R4,I4,$4,D4,L4,z4,B4,V4,f5,r5,i5,o5,u5,a5,s5,n5,m5,p5,l5,d5,c5,O4,D5,U4,e5,t5,Z4,Y4,Q4,G4,H4,K4,W4,N4,J4,X4,j4].forEach(t=>{yl.set(t.id,t)});var ic=class{constructor(e){this.entity=e,this.alive=!0,this.stat=new Map,this.resource=new Map,this.combatTimer=new kt(-1,6)}tick(e,n){this.combatTimer.start>0&&this.combatTimer.done(n)&&this.onCombatEnd(n)}die(){return this.alive?(this.alive=!1,this.entity.skills.onDeath(),this.entity.buffs.onDeath(),!0):!1}getStat(e){return this.stat.get(e)|0}getResource(e){return this.resource.get(e)|0}addStat(e,n){this.stat.set(e,(this.stat.get(e)|0)+n)}maxStat(e,n){this.stat.set(e,Math.max(this.stat.get(e)|0,n))}multiplyStat(e,n){this.stat.set(e,(this.stat.get(e)|0)*n)}setResource(e,n){let o=Math.round(gt(n,0,this.getStat(e)));return this.resource.set(e,o),o}changeResource(e,n){return this.setResource(e,this.getResource(e)+n)}respawn(){this.alive=!0,this.onCombatEnd()}clear(){}refreshCombatTimer(e,n){this.combatTimer.end<e+n&&this.combatTimer.reset(e,n)}onCombatEnd(){this.combatTimer.reset(-1)}getDamageRoll(){return Math.round((this.getStat(10)+this.getStat(11))/2)}};function q5(t,e,n){let o=t.slice();return o[12]=e[n],o}function R5(t,e,n){let o=t.slice();return o[15]=e[n],o}function z5(t,e,n){let o=t.slice();return o[18]=e[n],o}function B5(t,e,n){let o=t.slice();return o[18]=e[n],o}function $5(t,e,n){let o=t.slice();return o[23]=e[n],o}function U5(t,e,n){let o=t.slice();return o[26]=e[n],o}function O5(t,e,n){let o=t.slice();return o[23]=e[n],o}function N5(t,e,n){let o=t.slice();return o[26]=e[n],o}function j5(t,e,n){let o=t.slice();return o[33]=e[n],o}function W5(t,e,n){let o=t.slice();return o[26]=e[n],o}function NI(t){let e,n,o,s,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A,C,M,D,$=!t[2]&&t[0].parent===void 0&&G5(t),V=t[0].actiontype&&H5(t),z=t[0].auto&&Y5(t),q=t[0].costMp&&X5(t),L=t[0].castLen&&Q5(t),U=t[0].cd&&Z5(t),W=t[0].duration>0&&J5(t),R=t[0].unique&&K5(t),N=t[0].refresh&&eM(t),Y=t[0].range&&tM(t),_e=t[6][t[0].targetMode]&&nM(t),Fe=t[0].maxStacks&&oM(t),he=t[0].dmg&&sM(t),ie=t[0].heal&&iM(t),le=me([t[0].multiplyIncomingHeal,t[0].multiplyIncomingDamage]),ge=[];for(let oe=0;oe<2;oe+=1)ge[oe]=lM(j5(t,le,oe));let be=me([t[0].addIncomingHeal,t[0].addIncomingDamage]),Te=[];for(let oe=0;oe<2;oe+=1)Te[oe]=cM(O5(t,be,oe));let se=me([t[0].addIncomingCrit]),Ie=[];for(let oe=0;oe<1;oe+=1)Ie[oe]=uM($5(t,se,oe));let K=t[0].statsStatic&&mM(t),Re=t[0].statsConvert&&dM(t),Ge=t[0].custom&&gM(t),Qe=t[0].aoe&&t[0].aoe.circleRadius&&_M(t),Ye=!t[0].parent&&bM(t),pe=me(t[5]),ce=[];for(let oe=0;oe<pe.length;oe+=1)ce[oe]=yM(q5(t,pe,oe));let Oe=oe=>E(ce[oe],1,1,()=>{ce[oe]=null});return{c(){$&&$.c(),e=h("div"),V&&V.c(),n=de(),z&&z.c(),o=de(),q&&q.c(),s=de(),L&&L.c(),i=de(),U&&U.c(),r=de(),W&&W.c(),l=de(),R&&R.c(),a=de(),N&&N.c(),c=h("div"),Y&&Y.c(),f=de(),_e&&_e.c(),Fe&&Fe.c(),u=de(),he&&he.c(),m=de(),ie&&ie.c(),g=de();for(let oe=0;oe<2;oe+=1)ge[oe].c();v=de();for(let oe=0;oe<2;oe+=1)Te[oe].c();_=de();for(let oe=0;oe<1;oe+=1)Ie[oe].c();b=de(),K&&K.c(),k=de(),Re&&Re.c(),y=de(),Ge&&Ge.c(),F=de(),Qe&&Qe.c(),A=de(),Ye&&Ye.c(),C=de();for(let oe=0;oe<ce.length;oe+=1)ce[oe].c();M=de(),p(e,"class","pad textgreen svelte-14w0l4b")},m(oe,ee){$&&$.m(oe,ee),w(oe,e,ee),V&&V.m(e,null),d(e,n),z&&z.m(e,null),d(e,o),q&&q.m(e,null),d(e,s),L&&L.m(e,null),d(e,i),U&&U.m(e,null),d(e,r),W&&W.m(e,null),d(e,l),R&&R.m(e,null),d(e,a),N&&N.m(e,null),d(e,c),Y&&Y.m(c,null),d(c,f),_e&&_e.m(c,null),Fe&&Fe.m(oe,ee),w(oe,u,ee),he&&he.m(oe,ee),w(oe,m,ee),ie&&ie.m(oe,ee),w(oe,g,ee);for(let O=0;O<2;O+=1)ge[O]&&ge[O].m(oe,ee);w(oe,v,ee);for(let O=0;O<2;O+=1)Te[O]&&Te[O].m(oe,ee);w(oe,_,ee);for(let O=0;O<1;O+=1)Ie[O]&&Ie[O].m(oe,ee);w(oe,b,ee),K&&K.m(oe,ee),w(oe,k,ee),Re&&Re.m(oe,ee),w(oe,y,ee),Ge&&Ge.m(oe,ee),w(oe,F,ee),Qe&&Qe.m(oe,ee),w(oe,A,ee),Ye&&Ye.m(oe,ee),w(oe,C,ee);for(let O=0;O<ce.length;O+=1)ce[O]&&ce[O].m(oe,ee);w(oe,M,ee),D=!0},p(oe,ee){if(!oe[2]&&oe[0].parent===void 0?$?$.p(oe,ee):($=G5(oe),$.c(),$.m(e.parentNode,e)):$&&($.d(1),$=null),oe[0].actiontype?V?V.p(oe,ee):(V=H5(oe),V.c(),V.m(e,n)):V&&(V.d(1),V=null),oe[0].auto?z||(z=Y5(oe),z.c(),z.m(e,o)):z&&(z.d(1),z=null),oe[0].costMp?q?q.p(oe,ee):(q=X5(oe),q.c(),q.m(e,s)):q&&(q.d(1),q=null),oe[0].castLen?L?L.p(oe,ee):(L=Q5(oe),L.c(),L.m(e,i)):L&&(L.d(1),L=null),oe[0].cd?U?U.p(oe,ee):(U=Z5(oe),U.c(),U.m(e,r)):U&&(U.d(1),U=null),oe[0].duration>0?W?W.p(oe,ee):(W=J5(oe),W.c(),W.m(e,l)):W&&(W.d(1),W=null),oe[0].unique?R||(R=K5(oe),R.c(),R.m(e,a)):R&&(R.d(1),R=null),oe[0].refresh?N||(N=eM(oe),N.c(),N.m(e,c)):N&&(N.d(1),N=null),oe[0].range?Y?Y.p(oe,ee):(Y=tM(oe),Y.c(),Y.m(c,f)):Y&&(Y.d(1),Y=null),oe[6][oe[0].targetMode]?_e?_e.p(oe,ee):(_e=nM(oe),_e.c(),_e.m(c,null)):_e&&(_e.d(1),_e=null),oe[0].maxStacks?Fe?Fe.p(oe,ee):(Fe=oM(oe),Fe.c(),Fe.m(u.parentNode,u)):Fe&&(Fe.d(1),Fe=null),oe[0].dmg?he?he.p(oe,ee):(he=sM(oe),he.c(),he.m(m.parentNode,m)):he&&(he.d(1),he=null),oe[0].heal?ie?ie.p(oe,ee):(ie=iM(oe),ie.c(),ie.m(g.parentNode,g)):ie&&(ie.d(1),ie=null),ee[0]&129){le=me([oe[0].multiplyIncomingHeal,oe[0].multiplyIncomingDamage]);let O;for(O=0;O<2;O+=1){let ue=j5(oe,le,O);ge[O]?ge[O].p(ue,ee):(ge[O]=lM(ue),ge[O].c(),ge[O].m(v.parentNode,v))}for(;O<2;O+=1)ge[O].d(1)}if(ee[0]&129){be=me([oe[0].addIncomingHeal,oe[0].addIncomingDamage]);let O;for(O=0;O<2;O+=1){let ue=O5(oe,be,O);Te[O]?Te[O].p(ue,ee):(Te[O]=cM(ue),Te[O].c(),Te[O].m(_.parentNode,_))}for(;O<2;O+=1)Te[O].d(1)}if(ee[0]&129){se=me([oe[0].addIncomingCrit]);let O;for(O=0;O<1;O+=1){let ue=$5(oe,se,O);Ie[O]?Ie[O].p(ue,ee):(Ie[O]=uM(ue),Ie[O].c(),Ie[O].m(b.parentNode,b))}for(;O<1;O+=1)Ie[O].d(1)}if(oe[0].statsStatic?K?K.p(oe,ee):(K=mM(oe),K.c(),K.m(k.parentNode,k)):K&&(K.d(1),K=null),oe[0].statsConvert?Re?Re.p(oe,ee):(Re=dM(oe),Re.c(),Re.m(y.parentNode,y)):Re&&(Re.d(1),Re=null),oe[0].custom?Ge?Ge.p(oe,ee):(Ge=gM(oe),Ge.c(),Ge.m(F.parentNode,F)):Ge&&(Ge.d(1),Ge=null),oe[0].aoe&&oe[0].aoe.circleRadius?Qe?Qe.p(oe,ee):(Qe=_M(oe),Qe.c(),Qe.m(A.parentNode,A)):Qe&&(Qe.d(1),Qe=null),oe[0].parent?Ye&&(Ye.d(1),Ye=null):Ye?Ye.p(oe,ee):(Ye=bM(oe),Ye.c(),Ye.m(C.parentNode,C)),ee[0]&34){pe=me(oe[5]);let O;for(O=0;O<pe.length;O+=1){let ue=q5(oe,pe,O);ce[O]?(ce[O].p(ue,ee),S(ce[O],1)):(ce[O]=yM(ue),ce[O].c(),S(ce[O],1),ce[O].m(M.parentNode,M))}for(we(),O=pe.length;O<ce.length;O+=1)Oe(O);Me()}},i(oe){if(!D){for(let ee=0;ee<pe.length;ee+=1)S(ce[ee]);D=!0}},o(oe){ce=ce.filter(Boolean);for(let ee=0;ee<ce.length;ee+=1)E(ce[ee]);D=!1},d(oe){oe&&(x(e),x(u),x(m),x(g),x(v),x(_),x(b),x(k),x(y),x(F),x(A),x(C),x(M)),$&&$.d(oe),V&&V.d(),z&&z.d(),q&&q.d(),L&&L.d(),U&&U.d(),W&&W.d(),R&&R.d(),N&&N.d(),Y&&Y.d(),_e&&_e.d(),Fe&&Fe.d(oe),he&&he.d(oe),ie&&ie.d(oe),ot(ge,oe),ot(Te,oe),ot(Ie,oe),K&&K.d(oe),Re&&Re.d(oe),Ge&&Ge.d(oe),Qe&&Qe.d(oe),Ye&&Ye.d(oe),ot(ce,oe)}}}function jI(t){let e,n=t[0].item+"",o;return{c(){e=h("div"),o=T(n)},m(s,i){w(s,e,i),d(e,o)},p(s,i){i[0]&1&&n!==(n=s[0].item+"")&&G(o,n)},i:ae,o:ae,d(s){s&&x(e)}}}function G5(t){let e,n,o,s,i=P.items.book[t[0].id].name+"",r,l=t[0].engineOnly?"":" Lv. "+t[1],a;return{c(){e=h("div"),n=h("img"),s=Ne(),r=T(i),a=T(l),p(n,"class","texticon"),at(n.src,o=Qf(t[0].id))||p(n,"src",o),p(e,"class","slottitle textprimary")},m(c,f){w(c,e,f),d(e,n),d(e,s),d(e,r),d(e,a)},p(c,f){f[0]&1&&!at(n.src,o=Qf(c[0].id))&&p(n,"src",o),f[0]&1&&i!==(i=P.items.book[c[0].id].name+"")&&G(r,i),f[0]&3&&l!==(l=c[0].engineOnly?"":" Lv. "+c[1])&&G(a,l)},d(c){c&&x(e)}}}function H5(t){let e,n=t[8][t[0].mode]+"",o,s,i=t[0].actiontype+"",r;return{c(){e=h("div"),o=T(n),s=Ne(),r=T(i),p(e,"class","textwhite")},m(l,a){w(l,e,a),d(e,o),d(e,s),d(e,r)},p(l,a){a[0]&1&&n!==(n=l[8][l[0].mode]+"")&&G(o,n),a[0]&1&&i!==(i=l[0].actiontype+"")&&G(r,i)},d(l){l&&x(e)}}}function Y5(t){let e;return{c(){e=h("div"),e.textContent="Auto cast"},m(n,o){w(n,e,o)},d(n){n&&x(e)}}}function X5(t){let e,n,o=t[0].costMp(t[1])+"",s,i,r=P.ui.stats.array[7]+"",l;return{c(){e=h("div"),n=T("Cost: "),s=T(o),i=Ne(),l=T(r)},m(a,c){w(a,e,c),d(e,n),d(e,s),d(e,i),d(e,l)},p(a,c){c[0]&3&&o!==(o=a[0].costMp(a[1])+"")&&G(s,o)},d(a){a&&x(e)}}}function Q5(t){let e,n=t[7](t[0].castLen)+"",o,s;return{c(){e=h("div"),o=T(n),s=T("s Cast time")},m(i,r){w(i,e,r),d(e,o),d(e,s)},p(i,r){r[0]&1&&n!==(n=i[7](i[0].castLen)+"")&&G(o,n)},d(i){i&&x(e)}}}function Z5(t){let e,n=t[7](t[0].cd)+"",o,s;return{c(){e=h("div"),o=T(n),s=T("s Cooldown")},m(i,r){w(i,e,r),d(e,o),d(e,s)},p(i,r){r[0]&1&&n!==(n=i[7](i[0].cd)+"")&&G(o,n)},d(i){i&&x(e)}}}function J5(t){let e,n=t[7](t[0].duration)+"",o,s;return{c(){e=h("div"),o=T(n),s=T("s Duration")},m(i,r){w(i,e,r),d(e,o),d(e,s)},p(i,r){r[0]&1&&n!==(n=i[7](i[0].duration)+"")&&G(o,n)},d(i){i&&x(e)}}}function K5(t){let e;return{c(){e=h("div"),e.textContent="Unique"},m(n,o){w(n,e,o)},d(n){n&&x(e)}}}function eM(t){let e;return{c(){e=h("div"),e.textContent="Stacks refresh duration"},m(n,o){w(n,e,o)},d(n){n&&x(e)}}}function tM(t){let e,n=t[7](t[0].range)+"",o,s;return{c(){e=h("span"),o=T(n),s=T("m range ")},m(i,r){w(i,e,r),d(e,o),d(e,s)},p(i,r){r[0]&1&&n!==(n=i[7](i[0].range)+"")&&G(o,n)},d(i){i&&x(e)}}}function nM(t){let e,n=t[6][t[0].targetMode]+"",o;return{c(){e=h("span"),o=T(n)},m(s,i){w(s,e,i),d(e,o)},p(s,i){i[0]&1&&n!==(n=s[6][s[0].targetMode]+"")&&G(o,n)},d(s){s&&x(e)}}}function oM(t){let e,n,o,s=t[4].stacks+"",i,r,l,a;return{c(){e=h("div"),n=h("u"),o=T("At "),i=T(s),r=T(" stacks"),l=T(":"),a=h("span"),a.textContent="(Press shift to toggle)",p(e,"class","pad textsecondary svelte-14w0l4b"),p(a,"class","textgrey")},m(c,f){w(c,e,f),d(e,n),d(n,o),d(n,i),d(n,r),d(e,l),w(c,a,f)},p(c,f){f[0]&16&&s!==(s=c[4].stacks+"")&&G(i,s)},d(c){c&&(x(e),x(a))}}}function sM(t){let e,n=t[7](t[0].dmg)+"",o,s;return{c(){e=h("div"),o=T(n),s=T(" DMG"),p(e,"class","textgreen")},m(i,r){w(i,e,r),d(e,o),d(e,s)},p(i,r){r[0]&1&&n!==(n=i[7](i[0].dmg)+"")&&G(o,n)},d(i){i&&x(e)}}}function iM(t){let e,n=t[7](t[0].heal)+"",o,s;return{c(){e=h("div"),o=T(n),s=T(" Heal"),p(e,"class","textgreen")},m(i,r){w(i,e,r),d(e,o),d(e,s)},p(i,r){r[0]&1&&n!==(n=i[7](i[0].heal)+"")&&G(o,n)},d(i){i&&x(e)}}}function rM(t){let e,n,o=P.items.book[t[26]].name+"",s,i,r=Math.round(100*t[7](t[33][t[26]](t[0]))-100)+"",l,a;return{c(){e=h("div"),n=T("Empower "),s=T(o),i=T(" by "),l=T(r),a=T("%"),p(e,"class","textcyan")},m(c,f){w(c,e,f),d(e,n),d(e,s),d(e,i),d(e,l),d(e,a)},p(c,f){f[0]&1&&o!==(o=P.items.book[c[26]].name+"")&&G(s,o),f[0]&1&&r!==(r=Math.round(100*c[7](c[33][c[26]](c[0]))-100)+"")&&G(l,r)},d(c){c&&x(e)}}}function lM(t){let e,n=me(Object.keys(t[33]||{})),o=[];for(let s=0;s<n.length;s+=1)o[s]=rM(W5(t,n,s));return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=de()},m(s,i){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(s,i);w(s,e,i)},p(s,i){if(i[0]&129){n=me(Object.keys(s[33]||{}));let r;for(r=0;r<n.length;r+=1){let l=W5(s,n,r);o[r]?o[r].p(l,i):(o[r]=rM(l),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(s){s&&x(e),ot(o,s)}}}function aM(t){let e,n,o=P.items.book[t[26]].name+"",s,i,r=t[7](t[23][t[26]](t[0]))+"",l;return{c(){e=h("div"),n=T("Empower "),s=T(o),i=T(" by "),l=T(r),p(e,"class","textcyan")},m(a,c){w(a,e,c),d(e,n),d(e,s),d(e,i),d(e,l)},p(a,c){c[0]&1&&o!==(o=P.items.book[a[26]].name+"")&&G(s,o),c[0]&1&&r!==(r=a[7](a[23][a[26]](a[0]))+"")&&G(l,r)},d(a){a&&x(e)}}}function cM(t){let e,n=me(Object.keys(t[23]||{})),o=[];for(let s=0;s<n.length;s+=1)o[s]=aM(N5(t,n,s));return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=de()},m(s,i){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(s,i);w(s,e,i)},p(s,i){if(i[0]&129){n=me(Object.keys(s[23]||{}));let r;for(r=0;r<n.length;r+=1){let l=N5(s,n,r);o[r]?o[r].p(l,i):(o[r]=aM(l),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(s){s&&x(e),ot(o,s)}}}function fM(t){let e,n,o=P.items.book[t[26]].name+"",s,i,r=Qn(14,t[7](t[23][t[26]](t[0])))+"",l;return{c(){e=h("div"),n=T("Empower Crit% of "),s=T(o),i=T(" by "),l=T(r),p(e,"class","textcyan")},m(a,c){w(a,e,c),d(e,n),d(e,s),d(e,i),d(e,l)},p(a,c){c[0]&1&&o!==(o=P.items.book[a[26]].name+"")&&G(s,o),c[0]&1&&r!==(r=Qn(14,a[7](a[23][a[26]](a[0])))+"")&&G(l,r)},d(a){a&&x(e)}}}function uM(t){let e,n=me(Object.keys(t[23]||{})),o=[];for(let s=0;s<n.length;s+=1)o[s]=fM(U5(t,n,s));return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=de()},m(s,i){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(s,i);w(s,e,i)},p(s,i){if(i[0]&129){n=me(Object.keys(s[23]||{}));let r;for(r=0;r<n.length;r+=1){let l=U5(s,n,r);o[r]?o[r].p(l,i):(o[r]=fM(l),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(s){s&&x(e),ot(o,s)}}}function mM(t){let e,n=me(Array.from(t[3].stat)),o=[];for(let s=0;s<n.length;s+=1)o[s]=pM(B5(t,n,s));return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=de()},m(s,i){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(s,i);w(s,e,i)},p(s,i){if(i[0]&8){n=me(Array.from(s[3].stat));let r;for(r=0;r<n.length;r+=1){let l=B5(s,n,r);o[r]?o[r].p(l,i):(o[r]=pM(l),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(s){s&&x(e),ot(o,s)}}}function pM(t){let e,n,o=Qn(t[18][0],t[18][1])+"",s,i,r=P.ui.stats.array[t[18][0]]+"",l,a;return{c(){e=h("div"),n=T("+"),s=T(o),i=Ne(),l=T(r),a=Ne(),p(e,"class","textcyan")},m(c,f){w(c,e,f),d(e,n),d(e,s),d(e,i),d(e,l),d(e,a)},p(c,f){f[0]&8&&o!==(o=Qn(c[18][0],c[18][1])+"")&&G(s,o),f[0]&8&&r!==(r=P.ui.stats.array[c[18][0]]+"")&&G(l,r)},d(c){c&&x(e)}}}function dM(t){let e,n=me(t[0].statsConvert),o=[];for(let s=0;s<n.length;s+=1)o[s]=hM(z5(t,n,s));return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=de()},m(s,i){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(s,i);w(s,e,i)},p(s,i){if(i[0]&1){n=me(s[0].statsConvert);let r;for(r=0;r<n.length;r+=1){let l=z5(s,n,r);o[r]?o[r].p(l,i):(o[r]=hM(l),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(s){s&&x(e),ot(o,s)}}}function hM(t){let e,n=P.ui.skilldescription.statincrement[0]+"",o,s,i=P.ui.stats.array[t[18][0]]+"",r,l,a=P.ui.skilldescription.statincrement[1]+"",c,f,u=Qn(t[18][0],t[18][1])+"",m,g,v=P.ui.stats.array[t[18][2]]+"",_,b,k=P.ui.skilldescription.statincrement[2]+"",y;return{c(){e=h("div"),o=T(n),s=Ne(),r=T(i),l=Ne(),c=T(a),f=Ne(),m=T(u),g=Ne(),_=T(v),b=Ne(),y=T(k),p(e,"class","textcyan")},m(F,A){w(F,e,A),d(e,o),d(e,s),d(e,r),d(e,l),d(e,c),d(e,f),d(e,m),d(e,g),d(e,_),d(e,b),d(e,y)},p(F,A){A[0]&1&&i!==(i=P.ui.stats.array[F[18][0]]+"")&&G(r,i),A[0]&1&&u!==(u=Qn(F[18][0],F[18][1])+"")&&G(m,u),A[0]&1&&v!==(v=P.ui.stats.array[F[18][2]]+"")&&G(_,v)},d(F){F&&x(e)}}}function gM(t){let e,n=me(t[0].custom),o=[];for(let s=0;s<n.length;s+=1)o[s]=vM(R5(t,n,s));return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=de()},m(s,i){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(s,i);w(s,e,i)},p(s,i){if(i[0]&131){n=me(s[0].custom);let r;for(r=0;r<n.length;r+=1){let l=R5(s,n,r);o[r]?o[r].p(l,i):(o[r]=vM(l),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(s){s&&x(e),ot(o,s)}}}function vM(t){let e,n=t[7](t[15][0](t[1]))+"",o,s=t[15][1]+"",i;return{c(){e=h("div"),o=T(n),i=T(s),p(e,"class","textcyan")},m(r,l){w(r,e,l),d(e,o),d(e,i)},p(r,l){l[0]&3&&n!==(n=r[7](r[15][0](r[1]))+"")&&G(o,n),l[0]&1&&s!==(s=r[15][1]+"")&&G(i,s)},d(r){r&&x(e)}}}function _M(t){let e,n=t[0].aoe.limit?"Up to "+t[0].aoe.limit:"All",o,s,i=t[0].aoe.faction?"allies":"enemies",r,l,a=t[7](t[0].aoe.circleRadius)+"",c,f;return{c(){e=h("div"),o=T(n),s=Ne(),r=T(i),l=T(" within "),c=T(a),f=T("m"),p(e,"class","textpvp")},m(u,m){w(u,e,m),d(e,o),d(e,s),d(e,r),d(e,l),d(e,c),d(e,f)},p(u,m){m[0]&1&&n!==(n=u[0].aoe.limit?"Up to "+u[0].aoe.limit:"All")&&G(o,n),m[0]&1&&i!==(i=u[0].aoe.faction?"allies":"enemies")&&G(r,i),m[0]&1&&a!==(a=u[7](u[0].aoe.circleRadius)+"")&&G(c,a)},d(u){u&&x(e)}}}function bM(t){let e,n,o,s=P.items.book[t[0].id].description+"",i;return{c(){e=h("div"),n=h("u"),n.textContent="Effect",o=T(": "),i=T(s),p(e,"class","textsecondary pad svelte-14w0l4b")},m(r,l){w(r,e,l),d(e,n),d(e,o),d(e,i)},p(r,l){l[0]&1&&s!==(s=P.items.book[r[0].id].description+"")&&G(i,s)},d(r){r&&x(e)}}}function yM(t){let e,n,o;return n=new Fd({props:{level:t[1],skill:t[12]}}),{c(){e=h("div"),J(n.$$.fragment),p(e,"class","pad svelte-14w0l4b")},m(s,i){w(s,e,i),Q(n,e,null),o=!0},p(s,i){let r={};i[0]&2&&(r.level=s[1]),i[0]&32&&(r.skill=s[12]),n.$set(r)},i(s){o||(S(n.$$.fragment,s),o=!0)},o(s){E(n.$$.fragment,s),o=!1},d(s){s&&x(e),Z(n)}}}function WI(t){let e,n,o,s,i=[jI,NI],r=[];function l(a,c){return a[0].item?0:1}return n=l(t,[-1,-1]),o=r[n]=i[n](t),{c(){e=h("div"),o.c(),p(e,"class","container textsecondary svelte-14w0l4b")},m(a,c){w(a,e,c),r[n].m(e,null),s=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(we(),E(r[f],1,1,()=>{r[f]=null}),Me(),o=r[n],o?o.p(a,c):(o=r[n]=i[n](a),o.c()),S(o,1),o.m(e,null))},i(a){s||(S(o),s=!0)},o(a){E(o),s=!1},d(a){a&&x(e),r[n].d()}}}function GI(t,e,n){let{skill:o}=e,{level:s}=e,{asItemDescription:i=!1}=e,{shift:r=!1}=e,l={1:"Requires no target",16:"Self cast",256:"on Allies",4096:"on Enemy"},a=(_,b=I&&I.player)=>{if(!b)return"?";let k=g4(_,b);return k%1===0?k:k.toFixed(1)},c={0:"Melee attack",1:"Magic attack",2:"Heal",4:"Buff",5:"Stackable buff",6:"Ranged missile",7:"Ranged effect",9:"Effect"},f=[],u,m={},g=_=>{if(I)return _.onCast&&v("on cast",_.onCast,I.player,s),_.onBlock&&v("on block",_.onBlock,m,I.player),_.onInterval&&v(`every ${_.intervalDuration.toFixed(1)}s`,_.onInterval,m,I.player,I.player),_.onPermanent&&v("permanently",()=>({id:_.onPermanent(I.player),mode:4}),I.player,s),_},v=(_,b,k,y,F)=>{let A=b(k,y,F);if(!A||A===!0)return;let C=Object.assign({},A);if(C.actiontype=_,C.parent||(C.parent=[]),C.parent.push(o),C.mode===4||C.mode===5){let M=yl.get(C.id);f.unshift(g({...C,...M}))}else if(o.id===C.id)o.parent||(C.parent=void 0),n(0,o={...o,...C});else{if(o.parent){let M=o.parent.find(D=>D.id==C.id);if(M){M.parent||(C.parent=void 0),Object.assign(M,C);return}}f.unshift(g(C))}};return t.$$set=_=>{"skill"in _&&n(0,o=_.skill),"level"in _&&n(1,s=_.level),"asItemDescription"in _&&n(2,i=_.asItemDescription),"shift"in _&&n(9,r=_.shift)},t.$$.update=()=>{t.$$.dirty[0]&539&&(n(4,m={stacks:1,level:s}),n(4,m.stacks=o.maxStacks?r?1:o.maxStacks:1,m),n(0,o.stacks=m.stacks,o),n(5,f=[]),o.parent||g(o),o.statsStatic&&(n(3,u=new ic),o.statsStatic(m,u)))},[o,s,i,u,m,f,l,a,c,r]}var Fd=class extends Ce{constructor(e){super(),Pe(this,e,GI,WI,Be,{skill:0,level:1,asItemDescription:2,shift:9},null,[-1,-1])}},kl=Fd;function HI(t){let e;return{c(){e=h("span")},m(n,o){w(n,e,o),e.innerHTML=t[0]},p(n,[o]){o&1&&(e.innerHTML=n[0])},i:ae,o:ae,d(n){n&&x(e)}}}function YI(t,e,n){let o,s,i;re(t,Zo,a=>n(4,i=a));let{amount:r}=e,{isPrice:l=!1}=e;return t.$$set=a=>{"amount"in a&&n(1,r=a.amount),"isPrice"in a&&n(2,l=a.isPrice)},t.$$.update=()=>{t.$$.dirty&22&&n(3,o=l&&r>i),t.$$.dirty&10&&n(0,s=J1(r,o))},[s,r,l,o,i]}var Og=class extends Ce{constructor(e){super(),Pe(this,e,YI,HI,yn,{amount:1,isPrice:2})}},xn=Og;function XI(t){let e;return{c(){e=h("span")},m(n,o){w(n,e,o),e.innerHTML=t[0]},p(n,[o]){o&1&&(e.innerHTML=n[0])},i:ae,o:ae,d(n){n&&x(e)}}}function QI(t,e,n){let o,s,i;re(t,fa,a=>n(4,i=a));let{amount:r}=e,{isPrice:l=!1}=e;return t.$$set=a=>{"amount"in a&&n(1,r=a.amount),"isPrice"in a&&n(2,l=a.isPrice)},t.$$.update=()=>{t.$$.dirty&22&&n(3,o=l&&r>i),t.$$.dirty&10&&n(0,s=K1(r,o))},[s,r,l,o,i]}var Ng=class extends Ce{constructor(e){super(),Pe(this,e,QI,XI,yn,{amount:1,isPrice:2})}},gr=Ng;function ZI(t){let e,n,o,s,i,r;return{c(){e=h("span"),n=h("img"),s=h("span"),i=T(t[0]),p(n,"class","svgicon texticon"),at(n.src,o="/data/ui/icons/gem.svg?v=8738303")||p(n,"src",o),p(s,"class",r=!t[1]||t[0]<t[2]?"textprimary":"textred")},m(l,a){w(l,e,a),d(e,n),d(e,s),d(s,i)},p(l,[a]){a&1&&G(i,l[0]),a&7&&r!==(r=!l[1]||l[0]<l[2]?"textprimary":"textred")&&p(s,"class",r)},i:ae,o:ae,d(l){l&&x(e)}}}function JI(t,e,n){let o;re(t,Oi,r=>n(2,o=r));let{amount:s}=e,{isPrice:i=!1}=e;return t.$$set=r=>{"amount"in r&&n(0,s=r.amount),"isPrice"in r&&n(1,i=r.isPrice)},[s,i,o]}var jg=class extends Ce{constructor(e){super(),Pe(this,e,JI,ZI,yn,{amount:0,isPrice:1})}},vr=jg;function kM(t,e,n){let o=t.slice();return o[11]=e[n],o}function xM(t,e,n){let o=t.slice();return o[14]=e[n],o}function wM(t,e,n){let o=t.slice();return o[14]=e[n],o}function MM(t,e,n){let o=t.slice();return o[19]=e[n],o}function FM(t,e,n){let o=t.slice();return o[11]=e[n],o}function CM(t){let e,n,o=t[0].gs+"",s,i;return{c(){e=h("span"),n=T("GS: "),s=T(o),i=Ne(),p(e,"class","textgreen")},m(r,l){w(r,e,l),d(e,n),d(e,s),w(r,i,l)},p(r,l){l&1&&o!==(o=r[0].gs+"")&&G(s,o)},d(r){r&&(x(e),x(i))}}}function SM(t){let e,n,o=t[0].dbid+"",s;return{c(){e=h("span"),n=T("ID: "),s=T(o),p(e,"class","textgrey")},m(i,r){w(i,e,r),d(e,n),d(e,s)},p(i,r){r&1&&o!==(o=i[0].dbid+"")&&G(s,o)},d(i){i&&x(e)}}}function KI(t){let e,n=t[11][1].type=="bonus"?"+ ":"",o,s=Qn(t[11][0],t[11][1].value)+"",i,r,l=P.ui.stats.array[t[11][0]]+"",a,c,f,u=t[11][1].type=="bonus"&&t[3]&&PM(t);return{c(){e=h("div"),o=T(n),i=T(s),r=Ne(),a=T(l),c=Ne(),u&&u.c(),p(e,"class",f="text"+jt(t[11][1].qual)[0]+" svelte-e3ao5j")},m(m,g){w(m,e,g),d(e,o),d(e,i),d(e,r),d(e,a),d(e,c),u&&u.m(e,null)},p(m,g){g&256&&n!==(n=m[11][1].type=="bonus"?"+ ":"")&&G(o,n),g&256&&s!==(s=Qn(m[11][0],m[11][1].value)+"")&&G(i,s),g&256&&l!==(l=P.ui.stats.array[m[11][0]]+"")&&G(a,l),m[11][1].type=="bonus"&&m[3]?u?u.p(m,g):(u=PM(m),u.c(),u.m(e,null)):u&&(u.d(1),u=null),g&256&&f!==(f="text"+jt(m[11][1].qual)[0]+" svelte-e3ao5j")&&p(e,"class",f)},d(m){m&&x(e),u&&u.d()}}}function eD(t){let e,n,o=t[0].stats.get(10).value+"",s,i,r,l,a=t[0].stats.get(11).value+"",c,f,u,m,g=P.ui.stats.misc.damage+"",v,_;return{c(){e=h("div"),n=h("span"),s=T(o),r=T(" - "),l=h("span"),c=T(a),u=Ne(),m=h("span"),v=T(g),p(n,"class",i="text"+jt(t[0].stats.get(10).qual)[0]+" svelte-e3ao5j"),p(l,"class",f="text"+jt(t[0].stats.get(11).qual)[0]+" svelte-e3ao5j"),p(m,"class",_="text"+jt(Math.min(t[0].stats.get(10).qual,t[0].stats.get(11).qual))[0]+" svelte-e3ao5j")},m(b,k){w(b,e,k),d(e,n),d(n,s),d(e,r),d(e,l),d(l,c),d(e,u),d(e,m),d(m,v)},p(b,k){k&1&&o!==(o=b[0].stats.get(10).value+"")&&G(s,o),k&1&&i!==(i="text"+jt(b[0].stats.get(10).qual)[0]+" svelte-e3ao5j")&&p(n,"class",i),k&1&&a!==(a=b[0].stats.get(11).value+"")&&G(c,a),k&1&&f!==(f="text"+jt(b[0].stats.get(11).qual)[0]+" svelte-e3ao5j")&&p(l,"class",f),k&1&&_!==(_="text"+jt(Math.min(b[0].stats.get(10).qual,b[0].stats.get(11).qual))[0]+" svelte-e3ao5j")&&p(m,"class",_)},d(b){b&&x(e)}}}function PM(t){let e,n=Math.round(t[11][1].qual)+"",o,s;return{c(){e=h("span"),o=T(n),s=T("%")},m(i,r){w(i,e,r),d(e,o),d(e,s)},p(i,r){r&256&&n!==(n=Math.round(i[11][1].qual)+"")&&G(o,n)},d(i){i&&x(e)}}}function AM(t){let e,n;function o(r,l){return l&257&&(e=null),e==null&&(e=!!(r[11][0]==10&&r[0].stats.has(11))),e?eD:KI}let s=o(t,-1),i=s(t);return{c(){i.c(),n=de()},m(r,l){i.m(r,l),w(r,n,l)},p(r,l){s===(s=o(r,l))&&i?i.p(r,l):(i.d(1),i=s(r),i&&(i.c(),i.m(n.parentNode,n)))},d(r){r&&x(n),i.d(r)}}}function TM(t){let e,n=me(t[0].logic.custom),o=[];for(let s=0;s<n.length;s+=1)o[s]=EM(MM(t,n,s));return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=de()},m(s,i){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(s,i);w(s,e,i)},p(s,i){if(i&1){n=me(s[0].logic.custom);let r;for(r=0;r<n.length;r+=1){let l=MM(s,n,r);o[r]?o[r].p(l,i):(o[r]=EM(l),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(s){s&&x(e),ot(o,s)}}}function EM(t){let e,n=t[19]+"",o;return{c(){e=h("span"),o=T(n),p(e,"class","textgreen")},m(s,i){w(s,e,i),d(e,o)},p(s,i){i&1&&n!==(n=s[19]+"")&&G(o,n)},d(s){s&&x(e)}}}function IM(t){let e,n=t[14][0]+"",o,s;return{c(){e=h("div"),o=T(n),p(e,"class",s=t[14][1]?"textgreen":"textred")},m(i,r){w(i,e,r),d(e,o)},p(i,r){r&1&&n!==(n=i[14][0]+"")&&G(o,n),r&1&&s!==(s=i[14][1]?"textgreen":"textred")&&p(e,"class",s)},d(i){i&&x(e)}}}function tD(t){let e,n,o,s=t[0].logic.bindOnPurchase&&DM(t),i=t[0].logic.bindOnUse&&VM(t),r=t[0].logic.bindOnMerchant&&LM(t);return{c(){s&&s.c(),e=de(),i&&i.c(),n=de(),r&&r.c(),o=de()},m(l,a){s&&s.m(l,a),w(l,e,a),i&&i.m(l,a),w(l,n,a),r&&r.m(l,a),w(l,o,a)},p(l,a){l[0].logic.bindOnPurchase?s?s.p(l,a):(s=DM(l),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null),l[0].logic.bindOnUse?i?i.p(l,a):(i=VM(l),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null),l[0].logic.bindOnMerchant?r?r.p(l,a):(r=LM(l),r.c(),r.m(o.parentNode,o)):r&&(r.d(1),r=null)},d(l){l&&(x(e),x(n),x(o)),s&&s.d(l),i&&i.d(l),r&&r.d(l)}}}function nD(t){let e,n=P.ui.inventory.bindlevel[t[0].bound]+"",o;return{c(){e=h("div"),o=T(n),p(e,"class","textgreen")},m(s,i){w(s,e,i),d(e,o)},p(s,i){i&1&&n!==(n=P.ui.inventory.bindlevel[s[0].bound]+"")&&G(o,n)},d(s){s&&x(e)}}}function DM(t){let e,n=P.ui.inventory.bindlevel[t[0].logic.bindOnPurchase]+"",o,s,i=P.ui.itemdescription.onpurchase+"",r;return{c(){e=h("div"),o=T(n),s=Ne(),r=T(i),p(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,o),d(e,s),d(e,r)},p(l,a){a&1&&n!==(n=P.ui.inventory.bindlevel[l[0].logic.bindOnPurchase]+"")&&G(o,n)},d(l){l&&x(e)}}}function VM(t){let e,n=P.ui.inventory.bindlevel[t[0].logic.bindOnUse]+"",o,s,i=P.ui.itemdescription.onuse+"",r;return{c(){e=h("div"),o=T(n),s=Ne(),r=T(i),p(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,o),d(e,s),d(e,r)},p(l,a){a&1&&n!==(n=P.ui.inventory.bindlevel[l[0].logic.bindOnUse]+"")&&G(o,n)},d(l){l&&x(e)}}}function LM(t){let e,n=P.ui.inventory.bindlevel[t[0].logic.bindOnMerchant]+"",o,s,i=P.ui.itemdescription.onsale+"",r;return{c(){e=h("div"),o=T(n),s=Ne(),r=T(i),p(e,"class","textcyan")},m(l,a){w(l,e,a),d(e,o),d(e,s),d(e,r)},p(l,a){a&1&&n!==(n=P.ui.inventory.bindlevel[l[0].logic.bindOnMerchant]+"")&&G(o,n)},d(l){l&&x(e)}}}function qM(t){let e,n,o=t[0].medalValue()>0&&t[1],s,i=t[0].storeValue()>0&&t[1],r,l=!(t[0].storeValue()>0&&t[1])&&t[0].canBeSold(),a,c=t[1]&&RM(t),f=o&&BM(t),u=i&&$M(t),m=l&&UM(t);return{c(){e=h("div"),c&&c.c(),n=de(),f&&f.c(),s=de(),u&&u.c(),r=de(),m&&m.c(),p(e,"class","panel value pack svelte-e3ao5j")},m(g,v){w(g,e,v),c&&c.m(e,null),d(e,n),f&&f.m(e,null),d(e,s),u&&u.m(e,null),d(e,r),m&&m.m(e,null),a=!0},p(g,v){g[1]?c?c.p(g,v):(c=RM(g),c.c(),c.m(e,n)):c&&(c.d(1),c=null),v&3&&(o=g[0].medalValue()>0&&g[1]),o?f?(f.p(g,v),v&3&&S(f,1)):(f=BM(g),f.c(),S(f,1),f.m(e,s)):f&&(we(),E(f,1,1,()=>{f=null}),Me()),v&3&&(i=g[0].storeValue()>0&&g[1]),i?u?(u.p(g,v),v&3&&S(u,1)):(u=$M(g),u.c(),S(u,1),u.m(e,r)):u&&(we(),E(u,1,1,()=>{u=null}),Me()),v&3&&(l=!(g[0].storeValue()>0&&g[1])&&g[0].canBeSold()),l?m?(m.p(g,v),v&3&&S(m,1)):(m=UM(g),m.c(),S(m,1),m.m(e,null)):m&&(we(),E(m,1,1,()=>{m=null}),Me())},i(g){a||(S(f),S(u),S(m),a=!0)},o(g){E(f),E(u),E(m),a=!1},d(g){g&&x(e),c&&c.d(),f&&f.d(),u&&u.d(),m&&m.d()}}}function RM(t){let e,n=me(t[0].buyReasons(I&&I.player)),o=[];for(let s=0;s<n.length;s+=1)o[s]=zM(xM(t,n,s));return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=de()},m(s,i){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(s,i);w(s,e,i)},p(s,i){if(i&1){n=me(s[0].buyReasons(I&&I.player));let r;for(r=0;r<n.length;r+=1){let l=xM(s,n,r);o[r]?o[r].p(l,i):(o[r]=zM(l),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(s){s&&x(e),ot(o,s)}}}function zM(t){let e,n=t[14][0]+"",o;return{c(){e=h("div"),p(e,"class",o=t[14][1]?"textgreen":"textred")},m(s,i){w(s,e,i),e.innerHTML=n},p(s,i){i&1&&n!==(n=s[14][0]+"")&&(e.innerHTML=n),i&1&&o!==(o=s[14][1]?"textgreen":"textred")&&p(e,"class",o)},d(s){s&&x(e)}}}function BM(t){let e,n,o;return n=new gr({props:{amount:t[0].medalValue(),isPrice:!0}}),{c(){e=h("div"),J(n.$$.fragment)},m(s,i){w(s,e,i),Q(n,e,null),o=!0},p(s,i){let r={};i&1&&(r.amount=s[0].medalValue()),n.$set(r)},i(s){o||(S(n.$$.fragment,s),o=!0)},o(s){E(n.$$.fragment,s),o=!1},d(s){s&&x(e),Z(n)}}}function $M(t){let e,n,o;return n=new vr({props:{amount:t[0].storeValue(),isPrice:!0}}),{c(){e=h("div"),J(n.$$.fragment)},m(s,i){w(s,e,i),Q(n,e,null),o=!0},p(s,i){let r={};i&1&&(r.amount=s[0].storeValue()),n.$set(r)},i(s){o||(S(n.$$.fragment,s),o=!0)},o(s){E(n.$$.fragment,s),o=!1},d(s){s&&x(e),Z(n)}}}function UM(t){let e,n,o;return n=new xn({props:{amount:t[0].goldValue(t[1]),isPrice:t[1]}}),{c(){e=h("div"),J(n.$$.fragment)},m(s,i){w(s,e,i),Q(n,e,null),o=!0},p(s,i){let r={};i&3&&(r.amount=s[0].goldValue(s[1])),i&2&&(r.isPrice=s[1]),n.$set(r)},i(s){o||(S(n.$$.fragment,s),o=!0)},o(s){E(n.$$.fragment,s),o=!1},d(s){s&&x(e),Z(n)}}}function oD(t){let e,n,o,s,i=[rD,iD],r=[];function l(a,c){return a[0].type=="book"?0:a[5]?1:-1}return~(e=l(t,-1))&&(n=r[e]=i[e](t)),{c(){n&&n.c(),o=de()},m(a,c){~e&&r[e].m(a,c),w(a,o,c),s=!0},p(a,c){let f=e;e=l(a,c),e===f?~e&&r[e].p(a,c):(n&&(we(),E(r[f],1,1,()=>{r[f]=null}),Me()),~e?(n=r[e],n?n.p(a,c):(n=r[e]=i[e](a),n.c()),S(n,1),n.m(o.parentNode,o)):n=null)},i(a){s||(S(n),s=!0)},o(a){E(n),s=!1},d(a){a&&x(o),~e&&r[e].d(a)}}}function sD(t){let e,n,o=me(t[7]),s=[];for(let i=0;i<o.length;i+=1)s[i]=OM(kM(t,o,i));return{c(){e=h("div"),n=h("div"),n.textContent=`${P.ui.itemdescription.equipeffect}:`;for(let i=0;i<s.length;i+=1)s[i].c();p(n,"class","textgrey"),p(e,"class","pack svelte-e3ao5j")},m(i,r){w(i,e,r),d(e,n);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null)},p(i,r){if(r&128){o=me(i[7]);let l;for(l=0;l<o.length;l+=1){let a=kM(i,o,l);s[l]?s[l].p(a,r):(s[l]=OM(a),s[l].c(),s[l].m(e,null))}for(;l<s.length;l+=1)s[l].d(1);s.length=o.length}},i:ae,o:ae,d(i){i&&x(e),ot(s,i)}}}function iD(t){let e,n=Jh(t[0].type,t[0].tier)+"",o;return{c(){e=h("div"),o=T(n),p(e,"class","pack description svelte-e3ao5j")},m(s,i){w(s,e,i),d(e,o)},p(s,i){i&1&&n!==(n=Jh(s[0].type,s[0].tier)+"")&&G(o,n)},i:ae,o:ae,d(s){s&&x(e)}}}function rD(t){let e,n;return e=new kl({props:{shift:t[2],level:t[0].logic.skilllevel+1,skill:At.get(t[0].logic.skillid),asItemDescription:!0}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&4&&(i.shift=o[2]),s&1&&(i.level=o[0].logic.skilllevel+1),s&1&&(i.skill=At.get(o[0].logic.skillid)),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function OM(t){let e,n=t[11][1]>0?"+":"",o,s=Qn(t[11][0],t[11][1])+"",i,r,l=P.ui.stats.array[t[11][0]]+"",a,c;return{c(){e=h("div"),o=T(n),i=T(s),r=Ne(),a=T(l),p(e,"class",c="text"+(t[11][1]>0?"green":"red"))},m(f,u){w(f,e,u),d(e,o),d(e,i),d(e,r),d(e,a)},p(f,u){u&128&&n!==(n=f[11][1]>0?"+":"")&&G(o,n),u&128&&s!==(s=Qn(f[11][0],f[11][1])+"")&&G(i,s),u&128&&l!==(l=P.ui.stats.array[f[11][0]]+"")&&G(a,l),u&128&&c!==(c="text"+(f[11][1]>0?"green":"red"))&&p(e,"class",c)},d(f){f&&x(e)}}}function NM(t){let e,n,o,s;return n=new Cd({props:{item:t[6],comparison:!0,percentages:!0}}),{c(){e=h("div"),J(n.$$.fragment),p(e,"class",o="slotdescription border "+jt(t[6].quality)[0]+" comparecontainer svelte-e3ao5j")},m(i,r){w(i,e,r),Q(n,e,null),s=!0},p(i,r){let l={};r&64&&(l.item=i[6]),n.$set(l),(!s||r&64&&o!==(o="slotdescription border "+jt(i[6].quality)[0]+" comparecontainer svelte-e3ao5j"))&&p(e,"class",o)},i(i){s||(S(n.$$.fragment,i),s=!0)},o(i){E(n.$$.fragment,i),s=!1},d(i){i&&x(e),Z(n)}}}function lD(t){let e,n,o,s=t[2]?"T"+(t[0].tier+1)+" ":"",i,r=nn(t[0].type,t[0].tier)+"",l,a,c=t[0].upgrade?" +"+t[0].upgrade:"",f,u,m,g=(t[0].stacks?"":jt(t[0].quality)[1])+"",v,_,b=t[0].type+"",k,y,F,A=t[0].quality&&!t[0].stacks?t[0].quality+"%":"",C,M,D,$,V,z,q,L,U=t[4]&&(t[1]||t[0].canBeSold()),W,R,N,Y,_e,Fe=t[0].gs>0&&CM(t),he=t[0].dbid&&SM(t),ie=me(t[8]),le=[];for(let ce=0;ce<ie.length;ce+=1)le[ce]=AM(FM(t,ie,ce));let ge=t[0].logic.custom!==void 0&&TM(t),be=me(t[0].equipReasons(I&&I.player)),Te=[];for(let ce=0;ce<be.length;ce+=1)Te[ce]=IM(wM(t,be,ce));function se(ce,Oe){return ce[0].bound>0?nD:tD}let Ie=se(t,-1),K=Ie(t),Re=U&&qM(t),Ge=[sD,oD],Qe=[];function Ye(ce,Oe){return ce[6]?0:1}R=Ye(t,-1),N=Qe[R]=Ge[R](t);let pe=t[6]&&NM(t);return{c(){e=h("div"),n=h("div"),o=h("div"),i=T(s),l=T(r),a=h("span"),f=T(c),m=h("div"),v=T(g),_=Ne(),k=T(b),y=Ne(),F=h("span"),C=T(A),M=h("small"),Fe&&Fe.c(),D=de(),he&&he.c(),$=Ne(),V=h("div");for(let ce=0;ce<le.length;ce+=1)le[ce].c();z=de(),ge&&ge.c(),q=h("div");for(let ce=0;ce<Te.length;ce+=1)Te[ce].c();L=de(),K.c(),Re&&Re.c(),W=de(),N.c(),pe&&pe.c(),Y=de(),p(a,"class","textprimary"),p(o,"class",u="slottitle text"+jt(t[0].quality)[0]+" svelte-e3ao5j"),p(m,"class","type textwhite svelte-e3ao5j"),p(n,"class","pack svelte-e3ao5j"),p(V,"class","pack svelte-e3ao5j"),p(q,"class","pack svelte-e3ao5j"),p(e,"class","container svelte-e3ao5j")},m(ce,Oe){w(ce,e,Oe),d(e,n),d(n,o),d(o,i),d(o,l),d(o,a),d(a,f),d(n,m),d(m,v),d(m,_),d(m,k),d(m,y),d(m,F),d(F,C),d(n,M),Fe&&Fe.m(M,null),d(M,D),he&&he.m(M,null),d(n,$),d(e,V);for(let oe=0;oe<le.length;oe+=1)le[oe]&&le[oe].m(V,null);d(V,z),ge&&ge.m(V,null),d(e,q);for(let oe=0;oe<Te.length;oe+=1)Te[oe]&&Te[oe].m(q,null);d(q,L),K.m(q,null),Re&&Re.m(e,null),d(e,W),Qe[R].m(e,null),pe&&pe.m(ce,Oe),w(ce,Y,Oe),_e=!0},p(ce,[Oe]){if((!_e||Oe&5)&&s!==(s=ce[2]?"T"+(ce[0].tier+1)+" ":"")&&G(i,s),(!_e||Oe&1)&&r!==(r=nn(ce[0].type,ce[0].tier)+"")&&G(l,r),(!_e||Oe&1)&&c!==(c=ce[0].upgrade?" +"+ce[0].upgrade:"")&&G(f,c),(!_e||Oe&1&&u!==(u="slottitle text"+jt(ce[0].quality)[0]+" svelte-e3ao5j"))&&p(o,"class",u),(!_e||Oe&1)&&g!==(g=(ce[0].stacks?"":jt(ce[0].quality)[1])+"")&&G(v,g),(!_e||Oe&1)&&b!==(b=ce[0].type+"")&&G(k,b),(!_e||Oe&1)&&A!==(A=ce[0].quality&&!ce[0].stacks?ce[0].quality+"%":"")&&G(C,A),ce[0].gs>0?Fe?Fe.p(ce,Oe):(Fe=CM(ce),Fe.c(),Fe.m(M,D)):Fe&&(Fe.d(1),Fe=null),ce[0].dbid?he?he.p(ce,Oe):(he=SM(ce),he.c(),he.m(M,null)):he&&(he.d(1),he=null),Oe&265){ie=me(ce[8]);let ee;for(ee=0;ee<ie.length;ee+=1){let O=FM(ce,ie,ee);le[ee]?le[ee].p(O,Oe):(le[ee]=AM(O),le[ee].c(),le[ee].m(V,z))}for(;ee<le.length;ee+=1)le[ee].d(1);le.length=ie.length}if(ce[0].logic.custom!==void 0?ge?ge.p(ce,Oe):(ge=TM(ce),ge.c(),ge.m(V,null)):ge&&(ge.d(1),ge=null),Oe&1){be=me(ce[0].equipReasons(I&&I.player));let ee;for(ee=0;ee<be.length;ee+=1){let O=wM(ce,be,ee);Te[ee]?Te[ee].p(O,Oe):(Te[ee]=IM(O),Te[ee].c(),Te[ee].m(q,L))}for(;ee<Te.length;ee+=1)Te[ee].d(1);Te.length=be.length}Ie===(Ie=se(ce,Oe))&&K?K.p(ce,Oe):(K.d(1),K=Ie(ce),K&&(K.c(),K.m(q,null))),Oe&19&&(U=ce[4]&&(ce[1]||ce[0].canBeSold())),U?Re?(Re.p(ce,Oe),Oe&19&&S(Re,1)):(Re=qM(ce),Re.c(),S(Re,1),Re.m(e,W)):Re&&(we(),E(Re,1,1,()=>{Re=null}),Me());let oe=R;R=Ye(ce,Oe),R===oe?Qe[R].p(ce,Oe):(we(),E(Qe[oe],1,1,()=>{Qe[oe]=null}),Me(),N=Qe[R],N?N.p(ce,Oe):(N=Qe[R]=Ge[R](ce),N.c()),S(N,1),N.m(e,null)),ce[6]?pe?(pe.p(ce,Oe),Oe&64&&S(pe,1)):(pe=NM(ce),pe.c(),S(pe,1),pe.m(Y.parentNode,Y)):pe&&(we(),E(pe,1,1,()=>{pe=null}),Me())},i(ce){_e||(S(Re),S(N),S(pe),_e=!0)},o(ce){E(Re),E(N),E(pe),_e=!1},d(ce){ce&&(x(e),x(Y)),Fe&&Fe.d(),he&&he.d(),ot(le,ce),ge&&ge.d(),ot(Te,ce),K.d(),Re&&Re.d(),Qe[R].d(),pe&&pe.d(ce)}}}function aD(t,e,n){let o,{item:s}=e,{comparison:i=!1}=e,{isTrader:r=!1}=e,{shift:l=!1}=e,{percentages:a=!1}=e,{showTradeInfo:c=!0}=e,{showLore:f=!0}=e,u,m,g=v=>{let _=new Map;return s.stats.forEach((b,k)=>{_.set(k,b.value)}),v.stats.forEach((b,k)=>{let y=(_.get(k)||0)-b.value;y!==0?_.set(k,y):_.delete(k)}),Array.from(_)};return t.$$set=v=>{"item"in v&&n(0,s=v.item),"comparison"in v&&n(9,i=v.comparison),"isTrader"in v&&n(1,r=v.isTrader),"shift"in v&&n(2,l=v.shift),"percentages"in v&&n(3,a=v.percentages),"showTradeInfo"in v&&n(4,c=v.showTradeInfo),"showLore"in v&&n(5,f=v.showLore)},t.$$.update=()=>{if(t.$$.dirty&1&&n(8,o=s.stats.has(10)?Array.from(s.stats).filter(v=>v[0]!==11):Array.from(s.stats)),t.$$.dirty&517)if(I&&l&&!i){let v=s.getEquipSlot();if(v!==void 0&&I.player.inventory.slots.has(v)){let _=I.player.inventory.slots.get(v);n(6,u=_.type!==void 0?_:void 0),n(7,m=g(_))}}else n(6,u=void 0),n(7,m=void 0)},[s,r,l,a,c,f,u,m,o,i]}var Cd=class extends Ce{constructor(e){super(),Pe(this,e,aD,lD,Be,{item:0,comparison:9,isTrader:1,shift:2,percentages:3,showTradeInfo:4,showLore:5})}},rc=Cd;function cD(t){let e,n;return e=new kl({props:{level:t[2]||1,skill:{...At.get(t[7].id)}}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s[0]&4&&(i.level=o[2]||1),s[0]&128&&(i.skill={...At.get(o[7].id)}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function fD(t){let e,n;return e=new rc({props:{item:t[4]}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s[0]&16&&(i.item=o[4]),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function uD(t){let e,n,o,s,i=[fD,cD],r=[];function l(a,c){return a[4]?0:a[7].id>=0?1:-1}return~(e=l(t,[-1,-1]))&&(n=r[e]=i[e](t)),{c(){n&&n.c(),o=de()},m(a,c){~e&&r[e].m(a,c),w(a,o,c),s=!0},p(a,c){let f=e;e=l(a,c),e===f?~e&&r[e].p(a,c):(n&&(we(),E(r[f],1,1,()=>{r[f]=null}),Me()),~e?(n=r[e],n?n.p(a,c):(n=r[e]=i[e](a),n.c()),S(n,1),n.m(o.parentNode,o)):n=null)},i(a){s||(S(n),s=!0)},o(a){E(n),s=!1},d(a){a&&x(o),~e&&r[e].d(a)}}}function mD(t){let e,n;return e=new bl({props:{shift:t[1],describe:t[7].id>=0&&!t[7].item||t[4]!==void 0,descPos:"bottom:100%;left:50%;transform:translateX(-50%);",clickToUse:!0,status:t[11]?-1:t[5]!==void 0?t[5].status:0,id:"sk"+t[7].hotkey,data:t[7].id>=0||t[4]!==void 0?t[7]:void 0,auto:t[9],queued:t[10],meta:t[16],css:t[15],stacks:t[3],cd:t[13],img:t[14],remaining:t[12],key:t[7].hotkey,border:t[10]||t[8]?"auto":t[11]||t[9]||t[6]||t[13]?"grey":t[4]?jt(t[4].quality)[0]:"white",$$slots:{default:[uD]},$$scope:{ctx:t}}}),e.$on("discard",t[25]),e.$on("move",t[26]),e.$on("use",t[17]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s[0]&2&&(i.shift=o[1]),s[0]&144&&(i.describe=o[7].id>=0&&!o[7].item||o[4]!==void 0),s[0]&2080&&(i.status=o[11]?-1:o[5]!==void 0?o[5].status:0),s[0]&128&&(i.id="sk"+o[7].hotkey),s[0]&144&&(i.data=o[7].id>=0||o[4]!==void 0?o[7]:void 0),s[0]&512&&(i.auto=o[9]),s[0]&1024&&(i.queued=o[10]),s[0]&65536&&(i.meta=o[16]),s[0]&32768&&(i.css=o[15]),s[0]&8&&(i.stacks=o[3]),s[0]&8192&&(i.cd=o[13]),s[0]&16384&&(i.img=o[14]),s[0]&4096&&(i.remaining=o[12]),s[0]&128&&(i.key=o[7].hotkey),s[0]&12112&&(i.border=o[10]||o[8]?"auto":o[11]||o[9]||o[6]||o[13]?"grey":o[4]?jt(o[4].quality)[0]:"white"),s[0]&148|s[1]&8&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function pD(t,e,n){let o,s,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F=ae,A=()=>(F(),F=us(z,le=>n(7,y=le)),z),C,M,D,$,V;re(t,ym,le=>n(20,C=le)),re(t,bm,le=>n(21,M=le)),re(t,ji,le=>n(22,D=le)),re(t,ma,le=>n(23,$=le)),re(t,Ni,le=>n(24,V=le)),t.$$.on_destroy.push(()=>F());let{skill:z}=e;A();let{skillslot:q}=e,{shift:L=!1}=e,U,W,R,N;Bc(()=>{if(y.hotkey!==U&&(W!==void 0&&Fe(),U=y.hotkey,U!==void 0)){N=nt[U],N==null&&(N=nt[U]={});let le=rn(U,N);W=le.onPress(Y),R=le.onRelease(_e)}});let Y=le=>{if(I.player&&y.id>=0){if(y.item){let be=I.player.inventory.findFirstSlotOfType(y.item.type,y.item.tier);if(be!==void 0){let Te=I.player.inventory.slots.get(be);if(Te.bound<Te.logic.bindOnUse){Nt("error","Right-click and use the item in your inventory to bind it before using");return}Xe(z,y.info[0]=be,y)}else return}let ge=At.get(y.id);ge.envCast>0?hr>0?uu(0,0,0):uu(y.id,ge.range,ge.envCast):Io(Mt.clientPlayerSkill.packData({id:y.id,info:y.info})),le.type==="keydown"&&n(8,u=!0),xt(96)}},_e=()=>{n(8,u=!1)},Fe=()=>{N&&N.mappings&&(N.mappings=N.mappings.filter(le=>le!=U)),N&&N.press&&(N.press=N.press.filter(le=>le!=W)),N&&N.release&&(N.release=N.release.filter(le=>le!=R)),U=void 0,W=void 0,R=void 0};Tn(Fe);function he(le){fi.call(this,t,le)}function ie(le){fi.call(this,t,le)}return t.$$set=le=>{"skill"in le&&A(n(0,z=le.skill)),"skillslot"in le&&n(18,q=le.skillslot),"shift"in le&&n(1,L=le.shift)},t.$$.update=()=>{t.$$.dirty[0]&262272&&n(16,o={type:"skill",slot:q,skill:y}),t.$$.dirty[0]&128&&n(6,s=y.id<0),t.$$.dirty[0]&128&&n(19,i=y.item),t.$$.dirty[0]&16777408&&n(5,r=s?void 0:V[y.id]),t.$$.dirty[0]&128&&n(15,l=y.item?"slotitem":"slotskill"),t.$$.dirty[0]&8388736&&n(4,a=$&&y.item&&I.player?I.player.inventory.findFirstItemOfType(y.item.type,y.item.tier):void 0),t.$$.dirty[0]&524496&&n(14,c=s?void 0:i?a?Xf(a.type,a.tier,a.logic.class,Za(a.quality)):Xf(i.type,i.tier,0,0):Qf(y.id)),t.$$.dirty[0]&8912912&&n(3,f=a!==void 0&&a.stacks!==void 0?$[i.type+i.tier]||0:void 0),t.$$.dirty[0]&4194496&&n(2,m=!y.item&&!s&&D.has(y.id)?D.get(y.id):0),t.$$.dirty[0]&32&&n(13,g=r?r.cd:void 0),t.$$.dirty[0]&32&&n(12,v=r?r.remaining:void 0),t.$$.dirty[0]&156&&n(11,_=y.item&&(!a||f===0)||!y.item&&m===0),t.$$.dirty[0]&2097280&&n(10,b=M!==void 0&&M===y.id),t.$$.dirty[0]&1048704&&n(9,k=C!==void 0&&C===y.id)},n(8,u=!1),[z,L,m,f,a,r,s,y,u,k,b,_,v,g,c,l,o,Y,q,i,C,M,D,$,V,he,ie]}var Wg=class extends Ce{constructor(e){super(),Pe(this,e,pD,mD,Be,{skill:0,skillslot:18,shift:1},null,[-1,-1])}},jM=Wg;function WM(t,e,n){let o=t.slice();return o[10]=e[n],o[12]=n,o}function GM(t){let e,n;return e=new jM({props:{skill:t[10],skillslot:t[12],shift:t[0]}}),e.$on("discard",t[3]),e.$on("move",t[2]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&1&&(i.shift=o[0]),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function dD(t){let e,n,o=me(Po),s=[];for(let r=0;r<o.length;r+=1)s[r]=GM(WM(t,o,r));let i=r=>E(s[r],1,1,()=>{s[r]=null});return{c(){e=h("div");for(let r=0;r<s.length;r+=1)s[r].c();p(e,"id","skillbar"),p(e,"class","panel-black bar svelte-1v6qmvo")},m(r,l){w(r,e,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null);n=!0},p(r,[l]){if(l&13){o=me(Po);let a;for(a=0;a<o.length;a+=1){let c=WM(r,o,a);s[a]?(s[a].p(c,l),S(s[a],1)):(s[a]=GM(c),s[a].c(),S(s[a],1),s[a].m(e,null))}for(we(),a=o.length;a<s.length;a+=1)i(a);Me()}},i(r){if(!n){for(let l=0;l<o.length;l+=1)S(s[l]);n=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)E(s[l]);n=!1},d(r){r&&x(e),ot(s,r)}}}function hD(t,e,n){let o,s,i,r;re(t,In,g=>n(5,o=g)),re(t,xi,g=>n(6,s=g)),re(t,el,g=>n(7,i=g));let l=nt.shift.store;re(t,l,g=>n(0,r=g));let a=I.player.name,c=s[a];c||(c=Xe(xi,s[a]=[],s));for(let g=0;g<i;++g)if(s[a][g]===void 0){let v=Wp.get(I.player.class).startSkills[g];s[a].push({id:v!==void 0&&At.get(v).autoSkillbar?v:-1,type:0,info:[]}),g===4||g===5?(Xe(xi,s[a][g].id=100,s),Xe(xi,s[a][g].item={type:"misc",tier:g-4},s)):g===11&&Xe(xi,s[a][11].id=40,s)}for(let g=0;g<i;++g)Po[g]===void 0&&Po.push(te({id:-1,type:0,info:[]}));s[a].forEach((g,v)=>{Po[v]&&(g.hotkey=fe["kbSkillbar"+(v+1)],Po[v].set(g))}),Po.forEach((g,v)=>{g.subscribe(_=>{xi.update(b=>(b[a][v]=_,b))})});let f=g=>{let{from:v,to:_}=g.detail;v!==_&&(v.type=="item"?Po[_.slot].update(b=>(b.id=v.item.logic.useSkill,b.item={type:v.item.type,tier:v.item.tier},b)):v.type=="skill"&&(Po[_.slot].update(b=>(b.id=v.skill.id,b.item=v.skill.item,b)),v.slot!==void 0&&Po[v.slot].update(u)))},u=g=>(g.id=-1,g.item=void 0,g);return[r,l,f,g=>{Po[o.meta.slot].update(u)}]}var Gg=class extends Ce{constructor(e){super(),Pe(this,e,hD,dD,yn,{})}},HM=Gg;function YM(t){let e,n;return e=new rc({props:{isTrader:t[6],item:t[10],shift:t[8],percentages:t[8]}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&64&&(i.isTrader=o[6]),s&1024&&(i.item=o[10]),s&256&&(i.shift=o[8]),s&256&&(i.percentages=o[8]),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function gD(t){let e,n,o=t[10]&&YM(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,i){s[10]?o?(o.p(s,i),i&1024&&S(o,1)):(o=YM(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function vD(t){let e,n;return e=new bl({props:{describe:t[10]!==void 0,shift:t[8],cd:t[11],id:t[7],hover:t[5],descPos:t[4],descRoot:t[3],pickable:t[1],status:t[9]?-1:0,meta:t[14],img:t[15],border:t[13],stacks:t[12],data:t[10],key:t[2],$$slots:{default:[gD]},$$scope:{ctx:t}}}),e.$on("discard",t[21]),e.$on("use",t[22]),e.$on("click",t[23]),e.$on("context",t[24]),e.$on("move",t[25]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,[s]){let i={};s&1024&&(i.describe=o[10]!==void 0),s&256&&(i.shift=o[8]),s&2048&&(i.cd=o[11]),s&128&&(i.id=o[7]),s&32&&(i.hover=o[5]),s&16&&(i.descPos=o[4]),s&8&&(i.descRoot=o[3]),s&2&&(i.pickable=o[1]),s&512&&(i.status=o[9]?-1:0),s&16384&&(i.meta=o[14]),s&32768&&(i.img=o[15]),s&8192&&(i.border=o[13]),s&4096&&(i.stacks=o[12]),s&1024&&(i.data=o[10]),s&4&&(i.key=o[2]),s&134219072&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function _D(t,e,n){let o,s,i,r,l,a,c,f,u=ae,m=()=>(u(),u=us(v,N=>n(10,f=N)),v),g;re(t,Ni,N=>n(20,g=N)),t.$$.on_destroy.push(()=>u());let{item:v}=e;m();let{filter:_=""}=e,{invslot:b}=e,{pickable:k=!0}=e,{text:y}=e,{descRoot:F}=e,{descPos:A}=e,{hover:C}=e,{isTrader:M=!1}=e,{clearOnMove:D=!1}=e,{id:$=""}=e,{shift:V=!1}=e,z=N=>N===!0||f.moving?!0:!(!N||f.type.includes(N)||f.logic.level>N||P.items[f.type][f.type==="book"?f.logic.skillid:f.tier].name.toLowerCase().includes(N));function q(N){fi.call(this,t,N)}function L(N){fi.call(this,t,N)}function U(N){fi.call(this,t,N)}function W(N){fi.call(this,t,N)}function R(N){fi.call(this,t,N)}return t.$$set=N=>{"item"in N&&m(n(0,v=N.item)),"filter"in N&&n(16,_=N.filter),"invslot"in N&&n(17,b=N.invslot),"pickable"in N&&n(1,k=N.pickable),"text"in N&&n(2,y=N.text),"descRoot"in N&&n(3,F=N.descRoot),"descPos"in N&&n(4,A=N.descPos),"hover"in N&&n(5,C=N.hover),"isTrader"in N&&n(6,M=N.isTrader),"clearOnMove"in N&&n(18,D=N.clearOnMove),"id"in N&&n(7,$=N.id),"shift"in N&&n(8,V=N.shift)},t.$$.update=()=>{t.$$.dirty&132096&&n(15,o=f?Xf(f.type,f.tier,f.logic?f.logic.class:0,Za(f.quality)):b>100?Kk(b):void 0),t.$$.dirty&394241&&n(14,s={type:"item",slot:b,item:f,store:D?v:void 0}),t.$$.dirty&66624&&n(9,i=f&&(M?!1:z(_))),t.$$.dirty&1536&&n(13,r=f?jt(f.quality)[0]+(i?" grey":""):"grey"),t.$$.dirty&1024&&n(12,l=f&&(f.upgrade?"+"+f.upgrade:f.stacks)),t.$$.dirty&1049600&&n(19,a=f&&f.logic.useSkill?g[f.logic.useSkill]:void 0),t.$$.dirty&524288&&n(11,c=a?a.cd:void 0)},[v,k,y,F,A,C,M,$,V,i,f,c,l,r,s,o,_,b,D,a,g,q,L,U,W,R]}var Hg=class extends Ce{constructor(e){super(),Pe(this,e,_D,vD,Be,{item:0,filter:16,invslot:17,pickable:1,text:2,descRoot:3,descPos:4,hover:5,isTrader:6,clearOnMove:18,id:7,shift:8})}},Mo=Hg;function XM(t,e,n){let o=t.slice();return o[19]=e[n],o[21]=n,o}function QM(t){let e,n;return e=new $t({props:{zindex:7,title:P.ui.inventory.name,icon:"bag",$$slots:{default:[bD]},$$scope:{ctx:t}}}),e.$on("close",t[14]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&4194555&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function ZM(t){let e,n;return e=new Mo({props:{id:"bag"+t[21],item:t[19],invslot:t[21],filter:t[0].toLowerCase(),shift:t[4]||t[5]}}),e.$on("use",t[12]),e.$on("context",t[11]),e.$on("move",t[10]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&2&&(i.item=o[19]),s&1&&(i.filter=o[0].toLowerCase()),s&48&&(i.shift=o[4]||o[5]),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function bD(t){let e,n,o,s,i,r,l,a,c,f,u=me(t[1].filter(JM)),m=[];for(let v=0;v<u.length;v+=1)m[v]=ZM(XM(t,u,v));let g=v=>E(m[v],1,1,()=>{m[v]=null});return i=new xn({props:{amount:t[6]}}),l=new vr({props:{amount:t[7]}}),{c(){e=h("input"),o=h("div");for(let v=0;v<m.length;v+=1)m[v].c();s=h("div"),J(i.$$.fragment),r=h("a"),J(l.$$.fragment),p(e,"class","filter svelte-ha50yv"),p(e,"type","text"),p(e,"placeholder",n=P.ui.filter),p(o,"class","slotcontainer svelte-ha50yv"),Le(o,"grid-template-columns","repeat("+t[3]+", auto)"),p(s,"class","panel-black gold svelte-ha50yv"),p(r,"class","panel-black gold svelte-ha50yv"),Le(r,"margin-right","3px"),p(r,"target","_blank"),p(r,"href","/store")},m(v,_){w(v,e,_),je(e,t[0]),w(v,o,_);for(let b=0;b<m.length;b+=1)m[b]&&m[b].m(o,null);w(v,s,_),Q(i,s,null),w(v,r,_),Q(l,r,null),a=!0,c||(f=H(e,"input",t[13]),c=!0)},p(v,_){if(_&1&&e.value!==v[0]&&je(e,v[0]),_&7219){u=me(v[1].filter(JM));let y;for(y=0;y<u.length;y+=1){let F=XM(v,u,y);m[y]?(m[y].p(F,_),S(m[y],1)):(m[y]=ZM(F),m[y].c(),S(m[y],1),m[y].m(o,null))}for(we(),y=u.length;y<m.length;y+=1)g(y);Me()}(!a||_&8)&&Le(o,"grid-template-columns","repeat("+v[3]+", auto)");let b={};_&64&&(b.amount=v[6]),i.$set(b);let k={};_&128&&(k.amount=v[7]),l.$set(k)},i(v){if(!a){for(let _=0;_<u.length;_+=1)S(m[_]);S(i.$$.fragment,v),S(l.$$.fragment,v),a=!0}},o(v){m=m.filter(Boolean);for(let _=0;_<m.length;_+=1)E(m[_]);E(i.$$.fragment,v),E(l.$$.fragment,v),a=!1},d(v){v&&(x(e),x(o),x(s),x(r)),ot(m,v),Z(i),Z(l),c=!1,f()}}}function yD(t){let e,n,o=t[2]&&QM(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[2]?o?(o.p(s,i),i&4&&S(o,1)):(o=QM(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}var JM=(t,e)=>e<101;function kD(t,e,n){let o,s,i,r,l,a,c,f,u,m,g;re(t,Jo,M=>n(15,o=M)),re(t,ds,M=>n(16,s=M)),re(t,zo,M=>n(17,i=M)),re(t,In,M=>n(18,r=M)),re(t,ua,M=>n(1,l=M)),re(t,gi,M=>n(2,a=M)),re(t,Xr,M=>n(3,c=M)),re(t,Zo,M=>n(6,m=M)),re(t,Oi,M=>n(7,g=M));let v="",_=nt.shift.store;re(t,_,M=>n(4,f=M));let b=nt.ctrl.store;re(t,b,M=>n(5,u=M));let k=M=>{let{from:D,to:$}=M.detail;if(D!==$&&D.type=="item"&&D.slot!==void 0&&$.slot!==void 0&&D.slot!==$.slot){if(yt("itemmove",`${D.slot} ${$.slot}`),D.slot>=101)return;D.item.stacks&&(D.item.stacks=""),D.item.moving=!0,$.item?($.item.stacks&&($.item.stacks=""),l[D.slot].set($.item),$.item.moving=!0):l[D.slot]&&l[D.slot].set(void 0),l[$.slot].set(D.item)}},y=M=>{if(!M.detail.item||r)return;let D=[];if(i&&D.push(Wt.itemstash(M.detail.slot)),M.detail.item.canEquip(I.player)){let $=M.detail.item.getBestEquipslot(I.player.inventory);$!==void 0&&D.push(Wt.itemmove(M.detail.slot,$)),M.detail.item.logic.useSkill&&D.push(Wt.itemuse(M.detail.slot,M.detail.item.logic.useSkill,M.detail.item.bound,M.detail.item.logic.bindOnUse))}o&&M.detail.item.canBeSold()&&D.push(Wt.itemsell(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier)),M.detail.item.stacks>1&&(D.push(Wt.itemsplithalf(M.detail.slot)),D.push(Wt.itemsplitone(M.detail.slot))),D.push(Wt.itemcopyid(M.detail.item.dbid)),D.push({name:"Link in chat",fun:$=>Ro.update(V=>V+`>${M.detail.item.dbid}`)}),M.detail.item.canBeDropped()&&D.push(Wt.itemdrop(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier)),dn.set({x:M.detail.e.pageX-M.detail.e.layerX,y:M.detail.e.pageY+(46-M.detail.e.layerY),xFlip:46,yFlip:46,opts:D})},F=M=>{M.detail.item&&(i?yt("itemstash",`${M.detail.slot}`):s?(hs.set(M.detail.item),M.detail.item.type&&xt(Uo[M.detail.item.type].sound)):o&&M.detail.item.canBeSold()?Kf(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier):M.detail.item.canBeDropped()&&Q1(M.detail.item.quality,M.detail.item.upgrade,M.detail.slot,M.detail.item.type,M.detail.item.tier))};function A(){v=this.value,n(0,v)}return[v,l,a,c,f,u,m,g,_,b,k,y,F,A,M=>Xe(gi,a=!1,a)]}var Yg=class extends Ce{constructor(e){super(),Pe(this,e,kD,yD,Be,{})}},KM=Yg;var Qg={};Kn(Qg,{add:()=>Sd,init:()=>e6,onWorldEnter:()=>xD,tick:()=>wD,values:()=>rs});var rs=new Map,Xg=new kt(0,.5),e6=()=>{rs.clear(),Xg.reset(0)},xD=e6,wD=t=>{if(fe.dpsmeterOpen&&Xg.done(I.time))if(Xg.reset(I.time),rs.forEach((e,n)=>{if(e.ooc){I.time-e.start>5&&rs.delete(n);return}!I.entity(e.id)||I.time-e.last>5?(e.ooc=!0,e.start=I.time):e.dps=Math.ceil(e.amount/Math.max(5,I.time-e.start))}),fe.dpsmeterTarget){let e=rs.get(fe.dpsmeterTarget);e?Xc.set(Array.from(e.skills).sort((n,o)=>o[1].amount-n[1].amount).map(n=>(n[1].dps=Math.ceil(n[1].amount/Math.max(5,I.time-n[1].start)),n)).slice(0,10)):Jr.set(0)}else Xc.set(Array.from(rs).sort((e,n)=>n[1].amount-e[1].amount).slice(0,10))},Sd=(t,e,n)=>{if(t.name===void 0||!fe.dpsmeterOpen||t.type!==0||fe.dpsmeterParty&&(I.player.party===0&&t!==I.player||t.party!==I.player.party))return;let o;rs.has(t.name)?o=rs.get(t.name):(rs.set(t.name,o={}),o.amount=0,o.start=0,o.class=t.class,o.dps=0,o.id=t.id,o.ooc=!0,o.skills=new Map),o.ooc?(o.start=I.time,o.ooc=!1,o.amount=e):o.amount+=e;let s=P.items.book[n]?P.items.book[n].name:"Unknown";o.skills.has(s)||o.skills.set(s,{id:n,class:t.class,amount:0,start:I.time});let i=o.skills.get(s);i.amount+=e,o.last=I.time};function t6(t,e,n){let o=t.slice();return o[11]=e[n],o[13]=n,o}function n6(t){let e,n;return e=new $t({props:{origin:"right bottom",title:t[5][t[1]],icon:"trophy",$$slots:{default:[MD]},$$scope:{ctx:t}}}),e.$on("close",t[10]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&2&&(i.title=o[5][o[1]]),s&16414&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function o6(t,e){let n,o,s,i,r;o=new xo({props:{size:"0.9em",fract:Math.round(100*e[11][1].amount/e[2][0][1].amount),barcol:"bgc"+e[11][1].class,left:`${e[13]+1}. ${e[11][0]}`,right:`${ro(e[11][1].amount)} (${dt(e[11][1].dps)})`}});function l(...a){return e[7](e[11],...a)}return{key:t,first:null,c(){n=h("div"),J(o.$$.fragment),this.first=n},m(a,c){w(a,n,c),Q(o,n,null),s=!0,i||(r=H(n,"click",l),i=!0)},p(a,c){e=a;let f={};c&4&&(f.fract=Math.round(100*e[11][1].amount/e[2][0][1].amount)),c&4&&(f.barcol="bgc"+e[11][1].class),c&4&&(f.left=`${e[13]+1}. ${e[11][0]}`),c&4&&(f.right=`${ro(e[11][1].amount)} (${dt(e[11][1].dps)})`),o.$set(f)},i(a){s||(S(o.$$.fragment,a),s=!0)},o(a){E(o.$$.fragment,a),s=!1},d(a){a&&x(n),Z(o),i=!1,r()}}}function MD(t){let e,n=[],o=new Map,s,i,r=t[5][t[1]]+"",l,a,c,f,u,m,g,v,_=me(t[2]),b=k=>k[11][1].id;for(let k=0;k<_.length;k+=1){let y=t6(t,_,k),F=b(y);o.set(F,n[k]=o6(F,y))}return{c(){e=h("div");for(let k=0;k<n.length;k+=1)n[k].c();s=h("div"),i=h("div"),l=T(r),a=h("div"),c=T("Party"),u=h("div"),u.textContent=`${P.ui.reset}`,p(e,"class","wrapper svelte-hjyujf"),p(i,"class","btn grey"),p(a,"class",f="btn "+(t[4]?"grey active":"black textgrey")),p(u,"class","btn grey"),p(s,"class","grid buttons marg-top svelte-hjyujf"),Le(s,"grid-template-columns","2fr 1fr 1fr")},m(k,y){w(k,e,y);for(let F=0;F<n.length;F+=1)n[F]&&n[F].m(e,null);w(k,s,y),d(s,i),d(i,l),d(s,a),d(a,c),d(s,u),m=!0,g||(v=[H(i,"click",t[6]),H(a,"click",t[8]),H(u,"click",t[9])],g=!0)},p(k,y){y&12&&(_=me(k[2]),we(),n=En(n,y,b,1,k,_,o,e,Hn,o6,null,t6),Me()),(!m||y&2)&&r!==(r=k[5][k[1]]+"")&&G(l,r),(!m||y&16&&f!==(f="btn "+(k[4]?"grey active":"black textgrey")))&&p(a,"class",f)},i(k){if(!m){for(let y=0;y<_.length;y+=1)S(n[y]);m=!0}},o(k){for(let y=0;y<n.length;y+=1)E(n[y]);m=!1},d(k){k&&(x(e),x(s));for(let y=0;y<n.length;y+=1)n[y].d();g=!1,rt(v)}}}function FD(t){let e,n,o=t[0]&&n6(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[0]?o?(o.p(s,i),i&1&&S(o,1)):(o=n6(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function CD(t,e,n){let o,s,i,r,l;re(t,Zr,v=>n(0,o=v)),re(t,pf,v=>n(1,s=v)),re(t,Xc,v=>n(2,i=v)),re(t,Jr,v=>n(3,r=v)),re(t,mf,v=>n(4,l=v));let a=[P.ui.stats.misc.damage,P.ui.stats.misc.healing];return[o,s,i,r,l,a,v=>{dn.set({x:v.pageX,y:v.pageY-50,opts:a.map((_,b)=>({name:_,fun:()=>{pf.set(b),rs.clear()}}))})},(v,_)=>{Xe(Jr,r=r?0:v[0],r)},v=>Xe(mf,l=!l,l),v=>rs.clear(),v=>Xe(Zr,o=!1,o)]}var Zg=class extends Ce{constructor(e){super(),Pe(this,e,CD,FD,Be,{})}},s6=Zg;function i6(t){let e,n=t[0].area+"",o,s,i,r;return{c(){e=h("p"),o=T(n),i=Ne(),p(e,"class","text location textgreen svelte-dujqu3")},m(l,a){w(l,e,a),d(e,o),w(l,i,a),r=!0},p(l,a){(!r||a&1)&&n!==(n=l[0].area+"")&&G(o,n)},i(l){r||(l&&bn(()=>{r&&(s||(s=Vh(e,Pm,{},!0)),s.run(1))}),r=!0)},o(l){l&&(s||(s=Vh(e,Pm,{},!1)),s.run(0)),r=!1},d(l){l&&(x(e),x(i)),l&&s&&s.end()}}}function r6(t){let e,n=t[0].error+"",o,s,i;return{c(){e=h("p"),o=T(n),p(e,"class","text error textred svelte-dujqu3")},m(r,l){w(r,e,l),d(e,o),i=!0},p(r,l){(!i||l&1)&&n!==(n=r[0].error+"")&&G(o,n)},i(r){i||(s&&s.end(1),i=!0)},o(r){r&&(s=_2(e,Pm,{})),i=!1},d(r){r&&x(e),r&&s&&s.end()}}}function SD(t){let e,n,o=t[0].area&&i6(t),s=t[0].error&&r6(t);return{c(){e=h("div"),o&&o.c(),n=de(),s&&s.c(),p(e,"class","l-ui")},m(i,r){w(i,e,r),o&&o.m(e,null),d(e,n),s&&s.m(e,null)},p(i,[r]){i[0].area?o?(o.p(i,r),r&1&&S(o,1)):(o=i6(i),o.c(),S(o,1),o.m(e,n)):o&&(we(),E(o,1,1,()=>{o=null}),Me()),i[0].error?s?(s.p(i,r),r&1&&S(s,1)):(s=r6(i),s.c(),S(s,1),s.m(e,null)):s&&(we(),E(s,1,1,()=>{s=null}),Me())},i(i){S(o),S(s)},o(i){E(o),E(s)},d(i){i&&x(e),o&&o.d(),s&&s.d()}}}function PD(t,e,n){let o={},s={};return Dr.subscribe(i=>{n(0,o[i.type]=i.text,o),s[i.type]&&clearTimeout(s[i.type]),s[i.type]=setTimeout(()=>{n(0,o[i.type]=void 0,o)},i.time||1e3)}),[o]}var Jg=class extends Ce{constructor(e){super(),Pe(this,e,PD,SD,Be,{})}},l6=Jg;function a6(t,e,n){let o=t.slice();return o[3]=e[n],o}function c6(t){let e,n;return e=new $t({props:{origin:"center",zindex:10,title:P.ui.headers.request,close:!1,$$slots:{default:[AD]},$$scope:{ctx:t}}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&65&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function f6(t){let e,n=t[3].text+"",o,s,i=(t[3].unavailable||"")+"",r,l,a=(t[3].additional||"")+"",c,f,u,m;function g(){return t[2](t[3])}return{c(){e=h("div"),o=T(n),s=Ne(),r=T(i),l=Ne(),c=T(a),p(e,"class",f="choice "+(t[3].unavailable?"unavailable textgrey":"")+" svelte-1uywqr8")},m(v,_){w(v,e,_),d(e,o),d(e,s),d(e,r),d(e,l),d(e,c),u||(m=H(e,"click",g),u=!0)},p(v,_){t=v,_&1&&n!==(n=t[3].text+"")&&G(o,n),_&1&&i!==(i=(t[3].unavailable||"")+"")&&G(r,i),_&1&&a!==(a=(t[3].additional||"")+"")&&G(c,a),_&1&&f!==(f="choice "+(t[3].unavailable?"unavailable textgrey":"")+" svelte-1uywqr8")&&p(e,"class",f)},d(v){v&&x(e),u=!1,m()}}}function AD(t){let e,n,o=t[0][0].title+"",s,i,r=t[0][0].text+"",l=me(t[0][0].choices),a=[];for(let c=0;c<l.length;c+=1)a[c]=f6(a6(t,l,c));return{c(){e=h("div"),n=h("h3"),s=T(o),i=h("p");for(let c=0;c<a.length;c+=1)a[c].c();p(n,"class","textprimary"),p(e,"class","container svelte-1uywqr8")},m(c,f){w(c,e,f),d(e,n),d(n,s),d(e,i),i.innerHTML=r;for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(e,null)},p(c,f){if(f&1&&o!==(o=c[0][0].title+"")&&G(s,o),f&1&&r!==(r=c[0][0].text+"")&&(i.innerHTML=r),f&3){l=me(c[0][0].choices);let u;for(u=0;u<l.length;u+=1){let m=a6(c,l,u);a[u]?a[u].p(m,f):(a[u]=f6(m),a[u].c(),a[u].m(e,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=l.length}},d(c){c&&x(e),ot(a,c)}}}function TD(t){let e,n,o=t[0].length&&c6(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[0].length?o?(o.p(s,i),i&1&&S(o,1)):(o=c6(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function ED(t,e,n){let o;re(t,ui,r=>n(0,o=r));let s=async r=>{r&&await r(),d1()};return[o,s,r=>{s(r.fun)}]}var Kg=class extends Ce{constructor(e){super(),Pe(this,e,ED,TD,Be,{})}},u6=Kg;function m6(t){let e,n,o=t[0][0].text+"",s,i,r=t[0][0].icon&&p6(t);return{c(){e=h("div"),r&&r.c(),n=h("div"),p(e,"class","notification panel-black border grey svelte-9nlpzp")},m(l,a){w(l,e,a),r&&r.m(e,null),d(e,n),n.innerHTML=o,s||(i=H(e,"click",t[2]),s=!0)},p(l,a){l[0][0].icon?r?r.p(l,a):(r=p6(l),r.c(),r.m(e,n)):r&&(r.d(1),r=null),a&1&&o!==(o=l[0][0].text+"")&&(n.innerHTML=o)},d(l){l&&x(e),r&&r.d(),s=!1,i()}}}function p6(t){let e,n,o;return{c(){e=h("img"),p(e,"class",n="icon "+t[0][0].css+" svelte-9nlpzp"),at(e.src,o="/data/ui/"+t[0][0].icon)||p(e,"src",o)},m(s,i){w(s,e,i)},p(s,i){i&1&&n!==(n="icon "+s[0][0].css+" svelte-9nlpzp")&&p(e,"class",n),i&1&&!at(e.src,o="/data/ui/"+s[0][0].icon)&&p(e,"src",o)},d(s){s&&x(e)}}}function ID(t){let e,n=t[0].length&&!t[1]&&m6(t);return{c(){n&&n.c(),e=de()},m(o,s){n&&n.m(o,s),w(o,e,s)},p(o,[s]){o[0].length&&!o[1]?n?n.p(o,s):(n=m6(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(o){o&&x(e),n&&n.d(o)}}}function DD(t,e,n){let o,s;return re(t,Oc,r=>n(0,o=r)),re(t,So,r=>n(1,s=r)),[o,s,()=>{Oc.update(r=>(r.shift(),r))}]}var ev=class extends Ce{constructor(e){super(),Pe(this,e,DD,ID,Be,{})}},d6=ev;function h6(t,e,n){let o=t.slice();return o[5]=e[n],o}function g6(t){let e,n;return{c(){e=h("div"),n=T(t[0]),p(e,"class","btn border grey")},m(o,s){w(o,e,s),d(e,n)},p(o,s){s&1&&G(n,o[0])},d(o){o&&x(e)}}}function v6(t){let e,n,o,s,i,r;function l(...c){return t[2](t[5],...c)}function a(...c){return t[4](t[5],...c)}return{c(){e=h("div"),n=h("img"),p(n,"class","svgicon"),at(n.src,o="/data/ui/icons/"+t[5].img+".svg?v=8738303")||p(n,"src",o),p(e,"id",s="sys"+t[5].img),p(e,"class","btn border black")},m(c,f){w(c,e,f),d(e,n),i||(r=[H(e,"mouseenter",l),H(e,"mouseleave",t[3]),H(e,"click",a)],i=!0)},p(c,f){t=c},d(c){c&&x(e),i=!1,rt(r)}}}function VD(t){let e,n,o=t[0]!==""&&g6(t),s=me(t[1]),i=[];for(let r=0;r<s.length;r+=1)i[r]=v6(h6(t,s,r));return{c(){e=h("div"),o&&o.c(),n=de();for(let r=0;r<i.length;r+=1)i[r].c();p(e,"class","btnbar svelte-133q4bd")},m(r,l){w(r,e,l),o&&o.m(e,null),d(e,n);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(e,null)},p(r,[l]){if(r[0]!==""?o?o.p(r,l):(o=g6(r),o.c(),o.m(e,n)):o&&(o.d(1),o=null),l&3){s=me(r[1]);let a;for(a=0;a<s.length;a+=1){let c=h6(r,s,a);i[a]?i[a].p(c,l):(i[a]=v6(c),i[a].c(),i[a].m(e,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},i:ae,o:ae,d(r){r&&x(e),o&&o.d(),ot(i,r)}}}function LD(t,e,n){let o=[{img:"gem",desc:P.ui.elixir.subscription,store:Bo},{img:"char",desc:P.ui.headers.character,store:ki},{img:"book",desc:P.ui.headers.skills,store:vi},{img:"bag",desc:P.ui.inventory.name,store:gi},{img:"pvp",desc:P.ui.headers.pvp,store:yi},{img:"clan",desc:P.ui.clan.heading,store:_i},{img:"trophy",desc:P.ui.headers.dpsMeter,store:Zr},{img:"social",desc:"Social",store:bi},{img:"cog",desc:P.ui.settings.name,store:Qr},{img:"fullscreen",desc:P.ui.headers.fullscreen,fun:async()=>{"keyboard"in navigator&&"lock"in navigator.keyboard&&await navigator.keyboard.lock(["Escape"]),document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}},{img:"back",desc:P.ui.headers.menuReturn,fun:()=>{document.location.href="/"}}],s="";return[s,o,(a,c)=>n(0,s=a.desc),a=>n(0,s=""),(a,c)=>{a.fun?a.fun():a.store.update(f=>!f)}]}var tv=class extends Ce{constructor(e){super(),Pe(this,e,LD,VD,Be,{})}},_6=tv;function qD(t){let e,n,o,s;return{c(){e=h("div"),p(e,"class",n="btn checkbox "+(t[2]?"active":""))},m(i,r){w(i,e,r),o||(s=H(e,"click",t[3]),o=!0)},p(i,[r]){r&4&&n!==(n="btn checkbox "+(i[2]?"active":""))&&p(e,"class",n)},i:ae,o:ae,d(i){i&&x(e),o=!1,s()}}}function RD(t,e,n){let o,s=ae,i=()=>(s(),s=us(r,c=>n(2,o=c)),r);t.$$.on_destroy.push(()=>s());let{store:r}=e;i();let{cb:l}=e,a=c=>{Xe(r,o=!o,o),l&&l(o)};return t.$$set=c=>{"store"in c&&i(n(0,r=c.store)),"cb"in c&&n(1,l=c.cb)},[r,l,o,a]}var nv=class extends Ce{constructor(e){super(),Pe(this,e,RD,qD,Be,{store:0,cb:1})}},St=nv;function b6(t,e,n){let o=t.slice();return o[71]=e[n],o}function y6(t,e,n){let o=t.slice();return o[68]=e[n],o[69]=e,o[70]=n,o}function k6(t,e,n){let o=t.slice();return o[74]=e[n],o}function x6(t){let e,n;return e=new $t({props:{zindex:9,title:P.ui.settings.name,origin:"center",icon:"cog",$$slots:{default:[ND]},$$scope:{ctx:t}}}),e.$on("close",t[66]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s[0]&2147483626|s[2]&32768&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function w6(t){let e,n=t[74].name+"",o,s,i,r;function l(...a){return t[35](t[74],...a)}return{c(){e=h("div"),o=T(n),p(e,"class",s="choice "+(t[74]==t[1]?"active":""))},m(a,c){w(a,e,c),d(e,o),i||(r=H(e,"click",l),i=!0)},p(a,c){t=a,c[0]&2&&s!==(s="choice "+(t[74]==t[1]?"active":""))&&p(e,"class",s)},d(a){a&&x(e),i=!1,r()}}}function zD(t){let e,n,o,s,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A,C;return n=new St({props:{store:rp}}),l=new St({props:{store:up}}),c=new St({props:{store:mp}}),u=new St({props:{store:gp}}),v=new St({props:{store:pp}}),b=new St({props:{store:dp}}),y=new St({props:{store:hp}}),A=new St({props:{store:vp}}),{c(){e=h("div"),e.textContent=`${P.ui.settings.chatbubbles}`,J(n.$$.fragment),o=h("div"),o.textContent=`${P.ui.settings.combatlog}`,s=h("div"),i=Ne(),r=h("div"),r.textContent="Exp Gain",J(l.$$.fragment),a=h("div"),a.textContent="Fame Loss / Gain",J(c.$$.fragment),f=h("div"),f.textContent="Gold Pick Up",J(u.$$.fragment),m=Ne(),g=h("div"),g.textContent="Item Pick Up",J(v.$$.fragment),_=h("div"),_.textContent="Item Party Roll",J(b.$$.fragment),k=h("div"),k.textContent="Item Party Pick Up",J(y.$$.fragment),F=h("div"),F.textContent="Friend Online Status",J(A.$$.fragment),p(o,"class","textprimary")},m(M,D){w(M,e,D),Q(n,M,D),w(M,o,D),w(M,s,D),w(M,i,D),w(M,r,D),Q(l,M,D),w(M,a,D),Q(c,M,D),w(M,f,D),Q(u,M,D),w(M,m,D),w(M,g,D),Q(v,M,D),w(M,_,D),Q(b,M,D),w(M,k,D),Q(y,M,D),w(M,F,D),Q(A,M,D),C=!0},p:ae,i(M){C||(S(n.$$.fragment,M),S(l.$$.fragment,M),S(c.$$.fragment,M),S(u.$$.fragment,M),S(v.$$.fragment,M),S(b.$$.fragment,M),S(y.$$.fragment,M),S(A.$$.fragment,M),C=!0)},o(M){E(n.$$.fragment,M),E(l.$$.fragment,M),E(c.$$.fragment,M),E(u.$$.fragment,M),E(v.$$.fragment,M),E(b.$$.fragment,M),E(y.$$.fragment,M),E(A.$$.fragment,M),C=!1},d(M){M&&(x(e),x(o),x(s),x(i),x(r),x(a),x(f),x(m),x(g),x(_),x(k),x(F)),Z(n,M),Z(l,M),Z(c,M),Z(u,M),Z(v,M),Z(b,M),Z(y,M),Z(A,M)}}}function BD(t){let e,n=P.ui.settings.language+"",o,s,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A,C,M,D,$,V,z,q,L,U,W,R,N,Y,_e,Fe,he,ie,le,ge,be,Te,se,Ie,K,Re=P.ui.settings.qualitymin+"",Ge,Qe,Ye,pe,ce,Oe,oe,ee=P.ui.settings.excludedrops+"",O,ue,We,ze,Ae,$e,Ue,mt,wt,Je,Et,xe,Ke,bt,Ct,Ve,ye,Vt=P.ui.settings.skillcdtext+"",Ht,Lt,Rt,He,et,Ee,it,Ze,ft,wn=P.ui.settings.flashinterval+"",Is,fo,qo,pt=t[22].toFixed(1)+"",zt,Ds,Wn,uo,Pc=P.ui.settings.flashduration+"",Tr,zi,Vs,pn=t[23].toFixed(1)+"",Ut,tn,mo,ju,Ls,Wu,qs,Gu,Bl,Ac,gh,Hu,$l,Yu,Ul,Xu,Ol,Qu,Rs,Tc,vh,Zu,Nl,Ju,jl,Ec,_h,Wl,a7=P.ui.settings.protectedquality+"",G_,H_,Ic,bh,Y_,zs,Gl,c7=P.ui.settings.invwidth+"",X_,Q_,Ku,yh,Bs,Dc,kh,Hl,f7=P.ui.settings.stashwidth+"",Z_,J_,em,xh,$s,Yl,u7=P.ui.settings.stashheight+"",K_,e2,tm,wh,Us,Vc,Mh,nm,Xl,fs,Fh,t2,Ql=me(t[32]),po=[];for(let ne=0;ne<Ql.length;ne+=1)po[ne]=M6(b6(t,Ql,ne));return k=new St({props:{store:Ma}}),D=new St({props:{store:Ym}}),V=new St({props:{store:Zm}}),q=new St({props:{store:Xm}}),U=new St({props:{store:Jm}}),R=new St({props:{store:Qm}}),Y=new St({props:{store:Km}}),Fe=new St({props:{store:tp}}),ie=new St({props:{store:op}}),ge=new St({props:{store:ep}}),Ie=new St({props:{store:fp}}),mt=new St({props:{store:ap}}),Je=new St({props:{store:lp}}),xe=new St({props:{store:cp}}),bt=new St({props:{store:np}}),He=new St({props:{store:_p,cb:t[33]}}),Ee=new St({props:{store:bp}}),Ze=new St({props:{store:wp}}),Bl=new St({props:{store:yp}}),$l=new St({props:{store:xp}}),Ul=new St({props:{store:kp}}),Ol=new St({props:{store:Fa}}),Nl=new St({props:{store:sp}}),jl=new St({props:{store:ip}}),Xl=new St({props:{store:wa}}),{c(){e=h("div"),o=T(n),s=Ne(),i=h("br"),r=h("small"),r.textContent=`${P.ui.settings.reload}`,l=h("select");for(let ne=0;ne<po.length;ne+=1)po[ne].c();a=h("div"),a.textContent=`${P.ui.settings.tutorial}`,c=h("div"),f=h("div"),f.textContent=`${P.ui.reset}`,u=h("div"),u.textContent=`${P.ui.settings.resettutorial}`,m=h("div"),m.textContent=`${P.ui.disable}`,g=h("div"),g.textContent=`${P.ui.settings.disabletutorial}`,v=h("div"),v.textContent=`${P.ui.settings.fpsping}`,_=h("div"),b=h("div"),b.textContent=`${P.ui.settings.showfps}`,J(k.$$.fragment),y=h("div"),y.textContent=`${P.ui.settings.nameplates}`,F=h("div"),A=h("div"),A.textContent=`${P.ui.settings.drawrange}`,C=h("input"),M=h("div"),M.textContent=`${P.ui.settings.monsterbars}`,J(D.$$.fragment),$=h("div"),$.textContent=`${P.ui.settings.monsternames}`,J(V.$$.fragment),z=h("div"),z.textContent=`${P.ui.settings.friendlyplayerbars}`,J(q.$$.fragment),L=h("div"),L.textContent=`${P.ui.settings.friendlyplayernames}`,J(U.$$.fragment),W=h("div"),W.textContent=`${P.ui.settings.enemyplayerbars}`,J(R.$$.fragment),N=h("div"),N.textContent=`${P.ui.settings.enemyplayernames}`,J(Y.$$.fragment),_e=h("div"),_e.textContent=`${P.ui.settings.showlevel}`,J(Fe.$$.fragment),he=h("div"),he.textContent=`${P.ui.settings.classcolors}`,J(ie.$$.fragment),le=h("div"),le.textContent=`${P.ui.settings.transparency}`,J(ge.$$.fragment),be=h("div"),be.textContent=`${P.ui.settings.drops}`,Te=h("div"),se=h("div"),se.textContent=`${P.ui.settings.showquality}`,J(Ie.$$.fragment),K=h("div"),Ge=T(Re),Qe=h("br"),Ye=h("small"),pe=T(t[20]),ce=T("%"),Oe=h("input"),oe=h("div"),O=T(ee),ue=h("br"),We=h("small"),We.textContent=`${P.ui.settings.reload}`,ze=h("input"),Ae=h("div"),Ae.textContent=`${P.ui.settings.damagehealing}`,$e=h("div"),Ue=h("div"),Ue.textContent=`${P.ui.settings.incomingdamage}`,J(mt.$$.fragment),wt=h("div"),wt.textContent=`${P.ui.settings.incominghealing}`,J(Je.$$.fragment),Et=h("div"),Et.textContent=`${P.ui.settings.incomingmana}`,J(xe.$$.fragment),Ke=h("div"),Ke.textContent=`${P.ui.settings.preventoverlap}`,J(bt.$$.fragment),Ct=h("div"),Ct.textContent=`${P.ui.settings.icons}`,Ve=h("div"),ye=h("div"),Ht=T(Vt),Lt=h("br"),Rt=h("small"),Rt.textContent=`${P.ui.settings.reload}`,J(He.$$.fragment),et=h("div"),et.textContent=`${P.ui.settings.buffcdtext}`,J(Ee.$$.fragment),it=h("div"),it.textContent=`${P.ui.settings.selfbuffsonly}`,J(Ze.$$.fragment),ft=h("div"),Is=T(wn),fo=h("br"),qo=h("small"),zt=T(pt),Ds=T("s"),Wn=h("input"),uo=h("div"),Tr=T(Pc),zi=h("br"),Vs=h("small"),Ut=T(pn),tn=T("s"),mo=h("input"),ju=h("div"),ju.textContent=`${P.ui.settings.buffmax}`,Ls=h("input"),Wu=h("div"),Wu.textContent=`${P.ui.settings.buffmaxparty}`,qs=h("input"),Gu=h("div"),Gu.textContent=`${P.ui.settings.updateratelimit}`,J(Bl.$$.fragment),Ac=h("div"),Ac.textContent="Party",gh=h("div"),Hu=h("div"),Hu.textContent="Leave party if empty",J($l.$$.fragment),Yu=h("div"),Yu.textContent=`${P.ui.settings.showselfparty}`,J(Ul.$$.fragment),Xu=h("div"),Xu.textContent=`${P.ui.settings.partymana}`,J(Ol.$$.fragment),Qu=h("div"),Qu.textContent=`${P.ui.settings.partyframewidth}`,Rs=h("input"),Tc=h("div"),Tc.textContent=`${P.ui.settings.map}`,vh=h("div"),Zu=h("div"),Zu.textContent=`${P.ui.settings.mapshowmonsters}`,J(Nl.$$.fragment),Ju=h("div"),Ju.textContent=`${P.ui.settings.maplowqual}`,J(jl.$$.fragment),Ec=h("div"),Ec.textContent=`${P.ui.inventory.name}`,_h=h("div"),Wl=h("div"),G_=T(a7),H_=h("br"),Ic=h("small"),bh=T(t[27]),Y_=T("%"),zs=h("input"),Gl=h("div"),X_=T(c7),Q_=h("br"),Ku=h("small"),yh=T(t[28]),Bs=h("input"),Dc=h("div"),Dc.textContent=`${P.ui.stash.name}`,kh=h("div"),Hl=h("div"),Z_=T(f7),J_=h("br"),em=h("small"),xh=T(t[29]),$s=h("input"),Yl=h("div"),K_=T(u7),e2=h("br"),tm=h("small"),wh=T(t[30]),Us=h("input"),Vc=h("div"),Vc.textContent="Social",Mh=h("div"),nm=h("div"),nm.textContent="Twitch Streams",J(Xl.$$.fragment),p(r,"class","textgrey"),t[18]===void 0&&bn(()=>t[51].call(l)),p(a,"class","textprimary"),p(u,"class","btn blue"),p(g,"class","btn orange"),p(v,"class","textprimary"),p(y,"class","textprimary"),p(C,"type","range"),p(be,"class","textprimary"),p(Ye,"class","textgrey"),p(Oe,"type","range"),p(Oe,"min","0"),p(Oe,"max","100"),p(We,"class","textgrey"),p(ze,"type","text"),p(ze,"placeholder","misc, gold, ..."),p(Ae,"class","textprimary"),p(Ct,"class","textprimary"),p(Rt,"class","textgrey"),p(qo,"class","textgrey"),p(Wn,"type","range"),p(Wn,"min","0"),p(Wn,"max","1"),p(Wn,"step","0.1"),p(Vs,"class","textgrey"),p(mo,"type","range"),p(mo,"min","0"),p(mo,"max","5"),p(mo,"step","0.1"),p(Ls,"placeholder","14"),p(Ls,"type","number"),p(Ls,"min","0"),p(qs,"placeholder","8"),p(qs,"type","number"),p(qs,"min","0"),p(Ac,"class","textprimary"),p(Rs,"type","range"),p(Rs,"min","50"),p(Rs,"max","400"),p(Tc,"class","textprimary"),p(Ec,"class","textprimary"),p(Ic,"class","textgrey"),p(zs,"type","range"),p(zs,"min","0"),p(zs,"max","110"),p(Ku,"class","textgrey"),p(Bs,"type","range"),p(Bs,"min","4"),p(Bs,"max","10"),p(Dc,"class","textprimary"),p(em,"class","textgrey"),p($s,"type","range"),p($s,"min","7"),p($s,"max","20"),p(tm,"class","textgrey"),p(Us,"type","range"),p(Us,"min","50"),p(Us,"max","500"),p(Vc,"class","textprimary")},m(ne,De){w(ne,e,De),d(e,o),d(e,s),d(e,i),d(e,r),w(ne,l,De);for(let Gn=0;Gn<po.length;Gn+=1)po[Gn]&&po[Gn].m(l,null);Mn(l,t[18],!0),w(ne,a,De),w(ne,c,De),w(ne,f,De),w(ne,u,De),w(ne,m,De),w(ne,g,De),w(ne,v,De),w(ne,_,De),w(ne,b,De),Q(k,ne,De),w(ne,y,De),w(ne,F,De),w(ne,A,De),w(ne,C,De),je(C,t[19]),w(ne,M,De),Q(D,ne,De),w(ne,$,De),Q(V,ne,De),w(ne,z,De),Q(q,ne,De),w(ne,L,De),Q(U,ne,De),w(ne,W,De),Q(R,ne,De),w(ne,N,De),Q(Y,ne,De),w(ne,_e,De),Q(Fe,ne,De),w(ne,he,De),Q(ie,ne,De),w(ne,le,De),Q(ge,ne,De),w(ne,be,De),w(ne,Te,De),w(ne,se,De),Q(Ie,ne,De),w(ne,K,De),d(K,Ge),d(K,Qe),d(K,Ye),d(Ye,pe),d(Ye,ce),w(ne,Oe,De),je(Oe,t[20]),w(ne,oe,De),d(oe,O),d(oe,ue),d(oe,We),w(ne,ze,De),je(ze,t[21]),w(ne,Ae,De),w(ne,$e,De),w(ne,Ue,De),Q(mt,ne,De),w(ne,wt,De),Q(Je,ne,De),w(ne,Et,De),Q(xe,ne,De),w(ne,Ke,De),Q(bt,ne,De),w(ne,Ct,De),w(ne,Ve,De),w(ne,ye,De),d(ye,Ht),d(ye,Lt),d(ye,Rt),Q(He,ne,De),w(ne,et,De),Q(Ee,ne,De),w(ne,it,De),Q(Ze,ne,De),w(ne,ft,De),d(ft,Is),d(ft,fo),d(ft,qo),d(qo,zt),d(qo,Ds),w(ne,Wn,De),je(Wn,t[22]),w(ne,uo,De),d(uo,Tr),d(uo,zi),d(uo,Vs),d(Vs,Ut),d(Vs,tn),w(ne,mo,De),je(mo,t[23]),w(ne,ju,De),w(ne,Ls,De),je(Ls,t[24]),w(ne,Wu,De),w(ne,qs,De),je(qs,t[25]),w(ne,Gu,De),Q(Bl,ne,De),w(ne,Ac,De),w(ne,gh,De),w(ne,Hu,De),Q($l,ne,De),w(ne,Yu,De),Q(Ul,ne,De),w(ne,Xu,De),Q(Ol,ne,De),w(ne,Qu,De),w(ne,Rs,De),je(Rs,t[26]),w(ne,Tc,De),w(ne,vh,De),w(ne,Zu,De),Q(Nl,ne,De),w(ne,Ju,De),Q(jl,ne,De),w(ne,Ec,De),w(ne,_h,De),w(ne,Wl,De),d(Wl,G_),d(Wl,H_),d(Wl,Ic),d(Ic,bh),d(Ic,Y_),w(ne,zs,De),je(zs,t[27]),w(ne,Gl,De),d(Gl,X_),d(Gl,Q_),d(Gl,Ku),d(Ku,yh),w(ne,Bs,De),je(Bs,t[28]),w(ne,Dc,De),w(ne,kh,De),w(ne,Hl,De),d(Hl,Z_),d(Hl,J_),d(Hl,em),d(em,xh),w(ne,$s,De),je($s,t[29]),w(ne,Yl,De),d(Yl,K_),d(Yl,e2),d(Yl,tm),d(tm,wh),w(ne,Us,De),je(Us,t[30]),w(ne,Vc,De),w(ne,Mh,De),w(ne,nm,De),Q(Xl,ne,De),fs=!0,Fh||(t2=[H(l,"change",t[51]),H(l,"change",t[33]),H(u,"click",t[52]),H(g,"click",t[53]),H(C,"change",t[54]),H(C,"input",t[54]),H(Oe,"change",t[55]),H(Oe,"input",t[55]),H(Oe,"change",t[33]),H(ze,"input",t[56]),H(ze,"change",t[33]),H(Wn,"change",t[57]),H(Wn,"input",t[57]),H(mo,"change",t[58]),H(mo,"input",t[58]),H(Ls,"input",t[59]),H(qs,"input",t[60]),H(Rs,"change",t[61]),H(Rs,"input",t[61]),H(zs,"change",t[62]),H(zs,"input",t[62]),H(Bs,"change",t[63]),H(Bs,"input",t[63]),H($s,"change",t[64]),H($s,"input",t[64]),H(Us,"change",t[65]),H(Us,"input",t[65])],Fh=!0)},p(ne,De){if(De[1]&2){Ql=me(ne[32]);let Gn;for(Gn=0;Gn<Ql.length;Gn+=1){let n2=b6(ne,Ql,Gn);po[Gn]?po[Gn].p(n2,De):(po[Gn]=M6(n2),po[Gn].c(),po[Gn].m(l,null))}for(;Gn<po.length;Gn+=1)po[Gn].d(1);po.length=Ql.length}De[0]&262144|De[1]&2&&Mn(l,ne[18]),De[0]&524288&&je(C,ne[19]),(!fs||De[0]&1048576)&&G(pe,ne[20]),De[0]&1048576&&je(Oe,ne[20]),De[0]&2097152&&ze.value!==ne[21]&&je(ze,ne[21]),(!fs||De[0]&4194304)&&pt!==(pt=ne[22].toFixed(1)+"")&&G(zt,pt),De[0]&4194304&&je(Wn,ne[22]),(!fs||De[0]&8388608)&&pn!==(pn=ne[23].toFixed(1)+"")&&G(Ut,pn),De[0]&8388608&&je(mo,ne[23]),De[0]&16777216&&Gt(Ls.value)!==ne[24]&&je(Ls,ne[24]),De[0]&33554432&&Gt(qs.value)!==ne[25]&&je(qs,ne[25]),De[0]&67108864&&je(Rs,ne[26]),(!fs||De[0]&134217728)&&G(bh,ne[27]),De[0]&134217728&&je(zs,ne[27]),(!fs||De[0]&268435456)&&G(yh,ne[28]),De[0]&268435456&&je(Bs,ne[28]),(!fs||De[0]&536870912)&&G(xh,ne[29]),De[0]&536870912&&je($s,ne[29]),(!fs||De[0]&1073741824)&&G(wh,ne[30]),De[0]&1073741824&&je(Us,ne[30])},i(ne){fs||(S(k.$$.fragment,ne),S(D.$$.fragment,ne),S(V.$$.fragment,ne),S(q.$$.fragment,ne),S(U.$$.fragment,ne),S(R.$$.fragment,ne),S(Y.$$.fragment,ne),S(Fe.$$.fragment,ne),S(ie.$$.fragment,ne),S(ge.$$.fragment,ne),S(Ie.$$.fragment,ne),S(mt.$$.fragment,ne),S(Je.$$.fragment,ne),S(xe.$$.fragment,ne),S(bt.$$.fragment,ne),S(He.$$.fragment,ne),S(Ee.$$.fragment,ne),S(Ze.$$.fragment,ne),S(Bl.$$.fragment,ne),S($l.$$.fragment,ne),S(Ul.$$.fragment,ne),S(Ol.$$.fragment,ne),S(Nl.$$.fragment,ne),S(jl.$$.fragment,ne),S(Xl.$$.fragment,ne),fs=!0)},o(ne){E(k.$$.fragment,ne),E(D.$$.fragment,ne),E(V.$$.fragment,ne),E(q.$$.fragment,ne),E(U.$$.fragment,ne),E(R.$$.fragment,ne),E(Y.$$.fragment,ne),E(Fe.$$.fragment,ne),E(ie.$$.fragment,ne),E(ge.$$.fragment,ne),E(Ie.$$.fragment,ne),E(mt.$$.fragment,ne),E(Je.$$.fragment,ne),E(xe.$$.fragment,ne),E(bt.$$.fragment,ne),E(He.$$.fragment,ne),E(Ee.$$.fragment,ne),E(Ze.$$.fragment,ne),E(Bl.$$.fragment,ne),E($l.$$.fragment,ne),E(Ul.$$.fragment,ne),E(Ol.$$.fragment,ne),E(Nl.$$.fragment,ne),E(jl.$$.fragment,ne),E(Xl.$$.fragment,ne),fs=!1},d(ne){ne&&(x(e),x(l),x(a),x(c),x(f),x(u),x(m),x(g),x(v),x(_),x(b),x(y),x(F),x(A),x(C),x(M),x($),x(z),x(L),x(W),x(N),x(_e),x(he),x(le),x(be),x(Te),x(se),x(K),x(Oe),x(oe),x(ze),x(Ae),x($e),x(Ue),x(wt),x(Et),x(Ke),x(Ct),x(Ve),x(ye),x(et),x(it),x(ft),x(Wn),x(uo),x(mo),x(ju),x(Ls),x(Wu),x(qs),x(Gu),x(Ac),x(gh),x(Hu),x(Yu),x(Xu),x(Qu),x(Rs),x(Tc),x(vh),x(Zu),x(Ju),x(Ec),x(_h),x(Wl),x(zs),x(Gl),x(Bs),x(Dc),x(kh),x(Hl),x($s),x(Yl),x(Us),x(Vc),x(Mh),x(nm)),ot(po,ne),Z(k,ne),Z(D,ne),Z(V,ne),Z(q,ne),Z(U,ne),Z(R,ne),Z(Y,ne),Z(Fe,ne),Z(ie,ne),Z(ge,ne),Z(Ie,ne),Z(mt,ne),Z(Je,ne),Z(xe,ne),Z(bt,ne),Z(He,ne),Z(Ee,ne),Z(Ze,ne),Z(Bl,ne),Z($l,ne),Z(Ul,ne),Z(Ol,ne),Z(Nl,ne),Z(jl,ne),Z(Xl,ne),Fh=!1,rt(t2)}}}function $D(t){let e,n,o,s=P.ui.settings.sfxmultiplier+"",i,r,l,a,c,f,u,m,g,v;return{c(){e=h("div"),e.textContent=`${P.ui.settings.sfxvolume}`,n=h("input"),o=h("div"),i=T(s),r=h("br"),l=h("small"),l.textContent=`${P.ui.settings.multiplierdesc}`,a=h("input"),c=h("div"),c.textContent=`${P.ui.settings.musicvolume}`,f=h("input"),u=h("div"),u.textContent=`${P.ui.settings.ambiencevolume}`,m=h("input"),p(n,"type","range"),p(l,"class","textgrey"),p(a,"type","range"),p(f,"type","range"),p(m,"type","range")},m(_,b){w(_,e,b),w(_,n,b),je(n,t[14]),w(_,o,b),d(o,i),d(o,r),d(o,l),w(_,a,b),je(a,t[15]),w(_,c,b),w(_,f,b),je(f,t[16]),w(_,u,b),w(_,m,b),je(m,t[17]),g||(v=[H(n,"change",t[47]),H(n,"input",t[47]),H(a,"change",t[48]),H(a,"input",t[48]),H(f,"change",t[49]),H(f,"input",t[49]),H(m,"change",t[50]),H(m,"input",t[50])],g=!0)},p(_,b){b[0]&16384&&je(n,_[14]),b[0]&32768&&je(a,_[15]),b[0]&65536&&je(f,_[16]),b[0]&131072&&je(m,_[17])},i:ae,o:ae,d(_){_&&(x(e),x(n),x(o),x(a),x(c),x(f),x(u),x(m)),g=!1,rt(v)}}}function UD(t){let e,n,o,s=P.ui.settings.mousesensitivity+"",i,r,l,a=t[11].toFixed(2)+"",c,f,u,m,g,v,_,b,k,y,F,A,C,M=P.ui.settings.skillbarslots+"",D,$,V,z,q,L,U,W,R,N,Y,_e,Fe,he,ie,le,ge,be,Te,se,Ie,K,Re,Ge;m=new St({props:{store:Mp}}),v=new St({props:{store:Fp}}),b=new St({props:{store:Cp}}),y=new St({props:{store:Sp}}),Y=new St({props:{store:Pp}});let Qe=me(t[3]),Ye=[];for(let pe=0;pe<Qe.length;pe+=1)Ye[pe]=F6(y6(t,Qe,pe));return{c(){e=h("div"),e.textContent=`${P.ui.settings.camera}`,n=h("div"),o=h("div"),i=T(s),r=Ne(),l=h("span"),c=T(a),f=h("input"),u=h("div"),u.textContent=`${P.ui.settings.invertmousex}`,J(m.$$.fragment),g=h("div"),g.textContent=`${P.ui.settings.invertmousey}`,J(v.$$.fragment),_=h("div"),_.textContent=`${P.ui.settings.lockedcamera}`,J(b.$$.fragment),k=h("div"),k.textContent=`${P.ui.settings.pointerlock}`,J(y.$$.fragment),F=h("div"),F.textContent=`${P.ui.settings.skillbar}`,A=h("div"),C=h("div"),D=T(M),$=Ne(),V=h("span"),z=T(t[12]),q=h("br"),L=h("small"),L.textContent=`${P.ui.settings.reload}`,U=h("input"),W=h("div"),W.textContent="Targeting",R=h("div"),N=h("div"),N.textContent="Target Next Friendly: Allow Non-Partied",J(Y.$$.fragment),_e=h("div"),Fe=T("Target Next Friendly: Cycle Size "),he=h("span"),ie=T(t[13]),le=h("input"),ge=h("div"),ge.textContent=`${P.ui.settings.keybindings}`,be=h("div"),Te=h("small"),Te.textContent=`${P.ui.settings.reload}`,se=h("small"),se.textContent=`${P.ui.settings.bindingreset}`;for(let pe=0;pe<Ye.length;pe+=1)Ye[pe].c();Ie=de(),p(e,"class","textprimary"),p(l,"class","textgrey"),p(f,"type","range"),p(f,"step","0.05"),p(f,"min","0.1"),p(f,"max","3"),p(F,"class","textprimary"),p(V,"class","textgrey"),p(L,"class","textgrey"),p(U,"type","range"),p(U,"min","10"),p(U,"max","24"),p(W,"class","textprimary"),p(he,"class","textgrey"),p(le,"type","range"),p(le,"min","1"),p(le,"max","10"),p(ge,"class","textprimary"),p(Te,"class","textgrey"),p(se,"class","textprimary")},m(pe,ce){w(pe,e,ce),w(pe,n,ce),w(pe,o,ce),d(o,i),d(o,r),d(o,l),d(l,c),w(pe,f,ce),je(f,t[11]),w(pe,u,ce),Q(m,pe,ce),w(pe,g,ce),Q(v,pe,ce),w(pe,_,ce),Q(b,pe,ce),w(pe,k,ce),Q(y,pe,ce),w(pe,F,ce),w(pe,A,ce),w(pe,C,ce),d(C,D),d(C,$),d(C,V),d(V,z),d(C,q),d(C,L),w(pe,U,ce),je(U,t[12]),w(pe,W,ce),w(pe,R,ce),w(pe,N,ce),Q(Y,pe,ce),w(pe,_e,ce),d(_e,Fe),d(_e,he),d(he,ie),w(pe,le,ce),je(le,t[13]),w(pe,ge,ce),w(pe,be,ce),w(pe,Te,ce),w(pe,se,ce);for(let Oe=0;Oe<Ye.length;Oe+=1)Ye[Oe]&&Ye[Oe].m(pe,ce);w(pe,Ie,ce),K=!0,Re||(Ge=[H(f,"change",t[42]),H(f,"input",t[42]),H(U,"change",t[43]),H(U,"input",t[43]),H(U,"change",t[33]),H(le,"change",t[44]),H(le,"input",t[44])],Re=!0)},p(pe,ce){if((!K||ce[0]&2048)&&a!==(a=pe[11].toFixed(2)+"")&&G(c,a),ce[0]&2048&&je(f,pe[11]),(!K||ce[0]&4096)&&G(z,pe[12]),ce[0]&4096&&je(U,pe[12]),(!K||ce[0]&8192)&&G(ie,pe[13]),ce[0]&8192&&je(le,pe[13]),ce[0]&8|ce[1]&8){Qe=me(pe[3]);let Oe;for(Oe=0;Oe<Qe.length;Oe+=1){let oe=y6(pe,Qe,Oe);Ye[Oe]?Ye[Oe].p(oe,ce):(Ye[Oe]=F6(oe),Ye[Oe].c(),Ye[Oe].m(Ie.parentNode,Ie))}for(;Oe<Ye.length;Oe+=1)Ye[Oe].d(1);Ye.length=Qe.length}},i(pe){K||(S(m.$$.fragment,pe),S(v.$$.fragment,pe),S(b.$$.fragment,pe),S(y.$$.fragment,pe),S(Y.$$.fragment,pe),K=!0)},o(pe){E(m.$$.fragment,pe),E(v.$$.fragment,pe),E(b.$$.fragment,pe),E(y.$$.fragment,pe),E(Y.$$.fragment,pe),K=!1},d(pe){pe&&(x(e),x(n),x(o),x(f),x(u),x(g),x(_),x(k),x(F),x(A),x(C),x(U),x(W),x(R),x(N),x(_e),x(le),x(ge),x(be),x(Te),x(se),x(Ie)),Z(m,pe),Z(v,pe),Z(b,pe),Z(y,pe),Z(Y,pe),ot(Ye,pe),Re=!1,rt(Ge)}}}function OD(t){let e,n,o,s,i,r=P.ui.settings.fov+"",l,a,c,f,u,m,g=P.ui.settings.anisotropy+"",v,_,b,k,y,F=P.ui.settings.grass+"",A,C,M,D,$,V,z,q,L,U=P.ui.settings.disableoffscreen+"",W,R,N,Y,_e,Fe,he,ie,le,ge,be,Te=P.ui.settings.shadows+"",se,Ie,K,Re,Ge,Qe=P.ui.settings.shadowresolution+"",Ye,pe,ce,Oe,oe,ee,O;return V=new St({props:{store:Um}}),q=new St({props:{store:jm}}),Y=new St({props:{store:Om}}),Fe=new St({props:{store:Wm}}),ie=new St({props:{cb:t[33],store:Gm}}),Re=new St({props:{cb:t[33],store:Nm}}),{c(){e=h("div"),e.textContent=`${P.ui.settings.resolution}`,n=h("input"),o=h("div"),o.textContent=`${P.ui.settings.viewrange}`,s=h("input"),i=h("div"),l=T(r),a=Ne(),c=h("span"),f=T(t[7]),u=h("input"),m=h("div"),v=T(g),_=h("br"),b=h("small"),b.textContent=`${P.ui.settings.reload}`,k=h("input"),y=h("div"),A=T(F),C=h("br"),M=h("small"),M.textContent=`${P.ui.settings.reload}`,D=h("input"),$=h("div"),$.textContent=`${P.ui.settings.fxaa}`,J(V.$$.fragment),z=h("div"),z.textContent=`${P.ui.settings.bloom}`,J(q.$$.fragment),L=h("div"),W=T(U),R=h("br"),N=h("small"),N.textContent=`${P.ui.settings.offscreendesc}`,J(Y.$$.fragment),_e=h("div"),_e.textContent=`${P.ui.settings.particles}`,J(Fe.$$.fragment),he=h("div"),he.textContent=`${P.ui.settings.fogpattern}`,J(ie.$$.fragment),le=h("div"),le.textContent=`${P.ui.settings.shadows}`,ge=h("div"),be=h("div"),se=T(Te),Ie=h("br"),K=h("small"),K.textContent=`${P.ui.settings.reload}`,J(Re.$$.fragment),Ge=h("div"),Ye=T(Qe),pe=h("br"),ce=h("small"),ce.textContent=`${P.ui.settings.reload}`,Oe=h("input"),p(n,"type","range"),p(n,"min","30"),p(n,"step","10"),p(s,"type","range"),p(s,"min","30"),p(c,"class","textgrey"),p(u,"type","range"),p(u,"min","50"),p(u,"max","100"),p(b,"class","textgrey"),p(k,"type","range"),p(k,"min","0"),p(k,"max","4"),p(M,"class","textgrey"),p(D,"type","range"),p(D,"min","0"),p(D,"max","100"),p(N,"class","textgrey"),p(le,"class","textprimary"),p(K,"class","textgrey"),p(ce,"class","textgrey"),p(Oe,"type","range"),p(Oe,"min","0"),p(Oe,"max","3")},m(ue,We){w(ue,e,We),w(ue,n,We),je(n,t[5]),w(ue,o,We),w(ue,s,We),je(s,t[6]),w(ue,i,We),d(i,l),d(i,a),d(i,c),d(c,f),w(ue,u,We),je(u,t[7]),w(ue,m,We),d(m,v),d(m,_),d(m,b),w(ue,k,We),je(k,t[8]),w(ue,y,We),d(y,A),d(y,C),d(y,M),w(ue,D,We),je(D,t[9]),w(ue,$,We),Q(V,ue,We),w(ue,z,We),Q(q,ue,We),w(ue,L,We),d(L,W),d(L,R),d(L,N),Q(Y,ue,We),w(ue,_e,We),Q(Fe,ue,We),w(ue,he,We),Q(ie,ue,We),w(ue,le,We),w(ue,ge,We),w(ue,be,We),d(be,se),d(be,Ie),d(be,K),Q(Re,ue,We),w(ue,Ge,We),d(Ge,Ye),d(Ge,pe),d(Ge,ce),w(ue,Oe,We),je(Oe,t[10]),oe=!0,ee||(O=[H(n,"change",t[36]),H(n,"input",t[36]),H(s,"change",t[37]),H(s,"input",t[37]),H(u,"change",t[38]),H(u,"input",t[38]),H(k,"change",t[39]),H(k,"input",t[39]),H(k,"change",t[33]),H(D,"change",t[40]),H(D,"input",t[40]),H(D,"change",t[33]),H(Oe,"change",t[41]),H(Oe,"input",t[41]),H(Oe,"change",t[33])],ee=!0)},p(ue,We){We[0]&32&&je(n,ue[5]),We[0]&64&&je(s,ue[6]),(!oe||We[0]&128)&&G(f,ue[7]),We[0]&128&&je(u,ue[7]),We[0]&256&&je(k,ue[8]),We[0]&512&&je(D,ue[9]),We[0]&1024&&je(Oe,ue[10])},i(ue){oe||(S(V.$$.fragment,ue),S(q.$$.fragment,ue),S(Y.$$.fragment,ue),S(Fe.$$.fragment,ue),S(ie.$$.fragment,ue),S(Re.$$.fragment,ue),oe=!0)},o(ue){E(V.$$.fragment,ue),E(q.$$.fragment,ue),E(Y.$$.fragment,ue),E(Fe.$$.fragment,ue),E(ie.$$.fragment,ue),E(Re.$$.fragment,ue),oe=!1},d(ue){ue&&(x(e),x(n),x(o),x(s),x(i),x(u),x(m),x(k),x(y),x(D),x($),x(z),x(L),x(_e),x(he),x(le),x(ge),x(be),x(Ge),x(Oe)),Z(V,ue),Z(q,ue),Z(Y,ue),Z(Fe,ue),Z(ie,ue),Z(Re,ue),ee=!1,rt(O)}}}function M6(t){let e,n=t[71].name+"",o,s;return{c(){e=h("option"),o=T(n),e.__value=s=t[71].val,je(e,e.__value)},m(i,r){w(i,e,r),d(e,o)},p:ae,d(i){i&&x(e)}}}function F6(t){let e,n=t[68].name+"",o,s,i,r;function l(){t[45].call(s,t[68])}function a(...c){return t[46](t[68],...c)}return{c(){e=h("div"),o=T(n),s=h("input"),p(s,"type","text")},m(c,f){w(c,e,f),d(e,o),w(c,s,f),je(s,t[0].current[t[68].kb]),i||(r=[H(s,"input",l),H(s,"change",a)],i=!0)},p(c,f){t=c,f[0]&8&&n!==(n=t[68].name+"")&&G(o,n),f[0]&8&&s.value!==t[0].current[t[68].kb]&&je(s,t[0].current[t[68].kb])},d(c){c&&(x(e),x(s)),i=!1,rt(r)}}}function ND(t){let e,n,o,s,i=t[1].name+"",r,l,a,c,f,u=me(t[31]),m=[];for(let b=0;b<u.length;b+=1)m[b]=w6(k6(t,u,b));let g=[OD,UD,$D,BD,zD],v=[];function _(b,k){return b[1].id=="gfx"?0:b[1].id=="controls"?1:b[1].id=="audio"?2:b[1].id=="ui"?3:b[1].id=="chat"?4:-1}return~(a=_(t,[-1,-1,-1]))&&(c=v[a]=g[a](t)),{c(){e=h("div"),n=h("div");for(let b=0;b<m.length;b+=1)m[b].c();o=h("div"),s=h("h3"),r=T(i),l=h("div"),c&&c.c(),p(s,"class","textprimary"),p(l,"class","settings svelte-13nnce4"),p(o,"class","menu panel-black scrollbar svelte-13nnce4"),p(e,"class","divide svelte-13nnce4")},m(b,k){w(b,e,k),d(e,n);for(let y=0;y<m.length;y+=1)m[y]&&m[y].m(n,null);d(e,o),d(o,s),d(s,r),d(o,l),~a&&v[a].m(l,null),f=!0},p(b,k){if(k[0]&2|k[1]&1){u=me(b[31]);let F;for(F=0;F<u.length;F+=1){let A=k6(b,u,F);m[F]?m[F].p(A,k):(m[F]=w6(A),m[F].c(),m[F].m(n,null))}for(;F<m.length;F+=1)m[F].d(1);m.length=u.length}(!f||k[0]&2)&&i!==(i=b[1].name+"")&&G(r,i);let y=a;a=_(b,k),a===y?~a&&v[a].p(b,k):(c&&(we(),E(v[y],1,1,()=>{v[y]=null}),Me()),~a?(c=v[a],c?c.p(b,k):(c=v[a]=g[a](b),c.c()),S(c,1),c.m(l,null)):c=null)},i(b){f||(S(c),f=!0)},o(b){E(c),f=!1},d(b){b&&x(e),ot(m,b),~a&&v[a].d()}}}function jD(t){let e,n,o=t[4]&&x6(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,i){s[4]?o?(o.p(s,i),i[0]&16&&S(o,1)):(o=x6(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function WD(t,e,n){let o,s,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A,C,M,D,$,V,z,q,L,U;re(t,Qr,ye=>n(4,o=ye)),re(t,Wr,ye=>n(5,s=ye)),re(t,Nr,ye=>n(6,i=ye)),re(t,jr,ye=>n(7,r=ye)),re(t,rf,ye=>n(8,l=ye)),re(t,of,ye=>n(9,a=ye)),re(t,sf,ye=>n(10,c=ye)),re(t,Ff,ye=>n(11,f=ye)),re(t,el,ye=>n(12,u=ye)),re(t,Cf,ye=>n(13,m=ye)),re(t,Gr,ye=>n(14,g=ye)),re(t,Hr,ye=>n(15,v=ye)),re(t,af,ye=>n(16,_=ye)),re(t,lf,ye=>n(17,b=ye)),re(t,Yr,ye=>n(18,k=ye)),re(t,df,ye=>n(19,y=ye)),re(t,vf,ye=>n(20,F=ye)),re(t,gf,ye=>n(21,A=ye)),re(t,yf,ye=>n(22,C=ye)),re(t,kf,ye=>n(23,M=ye)),re(t,xf,ye=>n(24,D=ye)),re(t,wf,ye=>n(25,$=ye)),re(t,Kr,ye=>n(26,V=ye)),re(t,_f,ye=>n(27,z=ye)),re(t,Xr,ye=>n(28,q=ye)),re(t,Qi,ye=>n(29,L=ye)),re(t,Zi,ye=>n(30,U=ye));let W=[{id:"ui",name:P.ui.settings.interface},{id:"gfx",name:P.ui.settings.graphics},{id:"controls",name:P.ui.settings.controls},{id:"chat",name:P.ui.settings.chat},{id:"audio",name:P.ui.settings.audio}],R=W[0],N=[{val:"en",name:"English"},{val:"de",name:"German"},{val:"ru",name:"Russian"},{val:"zh",name:"Chinese"},{val:"pt",name:"Portugese"},{val:"es",name:"Spanish"},{val:"fr",name:"French"},{val:"ro",name:"Romanian"},{val:"it",name:"Italian"},{val:"nl",name:"Dutch"},{val:"vi",name:"Vietnamese"},{val:"hu",name:"Hungarian"},{val:"ro",name:"Romanian"},{val:"cs",name:"Czech"},{val:"pl",name:"Polish"}],Y=!1,_e=()=>{n(2,Y=!0)},Fe=(ye,Vt)=>{Vt.set(ye===""?void 0:ye),n(2,Y=!0)},he=["Forward","Left","Back","Right","TurnLeft","TurnRight","Map","Skills","Character","Inventory","Clan","Pvp","Party","Social","NextTarget","NextParty","Untarget"],ie=["Forward","Left","Back","Right","Turn Left","Turn Right","Map","Skills","Character","Inventory","Clan","Pvp","Party","Social","Target Next Enemy","Target Next Friendly","Untarget"];for(let ye=1;ye<25;++ye)he.push("Skillbar"+ye);he=he.map((ye,Vt)=>({name:ie[Vt]||ye,kb:"kb"+ye,setting:Zs["kb"+ye]}));let le=(ye,Vt)=>{n(1,R=ye)};function ge(){s=Gt(this.value),Wr.set(s)}function be(){i=Gt(this.value),Nr.set(i)}function Te(){r=Gt(this.value),jr.set(r)}function se(){l=Gt(this.value),rf.set(l)}function Ie(){a=Gt(this.value),of.set(a)}function K(){c=Gt(this.value),sf.set(c)}function Re(){f=Gt(this.value),Ff.set(f)}function Ge(){u=Gt(this.value),el.set(u)}function Qe(){m=Gt(this.value),Cf.set(m)}function Ye(ye){fe[ye.kb]=this.value,n(0,Zs)}let pe=(ye,Vt)=>{Fe(fe[ye.kb],ye.setting)};function ce(){g=Gt(this.value),Gr.set(g)}function Oe(){v=Gt(this.value),Hr.set(v)}function oe(){_=Gt(this.value),af.set(_)}function ee(){b=Gt(this.value),lf.set(b)}function O(){k=Co(this),Yr.set(k),n(32,N)}let ue=ye=>wi.set(0),We=ye=>wi.set(ko.length);function ze(){y=Gt(this.value),df.set(y)}function Ae(){F=Gt(this.value),vf.set(F)}function $e(){A=this.value,gf.set(A)}function Ue(){C=Gt(this.value),yf.set(C)}function mt(){M=Gt(this.value),kf.set(M)}function wt(){D=Gt(this.value),xf.set(D)}function Je(){$=Gt(this.value),wf.set($)}function Et(){V=Gt(this.value),Kr.set(V)}function xe(){z=Gt(this.value),_f.set(z)}function Ke(){q=Gt(this.value),Xr.set(q)}function bt(){L=Gt(this.value),Qi.set(L)}function Ct(){U=Gt(this.value),Zi.set(U)}return[Zs,R,Y,he,o,s,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A,C,M,D,$,V,z,q,L,U,W,N,_e,Fe,le,ge,be,Te,se,Ie,K,Re,Ge,Qe,Ye,pe,ce,Oe,oe,ee,O,ue,We,ze,Ae,$e,Ue,mt,wt,Je,Et,xe,Ke,bt,Ct,()=>{Xe(Qr,o=!1,o),Y&&window.location.reload()}]}var ov=class extends Ce{constructor(e){super(),Pe(this,e,WD,jD,Be,{},null,[-1,-1,-1])}},C6=ov;function S6(t,e,n){let o=t.slice();return o[39]=e[n],o}function P6(t,e,n){let o=t.slice();return o[39]=e[n],o}function A6(t,e,n){let o=t.slice();return o[44]=e[n],o[46]=n,o}function T6(t,e,n){let o=t.slice();return o[47]=e[n],o}function E6(t){let e,n;return e=new $t({props:{origin:"center",title:P.ui.headers.skills,settings:[{name:"Preset Manager",fun:t[31]}],icon:"book",$$slots:{default:[iV]},$$scope:{ctx:t}}}),e.$on("close",t[32]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s[0]&4096&&(i.settings=[{name:"Preset Manager",fun:o[31]}]),s[0]&6143|s[1]&524288&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function I6(t){let e,n;function o(r,l){return r[6]===void 0?HD:GD}let s=o(t,[-1,-1]),i=s(t);return{c(){e=h("div"),i.c(),p(e,"class",n="panel-black "+(t[6]===void 0?"bar-top-config":"bar-top-save")+" svelte-1e0alkc")},m(r,l){w(r,e,l),i.m(e,null)},p(r,l){s===(s=o(r,l))&&i?i.p(r,l):(i.d(1),i=s(r),i&&(i.c(),i.m(e,null))),l[0]&64&&n!==(n="panel-black "+(r[6]===void 0?"bar-top-config":"bar-top-save")+" svelte-1e0alkc")&&p(e,"class",n)},d(r){r&&x(e),i.d()}}}function GD(t){let e,n,o,s,i,r,l;return{c(){e=h("div"),n=h("input"),o=h("div"),o.textContent="Save",s=h("div"),s.textContent="Cancel",i=h("div"),p(n,"placeholder","Enter Preset Name"),p(n,"maxlength","25"),p(o,"class","btn green"),p(s,"class","btn orange")},m(a,c){w(a,e,c),w(a,n,c),je(n,t[6]),w(a,o,c),w(a,s,c),w(a,i,c),r||(l=[H(n,"input",t[25]),H(o,"click",t[15]),H(s,"click",t[26])],r=!0)},p(a,c){c[0]&64&&n.value!==a[6]&&je(n,a[6])},d(a){a&&(x(e),x(n),x(o),x(s),x(i)),r=!1,rt(l)}}}function HD(t){let e,n,o,s,i,r,l,a,c,f,u,m,g=me(t[10].filter(t[21])),v=[];for(let b=0;b<g.length;b+=1)v[b]=D6(T6(t,g,b));let _=t[7]===void 0&&V6(t);return{c(){e=h("span"),e.textContent="Preset:",n=h("select");for(let b=0;b<v.length;b+=1)v[b].c();o=de(),_&&_.c(),i=h("div"),r=T("Save"),a=h("div"),c=T("Delete"),p(e,"class","btn textprimary"),p(n,"class",s="btn grey "+(t[10].filter(t[22]).length===0?"disabled":"")),t[7]===void 0&&bn(()=>t[23].call(n)),p(i,"class",l="btn grey "+(t[5]?"":"disabled")),p(a,"class",f="btn grey "+(t[7]!==void 0?"":"disabled"))},m(b,k){w(b,e,k),w(b,n,k);for(let y=0;y<v.length;y+=1)v[y]&&v[y].m(n,null);d(n,o),_&&_.m(n,null),Mn(n,t[7],!0),w(b,i,k),d(i,r),w(b,a,k),d(a,c),u||(m=[H(n,"change",t[23]),H(n,"change",t[16]),H(i,"click",t[24]),H(a,"click",t[17])],u=!0)},p(b,k){if(k[0]&1024){g=me(b[10].filter(b[21]));let y;for(y=0;y<g.length;y+=1){let F=T6(b,g,y);v[y]?v[y].p(F,k):(v[y]=D6(F),v[y].c(),v[y].m(n,o))}for(;y<v.length;y+=1)v[y].d(1);v.length=g.length}b[7]===void 0?_?_.p(b,k):(_=V6(b),_.c(),_.m(n,null)):_&&(_.d(1),_=null),k[0]&1024&&s!==(s="btn grey "+(b[10].filter(b[22]).length===0?"disabled":""))&&p(n,"class",s),k[0]&1152&&Mn(n,b[7]),k[0]&32&&l!==(l="btn grey "+(b[5]?"":"disabled"))&&p(i,"class",l),k[0]&1152&&f!==(f="btn grey "+(b[7]!==void 0?"":"disabled"))&&p(a,"class",f)},d(b){b&&(x(e),x(n),x(i),x(a)),ot(v,b),_&&_.d(),u=!1,rt(m)}}}function D6(t){let e,n=t[47].name+"",o,s;return{c(){e=h("option"),o=T(n),e.__value=s=t[47].name,je(e,e.__value)},m(i,r){w(i,e,r),d(e,o)},p(i,r){r[0]&1024&&n!==(n=i[47].name+"")&&G(o,n),r[0]&1024&&s!==(s=i[47].name)&&(e.__value=s,je(e,e.__value))},d(i){i&&x(e)}}}function V6(t){let e,n;return{c(){e=h("option"),n=T("No Preset"),e.disabled=!0,e.selected=!0,e.__value=void 0,je(e,e.__value)},m(o,s){w(o,e,s),d(e,n)},p:ae,d(o){o&&x(e)}}}function YD(t){let e,n;return e=new kl({props:{level:Math.max(1,t[39].level),skill:At.get(t[39].id)}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s[0]&8&&(i.level=Math.max(1,o[39].level)),s[0]&8&&(i.skill=At.get(o[39].id)),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function XD(t){let e;return{c(){e=h("div"),e.textContent=`${P.ui.default}`,p(e,"class","textgrey")},m(n,o){w(n,e,o)},p:ae,d(n){n&&x(e)}}}function QD(t){let e,n=me(Array(At.get(t[39].id).skilllevels)),o=[];for(let s=0;s<n.length;s+=1)o[s]=L6(A6(t,n,s));return{c(){e=h("div");for(let s=0;s<o.length;s+=1)o[s].c();p(e,"class","skillpoints svelte-1e0alkc")},m(s,i){w(s,e,i);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,null)},p(s,i){if(i[0]&24){n=me(Array(At.get(s[39].id).skilllevels));let r;for(r=0;r<n.length;r+=1){let l=A6(s,n,r);o[r]?o[r].p(l,i):(o[r]=L6(l),o[r].c(),o[r].m(e,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(s){s&&x(e),ot(o,s)}}}function ZD(t){let e;return{c(){e=h("div"),p(e,"class","border grey")},m(n,o){w(n,e,o)},p:ae,d(n){n&&x(e)}}}function JD(t){let e;return{c(){e=h("div"),p(e,"class","btn incbtn grey svelte-1e0alkc")},m(n,o){w(n,e,o)},p:ae,d(n){n&&x(e)}}}function KD(t){let e,n;return{c(){e=h("div"),p(e,"class",n="btn incbtn "+(t[4]?"green":"white")+" svelte-1e0alkc")},m(o,s){w(o,e,s)},p(o,s){s[0]&16&&n!==(n="btn incbtn "+(o[4]?"green":"white")+" svelte-1e0alkc")&&p(e,"class",n)},d(o){o&&x(e)}}}function L6(t){let e;function n(i,r){return i[46]+1<=i[39].level?KD:i[46]+1<=i[39].learned?JD:ZD}let o=n(t,[-1,-1]),s=o(t);return{c(){s.c(),e=de()},m(i,r){s.m(i,r),w(i,e,r)},p(i,r){o===(o=n(i,r))&&s?s.p(i,r):(s.d(1),s=o(i),s&&(s.c(),s.m(e.parentNode,e)))},d(i){i&&x(e),s.d(i)}}}function eV(t){let e;return{c(){e=h("div"),p(e,"class","name svelte-1e0alkc")},m(n,o){w(n,e,o)},p:ae,d(n){n&&x(e)}}}function tV(t){let e,n,o,s=t[39].level+"",i;return{c(){e=h("div"),n=T("Lv. "),o=h("span"),i=T(s),p(o,"class","bold textwhite"),p(e,"class","name svelte-1e0alkc")},m(r,l){w(r,e,l),d(e,n),d(e,o),d(o,i)},p(r,l){l[0]&8&&s!==(s=r[39].level+"")&&G(i,s)},d(r){r&&x(e)}}}function q6(t){let e,n,o,s,i,r,l;function a(...m){return t[27](t[39],...m)}function c(m,g){return g[0]&520&&(i=null),i==null&&(i=m[9]>=At.get(m[39].id).skillpoints&&m[39].level<At.get(m[39].id).skilllevels&&m[39].level<m[39].learned),i?oV:nV}let f=c(t,[-1,-1]),u=f(t);return{c(){e=h("div"),n=h("div"),o=T("-"),u.c(),p(n,"class",s="btn incbtn "+(t[39].level>0?"grey":"black disabled")+" svelte-1e0alkc"),p(e,"class","skillpoints svelte-1e0alkc")},m(m,g){w(m,e,g),d(e,n),d(n,o),u.m(e,null),r||(l=H(n,"click",a),r=!0)},p(m,g){t=m,g[0]&8&&s!==(s="btn incbtn "+(t[39].level>0?"grey":"black disabled")+" svelte-1e0alkc")&&p(n,"class",s),f===(f=c(t,g))&&u?u.p(t,g):(u.d(1),u=f(t),u&&(u.c(),u.m(e,null)))},d(m){m&&x(e),u.d(),r=!1,l()}}}function nV(t){let e;return{c(){e=h("div"),e.textContent="+",p(e,"class","btn incbtn black disabled svelte-1e0alkc")},m(n,o){w(n,e,o)},p:ae,d(n){n&&x(e)}}}function oV(t){let e,n,o;function s(...i){return t[28](t[39],...i)}return{c(){e=h("div"),e.textContent="+",p(e,"id","tutsetskillpoint"),p(e,"class","btn incbtn green svelte-1e0alkc")},m(i,r){w(i,e,r),n||(o=H(e,"click",s),n=!0)},p(i,r){t=i},d(i){i&&x(e),n=!1,o()}}}function R6(t){let e,n,o,s,i=P.items.book[t[39].id].name+"",r,l,a,c,f;n=new bl({props:{descPos:"left:100%;top:0;",descRoot:t[2],border:"white",data:{},pickable:t[39].pickable,meta:{type:"skill",skill:At.get(t[39].id)},css:"slotskill",img:`/data/ui/skills/${t[39].id}.${Yn}?v=8738303`,$$slots:{default:[YD]},$$scope:{ctx:t}}});function u(y,F){return y[39].engineOnly?XD:QD}let m=u(t,[-1,-1]),g=m(t);function v(y,F){return y[39].engineOnly?eV:tV}let _=v(t,[-1,-1]),b=_(t),k=!t[39].engineOnly&&q6(t);return{c(){e=h("div"),J(n.$$.fragment),o=h("div"),s=h("div"),r=T(i),l=Ne(),g.c(),a=h("div"),b.c(),c=de(),k&&k.c(),p(s,"class","textprimary name svelte-1e0alkc"),p(e,"class","panel-bright skillbox svelte-1e0alkc")},m(y,F){w(y,e,F),Q(n,e,null),d(e,o),d(o,s),d(s,r),d(o,l),g.m(o,null),d(e,a),b.m(a,null),d(a,c),k&&k.m(a,null),f=!0},p(y,F){let A={};F[0]&4&&(A.descRoot=y[2]),F[0]&8&&(A.pickable=y[39].pickable),F[0]&8&&(A.meta={type:"skill",skill:At.get(y[39].id)}),F[0]&8&&(A.img=`/data/ui/skills/${y[39].id}.${Yn}?v=8738303`),F[0]&8|F[1]&524288&&(A.$$scope={dirty:F,ctx:y}),n.$set(A),(!f||F[0]&8)&&i!==(i=P.items.book[y[39].id].name+"")&&G(r,i),m===(m=u(y,F))&&g?g.p(y,F):(g.d(1),g=m(y),g&&(g.c(),g.m(o,null))),_===(_=v(y,F))&&b?b.p(y,F):(b.d(1),b=_(y),b&&(b.c(),b.m(a,c))),y[39].engineOnly?k&&(k.d(1),k=null):k?k.p(y,F):(k=q6(y),k.c(),k.m(a,null))},i(y){f||(S(n.$$.fragment,y),f=!0)},o(y){E(n.$$.fragment,y),f=!1},d(y){y&&x(e),Z(n),g.d(),b.d(),k&&k.d()}}}function sV(t){let e,n;return e=new kl({props:{level:1,skill:t[39]}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s[0]&1&&(i.skill=o[39]),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function z6(t){let e,n,o,s,i=P.items.book[t[39].id].name+"",r,l,a=P.ui.learnable+"",c,f,u=t[39].minlevel+"",m,g;return n=new bl({props:{descPos:"left:100%;top:0;",descRoot:t[2],border:"grey filtered",data:{},pickable:!1,meta:{type:"skill",skill:t[39]},css:"slotskill",img:`/data/ui/skills/${t[39].id}.${Yn}?v=8738303`,$$slots:{default:[sV]},$$scope:{ctx:t}}}),{c(){e=h("div"),J(n.$$.fragment),o=h("div"),s=h("div"),r=T(i),l=h("div"),c=T(a),f=Ne(),m=T(u),p(s,"class","name svelte-1e0alkc"),p(o,"class","textgrey"),p(e,"class","panel-bright skillbox svelte-1e0alkc")},m(v,_){w(v,e,_),Q(n,e,null),d(e,o),d(o,s),d(s,r),d(o,l),d(l,c),d(l,f),d(l,m),g=!0},p(v,_){let b={};_[0]&4&&(b.descRoot=v[2]),_[0]&1&&(b.meta={type:"skill",skill:v[39]}),_[0]&1&&(b.img=`/data/ui/skills/${v[39].id}.${Yn}?v=8738303`),_[0]&1|_[1]&524288&&(b.$$scope={dirty:_,ctx:v}),n.$set(b),(!g||_[0]&1)&&i!==(i=P.items.book[v[39].id].name+"")&&G(r,i),(!g||_[0]&1)&&u!==(u=v[39].minlevel+"")&&G(m,u)},i(v){g||(S(n.$$.fragment,v),g=!0)},o(v){E(n.$$.fragment,v),g=!1},d(v){v&&x(e),Z(n)}}}function iV(t){let e,n,o,s,i,r=(t[1]?t[1]:`${P.ui.stats.array[23]}: ${t[8]}`)+"",l,a,c,f,u,m,g,v,_,b=t[12]&&I6(t),k=me(t[3]),y=[];for(let D=0;D<k.length;D+=1)y[D]=R6(P6(t,k,D));let F=D=>E(y[D],1,1,()=>{y[D]=null}),A=me(Array.from(At.values()).filter(t[29]).sort(B6)),C=[];for(let D=0;D<A.length;D+=1)C[D]=z6(S6(t,A,D));let M=D=>E(C[D],1,1,()=>{C[D]=null});return{c(){e=h("div"),b&&b.c(),n=h("div");for(let D=0;D<y.length;D+=1)y[D].c();o=de();for(let D=0;D<C.length;D+=1)C[D].c();s=h("div"),i=h("span"),l=T(r),c=h("div"),f=T("Activate Skills"),m=h("span"),p(n,"id","skilllist"),p(n,"class","scrollbar panel-black skilllist svelte-1e0alkc"),p(i,"class",a=t[1]?"textred":t[8]>0?"textprimary":"textgrey"),p(c,"id","tutapplyskills"),p(c,"class",u="btn "+(t[4]?"green":"grey disabled")),p(s,"class","panel-black bar-bot svelte-1e0alkc"),p(e,"class","flexer svelte-1e0alkc")},m(D,$){w(D,e,$),b&&b.m(e,null),d(e,n);for(let V=0;V<y.length;V+=1)y[V]&&y[V].m(n,null);d(n,o);for(let V=0;V<C.length;V+=1)C[V]&&C[V].m(n,null);d(e,s),d(s,i),d(i,l),d(s,c),d(c,f),d(s,m),t[30](e),g=!0,v||(_=H(c,"click",t[13]),v=!0)},p(D,$){if(D[12]?b?b.p(D,$):(b=I6(D),b.c(),b.m(e,n)):b&&(b.d(1),b=null),$[0]&16924){k=me(D[3]);let V;for(V=0;V<k.length;V+=1){let z=P6(D,k,V);y[V]?(y[V].p(z,$),S(y[V],1)):(y[V]=R6(z),y[V].c(),S(y[V],1),y[V].m(n,o))}for(we(),V=k.length;V<y.length;V+=1)F(V);Me()}if($[0]&5){A=me(Array.from(At.values()).filter(D[29]).sort(B6));let V;for(V=0;V<A.length;V+=1){let z=S6(D,A,V);C[V]?(C[V].p(z,$),S(C[V],1)):(C[V]=z6(z),C[V].c(),S(C[V],1),C[V].m(n,null))}for(we(),V=A.length;V<C.length;V+=1)M(V);Me()}(!g||$[0]&258)&&r!==(r=(D[1]?D[1]:`${P.ui.stats.array[23]}: ${D[8]}`)+"")&&G(l,r),(!g||$[0]&258&&a!==(a=D[1]?"textred":D[8]>0?"textprimary":"textgrey"))&&p(i,"class",a),(!g||$[0]&16&&u!==(u="btn "+(D[4]?"green":"grey disabled")))&&p(c,"class",u)},i(D){if(!g){for(let $=0;$<k.length;$+=1)S(y[$]);for(let $=0;$<A.length;$+=1)S(C[$]);g=!0}},o(D){y=y.filter(Boolean);for(let $=0;$<y.length;$+=1)E(y[$]);C=C.filter(Boolean);for(let $=0;$<C.length;$+=1)E(C[$]);g=!1},d(D){D&&x(e),b&&b.d(),ot(y,D),ot(C,D),t[30](null),v=!1,_()}}}function rV(t){let e,n,o=t[11]&&E6(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,i){s[11]?o?(o.p(s,i),i[0]&2048&&S(o,1)):(o=E6(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}var B6=(t,e)=>t.minlevel-e.minlevel;function lV(t,e,n){let o,s,i,r,l,a,c,f,u;re(t,Gc,se=>n(0,i=se)),re(t,Ca,se=>n(10,r=se)),re(t,Hi,se=>n(19,l=se)),re(t,Hc,se=>n(1,a=se)),re(t,ji,se=>n(20,c=se)),re(t,vi,se=>n(11,f=se)),re(t,Mf,se=>n(12,u=se));let m,g=se=>{let Ie=[];return se.forEach((K,Re)=>{for(let Ge=0;Ge<K.level;++Ge)Ie.push(K.id)}),Ie},v=()=>{let se=A.filter(Ie=>!At.get(Ie)?.engineOnly);yt("skillconfig",se),n(4,b=!1),Xe(Hc,a=void 0,a),an(25,100)},_=[],b=!1,k=!1,y=(se,Ie)=>{n(3,_=[]),se.forEach((K,Re)=>{let Ge=At.get(Re);_.push({id:Re,level:K,minlevel:Ge.minlevel,learned:Ie.get(Re)||0,engineOnly:Ge.engineOnly,pickable:Ge.onCast!==void 0})}),Ie.forEach((K,Re)=>{if(!se.has(Re)){let Ge=At.get(Re);_.push({id:Re,level:0,minlevel:Ge.minlevel,learned:K,engineOnly:Ge.engineOnly,pickable:Ge.onCast!==void 0})}}),_.sort((K,Re)=>K.id-Re.id)},F=()=>{C=g(_);let se=C.filter(Ie=>!At.get(Ie)?.engineOnly);n(18,M=sg(se))},A=[],C=[],M=0,D=(se,Ie)=>{se.level+=Ie,n(3,_),an(24,100),$()},$=()=>{A=g(_);let se=A.filter(Ge=>!At.get(Ge)?.engineOnly);n(18,M=sg(se));let Ie=A.sort().join(","),K=C.sort().join(",");n(4,b=A.length&&Ie!==K);let Re=r.find(Ge=>Ie===Ge.skills.sort().join(","));Re?(n(7,q=Re.name),n(5,k=!1)):(n(7,q=void 0),n(5,k=!0))},V,z=()=>{V!==void 0&&(Ca.update(se=>(se=se.filter(Ie=>Ie.name!==V||Ie.pclass!==I.player.class),se.push({name:V,skills:g(_),pclass:I.player.class}),se)),n(7,q=V),n(6,V=void 0),n(5,k=!1))},q,L=se=>{let Ie=r.find(K=>K.name===q&&K.pclass===I.player.class);if(Ie){let K=new Map;Ie.skills.forEach(Re=>{K.has(Re)?K.set(Re,K.get(Re)+1):K.set(Re,1)}),y(K,i),$(),b&&v()}},U=()=>{Ca.update(se=>se.filter(Ie=>Ie.name!==q)),n(7,q=void 0),n(5,k=!0)},W=se=>se.pclass===I.player.class,R=se=>se.pclass===I.player.class;function N(){q=Co(this),n(7,q)}let Y=se=>n(6,V="");function _e(){V=this.value,n(6,V)}let Fe=se=>n(6,V=void 0),he=(se,Ie)=>D(se,-1),ie=(se,Ie)=>D(se,1),le=se=>se.class===I.player.class&&!se.engineOnly&&!i.has(se.id);function ge(se){qt[se?"unshift":"push"](()=>{m=se,n(2,m)})}let be=()=>{Xe(Mf,u=!u,u)},Te=()=>{Xe(vi,f=!1,f)};return t.$$.update=()=>{t.$$.dirty[0]&1048577&&(y(c,i),F(),$()),t.$$.dirty[0]&2&&a&&n(4,b=!0),t.$$.dirty[0]&786432&&n(9,o=l[24]-M),t.$$.dirty[0]&786432&&n(8,s=l[24]-M)},[i,a,m,_,b,k,V,q,s,o,r,f,u,v,D,z,L,U,M,l,c,W,R,N,Y,_e,Fe,he,ie,le,ge,be,Te]}var sv=class extends Ce{constructor(e){super(),Pe(this,e,lV,rV,Be,{},null,[-1,-1])}},$6=sv;function U6(t,e,n){let o=t.slice();return o[19]=e[n],o[21]=n,o}function O6(t){let e,n,o=me(t[1]),s=[];for(let r=0;r<o.length;r+=1)s[r]=j6(U6(t,o,r));let i=null;return o.length||(i=N6(t)),{c(){e=h("div");for(let r=0;r<s.length;r+=1)s[r].c();n=de(),i&&i.c(),p(e,"class","divider")},m(r,l){w(r,e,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(r,l);w(r,n,l),i&&i.m(r,l)},p(r,l){if(l&74){o=me(r[1]);let a;for(a=0;a<o.length;a+=1){let c=U6(r,o,a);s[a]?s[a].p(c,l):(s[a]=j6(c),s[a].c(),s[a].m(n.parentNode,n))}for(;a<s.length;a+=1)s[a].d(1);s.length=o.length,!o.length&&i?i.p(r,l):o.length?i&&(i.d(1),i=null):(i=N6(r),i.c(),i.m(n.parentNode,n))}},d(r){r&&(x(e),x(n)),ot(s,r),i&&i.d(r)}}}function N6(t){let e;return{c(){e=h("div"),e.textContent="No results",p(e,"class","textgrey result svelte-17jb1r5")},m(n,o){w(n,e,o)},p:ae,d(n){n&&x(e)}}}function j6(t){let e,n,o=t[19].name+"",s,i,r=t[19].type+"",l,a,c,f=(t[19].level||1)+"",u,m,g,v;function _(...b){return t[14](t[21],...b)}return{c(){e=h("div"),n=h("span"),s=T(o),i=h("span"),l=T(r),a=h("span"),c=T("Lv. "),u=T(f),p(i,"class","textgrey infocol svelte-17jb1r5"),p(a,"class","infocol svelte-17jb1r5"),p(e,"class",m="result "+(t[21]===t[3]?"sel":"")+" svelte-17jb1r5")},m(b,k){w(b,e,k),d(e,n),d(n,s),d(e,i),d(i,l),d(e,a),d(a,c),d(a,u),g||(v=H(e,"mousedown",_),g=!0)},p(b,k){t=b,k&2&&o!==(o=t[19].name+"")&&G(s,o),k&2&&r!==(r=t[19].type+"")&&G(l,r),k&2&&f!==(f=(t[19].level||1)+"")&&G(u,f),k&8&&m!==(m="result "+(t[21]===t[3]?"sel":"")+" svelte-17jb1r5")&&p(e,"class",m)},d(b){b&&x(e),g=!1,v()}}}function aV(t){let e,n,o,s,i,r,l,a=t[2]&&O6(t);return{c(){e=h("div"),n=h("div"),o=h("input"),a&&a.c(),p(o,"placeholder",s=P.ui.merchant.itemSearch),p(o,"type","search"),p(n,"class",i="container input "+(t[2]?"focus":"")),p(e,"class","navbtn finder")},m(c,f){w(c,e,f),d(e,n),d(n,o),t[11](o),je(o,t[0]),a&&a.m(n,null),r||(l=[H(o,"input",t[12]),H(o,"input",t[5]),H(o,"focus",t[13]),H(o,"blur",t[7])],r=!0)},p(c,[f]){f&1&&o.value!==c[0]&&je(o,c[0]),c[2]?a?a.p(c,f):(a=O6(c),a.c(),a.m(n,null)):a&&(a.d(1),a=null),f&4&&i!==(i="container input "+(c[2]?"focus":""))&&p(n,"class",i)},i:ae,o:ae,d(c){c&&x(e),t[11](null),a&&a.d(),r=!1,rt(l)}}}function cV(t,e,n){let o=ci(),s=cr.filter(M=>M.level<=45||M.type==="rune"&&M.tier===5).map(M=>({name:nn(M.type,M.tier),type:M.type,tier:M.tier,level:M.level})),i=()=>{let M=a.toLowerCase();M.length?n(1,f=s.filter(D=>D.type===M||D.name.toLowerCase().includes(M)).slice(0,c)):n(1,f=[]),m>=f.length&&_(f.length-1)},{type:r}=e,{tier:l}=e,{name:a=""}=e,{limit:c=5}=e,f=[],u=!1,m=-1,g,v,_=M=>{n(3,m=M),m>=0?(g=f[m],n(0,a=g.name),n(8,r=g.type),n(9,l=g.tier)):(g=void 0,n(0,a=""),n(8,r="all"),n(9,l="all"))},b=M=>{M.target==v&&((M.keyCode===38||M.keyCode===40)&&f.length?(_(Pa(m+(M.keyCode===38?-1:1),f.length)),M.preventDefault()):(M.keyCode==13||M.keyCode==27)&&v.blur())},k=M=>{n(2,u=!1),_(Math.min(Math.max(0,m),f.length-1)),m>=0&&o("finalize")};Fn(()=>{document.addEventListener("keydown",b)}),Tn(()=>{document.removeEventListener("keydown",b),n(4,v=void 0)});function y(M){qt[M?"unshift":"push"](()=>{v=M,n(4,v)})}function F(){a=this.value,n(0,a)}let A=M=>n(2,u=!0),C=(M,D)=>_(M);return t.$$set=M=>{"type"in M&&n(8,r=M.type),"tier"in M&&n(9,l=M.tier),"name"in M&&n(0,a=M.name),"limit"in M&&n(10,c=M.limit)},[a,f,u,m,v,i,_,k,r,l,c,y,F,A,C]}var iv=class extends Ce{constructor(e){super(),Pe(this,e,cV,aV,Be,{type:8,tier:9,name:0,limit:10})}},W6=iv;var G6=t=>9+Math.ceil(t*.001);function H6(t,e,n){let o=t.slice();return o[55]=e[n],o}function Y6(t,e,n){let o=t.slice();return o[58]=e[n],o[60]=n,o}function X6(t){let e,n;return e=new $t({props:{origin:"left top",defaultOffset:[0,100],title:"Merchant",$$slots:{default:[gV]},$$scope:{ctx:t}}}),e.$on("close",t[50]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s[0]&2097135|s[1]&1073741824&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function fV(t){let e,n=t[58]+"",o,s,i,r;function l(...a){return t[44](t[58],...a)}return{c(){e=h("div"),o=T(n),p(e,"class",s="choice "+(t[58]==t[6]?"active":"")+" svelte-35lzg4")},m(a,c){w(a,e,c),d(e,o),i||(r=H(e,"click",l),i=!0)},p(a,c){t=a,c[0]&64&&s!==(s="choice "+(t[58]==t[6]?"active":"")+" svelte-35lzg4")&&p(e,"class",s)},d(a){a&&x(e),i=!1,r()}}}function uV(t){let e;return{c(){e=h("div"),p(e,"class","divider svelte-35lzg4")},m(n,o){w(n,e,o)},p:ae,d(n){n&&x(e)}}}function Q6(t){let e;function n(i,r){return i[58]===null?uV:fV}let s=n(t,[-1,-1])(t);return{c(){s.c(),e=de()},m(i,r){s.m(i,r),w(i,e,r)},p(i,r){s.p(i,r)},d(i){i&&x(e),s.d(i)}}}function Z6(t){let e,n,o,s=nn(t[55].temp.type,t[55].temp.tier)+"",i,r,l,a=(t[55].temp.logic.level||1)+"",c,f,u,m=t[55].temp.owner+"",g,v,_=t[27](t[55].temp.auction.getTime())+"",b,k,y,F=t[13]&&t[55].temp.stacks>0?t[55].temp.stacks+" x ":"",A,C,M,D,$,V;n=new Mo({props:{shift:t[20],descPos:"right:0;top:0;",descRoot:t[5],pickable:!1,item:t[55]}}),C=new xn({props:{amount:t[13]&&t[55].temp.stacks>0?Math.ceil(t[55].temp.auctionprice/t[55].temp.stacks):t[55].temp.auctionprice}});function z(...q){return t[47](t[55],...q)}return{c(){e=h("div"),J(n.$$.fragment),o=h("span"),i=T(s),l=h("span"),c=T(a),u=h("span"),g=T(m),v=h("span"),b=T(_),k=h("div"),y=h("span"),A=T(F),J(C.$$.fragment),p(o,"class",r="marg text"+jt(t[55].temp.quality)[0]+" svelte-35lzg4"),Le(o,"margin-left","6px"),p(l,"class",f="marg "+(I.player.level>=t[55].temp.logic.level?"textgreen":"textred")+" svelte-35lzg4"),p(u,"class","marg svelte-35lzg4"),p(v,"class","marg svelte-35lzg4"),p(y,"class","textgreen"),p(k,"class","marg svelte-35lzg4"),Le(k,"text-align","end"),p(e,"class",M="buy "+(t[18]==t[55]?"selected":"")+" item panel-black svelte-35lzg4")},m(q,L){w(q,e,L),Q(n,e,null),d(e,o),d(o,i),d(e,l),d(l,c),d(e,u),d(u,g),d(e,v),d(v,b),d(e,k),d(k,y),d(y,A),Q(C,k,null),D=!0,$||(V=H(e,"click",z),$=!0)},p(q,L){t=q;let U={};L[0]&1048576&&(U.shift=t[20]),L[0]&32&&(U.descRoot=t[5]),L[0]&131072&&(U.item=t[55]),n.$set(U),(!D||L[0]&131072)&&s!==(s=nn(t[55].temp.type,t[55].temp.tier)+"")&&G(i,s),(!D||L[0]&131072&&r!==(r="marg text"+jt(t[55].temp.quality)[0]+" svelte-35lzg4"))&&p(o,"class",r),(!D||L[0]&131072)&&a!==(a=(t[55].temp.logic.level||1)+"")&&G(c,a),(!D||L[0]&131072&&f!==(f="marg "+(I.player.level>=t[55].temp.logic.level?"textgreen":"textred")+" svelte-35lzg4"))&&p(l,"class",f),(!D||L[0]&131072)&&m!==(m=t[55].temp.owner+"")&&G(g,m),(!D||L[0]&131072)&&_!==(_=t[27](t[55].temp.auction.getTime())+"")&&G(b,_),(!D||L[0]&139264)&&F!==(F=t[13]&&t[55].temp.stacks>0?t[55].temp.stacks+" x ":"")&&G(A,F);let W={};L[0]&139264&&(W.amount=t[13]&&t[55].temp.stacks>0?Math.ceil(t[55].temp.auctionprice/t[55].temp.stacks):t[55].temp.auctionprice),C.$set(W),(!D||L[0]&393216&&M!==(M="buy "+(t[18]==t[55]?"selected":"")+" item panel-black svelte-35lzg4"))&&p(e,"class",M)},i(q){D||(S(n.$$.fragment,q),S(C.$$.fragment,q),D=!0)},o(q){E(n.$$.fragment,q),E(C.$$.fragment,q),D=!1},d(q){q&&x(e),Z(n),Z(C),$=!1,V()}}}function mV(t){let e,n,o,s,i=[hV,dV],r=[];function l(a,c){return a[18].temp.owner!==I.player.name?0:1}return n=l(t,[-1,-1]),o=r[n]=i[n](t),{c(){e=h("section"),o.c(),p(e,"class","confirm panel-black svelte-35lzg4")},m(a,c){w(a,e,c),r[n].m(e,null),s=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(we(),E(r[f],1,1,()=>{r[f]=null}),Me(),o=r[n],o?o.p(a,c):(o=r[n]=i[n](a),o.c()),S(o,1),o.m(e,null))},i(a){s||(S(o),s=!0)},o(a){E(o),s=!1},d(a){a&&x(e),r[n].d()}}}function pV(t){let e,n,o,s=(t[3]?nn(t[3].type,t[3].tier):P.ui.merchant.dragitem)+"",i,r,l,a,c=P.ui.merchant.price+"",f,u,m,g,v,_,b=P.ui.merchant.fee+"",k,y,F,A,C,M,D=P.ui.merchant.post+"",$,V,z,q,L,U;n=new Mo({props:{descPos:"left:100%;bottom:100%;",clearOnMove:!0,invslot:void 0,pickable:!0,item:hs}}),n.$on("discard",t[26]),n.$on("move",t[25]),n.$on("click",t[26]),n.$on("context",t[26]),m=new xn({props:{amount:t[1]}}),F=new xn({props:{amount:t[15]}});let W=t[3]&&t[3].stacks>0&&J6(t);return{c(){e=h("section"),J(n.$$.fragment),o=h("span"),i=T(s),l=h("div"),a=h("span"),f=T(c),u=T(": "),J(m.$$.fragment),g=Ne(),v=h("br"),_=h("span"),k=T(b),y=T(": "),J(F.$$.fragment),A=h("input"),W&&W.c(),M=h("div"),$=T(D),p(o,"class",r="marg text"+(t[3]?jt(t[3].quality)[0]:"grey")+" svelte-35lzg4"),p(a,"class","textwhite"),p(_,"class","textgrey"),p(l,"class","marg svelte-35lzg4"),Le(l,"text-align","end"),p(A,"class","marg svelte-35lzg4"),p(A,"type","number"),p(A,"placeholder",C=P.ui.merchant.setPrice),p(M,"class",V="marg btn formatted secondary "+(t[16]?"":"disabled")+" svelte-35lzg4"),p(e,"class",z="post "+(t[3]&&t[3].stacks>0?"postStacks":"")+" panel-black svelte-35lzg4")},m(R,N){w(R,e,N),Q(n,e,null),d(e,o),d(o,i),d(e,l),d(l,a),d(a,f),d(a,u),Q(m,a,null),d(a,g),d(l,v),d(l,_),d(_,k),d(_,y),Q(F,_,null),d(e,A),je(A,t[0]),W&&W.m(e,null),d(e,M),d(M,$),q=!0,L||(U=[H(A,"input",t[48]),H(M,"click",t[24])],L=!0)},p(R,N){(!q||N[0]&8)&&s!==(s=(R[3]?nn(R[3].type,R[3].tier):P.ui.merchant.dragitem)+"")&&G(i,s),(!q||N[0]&8&&r!==(r="marg text"+(R[3]?jt(R[3].quality)[0]:"grey")+" svelte-35lzg4"))&&p(o,"class",r);let Y={};N[0]&2&&(Y.amount=R[1]),m.$set(Y);let _e={};N[0]&32768&&(_e.amount=R[15]),F.$set(_e),N[0]&1&&Gt(A.value)!==R[0]&&je(A,R[0]),R[3]&&R[3].stacks>0?W?W.p(R,N):(W=J6(R),W.c(),W.m(e,M)):W&&(W.d(1),W=null),(!q||N[0]&65536&&V!==(V="marg btn formatted secondary "+(R[16]?"":"disabled")+" svelte-35lzg4"))&&p(M,"class",V),(!q||N[0]&8&&z!==(z="post "+(R[3]&&R[3].stacks>0?"postStacks":"")+" panel-black svelte-35lzg4"))&&p(e,"class",z)},i(R){q||(S(n.$$.fragment,R),S(m.$$.fragment,R),S(F.$$.fragment,R),q=!0)},o(R){E(n.$$.fragment,R),E(m.$$.fragment,R),E(F.$$.fragment,R),q=!1},d(R){R&&x(e),Z(n),Z(m),Z(F),W&&W.d(),L=!1,rt(U)}}}function dV(t){let e,n,o,s=nn(t[18].temp.type,t[18].temp.tier)+"",i,r,l,a,c,f,u;return{c(){e=h("span"),n=T("Stop "),o=h("span"),i=T(s),l=T(" from being listed?"),a=h("div"),a.textContent=`${P.ui.cancel}`,c=h("div"),c.textContent=`${P.ui.merchant.delist}`,p(o,"class",r="text"+jt(t[18].temp.quality)[0]+" svelte-35lzg4"),p(e,"class","marg svelte-35lzg4"),p(a,"class","marg btn formatted grey svelte-35lzg4"),p(c,"class","marg btn formatted orange svelte-35lzg4")},m(m,g){w(m,e,g),d(e,n),d(e,o),d(o,i),d(e,l),w(m,a,g),w(m,c,g),f||(u=[H(a,"click",t[29]),H(c,"click",t[31])],f=!0)},p(m,g){g[0]&262144&&s!==(s=nn(m[18].temp.type,m[18].temp.tier)+"")&&G(i,s),g[0]&262144&&r!==(r="text"+jt(m[18].temp.quality)[0]+" svelte-35lzg4")&&p(o,"class",r)},i:ae,o:ae,d(m){m&&(x(e),x(a),x(c)),f=!1,rt(u)}}}function hV(t){let e,n=P.ui.merchant.buyItem[0]+"",o,s,i,r=t[18].temp.stacks>0?t[18].temp.stacks+" x ":"",l,a,c=nn(t[18].temp.type,t[18].temp.tier)+"",f,u,m,g=P.ui.merchant.buyItem[1]+"",v,_,b,k,y=P.ui.merchant.buyItem[2]+"",F,A,C,M,D,$;return b=new xn({props:{amount:t[18].temp.auctionprice}}),{c(){e=h("span"),o=T(n),s=Ne(),i=h("span"),l=T(r),a=h("span"),f=T(c),m=Ne(),v=T(g),_=Ne(),J(b.$$.fragment),k=Ne(),F=T(y),A=h("div"),A.textContent=`${P.ui.cancel}`,C=h("div"),C.textContent=`${P.ui.merchant.buy}`,p(i,"class","textgreen"),p(a,"class",u="text"+jt(t[18].temp.quality)[0]+" svelte-35lzg4"),p(e,"class","marg svelte-35lzg4"),p(A,"class","marg btn formatted grey svelte-35lzg4"),p(C,"class","marg btn formatted secondary svelte-35lzg4")},m(V,z){w(V,e,z),d(e,o),d(e,s),d(e,i),d(i,l),d(e,a),d(a,f),d(e,m),d(e,v),d(e,_),Q(b,e,null),d(e,k),d(e,F),w(V,A,z),w(V,C,z),M=!0,D||($=[H(A,"click",t[29]),H(C,"click",t[30])],D=!0)},p(V,z){(!M||z[0]&262144)&&r!==(r=V[18].temp.stacks>0?V[18].temp.stacks+" x ":"")&&G(l,r),(!M||z[0]&262144)&&c!==(c=nn(V[18].temp.type,V[18].temp.tier)+"")&&G(f,c),(!M||z[0]&262144&&u!==(u="text"+jt(V[18].temp.quality)[0]+" svelte-35lzg4"))&&p(a,"class",u);let q={};z[0]&262144&&(q.amount=V[18].temp.auctionprice),b.$set(q)},i(V){M||(S(b.$$.fragment,V),M=!0)},o(V){E(b.$$.fragment,V),M=!1},d(V){V&&(x(e),x(A),x(C)),Z(b),D=!1,rt($)}}}function J6(t){let e,n,o,s,i,r,l;return{c(){e=h("select"),n=h("option"),n.textContent="Total",s=h("option"),s.textContent="Per Unit",n.__value=o=!1,je(n,n.__value),s.__value=i=!0,je(s,s.__value),p(e,"class","marg formatted svelte-35lzg4"),t[2]===void 0&&bn(()=>t[49].call(e))},m(a,c){w(a,e,c),d(e,n),d(e,s),Mn(e,t[2],!0),r||(l=H(e,"change",t[49]),r=!0)},p(a,c){c[0]&4&&Mn(e,a[2])},d(a){a&&x(e),r=!1,l()}}}function gV(t){let e,n,o,s,i,r,l,a,c=P.ui.merchant.search+"",f,u,m,g=P.ui.merchant.previous+"",v,_,b,k=P.ui.merchant.next+"",y,F,A,C,M,D,$,V,z,q,L,U=P.ui.merchant.results+"",W,R,N=t[14]+1+"",Y,_e,Fe=Math.ceil(t[19]/50)+"",he,ie,le,ge,be,Te=t[32](t[10],"time",t[11])+"",se,Ie=P.ui.merchant.time+"",K,Re,Ge,Qe=(t[12]?P.ui.merchant.perUnit:P.ui.merchant.total)+"",Ye,pe,ce,Oe=t[32](t[10],"price",t[11])+"",oe,ee=P.ui.merchant.price+"",O,ue,We,ze,Ae,$e,Ue,mt,wt;function Je(He){t[37](He)}function Et(He){t[38](He)}function xe(He){t[39](He)}let Ke={limit:10};t[8]!==void 0&&(Ke.name=t[8]),t[7]!==void 0&&(Ke.tier=t[7]),t[6]!==void 0&&(Ke.type=t[6]),o=new W6({props:Ke}),qt.push(()=>ps(o,"name",Je)),qt.push(()=>ps(o,"tier",Et)),qt.push(()=>ps(o,"type",xe)),o.$on("finalize",t[23]);let bt=me(t[22]),Ct=[];for(let He=0;He<bt.length;He+=1)Ct[He]=Q6(Y6(t,bt,He));let Ve=me(t[17]),ye=[];for(let He=0;He<Ve.length;He+=1)ye[He]=Z6(H6(t,Ve,He));let Vt=He=>E(ye[He],1,1,()=>{ye[He]=null}),Ht=[pV,mV],Lt=[];function Rt(He,et){return He[18]?1:0}return Ae=Rt(t,[-1,-1]),$e=Lt[Ae]=Ht[Ae](t),{c(){e=h("div"),n=h("section"),J(o.$$.fragment),l=h("span"),a=h("div"),f=T(c),m=h("div"),v=T(g),b=h("div"),y=T(k),A=h("section");for(let He=0;He<Ct.length;He+=1)Ct[He].c();C=h("section"),M=h("div"),D=h("div"),$=h("div"),V=h("span"),z=h("span"),q=T(t[19]),L=Ne(),W=T(U),R=T(" ("),Y=T(N),_e=T("/"),he=T(Fe),ie=T(")"),le=h("span"),le.textContent="Lv.",ge=h("span"),ge.textContent=`${P.ui.merchant.owner}`,be=h("span"),se=T(Te),K=T(Ie),Ge=h("span"),Ye=T(Qe),ce=h("span"),oe=T(Oe),O=T(ee),ue=Ne(),ze=h("div");for(let He=0;He<ye.length;He+=1)ye[He].c();$e.c(),p(a,"class",u="btn formatted secondary "+(t[9]?"":"disabled")),p(m,"class",_="btn formatted grey "+(t[9]&&t[14]>0?"":"disabled")),p(b,"class",F="btn formatted grey "+(t[9]&&t[17].length==50?"":"disabled")),p(n,"class","search panel-black svelte-35lzg4"),p(A,"class","choices border grey scrollbar svelte-35lzg4"),p(z,"class","btn black disabled textgrey"),p(le,"class","btn black disabled textgrey"),p(ge,"class","btn black disabled textgrey"),p(be,"class",Re="btn grey "+(t[9]?"":"disabled")+" "+(t[10]=="time"?"textprimary active":"")),p(Ge,"class",pe="btn grey "+(t[9]?"":"disabled")+" "+(t[12]?"textgreen":"")),Le(Ge,"text-align","end"),p(ce,"class",We="btn grey "+(t[9]?"":"disabled")+" "+(t[10]=="price"?"textprimary active":"")),Le(ce,"text-align","end"),p($,"class","buytblhead svelte-35lzg4"),p(D,"class","scrollbar scrollbar-fix"),p(ze,"class","scrollbar scrollbar-fix"),p(M,"class","buytable svelte-35lzg4"),p(C,"class","items border grey svelte-35lzg4"),p(e,"class","layout svelte-35lzg4")},m(He,et){w(He,e,et),d(e,n),Q(o,n,null),d(n,l),d(n,a),d(a,f),d(n,m),d(m,v),d(n,b),d(b,y),t[43](n),d(e,A);for(let Ee=0;Ee<Ct.length;Ee+=1)Ct[Ee]&&Ct[Ee].m(A,null);d(e,C),d(C,M),d(M,D),d(D,$),d($,V),d($,z),d(z,q),d(z,L),d(z,W),d(z,R),d(z,Y),d(z,_e),d(z,he),d(z,ie),d($,le),d($,ge),d($,be),d(be,se),d(be,K),d($,Ge),d(Ge,Ye),d($,ce),d(ce,oe),d(ce,O),d(ce,ue),d(M,ze);for(let Ee=0;Ee<ye.length;Ee+=1)ye[Ee]&&ye[Ee].m(ze,null);Lt[Ae].m(e,null),Ue=!0,mt||(wt=[H(a,"click",t[40]),H(m,"click",t[41]),H(b,"click",t[42]),H(be,"click",t[45]),H(Ge,"click",t[34]),H(ce,"click",t[46])],mt=!0)},p(He,et){let Ee={};if(!s&&et[0]&256&&(s=!0,Ee.name=He[8],ms(()=>s=!1)),!i&&et[0]&128&&(i=!0,Ee.tier=He[7],ms(()=>i=!1)),!r&&et[0]&64&&(r=!0,Ee.type=He[6],ms(()=>r=!1)),o.$set(Ee),(!Ue||et[0]&512&&u!==(u="btn formatted secondary "+(He[9]?"":"disabled")))&&p(a,"class",u),(!Ue||et[0]&16896&&_!==(_="btn formatted grey "+(He[9]&&He[14]>0?"":"disabled")))&&p(m,"class",_),(!Ue||et[0]&131584&&F!==(F="btn formatted grey "+(He[9]&&He[17].length==50?"":"disabled")))&&p(b,"class",F),et[0]&12599744){bt=me(He[22]);let Ze;for(Ze=0;Ze<bt.length;Ze+=1){let ft=Y6(He,bt,Ze);Ct[Ze]?Ct[Ze].p(ft,et):(Ct[Ze]=Q6(ft),Ct[Ze].c(),Ct[Ze].m(A,null))}for(;Ze<Ct.length;Ze+=1)Ct[Ze].d(1);Ct.length=bt.length}if((!Ue||et[0]&524288)&&G(q,He[19]),(!Ue||et[0]&16384)&&N!==(N=He[14]+1+"")&&G(Y,N),(!Ue||et[0]&524288)&&Fe!==(Fe=Math.ceil(He[19]/50)+"")&&G(he,Fe),(!Ue||et[0]&3072)&&Te!==(Te=He[32](He[10],"time",He[11])+"")&&G(se,Te),(!Ue||et[0]&1536&&Re!==(Re="btn grey "+(He[9]?"":"disabled")+" "+(He[10]=="time"?"textprimary active":"")))&&p(be,"class",Re),(!Ue||et[0]&4096)&&Qe!==(Qe=(He[12]?P.ui.merchant.perUnit:P.ui.merchant.total)+"")&&G(Ye,Qe),(!Ue||et[0]&4608&&pe!==(pe="btn grey "+(He[9]?"":"disabled")+" "+(He[12]?"textgreen":"")))&&p(Ge,"class",pe),(!Ue||et[0]&3072)&&Oe!==(Oe=He[32](He[10],"price",He[11])+"")&&G(oe,Oe),(!Ue||et[0]&1536&&We!==(We="btn grey "+(He[9]?"":"disabled")+" "+(He[10]=="price"?"textprimary active":"")))&&p(ce,"class",We),et[0]&404103200){Ve=me(He[17]);let Ze;for(Ze=0;Ze<Ve.length;Ze+=1){let ft=H6(He,Ve,Ze);ye[Ze]?(ye[Ze].p(ft,et),S(ye[Ze],1)):(ye[Ze]=Z6(ft),ye[Ze].c(),S(ye[Ze],1),ye[Ze].m(ze,null))}for(we(),Ze=Ve.length;Ze<ye.length;Ze+=1)Vt(Ze);Me()}let it=Ae;Ae=Rt(He,et),Ae===it?Lt[Ae].p(He,et):(we(),E(Lt[it],1,1,()=>{Lt[it]=null}),Me(),$e=Lt[Ae],$e?$e.p(He,et):($e=Lt[Ae]=Ht[Ae](He),$e.c()),S($e,1),$e.m(e,null))},i(He){if(!Ue){S(o.$$.fragment,He);for(let et=0;et<Ve.length;et+=1)S(ye[et]);S($e),Ue=!0}},o(He){E(o.$$.fragment,He),ye=ye.filter(Boolean);for(let et=0;et<ye.length;et+=1)E(ye[et]);E($e),Ue=!1},d(He){He&&x(e),Z(o),t[43](null),ot(Ct,He),ot(ye,He),Lt[Ae].d(),mt=!1,rt(wt)}}}function vV(t){let e,n,o=t[4]&&X6(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,i){s[4]?o?(o.p(s,i),i[0]&16&&S(o,1)):(o=X6(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function _V(t,e,n){let o,s,i,r,l,a;re(t,pa,Ae=>n(35,o=Ae)),re(t,hs,Ae=>n(3,s=Ae)),re(t,ds,Ae=>n(4,i=Ae)),re(t,Vr,Ae=>n(36,r=Ae)),re(t,wm,Ae=>n(19,l=Ae));let c=nt.shift.store;re(t,c,Ae=>n(20,a=Ae));let f,u=[P.ui.all,P.ui.merchant.filtermine,null,"bow","hammer","staff","sword",null,"orb","quiver","shield","totem",null,"armlet","armor","boot","glove",null,"amulet","bag","ring",null,"book","rune","misc",null,"mount","pet","box"],m=u[0],g="all",v="",_=[],b=!0,k="price",y=1,F=!1,A=!1,C=0,M=()=>{if(b&&i){n(18,he=void 0);let Ae=u.indexOf(m);yt("itemauctionfind",`${Ae} ${Ae===1?"all":g} ${k==="time"?0:F?2:1} ${y} ${C}`),n(9,b=!1)}},D,$,V=!1,z,q,L=()=>{q&&yt("itemauctionpost",`${s.dbid} ${$}`)},U=Ae=>{let{from:$e,to:Ue}=Ae.detail;$e!==Ue&&$e.type=="item"&&hs.set($e.item)},W=Ae=>{s&&s.type&&xt(Uo[s.type].sound),hs.set()},R,N=[],Y=[],_e=()=>{if(R=Date.now(),o.length){let Ae=o.map($e=>$e.dbid);fetch("/api/item/getAuction",{method:"POST",body:JSON.stringify({ids:Ae})}).then(async $e=>{let Ue=await $e.json();Ue==="error"||$e.ok===!1?console.error(Ue):(n(17,Y.length=0,Y),o.forEach((mt,wt)=>{let Je=Ue.find(Et=>Et.id===mt.dbid);Je&&(Je.store=N[wt]||(N[wt]=te()),Je.store.temp=mt,mt.hydrate(Je),Y.push(Je.store))}),n(13,A=F),n(9,b=!0))})}else n(13,A=F),n(9,b=!0),n(17,Y.length=0,Y)},Fe=Ae=>{let $e=Math.ceil((Ae-R)/6e4);return $e<60?`${$e} m`:`${Math.ceil($e/60)} h`},he,ie=Ae=>{n(18,he=Ae)},le=()=>{n(18,he=void 0)},ge=()=>{yt("itemauctionbuy",he.temp.dbid+""),le()},be=()=>{yt("itemauctioncancel",he.temp.dbid+""),le()},Te=(Ae,$e,Ue)=>Ae==$e?Ue==1?"\u{1F815} ":"\u{1F817} ":"",se=Ae=>{n(14,C=0),Ae==k?n(11,y=y==1?0:1):n(10,k=Ae),M()},Ie=()=>{n(12,F=!F),k=="price"?M():n(13,A=F)};hs.subscribe(Ae=>{Ae!==void 0&&(n(6,m=Ae.type),n(7,g=Ae.tier),n(11,y=1),n(10,k="price"),n(12,F=!0),n(14,C=0),M())});function K(Ae){v=Ae,n(8,v)}function Re(Ae){g=Ae,n(7,g)}function Ge(Ae){m=Ae,n(6,m)}let Qe=Ae=>{n(14,C=0),M()},Ye=Ae=>{n(14,C--,C),M()},pe=Ae=>{n(14,C++,C),M()};function ce(Ae){qt[Ae?"unshift":"push"](()=>{f=Ae,n(5,f)})}let Oe=(Ae,$e)=>{n(6,m=Ae),n(8,v=""),n(7,g="all"),n(14,C=0),M()},oe=Ae=>se("time"),ee=Ae=>se("price"),O=(Ae,$e)=>!$e.altKey&&ie(Ae);function ue(){D=Gt(this.value),n(0,D),n(3,s),n(2,V),n(1,$),n(4,i)}function We(){V=Co(this),n(2,V)}let ze=()=>{Xe(ds,i=void 0,i),n(8,v=""),n(7,g="all")};return t.$$.update=()=>{t.$$.dirty[0]&16|t.$$.dirty[1]&32&&i&&M(),t.$$.dirty[0]&16&&(i?n(18,he=void 0):Xe(hs,s=void 0,s)),t.$$.dirty[0]&15&&(gt(),n(0,D=gt(D,0,2147483646)),n(1,$=s?gt((parseInt(D)||0)*(V&&s.stacks||1),0,2147483646):0),n(15,z=Number.isInteger($)?G6($):0),n(16,q=Number.isInteger($)&&$>0&&s&&s.canBeTraded())),t.$$.dirty[1]&16&&_e()},[D,$,V,s,i,f,m,g,v,b,k,y,F,A,C,z,q,Y,he,l,a,c,u,M,L,U,W,Fe,ie,le,ge,be,Te,se,Ie,o,r,K,Re,Ge,Qe,Ye,pe,ce,Oe,oe,ee,O,ue,We,ze]}var rv=class extends Ce{constructor(e){super(),Pe(this,e,_V,vV,Be,{},null,[-1,-1])}},K6=rv;var Pd=[{name:"Year",days:365,price:9e3},{name:"Month",days:30,price:900}],Nn=[{sub:!1,stash:15,inventory:15,auction:10,auctionHours:12},{sub:!0,stash:100,inventory:25,auction:100,auctionHours:24}];function eF(t,e,n){let o=t.slice();return o[41]=e[n],o}function tF(t,e,n){let o=t.slice();return o[44]=e[n],o}function nF(t){let e,n;return e=new $t({props:{origin:"left top",defaultOffset:[3,100],title:"Stash",settings:[{name:"Stash Settings",fun:t[33]}],icon:"bag",$$slots:{default:[bV]},$$scope:{ctx:t}}}),e.$on("close",t[34]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s[0]&2048&&(i.settings=[{name:"Stash Settings",fun:o[33]}]),s[0]&131071|s[1]&65536&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function oF(t){let e,n,o,s,i,r,l,a=["Ungrouped","Grouped","Groups + Titles"][t[14]]+"",c,f,u,m;return{c(){e=h("div"),n=h("small"),n.textContent="Width",o=h("input"),s=h("small"),s.textContent="Height",i=h("input"),r=h("div"),l=h("small"),c=T(a),p(n,"class","btn textsecondary"),p(o,"type","range"),p(o,"min","7"),p(o,"max","20"),p(s,"class","btn textsecondary"),p(i,"type","range"),p(i,"min","50"),p(i,"max","500"),p(l,"class",f="btn grey text"+["white","green","cyan"][t[14]]+" svelte-gou6xs"),p(e,"class","panel-black bar-top-config svelte-gou6xs")},m(g,v){w(g,e,v),d(e,n),d(e,o),je(o,t[12]),d(e,s),d(e,i),je(i,t[13]),d(e,r),d(e,l),d(l,c),u||(m=[H(o,"change",t[25]),H(o,"input",t[25]),H(i,"change",t[26]),H(i,"input",t[26]),H(l,"click",t[27])],u=!0)},p(g,v){v[0]&4096&&je(o,g[12]),v[0]&8192&&je(i,g[13]),v[0]&16384&&a!==(a=["Ungrouped","Grouped","Groups + Titles"][g[14]]+"")&&G(c,a),v[0]&16384&&f!==(f="btn grey text"+["white","green","cyan"][g[14]]+" svelte-gou6xs")&&p(l,"class",f)},d(g){g&&x(e),u=!1,rt(m)}}}function sF(t){let e,n=t[41].name+"",o;return{c(){e=h("small"),o=T(n),p(e,"class","textprimary"),Le(e,"display","block"),Le(e,"font-size","10px"),Le(e,"text-transform","uppercase"),Le(e,"letter-spacing","0.1em")},m(s,i){w(s,e,i),d(e,o)},p(s,i){i[0]&16864&&n!==(n=s[41].name+"")&&G(o,n)},d(s){s&&x(e)}}}function iF(t){let e,n;return e=new Mo({props:{descPos:"left:100%;top:0;",shift:t[15],descRoot:t[3],pickable:!1,text:t[19](t[44].temp?t[44].temp.getStashTime():0),item:t[44],filter:!t[9]||(!t[44].temp||t[44].temp.getStashTime()>t[4]||"")||t[6].includes(t[44])?!0:""}}),e.$on("click",function(){Os(t[6].includes(t[44])?void 0:t[20])&&(t[6].includes(t[44])?void 0:t[20]).apply(this,arguments)}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){t=o;let i={};s[0]&32768&&(i.shift=t[15]),s[0]&8&&(i.descRoot=t[3]),s[0]&16864&&(i.text=t[19](t[44].temp?t[44].temp.getStashTime():0)),s[0]&16864&&(i.item=t[44]),s[0]&17392&&(i.filter=!t[9]||(!t[44].temp||t[44].temp.getStashTime()>t[4]||"")||t[6].includes(t[44])?!0:""),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function rF(t){let e,n,o=t[14]===2&&t[41].stores.length>0&&sF(t),s=me(t[41].stores),i=[];for(let l=0;l<s.length;l+=1)i[l]=iF(tF(t,s,l));let r=l=>E(i[l],1,1,()=>{i[l]=null});return{c(){o&&o.c(),e=h("div");for(let l=0;l<i.length;l+=1)i[l].c();p(e,"class","slotcontainer svelte-gou6xs"),Le(e,"width",t[8].length?"fit-content":"auto"),Le(e,"grid-template-columns","repeat("+Math.min(t[8].length,t[12])+", auto)")},m(l,a){o&&o.m(l,a),w(l,e,a);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null);n=!0},p(l,a){if(l[14]===2&&l[41].stores.length>0?o?o.p(l,a):(o=sF(l),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null),a[0]&1623032){s=me(l[41].stores);let c;for(c=0;c<s.length;c+=1){let f=tF(l,s,c);i[c]?(i[c].p(f,a),S(i[c],1)):(i[c]=iF(f),i[c].c(),S(i[c],1),i[c].m(e,null))}for(we(),c=s.length;c<i.length;c+=1)r(c);Me()}(!n||a[0]&256)&&Le(e,"width",l[8].length?"fit-content":"auto"),(!n||a[0]&4352)&&Le(e,"grid-template-columns","repeat("+Math.min(l[8].length,l[12])+", auto)")},i(l){if(!n){for(let a=0;a<s.length;a+=1)S(i[a]);n=!0}},o(l){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)E(i[a]);n=!1},d(l){l&&x(e),o&&o.d(l),ot(i,l)}}}function lF(t){let e,n,o;return{c(){e=h("span"),e.innerHTML='Upgrade <img class="svgicon texticon" src="/data/ui/icons/gem.svg?v=8738303"/>',p(e,"class","btn textwhite")},m(s,i){w(s,e,i),n||(o=H(e,"click",t[29]),n=!0)},p:ae,d(s){s&&x(e),n=!1,o()}}}function aF(t){let e,n,o=(t[0]===1?P.ui.stash.deposit:P.ui.stash.withdraw)+"",s,i,r,l,a,c,f,u,m=(t[0]===1?P.ui.stash.deposit:P.ui.stash.withdraw)+"",g,v,_,b,k;return r=new xn({props:{amount:t[0]>0?t[1]:0}}),{c(){e=h("div"),n=h("span"),s=T(o),i=Ne(),J(r.$$.fragment),l=T(" ?"),a=h("div"),c=h("input"),f=h("div"),f.textContent="Max",u=h("div"),g=T(m),Le(c,"width","150px"),p(c,"class","navbtn formatted"),p(c,"type","number"),p(f,"class","btn navbtn cyan formatted"),p(u,"class",v="btn navbtn "+(!t[9]||t[1]<=0?"disabled":"")+" "+(t[0]===1?"blue":"green")+" formatted"),p(a,"class","marg-top formelements svelte-gou6xs"),p(e,"class","panel-black marg-top"),Le(e,"text-align","right")},m(y,F){w(y,e,F),d(e,n),d(n,s),d(n,i),Q(r,n,null),d(n,l),d(e,a),d(a,c),je(c,t[1]),d(a,f),d(a,u),d(u,g),_=!0,b||(k=[H(c,"input",t[32]),H(f,"click",t[22]),H(u,"click",t[21])],b=!0)},p(y,F){(!_||F[0]&1)&&o!==(o=(y[0]===1?P.ui.stash.deposit:P.ui.stash.withdraw)+"")&&G(s,o);let A={};F[0]&3&&(A.amount=y[0]>0?y[1]:0),r.$set(A),F[0]&2&&Gt(c.value)!==y[1]&&je(c,y[1]),(!_||F[0]&1)&&m!==(m=(y[0]===1?P.ui.stash.deposit:P.ui.stash.withdraw)+"")&&G(g,m),(!_||F[0]&515&&v!==(v="btn navbtn "+(!y[9]||y[1]<=0?"disabled":"")+" "+(y[0]===1?"blue":"green")+" formatted"))&&p(u,"class",v)},i(y){_||(S(r.$$.fragment,y),_=!0)},o(y){E(r.$$.fragment,y),_=!1},d(y){y&&x(e),Z(r),b=!1,rt(k)}}}function bV(t){let e,n,o,s,i=t[8].length+"",r,l,a=(t[10].subscribed_until?Nn[1].stash:Nn[0].stash)+"",c,f,u,m,g,v,_,b,k,y,F,A,C,M,D,$,V=t[11]&&oF(t),z=me(t[14]<1?[{stores:t[8],name:""}]:[{stores:t[5],name:I.player.name},{stores:t[7],name:"Account Wide"},{stores:t[6],name:"Other characters"}]),q=[];for(let R=0;R<z.length;R+=1)q[R]=rF(eF(t,z,R));let L=R=>E(q[R],1,1,()=>{q[R]=null}),U=!t[10].subscribed_until&&lF(t);m=new xn({props:{amount:t[2].gold}});let W=t[0]>0&&aF(t);return{c(){V&&V.c(),e=h("div");for(let R=0;R<q.length;R+=1)q[R].c();n=h("div"),o=h("div"),s=h("span"),r=T(i),l=T(" / "),c=T(a),U&&U.c(),u=h("div"),J(m.$$.fragment),g=h("div"),v=h("img"),k=h("div"),y=h("img"),W&&W.c(),C=de(),p(e,"class","panel-black scrollbar marg-top marg-bot slotparent svelte-gou6xs"),Le(e,"max-height",t[13]+"px"),p(s,"class",f=t[8].length<(t[10].subscribed_until?Nn[1].stash:Nn[0].stash)?"textgreen":"textred"),p(o,"class","navbtn panel-black border black gold svelte-gou6xs"),Le(o,"margin-right","auto"),p(u,"class","navbtn panel-black border black gold svelte-gou6xs"),p(v,"class","svgicon"),at(v.src,_="/data/ui/icons/deposit.svg?v=8738303")||p(v,"src",_),p(g,"class",b="navbtn btn grey gold "+(t[0]===1?"active":"")+" svelte-gou6xs"),p(y,"class","svgicon"),at(y.src,F="/data/ui/icons/withdraw.svg?v=8738303")||p(y,"src",F),p(k,"class",A="navbtn btn grey gold "+(t[0]===2?"active":"")+" svelte-gou6xs"),p(n,"class","formelements svelte-gou6xs")},m(R,N){V&&V.m(R,N),w(R,e,N);for(let Y=0;Y<q.length;Y+=1)q[Y]&&q[Y].m(e,null);t[28](e),w(R,n,N),d(n,o),d(o,s),d(s,r),d(s,l),d(s,c),U&&U.m(s,null),d(n,u),Q(m,u,null),d(n,g),d(g,v),d(n,k),d(k,y),W&&W.m(R,N),w(R,C,N),M=!0,D||($=[H(e,"pointerup",t[18]),H(g,"click",t[30]),H(k,"click",t[31])],D=!0)},p(R,N){if(R[11]?V?V.p(R,N):(V=oF(R),V.c(),V.m(e.parentNode,e)):V&&(V.d(1),V=null),N[0]&1627128){z=me(R[14]<1?[{stores:R[8],name:""}]:[{stores:R[5],name:I.player.name},{stores:R[7],name:"Account Wide"},{stores:R[6],name:"Other characters"}]);let _e;for(_e=0;_e<z.length;_e+=1){let Fe=eF(R,z,_e);q[_e]?(q[_e].p(Fe,N),S(q[_e],1)):(q[_e]=rF(Fe),q[_e].c(),S(q[_e],1),q[_e].m(e,null))}for(we(),_e=z.length;_e<q.length;_e+=1)L(_e);Me()}(!M||N[0]&8192)&&Le(e,"max-height",R[13]+"px"),(!M||N[0]&256)&&i!==(i=R[8].length+"")&&G(r,i),(!M||N[0]&1024)&&a!==(a=(R[10].subscribed_until?Nn[1].stash:Nn[0].stash)+"")&&G(c,a),R[10].subscribed_until?U&&(U.d(1),U=null):U?U.p(R,N):(U=lF(R),U.c(),U.m(s,null)),(!M||N[0]&1280&&f!==(f=R[8].length<(R[10].subscribed_until?Nn[1].stash:Nn[0].stash)?"textgreen":"textred"))&&p(s,"class",f);let Y={};N[0]&4&&(Y.amount=R[2].gold),m.$set(Y),(!M||N[0]&1&&b!==(b="navbtn btn grey gold "+(R[0]===1?"active":"")+" svelte-gou6xs"))&&p(g,"class",b),(!M||N[0]&1&&A!==(A="navbtn btn grey gold "+(R[0]===2?"active":"")+" svelte-gou6xs"))&&p(k,"class",A),R[0]>0?W?(W.p(R,N),N[0]&1&&S(W,1)):(W=aF(R),W.c(),S(W,1),W.m(C.parentNode,C)):W&&(we(),E(W,1,1,()=>{W=null}),Me())},i(R){if(!M){for(let N=0;N<z.length;N+=1)S(q[N]);S(m.$$.fragment,R),S(W),M=!0}},o(R){q=q.filter(Boolean);for(let N=0;N<q.length;N+=1)E(q[N]);E(m.$$.fragment,R),E(W),M=!1},d(R){R&&(x(e),x(n),x(C)),V&&V.d(R),ot(q,R),t[28](null),U&&U.d(),Z(m),W&&W.d(R),D=!1,rt($)}}}function yV(t){let e,n,o=t[2]&&t[10]&&nF(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,i){s[2]&&s[10]?o?(o.p(s,i),i[0]&1028&&S(o,1)):(o=nF(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function kV(t,e,n){let o,s,i,r,l,a,c,f,u,m,g;re(t,zo,K=>n(2,o=K)),re(t,Zo,K=>n(23,s=K)),re(t,In,K=>n(37,i=K)),re(t,Mm,K=>n(24,r=K)),re(t,ha,K=>n(10,l=K)),re(t,cf,K=>n(11,a=K)),re(t,Qi,K=>n(12,c=K)),re(t,Zi,K=>n(13,f=K)),re(t,xa,K=>n(14,u=K)),re(t,Bo,K=>n(16,g=K));let v=nt.shift.store;re(t,v,K=>n(15,m=K));let _,b,k={},y=[],F=[],A=[],C=[],M=!1,D,$=async()=>{if(n(4,b=Date.now()),r.all.length){let K=await fetch("/api/item/getStash",{method:"POST",body:JSON.stringify({ids:r.all.map(Ge=>Ge.dbid)})}),Re=await K.json();if(Re==="error"||K.ok===!1)console.error(Re);else{n(8,C.length=n(5,y.length=n(6,F.length=0,F),y),C),n(7,A.length=0,A);let Ge=new Map(r.all.map(Ye=>[Ye.dbid,Ye])),Qe=new Map(Re.map(Ye=>[Ye.id,Ye]));r.all.forEach(Ye=>{let pe=Qe.get(Ye.dbid);pe&&(pe.store=k[pe.id]||(k[pe.id]=te()),r.other.find(ce=>ce.dbid===pe.id)?F.push(pe.store):r.self.find(ce=>ce.dbid===pe.id)?y.push(pe.store):A.push(pe.store),C.push(pe.store),Ge.has(pe.id)&&(Ge.get(pe.id).hydrate(pe),pe.store.temp=Ge.get(pe.id)))})}}else n(8,C.length=n(5,y.length=n(6,F.length=0,F),y),C),n(7,A.length=0,A);Y()},V=K=>{i&&(yt("itemstash",`${i.meta.slot}`),Xe(In,i=void 0,i))},z=K=>K<b?void 0:`${Math.ceil((K-b)/6e4)}m`,q=K=>{M&&(K.detail.item.getStashTime()>Date.now()?Nt("system",P.ui.stash.waitunstash):(yt("itemunstash",K.detail.item.dbid+""),N()))},L=K=>{M&&(yt("goldstash",W===1?R+"":-R+""),N())},U=()=>{n(1,R=W===1?s:o.gold)},W=2,R=0,N=()=>{n(9,M=!1),D=setTimeout(()=>{n(9,M=!0)},500)},Y=()=>{n(9,M=!0),D&&(clearTimeout(D),D=void 0)};function _e(){c=Gt(this.value),Qi.set(c)}function Fe(){f=Gt(this.value),Zi.set(f)}let he=K=>Xe(xa,u=Xe(xa,++u,u)%3,u);function ie(K){qt[K?"unshift":"push"](()=>{_=K,n(3,_)})}let le=K=>Xe(Bo,g=!0,g),ge=K=>n(0,W=1),be=K=>n(0,W=2);function Te(){R=Gt(this.value),n(1,R),n(2,o),n(0,W),n(23,s)}let se=()=>{Xe(cf,a=!a,a)},Ie=K=>Xe(zo,o=!1,o);return t.$$.update=()=>{t.$$.dirty[0]&16777216&&$(),t.$$.dirty[0]&8388615&&n(1,R=o?Math.min(W===1?s:o.gold,R):0)},[W,R,o,_,b,y,F,A,C,M,l,a,c,f,u,m,g,v,V,z,q,L,U,s,r,_e,Fe,he,ie,le,ge,be,Te,se,Ie]}var lv=class extends Ce{constructor(e){super(),Pe(this,e,kV,yV,Be,{},null,[-1,-1])}},cF=lv;function xV(t,e,n){let o=t.slice();return o[7]=e[n],o[9]=n,o}function fF(t,e,n){let o=t.slice();return o[10]=e[n],o}function uF(t){let e,n;return e=new $t({props:{origin:"center",title:P.npcs.trader.name,icon:"bag",$$slots:{default:[PV]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&8195&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function mF(t){let e,n;return e=new Mo({props:{id:"trader"+t[10][0].buyid,descPos:"left:100%;top:0;",descRoot:t[0],isTrader:!0,pickable:!1,item:t[10][1]}}),e.$on("click",t[4]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&1&&(i.descRoot=o[0]),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function wV(t){let e,n;return e=new Mo({props:{isTrader:!0}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p:ae,i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function MV(t){let e;return{c(){e=h("span"),e.textContent=`${P.npcs.trader.select}`,p(e,"class","textgrey")},m(n,o){w(n,e,o)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function FV(t){let e,n,o,s,i,r=[SV,CV],l=[];function a(c,f){return f&2&&(e=null),e==null&&(e=!!c[1].data.canBeSold()),e?0:1}return n=a(t,-1),o=l[n]=r[n](t),{c(){o.c(),s=de()},m(c,f){l[n].m(c,f),w(c,s,f),i=!0},p(c,f){let u=n;n=a(c,f),n===u?l[n].p(c,f):(we(),E(l[u],1,1,()=>{l[u]=null}),Me(),o=l[n],o?o.p(c,f):(o=l[n]=r[n](c),o.c()),S(o,1),o.m(s.parentNode,s))},i(c){i||(S(o),i=!0)},o(c){E(o),i=!1},d(c){c&&x(s),l[n].d(c)}}}function CV(t){let e;return{c(){e=h("span"),e.textContent=`${P.npcs.trader.refuse}`,p(e,"class","textred")},m(n,o){w(n,e,o)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function SV(t){let e,n;return e=new xn({props:{amount:t[1].data.goldValue()}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&2&&(i.amount=o[1].data.goldValue()),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function PV(t){let e,n,o,s,i,r,l,a,c,f,u,m,g,v=me(I.player.getTargetEntity().items),_=[];for(let M=0;M<v.length;M+=1)_[M]=mF(fF(t,v,M));let b=M=>E(_[M],1,1,()=>{_[M]=null}),k=me(Array(24-I.player.getTargetEntity().items.length)),y=[];for(let M=0;M<k.length;M+=1)y[M]=wV(xV(t,k,M));let F=[FV,MV],A=[];function C(M,D){return M[1]&&M[1].meta.type==="item"?0:1}return c=C(t,-1),f=A[c]=F[c](t),{c(){e=h("div"),n=h("p"),n.textContent=`${P.npcs.trader.buy}`,o=h("div");for(let M=0;M<_.length;M+=1)_[M].c();s=de();for(let M=0;M<y.length;M+=1)y[M].c();i=h("div"),r=h("p"),r.textContent=`${P.npcs.trader.info}`,l=h("p"),l.textContent=`${P.npcs.trader.price}`,a=h("span"),f.c(),p(n,"class","textprimary textcenter"),p(o,"class","panel-black slotcontainer svelte-12uytpc"),p(r,"class","textprimary"),p(a,"class","panel-black formatted info svelte-12uytpc"),p(i,"class","textcenter"),p(e,"class","container svelte-12uytpc")},m(M,D){w(M,e,D),d(e,n),d(e,o);for(let $=0;$<_.length;$+=1)_[$]&&_[$].m(o,null);d(o,s);for(let $=0;$<y.length;$+=1)y[$]&&y[$].m(o,null);d(e,i),d(i,r),d(i,l),d(i,a),A[c].m(a,null),t[5](e),u=!0,m||(g=H(e,"pointerup",t[3]),m=!0)},p(M,D){if(D&17){v=me(I.player.getTargetEntity().items);let V;for(V=0;V<v.length;V+=1){let z=fF(M,v,V);_[V]?(_[V].p(z,D),S(_[V],1)):(_[V]=mF(z),_[V].c(),S(_[V],1),_[V].m(o,s))}for(we(),V=v.length;V<_.length;V+=1)b(V);Me()}let $=c;c=C(M,D),c===$?A[c].p(M,D):(we(),E(A[$],1,1,()=>{A[$]=null}),Me(),f=A[c],f?f.p(M,D):(f=A[c]=F[c](M),f.c()),S(f,1),f.m(a,null))},i(M){if(!u){for(let D=0;D<v.length;D+=1)S(_[D]);for(let D=0;D<k.length;D+=1)S(y[D]);S(f),u=!0}},o(M){_=_.filter(Boolean);for(let D=0;D<_.length;D+=1)E(_[D]);y=y.filter(Boolean);for(let D=0;D<y.length;D+=1)E(y[D]);E(f),u=!1},d(M){M&&x(e),ot(_,M),ot(y,M),A[c].d(),t[5](null),m=!1,g()}}}function AV(t){let e,n,o=t[2]&&uF(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[2]?o?(o.p(s,i),i&4&&S(o,1)):(o=uF(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function TV(t,e,n){let o,s;re(t,In,f=>n(1,o=f)),re(t,Jo,f=>n(2,s=f));let i=f=>{o&&o.meta&&o.meta.type==="item"&&o.data.canBeSold()&&Kf(o.data.quality,o.data.upgrade,o.meta.slot,o.data.type,o.data.tier),Xe(In,o=void 0,o)},r=f=>{yt("itemtraderbuy",`${f.detail.item.buyid}`)},l;function a(f){qt[f?"unshift":"push"](()=>{l=f,n(0,l)})}return[l,o,s,i,r,a,f=>Xe(Jo,s=!1,s)]}var av=class extends Ce{constructor(e){super(),Pe(this,e,TV,AV,Be,{})}},pF=av;function dF(t,e,n){let o=t.slice();return o[15]=e[n],o[17]=n,o}function hF(t,e,n){let o=t.slice();return o[18]=e[n],o[17]=n,o}function gF(t,e,n){let o=t.slice();return o[20]=e[n],o}function EV(t){let e,n,o;return{c(){e=h("div"),n=T("Auto Invite"),p(e,"class",o=t[18].lvldiff?"textgrey":"textcyan")},m(s,i){w(s,e,i),d(e,n)},p(s,i){i&4&&o!==(o=s[18].lvldiff?"textgrey":"textcyan")&&p(e,"class",o)},i:ae,o:ae,d(s){s&&x(e)}}}function IV(t){let e,n;return e=new Xn({props:{name:t[18].leadername,level:t[18].leaderlevel,pclass:t[18].leaderclass,faction:t[18].faction}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&4&&(i.name=o[18].leadername),s&4&&(i.level=o[18].leaderlevel),s&4&&(i.pclass=o[18].leaderclass),s&4&&(i.faction=o[18].faction),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function vF(t){let e,n,o,s=t[18].classcount[t[20]]+"",i,r;return{c(){e=h("div"),n=h("div"),n.innerHTML=`<img class="texticon" src="${ni(t[20])}"/>`,o=h("b"),i=T(s),p(o,"class",r=t[18].classcount[t[20]]>0?"textprimary":"textgrey")},m(l,a){w(l,e,a),d(e,n),d(e,o),d(o,i)},p(l,a){a&4&&s!==(s=l[18].classcount[l[20]]+"")&&G(i,s),a&4&&r!==(r=l[18].classcount[l[20]]>0?"textprimary":"textgrey")&&p(o,"class",r)},d(l){l&&x(e)}}}function _F(t){let e,n,o,s=t[18].message+"",i,r,l=t[4][t[18].activity]+"",a,c,f,u,m,g=t[18].minlevel+"",v,_,b=t[18].maxlevel+"",k,y,F,A,C,M,D=t[18].totalcount+"",$,V,z,q,L,U,W,R,N=[IV,EV],Y=[];function _e(ge,be){return ge[18].auto?1:0}F=_e(t,-1),A=Y[F]=N[F](t);let Fe=me([0,1,2,3]),he=[];for(let ge=0;ge<4;ge+=1)he[ge]=vF(gF(t,Fe,ge));function ie(...ge){return t[10](t[18],...ge)}function le(...ge){return t[11](t[18],...ge)}return{c(){e=h("div"),n=h("div"),o=h("div"),i=T(s),r=h("div"),a=T(l),c=h("div"),f=h("div"),u=T("Lv. "),m=h("span"),v=T(g),_=T(" - "),k=T(b),A.c(),C=h("div"),M=h("b"),$=T(D),V=T(" / 10"),q=h("div");for(let ge=0;ge<4;ge+=1)he[ge].c();p(o,"class","textprimary"),p(r,"class","textgrey textsmall"),Le(n,"text-overflow","ellipsis"),Le(n,"white-space","nowrap"),Le(n,"overflow","hidden"),p(m,"class",y=t[18].auto&&t[18].lvldiff?"textgrey":"textgreen"),p(f,"class","textgrey"),p(c,"class","textcenter"),p(M,"class",z=t[18].totalcount>=10?"textred":"textgreen"),p(C,"class","textcenter"),p(q,"class","grid four textcenter"),p(e,"class",L="panel-black listing marg-bot "+(t[1]===t[18]?"selected":t[5][t[18].applied])+" svelte-3fcblv")},m(ge,be){w(ge,e,be),d(e,n),d(n,o),d(o,i),d(n,r),d(r,a),d(e,c),d(c,f),d(f,u),d(f,m),d(m,v),d(m,_),d(m,k),Y[F].m(c,null),d(e,C),d(C,M),d(M,$),d(M,V),d(e,q);for(let Te=0;Te<4;Te+=1)he[Te]&&he[Te].m(q,null);U=!0,W||(R=[H(e,"click",ie),H(e,"contextmenu",le)],W=!0)},p(ge,be){t=ge,(!U||be&4)&&s!==(s=t[18].message+"")&&G(i,s),(!U||be&4)&&l!==(l=t[4][t[18].activity]+"")&&G(a,l),(!U||be&4)&&g!==(g=t[18].minlevel+"")&&G(v,g),(!U||be&4)&&b!==(b=t[18].maxlevel+"")&&G(k,b),(!U||be&4&&y!==(y=t[18].auto&&t[18].lvldiff?"textgrey":"textgreen"))&&p(m,"class",y);let Te=F;if(F=_e(t,be),F===Te?Y[F].p(t,be):(we(),E(Y[Te],1,1,()=>{Y[Te]=null}),Me(),A=Y[F],A?A.p(t,be):(A=Y[F]=N[F](t),A.c()),S(A,1),A.m(c,null)),(!U||be&4)&&D!==(D=t[18].totalcount+"")&&G($,D),(!U||be&4&&z!==(z=t[18].totalcount>=10?"textred":"textgreen"))&&p(M,"class",z),be&4){Fe=me([0,1,2,3]);let se;for(se=0;se<4;se+=1){let Ie=gF(t,Fe,se);he[se]?he[se].p(Ie,be):(he[se]=vF(Ie),he[se].c(),he[se].m(q,null))}for(;se<4;se+=1)he[se].d(1)}(!U||be&6&&L!==(L="panel-black listing marg-bot "+(t[1]===t[18]?"selected":t[5][t[18].applied])+" svelte-3fcblv"))&&p(e,"class",L)},i(ge){U||(S(A),U=!0)},o(ge){E(A),U=!1},d(ge){ge&&x(e),Y[F].d(),ot(he,ge),W=!1,rt(R)}}}function bF(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[15]}`,e.__value=n=t[17],je(e,e.__value)},m(o,s){w(o,e,s)},p:ae,d(o){o&&x(e)}}}function DV(t){let e,n,o,s,i,r,l,a,c;return{c(){e=h("div"),n=h("div"),o=T("\u{1F64B} Apply"),i=h("div"),r=T("\u{1F50E} Refresh"),p(n,"id","partyapply"),p(n,"class",s="btn textcenter "+(t[1]&&t[1].applied===0?"green":"disabled")),p(i,"class",l="btn textcenter "+(t[0]?"disabled":"cyan")),p(e,"class","panel-black grid two")},m(f,u){w(f,e,u),d(e,n),d(n,o),d(e,i),d(i,r),a||(c=[H(n,"click",t[7]),H(i,"click",t[6])],a=!0)},p(f,u){u&2&&s!==(s="btn textcenter "+(f[1]&&f[1].applied===0?"green":"disabled"))&&p(n,"class",s),u&1&&l!==(l="btn textcenter "+(f[0]?"disabled":"cyan"))&&p(i,"class",l)},d(f){f&&x(e),a=!1,rt(c)}}}function VV(t){let e;return{c(){e=h("div"),e.textContent="You are in a party.",p(e,"class","textcenter panel-black textgrey")},m(n,o){w(n,e,o)},p:ae,d(n){n&&x(e)}}}function LV(t){let e,n,o,s,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A,C=me(t[2].parties.filter(t[9])),M=[];for(let U=0;U<C.length;U+=1)M[U]=_F(hF(t,C,U));let D=U=>E(M[U],1,1,()=>{M[U]=null}),$=me(t[4]),V=[];for(let U=0;U<$.length;U+=1)V[U]=bF(dF(t,$,U));function z(U,W){return U[3].membercount>0?VV:DV}let q=z(t,-1),L=q(t);return{c(){e=h("div"),n=h("div");for(let U=0;U<M.length;U+=1)M[U].c();o=h("div"),s=h("div"),i=h("small"),i.textContent="Filter Party Listings",r=h("div"),l=h("small"),l.textContent="Activity",a=h("select"),c=h("option"),c.textContent="All";for(let U=0;U<V.length;U+=1)V[U].c();u=h("small"),u.textContent="Show Full",m=h("small"),v=h("small"),v.textContent="Show Auto Inv.",_=h("small"),k=Ne(),L.c(),p(n,"class","listcontainer scrollbar border grey svelte-3fcblv"),Le(n,"font-size","0.9em"),p(i,"class","textprimary"),c.__value=f=-1,je(c,c.__value),p(a,"class","btn grey small"),t[2].filterActivity===void 0&&bn(()=>t[12].call(a)),p(m,"class",g="btn checkbox "+(t[2].showFull?"active":"")),p(_,"class",b="btn checkbox "+(t[2].showAuto?"active":"")),p(r,"class","grid two search svelte-3fcblv"),p(s,"class","panel-black"),p(o,"class","grid"),Le(o,"grid-template-rows","1fr auto"),p(e,"class","layout svelte-3fcblv")},m(U,W){w(U,e,W),d(e,n);for(let R=0;R<M.length;R+=1)M[R]&&M[R].m(n,null);d(e,o),d(o,s),d(s,i),d(s,r),d(r,l),d(r,a),d(a,c);for(let R=0;R<V.length;R+=1)V[R]&&V[R].m(a,null);Mn(a,t[2].filterActivity,!0),d(r,u),d(r,m),d(r,v),d(r,_),d(o,k),L.m(o,null),y=!0,F||(A=[H(a,"change",t[12]),H(m,"click",t[13]),H(_,"click",t[14])],F=!0)},p(U,[W]){if(W&310){C=me(U[2].parties.filter(U[9]));let R;for(R=0;R<C.length;R+=1){let N=hF(U,C,R);M[R]?(M[R].p(N,W),S(M[R],1)):(M[R]=_F(N),M[R].c(),S(M[R],1),M[R].m(n,null))}for(we(),R=C.length;R<M.length;R+=1)D(R);Me()}if(W&16){$=me(U[4]);let R;for(R=0;R<$.length;R+=1){let N=dF(U,$,R);V[R]?V[R].p(N,W):(V[R]=bF(N),V[R].c(),V[R].m(a,null))}for(;R<V.length;R+=1)V[R].d(1);V.length=$.length}W&4&&Mn(a,U[2].filterActivity),(!y||W&4&&g!==(g="btn checkbox "+(U[2].showFull?"active":"")))&&p(m,"class",g),(!y||W&4&&b!==(b="btn checkbox "+(U[2].showAuto?"active":"")))&&p(_,"class",b),q===(q=z(U,W))&&L?L.p(U,W):(L.d(1),L=q(U),L&&(L.c(),L.m(o,null)))},i(U){if(!y){for(let W=0;W<C.length;W+=1)S(M[W]);y=!0}},o(U){M=M.filter(Boolean);for(let W=0;W<M.length;W+=1)E(M[W]);y=!1},d(U){U&&x(e),ot(M,U),ot(V,U),L.d(),F=!1,rt(A)}}}function qV(t,e,n){let o,s;re(t,la,y=>n(2,o=y)),re(t,eo,y=>n(3,s=y));let i=P.ui.party.activities,r=["","applied","denied"],l=!1,a,c=async()=>{n(0,l=!0);let y=await Ft("/api/party/getlistedparties",{},()=>{});y.forEach(F=>{F.totalcount=F.classcount.reduce((A,C)=>A+C,0),F.auto=F.leadername===null,F.lvldiff=F.auto?I.player.level<F.minlevel||I.player.level>F.maxlevel:!1}),Xe(la,o.parties=y,o),a&&n(1,a=y.find(F=>F.party===a.party)),setTimeout(()=>n(0,l=!1),200)};c();let f=()=>{a&&(n(1,a.applied=1,a),Ft("/api/party/makeapplication",{party:a.party,message:""},()=>{}),n(1,a=void 0),an(29,100))},u=(y,F)=>{F.leadername!==null&&dn.set({x:y.pageX,y:y.pageY,opts:[{name:F.leadername,css:"disabled"},Wt.whisper(F.leadername)]})},m=y=>(o.filterActivity===-1||y.activity===o.filterActivity)&&(o.showAuto||!y.auto)&&(o.showFull||y.totalcount<10),g=(y,F)=>n(1,a=y),v=(y,F)=>u(F,y);function _(){o.filterActivity=Co(this),la.set(o)}return[l,a,o,s,i,r,c,f,u,m,g,v,_,y=>Xe(la,o.showFull=!o.showFull,o),y=>Xe(la,o.showAuto=!o.showAuto,o)]}var cv=class extends Ce{constructor(e){super(),Pe(this,e,qV,LV,Be,{})}},yF=cv;var Ad=async t=>{let e;try{e=await Ft("/api/party/getpartystate",{},()=>{})}catch{e=void 0}e&&Qo.update(n=>{let o=!1;return e.applications.forEach(s=>{n.applications.find(r=>r.player===s.player)||(o=!0)}),n.applications=e.applications,n.message=e.message||n.message||"",n.activity=e.activity||n.activity||0,n.listed=e.listed,g1(n.listed),n.flashing=o&&!fe.partyOpen,n})};function kF(t,e,n){let o=t.slice();return o[14]=e[n],o[16]=n,o}function xF(t,e,n){let o=t.slice();return o[17]=e[n],o[16]=n,o}function RV(t){let e,n,o,s=me(t[1].applications),i=[];for(let l=0;l<s.length;l+=1)i[l]=wF(xF(t,s,l));let r=l=>E(i[l],1,1,()=>{i[l]=null});return{c(){e=h("table"),n=h("tbody");for(let l=0;l<i.length;l+=1)i[l].c();p(e,"class","dense"),Le(e,"width","100%"),Le(e,"table-layout","fixed")},m(l,a){w(l,e,a),d(e,n);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(n,null);o=!0},p(l,a){if(a&226){s=me(l[1].applications);let c;for(c=0;c<s.length;c+=1){let f=xF(l,s,c);i[c]?(i[c].p(f,a),S(i[c],1)):(i[c]=wF(f),i[c].c(),S(i[c],1),i[c].m(n,null))}for(we(),c=s.length;c<i.length;c+=1)r(c);Me()}},i(l){if(!o){for(let a=0;a<s.length;a+=1)S(i[a]);o=!0}},o(l){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)E(i[a]);o=!1},d(l){l&&x(e),ot(i,l)}}}function zV(t){let e;function n(i,r){return i[1].listed?$V:BV}let o=n(t,-1),s=o(t);return{c(){e=h("p"),s.c(),p(e,"class","textcenter textgrey")},m(i,r){w(i,e,r),s.m(e,null)},p(i,r){o!==(o=n(i,r))&&(s.d(1),s=o(i),s&&(s.c(),s.m(e,null)))},i:ae,o:ae,d(i){i&&x(e),s.d()}}}function wF(t){let e,n,o,s,i=t[17].gearscore+"",r,l,a,c,f,u,m,g,v,_,b;o=new Xn({props:{name:t[17].name,level:t[17].level,pclass:t[17].class,faction:t[17].faction}});function k(...A){return t[8](t[17],...A)}function y(...A){return t[9](t[17],...A)}function F(...A){return t[10](t[17],...A)}return{c(){e=h("tr"),n=h("td"),J(o.$$.fragment),s=h("td"),r=T(i),l=T(" GS"),a=h("td"),c=T("\u{1F91D}"),u=h("td"),m=T("\u274C"),p(n,"width","50%"),p(s,"width","20%"),p(s,"class","textcenter textcyan"),p(a,"width","15%"),p(a,"class",f="textcenter accept "+(t[17].invited?"active":"")+" svelte-6mz3cb"),p(u,"width","15%"),p(u,"class",g="textcenter deny "+(t[17].denied?"active":"")+" svelte-6mz3cb"),p(e,"class","striped"),Le(e,"cursor","unset")},m(A,C){w(A,e,C),d(e,n),Q(o,n,null),d(e,s),d(s,r),d(s,l),d(e,a),d(a,c),d(e,u),d(u,m),v=!0,_||(b=[H(a,"click",k),H(u,"click",y),H(e,"contextmenu",F)],_=!0)},p(A,C){t=A;let M={};C&2&&(M.name=t[17].name),C&2&&(M.level=t[17].level),C&2&&(M.pclass=t[17].class),C&2&&(M.faction=t[17].faction),o.$set(M),(!v||C&2)&&i!==(i=t[17].gearscore+"")&&G(r,i),(!v||C&2&&f!==(f="textcenter accept "+(t[17].invited?"active":"")+" svelte-6mz3cb"))&&p(a,"class",f),(!v||C&2&&g!==(g="textcenter deny "+(t[17].denied?"active":"")+" svelte-6mz3cb"))&&p(u,"class",g)},i(A){v||(S(o.$$.fragment,A),v=!0)},o(A){E(o.$$.fragment,A),v=!1},d(A){A&&x(e),Z(o),_=!1,rt(b)}}}function BV(t){let e;return{c(){e=T("List your party to search for players")},m(n,o){w(n,e,o)},d(n){n&&x(e)}}}function $V(t){let e;return{c(){e=T("Waiting for players...")},m(n,o){w(n,e,o)},d(n){n&&x(e)}}}function MF(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[14]}`,e.__value=n=t[16],je(e,e.__value)},m(o,s){w(o,e,s)},p:ae,d(o){o&&x(e)}}}function UV(t){let e,n,o,s,i,r,l,a,c,f,u,m,g,v,_,b,k,y=t[1].listed?"\u{1F441}\uFE0F Unlist":"List",F,A,C,M,D,$,V=[zV,RV],z=[];function q(W,R){return W[1].applications.length===0?0:1}o=q(t,-1),s=z[o]=V[o](t);let L=me(t[3]),U=[];for(let W=0;W<L.length;W+=1)U[W]=MF(kF(t,L,W));return{c(){e=h("div"),n=h("div"),s.c(),i=h("div"),r=h("div"),l=h("div"),a=h("small"),a.textContent="Describe your party",c=h("input"),m=h("div"),g=h("small"),g.textContent="Select an activity",v=h("select");for(let W=0;W<U.length;W+=1)U[W].c();b=h("div"),k=h("div"),F=T(y),A=T(" Party"),p(n,"class","listcontainer scrollbar border grey svelte-6mz3cb"),p(a,"class","textprimary"),p(c,"maxlength",f=40),p(c,"class",u="marg-top "+(t[2].role<2||t[1].listed?"disabled":"")),p(c,"type","text"),p(c,"placeholder","Enter Party Message"),p(l,"class","panel-bright"),p(g,"class","textprimary"),p(v,"class",_="btn grey marg-top "+(t[2].role<2||t[1].listed?"disabled":"")),t[1].activity===void 0&&bn(()=>t[12].call(v)),p(m,"class","panel-bright marg-top"),p(r,"class","panel-black "),p(k,"class",C="btn purp textcenter "+(t[2].role<2||t[0]?"disabled":t[1].listed?"active":"")),p(b,"class","panel-black"),p(i,"class","grid"),Le(i,"grid-template-rows","1fr auto"),p(e,"class","layout svelte-6mz3cb")},m(W,R){w(W,e,R),d(e,n),z[o].m(n,null),d(e,i),d(i,r),d(r,l),d(l,a),d(l,c),je(c,t[1].message),d(r,m),d(m,g),d(m,v);for(let N=0;N<U.length;N+=1)U[N]&&U[N].m(v,null);Mn(v,t[1].activity,!0),d(i,b),d(b,k),d(k,F),d(k,A),M=!0,D||($=[H(c,"input",t[11]),H(v,"change",t[12]),H(k,"click",t[4])],D=!0)},p(W,[R]){let N=o;if(o=q(W,R),o===N?z[o].p(W,R):(we(),E(z[N],1,1,()=>{z[N]=null}),Me(),s=z[o],s?s.p(W,R):(s=z[o]=V[o](W),s.c()),S(s,1),s.m(n,null)),(!M||R&6&&u!==(u="marg-top "+(W[2].role<2||W[1].listed?"disabled":"")))&&p(c,"class",u),R&2&&c.value!==W[1].message&&je(c,W[1].message),R&8){L=me(W[3]);let Y;for(Y=0;Y<L.length;Y+=1){let _e=kF(W,L,Y);U[Y]?U[Y].p(_e,R):(U[Y]=MF(_e),U[Y].c(),U[Y].m(v,null))}for(;Y<U.length;Y+=1)U[Y].d(1);U.length=L.length}(!M||R&6&&_!==(_="btn grey marg-top "+(W[2].role<2||W[1].listed?"disabled":"")))&&p(v,"class",_),R&2&&Mn(v,W[1].activity),(!M||R&2)&&y!==(y=W[1].listed?"\u{1F441}\uFE0F Unlist":"List")&&G(F,y),(!M||R&7&&C!==(C="btn purp textcenter "+(W[2].role<2||W[0]?"disabled":W[1].listed?"active":"")))&&p(k,"class",C)},i(W){M||(S(s),M=!0)},o(W){E(s),M=!1},d(W){W&&x(e),z[o].d(),ot(U,W),D=!1,rt($)}}}function OV(t,e,n){let o,s;re(t,Qo,k=>n(1,o=k)),re(t,eo,k=>n(2,s=k));let i=P.ui.party.activities,r,l=!1;Ad();let a=async()=>{n(0,l=!0),o.listed?(Xe(Qo,o.listed=!1,o),await Ft("/api/party/unlistparty",{},()=>{})):(Xe(Qo,o.listed=!0,o),await Ft("/api/party/listparty",{message:o.message,activity:o.activity},()=>{})),n(0,l=!1)},c=k=>{yt("partyinvite",k.name),k.invited=!0,k.denied=!1,Qo.set(o)},f=k=>{k.denied=!0,k.invited=!1,Xe(Qo,o.applications=o.applications.filter(y=>y.player!==k.player),o),Ft("/api/party/denyapplication",{player:k.player},()=>{})},u=(k,y)=>{dn.set({x:k.pageX,y:k.pageY,opts:[{name:y.name,css:"disabled"},Wt.whisper(y.name)]})},m=(k,y)=>{c(k)},g=(k,y)=>{f(k)},v=(k,y)=>u(y,k);function _(){o.message=this.value,Qo.set(o)}function b(){o.activity=Co(this),Qo.set(o)}return[l,o,s,i,a,c,f,u,m,g,v,_,b]}var fv=class extends Ce{constructor(e){super(),Pe(this,e,OV,UV,Be,{})}},FF=fv;function CF(t){let e,n;return e=new $t({props:{origin:"center",title:"\u{1F465} Party",$$slots:{default:[WV]},$$scope:{ctx:t}}}),e.$on("close",t[3]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&67&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function NV(t){let e,n;return e=new FF({}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function jV(t){let e,n;return e=new yF({}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function WV(t){let e,n,o,s,i,r,l,a,c,f,u,m=[jV,NV],g=[];function v(_,b){return _[1]===0||_[0].membercount===0?0:1}return l=v(t,-1),a=g[l]=m[l](t),{c(){e=h("div"),n=h("div"),o=h("div"),o.textContent="Party List",s=h("div"),i=T("Your Party"),a.c(),p(o,"class","tab"),$i(o,"active",t[1]===0),p(s,"class",r="tab "+(t[0].membercount===0?"disabled":"")),$i(s,"active",t[1]===1),p(n,"class","tab-bar flex"),p(e,"class","container svelte-6dw5x1")},m(_,b){w(_,e,b),d(e,n),d(n,o),d(n,s),d(s,i),g[l].m(e,null),c=!0,f||(u=[H(o,"click",t[4]),H(s,"click",t[5])],f=!0)},p(_,b){(!c||b&2)&&$i(o,"active",_[1]===0),(!c||b&1&&r!==(r="tab "+(_[0].membercount===0?"disabled":"")))&&p(s,"class",r),(!c||b&3)&&$i(s,"active",_[1]===1);let k=l;l=v(_,b),l!==k&&(we(),E(g[k],1,1,()=>{g[k]=null}),Me(),a=g[l],a||(a=g[l]=m[l](_),a.c()),S(a,1),a.m(e,null))},i(_){c||(S(a),c=!0)},o(_){E(a),c=!1},d(_){_&&x(e),g[l].d(),f=!1,rt(u)}}}function GV(t){let e,n,o=t[2]&&CF(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[2]?o?(o.p(s,i),i&4&&S(o,1)):(o=CF(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function HV(t,e,n){let o,s;re(t,es,c=>n(2,o=c)),re(t,eo,c=>n(0,s=c));let i=0,r=c=>Xe(es,o=!1,o),l=()=>{n(1,i=0)},a=()=>{n(1,i=1)};return t.$$.update=()=>{t.$$.dirty&1&&s.membercount===0&&n(1,i=0)},[s,i,o,r,l,a]}var uv=class extends Ce{constructor(e){super(),Pe(this,e,HV,GV,Be,{})}},SF=uv;var Td=t=>t.type==="pet"&&t.upgrade>=1?!1:t.stacks===void 0&&t.rolls.length>0&&!Pn[t.type].noupgrade,PF=t=>t<101,Ed=t=>{if(!Td(t)||t.type==="pet")return 0;let e=ln[t.type+t.tier];return Math.ceil(((1+e.level*(1+t.upgrade))/Pn[t.type].drop)**(1.2+t.upgrade*.2))+100},AF=t=>{if(Td(t)){let e=[];if(t.type==="pet")e.push({type:"box",tier:2});else for(let n=0;n<Math.max(1,t.upgrade);++n)e.push({type:"rune",tier:n,stacks:Math.max(1,Math.min(2,t.upgrade-n))});return e}else return[]};var dv={};Kn(dv,{addExp:()=>pv,addGold:()=>Dd,init:()=>du,onWorldEnter:()=>YV,tick:()=>XV,values:()=>Cs});var Cs=new Map,mv=new kt(0,1),Id=0,du=()=>{Cs.set("exp",0),Cs.set("gold",0),mv.reset(0),Id=0},YV=du,XV=t=>{mv.done(I.time)&&(++Id,mv.reset(I.time),Fm.set({gold:Cs.get("gold"),gph:Cs.get("gold")/Id*60*60}),Cm.set({exp:Cs.get("exp"),exph:Cs.get("exp")/Id*60*60}))},pv=t=>{Cs.set("exp",(Cs.get("exp")||0)+t)},Dd=t=>{Cs.set("gold",(Cs.get("gold")||0)+t)};var TF=(t,e,n)=>{if(t&&t.type)switch(e){case 13:t.rolls&&t.quality>=70&&xt(t.quality<90?98:99);case 1:fe.msgItemPickup&&Nt("inv",P.ui.inventory.pick.replace("$1",nn(t.type,t.tier)),!0),an(7,100),xt(Uo[t.type].sound),ko[9].element="bag"+n,t.type=="book"&&an(20,100)&&(ko[21].element="bag"+n);break;case 10:t.rolls&&Gi.update(o=>(da.set(t.upgrade-o.upgrade),t));break}},EF=(t,e)=>{if(t&&t.type)switch(e){case 7:Nt("inv",P.ui.stash.stashed.replace("$1",nn(t.type,t.tier))),xt(Uo[t.type].sound);break;case 6:hs.set(),Vr.update(n=>!n),Nt("inv",P.ui.merchant.auctionpost.replace("$1",nn(t.type,t.tier)));break;case 9:Nt("inv",P.ui.inventory.sold.replace("$1",nn(t.type,t.tier))),xt(Uo[t.type].sound);break;case 2:Nt("inv",P.ui.inventory.throw.replace("$1",nn(t.type,t.tier))),xt(Uo[t.type].sound);break}},hu=(t,e,n,o)=>{n!=0&&xt(Uo.gold.sound);let s=o+e;switch(n){case 1:fe.msgGoldPickUp&&Nt("inv",P.ui.inventory.pick.replace("$1",s),!0),Dd(e);break;case 4:Vr.update(i=>!i),Nt("inv",P.ui.merchant.auctionbuy.replace("$1",s),!0);break;case 12:case 3:Nt("inv",P.ui.inventory.spend.replace("$1",s),!0);break;case 11:Nt("inv",P.ui.inventory.death.replace("$1",s),!0);break;case 9:Nt("inv",P.ui.inventory.receive.replace("$1",s),!0),Dd(e);break}};var Ss=class extends mr{constructor(e){super(e)}hydrate(e){super.hydrate(e),e.store?e.store.set(this):console.error("no store for item",e),TF(this,this.reason,e.slot)}equipReasons(e){let n=[];if(this.logic.class!==void 0&&n.push(["Class: "+P.classes[this.logic.class].name,Qa(e.class,this.type,this.tier)]),this.logic.level&&n.push(["Requires Lv. "+this.logic.level,og(e.level,this.type,this.tier)]),this.logic.requiredSkill&&n.push(["Must know: "+P.items.book[this.logic.requiredSkill].name,rg(e.skills.skillIdsActive,this.type,this.tier)]),Qa(e.class,this.type,this.tier)&&this.type=="book"){let o=ig(e.skills.skillIdsLearned,this.type,this.tier),s=ou(e.skills.skillIdsLearned,this.logic.skillid);n.push([o?"Use book to learn skill":s>=this.logic.skilllevel?"You already know this skill":`Must learn book Lv. ${this.logic.skilllevel} first`,o])}return n}buyReasons(e){let n=[];return this.logic.buyElo!==void 0&&n.push([`Min. Rating: ${eu(this.logic.buyElo)}`,Mx(e.elo,this.type,this.tier)]),n}getBestEquipslot(e){let n=Pn[this.type].slot;return n===void 0?void 0:n.find(s=>e.slots.get(s)===void 0)||n[0]}};function IF(t,e,n){let o=t.slice();return o[18]=e[n],o}function DF(t){let e,n;return e=new $t({props:{origin:"center",title:"Blacksmith",icon:"bag",$$slots:{default:[QV]},$$scope:{ctx:t}}}),e.$on("close",t[13]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&2097661&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function VF(t){let e;return{c(){e=h("div")},m(n,o){w(n,e,o)},p:ae,d(n){n&&x(e)}}}function LF(t){let e,n;return e=new Mo({props:{pickable:!1,item:t[18],filter:t[18].filter}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&8&&(i.item=o[18]),s&8&&(i.filter=o[18].filter),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function QV(t){let e,n,o,s=(t[7]||"Place an item into the upgrade slot")+"",i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A;a=new Mo({props:{clearOnMove:!0,invslot:t[0]?t[2]:void 0,pickable:!0,item:Gi,filter:t[5]?!0:""}}),a.$on("discard",t[10]),a.$on("move",t[9]);let C=me(t[3]),M=[];for(let V=0;V<C.length;V+=1)M[V]=LF(IF(t,C,V));let D=V=>E(M[V],1,1,()=>{M[V]=null}),$=null;return C.length||($=VF(t)),v=new xn({props:{isPrice:!0,amount:t[0]?Ed(t[0]):0}}),{c(){e=h("div"),n=h("h3"),n.textContent="Upgrade Item",o=h("span"),i=T(s),l=h("div"),J(a.$$.fragment),f=h("div"),u=h("span"),u.textContent="Cost:",m=h("div");for(let V=0;V<M.length;V+=1)M[V].c();$&&$.c(),g=h("div"),J(v.$$.fragment),_=h("div"),b=T("Upgrade"),p(n,"class","textwhite"),p(o,"class",r="panel-black upgradetext "+t[8]+" svelte-1u9u6qj"),p(l,"class",c="upgradeslot "+t[6]+" svelte-1u9u6qj"),p(m,"class","panel-black costgrid svelte-1u9u6qj"),Le(m,"grid-template-columns","repeat("+Math.min(3,t[3].length||1)+", 30px)"),p(_,"class",k="btn primary formatted textcenter upgradebutton "+(t[4]?"":"disabled")+" svelte-1u9u6qj"),p(f,"class","upgrade svelte-1u9u6qj"),p(e,"class","container textcenter svelte-1u9u6qj")},m(V,z){w(V,e,z),d(e,n),d(e,o),d(o,i),d(e,l),Q(a,l,null),d(e,f),d(f,u),d(f,m);for(let q=0;q<M.length;q+=1)M[q]&&M[q].m(m,null);$&&$.m(m,null),d(f,g),Q(v,g,null),d(f,_),d(_,b),y=!0,F||(A=H(_,"click",t[11]),F=!0)},p(V,z){(!y||z&128)&&s!==(s=(V[7]||"Place an item into the upgrade slot")+"")&&G(i,s),(!y||z&256&&r!==(r="panel-black upgradetext "+V[8]+" svelte-1u9u6qj"))&&p(o,"class",r);let q={};if(z&5&&(q.invslot=V[0]?V[2]:void 0),z&32&&(q.filter=V[5]?!0:""),a.$set(q),(!y||z&64&&c!==(c="upgradeslot "+V[6]+" svelte-1u9u6qj"))&&p(l,"class",c),z&8){C=me(V[3]);let U;for(U=0;U<C.length;U+=1){let W=IF(V,C,U);M[U]?(M[U].p(W,z),S(M[U],1)):(M[U]=LF(W),M[U].c(),S(M[U],1),M[U].m(m,null))}for(we(),U=C.length;U<M.length;U+=1)D(U);Me(),!C.length&&$?$.p(V,z):C.length?$&&($.d(1),$=null):($=VF(V),$.c(),$.m(m,null))}(!y||z&8)&&Le(m,"grid-template-columns","repeat("+Math.min(3,V[3].length||1)+", 30px)");let L={};z&1&&(L.amount=V[0]?Ed(V[0]):0),v.$set(L),(!y||z&16&&k!==(k="btn primary formatted textcenter upgradebutton "+(V[4]?"":"disabled")+" svelte-1u9u6qj"))&&p(_,"class",k)},i(V){if(!y){S(a.$$.fragment,V);for(let z=0;z<C.length;z+=1)S(M[z]);S(v.$$.fragment,V),y=!0}},o(V){E(a.$$.fragment,V),M=M.filter(Boolean);for(let z=0;z<M.length;z+=1)E(M[z]);E(v.$$.fragment,V),y=!1},d(V){V&&x(e),Z(a),ot(M,V),$&&$.d(),Z(v),F=!1,A()}}}function ZV(t){let e,n,o=t[1]&&DF(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[1]?o?(o.p(s,i),i&2&&S(o,1)):(o=DF(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function JV(t,e,n){let o,s,i,r,l;re(t,da,C=>n(12,o=C)),re(t,Gi,C=>n(0,s=C)),re(t,ma,C=>n(14,i=C)),re(t,Zo,C=>n(15,r=C)),re(t,Xs,C=>n(1,l=C));let a=C=>{let{from:M,to:D}=C.detail;M!==D&&M.type=="item"&&(Gi.set(M.item),n(2,f=M.slot))},c=C=>{Gi.set(),n(2,f=void 0)},f,u=[],m=!1,g=!1,v=()=>{let C=Td(s),M=r>=Ed(s),D=PF(f);n(4,m=C&&M&&D);let $=AF(s);$.forEach((V,z)=>{let q=u[z]||n(3,u[z]=te(),u),L=new Ss;L.hydrate({...V,store:q}),L.stacks!==void 0?q.filter=i[L.type+L.tier]>=L.stacks?"":!0:q.filter=i[L.type+L.tier]>=0?"":!0,q.filter&&n(4,m=!1)}),n(3,u=u.slice(0,$.length)),m||n(7,k="You lack the required materials"),C||n(7,k="This item cannot be upgraded"),M||n(7,k="You do not have enough gold"),D||n(7,k="You must un-equip the item first"),m?(n(8,y="textgreen"),n(7,k="Ready to upgrade")):n(8,y="textred")},_=()=>{s&&m&&!g&&(n(5,g=!0),Xe(da,o=void 0,o),n(7,k="Upgrading..."),n(8,y="textprimary"),xt(100),setTimeout(()=>yt("itemblacksmithupgrade",`${s.dbid}`),1e3))},b,k,y,F=()=>{xt(o>0?101:102),n(6,b=o>0?"flash_success":"flash_fail"),n(7,k=(o>0?"Success! ":"Fail! ")+(o<0?"-":"+")+o),n(8,y=o>0?"textgreen":"textred")},A=C=>Xe(Xs,l=!1,l);return t.$$.update=()=>{t.$$.dirty&2&&(l||(Xe(Gi,s=void 0,s),Xe(da,o=void 0,o))),t.$$.dirty&1&&(n(4,m=!0),s?v():(n(3,u.length=0,u),n(4,m=!1),n(8,y=void 0),n(7,k=void 0)),n(5,g=!1)),t.$$.dirty&4096&&(o!==void 0?F():(n(6,b=""),n(8,y="")))},[s,l,f,u,m,g,b,k,y,a,c,_,o,A]}var hv=class extends Ce{constructor(e){super(),Pe(this,e,JV,ZV,Be,{})}},qF=hv;function KV(t){let e;return{c(){e=h("span")},m(n,o){w(n,e,o),e.innerHTML=t[0]},p(n,[o]){o&1&&(e.innerHTML=n[0])},i:ae,o:ae,d(n){n&&x(e)}}}function eL(t,e,n){let o,{amount:s}=e;return t.$$set=i=>{"amount"in i&&n(1,s=i.amount)},t.$$.update=()=>{t.$$.dirty&2&&n(0,o=eu(s))},[o,s]}var gv=class extends Ce{constructor(e){super(),Pe(this,e,eL,KV,yn,{amount:1})}},Vd=gv;var vv=Xa({0:{6:2,8:.3},1:{6:4,12:1},2:{14:.5},3:{14:.4,7:.8},4:{16:.3,7:.8},5:{14:.2,18:.4}});var RF=t=>1+t/1e3;function tL(t){let e,n=P.ui.stats.array[t[1]]+"",o,s,i=(t[3]?"+"+Qn(t[1],t[0].get(t[2]).get(t[1])):Qn(t[1],t[4][t[1]]||0))+"",r,l;return{c(){e=h("span"),o=T(n),s=h("span"),r=T(i),p(s,"class",l="statnumber "+(t[3]?"textgreen":t[0]?"textprimary":"textgreen"))},m(a,c){w(a,e,c),d(e,o),w(a,s,c),d(s,r)},p(a,[c]){c&2&&n!==(n=P.ui.stats.array[a[1]]+"")&&G(o,n),c&31&&i!==(i=(a[3]?"+"+Qn(a[1],a[0].get(a[2]).get(a[1])):Qn(a[1],a[4][a[1]]||0))+"")&&G(r,i),c&9&&l!==(l="statnumber "+(a[3]?"textgreen":a[0]?"textprimary":"textgreen"))&&p(s,"class",l)},i:ae,o:ae,d(a){a&&(x(e),x(s))}}}function nL(t,e,n){let o,s;re(t,Hi,a=>n(4,s=a));let{relmap:i}=e,{id:r}=e,{relation:l=void 0}=e;return t.$$set=a=>{"relmap"in a&&n(0,i=a.relmap),"id"in a&&n(1,r=a.id),"relation"in a&&n(2,l=a.relation)},t.$$.update=()=>{t.$$.dirty&7&&n(3,o=l!==void 0&&i.get(l).get(r)!==void 0)},[i,r,l,o,s]}var _v=class extends Ce{constructor(e){super(),Pe(this,e,nL,tL,Be,{relmap:0,id:1,relation:2})}},Ld=_v;var Di=[4e3,8e3,12e3,16e3,2e4,24e3,28e3,32e3,36e3,4e4,44e3,48e3];var _r=Di.length,lc=t=>{for(let e=0;e<_r;++e)if(Di[e]>t)return e;return Math.max(0,_r)},Rd=t=>t===0?0:Di[t-1],bv=t=>{for(let e=0;e<_r;++e)if(Di[e]>t)return Di[e];return Di[_r-1]},qd=[1,.8,.63,.479,.342,.23,.146,.085,.045,.024,.01,.003,0],yue=qd.map(t=>1-t);var gu=t=>t===0?"No Bracket":t===qd.length?qd.length+" (Faction Leader)":`${t} (Top ${(qd[t-1]*100).toFixed(1)}%)`;function zF(t,e,n){let o=t.slice();return o[12]=e[n],o[14]=n,o}function BF(t,e,n){let o=t.slice();return o[15]=e[n],o}function $F(t,e,n){let o=t.slice();return o[18]=e[n],o[20]=n,o}function UF(t,e,n){let o=t.slice();return o[15]=e[n],o}function OF(t){let e,n;return e=new $t({props:{title:P.ui.headers.character,icon:"char",origin:"left top",defaultOffset:[3,100],$$slots:{default:[oL]},$$scope:{ctx:t}}}),e.$on("close",t[11]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&8388727&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function NF(t){let e,n,o,s,i,r,l;e=new Ld({props:{id:t[15]}});function a(...f){return t[8](t[15],...f)}function c(...f){return t[10](t[15],...f)}return{c(){J(e.$$.fragment),n=h("img"),at(n.src,o="/data/ui/icons/arrow.svg?v=8738303")||p(n,"src",o),p(n,"class",s="btn "+(t[0][22]>0?"green":"disabled")+" svgicon statbtn svelte-rbq5ku")},m(f,u){Q(e,f,u),w(f,n,u),i=!0,r||(l=[H(n,"pointerenter",a),H(n,"pointerleave",t[9]),H(n,"click",c)],r=!0)},p(f,u){t=f,(!i||u&1&&s!==(s="btn "+(t[0][22]>0?"green":"disabled")+" svgicon statbtn svelte-rbq5ku"))&&p(n,"class",s)},i(f){i||(S(e.$$.fragment,f),i=!0)},o(f){E(e.$$.fragment,f),i=!1},d(f){f&&x(n),Z(e,f),r=!1,rt(l)}}}function jF(t){let e,n;return e=new Mo({props:{descPos:"left:100%;top:0;",item:t[18],invslot:101+t[20]}}),e.$on("use",XF),e.$on("context",XF),e.$on("move",iL),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&64&&(i.item=o[18]),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function WF(t){let e,n;return e=new Ld({props:{id:t[15],relmap:kv,relation:t[1]}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&2&&(i.relation=o[1]),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function GF(t){let e,n,o=me(t[12]),s=[];for(let r=0;r<o.length;r+=1)s[r]=WF(BF(t,o,r));let i=r=>E(s[r],1,1,()=>{s[r]=null});return{c(){e=h("div");for(let r=0;r<s.length;r+=1)s[r].c();p(e,"class","statcol panel-black svelte-rbq5ku")},m(r,l){w(r,e,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null);n=!0},p(r,l){if(l&2){o=me(r[12]);let a;for(a=0;a<o.length;a+=1){let c=BF(r,o,a);s[a]?(s[a].p(c,l),S(s[a],1)):(s[a]=WF(c),s[a].c(),S(s[a],1),s[a].m(e,null))}for(we(),a=o.length;a<s.length;a+=1)i(a);Me()}},i(r){if(!n){for(let l=0;l<o.length;l+=1)S(s[l]);n=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)E(s[l]);n=!1},d(r){r&&x(e),ot(s,r)}}}function oL(t){let e,n,o,s,i=t[4].name+"",r,l,a,c=t[4].level+"",f,u,m,g,v,_,b=P.classes[t[4].class].name+"",k,y,F,A,C,M,D,$=P.factions[t[4].faction].name+"",V,z,q,L,U,W,R,N=dt(t[0][20]||0)+"",Y,_e,Fe=t[2]<_r?"/ "+ro(Di[t[2]]):"",he,ie,le=P.ui.charpanel.rank+"",ge,be,Te,se,Ie,K,Re,Ge,Qe,Ye,pe,ce,Oe,oe,ee,O,ue;Qe=new Vd({props:{amount:t[0][21]||0}}),pe=new gr({props:{amount:t[5],isPrice:!1}});let We=me([0,1,2,3,4,5]),ze=[];for(let xe=0;xe<6;xe+=1)ze[xe]=NF(UF(t,We,xe));let Ae=xe=>E(ze[xe],1,1,()=>{ze[xe]=null});oe=new Ld({props:{id:22}});let $e=me(t[6].filter(QF)),Ue=[];for(let xe=0;xe<$e.length;xe+=1)Ue[xe]=jF($F(t,$e,xe));let mt=xe=>E(Ue[xe],1,1,()=>{Ue[xe]=null}),wt=me(YF),Je=[];for(let xe=0;xe<wt.length;xe+=1)Je[xe]=GF(zF(t,wt,xe));let Et=xe=>E(Je[xe],1,1,()=>{Je[xe]=null});return{c(){e=h("div"),n=h("div"),o=h("span"),o.textContent=`${P.ui.charpanel.name}`,s=h("span"),r=T(i),l=h("span"),l.textContent=`${P.ui.charpanel.level}`,a=h("span"),f=T(c),u=h("span"),u.textContent=`${P.ui.charpanel.class}`,m=h("span"),g=h("img"),_=Ne(),k=T(b),F=h("span"),F.textContent=`${P.ui.charpanel.faction}`,A=h("span"),C=h("img"),D=Ne(),V=T($),q=h("span"),q.textContent=`${P.ui.stats.array[20]}`,L=h("span"),U=h("img"),R=Ne(),Y=T(N),_e=Ne(),he=T(Fe),ie=T(" ("),ge=T(le),be=Ne(),Te=T(t[2]),se=T("/"),Ie=T(_r),K=T(")"),Re=h("span"),Re.textContent=`${P.ui.charpanel.rating}`,Ge=h("span"),J(Qe.$$.fragment),Ye=h("span"),Ye.textContent=`${P.ui.charpanel.medals}`,J(pe.$$.fragment),ce=h("div");for(let xe=0;xe<6;xe+=1)ze[xe].c();Oe=de(),J(oe.$$.fragment),ee=h("div");for(let xe=0;xe<Ue.length;xe+=1)Ue[xe].c();O=h("div");for(let xe=0;xe<Je.length;xe+=1)Je[xe].c();p(s,"class","bold textwhite"),p(a,"class","bold textwhite"),p(g,"class","texticon"),at(g.src,v=ni(t[4].class))||p(g,"src",v),p(m,"class",y="bold "+("textc"+t[4].class)+" svelte-rbq5ku"),p(C,"class","texticon"),at(C.src,M=H1(t[4].faction))||p(C,"src",M),p(A,"class",z="bold "+("textf"+t[4].faction)+" svelte-rbq5ku"),p(U,"class","texticon"),at(U.src,W=Ya)||p(U,"src",W),p(L,"class","bold textprestige"),p(n,"class","statcol panel-black svelte-rbq5ku"),Le(n,"grid-template-columns","1fr 2fr"),p(ce,"id","statpoints"),p(ce,"class","statcol panel-black svelte-rbq5ku"),Le(ce,"grid-template-columns","1fr auto auto"),p(e,"class","grid"),Le(e,"grid-template-columns","3fr 2fr"),p(ee,"id","equipslots"),p(ee,"class","items svelte-rbq5ku"),p(O,"class","grid three stats2 svelte-rbq5ku")},m(xe,Ke){w(xe,e,Ke),d(e,n),d(n,o),d(n,s),d(s,r),d(n,l),d(n,a),d(a,f),d(n,u),d(n,m),d(m,g),d(m,_),d(m,k),d(n,F),d(n,A),d(A,C),d(A,D),d(A,V),d(n,q),d(n,L),d(L,U),d(L,R),d(L,Y),d(L,_e),d(L,he),d(L,ie),d(L,ge),d(L,be),d(L,Te),d(L,se),d(L,Ie),d(L,K),d(n,Re),d(n,Ge),Q(Qe,Ge,null),d(n,Ye),Q(pe,n,null),d(e,ce);for(let bt=0;bt<6;bt+=1)ze[bt]&&ze[bt].m(ce,null);d(ce,Oe),Q(oe,ce,null),w(xe,ee,Ke);for(let bt=0;bt<Ue.length;bt+=1)Ue[bt]&&Ue[bt].m(ee,null);w(xe,O,Ke);for(let bt=0;bt<Je.length;bt+=1)Je[bt]&&Je[bt].m(O,null);ue=!0},p(xe,Ke){(!ue||Ke&16)&&i!==(i=xe[4].name+"")&&G(r,i),(!ue||Ke&16)&&c!==(c=xe[4].level+"")&&G(f,c),(!ue||Ke&16&&!at(g.src,v=ni(xe[4].class)))&&p(g,"src",v),(!ue||Ke&16)&&b!==(b=P.classes[xe[4].class].name+"")&&G(k,b),(!ue||Ke&16&&y!==(y="bold "+("textc"+xe[4].class)+" svelte-rbq5ku"))&&p(m,"class",y),(!ue||Ke&16&&!at(C.src,M=H1(xe[4].faction)))&&p(C,"src",M),(!ue||Ke&16)&&$!==($=P.factions[xe[4].faction].name+"")&&G(V,$),(!ue||Ke&16&&z!==(z="bold "+("textf"+xe[4].faction)+" svelte-rbq5ku"))&&p(A,"class",z),(!ue||Ke&1)&&N!==(N=dt(xe[0][20]||0)+"")&&G(Y,N),(!ue||Ke&4)&&Fe!==(Fe=xe[2]<_r?"/ "+ro(Di[xe[2]]):"")&&G(he,Fe),(!ue||Ke&4)&&G(Te,xe[2]);let bt={};Ke&1&&(bt.amount=xe[0][21]||0),Qe.$set(bt);let Ct={};if(Ke&32&&(Ct.amount=xe[5]),pe.$set(Ct),Ke&131){We=me([0,1,2,3,4,5]);let Ve;for(Ve=0;Ve<6;Ve+=1){let ye=UF(xe,We,Ve);ze[Ve]?(ze[Ve].p(ye,Ke),S(ze[Ve],1)):(ze[Ve]=NF(ye),ze[Ve].c(),S(ze[Ve],1),ze[Ve].m(ce,Oe))}for(we(),Ve=6;Ve<6;Ve+=1)Ae(Ve);Me()}if(Ke&64){$e=me(xe[6].filter(QF));let Ve;for(Ve=0;Ve<$e.length;Ve+=1){let ye=$F(xe,$e,Ve);Ue[Ve]?(Ue[Ve].p(ye,Ke),S(Ue[Ve],1)):(Ue[Ve]=jF(ye),Ue[Ve].c(),S(Ue[Ve],1),Ue[Ve].m(ee,null))}for(we(),Ve=$e.length;Ve<Ue.length;Ve+=1)mt(Ve);Me()}if(Ke&2){wt=me(YF);let Ve;for(Ve=0;Ve<wt.length;Ve+=1){let ye=zF(xe,wt,Ve);Je[Ve]?(Je[Ve].p(ye,Ke),S(Je[Ve],1)):(Je[Ve]=GF(ye),Je[Ve].c(),S(Je[Ve],1),Je[Ve].m(O,null))}for(we(),Ve=wt.length;Ve<Je.length;Ve+=1)Et(Ve);Me()}},i(xe){if(!ue){S(Qe.$$.fragment,xe),S(pe.$$.fragment,xe);for(let Ke=0;Ke<6;Ke+=1)S(ze[Ke]);S(oe.$$.fragment,xe);for(let Ke=0;Ke<$e.length;Ke+=1)S(Ue[Ke]);for(let Ke=0;Ke<wt.length;Ke+=1)S(Je[Ke]);ue=!0}},o(xe){E(Qe.$$.fragment,xe),E(pe.$$.fragment,xe),ze=ze.filter(Boolean);for(let Ke=0;Ke<6;Ke+=1)E(ze[Ke]);E(oe.$$.fragment,xe),Ue=Ue.filter(Boolean);for(let Ke=0;Ke<Ue.length;Ke+=1)E(Ue[Ke]);Je=Je.filter(Boolean);for(let Ke=0;Ke<Je.length;Ke+=1)E(Je[Ke]);ue=!1},d(xe){xe&&(x(e),x(ee),x(O)),Z(Qe),Z(pe),ot(ze,xe),Z(oe),ot(Ue,xe),ot(Je,xe)}}}function sL(t){let e,n,o=t[3]&&t[4].visible&&OF(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[3]&&s[4].visible?o?(o.p(s,i),i&24&&S(o,1)):(o=OF(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}var HF=!1,kv=new Map;vv.forEach((t,e)=>{let n=new Map;t.forEach((o,s)=>{n.set(s,o)}),kv.set(e,n)});var YF=[[6,8,7,9,12,13],[10,11,17,14,16],[15,19,18,25,26]],iL=t=>{let{from:e,to:n}=t.detail;e!==n&&e.type=="item"&&yt("itemmove",`${e.slot} ${n.slot}`)},XF=t=>{let{item:e}=t.detail;if(e!==void 0){let n=I.player.inventory.getFirstEmptySlot();n>=0&&yt("itemmove",`${t.detail.slot} ${n}`)}},QF=(t,e)=>e>=101;function rL(t,e,n){let o,s,i,r,l,a;re(t,Hi,_=>n(0,s=_)),re(t,ki,_=>n(3,i=_)),re(t,Ws,_=>n(4,r=_)),re(t,fa,_=>n(5,l=_)),re(t,ua,_=>n(6,a=_)),I&&I.player&&!HF&&(HF=!0,yl.forEach((_,b)=>{b-61==I.player.class&&_.statsConvert&&_.statsConvert.forEach(k=>{let y=vv.get(k[0])||new Map;y.set(k[2],(y.get(k[2])||0)+k[1]),kv.set(k[0],y)})}));let c,f=_=>{s[22]&&(yt("statincrease",_+" "+(nt.shift.down?10:1)),n(1,c=void 0),an(15,50))},u=(_,b)=>n(1,c=_),m=_=>n(1,c=void 0),g=(_,b)=>f(_),v=()=>{Xe(ki,i=!1,i)};return t.$$.update=()=>{t.$$.dirty&1&&n(2,o=lc(s[20]||0))},[s,c,o,i,r,l,a,f,u,m,g,v]}var yv=class extends Ce{constructor(e){super(),Pe(this,e,rL,sL,Be,{})}},ZF=yv;var zd={normal:{partyBasedHostility:!1,pvpprotect:!0,instanced:!1},arena3v3:{name:"Arena 3v3",queue:!0,instanced:!0,groupsize:3,groupcount:2,partyBasedHostility:!0,pvpprotect:!1,startTimer:30},arena5v5:{name:"Arena 5v5",startTimer:30,groupsize:5,groupcount:2,queue:!0,instanced:!0,partyBasedHostility:!0,pvpprotect:!1}};function JF(t,e,n){let o=t.slice();return o[16]=e[n],o}function lL(t){let e,n,o=t[4].listed?"\u{1F441}\uFE0F ":"",s,i=t[2].membercount+"",r,l,a,c,f;return{c(){e=h("div"),n=h("span"),s=T(o),r=T(i),l=T("/10"),p(e,"id","partybtn"),p(e,"class",a="btn border black textgreen "+(t[4].flashing?"flashing-border":""))},m(u,m){w(u,e,m),d(e,n),d(n,s),d(e,r),d(e,l),c||(f=H(e,"click",t[11]),c=!0)},p(u,m){m&16&&o!==(o=u[4].listed?"\u{1F441}\uFE0F ":"")&&G(s,o),m&4&&i!==(i=u[2].membercount+"")&&G(r,i),m&16&&a!==(a="btn border black textgreen "+(u[4].flashing?"flashing-border":""))&&p(e,"class",a)},d(u){u&&x(e),c=!1,f()}}}function aL(t){let e,n,o;return{c(){e=h("div"),e.textContent=`${P.ui.party.noParty}`,p(e,"id","partybtn"),p(e,"class","btn border black textgrey")},m(s,i){w(s,e,i),n||(o=H(e,"click",t[10]),n=!0)},p:ae,d(s){s&&x(e),n=!1,o()}}}function cL(t){let e=t[2].exprate+"",n,o,s=t[2].membercount===0?"":"/"+t[2].nearby,i;return{c(){n=T(e),o=T("% EXP"),i=T(s)},m(r,l){w(r,n,l),w(r,o,l),w(r,i,l)},p(r,l){l&4&&e!==(e=r[2].exprate+"")&&G(n,e),l&4&&s!==(s=r[2].membercount===0?"":"/"+r[2].nearby)&&G(i,s)},d(r){r&&(x(n),x(o),x(i))}}}function fL(t){let e=dt(~~t[1].exph)+"",n,o;return{c(){n=T(e),o=T(" EXP / h")},m(s,i){w(s,n,i),w(s,o,i)},p(s,i){i&2&&e!==(e=dt(~~s[1].exph)+"")&&G(n,e)},d(s){s&&(x(n),x(o))}}}function uL(t){let e=t[2].itemfind+"",n,o;return{c(){n=T(e),o=T("% FIND")},m(s,i){w(s,n,i),w(s,o,i)},p(s,i){i&4&&e!==(e=s[2].itemfind+"")&&G(n,e)},i:ae,o:ae,d(s){s&&(x(n),x(o))}}}function mL(t){let e,n,o;return e=new xn({props:{amount:Math.round(t[0].gph)}}),{c(){J(e.$$.fragment),n=T(" / h")},m(s,i){Q(e,s,i),w(s,n,i),o=!0},p(s,i){let r={};i&1&&(r.amount=Math.round(s[0].gph)),e.$set(r)},i(s){o||(S(e.$$.fragment,s),o=!0)},o(s){E(e.$$.fragment,s),o=!1},d(s){s&&x(n),Z(e,s)}}}function KF(t,e){let n,o,s;return o=new mu({props:{mode:"party",unit:e[16].unitStore,buffs:e[16].buffStore}}),{key:t,first:null,c(){n=de(),J(o.$$.fragment),this.first=n},m(i,r){w(i,n,r),Q(o,i,r),s=!0},p(i,r){e=i;let l={};r&256&&(l.unit=e[16].unitStore),r&256&&(l.buffs=e[16].buffStore),o.$set(l)},i(i){s||(S(o.$$.fragment,i),s=!0)},o(i){E(o.$$.fragment,i),s=!1},d(i){i&&x(n),Z(o,i)}}}function pL(t){let e,n,o,s,i,r,l,a,c,f=[],u=new Map,m,g,v;function _(z,q){return z[2].membercount===0?aL:lL}let b=_(t,-1),k=b(t);function y(z,q){return z[5]?fL:cL}let F=y(t,-1),A=F(t),C=[mL,uL],M=[];function D(z,q){return z[6]?0:1}r=D(t,-1),l=M[r]=C[r](t);let $=me(t[8]),V=z=>z[16].name;for(let z=0;z<$.length;z+=1){let q=JF(t,$,z),L=V(q);u.set(L,f[z]=KF(L,q))}return{c(){e=h("div"),n=h("div"),o=h("div"),o.textContent=`\u{1F465} ${P.ui.party.name}`,k.c(),s=h("div"),A.c(),i=h("div"),l.c(),a=Ne(),c=h("div");for(let z=0;z<f.length;z+=1)f[z].c();p(o,"class","btn party"),p(s,"class","btn border black textexp"),p(i,"class","btn border black textcyan"),p(n,"class","btnbar"),p(c,"class","partyframes svelte-1xmlhk"),Le(c,"width",t[7]+"px"),p(e,"class","l-corner-ul uiscaled")},m(z,q){w(z,e,q),d(e,n),d(n,o),k.m(n,null),d(n,s),A.m(s,null),d(n,i),M[r].m(i,null),d(e,a),d(e,c);for(let L=0;L<f.length;L+=1)f[L]&&f[L].m(c,null);m=!0,g||(v=[H(o,"click",t[9]),H(s,"click",t[12]),H(s,"contextmenu",du),H(i,"click",t[13]),H(i,"contextmenu",du)],g=!0)},p(z,[q]){b===(b=_(z,q))&&k?k.p(z,q):(k.d(1),k=b(z),k&&(k.c(),k.m(n,s))),F===(F=y(z,q))&&A?A.p(z,q):(A.d(1),A=F(z),A&&(A.c(),A.m(s,null)));let L=r;r=D(z,q),r===L?M[r].p(z,q):(we(),E(M[L],1,1,()=>{M[L]=null}),Me(),l=M[r],l?l.p(z,q):(l=M[r]=C[r](z),l.c()),S(l,1),l.m(i,null)),q&256&&($=me(z[8]),we(),f=En(f,q,V,1,z,$,u,c,Hn,KF,null,JF),Me()),(!m||q&128)&&Le(c,"width",z[7]+"px")},i(z){if(!m){S(l);for(let q=0;q<$.length;q+=1)S(f[q]);m=!0}},o(z){E(l);for(let q=0;q<f.length;q+=1)E(f[q]);m=!1},d(z){z&&x(e),k.d(),A.d(),M[r].d();for(let q=0;q<f.length;q+=1)f[q].d();g=!1,rt(v)}}}function dL(t,e,n){let o,s,i,r,l,a,c,f,u;re(t,Fm,F=>n(0,o=F)),re(t,Cm,F=>n(1,s=F)),re(t,eo,F=>n(2,i=F)),re(t,es,F=>n(3,r=F)),re(t,Qo,F=>n(4,l=F)),re(t,uf,F=>n(5,a=F)),re(t,ff,F=>n(6,c=F)),re(t,Kr,F=>n(7,f=F)),re(t,aa,F=>n(8,u=F));let m=F=>{let A=[{name:"Party Panel",fun:()=>{Xe(es,r=!0,r)}},i.membercount?Wt.partyleave():Wt.partycreate()];dn.set({x:F.pageX,y:F.pageY,opts:A})},g=()=>{console.log(s)},v=()=>{console.log(o)};return[o,s,i,r,l,a,c,f,u,m,F=>Xe(es,r=!r,r),F=>Xe(es,r=!r,r),F=>{Xe(uf,a=!a,a)},F=>{Xe(ff,c=!c,c)}]}var xv=class extends Ce{constructor(e){super(),Pe(this,e,dL,pL,Be,{})}},eC=xv;function hL(t){let e;return{c(){e=h("div"),p(e,"class","pattern svelte-1m0q37p")},m(n,o){w(n,e,o)},p:ae,d(n){n&&x(e)}}}function gL(t){let e,n,o;return n=new xo({props:{size:"0.8em",fract:t[0],barcol:"bgexp",left:t[1],right:`${t[0]}%`,$$slots:{default:[hL]},$$scope:{ctx:t}}}),{c(){e=h("div"),J(n.$$.fragment),p(e,"id","expbar"),p(e,"class","container svelte-1m0q37p")},m(s,i){w(s,e,i),Q(n,e,null),o=!0},p(s,[i]){let r={};i&1&&(r.fract=s[0]),i&2&&(r.left=s[1]),i&1&&(r.right=`${s[0]}%`),i&8&&(r.$$scope={dirty:i,ctx:s}),n.$set(r)},i(s){o||(S(n.$$.fragment,s),o=!0)},o(s){E(n.$$.fragment,s),o=!1},d(s){s&&x(e),Z(n)}}}function vL(t,e,n){let o;re(t,_m,r=>n(2,o=r));let s,i;return t.$$.update=()=>{t.$$.dirty&4&&(n(0,s=(100*o.current/o.max).toFixed(2)),n(1,i=`${dt(o.current)} / ${dt(o.max)} EXP`))},[s,i,o]}var wv=class extends Ce{constructor(e){super(),Pe(this,e,vL,gL,Be,{})}},tC=wv;function nC(t){let e,n,o=t[5].msg+"",s,i,r,l=(t[5].fixed||t[5].step)&&oC(t),a=t[5].click&&sC(t);return{c(){e=h("div"),n=h("div"),l&&l.c(),s=de(),a&&a.c(),p(n,"class","textprimary msgtext svelte-ocy2wa"),p(e,"class",i="msg "+(t[5].complete?"complete":"")+" svelte-ocy2wa")},m(c,f){w(c,e,f),d(e,n),n.innerHTML=o,l&&l.m(e,null),d(e,s),a&&a.m(e,null),r=!0},p(c,f){(!r||f&32)&&o!==(o=c[5].msg+"")&&(n.innerHTML=o),c[5].fixed||c[5].step?l?(l.p(c,f),f&32&&S(l,1)):(l=oC(c),l.c(),S(l,1),l.m(e,s)):l&&(we(),E(l,1,1,()=>{l=null}),Me()),c[5].click?a||(a=sC(c),a.c(),a.m(e,null)):a&&(a.d(1),a=null),(!r||f&32&&i!==(i="msg "+(c[5].complete?"complete":"")+" svelte-ocy2wa"))&&p(e,"class",i)},i(c){r||(S(l),r=!0)},o(c){E(l),r=!1},d(c){c&&x(e),l&&l.d(),a&&a.d()}}}function oC(t){let e,n;return e=new xo({props:{size:"0.8em",fract:t[5].progress,barcol:"bgtut",left:"",right:Math.ceil(t[5].progress)+"%"}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&32&&(i.fract=o[5].progress),s&32&&(i.right=Math.ceil(o[5].progress)+"%"),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function sC(t){let e,n,o,s;return{c(){e=h("div"),n=h("div"),n.textContent="Okay",p(n,"class","btn green"),p(e,"class","marg-top"),Le(e,"display","flex"),Le(e,"flex-direction","row-reverse")},m(i,r){w(i,e,r),d(e,n),o||(s=H(n,"click",t[6]),o=!0)},d(i){i&&x(e),o=!1,s()}}}function iC(t){let e,n;return{c(){e=h("div"),p(e,"class",n="border skill tut "+(t[5].complete?"complete":"")+" svelte-ocy2wa"),Le(e,"top",t[2]+"px"),Le(e,"left",t[1]+"px"),Le(e,"width",t[3]+"px"),Le(e,"height",t[4]+"px")},m(o,s){w(o,e,s)},p(o,s){s&32&&n!==(n="border skill tut "+(o[5].complete?"complete":"")+" svelte-ocy2wa")&&p(e,"class",n),s&4&&Le(e,"top",o[2]+"px"),s&2&&Le(e,"left",o[1]+"px"),s&8&&Le(e,"width",o[3]+"px"),s&16&&Le(e,"height",o[4]+"px")},d(o){o&&x(e)}}}function _L(t){let e,n,o,s=t[5]&&t[5].msg&&nC(t),i=t[0]&&iC(t);return{c(){s&&s.c(),e=de(),i&&i.c(),n=de()},m(r,l){s&&s.m(r,l),w(r,e,l),i&&i.m(r,l),w(r,n,l),o=!0},p(r,[l]){r[5]&&r[5].msg?s?(s.p(r,l),l&32&&S(s,1)):(s=nC(r),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(we(),E(s,1,1,()=>{s=null}),Me()),r[0]?i?i.p(r,l):(i=iC(r),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},i(r){o||(S(s),o=!0)},o(r){E(s),o=!1},d(r){r&&(x(e),x(n)),s&&s.d(r),i&&i.d(r)}}}function bL(t,e,n){let o;re(t,Wi,f=>n(5,o=f));let s=!1,i,r,l,a;return Wi.subscribe(f=>{if(f){let u=document.getElementById(f.element);if(u){n(0,s=!0);let m=u.getBoundingClientRect();n(3,l=m.width+10),n(4,a=m.height+10),n(1,i=m.x-5),n(2,r=m.y-5)}else n(0,s=!1)}else n(0,s=!1)}),[s,i,r,l,a,o,f=>{an(-1,1e4)}]}var Mv=class extends Ce{constructor(e){super(),Pe(this,e,bL,_L,Be,{})}},rC=Mv;function yL(t,e,n){let o=t.slice();return o[7]=e[n],o[9]=n,o}function lC(t){let e,n;return e=new $t({props:{zindex:8,origin:"center",title:"Report a player",$$slots:{default:[ML]},$$scope:{ctx:t}}}),e.$on("close",t[4]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&1031&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function kL(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[7]}`,e.__value=n=t[9],je(e,e.__value)},m(o,s){w(o,e,s)},p:ae,d(o){o&&x(e)}}}function aC(t){let e,n=t[2].info+"",o;return{c(){e=h("p"),o=T(n),p(e,"class","textprimary")},m(s,i){w(s,e,i),d(e,o)},p(s,i){i&4&&n!==(n=s[2].info+"")&&G(o,n)},d(s){s&&x(e)}}}function xL(t){let e,n=(t[0].result==="ok"?"Report submitted.":t[0].result)+"",o,s,i,r,l,a;return{c(){e=h("p"),o=T(n),i=h("div"),r=h("div"),r.textContent="Close",p(e,"class",s=t[0].result==="ok"?"textgreen":"textred"),p(r,"class","btn grey navbtn"),p(i,"class","subnav")},m(c,f){w(c,e,f),d(e,o),w(c,i,f),d(i,r),l||(a=H(r,"click",t[4]),l=!0)},p(c,f){f&1&&n!==(n=(c[0].result==="ok"?"Report submitted.":c[0].result)+"")&&G(o,n),f&1&&s!==(s=c[0].result==="ok"?"textgreen":"textred")&&p(e,"class",s)},d(c){c&&(x(e),x(i)),l=!1,a()}}}function wL(t){let e,n,o,s,i,r,l,a,c;return{c(){e=h("div"),n=h("div"),o=T("Report"),i=h("div"),r=T("Cancel"),p(n,"class",s="btn grey navbtn "+(t[1]?"disabled":"")),p(i,"class",l="btn grey navbtn "+(t[1]?"disabled":"")),p(e,"class","subnav")},m(f,u){w(f,e,u),d(e,n),d(n,o),d(e,i),d(i,r),a||(c=[H(n,"click",t[3]),H(i,"click",t[4])],a=!0)},p(f,u){u&2&&s!==(s="btn grey navbtn "+(f[1]?"disabled":""))&&p(n,"class",s),u&2&&l!==(l="btn grey navbtn "+(f[1]?"disabled":""))&&p(i,"class",l)},d(f){f&&x(e),a=!1,rt(c)}}}function ML(t){let e,n,o,s,i=t[2].name+"",r,l,a,c,f,u,m,g=P.ui.report.info[t[2].reason]+"",v,_,b,k,y,F,A,C,M=me(P.ui.report.reasons),D=[];for(let L=0;L<M.length;L+=1)D[L]=kL(yL(t,M,L));let $=t[2].info&&aC(t);function V(L,U){return L[0]?xL:wL}let z=V(t,-1),q=z(t);return{c(){e=h("div"),n=h("p"),o=T("Describe what happened with "),s=h("span"),r=T(i),l=T(" as accurately as you can:"),a=h("div"),c=h("select");for(let L=0;L<D.length;L+=1)D[L].c();u=h("p"),m=h("small"),v=T(g),$&&$.c(),_=h("div"),b=h("textarea"),F=h("p"),F.innerHTML='<small>Please do not file false reports. If you are unsure about a players behavior, refer to our <a href="/terms" target="_blank">Conduct Policy</a>.</small>',q.c(),p(s,"class","textprimary"),p(c,"class",f=t[1]?"disabled":""),t[2].reason===void 0&&bn(()=>t[5].call(c)),p(a,"class","subnav"),p(u,"class","textgrey"),p(b,"maxlength",k=300),p(b,"class",y="scrollbar reportdescription "+(t[1]?"disabled":"")+" svelte-jnzoj3"),p(b,"rows","4"),p(b,"placeholder","Provide additional context, a little description of the situation helps our moderators."),p(_,"class","subnav"),p(F,"class","textgrey"),p(e,"class","card container svelte-jnzoj3")},m(L,U){w(L,e,U),d(e,n),d(n,o),d(n,s),d(s,r),d(n,l),d(e,a),d(a,c);for(let W=0;W<D.length;W+=1)D[W]&&D[W].m(c,null);Mn(c,t[2].reason,!0),d(e,u),d(u,m),d(m,v),$&&$.m(e,null),d(e,_),d(_,b),je(b,t[2].description),d(e,F),q.m(e,null),A||(C=[H(c,"change",t[5]),H(b,"input",t[6])],A=!0)},p(L,U){U&4&&i!==(i=L[2].name+"")&&G(r,i),U&2&&f!==(f=L[1]?"disabled":"")&&p(c,"class",f),U&4&&Mn(c,L[2].reason),U&4&&g!==(g=P.ui.report.info[L[2].reason]+"")&&G(v,g),L[2].info?$?$.p(L,U):($=aC(L),$.c(),$.m(e,_)):$&&($.d(1),$=null),U&2&&y!==(y="scrollbar reportdescription "+(L[1]?"disabled":"")+" svelte-jnzoj3")&&p(b,"class",y),U&4&&je(b,L[2].description),z===(z=V(L,U))&&q?q.p(L,U):(q.d(1),q=z(L),q&&(q.c(),q.m(e,null)))},d(L){L&&x(e),ot(D,L),$&&$.d(),q.d(),A=!1,rt(C)}}}function FL(t){let e,n,o=t[2]!==void 0&&lC(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[2]!==void 0?o?(o.p(s,i),i&4&&S(o,1)):(o=lC(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function CL(t,e,n){let o;re(t,mi,f=>n(2,o=f));let s,i=!1,r=async()=>{n(1,i=!0),n(0,s=await Ft("/api/report/submit",{name:o.name,reason:o.reason,messageId:o.messageId,description:o.description||""}))},l=()=>{Xe(mi,o=void 0,o),n(0,s=void 0),n(1,i=void 0)};function a(){o.reason=Co(this),mi.set(o)}function c(){o.description=this.value,mi.set(o)}return[s,i,o,r,l,a,c]}var Fv=class extends Ce{constructor(e){super(),Pe(this,e,CL,FL,Be,{})}},cC=Fv;var xl=t=>Math.round((10+t*5)**1.85/50)*50,wl=t=>Math.min(100,8+t*2);var fC=(t,e=200)=>{let n;return(o,s)=>{n&&clearTimeout(n),n=setTimeout(i=>t(o),s??e)}};function uC(t,e,n){let o=t.slice();return o[17]=e[n],o[19]=n,o}function mC(t){let e,n,o,s=me(t[1]),i=[];for(let a=0;a<s.length;a+=1)i[a]=dC(uC(t,s,a));let r=a=>E(i[a],1,1,()=>{i[a]=null}),l=null;return s.length||(l=pC(t)),{c(){e=h("div");for(let a=0;a<i.length;a+=1)i[a].c();n=de(),l&&l.c(),p(e,"class","divider")},m(a,c){w(a,e,c);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(a,c);w(a,n,c),l&&l.m(a,c),o=!0},p(a,c){if(c&74){s=me(a[1]);let f;for(f=0;f<s.length;f+=1){let u=uC(a,s,f);i[f]?(i[f].p(u,c),S(i[f],1)):(i[f]=dC(u),i[f].c(),S(i[f],1),i[f].m(n.parentNode,n))}for(we(),f=s.length;f<i.length;f+=1)r(f);Me(),!s.length&&l?l.p(a,c):s.length?l&&(l.d(1),l=null):(l=pC(a),l.c(),l.m(n.parentNode,n))}},i(a){if(!o){for(let c=0;c<s.length;c+=1)S(i[c]);o=!0}},o(a){i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)E(i[c]);o=!1},d(a){a&&(x(e),x(n)),ot(i,a),l&&l.d(a)}}}function pC(t){let e;return{c(){e=h("div"),e.textContent="No results",p(e,"class","textgrey result")},m(n,o){w(n,e,o)},p:ae,d(n){n&&x(e)}}}function dC(t){let e,n,o,s,i,r,l=[t[17]],a={};for(let f=0;f<l.length;f+=1)a=Zl(a,l[f]);n=new Xn({props:a});function c(...f){return t[14](t[19],...f)}return{c(){e=h("div"),J(n.$$.fragment),p(e,"class",o="result "+(t[19]===t[3]?"sel":""))},m(f,u){w(f,e,u),Q(n,e,null),s=!0,i||(r=H(e,"mousedown",c),i=!0)},p(f,u){t=f;let m=u&2?dm(l,[hm(t[17])]):{};n.$set(m),(!s||u&8&&o!==(o="result "+(t[19]===t[3]?"sel":"")))&&p(e,"class",o)},i(f){s||(S(n.$$.fragment,f),s=!0)},o(f){E(n.$$.fragment,f),s=!1},d(f){f&&x(e),Z(n),i=!1,r()}}}function SL(t){let e,n,o,s,i,r,l,a=t[2]&&mC(t);return{c(){e=h("div"),n=h("div"),o=h("input"),a&&a.c(),p(o,"placeholder","Name"),p(o,"type","text"),p(n,"class",s="container input "+(t[2]?"focus":"")),p(e,"class","finder")},m(c,f){w(c,e,f),d(e,n),d(n,o),t[10](o),je(o,t[0]),a&&a.m(n,null),i=!0,r||(l=[H(o,"input",t[11]),H(o,"input",t[5]),H(o,"focus",t[12]),H(o,"blur",t[13])],r=!0)},p(c,[f]){f&1&&o.value!==c[0]&&je(o,c[0]),c[2]?a?(a.p(c,f),f&4&&S(a,1)):(a=mC(c),a.c(),S(a,1),a.m(n,null)):a&&(we(),E(a,1,1,()=>{a=null}),Me()),(!i||f&4&&s!==(s="container input "+(c[2]?"focus":"")))&&p(n,"class",s)},i(c){i||(S(a),i=!0)},o(c){E(a),i=!1},d(c){c&&x(e),t[10](null),a&&a.d(),r=!1,rt(l)}}}function PL(t,e,n){let o=fC(async()=>{n(1,a=await Ft("api/playerinfo/search",{[r]:i,order:"name",limit:l})),g(a.findIndex(A=>A.name.toLowerCase()==i.toLowerCase()))}),{id:s}=e,{name:i=""}=e,{type:r="name"}=e,{limit:l=5}=e,a=[],c=!1,f=-1,u,m,g=A=>{n(3,f=A),f>=0&&(u=a[f],n(0,i=u.name),n(7,s=u.id))},v=A=>{A.target==m&&((A.keyCode===38||A.keyCode===40)&&a.length?(g(Pa(f+(A.keyCode===38?-1:1),a.length)),A.preventDefault()):(A.keyCode==13||A.keyCode==27)&&m.blur())};Fn(()=>{document.addEventListener("keydown",v)}),Tn(()=>{document.removeEventListener("keydown",v),n(4,m=void 0)});function _(A){qt[A?"unshift":"push"](()=>{m=A,n(4,m)})}function b(){i=this.value,n(0,i)}let k=A=>n(2,c=!0),y=A=>n(2,c=!1),F=(A,C)=>g(A);return t.$$set=A=>{"id"in A&&n(7,s=A.id),"name"in A&&n(0,i=A.name),"type"in A&&n(8,r=A.type),"limit"in A&&n(9,l=A.limit)},[i,a,c,f,m,o,g,s,r,l,_,b,k,y,F]}var Cv=class extends Ce{constructor(e){super(),Pe(this,e,PL,SL,Be,{id:7,name:0,type:8,limit:9})}},Ml=Cv;function hC(t,e,n){let o=t.slice();return o[24]=e[n],o[23]=n,o}function gC(t,e,n){let o=t.slice();return o[21]=e[n],o[23]=n,o}function vC(t,e,n){let o=t.slice();return o[26]=e[n],o[23]=n,o}function _C(t){let e,n,o,s,i,r,l,a,c=t[0].tag+"",f,u,m=t[0].name+"",g,v,_,b=P.factions[t[0].faction].name+"",k,y,F=P.ui.clan.heading+"",A,C,M,D,$,V,z,q,L=t[0].level+"",U,W,R,N=wl(t[0].level)+"",Y,_e,Fe,he,ie=wl(t[0].level+1)-wl(t[0].level)+"",le,ge,be=P.ui.clan.capacity+"",Te,se,Ie,K=t[0].tax+"",Re,Ge,Qe,Ye,pe,ce,Oe=t[0].members.length+"",oe,ee,O,ue=`${t[0].online} (+${t[0].online*60} EXP/h)`,We,ze,Ae,$e,Ue,mt,wt=dt(t[0].prestige)+"",Je,Et,xe,Ke,bt,Ct,Ve,ye,Vt,Ht,Lt,Rt,He,et;M=new xo({props:{size:"1em",fract:Math.ceil(t[0].exp/xl(t[0].level)*100),barcol:"bgpurp",left:`${dt(t[0].exp)} / ${dt(xl(t[0].level))} EXP`,right:`${Math.ceil(t[0].exp/xl(t[0].level)*100)}% `}}),xe=new xn({props:{amount:t[0].gold}});let Ee=t[0].role>-1&&bC(t),it=t[0].role>0&&yC(t),Ze=t[0].eligibleApply.length>0&&kC(t),ft=t[1]&&wC(t),wn=t[0].role>0&&MC(t),Is=[TL,AL],fo=[];function qo(pt,zt){return pt[6]=="members"?0:pt[6]=="applications"?1:-1}return~(Ht=qo(t,-1))&&(Lt=fo[Ht]=Is[Ht](t)),{c(){e=h("div"),n=h("div"),o=h("div"),s=h("img"),r=h("div"),l=h("div"),a=h("h1"),f=T(c),u=h("h3"),g=T(m),_=h("p"),k=T(b),y=Ne(),A=T(F),C=h("div"),J(M.$$.fragment),D=h("div"),$=h("div"),V=h("div"),z=h("span"),z.textContent=`${P.ui.clan.level}`,q=h("span"),U=T(L),W=h("span"),W.textContent=`${P.ui.clan.capacity}`,R=h("span"),Y=T(N),_e=h("span"),_e.textContent=`${P.ui.clan.nextlevel}`,Fe=h("span"),he=T("+"),le=T(ie),ge=Ne(),Te=T(be),se=h("span"),se.textContent=`${P.ui.clan.taxrate}`,Ie=h("span"),Re=T(K),Ge=T("%"),Qe=h("div"),Ye=h("div"),pe=h("span"),pe.textContent=`${P.ui.clan.members}`,ce=h("span"),oe=T(Oe),ee=h("span"),ee.textContent=`${P.ui.clan.online}`,O=h("span"),We=T(ue),ze=h("span"),ze.textContent=`${P.ui.stats.array[20]}`,Ae=h("span"),$e=h("img"),mt=Ne(),Je=T(wt),Et=h("span"),Et.textContent=`${P.ui.clan.treasury}`,J(xe.$$.fragment),Ee&&Ee.c(),Ke=de(),it&&it.c(),bt=de(),Ze&&Ze.c(),Ct=de(),ft&&ft.c(),Ve=h("div"),ye=h("div"),Vt=h("div"),Vt.textContent=`${P.ui.clan.members}`,wn&&wn.c(),Lt&&Lt.c(),p(s,"class","helmet absCentered svelte-6t8hqd"),at(s.src,i="/data/ui/factions/"+t[0].faction+".svg?v=8738303")||p(s,"src",i),p(l,"class",v="textf"+t[0].faction+" svelte-6t8hqd"),p(r,"class","textcenter"),p(o,"class","hero svelte-6t8hqd"),p(C,"class","panel-black svelte-6t8hqd"),p(z,"class","textprimary"),p(W,"class","textprimary"),p(_e,"class","textprimary"),p(se,"class","textprimary"),p(V,"class","panel-black grid two svelte-6t8hqd"),p(pe,"class","textprimary"),p(ee,"class","textprimary"),p(ze,"class","textprimary"),p($e,"class","svgicon"),at($e.src,Ue=Ya)||p($e,"src",Ue),p(Ae,"class","textprestige"),p(Et,"class","textprimary"),p(Ye,"class","panel-black grid two svelte-6t8hqd"),p(D,"class","marg-top grid two"),p(n,"class","row slim"),p(e,"class","fold fadeIn"),p(Vt,"class","btn navbtn grey"),p(ye,"class","subnav marg-top"),p(Ve,"class","row slim fadeIn")},m(pt,zt){w(pt,e,zt),d(e,n),d(n,o),d(o,s),d(o,r),d(r,l),d(l,a),d(a,f),d(l,u),d(u,g),d(r,_),d(_,k),d(_,y),d(_,A),d(n,C),Q(M,C,null),d(n,D),d(D,$),d($,V),d(V,z),d(V,q),d(q,U),d(V,W),d(V,R),d(R,Y),d(V,_e),d(V,Fe),d(Fe,he),d(Fe,le),d(Fe,ge),d(Fe,Te),d(V,se),d(V,Ie),d(Ie,Re),d(Ie,Ge),d(D,Qe),d(Qe,Ye),d(Ye,pe),d(Ye,ce),d(ce,oe),d(Ye,ee),d(Ye,O),d(O,We),d(Ye,ze),d(Ye,Ae),d(Ae,$e),d(Ae,mt),d(Ae,Je),d(Ye,Et),Q(xe,Ye,null),Ee&&Ee.m(n,null),d(n,Ke),it&&it.m(n,null),d(n,bt),Ze&&Ze.m(n,null),d(n,Ct),ft&&ft.m(n,null),w(pt,Ve,zt),d(Ve,ye),d(ye,Vt),wn&&wn.m(ye,null),~Ht&&fo[Ht].m(Ve,null),Rt=!0,He||(et=H(Vt,"click",t[14]),He=!0)},p(pt,zt){(!Rt||zt&1&&!at(s.src,i="/data/ui/factions/"+pt[0].faction+".svg?v=8738303"))&&p(s,"src",i),(!Rt||zt&1)&&c!==(c=pt[0].tag+"")&&G(f,c),(!Rt||zt&1)&&m!==(m=pt[0].name+"")&&G(g,m),(!Rt||zt&1&&v!==(v="textf"+pt[0].faction+" svelte-6t8hqd"))&&p(l,"class",v),(!Rt||zt&1)&&b!==(b=P.factions[pt[0].faction].name+"")&&G(k,b);let Ds={};zt&1&&(Ds.fract=Math.ceil(pt[0].exp/xl(pt[0].level)*100)),zt&1&&(Ds.left=`${dt(pt[0].exp)} / ${dt(xl(pt[0].level))} EXP`),zt&1&&(Ds.right=`${Math.ceil(pt[0].exp/xl(pt[0].level)*100)}% `),M.$set(Ds),(!Rt||zt&1)&&L!==(L=pt[0].level+"")&&G(U,L),(!Rt||zt&1)&&N!==(N=wl(pt[0].level)+"")&&G(Y,N),(!Rt||zt&1)&&ie!==(ie=wl(pt[0].level+1)-wl(pt[0].level)+"")&&G(le,ie),(!Rt||zt&1)&&K!==(K=pt[0].tax+"")&&G(Re,K),(!Rt||zt&1)&&Oe!==(Oe=pt[0].members.length+"")&&G(oe,Oe),(!Rt||zt&1)&&ue!==(ue=`${pt[0].online} (+${pt[0].online*60} EXP/h)`)&&G(We,ue),(!Rt||zt&1)&&wt!==(wt=dt(pt[0].prestige)+"")&&G(Je,wt);let Wn={};zt&1&&(Wn.amount=pt[0].gold),xe.$set(Wn),pt[0].role>-1?Ee?Ee.p(pt,zt):(Ee=bC(pt),Ee.c(),Ee.m(n,Ke)):Ee&&(Ee.d(1),Ee=null),pt[0].role>0?it?(it.p(pt,zt),zt&1&&S(it,1)):(it=yC(pt),it.c(),S(it,1),it.m(n,bt)):it&&(we(),E(it,1,1,()=>{it=null}),Me()),pt[0].eligibleApply.length>0?Ze?Ze.p(pt,zt):(Ze=kC(pt),Ze.c(),Ze.m(n,Ct)):Ze&&(Ze.d(1),Ze=null),pt[1]?ft?ft.p(pt,zt):(ft=wC(pt),ft.c(),ft.m(n,null)):ft&&(ft.d(1),ft=null),pt[0].role>0?wn?wn.p(pt,zt):(wn=MC(pt),wn.c(),wn.m(ye,null)):wn&&(wn.d(1),wn=null);let uo=Ht;Ht=qo(pt,zt),Ht===uo?~Ht&&fo[Ht].p(pt,zt):(Lt&&(we(),E(fo[uo],1,1,()=>{fo[uo]=null}),Me()),~Ht?(Lt=fo[Ht],Lt?Lt.p(pt,zt):(Lt=fo[Ht]=Is[Ht](pt),Lt.c()),S(Lt,1),Lt.m(Ve,null)):Lt=null)},i(pt){Rt||(S(M.$$.fragment,pt),S(xe.$$.fragment,pt),S(it),S(Lt),Rt=!0)},o(pt){E(M.$$.fragment,pt),E(xe.$$.fragment,pt),E(it),E(Lt),Rt=!1},d(pt){pt&&(x(e),x(Ve)),Z(M),Z(xe),Ee&&Ee.d(),it&&it.d(),Ze&&Ze.d(),ft&&ft.d(),wn&&wn.d(),~Ht&&fo[Ht].d(),He=!1,et()}}}function bC(t){let e,n,o,s=P.ui.clan.roles[t[0].role]+"",i;return{c(){e=h("div"),n=h("span"),n.textContent=`${P.ui.clan.highestrank}: `,o=h("span"),i=T(s),p(n,"class","textprimary"),p(o,"class","textgreen"),p(e,"class","marg-top panel-black svelte-6t8hqd")},m(r,l){w(r,e,l),d(e,n),d(e,o),d(o,i)},p(r,l){l&1&&s!==(s=P.ui.clan.roles[r[0].role]+"")&&G(i,s)},d(r){r&&x(e)}}}function yC(t){let e,n,o,s,i,r,l=P.ui.clan.inviteplayer+"",a,c,f,u,m;function g(_){t[12](_)}let v={};return t[4]!==void 0&&(v.name=t[4]),s=new Ml({props:v}),qt.push(()=>ps(s,"name",g)),{c(){e=h("div"),n=h("span"),n.textContent=`${P.ui.clan.inviteplayers}`,o=h("div"),J(s.$$.fragment),r=h("div"),a=T(l),p(n,"class","textgrey"),p(r,"class",c="btn formatted navbtn grey "+(t[3]||!t[4].length?"disabled":"")),p(o,"class","subnav"),p(e,"class","marg-top panel-black svelte-6t8hqd")},m(_,b){w(_,e,b),d(e,n),d(e,o),Q(s,o,null),d(o,r),d(r,a),f=!0,u||(m=H(r,"click",t[8]),u=!0)},p(_,b){let k={};!i&&b&16&&(i=!0,k.name=_[4],ms(()=>i=!1)),s.$set(k),(!f||b&24&&c!==(c="btn formatted navbtn grey "+(_[3]||!_[4].length?"disabled":"")))&&p(r,"class",c)},i(_){f||(S(s.$$.fragment,_),f=!0)},o(_){E(s.$$.fragment,_),f=!1},d(_){_&&x(e),Z(s),u=!1,m()}}}function kC(t){let e,n,o,s,i,r=P.ui.apply+"",l,a,c,f,u=me(t[0].eligibleApply),m=[];for(let g=0;g<u.length;g+=1)m[g]=xC(vC(t,u,g));return{c(){e=h("div"),n=h("span"),n.textContent=`${P.ui.clan.apply}`,o=h("div"),s=h("select");for(let g=0;g<m.length;g+=1)m[g].c();i=h("div"),l=T(r),p(n,"class","textgrey"),p(s,"class","navbtn"),t[5]===void 0&&bn(()=>t[13].call(s)),p(i,"class",a="btn formatted navbtn grey "+(t[3]||!t[5].length?"disabled":"")),p(o,"class","subnav"),p(e,"class","marg-top panel-black svelte-6t8hqd")},m(g,v){w(g,e,v),d(e,n),d(e,o),d(o,s);for(let _=0;_<m.length;_+=1)m[_]&&m[_].m(s,null);Mn(s,t[5],!0),d(o,i),d(i,l),c||(f=[H(s,"change",t[13]),H(i,"click",t[9])],c=!0)},p(g,v){if(v&33){u=me(g[0].eligibleApply);let _;for(_=0;_<u.length;_+=1){let b=vC(g,u,_);m[_]?m[_].p(b,v):(m[_]=xC(b),m[_].c(),m[_].m(s,null))}for(;_<m.length;_+=1)m[_].d(1);m.length=u.length}v&33&&Mn(s,g[5]),v&41&&a!==(a="btn formatted navbtn grey "+(g[3]||!g[5].length?"disabled":""))&&p(i,"class",a)},d(g){g&&x(e),ot(m,g),c=!1,rt(f)}}}function xC(t){let e,n=t[26]+"",o,s,i;return{c(){e=h("option"),o=T(n),e.selected=s=t[5]==t[26],e.__value=i=t[26],je(e,e.__value)},m(r,l){w(r,e,l),d(e,o)},p(r,l){l&1&&n!==(n=r[26]+"")&&G(o,n),l&33&&s!==(s=r[5]==r[26])&&(e.selected=s),l&1&&i!==(i=r[26])&&(e.__value=i,je(e,e.__value))},d(r){r&&x(e)}}}function wC(t){let e,n,o,s,i;return{c(){e=h("div"),n=h("span"),o=T(t[1]),p(n,"class",s="text"+t[2]+" svelte-6t8hqd"),p(e,"class",i="marg-top panel-black border "+t[2]+" svelte-6t8hqd")},m(r,l){w(r,e,l),d(e,n),d(n,o)},p(r,l){l&2&&G(o,r[1]),l&4&&s!==(s="text"+r[2]+" svelte-6t8hqd")&&p(n,"class",s),l&4&&i!==(i="marg-top panel-black border "+r[2]+" svelte-6t8hqd")&&p(e,"class",i)},d(r){r&&x(e)}}}function MC(t){let e,n=P.ui.clan.applications+"",o,s,i=t[0].applications.length+"",r,l,a,c,f;return{c(){e=h("div"),o=T(n),s=T(" ("),r=T(i),l=T(")"),a=Ne(),p(e,"class","btn navbtn grey")},m(u,m){w(u,e,m),d(e,o),d(e,s),d(e,r),d(e,l),w(u,a,m),c||(f=H(e,"click",t[15]),c=!0)},p(u,m){m&1&&i!==(i=u[0].applications.length+"")&&G(r,i)},d(u){u&&(x(e),x(a)),c=!1,f()}}}function AL(t){let e,n,o,s,i,r,l=[],a=new Map,c,f=me(t[0].applications),u=m=>m[24].name;for(let m=0;m<f.length;m+=1){let g=hC(t,f,m),v=u(g);a.set(v,l[m]=FC(v,g))}return{c(){e=h("div"),e.textContent=`${P.ui.clan.applicationdesc}`,n=h("table"),o=h("thead"),s=h("tr"),i=h("th"),i.textContent=`${P.ui.clan.player}`,r=h("tbody");for(let m=0;m<l.length;m+=1)l[m].c();p(e,"class","marg-top textgrey"),p(i,"width","70%"),p(s,"class","textprimary"),p(n,"class","marg-top panel-black svelte-6t8hqd")},m(m,g){w(m,e,g),w(m,n,g),d(n,o),d(o,s),d(s,i),d(n,r);for(let v=0;v<l.length;v+=1)l[v]&&l[v].m(r,null);c=!0},p(m,g){g&1025&&(f=me(m[0].applications),we(),l=En(l,g,u,1,m,f,a,r,Hn,FC,null,hC),Me())},i(m){if(!c){for(let g=0;g<f.length;g+=1)S(l[g]);c=!0}},o(m){for(let g=0;g<l.length;g+=1)E(l[g]);c=!1},d(m){m&&(x(e),x(n));for(let g=0;g<l.length;g+=1)l[g].d()}}}function TL(t){let e,n,o,s,i,r,l,a=[],c=new Map,f,u=me(t[0].members),m=g=>g[21].name;for(let g=0;g<u.length;g+=1){let v=gC(t,u,g),_=m(v);c.set(_,a[g]=CC(_,v))}return{c(){e=h("div"),e.textContent=`${P.ui.clan.memberdesc}`,n=h("table"),o=h("thead"),s=h("tr"),i=h("th"),i.textContent=`${P.ui.clan.roles[0]}`,r=h("th"),r.textContent=`${P.ui.clan.rank}`,l=h("tbody");for(let g=0;g<a.length;g+=1)a[g].c();p(e,"class","marg-top textgrey"),p(i,"width","70%"),p(s,"class","textprimary"),p(n,"class","marg-top panel-black svelte-6t8hqd")},m(g,v){w(g,e,v),w(g,n,v),d(n,o),d(o,s),d(s,i),d(s,r),d(n,l);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(l,null);f=!0},p(g,v){v&129&&(u=me(g[0].members),we(),a=En(a,v,m,1,g,u,c,l,Hn,CC,null,gC),Me())},i(g){if(!f){for(let v=0;v<u.length;v+=1)S(a[v]);f=!0}},o(g){for(let v=0;v<a.length;v+=1)E(a[v]);f=!1},d(g){g&&(x(e),x(n));for(let v=0;v<a.length;v+=1)a[v].d()}}}function FC(t,e){let n,o,s,i,r,l;s=new Xn({props:{name:e[24].name,pclass:e[24].class,level:e[24].level,faction:e[0].faction}});function a(...c){return e[17](e[24],...c)}return{key:t,first:null,c(){n=h("tr"),o=h("td"),J(s.$$.fragment),p(n,"class","striped"),this.first=n},m(c,f){w(c,n,f),d(n,o),Q(s,o,null),i=!0,r||(l=H(n,"mousedown",a),r=!0)},p(c,f){e=c;let u={};f&1&&(u.name=e[24].name),f&1&&(u.pclass=e[24].class),f&1&&(u.level=e[24].level),f&1&&(u.faction=e[0].faction),s.$set(u)},i(c){i||(S(s.$$.fragment,c),i=!0)},o(c){E(s.$$.fragment,c),i=!1},d(c){c&&x(n),Z(s),r=!1,l()}}}function CC(t,e){let n,o,s,i,r=e[21].online?"\u2B24":"",l,a=e[21].owned?"\u2B50":"",c,f,u=P.ui.clan.roles[e[21].clanrole]+"",m,g,v,_,b;s=new Xn({props:{name:e[21].name,pclass:e[21].class,level:e[21].level,faction:e[0].faction}});function k(...y){return e[16](e[21],...y)}return{key:t,first:null,c(){n=h("tr"),o=h("td"),J(s.$$.fragment),i=h("span"),l=T(r),c=T(a),f=h("td"),m=T(u),p(i,"class","textgreen"),p(n,"class",g="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"),this.first=n},m(y,F){w(y,n,F),d(n,o),Q(s,o,null),d(o,i),d(i,l),d(i,c),d(n,f),d(f,m),v=!0,_||(b=H(n,"mousedown",k),_=!0)},p(y,F){e=y;let A={};F&1&&(A.name=e[21].name),F&1&&(A.pclass=e[21].class),F&1&&(A.level=e[21].level),F&1&&(A.faction=e[0].faction),s.$set(A),(!v||F&1)&&r!==(r=e[21].online?"\u2B24":"")&&G(l,r),(!v||F&1)&&a!==(a=e[21].owned?"\u2B50":"")&&G(c,a),(!v||F&1)&&u!==(u=P.ui.clan.roles[e[21].clanrole]+"")&&G(m,u),(!v||F&1&&g!==(g="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"))&&p(n,"class",g)},i(y){v||(S(s.$$.fragment,y),v=!0)},o(y){E(s.$$.fragment,y),v=!1},d(y){y&&x(n),Z(s),_=!1,b()}}}function EL(t){let e,n,o=t[0]&&_C(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[0]?o?(o.p(s,i),i&1&&S(o,1)):(o=_C(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function IL(t,e,n){let{tag:o}=e,s,i,r=async()=>{let $=await Ft("/api/claninfo/info",{tag:o});$.name&&(n(0,s=$),s.eligibleApply.length&&n(5,v=s.eligibleApply[0]),n(0,s.online=s.members.filter(V=>V.online).length,s)),i&&(clearTimeout(i),i=setTimeout(r,5e3))};i=!0,r(),Tn(()=>{clearTimeout(i),i=void 0});let l=($,V)=>{let z=[];V.owned?z.push({name:P.ui.clan.leave,fun:async()=>{u(await Ft("/api/clan/leave",{name:V.name}),P.ui.clan.left)}}):V.clanrole<s.role&&z.push({name:P.ui.clan.kick,fun:async()=>{u(await Ft("/api/clan/kick",{name:V.name}),P.ui.clan.memberkicked)}});for(let q=0;q<(s.role==3?4:s.role);q++)z.push({name:P.ui.clan.setrank+": "+P.ui.clan.roles[q],fun:async()=>{u(await Ft("/api/clan/setrole",{name:V.name,role:q}),P.ui.clan.setrank+": "+P.ui.clan.roles[q])}});dn.set({x:$.pageX,y:$.pageY,opts:z})},a,c,f=!1,u=async($,V)=>{$.result!=="ok"?(n(1,a=$.result),n(2,c="red")):(n(1,a=V),n(2,c="green")),await r(),n(3,f=!1)},m="",g=async()=>{n(3,f=!0),u(await Ft("/api/clan/invite",{name:m,tag:o}),P.ui.clan.invited[0]+m+P.ui.clan.invited[1]),n(4,m="")},v="",_=async()=>{n(3,f=!0),u(await Ft("/api/clan/apply",{name:v,tag:o}),P.ui.clan.applied),n(5,v="")},b=($,V)=>{let z=[];s.role>0&&z.push({name:P.ui.clan.applicationaccept,fun:async()=>{u(await Ft("/api/clan/invite",{tag:o,name:V.name}),P.ui.clan.applicationaccepted)}}),s.role>1&&z.push({name:P.ui.clan.applicationdeny,fun:async()=>{u(await Ft("/api/clan/denyapplication",{id:V.id}),P.ui.clan.applicationdenied)}}),dn.set({x:$.pageX,y:$.pageY,opts:z})},k="members";function y($){m=$,n(4,m)}function F(){v=Co(this),n(5,v),n(0,s)}let A=$=>n(6,k="members"),C=$=>n(6,k="applications"),M=($,V)=>l(V,$),D=($,V)=>b(V,$);return t.$$set=$=>{"tag"in $&&n(11,o=$.tag)},[s,a,c,f,m,v,k,l,g,_,b,o,y,F,A,C,M,D]}var Sv=class extends Ce{constructor(e){super(),Pe(this,e,IL,EL,Be,{tag:11})}},SC=Sv;function DL(t){let e,n,o,s,i,r,l=P.ui.cost+"",a,c,f,u,m,g,v,_=P.ui.clan.createbutton+"",b,k,y,F,A;return f=new xn({props:{amount:1e5}}),{c(){e=h("h3"),e.textContent=`${P.ui.clan.createheading}`,n=h("label"),n.textContent=`${P.ui.clan.createname}`,o=h("input"),s=h("label"),s.textContent=`${P.ui.clan.createtag}`,i=h("input"),r=h("p"),a=T(l),c=T(": "),J(f.$$.fragment),m=h("div"),g=T(t[3]),v=h("div"),b=T(_),p(e,"class","textprimary"),p(n,"class","svelte-7uvqsx"),p(o,"type","text"),p(o,"placeholder","Guardians of Guardstone (a-Z)"),p(o,"maxlength","20"),p(s,"class","svelte-7uvqsx"),p(i,"type","text"),p(i,"placeholder","GoG (a-Z !~=#*+-)"),p(i,"maxlength","4"),p(r,"class",u="text"+(t[2]>1e5?"primary":"red")),p(m,"class","textred"),Le(v,"display","inline-block"),p(v,"class",k="btn marg-top formatted "+(t[4]?"blue":"blue disabled"))},m(C,M){w(C,e,M),w(C,n,M),w(C,o,M),je(o,t[0]),w(C,s,M),w(C,i,M),je(i,t[1]),w(C,r,M),d(r,a),d(r,c),Q(f,r,null),w(C,m,M),d(m,g),w(C,v,M),d(v,b),y=!0,F||(A=[H(o,"input",t[7]),H(i,"input",t[8]),H(v,"click",t[5])],F=!0)},p(C,[M]){M&1&&o.value!==C[0]&&je(o,C[0]),M&2&&i.value!==C[1]&&je(i,C[1]),(!y||M&4&&u!==(u="text"+(C[2]>1e5?"primary":"red")))&&p(r,"class",u),(!y||M&8)&&G(g,C[3]),(!y||M&16&&k!==(k="btn marg-top formatted "+(C[4]?"blue":"blue disabled")))&&p(v,"class",k)},i(C){y||(S(f.$$.fragment,C),y=!0)},o(C){E(f.$$.fragment,C),y=!1},d(C){C&&(x(e),x(n),x(o),x(s),x(i),x(r),x(m),x(v)),Z(f),F=!1,rt(A)}}}function VL(t,e,n){let o,s;re(t,Zo,m=>n(2,s=m));let i="",r="",l=!1,a="",c=async()=>{if(l)return;n(6,l=!0);let m=await Ft("/api/clan/create",{name:i,tag:r});m.result!=="ok"&&(n(3,a=m.result),n(6,l=!1))};function f(){i=this.value,n(0,i)}function u(){r=this.value,n(1,r)}return t.$$.update=()=>{t.$$.dirty&71&&n(4,o=!l&&s>=1e5&&i.length<=20&&i.length>=3&&r.length<=4&&r.length>=2)},[i,r,s,a,o,c,l,f,u]}var Pv=class extends Ce{constructor(e){super(),Pe(this,e,VL,DL,Be,{})}},PC=Pv;function AC(t,e,n){let o=t.slice();return o[4]=e[n],o[6]=n,o}function LL(t){let e,n,o;function s(...i){return t[2](t[4],...i)}return{c(){e=h("div"),e.textContent=`${P.ui.accept}`,p(e,"class","btn blue")},m(i,r){w(i,e,r),n||(o=H(e,"click",s),n=!0)},p(i,r){t=i},d(i){i&&x(e),n=!1,o()}}}function qL(t){let e;return{c(){e=h("div"),e.textContent=`${P.ui.clan.application}`},m(n,o){w(n,e,o)},p:ae,d(n){n&&x(e)}}}function TC(t,e){let n,o,s=e[4].tag+"",i,r,l=e[4].name+"",a,c;function f(g,v){return g[4].request?qL:LL}let u=f(e,-1),m=u(e);return{key:t,first:null,c(){n=h("tr"),o=h("td"),i=T(s),r=h("td"),a=T(l),c=h("td"),m.c(),p(c,"class","textcenter"),p(n,"class","striped"),this.first=n},m(g,v){w(g,n,v),d(n,o),d(o,i),d(n,r),d(r,a),d(n,c),m.m(c,null)},p(g,v){e=g,v&1&&s!==(s=e[4].tag+"")&&G(i,s),v&1&&l!==(l=e[4].name+"")&&G(a,l),u===(u=f(e,v))&&m?m.p(e,v):(m.d(1),m=u(e),m&&(m.c(),m.m(c,null)))},d(g){g&&x(n),m.d()}}}function RL(t){let e,n,o,s,i,r,l,a=[],c=new Map,f=me(t[0]),u=m=>m[4].clan;for(let m=0;m<f.length;m+=1){let g=AC(t,f,m),v=u(g);c.set(v,a[m]=TC(v,g))}return{c(){e=h("table"),n=h("thead"),o=h("tr"),s=h("th"),s.textContent=`${P.ui.clan.createtag}`,i=h("th"),i.textContent=`${P.ui.clan.createname}`,r=h("th"),r.textContent=`${P.ui.clan.action}`,l=h("tbody");for(let m=0;m<a.length;m+=1)a[m].c();p(s,"width","20%"),p(i,"width","60%"),p(r,"class","textcenter"),p(o,"class","textprimary"),p(e,"class","marg-top panel-black")},m(m,g){w(m,e,g),d(e,n),d(n,o),d(o,s),d(o,i),d(o,r),d(e,l);for(let v=0;v<a.length;v+=1)a[v]&&a[v].m(l,null)},p(m,[g]){g&3&&(f=me(m[0]),a=En(a,g,u,1,m,f,c,l,b2,TC,null,AC))},i:ae,o:ae,d(m){m&&x(e);for(let g=0;g<a.length;g+=1)a[g].d()}}}function zL(t,e,n){let o=[];(async()=>{n(0,o=await Ft("/api/clan/invites",{name:I.player.name}))})();let i=async l=>{await Ft("/api/clan/apply",{tag:l,name:I.player.name})};return[o,i,(l,a)=>i(l.tag)]}var Av=class extends Ce{constructor(e){super(),Pe(this,e,zL,RL,Be,{})}},EC=Av;function IC(t){let e,n;return e=new $t({props:{origin:"center",title:P.ui.clan.heading,icon:"clan",scroll:!0,$$slots:{default:[jL]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&133&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function BL(t){let e,n,o,s,i,r,l;return{c(){e=h("div"),n=h("div"),o=h("h3"),o.textContent=`${P.ui.clan.noclan}`,s=h("div"),s.textContent=`${P.ui.clan.viewinvites}`,i=h("div"),i.textContent=`${P.ui.clan.createheading}`,p(s,"class","btn grey"),p(i,"class","btn grey marg-top"),p(n,"class","panel-black"),p(e,"class","clanInfoBox textcenter svelte-1vwl908")},m(a,c){w(a,e,c),d(e,n),d(n,o),d(n,s),d(n,i),r||(l=[H(s,"click",t[4]),H(i,"click",t[5])],r=!0)},p:ae,i:ae,o:ae,d(a){a&&x(e),r=!1,rt(l)}}}function $L(t){let e,n,o,s,i,r,l,a=[NL,OL],c=[];function f(u,m){return u[0]=="create"?0:u[0]=="invites"?1:-1}return~(o=f(t,-1))&&(s=c[o]=a[o](t)),{c(){e=h("div"),n=h("div"),n.textContent=`${P.ui.back}`,s&&s.c(),Le(n,"display","inline-block"),p(n,"class","btn formatted grey"),p(e,"class","modemenu svelte-1vwl908")},m(u,m){w(u,e,m),d(e,n),~o&&c[o].m(e,null),i=!0,r||(l=H(n,"click",t[3]),r=!0)},p(u,m){let g=o;o=f(u,m),o!==g&&(s&&(we(),E(c[g],1,1,()=>{c[g]=null}),Me()),~o?(s=c[o],s||(s=c[o]=a[o](u),s.c()),S(s,1),s.m(e,null)):s=null)},i(u){i||(S(s),i=!0)},o(u){E(s),i=!1},d(u){u&&x(e),~o&&c[o].d(),r=!1,l()}}}function UL(t){let e,n,o;return n=new SC({props:{tag:t[2]}}),{c(){e=h("div"),J(n.$$.fragment),p(e,"class","clanView svelte-1vwl908")},m(s,i){w(s,e,i),Q(n,e,null),o=!0},p(s,i){let r={};i&4&&(r.tag=s[2]),n.$set(r)},i(s){o||(S(n.$$.fragment,s),o=!0)},o(s){E(n.$$.fragment,s),o=!1},d(s){s&&x(e),Z(n)}}}function OL(t){let e,n;return e=new EC({}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function NL(t){let e,n;return e=new PC({}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function jL(t){let e,n,o,s,i=[UL,$L,BL],r=[];function l(a,c){return a[2]?0:a[0]?1:2}return n=l(t,-1),o=r[n]=i[n](t),{c(){e=h("div"),o.c(),p(e,"class","container svelte-1vwl908")},m(a,c){w(a,e,c),r[n].m(e,null),s=!0},p(a,c){let f=n;n=l(a,c),n===f?r[n].p(a,c):(we(),E(r[f],1,1,()=>{r[f]=null}),Me(),o=r[n],o?o.p(a,c):(o=r[n]=i[n](a),o.c()),S(o,1),o.m(e,null))},i(a){s||(S(o),s=!0)},o(a){E(o),s=!1},d(a){a&&x(e),r[n].d()}}}function WL(t){let e,n,o=t[1]&&IC(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[1]?o?(o.p(s,i),i&2&&S(o,1)):(o=IC(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function GL(t,e,n){let o,s;re(t,_i,f=>n(1,o=f)),re(t,Sm,f=>n(2,s=f));let i=!1;return[i,o,s,f=>n(0,i=!1),f=>n(0,i="invites"),f=>n(0,i="create"),()=>{Xe(_i,o=!1,o)}]}var Tv=class extends Ce{constructor(e){super(),Pe(this,e,GL,WL,Be,{})}},DC=Tv;function VC(t,e,n){let o=t.slice();return o[40]=e[n],o}function LC(t,e,n){let o=t.slice();return o[34]=e[n],o[35]=e,o[36]=n,o}function qC(t,e,n){let o=t.slice();return o[37]=e[n],o[38]=e,o[39]=n,o}function RC(t){let e,n;return e=new $t({props:{title:"Social",icon:"social",origin:"left top",defaultOffset:[3,100],$$slots:{default:[lq]},$$scope:{ctx:t}}}),e.$on("close",t[30]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s[0]&2045|s[1]&4096&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function HL(t){let e,n=[],o=new Map,s,i,r,l,a=me(t[7]),c=g=>g[40].id;for(let g=0;g<a.length;g+=1){let v=VC(t,a,g),_=c(v);o.set(_,n[g]=zC(_,v))}let f=[ZL,QL,XL],u=[];function m(g,v){return g[10]==="ok"?0:g[10]==="error"?1:2}return s=m(t,[-1,-1]),i=u[s]=f[s](t),{c(){e=h("div");for(let g=0;g<n.length;g+=1)n[g].c();i.c(),r=de(),p(e,"class","userlist scrollbar svelte-100hcdi")},m(g,v){w(g,e,v);for(let _=0;_<n.length;_+=1)n[_]&&n[_].m(e,null);u[s].m(g,v),w(g,r,v),l=!0},p(g,v){v[0]&32896&&(a=me(g[7]),we(),n=En(n,v,c,1,g,a,o,e,Hn,zC,null,VC),Me());let _=s;s=m(g,v),s===_?u[s].p(g,v):(we(),E(u[_],1,1,()=>{u[_]=null}),Me(),i=u[s],i?i.p(g,v):(i=u[s]=f[s](g),i.c()),S(i,1),i.m(r.parentNode,r))},i(g){if(!l){for(let v=0;v<a.length;v+=1)S(n[v]);S(i),l=!0}},o(g){for(let v=0;v<n.length;v+=1)E(n[v]);E(i),l=!1},d(g){g&&(x(e),x(r));for(let v=0;v<n.length;v+=1)n[v].d();u[s].d(g)}}}function YL(t){let e,n,o,s,i,r,l,a,c=t[6].length>0&&BC(t),f=[tq,eq],u=[];function m(b,k){return b[2].length>0?0:1}o=m(t,[-1,-1]),s=u[o]=f[o](t);let g=[rq,iq,sq],v=[];function _(b,k){return b[5]==="ok"?0:b[5]==="error"?1:2}return i=_(t,[-1,-1]),r=v[i]=g[i](t),{c(){e=h("div"),c&&c.c(),n=de(),s.c(),r.c(),l=de(),p(e,"class","userlist scrollbar svelte-100hcdi")},m(b,k){w(b,e,k),c&&c.m(e,null),d(e,n),u[o].m(e,null),v[i].m(b,k),w(b,l,k),a=!0},p(b,k){b[6].length>0?c?(c.p(b,k),k[0]&64&&S(c,1)):(c=BC(b),c.c(),S(c,1),c.m(e,n)):c&&(we(),E(c,1,1,()=>{c=null}),Me());let y=o;o=m(b,k),o===y?u[o].p(b,k):(we(),E(u[y],1,1,()=>{u[y]=null}),Me(),s=u[o],s?s.p(b,k):(s=u[o]=f[o](b),s.c()),S(s,1),s.m(e,null));let F=i;i=_(b,k),i===F?v[i].p(b,k):(we(),E(v[F],1,1,()=>{v[F]=null}),Me(),r=v[i],r?r.p(b,k):(r=v[i]=g[i](b),r.c()),S(r,1),r.m(l.parentNode,l))},i(b){a||(S(c),S(s),S(r),a=!0)},o(b){E(c),E(s),E(r),a=!1},d(b){b&&(x(e),x(l)),c&&c.d(),u[o].d(),v[i].d(b)}}}function zC(t,e){let n,o,s,i,r,l,a;s=new Xn({props:{name:e[40].name,pclass:e[40].class,level:e[40].level,faction:e[40].faction}});function c(...f){return e[28](e[40],...f)}return{key:t,first:null,c(){n=h("div"),o=h("div"),J(s.$$.fragment),i=h("div"),i.textContent="\u274C",p(o,"class","btn small textgrey"),p(i,"class","btn grey small"),p(n,"class","user-row panel-friend block svelte-100hcdi"),this.first=n},m(f,u){w(f,n,u),d(n,o),Q(s,o,null),d(n,i),r=!0,l||(a=H(i,"click",c),l=!0)},p(f,u){e=f;let m={};u[0]&128&&(m.name=e[40].name),u[0]&128&&(m.pclass=e[40].class),u[0]&128&&(m.level=e[40].level),u[0]&128&&(m.faction=e[40].faction),s.$set(m)},i(f){r||(S(s.$$.fragment,f),r=!0)},o(f){E(s.$$.fragment,f),r=!1},d(f){f&&x(n),Z(s),l=!1,a()}}}function XL(t){let e,n,o,s,i,r,l,a,c;function f(m){t[29](m)}let u={};return t[8]!==void 0&&(u.name=t[8]),n=new Ml({props:u}),qt.push(()=>ps(n,"name",f)),{c(){e=h("div"),J(n.$$.fragment),s=h("div"),i=T("Block"),p(s,"class",r="btn navbtn formatted "+(t[9]&&t[8].length>0?"grey":"grey disabled")),p(e,"class","bar-top svelte-100hcdi")},m(m,g){w(m,e,g),Q(n,e,null),d(e,s),d(s,i),l=!0,a||(c=H(s,"click",t[14]),a=!0)},p(m,g){let v={};!o&&g[0]&256&&(o=!0,v.name=m[8],ms(()=>o=!1)),n.$set(v),(!l||g[0]&768&&r!==(r="btn navbtn formatted "+(m[9]&&m[8].length>0?"grey":"grey disabled")))&&p(s,"class",r)},i(m){l||(S(n.$$.fragment,m),l=!0)},o(m){E(n.$$.fragment,m),l=!1},d(m){m&&x(e),Z(n),a=!1,c()}}}function QL(t){let e;return{c(){e=h("div"),e.textContent="Player not found.",p(e,"class","btn navbtn panel-black formatted textcenter textred fadeIn")},m(n,o){w(n,e,o)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function ZL(t){let e;return{c(){e=h("div"),e.textContent="Player blocked!",p(e,"class","btn navbtn panel-black formatted textcenter textgreen fadeIn")},m(n,o){w(n,e,o)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function BC(t){let e,n=[],o=new Map,s,i,r=me(t[6]),l=a=>a[37].id;for(let a=0;a<r.length;a+=1){let c=qC(t,r,a),f=l(c);o.set(f,n[a]=$C(f,c))}return{c(){e=h("small"),e.textContent="Incoming Requests";for(let a=0;a<n.length;a+=1)n[a].c();s=de(),p(e,"class","textgrey")},m(a,c){w(a,e,c);for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(a,c);w(a,s,c),i=!0},p(a,c){c[0]&8256&&(r=me(a[6]),we(),n=En(n,c,l,1,a,r,o,s.parentNode,Hn,$C,s,qC),Me())},i(a){if(!i){for(let c=0;c<r.length;c+=1)S(n[c]);i=!0}},o(a){for(let c=0;c<n.length;c+=1)E(n[c]);i=!1},d(a){a&&(x(e),x(s));for(let c=0;c<n.length;c+=1)n[c].d(a)}}}function JL(t){let e,n;return e=new Xn({props:{name:t[37].name,pclass:t[37].class,level:t[37].level,faction:t[37].faction}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s[0]&64&&(i.name=o[37].name),s[0]&64&&(i.pclass=o[37].class),s[0]&64&&(i.level=o[37].level),s[0]&64&&(i.faction=o[37].faction),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function KL(t){let e,n,o=t[37].to_name+"",s;return{c(){e=h("span"),n=T("Via "),s=T(o),p(e,"class","textgrey")},m(i,r){w(i,e,r),d(e,n),d(e,s)},p(i,r){r[0]&64&&o!==(o=i[37].to_name+"")&&G(s,o)},i:ae,o:ae,d(i){i&&x(e)}}}function $C(t,e){let n,o,s,i,r,l,a,c,f,u=[KL,JL],m=[];function g(y,F){return y[37].hover?0:1}s=g(e,[-1,-1]),i=m[s]=u[s](e);function v(...y){return e[20](e[37],...y)}function _(...y){return e[21](e[37],...y)}function b(...y){return e[22](e[37],e[38],e[39],...y)}function k(...y){return e[23](e[37],e[38],e[39],...y)}return{key:t,first:null,c(){n=h("div"),o=h("div"),i.c(),r=h("div"),r.textContent="\u{1F91D}",l=h("div"),l.textContent="\u274C",p(o,"class","btn nocursor small textnooverflow svelte-100hcdi"),p(r,"class","btn grey small green"),p(l,"class","btn grey small"),p(n,"class","user-row panel-friend request flashing-border svelte-100hcdi"),this.first=n},m(y,F){w(y,n,F),d(n,o),m[s].m(o,null),d(n,r),d(n,l),a=!0,c||(f=[H(r,"click",v),H(l,"click",_),H(n,"mouseenter",b),H(n,"mouseleave",k)],c=!0)},p(y,F){e=y;let A=s;s=g(e,F),s===A?m[s].p(e,F):(we(),E(m[A],1,1,()=>{m[A]=null}),Me(),i=m[s],i?i.p(e,F):(i=m[s]=u[s](e),i.c()),S(i,1),i.m(o,null))},i(y){a||(S(i),a=!0)},o(y){E(i),a=!1},d(y){y&&x(n),m[s].d(),c=!1,rt(f)}}}function eq(t){let e;return{c(){e=h("small"),e.textContent="Add someone to your friends list!",p(e,"class","textgrey textcenter"),Le(e,"padding","50px")},m(n,o){w(n,e,o)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function tq(t){let e,n=[],o=new Map,s,i,r=t[6].length>0&&UC(t),l=me(t[2]),a=c=>c[34].id;for(let c=0;c<l.length;c+=1){let f=LC(t,l,c),u=a(f);o.set(u,n[c]=NC(u,f))}return{c(){r&&r.c(),e=de();for(let c=0;c<n.length;c+=1)n[c].c();s=de()},m(c,f){r&&r.m(c,f),w(c,e,f);for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(c,f);w(c,s,f),i=!0},p(c,f){c[6].length>0?r||(r=UC(c),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),f[0]&4100&&(l=me(c[2]),we(),n=En(n,f,a,1,c,l,o,s.parentNode,Hn,NC,s,LC),Me())},i(c){if(!i){for(let f=0;f<l.length;f+=1)S(n[f]);i=!0}},o(c){for(let f=0;f<n.length;f+=1)E(n[f]);i=!1},d(c){c&&(x(e),x(s)),r&&r.d(c);for(let f=0;f<n.length;f+=1)n[f].d(c)}}}function UC(t){let e;return{c(){e=h("small"),e.textContent="Friends",p(e,"class","textgrey")},m(n,o){w(n,e,o)},d(n){n&&x(e)}}}function nq(t){let e,n=t[34].customname+"",o,s;return{c(){e=h("span"),o=T(n),p(e,"class",s="btn nocursor small textnooverflow "+(t[34].online?"textprimary":"textgrey")+" textnooverflow svelte-100hcdi")},m(i,r){w(i,e,r),d(e,o)},p(i,r){r[0]&4&&n!==(n=i[34].customname+"")&&G(o,n),r[0]&4&&s!==(s="btn nocursor small textnooverflow "+(i[34].online?"textprimary":"textgrey")+" textnooverflow svelte-100hcdi")&&p(e,"class",s)},i:ae,o:ae,d(i){i&&x(e)}}}function oq(t){let e,n,o;e=new Xn({props:{name:t[34].name,pclass:t[34].class,level:t[34].level,faction:t[34].faction}});let s=t[34].name!==t[34].customname&&OC(t);return{c(){J(e.$$.fragment),s&&s.c(),n=de()},m(i,r){Q(e,i,r),s&&s.m(i,r),w(i,n,r),o=!0},p(i,r){let l={};r[0]&4&&(l.name=i[34].name),r[0]&4&&(l.pclass=i[34].class),r[0]&4&&(l.level=i[34].level),r[0]&4&&(l.faction=i[34].faction),e.$set(l),i[34].name!==i[34].customname?s?s.p(i,r):(s=OC(i),s.c(),s.m(n.parentNode,n)):s&&(s.d(1),s=null)},i(i){o||(S(e.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),o=!1},d(i){i&&x(n),Z(e,i),s&&s.d(i)}}}function OC(t){let e,n=t[34].customname+"",o;return{c(){e=h("span"),o=T(n),p(e,"class","btn nocursor small textnooverflow textprimary textnooverflow svelte-100hcdi")},m(s,i){w(s,e,i),d(e,o)},p(s,i){i[0]&4&&n!==(n=s[34].customname+"")&&G(o,n)},d(s){s&&x(e)}}}function NC(t,e){let n,o,s,i,r=e[34].online?"\u2B24":"\u25CB",l,a,c,f,u,m,g,v,_=[oq,nq],b=[];function k(C,M){return C[34].online&&C[34].name!==null?0:1}f=k(e,[-1,-1]),u=b[f]=_[f](e);function y(...C){return e[24](e[34],...C)}function F(...C){return e[25](e[34],e[35],e[36],...C)}function A(...C){return e[26](e[34],e[35],e[36],...C)}return{key:t,first:null,c(){n=h("div"),o=h("div"),s=h("div"),i=h("small"),l=T(r),a=Ne(),u.c(),p(i,"class",c=e[34].online?"textgreen":"textgrey"),p(s,"class","btn small textnooverflow svelte-100hcdi"),p(o,"class","friend svelte-100hcdi"),p(n,"class","user-row panel-friend svelte-100hcdi"),this.first=n},m(C,M){w(C,n,M),d(n,o),d(o,s),d(s,i),d(i,l),d(i,a),b[f].m(s,null),m=!0,g||(v=[H(s,"contextmenu",y),H(n,"mouseenter",F),H(n,"mouseleave",A)],g=!0)},p(C,M){e=C,(!m||M[0]&4)&&r!==(r=e[34].online?"\u2B24":"\u25CB")&&G(l,r),(!m||M[0]&4&&c!==(c=e[34].online?"textgreen":"textgrey"))&&p(i,"class",c);let D=f;f=k(e,M),f===D?b[f].p(e,M):(we(),E(b[D],1,1,()=>{b[D]=null}),Me(),u=b[f],u?u.p(e,M):(u=b[f]=_[f](e),u.c()),S(u,1),u.m(s,null))},i(C){m||(S(u),m=!0)},o(C){E(u),m=!1},d(C){C&&x(n),b[f].d(),g=!1,rt(v)}}}function sq(t){let e,n,o,s,i,r,l,a,c;function f(m){t[27](m)}let u={};return t[3]!==void 0&&(u.name=t[3]),n=new Ml({props:u}),qt.push(()=>ps(n,"name",f)),{c(){e=h("div"),J(n.$$.fragment),s=h("div"),i=T("Add"),p(s,"class",r="btn navbtn formatted "+(t[4]&&t[3].length>0?"green":"grey disabled")),p(e,"class","bar-top svelte-100hcdi")},m(m,g){w(m,e,g),Q(n,e,null),d(e,s),d(s,i),l=!0,a||(c=H(s,"click",t[11]),a=!0)},p(m,g){let v={};!o&&g[0]&8&&(o=!0,v.name=m[3],ms(()=>o=!1)),n.$set(v),(!l||g[0]&24&&r!==(r="btn navbtn formatted "+(m[4]&&m[3].length>0?"green":"grey disabled")))&&p(s,"class",r)},i(m){l||(S(n.$$.fragment,m),l=!0)},o(m){E(n.$$.fragment,m),l=!1},d(m){m&&x(e),Z(n),a=!1,c()}}}function iq(t){let e;return{c(){e=h("div"),e.textContent="Player not found.",p(e,"class","btn navbtn panel-black formatted textcenter textred fadeIn")},m(n,o){w(n,e,o)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function rq(t){let e;return{c(){e=h("div"),e.textContent="Friend request sent!",p(e,"class","btn navbtn panel-black formatted textcenter textgreen fadeIn")},m(n,o){w(n,e,o)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function lq(t){let e,n,o,s,i,r,l,a,c,f,u,m,g,v=[YL,HL],_=[];function b(k,y){return k[0]==="friends"?0:k[0]==="blocked"?1:-1}return~(c=b(t,[-1,-1]))&&(f=_[c]=v[c](t)),{c(){e=h("div"),n=h("div"),o=T("Friends"),i=h("div"),r=T("Blocked"),a=h("div"),f&&f.c(),p(n,"class",s="textcenter tab equal small "+(t[0]==="friends"?"active":"")),p(i,"class",l="textcenter tab equal small "+(t[0]==="blocked"?"active":"")),p(e,"class","tab-bar flex"),p(a,"class","container panel-bright svelte-100hcdi")},m(k,y){w(k,e,y),d(e,n),d(n,o),d(e,i),d(i,r),w(k,a,y),~c&&_[c].m(a,null),u=!0,m||(g=[H(n,"click",t[18]),H(i,"click",t[19])],m=!0)},p(k,y){(!u||y[0]&1&&s!==(s="textcenter tab equal small "+(k[0]==="friends"?"active":"")))&&p(n,"class",s),(!u||y[0]&1&&l!==(l="textcenter tab equal small "+(k[0]==="blocked"?"active":"")))&&p(i,"class",l);let F=c;c=b(k,y),c===F?~c&&_[c].p(k,y):(f&&(we(),E(_[F],1,1,()=>{_[F]=null}),Me()),~c?(f=_[c],f?f.p(k,y):(f=_[c]=v[c](k),f.c()),S(f,1),f.m(a,null)):f=null)},i(k){u||(S(f),u=!0)},o(k){E(f),u=!1},d(k){k&&(x(e),x(a)),~c&&_[c].d(),m=!1,rt(g)}}}function aq(t){let e,n,o=t[1]&&RC(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,i){s[1]?o?(o.p(s,i),i[0]&2&&S(o,1)):(o=RC(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function cq(t,e,n){let o,s;re(t,pi,ie=>n(17,o=ie)),re(t,bi,ie=>n(1,s=ie));let i="friends";Xe(pi,o=!0,o);let r=async()=>{n(2,{friends:a,requests:_}=await Ft("/api/social/getFriends",{}),a,n(6,_))},l=async()=>{n(7,{blocks:y}=await Ft("/api/social/getBlocks",{}),y)},a=[],c=0,f="",u=!0,m,g=async()=>{try{n(4,u=!1);let ie=await Ft("/api/social/friendRequest",{name:f});n(5,m="ok")}catch{n(5,m="error")}setTimeout(()=>{n(5,m=void 0)},2e3),n(4,u=!0)},v=(ie,le)=>{let ge=[{name:le.customname,css:"disabled"}];ge.push({name:"Remove friend",css:"",fun:()=>{Ft("/api/social/removeFriend",{id:le.id}),n(2,a=a.filter(be=>be.id!==le.id))}}),le.online&&(le.faction===I.player.faction&&(Xt.has(le.name)||ge.push(Wt.partyinvite(le.name))),ge.push(Wt.whisper(le.name))),dn.set({x:ie.pageX,y:ie.pageY,opts:ge})},_=[],b=async(ie,le)=>{n(6,_=_.filter(ge=>ge.id!==ie)),await Ft("/api/social/friendRequest"+(le?"Accept":"Deny"),{id:ie,action:le}),le&&r()},k=!0,y=[],F="",A=!0,C,M=async()=>{try{n(9,A=!1);let ie=await Ft("/api/social/blockPlayer",{name:F});n(10,C="ok")}catch{n(10,C="error")}setTimeout(()=>{n(10,C=void 0)},2e3),n(9,A=!0),l()},D=async ie=>{n(7,y=y.filter(le=>le.id!==ie)),await Ft("/api/social/unblockPlayer",{id:ie})},$=ie=>n(0,i="friends"),V=ie=>n(0,i="blocked"),z=(ie,le)=>b(ie.id,!0),q=(ie,le)=>b(ie.id,!1),L=(ie,le,ge,be)=>n(6,le[ge].hover=!0,_),U=(ie,le,ge,be)=>n(6,le[ge].hover=!1,_),W=(ie,le)=>v(le,ie),R=(ie,le,ge,be)=>n(2,le[ge].hover=!0,a),N=(ie,le,ge,be)=>n(2,le[ge].hover=!1,a);function Y(ie){f=ie,n(3,f)}let _e=(ie,le)=>D(ie.id);function Fe(ie){F=ie,n(8,F)}let he=()=>{Xe(bi,s=!1,s)};return t.$$.update=()=>{t.$$.dirty[0]&196611&&(o&&s&&i==="friends"?(r(),Xe(pi,o=!1,o)):k&&s&&i==="blocked"&&(l(),n(16,k=!1)))},[i,s,a,f,u,m,_,y,F,A,C,g,v,b,M,D,k,o,$,V,z,q,L,U,W,R,N,Y,_e,Fe,he]}var Ev=class extends Ce{constructor(e){super(),Pe(this,e,cq,aq,Be,{},null,[-1,-1])}},jC=Ev;var Iv=t=>{let e=~~(t/86400),n=~~(t/(60*60)%24),o=~~(t/60%60),s=~~(t%60);return`${e?e+"d ":""}${n?n+"h ":""}${o?o+"m ":""}${s?s+"s":""}`};var vu=t=>~~(1e4+t**1.5*8e3);function WC(t,e,n){let o=t.slice();return o[9]=e[n],o[11]=n,o}function GC(t){let e,n;return e=new $t({props:{origin:"center",title:P.ui.headers.warstats,icon:"pvp",$$slots:{default:[uq]},$$scope:{ctx:t}}}),e.$on("close",t[8]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&4101&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function fq(t){let e,n=dt(t[2].contrib)+"",o,s,i=dt(vu(t[2].level))+"",r,l,a=t[2].level+"",c,f;return{c(){e=h("span"),o=T(n),s=T(" / "),r=T(i),l=T(" (Lv. "),c=T(a),f=T(" War)"),Le(e,"font-size","14px"),p(e,"class","absCentered textprimary")},m(u,m){w(u,e,m),d(e,o),d(e,s),d(e,r),d(e,l),d(e,c),d(e,f)},p(u,m){m&4&&n!==(n=dt(u[2].contrib)+"")&&G(o,n),m&4&&i!==(i=dt(vu(u[2].level))+"")&&G(r,i),m&4&&a!==(a=u[2].level+"")&&G(c,a)},d(u){u&&x(e)}}}function HC(t,e){let n,o,s,i,r=dt(e[9].stats[1])+"",l,a,c=dt(e[9].stats[2])+"",f,u,m=e[9].stats[0]+"",g,v,_=dt(e[9].stats[3])+"",b,k,y;return s=new Xn({props:{name:e[9].name,pclass:e[9].class,level:e[9].level,faction:e[9].faction}}),{key:t,first:null,c(){n=h("tr"),o=h("td"),J(s.$$.fragment),i=h("td"),l=T(r),a=h("td"),f=T(c),u=h("td"),g=T(m),v=h("td"),b=T(_),p(i,"class","textcenter"),p(a,"class","textcenter"),p(u,"class","textcenter"),p(v,"class","textcenter textfame"),p(n,"class",k="striped "+(I&&I.player&&I.player.name===e[9].name?"selected":"")),this.first=n},m(F,A){w(F,n,A),d(n,o),Q(s,o,null),d(n,i),d(i,l),d(n,a),d(a,f),d(n,u),d(u,g),d(n,v),d(v,b),y=!0},p(F,A){e=F;let C={};A&5&&(C.name=e[9].name),A&5&&(C.pclass=e[9].class),A&5&&(C.level=e[9].level),A&5&&(C.faction=e[9].faction),s.$set(C),(!y||A&5)&&r!==(r=dt(e[9].stats[1])+"")&&G(l,r),(!y||A&5)&&c!==(c=dt(e[9].stats[2])+"")&&G(f,c),(!y||A&5)&&m!==(m=e[9].stats[0]+"")&&G(g,m),(!y||A&5)&&_!==(_=dt(e[9].stats[3])+"")&&G(b,_),(!y||A&5&&k!==(k="striped "+(I&&I.player&&I.player.name===e[9].name?"selected":"")))&&p(n,"class",k)},i(F){y||(S(s.$$.fragment,F),y=!0)},o(F){E(s.$$.fragment,F),y=!1},d(F){F&&x(n),Z(s)}}}function uq(t){let e,n,o,s,i,r,l,a,c,f=t[2].kills[0]+"",u,m,g,v,_,b,k=dt(t[2].reward)+"",y,F,A=P.ui.war.status+"",C,M,D,$=P.ui.war.statustypes[t[2].status]+"",V,z,q,L=P.ui.war.duration+"",U,W,R,N=Iv(t[2].duration)+"",Y,_e,Fe,he,ie,le,ge,be,Te=t[2].kills[1]+"",se,Ie,K,Re,Ge,Qe,Ye,pe,ce=P.ui.stats.misc.damage+"",Oe,oe,ee,O=P.ui.stats.misc.healing+"",ue,We,ze,Ae=P.ui.stats.misc.kills+"",$e,Ue,mt,wt,Je,Et,xe=P.ui.stats.misc.fame+"",Ke,bt,Ct,Ve=[],ye=new Map,Vt,Ht,Lt;Ie=new xo({props:{size:"1.3em",fract:~~(t[2].contrib/vu(t[2].level)*100),left:"",right:"",barcol:"bgpurp",$$slots:{default:[fq]},$$scope:{ctx:t}}});let Rt=me(t[2].contributors.sort(t[7])),He=et=>et[9].name;for(let et=0;et<Rt.length;et+=1){let Ee=WC(t,Rt,et),it=He(Ee);ye.set(it,Ve[et]=HC(it,Ee))}return{c(){e=h("div"),n=h("div"),o=h("div"),s=h("div"),i=h("span"),i.textContent=`${P.factions[0].name}`,r=h("span"),l=h("img"),c=Ne(),u=T(f),m=h("div"),g=h("span"),v=h("img"),b=Ne(),y=T(k),F=h("span"),C=T(A),M=T(": "),D=h("span"),V=T($),q=h("span"),U=T(L),W=T(": "),R=h("span"),Y=T(N),_e=Ne(),Fe=h("div"),he=h("span"),he.textContent=`${P.factions[1].name}`,ie=h("span"),le=h("img"),be=Ne(),se=T(Te),J(Ie.$$.fragment),K=h("div"),Re=h("table"),Ge=h("thead"),Qe=h("tr"),Ye=h("th"),Ye.textContent=`${P.ui.war.player}`,pe=h("th"),Oe=T(ce),ee=h("th"),ue=T(O),ze=h("th"),$e=T(Ae),mt=h("th"),wt=h("img"),Et=Ne(),Ke=T(xe),Ct=h("tbody");for(let et=0;et<Ve.length;et+=1)Ve[et].c();p(i,"class","infosmall textf0 svelte-19s383j"),Le(i,"margin-top","30px"),p(l,"class","svgicon"),at(l.src,a="/data/ui/icons/pvp.svg?v=8738303")||p(l,"src",a),p(r,"class","infobig textprimary svelte-19s383j"),Le(r,"margin-top","10px"),p(v,"class","svgicon"),at(v.src,_=lr)||p(v,"src",_),p(g,"class","infobig textfame svelte-19s383j"),Le(g,"margin-top","20px"),p(D,"class",z="text"+["red","orange","green"][t[2].status]+" svelte-19s383j"),p(F,"class","infosmall svelte-19s383j"),Le(F,"margin-top","10px"),p(R,"class","textprimary"),p(q,"class","infosmall svelte-19s383j"),Le(q,"margin-bottom","20px"),p(he,"class","infosmall textf1 svelte-19s383j"),Le(he,"margin-top","30px"),p(le,"class","svgicon"),at(le.src,ge="/data/ui/icons/pvp.svg?v=8738303")||p(le,"src",ge),p(ie,"class","infobig textprimary svelte-19s383j"),Le(ie,"margin-top","10px"),p(o,"class","grid three"),p(n,"class","panel-black border grey"),p(Ye,"width","30%"),p(pe,"class",oe="textcenter "+(t[0]==1?"textwhite":"")),p(ee,"class",We="textcenter "+(t[0]==2?"textwhite":"")),p(ze,"class",Ue="textcenter "+(t[0]==0?"textwhite":"")),p(wt,"class","svgicon"),at(wt.src,Je=lr)||p(wt,"src",Je),p(mt,"class",bt="textcenter "+(t[0]==3?"textwhite":"")),p(Qe,"class","textprimary"),p(Re,"class","dense panel-black"),p(K,"class","scrollbar"),p(e,"class","layout svelte-19s383j")},m(et,Ee){w(et,e,Ee),d(e,n),d(n,o),d(o,s),d(s,i),d(s,r),d(r,l),d(r,c),d(r,u),d(o,m),d(m,g),d(g,v),d(g,b),d(g,y),d(m,F),d(F,C),d(F,M),d(F,D),d(D,V),d(m,q),d(q,U),d(q,W),d(q,R),d(R,Y),d(m,_e),d(o,Fe),d(Fe,he),d(Fe,ie),d(ie,le),d(ie,be),d(ie,se),Q(Ie,n,null),d(e,K),d(K,Re),d(Re,Ge),d(Ge,Qe),d(Qe,Ye),d(Qe,pe),d(pe,Oe),d(Qe,ee),d(ee,ue),d(Qe,ze),d(ze,$e),d(Qe,mt),d(mt,wt),d(mt,Et),d(mt,Ke),d(Re,Ct);for(let it=0;it<Ve.length;it+=1)Ve[it]&&Ve[it].m(Ct,null);Vt=!0,Ht||(Lt=[H(pe,"click",t[3]),H(ee,"click",t[4]),H(ze,"click",t[5]),H(mt,"click",t[6])],Ht=!0)},p(et,Ee){(!Vt||Ee&4)&&f!==(f=et[2].kills[0]+"")&&G(u,f),(!Vt||Ee&4)&&k!==(k=dt(et[2].reward)+"")&&G(y,k),(!Vt||Ee&4)&&$!==($=P.ui.war.statustypes[et[2].status]+"")&&G(V,$),(!Vt||Ee&4&&z!==(z="text"+["red","orange","green"][et[2].status]+" svelte-19s383j"))&&p(D,"class",z),(!Vt||Ee&4)&&N!==(N=Iv(et[2].duration)+"")&&G(Y,N),(!Vt||Ee&4)&&Te!==(Te=et[2].kills[1]+"")&&G(se,Te);let it={};Ee&4&&(it.fract=~~(et[2].contrib/vu(et[2].level)*100)),Ee&4100&&(it.$$scope={dirty:Ee,ctx:et}),Ie.$set(it),(!Vt||Ee&1&&oe!==(oe="textcenter "+(et[0]==1?"textwhite":"")))&&p(pe,"class",oe),(!Vt||Ee&1&&We!==(We="textcenter "+(et[0]==2?"textwhite":"")))&&p(ee,"class",We),(!Vt||Ee&1&&Ue!==(Ue="textcenter "+(et[0]==0?"textwhite":"")))&&p(ze,"class",Ue),(!Vt||Ee&1&&bt!==(bt="textcenter "+(et[0]==3?"textwhite":"")))&&p(mt,"class",bt),Ee&5&&(Rt=me(et[2].contributors.sort(et[7])),we(),Ve=En(Ve,Ee,He,1,et,Rt,ye,Ct,Hn,HC,null,WC),Me())},i(et){if(!Vt){S(Ie.$$.fragment,et);for(let Ee=0;Ee<Rt.length;Ee+=1)S(Ve[Ee]);Vt=!0}},o(et){E(Ie.$$.fragment,et);for(let Ee=0;Ee<Ve.length;Ee+=1)E(Ve[Ee]);Vt=!1},d(et){et&&x(e),Z(Ie);for(let Ee=0;Ee<Ve.length;Ee+=1)Ve[Ee].d();Ht=!1,rt(Lt)}}}function mq(t){let e,n,o=t[1]&&GC(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[1]?o?(o.p(s,i),i&2&&S(o,1)):(o=GC(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function pq(t,e,n){let o,s;re(t,Ys,m=>n(1,o=m)),re(t,Hs,m=>n(2,s=m));let i=1;return[i,o,s,()=>n(0,i=1),()=>n(0,i=2),()=>n(0,i=0),()=>n(0,i=3),(m,g)=>g.stats[i]-m.stats[i],()=>{Xe(Ys,o=!1,o)}]}var Dv=class extends Ce{constructor(e){super(),Pe(this,e,pq,mq,Be,{})}},YC=Dv;function XC(t,e,n){let o=t.slice();return o[15]=e[n],o}function QC(t,e,n){let o=t.slice();return o[18]=e[n],o[20]=n,o}function ZC(t){let e,n;return e=new $t({props:{origin:"center",title:P.ui.headers.pvp,icon:"pvp",$$slots:{default:[bq]},$$scope:{ctx:t}}}),e.$on("close",t[13]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&2097278&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function JC(t){let e,n,o;function s(){return t[11](t[20])}return{c(){e=h("div"),e.textContent=`${t[18]}`,p(e,"class","tab"),$i(e,"active",t[20]===t[1])},m(i,r){w(i,e,r),n||(o=H(e,"click",s),n=!0)},p(i,r){t=i,r&2&&$i(e,"active",t[20]===t[1])},d(i){i&&x(e),n=!1,o()}}}function dq(t){let e,n,o,s,i,r,l,a,c=t[5].arena_position+"",f,u,m,g,v=t[5].arena_wins_today+"",_,b,k,y,F=t[5].arena_losses_today+"",A,C,M,D,$,V,z,q,L,U,W,R,N,Y,_e;s=new Vd({props:{amount:t[5].arena_rating}});let Fe=me(t[8]),he=[];for(let be=0;be<Fe.length;be+=1)he[be]=KC(XC(t,Fe,be));$=new gr({props:{amount:Math.ceil(Yf(t[5].arena_rating)/5)}});let ie=[vq,gq],le=[];function ge(be,Te){return be[5].arena_wins_today?0:1}return U=ge(t,-1),W=le[U]=ie[U](t),Y=new gr({props:{amount:t[5].medals}}),{c(){e=h("div"),n=h("h4"),n.textContent="Current Rating",o=h("h2"),J(s.$$.fragment),i=h("div");for(let be=0;be<he.length;be+=1)he[be].c();r=h("div"),l=h("span"),l.textContent="Arena Position",a=h("span"),f=T(c),u=h("span"),u.textContent="Wins / Loss Today",m=h("span"),g=h("span"),_=T(v),k=T(" - "),y=h("span"),A=T(F),M=h("span"),M.textContent="Medals per win",D=h("span"),J($.$$.fragment),V=h("span"),z=T("End of day bonus"),L=h("span"),W.c(),R=h("span"),R.textContent="Total Medals",N=h("span"),J(Y.$$.fragment),p(n,"class","textgreen"),p(e,"class","textcenter panel-black"),p(i,"class","panel-black marg-top grid two textcenter"),p(l,"class","textwhite"),p(a,"class","textgreen statnumber"),p(u,"class","textwhite"),p(g,"class",b=t[5].arena_wins_today?"textgreen":"textgrey"),p(y,"class",C=t[5].arena_losses_today?"textred":"textgrey"),p(m,"class","textgrey statnumber"),p(M,"class","textwhite"),p(D,"class","statnumber"),p(V,"class",q=t[5].arena_wins_today?"textgreen":"textgrey"),p(L,"class","statnumber"),p(R,"class","textwhite"),p(N,"class","statnumber"),p(r,"class","stats panel-black marg-top svelte-voya4q")},m(be,Te){w(be,e,Te),d(e,n),d(e,o),Q(s,o,null),w(be,i,Te);for(let se=0;se<he.length;se+=1)he[se]&&he[se].m(i,null);w(be,r,Te),d(r,l),d(r,a),d(a,f),d(r,u),d(r,m),d(m,g),d(g,_),d(m,k),d(m,y),d(y,A),d(r,M),d(r,D),Q($,D,null),d(r,V),d(V,z),d(r,L),le[U].m(L,null),d(r,R),d(r,N),Q(Y,N,null),_e=!0},p(be,Te){let se={};if(Te&32&&(se.amount=be[5].arena_rating),s.$set(se),Te&832){Fe=me(be[8]);let Ge;for(Ge=0;Ge<Fe.length;Ge+=1){let Qe=XC(be,Fe,Ge);he[Ge]?he[Ge].p(Qe,Te):(he[Ge]=KC(Qe),he[Ge].c(),he[Ge].m(i,null))}for(;Ge<he.length;Ge+=1)he[Ge].d(1);he.length=Fe.length}(!_e||Te&32)&&c!==(c=be[5].arena_position+"")&&G(f,c),(!_e||Te&32)&&v!==(v=be[5].arena_wins_today+"")&&G(_,v),(!_e||Te&32&&b!==(b=be[5].arena_wins_today?"textgreen":"textgrey"))&&p(g,"class",b),(!_e||Te&32)&&F!==(F=be[5].arena_losses_today+"")&&G(A,F),(!_e||Te&32&&C!==(C=be[5].arena_losses_today?"textred":"textgrey"))&&p(y,"class",C);let Ie={};Te&32&&(Ie.amount=Math.ceil(Yf(be[5].arena_rating)/5)),$.$set(Ie),(!_e||Te&32&&q!==(q=be[5].arena_wins_today?"textgreen":"textgrey"))&&p(V,"class",q);let K=U;U=ge(be,Te),U===K?le[U].p(be,Te):(we(),E(le[K],1,1,()=>{le[K]=null}),Me(),W=le[U],W?W.p(be,Te):(W=le[U]=ie[U](be),W.c()),S(W,1),W.m(L,null));let Re={};Te&32&&(Re.amount=be[5].medals),Y.$set(Re)},i(be){_e||(S(s.$$.fragment,be),S($.$$.fragment,be),S(W),S(Y.$$.fragment,be),_e=!0)},o(be){E(s.$$.fragment,be),E($.$$.fragment,be),E(W),E(Y.$$.fragment,be),_e=!1},d(be){be&&(x(e),x(i),x(r)),Z(s),ot(he,be),Z($),le[U].d(),Z(Y)}}}function hq(t){let e,n,o,s,i,r,l,a,c=dt(t[5].prestige)+"",f,u,m,g,v=ml(t[3],P.ui.title.name[I.player.faction][t[3]-1])+"",_,b=dt(bv(t[5].prestige))+"",k,y,F,A,C,M,D,$=dt(t[5].kills_today)+"",V,z,q,L,U,W,R=dt(t[5].fame_today)+"",N,Y,_e,Fe,he,ie,le=dt(t[5].kills_this_week)+"",ge,be,Te,se,Ie,K,Re=dt(t[5].fame)+"",Ge,Qe,Ye,pe=t[5].fame_position+"",ce,Oe,oe,ee=gu(t[5].fame_bracket)+"",O,ue,We,ze,Ae,$e,Ue=dt(t[5].kills_last_week)+"",mt,wt,Je,Et,xe,Ke,bt=dt(t[5].fame_last_week)+"",Ct,Ve,ye,Vt=t[5].fame_position_last_week+"",Ht,Lt,Rt,He=gu(t[5].fame_bracket_last_week)+"",et,Ee,it,Ze,ft,wn,Is=dt(t[5].kills_lifetime)+"",fo,qo,pt,zt,Ds,Wn,uo=dt(t[5].fame_lifetime)+"",Pc,Tr,zi,Vs=(t[5].rank_lifetime>0?ml(t[5].rank_lifetime,P.ui.title.name[I.player.faction][t[5].rank_lifetime-1]):"Unranked")+"",pn;return n=new xo({props:{size:"1.5em",fract:t[4],barcol:"bgpurp",$$slots:{default:[_q]},$$scope:{ctx:t}}}),{c(){e=h("div"),J(n.$$.fragment),o=h("div"),s=h("span"),s.textContent=`${P.ui.pvpmenu.currentprestige}`,i=h("span"),r=h("img"),a=Ne(),f=T(c),u=h("span"),u.textContent=`${P.ui.pvpmenu.nextrank}`,m=h("span"),g=new am(!1),_=T(" ("),k=T(b),y=T(")"),F=h("div"),A=h("small"),A.textContent=`${P.ui.pvpmenu.today}`,C=h("span"),M=h("span"),M.textContent=`${P.ui.stats.misc.kills}`,D=h("span"),V=T($),z=h("span"),z.textContent=`${P.ui.stats.misc.fame}`,q=h("span"),L=h("img"),W=Ne(),N=T(R),Y=h("div"),_e=h("small"),_e.textContent=`${P.ui.pvpmenu.thisweek}`,Fe=h("a"),Fe.textContent=`${P.ui.pvpmenu.viewbrackets}`,he=h("span"),he.textContent=`${P.ui.stats.misc.kills}`,ie=h("span"),ge=T(le),be=h("span"),be.textContent=`${P.ui.stats.misc.fame}`,Te=h("span"),se=h("img"),K=Ne(),Ge=T(Re),Qe=h("span"),Qe.textContent=`${P.ui.pvpmenu.fameposition}`,Ye=h("span"),ce=T(pe),Oe=h("span"),Oe.textContent=`${P.ui.pvpmenu.famebracket}`,oe=h("span"),O=T(ee),ue=h("div"),We=h("small"),We.textContent=`${P.ui.pvpmenu.lastweek}`,ze=h("span"),Ae=h("span"),Ae.textContent=`${P.ui.stats.misc.kills}`,$e=h("span"),mt=T(Ue),wt=h("span"),wt.textContent=`${P.ui.stats.misc.fame}`,Je=h("span"),Et=h("img"),Ke=Ne(),Ct=T(bt),Ve=h("span"),Ve.textContent=`${P.ui.pvpmenu.fameposition}`,ye=h("span"),Ht=T(Vt),Lt=h("span"),Lt.textContent=`${P.ui.pvpmenu.famebracket}`,Rt=h("span"),et=T(He),Ee=h("div"),it=h("small"),it.textContent=`${P.ui.pvpmenu.lifetime}`,Ze=h("span"),ft=h("span"),ft.textContent=`${P.ui.stats.misc.kills}`,wn=h("span"),fo=T(Is),qo=h("span"),qo.textContent=`${P.ui.stats.misc.fame}`,pt=h("span"),zt=h("img"),Wn=Ne(),Pc=T(uo),Tr=h("span"),Tr.textContent=`${P.ui.pvpmenu.highestrank}`,zi=h("span"),p(s,"class","textwhite"),p(r,"class","svgicon"),at(r.src,l=Ya)||p(r,"src",l),p(i,"class","textprestige statnumber"),p(u,"class","textwhite"),g.a=_,p(m,"class","textprestige statnumber"),p(o,"class","stats marg-top svelte-voya4q"),p(e,"class","panel-black"),p(A,"class","bold textgreen"),p(M,"class","textwhite"),p(D,"class","textprimary statnumber"),p(z,"class","textwhite"),p(L,"class","svgicon"),at(L.src,U=lr)||p(L,"src",U),p(q,"class","textfame statnumber"),p(F,"class","stats panel-black marg-top svelte-voya4q"),p(_e,"class","bold textgreen"),p(Fe,"class","statnumber"),p(Fe,"href","/pvp"),p(Fe,"target","_blank"),p(Fe,"rel","noopener noreferrer"),p(he,"class","textwhite"),p(ie,"class","textprimary statnumber"),p(be,"class","textwhite"),p(se,"class","svgicon"),at(se.src,Ie=lr)||p(se,"src",Ie),p(Te,"class","textfame statnumber"),p(Qe,"class","textwhite"),p(Ye,"class","textgreen statnumber"),p(Oe,"class","textwhite"),p(oe,"class","textprimary statnumber"),p(Y,"class","stats panel-black marg-top svelte-voya4q"),p(We,"class","bold textgreen"),p(Ae,"class","textwhite"),p($e,"class","textprimary statnumber"),p(wt,"class","textwhite"),p(Et,"class","svgicon"),at(Et.src,xe=lr)||p(Et,"src",xe),p(Je,"class","textfame statnumber"),p(Ve,"class","textwhite"),p(ye,"class","textgreen statnumber"),p(Lt,"class","textwhite"),p(Rt,"class","textprimary statnumber"),p(ue,"class","stats panel-black marg-top svelte-voya4q"),p(it,"class","bold textgreen"),p(ft,"class","textwhite"),p(wn,"class","textprimary statnumber"),p(qo,"class","textwhite"),p(zt,"class","svgicon"),at(zt.src,Ds=lr)||p(zt,"src",Ds),p(pt,"class","textfame statnumber"),p(Tr,"class","textwhite"),p(zi,"class","textprestige statnumber"),p(Ee,"class","stats panel-black marg-top svelte-voya4q")},m(Ut,tn){w(Ut,e,tn),Q(n,e,null),d(e,o),d(o,s),d(o,i),d(i,r),d(i,a),d(i,f),d(o,u),d(o,m),g.m(v,m),d(m,_),d(m,k),d(m,y),w(Ut,F,tn),d(F,A),d(F,C),d(F,M),d(F,D),d(D,V),d(F,z),d(F,q),d(q,L),d(q,W),d(q,N),w(Ut,Y,tn),d(Y,_e),d(Y,Fe),d(Y,he),d(Y,ie),d(ie,ge),d(Y,be),d(Y,Te),d(Te,se),d(Te,K),d(Te,Ge),d(Y,Qe),d(Y,Ye),d(Ye,ce),d(Y,Oe),d(Y,oe),d(oe,O),w(Ut,ue,tn),d(ue,We),d(ue,ze),d(ue,Ae),d(ue,$e),d($e,mt),d(ue,wt),d(ue,Je),d(Je,Et),d(Je,Ke),d(Je,Ct),d(ue,Ve),d(ue,ye),d(ye,Ht),d(ue,Lt),d(ue,Rt),d(Rt,et),w(Ut,Ee,tn),d(Ee,it),d(Ee,Ze),d(Ee,ft),d(Ee,wn),d(wn,fo),d(Ee,qo),d(Ee,pt),d(pt,zt),d(pt,Wn),d(pt,Pc),d(Ee,Tr),d(Ee,zi),zi.innerHTML=Vs,pn=!0},p(Ut,tn){let mo={};tn&16&&(mo.fract=Ut[4]),tn&2097156&&(mo.$$scope={dirty:tn,ctx:Ut}),n.$set(mo),(!pn||tn&32)&&c!==(c=dt(Ut[5].prestige)+"")&&G(f,c),(!pn||tn&8)&&v!==(v=ml(Ut[3],P.ui.title.name[I.player.faction][Ut[3]-1])+"")&&g.p(v),(!pn||tn&32)&&b!==(b=dt(bv(Ut[5].prestige))+"")&&G(k,b),(!pn||tn&32)&&$!==($=dt(Ut[5].kills_today)+"")&&G(V,$),(!pn||tn&32)&&R!==(R=dt(Ut[5].fame_today)+"")&&G(N,R),(!pn||tn&32)&&le!==(le=dt(Ut[5].kills_this_week)+"")&&G(ge,le),(!pn||tn&32)&&Re!==(Re=dt(Ut[5].fame)+"")&&G(Ge,Re),(!pn||tn&32)&&pe!==(pe=Ut[5].fame_position+"")&&G(ce,pe),(!pn||tn&32)&&ee!==(ee=gu(Ut[5].fame_bracket)+"")&&G(O,ee),(!pn||tn&32)&&Ue!==(Ue=dt(Ut[5].kills_last_week)+"")&&G(mt,Ue),(!pn||tn&32)&&bt!==(bt=dt(Ut[5].fame_last_week)+"")&&G(Ct,bt),(!pn||tn&32)&&Vt!==(Vt=Ut[5].fame_position_last_week+"")&&G(Ht,Vt),(!pn||tn&32)&&He!==(He=gu(Ut[5].fame_bracket_last_week)+"")&&G(et,He),(!pn||tn&32)&&Is!==(Is=dt(Ut[5].kills_lifetime)+"")&&G(fo,Is),(!pn||tn&32)&&uo!==(uo=dt(Ut[5].fame_lifetime)+"")&&G(Pc,uo),(!pn||tn&32)&&Vs!==(Vs=(Ut[5].rank_lifetime>0?ml(Ut[5].rank_lifetime,P.ui.title.name[I.player.faction][Ut[5].rank_lifetime-1]):"Unranked")+"")&&(zi.innerHTML=Vs)},i(Ut){pn||(S(n.$$.fragment,Ut),pn=!0)},o(Ut){E(n.$$.fragment,Ut),pn=!1},d(Ut){Ut&&(x(e),x(F),x(Y),x(ue),x(Ee)),Z(n)}}}function KC(t){let e,n,o=t[15]+"",s,i,r,l;function a(...c){return t[12](t[15],...c)}return{c(){e=h("div"),n=T("Queue "),s=T(o),p(e,"class",i="btn grey "+(t[6].queues&&t[6].queues.includes("arena"+t[15])?"active":""))},m(c,f){w(c,e,f),d(e,n),d(e,s),r||(l=H(e,"click",a),r=!0)},p(c,f){t=c,f&64&&i!==(i="btn grey "+(t[6].queues&&t[6].queues.includes("arena"+t[15])?"active":""))&&p(e,"class",i)},d(c){c&&x(e),r=!1,l()}}}function gq(t){let e;return{c(){e=T("-")},m(n,o){w(n,e,o)},p:ae,i:ae,o:ae,d(n){n&&x(e)}}}function vq(t){let e,n;return e=new gr({props:{amount:Yf(t[5].arena_rating)}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&32&&(i.amount=Yf(o[5].arena_rating)),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function _q(t){let e,n=(t[2]>0?ml(t[2],P.ui.title.name[I.player.faction][t[2]-1]):"Unranked")+"";return{c(){e=h("span"),p(e,"class","absCentered ranktitle svelte-voya4q")},m(o,s){w(o,e,s),e.innerHTML=n},p(o,s){s&4&&n!==(n=(o[2]>0?ml(o[2],P.ui.title.name[I.player.faction][o[2]-1]):"Unranked")+"")&&(e.innerHTML=n)},d(o){o&&x(e)}}}function bq(t){let e,n,o,s,i,r,l=me(t[7]),a=[];for(let m=0;m<l.length;m+=1)a[m]=JC(QC(t,l,m));let c=[hq,dq],f=[];function u(m,g){return m[1]===0?0:m[1]===1?1:-1}return~(s=u(t,-1))&&(i=f[s]=c[s](t)),{c(){e=h("div"),n=h("div");for(let m=0;m<a.length;m+=1)a[m].c();o=h("div"),i&&i.c(),p(n,"class","tab-bar flex"),p(o,"class","panel-bright"),p(e,"class","container svelte-voya4q")},m(m,g){w(m,e,g),d(e,n);for(let v=0;v<a.length;v+=1)a[v]&&a[v].m(n,null);d(e,o),~s&&f[s].m(o,null),r=!0},p(m,g){if(g&130){l=me(m[7]);let _;for(_=0;_<l.length;_+=1){let b=QC(m,l,_);a[_]?a[_].p(b,g):(a[_]=JC(b),a[_].c(),a[_].m(n,null))}for(;_<a.length;_+=1)a[_].d(1);a.length=l.length}let v=s;s=u(m,g),s===v?~s&&f[s].p(m,g):(i&&(we(),E(f[v],1,1,()=>{f[v]=null}),Me()),~s?(i=f[s],i?i.p(m,g):(i=f[s]=c[s](m),i.c()),S(i,1),i.m(o,null)):i=null)},i(m){r||(S(i),r=!0)},o(m){E(i),r=!1},d(m){m&&x(e),ot(a,m),~s&&f[s].d()}}}function yq(t){let e,n,o=t[0]&&ZC(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[0]?o?(o.p(s,i),i&1&&S(o,1)):(o=ZC(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function kq(t,e,n){let o,s;re(t,eo,y=>n(6,o=y)),re(t,yi,y=>n(0,s=y));let i=["Prestige","Arena"],r=0,l=0,a=1,c=0,f={},u=async()=>{n(5,f=await Ft("/api/pvp/getplayerpvpinfo",{name:I.player.name})),n(2,l=lc(f.prestige)),n(3,a=Math.min(l+1,12));let y=Rd(a)-Rd(l),F=f.prestige-Rd(l);n(4,c=~~(F/y*100))},m=0,g=["3v3","5v5"],v=y=>{yt(o.queues.includes(y)?"stopqueue":"startqueue",y)},_=y=>{n(1,r=y)},b=(y,F)=>v("arena"+y),k=()=>{Xe(yi,s=!1,s)};return t.$$.update=()=>{t.$$.dirty&1025&&(s&&Date.now()-m>3e4||m===0)&&(u(),n(10,m=Date.now()))},[s,r,l,a,c,f,o,i,g,v,m,_,b,k]}var Vv=class extends Ce{constructor(e){super(),Pe(this,e,kq,yq,Be,{})}},eS=Vv;function tS(t){let e,n,o=t[1].name+"",s,i,r,l=t[1].level!==void 0?`Lv. ${t[1].level} `:"",a,c,f=(t[1].class!==void 0?P.classes[t[1].class].name:"Item")+"",u,m,g,v=(t[1].faction!==void 0?P.factions[t[1].faction].name:"")+"",_,b;return{c(){e=h("div"),n=h("div"),s=T(o),i=h("div"),r=h("span"),a=T(l),c=h("span"),u=T(f),g=h("span"),_=T(v),p(n,"class","textwhite title svelte-1wip79f"),p(c,"class",m=Bi(t[1].class!==void 0?"textc"+t[1].class:"textyellow")+" svelte-1wip79f"),p(g,"class",b=Bi(t[1].faction!==void 0?"textf"+t[1].faction:"")+" svelte-1wip79f"),p(e,"class","panel-black container svelte-1wip79f"),Le(e,"display",t[0]?"block":"none")},m(k,y){w(k,e,y),d(e,n),d(n,s),d(e,i),d(i,r),d(r,a),d(i,c),d(c,u),d(e,g),d(g,_)},p(k,y){y&2&&o!==(o=k[1].name+"")&&G(s,o),y&2&&l!==(l=k[1].level!==void 0?`Lv. ${k[1].level} `:"")&&G(a,l),y&2&&f!==(f=(k[1].class!==void 0?P.classes[k[1].class].name:"Item")+"")&&G(u,f),y&2&&m!==(m=Bi(k[1].class!==void 0?"textc"+k[1].class:"textyellow")+" svelte-1wip79f")&&p(c,"class",m),y&2&&v!==(v=(k[1].faction!==void 0?P.factions[k[1].faction].name:"")+"")&&G(_,v),y&2&&b!==(b=Bi(k[1].faction!==void 0?"textf"+k[1].faction:"")+" svelte-1wip79f")&&p(g,"class",b),y&1&&Le(e,"display",k[0]?"block":"none")},d(k){k&&x(e)}}}function xq(t){let e,n=t[1]&&tS(t);return{c(){n&&n.c(),e=de()},m(o,s){n&&n.m(o,s),w(o,e,s)},p(o,[s]){o[1]?n?n.p(o,s):(n=tS(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(o){o&&x(e),n&&n.d(o)}}}function wq(t,e,n){let o;re(t,km,i=>n(0,o=i));let s;return t.$$.update=()=>{t.$$.dirty&1&&o>0&&I.isEntityIdTaken(o)&&n(1,s=I.entity(o))},[o,s]}var Lv=class extends Ce{constructor(e){super(),Pe(this,e,wq,xq,Be,{})}},nS=Lv;var qv=ha,_u=async t=>{let e=await Ft("/api/account/info");qv.set(e),Oi.set(e.storepoints),t&&t(e)};function Mq(t){let e,n,o,s,i,r,l,a,c=P.ui.elixir.chatsupport+"",f,u,m,g,v,_=P.ui.elixir.noads+"",b,k,y,F,A,C,M,D,$,V=P.ui.elixir.bagslots+"",z,q,L,U,W,R,N,Y,_e,Fe=P.ui.elixir.stashstorage+"",he,ie,le,ge,be,Te,se,Ie,K,Re=P.ui.elixir.merchantlimit+"",Ge,Qe,Ye,pe,ce,Oe,oe,ee,O,ue=P.ui.elixir.merchantduration+"",We;return{c(){e=h("div"),n=h("div"),n.innerHTML='<img class="artwork svelte-cbx1m" src="/data/ui/elixir.svg?v=8738303"/><div class="sparkle svelte-cbx1m" style="font-size:35px; left:30%; top:30%; animation-delay: -1s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:50px; left:40%; top:60%; animation-delay: -2s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:80px; left:60%; top:20%; animation-delay: -3s;">+</div>',o=h("div"),s=h("h1"),s.innerHTML='Hordes <span class="textsub">Elixir</span>',i=h("div"),r=h("img"),a=Ne(),f=T(c),u=h("div"),m=h("img"),v=Ne(),b=T(_),k=h("div"),y=h("img"),A=Ne(),C=h("span"),C.textContent=`${Nn[0].inventory}`,M=Ne(),D=h("span"),D.textContent=`${Nn[1].inventory}`,$=Ne(),z=T(V),q=h("div"),L=h("img"),W=Ne(),R=h("span"),R.textContent=`${Nn[0].stash}`,N=Ne(),Y=h("span"),Y.textContent=`${Nn[1].stash}`,_e=Ne(),he=T(Fe),ie=h("div"),le=h("img"),be=Ne(),Te=h("span"),Te.textContent=`${Nn[0].auction}`,se=Ne(),Ie=h("span"),Ie.textContent=`${Nn[1].auction}`,K=Ne(),Ge=T(Re),Qe=h("div"),Ye=h("img"),ce=Ne(),Oe=h("span"),Oe.textContent=`${Nn[0].auctionHours}h`,oe=Ne(),ee=h("span"),ee.textContent=`${Nn[1].auctionHours}h`,O=Ne(),We=T(ue),p(n,"class","artcontainer svelte-cbx1m"),p(s,"class","textprimary"),p(r,"class","svgicon"),at(r.src,l="/data/ui/icons/gem.svg?v=8738303")||p(r,"src",l),p(i,"class","textwhite"),p(m,"class","svgicon"),at(m.src,g="/data/ui/icons/check.svg?v=8738303")||p(m,"src",g),p(u,"class","textwhite"),p(y,"class","svgicon"),at(y.src,F="/data/ui/icons/check.svg?v=8738303")||p(y,"src",F),p(C,"class","old svelte-cbx1m"),p(D,"class","textsub"),p(k,"class","textwhite"),p(L,"class","svgicon"),at(L.src,U="/data/ui/icons/check.svg?v=8738303")||p(L,"src",U),p(R,"class","old svelte-cbx1m"),p(Y,"class","textsub"),p(q,"class","textwhite"),p(le,"class","svgicon"),at(le.src,ge="/data/ui/icons/check.svg?v=8738303")||p(le,"src",ge),p(Te,"class","old svelte-cbx1m"),p(Ie,"class","textsub"),p(ie,"class","textwhite"),p(Ye,"class","svgicon"),at(Ye.src,pe="/data/ui/icons/check.svg?v=8738303")||p(Ye,"src",pe),p(Oe,"class","old svelte-cbx1m"),p(ee,"class","textsub"),p(Qe,"class","textwhite"),p(e,"class","split svelte-cbx1m")},m(ze,Ae){w(ze,e,Ae),d(e,n),d(e,o),d(o,s),d(o,i),d(i,r),d(i,a),d(i,f),d(o,u),d(u,m),d(u,v),d(u,b),d(o,k),d(k,y),d(k,A),d(k,C),d(k,M),d(k,D),d(k,$),d(k,z),d(o,q),d(q,L),d(q,W),d(q,R),d(q,N),d(q,Y),d(q,_e),d(q,he),d(o,ie),d(ie,le),d(ie,be),d(ie,Te),d(ie,se),d(ie,Ie),d(ie,K),d(ie,Ge),d(o,Qe),d(Qe,Ye),d(Qe,ce),d(Qe,Oe),d(Qe,oe),d(Qe,ee),d(Qe,O),d(Qe,We)},p:ae,i:ae,o:ae,d(ze){ze&&x(e)}}}var Rv=class extends Ce{constructor(e){super(),Pe(this,e,null,Mq,Be,{})}},oS=Rv;var ct={SECONDS_A_MINUTE:60,SECONDS_A_HOUR:3600,SECONDS_A_DAY:86400,SECONDS_A_WEEK:604800,MILLISECONDS_A_SECOND:1e3,MILLISECONDS_A_MINUTE:6e4,MILLISECONDS_A_HOUR:36e5,MILLISECONDS_A_DAY:864e5,MILLISECONDS_A_WEEK:6048e5,MS:"millisecond",S:"second",MIN:"minute",H:"hour",D:"day",W:"week",M:"month",Q:"quarter",Y:"year",DATE:"date",FORMAT_DEFAULT:"YYYY-MM-DDTHH:mm:ssZ",INVALID_DATE_STRING:"Invalid Date",REGEX_PARSE:/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,REGEX_FORMAT:/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g},zv=(t,e,n)=>{let o=String(t);return!o||o.length>=e?t:`${Array(e+1-o.length).join(n)}${t}`},Fq=t=>{let e=-t.utcOffset(),n=Math.abs(e),o=Math.floor(n/60),s=n%60;return`${e<=0?"+":"-"}${zv(o,2,"0")}:${zv(s,2,"0")}`},Cq=(t,e)=>{let n=(e.year()-t.year())*12+(e.month()-t.month()),o=t.clone().add(n,ct.M),s=e-o<0,i=t.clone().add(n+(s?-1:1),ct.M);return Number(-(n+(e-o)/(s?o-i:i-o))||0)},Sq=t=>t<0?Math.ceil(t)||0:Math.floor(t),Pq=t=>({M:ct.M,y:ct.Y,w:ct.W,d:ct.D,h:ct.H,m:ct.MIN,s:ct.S,ms:ct.MS,Q:ct.Q})[t]||String(t||"").toLowerCase().replace(/s$/,""),Aq=t=>t===void 0,Tq={s:zv,z:Fq,m:Cq,a:Sq,p:Pq,u:Aq},Eq={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},Bd="en",Fl={};Fl[Bd]=Eq;var Bv=t=>t instanceof ac,$d=(t,e,n)=>{let o;if(!t)return Bd;if(typeof t=="string")Fl[t]&&(o=t),e&&(Fl[t]=e,o=t);else{let{name:s}=t;Fl[s]=t,o=s}return n||(Bd=o),o},Zn=(t,e,n)=>{if(Bv(t))return t.clone();let o=e?typeof e=="string"?{format:e,pl:n}:e:{};return o.date=t,new ac(o)},Iq=(t,e)=>Zn(t,{locale:e.$L,utc:e.$u,$offset:e.$offset}),cn=Tq;cn.l=$d;cn.i=Bv;cn.w=Iq;var Dq=t=>{let{date:e,utc:n}=t;if(e===null)return new Date(NaN);if(cn.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){let o=e.match(ct.REGEX_PARSE);if(o)return n?new Date(Date.UTC(o[1],o[2]-1,o[3]||1,o[4]||0,o[5]||0,o[6]||0,o[7]||0)):new Date(o[1],o[2]-1,o[3]||1,o[4]||0,o[5]||0,o[6]||0,o[7]||0)}return new Date(e)},ac=class{constructor(e){this.$L=this.$L||$d(e.locale,null,!0),this.parse(e)}parse(e){this.$d=Dq(e),this.init()}init(){let{$d:e}=this;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()}$utils(){return cn}isValid(){return this.$d.toString()!==ct.INVALID_DATE_STRING}isSame(e,n){let o=Zn(e);return this.startOf(n)<=o&&o<=this.endOf(n)}isAfter(e,n){return Zn(e)<this.startOf(n)}isBefore(e,n){return this.endOf(n)<Zn(e)}$g(e,n,o){return cn.u(e)?this[n]:this.set(o,e)}year(e){return this.$g(e,"$y",ct.Y)}month(e){return this.$g(e,"$M",ct.M)}day(e){return this.$g(e,"$W",ct.D)}date(e){return this.$g(e,"$D",ct.DATE)}hour(e){return this.$g(e,"$H",ct.H)}minute(e){return this.$g(e,"$m",ct.MIN)}second(e){return this.$g(e,"$s",ct.S)}millisecond(e){return this.$g(e,"$ms",ct.MS)}unix(){return Math.floor(this.valueOf()/1e3)}valueOf(){return this.$d.getTime()}startOf(e,n){let o=cn.u(n)?!0:n,s=cn.p(e),i=(u,m)=>{let g=cn.w(this.$u?Date.UTC(this.$y,m,u):new Date(this.$y,m,u),this);return o?g:g.endOf(ct.D)},r=(u,m)=>{let g=[0,0,0,0],v=[23,59,59,999];return cn.w(this.toDate()[u].apply(this.toDate(),(o?g:v).slice(m)),this)},{$W:l,$M:a,$D:c}=this,f=`set${this.$u?"UTC":""}`;switch(s){case ct.Y:return o?i(1,0):i(31,11);case ct.M:return o?i(1,a):i(0,a+1);case ct.W:{let u=this.$locale().weekStart||0,m=(l<u?l+7:l)-u;return i(o?c-m:c+(6-m),a)}case ct.D:case ct.DATE:return r(`${f}Hours`,0);case ct.H:return r(`${f}Minutes`,1);case ct.MIN:return r(`${f}Seconds`,2);case ct.S:return r(`${f}Milliseconds`,3);default:return this.clone()}}endOf(e){return this.startOf(e,!1)}$set(e,n){let o=cn.p(e),s=`set${this.$u?"UTC":""}`,i={[ct.D]:`${s}Date`,[ct.DATE]:`${s}Date`,[ct.M]:`${s}Month`,[ct.Y]:`${s}FullYear`,[ct.H]:`${s}Hours`,[ct.MIN]:`${s}Minutes`,[ct.S]:`${s}Seconds`,[ct.MS]:`${s}Milliseconds`}[o],r=o===ct.D?this.$D+(n-this.$W):n;if(o===ct.M||o===ct.Y){let l=this.clone().set(ct.DATE,1);l.$d[i](r),l.init(),this.$d=l.set(ct.DATE,Math.min(this.$D,l.daysInMonth())).toDate()}else i&&this.$d[i](r);return this.init(),this}set(e,n){return this.clone().$set(e,n)}get(e){return this[cn.p(e)]()}add(e,n){e=Number(e);let o=cn.p(n),s=l=>{let a=Zn(this);return cn.w(a.date(a.date()+Math.round(l*e)),this)};if(o===ct.M)return this.set(ct.M,this.$M+e);if(o===ct.Y)return this.set(ct.Y,this.$y+e);if(o===ct.D)return s(1);if(o===ct.W)return s(7);let i={[ct.MIN]:ct.MILLISECONDS_A_MINUTE,[ct.H]:ct.MILLISECONDS_A_HOUR,[ct.S]:ct.MILLISECONDS_A_SECOND}[o]||1,r=this.$d.getTime()+e*i;return cn.w(r,this)}subtract(e,n){return this.add(e*-1,n)}format(e){if(!this.isValid())return ct.INVALID_DATE_STRING;let n=e||ct.FORMAT_DEFAULT,o=cn.z(this),s=this.$locale(),{$H:i,$m:r,$M:l}=this,{weekdays:a,months:c,meridiem:f}=s,u=(_,b,k,y)=>_&&(_[b]||_(this,n))||k[b].substr(0,y),m=_=>cn.s(i%12||12,_,"0"),g=f||((_,b,k)=>{let y=_<12?"AM":"PM";return k?y.toLowerCase():y}),v={YY:String(this.$y).slice(-2),YYYY:this.$y,M:l+1,MM:cn.s(l+1,2,"0"),MMM:u(s.monthsShort,l,c,3),MMMM:c[l]||c(this,n),D:this.$D,DD:cn.s(this.$D,2,"0"),d:String(this.$W),dd:u(s.weekdaysMin,this.$W,a,2),ddd:u(s.weekdaysShort,this.$W,a,3),dddd:a[this.$W],H:String(i),HH:cn.s(i,2,"0"),h:m(1),hh:m(2),a:g(i,r,!0),A:g(i,r,!1),m:String(r),mm:cn.s(r,2,"0"),s:String(this.$s),ss:cn.s(this.$s,2,"0"),SSS:cn.s(this.$ms,3,"0"),Z:o};return n.replace(ct.REGEX_FORMAT,(_,b)=>b||v[_]||o.replace(":",""))}utcOffset(){return-Math.round(this.$d.getTimezoneOffset()/15)*15}diff(e,n,o){let s=cn.p(n),i=Zn(e),r=(i.utcOffset()-this.utcOffset())*ct.MILLISECONDS_A_MINUTE,l=this-i,a=cn.m(this,i);return a={[ct.Y]:a/12,[ct.M]:a,[ct.Q]:a/3,[ct.W]:(l-r)/ct.MILLISECONDS_A_WEEK,[ct.D]:(l-r)/ct.MILLISECONDS_A_DAY,[ct.H]:l/ct.MILLISECONDS_A_HOUR,[ct.MIN]:l/ct.MILLISECONDS_A_MINUTE,[ct.S]:l/ct.MILLISECONDS_A_SECOND}[s]||l,o?a:cn.a(a)}daysInMonth(){return this.endOf(ct.M).$D}$locale(){return Fl[this.$L]}locale(e,n){if(!e)return this.$L;let o=this.clone();return o.$L=$d(e,n,!0),o}clone(){return cn.w(this.$d,this)}toDate(){return new Date(this.valueOf())}toJSON(){return this.isValid()?this.toISOString():null}toISOString(){return this.$d.toISOString()}toString(){return this.$d.toUTCString()}};Zn.prototype=ac.prototype;Zn.extend=(t,e)=>(t(e,ac,Zn),Zn);Zn.locale=$d;Zn.isDayjs=Bv;Zn.unix=t=>Zn(t*1e3);Zn.en=Fl[Bd];Zn.Ls=Fl;var bu=Zn;function sS(t,e,n){let o=t.slice();return o[13]=e[n],o[15]=n,o}function Vq(t){let e=P.ui.elixir.notactive+"",n;return{c(){n=T(e)},m(o,s){w(o,n,s)},p:ae,d(o){o&&x(n)}}}function Lq(t){let e,n,o,s=bu(t[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"",i;return{c(){e=h("img"),o=Ne(),i=T(s),p(e,"class","svgicon"),at(e.src,n="/data/ui/icons/check.svg?v=8738303")||p(e,"src",n)},m(r,l){w(r,e,l),w(r,o,l),w(r,i,l)},p(r,l){l&2&&s!==(s=bu(r[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"")&&G(i,s)},d(r){r&&(x(e),x(o),x(i))}}}function iS(t){let e,n=t[13].name+"",o,s,i,r,l,a,c;i=new vr({props:{amount:t[13].price}});function f(...u){return t[9](t[15],...u)}return{c(){e=h("btn"),o=T(n),s=Ne(),J(i.$$.fragment),p(e,"class",r="btn black navbtn textwhite "+(t[5]==t[15]?"active":"")+" big")},m(u,m){w(u,e,m),d(e,o),d(e,s),Q(i,e,null),l=!0,a||(c=H(e,"click",f),a=!0)},p(u,m){t=u,(!l||m&32&&r!==(r="btn black navbtn textwhite "+(t[5]==t[15]?"active":"")+" big"))&&p(e,"class",r)},i(u){l||(S(i.$$.fragment,u),l=!0)},o(u){E(i.$$.fragment,u),l=!1},d(u){u&&x(e),Z(i),a=!1,c()}}}function rS(t){let e,n=P.ui.elixir.sendgift+"",o,s,i,r;return{c(){e=h("btn"),o=T(n),p(e,"class",s="btn navbtn "+(t[6]?"active white":"textprimary")+" big")},m(l,a){w(l,e,a),d(e,o),i||(r=H(e,"click",t[10]),i=!0)},p(l,a){a&64&&s!==(s="btn navbtn "+(l[6]?"active white":"textprimary")+" big")&&p(e,"class",s)},d(l){l&&x(e),i=!1,r()}}}function qq(t){let e;function n(i,r){return i[0]=="addsubscription"?Bq:zq}let o=n(t,-1),s=o(t);return{c(){e=h("div"),s.c(),p(e,"class","fadeIn card marg-top")},m(i,r){w(i,e,r),s.m(e,null)},p(i,r){o!==(o=n(i,r))&&(s.d(1),s=o(i),s&&(s.c(),s.m(e,null)))},i:ae,o:ae,d(i){i&&x(e),s.d()}}}function Rq(t){let e,n,o=(t[6]?P.ui.elixir.willgift:P.ui.elixir.willadd)+"",s,i,r,l=P.ui.elixir.subduration[t[5]]+"",a,c,f,u,m=P.ui.elixir.willcost+"",g,v,_,b,k,y,F,A,C=(t[6]?P.ui.elixir.send:t[1].subscribed_until?P.ui.elixir.extend:P.ui.elixir.activate)+"",M,D,$,V,z;v=new vr({props:{amount:t[8].price}});let q=[Uq,$q],L=[];function U(N,Y){return N[6]?1:0}b=U(t,-1),k=L[b]=q[b](t);let W=t[0]=="addsubscription"&&t[2]&&lS(t),R=t[1].storepoints<t[8].price&&aS(t);return{c(){e=h("div"),n=h("div"),s=T(o),i=Ne(),r=h("span"),a=T(l),c=Ne(),f=h("span"),f.textContent=`${P.ui.elixir.subscription}`,u=T("? "),g=T(m),J(v.$$.fragment),_=T("."),k.c(),y=de(),W&&W.c(),F=h("div"),A=h("div"),M=T(C),R&&R.c(),p(r,"class","bold textwhite"),p(f,"class","textsub"),p(n,"class","textgrey"),p(A,"class",D="btn grey formatted "+(t[3]=="addsubscription"||t[1].storepoints<t[8].price?"disabled":"")),p(F,"class","subnav"),p(e,"class","fadeIn card marg-top"),Le(e,"padding","18px")},m(N,Y){w(N,e,Y),d(e,n),d(n,s),d(n,i),d(n,r),d(r,a),d(n,c),d(n,f),d(n,u),d(n,g),Q(v,n,null),d(n,_),L[b].m(e,null),d(e,y),W&&W.m(e,null),d(e,F),d(F,A),d(A,M),R&&R.m(e,null),$=!0,V||(z=H(A,"click",t[12]),V=!0)},p(N,Y){(!$||Y&64)&&o!==(o=(N[6]?P.ui.elixir.willgift:P.ui.elixir.willadd)+"")&&G(s,o),(!$||Y&32)&&l!==(l=P.ui.elixir.subduration[N[5]]+"")&&G(a,l);let _e={};Y&256&&(_e.amount=N[8].price),v.$set(_e);let Fe=b;b=U(N,Y),b===Fe?L[b].p(N,Y):(we(),E(L[Fe],1,1,()=>{L[Fe]=null}),Me(),k=L[b],k?k.p(N,Y):(k=L[b]=q[b](N),k.c()),S(k,1),k.m(e,y)),N[0]=="addsubscription"&&N[2]?W?W.p(N,Y):(W=lS(N),W.c(),W.m(e,F)):W&&(W.d(1),W=null),(!$||Y&66)&&C!==(C=(N[6]?P.ui.elixir.send:N[1].subscribed_until?P.ui.elixir.extend:P.ui.elixir.activate)+"")&&G(M,C),(!$||Y&266&&D!==(D="btn grey formatted "+(N[3]=="addsubscription"||N[1].storepoints<N[8].price?"disabled":"")))&&p(A,"class",D),N[1].storepoints<N[8].price?R||(R=aS(N),R.c(),R.m(e,null)):R&&(R.d(1),R=null)},i(N){$||(S(v.$$.fragment,N),S(k),$=!0)},o(N){E(v.$$.fragment,N),E(k),$=!1},d(N){N&&x(e),Z(v),L[b].d(),W&&W.d(),R&&R.d(),V=!1,z()}}}function zq(t){let e;return{c(){e=h("p"),e.textContent="Please Select an option above!",p(e,"class","fadeIn textgrey")},m(n,o){w(n,e,o)},d(n){n&&x(e)}}}function Bq(t){let e;return{c(){e=h("p"),e.textContent=`${P.ui.elixir.thankyou}`,p(e,"class","fadeIn textsub")},m(n,o){w(n,e,o)},d(n){n&&x(e)}}}function $q(t){let e,n,o,s;function i(l){t[11](l)}let r={};return t[7]!==void 0&&(r.name=t[7]),n=new Ml({props:r}),qt.push(()=>ps(n,"name",i)),{c(){e=h("div"),J(n.$$.fragment),p(e,"class","subnav")},m(l,a){w(l,e,a),Q(n,e,null),s=!0},p(l,a){let c={};!o&&a&128&&(o=!0,c.name=l[7],ms(()=>o=!1)),n.$set(c)},i(l){s||(S(n.$$.fragment,l),s=!0)},o(l){E(n.$$.fragment,l),s=!1},d(l){l&&x(e),Z(n)}}}function Uq(t){let e,n=P.ui.elixir.enable+"",o,s,i,r=bu(t[1].subscribed_until||void 0).add(t[8].days,"day").format("MMM DD, YYYY HH:mm")+"",l,a;return{c(){e=h("p"),o=T(n),s=Ne(),i=h("span"),l=T(r),a=T("."),p(i,"class","textwhite"),p(e,"class","bold textsub")},m(c,f){w(c,e,f),d(e,o),d(e,s),d(e,i),d(i,l),d(e,a)},p(c,f){f&258&&r!==(r=bu(c[1].subscribed_until||void 0).add(c[8].days,"day").format("MMM DD, YYYY HH:mm")+"")&&G(l,r)},i:ae,o:ae,d(c){c&&x(e)}}}function lS(t){let e,n;return{c(){e=h("p"),n=T(t[2]),p(e,"class","fadeIn textred")},m(o,s){w(o,e,s),d(e,n)},p(o,s){s&4&&G(n,o[2])},d(o){o&&x(e)}}}function aS(t){let e,n,o=P.ui.elixir.pointserror+"",s,i,r;return{c(){e=h("p"),n=h("small"),s=T(o),i=Ne(),r=h("a"),r.textContent=`${P.ui.elixir.buypoints} ${P.ui.elixir.currency}`,p(r,"class","textprimary"),p(r,"href","/store")},m(l,a){w(l,e,a),d(e,n),d(n,s),d(n,i),d(n,r)},d(l){l&&x(e)}}}function Oq(t){let e,n,o,s,i,r,l,a,c,f,u,m,g,v,_,b;n=new oS({});function k(q,L){return q[1].subscribed_until?Lq:Vq}let y=k(t,-1),F=y(t);a=new vr({props:{amount:t[1].storepoints}});let A=me(Pd),C=[];for(let q=0;q<A.length;q+=1)C[q]=iS(sS(t,A,q));let M=q=>E(C[q],1,1,()=>{C[q]=null}),D=t[5]!==void 0&&rS(t),$=[Rq,qq],V=[];function z(q,L){return q[5]!==void 0?0:1}return v=z(t,-1),_=V[v]=$[v](t),{c(){e=h("div"),J(n.$$.fragment),o=h("small"),o.textContent=`${P.ui.elixir.subscription}`,s=h("div"),F.c(),r=h("small"),r.textContent=`${P.ui.elixir.currency}`,l=h("div"),J(a.$$.fragment),c=Ne(),f=h("a"),f.textContent=`${P.ui.elixir.buypoints} ${P.ui.elixir.currency}`,u=h("p"),u.textContent=`${P.ui.elixir.support}`,m=h("div");for(let q=0;q<C.length;q+=1)C[q].c();g=de(),D&&D.c(),_.c(),p(o,"class","textgrey"),p(s,"class",i="cardinfo "+(t[1].subscribed_until?"textsub":"textgrey")),p(r,"class","textgrey"),p(f,"class","textwhite"),p(f,"href","/store"),p(l,"class","cardinfo"),p(u,"class","textgrey"),p(m,"class","subnav"),p(e,"class","card")},m(q,L){w(q,e,L),Q(n,e,null),d(e,o),d(e,s),F.m(s,null),d(e,r),d(e,l),Q(a,l,null),d(l,c),d(l,f),d(e,u),d(e,m);for(let U=0;U<C.length;U+=1)C[U]&&C[U].m(m,null);d(m,g),D&&D.m(m,null),V[v].m(e,null),b=!0},p(q,[L]){y===(y=k(q,L))&&F?F.p(q,L):(F.d(1),F=y(q),F&&(F.c(),F.m(s,null))),(!b||L&2&&i!==(i="cardinfo "+(q[1].subscribed_until?"textsub":"textgrey")))&&p(s,"class",i);let U={};if(L&2&&(U.amount=q[1].storepoints),a.$set(U),L&32){A=me(Pd);let R;for(R=0;R<A.length;R+=1){let N=sS(q,A,R);C[R]?(C[R].p(N,L),S(C[R],1)):(C[R]=iS(N),C[R].c(),S(C[R],1),C[R].m(m,g))}for(we(),R=A.length;R<C.length;R+=1)M(R);Me()}q[5]!==void 0?D?D.p(q,L):(D=rS(q),D.c(),D.m(m,null)):D&&(D.d(1),D=null);let W=v;v=z(q,L),v===W?V[v].p(q,L):(we(),E(V[W],1,1,()=>{V[W]=null}),Me(),_=V[v],_?_.p(q,L):(_=V[v]=$[v](q),_.c()),S(_,1),_.m(e,null))},i(q){if(!b){S(n.$$.fragment,q),S(a.$$.fragment,q);for(let L=0;L<A.length;L+=1)S(C[L]);S(_),b=!0}},o(q){E(n.$$.fragment,q),E(a.$$.fragment,q),C=C.filter(Boolean);for(let L=0;L<C.length;L+=1)E(C[L]);E(_),b=!1},d(q){q&&x(e),Z(n),F.d(),Z(a),ot(C,q),D&&D.d(),V[v].d()}}}function Nq(t,e,n){let o,s,i=!1,r,{user:l}=e,{flash:a=void 0}=e,{flashmsg:c=void 0}=e,{action:f=void 0}=e,{apiCall:u}=e,m=(b,k)=>n(5,s=b),g=b=>n(6,i=!i);function v(b){r=b,n(7,r)}let _=b=>u("addsubscription","/api/account/addsubscription",{value:s,gift:i?r:void 0},!0,k=>{k.result=="ok"&&(n(5,s=void 0),n(0,a="addsubscription"))});return t.$$set=b=>{"user"in b&&n(1,l=b.user),"flash"in b&&n(0,a=b.flash),"flashmsg"in b&&n(2,c=b.flashmsg),"action"in b&&n(3,f=b.action),"apiCall"in b&&n(4,u=b.apiCall)},t.$$.update=()=>{t.$$.dirty&32&&n(8,o=Pd[s])},[a,l,c,f,u,s,i,r,o,m,g,v,_]}var $v=class extends Ce{constructor(e){super(),Pe(this,e,Nq,Oq,Be,{user:1,flash:0,flashmsg:2,action:3,apiCall:4})}},cS=$v;function fS(t){let e,n;return e=new $t({props:{origin:"center",title:"Store / Elixir",icon:"gem",$$slots:{default:[jq]},$$scope:{ctx:t}}}),e.$on("close",t[6]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&316&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function jq(t){let e,n,o;return n=new cS({props:{user:t[5],flash:t[2],flashmsg:t[3],action:t[4],apiCall:t[0]}}),{c(){e=h("div"),J(n.$$.fragment),p(e,"class","container svelte-1lv1z23")},m(s,i){w(s,e,i),Q(n,e,null),o=!0},p(s,i){let r={};i&32&&(r.user=s[5]),i&4&&(r.flash=s[2]),i&8&&(r.flashmsg=s[3]),i&16&&(r.action=s[4]),n.$set(r)},i(s){o||(S(n.$$.fragment,s),o=!0)},o(s){E(n.$$.fragment,s),o=!1},d(s){s&&x(e),Z(n)}}}function Wq(t){let e,n,o=t[1]&&t[5]&&fS(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[1]&&s[5]?o?(o.p(s,i),i&34&&S(o,1)):(o=fS(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function Gq(t,e,n){let o,s;re(t,Bo,u=>n(1,o=u)),re(t,qv,u=>n(5,s=u));let i,r,l,a,c=async(u,m,g,v,_)=>{n(4,a=u);let b=await Ft(m,g);n(4,a=void 0),b.result==="ok"?n(2,r=void 0):(n(2,r=u),n(3,l=b.result)),v&&_u(),_&&_(b)},f=u=>Xe(Bo,o=!1,o);return t.$$.update=()=>{t.$$.dirty&2&&o&&_u()},[c,o,r,l,a,s,f]}var Uv=class extends Ce{constructor(e){super(),Pe(this,e,Gq,Wq,Be,{apiCall:0})}get apiCall(){return this.$$.ctx[0]}},uS=Uv;function Hq(t){let e,n,o,s,i,r,l,a,c;return{c(){e=h("div"),n=h("h3"),o=T("Hordes.io is free!"),s=h("br"),i=T(`
    Buy `),r=h("span"),r.innerHTML='<span class="textwhite">Hordes</span> <img class="svgicon texticon" src="/data/ui/icons/gem.svg?v=8738303"/>  Elixir',l=T(`
     to hide ads & unlock extra features!`),p(r,"class","btn black textsub"),p(n,"class","textgrey textcenter"),p(e,"class","container panel-black svelte-um60d1")},m(f,u){w(f,e,u),d(e,n),d(n,o),d(n,s),d(n,i),d(n,r),d(n,l),a||(c=H(r,"click",t[1]),a=!0)},p:ae,i:ae,o:ae,d(f){f&&x(e),a=!1,c()}}}function Yq(t,e,n){let o;return re(t,Bo,i=>n(0,o=i)),[o,i=>Xe(Bo,o=!0,o)]}var Ov=class extends Ce{constructor(e){super(),Pe(this,e,Yq,Hq,Be,{})}},mS=Ov;function pS(t,e,n){let o=t.slice();return o[4]=e[n],o}function dS(t){let e,n,o=ro(t[4].viewers)+"",s;return{c(){e=h("div"),n=h("span"),s=T(o),p(n,"class","textgreen"),p(e,"class","bold viewcount textbox svelte-13wcf6i")},m(i,r){w(i,e,r),d(e,n),d(n,s)},p(i,r){r&2&&o!==(o=ro(i[4].viewers)+"")&&G(s,o)},d(i){i&&x(e)}}}function hS(t){let e,n,o,s=t[4].name+"",i,r,l,a,c=t[4].viewers&&dS(t);return{c(){e=h("a"),n=h("div"),c&&c.c(),o=h("div"),i=T(s),p(o,"class","name textbox svelte-13wcf6i"),p(n,"class","border black preview svelte-13wcf6i"),p(n,"style",r=(t[4].preview?"background-image:url("+t[4].preview+");":"")+"); "+(t[0]?"margin-top:2px;":"")),p(e,"class","fadeIn stream svelte-13wcf6i"),p(e,"target","_blank"),p(e,"rel","noopener noreferrer"),p(e,"href",l=t[4].url),p(e,"style",a=t[0]?"":"width:calc(100%/6);")},m(f,u){w(f,e,u),d(e,n),c&&c.m(n,null),d(n,o),d(o,i)},p(f,u){f[4].viewers?c?c.p(f,u):(c=dS(f),c.c(),c.m(n,o)):c&&(c.d(1),c=null),u&2&&s!==(s=f[4].name+"")&&G(i,s),u&3&&r!==(r=(f[4].preview?"background-image:url("+f[4].preview+");":"")+"); "+(f[0]?"margin-top:2px;":""))&&p(n,"style",r),u&2&&l!==(l=f[4].url)&&p(e,"href",l),u&1&&a!==(a=f[0]?"":"width:calc(100%/6);")&&p(e,"style",a)},d(f){f&&x(e),c&&c.d()}}}function Xq(t){let e,n,o=me(t[1]),s=[];for(let i=0;i<o.length;i+=1)s[i]=hS(pS(t,o,i));return{c(){e=h("div");for(let i=0;i<s.length;i+=1)s[i].c();p(e,"style",n="pointer-events: all; "+(t[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))},m(i,r){w(i,e,r);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null)},p(i,[r]){if(r&3){o=me(i[1]);let l;for(l=0;l<o.length;l+=1){let a=pS(i,o,l);s[l]?s[l].p(a,r):(s[l]=hS(a),s[l].c(),s[l].m(e,null))}for(;l<s.length;l+=1)s[l].d(1);s.length=o.length}r&1&&n!==(n="pointer-events: all; "+(i[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))&&p(e,"style",n)},i:ae,o:ae,d(i){i&&x(e),ot(s,i)}}}function Qq(t,e,n){let{vertical:o=!1}=e,s=[],i,r=async()=>{i=setTimeout(r,2e4),n(1,s=await Ft("/api/twitch/streams",{max:6}))};return Fn(r),Tn(l=>{i&&clearTimeout(i)}),t.$$set=l=>{"vertical"in l&&n(0,o=l.vertical)},[o,s]}var Nv=class extends Ce{constructor(e){super(),Pe(this,e,Qq,Xq,Be,{vertical:0})}},gS=Nv;function vS(t){let e,n,o=t[1][3]+"",s,i,r=t[1][1]+"",l,a,c,f=t[1][0]+"",u,m,g,v=t[1][2]+"",_,b,k,y=t[1][4]+"",F,A;return{c(){e=h("small"),n=h("div"),s=T(o),i=h("div"),l=T(r),a=T(" fps"),c=h("div"),u=T(f),m=T(" ms"),g=h("div"),_=T(v),b=T(" KBs"),k=h("div"),F=T(y),A=T(" BFR"),p(n,"class","textyellow"),p(i,"class","textgreen"),p(c,"class","textcyan"),p(g,"class","textorange"),p(k,"class","textpurp"),p(e,"class","marg-top bar btn black grey svelte-nijy6x")},m(C,M){w(C,e,M),d(e,n),d(n,s),d(e,i),d(i,l),d(i,a),d(e,c),d(c,u),d(c,m),d(e,g),d(g,_),d(g,b),d(e,k),d(k,F),d(k,A)},p(C,M){M&2&&o!==(o=C[1][3]+"")&&G(s,o),M&2&&r!==(r=C[1][1]+"")&&G(l,r),M&2&&f!==(f=C[1][0]+"")&&G(u,f),M&2&&v!==(v=C[1][2]+"")&&G(_,v),M&2&&y!==(y=C[1][4]+"")&&G(F,y)},d(C){C&&x(e)}}}function Zq(t){let e,n=t[0]&&vS(t);return{c(){n&&n.c(),e=de()},m(o,s){n&&n.m(o,s),w(o,e,s)},p(o,[s]){o[0]?n?n.p(o,s):(n=vS(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ae,o:ae,d(o){o&&x(e),n&&n.d(o)}}}function Jq(t,e,n){let o,s;return re(t,Ma,i=>n(0,o=i)),re(t,xm,i=>n(1,s=i)),[o,s]}var jv=class extends Ce{constructor(e){super(),Pe(this,e,Jq,Zq,Be,{})}},_S=jv;function bS(t){let e,n;return e=new $t({props:{title:"Item",icon:"char",origin:"center",cog:!1,$$slots:{default:[Kq]},$$scope:{ctx:t}}}),e.$on("close",t[1]),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},p(o,s){let i={};s&5&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function Kq(t){let e,n,o,s;return n=new rc({props:{item:t[0],showTradeInfo:!1,showLore:!1,percentages:!0}}),{c(){e=h("div"),J(n.$$.fragment),p(e,"class",o="panel-black border "+jt(t[0].quality)[0])},m(i,r){w(i,e,r),Q(n,e,null),s=!0},p(i,r){let l={};r&1&&(l.item=i[0]),n.$set(l),(!s||r&1&&o!==(o="panel-black border "+jt(i[0].quality)[0]))&&p(e,"class",o)},i(i){s||(S(n.$$.fragment,i),s=!0)},o(i){E(n.$$.fragment,i),s=!1},d(i){i&&x(e),Z(n)}}}function eR(t){let e,n,o=t[0]&&bS(t);return{c(){o&&o.c(),e=de()},m(s,i){o&&o.m(s,i),w(s,e,i),n=!0},p(s,[i]){s[0]?o?(o.p(s,i),i&1&&S(o,1)):(o=bS(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(we(),E(o,1,1,()=>{o=null}),Me())},i(s){n||(S(o),n=!0)},o(s){E(o),n=!1},d(s){s&&x(e),o&&o.d(s)}}}function tR(t,e,n){let o;return re(t,Lr,i=>n(0,o=i)),[o,()=>{Xe(Lr,o=void 0,o)}]}var Wv=class extends Ce{constructor(e){super(),Pe(this,e,tR,eR,Be,{})}},yS=Wv;var Xv={};Kn(Xv,{canvas:()=>Fo,changeCanvas:()=>jd,init:()=>nR,onWorldDestroy:()=>iR,onWorldEnter:()=>sR,postTick:()=>oR});var cc={neticons:[],npcs:[]},br=.6,Ud=!1,Cl=200,Sl=200,Yv=!1,Od=0,Nd=0,Fo=document.createElement("canvas");Fo.className="border black minimap";var Ps=Fo.getContext("2d"),Gv=new Map,xu=new Map;Fo.addEventListener("wheel",t=>{br=gt(br*(t.deltaY<0?1+.1:1-.1),.25,1.5)},{passive:!0});Fo.addEventListener("mousedown",t=>{Yv=!0});Fo.addEventListener("mouseup",t=>{Yv=!1});Fo.addEventListener("mousemove",t=>{if(Yv){let e=t.movementX,n=t.movementY;Od-=e/br,Nd-=n/br}});var yu={player:"#fff",monster:"#D53434",pvp:It("pvp"),friendly:It("health"),party:It("party"),black:It("black")},nR=()=>{nt.map.onPress(()=>{jd(Ud=!Ud)}),Un(Mt.serverMapUpdate.header,t=>{cc.neticons=Mt.serverMapUpdate.decode(t).icons})},jd=t=>{Od=Nd=0,t?(document.body.appendChild(Fo),Cl=~~Math.min(Math.max(200,window.innerWidth*.7),1e3),Sl=~~Math.min(Math.max(200,window.innerHeight*.7),800),Cl%2!==0&&(Cl+=1),Sl%2!==0&&(Sl+=1),Fo.width=Cl,Fo.height=Sl,Fo.className="border black minimap enlarged"):(document.getElementById("minimapcontainer").appendChild(Fo),Fo.className="border black minimap",Cl=Fo.width=200,Sl=Fo.height=200)},wS=function(){this.loaded=!0},kS=0,oR=t=>{kS++;let e=I.player;if(!e||fe.mapLowQuality&&kS%10!==0)return;let n=Ps;n.globalAlpha=1,n.clearRect(0,0,Cl,Sl);let o=e,s=o.pos[0]+Od,i=o.pos[2]+Nd,r=br<.4?16:4,l=r*64,a=I.chunkAmount,c=Math.round(l*br),f=Cl,u=Sl,m=f*(l/c),g=u*(l/c),v=Math.ceil(m/l),_=Math.ceil(g/l),b=s-m/2,k=i-g/2,y=Math.floor(b/l),F=Math.floor(k/l),A=y+v,C=F+_;(A*l-b)*(c/l)<f&&A++,(C*l-k)*(c/l)<u&&C++,y=Math.max(0,y),F=Math.max(0,F),A=Math.min(a/r,A),C=Math.min(a/r,C);for(let Y=y;Y<A;++Y)for(let _e=F;_e<C;++_e){let Fe=Y*r+_e*a*r,he=r+"-"+Fe;if(xu.has(he)){let ie=xu.get(he);if(ie.loaded){let le=(Y*l-b)*(c/l),ge=(_e*l-k)*(c/l),be=Math.min(1,a/r-Y)*c,Te=Math.min(1,a/r-_e)*c;n.drawImage(ie,le,ge,be,Te)}}else{let ie=new Image;ie.src=ex(I.file,r,Fe),ie.onload=wS,xu.set(he,ie)}}let M=!1,D=[0,0];if(cc.neticons.forEach(Y=>{ku(D,Y.pos[0],Y.pos[1],s,i,c,l,f,u,100)&&(M=M||Y.blink,Hv(D,Y.id,Y.blink))}),M&&(n.globalAlpha=1),cc.npcs.forEach(Y=>{ku(D,Y.pos[0],Y.pos[1],s,i,c,l,f,u,100)&&Hv(D,Y.img,!1)}),I.entities.array.forEach(Y=>{!(!Y.stats||!Y.stats.alive||Y===e)&&ku(D,Y.pos[0],Y.pos[2],s,i,c,l,f,u,50)&&xS(D,Y.type,e.hostility(Y),Y.party>0&&Y.party===e.party)}),Xt.forEach(Y=>{Y.local&&Y.pos!==void 0&&!I.isEntityIdTaken(Y.id)&&ku(D,Y.pos[0],Y.pos[1],s,i,c,l,f,u,100)&&xS(D,0,0,e.party)}),e.buffs.buffs.has(128)){let Y=e.buffs.buffs.get(128).get(e.id);Y.data&&ku(D,Y.data[0],Y.data[1],s,i,c,l,f,u,500)&&Hv(D,2100,!1)}n.globalAlpha=Ud&&I.smoothtime%1<.5?.5:1;let $=I.player.visual.transform.rotation[1],V=Math.sin($)*6,z=Math.cos($)*6,q=Math.sin($+2.4)*6,L=Math.cos($+2.4)*6,U=Math.sin($-2.4)*6,W=Math.cos($-2.4)*6,R=f/2-Od*br,N=u/2-Nd*br;n.fillStyle="#C1DAE2",n.strokeStyle="#1A293A",n.lineWidth=1,n.beginPath(),n.moveTo(R+V,N+z),n.lineTo(R+q,N+L),n.lineTo(R+U,N+W),n.closePath(),n.fill(),n.stroke()},Hv=(t,e,n)=>{if(Gv.has(e)){let o=Gv.get(e);if(o.loaded===!0){!n||I.smoothtime%1<.5?Ps.globalAlpha=n?.6:.8:Ps.globalAlpha=1;let s=o.width,i=o.height;Ps.drawImage(o,t[0]-s/2,t[1]-i/2,~~s,~~i)}}else{let o=document.createElement("img");o.src="data/assets/"+Gp(e)+"?v=8738303",o.onload=wS,Gv.set(e,o)}},xS=(t,e,n,o)=>{if(!(!fe.mapShowMonsters&&e===1))if(e===0){if(Ud&&o&&I.smoothtime%1>.5)return;n===0?Ps.fillStyle=o?yu.party:yu.friendly:Ps.fillStyle=yu.pvp,Ps.fillRect(...t,6,6),Ps.strokeRect(...t,6,6)}else Ps.fillStyle=n>0?yu.monster:yu.friendly,Ps.fillRect(...t,4,4),Ps.strokeRect(...t,4,4)},ku=(t,e,n,o,s,i,r,l,a,c)=>{let f=e-o,u=n-s,m=f/r*i,g=u/r*i,v=l/2+m,_=a/2+g;return v<-c||_<-c||v>l+c||_>a+c?!1:(t[0]=Math.min(l-3,Math.max(0,v)),t[1]=Math.min(a-3,Math.max(0,_)),!0)},sR=t=>{xu.clear();for(let e=0;e<Of.length;++e)Of[e].world===t.idInt&&cc.npcs.push(Of[e])},iR=t=>{xu.clear(),cc.neticons.length=0,cc.npcs.length=0};function MS(t){let e,n,o,s;return{c(){e=h("img"),p(e,"class","btn border black bgblack round warIcon svelte-1khf45q"),at(e.src,n="/data/ui/icons/war0."+On+"?v=8738303")||p(e,"src",n)},m(i,r){w(i,e,r),o||(s=H(e,"click",t[2]),o=!0)},p:ae,d(i){i&&x(e),o=!1,s()}}}function rR(t){let e,n=t[0]!==void 0&&MS(t);return{c(){e=h("div"),n&&n.c(),p(e,"id","minimapcontainer"),p(e,"class","marg-top minimapcontainer svelte-1khf45q")},m(o,s){w(o,e,s),n&&n.m(e,null)},p(o,[s]){o[0]!==void 0?n?n.p(o,s):(n=MS(o),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},i:ae,o:ae,d(o){o&&x(e),n&&n.d()}}}function lR(t,e,n){let o,s;return re(t,Hs,r=>n(0,o=r)),re(t,Ys,r=>n(1,s=r)),Fn(()=>{jd(!1)}),[o,s,r=>Xe(Ys,s=!s,s)]}var Qv=class extends Ce{constructor(e){super(),Pe(this,e,lR,rR,Be,{})}},FS=Qv;function CS(t){let e,n;return e=new mS({}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function SS(t){let e,n;return e=new gS({props:{vertical:!0}}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function aR(t){let e,n,o,s,i,r,l,a,c,f,u,m,g,v,_,b,k,y,F,A,C,M,D,$,V,z,q,L,U,W,R,N,Y,_e,Fe,he,ie,le,ge,be,Te;e=new l6({}),o=new tb({});let se=t[0]&&!t[0].subscribed_until&&(t[1]||t[2]||t[3]||t[4]||t[5])&&CS(t);r=new rC({}),l=new cC({}),a=new e3({}),c=new SF({}),f=new u6({}),u=new Nx({}),m=new eC({}),g=new qx({}),v=new KM({}),_=new s6({}),b=new d6({}),k=new C6({}),y=new ZF({}),F=new $6({}),A=new K6({}),C=new cF({}),M=new pF({}),D=new qF({}),$=new YC({}),V=new eS({}),z=new DC({}),q=new jC({}),L=new uS({}),U=new yS({}),R=new _6({}),N=new FS({}),Y=new _S({});let Ie=t[6]&&SS(t);return ie=new f4({}),le=new HM({}),ge=new nS({}),be=new tC({}),{c(){J(e.$$.fragment),n=h("div"),J(o.$$.fragment),s=h("div"),se&&se.c(),i=de(),J(r.$$.fragment),J(l.$$.fragment),J(a.$$.fragment),J(c.$$.fragment),J(f.$$.fragment),J(u.$$.fragment),J(m.$$.fragment),J(g.$$.fragment),J(v.$$.fragment),J(_.$$.fragment),J(b.$$.fragment),J(k.$$.fragment),J(y.$$.fragment),J(F.$$.fragment),J(A.$$.fragment),J(C.$$.fragment),J(M.$$.fragment),J(D.$$.fragment),J($.$$.fragment),J(V.$$.fragment),J(z.$$.fragment),J(q.$$.fragment),J(L.$$.fragment),J(U.$$.fragment),W=h("div"),J(R.$$.fragment),J(N.$$.fragment),J(Y.$$.fragment),Ie&&Ie.c(),_e=h("div"),Fe=h("div"),he=h("div"),J(ie.$$.fragment),J(le.$$.fragment),J(ge.$$.fragment),J(be.$$.fragment),p(W,"class","l-corner-ur uiscaled"),p(s,"class","container svelte-k3qmu8"),p(he,"class","actionbarcontainer svelte-k3qmu8"),p(Fe,"class","uiscaled"),p(_e,"class","container svelte-k3qmu8"),p(n,"class","l-ui layout svelte-k3qmu8")},m(K,Re){Q(e,K,Re),w(K,n,Re),Q(o,n,null),d(n,s),se&&se.m(s,null),d(s,i),Q(r,s,null),Q(l,s,null),Q(a,s,null),Q(c,s,null),Q(f,s,null),Q(u,s,null),Q(m,s,null),Q(g,s,null),Q(v,s,null),Q(_,s,null),Q(b,s,null),Q(k,s,null),Q(y,s,null),Q(F,s,null),Q(A,s,null),Q(C,s,null),Q(M,s,null),Q(D,s,null),Q($,s,null),Q(V,s,null),Q(z,s,null),Q(q,s,null),Q(L,s,null),Q(U,s,null),d(s,W),Q(R,W,null),Q(N,W,null),Q(Y,W,null),Ie&&Ie.m(W,null),d(n,_e),d(_e,Fe),d(Fe,he),Q(ie,he,null),Q(le,he,null),Q(ge,_e,null),Q(be,n,null),Te=!0},p(K,[Re]){K[0]&&!K[0].subscribed_until&&(K[1]||K[2]||K[3]||K[4]||K[5])?se?Re&63&&S(se,1):(se=CS(K),se.c(),S(se,1),se.m(s,i)):se&&(we(),E(se,1,1,()=>{se=null}),Me()),K[6]?Ie?Re&64&&S(Ie,1):(Ie=SS(K),Ie.c(),S(Ie,1),Ie.m(W,null)):Ie&&(we(),E(Ie,1,1,()=>{Ie=null}),Me())},i(K){Te||(S(e.$$.fragment,K),S(o.$$.fragment,K),S(se),S(r.$$.fragment,K),S(l.$$.fragment,K),S(a.$$.fragment,K),S(c.$$.fragment,K),S(f.$$.fragment,K),S(u.$$.fragment,K),S(m.$$.fragment,K),S(g.$$.fragment,K),S(v.$$.fragment,K),S(_.$$.fragment,K),S(b.$$.fragment,K),S(k.$$.fragment,K),S(y.$$.fragment,K),S(F.$$.fragment,K),S(A.$$.fragment,K),S(C.$$.fragment,K),S(M.$$.fragment,K),S(D.$$.fragment,K),S($.$$.fragment,K),S(V.$$.fragment,K),S(z.$$.fragment,K),S(q.$$.fragment,K),S(L.$$.fragment,K),S(U.$$.fragment,K),S(R.$$.fragment,K),S(N.$$.fragment,K),S(Y.$$.fragment,K),S(Ie),S(ie.$$.fragment,K),S(le.$$.fragment,K),S(ge.$$.fragment,K),S(be.$$.fragment,K),Te=!0)},o(K){E(e.$$.fragment,K),E(o.$$.fragment,K),E(se),E(r.$$.fragment,K),E(l.$$.fragment,K),E(a.$$.fragment,K),E(c.$$.fragment,K),E(f.$$.fragment,K),E(u.$$.fragment,K),E(m.$$.fragment,K),E(g.$$.fragment,K),E(v.$$.fragment,K),E(_.$$.fragment,K),E(b.$$.fragment,K),E(k.$$.fragment,K),E(y.$$.fragment,K),E(F.$$.fragment,K),E(A.$$.fragment,K),E(C.$$.fragment,K),E(M.$$.fragment,K),E(D.$$.fragment,K),E($.$$.fragment,K),E(V.$$.fragment,K),E(z.$$.fragment,K),E(q.$$.fragment,K),E(L.$$.fragment,K),E(U.$$.fragment,K),E(R.$$.fragment,K),E(N.$$.fragment,K),E(Y.$$.fragment,K),E(Ie),E(ie.$$.fragment,K),E(le.$$.fragment,K),E(ge.$$.fragment,K),E(be.$$.fragment,K),Te=!1},d(K){K&&x(n),Z(e,K),Z(o),se&&se.d(),Z(r),Z(l),Z(a),Z(c),Z(f),Z(u),Z(m),Z(g),Z(v),Z(_),Z(b),Z(k),Z(y),Z(F),Z(A),Z(C),Z(M),Z(D),Z($),Z(V),Z(z),Z(q),Z(L),Z(U),Z(R),Z(N),Z(Y),Ie&&Ie.d(),Z(ie),Z(le),Z(ge),Z(be)}}}function cR(t,e,n){let o,s,i,r,l,a,c;return re(t,ha,f=>n(0,o=f)),re(t,Yc,f=>n(1,s=f)),re(t,ds,f=>n(2,i=f)),re(t,Xs,f=>n(3,r=f)),re(t,Jo,f=>n(4,l=f)),re(t,zo,f=>n(5,a=f)),re(t,wa,f=>n(6,c=f)),_u(),[o,s,i,r,l,a,c]}var Zv=class extends Ce{constructor(e){super(),Pe(this,e,cR,aR,Be,{})}},PS=Zv;function AS(t){let e,n;return e=new PS({}),{c(){J(e.$$.fragment)},m(o,s){Q(e,o,s),n=!0},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),n=!1},d(o){Z(e,o)}}}function fR(t){let e,n,o,s;e=new F2({props:{active:t[0]}});let i=t[1]&&!t[0]&&t[2]&&AS(t);return o=new K2({}),{c(){J(e.$$.fragment),i&&i.c(),n=de(),J(o.$$.fragment)},m(r,l){Q(e,r,l),i&&i.m(r,l),w(r,n,l),Q(o,r,l),s=!0},p(r,[l]){let a={};l&1&&(a.active=r[0]),e.$set(a),r[1]&&!r[0]&&r[2]?i?l&7&&S(i,1):(i=AS(r),i.c(),S(i,1),i.m(n.parentNode,n)):i&&(we(),E(i,1,1,()=>{i=null}),Me())},i(r){s||(S(e.$$.fragment,r),S(i),S(o.$$.fragment,r),s=!0)},o(r){E(e.$$.fragment,r),E(i),E(o.$$.fragment,r),s=!1},d(r){r&&x(n),Z(e,r),i&&i.d(r),Z(o,r)}}}function uR(t,e,n){let o,s,i;return re(t,So,r=>n(0,o=r)),re(t,gm,r=>n(1,s=r)),re(t,Wc,r=>n(2,i=r)),[o,s,i]}var Jv=class extends Ce{constructor(e){super(),Pe(this,e,uR,fR,Be,{})}},TS=Jv;var e_=0,ls=0,t_=0,n_=5,wu=10,Mu=10,LS=0,mR=0,o_=0,s_=0,i_=0,r_=0,qS=(t,e)=>{t=Math.max(150,Math.min(1500,t)),ls=t*.8,t_=Math.min(ls,150),e_=20,o_=ls,r_=ls**2,s_=Math.min(ls,50),i_=Math.min(ls/32,150/32)**2,ht.far=LS=t,mR=t**2,Jc(ht),Mu=Math.min(ls,100+e*50),wu=Math.min(ls,40+e*10),n_=(Mu+wu)/2,jn=Math.ceil(t*2/32),jn+=jn%2,Vi=jn/2,Vi+=Vi%2,pR()},Kv=[],yr=[],Wd=[],Pl=[],ES=0,IS=0,Gd=-1/0,Hd=-1/0,Yd=-1/0,Xd=-1/0,kr=-1/0,Fu=-1/0,xr=-1/0,Cu=-1/0,jn=0,Vi=0,pR=()=>{let t=Vi,e=(Math.min(ls*.7,250)/32)**2,n=(Math.max(e,ls)/32)**2,o=(LS/32)**2;Kv.length=0,yr.length=0;for(let s=0;s<jn;++s)for(let i=0;i<jn;++i){let r=(t-i)**2+(t-s)**2,l=0;r>o?l=3:r>n?l=2:r>e&&(l=1),Kv.push(r),yr.push(l)}Wd.length=0;for(let s=0;s<jn;++s)for(let i=0;i<jn;++i){let r=i%2,a=s%2*2+r,c=Math.min(yr[i+s*jn],2);if(c<2){let f=yr[Math.min(jn-1,i+1)+s*jn]>c,u=yr[Math.max(0,i-1)+s*jn]>c,m=yr[i+Math.max(0,s-1)*jn]>c,g=yr[i+Math.min(jn-1,s+1)*jn]>c,v=a*33+c*16+((u?1:0)|(m?2:0)|(f?4:0)|(g?8:0));Wd.push(v)}else Wd.push(a*33+c*16)}},l_=(t,e)=>{if(t<kr||t>=Fu||e<xr||e>=Cu)return 3;let n=t-kr,o=e-xr;return yr[n+o*jn]},RS=(t,e)=>{if(t<kr||t>=Fu||e<xr||e>=Cu)return 1/0;let n=t-kr,o=e-xr;return Kv[n+o*jn]},zS=(t,e)=>{if(t<kr||t>=Fu||e<xr||e>=Cu)return 2*16;let n=t-kr,o=e-xr;return Wd[n+o*jn]},DS=-1/0,VS=-1/0,dR=(t,e,n)=>{if(t=Math.floor(t/64)*2,e=Math.floor(e/64)*2,t!==DS||e!==VS){kr=t-Vi,Fu=t+Vi,xr=e-Vi,Cu=e+Vi,Gd=Math.min(Math.max(0,Math.floor(kr/2)),n-1),Hd=Math.min(Math.max(0,Math.ceil(Fu/2)),n-1),Yd=Math.min(Math.max(0,Math.floor(xr/2)),n-1),Xd=Math.min(Math.max(0,Math.ceil(Cu/2)),n-1),ES=Math.floor(t/2),IS=Math.floor(e/2),DS=t,VS=e,Pl.length=0;let o=new Map,s=0;for(let i=Gd;i<=Hd;++i)for(let r=Yd;r<=Xd;++r){let l=(i-ES)**2+(r-IS)**2;l>((Vi+1)/2)**2||(l=~~l|0,o.has(l)||o.set(l,[]),o.get(l).push(r*n+i,i,r),l>s&&(s=l))}for(let i=0;i<=s;++i)if(o.has(i)){let r=o.get(i);for(let l=0;l<r.length;++l)Pl.push(r[l])}return!0}return!1},a_=!0,BS=(t,e)=>{a_=dR(Yt.position[0],Yt.position[2],e)};var hR=0,US=(t,e,n,o=0,s=!1,i=!1)=>{let r={id:hR++,geometry:Sn({}),program:t,shadowProgram:o,mode:e,uniformData:{},individualFrustums:i,dynamic:s,needsUpdate:!1,lastUpdateCamPos:[0,0,0],drawCount:0,cullFace:1029,instances:[],instancedAttributeNames:[],instancedAttributes:[],instancedData:[]};for(let l=0;l<n.length;++l){let a=n[l];$S(r,a.name,a.size)}return $S(r,"worldMatrix",16),r},$S=(t,e,n)=>{t.instancedAttributes.push({name:e,instanced:!0,bufferMode:t.dynamic?35048:35044,size:n,data:new Float32Array(n)}),t.instancedAttributeNames.push(e),t.instancedData.push([])},c_=t=>{let e=sn();e.geometry=t.geometry,e.data.multi=t,t.instances.push(e);for(let n=0;n<t.instancedAttributes.length;++n){let o=t.instancedAttributes[n],s=t.instancedAttributeNames[n];t.instancedData[n].push(e.data[s]=s==="worldMatrix"?e.worldMatrix:Array(o.size).fill(1))}return t.needsUpdate=!0,e},OS=(t,e,n,o)=>{let s=t.instances.indexOf(e),i=t.instancedAttributeNames.indexOf(n);i>=0&&(t.instancedData[i][s]=o,e.data[n]=o)},As=(t,e)=>{let n=t.instances.indexOf(e);t.instances.splice(n,1);for(let o=0;o<t.instancedAttributes.length;++o)t.instancedData[o].splice(n,1);t.needsUpdate=!0,vs(e)},NS=t=>{for(let e=0;e<t.instances;++e)vs(t[e]);for(let e=0;e<t.instancedAttributes.length;++e)t.instancedData[e].length=0;t.instances.length=0,t.needsUpdate=!0},gR=(t,e)=>{t.needsUpdate=t.dynamic;for(let l=0;l<t.instancedAttributes.length;++l){let a=t.instancedAttributes[l];vR(a,a.size,t.instances.length)}let n=t.dynamic,o=t.individualFrustums,s=t.instancedData,i=t.instances,r=0;for(let l=0;l<i.length;++l){let a=i[l];if(a.visible&&(!n||!o||z2(e,a.geometry,a))){for(let f=0;f<t.instancedAttributes.length;++f){let u=t.instancedAttributes[f],m=u.data,g=s[f][l],v=r*u.size,_=v+u.size;for(let b=v,k=0;b<_;++b,++k)m[b]=g[k]}r++}}if(t.drawCount=r,Bp(t.geometry,t.drawCount),t.drawCount!==0)for(let l=0;l<t.instancedAttributes.length;++l){let a=t.instancedAttributes[l];zp(t.geometry,a,r)}},fc=(t,e,n,o)=>{if(n&&t.needsUpdate&&gR(t,o),e.active&&t.drawCount>0){e.cullFace=t.cullFace;for(let s=0;s<e.autoUniforms.length;++s){let i=e.autoUniforms[s];e.uniforms[i].value=t.uniformData[i]}$p(t.uniformData,e),La(e,tt.currentProgram===e.id),Va(t.geometry,e,t.mode)}},jS=(t,e)=>{let n={...e};for(let o=0;o<t.instancedAttributeNames.length;++o)n[t.instancedAttributeNames[o]]=t.instancedAttributes[o];b1(t.geometry,n)},vR=(t,e,n)=>{t.data=t.data.byteLength>=e*n*4?t.data:new Float32Array(e*(n+5))};var Li=[],WS=(10+1)*6,Tl=new Uint32Array(WS);for(let t=0,e=0;t<WS;t+=6,e+=2)Tl[t+0]=e,Tl[t+1]=e+1,Tl[t+2]=e+3,Tl[t+3]=e,Tl[t+4]=e+3,Tl[t+5]=e+2;var Qd=new Map,GS=(t,e,n,o,s,i)=>{let r=F1.get(t),l=Qd.get(r.steps),a;return!l||l.length===0?a=new f_(r):a=l.pop(),a.reset(r,e,n,o,s,i),Li.push(a),a},HS=(t,e)=>{for(let n=0;n<Li.length;n++)if(Li[n].tick(t,e),Li[n].remove){let o=Li.splice(n--,1)[0];YS(o)}},YS=t=>{Qd.has(t.maxSteps)||Qd.set(t.maxSteps,[]),Qd.get(t.maxSteps).push(t),t.onCache()},XS=t=>{Li.forEach(YS),Li.length=0},QS=()=>{for(let t=0;t<Li.length;++t){let e=Li[t];e.mesh.transform.visible&&ns(e.mesh,ut[e.mesh.program])}},f_=class{constructor(e){this.maxSteps=e.steps,this.stepTimer=new kt(0,1),this.duration=new kt(0,1),this.remove=!1,this.a=[0,0,0],this.b=[0,0,0],this.timeoutSteps=0;let n=this.maxSteps+1;this.uv=new Float32Array(n*4),this.positions=new Float32Array(n*6);for(let o=0,s=0;o<n;++o,s+=4)this.uv[s]=o/this.maxSteps,this.uv[s+2]=o/this.maxSteps,this.uv[s+1]=1,this.uv[s+3]=0;this.geometry=Sn({position:{size:3,data:this.positions},uv:{size:2,data:this.uv},index:{type:j.UNSIGNED_INT,data:Tl.subarray(0,6*this.maxSteps)}}),zp(this.geometry,this.geometry.attributes.uv,n),this.mesh=$o(this.geometry,19,j.TRIANGLES),this.mesh.uniformData.offset=[0,0],this.waitingForTexture=!1,this.parent=null}reset(e,n,o,s,i,r){this.stepTimer.reset(0,e.interval),this.duration.reset(r,i),this.currentStep=0,this.a=st(this.a,o),this.b=st(this.b,s),this.mesh.uniformData.offset[1]=1/(this.maxSteps+1),this.remove=!1,this.timeoutSteps=0,this.geometry.drawRangeCount=0,this.mesh.uniformData.colStart=e.colStart,this.mesh.uniformData.colEnd=e.colEnd,e.texture>0?(this.waitingForTexture=!0,this.mesh.program=19,yo(e.texture,l=>{this.mesh.uniformData.diffuse=l,this.waitingForTexture=!1})):(this.waitingForTexture=!1,this.mesh.program=18,this.mesh.uniformData.diffuse=void 0),this.parent=n}tick(e,n){if(this.waitingForTexture){this.mesh.transform.visible=!1;return}if(this.duration.duration>0&&this.duration.done(n)){this.remove=!0;return}if(this.parent!==null){if(this.mesh.transform.visible=this.parent.visible&&(!this.parent.parent||this.parent.parent.visible),!this.mesh.transform.visible)return;this.mesh.transform.visible&&this.timeoutSteps==0&&(this.positions.set(Ao(_t,this.a,this.parent.worldMatrix),0),this.positions.set(Ao(_t,this.b,this.parent.worldMatrix),3))}this.stepTimer.done(n)&&(this.stepTimer.reset(n),this.step()),bo(this.geometry,this.geometry.attributes.position);let o=this.stepTimer.fraction(n);this.mesh.uniformData.offset[0]=(1-o)/this.maxSteps}detach(){this.timeoutSteps=Math.max(1,this.currentStep),this.parent=null}step(){this.currentStep=Math.min(this.maxSteps,this.currentStep+1),this.positions.copyWithin(6,0),this.geometry.drawRangeCount=this.currentStep*6,this.timeoutSteps>0&&(this.timeoutSteps--,this.timeoutSteps==0&&(this.remove=!0))}onCache(){this.mesh.transform.visible=!1,this.parent=null}};var Zd=[],El=1e3,bR=500,uc=bR,Fr=[],JS=()=>{MR();for(let t=0;t<El;++t)Zd.push({pos:[-0,-0,-0],vel:[-0,-0,-0],info:Np.get(1),distance:0,start:0,end:1.01,forced:!1,scaleRota:[0,0,0,0],infoVec:[0,0,0,0],progVec:[0,0]})},Jd=(t,e,n,o)=>{let s=e,i=n,r=!0,l=n;for(;e-n<0;)r?t[l].distance>t[e].distance?(ZS(t,l,e),l=e,n--,r=!r):e++:t[l].distance>=t[n].distance?n--:(ZS(t,l,n),e++,l=n,r=!r);l-1>s&&Jd(t,s,l-1,o),l+1<i&&Jd(t,l+1,i,o)},ZS=(t,e,n)=>{let o=t[e];t[e]=t[n],t[n]=o},yR=(t,e,n)=>{let o=[[],[]],s=0,i=0;for(;s<Fr.length;){let r=Fr[s];if(r.start<0||r.end>t){if(Fr[i]=r,i++,r.pos[0]>-1e3){let l=r.pos,a=r.vel,c=r.info.acc;if(l[0]+=(a[0]+=c[0]*e)*e,l[1]+=(a[1]+=c[1]*e)*e,l[2]+=(a[2]+=c[2]*e)*e,r.info.friction>0){let f=1-r.info.friction;a[0]*=f,a[1]*=f,a[2]*=f}if(r.distance=hn(n.frustum[5],l)+n.frustumConstants[5],r.distance<s_&&r.distance>0){let f=r.start<0?(Math.sin(t/r.info.duration)+1)*.5:(t-r.start)/r.info.duration;r.progVec[0]=f,r.progVec[1]=Aa[r.info.interp](f),o[r.info.blend].push(r)}}}else uc+=r.forced?1:0,Zd.push(r);++s}return Fr.length=i,Jd(o[0],0,o[0].length-1,o[0].length),Jd(o[1],0,o[1].length-1,o[1].length),o},kR=t=>{for(let e=0;e<2;++e)wR(t[e],Su[e]),xR(t[e],Su[e],Il[e])},xR=(t,e,n)=>{t.length>0?(n.transform.visible=!0,Q3(e,0,t.length),bo(e,e.attributes.position),bo(e,e.attributes.info),bo(e,e.attributes.progress),bo(e,e.attributes.scaleRota),bo(e,e.attributes.colStart),bo(e,e.attributes.colEnd)):n.transform.visible=!1},wR=(t,e)=>{let n=e.attributes.position.data,o=e.attributes.progress.data,s=e.attributes.info.data,i=e.attributes.scaleRota.data,r=e.attributes.colStart.data,l=e.attributes.colEnd.data;for(let a=0;a<t.length;++a){let c=t[a],f=c.pos,u=c.infoVec,m=c.progVec,g=c.scaleRota,v=c.info.colStart,_=c.info.colEnd,b=a*2,k=a*3,y=a*4;n[k]=f[0],n[k+1]=f[1],n[k+2]=f[2],s[y]=u[0],s[y+1]=u[1],s[y+2]=u[2],s[y+3]=u[3],o[b]=m[0],o[b+1]=m[1],i[y]=g[0],i[y+1]=g[1],i[y+2]=g[2],i[y+3]=g[3],r[y]=v[0],r[y+1]=v[1],r[y+2]=v[2],r[y+3]=v[3],l[y]=_[0],l[y+1]=_[1],l[y+2]=_[2],l[y+3]=_[3]}},KS=t=>{let e=yR(Fi,t,ht);kR(e)},Mr=[0,0,0],oi=(t,e,n=0,o=0,s=0,i=0,r=0,l=0,a=!1)=>{if(e?zr(Mr,n,o,s,e):X(Mr,n,o,s),a){if(uc<=0)return}else{if(hn(ht.frustum[0],Mr)+ht.frustumConstants[0]<0||hn(ht.frustum[1],Mr)+ht.frustumConstants[1]<0)return;let v=hn(ht.frustum[5],Mr)+ht.frustumConstants[5];if(v<0||v*10>Zd.length)return}let c=Zd.pop();if(!c){let v=Fr.length-1;for(;v>=0&&Fr[v].forced;)--v;v>=0&&(c=Fr.splice(v,1)[0])}if(!c)return;let f=1;if(e){let v=e[0],_=e[1],b=e[2];f=Math.sqrt(v*v+_*_+b*b),Dm(c.vel,i,r,l,e)}else X(c.vel,i,r,l);c.pos[0]=Mr[0],c.pos[1]=Mr[1],c.pos[2]=Mr[2];let u=Np.get(t);c.info=u,c.start=a?-1:Fi,c.end=c.start+c.info.duration;let m=Math.random()*u.randomRota,g=m+u.rota;return Math.random()<.5&&(m*=-1,g*=-1),so(c.scaleRota,u.scaleStart*f,u.scaleEnd*f,m,g),so(c.infoVec,u.idLoop,0,u.idStart,u.idEnd+1),_o(c.progVec,0,0),c.forced=a,Fr.push(c),a&&uc--,c},Il=[],Su=[],MR=()=>{for(let t=0;t<2;++t)Su[t]=Sn({position:{size:3,data:new Float32Array(3*El)},progress:{size:2,data:new Float32Array(2*El)},info:{size:4,data:new Float32Array(4*El)},scaleRota:{size:4,data:new Float32Array(4*El)},colStart:{size:4,data:new Float32Array(4*El)},colEnd:{size:4,data:new Float32Array(4*El)}});Il[0]=$o(Su[0],17,j.POINTS),Il[1]=$o(Su[1],16,j.POINTS),yo(1215,t=>{qn("particleDiffuse",t,0,ut[17]),qn("particleDiffuse",t,0,ut[16])})};var e8=()=>{let t=ut[17];t.active&&Il[0].transform.visible&&ns(Il[0],t)},t8=()=>{let t=ut[16];t.active&&Il[1].transform.visible&&ns(Il[1],t)};var Au=[],Kd,Pu,n8,o8=()=>{Pu=Qt.pointlights.data.lightCols,Kd=Qt.pointlights.data.lightPos,n8=Qt.pointlights.data.lightCount},s8=t=>{let e=[0,0,0],n=[];for(let s=0,i=Au.length;s<i;++s){let r=Au[s];r.remove?(Au.splice(s,1),--s,--i):r.transform.visible&&(X(e,r.transform.worldMatrix[12],r.transform.worldMatrix[13],r.transform.worldMatrix[14]),r.distance=oo(ht.worldPosition,e),r.distance<r_&&n.push(r))}n.sort((s,i)=>s.distance-i.distance);let o=Math.min(n.length,16);for(let s=0;s<o;++s){let i=n[s],r=s*4,l=s*3;Kd[l]=i.transform.worldMatrix[12],Kd[l+1]=i.transform.worldMatrix[13],Kd[l+2]=i.transform.worldMatrix[14],Pu[r]=i.value[0],Pu[r+1]=i.value[1],Pu[r+2]=i.value[2],Pu[r+3]=i.value[3]}n8[0]=o,lo(Qt.pointlights)},i8=(t,e,n)=>{let o={transform:n,distance:0,remove:!1,value:[...t,e]};return Au.push(o),o},r8=t=>{Au.length=0};var Dl=[Zc(1,1),Zc(1,1)],mc=!1,l8=0,a8=t=>{l8=t},Tu=t=>{mc=t},c8=t=>{let n=[wu,Mu],o=[5,20,20];for(let s=0;s<Dl.length;++s){let i=Dl[s],r=n[s],l=[0,0,0];Dm(l,1,1,1,i.transform.worldMatrix);let a=[...Yt.position],c=o[s];for(let g=0;g<3;++g)a[g]=Math.floor(a[g]/c)*c;let f=(Math.abs(Math.cos(-1))+Math.abs(Math.sin(-1)))*r,u=r,m=[u,f,f];for(let g=0;g<3;++g){let v=m[g]*2/l8,_=a[g]*l[g];_=_-_%v,_=_/l[g],a[g]=_}I2(i.transform.position,a)||(st(i.transform.position,a),X(i.transform.rotation,-1,0,0),i.far=f,i.near=-1e3,R2(i,-u,u,-f,f),ba(i,!0),zm(i),mc=!0)}if(mc){let s=Qt.shadows.data;Ei(s.shadowRange,[wu,n_,Mu],0),Ei(s.shadowPVMatrix,Dl[0].projectionViewMatrix,0),Ei(s.shadowPVMatrix,Dl[1].projectionViewMatrix,16),lo(Qt.shadows)}return mc?1:0};var e0=new Map,t0=[],n0=[],o0=[],s0=[],i0=[],si=(t,e,n,o)=>{let s=t<<1|e;if(s=s<<1|n,s=s<<1|o,e0.has(s))return c_(e0.get(s));{let i=SR(t,e,n,o);return e0.set(s,i),c_(i)}},u8=(t,e,n,o)=>{t?e?n0.push(o):o0.push(o):t0.push(o),n===2?(Tu(!0),s0.push(o)):n===1&&(Tu(!0),i0.push(o))},SR=(t,e,n,o)=>{let s=Ms.get(t),i=Ag[s.shader],r=ut[i],l=fe.shadows&&e?s.texture?1:2:0,a=US(i,j.TRIANGLES,r.instancedAttributes,l,n,o);a.cullFace=s.cull?j.BACK:j.NONE;let c=!1,f=!1;return s.texture?yo(s.texture,u=>{f=!0,a.uniformData.diffuse=u,c&&u8(r.transparent,r.depthWrite,fe.shadows&&e?n?2:1:0,a)}):f=!0,nr(s.geometry,u=>{jS(a,u),c=!0,f&&u8(r.transparent,r.depthWrite,fe.shadows&&e?n?2:1:0,a)}),a},m8=()=>{e0.forEach(NS)};var p8=[{fun:(t,e,n)=>{oi(e[0],t.transform.worldMatrix,e[1],e[2],e[3],e[4],e[5],e[6],!1)}},{fun:(t,e,n)=>{let o=e[1],s=Math.PI*2/o;for(let i=0;i<o;++i){let r=Math.sin(i*s),l=Math.cos(i*s);oi(e[0],t.transform.worldMatrix,r*e[6]+e[2],e[3],l*e[6]+e[4],r*e[5],0,l*e[5],!1)}}},{fun:(t,e,n)=>{for(let o=0;o<e[1];++o)oi(e[0],t.transform.worldMatrix,e[2],e[3],e[4],Kt(e[5],e[6]),Kt(e[7],e[8]),Kt(e[9],e[10]),!1)}},{fun:(t,e,n)=>{ti(e[0],t.transform,t.priority,!1,1)}}];var m_=[{create:(t,e)=>i8([e[0],e[1],e[2]],e[3],t.transform),tick:(t,e,n,o,s)=>{},end:(t,e,n)=>{n.remove=!0},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,o,s)=>{let i=Aa[e[2]](s);n.value[3]=e[0]+i*(e[1]-e[0])}]},{create:(t,e)=>[0,0,0,0],tick:(t,e,n,o,s)=>{n[0]>=e[1]&&(n[0]=0,oi(e[0],t.transform.worldMatrix,Kt(e[2],e[3])+n[1],Kt(e[4],e[5])+n[2],Kt(e[6],e[7])+n[3],Kt(e[8],e[9]),Kt(e[10],e[11]),Kt(e[12],e[13]),!1)),n[0]+=~~(o*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,o,s)=>{let i=e[1]*s;n[1]=Math.sin(i)*e[0],n[3]=Math.cos(i)*e[0]}]},{create:(t,e)=>{if(uc>0)return oi(e[0],t.transform.worldMatrix,0,0,0,0,0,0,!0)},tick:(t,e,n,o,s)=>{},end:(t,e,n)=>{n.start=1,n.end=1},show:(t,e,n)=>{},hide:(t,e,n)=>{n.pos[0]=-1e3},modifiers:[(t,e,n,o,s)=>{let i=e[1]*s;zr(n.pos,Math.sin(i)*e[0],0,Math.cos(i)*e[0],t.transform.worldMatrix)},(t,e,n,o,s)=>{zr(n.pos,e[0],e[1],e[2],t.transform.worldMatrix)}]},{create:(t,e)=>ti(e[0],t.transform,t.priority,!0,1),tick:(t,e,n,o,s)=>{},end:(t,e,n)=>{n.stop()},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>{let n=si(e[0],!1,!0,!0);return X(n.position,e[1],e[2],e[3]),X(n.scale,e[4],e[5],e[6]),X(n.rotation,e[7],e[8],e[9]),Cn(n,t.transform),Bt(n,!1),n},tick:(t,e,n,o,s)=>{},end:(t,e,n)=>{As(n.data.multi,n)},show:(t,e,n)=>{n.visible=!0},hide:(t,e,n)=>{n.visible=!1},modifiers:[(t,e,n,o,s)=>{let i=e[1]*s;n.rotation[1]=e[2]+i,n.position[0]=Math.sin(i)*e[0],n.position[2]=Math.cos(i)*e[0],n.matrixNeedsUpdate=!0,Bt(n,!1)},(t,e,n,o,s)=>{let i=n.data.multi.instancedAttributes[e[0]];for(let r=0;r<i.size;++r)n.data[i.name][r]=e[1+r]},(t,e,n,o,s)=>{let i=n.data.multi.instancedAttributes[e[0]];for(let r=0;r<i.size;++r){let l=e[1+r],a=e[5+r];n.data[i.name][r]=l+s*(a-l)}},(t,e,n,o,s)=>{let i=Aa[e[6]](s);n.scale[0]=e[0]+i*(e[3]-e[0]),n.scale[1]=e[1]+i*(e[4]-e[1]),n.scale[2]=e[2]+i*(e[5]-e[2]),n.matrixNeedsUpdate=!0},(t,e,n,o,s)=>{let i=Aa[e[6]](s);n.rotation[0]=e[0]+i*(e[3]-e[0]),n.rotation[1]=e[1]+i*(e[4]-e[1]),n.rotation[2]=e[2]+i*(e[5]-e[2]),n.matrixNeedsUpdate=!0}]},{create:(t,e)=>GS(e[0],t.transform,[e[1],e[2],e[3]],[e[4],e[5],e[6]],0,0),tick:(t,e,n,o,s)=>{},end:(t,e,n)=>{n.detach()},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,o,s)=>{let i=e[1]*s;n.b[0]=n.a[0]=Math.sin(i)*e[0],n.b[2]=n.a[2]=Math.cos(i)*e[0]}]},{create:(t,e)=>{if(uc<e[1])return;let n=[];for(let o=0;o<e[1];++o)n.push(oi(e[0],t.transform.worldMatrix,0,0,0,0,0,0,!0));return n},tick:(t,e,n,o,s)=>{},end:(t,e,n)=>{for(let o=0;o<n.length;++o){let s=n[o];s.start=s.end=1}},show:(t,e,n)=>{},hide:(t,e,n)=>{for(let o=0;o<n.length;++o){let s=n[o];s.pos[0]=-1e3}},modifiers:[(t,e,n,o,s)=>{let i=n.length,r=6.283/i,l=e[0],a=e[1]*s;for(let c=0;c<i;++c){let f=n[c],u=r*c+a;zr(f.pos,Math.sin(u)*l,0,Math.cos(u)*l,t.transform.worldMatrix)}}]},{create:(t,e)=>[0,0],tick:(t,e,n,o,s)=>{if(n[0]>=e[6]){n[0]=0;let i=e[1],r=Math.PI*2/i;for(let l=0;l<i;++l)oi(e[0],t.transform.worldMatrix,e[2],e[3],e[4],Math.sin(l*r+n[1])*e[5],0,Math.cos(l*r+n[1])*e[5],!1)}n[0]+=~~(o*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,o,s)=>{n[1]=e[0]*s}]},{create:(t,e)=>[0],tick:(t,e,n,o,s)=>{if(n[0]>=e[1]){n[0]=0;let i=sn();X(i.rotation,Kt(e[8],e[9]),Kt(e[10],e[11]),Kt(e[12],e[13])),u_(e[0],i,t.priority,!0),zr(i.position,Kt(e[2],e[3]),Kt(e[4],e[5]),Kt(e[6],e[7]),t.transform.worldMatrix),di(i,!1)}n[0]+=~~(o*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>{let n=Math.sin(t.transform.rotation[1])*Math.cos(t.transform.rotation[0])*e[0],o=-Math.sin(t.transform.rotation[0])*e[0],s=Math.cos(t.transform.rotation[1])*Math.cos(t.transform.rotation[0])*e[0],i=t.info.duration,r=i;if(e[1]){let l=I.raycastEnvironmentClosest(t.transform.position[0],t.transform.position[1],t.transform.position[2],n*i,o*i,s*i);l<1&&(r=i*l)}return[n,o,s,r]},tick:(t,e,n,o,s)=>{if(e[1]&&(n[3]-=o,n[3]<=0)){t.done=!0;return}t.transform.position[0]+=n[0]*o,t.transform.position[1]+=n[1]*o,t.transform.position[2]+=n[2]*o,t.transform.matrixNeedsUpdate=!0,Bt(t.transform,!1)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>[],tick:(t,e,n,o,s)=>{},end:(t,e,n)=>{let o=sn();st(o.position,t.transform.position),st(o.rotation,t.transform.rotation),u_(e[0],o,t.priority,!0),di(o,!1)},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]}],u_,d8=t=>{u_=t};var Lo=[],Vl=[],Ll=[],Eu=[],h8=(t,e)=>{let n=o_;IR(t,e,n),DR(t,e,n),VR(t,e,n),LR(t,e),qR(t,e),RR(t,e);for(let o=0;o<Lo.length;++o){let s=Lo[o],i=s.visible!==s.transform.visible;if(s.visible=s.transform.visible,s.visible)for(let r=0;r<s.info.events.length;++r){let l=s.info.events[r];(s.loops===0||l.fraction>0)&&s.fractionLast<=l.fraction&&s.fractionNow>l.fraction&&p8[l.id].fun(s,l.params,t)}for(let r=0;r<s.info.periods.length;++r){let l=s.info.periods[r],a=m_[l.id],c=s.periodData[r]!==void 0,f=s.fractionNow>=l.fractionStart&&s.fractionNow<=l.fractionEnd,u=!1;if(s.visible&&f&&!c&&s.fractionLast<=l.fractionStart&&(c=(s.periodData[r]=a.create(s,l.params,t))!==void 0,u=c),f&&c&&(i&&(s.visible?a.show(s,l.params,s.periodData[r]):a.hide(s,l.params,s.periodData[r])),s.visible)){let m=s.periodData[r],g=(s.fractionNow-l.fractionStart)/(l.fractionEnd-l.fractionStart);a.tick(s,l.params,m,t,g);for(let v=0;v<l.modifiers.length;++v){let _=l.modifiers[v];(u||i||_.mode===1)&&a.modifiers[_.id](s,_.params,m,t,g)}}!f&&c&&(a.end(s,l.params,s.periodData[r]),s.periodData[r]=void 0)}s.visible&&s.returnTransform&&s.transform.parent===null&&Bt(s.transform,!1)}},p_=[],d_=(t,e,n,o)=>p_.length>0?TR(p_.pop(),t,e,n,o):AR(t,e,n,o),AR=(t,e,n,o)=>({info:t,priority:n,transform:e,returnTransform:o,visible:!0,fractionNow:0,fractionLast:0,timeEnd:0,periodData:[],done:!1,loops:0}),TR=(t,e,n,o,s)=>(t.info=e,t.priority=o,t.transform=n,t.returnTransform=s,t),ER=t=>(t.visible=!0,t.fractionNow=0,t.fractionLast=0,t.timeEnd=0,t.periodData.length=0,t.done=!1,t.loops=0,t),r0=t=>{zR(t),t.returnTransform&&vs(t.transform),p_.push(ER(t))},Ts=(t,e,n,o)=>{let s=zf.get(t),i=d_(s,e,n,o);return Lo.push(i),Vl.push(i),i},Oo=(t,e,n,o)=>{let s=zf.get(t),i=d_(s,e,n,o);return Lo.push(i),Ll.push(i),i},g8=(t,e,n,o)=>{let s=zf.get(t),i=d_(s,e,n,o);return Lo.push(i),Eu.push(i),i},IR=(t,e,n)=>{for(let o=0;o<Vl.length;++o){let s=Vl[o];s.info.duration===0?s.timeEnd===0?(s.timeEnd=e+s.info.duration,s.fractionLast=0,s.fractionNow=.999):(s.fractionLast=0,s.fractionNow=1):(s.timeEnd===0&&(s.timeEnd=e+s.info.duration),s.fractionLast=s.fractionNow,s.fractionNow=gt(1-(s.timeEnd-e)/s.info.duration,0,1))}},DR=t=>{for(let e=0;e<Ll.length;++e){let n=Ll[e];n.fractionLast=n.fractionNow,n.fractionNow=(n.fractionNow+t/n.info.duration)%1,n.fractionLast>n.fractionNow&&(n.fractionLast=0,n.loops++)}},VR=(t,e,n)=>{},LR=(t,e,n)=>{let o=Vl.length;for(;o--;){let s=Vl[o];(s.fractionNow===1||s.done)&&(Vl.splice(o,1),Lo.splice(Lo.indexOf(s),1),r0(s))}},qR=(t,e,n)=>{let o=Ll.length;for(;o--;){let s=Ll[o];s.done&&(Ll.splice(o,1),Lo.splice(Lo.indexOf(s),1),r0(s))}},RR=(t,e,n)=>{let o=Eu.length;for(;o--;){let s=Eu[o];s.done&&(Eu.splice(o,1),Lo.splice(Lo.indexOf(s),1),r0(s))}},zR=t=>{for(let e=0;e<t.info.periods.length;++e){let n=t.info.periods[e],o=m_[n.id];t.periodData[e]!==void 0&&(o.end(t,n.params,t.periodData[e]),t.periodData[e]=void 0)}},v8=t=>{for(let e=0;e<Lo.length;++e)r0(Lo[e]);Lo.length=0,Vl.length=0,Ll.length=0,Eu.length=0};d8(Ts);var pc=[0,2,2.3],dc=[0,0,0];to(pc,pc);var fn={},c0=["fog","sun","direct","ambient","skytop","skymid","skybot","horizon","water","clouds"],f0=["bloom"];for(let t=0;t<c0.length;++t)fn[c0[t]]=[[.5,.5,.5],[.5,.5,.5],[.5,.5,.5]];for(let t=0;t<f0.length;++t)fn[f0[t]]=[0,0,0];var _8=(t,e,n,o)=>{OR(),WR(t,n,e),NR(),e>0&&jR(e,o),lo(Qt.sky),lo(Qt.environment);let s=Qt.environment.data;j.clearColor(s.fog[0],s.fog[1],s.fog[2],1)},$R=(t,e,n,o,s,i,r)=>{let l=[0,0,0],a=[0,0,0];_a(l,e,n,i),_a(a,o,s,i),_a(t,l,a,r)},UR=(t,e,n,o,s,i)=>{let r=Af(s,t,e),l=Af(s,n,o);return Af(i,r,l)},ii=(t,e,n,o,s)=>{let i=[0,0,0],r=[0,0,0];gn(i,n,1-s),gn(r,o,s),t[e]=i[0]+r[0],t[e+1]=i[1]+r[1],t[e+2]=i[2]+r[2]},OR=()=>{let t=Yt.position[0],e=Yt.position[2],n=t,o=e,s=t+32,i=e+32,r=Ua.get(I.getEnvironmentId(n,o)),l=Ua.get(I.getEnvironmentId(s,o)),a=Ua.get(I.getEnvironmentId(n,i)),c=Ua.get(I.getEnvironmentId(s,i));if(!r||!l||!a||!c)return;let f=t/32%1,u=e/32%1;for(let m=0;m<c0.length;++m){let g=c0[m];for(let v=0;v<3;++v)$R(fn[g][v],r[g][v],l[g][v],a[g][v],c[g][v],f,u)}for(let m=0;m<f0.length;++m){let g=f0[m];for(let v=0;v<3;++v)fn[g][v]=UR(r[g][v],l[g][v],a[g][v],c[g][v],f,u)}},NR=()=>{let t=Qt.environment.data.watercolors;for(let e=0;e<9;++e)t[e]=fn.water[Math.floor(e/3)][e%3]},jR=(t,e)=>{let n=Qt.environment.data.worldlight,o=[0,0,0],s=Math.max(0,1-t/80),i=Math.min(1,1-s);ii(o,0,fn.water[1],fn.water[2],i);let r=[0,0,0];r[0]=(n[0]+n[3])*o[0]*1.5,r[1]=(n[1]+n[4])*o[1]*1.5,r[2]=(n[2]+n[5])*o[2]*1.5;let l=Qt.sky.data.skycolors,a=Qt.sky.data.suncolor,c=Qt.environment.data.worldlight,f=Qt.environment.data.fog,u=Math.max(.2,.5*s),m=Math.min(.4,Math.max(.1,.5*s)),g=Math.max(.3,.7*s);for(let v=0;v<15;++v)l[v]=u*r[v%3];X(f,u*r[0],u*r[1],u*r[2]),st(a,f);for(let v=0;v<9;++v)Qt.environment.data.watercolors[v]=m;for(let v=0;v<6;++v)c[v]=g*r[v%3]},l0=0,qi=1,a0=2,u0=[{from:qi,to:l0,start:0,end:0,dur:0},{from:l0,to:l0,start:0,end:0,dur:0},{from:l0,to:qi,start:0,end:0,dur:0},{from:qi,to:qi,start:0,end:0,dur:0},{from:qi,to:a0,start:0,end:0,dur:0},{from:a0,to:a0,start:0,end:0,dur:0},{from:a0,to:qi,start:0,end:0,dur:0},{from:qi,to:qi,start:0,end:0,dur:0}],b8=0;u0.forEach(t=>{let e=t.from!==t.to,n=!e&&t.from!==qi;e?t.dur=.5:n?t.dur=5:t.dur=1.5,b8+=t.dur});var h_=0;u0.forEach(t=>{t.start=h_,h_=t.end=h_+1/b8*t.dur});var WR=(t,e,n)=>{t=gt(t,0,1);let o=.5,s=0,i=0;for(let a=0;a<u0.length;++a){let c=u0[a];if(c.end>=t){o=Pf(c.start,c.end,t),s=c.from,i=c.to;break}}let r=Qt.sky.data;ii(r.skycolors,0,fn.skytop[s],fn.skytop[i],o),ii(r.skycolors,3,fn.skymid[s],fn.skymid[i],o),ii(r.skycolors,6,fn.skybot[s],fn.skybot[i],o),ii(r.skycolors,9,fn.horizon[s],fn.horizon[i],o),ii(r.skycolors,12,fn.clouds[s],fn.clouds[i],o),ii(r.suncolor,0,fn.sun[s],fn.sun[i],o),st(dc,pc),dc[1]=Math.abs(Math.sin(t*6.282)),to(dc,dc);let l=Qt.environment.data;ii(l.worldlight,0,fn.direct[s],fn.direct[i],o),ii(l.worldlight,3,fn.ambient[s],fn.ambient[i],o),l.worldlight[6]=pc[0],l.worldlight[7]=pc[1],l.worldlight[8]=pc[2],ii(l.fog,0,fn.fog[s],fn.fog[i],o),l.fog[3]=n>0?-100:e_,l.fog[4]=n>0?t_:ls,l.daycycle[0]=t,l.time[0]=e%3600,ut[31].uniforms.amount.value=Af(o,fn.bloom[s],fn.bloom[i])};var GR=[],HR=[],k8=(t,e)=>{if(vn===void 0||vn.suspended)return;let n=vn.currentTime,o=Bf.get(I.getAreaId(Yt.position[0],Yt.position[2])),i=t>.5?o.ambientnight:o.ambientday,r=5;e>0&&(i=167,r=.5),y8(GR,n,r,i,!1),y8(HR,n,5,o.music,!0)},y8=(t,e,n,o,s)=>{let i=!1;for(let r=t.length-1;r>=0;--r){let l=t[r],a=l.sound,c=a.gain.gain;l.id===o&&!a.ended?(i=!0,l.fade!==1&&(l.fade=1,c.setTargetAtTime(1,e,n))):c.value<.02||a.ended?(a.stop(),t.splice(r,1)):l.fade!==0&&(l.fade=0,c.setTargetAtTime(0,e,l.fadeDuration))}if(!i&&o!==0){let r=s?wy(o,3):xy(o,2);r&&(r.gain.gain.setValueAtTime(0,e),t.push({id:o,sound:r,fade:0,fadeDuration:n}))}};var Ri=[0,0,0,0],x8=(t,e,n,o)=>{if(I.player&&I.player.buffs.buffs.has(128))Ri[0]=.2,Ri[1]=.4,Ri[2]=.4,Ri[3]=.7,o.add(33),ut[33].uniforms.warp.value=.1,ut[31].uniforms.amount.value=3;else if(e>0){let s=Qt.environment.data.fog;Ri[0]=s[0],Ri[1]=s[1],Ri[2]=s[2],Ri[3]=.5,o.add(33),ut[33].uniforms.warp.value=.3,ut[31].uniforms.amount.value=Math.min(3,Math.max(.3,e/10))}ut[33].uniforms.tint.value=Ri};var w8=()=>{},m0=0,p0=t=>m0=t,M8=(t,e,n)=>{let o=(e/3600+.9)%1;o<.7?o=Pf(0,.7,o)*.4:o=.4+Pf(.7,1,o)*.6,_8(o,m0,e,n),x8(o,m0,e,n),k8(o,m0)};var Iu=()=>[-0,-0,-0,-0,-0,-0],ri=Iu();var F8=(t,e)=>!(t[3]<e[0]||t[0]>e[3]||t[4]<e[1]||t[1]>e[4]||t[5]<e[2]||t[2]>e[5]),XR=(t,e,n,o,s)=>(t[0]=e[0],t[3]=e[0]+n,t[1]=e[1],t[4]=e[1]+o,t[2]=e[2],t[5]=e[2]+s,t);var C8=(t,e)=>{t[0]=t[1]=t[2]=1/0,t[3]=t[4]=t[5]=-1/0;for(let n=0;n<e.length;++n){let o=e[n];t[0]=Math.min(t[0],o[0]),t[3]=Math.max(t[3],o[0]),t[1]=Math.min(t[1],o[1]),t[4]=Math.max(t[4],o[1]),t[2]=Math.min(t[2],o[2]),t[5]=Math.max(t[5],o[2])}return t};var d0=(t,e,n,o,s)=>(X(_t,e[0]-n/2,e[1]-o/2,e[2]-s/2),XR(t,_t,n,o,s));var S8=(t,e,n,o,s)=>{let i=(t[0]-e[0])*n[0],r=(t[1]-e[1])*n[1],l=(t[2]-e[2])*n[2],a=(t[3]-e[0])*n[0],c=(t[4]-e[1])*n[1],f=(t[5]-e[2])*n[2],u=Math.max(o,Math.min(i,a),Math.min(r,c),Math.min(l,f)),m=Math.min(s,Math.max(i,a),Math.max(r,c),Math.max(l,f));return!(m<0||u>m)};var P8=(t,e,n)=>{let o=[0,0,0];for(let s=0;s<6;++s){let i=e[s],r=n[s];if(i[0]>0?o[0]=t[3]:o[0]=t[0],i[1]>0?o[1]=t[4]:o[1]=t[1],i[2]>0?o[2]=t[5]:o[2]=t[2],hn(i,o)+r<0)return!1}return!0};var h0=class{constructor(){this.id=0,this.pos=[-0,-0,-0],this.rot=[-0,-0,-0],this.scale=1,this.matrix=void 0,this.loaded=!1}setWorldMatrix(e,n){this.matrix=e,Bn(_t,n,this.pos),go(kn,this.scale),Vm(Mi,this.rot),Em(this.matrix,Mi,_t,kn)}loadGeometry(e,n){if(!this.loaded){let o=Ms.get(this.id);this.loaded=!0,o.geometry===0?this.postGeometryLoad(e,n):nr(o.geometry,(s,i)=>{let r=!e.finishedLoadingChunks.has(n.id);this.addMesh(e,n),r&&this.addCollider(e,n,s,i),this.postGeometryLoad(e,n)})}}onUpdate(e,n,o){}addMesh(){}postGeometryLoad(e,n){n.loadingProps--}handleColliderGeometry(e,n,o,s){let i=this.matrix,r=o.position,l=o.color,a=o.flags;for(let c=0,f=n.length;c<f;c+=3){let u=n[c],m=n[c+1],g=n[c+2],v=g_(u*3,s,r,i),_=g_(m*3,s,r,i),b=g_(g*3,s,r,i),k=[v,_,b],y=C8(Iu(),k);if(a[u]&1&&a[m]&1&&a[g]&1){if(k.push(Gf([0,0,0],v,_,b)),l.length){let F=[(l[u*4+0]+l[m*4+0]+l[g*4+0])/3,(l[u*4+1]+l[m*4+1]+l[g*4+1])/3,(l[u*4+2]+l[m*4+2]+l[g*4+2])/3,(l[u*4+3]+l[m*4+3]+l[g*4+3])/3];k.push(F)}e.triangleGrid.add(k,y)}}}addCollider(e,n,o,s){let i=new Map;this.handleColliderGeometry(e,s.index,s,i),this.handleColliderGeometry(e,s.indexInvisible,s,i)}onRemove(){}},g_=(t,e,n,o)=>{if(e.has(t))return e.get(t);{let s=[n[t],n[t+1],n[t+2]];return Ao(s,s,o),e.set(t,s),s}};var g0=class extends h0{constructor(){super(),this.mesh=void 0,this.effects=[],this.isEffectProp=!1,this.effectsCreated=!1}onUpdate(e,n,o){this.mesh!==void 0&&this.updateMesh(n),super.onUpdate(e,n,o)}updateMesh(e){this.setWorldMatrix(this.mesh.worldMatrix,e),Bn(this.mesh.position,e,this.pos),X(this.mesh.rotation,this.rot[0],this.rot[1],this.rot[2]),go(this.mesh.scale,this.scale),this.mesh.data.multi&&(this.mesh.data.multi.needsUpdate=!0)}onRemove(e){super.onRemove(e),Ms.get(this.id).effects.length&&this.deleteEffects(),this.mesh&&(this.mesh.data.multi?As(this.mesh.data.multi,this.mesh):vs(this.mesh),this.mesh=void 0)}addMesh(e,n){if(this.mesh===void 0){let o=Ms.get(this.id);this.mesh=si(this.id,o.shadow,!1,!0),this.mesh.visible=!1,this.updateMesh(n.origin),o.effects.length&&(this.isEffectProp=!0)}}onChunkRebuild(e){this.mesh&&this.mesh.data&&this.mesh.data.interiorlight&&I.getInteriorLight(this.mesh.data.interiorlight,d0(ri,this.mesh.position,3,3,3))}createEffects(){if(this.isEffectProp=!0,!this.effectsCreated){let e=Ms.get(this.id).effects;for(let n=0;n<e.length;++n){let o=e[n],s=sn();st(s.position,o.pos),st(s.scale,o.scale),st(s.rotation,o.rot),Cn(s,this.mesh),Bt(s,!0);let i=Oo(o.id,s,0,!0);this.effects.push(i)}this.effectsCreated=!0}}deleteEffects(){if(this.effectsCreated){for(let e=0;e<this.effects.length;++e)this.effects[e].done=!0;this.effects.length=0,this.effectsCreated=!1}}setVisible(e){this.mesh.visible!==e&&(this.mesh.visible=!0,this.mesh.data.multi.needsUpdate=!0)}setEffectVisible(e){this.isEffectProp&&this.effectsCreated!==e&&(e?this.createEffects():this.deleteEffects())}};var T8=(t,e,n)=>{e[n]=(t&31)*8,e[n+1]=(t>>5&31)*8,e[n+2]=(t>>10&31)*8},A8=65536/64,QR=2147483647/2e3,v_=65536/(Math.PI*2),ZR=65536/100;var E8=(t,e)=>(t.id=e.id,X(t.pos,e.x/A8,e.y/QR,e.z/A8),X(t.rot,e.rx/v_,e.ry/v_,e.rz/v_),t.scale=Math.max(e.scale,100)/ZR,t);var I8=(t,e,n,o)=>{t.id=e,t.x=n,t.z=o,t.origin[0]=n*64,t.origin[2]=o*64,t.deserialized=!1,t.props.length=0,t.data=void 0,t.loadingProps=0},D8=(t,e)=>{t.data=e,V8(t),JR(t,!0),t.deserialized=!0},Es=(t,e,n)=>{e/=2.6666666666666665,n/=2.6666666666666665;let o=e%1,s=n%1;if(o===0&&s===0)return t.data.terrain[e+25*n]*.030517578125;{let i=Math.floor(e),r=Math.floor(n),l=o+s<1,a=t.data.terrain[i+25*r+(l?0:1)],c=t.data.terrain[i+25*Math.min(24,r+1)],f=t.data.terrain[i+1+25*(r+(l?0:1))],u=l?-(o-1+s):-(s-1),m=l?s:-(o-1),g=1-u-m;return(u*a+m*c+g*f)*.030517578125}},Vu=(t,e,n)=>{if(t.data.holes.length===0)return!1;e/=2.6666666666666665,n/=2.6666666666666665;let o=Math.floor(e)+Math.floor(n)*24;return t.data.holes.indexOf(o)>=0},Lu=(t,e,n)=>{if(t.data.water.length===0)return-1;e/=64,n/=64;let o=e%1,s=n%1;if(o===0&&s===0)return t.data.water[e+2*n]*.030517578125;{let i=Math.floor(e),r=Math.floor(n),l=o+s<1,a=t.data.water[i+2*r+(l?0:1)],c=t.data.water[i+2*Math.min(2-1,r+1)],f=t.data.water[i+1+2*(r+(l?0:1))],u=l?-(o-1+s):-(s-1),m=l?s:-(o-1),g=1-u-m;return(u*a+m*c+g*f)*.030517578125}};var __=(t,e,n)=>{e/=16,n/=16;let s=Math.floor(e)+Math.floor(n)*4;return t.data.area[s]||0},b_=(t,e,n)=>{e/=32,n/=32;let s=Math.floor(e)+Math.floor(n)*2;return t.data.environment[s]||0},V8=t=>{let e=[-0,-0,-0];for(let n=0;n<24;++n)for(let o=0;o<24;++o){let s=(o*2+24*n*2)*3,i=o*2.6666666666666665,r=n*2.6666666666666665;X(bs,i,Es(t,i,r),r),X(Ep,i,Es(t,i,r+2.6666666666666665),r+2.6666666666666665),X(Sf,i+2.6666666666666665,Es(t,i+2.6666666666666665,r),r),Gf(e,bs,Ep,Sf),t.normals[s]=e[0],t.normals[s+1]=e[1],t.normals[s+2]=e[2],X(bs,i+2.6666666666666665,Es(t,i+2.6666666666666665,r),r),X(Sf,i+2.6666666666666665,Es(t,i+2.6666666666666665,r+2.6666666666666665),r+2.6666666666666665),Gf(e,bs,Ep,Sf),t.normals[s+3]=e[0],t.normals[s+4]=e[1],t.normals[s+5]=e[2]}};var JR=(t,e)=>{for(let n=0,o=t.data.props.length;n<o;++n){let s=t.data.props[n],i=E8(new g0,s);t.props.push(i),e&&t.loadingProps++}for(let n=0;n<t.props.length;++n){let o=t.props[n];o.onUpdate(I,t.origin,I.bounds),o.loadGeometry(I,t)}},KR=t=>{for(let e=0;e<t.props.length;++e)t.props[e].onRemove(t);t.props.length=0},L8=t=>{KR(t)},q8=(t,e)=>Math.floor(t%64/32)+Math.floor(e%64/32)*2,R8=(t,e)=>Math.floor(t%32*3)+Math.floor(e%32*3)*96;var qu=1,v0=t=>{qu=t%2147483647,qu<=0&&(qu+=2147483646),ql(),ql()},ql=()=>qu=qu*16807%2147483647,Ru=()=>(ql()-1)/2147483647,hc=(t,e)=>Ru()*(e-t)+t;var b0,y0,k0,No=[0,0,0],gc,vc,_c,ez=[21,56,50,44,13,19,7,42],k_=3758102380,x_=(t,e)=>t>>e&1,Cr=(t,e,n,o)=>ez[x_(t,o)<<2|x_(e,o)<<1|x_(n,o)],_0=t=>{let e=(No[0]+No[1]+No[2])/6,n=gc-No[0]+e,o=vc-No[1]+e,s=_c-No[2]+e,i=.6-n*n-o*o-s*s,r=tz(b0+No[0],y0+No[1],k0+No[2]);if(No[t]++,i<0)return 0;let l=r>>5&1,a=r>>4&1,c=r>>3&1,f=r>>2&1,u=r&3,m=u===1?n:u===2?o:s,g=u===1?o:u===2?s:n,v=u===1?s:u===2?n:o;return m=l===c?-m:m,g=l===a?-g:g,v=l!==(a^c)?-v:v,i*=i,8*i*i*(m+(u===0?g+v:f===0?g:v))},tz=(t,e,n)=>Cr(t,e,n,0)+Cr(e,n,t,1)+Cr(n,t,e,2)+Cr(t,e,n,3)+Cr(e,n,t,4)+Cr(n,t,e,5)+Cr(t,e,n,6)+Cr(e,n,t,7),B8=(t,e,n)=>{let o=t+k_,s=e+k_,i=n+k_,r=(o+s+i)/3;b0=Math.floor(o+r),y0=Math.floor(s+r),k0=Math.floor(i+r),r=(b0+y0+k0)/6,gc=o-b0+r,vc=s-y0+r,_c=i-k0+r,No[0]=No[1]=No[2]=0;let l=gc>=_c?gc>=vc?0:1:vc>=_c?1:2,a=gc<_c?gc<vc?0:1:vc<_c?1:2;return _0(l)+_0(3-l-a)+_0(a)+_0(0)};var $8=t=>{let e=0,n=0,o=0;for(let u=0;u<t.nodes.length;++u){let m=t.nodes[u],g=m.leafCount,v=m.points.length/2;e+=v*3*g,n+=v*2*g,o+=Math.max(0,(v-2)*3)*g,m.geotype===1&&(o+=3*g*Math.min(1,m.points.length))}let s=new Float32Array(e),i=new Float32Array(n),r=new Uint32Array(o);v0(t.seed);let l=0,a=0,c=0,f=0;for(let u=0;u<t.nodes.length;++u){let m=t.nodes[u],g=m.start,v=m.end,_=Math.atan2(v[1]-g[1],v[0]-g[0]),{geotype:b,leafCount:k,y,radius:F,slant:A,size:C,arc:M,jitter_slant:D,jitter_size:$,jitter_rotation:V,jitter_radius:z,jitter_y:q}=m,L=m.points.length/2,U=Math.PI*2/(k===2?4:k);for(let W=0;W<k;++W){let R=W*U+hc(-V,V),N=A+hc(-D,D),Y=C*hc(1-$,1),_e=F*hc(1-z,1),Fe=y*hc(1-q,1);for(let he=0;he<L;++he){let ie=m.points[he*2],le=m.points[he*2+1],ge=ie-g[0],be=le-g[1],Te=ge*Math.cos(-_)-be*Math.sin(-_),se=ge*Math.sin(-_)+be*Math.cos(-_),Ie=0,K=0,Re=0;if(m.geotype===0){let Ye=N+M*Te;Ie=Math.sin(Ye)*Te,K=Math.cos(Ye)*Te,Re=se}else Ie=Te,K=M*(Math.abs(Te)+Math.abs(se)),Re=se;let Ge=Ie*Math.cos(R)-Re*Math.sin(R),Qe=Ie*Math.sin(R)+Re*Math.cos(R);s[l]=Ge*Y+Math.cos(R)*_e,s[l+1]=Fe+K*Y,s[l+2]=Qe*Y+Math.sin(R)*_e,i[a]=ie,i[a+1]=1-le,l+=3,a+=2}if(b===0)for(let he=0;he<L-2;++he)r[c]=f+he,r[c+1]=f+he+1,r[c+2]=f+he+2,c+=3;else for(let he=0;he<L-1;++he){let ie=he===L-2;r[c]=f,r[c+1]=ie?f+L-1:f+he+1,r[c+2]=ie?f+1:f+he+2,c+=3}f+=L}}return Sn({position:{size:3,data:s},uv:{size:2,data:i},index:{type:5125,data:r}})};var O8=Math.floor(64**2*(fe.foliage/100)),N8=[],x0=[],j8=[];for(let t=0;t<64*64;++t){let e=Math.max(0,B8(Math.floor(t/64)/7,t%64/7,1));j8.push(e)}for(let t=0;t<8;++t)N8.push(new Float32Array(7*O8)),x0.push([]);var W8=(t,e)=>{if(fe.foliage===0||!e)return;sz(t,j),v0(t.id+1e3);let n=t.geometry.foliage.folIds,o=[],s=t.geometry.foliage.instances,i=[];for(let c=0;c<n.length;++c)o.push($a.get(n[c])),i.push(0);let r=fe.foliage,l=!1;t.data.holes.length>0&&(l=!0);let a=[-1,-1,-1,-1];for(let c=0;c<4;++c){let f=t.data.textureid[c];for(let u=0;u<4;++u)f[u]===27&&(a[c]=u)}for(let c=0;c<64;++c)for(let f=0;f<64;++f){if(ql()%100>r)continue;let u=c+t.origin[0],m=f+t.origin[2],g=I.getNormal(u,m);if(g[1]<.6||l&&Vu(t,c,f)||Lu(t,c,f)>Es(t,c,f)+80)continue;let v=q8(c,f),_=R8(c,f),b=t.data.texture[v][_],k=b&31,y=b>>5&31,F=b>>10&31,A=a[v];A>=0&&(A===0&&k>0?k=255:A===1&&y>0?y=255:A===2&&F>0&&(F=255));let C=ql()%Math.max(32,k+y+F),M=3;C<k?M=0:C<k+y?M=1:C<k+y+F&&(M=2);let D=t.data.textureid[v][M],$=Ba.get(D).foliage,V=j8[u%64+m%64*64];for(let z=0;z<$.length;++z){let q=$[z],L=q[1];if(ql()%255>L||q[2]&&V<=0)continue;let U=q[0],W=n.indexOf(U);if(i[W]>=O8||W<0)continue;let R=s[W].attributes.inst.data,N=i[W]*7,Y=Math.max(0,Math.min(64,c-.25+Ru()*.5)),_e=Math.max(0,Math.min(64,f-.25+Ru()*.5)),Fe=Es(t,Y,_e);R[N]=Y+t.origin[0],R[N+1]=Fe,R[N+2]=_e+t.origin[2],R[N+3]=q[2]?.5+Math.min(1.4,V*1.5):.5+Ru(),R[N+4]=g[0]+.001,R[N+5]=g[1],R[N+6]=g[2],i[W]++}}for(let c=0;c<n.length;++c){let f=s[c],u=i[c];Bp(f,u),bo(f,f.attributes.inst),f.bounds=t.geometry.terrain.bounds}},w0=new Map,w_=new Map,U8=new Set,nz=t=>x0[t].length<1?Sn({inst:{instanced:!0,size:7,data:N8[t]}}):x0[t].pop(),oz=(t,e)=>{x0[t].push(e)},sz=(t,e)=>{if(!t.geometry.foliage){let n=t.geometry.foliage={instances:[],folIds:[]};for(let o=0;o<4;++o){let s=t.data.textureid[o];for(let i=0;i<4;++i){let r=Ba.get(s[i]).foliage;for(let l=0;l<r.length;++l)n.folIds.indexOf(r[l][0])<0&&n.folIds.push(r[l][0])}}n.folIds.length>8&&(n.folIds.length=8);for(let o=0;o<n.folIds.length;++o){let s=n.folIds[o];n.instances.push(nz(o));let i=$a.get(s);w0.has(i.id)||w0.set(i.id,$8(i)),U8.has(i.texture)||(U8.add(i.texture),yo(i.texture,r=>{Up(r,16),os(r),w_.set(i.texture,r)}))}}},G8=t=>{if(t.geometry.foliage){for(let e=0;e<t.geometry.foliage.instances.length;++e)oz(e,t.geometry.foliage.instances[e]);t.geometry.foliage=void 0}},H8=(t,e)=>{},Y8=t=>{if(!fe.foliage)return;let e=3,n=2,o=[],s=[],i=[];for(let r=0,l=t.length;r<l;++r){let a=t[r];if(RS(a.x*2,a.z*2)<i_){let c=a.geometry.foliage;for(let f=0;f<c.folIds.length;++f){let u=c.folIds[f],m=o.indexOf(u);m<0&&(o.push(u),s.push([]),i.push($a.get(u).type===0?13:14),m=o.length-1),s[m].push(c.instances[f])}}}for(let r=0;r<o.length;++r){let l=$a.get(o[r]);if(w0.has(l.id)&&w_.has(l.texture)){let a=i[r],c=ut[a];tt.currentProgram!==c.id&&(j.useProgram(c.program),tt.currentProgram=c.id,Ra(c),qa(c),k1(c.uniformArray));let f=w0.get(l.id);Da(f,c),qn("foliageDiffuse",w_.get(l.texture),0,c),Lf(c);let u=s[r];for(let m=0;m<u.length;++m){let g=u[m];j.bindBuffer(j.ARRAY_BUFFER,g.attributes.inst.buffer),j.vertexAttribPointer(e,3,j.FLOAT,!1,7*4,4*4),j.enableVertexAttribArray(e),ya(e,1),j.vertexAttribPointer(n,4,j.FLOAT,!1,7*4,0),j.enableVertexAttribArray(n),ya(n,1),tt.boundBuffer=g.attributes.inst.id,j.drawElementsInstanced(j.TRIANGLES,f.drawRangeCount,f.attributes.index.type,f.drawRangeStart,g.instancedCount)}}}};var bc=[],yc=[],Sr=new Map,X8=(t,e,n,o,s)=>{let i=I.entity(t),r=I.entity(e);if(n.fx.effectMissile&&i!==void 0&&r!==void 0&&(!i.visual.inFog||!r.visual.inFog)){let l={mId:o,targetid:e,timer:s,effect:Oo(n.fx.effectMissile,sn(),i===I.playerId?1:0,!0),start:Bn([0,0,0],Br(_t,[0,0,i.radius],i.rot),i.visualPosition)};l.effect.transform.matrixAutoUpdate=!0,bc.push(l),Sr.set(o,l),Z8(l,bc.length-1)}},Q8=(t,e,n,o,s,i)=>{if(o.fx.effectMissile){let r={mId:s,timer:i,path:e,fractions:n,currentIndex:0,effect:Oo(o.fx.effectMissile,sn(),t===I.playerId?1:0,!0)};r.effect.transform.matrixAutoUpdate=!0,yc.push(r),Sr.set(s,r),J8(r,yc.length-1)}},Z8=(t,e)=>{if(!I.isEntityIdTaken(t.targetid)||t.timer.done(I.smoothtime)){bc.splice(e,1),t.effect.done=!0,Sr.delete(t.mId);return}let n=I.entity(t.targetid),o=Zt(t.effect.transform.position,n.visualPosition,t.start);on(t.effect.transform.position,t.start,o,t.timer.fraction(I.smoothtime));let s=I.getHeight(t.effect.transform.position[0],t.effect.transform.position[2])+.3;s>t.effect.transform.position[1]&&(t.effect.transform.position[1]=s),Ur(t.effect.transform,n.visualPosition,!1,Tp),t.timer.passed(I.smoothtime)>.5&&(st(t.start,t.effect.transform.position),t.timer.reset(I.smoothtime,t.timer.end-I.smoothtime)),Bt(t.effect.transform,!1)},J8=(t,e)=>{if(t.timer.done(I.smoothtime)){yc.splice(e,1),t.effect.done=!0,Sr.delete(t.mId);return}let n=Math.max(0,Math.min(1,t.timer.fraction(I.smoothtime)));t.currentIndex=Sy(t.effect.transform.position,t.path,n,t.fractions),Bt(t.effect.transform,!1)},K8=()=>{bc.forEach(Z8),yc.forEach(J8)},eP=t=>{bc.forEach(e=>{e.effect.done=!0}),yc.forEach(e=>{e.effect.done=!0}),bc.length=0,yc.length=0,Sr.clear()};var as,tP=()=>{as=$o(void 0,11,j.TRIANGLES),go(as.transform.scale,40),as.transform.visible=!1,as.transform.matrixAutoUpdate=!0,nr(1456,t=>{let e=Sn(t);as.geometry=e;let n=Pi(1024,1024,1,!1,j.NONE,j.REPEAT,j.REPEAT);Q2(n),ns(Wf,ut[34]);let o=n.colorTexture;qn("skyDiffuse",o,0,ut[11]),yo(1748,s=>{as.transform.visible=!0,qn("cloudDiffuse",s,0,ut[11])})})},nP=()=>{X(as.transform.position,ht.transform.worldMatrix[12],ht.transform.worldMatrix[13],ht.transform.worldMatrix[14]),Bt(as.transform,!1)},oP=()=>{as.transform.visible&&ns(as,ut[11])};var jo,sP=()=>{jo=$o(void 0,12,j.TRIANGLES),go(jo.transform.scale,.1),Cn(jo.transform,as.transform),jo.transform.visible=!1,nr(1455,t=>{jo.geometry=Sn(t),jo.transform.visible=!0})},iP=()=>{st(jo.transform.position,dc),gn(jo.transform.position,jo.transform.position,.45),Ur(jo.transform,J2,!1,Z2),jo.transform.matrixNeedsUpdate=!0},rP=()=>{jo.transform.visible&&ns(jo,ut[12])};var F0=24,Pt=F0+1,fP=Pt**2,M_=new Map,Pr=96,lP=96/12,kc=8,zu=new Uint8Array(3*Pr**2),F_=new Map,M0=F0/2,aP=3,cP=[1,2,4,8],Rl=[0],en=[],cz=(t,e,n,o)=>{let s=e+n*Pt,i=e+(n+o)*Pt,r=e+(n+o)*Pt+o,l=e+n*Pt+o;en.push(s),en.push(i),en.push(l),en.push(i),en.push(r),en.push(l)};for(let t=0;t<2;++t)for(let e=0;e<2;++e)for(let n=0;n<aP;++n){let o=cP[n],s=cP[n+1],i=e*M0,r=(e+1)*M0,l=t*M0,a=(t+1)*M0;for(let c=0;c<(n===aP-1?1:16);++c){let f=1&c,u=2&c,m=4&c,g=8&c,v=i+(f?o:0),_=r-(m?o:0),b=l+(u?o:0),k=a-(g?o:0);for(let y=b;y<k;y+=o)for(let F=v;F<_;F+=o)cz(en,F,y,o);if(f){for(let y=l;y<a;y+=s){let F=i+y*Pt,A=i+(y+s)*Pt,C=i+(y+o)*Pt+o;if(en.push(F,A,C),y<a-s){let M=C+o*Pt,D=M+o*Pt;en.push(C,A,M),en.push(M,A,D)}}u||en.push(i+l*Pt,i+(l+o)*Pt+o,i+l*Pt+o),g||en.push(i+a*Pt,i+a*Pt+o,i+(a-o)*Pt+o)}if(u){for(let y=i;y<r;y+=s){let F=y+l*Pt,A=y+l*Pt+s,C=y+(l+o)*Pt+o;if(en.push(F,C,A),y<r-s){let M=C+o;en.push(C,M,A),en.push(M,M+o,A)}}f||en.push(i+l*Pt,i+(l+o)*Pt,i+(l+o)*Pt+o),m||en.push(r+l*Pt,r+(l+o)*Pt-o,r+(l+o)*Pt)}if(m){for(let y=l;y<a;y+=s){let F=r+y*Pt,A=r+(y+s)*Pt,C=r+(y+o)*Pt-o;if(en.push(F,C,A),y<a-s){let M=C+o*Pt,D=M+o*Pt;en.push(C,M,A),en.push(M,D,A)}}u||en.push(r+l*Pt,r+l*Pt-o,r+(l+o)*Pt-o),g||en.push(r+a*Pt,r+(a-o)*Pt-o,r+a*Pt-o)}if(g){for(let y=i;y<r;y+=s){let F=y+a*Pt,A=y+a*Pt+s,C=y+(a-o)*Pt+o;if(en.push(F,A,C),y<r-s){let M=C+o,D=M+o;en.push(C,A,M),en.push(M,A,D)}}f||en.push(i+a*Pt,i+(a-o)*Pt+o,i+(a-o)*Pt),m||en.push(r+a*Pt,r+(a-o)*Pt,r+(a-o)*Pt-o)}Rl.push(en.length)}}var fz={type:j.UNSIGNED_INT,data:new Uint32Array(en)},C_=new Float32Array(fP*3),uz=new Float32Array(fP*3);for(let t=0,e=0;t<=F0;++t)for(let n=0;n<=F0;++n,++e)C_[e*3+0]=n*2.6666666666666665,C_[e*3+2]=t*2.6666666666666665;var uP=()=>{},mP=(t,e,n)=>{if(pz(t),e){let o=t.geometry.terrain,s=o.attributes.position.data,i=o.attributes.normal.data;for(let l=0;l<25;++l)for(let a=0;a<25;++a){let c=a+25*l,f=t.data.terrain[c]*.030517578125;s[c*3+1]=f}let r=t.normals;for(let l=0;l<25*25*3;++l)i[l]=0;for(let l=0;l<24;++l)for(let a=0;a<24;++a){let c=(a*2+24*l*2)*3,f=r[c],u=r[c+1],m=r[c+2],g=r[c+3],v=r[c+4],_=r[c+5],b=(a+25*l)*3,k=(a+25*(l+1))*3,y=(a+1+25*l)*3,F=(a+1+25*(l+1))*3;i[b]+=f,i[b+1]+=u,i[b+2]+=m,i[k]+=f+g,i[k+1]+=u+v,i[k+2]+=m+_,i[y]+=f+g,i[y+1]+=u+v,i[y+2]+=m+_,i[F]+=g,i[F+1]+=v,i[F+2]+=_}if(t.z>0){let a=I.getChunk(t.x,t.z-1).normals,c=24-1;for(let f=0;f<24;++f){let u=(f*2+24*c*2)*3,m=a[u],g=a[u+1],v=a[u+2],_=a[u+3],b=a[u+4],k=a[u+5],y=(f+1)*3,F=f*3;i[F]+=m+_,i[F+1]+=g+b,i[F+2]+=v+k,i[y]+=_,i[y+1]+=b,i[y+2]+=k}}if(t.z+1<I.chunkAmount){let a=I.getChunk(t.x,t.z+1).normals,c=0,f=25-1;for(let u=0;u<24;++u){let m=(u*2+24*c*2)*3,g=a[m],v=a[m+1],_=a[m+2],b=a[m+3],k=a[m+4],y=a[m+5],F=(u+25*f)*3,A=(u+1+25*f)*3;i[F]+=g,i[F+1]+=v,i[F+2]+=_,i[A]+=g+b,i[A+1]+=v+k,i[A+2]+=_+y}}if(t.x>0){let a=I.getChunk(t.x-1,t.z).normals,c=24-1;for(let f=0;f<24;++f){let u=(c*2+24*f*2)*3,m=a[u],g=a[u+1],v=a[u+2],_=a[u+3],b=a[u+4],k=a[u+5],y=25*f*3,F=25*(f+1)*3;i[y]+=m+_,i[y+1]+=g+b,i[y+2]+=v+k,i[F]+=_,i[F+1]+=b,i[F+2]+=k}}if(t.x+1<I.chunkAmount){let a=I.getChunk(t.x+1,t.z).normals,c=0,f=25-1;for(let u=0;u<24;++u){let m=(c*2+24*u*2)*3,g=a[m],v=a[m+1],_=a[m+2],b=a[m+3],k=a[m+4],y=a[m+5],F=(f+25*u)*3,A=(f+25*(u+1))*3;i[A]+=g+b,i[A+1]+=v+k,i[A+2]+=_+y,i[F]+=g,i[F+1]+=v,i[F+2]+=_}}for(let l=0;l<25;++l)for(let a=0;a<25;++a){let c=(a+25*l)*3,f=i[c],u=i[c+1],m=i[c+2],g=1/Math.sqrt(f*f+u*u+m*m);i[c]=f*g,i[c+1]=u*g,i[c+2]=m*g}bo(o,o.attributes.position),bo(o,o.attributes.normal)}if(n){let o=t.x*2%kc*2+t.z*2%kc*kc;t.meshes.atlas=dz(t),t.meshes.texSet=t.data.textureid.map(hz);let s=t.data.holes.length>0;for(let i=0;i<2;++i)for(let r=0;r<2;++r){let l=r*2+i,a=t.data.texture[l];for(let f=0;f<Pr;++f)for(let u=0;u<Pr;++u){let m=f*Pr+u,g=m*3;if(T8(a[m],zu,g),s){let v=i*12+Math.floor(u/lP)+(Math.floor(f/lP)+r*12)*24;t.data.holes.indexOf(v)>=0&&(zu[g+0]=255,zu[g+1]=255,zu[g+2]=255)}}ry(t.meshes.atlas,o+l,Pr,Pr,zu);let c=t.meshes.quadrantUbos[l];c.data.quadrant[0]=o+l,c.data.terrainInfo=t.meshes.texSet[l].info,id(c),lo(c)}}},mz={min:[0,0,0],max:[64,64,64],center:[32,32,32],scale:[64,64,64],radius:60,initiated:!0},pz=t=>{if(t.geometry.terrain||(t.geometry.terrain=Sn({position:{size:3,data:C_},normal:{size:3,data:uz},index:fz}),Object.assign(t.geometry.terrain.bounds,mz)),!t.meshes.terrain){let e=$o(t.geometry.terrain,8,j.TRIANGLES);t.meshes.terrain=e,t.meshes.quadrantUbos=[];for(let n=0;n<4;++n){let o=Ja(cu.meshterrain);o.data.modelMatrix=e.transform.matrix,t.meshes.quadrantUbos.push(o)}}st(t.meshes.terrain.transform.position,t.origin),t.meshes.terrain.transform.matrixNeedsUpdate=!0,Bt(t.meshes.terrain.transform,!1),t.state=Math.max(t.state,5)},dz=t=>{let e=Math.floor(t.x*2/kc),n=Math.floor(t.z*2/kc),o=e+1e3*n;if(!M_.has(o)){let s=tr({width:Pr,height:Pr,target:j.TEXTURE_2D_ARRAY,format:j.RGB,internalFormat:j.RGB565,depth:kc**2,flipY:!1,generateMipmaps:!1});Up(s,4),os(s),M_.set(o,s)}return M_.get(o)},hz=t=>{let e=t.join(",");if(!F_.has(e)){let n={info:[],diffuse:[],loaded:0};t.forEach((o,s)=>{let i=Ba.get(o);n.info[s*4+0]=i.scale/127,n.info[s*4+1]=i.darkest/255*3,n.info[s*4+2]=i.brightest/255*3,n.info[s*4+3]=i.spec/255,yo(i.texture,r=>{n.diffuse[s]=r,n.loaded++})}),F_.set(e,n)}return F_.get(e)},pP=t=>{},dP=(t,e)=>{},hP=()=>{},gP=t=>{let e=ut[8];if(!e.active)return;j.useProgram(e.program),tt.currentProgram=e.id,Ra(e),qa(e);let n,o,s=1;for(let r=0;r<t.length;++r){let l=t[r],a=l.meshes.terrain,c=a.geometry;n!==l.meshes.atlas&&(qn("atlas",l.meshes.atlas,0,e),n=l.meshes.atlas),Da(c,e);for(let f=0;f<4;++f)if(l.quadrantlod[f]<=s){let u=l.meshes.texSet[f];if(u.loaded<4)continue;let m=l.meshes.quadrantUbos[f];if(dl(m),o!==u){for(let b=0;b<4;++b)qn("diffuse",u.diffuse[b],b,e);o=u}Lf(e);let g=l.quadrantmask[f],v=Rl[g]*4,_=Rl[g+1]-Rl[g];j.drawElements(a.mode,_,c.attributes.index.type,v)}}let i=ut[9];if(i.active){j.useProgram(i.program),tt.currentProgram=i.id,Ra(i),qa(e);for(let r=0;r<t.length;++r){let l=t[r],a=l.meshes.terrain,c=a.geometry,f=l.meshes.quadrantUbos[0];dl(f),Da(c,i);for(let u=0;u<4;++u)if(l.quadrantlod[u]>s){let m=l.quadrantmask[u],g=Rl[m]*4,v=Rl[m+1]-Rl[m];j.drawElements(a.mode,v,c.attributes.index.type,g)}}}};var vP,_P=()=>{vP=Sn({position:{size:3,data:new Float32Array([0,0,0,64,0,0,0,0,64,64,0,64])},index:{type:j.UNSIGNED_INT,data:new Uint32Array([0,2,1,2,3,1])}}),yo(1748,t=>qn("waterNoise",t,0,ut[20])),yo(1243,t=>qn("waterLines",t,0,ut[20])),qn("bufferPongColor",Ii.colorTexture,0,ut[20]),qn("bufferPongDepth",Ii.depthTexture,0,ut[20])},bP=(t,e)=>{if(!e||t.data.water.length===0)return;t.meshes.waterubo||(t.meshes.waterubo=Ja(cu.water));let n=t.origin[0],o=t.origin[2],s=t.meshes.waterubo.data.verts;for(let i=0;i<4;++i){let r=t.data.water[i]*.030517578125;s[i*3]=n+i%2*64,s[i*3+1]=r,s[i*3+2]=o+Math.floor(i/2)*64}id(t.meshes.waterubo),lo(t.meshes.waterubo)},yP=t=>{},kP=t=>{let e=ut[20];La(e,tt.currentProgram===e.id);for(let n=0,o=t.length;n<o;++n){let s=t[n];s.data.water.length!==0&&(dl(s.meshes.waterubo),Va(vP,e,j.TRIANGLES))}};var xP=t=>{cy(),Jw(),a8(t),w8(),_P(),JS(),o8(),tP(),sP(),hP()},wP=(t,e,n)=>{M8(t,e,n),uP(),c8(e),K8(),h8(t,e),KS(t),s8(t),HS(t,e),nP(),iP(),hy(t)},MP=(t,e)=>{yy(t,e),dP(t,e),H8(t,e)},FP=t=>{eP(t),v8(t),r8(t),XS(t),ky(t)},xc=[],CP=t=>{xc.push(t)},S_=t=>{xc.splice(xc.indexOf(t),1)},SP=t=>{gP(t),e8(),oP(),Y8(t)},PP=t=>{rP()},AP=t=>{kP(t),t8(),QS()},TP=(t,e,n,o,s,i,r)=>{if(t.state!==8&&(mP(t,e,n),W8(t,o),bP(t,i),s))for(let l=0;l<t.props.length;++l)t.props[l].onChunkRebuild(t)},EP=t=>{pP(t),G8(t),yP(t)};var DP=()=>({id:0,x:0,z:0,origin:[0,0,0],deserialized:!1,props:[],normals:new Float32Array(3456),data:void 0,loadingProps:0,center2d:[0,0],geometry:{},meshes:{},state:0,neighbors:[],quadrantlod:[0,0,0,0],quadrantmask:[0,49,98,147],inRange:!1,isMeshVisible:!1,isEffectsVisible:!1,reloadAttempts:0,abort:new AbortController}),P_=(t,e,n,o,s)=>{I8(t,e,n,o),t.reloadAttempts=0,t.center2d[0]=t.origin[0]+64/2,t.center2d[1]=t.origin[2]+64/2,t.neighbors.length=0;for(let i=Math.max(0,n-1);i<=Math.min(s-1,n+1);i++)for(let r=Math.max(0,o-1);r<=Math.min(s-1,o+1);r++){let l=i+r*s;l!==t.id&&t.neighbors.push(l)}t.state=0},VP=t=>t.state>=2?!1:(t.state=2,_z(t),!0),_z=async t=>{try{t.abort=new AbortController;let n=await(await fetch(`data/world/${I.file}/${t.id}?v=8738303`,{signal:t.abort.signal,cache:"default"})).arrayBuffer();if(t.reloadAttempts=0,t.state>2)return;bz(new Uint8Array(n),t)}catch(e){t.state===2&&t.reloadAttempts++<5?(t.state=2-1,VP(t)):console.log(`failed to load chunk ${t.id}, giving up`,e)}},bz=(t,e)=>{e.state=3,D8(e,Sa.chunk.decode(t)),A_(e)},A_=t=>{if(t.inRange=l_(t.x*2,t.z*2)<3,t.inRange)for(let e=0;e<2;++e)for(let n=0;n<2;++n){let o=n*2+e,s=Math.min(2,l_(t.x*2+e,t.z*2+n)),i=zS(t.x*2+e,t.z*2+n);t.quadrantlod[o]=s,t.quadrantmask[o]=i}},LP=(t,e)=>{let n=t.state;if(n===0||n===3){if(t.inRange){n===0&&(t.state=1);let o=t.loadingProps===0;for(let s=0;s<t.neighbors.length;++s){let i=e.chunksMap.get(t.neighbors[s]);i?i.state<3&&(i.state===0&&(i.state=1),o=!1):o=!1}n===3&&o&&(t.state=4,yz(t,!0,!0,!0,!0,!0,!0))}}else n>=5?t.inRange&&t.state<7?(CP(t),t.state=7):!t.inRange&&t.state===7&&(S_(t),Bu(t,!1,!1),t.state=6):n===1&&VP(t)&&(t.state=2)},Bu=(t,e,n)=>{if(t.isMeshVisible!==e){t.isMeshVisible=e;for(let o=0;o<t.props.length;++o)t.props[o].setVisible(e)}if(!n&&t.isEffectsVisible!==e){t.isEffectsVisible=e;for(let o=0;o<t.props.length;++o)t.props[o].setEffectVisible(e)}},yz=(t,e,n,o,s,i,r)=>{TP(t,e,n,o,s,i,r)},T_=t=>{L8(t);let e=t.state===2;t.state===7&&(S_(t),Bu(t,!1,!1),t.state=6),EP(t),t.state=8,e&&t.abort.abort()};var RP=(t,e,n)=>{let o=[];for(let s=0;s<t.length;++s){let i=t[s];P8(i.data.aabb,e.frustum,e.frustumConstants)?(o.push(i),Bu(i,!0,n)):Bu(i,!1,n)}return o},kz=()=>{let t=xc;if(j.enable(j.POLYGON_OFFSET_FILL),j.polygonOffset(1.3,3),mc){for(let e=1;e>=0;--e){let n=Ka[e],o=Dl[e];bd(o,!0),$u(n),Hh(n),t=RP(t,o,!0);for(let s=0,i=i0.length;s<i;++s){let r=i0[s];fc(r,ut[r.shadowProgram],!0,o)}}Tu(!1)}bd(Dl[0],!0),C0(Ka[0],ec,j.DEPTH_BUFFER_BIT),$u(ec);for(let e=0,n=s0.length;e<n;++e){let o=s0[e];fc(o,ut[o.shadowProgram],!1,ht)}j.disable(j.POLYGON_OFFSET_FILL)},xz=t=>{bd(ht,!0),$u(Fs),Hh(Fs);for(let e=0,n=t0.length;e<n;++e){let o=t0[e];fc(o,ut[o.program],!0,ht)}SP(t)},wz=t=>{PP(t);for(let e=0,n=n0.length;e<n;++e){let o=n0[e];fc(o,ut[o.program],!0,ht)}C0(Fs,Ii,j.DEPTH_BUFFER_BIT),C0(Fs,Ii,j.COLOR_BUFFER_BIT),$u(Fs),AP(t);for(let e=0,n=o0.length;e<n;++e){let o=o0[e];fc(o,ut[o.program],!0,ht)}},wc=(t,e,n,o,s)=>{let i=ut[t];n&&qn("inputA",n.colorTexture,0,i),o&&qn("inputB",o.colorTexture,0,i);for(let r=0;r<s.length;++r){let l=i.uniforms[s[r][0]];l.value=s[r][1]}$u(e),ns(Wf,i)},Mz=t=>{let e=Ii,n=Fs;if(t.has(32)&&(t.delete(32),wc(32,e,n,null,[]),[e,n]=[n,e]),t.has(33)&&(t.delete(33),wc(33,e,n,null,[]),[e,n]=[n,e]),t.has(30)){t.delete(30);let o=.5/gl.width,s=.5/gl.height;wc(30,vl,n,null,[["offset",[-o,-s,o,-s,o,s,-o,s]],["amount",[.25,.25,.25,.25]]]);let i=["amount",[.125,.375,.375,.125]];o*=2,s*=2,wc(30,gl,vl,null,[["offset",[-o*2,0,-o,0,o,0,o*2,0]],i]),wc(30,vl,gl,null,[["offset",[0,-s*2,0,-s,0,s,0,s*2]],i]),wc(31,null,n,vl,[])}else C0(n,null,j.COLOR_BUFFER_BIT)},C0=(t,e,n,o=j.NEAREST)=>{let s=t.width,i=t.height,r=e!==null?e.width:Fs.width,l=e!==null?e.height:Fs.height;j.bindFramebuffer(j.READ_FRAMEBUFFER,t.buffer),j.bindFramebuffer(j.DRAW_FRAMEBUFFER,e!==null?e.buffer:null),j.blitFramebuffer(0,0,s,i,0,0,r,l,n,o)},$u=t=>{t?(j.bindFramebuffer(j.FRAMEBUFFER,t.buffer),Kc(t.width,t.height)):(j.bindFramebuffer(j.FRAMEBUFFER,null),Kc(tt.width,tt.height))},zP=t=>{Zx(t)},BP=t=>{kz();let e=RP(xc,ht,!1);xz(e),wz(e),Mz(t)};var Mc=fe.resolution/100,UP=!1,$P=[256,512,1024,2048][fe.shadowmapResolution]||1024,OP=()=>{j||(alert("WebGL2 problem found."),window.location.href="/technical"),NP(),zP($P),xP($P),WP(tt.width,tt.height),Vn.className="l-canvas",To.className="l-canvas",To.style.pointerEvents="all",window.addEventListener("resize",jP,!1)};Nr.subscribe(t=>{qS(t**2/10,fe.shadowmapResolution)});jr.subscribe(t=>{ht.fov=t,Jc(ht)});So.subscribe(t=>{UP=!t});var NP=()=>{let t=window.innerWidth*Mc,e=window.innerHeight*Mc;j2(t,e)},jP=()=>{let t=window.innerWidth*Mc,e=window.innerHeight*Mc;NP(),Jx(t,e),WP(t,e)},WP=(t,e)=>{ht.aspect=t/e,Jc(ht),Kw(t,e)};Wr.subscribe(t=>{let e=t/100,n=Mc!==e;Mc=e,fe.resolutionScale=e,n&&jP()});var GP=(t,e)=>{zm(ht);let n=new Set;fe.fxaa&&n.add(32),fe.bloom&&n.add(30),UP&&(wP(t,e.smoothtime,n),BP(n))},HP=(t,e)=>{MP(t,e)},YP=t=>{FP(t),m8()};Ci.report.fun=t=>{t.length>=3?mi.set({name:t,reason:0,reasonfixed:!1}):Nt("error","Enter a player name to report",!0)};var L_={};Kn(L_,{init:()=>Iz,postTick:()=>Vz,preTick:()=>Dz});var Uu=[],li=0,XP=t=>{li+=t;let e=[];for(let o=0;o<Uu.length;o++){let s=Uu[o];if(s.timer.done(li))Sz(s),Uu.splice(o--,1);else if(li>=s.timer.start){let i=s.timer.fraction(li);st(s.screenPos,s.pos);let r=pl(s.screenPos,s.screenPos,s.flat);if(r){let l=s.timer.remaining(li);if(s.alpha=l<.3?l/.3:1,s.crit){let a=Math.min(1,i*6);s.scale=1+(a>.5?2-a*2:a*2)*1.6}else r[1]-=50-(1-i)**2*50,s.scale=1;e.push(s)}}}if(e.sort((o,s)=>s.timer.start-o.timer.start),fe.combatTextPush){let o=0,s=!0,i=[0,0],r=[0,0];for(;o<10&&s;){++o,s=!1;for(let l=0;l<e.length;++l){let a=e[l],c=a.width*a.scale,f=a.height*a.scale;i[0]=a.screenPos[0]+a.screenOffset[0],i[1]=a.screenPos[1]+a.screenOffset[1];for(let u=0;u<e.length;++u){if(u===l)continue;let m=e[u],g=m.width*m.scale;if(m.flat!==a.flat||g<c||g===c&&l<u)continue;let v=m.height*m.scale;r[0]=m.screenPos[0]+m.screenOffset[0],r[1]=m.screenPos[1]+m.screenOffset[1];let _=r[0]-i[0],b=r[1]-i[1],k=g/2+c/2,y=v/2+f/2;if(Math.abs(_)<k&&Math.abs(b)<y){let F=_<0?_+k:_-k,A=b<0?b+y:b-y;Math.abs(F)<Math.abs(A)*1.2?a.screenOffset[0]+=F:a.screenOffset[1]+=A,s=!0,i[0]=a.screenPos[0]+a.screenOffset[0],i[1]=a.screenPos[1]+a.screenOffset[1]}}}}}let n=[0,0];for(let o=0;o<e.length;++o){let s=e[o];s.screenOffset[0]*=Math.max(0,1-t*3),s.screenOffset[1]*=Math.max(0,1-t*3),n[0]=s.screenPos[0]+s.screenOffset[0],n[1]=s.screenPos[1]+s.screenOffset[1],kx(n,s.img,s.alpha,s.scale)}},I_=(t,e,n,o,s=!1,i)=>{let r=n===3;Ou(t,s,r,s||!r,n===0?"Miss":dt(e)+(n===1?"\u{1F6E1}\uFE0F":""),s?Dt.pdmg:o===1?r?Dt.spellCrit:Dt.spell:r?Dt.physCrit:Dt.phys,i,li,r?1.2:.9)},D_=(t,e,n,o=!1,s)=>{Ou(t,o,n===3,o||n!==3,dt(e),o?Dt.pheal:Dt.heal,s,li,1.3)},QP=(t,e,n)=>{Ou(t,n,!1,!0,"Immune",n?Dt.mana:Dt.spell,e,li,2)},ZP=(t,e,n,o=!1)=>{Ou(t,o,n===3,o||n!==3,e,Dt.mana,0,li,1.3)};var JP=(t,e)=>{Ou(t,!1,!1,!0,`+${e} Fame`,Dt.fame,5.5,li,1.5)},Ou=(t,e=!1,n=!1,o=!1,s,i,r,l,a)=>{let c=Cz();st(c.pos,t),c.pos[1]+=r||0,c.side=Math.sin(Uu.length*2.3),c.flat=e,c.crit=n,c.float=o,c.timer.reset(l,a),X(c.screenPos,0,0,0),_o(c.screenOffset,0,0,0),c.scale=0,c.alpha=0,c.img=nu(s,i),c.width=c.img.width,c.height=c.img.height,Uu.push(c)},E_=[],Cz=()=>E_.length?E_.pop():{pos:[0,0,0],flat:!0,crit:!0,float:!0,yoffset:0,timer:new kt(0,1),screenPos:[0,0,0],screenOffset:[0,0],scale:0,alpha:0,img:void 0,width:0,height:0},Sz=t=>{E_.push(t)};var V_=fe.itemTypeFilter.toLowerCase().replace(/\s/g,"").split(","),Fc=new Set,Pz=(t,e,n)=>{for(let o=n.length-1;o>=0;o--){let s=n[o];(s==e||oo(e.pos,s.pos)<5**2)&&(t.push(s),Bn(t.pos,t.pos,s.pos),n.splice(o,1))}},KP=(t,e)=>{st(t.hudPos,t.visualPosition||t.pos),pl(t.hudPos,t.hudPos)&&t.hudPos[2]<.997&&e.push(t)},eA=t=>{let e=[];I.entities.array.forEach(s=>{s.type!==3||!s.visual.transform.visible||s.quality<fe.itemQualityFilter||V_.includes(s.droptype)||KP(s,e)}),Fc.forEach(s=>{s.uiTimeout<I.time?Fc.delete(s):KP(s,e)}),e=e.sort((s,i)=>i.id-s.id);let n=new Set;for(;e.length;){let s=e[0],i=[];i.pos=[0,0,0],Pz(i,s,e),gn(i.pos,i.pos,1/i.length),X(i.pos,Math.round(i.pos[0]),Math.round(i.pos[1]),Math.round(i.pos[2])),pl(i.pos,i.pos)?n.add(i.sort((r,l)=>r.hudPos[2]-l.hudPos[2])):n.delete(i)}let o=0;Array.from(n).sort((s,i)=>i.pos[2]-s.pos[2]).forEach(s=>{let i=s.length/5*100,r=0,l=0;s.forEach((a,c)=>{a.hudTextImg||(a.hudTextImg=nu(a.name,Dt[a.color]));let f=a.hudTextImg.width,u=Math.round(s.pos[0]+l-i*.5)-2,m=Math.round(s.pos[1]-r*20)-8;if(a.uiTimeout===0){let g=a.canBePickedUpBy(I.player),v=a.partyTimeoutCheck(I.player);g&&!(Wa[0]>u+f||Wa[1]>m+20||Wa[0]<u||Wa[1]<m)?(o=a.id,Eo.globalAlpha=1):Eo.globalAlpha=g?.4:.1,Eo.fillStyle="#000000",Eo.beginPath(),Eo.rect(u,m,f,20),Eo.fill(),ur(_o($n,u+2,m+8),a.name,v?Dt[a.color]:Dt.itemgrey,g?1:.8,1,0,0,0)}l+=f+3,l>i&&(r++,l=0)})}),o!==_n&&fu(o)};var Jn=[],tA,nA,Wo=2,oA=()=>{let n=Math.ceil(100),o=Math.max(7,Math.ceil(9*1)),s=Math.max(1,Math.ceil(Wo*1)),i=n-Wo*2,r=o-Wo*2;Jn.push(Vo(null,It("panel"),n,o,0,0,s)),Vo(Jn[0],It("grey"),i,r,Wo,Wo,1),Jn.push(Vo(null,It("health"),i,r,0,0,1)),Jn.push(Vo(null,"#ffbc00",i,r,0,0,1)),Jn.push(Vo(null,It("enemy"),i,r,0,0,1)),Jn.push(Vo(null,It("party"),i,r,0,0,1)),Jn.push(Vo(null,It("pvp"),i,r,0,0,1)),Jn.push(Vo(null,"#555555",i,r,0,0,1)),Jn.push(Vo(null,It("spell"),i,r,0,0,1));for(let l=0;l<=3;++l)Jn.push(Vo(null,It("c"+l),i,r,0,0,1));tA=Vo(null,"#ffffff",100+Wo*2,9+Wo*2,0,0,3),nA=Vo(null,"#ffffff",100+Wo*2,16+Wo*2,0,0,3)},Az=()=>{let t=[];return I.entities.array.forEach((e,n)=>{!e.visual||!e.visual.transform.visible||e.stats&&!e.stats.alive||e.id!==zn&&e.visual.cDist&&e.visual.cDist>60||e.type===3&&e.id!==_n||(st(e.hudPos,e.visualPosition||e.pos),e.type!==3&&(e.hudPos[1]+=e.visual.getTopAbsolute(),e.mount!==void 0&&(e.hudPos[1]+=1)),pl(e.hudPos,e.hudPos)&&(e.id===I.playerId&&(e.hudPos[0]=Math.round(.5*Vn.width),e.hudPos[1]=Math.round(.5*Vn.height)),t.push(e)))}),t.sort((e,n)=>n.hudPos[2]-e.hudPos[2])},Tz=(t,e,n)=>e?4:n===0?fe.classColorBars&&t.type===0?8+t.class:1:I.player.canCombatInteract(t)?n===2?fe.classColorBars?8+t.class:5:t.type===1&&t.aggroMode===0?2:3:6,Ez=(t,e)=>{let n=t.visual&&t.visual.cDist;if(n>fe.nameplateViewRange)return;n?n/=70:n=0;let o=t.party>0&&t.party===I.player.party,s=t.faction!==void 0?I.player.hostility(t):0,i=I.player.clan,r=I.player.level,l=t.id===zn,a=t.id===I.playerId,c=t.id===_n;if(t.type!==3&&t.stats&&t.stats.alive){t.namePlateScale=gt(t.namePlateScale+((l?1:0)-t.namePlateScale)*.25,.5,1);let m=l?1:Math.max(.1,Math.min(1,1-n))*.7,g=l||o?1:Math.min(.8,c?.9:m*.75+.2),v=t.skills.timedSkill!==void 0;!a&&l&&fr(v?nA:tA,t.hudPos,1,t.namePlateScale,1,v?2:1,0,v?4:0);let _=l||s===0&&fe.nameplateShowFriendlyPlayers||s===1&&fe.nameplateShowMonsters||s===2&&fe.nameplateShowEnemyPlayers;if(v&&_){let b=Jn[0].height-Wo,k=gt(t.skills.timedCast.fraction(I.smoothtime),0,1);fr(Jn[0],t.hudPos,g,t.namePlateScale,1,1,0,b),k>0&&fr(Jn[7],t.hudPos,g,t.namePlateScale,k,1,0,b)}if(!a&&_&&(fr(Jn[0],t.hudPos,g,t.namePlateScale,1,v?2:1),fr(Jn[Tz(t,o,s)],t.hudPos,g,t.namePlateScale,t.stats.getResource(6)/t.stats.getStat(6),1),t.clan&&ur(_o($n,t.hudPos[0]-(Jn[0].width/2+Wo)*t.namePlateScale,t.hudPos[1]),t.clan,t.clan==i?Dt.clan:t.faction===0?Dt.faction0small:Dt.faction1small,g,1,2,0,1),t.level&&(fe.alwaysShowLevel||l))){let b=Dt.lev1;s!==0&&(t.level-r>4?b=Dt.lev3:t.level-r>1?b=Dt.lev2:t.level-r<-5&&(b=Dt.lev0)),ur(_o($n,t.hudPos[0]+(Jn[0].width/2+Wo)*t.namePlateScale,t.hudPos[1]),t.level,b,g,1,0,0,0)}}let f,u=!1;if(t.type===3?(f=t.partyTimeoutCheck(I.player)?Dt[t.color]:Dt.itemgrey,u=!0):s===0?(f=l?Dt.name:Dt.nameSmall,u=fe.nameShowFriendlyPlayers):s===1?(f=l?Dt.enemy:Dt.enemySmall,u=fe.nameShowMonsters):s===2&&(f=l?Dt.pvp:Dt.pvpSmall,u=fe.nameShowEnemyPlayers),l||u){let m=t.type===3&&c&&!t.canBePickedUpBy(I.player)?.5:l||t.type===3?1:c?.9:Math.max(.1,Math.min(1,1-n))*.7,g=l?-16:-9,v=a&&t.clan?t.clan.length*5:0,_=ur(t.hudPos,t.name,f,m,1,v,g);t.clan&&a&&ur(_o($n,t.hudPos[0]-_/2+Wo,t.hudPos[1]),t.clan,t.faction===0?l?Dt.faction0:Dt.faction0small:l?Dt.faction1:Dt.faction1small,m,1,t.clan.length*5,g,1)}t.speechText&&ur(t.hudPos,t.speechText,t.speechStyle,1,1,0,l?-30:-20,.5,1)},sA=t=>{Fc.clear();let e=Az();qg(e),e=e.sort((n,o)=>n.id===zn||n.id===_n?1:o.id===zn||o.id===_n?-1:o.hudPos[2]-n.hudPos[2]),so(Mi,0,0,0,0),e.forEach(Ez)};var Iz=()=>{yx(),oA()},Dz=()=>{Eo.clearRect(0,0,Vn.width,Vn.height)},Vz=t=>{nt.shift.down?eA(t):sA(t),XP(t)};var q_={};Kn(q_,{onWorldEnter:()=>Lz});var Lz=()=>{yt("petlootsettings",V_.join(",")+" "+fe.itemQualityFilter)};var R_={};Kn(R_,{init:()=>qz});var qz=()=>{Un(Mt.serverWarUpdate.header,t=>{let e=Mt.serverWarUpdate.decode(t);Hs.update(n=>(n===void 0||e.contributors.length===0&&(e.contributors=n.contributors),e))})};var Cc=[L_,Rg,Qg,dv,Xv,X1,f1,hg,h1,q_,cg,Lp,R_],z_=!1,iA=()=>{Cc.forEach(t=>{t.init&&t.init()})},rA=t=>{Cc.forEach(e=>{e.preTick&&e.preTick(t)})},lA=t=>{Cc.forEach(e=>{e.tick&&e.tick(t)})},aA=(t,e)=>{Cc.forEach(n=>{n.postTick&&n.postTick(t,e)})},cA=t=>{Cc.forEach(e=>{e.onWorldEnter&&e.onWorldEnter(t)}),z_=!0},fA=t=>{z_&&Cc.forEach(e=>{e.onWorldDestroy&&e.onWorldDestroy(t)}),z_=!1};var mA=async t=>{let n=await(await fetch("api/user/join",{method:"POST",body:JSON.stringify({id:t})})).json();if(n.world)Or.set(n.world),nf.set(t);else throw Or.set(void 0),nf.set(void 0),n.result||"Unknown Error";return!0};var pA=0,S0=!1,dA=new kt(0,2e4),hA=2,gA=t=>{dA.done(t)&&(t>1e5&&!S0&&t-pA>60*1e3*3?(S0=!0,pA=t,Yc.set(hA),hA++):S0&&(S0=!1,Yc.set(0)),dA.reset(t))};var B_={arena3v3:{port:5006},arena5v5:{port:5007},main:{port:5009},dev2:{port:5010},dev_default:{port:5010},dev_pathfind:{port:5011},arena_big_swamp:{port:5012},arena_cage:{port:5013},arena_cove:{port:5014},arena_lava:{port:5015},arena_ruins:{port:5016},arena_small_swamp:{port:5017}};var $_=t=>{B_[fe.activeWorld]===void 0?window.location.href="/":(console.log("Connecting to "+fe.activeWorld),t&&So.set("Connecting"),R3(B_[fe.activeWorld].port))},vA=t=>{I.load(t.world,t.file,t.playerId),I.setTimeFromTickId(t.tickId),Nu=0},Nu=0,_A=async t=>{if(t===4002)So.set("Connecting"),I.destroy();else try{if(Nu<10?So.set("Connecting"):So.set(`Connecting (${t})`),t===1006&&(Nu++,Nu>=20)||t>=4008)throw!0;I.destroy();let e=Nu>1?z1(500,1e3):z1(1200,1600);for(await new Promise(n=>setTimeout(n,e));document.visibilityState==="hidden";)So.set("Browser is idle"),await new Promise(n=>setTimeout(n,e));await mA(fe.lastConnectedChar)}catch{return window.location.href="/",!1}$_(!1)},bA=(t,e)=>{T3(e),gA(e),I&&I.player?(Ty(t),rA(t),I.tick(t),lA(t),GP(t,I),aA(t,I)):I&&I.tick(t)};var P0=class{constructor(){this.nodes=new Map,this.width=-0,this.height=-0,this.depth=-0,this.yd=-0,this.zd=-0,this.xm=-0,this.ym=-0,this.zm=-0,this.xs=-0,this.ys=-0,this.zs=-0,this.dirty=!1}setDimensions(e,n,o,s,i,r){this.clear(),this.dirty=!0;let l=Math.floor(e/s),a=Math.floor(n/i),c=Math.floor(o/r);this.width=e,this.height=n,this.depth=o,this.yd=a,this.zd=c,this.xm=l-1,this.ym=a-1,this.zm=c-1,this.xs=e/l,this.ys=n/a,this.zs=o/c}clear(){this.nodes.clear()}add(e,n){let o=Math.max(0,Math.min(this.xm,~~(n[0]/this.xs))),s=Math.max(0,Math.min(this.ym,~~(n[1]/this.ys))),i=Math.max(0,Math.min(this.zm,~~(n[2]/this.zs))),r=Math.max(0,Math.min(this.xm,~~(n[3]/this.xs))),l=Math.max(0,Math.min(this.ym,~~(n[4]/this.ys))),a=Math.max(0,Math.min(this.zm,~~(n[5]/this.zs)));for(let c=o;c<=r;++c)for(let f=s;f<=l;++f)for(let u=i;u<=a;++u){let m=c*this.yd*this.zd+f*this.zd+u;this.nodes.has(m)||this.nodes.set(m,{aabbs:[],content:[],count:0});let g=this.nodes.get(m);g.content.push(e),g.aabbs.push(n),g.count++}}queryAABB(e){let n=Math.max(0,Math.min(this.xm,~~(e[0]/this.xs))),o=Math.max(0,Math.min(this.ym,~~(e[1]/this.ys))),s=Math.max(0,Math.min(this.zm,~~(e[2]/this.zs))),i=Math.max(0,Math.min(this.xm,~~(e[3]/this.xs))),r=Math.max(0,Math.min(this.ym,~~(e[4]/this.ys))),l=Math.max(0,Math.min(this.zm,~~(e[5]/this.zs))),a=[];for(let c=n;c<=i;++c)for(let f=o;f<=r;++f)for(let u=s;u<=l;++u){let m=c*this.yd*this.zd+f*this.zd+u;if(this.nodes.has(m)){let g=this.nodes.get(m);for(let v=0;v<g.count;++v){let _=g.content[v];F8(g.aabbs[v],e)&&!a.includes(_)&&a.push(_)}}}return a}queryRay(e,n,o){let s=e[0]+n[0],i=e[1]+n[1],r=e[2]+n[2],l=Math.max(0,Math.min(this.xm,~~(Math.min(e[0],s)/this.xs))),a=Math.max(0,Math.min(this.ym,~~(Math.min(e[1],i)/this.ys))),c=Math.max(0,Math.min(this.zm,~~(Math.min(e[2],r)/this.zs))),f=Math.max(0,Math.min(this.xm,~~(Math.max(e[0],s)/this.xs))),u=Math.max(0,Math.min(this.ym,~~(Math.max(e[1],i)/this.ys))),m=Math.max(0,Math.min(this.zm,~~(Math.max(e[2],r)/this.zs))),g=[];for(let v=l;v<=f;++v)for(let _=a;_<=u;++_)for(let b=c;b<=m;++b){let k=v*this.yd*this.zd+_*this.zd+b;if(this.nodes.has(k)){let y=this.nodes.get(k);for(let F=0;F<y.count;++F){let A=y.content[F];S8(y.aabbs[F],e,o,0,1)&&!g.includes(A)&&g.push(A)}}}return g}queryNodeContents(e,n,o){e=Math.max(0,Math.min(this.xm,~~(e/this.xs))),n=Math.max(0,Math.min(this.ym,~~(n/this.ys))),o=Math.max(0,Math.min(this.zm,~~(o/this.zs)));let s=e*this.yd*this.zd+n*this.zd+o;return this.nodes.has(s)?this.nodes.get(s).content:[]}};var ao={origin:[0,0,0],dir:[0,-1,0],invDir:[0,0,0]},A0=(t,e,n,o,s,i,r)=>{X(t.origin,e,n,o),X(t.dir,s,i,r),Im(t.invDir,t.dir)};var T0=class{constructor(e){this.entity=e,this.buffs=new Map,this.casters=new Map,pu.forEach(n=>{this[n]=new Set}),this.tags=new Map;for(let n=0;n<13;++n)this.tags.set(n,new Set)}tick(e,n,o){}setBuff(e,n,o,s,i,r){o<=0&&console.error("buff with zero or less stacks");let l=this.buffs.get(e)||this.buffs.set(e,new Map).get(e),a=l.get(n)||{};if(a.caster=n,a.id=e,a.level=r,a.stacks=o,a.logic=yl.get(e),a.timer=new kt(s,i),a.active=!0,a.uniqueInstances=0,a.remove=!1,a.logic.intervalDuration!==void 0){let f=s;a.interval&&(f=a.interval.start);let u=I.entity(n);a.interval=new kt(f,a.logic.intervalHaste&&u!==void 0?a.logic.intervalDuration/RF(u.stats.getStat(16)):a.logic.intervalDuration)}else a.interval=new kt(0,0);return l.set(n,a),a.logic.onSet(a,n,this),(this.casters.get(n)||this.casters.set(n,new Map).get(n)).set(e,a),a.logic.unique&&this.updateUniqueState(e),a}removeBuff(e,n){let o=this.buffs.get(e);if(o){let s=o.get(n);if(s){s.logic.onRemove(s,n,this),o.delete(n),o.size===0&&this.buffs.delete(e);let i=this.casters.get(n);return i.delete(e),i.size===0&&this.casters.delete(n),s.logic.unique&&this.updateUniqueState(e),s}}}updateUniqueState(e){let n=this.buffs.get(e);if(n){let o;n.forEach((s,i)=>{(!o||s.level>o.level)&&(o=s),s.active=!1,s.uniqueInstances=n.size}),o.active=!0}}clear(e,n=!1){this.buffs.forEach((o,s)=>{o.forEach((i,r)=>{(!n||r!==this.entity.id)&&i.logic.passive==e&&i.logic.clearOnDeath&&this.removeBuff(s,r)})})}clearTempBuffs(){this.clear(!1)}clearPassiveBuffs(){this.clear(!0)}onDeath(){this.clearTempBuffs()}hasAnyWithTag(e){return this.tags.get(e).size>0}};var Ho=[5,4,0,2,3,8,9],Yo=(t,e,n,o)=>{let s=t.entity.mount!==void 0;t.walking=!s&&t.walking,$z(t,s),Uz(t,s),Bz(t,s),zz(t,e,n,o,s),Rz(t,e,n,o,s)},Rz=(t,e,n,o)=>{if(t.body[0].visible&&t.entity.buffs.visualIncapacitate>0){no(t.body[0].rotation,(Math.sin(n*2.2)+Math.sin(n*2.1)*.3)*.3+1,(Math.sin(n*2.1)+Math.sin(n*2)*.6)*.3,(Math.sin(n*.8)+Math.sin(n*2.3)*.5)*.3);for(let s=2;s<=3;++s)t.body[s].position[1]-=.2}},zz=(t,e,n,o,s)=>{let i=t.body[2];if(i.visible&&(t.body[6]!==void 0&&(t.sheathed||(s?Go(t,!0):t.entity.target&&!t.walking&&!t.falling?(i.rotation[0]+=1,i.rotation[2]+=.6,i.position[2]-=.3,i.position[1]-=.2,i.position[0]-=.1,t.body[4].position[0]-=.05,t.body[5].position[0]+=.05,t.body[4].position[2]-=.2,t.body[0].position[1]+=-.05+Math.sin(n*3)*.05,t.body[0].rotation[1]-=Math.cos(n*3)*.05):(i.rotation[0]+=.5,i.position[1]-=.2,i.position[0]-=.1))),t.currentAnim&&t.currentAnim.info.movement!==13)){let l=Jt.easeInOutCubic(t.currentAnim.fract),a=-Math.sin(l*7.5-1.5),c=-Math.sin(l*6.28),f=-Math.sin(l*3.14),u=Jt.easeOutExpo(-f);switch(gn(i.rotation,i.rotation,1-u),t.currentAnim.info.movement){case 0:if(t.body[6]!==void 0)Go(t,!1),no(i.rotation,f*1.7,u*1.5,a*u+u*.5),i.position[2]-=f-l*u,i.position[1]+=Math.sin(l*13+3)*u*.5,i.position[0]+=(-.5+l*1.5)*u,t.body[0].rotation[1]+=c*1.5;else{let m=Math.cos(l*6.28);t.body[0].position[2]+=(.3+Math.sin(l*6.28-3.14)*.2)*u,t.body[0].rotation[0]+=Math.sin(l*3.28)*.5*u;for(let g=0;g<=1;++g){let v=t.body[2+g];v.visible&&(gn(v.position,v.position,1-u),v.position[2]+=(1-m*.5)*u,v.position[1]+=Math.sin(l*6.28)*(l>.5?.7:1),v.position[0]+=(g?.5+f*.2:-.5-f*.2)*u,X(v.rotation,0,1.5,0))}}break;case 1:Go(t,!1),i.rotation[0]-=f*1.7,i.rotation[1]+=u*1.5-u,i.rotation[2]+=a*u+u*.5,i.position[2]+=u,i.position[0]-=u*.5,t.body[0].rotation[1]-=c*1.5-u*.5;break;case 12:Go(t,!1),i.rotation[0]=1.7,i.rotation[1]=0,i.rotation[2]=.5,i.position[2]=1.3,i.position[1]=.2,i.position[0]=-.5;break;case 4:Go(t,!1),i.rotation[0]+=f*1.7,i.rotation[1]-=f*1.5,i.position[0]-=u*.5,t.body[0].rotation[1]=l*2*Math.PI+u*3;break;case 3:{Go(t,!0),X(t.body[0].rotation,f,0,0),X(i.position,-.3,0,.7);break}case 11:{Go(t,!1),X(t.body[0].rotation,f*.4,0,f*.3),i.rotation[0]-=f*.8,i.rotation[1]+=f*.4;break}case 9:{Go(t,!1),X(i.rotation,0,0,0);break}case 5:{Go(t,!0);break}}}let r=t.body[3];t.body[7]!==void 0&&r.visible&&(t.entity.target&&!t.walking&&!t.falling?(r.rotation[2]-=.2,r.rotation[1]-=1,r.position[1]+=.1,r.position[2]+=.4):(r.rotation[2]-=.1,r.position[1]+=.1))},Bz=(t,e)=>{for(let n=0;n<=1;++n){let o=t.body[4+n];if(o.visible)if(e)X(o.rotation,-.9,n?.2:-.2,n?.4:-.4),X(o.position,n?.6:-.6,-.4,.5);else{let s=cl(t.entity.steer);if(t.currentAnim&&t.currentAnim.info.movement===10){X(o.position,0,0,0);continue}if(t.falling)if(t.flip==0){let i=Math.max(-1,Math.min(0,t.entity.vel[1]*.2))*.1,r=n?t.cycle(0)*.3-i:t.cycle(.5)*.3+i;X(_t,n?.3-i:-.3+i,-.65,r),Br(o.position,_t,0),X(o.rotation,-r,s,0)}else X(o.position,n?.3:-.3,-.3,0),X(o.rotation,0,0,0);else if(t.entity.inWater>t.entity.radius)t.walking?(X(o.rotation,1.3,n?.1:-.1,0),X(o.position,n?.3:-.3,Math.cos(t.cycleRad+n*Math.PI)*.4,-1.1)):(X(o.rotation,1,n?.1:-.1,0),X(o.position,n?.3:-.3,-.7,Math.cos(t.cycleRad+n*Math.PI)*.4));else{if(t.walking){let i=t.entity.steer[1]<0?.4:.6,r=t.cycle(0)*i*1.3;X(_t,n?.3:-.3,Math.max(0,Math.cos(t.cycleRad+(n?0:Math.PI))*.6)-.55,t.cycle(n?0:.5)*i),Br(o.position,_t,s),X(o.rotation,n?-r:r,s,0)}else X(o.rotation,0,n?.1:-.1,0),X(o.position,n?.45:-.45,-.65,0);t.currentAnim&&!t.walking&&(t.currentAnim.info.movement==5||t.currentAnim.info.movement==13||t.currentAnim.info.movement==6||t.currentAnim.info.movement==9)&&X(o.position,n?.4:-.55,-.65,n?.2:-.3)}}}},$z=(t,e)=>{let n=t.body[0],o=n.position,s=n.rotation;if(n.visible){if(!t.falling||e?(t.walking?t.entity.inWater>t.entity.radius?X(o,0,-.1,0):X(o,0,Math.cos(t.cycleRad*2)*.1+.4,0):t.entity.inWater>t.entity.radius?X(o,0,.3,0):X(o,0,e?.5:t.cycle(0)*.1+.4,0),t.transform.rotation[0]!==0&&(t.transform.rotation[0]=0)):(t.transform.rotation[0]=t.cycleRad*t.flip,X(o,0,t.flip!=0?.3:.5,0)),t.entity.inWater>t.entity.radius)t.walking?X(s,1.2,0,Math.sin(t.cycleRad)*.1):X(s,Math.sin(t.cycleRad)*.1-.1,0,Math.cos(t.cycleRad)*.05);else{X(s,-t.pushBack[1]*5+t.movementPushback[2],0,t.pushBack[0]*5-t.movementPushback[0]),Jp(o,o,t.pushBackOffset),on(o,o,t.movementPushback,1);let i=-t.movementPushback[1]*.5;X(n.scale,1+i,1-i,1+i)}if(t.currentAnim!==void 0){let i=t.currentAnim.info.movement;if((i==5||i==6)&&(s[1]-=.3+.05*t.cycle(.2),s[0]+=.3+.02*t.cycle(.4),o[1]-=.1+.05*t.cycle(.6),o[0]-=.05),i==6)s[1]*=1-t.currentAnim.fract;else if(i==10)X(o,0,.2+Math.sin(t.currentAnim.fract*Math.PI)*.5,0),s[0]+=t.currentAnim.fract*al,s[1]+=cl(t.entity.steer);else if(i==9){let r=Jt.easeOutQuad(gt(t.currentAnim.fract*2,0,1));o[1]+=Math.sin(3+r*5)*.2,s[0]+=.5-r*.5}else i==12?s[1]=t.currentAnim.fract*Math.PI*2:i==13&&(o[2]-=.2+t.cycle(.4)*.05,s[0]=-.2+t.cycle(.8)*.12,s[1]=-.2,s[2]=.2+t.cycle(.15)*.05)}}},Uz=(t,e)=>{for(let n=0;n<=1;++n){let o=t.body[2+n];if(o.visible){if(!t.falling||e)if(t.entity.inWater>t.entity.radius)if(t.walking){let s=t.cycle(0),i=t.entity.steer[1]<0?.3:.5,r=Math.sin(t.cycleRad*2+5);X(o.rotation,0,s*i*1.3+(n?Math.PI:0),0),X(o.position,(n?.7:-.7)+r*(n?-.2:.2),.2+s*i*(n?-1.5:1.5),-.2+s*(n?-.3:.3))}else{let s=Math.cos(t.cycleRad+n*2);X(o.rotation,0,(n?-.43+Math.PI:.43)+s*.15*(n?1:-1),.3),X(o.position,n?.7:-.7,s*.05-.2,.6-s*.2)}else if(t.walking){let s=t.cycle(0),i=t.entity.steer[1]<0?.3:.5,r=Math.sin(t.cycleRad*2+5);X(o.rotation,0,s*i*1.3+(n?Math.PI:0),0),X(o.position,(n?.7:-.7)+r*(n?-.2:.2),-.2+s*(n?.3:-.3),.2+s*i*(n?-1.5:1.5)),o.position[0]=n?Math.max(.5,o.position[0]):Math.min(-.5,o.position[0])}else if(e)X(o.rotation,0,n?-1.3+Math.PI:1.3,.3),X(o.position,n?.3:-.3,-.5,.7);else{let s=t.cycle(0);X(o.rotation,0,(n?-.43+Math.PI:.43)+s*.15*(n?1:-1),.3),X(o.position,n?.7:-.7,-.3+s*.08,.15-s*.1)}else X(o.position,n?.6:-.6,-gt(t.entity.vel[1],-5,5)/20,0),o.position[0]+=(n?1:-1)*Math.sin(o.position[1]*3.1+.8)*.3,X(o.rotation,0,n?Math.PI:0,-.3-o.position[1]);if(t.currentAnim){let s=t.currentAnim.info.movement;if(s==5||s==6)n==0?(o.position[0]-=.2,o.position[1]-=.2,s==6&&(gn(o.position,o.position,1-t.currentAnim.fract),o.position[0]+=-t.currentAnim.fract*.3,o.position[2]+=Math.sin(Math.min(.5,t.currentAnim.fract)*7+4)*.8+.4)):(o.position[0]-=.4,o.position[2]+=.5-t.cycle(.3)*.2,o.rotation[1]+=.6+t.cycle(.4)*.2,o.rotation[0]-=.8,s==6&&(gn(o.position,o.position,1-t.currentAnim.fract),o.position[0]+=t.currentAnim.fract*.3,o.position[2]+=Math.sin(Math.min(.5,t.currentAnim.fract)*7+4)*.7+.3));else if(s===9){let i=Jt.easeInOutCubic(gt(t.currentAnim.fract*2,0,1));X(o.rotation,1-i,0,0);let r=Math.sin(i*3);n==0?X(o.position,-.12-r*.35,-.1+i*1.2,.3+r):X(o.position,.12+r*.35,i*1.2,.3+r)}else if(s===11){let i=Math.sin(Jt.easeInOutCubic(t.currentAnim.fract)*3);o.position[0]+=i*(n?.3:0),o.position[1]=i*(n?-.2:1)-.3,o.position[2]=i*(n?-.3:1)}else s===13&&(o.position[0]=n?.6:0,o.position[1]=n?.7:1,o.position[2]=.8,o.rotation[0]=n?t.cycle(.4)*.2:t.cycle(.2)*.2,o.rotation[1]=n?2:1,o.rotation[2]=n?2:1)}if(t.body[8+n]){let s=t.body[8+n];s.visible&&(Ur(s,o.position,!1,Tp),gn(s.rotation,s.rotation,.5),s.rotation[1]-=n?.8:-.8,s.rotation[2]-=n?.5:-.5)}}}},Go=(t,e)=>{t.sheathed!==e&&(t.sheathed=e,t.body[6]!==void 0&&(Cn(t.body[6],e?t.body[0]:t.body[2]),t.sheathed?st(t.body[6].position,t.skin.sheathedPos):st(t.body[6].position,t.skin.unsheathedPos),t.body[6].matrixNeedsUpdate=!0),t.body[7]!==void 0&&(Cn(t.body[7],e?t.body[0]:t.body[3]),t.sheathed?(X(t.body[7].position,0,-.2,-.65),X(t.body[7].rotation,0,-1.57,0)):(X(t.body[7].position,-.2,0,0),X(t.body[7].rotation,0,0,0)),t.body[7].matrixNeedsUpdate=!0))};var U_=[5,4,0,2,3],O_=(t,e,n,o)=>{let s=t.body[3];if(s.visible&&(X(s.rotation,.2,1.7+t.cycleSin*.15,.4),X(s.position,.1+t.cycleSin*.2,-.3,.9),t.entity.target>0&&(s.position[0]=.2,s.position[1]+=.15,s.position[2]+=.1,s.rotation[0]+=.2,s.rotation[1]=1.8,s.rotation[2]-=.2),t.currentAnim))switch(t.currentAnim.info.movement){case 5:{Go(t,!1);let i=Jt.easeOutQuad(gt(t.currentAnim.fract*2,0,1));X(s.rotation,1.2,2,.3),X(s.position,.2,0,.8+i*.8),X(t.body[2].position,-.1-Math.sin(i*2)*.6,i*.1,.8-i*.8),X(t.body[0].position,0,.6-i*.2,0),X(t.body[0].rotation,.2-i*.2,-.4+i*.3,0);break}case 7:{Go(t,!1);let i=Jt.easeOutFlick(gt((t.currentAnim.fract-.5)*2,0,1));X(s.rotation,1.2,2,.3+i*.1),X(s.position,.2,i*.3,1.6),X(t.body[2].position,-.7,.1,-i*.7),X(t.body[0].position,0,.4,0),X(t.body[0].rotation,0,-.1,0);break}case 8:{Go(t,!1);let i=Jt.easeOutQuad(gt(t.currentAnim.fract*2,0,1));X(t.body[2].position,-.5-i*.3,-.3+i*.3,Math.sin(i*6.28)*.6),X(s.rotation,.2+.5*i,2,.3),X(s.position,.2,-.4+i*.3,.8+i*.8),t.body[0].rotation[1]=0,t.body[0].rotation[0]=-.2+i*.2}break}!t.walking&&t.body[4].visible&&(t.body[4].position[2]-=.3,t.body[5].position[2]+=.1)};var yA=[2],kA=(t,e,n,o)=>{let s=t.body[2];no(s.rotation,.9,-.4,0),s.position[2]-=.1};var xA=[0,16,17],wA=(t,e,n,o)=>{let s=t.cycle(.5);if(X(t.body[0].scale,s*.1+1,1+t.cycleSin*.1,s*.1+1),X(t.body[0].position,0,-.2+t.cycleSin*.1,0),X(t.body[0].rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5),Jp(t.body[0].position,t.body[0].position,t.pushBackOffset),t.currentAnim){let i=Jt.easeOutExpo(t.currentAnim.fract**3);switch(t.currentAnim.info.movement){case 0:t.body[0].position[2]+=Math.sin(i*6.28-3.14);break}}for(let i=0;i<2;++i){let r=t.body[16+i];if(r.visible=t.transform.visible,!r.visible)continue;for(let c=0;c<r.children.length;++c)r.children[c].visible=!0;let l=i==0?t.transform:t.body[16+i-1];Zt(_t,l.position,r.position),X(tl,0,0,-l.scale[0]*.7),Br(kn,tl,l.rotation[1]),Bn(_t,_t,kn);let a=ho(_t);a>30*t.entity.size?st(r.position,t.entity.pos):on(r.position,r.position,_t,Math.max(0,Math.min(.5,20*e*(a-r.scale[1]*.7)))),X(r.rotation,0,Qp(Zt(_t,l.position,r.position)),0),go(r.scale,(3-i)*.3*(.8+t.cycle(i*.3)*.1)*t.transform.scale[0]),r.position[1]=Math.max(t.entity.pos[1]+r.scale[1]*.5,r.position[1]-e*2.5),Bt(r,!1)}};var MA=[2,3],FA=(t,e,n,o)=>{if(!t.currentAnim)for(let s=0;s<2;++s){let i=t.body[2+s];if(!i.visible)continue;let r=t.cycle(1.3);X(i.rotation,.78,0,s?r*.2:-r*.2),X(i.position,s?.2:-.2,-.4,.6)}};var CA=[0,4,5],SA=(t,e,n,o)=>{let s=t.body[0],i=t.body[4],r=t.body[5];if(t.walking&&!t.falling){t.speed=t.entity.speed*(t.entity.steer[1]===-1?-1.2:1)*.04/(.6+t.entity.size*.6);let l=Math.cos(t.cycleRad);X(i.rotation,0,t.cycleSin*.2,t.cycleSin*.2),X(i.position,0,Math.abs(l)*.3+.2,0),X(r.rotation,0,Math.PI+l*.2,l*.2),X(r.position,0,Math.abs(t.cycleSin)*.3,0),X(s.position,t.cycle(.3)*.01,t.cycleSin*.02,0),X(s.rotation,0,t.cycleSin*.01,Math.sin(t.cycleRad*2)*.01),t.entity.target>0&&Math.random()<.3&&t.fraction(.1,e)&&t.playSound(t.stepset[0],!1)}else{if(t.speed=.5,t.currentAnim){let l=Jt.easeOutExpo(t.currentAnim.fract**3);switch(t.currentAnim.info.movement){case 0:{let a=Math.sin(l*6.28-3.14);X(s.position,0,Math.max(0,-a),a*.5);for(let c=0;c<2;++c){let f=c==0?i:r,u=c==0?1:-1,m=c==1?Math.PI:0;X(f.rotation,u*Math.min(a,0),m+a*.1*u,0),X(f.position,0,Math.max(0,-a),a*.5)}break}}}else{let l=t.cycle(-.1)*.05;X(s.position,0,t.cycle(-.1)*.1,0);for(let a=0;a<2;++a){let c=a==0?i:r;X(c.rotation,0,a==1?Math.PI:0,t.falling?.4:l*.5),X(c.position,0,0,0)}}X(s.rotation,0,0,0)}no(s.rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5)};var PA=[],AA=(t,e,n,o)=>{X(t.transform.rotation,-t.pushBack[1]*2,t.entity.rot,t.pushBack[0]*2)};var TA=[0,2,3,16],EA=(t,e,n,o)=>{let s=t.body[0],i=t.body[2],r=t.body[3],l=25/i.scale[0],a=n+t.entity.id;if(X(s.rotation,Math.sin(a*l/8)*.15,0,Math.sin(a*l/10)*.07),no(s.rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5),X(s.position,0,1+Math.sin(a*18)*.1,0),t.body[16]!==void 0){let f=t.body[16];f.position[1]=f.data.skin.pos[1]+Math.sin(a*18+2.75)*.1}let c=Math.sin(a*l)*.7;for(let f=0;f<2;++f){let u=f==0,m=u?i:r;m.rotation[2]=m.data.skin.rot[2]+(u?Math.PI-c:c)}if(t.currentAnim&&t.currentAnim.info.movement===0){let f=t.currentAnim.fract,u=Math.sin(er(f,.2,-.4)*3.14)*1.5;if(s.position[2]+=u,s.rotation[0]+=u*.4,f>.65){let m=Jt.easeOutQuad(ys(f,.65,1,0,1));s.rotation[0]-=m*Math.PI*2,s.position[1]+=Math.sin(m*Math.PI)*1.5}}};var IA=[0,2,3],DA=(t,e,n,o)=>{for(let s=0;s<2;++s){let i=t.body[2+s];i.position[1]*=.8,i.position[2]*=.8,i.position[1]+=.5;let r=t.body[4+s];r.position[1]-=0,r.position[0]+=s?.4:-.4}X(t.body[0].scale,1.8,2,1.8),t.body[0].position[1]+=1};var VA=[2],LA=(t,e,n,o)=>{X(t.body[2].position,-.8,-.2,.7),X(t.body[2].rotation,1.8+t.cycleSin*.1,0,0)};var qA=[17,0,16,21,2,3,4,5],RA=(t,e,n,o)=>{let s=t.body[4].scale[1];t.currentAnim&&t.currentAnim.info.movement===0?tB(t,s):Jz(t,s)},Jz=(t,e)=>{let n=ys(t.entity.speed/20/(.2+t.entity.size*.8),3,10,0,1),o=ys(n,0,1,.6,.4),s=ys(n,0,1,.5,.2);t.speedMultiplier=ys(n,0,1,1,.5),Kz(t,s,o,e),eB(t,s,o,e)},Kz=(t,e,n,o)=>{let s=0,i=0,r=0,l=0,a=0,c=0,f=0,u=ys(e,.2,.5,.5,1);t.walking?(s=Math.sin(t.cycleRad*2-1)*.07,r=Math.sin(t.cycleRad*2)*.07,i=-t.cycle(0)*.1*u,a=Math.sin(t.cycleRad*2+n)*.05,l=-t.cycle(n)*.07*u,c=t.cycle(n+.2)*.3,f=0):(s=t.cycle(.3)*.03,r=t.cycle(.35)*.02,a=t.cycle(0)*.02-.05,c=Math.sin(t.cycleRad*2)*.07,f=t.cycle(.3)*.1);let m=t.body[17];X(m.position,0,o*.8+s-.15,1.2),X(m.rotation,.1,f,0);let g=t.body[0];X(g.position,0,o*.7+r-.15,.5),X(g.rotation,-.06,i*1.3,i);let v=t.body[16];X(v.position,0,o*.75+a-.15,-.35),X(v.rotation,.04,l*1.3,l);let _=t.body[21];X(_.position,-c*.35,-.18+s*.5,-.67),X(_.rotation,.6,c,0)},eB=(t,e,n,o)=>{let s=[2,3,4,5];for(let i=0;i<4;++i){let r=s[i],l=t.body[r],a=i%2==0,c=i<2,f=-.75+o*.5,u=c?.8:-.6,m=c?.35:.26,g=t.entity.steer[1]<0?-.5:1;if(t.walking){let v=(a?0:e)+(c?0:n),_=t.cycleScaled(v,g),b=Math.max(0,t.cycleScaled(v-Math.PI,g)*.3);u-=_*.4,X(l.rotation,_,0,0),X(l.position,a?-m:m,f+b,u)}else X(l.rotation,0,a?-.2:.2,0),X(l.position,a?-m:m,f,u)}},tB=(t,e)=>{let n=t.currentAnim.fract,o=Math.sin(er(n,.2,-.4)*3.14)*1.5,s=[2,3,4,5];for(let f=0;f<4;++f){let u=s[f],m=t.body[u],g=f%2==0,v=f<2,_=-.75+e*.5,b=(v?.8:-.6)+o*.2,k=v?.35:.26;X(m.rotation,o*.5,0,0),X(m.position,g?-k:k,_,b)}let i=t.body[17];X(i.position,0,.8*e-.15,1.2+o*.4),X(i.rotation,o*.4,0,Math.sin(o*3)*.5);let r=t.body[0];X(r.position,0,.7*e-.15,.5+o*.4),X(r.rotation,-.06,0,0);let l=t.body[16];X(l.position,0,.75*e-.15,-.35+o*.4),X(l.rotation,.04,0,0);let a=t.body[21],c=Math.max(o,0);X(a.position,0,-.18*.5+c*.3,-.67),X(a.rotation,.6+c,0,0)};var zA=[2,3,4,5],BA=[[-.6,-.5,.5],[.6,-.5,.5],[-.6,-.5,-.5],[.6,-.5,-.5]],$A=[2,3,4,5,0,16,21,17,19,20],UA=(t,e,n,o)=>{let s=t.body[4].scale[1];t.currentAnim&&t.currentAnim.info.movement===0?oB(t,s):sB(t,s)},oB=(t,e)=>{aB(t,e),cB(t,e),fB(t,e)},sB=(t,e)=>{t.speedMultiplier=.8,iB(t,e),rB(t,e),lB(t,e)},iB=(t,e)=>{let n=t.body[0],o=t.body[16],s=t.body[21],i=e-.9+n.scale[1]*.5;if(t.walking){let r=t.cycle(0)*.2;n.position[1]=i+Math.sin(t.cycleRad*2)*.05,o.position[1]=i+Math.sin(t.cycleRad*2+.5)*.05,X(n.rotation,0,r,0),X(o.rotation,0,-r,0),s&&(s.position[1]=s.data.skin.pos[1]+i+Math.sin(t.cycleRad*2)*.05)}else n.position[1]=i,o.position[1]=i,X(n.rotation,0,0,0),X(o.rotation,0,0,0),s&&(s.position[1]=s.data.skin.pos[1]+i+Math.sin(t.cycleRad)*.05);n.matrixNeedsUpdate=!0,o.matrixNeedsUpdate=!0,di(n),di(o)},rB=(t,e)=>{let n=t.walking?.2:.08,o=t.body[17];o!==void 0&&X(o.rotation,0,t.cycle(.4)*n,0);let s=t.body[19];s!==void 0&&X(s.rotation,0,t.cycle(.2)*n,0);let i=t.body[20];i!==void 0&&X(i.rotation,0,t.cycle(t.walking?.1:.9)*n,0)},lB=(t,e)=>{let n=t.walking,o=n?t.cycle(0)*.5:0,s=n?t.cycle(.25)*.5:0,i=n?t.cycle(.75)*.5:0,r=t.entity.steer[1]<0?-.5:1;for(let l=0;l<4;++l){let a=zA[l],c=t.body[a],f=l%2==0,u=l<2,m=t.body[u?0:16],g=BA[l];Ao(c.position,g,m.matrix);let v=0,_=0;f&&u||!u&&!f?(v=s,_=o):(v=i,_=-o),c.position[1]+=Math.max(0,v*.5),c.position[2]+=_*r*.4,c.rotation[0]=-_*r}},aB=(t,e)=>{let n=t.currentAnim.fract,o=Math.sin(er(n,.2,-.4)*3.14)*1.5,s=t.body[0],i=t.body[16],r=t.body[21],l=e-1+s.scale[1]*.5;X(s.position,0,l,s.data.skin.pos[2]+o*.4),X(s.rotation,0,o*.2,0),X(i.position,0,l,i.data.skin.pos[2]+o*.4),X(i.rotation,0,-o*.2,0),r!==void 0&&(X(r.position,0,r.data.skin.pos[1]+l,r.data.skin.pos[2]+o*.4),X(r.rotation,0,0,0)),s.matrixNeedsUpdate=!0,i.matrixNeedsUpdate=!0,di(s),di(i)},cB=(t,e)=>{let n=t.currentAnim.fract,o=Math.sin(er(n,.2,-.4)*3.14)*1.5,s=t.body[17];s!==void 0&&X(s.rotation,o*.4,0,Math.sin(o*3)*.5);let i=t.body[19];i!==void 0&&X(i.rotation,0,o*.5,0);let r=t.body[20];r!==void 0&&X(r.rotation,0,o*.5,0)},fB=(t,e)=>{let n=t.currentAnim.fract,o=Math.sin(er(n,.2,-.4)*3.14)*1.5;for(let s=0;s<4;++s){let i=zA[s],r=t.body[i],l=s<2,a=t.body[l?0:16],c=BA[s];Ao(r.position,c,a.matrix),X(r.rotation,o*.5,0,0)}};var OA=[18,3],NA=(t,e,n,o)=>{X(t.body[18].rotation,0,0,n*.3),X(t.body[3].position,.8,-.2,.7),X(t.body[3].rotation,1.8,0,0)};var E0=[5,4,0,2,3],I0=(t,e,n,o)=>{no(t.body[0].rotation,(Math.sin(n*1.8)*Math.cos(n*12)*.3+Math.sin(n*1.4)*.3)*.1-.2,(Math.sin(n*1.3)+Math.sin(n*2.4)*.6)*.15,(Math.sin(n*.2)+Math.sin(n*1.9)*.5)*.2);for(let s=0;s<=1;++s){let i=t.body[2+s];i.visible&&no(i.rotation,(Math.sin(n*2)*Math.cos(n*9)+Math.sin(n*1.3))*.2,(Math.sin(n*2-2)*Math.cos(n*7)+Math.sin(n*.8))*.3,0);let r=t.body[4+s];r.visible&&(r.rotation[1]+=Math.sin(n*.2-s)*.3,r.position[0]+=s?.15:-.15)}};var jA=[2],WA=(t,e,n,o)=>{t.body[2].position[2]+=.6,no(t.body[2].rotation,-2.1,-4.1,-.2)};var GA=[2,3,0],HA=(t,e,n,o)=>{if(t.currentAnim===void 0||t.currentAnim.info.movement===0)for(let s=0;s<2;++s){let i=t.body[2+s],r=Math.sin(n*4+s);X(i.position,s?.5:-.5,r*.2,1),X(i.rotation,0,1.5,-r*.2)}no(t.body[0].rotation,(Math.sin(n*1.8)*Math.cos(n*2)*.3+Math.sin(n*1.4)*.3)*.1+.2,(Math.sin(n*1.3)+Math.sin(n*2.4)*.6)*.1,(Math.sin(n*.4)+Math.sin(n*1.9)*.5)*.1)};var YA=[[Yo,O_],[Yo,kA],[wA],[Yo,FA],[SA],[AA],[Yo,DA],[Yo],[],[Yo,LA],[Yo,NA],[Yo,I0],[Yo,O_,I0],[Yo,I0],[Yo,WA],[Yo,HA],[RA],[UA],[EA]],XA=[new Set([...Ho,...U_]),new Set([...Ho,...yA]),new Set([...xA]),new Set([...Ho,...MA]),new Set([...CA]),new Set([...PA]),new Set([...Ho,...IA]),new Set([...Ho]),new Set,new Set([...Ho,...VA]),new Set([...Ho,...OA]),new Set([...Ho,...E0]),new Set([...Ho,...U_,...E0]),new Set([...Ho,...E0]),new Set([...Ho,...jA]),new Set([...Ho,...GA]),new Set([...qA]),new Set([...$A]),new Set([...TA])];var Sc=class{constructor(e){this.transform=sn(),this.transform.matrixAutoUpdate=!0,this.soundPrio=e.radius>3?1:0,this.doesYell=e.type!==0,this.entity=e,this.cycleOne=0,this.cycleRad=Kt(0,1),this.cycleSin=0,this.speed=1,this.speedMultiplier=1,this.lastFlags=0,this.deathTimer=new kt(0,0),this.hurtSoundTimer=new kt(0,5),this.pushBack=[0,0],this.pushBackVel=[0,0],this.pushBackOffset=[0,0],this.movementPushback=[0,0,0],this.movementPushbackVel=[0,0,0],this.groundNormal=[0,0,0],this.cDist=1/0,this.cDistLast=1/0,this.inFog=!0,this.animQueue=[],this.currentAnim=void 0,this.eyesBlink=0,this.capeoffset=0,this.walking=!0,this.falling=!1,this.hasDied=!1,this.flip=0,this.hasJustJumped=!1,this.hasJustLanded=!0,this.sheathed=!1,this.interiorlight=[0,0,0,0],this.needsColorUpdate=!1,this.colors=new Set,this.alphas=new Set,this.currentAlpha=0,this.goalAlpha=1,this.body=[],this.meshes=[],this.effects=[],this.skin=void 0,this.soundset=void 0,this.stepset=void 0,this.skeleton=void 0,this.animset=void 0,this.colPrim=void 0,this.colSec=void 0}setSkin(e,n,o){this.skin!==void 0&&(this.removeSkin(),this.cDistLast=0,this.hasDied=!1,this.deathTimer.reset(0,0),this.removeColor(Rn.death)),this.skin=C1.get(e);let s=w1.get(this.skin.soundset);this.soundset=s.sounds,this.stepset=M1.get(s.steps).steps,this.skeleton=S1.get(this.skin.skeleton),this.animset=YA[this.skin.animset],this.colPrim=n||this.skin.colPrim,this.colSec=o||this.skin.colSec;let i=XA[this.skin.animset];for(let r=0;r<this.skin.body.length;++r){let l=this.skin.body[r],a=l.col;l.colMode===1?a=this.colPrim:l.colMode===2&&(a=this.colSec);let c=this.mesh(l.bid,l.pid,i.has(l.bid),l.mid,l.lod,a,l.ts===1);c&&(st(c.position,l.pos),st(c.scale,l.scl),st(c.rotation,l.rot),c.data.skin=l)}for(let r=0;r<this.skin.effects.length;++r){let l=this.skin.effects[r];this.effects.push(Oo(l.id,this.body[l.bid],0,!1))}}removeSkin(){this.clearAnims(),this.clearMeshes(),this.clearEffects()}cycle(e){return e==0?this.cycleSin:Math.sin(this.cycleRad+2*e*Math.PI)}cycleScaled(e,n){return Math.sin(this.cycleRad*Math.sign(n)+2*e*Math.PI)*n}checkCycleReset(){let e=this.falling<<1|(!this.falling&&this.walking)<<2;e!=this.lastFlags&&(this.cycleOne=0,this.lastFlags=e)}addPushBack(e,n,o){this.cDist<50&&(this.pushBackVel[0]-=e*o/this.entity.size,this.pushBackVel[1]-=n*o/this.entity.size)}addRandomPushback(e){this.cDist<50&&(this.pushBackVel[0]-=Kt(-1,1)*e/this.entity.size,this.pushBackVel[1]-=Kt(-1,1)*e/this.entity.size)}tickPushBack(e,n,o){this.cDist<50&&(_1(this.pushBackVel,this.pushBackVel,this.pushBack,-e*1500/this.entity.size),Vf(this.pushBackVel,this.pushBackVel,1-e*30),_1(this.pushBack,this.pushBack,this.pushBackVel,e),G3(this.pushBackOffset,this.pushBack,-this.entity.rot)),this.cDist<25&&(on(this.movementPushback,this.movementPushback,this.movementPushbackVel,e*60),on(this.movementPushbackVel,this.movementPushbackVel,this.movementPushbackVel,-(e*20)),on(this.movementPushbackVel,this.movementPushbackVel,this.movementPushback,-(e*10)),this.movementPushbackVel[2]+=this.entity.steer[1]*.01,this.movementPushbackVel[0]-=this.entity.steer[0]*.01)}disableVis(e){for(let n=0,o=e.children.length;n<o;++n){let s=e.children[n];s.visible=!1,this.disableVis(s)}}checkVis(e,n,o){for(let s=0,i=e.children.length;s<i;++s){let r=e.children[s];this.meshes.indexOf(r)<0||(r.visible=r.data.lod*n/this.cDist>o,r.visible?this.checkVis(r,n,o):this.disableVis(r))}}updateVisibility(){let e=this.entity.mount!==void 0?1/0:Math.max(60,Math.min(150,ht.far*.7));return this.cDist=Rr(this.transform.position,ht.worldPosition),this.inFog=this.cDist>e,!this.inFog&&(!fe.disableoffscreen||jh(ht,this.entity.visualPosition,this.transform.scale[1]))?(!this.hasDied&&Math.abs(this.cDistLast-this.cDist)>1&&(this.cDistLast=this.cDist,this.checkVis(this.transform,Math.max(1,this.transform.scale[1]),1.5/(45+e))),this.transform.visible=!0,!0):(this.cDistLast=0,this.transform.visible&&(this.transform.visible=!1,this.meshes.forEach(n=>n.visible=!1),this.clearAnims()),!1)}tick(e,n,o){this.updateVisibility()?(this.needsColorUpdate&&this.colorUpdate(),this.alphaUpdate(e),this.entity.stats===void 0||this.entity.stats.alive?this.entity.buffs.visualFreeze===0&&(this.cycleOne=(this.cycleOne+this.speed*e)%1,this.cycleRad=this.cycleOne*Math.PI*2,this.cycleSin=Math.sin(this.cycleRad),this.tickAnimations(e),this.falling=this.entity.inWater<this.entity.radius&&(this.falling&&!this.entity.onGround||!this.falling&&!this.entity.onGround&&Math.abs(this.entity.vel[1])>6),this.walking=this.entity.steer[0]!=0||this.entity.steer[1]!=0,this.tickVisuals(e,n,o)):this.tickDeath(e,n,o),Bt(this.transform,!1)):this.alphaUpdate(100)}tickVisuals(e,n,o){this.checkCycleReset(),this.calculateCycleSpeed(),this.body[1]!==void 0&&this.tickEyes(e,this.body[1]),this.body[10]!==void 0&&this.tickCape(e,this.body[10]),this.tickWalking(e),this.tickLanding();for(let s=0;s<this.animset.length;++s)this.animset[s](this,e,n,o);if(this.skeleton.groundNormal||this.entity.mount&&this.entity.mount.skeleton.groundNormal){let s=Math.min(1,e*10);this.groundNormal[0]+=(this.entity.groundNormal[0]-this.groundNormal[0])*s,this.groundNormal[2]+=(this.entity.groundNormal[2]-this.groundNormal[2])*s,Xp(this.transform.rotation,this.groundNormal)}else this.flip||(this.transform.rotation[0]=this.transform.rotation[2]=0)}tickFixed(e,n,o){this.hasDied||this.tickPushBack(e,n,o)}tickAnimations(e){let n=this.currentAnim=this.animQueue[0];if(n){let o=n.info,s=n.fract;if(this.animQueue.length>1&&o.priority===0?n.fract>.6?n.time+=e*5:n.time=n.info.duration:n.time+=e,n.fract=n.time/o.duration,n.time>o.duration)if(n.loop)n.fract%=1,n.time=0;else{n.fract=1,this.onAnimEnd(n),this.animQueue.shift();return}for(let i=0;i<o.sounds.length;++i){let r=o.sounds[i];r.end>0?n.fract>=r.start&&n.fract<=r.end?n.activeSounds[i]===void 0&&(n.activeSounds[i]=ti(r.id,this.transform,this.soundPrio,!0,1)):n.activeSounds[i]!==void 0&&(n.activeSounds[i].stop(),n.activeSounds[i]=void 0):n.fract>=r.start&&(s<r.start||r.start===0&&s===0)&&(n.id===4&&r.id===50?ti(this.soundset[4],this.transform,this.soundPrio,!1,1):ti(r.id,this.transform,this.soundPrio,!1,1))}for(let i=0;i<o.effects.length;++i){let r=o.effects[i];if(r.type===0&&n.fract>r.start&&s<=r.start){let l,a=!1;if(r.body===99){let c=I.entity(n.dirImpactTarget);c&&c.visual&&(l=sn(),qm(l,c.visual.transform,this.transform,c.radius),Bt(l,!1),c.visual.addPushBack(this.transform.position[0]-c.visual.transform.position[0],this.transform.position[2]-c.visual.transform.position[2],2)),a=!0}else r.body===101?(l=sn(),st(l.position,this.transform.position),st(l.scale,this.transform.scale),st(l.rotation,this.transform.rotation),Bt(l,!1),a=!0):l=r.body===100?this.transform:this.body[r.body];if(l===void 0)continue;Ts(r.id,l,this.soundPrio,a)}else if(r.type>0)if(n.fract>=r.start&&n.fract<=r.end)if(n.activeEffects[i]===void 0){let l=r.body===100?this.transform:this.body[r.body];l&&(n.activeEffects[i]=r.type===1?Oo(r.id,l,this.soundPrio,!1):g8(r.id,l,this.soundPrio,!1))}else{let l=n.activeEffects[i];r.type===1||(l.fractionLast=l.fractionNow,l.fractionNow=Math.min(1,Math.max(0,1-(r.end-n.fract)/(r.end-r.start))))}else n.activeEffects[i]!==void 0&&(n.activeEffects[i].done=!0,n.activeEffects[i]=void 0)}}}tickEyes(e,n){if(n.visible){let o=0;this.eyesBlink>0?o=this.eyesBlink-e:Math.random()<.006?o=.1:o=this.eyesBlink,(this.eyesBlink>0&&o<0||o>0&&this.eyesBlink<0)&&(n.scale[1]=o>0?.1:n.scale[0],n.matrixNeedsUpdate=!0),this.eyesBlink=o}}tickCape(e,n){n.visible&&this.skin.capeswing&&((this.entity.steer[1]>0||this.falling)&&(this.capeoffset+=ho(this.entity.vel)*.5*e),this.capeoffset=Math.max(0,Math.min(2,this.capeoffset*(1-e*3))),X(n.rotation,this.capeoffset,0,0))}tickLanding(){this.entity.inWater>this.entity.radius||(this.hasJustJumped&&this.entity.onGround&&(this.cDist<20&&this.entity.vel[1]<-4&&(this.soundPrio===1&&this.playSound(56,!0),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.15,this.eyesBlink=.3),this.hasJustLanded=!0,this.hasJustJumped=!1,this.flip=0),this.hasJustLanded&&!this.entity.onGround&&(this.entity.vel[1]>5&&(this.soundPrio===1&&this.playSound(57,!0),Math.random()<.5&&(this.flip=this.entity.steer[1]),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.1,this.eyesBlink=.3),this.hasJustJumped=!0,this.hasJustLanded=!1))}tickWalking(e){if((this.cDist<20||this.transform.scale[1]>2)&&!this.falling){let n=this.transform.scale[1]>2||this.body[0].scale[1]>2,o=this.fraction(.2,e),s=this.fraction(.7,e);if(this.entity.inWater>0){if(this.entity.inWater<this.entity.radius*2)this.walking?this.entity.inWater<this.entity.radius?(o||s)&&(this.playSound(n?55:this.entity.inWater>this.entity.radius/2?127:128,!1),this.watersplash(92)):(o||s)&&(o&&this.playSound(129,!1),this.watersplash(93)):(o||s)&&this.watersplash(93);else if(this.entity.inWater>3&&(o||s)&&Math.random()<.5){let i=this.transform.position;oi(153,void 0,i[0],i[1],i[2],0,0,0,!1)}}else this.walking&&(n||this.soundPrio===1)&&(o||s)&&this.playSound(n?55:this.stepset[0],!n)}}calculateCycleSpeed(){this.falling?this.speed=1.5:this.walking?this.entity.inWater<this.entity.radius?this.speed=this.entity.speed/20*(this.entity.steer[1]===-1?1.3:1)*.45/(.4+this.entity.size*.6):this.speed=this.entity.speed/20*.2:this.speed=.5,this.speed*=this.speedMultiplier}fraction(e,n,o=this.cycleOne){return o>=e&&o-this.speed*n<e}mesh(e,n,o,s,i,r,l=!1){let a=si(s,l,!0,!1);if(a.data.lod=i,OS(a.data.multi,a,"interiorlight",this.interiorlight),a.visible=!1,a.matrixAutoUpdate=o,r!==void 0&&this.changeMeshBaseColor(a,r),a.data.basealpha=1,a.data.alpha[0]=this.currentAlpha,n>=0){if(!this.body[n])return;Cn(a,this.body[n]),a.parent.data.lod=Math.max(i,a.parent.data.lod||1)}else n===-1&&Cn(a,this.transform);return this.meshes.push(a),this.body[e]=a,a}removeMesh(e){let n=this.body[e];n!==void 0&&(As(n.data.multi,n),this.meshes.splice(this.meshes.indexOf(n),1),this.body[e]=void 0)}clearMeshes(){for(let e=0;e<this.meshes.length;++e){let n=this.meshes[e];As(n.data.multi,n)}this.meshes.length=0,this.body.length=0}clearEffects(){for(let e=0;e<this.effects.length;++e){let n=this.effects[e];n.done=!0}this.effects.length=0}onRemove(){this.removeSkin(),vs(this.transform)}anim(e,n,o){if(this.transform.visible&&this.animQueue.length<=2){let s=$f.get(e),i={id:e,info:s,loop:n,dirImpactTarget:o,activeSounds:[],activeEffects:[],time:0,fract:0};this.animQueue.push(i)}}clearAnims(){for(let e=0;e<this.animQueue.length;++e)this.onAnimEnd(this.animQueue[e]);this.animQueue.length=0}onAnimEnd(e){for(let n=0;n<e.activeEffects.length;++n){let o=e.activeEffects[n];o&&(o.done=!0)}e.activeEffects.length=0;for(let n=0;n<e.activeSounds.length;++n){let o=e.activeSounds[n];o&&o.stop()}e.activeSounds.length=0}playSound(e,n){return e===0||this.inFog?!1:(ti(e,this.transform,this.soundPrio,!1,n?this.getAudioPitch():1),!0)}onHurt(e){(e>.2||this.hurtSoundTimer.done(I.time))&&this.playSound(this.soundset[1],!0)&&this.hurtSoundTimer.reset(I.time)}onYell(){this.doesYell&&Kt(0,1)<.3&&this.playSound(this.soundset[0],!0)}onAggro(){this.playSound(this.soundset[3],!0)}onDeath(){this.hasDied=!0,this.playSound(this.soundset[2],!0),this.body[1]&&this.removeMesh(1),this.addColor(Rn.death),this.deathTimer.reset(I.time,3);let e=this.meshes.length;for(;e--;){let n=this.meshes[e];n.data.deathSize=(n.geometry.bounds.initiated?n.geometry.bounds.radius:1)*(n.scale[0]+n.scale[1]+n.scale[2])/3,Cn(n,null),va(n.position,n.worldMatrix),S2(n.scale,n.worldMatrix),Tm(n.quaternion,n.worldMatrix),n.data.deathVel=[Kt(-.5,.5),1,Kt(-.5,.5)],n.matrixAutoUpdate=!0}}tickDeath(e,n,o){this.deathTimer.done(n)?(this.clearMeshes(),this.clearEffects()):this.meshes.forEach(s=>{if(!s.visible||s.data.deathVel===void 0)return;let i=s.data.deathVel,r=s.data.deathSize;on(s.position,s.position,i,e),gn(i,i,1-e*3);let l=o.getHeight(s.position[0],s.position[2])+r*.5;i[1]<0&&s.position[1]<l?i[1]<-1?(i[1]=Math.abs(i[1])*.7,i[0]+=Kt(-1,1)/r,i[2]+=Kt(-1,1)/r):i[1]=-.5:i[1]-=e*50,Ko(_t,i,[0,1,0]),on(s.rotation,s.rotation,_t,-e*5),Bt(s,!1)})}mountPosition(e){Ao(e,this.skin.mountPos,this.body[this.skin.mountPart].worldMatrix)}getAudioPitch(){return Math.max(.6,Math.min(1,.5/this.entity.radius))}getTopAbsolute(){return this.entity.radius*this.skeleton.height}addColor(e){this.colors.add(e),this.needsColorUpdate=!0}removeColor(e){this.colors.delete(e),this.needsColorUpdate=!0}colorUpdate(){this.needsColorUpdate=!1;for(let e=0;e<this.meshes.length;++e)this.updateMeshColor(this.meshes[e])}changeMeshBaseColor(e,n){e.data.basecolor=n,this.updateMeshColor(e)}updateMeshColor(e){let n=e.data.color;$r(n,e.data.basecolor),this.colors.forEach(o=>{let s=o[3],i=1-s;n[0]=n[0]*i+o[0]*s,n[1]=n[1]*i+o[1]*s,n[2]=n[2]*i+o[2]*s})}addAlpha(e){this.alphas.add(e),this.updateGoalAlpha()}removeAlpha(e){this.alphas.delete(e),this.updateGoalAlpha()}updateGoalAlpha(){this.goalAlpha=1,this.alphas.forEach(e=>{this.goalAlpha=Math.min(this.goalAlpha,e)})}alphaUpdate(e){if(this.currentAlpha!==this.goalAlpha){Math.abs(this.goalAlpha-this.currentAlpha)<.1?this.currentAlpha=this.goalAlpha:(e=Math.min(e,2),this.currentAlpha<this.goalAlpha?this.currentAlpha=Math.min(this.goalAlpha,this.currentAlpha+e*.5):this.currentAlpha=Math.max(this.goalAlpha,this.currentAlpha-e*.5));for(let n=0;n<this.meshes.length;++n){let o=this.meshes[n];o.data.alpha[0]=o.data.basealpha*this.currentAlpha}}}changeMeshBaseAlpha(e,n){e.data.basealpha=n}setShoulders(e,n=1,o=!1){if(!(this.hasDied||!this.skeleton.shoulders)){if(e===!1){for(let s=8;s<=9;++s)this.removeMesh(s);for(let s=14;s<=15;++s)this.body[s]&&this.removeMesh(s)}else for(let s=0;s<=1;++s)if(!this.body[8+s]){let i=this.mesh(8+s,0,!0,1,.6);X(i.position,s?.5:-.5,-.4+n*.4,-.05),X(i.scale,.8*n,.5*n,.5*n),this.changeMeshBaseColor(i,e)}if(o!==!1)for(let s=0;s<=1;++s){this.body[14+s]||this.mesh(14+s,8+s,!1,7,.3);let i=this.body[14+s];X(i.rotation,0,3.14,0),X(i.position,s?.2:-.2,0,-.5),X(i.scale,.35,.55,.2),this.changeMeshBaseColor(i,o)}else for(let s=14;s<=15;++s)this.body[s]&&this.removeMesh(s)}}setCape(e,n){if(!(this.hasDied||!this.skeleton.cape))if(e===!1)this.body[10]!==void 0&&this.removeMesh(10);else{if(this.body[10]===void 0){let o=this.mesh(10,0,!0,8,.7);X(o.position,0,.2,-.55)}X(this.body[10].scale,n,n,n),this.changeMeshBaseColor(this.body[10],e)}}setHeadgear(e){this.hasDied||!this.skeleton.helmet||(e===!1?this.body[11]!==void 0&&this.removeMesh(11):(this.body[11]===void 0&&this.mesh(11,0,!1,9,.5),this.changeMeshBaseColor(this.body[11],e)))}setGem(e,n=1){if(!(this.hasDied||!this.skeleton.helmet))if(e===!1)this.body[12]!==void 0&&this.removeMesh(12);else{if(this.body[12]===void 0){let o=this.mesh(12,0,!1,7,.5);X(o.position,0,.4,.54),X(o.scale,.3*n,.3*n,.08*n)}this.changeMeshBaseColor(this.body[12],e)}}setCrown(e){this.hasDied||!this.skeleton.helmet||(e===!1?this.body[13]!==void 0&&this.removeMesh(13):(this.body[13]===void 0&&(this.mesh(13,0,!1,10,.8),this.body[13].position[1]=.8),this.changeMeshBaseColor(this.body[13],e)))}watersplash(e){let n=sn();st(n.position,this.entity.pos),n.position[1]=this.entity.pos[1]+this.entity.inWater+.05,Bt(n),Ts(e,n,this.soundPrio,!0)}};var D0=class extends T0{constructor(e){super(e),this.stickEffects=new Map,this.effects=new Set,this.visualFreeze=0,this.visualIncapacitate=0}addEffectBuff(e,n,o){if(n.logic.fx.stick&&(!(n.logic.incapacitated||n.logic.tags.has(4))||this.immuneCC.size<=0)&&!this.stickEffects.has(e)){let s=Oo(n.logic.fx.stick,this.entity.visual.transform,this.entity.id===I.playerId||n.caster===I.playerId?1:0,!1);this.stickEffects.set(e,s)}if(!this.effects.has(e))n.logic.fx.visual&&this.entity.visual.skin.id!==n.logic.fx.visual&&this.changeEntityVisual(n.logic.fx.visual),n.logic.fx.mount&&this.changeEntityMount(n.logic.fx.mount(n)),n.logic.fx.color&&this.entity.visual.addColor(n.logic.fx.color),n.logic.fx.alpha&&this.entity.visual.addAlpha(n.logic.fx.alpha),n.logic.fx.anim&&(this.entity.visual.clearAnims(),this.entity.visual.anim(n.logic.fx.anim,!0,0)),this.visualFreeze+=n.visualFreeze,this.visualIncapacitate+=n.visualIncapacitate,this.effects.add(e);else if(o&&this.stickEffects.has(e)){let s=this.stickEffects.get(e);s.loops=0,s.fractionNow=0}n.logic.fx.apply&&o&&Ts(n.logic.fx.apply,this.entity.visual.transform,this.entity.id===I.playerId||n.caster===I.playerId?1:0,!1)}removeEffectBuff(e,n,o){if(this.stickEffects.has(e)){let s=this.stickEffects.get(e);this.buffs.has(e)||(s.done=!0,this.stickEffects.delete(e))}this.effects.has(e)&&(n.fx.visual&&this.entity.visual.skin.id===n.fx.visual&&this.changeEntityVisual(),n.fx.mount&&this.changeEntityMount(),n.fx.color&&this.entity.visual.removeColor(n.fx.color),n.fx.alpha&&this.entity.visual.removeAlpha(n.fx.alpha),n.fx.anim&&this.entity.visual.clearAnims(),this.visualFreeze-=o.visualFreeze,this.visualIncapacitate-=o.visualIncapacitate,this.effects.delete(e))}setBuff(e,n,o,s,i,r,l,a){let c=super.setBuff(e,n,o,s,i,r);c.data=a,c.visualFreeze=c.visualIncapacitate=0,this.immuneCC.size===0&&(c.logic.fx.frozen&&c.visualFreeze++,c.logic.fx.incapacitated&&c.visualIncapacitate++),this.entity.buffDisplayDirty=!0,this.entity.visual&&this.addEffectBuff(e,c,l)}removeBuff(e,n){let o=super.removeBuff(e,n);o&&(this.entity.buffDisplayDirty=!0,this.removeEffectBuff(e,o.logic,o),o.logic.fx.endSound!==void 0&&I.player!==void 0&&ti(o.logic.fx.endSound,this.entity.visual.transform,this.entity.id===I.playerId||n===I.playerId?1:0,0,1))}changeEntityVisual(e){this.entity.remakeTransform(e),this.stickEffects.forEach((n,o)=>{let s=Oo(n.info.id,this.entity.visual.transform,n.priority,!1);s.loops=1,n.done=!0,this.stickEffects.set(o,s)})}changeEntityMount(e){this.entity.mount&&(this.entity.mount.onRemove(),this.entity.mount=void 0,this.entity.updateVisualPosition(0,I.time,I,!0)),e&&(this.entity.mount=new Sc(this.entity),this.entity.mount.setSkin(e),this.entity.updateTransformScale(),this.entity.updateVisualPosition(0,I.time,I,!0),this.entity.updateTransformRotation(.016),this.entity.updateMountRotation(.016))}};var V0=class{constructor(e){this.id=e.id||0,this.type=e.type,this.pos=[0,0,0],this.vel=[0,0,0],this.rot=0,this.radius=0,this.size=0,this.name=e.name,this.setSize(e.size||1)}async init(e){this.name=e.name||""}preFixed(e,n,o){}tickFixed(e,n,o){}postFixed(e,n,o){}preDelta(e,n,o){}tickDelta(e,n,o){}postDelta(e,n,o){}onRemove(){}setPos(e){this.pos[0]=e[0],this.pos[1]=e[1],this.pos[2]=e[2]}setRot(e){this.rot=Oa(e)}onTarget(e){return!0}setName(e){this.name=e}setSize(e){this.size=e,this.radius=e/2}hSquaredDistanceV3(e){let n=e[0]-this.pos[0],o=e[2]-this.pos[2];return n*n+o*o}distanceV2(e){return Ea($n,e,Na(Ks,this.pos)),Ia($n)}distanceV3(e){return Zt(_t,e,this.pos),ho(_t)}squaredDistanceV2(e){return Ea($n,e,Na(Ks,this.pos)),W3($n)}squaredDistance(e){return Zt(_t,e,this.pos),Qc(_t)}rotationToV2(e){return Ea($n,e,Na(Ks,this.pos)),qp($n,$n),cl($n)}rotationToV3(e){return Zt(_t,e,this.pos),to(_t,_t),Qp(_t)}};var Ar=class extends V0{constructor(e){super(e),this.hudPos=[0,0,0],this.netDeletion=new kt(0,0)}handleMovementData(e,n){st(this.pos,e.pos),st(this.vel,e.vel)}onRemove(){this.visual&&this.visual.onRemove()}};var L0=class{constructor(e){this.entity=e,this.skills=new Map,this.skillIdsLearned=[],this.skillIdsActive=[],this.timedCast=new kt,this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0,this.gcdEnd=0}add(e,n=0,o=0,s){let i=this.skills.get(e);return i=Object.assign(i||{},{level:s!==void 0?s:i?i.level+1:1,logic:At.get(e),cd:new kt(n,o-n),preGcdEnd:0}),this.skills.set(e,i),i}updateSkillsLearned(e){this.skillIdsLearned.length=0,this.skillIdsLearned.push(...e)}remove(e){this.skills.delete(e)}compileActiveSkillIds(){this.skillIdsActive.length=0,this.skills.forEach((e,n)=>{if(!e.logic.engineOnly)for(let o=0;o<e.level;++o)this.skillIdsActive.push(n)})}globalCd(e,n){this.skills.forEach(o=>{!o.logic.auto&&!o.logic.ignoreGcd&&(o.cd.end<e&&(o.cd.start=e),o.cd.end<n&&(o.preGcdEnd=o.cd.end,o.cd.end=n),o.cd.duration=o.cd.end-o.cd.start)}),this.gcdEnd=n}clearGlobalCd(){this.skills.forEach(e=>{!e.logic.auto&&!e.logic.ignoreGcd&&e.cd.end===this.gcdEnd&&(e.cd.end=e.preGcdEnd,e.cd.duration=e.preGcdEnd-e.cd.start)})}startTimedCast(e,n,o,s){this.timedCast.reset(n,s),this.timedSkill=e,this.timedTarget=o,this.entity.steer[0]=0,this.entity.steer[1]=0,this.pvpBoundModifier=At.get(e.id).pvpBoundsAdd}interruptTimedCast(e,n){this.timedCast.reset(0,0),this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0,n&&this.clearGlobalCd()}finishTimedCast(e){return this.interruptTimedCast(!1,!1)}onDeath(){this.interruptTimedCast(!0,!1)}clear(){}hasInstantCast(e){return this.entity.buffs.instantCast.size>0&&Array.from(this.entity.buffs.instantCast).some(n=>n.logic.instantCast.has(e))}};var QA=new Map,q0=class extends L0{constructor(e){super(e)}tick(e,n,o){if(this.isPlayer){let s=this.entity.buffs.incapacitated.size>0;this.skills.forEach((i,r)=>{let l=QA.get(r)||QA.set(r,new Map).get(r),a=new Map,c=0;if(s&&!i.logic.ignoreIncapacitated?c=9:(c=i.logic.can(this.entity,i.level,this.entity.target,!0),(c===3||c===4)&&(c=i.logic.can(this.entity,i.level,this.entity.id,!0))),c!==i.status&&(i.status=c,l.get("status")!==c&&a.set("status",c)),i.cd.done(o.smoothtime))i.cd.icondone||(i.cd.icondone=!0,l.get("cd")!==void 0&&a.set("cd",void 0),l.get("remaining")!==void 0&&a.set("remaining",void 0));else{i.cd.icondone=!1;let f=Math.round(100-i.cd.fraction(o.smoothtime)*100),u;i.cd.duration>1.5&&(u=i.cd.remaining(o.smoothtime),u<=3?u=Math.ceil(u*10)/10:u=Math.ceil(u)),l.get("cd")!==f&&a.set("cd",f),l.get("remaining")!==u&&a.set("remaining",u)}a.size>0&&Ni.update(f=>(a.forEach((u,m)=>{l.set(m,u),f[i.logic.id][m]=u}),f))})}if(this.timedSkill&&this.entity.visual){let s=this.timedSkill.fx;if(s){let i=this.entity.visual.animQueue[0],r=this.timedCast.remaining(n);if(s.animCast){let l=$f.get(s.animCast);r-=Math.min(.3,l.duration/2)}r>0?s.animChannel&&(!i||s.animChannel!==i.id)&&(this.entity.visual.clearAnims(),this.entity.visual.anim(s.animChannel,!0,0)):s.animCast&&(!i||s.animCast!==i.id)&&(this.entity.visual.clearAnims(),this.entity.visual.anim(s.animCast,!1,0))}}}add(e,n=0,o=0,s){super.add(e,n,o,s),this.isPlayer&&(this.compileActiveSkillIds(),Ni.update(r=>(r[e]={},r)),this.skills.get(e).logic.id<100&&ji.update(r=>(r.set(e,s),r)))}remove(e){this.isPlayer&&(this.compileActiveSkillIds(),Ni.update(o=>(o[e]=void 0,o)),this.skills.get(e)&&ji.update(o=>(o.delete(e),o))),super.remove(e)}updateSkillsLearned(e){super.updateSkillsLearned(e),Gc.update(n=>{n.clear();for(let o=0;o<e.length;++o){let s=e[o];n.has(s)||n.set(s,ou(e,s))}return n})}cd(e,n,o){this.skills.get(e).cd.set(n,o)}clearSkillInfo(){ji.update(e=>(e.clear(),e)),Gc.update(e=>(e.clear(),e))}startTimedCast(e,n,o,s){super.startTimedCast(e,n,o,s),this.entity.uiFrameDirty=!0}interruptTimedCast(e,n){super.interruptTimedCast(e,n),this.entity.uiFrameDirty=!0,e&&this.entity.visual&&this.entity.visual.clearAnims()}};var R0=class extends ic{constructor(e){super(e)}setStat(e,n){this.stat.set(e,n),this.entity.statsDirty=!0,e==20?this.entity.setPrestige(n):e==21?this.entity.setElo(n):e==6||e==7?this.entity.uiFrameDirty=!0:e==19&&this.entity.inventory&&this.entity.inventory.setSize(n)}setResource(e,n){super.setResource(e,n),this.entity.uiFrameDirty=!0}die(){super.die(),this.entity.uiFrameDirty=!0,this.entity.visual&&this.entity.visual.onDeath()}respawn(){super.respawn(),this.entity.uiFrameDirty=!0,this.entity.visual&&this.entity.remakeTransform()}refreshCombatTimer(e,n){super.refreshCombatTimer(e,n),this.entity.uiFrameDirty=!0}onCombatEnd(){super.onCombatEnd(),this.entity.uiFrameDirty=!0}};var z0=class extends Ar{constructor(e){e.creature&&(e.skin=e.creature.skin,e.name=e.creature.name),super(e),this.creatureId=e.creature?e.creature.id:-1,this.stats=new R0(this),this.buffs=new D0(this),this.skills=new q0(this),this.steer=[0,0],this.speed=1,this.static=!1,this.jump=0,this.onGround=!0,this.belowGround=!1,this.inWater=0,this.groundNormal=[0,0,0],this.target=0,this.level=0,this.faction=0,this.posLock=[0,0],this.posLockRadius=0,this.aabb=Iu()}setAABB(){d0(this.aabb,this.pos,this.size,this.size,this.size)}preFixed(e,n,o){super.preFixed(e,n,o),this.buffs.tick(e,n,o),this.stats.tick(e,n),this.skills.tick(e,n,o),this.setSize((this.stats.getStat(31)||100)/100)}getStatBasedMoveSpeed(){return Math.max(Math.min(65534,this.stats.getStat(15)))}postFixed(e,n,o){this.handlePosLock()}handlePosLock(){if(this.posLockRadius>0){Ea(Ks,Na($n,this.pos),this.posLock);let e=Ia(Ks);if(e>this.posLockRadius){let n=j3(Ks,this.posLock,Vf(Ks,Ks,this.posLockRadius/e));X(this.pos,n[0],this.pos[1],n[1])}}}hasMovementOverride(){return this.buffs.movementOverride.size>0}buffMovementOverride(e,n,o){this.hasMovementOverride()&&this.buffs.movementOverride.forEach(s=>{s.logic.movementOverride(e,n,o,this,s)})}combatRangeCheck(e,n){let o=this.pos[0]-e.pos[0],s=Math.max(0,Math.abs(this.pos[1]-e.pos[1])-this.size),i=this.pos[2]-e.pos[2];return o*o+s*s+i*i<(n+(e.size+this.size))**2}combatCylinderCheck(e,n,o){return!(this.aabb[1]>e[1]+n||this.aabb[4]<e[1]-n||Math.sqrt((e[0]-this.pos[0])**2+(e[2]-this.pos[2])**2)>o+this.radius)}tickHoles(e){let n=I.getHole(this.pos[0],this.pos[2]),o=this.pos[1]-I.getHeight(this.pos[0],this.pos[2]);return this.belowGround=n&&o<=0,n}horizontalSteer(e,n,o){if(this.stats.alive){this.rot=o;let s=qp($n,n);n[1]<0&&(s[1]*=.5),Vf(s,s,e/20),D2(this.vel,s,o)}else this.vel[0]=0,this.vel[2]=0}setSteer(e,n){this.steer[0]=e,this.steer[1]=n}setJump(e){this.jump=e}setRot(e){super.setRot(e)}setSpeed(e){this.speed=e}setTarget(e){let n=e>0&&this.canTarget(I.getEntityById(e));return n!==!1&&n!==void 0?n.onTarget(this.id):this.target!==(this.target=0)}onTarget(e){let n=I.getEntityById(e);return n.target=this.id,super.onTarget(e)}getTargetEntity(){return I.getEntityById(this.target)}canTarget(e){return e}setFaction(e){this.faction=e}setLevel(e){this.level=e}setClass(e){this.class=e}onRemove(){this.stats.clear(),this.buffs.clearTempBuffs(),this.buffs.clearPassiveBuffs(),this.skills.clear(),super.onRemove()}hostility(e){return e.faction!==this.faction?1:0}canCombatInteract(e){return!0}canSupportInteract(e){return!0}die(e,n,o){}setPosLock(e,n,o){this.posLock[0]=~~e,this.posLock[1]=~~n,this.posLockRadius=~~o}tickWaterCollisions(e){let n=this.inWater;return this.inWater=Math.max(0,e.getWaterHeight(this.pos[0],this.pos[2])-this.pos[1]),!n&&this.inWater>0&&this.vel[1]<-3&&this.onEnterWater(),this.inWater>0}onEnterWater(){}};var cs=class extends z0{constructor(e){super(e),this.uiFrameDirty=!0,this.uiRange=!0,this.buffDisplayDirty=!0,this.visualPosition=[0,0,0],this.speechTimer=new kt(0,5),this.mount=void 0,this.mountRotAdd=0,this.namePlateScale=.5,e.creature&&(e.creature.col1[0]!==0&&(e.colPrim=e.creature.col1),e.creature.col2[0]!==0&&(e.colSec=e.creature.col2)),this.skin=e.skin,this.colPrim=e.colPrim,this.colSec=e.colSec,this.interiorlightTarget=[0,0,0,0],this.interiorlightTimer=new kt(0,.5),this.conciliator=[0,0,0],this.visual=new Sc(this),this.skin>0&&this.remakeTransform()}handleMovementData(e,n){let o=Bn([0,0,0],this.pos,this.conciliator),s=Zt([0,0,0],o,e.pos);Qc(s)>1?(X(this.conciliator,0,0,0),st(this.pos,e.pos)):Bn(this.conciliator,this.conciliator,s),st(this.vel,e.vel)}makeVisual(e,n,o){this.visual.setSkin(e||this.skin,n||this.colPrim,o||this.colSec)}remakeTransform(e,n,o){this.makeVisual(e,n,o),this.updateTransformScale(),this.updateTransformRotation(1),this.updateVisualPosition(0,0,I,!0)}onRemove(){super.onRemove(),this.mount!==void 0&&this.mount.onRemove()}updateVisualPosition(e,n,o,s=!1){e>0&&(on(this.pos,this.pos,this.conciliator,-e*10),gn(this.conciliator,this.conciliator,1-e*10));let i=oo(this.pos,this.visualPosition);(s||i>1e-5)&&(st(this.visualPosition,this.pos),this.visualPosition[1]+=this.radius,this.mount===void 0?st(this.visual.transform.position,this.visualPosition):(st(this.mount.transform.position,this.visualPosition),this.mount.transform.position[1]+=this.mount.skin.size*.5-this.radius)),this.interiorlightTimer.done(n)&&(this.interiorlightTimer.reset(n),o.getInteriorLight(this.interiorlightTarget,this.aabb));let r=Math.min(1,e),l=this.interiorlightTarget,a=this.visual.interiorlight;a[0]+=Math.sign(l[0]-a[0])*r,a[1]+=Math.sign(l[1]-a[1])*r,a[2]+=Math.sign(l[2]-a[2])*r,a[3]+=Math.sign(l[3]-a[3])*r}updateTransformScale(){go(this.visual.transform.scale,this.size*.7),this.mount!==void 0&&go(this.mount.transform.scale,this.mount.skin.size*.7)}updateTransformRotation(e){if(this.stats.alive&&this.buffs.visualFreeze===0){this.updateMountRotation(e);let n=fl(this.rot+this.mountRotAdd,this.visual.transform.rotation[1]);Math.abs(n)>.01&&(this.visual.transform.rotation[1]=Pa(this.visual.transform.rotation[1]-n*Math.min(1,e*20),Math.PI*2))}}updateMountRotation(e){if(this.mount!==void 0){if((this.onGround||this.inWater>0)&&(this.steer[0]!==0||this.steer[1]!==0)){let n=this.steer[0]*1.5;this.steer[1]!=0&&(n*=.5*this.steer[1]),this.mountRotAdd-=(this.mountRotAdd-n)*Math.min(1,e*10)}this.mount.transform.rotation[1]=this.visual.transform.rotation[1]}else this.mountRotAdd=0}postFixed(e,n,o){super.postFixed(e,n,o),this.visual.tickFixed(e,n,o),this.mount!==void 0&&this.mount.tickFixed(e,n,o)}postDelta(e,n,o){super.postDelta(e,n,o),this.updateVisuals(e,n,o),this.updateUiParts(n)}updateVisuals(e,n,o){this.updateTransformRotation(e),this.updateTransformScale(),this.updateVisualPosition(e,n,o),this.mount!==void 0&&(this.mount.tick(e,n,o),this.mount.mountPosition(this.visual.transform.position)),this.visual.tick(e,n,o)}updateUiParts(e){let n=this.id===I.playerId,o=zn===this.id,s=Xt.has(this.name);if(o||s){let i=this.squaredDistance(I.player.pos)<900;i!=this.uiRange&&(this.uiFrameDirty=!0),this.uiRange=i}(this.uiFrameDirty||this.skills.timedSkill!==void 0)&&(o&&this.hydrateUnitStore(Gs),n?this.hydrateUnitStore(Ws):s&&this.hydrateUnitStore(Xt.get(this.name).unitStore)),(this.buffDisplayDirty||n||o)&&(o&&this.hydrateBuffStore(n,jc,fe.buffcountUnitframes),n?this.hydrateBuffStore(n,ca,fe.buffcountUnitframes):(this.buffDisplayDirty||o)&&s&&this.hydrateBuffStore(n,Xt.get(this.name).buffStore,fe.buffcountParty)),this.speechText!==void 0&&this.speechTimer.done(e)&&(this.speechText=void 0)}setTarget(e){let n=this.target,o=super.setTarget(e);if(n!=this.target&&this==I.player&&o){let s=I.getEntityById(e);s?(s.hydrateUnitStore(Gs,fe.buffcountUnitframes),s.hydrateBuffStore(!1,jc,fe.buffcountUnitframes)):Gs.update(i=>(i.visible=!1,i))}return o}hydrateUnitStore(e){e.update(n=>(n.visible=!0,n.name=this.name,n.alive=this.stats.alive,n.hp=this.stats.getResource(6),n.hpMax=this.stats.getStat(6),n.mp=this.stats.getResource(7),n.mpMax=this.stats.getStat(7),n.level=this.level,n.class=this.class,n.id=this.id,n.clan=this.clan,n.faction=this.faction,n.party=this.party,n.role=this.partyrole,n.type=this.type,n.combat=!this.stats.combatTimer.done(I.time),n.range=this.uiRange,n.rarity=this.faction===2&&(this.rarity||!1),n.timedSkill=this.skills.timedSkill,n.timedCast=this.skills.timedCast,n)),this.uiFrameDirty=!1}hydrateBuffStore(e,n,o){n.update(s=>gB(s,this.buffs,o,e)),this.buffDisplayDirty=!1}speech(e,n){this.speechText=e,this.speechStyle=n,this.speechTimer.reset(I.time)}},gB=(t,e,n,o)=>{let s=[];e.buffs.forEach((r,l)=>{r.forEach((a,c)=>{!a.logic.passive&&a.logic.icon!==void 0&&(!fe.buffsHideIrrelevant||c===I.playerId||c===e.entity.id&&e.entity.faction===2||e.entity===I.player&&a.logic.type==1)&&(!a.logic.unique||s.reduce((f,u)=>f+(u.id===a.id?1:0),0)===0)&&s.push(a)})});let i=s.sort((r,l)=>l.time-r.time).sort((r,l)=>r.type-l.type).slice(0,n);if(t.length<i.length)for(;t.length<i.length;)t.push(_B());else if(t.length>i.length)for(;t.length>i.length;)bB(t.pop());return i.forEach((r,l)=>{yB(I.smoothtime,r,t[l],o)}),t},vB=0,ZA=[],_B=()=>ZA.pop()||{id:vB++,icon:"",type:1,time:0,duration:10,stacks:0,cancel:-1},bB=t=>{ZA.push(t)},yB=(t,e,n,o)=>{e.logic.customIcon===void 0?n.icon=`/data/${e.logic.icon}.${Yn}?v=8738303`:n.icon=`/data/${e.logic.customIcon(e)}.${Yn}?v=8738303`,n.cancel=o&&e.logic.tags.has(12)?e.logic.id:-1,n.type=e.logic.type,n.time=Math.min(e.timer.duration,e.timer.passed(t)),n.duration=e.timer.duration,n.stacks=e.uniqueInstances>1?e.uniqueInstances:e.stacks};var co=class extends cs{constructor(e){super(e),this.static=!0,this.interactions=e.interactions,this.interactions.length&&this.setDialogue(this.interactions[0].text,this.interactions[0].choices)}interact(e){this.createInteraction()}createInteraction(){js.set({title:this.name,text:this.text,choices:this.choices})}setDialogue(e,n){this.text=e,this.choices=n}};var B0=class extends co{constructor(e){super({type:6,...e})}};var $0=class extends B0{constructor(e){super({...e,...P.npcs.blacksmith})}};var U0=class extends co{constructor(e){super({type:2,...e})}};var Xo=(t,e)=>{let n=t.length-e,o="",s=e+n;for(;e<s;){let i=t[e++];if(i<128)o+=String.fromCharCode(i);else if(i>191&&i<224){let r=t[e++];o+=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){let r=t[e++],l=t[e++],a=t[e++],c=((i&7)<<18|(r&63)<<12|(l&63)<<6|a&63)-65536;o+=String.fromCharCode(55296+(c>>10)),o+=String.fromCharCode(56320+(c&1023))}else{let r=t[e++],l=t[e++];o+=String.fromCharCode((i&15)<<12|(r&63)<<6|l&63)}}return o};var O0=class extends U0{constructor(e){super({...e,...P.npcs.conjurer})}interact(e){let n=Xo(e,1).split("#");n[0]!==""?this.setDialogue(this.interactions[0].text,Array.from(n,o=>{let s=o.split("~");return this.interactions[0].choices[0].replace("$1",s[0])+(s[1]>0?` (Lv. ${s[1]}+)`:"")})):this.setDialogue(this.interactions[0].text,[]),super.interact(e)}};var N0=class extends Ar{constructor(e){super({type:3,...e}),this.partytimeout=0,this.party=0,this.droptype="",this.tier=0,this.quality=0}partyTimeoutCheck(e){return this.party===0||e.id===this.party||e.party===this.party||I.time>this.partytimeout}canBePickedUpBy(e,n=30){return this.partyTimeoutCheck(e)&&e.stats.alive&&!e.buffs.buffs.has(128,e.id)&&e.squaredDistance(this.pos)<n}};var j0=class extends N0{constructor(e){super(e),this.visual={transform:si(1561,!1,!1,!0)},this.visual.transform.data.multi.needsUpdate=!1,this.setSize(.2),this.visual.transform.visible=!1,this.uiTimeout=0,this.dirty=!1,this.hasInfo=!1,this.hasPos=!1,this.hasRot=!1,this.color="misc"}postDelta(e,n,o){if(this.visual.transform.visible&&this.dirty){let s=o.getChunkFromWorld(this.pos[0],this.pos[2]);s!==void 0&&s.deserialized&&(this.pos[1]=o.getHeight(this.pos[0],this.pos[2])+Math.random()*.1+.1,this.visual.transform.rotation[1]=Math.random()*Math.PI*2,Xp(this.visual.transform.rotation,o.getNormal(this.pos[0],this.pos[2])),st(this.visual.transform.position,this.pos),this.visual.transform.data.multi.needsUpdate=!0,Bt(this.visual.transform,!1),this.dirty=!1)}}setDropInfo(e,n,o,s,i){this.hasInfo=!0,this.party=s,this.partytimeout=i,this.droptype=rx[e],this.tier=n,this.quality=o,this.lootquality=o;let r,l;this.droptype=="gold"?(this.name=this.tier+"c",this.setSize(.1),r="gold",this.color="gold",this.quality=100):(r=this.droptype+this.tier,l=ln[r],l&&(this.name=nn(this.droptype,this.tier)),this.droptype!=="misc"&&this.droptype!=="rune"&&this.droptype!=="book"?(this.color=jt(o)[1],fe.itemQualityPercent&&(this.name+=` ${this.quality}%`)):(this.color=this.droptype,this.quality=100,this.droptype==="rune"&&(this.lootquality=90)));let a=l&&l.art||r;$r(this.visual.transform.data.uvshift,Ai[a]),X(this.visual.transform.scale,Ai[a][0]*20,1,Ai[a][1]*20),this.visual.transform.data.shine[0]=Math.random()*6.1,this.dirty=!0,this.visual.transform.visible=!0}onRemove(){As(this.visual.transform.data.multi,this.visual.transform),nt.shift.down&&(Fc.add(this),this.uiTimeout=Math.round(I.time/5)*5+10)}};var W0=class extends cs{constructor(e){super({type:7,...e}),this.static=!0,this.class=5}};var G0=class extends W0{};var H0=class extends co{constructor(e){super({type:12,...e})}};var Y0=class extends H0{constructor(e){super({...e,interactions:[]})}};var X0=class extends co{constructor(e){super({type:4,...e})}};var Q0=class extends X0{constructor(e){super({...e,...P.npcs.merchant})}};var Z0=class extends cs{constructor(e){super({type:1,...e}),this.groundHeight=0;let n=A1.get(e.creature.id);this.aggroMode=n.aggroMode,this.rarity=n.rarity}tickFixed(e,n,o){this.horizontalSteer(this.speed,this.steer,this.rot),super.tickFixed(e,n,o),this.tickHoles(e),this.stats.alive&&(on(this.pos,this.pos,this.vel,e),this.groundHeight=o.raycastEnvironmentHeight(this.pos[0],this.pos[2],this.pos[1]+1,this.pos[1]-1,this.groundNormal),this.belowGround||(this.groundHeight=Math.max(this.groundHeight,o.getHeight(this.pos[0],this.pos[2])))),this.setAABB(),this.tickWaterCollisions(o),this.inWater>this.radius||(this.pos[1]-=10*e),this.pos[1]=Math.max(this.groundHeight,this.pos[1])}};var J0=class extends Z0{};var K0=class extends Ar{constructor(e){super({type:11,...e})}};var eh=class extends K0{constructor(e){super(e),this.meshId=0,this.scale=0,this.effects=[],this.dirty=!1,this.rot=Math.random()*3.14}postDelta(e,n,o){if(this.dirty){st(this.mesh.position,this.pos),this.mesh.rotation[1]=this.rot,go(this.mesh.scale,this.scale),this.mesh.matrixNeedsUpdate=!0,Bt(this.mesh,!0);for(let s=0;s<this.effects.length;++s){let i=this.effects[s];Bt(i.transform,!0)}this.mesh.data.multi&&(this.mesh.data.multi.needsUpdate=!0),this.dirty=!1}}setNodeInfo(e,n){e!==this.meshId&&(this.meshId>0&&this.removeMesh(),this.meshId=e,this.makeMesh(),this.dirty=!0),this.scale!==n&&(this.scale=n,this.dirty=!0)}makeMesh(){let e=Ms.get(this.meshId);e.geometry>0?(this.mesh=si(this.meshId,!0,!1,!0),so(this.mesh.data.interiorlight,0,0,0,0)):this.mesh=sn();for(let n=0;n<e.effects.length;++n){let o=e.effects[n],s=sn();st(s.position,o.pos),st(s.scale,o.scale),st(s.rotation,o.rot),Cn(s,this.mesh);let i=Oo(o.id,s,0,!0);this.effects.push(i)}}removeMesh(){this.mesh!==void 0&&(this.mesh.data.multi?As(this.mesh.data.multi,this.mesh):vs(this.mesh)),this.mesh=void 0;for(let e=0;e<this.effects.length;++e)this.effects[e].done=!0;this.effects.length=0}onRemove(){this.removeMesh()}};var th=class extends cs{constructor(e){super({type:10,...e}),this.groundHeight=0}tickFixed(e,n,o){this.horizontalSteer(this.speed,this.steer,this.rot),super.tickFixed(e,n,o),this.tickHoles(e),this.stats.alive&&(on(this.pos,this.pos,this.vel,e),this.groundHeight=o.raycastEnvironmentHeight(this.pos[0],this.pos[2],this.pos[1]+1,this.pos[1]-1,this.groundNormal)),this.setAABB(),this.tickWaterCollisions(o),this.inWater>this.radius||(this.pos[1]-=10*e),this.pos[1]=Math.max(this.groundHeight,this.pos[1])}};var nh=class extends th{};var oh=class extends cs{constructor(e){super({type:0,size:.9,...e}),this.exp=0,this.party=0,this.partyrole=0,this.prestige=0,this.prestigeRank=0,this.elo=0,this.eloRank=0,this.clan=void 0,this.clanRole=0,this.jumpLast=0}tickVelocity(e,n,o,s,i){this.inWater>this.radius?(this.onGround&&(this.vel[1]=Math.max(0,this.vel[1])),this.inWater<this.radius+.1&&(this.jump>0||this.vel[1]===0)?this.vel[1]=this.jumpLast===0&&s>0?7:0:(this.vel[1]+=s?e*8:e*-4,this.vel[1]=Math.max(Math.min(this.vel[1],4),-3)),this.horizontalSteer(i*.5,n,o)):this.onGround?(this.stats.alive&&s>0&&i>0&&(this.vel[1]=9,this.onGround=!1),this.horizontalSteer(i,n,o)):(this.vel[1]=Math.max(-60,this.vel[1]-25*e),this.stats.alive&&this.vel[0]===0&&this.vel[2]===0&&this.horizontalSteer(i*.5,n,o)),this.jumpLast=this.vel[1]<0?this.jumpLast:this.jump}tickMovement(e,n,o,s,i){this.tickVelocity(e,n,o,s,i);let r=this.tickHoles(e);this.setWorldCollAABB(this.vel[0]*e,this.vel[1]*e,this.vel[2]*e);let l=I.triangleGrid.queryAABB(this.aabb),a=[],c=[],f=[];for(let v=0;v<l.length;++v){let _=l[v],b=_[3][1];b>.6?c.push(_):b<-.6?f.push(_):a.push(_)}let u=ho(this.vel)*e,m=Math.floor(Math.max(1,u/.1)),g=e/m;for(let v=0;v<m;++v)this.tickCollisions(g,a,c,f,r);this.setAABB(),this.tickWaterCollisions(I),I.clampV3(this.pos)}setWorldCollAABB(e,n,o){let s=this.aabb,i=this.radius+.5;s[0]=this.pos[0]-Math.min(0,e)-i,s[3]=this.pos[0]+Math.max(0,e)+i,s[1]=this.pos[1]-Math.min(0,n)-i,s[4]=this.pos[1]+Math.max(0,n)+i*2,s[2]=this.pos[2]-Math.min(0,o)-i,s[5]=this.pos[2]+Math.max(0,o)+i}tickCollisions(e,n,o,s,i){let r=[...this.pos];on(this.pos,this.pos,this.vel,e);let l=this.belowGround||i?0:I.getHeight(this.pos[0],this.pos[2]),a=I.getNormal(this.pos[0],this.pos[2]);this.tickWallCollisions(n,l,a),l=this.belowGround||i?0:I.getHeight(this.pos[0],this.pos[2]),a=I.getNormal(this.pos[0],this.pos[2]),this.tickFloorCollisions(o,l,a),this.tickCeilCollisions(s,r),this.belowGround||(this.pos[1]=Math.max(this.pos[1],I.getHeight(this.pos[0],this.pos[2])))}tickWallCollisions(e,n,o){if(o[1]<.6&&this.pos[1]<n){let c=-(Fy(...this.pos,this.pos[0],n,this.pos[2],...o)+.05);this.pos[0]-=o[0]*c,this.pos[2]-=o[2]*c}let s=this.radius,i=this.radius*1.5,r=this.pos[0],l=this.pos[1]+i,a=this.pos[2];for(let c=0;c<e.length;++c){let f=e[c];if(Yp(f[0],f[1],f[2],r,l,a)){let u=My(r,l,a,...f[0],...f[3]);if(u<s&&u>-.5){let m=u-s;this.pos[0]-=f[3][0]*m,this.pos[2]-=f[3][2]*m}}}}tickFloorCollisions(e,n,o){let i=this.vel[1]>0||this.inWater>this.radius?0:.1,r=this.radius*1.5,l=1/0,a=!1;for(let f=0;f<e.length;++f){let u=e[f];if(Yp(u[0],u[1],u[2],...this.pos)){let m=O1(...this.pos,...u[0],...u[3]);m<l&&m<i&&m>-r&&(l=m,a=!0,st(this.groundNormal,u[3]))}}let c=-(n-this.pos[1]);o[1]>.6&&this.pos[1]<n+i&&c<l&&c<i&&c>-r&&(l=c,a=!0,st(this.groundNormal,o)),a?(this.pos[1]-=l,this.onGround||(this.onGround=!0,this.onFallLanding(-this.vel[1]),this.vel[1]=Math.max(0,this.vel[1]))):(this.onGround=!1,X(this.groundNormal,0,1,0))}tickCeilCollisions(e,n){let o=this.radius*1.5;for(let s=0;s<e.length;++s){let i=e[s],r=this.pos[0],l=this.pos[1],a=this.pos[2];if(Yp(i[0],i[1],i[2],r,l,a)){let c=O1(...this.pos,...i[0],...i[3]);c<0&&c>-o&&(this.pos[1]>=n[1]&&(this.pos[0]=n[0],this.pos[2]=n[2]),this.vel[1]=Math.min(0,this.vel[1]),this.vel[0]=0,this.vel[2]=0)}}}setExp(e){this.exp=e}setParty(e,n){this.party=e,this.partyrole=n}setPrestige(e){return e!==this.prestige?(this.prestige=e,this.prestigeRank=lc(e),!0):!1}setElo(e){return e!==this.elo?(this.elo=e,this.eloRank=Ha(e),!0):!1}setClan(e,n=0){this.clan=e,this.clanRole=n}getNearbyPartyMembers(e){let n=[];return this.stats.alive&&n.push(this),this.party>0&&I.entities.type[0].forEach(o=>{o.party==this.party&&o!=this&&o.stats.alive&&oo(e,o.pos)<1e3&&n.push(o)}),n}hostility(e){return(I.mode.partyBasedHostility===!0?e.party!==this.party:e.faction!==this.faction)?e.type===0?e.stats.stat.get(26)===0&&this.stats.stat.get(26)===0?0:2:1:0}canCombatInteract(e){return e.type===0?e.buffs.buffs.has(128,e.id)?!1:!I.mode.pvpprotect||this.hostility(e)<2?!0:!(this.stats.stat.get(26)===0||e.stats.stat.get(26)===0)&&Math.abs(this.stats.stat.get(26)-e.stats.stat.get(26))<=5+Math.max(this.skills.pvpBoundModifier,e.skills.pvpBoundModifier):e.type===1||e.type===10||e.type===12?e.stats.stat.get(26)>0:!0}canSupportInteract(e){return this.hostility(e)===0&&(!I.mode.pvpprotect||(e.type===0?Math.abs(this.stats.stat.get(26)-e.stats.stat.get(26))<=5:!0))}onFallLanding(e){}};var kB=[1,2,3,4],zl=class extends oh{constructor(e){e.skin=0,super(e)}tickFixed(e,n,o){super.tickFixed(e,n,o),this.tickMovement(e,this.steer,this.rot,this.jump,this.speed)}setClass(e){e!==this.class&&(super.setClass(e),this.skin=kB[this.class],this.remakeTransform())}makeVisual(e,n){super.makeVisual(e,n),this.prestige>0&&this.setPrestige(this.prestige,!0),this.level>=10&&this.setLevel(this.level),this.elo>1500&&this.setElo(this.elo,!0)}setPrestige(e,n){if(super.setPrestige(e)||n){let o=Math.min(this.prestigeRank,10),s=this.prestigeRank-11;o<1?(this.visual.setCrown(!1),this.visual.setHeadgear(!1)):(this.visual.setHeadgear(s<0?Tg[Math.min(4,o-1)]:Rn.darkgold),o>5?this.visual.setCrown(Tg[o-6]):this.visual.setCrown(!1)),s<0?this.visual.setGem(!1):this.visual.setGem(e4[s],s>0?1:.8)}}setElo(e,n){if(super.setElo(e)||n){let o=Ha(e);this.visual.setShoulders(Eg[Math.min(o,1)],.65+o*.08,o>0&&Eg[o])}}setLevel(e){super.setLevel(e),e>=15?this.visual.setCape(this.faction===0?Rn.vanguard:Rn.bloodlust,e>=25?1:.5):this.visual.setCape(!1)}setParty(e,n){this.uiFrameDirty=!0,this.buffDisplayDirty=!0,super.setParty(e,n)}onEnterWater(){this.visual.playSound(130,!1),this.visual.watersplash(94)}};var sh=class extends co{constructor(e){super({type:9,...e})}};var ih=class extends sh{constructor(e){super({...e,...P.npcs.sage})}interact(e){this.interactions[0].choices[0]=this.interactions[0].choices[0].replace("$1",I.player.level*10),super.interact(e)}};var rh=class extends co{constructor(e){super({type:5,...e})}};var lh=class extends rh{constructor(e){super({...e,...P.npcs.stash})}};var ah=class extends co{constructor(e){super({type:8,...e})}};var ch=class extends ah{constructor(e){super({...e,...P.npcs.trader});let n=T1.get(e.creature.id);this.items=[],Uf.forEach(o=>{if(o.shop===n.shop){let s=new Ss,i=te();s.hydrate({type:o.type,tier:o.tier,stacks:o.stacks===0?void 0:o.stacks,upgrade:o.upgrade,store:i}),s.buyid=o.id,this.items.push([s,i])}})}};var fh=class{constructor(e){this.entity=e,this.slots=new Map,this.gold=0,this.medals=0,this.size=0,this.firstEmptySlot=0,this.firstEmptySlotDirty=!0,this.setSize(0)}tickFixed(e,n,o){}setSize(e){this.size=Math.min(100,e)}setGold(e){this.gold=e}setMedals(e){this.medals=e}setItem(e,n){let o=new Ss(n);return this.slots.set(e,o),e===this.firstEmptySlot&&(this.firstEmptySlotDirty=!0),o}removeItem(e){let n=this.slots.get(e);return this.slots.delete(e),(e<this.firstEmptySlot||this.firstEmptySlot===-1)&&(this.firstEmptySlot=e),n}async hydrateItems(e=!1){let n=[],o=[];if(this.slots.forEach((s,i)=>{s.dirty&&(s.dirty=!1,n.push(s.dbid),o.push(i))}),n.length){let s=await this.fetchData(n);this.compareData(s,o,0),this.postHydrate(o,e)}else e&&this.postHydrate(o,e)}hydrate(e){this.slots.has(e.slot)?this.slots.get(e.slot).hydrate(e):console.error("received hydration of unknown item")}postHydrate(e){}compareData(e,n,o){e.forEach(s=>{s.slot!==null&&(this.hydrate(s),n=n.filter(i=>i!==s.slot))}),n.forEach(s=>this.removeItem(s,o))}findFirstItemOfType(e,n){for(let o of this.slots)if(o[1].type==e&&o[1].tier==n)return o[1]}findFirstSlotOfType(e,n){let o=-1,s=0;for(let i of this.slots){let r=i[0],l=i[1];l.type==e&&l.tier==n&&r>o&&l.bound>=s&&(o=r,s=l.bound)}return o>=0?o:void 0}getFirstEmptySlot(){if(this.firstEmptySlotDirty){this.firstEmptySlotDirty=!1;for(let e=0;e<this.size;++e)if(!this.slots.has(e))return this.firstEmptySlot=e;this.firstEmptySlot=-1}return this.firstEmptySlot}findFirstUnmaxedStackableOfType(e,n){for(let o of this.slots)if(o[1].type==e&&o[1].tier==n&&o[1].stacks<50)return o[1];return-1}};var uh,mh=class extends fh{constructor(e){super(e),this.dirty=!1}tickFixed(e,n,o){super.tickFixed(e,n,o),this.dirty&&(this.hydrateItems(),this.dirty=!1)}setGold(e,n,o){super.setGold(e),hu(e,n,o,"$g"),Zo.set(e)}setMedals(e,n,o){super.setMedals(e),hu(e,n,o,"$m"),fa.set(e)}setItem(e,n,o){let s=super.setItem(e,n);s.reason=o,this.dirty=!0}removeItem(e,n){EF(super.removeItem(e),n),uh[e]!==void 0&&(uh[e].set(void 0),this.dirty=!0,this.updateInventoryCounts())}hydrate(e){e.store=uh[e.slot],super.hydrate(e)}postHydrate(e){super.postHydrate(e),this.updateInventoryCounts()}updateInventoryCounts(){let e={};this.slots.forEach(n=>{let o=n.type+n.tier;e[o]=(e[o]||0)+(n.stacks?n.stacks:1)}),ma.set(e)}async fetchData(e){let n=await fetch("/api/item/get",{method:"POST",body:JSON.stringify({ids:e})}),o=await n.json();if(o==="error"||n.ok===!1)console.error("inventory hydration error",o);else return o}setSize(e){super.setSize(e),ua.update(n=>{for(let o=111;o>=0;--o)o>=101?n[o]||(n[o]=te(void 0)):o>=this.size?n[o]&&delete n[o]:n[o]||(n[o]=te(void 0));return uh=n,n})}};var ph=class extends zl{constructor(e){super(e),I.setPlayer(this),this.skills.isPlayer=!0,this.skills.clearSkillInfo(),this.inventory=new mh(this),this.partyInfoUpdateTimer=new kt(0,1),this.heartBeatTimer=new kt(0,1),this.secondlyUpdates=new kt(0,1),this.lastNetRot=this.rot,this.inputTicksPassed=0,this.inputTicksSinceLastPosUpdate=0,this.inputTicksSinceLastRotUpdate=0,io[1]=.7,this.smoothZoom=0,this.areaid=-1}makeVisual(e,n){super.makeVisual(e,n),this.visual.soundPrio=1}tickFixed(e,n,o){super.tickFixed(e,n,o),this.inventory.tickFixed(e,n,o)}preFixed(e,n,o){super.preFixed(e,n,o),(nt.turnright.down||nt.turnleft.down)&&(io[0]=Oa(io[0]+fe.mouseSensitivity*3*e*((nt.turnleft.down?1:0)-(nt.turnright.down?1:0)))),this.handleInput(e,n,o)}postFixed(e,n,o){super.postFixed(e,n,o)}handleInput(e,n,o){this.inputTicksPassed++;let s=!1,i=!1,r=!1,l=!1,a=!1,c=!1,f=this.steer[0],u=this.steer[1],m=this.jump,g=this.rot,v=f,_=u,b=m,k=g;this.hasMovementOverride()?(this.buffMovementOverride(e,n,o),f=this.steer[0],u=this.steer[1],m=this.jump,g=this.rot):(f=(nt.left.down?1:0)+(nt.right.down?-1:0),u=(nt.fwd.down||nt.lmb.down&&nt.rmb.down?1:0)+(nt.back.down?-1:0),m=nt.jump.down?1:0,g=fe.lockedcamera&&nt.lmb.down||nt.rmb.down||nt.turnleft.down||nt.turnright.down?io[0]:this.rot),(f!==v||u!==_)&&(i=f!==v,r=u!==_,this.setSteer(f,u)),m!==b&&(this.setJump(m),a=!0);let y=fl(g,this.lastNetRot);this.inputTicksSinceLastRotUpdate++,g!==k&&this.setRot(g),g!==this.lastNetRot&&((this.steer[0]!==0||this.steer[1]!==0)&&Math.abs(y)>.1||this.inputTicksSinceLastRotUpdate>10||r||i||Math.abs(y)>.2)&&(this.lastNetRot=k,s=!0);let F=this.getStatBasedMoveSpeed();F!=this.speed&&(this.setSpeed(F),l=!0),this.inputTicksSinceLastPosUpdate++,this.inputTicksSinceLastPosUpdate>600?c=!0:this.inputTicksSinceLastPosUpdate>40?(this.steer[0]!==0||this.steer[1]!==0)&&(c=!0):this.inputTicksSinceLastPosUpdate>20&&(this.steer[0]!==0||this.steer[1]!==0)&&(s||i||r)&&(c=!0),(s||i||r||l||a||c)&&this.sendInput(s,i,r,l,a,c)}sendInput(e,n,o,s,i,r){let l={uint8s:[],int8s:[],uint16s:[],doubles:[]};l.uint8s.push(Math.min(254,this.inputTicksPassed)),i&&l.uint8s.push(this.jump),n&&!o?l.int8s.push(this.steer[0]):(n||o)&&l.int8s.push(this.steer[0],this.steer[1]),e&&(this.inputTicksSinceLastRotUpdate=0,l.doubles.push(this.rot)),r&&(this.inputTicksSinceLastPosUpdate=0,l.doubles.push(this.pos[0],this.pos[1],this.pos[2])),s&&l.uint16s.push(this.speed),Io(Mt.clientPlayerInput.packData(l)),this.inputTicksPassed=0}updateCharPanel(){(fe.charpanelOpen||fe.skillmenuOpen)&&this.statsDirty&&(this.statsDirty=!1,Hi.update(e=>(Array.from(this.stats.stat).forEach(o=>e[o[0]]=o[1]),e)))}updatePartyInfo(e){if(this.partyInfoUpdateTimer.done(e)){this.partyInfoUpdateTimer.reset(e);let n=this.getNearbyPartyMembers(this.pos),o=j1(n.length);eo.update(s=>(s.role=this.partyrole,s.nearby=n.length,s.exprate=Math.round(o*100),s.itemfind=Math.min(10*100,Math.round(o*100+Dy(n)*100)),s))}}handleCamera(e){if(st(Yt.position,this.mount?this.mount.transform.position:this.visual.transform.position),Yt.position[1]+=1.25,Yt.rotation[0]=io[1],!nt.lmb.down&&!nt.rmb.down&&(this.steer[0]!==0||this.steer[1]!==0)){let u=fl(this.rot,io[0])*Math.min(1,e*2);u!==0&&(Math.abs(u)>.03*e?(u=u>0?Math.max(u,Math.min(1,.6*e)):Math.min(u,Math.max(1,-.6*e)),io[0]-=u):io[0]=this.rot)}Yt.rotation[1]=io[0],Bt(Yt,!1);let n=fe.cameraZoom;X(ht.transform.position,0,0,-n),ba(ht,!1);let o=[0,0,0],s=[0,0,0],i=[0,0,0];hi(ht,i,[0,0]),Zt(o,i,Yt.position),Im(s,o);let r=ho(o),l=[0,0,0],a=[0,0,0],c=[[-1,1],[1,1],[-1,-1],[1,-1]];for(let u=0;u<c.length;++u){let m=c[u];hi(ht,l,m),Zt(a,l,i),Bn(l,Yt.position,a);let g=I.triangleGrid.queryRay(l,o,s),v=1;for(let _=0;_<g.length;++_){let b=g[_];v=Math.min(v,ja(b[0],b[1],b[2],l,o,!0))}v<1&&(n=Math.min(r*v,n))}if(this.smoothZoom=Math.max(0,Math.min(this.smoothZoom+e*20,n)),X(ht.transform.position,0,0,-this.smoothZoom),Nh(ht),!this.belowGround){hi(ht,l,[0,-1]);let u=I.getHeight(l[0],l[2]);u>l[1]&&(Yt.position[1]+=u-l[1])}Bt(Yt,!1),ba(ht,!1),hi(ht,l,[0,-1]);let f=I.getWaterHeight(l[0],l[2]);if(f>l[1]){let u=f-l[1];p0(u);let m=l[1]-f;if(hi(ht,l,[0,1]),f<l[1]){let g=l[1]-f;Math.abs(g)>Math.abs(m)?(Yt.position[1]-=m,p0(0)):Yt.position[1]-=g,Bt(Yt,!1),ba(ht,!1)}}else p0(0)}handleAreaCheck(e){let n=e.getAreaId(this.pos[0],this.pos[2]);if(n!==this.areaid){this.areaid=n;let o=Bf.get(n);o!==void 0&&Dr.set({type:"area",text:o.name,time:5e3})}}handleHeartBeat(e){let n=this.stats.getResource(6)/(this.stats.getStat(6)*.5);n>0&&n<1&&(n=(Math.max(0,Math.min(1,n))+.5)/1.5,xt(103),this.heartBeatTimer.reset(e,n))}postDelta(e,n,o){this.updateCharPanel(),this.updatePartyInfo(n),super.postDelta(e,n,o),this.handleCamera(e),this.secondlyUpdates.done(n)&&this.handleAreaCheck(o),this.heartBeatTimer.done(n)&&this.handleHeartBeat(n)}updateTransformRotation(e){this.stats.alive&&this.buffs.visualFreeze===0&&(this.updateMountRotation(e),this.buffs.movementOverride.size||!nt.rmb.down&&!(fe.lockedcamera&&nt.lmb.down)?this.visual.transform.rotation[1]=this.rot:this.visual.transform.rotation[1]=io[0],this.visual.transform.rotation[1]+=this.mountRotAdd)}setLevel(e){super.setLevel(e),this.uiFrameDirty=!0}onRemove(){super.onRemove(),I.removePlayer(this)}setExp(e){super.setExp(e),_m.update(n=>(n.current=e,n.max=rr(this.level),n))}setClan(e,n=0){super.setClan(e,n),Sm.set(e)}setRot(e,n=!1){super.setRot(e),n&&(io[0]=e)}};var N_=new Map([[6,$0],[2,O0],[7,G0],[4,Q0],[0,zl],[9,ih],[12,Y0],[5,lh],[8,ch],[3,j0],[1,J0],[10,nh],[11,eh]]),JA=(t,e)=>t==0?e==I.playerId?ph:zl:N_.get(t);var j_=[-0,-1,-0],dh=class{constructor(){this.id="",this.idInt=0,this.file="",this.bounds=0,this.chunkAmount=0,this.entities={array:[],map:new Map,type:{}},N_.forEach((e,n)=>this.entities.type[n]=[]),this.mode=zd.normal,this.chunksMap=new Map,this.chunksArray=[],this.finishedLoadingChunks=new Set,this.time=this.accum=-0,this.timestep=1/60,this.tickId=0,this.data=void 0,this.triangleGrid=new P0}load(e,n){this.id=e,this.file=n,E1.forEach(o=>{o.name===n&&(this.data=o,this.idInt=o.id)}),this.parse(!1)}tickIdToTimestamp(e){return e*this.timestep}setTimeFromTickId(e){return this.tickId=e,this.time=this.tickIdToTimestamp(e),this.tickId}createEntity(e,n,o){return o=o||{},o.id=n,new(JA(e,n))(o)}addEntity(e){if(e===void 0||e.type===void 0){console.log("Error: tried adding an entity of unknown type to the world");return}if(this.isEntityInWorld(e)||this.isEntityIdTaken(e.id)){console.log("Error: Entity in world or entity id taken"),console.log(e),console.log(this.getEntityById(e.id));return}return this.entities.array.push(e),this.entities.map.set(e.id,e),this.entities.type[e.type].push(e),e}removeEntity(e){if(e===void 0)return!1;this.entities.map.delete(e.id);let n=this.entities.array.indexOf(e);return n>-1&&this.entities.array.splice(n,1),n=this.entities.type[e.type].indexOf(e),n>-1&&this.entities.type[e.type].splice(n,1),e.onRemove(),e}isEntityIdTaken(e){return this.entities.map.has(e)}isEntityIdAllowed(e){return!0}isEntityInWorld(e){return this.entities.array.indexOf(e)>=0}entity(e){return this.entities.map.get(e)}getEntityById(e){return this.entities.map.get(e)}getPlayerByName(e){let n=e.toLowerCase();return this.entities.type[0].find(o=>o.name&&o.name.toLowerCase()===n)}getMonsterByName(e){let n=e.toLowerCase();return this.entities.array.find(o=>o.name&&o.name.toLowerCase()===n)}setMode(){this.mode=zd[this.id]||zd.normal}getHeight(e,n){e=gt(e,0,this.bounds),n=gt(n,0,this.bounds);let o=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!o||!o.deserialized?-0:Es(o,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getHole(e,n){e=gt(e,0,this.bounds),n=gt(n,0,this.bounds);let o=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!o||!o.deserialized?-0:Vu(o,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getWaterHeight(e,n){e=gt(e,0,this.bounds),n=gt(n,0,this.bounds);let o=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!o||!o.deserialized?-1:Lu(o,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getAreaId(e,n){e=gt(e,0,this.bounds),n=gt(n,0,this.bounds);let o=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!o||!o.deserialized?-0:__(o,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getEnvironmentId(e,n){e=gt(e,0,this.bounds),n=gt(n,0,this.bounds);let o=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!o||!o.deserialized?-0:b_(o,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getNormal(e,n){e=gt(e,0,this.bounds),n=gt(n,0,this.bounds);let o=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);if(!o||!o.deserialized)X(j_,0,0,0);else{e=e>=this.bounds?63:e%64,n=n>=this.bounds?63:n%64,e/=2.6666666666666665,n/=2.6666666666666665;let s=Math.floor(e)*2+24*Math.floor(n)*2;e%1+n%1>1&&s++,s*=3,X(j_,o.normals[s],o.normals[s+1],o.normals[s+2])}return j_}clampV3(e){return e[0]=gt(e[0],0,this.bounds),e[1]=gt(e[1],0,2e3),e[2]=gt(e[2],0,this.bounds),e}getChunkFromWorld(e,n){return e=gt(e,0,this.bounds),n=gt(n,0,this.bounds),e=Math.min(Math.floor(e/64),this.chunkAmount-1),n=Math.min(Math.floor(n/64),this.chunkAmount-1),this.chunksMap.get(e+n*this.chunkAmount)}getChunk(e,n){if(!(e<0||n<0||e>=this.chunkAmount||n>=this.chunkAmount))return this.chunksMap.get(e+n*this.chunkAmount)}parse(e){this.setMode(),e||(this.chunkAmount=this.data.chunkAmount,this.bounds=64*this.chunkAmount,this.setGrids(),this.finishedLoadingChunks.clear(),this.createChunks())}setGrids(){this.triangleGrid.setDimensions(this.bounds,this.bounds,this.bounds,15,15,15)}rebuildTriangleOctree(){this.triangleGrid.clear(),this.chunksMap.forEach(e=>{for(let n=0;n<e.props.length;++n){let o=e.props[n];o.loaded=!1,o.loadGeometry(this,e)}})}triangleRaycastClosest(e,n,o,s,i,r){A0(ao,e,n,o,s,i,r);let l=1,a=this.triangleGrid.queryRay(ao.origin,ao.dir,ao.invDir);for(let c=0;c<a.length;++c){let f=a[c];l=Math.min(l,ja(f[0],f[1],f[2],ao.origin,ao.dir,!1))}return l}triangleRaycastAny(e,n,o,s,i,r,l){A0(ao,e,n,o,s,i,r);let a=this.triangleGrid.queryRay(ao.origin,ao.dir,ao.invDir);for(let c=0;c<a.length;++c){let f=a[c];if(ja(f[0],f[1],f[2],ao.origin,ao.dir,l)<1)return!0}return!1}raycastEnvironmentClosest(e,n,o,s,i,r){let l=this.getHeight(e,o)>n,a=this.triangleRaycastClosest(e,n,o,s,i,r);a<1&&(s*=a,i*=a,r*=a);let c=0,f=0,u=.1;if(l)f=1;else for(;c<100&&f<1;){let m=f+u,g=e+s*m,v=n+i*m,_=o+r*m,b=this.getHole(e,o)?0:this.getHeight(g,_),k=v-b;k<0?k>-.05?(f+=u,c=100):u*=.5:f+=u,c++}return Math.min(f,a,1)}raycastEnvironmentAny(e,n,o,s,i,r,l){let a=Math.sqrt(s*s+i*i+r*r),c=3/a,f=s*c,u=i*c,m=r*c,g=e,v=n+l,_=o,b=Math.floor(a/3),k=0;for(;k<b;)if(++k,g+=f,v+=u,_+=m,this.getHeight(g,_)>v)return!0;return this.triangleRaycastAny(e,n,o,s,i,r,!0)}raycastEnvironmentHeight(e,n,o,s,i){let l=this.getHole(e,n)?0:this.getHeight(e,n),a=0;o>l&&(i!==void 0&&st(i,this.getNormal(e,n)),a=l);let c=o-s;ri[0]=ri[3]=e,ri[5]=ri[2]=n,ri[4]=o,ri[1]=s;let f=this.triangleGrid.queryAABB(ri);if(f.length>0){let u=1/0;A0(ao,e,o,n,0,-c,0);for(let m=0;m<f.length;++m){let g=f[m],v=ja(g[0],g[1],g[2],ao.origin,ao.dir,!1);if(v<u){u=v;let _=o-v*c;_>a&&(a=_,i!==void 0&&st(i,g[3]))}}}return a}addChunk(e){this.chunksMap.set(e.id,e),this.chunksArray.push(e)}removeChunk(e){this.chunksMap.delete(e.id),this.chunksArray.splice(this.chunksArray.indexOf(e),1)}};var KA=(t,e,n="")=>{Oc.update(o=>(o.push({text:t,icon:e,css:n}),o))};var xB={2:"On cooldown.",3:"Can only be cast on enemy.",4:"Can only be cast on ally.",5:"Not enough mana.",6:"Out of range.",10:"Target is dead.",7:"Can't do that during movement.",8:"Can't cast while busy.",9:"You are incapacitated.",11:"Can't do that in combat.",12:"Can't cast this right now.",13:"Level difference is too big.",14:"Target is not in line of sight."},e7=new Map;e7.set(16,t=>{if(Nt("system",`You have learned ${P.items.book[t[0]].name} Lv. ${t[1]}`,!0),xt(89),an(21,100),t[1]===0&&At.get(t[0]).autoSkillbar){let e=fe.skillbarsettings[I.player.name].findIndex(n=>n.id===-1);e>=0&&Po[e].update(n=>(n.id=t[0],n))}}).set(15,t=>{I.player.skills.add(t[0],wo(t[2]),wo(t[3]),t[1])}).set(17,t=>{I.player.skills.remove(t[0])}).set(18,t=>{I.player.skills.updateSkillsLearned(t)}).set(19,t=>{Hc.set(Xo(t,0))}).set(1,t=>{Dr.set({type:"error",text:xB[t[0]]})}).set(20,t=>{I.player.setExp(t[1]),fe.msgExpGain&&Nt("exp",`Gained ${t[0]} experience. ${I.player.exp}/${rr(I.player.level)}`,!0),pv(t[0])}).set(21,t=>{I.player.setExp(t[1]),Nt("error",`Lost ${t[0]} experience. ${I.player.exp}/${rr(I.player.level)}`,!0)}).set(22,t=>{I.player.setExp(t[0])}).set(45,t=>{let e=I.entity(t[1]);xt(104),e&&JP(st([0,0,0],e.visualPosition),t[0]),fe.msgFame&&Nt("fame",`Gained $fm${t[0]} fame ${e?"from "+e.name:""}`,!0)}).set(46,t=>{fe.msgFame&&Nt("fame",`Lost $fm${t[0]} fame.`,!0)}).set(47,t=>{xt(104),fe.msgFame&&Nt("fame",`Gained $fm${t[0]} salary from the war.`,!0)}).set(48,t=>{xt(105),fe.msgFame&&Nt("fame",`War: Gained $fm${t[0]} spoils of war (Fight ${t[1]>0?"Victory!":"Loss!"}).`,!0)}).set(49,t=>{xt(105),fe.msgFame&&Nt("fame",`Obelisk: Captured obelisk for $fm${t[0]} and $m${t[2]}.`,!0),I.player.inventory.setMedals(t[1],t[2],1)}).set(50,t=>{Hs.set(),Ys.set(!1),t[0]===1&&Nt("system","War: You have left the war due to inactivity.",!0)}).set(23,t=>{let e=I.getEntityById(t[0]);e&&e.interact(t)}).set(24,t=>{js.set(void 0)}).set(25,t=>{let e=Xo(t,0);e.startsWith("Rolling for")&&!fe.msgItemPartyRoll||Nt("system",e,!0)}).set(26,t=>{Nt("error",Xo(t,0),!0)}).set(52,t=>{let e=Xo(t,1);Ta(P.ui.party.summon,P.ui.party.onSummon.replace("$1",e),[{text:P.ui.accept,nocombat:!0,remaining:20,fun:()=>{yt("summonaccept",e)}},{text:P.ui.decline,fun:()=>{}}])}).set(27,t=>{let e=Xo(t,1);Ta(P.ui.party.invite,P.ui.party.onInvite.replace("$1",e),[{text:P.ui.accept,fun:()=>{yt("partyaccept",t[0]+"")}},{text:P.ui.decline,fun:()=>{yt("partydecline",t[0]+"")}}])}).set(29,t=>{I.player.inventory.setItem(t[0],t[1],t[2])}).set(30,t=>{I.player.inventory.removeItem(t[0],t[1])}).set(31,t=>{I.player.inventory.setGold(t[0],t[1],t[2])}).set(32,t=>{I.player.inventory.setMedals(t[0],t[1],t[2])}).set(33,t=>{Oi.set(t[0]),hu(t[0],t[1],12,"$sp")}).set(34,t=>{bm.set(t[0]==0?void 0:t[0]-1)}).set(51,t=>{ym.set(t[0]==0?void 0:t[0]-1)}).set(35,t=>{ds.set(t[0]),t[0]&&xt(106)}).set(36,t=>{wm.set(t.pop()),wB(t,pa)}).set(37,t=>{Vr.update(e=>!e),Nt("inv",P.ui.merchant.auctioncancel,!0)}).set(38,t=>{let e=t.slice(2),n=[],o=[],s=[],i=[],r=[n,s,o],l=0,a=0,c=n;for(let f=0;f<e.length;f++)if(a===0)a=e[f],c=r[l],++l;else{let u=new Ss(e[f]);i.push(u),c.push(u),--a}Mm.set({self:n,other:o,nonOrAcc:s,all:i}),t[0]&&xt(107),zo.set({gold:t[1]})}).set(39,t=>{zo.set({gold:t[0]})}).set(40,t=>{zo.set(!1)}).set(41,t=>{Jo.set(!0),xt(108),an(19,100)}).set(42,t=>{Jo.set(!1)}).set(43,t=>{Xs.set(!0)}).set(44,t=>{Xs.set(!1)}).set(54,t=>{let e=I.entity(t[0]);e!==void 0&&(e.party=1)}).set(55,t=>{window.open("/leaderboards?mode=1&kill="+t[0],"_blank")}).set(56,t=>{Ad()}).set(58,t=>{fe.msgFriendOnlineStatus&&Nt("social",`${Xo(t,0)} has come online.`),pi.set(!0)}).set(59,t=>{pi.set(!0)}).set(60,t=>{pi.set(!0),Nt("social",`${Xo(t,0)} has sent you a friend request.`)}).set(61,t=>{pi.set(!0),Nt("social",`${Xo(t,0)} has accepted your friend request.`)}).set(53,t=>{let e=t[0];e<1e3&&e>0&&Dr.set({type:"error",timer:500,text:e}),e<=5&&e>0?xt(109):e===0?xt(110):e===1e3?xt(111):e===2e3&&xt(112)});var wB=(t,e)=>{e.update(n=>(n.length=0,t.forEach(o=>{n.push(new Ss(o))}),n))},t7=(t,e)=>{I.player&&e7.get(t)(e)},n7=new Map;n7.set(0,(t,e,n)=>{}).set(1,(t,e,n)=>{I.removeEntity(t)}).set(2,(t,e,n)=>{e[1]>0&&e[1]!==t.target&&t.visual&&t.type!==0&&t.visual.onAggro(),t===I.player&&Lg(e[1])}).set(3,(t,e,n)=>{for(let o=1;o<e.length;o+=2)t.stats.setResource(e[o],e[o+1])}).set(6,(t,e,n)=>{for(let o=1;o<e.length;o+=2)t.stats.setResource(e[o],e[o+1])}).set(4,(t,e,n)=>{for(let o=1;o<e.length;o+=2)t.stats.setStat(e[o],e[o+1])}).set(5,(t,e,n)=>{if(t==I.player&&(an(3,100),t.skills.cd(e[1],I.time,wo(e[2])),e[5]>0&&t.skills.globalCd(wo(e[4]),wo(e[5]))),!n&&t.visual&&!t.visual.inFog){let s=At.get(e[1]);(!s.castLen||!t.visual.currentAnim)&&s.fx.animCast&&t.visual.anim(s.fx.animCast),t.visual.onYell()}}).set(22,(t,e,n)=>{t.skills.startTimedCast(At.get(e[1]),wo(e[2]),e[3],wo(e[4])),e[5]>0&&t.skills.globalCd(wo(e[2]),wo(e[5]))}).set(23,(t,e,n)=>{t.skills.interruptTimedCast(!0,e[1]===1)}).set(24,(t,e,n)=>{t.skills.finishTimedCast(wo(e[1]))}).set(7,(t,e,n)=>{let o=e[1],s=e[2],i=I.getEntityById(e[3]),r=e[4],l=e[5],a=e[6],c=e[7];i!==void 0&&fe.dpsmeterMode===0&&Sd(i,o,s);let f=t===I.player,u=i===I.player;f?fe.showIncomingDamage&&I_([-.3,-.3,.5],o,l,a,!0,0):u&&I_(t.visualPosition,o,l,a,!1,2),l>0&&t.stats.changeResource(6,-o),c>0&&(t.stats.refreshCombatTimer(I.time,c),i&&i.stats.refreshCombatTimer(I.time,c));let m=At.get(s);if(!n&&l>0&&t.visual&&!t.visual.inFog){let g=r>0&&Sr.has(r)?Sr.get(r).effect.transform:i&&i.visual&&i.visual.transform,v=t.visual.transform;i&&i.visual&&m.fx.animImpact&&i.visual.anim(m.fx.animImpact,!1,t.id),l!==1?(t.visual.onHurt(o/t.stats.getStat(6),l),g&&W_(m,g,v,t.radius,u?1:0)):g&&(m.fx.effectDirImpact||m.fx.animImpact)&&s7(13,g,v,t.radius,u?1:0)}}).set(8,(t,e,n)=>{let o=I.getEntityById(e[3]);o!==void 0&&fe.dpsmeterMode===1&&Sd(o,e[1],e[2]),o&&e[5]>0&&o.stats.refreshCombatTimer(I.time,e[5]);let s=t===I.player,i=o===I.player;s?fe.showIncomingHeal&&D_([.3,-.3,.5],e[1],e[4],!0,0):i&&D_(t.visualPosition,e[1],e[4],!1,2),t.stats.changeResource(6,e[1]);let r=At.get(e[2]);!n&&o&&o.visual&&t.visual&&!t.visual.inFog&&W_(r,o.visual.transform,t.visual.transform,t.radius,s||i?1:0)}).set(9,(t,e,n)=>{t.stats.changeResource(7,e[1]);let o=I.getEntityById(e[3]),s=t===I.player;s&&fe.showIncomingHeal&&ZP([.35,-.2,.5],e[1],e[4],!0,0);let i=At.get(e[2]);!n&&o&&o.visual&&t.visual&&!t.visual.inFog&&!o.visual.inFog&&W_(i,o.visual.transform,t.visual.transform,t.radius,s?1:0)}).set(10,(t,e,n)=>{e[1]==0?t.stats.alive&&(t.stats.die(),t==I.player?Ta(P.ui.death.death,P.ui.death.deathmsg,[{text:P.ui.death.respawn,blockedTime:Math.max(0,Math.ceil(e[2]-I.time)+1),fun:()=>{yt("respawn","")}}]):I.player&&t.id==zn&&an(4,100)):t.stats.alive||t.stats.respawn()}).set(11,(t,e,n)=>{t.setFaction(e[1])}).set(14,(t,e,n)=>{t.setLevel(e[1])}).set(16,(t,e,n)=>{t.setClass(e[1])}).set(12,(t,e,n)=>{t.setName(Xo(e,1))}).set(13,(t,e,n)=>{t.setClan(e.length>2?Xo(e,2):void 0,e[1])}).set(15,(t,e,n)=>{t.setLevel(e[1]);let o=`${t==I.player?"You":MB(e[0])} leveled up to ${e[1]}!`;Nt("lvlup",o),t==I.player&&(an(13,100),At.forEach(s=>{s.class===I.player.class&&s.minlevel===e[1]&&(an(16,100),KA(`<span class=textprimary><b class=textgreen>${P.items.book[s.id].name}</b><br>Skill book available at the Trader!</span>`,`skills/${s.id}.${Yn}`,"border primary"))})),t.visual&&!t.visual.inFog&&Ts(26,t.visual.transform,t==I.player?1:0,!1)}).set(17,(t,e,n)=>{t.buffs.setBuff(e[1],e[2],e[3],wo(e[4]),wo(e[5]),e[6],e[7],e.length>8?e.slice(8):void 0)}).set(19,(t,e,n)=>{e[2]===I.playerId&&QP(t.visualPosition,2,!1)}).set(18,(t,e,n)=>{t.buffs.removeBuff(e[1],e[2])}).set(20,(t,e,n)=>{let o=At.get(e[1]),s=new kt(I.time,wo(e[4])-I.time+.2);X8(e[0],e[2],o,e[3],s)}).set(21,(t,e,n)=>{let o=At.get(e[1]),s=e[2],i=wo(e[3])-I.time,r=new kt(I.time,i),l=4,a=e.length-l,c=a>6?2+(a-6)/4:2,f=[],u=[];for(let m=l;m<l+c*3;m+=3)f.push([Md(e[m],6400),Md(e[m+1],6400),Md(e[m+2],6400)]);if(c>2)for(let m=l+c*3;m<e.length;++m)u.push(e[m]/65535);Q8(t.id,f,u,o,s,r)}).set(25,(t,e,n)=>{t.setParty(e[1],e[2])}).set(26,(t,e,n)=>{t.hasInfo===!1&&t.setDropInfo(e[1],e[2],e[3],e[4],e[5])}).set(27,(t,e,n)=>{t.setNodeInfo(e[1],e[2],e[3])}).set(28,(t,e,n)=>{t.setPosLock(e[1],e[2],e[3])});var o7=(t,e,n)=>{let o=I.getEntityById(e[0]);o===void 0||n7.get(t)(o,e,n)},MB=t=>{let e=I.getEntityById(t);return`${t>0?e?e.name:"unknown":"nobody"}`},s7=(t,e,n,o,s)=>{let i=Ts(t,sn(),s,!0);qm(i.transform,n,e,o),Bt(i.transform,!1)},W_=(t,e,n,o,s)=>{if(t.fx.effectDirImpact&&s7(t.fx.effectDirImpact,e,n,o,s),t.fx.effectImpact){let i=Ts(t.fx.effectImpact,sn(),s,!0);st(i.transform.position,n.position),Bt(i.transform,!1)}t.fx.effectTarget&&Ts(t.fx.effectTarget,n,s,!1)};var FB=[js,ds,zo,Xs,Jo],CB=[aa,pa,ui],SB=[Ws,Gs],i7=()=>{SB.forEach(t=>t.update(e=>(e.visible=!1,e))),eo.update(t=>(t.membercount=0,t.role=0,fe.partyinfo=t,t)),FB.forEach(t=>t.set()),CB.forEach(t=>t.set([]))};var hh=class extends dh{constructor(){super(),this.smoothtime=0,this.state=0,this.playerId=0,this.removePlayer(),this.netTimeoutTimer=new kt,this.chunkCache=[],Un("close",()=>{this.onDisconnect()}),this.netData=[],Un(Mt.serverEntityDelta.header,e=>{this.netData.push(Mt.serverEntityDelta.decode(e))}),Un(Mt.ping.header,e=>{B3(Mt.ping.decode(e))}),Un(Mt.serverChangeWorld.header,e=>{Or.set(Mt.serverChangeWorld.decode(e).world)}),Un(Mt.serverQueue.header,e=>{this.setState(1,"Queue Position: "+Mt.serverQueue.decode(e).pos)})}setState(e,n=""){this.state===2&&e===4&&cA(this),this.state=e,So.set(e!==4?n:!1)}handleEntityCreation(e){for(let n=0,o=e.log.length;n<o;++n){let s=e.log[n];s.type===0&&(this.isEntityIdTaken(s.data[0])||this.addEntity(this.createEntity(s.data[1],s.data[0],{creature:P1.get(s.data[2])})))}}handleEntityInput(e){for(let n=0;n<e.inputs.length;++n){let o=e.inputs[n],s=this.entity(o.id);s!==void 0&&(N3(s.steer,o.steer),s.setRot(o.rot,!0),s.setJump(o.jump),s.setSpeed(o.speed))}}handleEntityMovements(e){for(let n=0;n<e.movements.length;++n){let o=e.movements[n],s=this.entity(o.id);if(s!==void 0){let i=e.inputs[n];s.handleMovementData(o,i)}}}handleEntityLog(e){for(let o=0,s=e.log.length;o<s;++o)o7(e.log[o].type,e.log[o].data,!1)}handlePersonalLog(e){for(let n=0,o=e.logPersonal.length;n<o;++n)t7(e.logPersonal[n].type,e.logPersonal[n].data)}pollNetData(e){let n=this.netData[0];if(n!==void 0)return Math.abs(n.tickId-e)>1&&(e=this.setTimeFromTickId(n.tickId)),n.tickId<=e?(this.netData.shift(),n):void 0}tickDelta(e,n){let o=this.time+n;for(let s=this.entities.array.length-1;s>=0;--s){let i=this.entities.array[s];i.preDelta(e,o,this),i.tickDelta(e,o,this),i.postDelta(e,o,this)}}tickFixed(e,n){let o=this.pollNetData(n);if(o!==void 0&&(this.handleEntityCreation(o),this.handleEntityInput(o),this.handleEntityLog(o),this.handlePersonalLog(o),this.handleEntityMovements(o)),this.state>2)for(let s=this.entities.array.length-1;s>=0;--s){let i=this.entities.array[s],r=this.getChunkFromWorld(i.pos[0],i.pos[2]);r!==void 0&&r.state>=5&&(i.preFixed(e,this.time,this,1),i.tickFixed(e,this.time,this,1),i.postFixed(e,this.time,this,1))}this.handleNetTimeouts()}tick(e){for(this.netData.length>5&&(this.accum+=(this.netData.length-5)*this.timestep),e=Math.min(e,1),this.accum+=e;this.accum>this.timestep;)this.accum-=this.timestep,this.setTimeFromTickId(this.tickId+1),this.tickFixed(this.timestep,this.tickId);this.setSmoothTime(e),this.state>2?(this.tickDelta(e,this.accum),z3()):this.player&&st(Yt.position,this.player.pos),this.player&&this.manageChunks(e)}handleNetTimeouts(){if(this.player&&(this.netTimeoutTimer.done(this.time)||this.time<this.netTimeoutTimer.start)){this.netTimeoutTimer.reset(this.time-.5,1);for(let e=this.entities.array.length-1;e>=0;e--){let n=this.entities.array[e];n!==this.player&&(oo(n.pos,this.player.pos)<14400?n.netDeletion.reset(this.time,2):n.netDeletion.end>0&&n.netDeletion.done(this.time)&&(this.removeEntity(n),n.id===this.player.target&&this.player.setTarget(0)))}}}removeEntity(e){let n=super.removeEntity(e);return n&&this.state>2&&v1(e),n}load(e,n,o){this.destroy(),super.load(e,n),this.playerId=o,this.setState(2,"Loading World")}parse(e){super.parse(e),HP(this,!e)}onDisconnect(){ag(),this.netData.length=0,this.setState(0,"Loading World")}destroy(){this.setState(0,"Loading World");for(let e=0;e<this.chunksArray.length;e++){let n=this.chunksArray[e];this.returnCachedChunk(n),T_(n)}this.chunksMap.clear(),this.chunksArray.length=0;for(let e=this.entities.array.length-1;e>=0;e--)this.removeEntity(this.entities.array[e]);this.data=void 0,this.bounds=1,this.triangleGrid.clear(),YP(this),fA(this)}setPlayer(e){this.player=e,Wc.set(!0),i7()}removePlayer(e){this.player===e&&(this.player=void 0,this.playerId=0,Wc.set(!1),Hs.set(),Ys.set(!1))}setSmoothTime(e){let n=this.smoothtime-this.time;Math.abs(n)>1?this.smoothtime=this.time:n>.05?this.smoothtime+=e*.5:n<-.05?this.smoothtime+=e*2:this.smoothtime+=e}getInteriorLight(e,n){let o=this.triangleGrid.queryAABB(n);for(let s=0;s<o.length;++s)if(o[s].length>4){$r(e,o[s][4]);return}so(e,0,0,0,0)}createChunks(){}createCachedChunk(e,n,o){if(this.chunkCache.length){let s=this.chunkCache.pop();return P_(s,e,n,o,this.chunkAmount),s}else{let s=DP();return P_(s,e,n,o,this.chunkAmount),s}}returnCachedChunk(e){this.chunkCache.push(e)}manageChunks(e){BS(e,this.chunkAmount);let n=0,o=!1,s=5,i=s*3,r=0;for(;n<Pl.length&&!(r>=s);){let a=Pl[n],c=Pl[n+1],f=Pl[n+2];if(this.chunksMap.has(a))this.chunksMap.get(a).state<3&&(n<i&&(o=!0),r++);else{let u=this.createCachedChunk(a,c,f);this.addChunk(u),u.state=1,n<i&&(o=!0),r++}n+=3}let l=[];for(let a=0;a<this.chunksArray.length;++a){let c=this.chunksArray[a];a_&&(c.x+5<Gd||c.z+5<Yd||c.x-5>Hd||c.z-5>Xd?l.push(c):A_(c)),LP(c,this)}for(let a=l.length-1;a>=0;a--){let c=l[a];this.returnCachedChunk(c),this.removeChunk(c),T_(c)}o!==(this.state!==4)&&this.setState(o?3:4,"Loading World")}};window.onload=async()=>{console.log("Hordes 0.51.8738 Live"),await D1();let t=await fetch("data/game/game.bin?v=8738303");x1(Sa.gamedata.decode(new Uint8Array(await t.arrayBuffer()))),Ay(),OP(),iA(),new TS({target:document.querySelector("body")}),q3(vA,_A),A3(new hh({})),$_(!0),l7()};var r7=0,l7=()=>{let t=Tf(),e=(t-(r7||1e3/60))/1e3;r7=t,bA(e,t),requestAnimationFrame(l7)};})();
