(()=>{var DP=Object.defineProperty;var Xn=(t,e)=>{for(var n in e)DP(t,n,{get:e[n],enumerable:!0})};function ce(){}var wr=t=>t;function ja(t,e){for(let n in e)t[n]=e[n];return t}function ah(t){return t()}function Wu(){return Object.create(null)}function ut(t){t.forEach(ah)}function To(t){return typeof t=="function"}function $e(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}var ju;function at(t,e){return t===e?!0:(ju||(ju=document.createElement("a")),ju.href=e,t===ju.href)}function Fn(t,e){return t!=t?e==e:t!==e}function B2(t){return Object.keys(t).length===0}function as(t,...e){if(t==null){for(let i of e)i(void 0);return ce}let n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function se(t,e,n){t.$$.on_destroy.push(as(e,n))}function Wa(t,e,n,i){if(t){let s=z2(t,e,n,i);return t[0](s)}}function z2(t,e,n,i){return t[1]&&i?ja(n.ctx.slice(),t[1](i(e))):n.ctx}function Ga(t,e,n,i){if(t[2]&&i){let s=t[2](i(n));if(e.dirty===void 0)return s;if(typeof s=="object"){let o=[],r=Math.max(e.dirty.length,s.length);for(let a=0;a<r;a+=1)o[a]=e.dirty[a]|s[a];return o}return e.dirty|s}return e.dirty}function Ha(t,e,n,i,s,o){if(s){let r=z2(e,n,i,o);t.p(r,s)}}function Ya(t){if(t.ctx.length>32){let e=[],n=t.ctx.length/32;for(let i=0;i<n;i++)e[i]=-1;return e}return-1}function Eo(t){return t??""}function nt(t,e,n){return t.set(n),e}var $2=typeof window<"u",Gu=$2?()=>window.performance.now():()=>Date.now(),Cc=$2?t=>requestAnimationFrame(t):ce;var Xa=new Set;function U2(t){Xa.forEach(e=>{e.c(t)||(Xa.delete(e),e.f())}),Xa.size!==0&&Cc(U2)}function Hu(t){let e;return Xa.size===0&&Cc(U2),{promise:new Promise(n=>{Xa.add(e={c:t,f:n})}),abort(){Xa.delete(e)}}}var Sc=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var Yu=class t{_listeners="WeakMap"in Sc?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,n){return this._listeners.set(e,n),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(e=>{for(let n of e)t.entries.set(n.target,n),this._listeners.get(n.target)?.(n)}))}};Yu.entries="WeakMap"in Sc?new WeakMap:void 0;var O2=!1;function N2(){O2=!0}function j2(){O2=!1}function d(t,e){t.appendChild(e)}function lh(t){if(!t)return document;let e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function W2(t){let e=h("style");return e.textContent="/* empty */",VP(lh(t),e),e.sheet}function VP(t,e){return d(t.head||t,e),e.sheet}function x(t,e,n){t.insertBefore(e,n||null)}function k(t){t.parentNode&&t.parentNode.removeChild(t)}function it(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function LP(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function T(t){return document.createTextNode(t)}function Ue(){return T(" ")}function ge(){return T("")}function Q(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function m(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function jt(t){return t===""?null:+t}function G2(t){return Array.from(t.childNodes)}function G(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ge(t,e){t.value=e??""}function Pe(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,i?"important":"")}function xn(t,e,n){for(let i=0;i<t.options.length;i+=1){let s=t.options[i];if(s.__value===e){s.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function ki(t){let e=t.querySelector(":checked");return e&&e.__value}function Do(t,e,n){t.classList.toggle(e,!!n)}function Ac(t,e,{bubbles:n=!1,cancelable:i=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:i})}var Xu=class{is_svg=!1;e=void 0;n=void 0;t=void 0;a=void 0;constructor(e=!1){this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,n,i=null){this.e||(this.is_svg?this.e=LP(n.nodeName):this.e=h(n.nodeType===11?"TEMPLATE":n.nodeName),this.t=n.tagName!=="TEMPLATE"?n:n.content,this.c(e)),this.i(i)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)x(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(k)}};function H2(t){let e={};return t.childNodes.forEach(n=>{e[n.slot||"default"]=!0}),e}var Qu=new Map,Zu=0;function qP(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function RP(t,e){let n={stylesheet:W2(e),rules:{}};return Qu.set(t,n),n}function Pc(t,e,n,i,s,o,r,a=0){let l=16.666/i,c=`{
`;for(let b=0;b<=1;b+=l){let y=e+(n-e)*o(b);c+=b*100+`%{${r(y,1-y)}}
`}let f=c+`100% {${r(n,1-n)}}
}`,u=`__svelte_${qP(f)}_${a}`,p=lh(t),{stylesheet:g,rules:v}=Qu.get(p)||RP(p,t);v[u]||(v[u]=!0,g.insertRule(`@keyframes ${u} ${f}`,g.cssRules.length));let _=t.style.animation||"";return t.style.animation=`${_?`${_}, `:""}${u} ${i}ms linear ${s}ms 1 both`,Zu+=1,u}function Ju(t,e){let n=(t.style.animation||"").split(", "),i=n.filter(e?o=>o.indexOf(e)<0:o=>o.indexOf("__svelte")===-1),s=n.length-i.length;s&&(t.style.animation=i.join(", "),Zu-=s,Zu||BP())}function BP(){Cc(()=>{Zu||(Qu.forEach(t=>{let{ownerNode:e}=t.stylesheet;e&&k(e)}),Qu.clear())})}var Io;function no(t){Io=t}function Qa(){if(!Io)throw new Error("Function called outside component initialization");return Io}function ch(t){Qa().$$.before_update.push(t)}function jn(t){Qa().$$.on_mount.push(t)}function Tc(t){Qa().$$.after_update.push(t)}function Wn(t){Qa().$$.on_destroy.push(t)}function Mr(){let t=Qa();return(e,n,{cancelable:i=!1}={})=>{let s=t.$$.callbacks[e];if(s){let o=Ac(e,n,{cancelable:i});return s.slice().forEach(r=>{r.call(t,o)}),!o.defaultPrevented}return!0}}function io(t,e){let n=t.$$.callbacks[e.type];n&&n.slice().forEach(i=>i.call(this,e))}var Fr=[];var Wt=[],Ja=[],uh=[],Y2=Promise.resolve(),ph=!1;function mh(){ph||(ph=!0,Y2.then(Ku))}function dh(){return mh(),Y2}function mn(t){Ja.push(t)}function Vo(t){uh.push(t)}var fh=new Set,Za=0;function Ku(){if(Za!==0)return;let t=Io;do{try{for(;Za<Fr.length;){let e=Fr[Za];Za++,no(e),zP(e.$$)}}catch(e){throw Fr.length=0,Za=0,e}for(no(null),Fr.length=0,Za=0;Wt.length;)Wt.pop()();for(let e=0;e<Ja.length;e+=1){let n=Ja[e];fh.has(n)||(fh.add(n),n())}Ja.length=0}while(Fr.length);for(;uh.length;)uh.pop()();ph=!1,fh.clear(),no(t)}function zP(t){if(t.fragment!==null){t.update(),ut(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(mn)}}function X2(t){let e=[],n=[];Ja.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),Ja=e}var Ec;function Q2(){return Ec||(Ec=Promise.resolve(),Ec.then(()=>{Ec=null})),Ec}function Dc(t,e,n){t.dispatchEvent(Ac(`${e?"intro":"outro"}${n}`))}var ep=new Set,Ls;function Te(){Ls={r:0,c:[],p:Ls}}function Ee(){Ls.r||ut(Ls.c),Ls=Ls.p}function P(t,e){t&&t.i&&(ep.delete(t),t.i(e))}function I(t,e,n,i){if(t&&t.o){if(ep.has(t))return;ep.add(t),Ls.c.push(()=>{ep.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}var Z2={duration:0};function J2(t,e,n){let i={direction:"out"},s=e(t,n,i),o=!0,r,a=Ls;a.r+=1;let l;function c(){let{delay:f=0,duration:u=300,easing:p=wr,tick:g=ce,css:v}=s||Z2;v&&(r=Pc(t,1,0,u,f,p,v));let _=Gu()+f,b=_+u;mn(()=>Dc(t,!1,"start")),"inert"in t&&(l=t.inert,t.inert=!0),Hu(y=>{if(o){if(y>=b)return g(0,1),Dc(t,!1,"end"),--a.r||ut(a.c),!1;if(y>=_){let w=p((y-_)/u);g(1-w,w)}}return o})}return To(s)?Q2().then(()=>{s=s(i),c()}):c(),{end(f){f&&"inert"in t&&(t.inert=l),f&&s.tick&&s.tick(1,0),o&&(r&&Ju(t,r),o=!1)}}}function Ka(t,e,n,i){let o=e(t,n,{direction:"both"}),r=i?0:1,a=null,l=null,c=null,f;function u(){c&&Ju(t,c)}function p(v,_){let b=v.b-r;return _*=Math.abs(b),{a:r,b:v.b,d:b,duration:_,start:v.start,end:v.start+_,group:v.group}}function g(v){let{delay:_=0,duration:b=300,easing:y=wr,tick:w=ce,css:C}=o||Z2,A={start:Gu()+_,b:v};v||(A.group=Ls,Ls.r+=1),"inert"in t&&(v?f!==void 0&&(t.inert=f):(f=t.inert,t.inert=!0)),a||l?l=A:(C&&(u(),c=Pc(t,r,v,b,_,y,C)),v&&w(0,1),a=p(A,b),mn(()=>Dc(t,v,"start")),Hu(M=>{if(l&&M>l.start&&(a=p(l,b),l=null,Dc(t,a.b,"start"),C&&(u(),c=Pc(t,r,a.b,a.duration,0,y,o.css))),a){if(M>=a.end)w(r=a.b,1-r),Dc(t,a.b,"end"),l||(a.b?u():--a.group.r||ut(a.group.c)),a=null;else if(M>=a.start){let F=M-a.start;r=a.a+a.d*y(F/a.duration),w(r,1-r)}}return!!(a||l)}))}return{run(v){To(o)?Q2().then(()=>{o=o({direction:v?"in":"out"}),g(v)}):g(v)},end(){u(),a=l=null}}}function pe(t){return t?.length!==void 0?t:Array.from(t)}function K2(t,e){t.d(1),e.delete(t.key)}function Ii(t,e){I(t,1,1,()=>{e.delete(t.key)})}function ui(t,e,n,i,s,o,r,a,l,c,f,u){let p=t.length,g=o.length,v=p,_={};for(;v--;)_[t[v].key]=v;let b=[],y=new Map,w=new Map,C=[];for(v=g;v--;){let V=u(s,o,v),L=n(V),q=r.get(L);q?i&&C.push(()=>q.p(V,e)):(q=c(L,V),q.c()),y.set(L,b[v]=q),L in _&&w.set(L,Math.abs(v-_[L]))}let A=new Set,M=new Set;function F(V){P(V,1),V.m(a,f),r.set(V.key,V),f=V.first,g--}for(;p&&g;){let V=b[g-1],L=t[p-1],q=V.key,R=L.key;V===L?(f=V.first,p--,g--):y.has(R)?!r.has(q)||A.has(q)?F(V):M.has(R)?p--:w.get(q)>w.get(R)?(M.add(q),F(V)):(A.add(R),p--):(l(L,r),p--)}for(;p--;){let V=t[p];y.has(V.key)||l(V,r)}for(;g;)F(b[g-1]);return ut(C),b}function tp(t,e){let n={},i={},s={$$scope:1},o=t.length;for(;o--;){let r=t[o],a=e[o];if(a){for(let l in r)l in a||(i[l]=1);for(let l in a)s[l]||(n[l]=a[l],s[l]=1);t[o]=a}else for(let l in r)s[l]=1}for(let r in i)r in n||(n[r]=void 0);return n}function np(t){return typeof t=="object"&&t!==null?t:{}}var $P=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],UP=new Set([...$P]);function Lo(t,e,n){let i=t.$$.props[e];i!==void 0&&(t.$$.bound[i]=n,n(t.$$.ctx[i]))}function te(t){t&&t.c()}function K(t,e,n){let{fragment:i,after_update:s}=t.$$;i&&i.m(e,n),mn(()=>{let o=t.$$.on_mount.map(ah).filter(To);t.$$.on_destroy?t.$$.on_destroy.push(...o):ut(o),t.$$.on_mount=[]}),s.forEach(mn)}function ee(t,e){let n=t.$$;n.fragment!==null&&(X2(n.after_update),ut(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function NP(t,e){t.$$.dirty[0]===-1&&(Fr.push(t),mh(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ce(t,e,n,i,s,o,r=null,a=[-1]){let l=Io;no(t);let c=t.$$={fragment:null,ctx:[],props:o,update:ce,not_equal:s,bound:Wu(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Wu(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};r&&r(c.root);let f=!1;if(c.ctx=n?n(t,e.props||{},(u,p,...g)=>{let v=g.length?g[0]:p;return c.ctx&&s(c.ctx[u],c.ctx[u]=v)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](v),f&&NP(t,u)),p}):[],c.update(),f=!0,ut(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){N2();let u=G2(e.target);c.fragment&&c.fragment.l(u),u.forEach(k)}else c.fragment&&c.fragment.c();e.intro&&P(t.$$.fragment),K(t,e.target,e.anchor),j2(),Ku()}no(l)}var jP;typeof HTMLElement=="function"&&(jP=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(t,e,n){super(),this.$$ctor=t,this.$$s=e,n&&this.attachShadow({mode:"open"})}addEventListener(t,e,n){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let i=this.$$c.$on(t,e);this.$$l_u.set(e,i)}super.addEventListener(t,e,n)}removeEventListener(t,e,n){if(super.removeEventListener(t,e,n),this.$$c){let i=this.$$l_u.get(e);i&&(i(),this.$$l_u.delete(e))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(s){return()=>{let o;return{c:function(){o=h("slot"),s!=="default"&&m(o,"name",s)},m:function(l,c){x(l,o,c)},d:function(l){l&&k(o)}}}};if(await Promise.resolve(),!this.$$cn)return;let e={},n=H2(this);for(let s of this.$$s)s in n&&(e[s]=[t(s)]);for(let s of this.attributes){let o=this.$$g_p(s.name);o in this.$$d||(this.$$d[o]=hh(o,s.value,this.$$p_d,"toProp"))}for(let s in this.$$p_d)!(s in this.$$d)&&this[s]!==void 0&&(this.$$d[s]=this[s],delete this[s]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});let i=()=>{this.$$r=!0;for(let s in this.$$p_d)if(this.$$d[s]=this.$$c.$$.ctx[this.$$c.$$.props[s]],this.$$p_d[s].reflect){let o=hh(s,this.$$d[s],this.$$p_d,"toAttribute");o==null?this.removeAttribute(this.$$p_d[s].attribute||s):this.setAttribute(this.$$p_d[s].attribute||s,o)}this.$$r=!1};this.$$c.$$.after_update.push(i),i();for(let s in this.$$l)for(let o of this.$$l[s]){let r=this.$$c.$on(s,o);this.$$l_u.set(o,r)}this.$$l={}}}attributeChangedCallback(t,e,n){this.$$r||(t=this.$$g_p(t),this.$$d[t]=hh(t,n,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{this.$$cn||(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function hh(t,e,n,i){let s=n[t]?.type;if(e=s==="Boolean"&&typeof e!="boolean"?e!=null:e,!i||!n[t])return e;if(i==="toAttribute")switch(s){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(s){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var we=class{$$=void 0;$$set=void 0;$destroy(){ee(this,1),this.$destroy=ce}$on(e,n){if(!To(n))return ce;let i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{let s=i.indexOf(n);s!==-1&&i.splice(s,1)}}$set(e){this.$$set&&!B2(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var e_="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(e_);var el=[];function ne(t,e=ce){let n,i=new Set;function s(a){if($e(t,a)&&(t=a,n)){let l=!el.length;for(let c of i)c[1](),el.push(c,t);if(l){for(let c=0;c<el.length;c+=2)el[c][0](el[c+1]);el.length=0}}}function o(a){s(a(t))}function r(a,l=ce){let c=[a,l];return i.add(c),i.size===1&&(n=e(s,o)||ce),a(t),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:r}}var Ic=ne([]),Qn=ne({role:0,nearby:0,exprate:1,itemfind:1,queues:[],membercount:0}),ip=ne({parties:[],filterActivity:-1}),Gi=ne({flashing:!1,message:"",activity:0,listed:!1,applications:[]}),tl=ne([]),wn=ne(),so=ne([]),Cr=ne({}),qs=ne(),sp=ne(!1),t_=ne(),n_=ne(!1),xi=ne("Loading World"),Vc=ne([]),Rs=ne({}),Bs=ne({}),Lc=ne([]),nl=ne([]),Pn=ne(),op=ne("auto"),Hi=ne(0),il=ne(0),qo=ne(0),sl=ne([]),ol=ne({}),Ro=ne({}),rp=ne({current:0,max:1}),ap=ne(),lp=ne(),qc=ne(!1),cp=ne(0),fp=ne([0,0]),oo=ne(),zs=ne(),$s=ne(!1),Rc=ne(new Map),Bo=ne(new Map),Bc=ne(),zo=ne(),ls=ne(),rl=ne([]),cs=ne(),up=ne(0),Sr=ne(!1),Ar=ne(!1),Vi=ne(),pp=ne([]),Yi=ne(),Us=ne(),$o=ne(),al=ne(),Uo=ne({}),zc=ne({}),mp=ne({}),dp=ne({}),hp=ne(),ll=ne(),wi=[];function WP(t){let e;return{c(){e=h("div"),e.innerHTML='<div class="bounce1 svelte-twvoek"></div><div class="bounce2 svelte-twvoek"></div><div class="bounce3 svelte-twvoek"></div>',m(e,"class","spinner svelte-twvoek")},m(n,i){x(n,e,i)},p:ce,i:ce,o:ce,d(n){n&&k(e)}}}var gh=class extends we{constructor(e){super(),Ce(this,e,null,WP,Fn,{})}},i_=gh;function Pr(t,{delay:e=0,duration:n=400,easing:i=wr}={}){let s=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:i,css:o=>`opacity: ${o*s}`}}function s_(t){let e,n,i,s,o,r;return n=new i_({}),{c(){e=h("div"),te(n.$$.fragment),i=h("h2"),s=T(t[0]),o=h("small"),o.innerHTML='<img alt="Hordes.io" class="svgicon" src="/data/ui/icon.svg?v=8582889"/> 0.50.8582 Live',Pe(i,"margin-top","100px"),m(o,"class","version textgrey textcenter svelte-aoht7k"),m(e,"class","l-ui container svelte-aoht7k")},m(a,l){x(a,e,l),K(n,e,null),d(e,i),d(i,s),d(e,o),r=!0},p(a,l){(!r||l&1)&&G(s,a[0])},i(a){r||(P(n.$$.fragment,a),r=!0)},o(a){I(n.$$.fragment,a),r=!1},d(a){a&&k(e),ee(n)}}}function GP(t){let e,n,i=t[0]&&s_(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=s_(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function HP(t,e,n){let{active:i}=e;return t.$$set=s=>{"active"in s&&n(0,i=s.active)},[i]}var vh=class extends we{constructor(e){super(),Ce(this,e,HP,GP,$e,{active:0})}},o_=vh;function fs(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function r_(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _h(t,e){let n=e[0],i=e[1],s=e[2],o=e[3],r=e[4],a=e[5],l=e[6],c=e[7],f=e[8],u=e[9],p=e[10],g=e[11],v=e[12],_=e[13],b=e[14],y=e[15],w=n*a-i*r,C=n*l-s*r,A=n*c-o*r,M=i*l-s*a,F=i*c-o*a,V=s*c-o*l,L=f*_-u*v,q=f*b-p*v,R=f*y-g*v,z=u*b-p*_,E=u*y-g*_,W=p*y-g*b,j=w*W-C*E+A*z+M*R-F*q+V*L;return j?(j=1/j,t[0]=(a*W-l*E+c*z)*j,t[1]=(s*E-i*W-o*z)*j,t[2]=(_*V-b*F+y*M)*j,t[3]=(p*F-u*V-g*M)*j,t[4]=(l*R-r*W-c*q)*j,t[5]=(n*W-s*R+o*q)*j,t[6]=(b*A-v*V-y*C)*j,t[7]=(f*V-p*A+g*C)*j,t[8]=(r*E-a*R+c*L)*j,t[9]=(i*R-n*E-o*L)*j,t[10]=(v*F-_*A+y*w)*j,t[11]=(u*A-f*F-g*w)*j,t[12]=(a*q-r*z-l*L)*j,t[13]=(n*z-i*q+s*L)*j,t[14]=(_*C-v*M-b*w)*j,t[15]=(f*M-u*C+p*w)*j,t):null}function gp(t,e,n){let i=e[0],s=e[1],o=e[2],r=e[3],a=e[4],l=e[5],c=e[6],f=e[7],u=e[8],p=e[9],g=e[10],v=e[11],_=e[12],b=e[13],y=e[14],w=e[15],C=n[0],A=n[1],M=n[2],F=n[3];return t[0]=C*i+A*a+M*u+F*_,t[1]=C*s+A*l+M*p+F*b,t[2]=C*o+A*c+M*g+F*y,t[3]=C*r+A*f+M*v+F*w,C=n[4],A=n[5],M=n[6],F=n[7],t[4]=C*i+A*a+M*u+F*_,t[5]=C*s+A*l+M*p+F*b,t[6]=C*o+A*c+M*g+F*y,t[7]=C*r+A*f+M*v+F*w,C=n[8],A=n[9],M=n[10],F=n[11],t[8]=C*i+A*a+M*u+F*_,t[9]=C*s+A*l+M*p+F*b,t[10]=C*o+A*c+M*g+F*y,t[11]=C*r+A*f+M*v+F*w,C=n[12],A=n[13],M=n[14],F=n[15],t[12]=C*i+A*a+M*u+F*_,t[13]=C*s+A*l+M*p+F*b,t[14]=C*o+A*c+M*g+F*y,t[15]=C*r+A*f+M*v+F*w,t}function fl(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function a_(t,e){let n=e[0],i=e[1],s=e[2],o=e[4],r=e[5],a=e[6],l=e[8],c=e[9],f=e[10];return t[0]=Math.sqrt(n*n+i*i+s*s),t[1]=Math.sqrt(o*o+r*r+a*a),t[2]=Math.sqrt(l*l+c*c+f*f),t}function l_(t){let e=t[0],n=t[1],i=t[2],s=t[4],o=t[5],r=t[6],a=t[8],l=t[9],c=t[10],f=e*e+n*n+i*i,u=s*s+o*o+r*r,p=a*a+l*l+c*c;return Math.sqrt(Math.max(f,u,p))}function vp(t,e){let n=e[0]+e[5]+e[10],i=0;return n>0?(i=Math.sqrt(n+1)*2,t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=Math.sqrt(1+e[0]-e[5]-e[10])*2,t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=Math.sqrt(1+e[5]-e[0]-e[10])*2,t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=Math.sqrt(1+e[10]-e[0]-e[5])*2,t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function _p(t,e,n,i){let s=e[0],o=e[1],r=e[2],a=e[3],l=s+s,c=o+o,f=r+r,u=s*l,p=s*c,g=s*f,v=o*c,_=o*f,b=r*f,y=a*l,w=a*c,C=a*f,A=i[0],M=i[1],F=i[2];return t[0]=(1-(v+b))*A,t[1]=(p+C)*A,t[2]=(g-w)*A,t[3]=0,t[4]=(p-C)*M,t[5]=(1-(u+b))*M,t[6]=(_+y)*M,t[7]=0,t[8]=(g+w)*F,t[9]=(_-y)*F,t[10]=(1-(u+v))*F,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function c_(t,e,n,i,s){let o=1/Math.tan(e/2),r=1/(i-s);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(s+i)*r,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*s*i*r,t[15]=0,t}function f_(t,e,n,i,s,o,r){let a=1/(e-n),l=1/(i-s),c=1/(o-r);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(s+i)*l,t[14]=(r+o)*c,t[15]=1,t}function bh(t,e,n,i){let s=e[0],o=e[1],r=e[2],a=i[0],l=i[1],c=i[2],f=s-n[0],u=o-n[1],p=r-n[2],g=f*f+u*u+p*p;g>0&&(g=1/Math.sqrt(g),f*=g,u*=g,p*=g);let v=l*p-c*u,_=c*f-a*p,b=a*u-l*f;return g=v*v+_*_+b*b,g>0&&(g=1/Math.sqrt(g),v*=g,_*=g,b*=g),t[0]=v,t[1]=_,t[2]=b,t[3]=0,t[4]=u*b-p*_,t[5]=p*v-f*b,t[6]=f*_-u*v,t[7]=0,t[8]=f,t[9]=u,t[10]=p,t[11]=0,t[12]=s,t[13]=o,t[14]=r,t[15]=1,t}function u_(t,e){return t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0),t}function pi(t){let e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)}function st(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Y(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function mi(t,e){return t[0]=e,t[1]=e,t[2]=e,t}function Ln(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Jn(t,e,n,i){return t[0]+=e,t[1]+=n,t[2]+=i,t}function Xt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function hn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function sn(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t}function Er(t,e){let n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(n*n+i*i+s*s)}function Kn(t,e){let n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return n*n+i*i+s*s}function $c(t){let e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function bp(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Zn(t,e){let n=e[0],i=e[1],s=e[2],o=n*n+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function dn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Xi(t,e,n){let i=e[0],s=e[1],o=e[2],r=n[0],a=n[1],l=n[2];return t[0]=s*l-o*a,t[1]=o*r-i*l,t[2]=i*a-s*r,t}function ul(t,e,n,i){let s=e[0],o=e[1],r=e[2];return t[0]=s+i*(n[0]-s),t[1]=o+i*(n[1]-o),t[2]=r+i*(n[2]-r),t}function Mi(t,e,n){let i=e[0],s=e[1],o=e[2],r=n[3]*i+n[7]*s+n[11]*o+n[15];return r=r||1,t[0]=(n[0]*i+n[4]*s+n[8]*o+n[12])/r,t[1]=(n[1]*i+n[5]*s+n[9]*o+n[13])/r,t[2]=(n[2]*i+n[6]*s+n[10]*o+n[14])/r,t}function Dr(t,e,n,i,s){return t[0]=s[0]*e+s[4]*n+s[8]*i+s[12],t[1]=s[1]*e+s[5]*n+s[9]*i+s[13],t[2]=s[2]*e+s[6]*n+s[10]*i+s[14],t}function yp(t,e,n,i,s){return t[0]=s[0]*e+s[4]*n+s[8]*i,t[1]=s[1]*e+s[5]*n+s[9]*i,t[2]=s[2]*e+s[6]*n+s[10]*i,t}function yh(t,e,n){let i=e[0],s=e[1],o=e[2],r=n[0],a=n[1],l=n[2],c=n[3],f=a*o-l*s,u=l*i-r*o,p=r*s-a*i,g=a*p-l*u,v=l*f-r*p,_=r*u-a*f,b=c*2;return f*=b,u*=b,p*=b,g*=2,v*=2,_*=2,t[0]=i+f+g,t[1]=s+u+v,t[2]=o+p+_,t}var L$=function(){let t=[0,0,0],e=[0,0,0];return function(n,i){st(t,n),st(e,i),Zn(t,t),Zn(e,e);let s=dn(t,e);return s>1?0:s<-1?Math.PI:Math.acos(s)}}();function p_(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Ir(t,e,n){let i=Math.sin(n),s=Math.cos(n);return t[0]=e[2]*i+e[0]*s,t[1]=e[1],t[2]=e[2]*s-e[0]*i,t}function m_(t,e,n){let i=Math.sin(n),s=Math.cos(n);return t[0]=e[1]*i+e[0]*s,t[2]=e[1]*s-e[0]*i,t}function Vr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ei(t,e,n,i,s){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t}function d_(t,e){let n=e[0],i=e[1],s=e[2],o=e[3],r=n*n+i*i+s*s+o*o;return r>0&&(r=1/Math.sqrt(r)),t[0]=n*r,t[1]=i*r,t[2]=s*r,t[3]=o*r,t}function XP(t,e,n){n=n*.5;let i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function kh(t,e,n,i){let s=e[0],o=e[1],r=e[2],a=e[3],l=n[0],c=n[1],f=n[2],u=n[3],p,g,v,_,b;return g=s*l+o*c+r*f+a*u,g<0&&(g=-g,l=-l,c=-c,f=-f,u=-u),1-g>1e-6?(p=Math.acos(g),v=Math.sin(p),_=Math.sin((1-i)*p)/v,b=Math.sin(i*p)/v):(_=1-i,b=i),t[0]=_*s+b*l,t[1]=_*o+b*c,t[2]=_*r+b*f,t[3]=_*a+b*u,t}function QP(t,e){let n=e[0]+e[4]+e[8],i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);let o=(s+1)%3,r=(s+2)%3;i=Math.sqrt(e[s*3+s]-e[o*3+o]-e[r*3+r]+1),t[s]=.5*i,i=.5/i,t[3]=(e[o*3+r]-e[r*3+o])*i,t[o]=(e[o*3+s]+e[s*3+o])*i,t[r]=(e[r*3+s]+e[s*3+r])*i}return t}function kp(t,e){let n=Math.sin(e[0]*.5),i=Math.cos(e[0]*.5),s=Math.sin(e[1]*.5),o=Math.cos(e[1]*.5),r=Math.sin(e[2]*.5),a=Math.cos(e[2]*.5);return t[0]=n*o*a+i*s*r,t[1]=i*s*a-n*o*r,t[2]=i*o*r-n*s*a,t[3]=i*o*a+n*s*r,t}var h_=d_;var j$=function(){let t=[0,0,0],e=[1,0,0],n=[0,1,0];return function(i,s,o){let r=dn(s,o);return r<-.999999?(Xi(t,e,s),pi(t)<1e-6&&Xi(t,n,s),Zn(t,t),XP(i,t,Math.PI),i):r>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Xi(t,s,o),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+r,h_(i,i))}}(),W$=function(){let t=[0,0,0,1],e=[0,0,0,1];return function(n,i,s,o,r,a){return kh(t,i,r,a),kh(e,s,o,a),kh(n,t,e,2*a*(1-a)),n}}(),G$=function(){let t=[1,0,0,0,1,0,0,0,1];return function(e,n,i,s){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],h_(e,QP(e,t))}}();var xh=fs(),ZP=()=>({parent:null,children:[],visible:!0,geometry:void 0,matrix:fs(),worldMatrix:fs(),position:[0,0,0],scale:[1,1,1],quaternion:[-0,-0,-0,1],rotation:[-0,-0,-0],matrixAutoUpdate:!1,matrixNeedsUpdate:!0,data:{}}),Mn=(t,e,n=!0)=>{n&&t.parent!==null&&e!==t.parent&&KP(t.parent,t,!1),t.parent=e,t.matrixNeedsUpdate=!0,n&&e&&JP(e,t,!1)},JP=(t,e,n=!0)=>{~t.children.indexOf(e)||t.children.push(e),n&&Mn(e,t,!1)},KP=(t,e,n=!0)=>{~t.children.indexOf(e)&&t.children.splice(t.children.indexOf(e),1),n&&Mn(e,null,!1)},qt=(t,e)=>{if(!t.visible)return;let n=ro(t),i=eT(t,e,n);t.children.forEach(s=>{s.visible&&qt(s,i)})},ro=t=>!t.matrixAutoUpdate&&!t.matrixNeedsUpdate?!1:(t.matrixNeedsUpdate=!1,kp(t.quaternion,t.rotation),_p(t.matrix,t.quaternion,t.position,t.scale),!0),eT=(t,e,n)=>t.parent!==null?e||n?(gp(t.worldMatrix,t.parent.worldMatrix,t.matrix),!0):!1:n?(r_(t.worldMatrix,t.matrix),!0):!1,wp=(t,e,n,i)=>{let s=Xt([0,0,0],n.position,e.position);Zn(s,s),sn(t.position,e.position,s,i),t.rotation[0]=0,t.rotation[1]=Math.atan2(s[0],s[2])+1.5,t.rotation[2]=Math.sin(-s[1])+1.5,qt(t,!1)},Lr=(t,e,n=!1,i)=>{n?bh(xh,t.position,e,i):bh(xh,e,t.position,i),u_(t.rotation,xh)},xp=[],on=()=>xp.length>0?xp.pop():ZP(),us=t=>{tT(t),xp.indexOf(t)<0?xp.push(t):console.log("tried returning transform that is already known")},tT=t=>{t.data={},t.geometry=void 0,t.visible=!0,t.matrixAutoUpdate=!1,Y(t.position,0,0,0),Y(t.scale,1,1,1),Y(t.rotation,0,0,0),Mn(t,null,!0);for(let e=0;e<t.children.length;++e)Mn(t.children[e],null);t.children.length=0};var Mp=[0,0,0],Uc=(t=.1,e=100,n=45,i=1)=>{let s={near:t,far:e,fov:n,aspect:i,transform:on(),projectionMatrix:fs(),viewMatrix:fs(),unprojectionViewMatrix:fs(),projectionViewMatrix:fs(),worldPosition:[0,0,0],frustum:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],frustumConstants:[0,0,0,0,0,0]};return s.transform.matrixAutoUpdate=!0,s},Oc=t=>{c_(t.projectionMatrix,t.fov*(Math.PI/180),t.aspect,t.near,t.far)},v_=(t,e,n,i,s)=>{f_(t.projectionMatrix,e,n,i,s,t.near,t.far)},wh=t=>{fl(t.worldPosition,t.transform.worldMatrix)},pl=(t,e)=>{qt(t.transform,e),_h(t.viewMatrix,t.transform.worldMatrix),gp(t.projectionViewMatrix,t.projectionMatrix,t.viewMatrix),_h(t.unprojectionViewMatrix,t.projectionViewMatrix),wh(t)};var ao=(t,e,n)=>{let i=t.unprojectionViewMatrix,s=n[0],o=n[1],r=i[3]*s+i[7]*o+i[11]*-1+i[15];return e[0]=(i[0]*s+i[4]*o+i[8]*-1+i[12])/r,e[1]=(i[1]*s+i[5]*o+i[9]*-1+i[13])/r,e[2]=(i[2]*s+i[6]*o+i[10]*-1+i[14])/r,e},Fp=t=>{let e=t.projectionViewMatrix;Y(t.frustum[0],e[3]-e[0],e[7]-e[4],e[11]-e[8]),Y(t.frustum[1],e[3]+e[0],e[7]+e[4],e[11]+e[8]),Y(t.frustum[2],e[3]+e[1],e[7]+e[5],e[11]+e[9]),Y(t.frustum[3],e[3]-e[1],e[7]-e[5],e[11]-e[9]),Y(t.frustum[4],e[3]-e[2],e[7]-e[6],e[11]-e[10]),Y(t.frustum[5],e[3]+e[2],e[7]+e[6],e[11]+e[10]),t.frustumConstants[0]=e[15]-e[12],t.frustumConstants[1]=e[15]+e[12],t.frustumConstants[2]=e[15]+e[13],t.frustumConstants[3]=e[15]-e[13],t.frustumConstants[4]=e[15]-e[14],t.frustumConstants[5]=e[15]+e[14];for(let n=0;n<6;n++){let i=t.frustum[n],s=1/pi(i);hn(i,i,s),t.frustumConstants[n]*=s}},__=(t,e,n)=>{st(Mp,e.bounds.center),Mi(Mp,Mp,n.worldMatrix);let i=e.bounds.radius*l_(n.worldMatrix);return Mh(t,Mp,i)},Mh=(t,e,n)=>{for(let i=0;i<6;i++)if(dn(t.frustum[i],e)+t.frustumConstants[i]<-n)return!1;return!0};var Fi=document.createElement("canvas"),O=Fi.getContext("webgl2",{depth:!0,stencil:!1,premultipliedAlpha:!1,alpha:!1,antialias:!1,powerPreference:"high-performance",preserveDrawingBuffer:!0}),En=document.createElement("canvas"),Ci=En.getContext("2d",{alpha:!0}),ml=O.vertexAttribDivisor.bind(O),y_=O.drawArraysInstanced.bind(O),k_=O.drawElementsInstanced.bind(O),x_=O.createVertexArray.bind(O),Cp=O.bindVertexArray.bind(O),nT=O.deleteVertexArray.bind(O),Fh=O.getExtension("EXT_texture_filter_anisotropic"),w_=O.getExtension("WEBGL_compressed_texture_s3tc"),et={maxTextureUnits:O.getParameter(O.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxAnisotropy:O.getParameter(Fh.MAX_TEXTURE_MAX_ANISOTROPY_EXT),blendFunc:{src:O.ONE,dst:O.ZERO,srcAlpha:0,dstAlpha:0},blendEquation:{modeRGB:O.FUNC_ADD,modeAlpha:0},frontFace:O.CCW,depthFunc:O.LESS,cullFace:null,depthMask:!0,flipY:!1,framebuffer:null,viewport:{width:-1,height:-1},textureUnits:[],activeTextureUnit:0,width:0,height:0,currentGeometry:-1,currentProgram:-1},M_=(t,e)=>{et.width=t,et.height=e,Fi.width=t,Fi.height=e,En.width=t,En.height=e},Nc=(t,e)=>{et.viewport.width===t&&et.viewport.height===e||(et.viewport.width=t,et.viewport.height=e,O.viewport(0,0,t,e))},jc=t=>{et[t]!==!0&&(O.enable(t),et[t]=!0)},Sp=t=>{et[t]!==!1&&(O.disable(t),et[t]=!1)},F_=(t,e,n,i)=>{et.blendFunc.src===t&&et.blendFunc.dst===e&&et.blendFunc.srcAlpha===n&&et.blendFunc.dstAlpha===i||(et.blendFunc.src=t,et.blendFunc.dst=e,et.blendFunc.srcAlpha=n,et.blendFunc.dstAlpha=i,n!==void 0?O.blendFuncSeparate(t,e,n,i):O.blendFunc(t,e))},C_=(t,e)=>{et.blendEquation.modeRGB===t&&et.blendEquation.modeAlpha===e||(et.blendEquation.modeRGB=t,et.blendEquation.modeAlpha=e,e!==void 0?O.blendEquationSeparate(t,e):O.blendEquation(t))},S_=t=>{et.cullFace!==t&&(et.cullFace=t,O.cullFace(t))},A_=t=>{et.frontFace!==t&&(et.frontFace=t,O.frontFace(t))},Ch=t=>{et.depthMask!==t&&(et.depthMask=t,O.depthMask(t))},P_=t=>{et.depthFunc!==t&&(et.depthFunc=t,O.depthFunc(t))},Wc=t=>{et.activeTextureUnit!==t&&(et.activeTextureUnit=t,O.activeTexture(O.TEXTURE0+t))},b_=({target:t=O.FRAMEBUFFER,buffer:e=null}={})=>{et.framebuffer!==e&&(et.framebuffer=e,O.bindFramebuffer(t,e))},T_=t=>{t?(b_(t),Nc(t.width,t.height)):(b_(),Nc(et.width,et.height))},Sh=t=>{(!t||!t.depth)&&(jc(O.DEPTH_TEST),Ch(!0)),O.clear(O.COLOR_BUFFER_BIT|O.DEPTH_BUFFER_BIT)};var dl=`#version 300 es
in vec2 uv;
in vec2 position;
out vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = vec4(position, 0.0, 1.0);
}`;var E_=[0,1,0],D_=[0,0,0],gt=Uc(.3,500,70),Gt=on();Mn(gt.transform,Gt);Y(gt.transform.position,0,0,-1);gt.transform.rotation[1]=Math.PI;Gt.matrixAutoUpdate=!0;function iT(t){let e;return{c(){e=h("div"),Pe(e,"cursor",t[1])},m(n,i){x(n,e,i),t[2](e)},p(n,[i]){i&2&&Pe(e,"cursor",n[1])},i:ce,o:ce,d(n){n&&k(e),t[2](null)}}}function sT(t,e,n){let i;se(t,op,r=>n(1,i=r));let s;jn(()=>{s.appendChild(Fi),s.appendChild(En)});function o(r){Wt[r?"unshift":"push"](()=>{s=r,n(0,s)})}return[s,i,o]}var Ah=class extends we{constructor(e){super(),Ce(this,e,sT,iT,$e,{})}},I_=Ah;function V_(t){let e,n,i,s,o;return{c(){e=h("div"),n=h("img"),m(n,"class",i=Eo(t[2].css)+" svelte-fc7xg3"),at(n.src,s=t[2].img)||m(n,"src",s),m(e,"class",o="container border "+t[2].border+" svelte-fc7xg3"),Pe(e,"top",t[1]+"px"),Pe(e,"left",t[0]+"px")},m(r,a){x(r,e,a),d(e,n)},p(r,a){a&4&&i!==(i=Eo(r[2].css)+" svelte-fc7xg3")&&m(n,"class",i),a&4&&!at(n.src,s=r[2].img)&&m(n,"src",s),a&4&&o!==(o="container border "+r[2].border+" svelte-fc7xg3")&&m(e,"class",o),a&2&&Pe(e,"top",r[1]+"px"),a&1&&Pe(e,"left",r[0]+"px")},d(r){r&&k(e)}}}function oT(t){let e,n=t[2]&&t[0]&&t[1]&&V_(t);return{c(){n&&n.c(),e=ge()},m(i,s){n&&n.m(i,s),x(i,e,s)},p(i,[s]){i[2]&&i[0]&&i[1]?n?n.p(i,s):(n=V_(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ce,o:ce,d(i){i&&k(e),n&&n.d(i)}}}function rT(t,e,n){let i;se(t,Pn,a=>n(2,i=a));let s,o,r=a=>{(i||s||o)&&(i?(n(0,s=a.clientX-10),n(1,o=a.clientY-10)):(n(0,s=0),n(1,o=0)))};return jn(()=>{document.addEventListener("mousemove",r,!1)}),Wn(()=>{document.removeEventListener("mousemove",r)}),[s,o,i]}var Ph=class extends we{constructor(e){super(),Ce(this,e,rT,oT,$e,{})}},L_=Ph;var q_=(t,e,n)=>n.items[t][t=="book"?Math.floor(e/5):e],R_=(t,e,n)=>q_(t,e,n).name+(t=="book"?" Lv. "+(e%5+1):""),B_=(t,e,n)=>q_(t,e,n).description;var Ns={};Xn(Ns,{activeWorld:()=>qr,alwaysShowLevel:()=>Op,ambienceVolume:()=>Qc,anisotropy:()=>Xc,audioVolume:()=>$r,audioVolumeLowered:()=>Ur,bloom:()=>Ep,buffCdFlashingDuration:()=>ff,buffCdFlashingInterval:()=>cf,buffcountParty:()=>pf,buffcountUnitframes:()=>uf,buffsHideIrrelevant:()=>nm,cameraZoom:()=>Vp,cdTextBuffs:()=>Kp,cdTextSkills:()=>Jp,charpanelOpen:()=>po,chat:()=>nf,chatbubbles:()=>Hp,clanOpen:()=>fo,classColorBars:()=>jp,combatTextPush:()=>Np,command:()=>Qi,current:()=>oe,disableoffscreen:()=>Pp,dpsmeterMode:()=>tf,dpsmeterOpen:()=>Hr,dpsmeterParty:()=>ef,dpsmeterTarget:()=>Yr,expmeterOpen:()=>Kc,filteredChannels:()=>of,fogpattern:()=>Ip,foliage:()=>Hc,fov:()=>Br,fxaa:()=>Ap,inventoryCols:()=>Wr,inventoryOpen:()=>lo,invertMouseX:()=>im,invertMouseY:()=>sm,itemProtectQuality:()=>lf,itemQualityFilter:()=>af,itemQualityPercent:()=>Zp,itemTypeFilter:()=>rf,itemmeterOpen:()=>Jc,kbAltBack:()=>N_,kbAltForward:()=>O_,kbBack:()=>W_,kbCharacter:()=>J_,kbClan:()=>eb,kbForward:()=>z_,kbInventory:()=>K_,kbLeft:()=>j_,kbMap:()=>Q_,kbNextParty:()=>Y_,kbNextTarget:()=>H_,kbParty:()=>nb,kbPvp:()=>tb,kbRight:()=>G_,kbSkillbar1:()=>ib,kbSkillbar10:()=>pb,kbSkillbar11:()=>mb,kbSkillbar12:()=>db,kbSkillbar13:()=>hb,kbSkillbar14:()=>gb,kbSkillbar15:()=>vb,kbSkillbar16:()=>_b,kbSkillbar17:()=>bb,kbSkillbar18:()=>yb,kbSkillbar19:()=>kb,kbSkillbar2:()=>sb,kbSkillbar20:()=>xb,kbSkillbar21:()=>wb,kbSkillbar22:()=>Mb,kbSkillbar23:()=>Fb,kbSkillbar24:()=>Cb,kbSkillbar3:()=>ob,kbSkillbar4:()=>rb,kbSkillbar5:()=>ab,kbSkillbar6:()=>lb,kbSkillbar7:()=>cb,kbSkillbar8:()=>fb,kbSkillbar9:()=>ub,kbSkills:()=>Z_,kbTurnLeft:()=>$_,kbTurnRight:()=>U_,kbUntarget:()=>X_,lang:()=>Or,lastConnectedChar:()=>Gc,lockedcamera:()=>om,mapLowQuality:()=>Gp,mapShowMonsters:()=>Wp,mouseSensitivity:()=>df,musicVolume:()=>Zc,nameShowEnemyPlayers:()=>$p,nameShowFriendlyPlayers:()=>zp,nameShowMonsters:()=>Bp,nameplateShowEnemyPlayers:()=>Rp,nameplateShowFriendlyPlayers:()=>qp,nameplateShowMonsters:()=>Lp,nameplateShowTransparency:()=>Up,nameplateViewRange:()=>sf,nextFriendlyTargetAllowNonParty:()=>am,nextFriendlyTargetCycle:()=>hf,particles:()=>Dp,partyBuffLimitUpdateRate:()=>em,partyOpen:()=>Zi,partyWidth:()=>Xr,pointerlock:()=>rm,pvpOpen:()=>uo,registerSetting:()=>Sb,resolution:()=>zr,settingsOpen:()=>Gr,shadowmapResolution:()=>Yc,shadows:()=>Tp,showFpsPing:()=>gl,showIncomingDamage:()=>Xp,showIncomingHeal:()=>Yp,showIncomingMana:()=>Qp,showPartyMana:()=>vl,showSelfInParty:()=>tm,skillConfigs:()=>_l,skillPresetVisible:()=>mf,skillbarAmount:()=>Qr,skillbarsettings:()=>mo,skillmenuOpen:()=>co,stashCols:()=>Nr,stashHeight:()=>jr,subscriptionOpen:()=>Li,tutprogress:()=>Os,twitchOpen:()=>hl,viewRange:()=>Rr});var Th={};Xn(Th,{activeWorld:()=>qr,alwaysShowLevel:()=>Op,ambienceVolume:()=>Qc,anisotropy:()=>Xc,audioVolume:()=>$r,audioVolumeLowered:()=>Ur,bloom:()=>Ep,buffCdFlashingDuration:()=>ff,buffCdFlashingInterval:()=>cf,buffcountParty:()=>pf,buffcountUnitframes:()=>uf,buffsHideIrrelevant:()=>nm,cameraZoom:()=>Vp,cdTextBuffs:()=>Kp,cdTextSkills:()=>Jp,charpanelOpen:()=>po,chat:()=>nf,chatbubbles:()=>Hp,clanOpen:()=>fo,classColorBars:()=>jp,combatTextPush:()=>Np,command:()=>Qi,disableoffscreen:()=>Pp,dpsmeterMode:()=>tf,dpsmeterOpen:()=>Hr,dpsmeterParty:()=>ef,dpsmeterTarget:()=>Yr,expmeterOpen:()=>Kc,filteredChannels:()=>of,fogpattern:()=>Ip,foliage:()=>Hc,fov:()=>Br,fxaa:()=>Ap,inventoryCols:()=>Wr,inventoryOpen:()=>lo,invertMouseX:()=>im,invertMouseY:()=>sm,itemProtectQuality:()=>lf,itemQualityFilter:()=>af,itemQualityPercent:()=>Zp,itemTypeFilter:()=>rf,itemmeterOpen:()=>Jc,kbAltBack:()=>N_,kbAltForward:()=>O_,kbBack:()=>W_,kbCharacter:()=>J_,kbClan:()=>eb,kbForward:()=>z_,kbInventory:()=>K_,kbLeft:()=>j_,kbMap:()=>Q_,kbNextParty:()=>Y_,kbNextTarget:()=>H_,kbParty:()=>nb,kbPvp:()=>tb,kbRight:()=>G_,kbSkillbar1:()=>ib,kbSkillbar10:()=>pb,kbSkillbar11:()=>mb,kbSkillbar12:()=>db,kbSkillbar13:()=>hb,kbSkillbar14:()=>gb,kbSkillbar15:()=>vb,kbSkillbar16:()=>_b,kbSkillbar17:()=>bb,kbSkillbar18:()=>yb,kbSkillbar19:()=>kb,kbSkillbar2:()=>sb,kbSkillbar20:()=>xb,kbSkillbar21:()=>wb,kbSkillbar22:()=>Mb,kbSkillbar23:()=>Fb,kbSkillbar24:()=>Cb,kbSkillbar3:()=>ob,kbSkillbar4:()=>rb,kbSkillbar5:()=>ab,kbSkillbar6:()=>lb,kbSkillbar7:()=>cb,kbSkillbar8:()=>fb,kbSkillbar9:()=>ub,kbSkills:()=>Z_,kbTurnLeft:()=>$_,kbTurnRight:()=>U_,kbUntarget:()=>X_,lang:()=>Or,lastConnectedChar:()=>Gc,lockedcamera:()=>om,mapLowQuality:()=>Gp,mapShowMonsters:()=>Wp,mouseSensitivity:()=>df,musicVolume:()=>Zc,nameShowEnemyPlayers:()=>$p,nameShowFriendlyPlayers:()=>zp,nameShowMonsters:()=>Bp,nameplateShowEnemyPlayers:()=>Rp,nameplateShowFriendlyPlayers:()=>qp,nameplateShowMonsters:()=>Lp,nameplateShowTransparency:()=>Up,nameplateViewRange:()=>sf,nextFriendlyTargetAllowNonParty:()=>am,nextFriendlyTargetCycle:()=>hf,particles:()=>Dp,partyBuffLimitUpdateRate:()=>em,partyOpen:()=>Zi,partyWidth:()=>Xr,pointerlock:()=>rm,pvpOpen:()=>uo,resolution:()=>zr,settingsOpen:()=>Gr,shadowmapResolution:()=>Yc,shadows:()=>Tp,showFpsPing:()=>gl,showIncomingDamage:()=>Xp,showIncomingHeal:()=>Yp,showIncomingMana:()=>Qp,showPartyMana:()=>vl,showSelfInParty:()=>tm,skillConfigs:()=>_l,skillPresetVisible:()=>mf,skillbarAmount:()=>Qr,skillbarsettings:()=>mo,skillmenuOpen:()=>co,stashCols:()=>Nr,stashHeight:()=>jr,subscriptionOpen:()=>Li,tutprogress:()=>Os,twitchOpen:()=>hl,viewRange:()=>Rr});var qr=ne(""),Gc=ne(0),Rr=ne(60),Br=ne(70),zr=ne(100),Hc=ne(100),Yc=ne(2),Ap=ne(!0),Pp=ne(!0),Tp=ne(!0),Ep=ne(!0),Dp=ne(!0),Xc=ne(4),Ip=ne(!0),Qc=ne(40),$r=ne(70),Ur=ne(80),Zc=ne(30),Or=ne("en"),Qi=ne("faction"),Nr=ne(8),jr=ne(300),Wr=ne(5),lo=ne(!1),Gr=ne(!1),co=ne(!1),Hr=ne(!1),Jc=ne(!0),Kc=ne(!0),hl=ne(!0),Li=ne(!1),Zi=ne(!1),fo=ne(!1),uo=ne(!1),ef=ne(!0),tf=ne(0),Yr=ne(0),po=ne(!1),mo=ne({}),nf=ne([0,0,0,0,0,0,1,1,1,1,1,1]),Vp=ne(7),sf=ne(100),Lp=ne(!0),qp=ne(!0),Rp=ne(!0),Bp=ne(!0),zp=ne(!0),$p=ne(!0),Up=ne(!0),Op=ne(!1),Np=ne(!0),jp=ne(!1),Wp=ne(!0),Gp=ne(!1),Os=ne(0),Hp=ne(!0),Yp=ne(!0),Xp=ne(!0),Qp=ne(!0),of=ne([]),rf=ne(""),af=ne(0),Zp=ne(!1),gl=ne(!1),lf=ne(70),Jp=ne(!0),Kp=ne(!0),cf=ne(.5),ff=ne(3),em=ne(!0),Xr=ne(200),tm=ne(!0),vl=ne(!1),uf=ne(14),pf=ne(8),nm=ne(!1),_l=ne([]),mf=ne(!1),df=ne(1),im=ne(!1),sm=ne(!1),om=ne(!0),rm=ne(!0),am=ne(!0),hf=ne(10),z_=ne("w"),$_=ne("arrowleft"),U_=ne("arrowright"),O_=ne("arrowup"),N_=ne("arrowdown"),j_=ne("a"),W_=ne("s"),G_=ne("d"),H_=ne("tab"),Y_=ne("x"),X_=ne("escape"),Q_=ne("m"),Z_=ne("k"),J_=ne("c"),K_=ne("b"),eb=ne("g"),tb=ne("v"),nb=ne("p"),ib=ne("1"),sb=ne("2"),ob=ne("3"),rb=ne("4"),ab=ne("5"),lb=ne("6"),cb=ne("7"),fb=ne("8"),ub=ne("9"),pb=ne("0"),mb=ne(""),db=ne(""),hb=ne(""),gb=ne(""),vb=ne(""),_b=ne(""),bb=ne(""),yb=ne(""),kb=ne(""),xb=ne(""),wb=ne(""),Mb=ne(""),Fb=ne(""),Cb=ne(""),Qr=ne(12);var Eh;Eh={...Th};var Sb=(t,e)=>{{let n=localStorage.getItem(t),i=JSON.parse(n=="undefined"?null:n);i!==null&&e.set(i)}e.subscribe(n=>{oe[t]=n,localStorage.setItem(t,JSON.stringify(n))})},oe={};for(let t in Eh)Sb(t,Eh[t]);var S;Or.subscribe(async t=>{await fetch(`/data/loc/${t}.json?v=8582889`).then(async e=>{S=await e.json(),sp.set(!0)})});var gn=(t,e)=>R_(t,e,S),Dh=(t,e)=>B_(t,e,S);function Ab(t,e,n){let i=t.slice();return i[6]=e[n],i}function Pb(t){let e,n=pe(t[2].opts),i=[];for(let o=0;o<n.length;o+=1)i[o]=Db(Ab(t,n,o));let s=null;return n.length||(s=Tb(t)),{c(){e=h("div");for(let o=0;o<i.length;o+=1)i[o].c();s&&s.c(),m(e,"class","panel context border grey"),Pe(e,"left",t[2].x+"px"),Pe(e,"top",t[2].y+"px")},m(o,r){x(o,e,r);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(e,null);s&&s.m(e,null),t[4](e)},p(o,r){if(r&5){n=pe(o[2].opts);let a;for(a=0;a<n.length;a+=1){let l=Ab(o,n,a);i[a]?i[a].p(l,r):(i[a]=Db(l),i[a].c(),i[a].m(e,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=n.length,!n.length&&s?s.p(o,r):n.length?s&&(s.d(1),s=null):(s=Tb(o),s.c(),s.m(e,null))}r&4&&Pe(e,"left",o[2].x+"px"),r&4&&Pe(e,"top",o[2].y+"px")},d(o){o&&k(e),it(i,o),s&&s.d(),t[4](null)}}}function Tb(t){let e;return{c(){e=h("div"),e.textContent=`${S.ui.noOptions}`,m(e,"class","choice disabled")},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function Eb(t){let e,n,i;return{c(){e=h("img"),i=Ue(),m(e,"class","svgicon"),at(e.src,n="/data/ui/icons/"+t[6].icon+".svg?v=8582889")||m(e,"src",n)},m(s,o){x(s,e,o),x(s,i,o)},p(s,o){o&4&&!at(e.src,n="/data/ui/icons/"+s[6].icon+".svg?v=8582889")&&m(e,"src",n)},d(s){s&&(k(e),k(i))}}}function Db(t){let e,n=t[6].name+"",i,s,o,r,a=t[6].icon&&Eb(t);function l(...c){return t[3](t[6],...c)}return{c(){e=h("div"),a&&a.c(),i=T(n),m(e,"class",s="choice "+(t[6].css||""))},m(c,f){x(c,e,f),a&&a.m(e,null),d(e,i),o||(r=Q(e,"mouseup",l),o=!0)},p(c,f){t=c,t[6].icon?a?a.p(t,f):(a=Eb(t),a.c(),a.m(e,i)):a&&(a.d(1),a=null),f&4&&n!==(n=t[6].name+"")&&G(i,n),f&4&&s!==(s="choice "+(t[6].css||""))&&m(e,"class",s)},d(c){c&&k(e),a&&a.d(),o=!1,r()}}}function aT(t){let e,n=t[2]&&Pb(t);return{c(){n&&n.c(),e=ge()},m(i,s){n&&n.m(i,s),x(i,e,s)},p(i,[s]){i[2]?n?n.p(i,s):(n=Pb(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ce,o:ce,d(i){i&&k(e),n&&n.d(i)}}}function lT(t,e,n){let i;se(t,wn,c=>n(2,i=c));let s,o=c=>{c.target!=s&&c.target.parentNode!=s&&i&&wn.set(void 0)},r=(c,f)=>{f.fun(c),wn.set(void 0)};jn(()=>{document.addEventListener("pointerdown",o,!1)}),Wn(()=>{document.removeEventListener("pointerdown",o)});let a=(c,f)=>r(f,c);function l(c){Wt[c?"unshift":"push"](()=>{s=c,n(1,s)})}return[r,s,i,a,l]}var Ih=class extends we{constructor(e){super(),Ce(this,e,lT,aT,$e,{opt:0})}get opt(){return this.$$.ctx[0]}},Ib=Ih;var B=0,Vb={string:t=>{let e=$b(t);return Ji(e)+e},varuint:t=>Ji(t),varint:t=>cT(t),buffer8:t=>{let e=t.length;return Ji(e)+e},buffer16:(t,e)=>{let n=t.length*2,i=Ji(n);return(e+i)%2==1&&i++,i+n}};var he=t=>{let e=0,n=0,i=0;do i=t[B++],e|=(i&127)<<7*n,n++;while(i&128);return e};var jo=(t,e)=>{for(;e>127;)t[B++]=e&127|128,e>>=7;t[B++]=e&127},Ji=t=>t<=0?1:Math.floor(Math.log(t)/Math.log(128))+1,cT=t=>Ji(t<<1^t>>31),ps=t=>t[B]&128?(255-t[B]+1)*-1:t[B],fT=(t,e)=>{e<0&&(e=255+e+1),t[B]=e&255,B+=1},Ie=t=>t[B],js=(t,e)=>{t[B]=e,B+=1},lm=t=>{let e=t[B]|t[B+1]<<8;return e&32768?e|4294901760:e},cm=(t,e)=>{t[B]=e&255,t[B+1]=e>>>8,B+=2},Rt=t=>t[B]|t[B+1]<<8;var ho=t=>(t[B]|t[B+1]<<8|t[B+2]<<16)+t[B+3]*16777216,Rb=(t,e)=>{t[B]=e&255,t[B+1]=e>>>8,t[B+2]=e>>>16,t[B+3]=e>>>24,B+=4},Vh=new ArrayBuffer(8),Wo=new Uint8Array(Vh),Bb=new Float32Array(Vh),wU=new Float64Array(Vh),rt=t=>(Wo[0]=t[B],Wo[1]=t[B+1],Wo[2]=t[B+2],Wo[3]=t[B+3],Bb[0]),zb=(t,e)=>{Bb[0]=e,t[B]=Wo[0],t[B+1]=Wo[1],t[B+2]=Wo[2],t[B+3]=Wo[3],B+=4};var Lb=t=>{let e=he(t);B%2==1&&B++;let n=new Uint16Array(t.buffer,B,e/2);return B+=e,n},$b=t=>{let e=t.length;for(let n=t.length-1;n>=0;n--){let i=t.charCodeAt(n);i>127&&i<=2047?e++:i>2047&&i<=65535&&(e+=2),i>=56320&&i<=57343&&n--}return e},qb=(t,e)=>{let n=$b(e);jo(t,n);for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[B++]=s:s<2048?(t[B++]=s>>6|192,t[B++]=s&63|128):(s&64512)==55296&&i+1<e.length&&(e.charCodeAt(i+1)&64512)==56320?(s=65536+((s&1023)<<10)+(e.charCodeAt(++i)&1023),t[B++]=s>>18|240,t[B++]=s>>12&63|128,t[B++]=s>>6&63|128,t[B++]=s&63|128):(t[B++]=s>>12|224,t[B++]=s>>6&63|128,t[B++]=s&63|128)}},qn=t=>{let e=he(t),n="",i=B+e;for(;B<i;){let s=t[B++];if(s<128)n+=String.fromCharCode(s);else if(s>191&&s<224){let o=t[B++];n+=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){let o=t[B++],r=t[B++],a=t[B++],l=((s&7)<<18|(o&63)<<12|(r&63)<<6|a&63)-65536;n+=String.fromCharCode(55296+(l>>10)),n+=String.fromCharCode(56320+(l&1023))}else{let o=t[B++],r=t[B++];n+=String.fromCharCode((s&15)<<12|(o&63)<<6|r&63)}}return n},Ub={encode:t=>{let e=t,n=e.doubles,i=e.int8s,s=e.uint16s,o=e.uint8s,r=0;r+=1,r+=Ji(n.length);for(let l=0;l<n.length;l++)r+=4;r+=Ji(i.length);for(let l=0;l<i.length;l++)r+=1;r+=Ji(s.length);for(let l=0;l<s.length;l++)r+=2;r+=Ji(o.length);for(let l=0;l<o.length;l++)r+=1;let a=new Uint8Array(r);B=0,js(a,e._header),jo(a,n.length);for(let l=0;l<n.length;l++)zb(a,n[l]);jo(a,i.length);for(let l=0;l<i.length;l++)fT(a,i[l]);jo(a,s.length);for(let l=0;l<s.length;l++)cm(a,s[l]);jo(a,o.length);for(let l=0;l<o.length;l++)js(a,o[l]);return a}},Ob={encode:t=>{let e=t,n=0;n+=1,n+=2;let i=new Uint8Array(n);return B=0,js(i,e._header),cm(i,e.target),i}},Nb={encode:t=>{let e=t,n=e.info,i=0;i+=1,i+=2,i+=Ji(n.length);for(let o=0;o<n.length;o++)i+=4;let s=new Uint8Array(i);B=0,js(s,e._header),cm(s,e.id),jo(s,n.length);for(let o=0;o<n.length;o++)Rb(s,n[o]);return s}},jb={encode:t=>{let e=t,n=e.info,i=e.pos,s=0;s+=1,s+=2,s+=Ji(n.length);for(let r=0;r<n.length;r++)s+=4;s+=Ji(i.length);for(let r=0;r<i.length;r++)s+=4;let o=new Uint8Array(s);B=0,js(o,e._header),cm(o,e.id),jo(o,n.length);for(let r=0;r<n.length;r++)Rb(o,n[r]);jo(o,i.length);for(let r=0;r<i.length;r++)zb(o,i[r]);return o}},Wb={encode:t=>{let e=t,n=0;n+=1,n+=1;let i=new Uint8Array(n);return B=0,js(i,e._header),js(i,e.id),i}},Gb={encode:t=>{let e=t,n=0;n+=1,n+=Vb.string(e.command,n),n+=Vb.string(e.string,n);let i=new Uint8Array(n);return B=0,js(i,e._header),qb(i,e.command),qb(i,e.string),i}},Hb={decode:t=>{let e=t,n={};B=0,n._header=Ie(e),B+=1;let i=[];n.inputs=i;let s=he(e);for(let u=0;u<s;u++){let p={};i[u]=p,p.id=Rt(e),B+=2,p.jump=Ie(e),B+=1,p.rot=rt(e),B+=4,p.speed=Rt(e),B+=2;let g=[];p.steer=g,g[0]=ps(e),B+=1;let v=he(e);for(let _=1;_<v;_++)g[_]=ps(e),B+=1}let o=[];n.log=o;let r=he(e);for(let u=0;u<r;u++){let p={};o[u]=p;let g=[];p.data=g;let v=he(e);for(let _=0;_<v;_++)g[_]=he(e);p.type=Ie(e),B+=1}let a=[];n.logPersonal=a;let l=he(e);for(let u=0;u<l;u++){let p={};a[u]=p;let g=[];p.data=g;let v=he(e);for(let _=0;_<v;_++)g[_]=he(e);p.type=Ie(e),B+=1}let c=[];n.movements=c;let f=he(e);for(let u=0;u<f;u++){let p={};c[u]=p,p.id=Rt(e),B+=2;let g=[];p.pos=g,g[0]=rt(e),B+=4,g[1]=rt(e),B+=4;let v=he(e);for(let y=2;y<v;y++)g[y]=rt(e),B+=4;let _=[];p.vel=_,_[0]=rt(e),B+=4,_[1]=rt(e),B+=4;let b=he(e);for(let y=2;y<b;y++)_[y]=rt(e),B+=4}return n.tickId=ho(e),B+=4,n}},Yb={decode:t=>{let e=t,n={};B=0,n._header=Ie(e),B+=1;let i=[];n.members=i;let s=he(e);for(let a=0;a<s;a++){let l={};i[a]=l,l.class=Ie(e),B+=1,l.entityid=Rt(e),B+=2,l.level=Ie(e),B+=1,l.name=qn(e),l.role=Rt(e),B+=2,l.world=qn(e)}let o=[];n.queues=o;let r=he(e);for(let a=0;a<r;a++)o[a]=qn(e);return n}},Xb={decode:t=>{let e=t,n={};B=0,n._header=Ie(e),B+=1,n.contrib=he(e);let i=[];n.contributors=i;let s=he(e);for(let a=0;a<s;a++){let l={};i[a]=l,l.class=Ie(e),B+=1,l.faction=Ie(e),B+=1,l.level=Ie(e),B+=1,l.name=qn(e);let c=[];l.stats=c;let f=he(e);for(let u=0;u<f;u++)c[u]=he(e)}n.duration=he(e);let o=[];n.kills=o,o[0]=he(e);let r=he(e);for(let a=1;a<r;a++)o[a]=he(e);return n.level=he(e),n.reward=he(e),n.status=Ie(e),B+=1,n}},Qb={decode:t=>{let e=t,n={};B=0,n._header=Ie(e),B+=1;let i=[];n.members=i;let s=he(e);for(let o=0;o<s;o++){let r={};i[o]=r,r.entityid=Rt(e),B+=2;let a=[];r.pos=a;let l=he(e);for(let c=0;c<l;c++)a[c]=Rt(e),B+=2}return n}},Zb={decode:t=>{let e=t,n={};B=0,n._header=Ie(e),B+=1;let i=[];n.icons=i;let s=he(e);for(let o=0;o<s;o++){let r={};i[o]=r,r.blink=!!ps(e),B+=1,r.id=Rt(e),B+=2;let a=[];r.pos=a,a[0]=Rt(e),B+=2;let l=he(e);for(let c=1;c<l;c++)a[c]=Rt(e),B+=2}return n}},Jb={decode:t=>{let e=t,n={};B=0,n._header=Ie(e),B+=1;let i=[];n.messages=i;let s=he(e);for(let o=0;o<s;o++){let r={};i[o]=r,r.channel=qn(e),r.clan=qn(e),r.class=Ie(e),B+=1,r.faction=Ie(e),B+=1,r.from=qn(e),r.id=ho(e),B+=4,r.level=Ie(e),B+=1,r.message=qn(e),r.subscribed=Ie(e),B+=1}return n}},Kb={decode:t=>{let e=t,n={};return B=0,n._header=Ie(e),B+=1,n.world=qn(e),n}},ey={decode:t=>{let e=t,n={};B=0,n._header=Ie(e),B+=1;let i=[];n.messages=i;let s=he(e);for(let o=0;o<s;o++){let r={};i[o]=r,r.message=qn(e),r.type=qn(e)}return n}},ty={decode:t=>{let e=t,n={};return B=0,n._header=Ie(e),B+=1,n.file=qn(e),n.playerId=Rt(e),B+=2,n.tickId=ho(e),B+=4,n.world=qn(e),n}},ny={decode:t=>{let e=t,n={};return B=0,n._header=Ie(e),B+=1,n.pos=Rt(e),B+=2,n}},iy={decode:t=>{let e=t,n={};return B=0,n._header=Ie(e),B+=1,n.id=Ie(e),B+=1,n},encode:t=>{let e=t,n=0;n+=1,n+=1;let i=new Uint8Array(n);return B=0,js(i,e._header),js(i,e.id),i}};var sy={decode:t=>{let e=t,n={};B=0;let i=[];n.aabb=i;let s=he(e);for(let M=0;M<s;M++)i[M]=rt(e),B+=4;let o=[];n.area=o;let r=he(e);for(let M=0;M<r;M++)o[M]=Rt(e),B+=2;let a=[];n.environment=a;let l=he(e);for(let M=0;M<l;M++)a[M]=Rt(e),B+=2;let c=[];n.holes=c;let f=he(e);for(let M=0;M<f;M++)c[M]=Rt(e),B+=2;let u=[];n.props=u;let p=he(e);for(let M=0;M<p;M++){let F={};u[M]=F,F.id=ho(e),B+=4,F.rx=lm(e),B+=2,F.ry=lm(e),B+=2,F.rz=lm(e),B+=2,F.scale=Rt(e),B+=2,F.x=Rt(e),B+=2,F.y=ho(e),B+=4,F.z=Rt(e),B+=2}let g=[];n.shore=g;let v=he(e);for(let M=0;M<v;M++)g[M]=Rt(e),B+=2;n.terrain=Lb(e);let _=[];n.texture=_;let b=he(e);for(let M=0;M<b;M++)_[M]=Lb(e);let y=[];n.textureid=y;let w=he(e);for(let M=0;M<w;M++){let F=[];y[M]=F;let V=he(e);for(let L=0;L<V;L++)F[L]=Rt(e),B+=2}let C=[];n.water=C;let A=he(e);for(let M=0;M<A;M++)C[M]=Rt(e),B+=2;return n}},oy={decode:t=>{let e=t,n={};B=0;let i=[];n.color=i;let s=he(e);for(let y=0;y<s;y++)i[y]=Ie(e),B+=1;let o=[];n.flags=o;let r=he(e);for(let y=0;y<r;y++)o[y]=Ie(e),B+=1;let a=[];n.index=a;let l=he(e);for(let y=0;y<l;y++)a[y]=he(e);let c=[];n.indexInvisible=c;let f=he(e);for(let y=0;y<f;y++)c[y]=he(e);let u=[];n.normal=u;let p=he(e);for(let y=0;y<p;y++)u[y]=ps(e),B+=1;let g=[];n.position=g;let v=he(e);for(let y=0;y<v;y++)g[y]=lm(e),B+=2;n.sx=ho(e),B+=4,n.sy=ho(e),B+=4,n.sz=ho(e),B+=4;let _=[];n.uv=_;let b=he(e);for(let y=0;y<b;y++)_[y]=Rt(e),B+=2;return n}},ry={decode:t=>{let e=t,n={};B=0;let i=[];n.animations=i;let s=he(e);for(let X=0;X<s;X++){let $={};i[X]=$,$.duration=rt(e),B+=4;let fe=[];$.effects=fe;let je=he(e);for(let Re=0;Re<je;Re++){let Be={};fe[Re]=Be,Be.body=Ie(e),B+=1,Be.end=rt(e),B+=4,Be.id=Ie(e),B+=1,Be.priority=Ie(e),B+=1,Be.start=rt(e),B+=4,Be.type=Ie(e),B+=1}$.id=Ie(e),B+=1,$.movement=Ie(e),B+=1,$.priority=Ie(e),B+=1;let Ve=[];$.sounds=Ve;let ye=he(e);for(let Re=0;Re<ye;Re++){let Be={};Ve[Re]=Be,Be.end=Ie(e),B+=1,Be.id=Ie(e),B+=1,Be.start=rt(e),B+=4}}let o=[];n.areas=o;let r=he(e);for(let X=0;X<r;X++){let $={};o[X]=$,$.ambientday=Ie(e),B+=1,$.ambientnight=Ie(e),B+=1,$.id=Ie(e),B+=1,$.music=Ie(e),B+=1,$.name=qn(e)}let a=[];n.arenas=a;let l=he(e);for(let X=0;X<l;X++){let $={};a[X]=$,$.group=Ie(e),B+=1,$.id=Ie(e),B+=1;let fe=[];$.pos=fe;let je=he(e);for(let Ve=0;Ve<je;Ve++)fe[Ve]=rt(e),B+=4;$.radius=Ie(e),B+=1,$.rot=rt(e),B+=4,$.type=Ie(e),B+=1,$.world=Ie(e),B+=1}let c=[];n.classes=c;let f=he(e);for(let X=0;X<f;X++){let $={};c[X]=$;let fe=[];$.baseStats=fe;let je=he(e);for(let Qe=0;Qe<je;Qe++){let Et=[];fe[Qe]=Et;let be=he(e);for(let Je=0;Je<be;Je++)Et[Je]=Ie(e),B+=1}let Ve=[];$.engineSkills=Ve;let ye=he(e);for(let Qe=0;Qe<ye;Qe++)Ve[Qe]=Ie(e),B+=1;$.id=Ie(e),B+=1;let Re=[];$.startSkills=Re;let Be=he(e);for(let Qe=0;Qe<Be;Qe++)Re[Qe]=Ie(e),B+=1;let mt=[];$.statPerLevel=mt;let wt=he(e);for(let Qe=0;Qe<wt;Qe++){let Et=[];mt[Qe]=Et;let be=he(e);for(let Je=0;Je<be;Je++)Et[Je]=Ie(e),B+=1}}let u=[];n.creatures=u;let p=he(e);for(let X=0;X<p;X++){let $={};u[X]=$;let fe=[];$.col1=fe;let je=he(e);for(let Re=0;Re<je;Re++)fe[Re]=rt(e),B+=4;let Ve=[];$.col2=Ve;let ye=he(e);for(let Re=0;Re<ye;Re++)Ve[Re]=rt(e),B+=4;$.drProtection=!!ps(e),B+=1,$.faction=Ie(e),B+=1,$.id=Rt(e),B+=2,$.level=Ie(e),B+=1,$.name=qn(e),$.skin=Ie(e),B+=1,$.type=Ie(e),B+=1}let g=[];n.creaturesConjurer=g;let v=he(e);for(let X=0;X<v;X++){let $={};g[X]=$,$.id=Rt(e),B+=2,$.war=!!ps(e),B+=1}let _=[];n.creaturesMonster=_;let b=he(e);for(let X=0;X<b;X++){let $={};_[X]=$,$.aggroMode=Ie(e),B+=1,$.id=Rt(e),B+=2,$.rarity=Ie(e),B+=1}let y=[];n.creaturesTrader=y;let w=he(e);for(let X=0;X<w;X++){let $={};y[X]=$,$.id=Rt(e),B+=2,$.shop=Ie(e),B+=1}let C=[];n.effects=C;let A=he(e);for(let X=0;X<A;X++){let $={};C[X]=$,$.duration=rt(e),B+=4;let fe=[];$.events=fe;let je=he(e);for(let Re=0;Re<je;Re++){let Be={};fe[Re]=Be,Be.fraction=rt(e),B+=4,Be.id=Ie(e),B+=1;let mt=[];Be.params=mt;let wt=he(e);for(let Qe=0;Qe<wt;Qe++)mt[Qe]=rt(e),B+=4}$.id=Ie(e),B+=1;let Ve=[];$.periods=Ve;let ye=he(e);for(let Re=0;Re<ye;Re++){let Be={};Ve[Re]=Be,Be.fractionEnd=rt(e),B+=4,Be.fractionStart=rt(e),B+=4,Be.id=Ie(e),B+=1;let mt=[];Be.modifiers=mt;let wt=he(e);for(let be=0;be<wt;be++){let Je={};mt[be]=Je,Je.id=Ie(e),B+=1,Je.mode=Ie(e),B+=1;let yt=[];Je.params=yt;let St=he(e);for(let Ae=0;Ae<St;Ae++)yt[Ae]=rt(e),B+=4}let Qe=[];Be.params=Qe;let Et=he(e);for(let be=0;be<Et;be++)Qe[be]=rt(e),B+=4}}let M=[];n.environments=M;let F=he(e);for(let X=0;X<F;X++){let $={};M[X]=$;let fe=[];$.ambient=fe;let je=he(e);for(let xe=0;xe<je;xe++){let ot=[];fe[xe]=ot;let Xe=he(e);for(let ft=0;ft<Xe;ft++)ot[ft]=rt(e),B+=4}let Ve=[];$.bloom=Ve;let ye=he(e);for(let xe=0;xe<ye;xe++)Ve[xe]=rt(e),B+=4;let Re=[];$.clouds=Re;let Be=he(e);for(let xe=0;xe<Be;xe++){let ot=[];Re[xe]=ot;let Xe=he(e);for(let ft=0;ft<Xe;ft++)ot[ft]=rt(e),B+=4}let mt=[];$.direct=mt;let wt=he(e);for(let xe=0;xe<wt;xe++){let ot=[];mt[xe]=ot;let Xe=he(e);for(let ft=0;ft<Xe;ft++)ot[ft]=rt(e),B+=4}let Qe=[];$.fog=Qe;let Et=he(e);for(let xe=0;xe<Et;xe++){let ot=[];Qe[xe]=ot;let Xe=he(e);for(let ft=0;ft<Xe;ft++)ot[ft]=rt(e),B+=4}let be=[];$.horizon=be;let Je=he(e);for(let xe=0;xe<Je;xe++){let ot=[];be[xe]=ot;let Xe=he(e);for(let ft=0;ft<Xe;ft++)ot[ft]=rt(e),B+=4}$.id=Ie(e),B+=1;let yt=[];$.skybot=yt;let St=he(e);for(let xe=0;xe<St;xe++){let ot=[];yt[xe]=ot;let Xe=he(e);for(let ft=0;ft<Xe;ft++)ot[ft]=rt(e),B+=4}let Ae=[];$.skymid=Ae;let ct=he(e);for(let xe=0;xe<ct;xe++){let ot=[];Ae[xe]=ot;let Xe=he(e);for(let ft=0;ft<Xe;ft++)ot[ft]=rt(e),B+=4}let $t=[];$.skytop=$t;let Le=he(e);for(let xe=0;xe<Le;xe++){let ot=[];$t[xe]=ot;let Xe=he(e);for(let ft=0;ft<Xe;ft++)ot[ft]=rt(e),B+=4}let Ct=[];$.sun=Ct;let Vt=he(e);for(let xe=0;xe<Vt;xe++){let ot=[];Ct[xe]=ot;let Xe=he(e);for(let ft=0;ft<Xe;ft++)ot[ft]=rt(e),B+=4}let We=[];$.water=We;let Ke=he(e);for(let xe=0;xe<Ke;xe++){let ot=[];We[xe]=ot;let Xe=he(e);for(let ft=0;ft<Xe;ft++)ot[ft]=rt(e),B+=4}}let V=[];n.files=V;let L=he(e);for(let X=0;X<L;X++){let $={};V[X]=$,$.ext=Ie(e),B+=1,$.id=Rt(e),B+=2,$.type=Ie(e),B+=1}let q=[];n.filesExt=q;let R=he(e);for(let X=0;X<R;X++)q[X]=qn(e);let z=[];n.foliages=z;let E=he(e);for(let X=0;X<E;X++){let $={};z[X]=$,$.id=Ie(e),B+=1;let fe=[];$.nodes=fe;let je=he(e);for(let Ve=0;Ve<je;Ve++){let ye={};fe[Ve]=ye,ye.arc=rt(e),B+=4;let Re=[];ye.end=Re;let Be=he(e);for(let be=0;be<Be;be++)Re[be]=rt(e),B+=4;ye.geotype=Ie(e),B+=1,ye.jitter_radius=rt(e),B+=4,ye.jitter_rotation=rt(e),B+=4,ye.jitter_size=rt(e),B+=4,ye.jitter_slant=rt(e),B+=4,ye.jitter_y=rt(e),B+=4,ye.leafCount=Ie(e),B+=1;let mt=[];ye.points=mt;let wt=he(e);for(let be=0;be<wt;be++)mt[be]=rt(e),B+=4;ye.radius=rt(e),B+=4,ye.size=rt(e),B+=4,ye.slant=rt(e),B+=4;let Qe=[];ye.start=Qe;let Et=he(e);for(let be=0;be<Et;be++)Qe[be]=rt(e),B+=4;ye.y=rt(e),B+=4}$.seed=ho(e),B+=4,$.texture=Rt(e),B+=2,$.type=Ie(e),B+=1}let W=[];n.meshes=W;let j=he(e);for(let X=0;X<j;X++){let $={};W[X]=$,$.cull=Ie(e),B+=1;let fe=[];$.effects=fe;let je=he(e);for(let Ve=0;Ve<je;Ve++){let ye={};fe[Ve]=ye,ye.id=Ie(e),B+=1;let Re=[];ye.pos=Re;let Be=he(e);for(let be=0;be<Be;be++)Re[be]=rt(e),B+=4;let mt=[];ye.rot=mt;let wt=he(e);for(let be=0;be<wt;be++)mt[be]=rt(e),B+=4;let Qe=[];ye.scale=Qe;let Et=he(e);for(let be=0;be<Et;be++)Qe[be]=rt(e),B+=4}$.geometry=Rt(e),B+=2,$.id=Rt(e),B+=2,$.shader=Ie(e),B+=1,$.shadow=Ie(e),B+=1,$.texture=Rt(e),B+=2}let N=[];n.minimap=N;let U=he(e);for(let X=0;X<U;X++){let $={};N[X]=$,$.img=Rt(e),B+=2;let fe=[];$.pos=fe;let je=he(e);for(let Ve=0;Ve<je;Ve++)fe[Ve]=Rt(e),B+=2;$.world=Ie(e),B+=1}let ie=[];n.particles=ie;let re=he(e);for(let X=0;X<re;X++){let $={};ie[X]=$;let fe=[];$.acc=fe;let je=he(e);for(let mt=0;mt<je;mt++)fe[mt]=rt(e),B+=4;$.blend=Ie(e),B+=1;let Ve=[];$.colEnd=Ve;let ye=he(e);for(let mt=0;mt<ye;mt++)Ve[mt]=rt(e),B+=4;let Re=[];$.colStart=Re;let Be=he(e);for(let mt=0;mt<Be;mt++)Re[mt]=rt(e),B+=4;$.duration=rt(e),B+=4,$.friction=rt(e),B+=4,$.id=Ie(e),B+=1,$.idEnd=Ie(e),B+=1,$.idLoop=Ie(e),B+=1,$.idStart=Ie(e),B+=1,$.interp=Ie(e),B+=1,$.randomRota=rt(e),B+=4,$.rota=rt(e),B+=4,$.rotaEnd=rt(e),B+=4,$.scaleEnd=rt(e),B+=4,$.scaleStart=rt(e),B+=4}let ae=[];n.ribbons=ae;let ue=he(e);for(let X=0;X<ue;X++){let $={};ae[X]=$;let fe=[];$.colEnd=fe;let je=he(e);for(let Re=0;Re<je;Re++)fe[Re]=rt(e),B+=4;let Ve=[];$.colStart=Ve;let ye=he(e);for(let Re=0;Re<ye;Re++)Ve[Re]=rt(e),B+=4;$.id=Ie(e),B+=1,$.interval=rt(e),B+=4,$.steps=Ie(e),B+=1,$.texture=Rt(e),B+=2}let Me=[];n.skeletons=Me;let me=he(e);for(let X=0;X<me;X++){let $={};Me[X]=$,$.cape=!!ps(e),B+=1,$.groundNormal=!!ps(e),B+=1,$.height=rt(e),B+=4,$.helmet=!!ps(e),B+=1,$.id=Ie(e),B+=1,$.shoulders=!!ps(e),B+=1}let Ne=[];n.skins=Ne;let De=he(e);for(let X=0;X<De;X++){let $={};Ne[X]=$,$.animset=Ie(e),B+=1;let fe=[];$.body=fe;let je=he(e);for(let Ae=0;Ae<je;Ae++){let ct={};fe[Ae]=ct,ct.bid=Ie(e),B+=1;let $t=[];ct.col=$t;let Le=he(e);for(let Xe=0;Xe<Le;Xe++)$t[Xe]=rt(e),B+=4;ct.colMode=Ie(e),B+=1,ct.lod=Ie(e),B+=1,ct.mid=Rt(e),B+=2,ct.pid=ps(e),B+=1;let Ct=[];ct.pos=Ct;let Vt=he(e);for(let Xe=0;Xe<Vt;Xe++)Ct[Xe]=rt(e),B+=4;let We=[];ct.rot=We;let Ke=he(e);for(let Xe=0;Xe<Ke;Xe++)We[Xe]=rt(e),B+=4;let xe=[];ct.scl=xe;let ot=he(e);for(let Xe=0;Xe<ot;Xe++)xe[Xe]=rt(e),B+=4;ct.ts=Ie(e),B+=1}$.capeswing=Ie(e),B+=1;let Ve=[];$.colPrim=Ve;let ye=he(e);for(let Ae=0;Ae<ye;Ae++)Ve[Ae]=rt(e),B+=4;let Re=[];$.colSec=Re;let Be=he(e);for(let Ae=0;Ae<Be;Ae++)Re[Ae]=rt(e),B+=4;let mt=[];$.effects=mt;let wt=he(e);for(let Ae=0;Ae<wt;Ae++){let ct={};mt[Ae]=ct,ct.bid=Ie(e),B+=1,ct.id=Ie(e),B+=1}$.id=Ie(e),B+=1,$.mountPart=Ie(e),B+=1;let Qe=[];$.mountPos=Qe;let Et=he(e);for(let Ae=0;Ae<Et;Ae++)Qe[Ae]=rt(e),B+=4;let be=[];$.sheathedPos=be;let Je=he(e);for(let Ae=0;Ae<Je;Ae++)be[Ae]=rt(e),B+=4;$.size=rt(e),B+=4,$.skeleton=Ie(e),B+=1,$.soundset=Ie(e),B+=1;let yt=[];$.unsheathedPos=yt;let St=he(e);for(let Ae=0;Ae<St;Ae++)yt[Ae]=rt(e),B+=4}let Fe=[];n.sounds=Fe;let _e=he(e);for(let X=0;X<_e;X++){let $={};Fe[X]=$,$.distance=rt(e),B+=4;let fe=[];$.files=fe;let je=he(e);for(let Ve=0;Ve<je;Ve++)fe[Ve]=Rt(e),B+=2;$.id=Ie(e),B+=1}let H=[];n.soundsetSteps=H;let qe=he(e);for(let X=0;X<qe;X++){let $={};H[X]=$,$.id=Ie(e),B+=1;let fe=[];$.steps=fe;let je=he(e);for(let Ve=0;Ve<je;Ve++)fe[Ve]=Ie(e),B+=1}let Oe=[];n.soundsets=Oe;let He=he(e);for(let X=0;X<He;X++){let $={};Oe[X]=$,$.id=Ie(e),B+=1;let fe=[];$.sounds=fe;let je=he(e);for(let Ve=0;Ve<je;Ve++)fe[Ve]=Ie(e),B+=1;$.steps=Ie(e),B+=1}let Ye=[];n.terrains=Ye;let Ze=he(e);for(let X=0;X<Ze;X++){let $={};Ye[X]=$,$.brightest=Ie(e),B+=1,$.darkest=Ie(e),B+=1;let fe=[];$.foliage=fe;let je=he(e);for(let Ve=0;Ve<je;Ve++){let ye=[];fe[Ve]=ye;let Re=he(e);for(let Be=0;Be<Re;Be++)ye[Be]=Ie(e),B+=1}$.id=Ie(e),B+=1,$.scale=Ie(e),B+=1,$.spec=Ie(e),B+=1,$.texture=Rt(e),B+=2}let ve=[];n.traderShopItems=ve;let le=he(e);for(let X=0;X<le;X++){let $={};ve[X]=$,$.bind=Ie(e),B+=1,$.id=Ie(e),B+=1,$.shop=Ie(e),B+=1,$.stacks=Ie(e),B+=1,$.tier=Rt(e),B+=2,$.type=qn(e),$.upgrade=Ie(e),B+=1}let ze=[];n.worlds=ze;let Z=he(e);for(let X=0;X<Z;X++){let $={};ze[X]=$,$.chunkAmount=Ie(e),B+=1,$.id=Ie(e),B+=1,$.minlevel=Ie(e),B+=1,$.music=Ie(e),B+=1,$.name=qn(e)}return n}};var Ft={clientPlayerInput:Ub,clientPlayerChangeTarget:Ob,clientPlayerSkill:Nb,clientPlayerEnvSkill:jb,clientPlayerInteract:Wb,clientCommand:Gb,serverOnClientConnect:ty,serverEntityDelta:Hb,serverPartyUpdate:Yb,serverWarUpdate:Xb,serverPartyPositions:Qb,serverChangeWorld:Kb,serverMapUpdate:Zb,serverChat:Jb,serverSystemMessage:ey,serverQueue:ny,ping:iy},bl={chunk:sy,gamedata:ry,modelformat:oy},ay=[],pT=0;for(let t in Ft)Ft[t]&&(Ft[t].header=pT++,Ft[t].packData=function(e){return e._header=this.header,this.encode(e)},ay.push(Ft[t]));var ly=t=>{if(t.length===0)return;let e=ay[t[0]];if(!(e&&e.maxSize<t.length))return e};var D,fm=[0,1,0];var bt=[0,0,0],bn=[0,0,0],Zr=[0,0,0],ms=[0,0,0],um=[0,0,0],gf=[0,0,0];var go=[0,0,0,0];var Rn=[0,0],Ws=[0,0];var FU=fs(),cy=t=>{D=t},vo=0,fy=t=>vo=t;var Oh={};Xn(Oh,{onWorldEnter:()=>dT,parseBandwidth:()=>$h,parseFrameDelta:()=>uy,parseLatency:()=>Uh,tick:()=>mT});var vt=(t,e,n)=>Math.min(Math.max(t,e),n),yl=(t,e)=>(t%e+e)%e,vf=(t,e,n)=>{let i=vt((n-t)/(e-t),0,1);return i*i*(3-2*i)},ds=(t,e,n,i,s)=>i+(vt(t,e,n)-e)/(n-e)*(s-i),_f=(t,e,n)=>e+vt(t,0,1)*(n-e),Qt={linear:t=>t,easeInQuad:t=>t*t,easeInQuart:t=>t**4,easeOutQuad:t=>t*(2-t),easeOutExpo:t=>-Math.pow(2,-10*t)+1,easeOutFlick:t=>1-Math.pow(1-t,10),sin:t=>Math.sin(t*3.14),sinReverse:t=>1-Math.sin(t*3.14),easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeBounce:t=>t<.36363636363636365?7.5625*t*t:t<.7272727272727273?7.5625*(t-=.5454545454545454)*t+.75:t<.9090909090909091?7.5625*(t-=.8181818181818182)*t+.9375:7.5625*(t-=.9545454545454546)*t+.984375,anticipate:t=>-1/(1+Math.exp((t-.5)*50))+Math.sin((t-.5)*6.2)*1.4*(1-t*.5)+1,flicker:t=>Math.sin(t*3.14)*(1+Math.sin(t*38)*.3)},Go=(t,e,n)=>t<e?ds(t,0,e,0,n):ds(Qt.easeInOutCubic(ds(t,e,1,0,1)),0,1,n,1),kl=[Qt.linear,Qt.easeInQuad,Qt.easeInQuart,Qt.easeOutQuad,Qt.easeOutExpo,Qt.easeOutFlick,Qt.sin,Qt.sinReverse,Qt.easeInOutCubic,Qt.easeInOutQuint,Qt.easeBounce,Qt.anticipate,Qt.flicker];var kt=class{constructor(e=0,n=0){this.start=e,this.end=e+n,this.duration=n}done(e){return e>this.end}fraction(e){return vt(1-(this.end-e)/this.duration,0,1)}remaining(e){return this.end-e}passed(e){return e-this.start}reset(e,n=this.duration){return this.start=e,this.end=e+n,this.duration=n,!0}set(e,n){return this.start=e,this.end=n,this.duration=this.end-this.start,!0}};var Rh=.016,uy=t=>{Rh=(Rh*10+t)/11},py=0,Lh=0,$h=t=>{py=t},Bh=0,Uh=t=>{Bh=(Bh*2+t)/3},qh=0,zh=new kt(0,.05),mT=t=>{uy(t),oe.showFpsPing&&zh.done(D.time)&&(Lh=(Lh*10+py)/11,qh=(qh*5+D.netData.length)/6,zh.reset(D.time),fp.update(e=>(e[0]=vt(Bh>>0,1,999),e[1]=(1/Rh).toFixed(1),e[2]=(Lh/1e3).toFixed(1),e[3]=D.player?`${~~D.player.pos[0]} ${~~D.player.pos[1]} ${~~D.player.pos[2]}`:"-",e[4]=qh.toFixed(1),e)))},dT=t=>{zh.reset(t.time)};var hT=performance,bf=()=>hT.now();var hs,jh=0,my=0,gy=(t,e)=>{Bn(Ft.serverOnClientConnect.header,n=>{t(Ft.serverOnClientConnect.decode(n))}),Bn("close",n=>{e(n.code)})},Jr={open:[],close:[]};for(let t in Ft)Jr[Ft[t].header]=[];var gT=t=>{},vT=t=>{console.log("Connected"),jh=1;for(let e=0,n=Jr.open.length;e<n;++e)Jr.open[e](t)},_T=t=>{console.log("Connection closed:",t.reason,t.code),jh=0,hs.close(),hs=void 0;for(let e=0,n=Jr.close.length;e<n;++e)Jr.close[e](t)},bT=t=>{yT(t.data.byteLength),t=new Uint8Array(t.data);let e=ly(t),n=e&&Jr[e.header];if(n)for(let i=0,s=n.length;i<s;++i)n[i](t)},Bn=(t,e)=>{Jr[t].push(e)},Si=t=>{hs===void 0||jh!==1||hs.send(t)},vy=t=>{if(hs!==void 0)return;let e="game1.hordes.io";hs=new WebSocket(`wss://${e}:`+t+"/play"),hs.binaryType="arraybuffer",hs.onerror=gT,hs.onopen=vT,hs.onclose=_T,hs.onmessage=bT};var dy=0,Nh=0,yT=t=>{Nh+=t,vo-dy>1e3/4&&(my=Nh*4,Nh=0,dy=vo,$h(my))},_y=()=>{oe.showFpsPing&&vo-hy>(kf.length<10?100:2e3)&&(hy=vo,kT())},by=t=>{if(kf[t.id]){let e=bf();if(kf[t.id]<=e){let n=e-kf[t.id];Uh(n)}}},yf=0,hy=0,kf=[],kT=()=>{yf>254&&(yf=0),kf[yf]=bf(),Si(Ft.ping.packData({id:yf})),yf++};var xt=(t,e="")=>{Si(Ft.clientCommand.packData({command:t,string:e+""}))};var ea={report:{client:!0},partyleave:{},partyinvite:{a:1},partycreate:{},time:{},bosslog:{},party:{a:1,chat:!0},clan:{a:1,chat:!0},faction:{a:1,chat:!0}},_o={itemmove:{a:2},itemdrop:{a:1},itemauctionpost:{a:2},itemauctionfind:{a:5},itemauctionbuy:{a:1},itemauctioncancel:{a:1},itemstash:{a:1},itemunstash:{a:1},itemsplithalf:{a:1},itemsplitone:{a:1},goldstash:{a:1},itemtradersell:{a:1},itemtraderbuy:{a:1},itemblacksmithupgrade:{a:1},petlootsettings:{a:2},statincrease:{a:2},skillconfig:{a:1},cancelbuff:{a:1},respawn:{},startqueue:{a:1},stopqueue:{a:1},partyaccept:{a:1},partydecline:{a:1},partykick:{a:1},partysetrole:{a:2},summonaccept:{a:1},whisper:{a:2,chat:!0},global:{a:1},...ea};var yy=t=>{navigator.clipboard.writeText(t)};var Hh={};Xn(Hh,{addRequest:()=>xl,confirmationBasedCallback:()=>mm,onWorldDestroy:()=>MT,onWorldEnter:()=>wT,postTick:()=>xT,removeTopRequest:()=>Gh});var Wh=new kt(0,1),Gs=[],xT=(t,e)=>{Wh.done(e.time)&&(Wh.reset(e.time),Gs.length&&(Gs.forEach(n=>{ky(n,1)}),so.set(Gs)))},wT=t=>{Wh.reset(0)},MT=t=>{Gs.length=0,so.set(Gs)},xl=(t,e,n)=>{let i={title:t,text:e,choices:n};Gs.push(i),ky(i,0),so.set(Gs)},ky=(t,e)=>{for(let n=0;n<t.choices.length;++n){let i=t.choices[n];if(i.blockedTime!==void 0)i.blockedTime>1?(i.blockedTime-=e,i.unavailable=`(${i.blockedTime} s)`):i.unavailable=void 0;else if(i.nocombat&&D&&D.player&&D.player.stats){let s=~~D.player.stats.combatTimer.remaining(D.time);s>0?i.unavailable=`(Combat - ${s}s)`:i.unavailable=void 0}i.remaining!==void 0&&(i.remaining>1?(i.remaining-=e,i.additional=`(${~~i.remaining}s remaining)`):(i.additional=void 0,i.unavailable="(Timed out)"))}},Gh=()=>{Gs.length&&(Gs.shift(),so.set(Gs))},pm=!0,mm=(t,e,n,i)=>{t?pm&&(xl(n,i,[{text:n,fun:()=>{pm=!0,e()}},{text:S.ui.decline,fun:()=>{pm=!0}}]),pm=!1):e()};var dm={normal:{partyBasedHostility:!1,pvpprotect:!0,instanced:!1},arena3v3:{name:"Arena 3v3",queue:!0,instanced:!0,groupsize:3,groupcount:2,partyBasedHostility:!0,pvpprotect:!1,startTimer:30},arena5v5:{name:"Arena 5v5",startTimer:30,groupsize:5,groupcount:2,queue:!0,instanced:!0,partyBasedHostility:!0,pvpprotect:!1}};var gm={};Xn(gm,{init:()=>CT,onRemoveEntity:()=>Yh,onWorldDestroy:()=>AT,party:()=>en,postTick:()=>ST});var hm,FT=0,en=new Map,CT=()=>{Bn(Ft.serverPartyUpdate.header,t=>{hm=t}),Bn(Ft.serverPartyPositions.header,t=>{t=Ft.serverPartyPositions.decode(t).members,en.forEach(e=>{let n=t.find(i=>i.entityid===e.id);n&&(e.pos[0]=n.pos[0],e.pos[1]=n.pos[1])})})},ST=(t,e)=>{if(e.player!==void 0){if(hm){en.forEach(i=>{i.found=!1});let n=Ft.serverPartyUpdate.decode(hm);n.members.forEach(i=>{if(!en.has(i.name))en.set(i.name,{id:i.entityid,found:!0,pos:[0,0],local:i.world===e.id,name:i.name,buffStore:i.entityid===e.playerId?nl:ne([]),unitStore:i.entityid===e.playerId?Rs:ne({id:i.entityid,name:i.name,level:i.level,class:i.class,world:i.world,role:i.role,party:e.player.party,faction:e.player.faction,type:0,visible:!0,alive:!0,rarity:!1,range:!1})});else{let s=en.get(i.name);i.entityid!==e.playerId&&(s.local=i.world===e.id,s.unitStore.update(o=>(o.id=i.entityid,o.name=i.name,o.level=i.level,o.class=i.class,o.world=i.world,o.party=e.player.party,o.faction=e.player.faction,o.role=i.role,o))),s.id=i.entityid,s.found=!0}}),en.forEach((i,s)=>{i.found||en.delete(s)}),tl.set(Array.from(en.values()).filter(i=>oe.showSelfInParty||i.id!==e.playerId)),Qn.update(i=>(i.membercount=n.members.length,i.queues=n.queues,oe.partyinfo=i,i)),hm=void 0}if(e.player.party>0)if(!oe.partyBuffLimitUpdateRate)e.entities.type[0].forEach(n=>{n.party===e.player.party&&(n.buffDisplayDirty=!0)});else{let n=Array.from(en.values())[FT++%en.size];if(n){let i=e.entity(n.id);i!==void 0&&i.id!==e.playerId&&(i.buffDisplayDirty=!0)}}}},Yh=t=>{if(en.has(t.name)){let e=en.get(t.name);e.unitStore.update(n=>(n.timedSkill=void 0,n.timedCast=void 0,n.alive=!0,n.range=!1,n.mp=n.hp=n.hpMax=n.mpMax=0,n)),e.buffStore.set([])}},AT=()=>{en.clear()};var C1={};Xn(C1,{onWorldEnter:()=>t7,postTick:()=>n7,steps:()=>Pi,tut:()=>tn});function xy(t,e){return t[0]=e[0],t[1]=e[1],t}function di(t,e,n){return t[0]=e,t[1]=n,t}function wy(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function wl(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function xf(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function Xh(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t}function Ml(t){let e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function My(t){let e=t[0],n=t[1];return e*e+n*n}function vm(t,e){let n=e[0],i=e[1],s=n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t}function Fy(t,e,n){let i=Math.sin(n),s=Math.cos(n);return t[0]=e[1]*i+e[0]*s,t[1]=e[1]*s-e[0]*i,t}var _m=[0,0,0],Cy=(t,e,n,i,s)=>{if(t.length>0){Y(e,1/0,1/0,1/0),Y(n,-1/0,-1/0,-1/0);for(let o=0,r=t.length;o<r;o+=3){let a=t[o],l=t[o+1],c=t[o+2];e[0]=Math.min(a,e[0]),e[1]=Math.min(l,e[1]),e[2]=Math.min(c,e[2]),n[0]=Math.max(a,n[0]),n[1]=Math.max(l,n[1]),n[2]=Math.max(c,n[2])}}else Y(e,0,0,0),Y(n,-0,-0,-0);Xt(s,n,e),hn(i,Ln(i,e,n),.5)},PT=t=>{Cy(t.attributes.position.data,t.bounds.min,t.bounds.max,t.bounds.center,t.bounds.scale),t.bounds.initiated=!0},TT=t=>{let e=0;for(let n=0,i=t.attributes.position.data.length;n<i;n+=3)_m[0]=t.attributes.position.data[n],_m[1]=t.attributes.position.data[n+1],_m[2]=t.attributes.position.data[n+2],e=Math.max(e,Kn(t.bounds.center,_m));t.bounds.radius=Math.sqrt(e)},Sy=t=>{t.bounds.initiated||PT(t),TT(t)};var ET=1,DT=1,Cn=t=>{let e={id:ET++,vao:x_(),vaoNeedsUpdate:!0,attributes:t,drawRangeStart:0,drawRangeCount:0,attrRange:0,instancedCount:0,isInstanced:!1,bounds:{min:[0,0,0],max:[0,0,0],center:[0,0,0],scale:[0,0,0],radius:1/0,initiated:!1}};return Qh(e,e.attributes),e},hi=(t,e)=>{et.boundBuffer!==e.id&&(O.bindBuffer(e.target,e.buffer),et.boundBuffer=e.id),e.bufferLen<e.data.length?(e.bufferLen=e.data.length,O.bufferData(e.target,e.data,e.bufferMode,0,e.data.length)):O.bufferSubData(e.target,0,e.data,0,e.data.length)},bm=(t,e,n)=>{et.boundBuffer!==e.id&&(O.bindBuffer(e.target,e.buffer),et.boundBuffer=e.id);let i=n*e.size;e.bufferLen<i?(e.bufferLen=i,O.bufferData(e.target,e.data,e.bufferMode,0,i)):O.bufferSubData(e.target,0,e.data,0,i)},IT=(t,e,n)=>{n.id=DT++,n.size=n.size||1,n.type=n.type||(n.data.constructor===Float32Array?O.FLOAT:n.data.constructor===Uint16Array?O.UNSIGNED_SHORT:O.UNSIGNED_INT),n.target=e==="index"?O.ELEMENT_ARRAY_BUFFER:O.ARRAY_BUFFER,n.normalize=n.normalize||!1,n.count=n.data.length/n.size,n.divisor=n.instanced?typeof n.instanced=="number"?n.instanced:1:0,n.bufferMode=n.bufferMode||O.STATIC_DRAW,n.bufferLen=0,n.buffer||(n.buffer=O.createBuffer()),hi(t,n)},VT=(t,e,n)=>{if(t.attributes[e]=n,n.divisor){if(t.isInstanced=!0,t.instancedCount&&t.instancedCount!==n.count*n.divisor)return t.instancedCount=Math.min(t.instancedCount,n.count*n.divisor);t.instancedCount=n.count*n.divisor}else e==="index"?t.drawRangeCount=n.count:t.attributes.index||(t.drawRangeCount=Math.max(t.drawRangeCount,n.count))},Qh=(t,e)=>{Cp(null),et.currentGeometry=-1;for(let n in e)e[n].id===void 0&&IT(t,n,e[n]),VT(t,n,e[n]);t.attributes.position&&Sy(t)},Py=(t,e,n)=>{t.attrRange=n,t.drawRangeStart=e,t.drawRangeCount=n},ym=(t,e)=>{t.instancedCount=e},LT=(t,e)=>{Cp(t.vao);for(let n=0;n<e.attributeLocations.length;++n){let i=e.attributeLocations[n];if(!t.attributes[i])continue;let s=t.attributes[i];if(O.bindBuffer(O.ARRAY_BUFFER,s.buffer),et.boundBuffer=s.id,s.size>4){let o=s.size/4,r=o*4,a=r*4;for(let l=0;l<o;++l)O.vertexAttribPointer(n+l,o,O.FLOAT,!1,a,r*l),O.enableVertexAttribArray(n+l),ml(n+l,1)}else O.vertexAttribPointer(n,s.size,s.type,s.normalize,0,0),O.enableVertexAttribArray(n),ml(n,s.divisor)}t.attributes.index&&O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,t.attributes.index.buffer),t.vaoNeedsUpdate=!1},Fl=(t,e)=>{et.currentGeometry!==t.id&&(t.vaoNeedsUpdate&&LT(t,e),Cp(t.vao),et.currentGeometry=t.id)},Cl=(t,e,n)=>{Fl(t,e),t.isInstanced?t.attributes.index?k_(n,t.drawRangeCount,t.attributes.index.type,t.drawRangeStart,t.instancedCount):y_(n,t.drawRangeStart,t.drawRangeCount,t.instancedCount):t.attributes.index?O.drawElements(n,t.drawRangeCount,t.attributes.index.type,t.drawRangeStart):O.drawArrays(n,t.drawRangeStart,t.drawRangeCount)};var qT=1,cn=({vertex:t,fragment:e,uniforms:n={},instanced:i=[],active:s=!0,transparent:o=!1,cullFace:r=O.BACK,frontFace:a=O.CCW,depthTest:l=!0,depthWrite:c=!0,depthFunc:f=O.LESS,globalUniforms:u={},attributeLocations:p})=>{let g={id:qT++,program:O.createProgram(),active:s,transparent:o,cullFace:r,frontFace:a,depthTest:l,depthWrite:c,depthFunc:f,blendFunc:{},blendEquation:{},uniforms:n,autoUniforms:[],uniformArray:[],samplerNames:[],samplerTexUnits:[],samplerTexArray:[],samplerTextures:[],globalUniforms:u,instancedAttributes:i,attributeLocations:p};g.transparent&&!g.blendFunc.src&&Mf(g,O.SRC_ALPHA,O.ONE_MINUS_SRC_ALPHA);let v=Ty(t,O.VERTEX_SHADER),_=Ty(e,O.FRAGMENT_SHADER);for(let b=0;b<p.length;++b)O.bindAttribLocation(g.program,b,p[b]);return O.attachShader(g.program,v),O.attachShader(g.program,_),O.linkProgram(g.program),O.deleteShader(v),O.deleteShader(_),g},Ey=(t,e)=>{O.useProgram(t.program),et.currentProgram=t.id;let n=O.getProgramParameter(t.program,O.ACTIVE_UNIFORMS),i=0,s=2;for(let o=0;o<n;o++){let r=O.getActiveUniform(t.program,o),a=O.getUniformLocation(t.program,r.name);if(a===null)continue;let l=r.name.match(/(\w+)/g)[0],c=r.type,f=c===35678||c===35682||c===36289,u=c===35682;if(f){let p=r.size,g=[];for(let v=0;v<p;++v){let _=u?i++:s++;g.push(_),t.samplerNames.push(l),t.samplerTexUnits.push(_),t.samplerTexArray.push(p===1?-1:v)}p===1?O.uniform1i(a,g[0]):O.uniform1iv(a,g)}else{e[l]?t.uniforms[l]||(t.uniforms[l]=e[l]):t.uniforms[l]||(zT.has(l)||t.autoUniforms.push(l),t.uniforms[l]={value:void 0});let p={name:l,location:a,type:c,data:t.uniforms[l],fun:BT(c,t.uniforms[l].value)};t.uniformArray.push(p)}}},Dy=(t,e)=>{for(let n=0;n<e.length;++n){let i=e[n],s=O.getUniformBlockIndex(t.program,i.name);s!==O.INVALID_INDEX&&i.index>=0&&O.uniformBlockBinding(t.program,s,i.index)}},Sl=(t,e)=>{e||(O.useProgram(t.program),et.currentProgram=t.id),Al(t),Jh(t.uniformArray),wf(t),Pl(t)},Dn=(t,e,n,i)=>{let s=i.samplerNames.indexOf(t);s>=0?i.samplerTextures[s+n]=e:console.log("unknown texture type",t,i)},Al=t=>{for(let e=0;e<t.samplerNames.length;++e){let n=t.samplerNames[e],i=t.samplerTexArray[e];t.globalUniforms[n]&&t.globalUniforms[n].value&&(i<0?t.samplerTextures[e]=t.globalUniforms[n].value:t.samplerTextures[e]=t.globalUniforms[n].value[i])}},km=(t,e)=>{for(let n=0;n<e.samplerNames.length;++n){let i=e.samplerNames[n],s=e.samplerTexArray[n];t[i]&&(s<0?e.samplerTextures[n]=t[i]:e.samplerTextures[n]=t[i][s])}},wf=t=>{for(let e=0;e<t.samplerTexUnits.length;++e){let n=t.samplerTexUnits[e],i=t.samplerTextures[e];i&&et.textureUnits[n]!==i.id&&(Wc(n),O.bindTexture(i.target,i.texture),et.textureUnits[n]=i.id)}},Mf=(t,e,n,i,s)=>{t.blendFunc.src=e,t.blendFunc.dst=n,t.blendFunc.srcAlpha=i,t.blendFunc.dstAlpha=s,e&&(t.transparent=!0)},Zh={},Ty=(t,e)=>{if(Zh[t]!==void 0)return Zh[t];let n=Zh[t]=O.createShader(e);return O.shaderSource(n,t),O.compileShader(n),n},Pl=t=>{t.depthTest?jc(O.DEPTH_TEST):Sp(O.DEPTH_TEST),t.cullFace?jc(O.CULL_FACE):Sp(O.CULL_FACE),t.blendFunc.src?jc(O.BLEND):Sp(O.BLEND),t.cullFace&&S_(t.cullFace),A_(t.frontFace),Ch(t.depthWrite),P_(t.depthFunc),t.blendFunc.src&&F_(t.blendFunc.src,t.blendFunc.dst,t.blendFunc.srcAlpha,t.blendFunc.dstAlpha),t.blendEquation.modeRGB&&C_(t.blendEquation.modeRGB,t.blendEquation.modeAlpha)},Jh=t=>{for(let e=0;e<t.length;++e){let n=t[e];RT(O,n.fun,n.location,n.data.value)}};var RT=(t,e,n,i)=>{switch(e){case 12:return t.uniformMatrix4fv(n,!1,i);case 9:return t.uniform4fv(n,i);case 8:return t.uniform3fv(n,i);case 5:return t.uniform1f(n,i);case 0:return t.uniform1i(n,i);case 1:return t.uniform1iv(n,i);case 2:return t.uniform2iv(n,i);case 3:return t.uniform3iv(n,i);case 4:return t.uniform4iv(n,i);case 6:return t.uniform1fv(n,i);case 7:return t.uniform2fv(n,i);case 10:return t.uniformMatrix2fv(n,!1,i);case 11:return t.uniformMatrix3fv(n,!1,i)}},BT=(t,e)=>{switch(t){case 5126:return Array.isArray(e)?6:5;case 35664:return 7;case 35665:return 8;case 35666:return 9;case 35670:case 5124:case 35678:case 35682:case 36289:case 35680:return Array.isArray(e)?1:0;case 35671:case 35667:return 2;case 35672:case 35668:return 3;case 35673:case 35669:return 4;case 35674:return 10;case 35675:return 11;case 35676:return 12}};var zT=new Set(["projectionViewMatrix","shadowPVMatrix","modelMatrix","viewMatrix","projectionMatrix","cameraPosition"]);var $T=0,qi=(t,e,n,i=on(),s=0)=>({id:$T++,uniformData:{},transform:i,geometry:t,program:e,shadowProgram:s,mode:n}),Ki=(t,e)=>{e.uniforms.modelMatrix&&(e.uniforms.modelMatrix.value=t.transform.worldMatrix);for(let n=0;n<e.autoUniforms.length;++n){let i=e.autoUniforms[n];e.uniforms[i].value=t.uniformData[i]}km(t.uniformData,e),Sl(e,et.currentProgram===e.id),Cl(t.geometry,e,t.mode)};function Iy(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function Vy(t,e,n){switch(t){case Ly:return(e+3>>2)*(n+3>>2)*8;case qy:return(e+3>>2)*(n+3>>2)*16;default:return 0}}var Ly=33777,qy=33778,UT=131072,OT=31,NT=1,jT=2,WT=3,GT=4,HT=7,YT=21,XT=Iy("DXT1"),QT=Iy("DXT3");function Ry(t){let e=new Int32Array(t,0,OT),n=e[YT],i;switch(n){case XT:i=Ly;break;case QT:i=qy;break;default:console.error("Unsupported texture"+n)}let s=1;e[jT]&UT&&(s=Math.max(1,e[HT]));let o=e[GT],r=e[WT],a=e[NT]+4;return{data:new Uint8Array(t,a),width:o,height:r,levels:s,internalFormat:i}}var JT=1,Ho=function({image:t,buffer:e,target:n=O.TEXTURE_2D,type:i=O.UNSIGNED_BYTE,format:s=O.RGBA,internalFormat:o=s,wrapS:r=O.CLAMP_TO_EDGE,wrapT:a=O.CLAMP_TO_EDGE,generateMipmaps:l=!0,minFilter:c=l?O.LINEAR_MIPMAP_LINEAR:O.LINEAR,magFilter:f=O.LINEAR,flipY:u=!0,width:p,depth:g=0,height:v=p,compareMode:_=O.NONE,compareFunc:b=O.LEQUAL,anisotropy:y=1}){return{id:JT++,image:t,buffer:e,target:n,type:i,format:s,internalFormat:o,minFilter:c,magFilter:f,wrapS:r,wrapT:a,generateMipmaps:l,flipY:u,width:p,height:v,depth:g,compareMode:_,texture:O.createTexture(),anisotropy:Math.min(Math.max(1,y),et.maxAnisotropy),needsUpdate:!0,state:{flipY:!1,minFilter:O.NEAREST_MIPMAP_LINEAR,magFilter:O.LINEAR,wrapS:O.REPEAT,wrapT:O.REPEAT,compareMode:O.NONE,anisotropy:1,image:void 0}}},By=t=>{et.textureUnits[et.activeTextureUnit]!==t.id&&(O.bindTexture(t.target,t.texture),et.textureUnits[et.activeTextureUnit]=t.id)},es=(t,e=0)=>{let n=!(t.image===t.state.image&&!t.needsUpdate);if((n||et.textureUnits[e]!==t.id)&&(Wc(e),By(t)),!!n){if(t.needsUpdate=!1,t.flipY!==et.flipY&&(O.pixelStorei(O.UNPACK_FLIP_Y_WEBGL,t.flipY),et.flipY=t.flipY),t.minFilter!==t.state.minFilter&&(O.texParameteri(t.target,O.TEXTURE_MIN_FILTER,t.minFilter),t.state.minFilter=t.minFilter),t.magFilter!==t.state.magFilter&&(O.texParameteri(t.target,O.TEXTURE_MAG_FILTER,t.magFilter),t.state.magFilter=t.magFilter),t.wrapS!==t.state.wrapS&&(O.texParameteri(t.target,O.TEXTURE_WRAP_S,t.wrapS),t.state.wrapS=t.wrapS),t.wrapT!==t.state.wrapT&&(O.texParameteri(t.target,O.TEXTURE_WRAP_T,t.wrapT),t.state.wrapT=t.wrapT),t.anisotropy!==t.state.anisotropy&&(O.texParameterf(t.target,Fh.TEXTURE_MAX_ANISOTROPY_EXT,t.anisotropy),t.state.anisotropy=t.anisotropy),t.compareMode!==t.state.compareMode&&(O.texParameteri(t.target,O.TEXTURE_COMPARE_MODE,t.compareMode),t.state.compareMode=t.compareMode),t.image)t.image.width&&(t.width=t.image.width,t.height=t.image.height),O.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.type,t.image),t.generateMipmaps&&O.generateMipmap(t.target);else if(t.buffer){let i=0,s=t.height,o=t.width,r=t.buffer.data;for(let a=0;a<t.buffer.levels;++a){let l=Vy(t.internalFormat,s,s),c=new Uint8Array(r.buffer,r.byteOffset+i,l);O.compressedTexImage2D(t.target,a,t.internalFormat,o,s,0,c),o=o>>1,s=s>>1,i+=l}}else t.target!==O.TEXTURE_2D_ARRAY?O.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.type,null):O.texImage3D(t.target,0,t.internalFormat,t.width,t.height,t.depth,0,t.format,t.type,null);t.state.image=t.image}},xm=(t,e)=>{t.anisotropy=Math.min(Math.max(1,e),et.maxAnisotropy),t.needsUpdate=!0};var zy=(t,e,n,i,s)=>{Wc(0),By(t),t.flipY!==et.flipY&&(O.pixelStorei(O.UNPACK_FLIP_Y_WEBGL,t.flipY),et.flipY=t.flipY),O.texSubImage3D(t.target,0,0,0,e,n,i,1,t.format,t.type,s),t.generateMipmaps&&O.generateMipmap(t.target)};var yo=(t=O.canvas.width,e=O.canvas.height,n=1,i=!1,s=O.NONE,o=O.CLAMP_TO_EDGE,r=O.CLAMP_TO_EDGE)=>{let a=O.LINEAR,l=O.LINEAR,c={width:t,height:e,target:O.FRAMEBUFFER,buffer:O.createFramebuffer()};if(O.bindFramebuffer(c.target,c.buffer),n&&(c.colorTexture=Ho({width:t,height:e,wrapS:o,wrapT:r,minFilter:a,magFilter:l,flipY:!1,generateMipmaps:!1,internalFormat:O.RGBA8}),es(c.colorTexture),O.framebufferTexture2D(c.target,O.COLOR_ATTACHMENT0,O.TEXTURE_2D,c.colorTexture.texture,0)),i){let f=s===O.COMPARE_REF_TO_TEXTURE?O.LINEAR:O.NEAREST;c.depthTexture=Ho({width:t,height:e,wrapS:o,wrapT:r,minFilter:f,magFilter:f,flipY:!1,format:O.DEPTH_COMPONENT,internalFormat:O.DEPTH_COMPONENT24,type:O.UNSIGNED_INT,generateMipmaps:!1,compareMode:s}),es(c.depthTexture),O.framebufferTexture2D(c.target,O.DEPTH_ATTACHMENT,O.TEXTURE_2D,c.depthTexture.texture,0)}return O.bindFramebuffer(c.target,null),c},Ff=(t,e,n)=>{t.colorTexture.width=e,t.colorTexture.height=n,t.colorTexture.needsUpdate=!0,es(t.colorTexture),t.depthTexture&&(t.depthTexture.width=e,t.depthTexture.height=n,t.depthTexture.needsUpdate=!0,es(t.depthTexture)),t.width=e,t.height=n};var Ut=async(t,e,n)=>{let i=await fetch(t,{method:e!==void 0?"POST":"GET",body:e?JSON.stringify(e):void 0});return i.status===500?n(await i.text()):await i.json()};var Mm=new Map,Cf=new Map,Fm=new Map,e1=new Map,t1=new Map,Tl=new Map,_s=new Map,n1=new Map,El=new Map,Dl=new Map,Sf=new Map,Il=new Map,Af=new Map,i1=new Map,s1=new Map,o1=new Map,r1=new Map,KT=new Map,a1=new Map,Pf=new Map,Tf=[],Ef=[],l1=new Map,Cm=new Map;var Kh=t=>{t.classes.forEach(e=>Cm.set(e.id,e)),t.files.forEach(e=>Tl.set(e.id,e)),t.particles.forEach(e=>Mm.set(e.id,e)),t.effects.forEach(e=>Cf.set(e.id,e)),t.sounds.forEach(e=>Fm.set(e.id,e)),t.soundsets.forEach(e=>e1.set(e.id,e)),t.soundsetSteps.forEach(e=>t1.set(e.id,e)),t.meshes.forEach(e=>_s.set(e.id,e)),t.ribbons.forEach(e=>n1.set(e.id,e)),t.areas.forEach(e=>Sf.set(e.id,e)),t.terrains.forEach(e=>El.set(e.id,e)),t.foliages.forEach(e=>Dl.set(e.id,e)),t.environments.forEach(e=>Il.set(e.id,e)),t.animations.forEach(e=>Af.set(e.id,e)),t.skins.forEach(e=>i1.set(e.id,e)),t.skeletons.forEach(e=>s1.set(e.id,e)),t.creatures.forEach(e=>o1.set(e.id,e)),t.creaturesMonster.forEach(e=>r1.set(e.id,e)),t.creaturesConjurer.forEach(e=>KT.set(e.id,e)),t.creaturesTrader.forEach(e=>a1.set(e.id,e)),t.traderShopItems.forEach(e=>Pf.set(e.id,e)),t.worlds.forEach(e=>{l1.set(e.id,e)});for(let e=0;e<t.filesExt.length;++e)Ef.push(t.filesExt[e]);for(let e=0;e<t.minimap.length;++e)Tf.push(t.minimap[e])};var Sm=(t,e)=>{if(!Tl.has(t))return console.log("unknown file id: "+t),"";let n=Tl.get(t);return`${t}.${e||Ef[n.ext]}`};var zn="webp",Gn="webp",c1="webp",f1=()=>new Promise((t,e)=>{let n=new Image;n.onerror=()=>{e()},n.onload=()=>{zn=Gn=c1="avif",t(!0)},n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="}).catch(()=>{console.log("Avif not supported",navigator.userAgent)});f1();var e9=127,t9=254,u1=2**15-1,n9=2**16-1,p1=2**32-1;var Uy=t=>{let e=bl.modelformat.decode(t),n=u1/(p1/e.sx),i=u1/(p1/e.sy),s=u1/(p1/e.sz);for(let o=0;o<e.position.length;o+=3)e.position[o+0]=e.position[o+0]/n,e.position[o+1]=e.position[o+1]/i,e.position[o+2]=e.position[o+2]/s;for(let o=0;o<e.uv.length;++o)e.uv[o]/=n9;for(let o=0;o<e.color.length;++o)e.color[o]/=t9;for(let o=0,r=e.normal.length;o<r;o++)e.normal[o]=e.normal[o]/e9;return e};var m1=async(t,e,n,i,s,o=3)=>{switch(e.split(".").pop()){case"jpg":case"png":case"avif":case"webp":{let r=new Image;r.onload=()=>{n[e]=i(r),s(n[e],t+e),r.onload=void 0},r.src=t+e+"?v=8582889";break}default:{fetch(t+e+"?v=8582889").then(r=>{if(!r.ok)throw new Error;r.arrayBuffer().then(async a=>{n[e]=await i(a),s(n[e],t+e)})}).catch(r=>{console.log(e+" fetch failed"),o>1&&m1(t,e,n,i,s,--o)});break}}};var na={},s9=(t,e)=>{for(let n=0,i=na[e].length;n<i;++n)na[e][n](...t);na[e]=void 0},Df=async(t,e,n,i,s)=>{n[e]?s(...n[e]):na[t+e]?na[t+e].push(s):(na[t+e]=[],na[t+e].push(s),m1(t,e,n,i,s9))},o9=t=>{let e=Uy(new Uint8Array(t));return[{index:{type:5125,data:new Uint32Array(e.index)},position:{size:3,data:new Float32Array(e.position)},normal:{size:3,data:new Float32Array(e.normal)},uv:{size:2,data:new Float32Array(e.uv)},color:{size:4,data:new Float32Array(e.color)}},e]},r9={},Yo=(t,e)=>{Df("data/assets/",Sm(t),r9,o9,e)};var If,ko,Oy=()=>{If=qi(Cn({position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),0,O.TRIANGLES),fetch("/data/items/atlas.json?v=8582889").then(async t=>{ko=await t.json();for(let e in ko)e!="s"&&(ko[e]=ko[e].map(n=>n/ko.s))})},a9=t=>{let e=Ho({image:t,wrapS:O.REPEAT,wrapT:O.REPEAT,minFilter:O.LINEAR_MIPMAP_LINEAR,anisotropy:2**oe.anisotropy});return es(e),[e]},l9=t=>{let e=Ry(t),n=Ho({buffer:e,minFilter:O.LINEAR_MIPMAP_LINEAR,wrapS:O.REPEAT,wrapT:O.REPEAT,width:e.width,height:e.height,anisotropy:2**oe.anisotropy,format:e.internalFormat,internalFormat:e.internalFormat});return es(n),[n]},d1={},gi=(t,e)=>{Tl.has(t)||console.log("unknown file id: "+t);let n=Tl.get(t);n.ext===3&&w_?Df("data/assets/",`${t}.${Ef[n.ext]}`,d1,l9,e):Df("data/assets/",`${t}.${c1||Ef[n.ext]}`,d1,a9,e)},Ny,jy=(t,e,n)=>{Ny=e,Df("data/assets/",t+".ogg",d1,c9,n)},c9=async t=>[await Ny.decodeAudioData(t)];var Zt=(t,e)=>t+Math.random()*(e-t),h1=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;var Wy=t=>g1(t,Math.random()),g1=(t,e)=>t[Math.floor(e*t.length)];var vn,Qo=[],Xo=new Map,xo=new Map,Am=new Set,Yy=t=>{vn&&(f9(),u9(t),Am.clear())},f9=()=>{Xy(vn.listener,gt.transform.worldMatrix),vp(go,Gt.worldMatrix),Y(bt,0,0,1),yh(bt,bt,go),Y(bn,0,1,0),yh(bn,bn,go),vn.listener.setOrientation(bt[0],bt[1],bt[2],bn[0],bn[1],bn[2])},u9=t=>{let e=0,n=0;for(;n<Qo.length;){let i=Qo[n];i.ended?p9(i.id):(Qo[e]=i,e++),++n}Qo.length=e},Xy=(t,e)=>{t.setPosition(e[12],e[13],e[14])},Qy=function(){this.ended=!0},p9=t=>{xo.set(t,Math.max(0,xo.get(t)-1))},Gy=(t,e)=>{if(!xo.has(t))xo.set(t,1);else{if(xo.get(t)>=e)return!1;xo.set(t,xo.get(t)+1)}return!0},v1={},Zy=(t,e)=>{let n=Wy(t);v1[n]!==void 0?e.buffer=v1[n]:jy(n,vn,i=>{v1[n]=i,e.buffer=i})},Hs=(t,e,n,i,s)=>{if(vn===void 0||vn.state=="suspended"||Am.has(t))return;if(n===0){if(Qo.length>35||(Y(bt,e.worldMatrix[12],e.worldMatrix[13],e.worldMatrix[14]),1/((xo.get(t)||0)+10+Er(Gt.position,bt))*1e3/(Qo.length+20)**1.2<.4)||!Gy(t,2))return}else if(n===1&&!Gy(t,5))return;let o=Fm.get(t);if(!o){console.log("unknown sound id:"+t);return}Am.add(t);let r=vn.createBufferSource();r.id=t,r.loop=i,r.playbackRate.value=s,Zy(o.files,r);let a=Xo.get(n).in;return r.panner=vn.createPanner(),r.panner.distanceModel="exponential",r.panner.refDistance=o.distance,r.panner.rolloffFactor=1,Xy(r.panner,e.worldMatrix),r.connect(r.panner),r.panner.connect(a),r.start(0,0),r.onended=Qy,Qo.push(r),r},Jy=t=>{vn=new(window.AudioContext||window.webkitAudioContext),["ambience","music"].forEach((o,r)=>{let a=vn.createGain();a.connect(vn.destination),Xo.set(2+r,{gain:a,in:a}),Ns[o+"Volume"].subscribe(l=>{Xo.get(2+r).gain.gain.value=(l/100)**2})});let e=vn.createDynamicsCompressor(),n=vn.createGain();e.threshold.value=0,e.knee.value=0,e.ratio.value=15,e.attack.value=.005,e.release.value=.05,e.connect(n),n.connect(vn.destination);let i=vn.createGain();i.gain.value=2,i.connect(e);let s=vn.createGain();s.gain.value=.4,s.connect(e),Xo.set(1,{gain:n,in:i}),Xo.set(0,{gain:n,in:s}),$r.subscribe(o=>{Xo.get(1).gain.gain.value=(o/150)**2}),Ur.subscribe(o=>{Xo.get(0).in.gain.value=o/100}),n_.set(!0),document.removeEventListener("click",Jy)},Hy=!1,Ky=(t,e)=>{Hy||(Hy=!0,document.addEventListener("click",Jy))},e3=t=>{Qo.length=0,xo.clear(),Am.clear()},_1=(t,e,n,i)=>{if(vn===void 0||vn.state=="suspended")return;let s=Fm.get(t);if(!s)return;let o=vn.createBufferSource();o.id=t,o.loop=n,Zy(s.files,o);let r=Xo.get(e).in;return i&&(o.gain=vn.createGain(),o.gain.connect(r),r=o.gain),o.connect(r),o.start(0,n?Zt(0,1):0),o.onended=Qy,o},Mt=(t,e)=>{let n=_1(t,1,!1,e!==void 0);e!==void 0&&n&&(n.gain.gain.value=e)},t3=(t,e)=>_1(t,e,!0,!0),n3=(t,e)=>_1(t,e,!1,!0);var sa=Math.PI*2,d9=Math.PI*3,Vl=t=>t<0||t>sa?(t%sa+sa)%sa:t,Vf=(t,e,n,i)=>(Xt(bn,i,n),Xt(bt,e,n),Xi(bn,bn,bt),Zn(t,bn));var Pm=(t,e,n,i,s,o)=>{let r=[n[0]-t[0],n[1]-t[1],n[2]-t[2]],a=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],l=[i-t[0],s-t[1],o-t[2]],c=dn(r,r),f=dn(r,a),u=dn(r,l),p=dn(a,a),g=dn(a,l),v=1/(c*p-f*f),_=(p*u-f*g)*v,b=(c*g-f*u)*v;return _>=0&&b>=0&&_+b<=1},Tm=(t,e)=>{let n=Math.sin(t[1]),i=Math.cos(t[1]);t[0]=e[2]*i+e[0]*n,t[2]=e[2]*n-e[0]*i},oa=t=>{let e=Math.atan2(t[0],t[1]);return e<0&&(e+=2*Math.PI),e},Em=t=>{let e=Math.atan2(t[0],t[2]);return e<0&&(e+=2*Math.PI),e},ra=(t,e)=>(e-t+d9)%sa-Math.PI;var Dm=(t,e,n)=>{Xt(bt,n,t);let i=dn(bt,e);return sn(bt,t,e,i)},i3=(t,e,n,i,s,o,r,a,l)=>{let c=-(r*i+a*s+l*o);return r*t+a*e+l*n+c},b1=(t,e,n,i,s,o,r,a,l)=>{let c=-(r*i+a*s+l*o);return e+(r*t+l*n+c)/a},s3=(t,e,n,i,s,o,r,a,l)=>{let c=(r*(i-t)+a*(s-e)+l*(o-n))/(r*r+a*a+l*l),f=t+c*r,u=n+c*l;return Math.sqrt(Math.pow(f-t,2)+Math.pow(u-n,2))};var Ll=(t,e)=>(t[0]=e[0],t[1]=e[2],t);var Im=(t,e,n)=>(t[0]=e[0]+n[0],t[2]=e[2]+n[1],t);var o3=(t,e,n,i,s)=>{Xt(bt,e,i);let o=2*dn(n,bt),r=dn(bt,bt)-s*s,a=o*o-4*r;a>0?(t[0]=(-o-Math.sqrt(a))/2,t[1]=(-o+Math.sqrt(a))/2):t[0]=t[1]=-1},ql=(t,e,n,i,s,o)=>{Xt(bt,e,t),Xt(bn,n,t),Xi(Zr,bt,bn);let r=dn(s,Zr),a;if(r>0){if(!o)return 1/0;a=1}else if(r<0)a=-1,r=-r;else return 1/0;Xt(ms,i,t);let l=a*dn(s,Xi(bn,ms,bn));if(l<0)return 1/0;let c=a*dn(s,Xi(bt,bt,ms));if(c<0||l+c>r)return 1/0;let f=-a*dn(ms,Zr);return f<0?1/0:f/r};var r3=(t,e,n,i)=>{let s=0,o=0,r=1;e.length>2&&(s=i.findIndex(f=>f>=n),s<0&&(s=i.length),o=s>0?i[s-1]:0,r=s>=i.length?1:i[s]);let a=e[s],l=e[s+1],c=(n-o)/(r-o);return ul(t,a,l,c),s};var Vm=[0,0],Rl=[0,0],ti=[0,0],tt={},a3={},h9=function(t){return this.press.push(t),t},g9=function(t){return this.release.push(t),t},fn=(t,e)=>(e.press||(e.down=!1,e.onPress=h9,e.onRelease=g9,e.press=[],e.release=[],e.mappings=[],e.store||(e.store=ne(!1))),t=Array.isArray(t)?t:[t],t.forEach(n=>{a3[n]=e,e.mappings.push(n)}),t_.set(tt),e),l3=()=>{fn(oe.kbForward,tt.fwd={}),fn(oe.kbLeft,tt.left={}),fn(oe.kbBack,tt.back={}),fn(oe.kbRight,tt.right={}),fn(oe.kbNextTarget,tt.nextTarget={}),fn(oe.kbNextParty,tt.nextParty={}),fn(oe.kbUntarget,tt.untarget={}),fn(" ",tt.jump={}),fn(oe.kbAltForward,tt.fwd),fn(oe.kbAltBack,tt.back),fn(oe.kbTurnRight,tt.turnright={}),fn(oe.kbTurnLeft,tt.turnleft={}),fn("shift",tt.shift={}),fn("m0",tt.lmb={}),fn("m2",tt.rmb={}),fn("control",tt.ctrl={}),fn("alt",tt.alt={}),fn(oe.kbMap,tt.map={}),fn(oe.kbSkills,tt.skills={}).onPress(()=>{co.update(t=>!t),Mt(89)}),fn(oe.kbCharacter,tt.char={}).onPress(()=>{po.update(t=>!t),Mt(89)}),fn(oe.kbInventory,tt.inventory={}).onPress(()=>{lo.update(t=>!t),Mt(90)}),fn(oe.kbClan,tt.clan={}).onPress(()=>{fo.update(t=>!t),Mt(90)}),fn(oe.kbPvp,tt.pvp={}).onPress(()=>{uo.update(t=>!t),Mt(90)}),fn(oe.kbParty,tt.party={}).onPress(()=>{Zi.update(t=>!t),Mt(90)}),document.addEventListener("wheel",y9,{passive:!0}),document.addEventListener("keydown",x9,!1),document.addEventListener("keyup",w9,!1),document.addEventListener("contextmenu",k9,!1),document.addEventListener("mousedown",_9,!1),document.addEventListener("mouseup",b9,!1),document.addEventListener("mousemove",v9,!1)},c3=t=>{y1&&(y1=!1,oe.pointerlock&&!(tt.lmb.down||tt.rmb.down)&&(document.exitPointerLock(),Lm=!1))},Lf=0,v9=t=>{if(di(Vm,2*(t.x*oe.resolutionScale/Fi.width)-1,2*(1-t.y*oe.resolutionScale/Fi.height)-1),di(Rl,~~(t.x*oe.resolutionScale),~~(t.y*oe.resolutionScale)),tt.rmb.down||tt.lmb.down){let e=vt(t.movementX,-100,100),n=vt(t.movementY,-100,100);ti[1]=vt(ti[1]+n*.0028*(oe.invertMouseY?-oe.mouseSensitivity:oe.mouseSensitivity),-Math.PI/2,Math.PI/2),ti[0]=Vl(ti[0]-e*.005*(oe.invertMouseX?-oe.mouseSensitivity:oe.mouseSensitivity)),Lf+=Math.abs(n)+Math.abs(e)}},f3=!1;Pn.subscribe(t=>{f3=t!==void 0});var Lm=!1,y1=!1,_9=t=>{(t.target==Fi||t.target.id=="chat")&&(oe.pointerlock&&(Lm=!0,Fi.requestPointerLock()),Zo("m"+t.button,!0),f3&&Pn.update(e=>{e&&e.discard&&e.discard()}))},b9=t=>{Zo("m"+t.button,!1),Lf=0,y1=!0},y9=t=>{t.target==Fi&&Vp.update(e=>vt(e+(t.deltaY>0?1:-1),2,18))},k9=t=>{t.preventDefault()},Zo=(t,e,n)=>{let i=a3[t];return i!==void 0?(i.down!=e&&(i.down=e,i[e?"press":"release"].forEach(s=>{s(n)}),i.store.set(i.down)),n&&n.preventDefault(),!0):!1},x9=t=>{if(!u3(t))return;let e=t.key.toLowerCase();t.ctrlKey&&Zo("ctrl+"+e,!0,t)||t.shiftKey&&Zo("shift+"+e,!0,t)||Zo(e,!0,t)},w9=t=>{if(!u3(t))return;let e=t.key.toLowerCase();Zo("ctrl+"+e,!1),Zo("shift+"+e,!1),Zo(e,!1)},u3=t=>{let e=t.target.tagName.toLowerCase();return e!=="input"&&e!=="textarea"};var p3=(t,e,n,i)=>{window.gtag&&window.gtag("event",t,{event_category:e,event_label:n,value:i})};var k1=t=>1+(t-1)*.23,m3=t=>{let e=0;return t.forEach(n=>{e+=n.stats.getStat(18)}),F9(e,t.length)},F9=(t,e)=>t/Math.max(1,e)/100;var C9=[300,600,1e3,1400,2e3,2600,3200,4e3,4800,5700,6700,7700,8800,1e4,11500,13e3,14600,16400,18400,20400,22600,25100,27700,30400,33400,36600,4e4,43700,47500,51500,56200,61e3,66600,72500,78500,85300,92400,99700,107300,115700,124400,133400,142700,152300,162100],Jo=t=>C9[vt(t,1,45)-1];var qm=class{constructor(e){this.id=e.id,this.cd=e.cd!==void 0?e.cd:0,this.costMp=e.costMp,this.targetMode=e.targetMode||0,this.onCast=e.onCast,this.onPermanent=e.onPermanent,this.range=e.range||0,this.graceRange=this.range+Math.min(this.range*.2,10),this.auto=e.auto||!1,this.engineOnly=e.engineOnly||!1,this.minlevel=e.minlevel||0,this.castLen=e.castLen||0,this.gcd=e.gcd!==void 0?e.gcd:1.5,this.custom=e.custom,this.skilllevels=Math.min(5,e.skilllevels||5),this.goldValue=e.goldValue||0,this.noReward=e.noReward||!1,this.outOfCombat=e.outOfCombat||!1,this.pvpBoundsAdd=e.pvpBoundsAdd||0,this.ignoreGcd=e.ignoreGcd||!1,this.ignoreIncapacitated=e.ignoreIncapacitated||!1,this.disablingBuffs=e.disablingBuffs||[],this.hasteAffected=e.hasteAffected!==void 0?e.hasteAffected:!0,this.skillpoints=e.skillpoints!==void 0?e.skillpoints:1,this.envCast=e.envCast||0}can(e,n,i=0,s){if(this.outOfCombat&&!e.stats.combatTimer.done(D.time))return 11;if(this.costMp!==void 0&&e.stats.getResource(7)<this.costMp(n))return 5;if(this.targetMode!==1){let o=D.getEntityById(i),r=o===void 0||o.stats.alive,a=o===void 0?-1:e.hostility(o);if(this.targetMode===4096){if((a===-1||a===0)&&r)return 3;if(!e.canCombatInteract(o))return 13}else if(this.targetMode===256){if((a===-1||a!==0)&&r)return 4}else if(this.targetMode===16)o=e;else if(this.targetMode===17&&(o===void 0||o===e))return 3;if(o!==void 0&&!o.stats.alive)return 10;if(o&&i!==e.id&&o!==e&&this.range>0&&!e.combatRangeCheck(o,s?this.range:this.graceRange))return 6}return this.disablingBuffs.some(o=>e.buffs.hasAnyWithTag(o))?12:0}};var ke=class extends qm{constructor(e){super(e),this.fx=e.fx||{},this.autoSkillbar=e.autoSkillBar!==!1}};var Bl=(t,e,n,i)=>({id:t,minlevel:n,engineOnly:!1,cd:0,custom:i,autoSkillBar:!1,onPermanent:()=>e}),Ai=(t,e,n,i,s,o,r,a)=>({id:t,targetMode:16,minlevel:n,cd:s,costMp:r,fx:a,onCast:(l,c,f)=>({id:e,mode:4,stacks:1,duration:i,caster:l.id,target:l.id,aoe:{faction:!0,limit:o,circleRadius:30,circleHeight:20},level:c})}),Rm=(t,e,n,i,s,o,r,a=5,l)=>({id:t,targetMode:256,range:30,minlevel:n,cd:s,castLen:i,costMp:r,fx:l,onCast:(c,f,u)=>({id:e,mode:a,stacks:1,caster:c.id,target:u,refresh:!0,duration:o,level:f})}),aa=(t,e,n=0,i=!0,s,o=!1,r=!1,a)=>({id:t,targetMode:16,cd:e,gcd:0,hasteAffected:!1,ignoreIncapacitated:o,ignoreGcd:!0,castLen:n,engineOnly:!0,outOfCombat:s,fx:a});var d3=new ke(Bl(21,77,1));var h3=new ke({id:2,targetMode:16,minlevel:5,cd:30,gcd:0,costMp:t=>3+t*5,fx:{animCast:6},custom:[[t=>7+t*12," heal on block"]],onCast:(t,e,n)=>({id:59,mode:4,stacks:1,duration:9,caster:t.id,target:t.id,level:e})});var g3=t=>.7+t*.2,S9=t=>g3(t)+30/(250/20),v3=new ke({id:33,targetMode:17,skilllevels:1,minlevel:11,cd:15,range:30,disablingBuffs:[4],costMp:t=>12,custom:[[g3,"s stunned at min range"],[S9,"s stunned at max range"]],onCast:(t,e,n)=>{}});var _3=new ke(Ai(20,76,15,300,150,20,t=>t*8,{animCast:6}));var b3=new ke({id:18,cd:0,minlevel:8,autoSkillBar:!1,fx:{},onPermanent:()=>73});var y3=new ke({id:3,targetMode:1,minlevel:3,cd:6,costMp:t=>2+t*2,fx:{animCast:5,effectDirImpact:9},onCast:(t,e,n)=>({id:3,mode:0,caster:t.id,dmg:t.stats.getDamageRoll()*(1+e*.18),type:1,aoe:{faction:!1,circleRadius:2+5*t.size}})});var k3=new ke({id:17,targetMode:16,minlevel:13,cd:50,gcd:0,costMp:t=>t*8,fx:{animCast:6},onCast:(t,e,n)=>({id:72,mode:4,stacks:1,duration:17,caster:t.id,target:t.id,level:e})});var x3=new ke({id:50,targetMode:1,minlevel:7,cd:30,costMp:t=>t*4,fx:{animCast:40},custom:[[t=>20+t*5," % missing + 100 HP recovered"]],onCast:(t,e,n)=>({id:121,mode:4,stacks:1,caster:t.id,buffdata:[0],sendBuffData:!0,duration:1+e,level:e,aoe:{faction:!1,circleRadius:8}})});var A9=t=>t*8,w3=new ke({id:1,targetMode:4096,minlevel:1,cd:1,range:2,custom:[[A9,"% chance to daze target for 3 seconds"]],costMp:t=>1+t,fx:{animImpact:3},onCast:(t,e,n)=>{let i=5+t.stats.getDamageRoll()*(.38+e*.39);return{id:1,mode:0,caster:t.id,target:n,dmg:i,type:1}}});var M3=t=>1e4+t*1e4,P9=(t,e)=>{if(e.type===1){let n=0;e.aggroValues.forEach((i,s)=>{i>n&&(n=i)}),e.aggroValues.set(t.caster,n+M3(t.level)),e.buffs.buffs.has(122)&&add({id:125,mode:5,stacks:t.level,caster:e.id,target:t.caster,refresh:!0,duration:60,level:1})}},F3=new ke({id:34,targetMode:1,minlevel:6,cd:15,costMp:t=>t*4,fx:{animCast:7},custom:[[M3," aggro generation"]],onCast:(t,e,n)=>({custom:P9,id:89,mode:4,stacks:1,caster:t.id,duration:2+e,level:e,aoe:{faction:!1,circleRadius:10}})});var C3=new ke({id:41,targetMode:16,minlevel:25,cd:30,skilllevels:1,gcd:0,costMp:t=>3+t*5,onCast:(t,e,n)=>{}});var S3=new ke(Ai(19,75,18,300,150,20,t=>t*8,{animCast:6}));var A3=new ke({id:46,targetMode:1,range:30,minlevel:4,cd:30,castLen:0,costMp:t=>10+t*3,fx:{effectTarget:106},onCast:(t,e,n)=>{}});var P3=new ke(Ai(22,78,17,300,120,20,t=>5+t*10,{animCast:6}));var T3=new ke(Rm(24,80,15,1.5,0,300,t=>2+t*3,4,{animCast:9,animChannel:18}));var E3=new ke({id:52,targetMode:1,minlevel:7,envCast:7,cd:6,range:25,costMp:t=>t*2,fx:{effectMissile:107,effectTarget:111},onCast:(t,e,n,i,s,o)=>{}});var D3=new ke({id:14,targetMode:1,minlevel:3,cd:25,costMp:t=>t*4,fx:{animCast:31},onCast:(t,e,n)=>({id:69,mode:4,stacks:1,caster:t.id,duration:5.5+e*.5,level:e,aoe:{faction:!1,circleRadius:8}})});var I3=new ke({id:16,targetMode:16,minlevel:13,cd:45,gcd:0,fx:{animCast:6},onCast:(t,e,n)=>({id:71,mode:4,stacks:1,duration:12,caster:t.id,target:t.id,level:e})});var V3=new ke({id:53,targetMode:16,minlevel:9,cd:80,gcd:0,ignoreIncapacitated:!0,ignoreGcd:!0,costMp:t=>t*5,onCast:(t,e,n)=>({id:117,mode:4,duration:5,stacks:1,caster:t.id,target:t.id,level:e})});var L3=new ke({id:4,targetMode:4096,range:30,minlevel:1,cd:0,castLen:1.5,custom:[[t=>100+t*10,"% frozen buff multiplier"]],costMp:t=>1+t*2,fx:{animCast:29,effectDirImpact:30,animChannel:30,effectMissile:27},onCast:(t,e,n)=>({id:4,mode:6,speed:25,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.3+e*.32),type:1}),onPermanent:()=>100});var q3=t=>2+t*2,R3=new ke({id:23,targetMode:16,minlevel:5,cd:60,gcd:0,costMp:t=>t*5,custom:[[q3," attacks blocked"]],fx:{animCast:6},onCast:(t,e,n)=>({id:79,mode:4,stacks:q3(e),duration:60,caster:t.id,target:t.id,level:e})});var B3=new ke({id:15,targetMode:1,range:30,minlevel:8,cd:8,castLen:1.5,costMp:t=>5+t*5,fx:{animCast:29,animChannel:30,effectDirImpact:31,effectMissile:28},onCast:(t,e,n)=>({id:15,mode:6,speed:10,timeout:2.5,caster:t.id,rot:t.rot,dmg:10+t.stats.getDamageRoll()*(.56+e*.6),type:1,aoe:{circleRadius:4+e*.5,faction:!1,onlyOnce:[]}})});var z3=new ke({id:51,targetMode:4096,range:30,minlevel:4,cd:10,castLen:2.8,costMp:t=>1+t*2,fx:{animCast:37,effectDirImpact:119,animChannel:30,effectMissile:118},onCast:(t,e,n)=>({id:51,mode:6,speed:20,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(1.25+e*1.33),type:1,noBlock:!0})});var T9=()=>12,$3=new ke({id:32,targetMode:1,skilllevels:1,minlevel:5,gcd:.7,cd:12,disablingBuffs:[4],costMp:t=>t*4,fx:{animCast:32},custom:[[T9,"m distance"]],onCast:(t,e,n)=>{}});var U3=new ke({id:37,targetMode:4096,range:30,minlevel:15,cd:40,castLen:2.3,costMp:t=>5+t*5,fx:{animCast:9,effectImpact:50,animChannel:16},onCast:(t,e,n)=>({id:91,mode:4,stacks:1,caster:t.id,target:n,duration:2.4+e*1,level:e})});var O3=new ke(Ai(28,84,12,15,60,15,t=>1+t*3,{animCast:6}));var N3=new ke({id:12,targetMode:4096,range:30-5,minlevel:1,castLen:0,cd:3,costMp:t=>Math.round(1+t*4.5),fx:{animCast:10,effectMissile:48},onCast:(t,e,n)=>({id:12,mode:6,dmg:5+t.stats.getDamageRoll()*(.03+e*.13),type:1,speed:15,caster:t.id,target:n,level:e})});var j3=new ke({id:30,targetMode:1,range:30,minlevel:18,cd:60,castLen:2.3,costMp:t=>10+t*8,fx:{effectImpact:70,animCast:14,animChannel:15,effectMissile:69},onCast:(t,e,n)=>({id:30,mode:6,speed:0,timeout:30,caster:t.id,rot:t.rot,interval:new kt(0,2),heal:t.stats.getDamageRoll()*(.08+e*.05),type:1,aoe:{circleRadius:30,circleHeight:30,faction:!0,limit:15}})});var W3=new ke(Ai(13,68,6,15,90,15,void 0,{animCast:22}));var G3=new ke({id:6,targetMode:256,range:30,minlevel:8,cd:0,castLen:1.7,costMp:t=>4+t*4,fx:{animCast:11,effectImpact:36,animChannel:12},onCast:(t,e,n)=>({id:6,mode:2,caster:t.id,target:n,heal:15+t.stats.getDamageRoll()*(.2+e*.18)})});var H3=new ke({id:47,targetMode:256,range:30,minlevel:14,cd:12,castLen:0,costMp:t=>4+t*4,fx:{animCast:9,effectTarget:112},custom:[[t=>t," effects removed"]],onCast:(t,e,n)=>{let i=0;return{id:47,mode:2,caster:t.id,target:n,heal:(1+i)*(15+t.stats.getDamageRoll()*.25)}}});var E9=t=>1+t*2,D9=t=>1+t*2,Y3=new ke(Bl(43,106,3,[[E9,"% haste per stack"],[D9," jumps"]]));var X3=new ke(Rm(7,60,3,0,0,12,t=>2+t*2,5,{animCast:9}));var I9=t=>Math.round(t*1.3),V9=t=>t*2,Q3=new ke({id:42,targetMode:1,minlevel:8,cd:8,castLen:0,range:30-5,custom:[[I9," mana gained per soul"],[V9," extended Decay duration"]],costMp:t=>1+t*3,fx:{animCast:13,effectImpact:46},onCast:(t,e,n)=>({id:42,mode:1,caster:t.id,target:0,type:1,dmg:4+t.stats.getDamageRoll()*(.25+e*.4),level:e})});var Z3=new ke({id:105,engineOnly:!0,cd:0,fx:{effectImpact:47,effectMissile:45}});var J3=new ke({id:36,targetMode:16,minlevel:10,cd:30,gcd:0,costMp:t=>8+t*2,onCast:(t,e,n)=>({id:90,mode:4,stacks:1,duration:5+e*5,caster:t.id,target:t.id,level:e})});var K3=new ke({id:35,targetMode:1,skilllevels:1,minlevel:5,cd:120,skillpoints:0,castLen:5,outOfCombat:!0,hasteAffected:!1,pvpBoundsAdd:5,costMp:t=>20+t*5,fx:{animCast:20,animChannel:21},onCast:(t,e,n)=>{}});var ek=new ke({id:49,targetMode:4096,range:30,minlevel:13,cd:25,costMp:t=>1+t*1,fx:{animCast:38,effectMissile:123,animChannel:28},onCast:(t,e,n)=>({id:49,buffid:119,mode:7,speed:60,caster:t.id,level:e,stacks:1,duration:1+e*2,refresh:!0,target:n})});var tk=new ke({id:54,targetMode:4096,range:30,minlevel:8,cd:10,castLen:2.8,costMp:t=>8+t*3,fx:{animCast:39,effectDirImpact:121,animChannel:25,effectMissile:114},onCast:(t,e,n)=>({id:54,mode:6,speed:60,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(1.25+e*1.33),type:1,noBlock:!0})});var nk=new ke(Bl(26,82,15));var L9=t=>3+t*5,ik=new ke({id:11,targetMode:16,minlevel:7,cd:50,gcd:0,fx:{animCast:6},custom:[[L9,"% of max mp recovered"]],onCast:(t,e,n)=>({id:66,mode:4,stacks:1,duration:17,caster:t.id,target:t.id,level:e})});var sk=new ke(Ai(27,83,12,10,80,20,t=>5+t*7,{animCast:6}));var ok=new ke({id:29,cd:0,minlevel:9,autoSkillBar:!1,onPermanent:()=>85});var rk=new ke({id:9,targetMode:4096,range:30,minlevel:3,cd:6,castLen:1.7,costMp:t=>2+t*3,fx:{animCast:24,effectDirImpact:85,animChannel:25,effectMissile:33},onCast:(t,e,n)=>({id:9,mode:6,speed:120,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.53+e*.45),type:1})});var ak=new ke({id:10,targetMode:16,minlevel:5,cd:0,autoSkillBar:!1,skillpoints:0,onPermanent:()=>65});var lk=new ke({id:38,targetMode:16,minlevel:5,skilllevels:1,cd:10,gcd:0,disablingBuffs:[4],costMp:t=>6,fx:{animCast:23},onCast:(t,e,n)=>!0});var ck=new ke({id:31,targetMode:4096,range:30,minlevel:1,cd:0,castLen:1.5,costMp:t=>1+t*1,fx:{animCast:27,effectDirImpact:84,effectMissile:34,animChannel:28},onCast:(t,e,n)=>({id:31,mode:6,speed:60,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.24+e*.25),type:1})});var fk=new ke(Ai(25,81,18,300,120,20,t=>5+t*5,{animCast:6}));var uk=new ke({id:48,targetMode:4096,range:30,minlevel:6,cd:20,ignoreGcd:!0,costMp:t=>1+t*1,fx:{animCast:36,effectDirImpact:115,effectMissile:113,animChannel:28},custom:[[t=>t*120," HP recovered"]],onCast:(t,e,n)=>({id:48,mode:6,speed:80,caster:t.id,target:n,dmg:5+t.stats.getDamageRoll()*(.28+e*.28),type:1})});var pk=new ke({id:106,engineOnly:!0,cd:0,fx:{effectMissile:116,effectImpact:117}});var mk=new ke({id:45,targetMode:1,range:30,minlevel:4,cd:25,castLen:0,costMp:t=>18+t*3,fx:{effectDirImpact:11,effectMissile:103},onCast:(t,e,n)=>{}});var q9={medalValue:1e3,goldValue:5e4,buyElo:1600,quality:90,level:45,gs:30,uniqueEquipped:!0},x1=[{id:0,custom:["Use: Removes all movement limiting effects."],useCd:60,incap:!0,animCast:45},{id:1,custom:["Use: Protects you against 30% of incoming damage for 10 seconds."],useCd:60,animCast:6,incap:!1},{id:2,custom:["Use: Increases your damage by 20% for 10 seconds."],useCd:80,incap:!1,animCast:6},{id:3,custom:["Use: Speeds up your movement by 45 for 8 seconds."],useCd:50,incap:!1,animCast:6},{id:4,custom:["Use: Attacks made against you grant 20 MP (up to 200) for 20 seconds."],useCd:60,incap:!1,animCast:6}],dk=t=>{x1.forEach((e,n)=>{t["charm"+e.id]={...q9,...e,type:"charm",tier:e.id,useSkill:107+n}})};var hk=new ke(aa(100,30,0,!0,!0,!1,!1,{animCast:17})),gk=new ke(aa(101,1.5,0,!0,!1,!1,!1)),vk=new ke(aa(104,1.5,0,!1,!1,!1,!1,{animCast:6})),_k=new ke(aa(103,1.5,3,!0,!1,!1,!1,{animCast:19,animChannel:18})),bk=new ke(aa(102,1.5,1.5,!1,!0,!1,!1,{animCast:9,animChannel:18})),yk=x1.map((t,e)=>new ke(aa(107+e,t.useCd,0,!1,!1,t.incap,!0,{animCast:t.animCast}))).reduce((t,e)=>({...t,["charm"+e.id]:e}),{});var kk=new ke({id:5,targetMode:4096,range:30,engineOnly:!0,auto:!0,cd:t=>100/t.stats.getStat(17),fx:{animCast:26,effectDirImpact:11,effectMissile:32},onCast:(t,e,n)=>({id:5,mode:6,speed:15*3,caster:t.id,target:n,dmg:t.stats.getDamageRoll(),type:0})});var xk=new ke({id:56,targetMode:1,range:50,cd:10,engineOnly:!0,castLen:2,fx:{animCast:41,animChannel:42}});var wk=new ke({id:44,targetMode:1,range:50,minlevel:3,cd:5,engineOnly:!0,castLen:1.5,costMp:t=>t*4});var Mk=new ke({id:55,targetMode:1,range:50,minlevel:3,cd:20,engineOnly:!0,castLen:2,fx:{effectMissile:131,animCast:43,animChannel:42}});var Fk=new ke({id:58,targetMode:1,range:10,cd:2,engineOnly:!0,hasteAffected:!1,castLen:30,fx:{animCast:9,animChannel:44}});var Ck=new ke({id:57,targetMode:4096,engineOnly:!0,fx:{effectMissile:153,effectDirImpact:154}});var Sk=new ke({id:0,targetMode:4096,engineOnly:!0,auto:!0,range:2,cd:t=>100/t.stats.getStat(17),fx:{animImpact:4},onCast:(t,e,n)=>({id:0,mode:0,caster:t.id,target:n,dmg:t.stats.getDamageRoll(),type:0})});var Ak=new ke({id:39,engineOnly:!1,skilllevels:1,minlevel:30,cd:0,goldValue:25e3,skillpoints:0,noReward:!0,autoSkillBar:!1});var Pk=new ke({id:40,targetMode:1,engineOnly:!0,cd:300,castLen:5,outOfCombat:!0,hasteAffected:!1,costMp:t=>20+t*5,fx:{animCast:9,animChannel:8},onCast:(t,e,n)=>{}});var Tk=new ke({id:8,engineOnly:!0,cd:0,onPermanent:t=>t.class+61});var R9={...yk,hellspawn_missile:Ck,conjurer_obeliskport:Fk,boss_bigaoe:xk,boss_puddledot:Mk,recall:Pk,arrow:kk,melee:Sk,potion:hk,book:gk,specialization:Tk,mount:Ak,activatemount:bk,container:_k,boss_flamepits:wk,useGeneric:vk},B9={relentlessCry:x3,whirlwind:A3,temper:C3,taunt:F3,charge:v3,warcry:S3,courage:_3,armorreinforcement:d3,enrage:k3,slash:w3,blockBuff:h3,crescentStrike:y3,crescentBleed:b3},z9={frostcall:E3,iceblock:V3,shatterfrost:z3,teleport:$3,enchantment:T3,arcticaura:P3,iceshield:R3,hypothermic:I3,frostnova:D3,icebolt:L3,icicle:B3},$9={vampiricarrowReturn:pk,boneshot:tk,blindingshot:ek,vampiricarrow:uk,volley:mk,snipe:lk,poisonarrows:ok,temporaldilation:fk,pathfinding:sk,preciseShot:rk,serpentArrows:ak,invigorate:ik,swiftshot:ck,cranialpunctures:nk},U9={mimirscleanse:H3,soulharvestReturn:Z3,plaguespreader:Y3,soulharvest:Q3,agonize:U3,caninehowl:O3,mana:W3,mend:G3,revitalize:X3,decay:N3,healingtotem:j3,summon:K3,spiritanimal:J3},Pt=new Map;[B9,z9,$9,U9,R9].forEach((t,e)=>{for(let n in t)e<=3&&(t[n].class=e),Pt.set(t[n].id,t[n])});Pt.set(60,new ke({id:60,engineOnly:!0}));var Dk=[1600,1800,2e3,2200],Ek=Dk.length,zl=t=>{for(let e=0;e<Ek;++e)if(Dk[e]>t)return e;return Math.max(0,Ek)},O9=10,N9=30,j9=240,W9=-.0015,G9=930,H9=100,qf=t=>O9+Math.round(Math.max(t/N9,j9*(1-Math.exp(W9*(t-G9)))-H9));var Y9=[0,0,1,1,2,3],w1=(t,e)=>"book"+(e!==void 0?e:"")+Y9[t%5],Rf=(t,e,n,i)=>`https://raw.githubusercontent.com/2f147f0487a9fe5b/cb2e2197348007b8/main/${t}/${t=="book"?w1(e,n):t+e}_q${i}.webp?v=8582889`,Bf=t=>`/data/ui/skills/${t}.${Gn}?v=8582889`,Ik=t=>`/data/ui/slotbg/${t}.${zn}?v=8582889`,Vk=(t,e,n)=>`/data/world/${t}/map/${e}/${n}.${Gn}?v=8582889`,Ys=t=>`/data/ui/classes/${t}.${zn}?v=8582889`,M1=t=>`/data/ui/factions/${t}.${zn}?v=8582889`,Lk=t=>`/data/ui/elo/${zl(t)}.svg?v=8582889`,qk="/data/ui/currency/medal.svg?v=8582889",$l="/data/ui/currency/prestige.svg?v=8582889",Ko="/data/ui/currency/fame.svg?v=8582889",Rk=t=>`/data/ui/rank/rank${t}.svg?v=8582889`;var Bk=t=>{Pt.forEach(e=>{if(!e.engineOnly)for(let n=0;n<e.skilllevels;++n){let i=e.id*5+n;t[`book${i}`]={type:"book",tier:i,level:e.minlevel+n*8,skillid:e.id,skilllevel:n,class:e.class,noReward:e.noReward||!1,goldValue:e.goldValue||(e.minlevel+n*5<5?4:0),quality:Math.round(Math.min(99,30+70*(n/5))),art:w1(i,e.class),useSkill:101}}})};var X9=[{id:0,storeValue:300,quality:90,level:1,custom:["Contains random mount (account bound) of rare or epic quality"],bindOnPurchase:1,useSkill:103},{id:1,storeValue:900,quality:90,level:1,custom:["Adds one month of Elixir to your account"],bindOnMerchant:1,useSkill:103},{id:2,storeValue:700,quality:90,level:1,bindOnMerchant:1,custom:["Used to upgrade rare pets, allowing them to pick up items."]}],zk=t=>{X9.forEach(e=>{t["box"+e.id]={...e,type:"box",tier:e.id,unsellable:!0}})};var Ri={hammer:{sound:119,rot:1},bow:{sound:120,rot:1},staff:{sound:120,rot:1},sword:{sound:119,rot:1},armlet:{sound:121},armor:{sound:122},bag:{sound:121},boot:{sound:121},glove:{sound:121},ring:{sound:123},amulet:{sound:123},quiver:{sound:121,rot:1},shield:{sound:122},totem:{sound:122,rot:1},orb:{sound:122},rune:{sound:123,rot:0},misc:{sound:124,rot:1},book:{sound:121},mount:{sound:121,rot:0},pet:{sound:121,rot:0},box:{sound:125,rot:0},gold:{sound:126},charm:{sound:123}},Sn={hammer:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:3,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:15,min:.05,max:.1}},stackable:!1},bow:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:2,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}},stackable:!1},staff:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:1,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}},stackable:!1},sword:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:0,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:20,min:.05,max:.1}},stackable:!1},armlet:{baselvl:1,slot:[102],tiers:13,drop:1,weight:.3,stats:{6:{base:10,min:.5,max:.9},12:{base:7,min:.5,max:.8}},stackable:!1},armor:{baselvl:2,slot:[103],tiers:11,drop:1,weight:1,stats:{12:{base:10,min:1.4,max:2.8},6:{base:20,min:1,max:2}},stackable:!1},bag:{baselvl:5,slot:[104],tiers:5,drop:1,weight:.1,stats:{19:{base:1,min:.1,max:.3}},stackable:!1},boot:{baselvl:2,slot:[105],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.6,max:1.1},15:{base:3,min:.03,max:.1}},stackable:!1},glove:{baselvl:2,slot:[106],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.7,max:1.1},14:{base:1,min:.1,max:1.5}},stackable:!1},ring:{baselvl:5,slot:[107],tiers:12,drop:.8,weight:.2,stats:{6:{base:10,min:.5,max:.9},7:{base:5,min:.6,max:1}},stackable:!1},amulet:{baselvl:7,slot:[108],tiers:12,drop:.8,weight:.3,stats:{7:{base:10,min:1,max:1.8},9:{base:1,min:.2,max:.3}},stackable:!1},quiver:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:2,stats:{14:{base:5,min:.1,max:.9},9:{base:1,min:.1,max:.3}},stackable:!1},shield:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:0,stats:{12:{base:20,min:.8,max:1.4},13:{base:4,min:1,max:2.8}},stackable:!1},totem:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:3,stats:{12:{base:10,min:.4,max:.9},9:{base:1,min:.1,max:.4}},stackable:!1},orb:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:1,stats:{3:{base:10,min:.3,max:.7},9:{base:1,min:.1,max:.3}},stackable:!1},rune:{baselvl:1,tiers:11,drop:.8,quality:70,stackable:!0},misc:{drop:8,weight:.1,stackable:!0},book:{drop:1.6,weight:.5,stackable:!0},charm:{slot:[110,111],noupgrade:!0,undroppable:!0,drop:0,stackable:!1},mount:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},box:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},pet:{undroppable:!0,drop:0,stackable:!1},gold:{drop:24}},$k=Object.keys(Sn),zf={6:{min:.2,max:.8,round:!0},7:{min:.2,max:.5,round:!0},8:{min:.1,max:1},9:{min:.1,max:.5},10:{min:.03,max:.13,round:!0},11:{min:.1,max:.2,round:!0},12:{min:.1,max:.8,round:!0},13:{min:.1,max:.4},14:{min:.1,max:.5},16:{min:.1,max:.4},2:{min:.08,max:.45,round:!0},0:{min:.08,max:.45,round:!0},3:{min:.08,max:.45,round:!0},4:{min:.08,max:.45,round:!0},1:{min:.08,max:.45,round:!0},5:{min:.08,max:.45,round:!0},18:{min:.01,max:.15,round:!0}},Uk=Object.keys(zf),$f={6:4,7:3,8:5,9:4,10:1,11:1,12:5,13:5,14:5,15:.3,16:5,17:0,2:2,0:2,3:2,4:2,1:2,5:2,19:1,18:2};var Ok=t=>{for(let e in Sn)if(Sn[e].tiers){let n=Sn[e];for(let i=0;i<n.tiers;++i)Z9({type:e,tier:i,stats:n.stats,level:Q9(e,i),class:n.class,quality:n.quality},t)}},Q9=(t,e)=>Sn[t].baselvl+Math.floor(e/Sn[t].tiers*100),Z9=(t,e)=>{let n={level:t.level,type:t.type,tier:t.tier,stats:t.stats?new Map:void 0,class:t.class,quality:t.quality};t.stats&&Object.keys(t.stats).sort((i,s)=>i-s).forEach(i=>{let s=t.stats[i];n.stats.set(parseInt(i),{min:s.base+t.level*s.min,max:s.base+(t.level+10)*s.max})}),e[t.type+t.tier]=n};var J9=[250,100,500,200,1e3,300],Nk=t=>{for(let e=0;e<6;++e){let n=Math.floor(e/2),i=e%2==0;t["misc"+e]={type:"misc",tier:e,level:1+n*20,goldvalue:5**n,quality:15,custom:[""+J9[e]+(i?" HP recovered":" MP recovered")],useSkill:100}}};var K9=[{lvl:30,g:1e4,qual:50,store:0,skin:6},{lvl:30,g:2e4,qual:50,store:0,skin:21},{lvl:30,g:5e4,qual:80,store:300,skin:51},{lvl:30,g:5e4,qual:80,store:300,skin:52},{lvl:30,g:5e4,qual:95,store:1200,skin:22},{lvl:30,g:5e4,qual:90,store:600,skin:23},{lvl:30,g:5e4,qual:80,store:300,skin:24},{lvl:30,g:5e4,qual:90,store:600,skin:25},{lvl:30,g:5e4,qual:95,store:1200,skin:27},{lvl:30,g:5e4,qual:95,store:1200,skin:28},{lvl:30,g:5e4,qual:80,store:300,skin:30},{lvl:30,g:5e4,qual:95,store:1200,skin:31},{lvl:30,g:5e4,qual:95,store:1200,skin:32},{lvl:30,g:5e4,qual:85,store:400,skin:29},{lvl:30,g:5e4,qual:95,store:1200,skin:33},{lvl:30,g:5e4,qual:95,store:0,skin:94},{lvl:30,g:5e4,qual:95,store:0,skin:95},{lvl:30,g:5e4,qual:95,store:0,skin:96},{lvl:30,g:5e4,qual:95,store:0,skin:97},{lvl:30,g:5e4,qual:95,store:0,skin:98},{lvl:30,g:5e4,qual:95,store:0,skin:100},{lvl:30,g:5e4,qual:95,store:0,skin:101},{lvl:30,g:5e4,qual:95,store:0,skin:93},{lvl:30,g:5e4,qual:95,store:0,skin:91},{lvl:30,g:5e4,qual:95,store:0,skin:99},{lvl:30,g:5e4,qual:95,store:0,skin:92}].map(t=>({level:t.lvl,goldValue:t.g,storeValue:t.store,bindOnUse:1,bindOnMerchant:t.store>0?1:0,quality:t.qual,skin:t.skin})),jk=t=>{K9.forEach((e,n)=>{t["mount"+n]={...e,type:"mount",tier:n,requiredSkill:39,useSkill:102}})};var e7=[1919,1920,1944,1945,1946,1947,1948,1960,1968,1969,1970,1971,1972,1973,1974,1975],Wk=t=>{e7.forEach((e,n)=>{t["pet"+n]={level:10,unsellable:!0,storeValue:e>1920?0:900,quality:90,bindOnUse:1,bindOnMerchant:e>=1968?0:1,type:"pet",tier:n,useSkill:104,skin:e}})};var rn={};Ok(rn);Nk(rn);Bk(rn);jk(rn);dk(rn);Wk(rn);zk(rn);var tr=Object.values(rn);tr.forEach((t,e)=>t.id=e);var Pi=[{step:10,fun:()=>tt.fwd.down||tt.left.down||tt.right.down},{step:10,fun:()=>tt.lmb.down||tt.rmb.down,click:!0},{click:!0},{element:"ufplayer",click:!0},{},{element:"uftarget",click:!0},{element:"sk1"},{},{click:!0},{element:"expbar",click:!0},{},{element:"sysbag",step:100,fun:()=>oe.inventoryOpen},{element:"bag2",click:!0},{click:!0},{element:"syschar",step:100,fun:()=>oe.charpanelOpen},{element:"equipslots",click:!0},{fixed:()=>D.player.stats.getStat(22)>0?100:Math.round(D.player.exp/Jo(D.player.level)*100)},{element:"syschar",step:100,fun:()=>oe.charpanelOpen},{element:"statpoints"},{step:100,fixed:()=>Math.round(D.player.exp/Jo(D.player.level)*100),fun:()=>D.player.level>3},{click:!0},{fixed:()=>Math.round(D.player.inventory.gold/32*100)},{fun:()=>oe.traderWindow},{element:()=>{let t=0;return Pf.forEach(e=>{let n=rn[e.type+e.tier];n.type==="book"&&n.level===3&&n.class===D.player.class&&(t=e.id)}),"trader"+t}},{element:"bag0",click:!0},{element:"sysbook",step:100,fun:()=>oe.skillmenuOpen},{element:"skilllist",click:!0},{element:"tutsetskillpoint",click:!0},{element:"tutapplyskills",click:!0},{element:"skillbar",click:!0},{click:!0},{click:!0},{click:!0},{click:!0,element:"partybtn"},{click:!0},{click:!0},{click:!0},{click:!0},{click:!0},{click:!0},{element:"chat"},{element:"chatinput"},{element:"syscog",step:100,click:!0,fun:()=>oe.settingsOpen},{click:!0},{step:100,fun:()=>!oe.settingsOpen},{click:!0},{click:!0},{gate:()=>D.player.level>=25,click:!0}],Gk=!1,t7=()=>{F1.reset(D.smoothtime),Gk||(Gk=!0,Os.subscribe(t=>{let e=Pi[t];e&&(e.gate===void 0||e.gate())?zo.set(Hk(t)):zo.set()}))},Hk=t=>(Mt(91),{...Pi[t],msg:S.ui.tutorial.msg[t],progress:0}),F1=new kt(0,.2),n7=()=>{let t=Pi[oe.tutprogress];t&&F1.done(D.smoothtime)&&(F1.reset(D.smoothtime),(t.gate===void 0||t.gate())&&(t.gate&&t.gate()&&tn(oe.tutprogress,void 0,1),t.fun&&t.fun()&&tn(oe.tutprogress,t.step),t.fixed&&tn(oe.tutprogress,void 0,t.fixed())))},tn=(t,e,n)=>(n||e>0)&&(t===-1||oe.tutprogress===t)?(zo.update(i=>i?(i.progress=Math.min(100,n||i.progress+e),i.complete=i.progress>=100,i.complete&&!i.closing&&(i.closing=!0,Mt(92),setTimeout(()=>{zo.set(),setTimeout(()=>{Os.update(s=>(p3("tutorial","completestep",s,Math.round(performance.now()/1e3)),Pi[s+1]&&Pi[s+1].element&&typeof Pi[s+1].element!="string"&&(Pi[s+1].element=Pi[s+1].element()),s+1))},100)},1e3)),i):Hk(t)),!0):!1;var nn={partyleave:t=>({name:S.ui.party.leave,fun:()=>{xt("partyleave")}}),partyinvite:t=>({name:S.ui.party.invite,fun:()=>{xt("partyinvite",t)}}),partykick:t=>({name:S.ui.party.kick,fun:()=>{xt("partykick",t)}}),partygiveassistant:t=>({name:S.ui.party.giveAssistant,fun:()=>{xt("partysetrole",t+" 1")}}),partygiveleader:t=>({name:S.ui.party.giveLeader,fun:()=>{xt("partysetrole",t+" 2")}}),partyremoveassistant:t=>({name:S.ui.party.removeAssistant,fun:()=>{xt("partysetrole",t+" 0")}}),partycreate:t=>({name:S.ui.party.create,fun:()=>{xt("partycreate")}}),whisper:t=>({name:S.ui.chat.whisper,fun:()=>{Qi.set(t)}}),itemdrop:(...t)=>({name:S.ui.inventory.drop,fun:()=>S1(...t)}),itemsell:(...t)=>({name:S.ui.inventory.sell,fun:()=>Uf(...t)}),itemstash:t=>({name:S.ui.stash.stash,fun:()=>{xt("itemstash",t)}}),itemmove:(t,e)=>({name:S.ui.inventory.equip,fun:()=>{tn(13,100),xt("itemmove",`${t} ${e}`)}}),itemsplithalf:t=>({name:S.ui.inventory.splithalf,fun:()=>{xt("itemsplithalf",t)}}),itemsplitone:t=>({name:S.ui.inventory.splitone,fun:()=>{xt("itemsplitone",t)}}),itemuse:(t,e,n,i)=>({name:S.ui.inventory.use,fun:()=>{mm(n<i,()=>Si(Ft.clientPlayerSkill.packData({id:e,info:[t]})),"Bind Item","Using this item will bind it to you. Continue?")}}),itemcopyid:t=>({name:S.ui.inventory.copyitemid,fun:()=>{yy(t)}}),report:(t,e,n)=>({name:"Report",fun:i=>{oo.set({name:t,reason:0,messageId:e,info:n})}})},Yk=(t,e)=>{let n=[{name:e.name,css:"disabled"}];e.type===0&&(e.id==D.playerId?oe.partyinfo.membercount>0?n.push(nn.partyleave()):n.push(nn.partycreate()):(e.faction==D.player.faction&&(en.has(e.name)?oe.partyinfo.role>e.role&&(oe.partyinfo.role==2&&n.push(nn.partykick(e.name)),e.role==0?n.push(nn.partygiveassistant(e.name)):e.role==1&&n.push(nn.partyremoveassistant(e.name)),oe.partyinfo.role>1&&n.push(nn.partygiveleader(e.name))):n.push(nn.partyinvite(e.name))),n.push(nn.report(e.name)),n.push(nn.whisper(e.name)))),wn.set({x:t.pageX,y:t.pageY,opts:n})},Xk=(t,e,n,i,s,o,r,a)=>{mm(e>=oe.itemProtectQuality||n>0,()=>{xt(t,`${i}`)},r,`${a} ${gn(s,o)}?`)},Uf=(t,e,n,i,s)=>{Xk("itemtradersell",t,e,n,i,s,"Sell item","Really sell")},S1=(t,e,n,i,s)=>{Xk("itemdrop",t,e,n,i,s,"Drop item","Really drop")};function Qk(t){let e,n;return{c(){e=h("img"),m(e,"class","icon svelte-erbdzy"),at(e.src,n="/data/ui/icons/gem.svg?v=8582889")||m(e,"src",n)},m(i,s){x(i,e,s)},d(i){i&&k(e)}}}function i7(t){let e,n,i,s,o,r,a,l,c=t[4]&&Qk(t);return{c(){e=h("span"),c&&c.c(),n=h("img"),s=T(t[1]),o=Ue(),r=h("span"),a=T(t[0]),m(n,"class","icon svelte-erbdzy"),at(n.src,i=Ys(t[2]))||m(n,"src",i),m(e,"class","textwhite"),m(r,"class",l="name textf"+t[3]+" svelte-erbdzy")},m(f,u){x(f,e,u),c&&c.m(e,null),d(e,n),d(e,s),d(e,o),x(f,r,u),d(r,a)},p(f,[u]){f[4]?c||(c=Qk(f),c.c(),c.m(e,n)):c&&(c.d(1),c=null),u&4&&!at(n.src,i=Ys(f[2]))&&m(n,"src",i),u&2&&G(s,f[1]),u&1&&G(a,f[0]),u&8&&l!==(l="name textf"+f[3]+" svelte-erbdzy")&&m(r,"class",l)},i:ce,o:ce,d(f){f&&(k(e),k(r)),c&&c.d()}}}function s7(t,e,n){let{name:i}=e,{level:s}=e,{pclass:o}=e,{faction:r}=e,{sub:a=!1}=e;return t.$$set=l=>{"name"in l&&n(0,i=l.name),"level"in l&&n(1,s=l.level),"pclass"in l&&n(2,o=l.pclass),"faction"in l&&n(3,r=l.faction),"sub"in l&&n(4,a=l.sub)},[i,s,o,r,a]}var A1=class extends we{constructor(e){super(),Ce(this,e,s7,i7,$e,{name:0,level:1,pclass:2,faction:3,sub:4})}},Bi=A1;var{Map:o7}=Sc;function Zk(t,e,n){let i=t.slice();return i[31]=e[n],i}function Jk(t,e,n){let i=t.slice();return i[34]=e[n],i}function Kk(t,e,n){let i=t.slice();return i[37]=e[n],i}function ex(t){let e,n,i,s,o;n=new Bi({props:{name:t[37].sender,pclass:t[37].cclass,level:t[37].level,faction:t[37].faction,sub:t[37].sub}});function r(...l){return t[14](t[37],...l)}function a(...l){return t[15](t[37],...l)}return{c(){e=h("span"),te(n.$$.fragment),m(e,"class","sender svelte-16y0b84")},m(l,c){x(l,e,c),K(n,e,null),i=!0,s||(o=[Q(e,"contextmenu",r),Q(e,"dblclick",a)],s=!0)},p(l,c){t=l;let f={};c[0]&32&&(f.name=t[37].sender),c[0]&32&&(f.pclass=t[37].cclass),c[0]&32&&(f.level=t[37].level),c[0]&32&&(f.faction=t[37].faction),c[0]&32&&(f.sub=t[37].sub),n.$set(f)},i(l){i||(P(n.$$.fragment,l),i=!0)},o(l){I(n.$$.fragment,l),i=!1},d(l){l&&k(e),ee(n),s=!1,ut(o)}}}function r7(t){let e,n=t[37].text+"",i,s;return{c(){e=h("span"),i=T(n),m(e,"class",s="text"+t[37].channel+" svelte-16y0b84")},m(o,r){x(o,e,r),d(e,i)},p(o,r){r[0]&32&&n!==(n=o[37].text+"")&&G(i,n),r[0]&32&&s!==(s="text"+o[37].channel+" svelte-16y0b84")&&m(e,"class",s)},d(o){o&&k(e)}}}function a7(t){let e,n=t[37].text+"",i;return{c(){e=h("span"),m(e,"class",i="text"+t[37].channel+" svelte-16y0b84")},m(s,o){x(s,e,o),e.innerHTML=n},p(s,o){o[0]&32&&n!==(n=s[37].text+"")&&(e.innerHTML=n),o[0]&32&&i!==(i="text"+s[37].channel+" svelte-16y0b84")&&m(e,"class",i)},d(s){s&&k(e)}}}function tx(t,e){let n,i,s,o=e[37].time+"",r,a,l,c=e[37].channel+"",f,u,p,g,v=e[37].sender&&ex(e);function _(w,C){return w[37].interpolate?a7:r7}let b=_(e,[-1,-1]),y=b(e);return{key:t,first:null,c(){n=h("article"),i=h("div"),s=h("span"),r=T(o),a=h("span"),l=h("span"),f=T(c),u=Ue(),v&&v.c(),y.c(),m(s,"class","time svelte-16y0b84"),m(l,"class","capitalize channel svelte-16y0b84"),m(a,"class",p="text"+e[37].channel+" content svelte-16y0b84"),m(i,"class","linewrap svelte-16y0b84"),m(n,"class","line svelte-16y0b84"),this.first=n},m(w,C){x(w,n,C),d(n,i),d(i,s),d(s,r),d(i,a),d(a,l),d(l,f),d(a,u),v&&v.m(a,null),y.m(i,null),g=!0},p(w,C){e=w,(!g||C[0]&32)&&o!==(o=e[37].time+"")&&G(r,o),(!g||C[0]&32)&&c!==(c=e[37].channel+"")&&G(f,c),e[37].sender?v?(v.p(e,C),C[0]&32&&P(v,1)):(v=ex(e),v.c(),P(v,1),v.m(a,null)):v&&(Te(),I(v,1,1,()=>{v=null}),Ee()),(!g||C[0]&32&&p!==(p="text"+e[37].channel+" content svelte-16y0b84"))&&m(a,"class",p),b===(b=_(e,C))&&y?y.p(e,C):(y.d(1),y=b(e),y&&(y.c(),y.m(i,null)))},i(w){g||(P(v),g=!0)},o(w){I(v),g=!1},d(w){w&&k(n),v&&v.d(),y.d()}}}function nx(t){let e,n,i=t[34]+"",s,o,r,a;function l(...c){return t[17](t[34],...c)}return{c(){e=h("div"),n=T("/"),s=T(i),m(e,"class",o="choice textsystem text"+t[34]+" svelte-16y0b84")},m(c,f){x(c,e,f),d(e,n),d(e,s),r||(a=Q(e,"click",l),r=!0)},p(c,f){t=c},d(c){c&&k(e),r=!1,a()}}}function ix(t){let e,n=t[31]+"",i,s,o,r;function a(...l){return t[21](t[31],...l)}return{c(){e=h("small"),i=T(n),m(e,"class",s="btn border black text"+(t[0].indexOf(t[31])<0?t[31]:"grey")+" svelte-16y0b84")},m(l,c){x(l,e,c),d(e,i),o||(r=Q(e,"click",a),o=!0)},p(l,c){t=l,c[0]&1&&s!==(s="btn border black text"+(t[0].indexOf(t[31])<0?t[31]:"grey")+" svelte-16y0b84")&&m(e,"class",s)},d(l){l&&k(e),o=!1,r()}}}function l7(t){let e,n,i=[],s=new o7,o,r,a,l,c,f,u,p,g,v,_,b,y,w,C,A=pe(t[5]),M=R=>R[37].key;for(let R=0;R<A.length;R+=1){let z=Kk(t,A,R),E=M(z);s.set(E,i[R]=tx(E,z))}let F=pe(Object.keys(ea)),V=[];for(let R=0;R<F.length;R+=1)V[R]=nx(Jk(t,F,R));let L=pe(t[12]),q=[];for(let R=0;R<L.length;R+=1)q[R]=ix(Zk(t,L,R));return{c(){e=h("div"),n=h("section");for(let R=0;R<i.length;R+=1)i[R].c();o=h("div"),r=h("section"),a=h("div"),l=h("div");for(let R=0;R<V.length;R+=1)V[R].c();c=h("div"),c.textContent="/[playername]",f=h("div"),u=T(t[6]),g=h("input"),_=h("div");for(let R=0;R<q.length;R+=1)q[R].c();m(n,"id","chat"),m(n,"class","panel frame scrollbar svelte-16y0b84"),m(c,"class","choice textwhisper"),m(l,"class","panel context commandlist textsystem svelte-16y0b84"),Pe(l,"display",t[4]?"block":"none"),m(f,"class",p="command btn black text"+(_o[t[6]]?_o[t[6]].chat?t[6]:"system":"whisper")+" svelte-16y0b84"),m(g,"maxlength","480"),m(g,"type","text"),m(g,"class","svelte-16y0b84"),m(a,"id","chatinput"),m(a,"class","inputcontainer panel-black border black svelte-16y0b84"),m(r,"class",v="chatsection "+(t[3]?"":"hidden")+" svelte-16y0b84"),m(_,"class",b="channelselect "+(t[3]?"hidden":"")+" svelte-16y0b84"),m(o,"class","lowercontainer svelte-16y0b84"),m(e,"class","l-corner-ll container uiscaled svelte-16y0b84")},m(R,z){x(R,e,z),d(e,n);for(let E=0;E<i.length;E+=1)i[E]&&i[E].m(n,null);t[16](n),d(e,o),d(o,r),d(r,a),d(a,l);for(let E=0;E<V.length;E+=1)V[E]&&V[E].m(l,null);d(l,c),d(a,f),d(f,u),d(a,g),t[19](g),d(o,_);for(let E=0;E<q.length;E+=1)q[E]&&q[E].m(_,null);y=!0,w||(C=[Q(f,"click",t[18]),Q(g,"input",t[20])],w=!0)},p(R,z){if(z[0]&2336&&(A=pe(R[5]),Te(),i=ui(i,z,M,1,R,A,s,n,Ii,tx,null,Kk),Ee()),z[0]&512){F=pe(Object.keys(ea));let E;for(E=0;E<F.length;E+=1){let W=Jk(R,F,E);V[E]?V[E].p(W,z):(V[E]=nx(W),V[E].c(),V[E].m(l,c))}for(;E<V.length;E+=1)V[E].d(1);V.length=F.length}if((!y||z[0]&16)&&Pe(l,"display",R[4]?"block":"none"),(!y||z[0]&64)&&G(u,R[6]),(!y||z[0]&64&&p!==(p="command btn black text"+(_o[R[6]]?_o[R[6]].chat?R[6]:"system":"whisper")+" svelte-16y0b84"))&&m(f,"class",p),(!y||z[0]&8&&v!==(v="chatsection "+(R[3]?"":"hidden")+" svelte-16y0b84"))&&m(r,"class",v),z[0]&5121){L=pe(R[12]);let E;for(E=0;E<L.length;E+=1){let W=Zk(R,L,E);q[E]?q[E].p(W,z):(q[E]=ix(W),q[E].c(),q[E].m(_,null))}for(;E<q.length;E+=1)q[E].d(1);q.length=L.length}(!y||z[0]&8&&b!==(b="channelselect "+(R[3]?"hidden":"")+" svelte-16y0b84"))&&m(_,"class",b)},i(R){if(!y){for(let z=0;z<A.length;z+=1)P(i[z]);y=!0}},o(R){for(let z=0;z<i.length;z+=1)I(i[z]);y=!1},d(R){R&&k(e);for(let z=0;z<i.length;z+=1)i[z].d();t[16](null),it(V,R),t[19](null),it(q,R),w=!1,ut(C)}}}function c7(t,e,n){let i,s,o,r;se(t,of,re=>n(0,s=re)),se(t,Vc,re=>n(13,o=re)),se(t,Qi,re=>n(6,r=re));let a,l=!0;ch(()=>{l=a&&(a.offsetHeight+a.scrollTop>a.scrollHeight-20||a.scrollTop==0)}),Tc(()=>{l!==!1&&a.scrollTo(0,a.scrollHeight)});let c,f=!1,u=[],p=0,g=!1,v,_="faction",b=new Map([["c","clan"],["p","party"],["f","faction"]]),y=re=>{let ae=re.match(/^\/[a-zA-Z0-9]+ /g);if(ae){let ue=ae[0].substring(1,ae[0].length-1);if(ue==="r"||ue==="w")for(let Me=o.length-1;Me>0;--Me){let me=o[Me];me.channel=="from"&&(nt(Qi,r=me.sender,r),Me=0)}else nt(Qi,r=b.has(ue)?b.get(ue):ue,r);n(2,c.value=re.substring(ae[0].length),c)}},w=re=>_o[re]&&_o[re].chat,C=re=>{if(re.keyCode===13)if(re.target==c){if(re.target.value!=""){tn(41,100);let Me=re.target.value.match(/^\/[a-zA-Z0-9]+/g);Me&&(nt(Qi,r=Me[0].substring(1),r),n(2,c.value="",c)),ea[r]!==void 0&&ea[r].client?ea[r].fun(c.value):xt(r,c.value),n(2,c.value="",c),n(3,f=!1),c.blur()}else w(r)||xt(r,c.value),n(3,f=!1),c.blur();let ae=`/${r} `,ue=u.indexOf(ae);ue>=0&&u.splice(ue,1),u.length>10&&u.splice(0,1),u.push(ae),w(r)?_=r:(nt(Qi,r=_,r),p=u.length)}else document.activeElement==document.body&&M();else(re.keyCode===38||re.keyCode===40)&&u.length?re.target==c&&(p+=re.keyCode===38?-1:1,p=vt(p,0,u.length-1),y(u[p]),re.preventDefault()):re.keyCode===27&&(n(3,f=!1),c.blur())},A=re=>{c&&c.focus()},M=re=>{re&&nt(Qi,r=re,r),n(3,f=!0),dh().then(A),tn(40,100)},F=re=>{nt(Qi,r=re,r),n(4,g=!1),c&&c.focus()};jn(()=>{document.addEventListener("keydown",C)}),Wn(()=>{document.removeEventListener("keydown",C),n(2,c=void 0)});let V=re=>{let ae=s.indexOf(re);of.update(ue=>(ae>=0?ue.splice(ae,1):ue.push(re),ue))},L=(re,ae)=>{let ue=[{name:ae.sender,css:"disabled"}];D.player.name!==ae.sender&&(ae.faction==D.player.faction&&!en.has(ae.sender)&&ue.push(nn.partyinvite(ae.sender)),ae.channel!=="to"&&ue.push(nn.report(ae.sender,ae.id,`Message: \u201C${ae.text.length>40?ae.text.substring(0,37)+"...":ae.text}\u201D`)),ue.push({name:"Whisper",fun:Me=>{M(ae.sender)}})),wn.set({x:re.pageX,y:re.pageY,opts:ue}),re.preventDefault()},q=["faction","party","clan","pvp","inv","yell"],R=(re,ae)=>L(ae,re),z=(re,ae)=>{M(re.sender)};function E(re){Wt[re?"unshift":"push"](()=>{a=re,n(1,a)})}let W=(re,ae)=>F(re),j=re=>n(4,g=!g);function N(re){Wt[re?"unshift":"push"](()=>{c=re,n(2,c)})}let U=re=>y(re.target.value),ie=(re,ae)=>V(re);return t.$$.update=()=>{t.$$.dirty[0]&8193&&n(5,i=o.filter(re=>s.indexOf(re.channel)<0))},[s,a,c,f,g,i,r,y,M,F,V,L,q,o,R,z,E,W,j,N,U,ie]}var P1=class extends we{constructor(e){super(),Ce(this,e,c7,l7,$e,{},null,[-1,-1])}},sx=P1;function ox(t){let e,n;return{c(){e=h("img"),at(e.src,n="/data/ui/icons/"+t[1]+".svg?v=8582889")||m(e,"src",n),m(e,"class","titleicon svgicon svelte-yjs4p5")},m(i,s){x(i,e,s)},p(i,s){s&2&&!at(e.src,n="/data/ui/icons/"+i[1]+".svg?v=8582889")&&m(e,"src",n)},d(i){i&&k(e)}}}function rx(t){let e,n,i,s;return{c(){e=h("img"),at(e.src,n="/data/ui/icons/cog.svg?v=8582889")||m(e,"src",n),m(e,"class","btn black svgicon marg-right")},m(o,r){x(o,e,r),i||(s=Q(e,"click",t[8]),i=!0)},p:ce,d(o){o&&k(e),i=!1,s()}}}function ax(t){let e,n,i,s;return{c(){e=h("img"),at(e.src,n="/data/ui/icons/cross.svg?v=8582889")||m(e,"src",n),m(e,"class","btn black svgicon")},m(o,r){x(o,e,r),i||(s=Q(e,"click",t[9]),i=!0)},p:ce,d(o){o&&k(e),i=!1,s()}}}function f7(t){let e,n,i,s,o,r,a,l,c,f,u=t[1]&&ox(t),p=t[4]&&rx(t),g=t[2]&&ax(t),v=t[7].default,_=Wa(v,t,t[6],null);return{c(){e=h("div"),n=h("div"),u&&u.c(),i=h("div"),s=h("div"),o=T(t[0]),r=Ue(),p&&p.c(),a=ge(),g&&g.c(),l=h("div"),_&&_.c(),m(i,"class","textprimary title svelte-yjs4p5"),m(n,"class","titleframe svelte-yjs4p5"),m(l,"class",c="slot "+(t[3]?"scrollbar":"")+" svelte-yjs4p5"),m(e,"class","window panel-black svelte-yjs4p5")},m(b,y){x(b,e,y),d(e,n),u&&u.m(n,null),d(n,i),d(i,s),d(s,o),d(n,r),p&&p.m(n,null),d(n,a),g&&g.m(n,null),d(e,l),_&&_.m(l,null),f=!0},p(b,[y]){b[1]?u?u.p(b,y):(u=ox(b),u.c(),u.m(n,i)):u&&(u.d(1),u=null),(!f||y&1)&&G(o,b[0]),b[4]?p?p.p(b,y):(p=rx(b),p.c(),p.m(n,a)):p&&(p.d(1),p=null),b[2]?g?g.p(b,y):(g=ax(b),g.c(),g.m(n,null)):g&&(g.d(1),g=null),_&&_.p&&(!f||y&64)&&Ha(_,v,b,b[6],f?Ga(v,b[6],y,null):Ya(b[6]),null),(!f||y&8&&c!==(c="slot "+(b[3]?"scrollbar":"")+" svelte-yjs4p5"))&&m(l,"class",c)},i(b){f||(P(_,b),f=!0)},o(b){I(_,b),f=!1},d(b){b&&k(e),u&&u.d(),p&&p.d(),g&&g.d(),_&&_.d(b)}}}function u7(t,e,n){let{$$slots:i={},$$scope:s}=e,o=Mr(),{title:r="Title"}=e,{icon:a=void 0}=e,{close:l=!0}=e,{scroll:c=!1}=e,{cog:f=!1}=e,u=()=>o("cog"),p=()=>o("close");return t.$$set=g=>{"title"in g&&n(0,r=g.title),"icon"in g&&n(1,a=g.icon),"close"in g&&n(2,l=g.close),"scroll"in g&&n(3,c=g.scroll),"cog"in g&&n(4,f=g.cog),"$$scope"in g&&n(6,s=g.$$scope)},[r,a,l,c,f,o,s,i,u,p]}var T1=class extends we{constructor(e){super(),Ce(this,e,u7,f7,$e,{title:0,icon:1,close:2,scroll:3,cog:4})}},Ot=T1;var lx=t=>{let e=(t||0).toString().split(""),n=e.splice(-2).join(""),i=e.splice(-2).join(""),s=e.join("");return{c:n,s:i,g:s}};var Ul=(t,e=!0)=>{let n=Object.entries(t);return n.forEach(i=>{i[0]=parseInt(i[0]),e&&typeof i[1]=="object"&&(i[1]=Ul(i[1]))}),new Map(n)};var ni=t=>t>=1e4?(t/1e3).toFixed(1)+"k":ht(t);var ht=t=>t<1e3?t+"":ht(~~(t/1e3))+","+("00"+~~(t%1e3)).substr(-3,3),fx=(t,e)=>t.length>e?`${t.slice(0,e-2)}...`:t,cx=Ul({14:.1,13:.1,9:.1,8:.1,16:.1}),p7=Ul({14:"%",13:"%",16:"%",18:"%"}),ii=(t,e)=>(cx.has(t)&&(e*=cx.get(t),e=e.toFixed(e>=.1?1:2)),e+(p7.get(t)||""));var m7=t=>t.replace(/\$c(\d)/g,(e,n)=>`<img class=texticon src='${Ys(n)}'>`),d7=t=>t.replace(/\$l(\d+)/g,(e,n)=>`<span class=textwhite>${n}</span>`),h7=t=>t.replace(/\$f(\d)(\w*)/g,(e,n,i)=>`<span class=textf${n}>${i}</span>`),g7=t=>t.replace(/\$gt/g,(e,n)=>'<img class="svgicon" src="/data/ui/icons/check.svg?v=8582889">'),v7=t=>t.replace(/\$e(\d+)/g,(e,n)=>Of(n,!1)),_7=t=>t.replace(/\$g(\d+)/g,(e,n)=>E1(n,!1)),b7=t=>t.replace(/\$m(\d+)/g,(e,n)=>D1(n,!1)),y7=t=>t.replace(/\$sp(\d+)/g,(e,n)=>"<img class=texticon src=/data/ui/icons/gem.svg?v=8582889/>"+n),k7=t=>t.replace(/\$fm(\d+)/g,(e,n)=>`<span class=textfame><img class=svgicon src='/data/ui/currency/fame.svg?v=8582889'> ${n}</span>`),E1=(t,e=!1)=>{let{c:n,s:i,g:s}=lx(t),o="<span/>";return s!=""&&(o+=`<span class=${e?"textred":"textgold"}>${s}</span> <img class=texticon src='/data/ui/currency/gold.${zn}?v=8582889'/>`),i!=""&&(o+=`<span class=${e?"textred":"textsilver"}>${i}</span> <img class=texticon src='/data/ui/currency/silver.${zn}?v=8582889'/>`),n!=""&&(o+=`<span class=${e?"textred":"textcopper"}>${n}</span> <img class=texticon src='/data/ui/currency/copper.${zn}?v=8582889'/>`),o+"</span>"};var D1=(t,e=!1)=>`<span class='${e?"textred":"textgold"}'><img class='svgicon' src='${qk}'> ${ht(t)}</span>`,Of=t=>`<span class='bold textpvp'><img class='svgicon' src='${Lk(t)}'> ${ht(t)}</span>`,la=(t,e)=>`<span class='bold textprimary'><img class='svgicon' src='${Rk(t)}'> ${e}</span>`,x7=[m7,d7,h7,_7,k7,g7,y7,b7,v7],Nf=t=>x7.reduce((e,n)=>n(e),t);function ux(t,e,n){let i=t.slice();return i[4]=e[n],i[6]=n,i}function px(t){let e,n,i;return n=new Ot({props:{title:S.ui.headers.interaction,$$slots:{default:[w7]},$$scope:{ctx:t}}}),n.$on("close",t[3]),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","l-upperLeftModal container uiscaled svelte-uxs0uj")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&129&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function mx(t){let e,n,i=Nf(t[4])+"",s,o,r;function a(...l){return t[2](t[6],...l)}return{c(){e=h("div"),n=h("span"),m(e,"class","btn border black textgreen"),m(e,"value",s=t[6])},m(l,c){x(l,e,c),d(e,n),n.innerHTML=i,o||(r=Q(e,"click",a),o=!0)},p(l,c){t=l,c&1&&i!==(i=Nf(t[4])+"")&&(n.innerHTML=i)},d(l){l&&k(e),o=!1,r()}}}function w7(t){let e,n,i=t[0].title+"",s,o,r=t[0].text+"",a,l=pe(t[0].choices),c=[];for(let f=0;f<l.length;f+=1)c[f]=mx(ux(t,l,f));return{c(){e=h("div"),n=h("h3"),s=T(i),o=h("p"),a=T(r);for(let f=0;f<c.length;f+=1)c[f].c();m(n,"class","textprimary name svelte-uxs0uj"),m(e,"class","container svelte-uxs0uj")},m(f,u){x(f,e,u),d(e,n),d(n,s),d(e,o),d(o,a);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(e,null)},p(f,u){if(u&1&&i!==(i=f[0].title+"")&&G(s,i),u&1&&r!==(r=f[0].text+"")&&G(a,r),u&3){l=pe(f[0].choices);let p;for(p=0;p<l.length;p+=1){let g=ux(f,l,p);c[p]?c[p].p(g,u):(c[p]=mx(g),c[p].c(),c[p].m(e,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=l.length}},d(f){f&&k(e),it(c,f)}}}function M7(t){let e,n,i=t[0]&&px(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=px(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function F7(t,e,n){let i;se(t,qs,a=>n(0,i=a));function s(a){Si(Ft.clientPlayerInteract.packData({id:a})),nt(qs,i=void 0,i)}return[i,s,(a,l)=>s(a),()=>{nt(qs,i=void 0,i)}]}var I1=class extends we{constructor(e){super(),Ce(this,e,F7,M7,$e,{})}},dx=I1;function C7(t){let e,n,i,s,o,r,a,l,c,f=t[7].default,u=Wa(f,t,t[6],null);return{c(){e=h("div"),n=h("div"),i=h("span"),s=T(t[0]),o=h("span"),r=T(t[1]),u&&u.c(),m(i,"class","left svelte-i7i7g5"),m(o,"class","right svelte-i7i7g5"),m(n,"class",a="progressBar "+t[3]+" svelte-i7i7g5"),Pe(n,"width",t[2]+"%"),Pe(n,"font-size",t[4]),m(e,"class",l="bar "+(t[5]?"dark":"")+" svelte-i7i7g5"),Pe(e,"z-index",t[3]=="hp"?"1":"0")},m(p,g){x(p,e,g),d(e,n),d(n,i),d(i,s),d(n,o),d(o,r),u&&u.m(e,null),c=!0},p(p,[g]){(!c||g&1)&&G(s,p[0]),(!c||g&2)&&G(r,p[1]),(!c||g&8&&a!==(a="progressBar "+p[3]+" svelte-i7i7g5"))&&m(n,"class",a),(!c||g&4)&&Pe(n,"width",p[2]+"%"),(!c||g&16)&&Pe(n,"font-size",p[4]),u&&u.p&&(!c||g&64)&&Ha(u,f,p,p[6],c?Ga(f,p[6],g,null):Ya(p[6]),null),(!c||g&32&&l!==(l="bar "+(p[5]?"dark":"")+" svelte-i7i7g5"))&&m(e,"class",l),(!c||g&8)&&Pe(e,"z-index",p[3]=="hp"?"1":"0")},i(p){c||(P(u,p),c=!0)},o(p){I(u,p),c=!1},d(p){p&&k(e),u&&u.d(p)}}}function S7(t,e,n){let{$$slots:i={},$$scope:s}=e,{left:o=""}=e,{right:r=""}=e,{fract:a}=e,{barcol:l}=e,{size:c}=e,{darken:f}=e;return t.$$set=u=>{"left"in u&&n(0,o=u.left),"right"in u&&n(1,r=u.right),"fract"in u&&n(2,a=u.fract),"barcol"in u&&n(3,l=u.barcol),"size"in u&&n(4,c=u.size),"darken"in u&&n(5,f=u.darken),"$$scope"in u&&n(6,s=u.$$scope)},[o,r,a,l,c,f,s,i]}var V1=class extends we{constructor(e){super(),Ce(this,e,S7,C7,Fn,{left:0,right:1,fract:2,barcol:3,size:4,darken:5})}},vi=V1;var L1={};Xn(L1,{init:()=>A7,updateCd:()=>Wf});var jf=new Map,hx=!1,A7=()=>{fetch("/data/ui/circlecooldowns/circlecooldowns.txt?v=8582889").then(async t=>{let e=(await t.text()).split(`
`);for(let n=0;n<3;++n){let i=[];for(let s=0;s<101;++s){let o=new Image;o.src=e.shift(),i.push([o])}jf.set([40,31,23][n],i)}hx=!0})},Wf=(t,e,n)=>{hx&&e&&t!==e.step&&(e.cdimg!==void 0&&(jf.get(n)[e.step].push(e.removeChild(e.cdimg)),e.cdimg=void 0),(e.step=t)>0&&(jf.get(n)[e.step].length===1?e.cdimg=jf.get(n)[e.step][0].cloneNode():e.cdimg=jf.get(n)[e.step].pop(),e.appendChild(e.cdimg)))};function gx(t){let e,n;return{c(){e=h("div"),n=T(t[0]),m(e,"class","stacks slottext svelte-1nn7wcb")},m(i,s){x(i,e,s),d(e,n)},p(i,s){s&1&&G(n,i[0])},d(i){i&&k(e)}}}function vx(t){let e,n=(t[5]>99?Math.round(t[5]/60)+"'":Math.ceil(t[5]))+"",i;return{c(){e=h("div"),i=T(n),m(e,"class","time absCentered slottext svelte-1nn7wcb")},m(s,o){x(s,e,o),d(e,i)},p(s,o){o&32&&n!==(n=(s[5]>99?Math.round(s[5]/60)+"'":Math.ceil(s[5]))+"")&&G(i,n)},d(s){s&&k(e)}}}function P7(t){let e,n,i,s,o,r,a,l,c,f,u=t[0]>1&&gx(t),p=t[3]>30&&oe.cdTextBuffs&&t[5]>0&&vx(t);return{c(){e=h("div"),n=h("div"),i=h("img"),o=h("div"),u&&u.c(),r=ge(),p&&p.c(),m(i,"class","icon svelte-1nn7wcb"),at(i.src,s=t[1])||m(i,"src",s),Pe(i,"max-width",t[3]+"px"),m(o,"class","overlay svelte-1nn7wcb"),m(n,"class",a="slot border "+(t[2]===1?"negative":"positive")+" svelte-1nn7wcb"),m(e,"class",l="container "+(t[5]<oe.buffCdFlashingDuration&&t[5]%oe.buffCdFlashingInterval*2>oe.buffCdFlashingInterval?"soon":"")+" svelte-1nn7wcb")},m(g,v){x(g,e,v),d(e,n),d(n,i),d(n,o),t[10](o),u&&u.m(n,null),d(n,r),p&&p.m(n,null),c||(f=Q(e,"contextmenu",t[6]),c=!0)},p(g,[v]){v&2&&!at(i.src,s=g[1])&&m(i,"src",s),v&8&&Pe(i,"max-width",g[3]+"px"),g[0]>1?u?u.p(g,v):(u=gx(g),u.c(),u.m(n,r)):u&&(u.d(1),u=null),g[3]>30&&oe.cdTextBuffs&&g[5]>0?p?p.p(g,v):(p=vx(g),p.c(),p.m(n,null)):p&&(p.d(1),p=null),v&4&&a!==(a="slot border "+(g[2]===1?"negative":"positive")+" svelte-1nn7wcb")&&m(n,"class",a),v&32&&l!==(l="container "+(g[5]<oe.buffCdFlashingDuration&&g[5]%oe.buffCdFlashingInterval*2>oe.buffCdFlashingInterval?"soon":"")+" svelte-1nn7wcb")&&m(e,"class",l)},i:ce,o:ce,d(g){g&&k(e),t[10](null),u&&u.d(),p&&p.d(),c=!1,f()}}}function T7(t,e,n){let{stacks:i}=e,{duration:s}=e,{time:o}=e,{icon:r}=e,{type:a}=e,{size:l}=e,{cancel:c}=e,f=1,u=0,p,g=()=>{c>=0&&xt("cancelbuff",c)};function v(_){Wt[_?"unshift":"push"](()=>{p=_,n(4,p)})}return t.$$set=_=>{"stacks"in _&&n(0,i=_.stacks),"duration"in _&&n(7,s=_.duration),"time"in _&&n(8,o=_.time),"icon"in _&&n(1,r=_.icon),"type"in _&&n(2,a=_.type),"size"in _&&n(3,l=_.size),"cancel"in _&&n(9,c=_.cancel)},t.$$.update=()=>{t.$$.dirty&408&&(n(5,u=s-o),Wf(Math.round(o/s*100),p,l))},[i,r,a,l,p,u,g,s,o,c,v]}var q1=class extends we{constructor(e){super(),Ce(this,e,T7,P7,Fn,{stacks:0,duration:7,time:8,icon:1,type:2,size:3,cancel:9})}},_x=q1;var ig={};Xn(ig,{envSkillId:()=>sr,findEnvironmentTarget:()=>Cw,hoverinteractive:()=>nd,hovertarget:()=>_n,init:()=>zE,onWorldDestroy:()=>GE,parseHudTargets:()=>ng,playertarget:()=>Vn,preTick:()=>NE,ray:()=>nr,setEnvCast:()=>Zf,setHoverTarget:()=>Qf,setTarget:()=>ir,targetSwitchConciliate:()=>tg,targetSwitchNetTimer:()=>ma,tick:()=>jE});var yx=(t,e,n)=>{let i=O.getUniformBlockIndex(t,e),s=O.getActiveUniformBlockParameter(t,i,O.UNIFORM_BLOCK_DATA_SIZE),o={name:e,size:s,uniforms:[],index:n},r=O.getActiveUniformBlockParameter(t,i,O.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES),a=O.getActiveUniforms(t,r,O.UNIFORM_OFFSET);for(let l=0;l<r.length;++l){let c=r[l],f=O.getActiveUniform(t,c),u=a[l],p=f.size,g=0,v=0,_=!1;f.type===O.FLOAT_VEC3?(g=3,v=p>1?4:3):f.type===O.FLOAT_VEC2?(g=2,v=p>1?4:2):f.type===O.FLOAT_VEC4?(g=4,v=4):f.type===O.FLOAT_MAT4?(g=16,v=16):f.type===O.FLOAT?(g=1,v=1):f.type===O.INT&&(g=1,v=1,_=!0),p*=g;let b={name:f.name.replace("[0]",""),size:p,offset:u,divisor:v,elements:g,isInt:_};o.uniforms.push(b)}return o.uniforms.sort((l,c)=>l.offset-c.offset),o},Ol=t=>{let e={layout:t,buffer:O.createBuffer(),data:{},dataArray:[]};O.bindBuffer(O.UNIFORM_BUFFER,e.buffer),O.bufferData(O.UNIFORM_BUFFER,t.size,O.DYNAMIC_DRAW),O.bindBuffer(O.UNIFORM_BUFFER,null);for(let n=0;n<t.uniforms.length;++n){let i=t.uniforms[n],s=[];for(let o=0;o<i.size;++o)s.push(0);e.data[i.name]=s,e.dataArray.push(s)}return e},ca=t=>{O.bindBufferBase(O.UNIFORM_BUFFER,t.layout.index,t.buffer)},wo=(t,e,n,i=0)=>{i===0&&(i=e.length);for(let s=0;s<i;++s)t[s+n]=e[s]},kx=new ArrayBuffer(1e3),E7=new Int32Array(kx),bx=new Float32Array(kx),Bm=t=>{for(let e=0;e<t.layout.uniforms.length;++e){let n=t.layout.uniforms[e];t.data[n.name]!==t.dataArray[e]&&(t.dataArray[e]=t.data[n.name])}},si=t=>{let e=0;for(let n=0;n<t.layout.uniforms.length;++n){let i=t.layout.uniforms[n],s=t.dataArray[n],o=i.isInt?E7:bx,r=0;for(;r<s.length;)for(let a=0;a<i.divisor;++a)a<i.elements&&(o[e]=s[r],r++),e++}O.bindBuffer(O.UNIFORM_BUFFER,t.buffer),O.bufferSubData(O.UNIFORM_BUFFER,0,bx,0,t.layout.size/4),O.bindBuffer(O.UNIFORM_BUFFER,null)};var Nl=[],jl,bs,Mo,ua,pa,xx=t=>{let e=et.width,n=et.height;for(let i=0;i<2;++i)Nl.push(yo(t,t,0,!0,O.COMPARE_REF_TO_TEXTURE));jl=yo(t,t,0,!0,O.COMPARE_REF_TO_TEXTURE),bs=yo(e,n,1,!0),Mo=yo(e,n,1,!0),ua=yo(Math.ceil(e/4),Math.ceil(n/4)),pa=yo(Math.ceil(e/4),Math.ceil(n/4))},wx=(t,e)=>{Ff(bs,t,e),Ff(Mo,t,e),Ff(ua,Math.ceil(t/4),Math.ceil(e/4)),Ff(pa,Math.ceil(t/4),Math.ceil(e/4))};var Zm={};Xn(Zm,{bloom:()=>$1,bloomMerge:()=>U1,drop:()=>zm,foliagePlant:()=>$m,foliageStatic:()=>Um,fxaa:()=>O1,multimeshEffect:()=>Om,multimeshFlat:()=>Nm,multimeshSimple:()=>jm,multimeshTextured:()=>Gf,multimeshTexturedVcol:()=>Wm,multimeshTree:()=>R1,particles:()=>Gm,particles_additive:()=>B1,particles_normal:()=>z1,ribbon:()=>Hf,ribbonTextured:()=>j1,shadowInstanced:()=>Yf,shadowInstancedAlpha:()=>W1,simple:()=>Hm,simpleTextured:()=>PE,simpleVcol:()=>TE,sky:()=>G1,skyStarTex:()=>H1,sun:()=>Y1,terrain:()=>Ym,terrainEditorAreas:()=>EE,terrainEditorGrid:()=>DE,terrainEditorHeights:()=>IE,terrainEditorTiles:()=>VE,terrainFog:()=>Xm,tint:()=>N1,water:()=>Qm,waterEditorGrid:()=>LE});var Fx=`#version 300 es
precision highp float;precision highp int;out vec4 fragColor;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D diffuse;in vec2 vUv;in float vShine;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 a=texture(diffuse,vUv);if(a.a<0.5)discard;a.rgb=mix(a.rgb*worldlight[1],a.rgb*1.1,smoothstep(-0.7,0.7,sin(time*6.0+vShine)));float b=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);a.rgb=mix(fog[0],a.rgb,b);fragColor=a;}`;var Cx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in mat4 worldMatrix;in vec4 uvshift;in float shine;out float vShine;out vec2 vUv;void main(){vShine=shine;vWorldPos=worldMatrix*vec4(position,1.0);vUv=uvshift.zw-uv*uvshift.xy;vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);}`;var Sx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform sampler2D foliageDiffuse;in vec3 vLight;in vec3 vLightAmb;in vec3 vLightDir;in vec2 vUv;out vec4 fragColor;void main(){vec4 b=texture(foliageDiffuse,vUv);float c=0.1;b.a=b.a*smoothstep(1.0,0.0,(vCameraDistance-110.0)/20.0);if(b.a<c){discard;};float d=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float e=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 f=shadowPVMatrix[1]*(vWorldPos);vec3 g=(f.xyz/f.w)*0.5+0.5;d=texture(shadowMaps[1],g);}else{vec4 f=shadowPVMatrix[0]*(vWorldPos);vec3 g=(f.xyz/f.w)*0.5+0.5;d=texture(shadowMaps[0],g);}d=d;d=max(d,e);}b.rgb=b.rgb*(vLight+vLightAmb+vLightDir*d);float h=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,h);fragColor=b;}`;var Ax=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec4 instPos;in vec3 instNorm;in vec3 position;in vec2 uv;out vec3 vLightAmb;out vec3 vLightDir;out vec2 vUv;void main(){vUv=uv;vec3 b=vec3(0.0);for(int c=0;c<lightCount;++c){vec3 d=lightPos[c]-instPos.xyz;float e=lightCols[c].w-dot(d,d);if(e>0.0){e/=(lightCols[c].w);e=e*e;b+=0.3*lightCols[c].rgb*e;;}};vLight=b;vLightAmb=worldlight[1];vLightDir=worldlight[0]*max(0.0,dot(instNorm.xyz,worldlight[2]));vec3 f=position;float e=sin(time+instPos.x+f.x)*0.1*f.y;f.xz+=e;mat3 g;g[1]=instNorm.xyz;g[2]=normalize(cross(vec3(sin(instPos.x*100.0),0.0,cos(instPos.z*100.0)),g[1]));g[0]=normalize(cross(g[1],g[2]));vec3 h=g*f;vWorldPos=vec4(h*instPos.w+instPos.xyz,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var Px=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform sampler2D foliageDiffuse;in vec3 vLightAmb;in vec3 vLightDir;in vec3 vLight;in vec2 vUv;out vec4 fragColor;void main(){vec4 b=texture(foliageDiffuse,vUv);b.a=b.a*smoothstep(1.0,0.0,(vCameraDistance-110.0)/20.0);if(b.a<0.5){discard;};float c=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float d=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 e=shadowPVMatrix[1]*(vWorldPos);vec3 f=(e.xyz/e.w)*0.5+0.5;c=texture(shadowMaps[1],f);}else{vec4 e=shadowPVMatrix[0]*(vWorldPos);vec3 f=(e.xyz/e.w)*0.5+0.5;c=texture(shadowMaps[0],f);}c=c;c=max(c,d);}b.rgb=b.rgb*(vLight+vLightAmb+vLightDir*c);float g=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,g);fragColor=b;}`;var Tx=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec4 instPos;in vec3 instNorm;in vec3 position;in vec2 uv;out vec2 vUv;out vec3 vLightAmb;out vec3 vLightDir;void main(){vUv=uv;vec3 b=vec3(0.0);for(int c=0;c<lightCount;++c){vec3 d=lightPos[c]-instPos.xyz;float e=lightCols[c].w-dot(d,d);if(e>0.0){e/=(lightCols[c].w);e=e*e;b+=0.3*lightCols[c].rgb*e;;}}vLight=b;vLightAmb=worldlight[1];vLightDir+=worldlight[0]*max(0.0,dot(instNorm.xyz,worldlight[2]));vec3 f=position;mat3 g;g[1]=instNorm.xyz;g[2]=normalize(cross(vec3(sin(instPos.x*100.0),0.0,cos(instPos.z*100.0)),g[1]));g[0]=normalize(cross(g[1],g[2]));vec3 h=g*f;vWorldPos=vec4(h*instPos.w+instPos.xyz,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var Ex=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vCol;in vec2 vYcutoff;in vec4 vUvshift;out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec2 a=vec2((vUv.x+vUvshift.x)*vUvshift.z,(vUv.y+vUvshift.y)*vUvshift.w);vec4 b=vec4(1.0,1.0,1.0,texture(diffuse,a).r)*vCol;b.a*=min(1.0,max(0.0,vUv.y/vYcutoff[0]));b.a*=min(1.0,max(0.0,(vYcutoff[1]-vUv.y)/(1.0-vYcutoff[1])));if(b.a<0.01){discard;}float c=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);b.rgb=mix(fog[0],b.rgb,c);fragColor=b;fragColor.rgb*=fragColor.a;}`;var Dx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in mat4 worldMatrix;in vec4 uvshift;in vec2 ycutoff;in vec4 color;out vec3 vNormal;out vec2 vUv;out vec4 vCol;out vec2 vYcutoff;out vec4 vUvshift;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vUvshift=uvshift;vCol=color;vYcutoff=ycutoff;vWorldPos=worldMatrix*vec4(position,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var Ix=`#version 300 es
precision highp float;precision highp int;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 vLight;in vec4 vColor;in vec3 vNormal;in vec4 vInteriorlight;in float vAlpha;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}float o=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float p=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 q=shadowPVMatrix[1]*(vWorldPos);vec3 r=(q.xyz/q.w)*0.5+0.5;o=texture(shadowMaps[1],r);}else{vec4 q=shadowPVMatrix[0]*(vWorldPos);vec3 r=(q.xyz/q.w)*0.5+0.5;o=texture(shadowMaps[0],r);}o=o;o=max(o,p);}vec3 s=worldlight[1];vec3 t=worldlight[0];s=mix(s,vInteriorlight.rgb*0.5,vInteriorlight.a);t=mix(t,vInteriorlight.rgb,vInteriorlight.a);float u=max(0.0,min(1.0,vColor[3]*0.2));vec4 v=vec4(b(s,t,vColor.rgb,vNormal,o,vLight,u),vAlpha);float w=max(0.0,min(1.0,-vColor[3]));v.rgb=mix(v.rgb,vColor.rgb,w);float x=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);v.rgb=mix(fog[0],v.rgb,x);fragColor=v;}`;var Vx=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 position;in vec3 normal;in vec4 color;in vec4 interiorlight;in float alpha;in mat4 worldMatrix;out vec4 vColor;out vec3 vNormal;out vec4 vInteriorlight;out float vAlpha;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vWorldPos=worldMatrix*vec4(position,1.0);vColor=color;vAlpha=alpha;vInteriorlight=interiorlight;vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var Lx=`#version 300 es
precision highp float;precision highp int;in vec4 vColor;out vec4 fragColor;void main(){fragColor=vColor;fragColor.a=1.0;}`;var qx=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec3 position;in vec4 color;in mat4 worldMatrix;out vec4 vColor;void main(){vColor=color;gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);;}`;var Rx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Circle{vec4 circlePos;vec4 circleInfo;};in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vInteriorlight;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 o=texture(diffuse,vUv);if(o.a<0.5)discard;float p=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float q=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 r=shadowPVMatrix[1]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[1],s);}else{vec4 r=shadowPVMatrix[0]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[0],s);}p=p;p=max(p,q);}vec3 t=worldlight[1];vec3 u=worldlight[0];t=mix(t,vInteriorlight.rgb*0.5,vInteriorlight.a);u=mix(u,vInteriorlight.rgb,vInteriorlight.a);o.rgb=b(t,u,o.rgb,vNormal,p,vLight,0.0);o.rgb/=o.a;float v=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,v);float w=distance(vWorldPos.xz,circlePos.xz);float x=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(w<circlePos.w+0.1&&x>0.0){o.rgb=mix(o.rgb,circleInfo.rgb,x*circleInfo.a*((w<circlePos.w?w/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-w))/0.1)));}fragColor=o;}`;var Bx=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in vec4 interiorlight;in mat4 worldMatrix;out vec3 vNormal;out vec2 vUv;out vec4 vInteriorlight;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vWorldPos=worldMatrix*vec4(position,1.0);vInteriorlight=interiorlight;vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var zx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Circle{vec4 circlePos;vec4 circleInfo;};in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec4 vCol;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 o=texture(diffuse,vUv);if(o.a<0.5)discard;float p=(float(gl_FrontFacing)*2.0-1.0);float q=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float r=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 s=shadowPVMatrix[1]*(vWorldPos);vec3 t=(s.xyz/s.w)*0.5+0.5;q=texture(shadowMaps[1],t);}else{vec4 s=shadowPVMatrix[0]*(vWorldPos);vec3 t=(s.xyz/s.w)*0.5+0.5;q=texture(shadowMaps[0],t);}q=q;q=max(q,r);}vec3 u=mix(worldlight[1],vCol.rgb,vCol.a);vec3 v=worldlight[0]*(1.0-vCol.a);o.rgb=b(u,v,o.rgb,vNormal,q,vLight,0.0);float w=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,w);float x=distance(vWorldPos.xz,circlePos.xz);float y=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(x<circlePos.w+0.1&&y>0.0){o.rgb=mix(o.rgb,circleInfo.rgb,y*circleInfo.a*((x<circlePos.w?x/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-x))/0.1)));}fragColor=o;}`;var $x=`#version 300 es
precision highp float;precision highp int;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in vec2 uv;in vec3 position;in vec3 normal;in vec4 color;in mat4 worldMatrix;out vec3 vNormal;out vec2 vUv;out vec4 vCol;out vec3 vViewDir;void main(){vNormal=normalize(mat3(worldMatrix)*normal);vUv=uv;vCol=color;vWorldPos=worldMatrix*vec4(position,1.0);vCameraDistance=length(cameraPosition-vWorldPos.xyz);vec3 a=vec3(0.0);for(int b=0;b<lightCount;++b){vec3 c=lightPos[b]-vWorldPos.xyz;float d=lightCols[b].w-dot(c,c);if(d>0.0){d/=(lightCols[b].w);d=d*d;a+=max(0.0,dot(normalize(c),vNormal))*lightCols[b].rgb*d;}}vLight=a;vViewDir=-normalize(vWorldPos.xyz-cameraPosition);gl_Position=projectionViewMatrix*vWorldPos;}`;var Ux=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];in vec3 vLight;uniform sampler2D diffuse;in vec3 vNormal;in vec2 vUv;in vec3 vViewDir;vec3 b(vec3 c,vec3 d,vec3 e,vec3 f,float g,vec3 h,float i){float j=clamp(dot(f,worldlight[2]),0.0,g);vec3 k=c*mix(0.7,1.1,0.5+(0.5*j));vec3 l=normalize(worldlight[2]+vViewDir);vec3 m=d*pow(max(0.0,dot(l,f)),20.0)*i*max(g*0.7+0.2,0.2)*20.0;vec3 n=k+d*j+h;return n*e+m;}out vec4 fragColor;void main(){vec4 o=texture(diffuse,vUv);if(o.a<0.7)discard;if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}float p=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float q=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 r=shadowPVMatrix[1]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[1],s);}else{vec4 r=shadowPVMatrix[0]*(vWorldPos);vec3 s=(r.xyz/r.w)*0.5+0.5;p=texture(shadowMaps[0],s);}p=p;p=max(p,q);}o.rgb=b(worldlight[1],worldlight[0],o.rgb,vNormal,p,vLight,0.0);o.rgb/=o.a;float t=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);o.rgb=mix(fog[0],o.rgb,t);fragColor=o;}`;var Ox=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};in vec3 position;in vec4 info;in vec2 progress;in vec4 scaleRota;in vec4 colStart;in vec4 colEnd;out vec4 vCol;out float vRotationCos;out float vRotationSin;out vec2 vOffset;void main(){float a=min(info[3]-1.0,floor(mix(info[2],info[3],mod(info[0]*progress[0],1.0))));vOffset=vec2(fract(a*0.125),-floor(a/8.0)*0.125);vCol=mix(colStart,colEnd,progress[1]);float b=mix(scaleRota[2],scaleRota[3],progress[0]);vRotationCos=cos(b);vRotationSin=sin(b);float c=mix(scaleRota[0],scaleRota[1],progress[1])*(abs(vRotationSin)+abs(vRotationCos));vec4 d=viewMatrix*vec4(position,1.0);gl_PointSize=c*resolution[1]*projectionMatrix[1][1]/length(d.xyz);gl_Position=projectionMatrix*d;}`;var Nx=`#version 300 es
precision highp float;precision highp int;uniform sampler2D particleDiffuse;in vec4 vCol;in vec2 vOffset;in float vRotationCos;in float vRotationSin;out vec4 fragColor;const float a=1.0/(1024.0/8.0);void main(){float b=0.5;float c=abs(vRotationSin)+abs(vRotationCos);vec2 d=vec2(gl_PointCoord.x-b,gl_PointCoord.y-b)*c;vec2 e=d*vRotationCos;vec2 f=d*vRotationSin;d=vec2(e.x+f.y+b,e.y-f.x+b);if(d.x<a||d.x>1.0-a||d.y>1.0-a||d.y<a){discard;}d.x*=0.125;d.y=1.0-d.y*0.125;vec4 g=vec4(1.0,1.0,1.0,texture(particleDiffuse,d+vOffset).r);g*=vCol;if(g.a<0.01){discard;}fragColor=g;fragColor.rgb*=fragColor.a;fragColor.a*=0.33;}`;var jx=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D particleDiffuse;in vec4 vCol;in vec2 vOffset;in float vRotationCos;in float vRotationSin;out vec4 fragColor;const float a=1.0/(1024.0/8.0);void main(){float b=0.5;float c=abs(vRotationSin)+abs(vRotationCos);vec2 d=vec2(gl_PointCoord.x-b,gl_PointCoord.y-b)*c;vec2 e=d*vRotationCos;vec2 f=d*vRotationSin;d=vec2(e.x+f.y+b,e.y-f.x+b);if(d.x<a||d.x>1.0-a||d.y>1.0-a||d.y<a){discard;}d.x*=0.125;d.y=1.0-d.y*0.125;vec3 g=texture(particleDiffuse,d+vOffset).rgb;if((g.r+g.g+g.b)<0.1){discard;}fragColor=vec4(g.rgb,1.0);}`;var Wx=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;uniform vec2 offset[4];uniform vec4 amount;in vec2 vUv;out vec4 fragColor;void main(){vec3 a=texture(inputA,vUv+offset[0]).rgb*amount[0];a+=texture(inputA,vUv+offset[1]).rgb*amount[1];a+=texture(inputA,vUv+offset[2]).rgb*amount[2];a+=texture(inputA,vUv+offset[3]).rgb*amount[3];fragColor=vec4(a,1.0);}`;var Gx=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;uniform sampler2D inputB;uniform float amount;in vec2 vUv;out vec4 fragColor;void main(){vec4 a=texture(inputA,vUv);vec3 b=texture(inputB,vUv).rgb;b=b*b;fragColor.w=a.w;fragColor.xyz=b*amount+a.xyz;}`;var Hx=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform sampler2D inputA;in vec2 vUv;out vec4 fragColor;
#define a  4.0
#define b (1.0/a)
#define c (1.0/128.0)
#define d (1.0/8.0)
vec3 e(vec4 f,sampler2D g,vec2 h){vec3 i=textureLod(g,f.zw,0.0).xyz;vec3 j=textureLod(g,f.zw+vec2(1,0)*h.xy,0.0).xyz;vec3 k=textureLod(g,f.zw+vec2(0,1)*h.xy,0.0).xyz;vec3 l=textureLod(g,f.zw+vec2(1,1)*h.xy,0.0).xyz;vec3 m=textureLod(g,f.xy,0.0).xyz;vec3 n=vec3(0.299,0.587,0.114);float o=dot(i,n);float p=dot(j,n);float q=dot(k,n);float r=dot(l,n);float s=dot(m,n);float t=min(s,min(min(o,p),min(q,r)));float u=max(s,max(max(o,p),max(q,r)));vec2 v;v.x=-((o+p)-(q+r));v.y=((o+q)-(p+r));float w=max((o+p+q+r)*(0.25*b),c);float x=1.0/(min(abs(v.x),abs(v.y))+w);v=min(vec2(a,a),max(vec2(-a,-a),v*x))*h.xy;vec3 y=(1.0/2.0)*(textureLod(g,f.xy+v*(1.0/3.0-0.5),0.0).xyz+textureLod(g,f.xy+v*(2.0/3.0-0.5),0.0).xyz);vec3 az=y*(1.0/2.0)+(1.0/4.0)*(textureLod(g,f.xy+v*(0.0/3.0-0.5),0.0).xyz+textureLod(g,f.xy+v*(3.0/3.0-0.5),0.0).xyz);float aa=dot(az,n);if((aa<t)||(aa>u))return y;return az;}void main(){vec2 h=1.0/resolution;vec4 f=vec4(vUv,vUv-(h*(0.5+d)));vec3 ab=e(f,inputA,1.0/resolution);fragColor=vec4(ab,1.);}`;var Yx=`#version 300 es
precision highp float;precision highp int;uniform Screen{vec2 resolution;};uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform sampler2D inputA;uniform vec4 tint;uniform float warp;in vec2 vUv;out vec4 fragColor;void main(){float a=0.01;float b=5.0;vec2 c;c.x=sin(vUv.y*10.0+time)*a;c.y=cos(vUv.x*10.0+time)*a;vec4 d=texture(inputA,vUv);vec4 e=texture(inputA,vUv+c);vec4 f=mix(d,e,warp);f.rgb=mix(f.rgb,tint.rgb*0.2+0.8*tint.rgb*length(f.rgb),tint.a);fragColor=f;}`;var Xx=`#version 300 es
precision highp float;precision highp int;uniform vec4 colStart;uniform vec4 colEnd;uniform vec2 offset;in vec2 vUv;out vec4 fragColor;void main(){fragColor=mix(colStart,colEnd,vUv.x);if(fragColor.a<0.01){discard;}fragColor.rgb*=fragColor.a;fragColor.a*=0.5;}`;var Qx=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform vec2 offset;in vec3 position;in vec2 uv;out vec2 vUv;void main(){vUv=vec2(uv.x-min(uv.x/offset.y,1.0)*offset.x,uv.y);gl_Position=projectionViewMatrix*vec4(position,1.0);}`;var Zx=`#version 300 es
precision highp float;precision highp int;uniform vec4 colStart;uniform vec4 colEnd;uniform vec2 offset;uniform sampler2D diffuse;in vec2 vUv;out vec4 fragColor;void main(){fragColor=texture(diffuse,vUv);fragColor*=mix(colStart,colEnd,vUv.x);if(fragColor.a<0.01){discard;}}`;var Jx=`#version 300 es
precision highp float;precision highp int;void main(){}`;var Kx=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};in mat4 worldMatrix;in vec3 position;in vec2 uv;out vec2 vUv;void main(){vUv=uv;gl_Position=projectionViewMatrix*worldMatrix*vec4(position,1.0);}`;var ew=`#version 300 es
precision highp float;precision highp int;in vec2 vUv;uniform sampler2D diffuse;void main(){if(texture(diffuse,vUv).a<0.7)discard;}`;var tw=`#version 300 es
precision highp float;precision highp int;uniform vec4 color;out vec4 fragColor;void main(){fragColor=color;}`;var nw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 position;in vec2 uv;in vec3 normal;out vec2 vUv;out vec3 vNormal;out vec3 vPos;void main(){vUv=uv;vNormal=normal;vPos=position;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var iw=`#version 300 es
precision highp float;precision highp int;uniform sampler2D diffuse;in vec2 vUv;out vec4 fragColor;void main(){vec4 a=texture(diffuse,vUv);vec3 b=normalize(vec3(1.0,1.0,0.3));fragColor=a;if(fragColor.a<0.2)discard;}`;var sw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec2 uv;in vec3 position;in vec3 normal;out vec2 vUv;out vec3 vNormal;void main(){vUv=uv;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var ow=`#version 300 es
precision highp float;precision highp int;in vec4 vColor;out vec4 fragColor;void main(){fragColor=vColor;}`;var rw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 position;in vec4 color;out vec4 vColor;void main(){vColor=color;gl_Position=projectionViewMatrix*modelMatrix*vec4(position,1.0);}`;var aw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Sky{vec3 skycolors[5];vec3 suncolor;};uniform sampler2D skyDiffuse;uniform sampler2D cloudDiffuse;in vec2 vUv;in vec3 vPos;out vec4 fragColor;void main(){gl_FragDepth=0.999999;vec3 a=vec3(0.0);float b=vPos.y/0.5;if(b>0.4){a=mix(skycolors[1],skycolors[0],smoothstep(0.4,1.0,b));}else if(b>0.25){a=mix(skycolors[2],skycolors[1],smoothstep(0.25,0.4,b));}else if(b>0.06){a=mix(skycolors[3],skycolors[2],smoothstep(0.06,0.25,b));}else{a=mix(fog[0],skycolors[3],smoothstep(0.0,0.06,b));}float c=1.0-sin(daycycle*6.28)+0.02;float d=smoothstep(0.1,0.5,b)*smoothstep(0.9,0.6,b);a+=texture(skyDiffuse,vUv*vec2(4.0,1.0)).rgb*c*d;float e=texture(cloudDiffuse,vec2(vUv.x+time/80.0,vUv.y*0.6+time/120.0)).r*texture(cloudDiffuse,vec2(vUv.x*2.0+time/300.0,vUv.y*0.6)).r;e=e*smoothstep(0.0,0.1,b)*smoothstep(0.9,0.6,b);e=smoothstep(0.25,0.7,e);a=mix(a,skycolors[4],e);fragColor=vec4(a,1.0);}`;var lw=`#version 300 es
precision highp float;precision highp int;in vec2 vUv;uniform float seed;float a(in vec2 uv,float scale){uv*=scale;vec2 b=floor(uv),f=fract(uv),p;float c=3.,d;p=.5+.35*sin(11.*fract(sin((b+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);c=min(d,c);return smoothstep(0.,c,sin(f.x+f.y)*0.003);}vec2 d(vec2 e){e=vec2(dot(e,vec2(127.1,311.7)),dot(e,vec2(269.5,183.3)));return-1.0+2.0*fract(sin(e)*43758.5453123);}float f(in vec2 e){const float g=0.366025404;const float h=0.211324865;vec2 i=floor(e+(e.x+e.y)*g);vec2 j=e-i+(i.x+i.y)*h;vec2 l=(j.x>j.y)?vec2(1.0,0.0):vec2(0.0,1.0);vec2 m=j-l+h;vec2 n=j-1.0+2.0*h;vec3 q=max(0.5-vec3(dot(j,j),dot(m,m),dot(n,n)),0.0);vec3 r=q*q*q*vec3(dot(j,d(i+0.0)),dot(m,d(i+l)),dot(n,d(i+1.0)));float t=dot(r,vec3(70.0));return smoothstep(-1.0,1.0,t);}out vec4 fragColor;void main(){vec2 u=vec2(vUv.x+seed,vUv.y);float r=a(vUv,10.0);r+=a(vUv,20.0)*0.5;r+=a(vUv,30.0)*0.2;r*=f(vUv*20.0);fragColor.rgb+=r*4.0;}`;var cw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Sky{vec3 skycolors[5];vec3 suncolor;};in vec2 vUv;in vec3 vPos;out vec4 fragColor;void main(){gl_FragDepth=0.999998;float a=length(vec2(0.5,0.5)-vUv);float b=smoothstep(0.3,0.2,a)*2.0;b+=smoothstep(0.5,0.1,a);b*=smoothstep(0.08,0.15,(vPos.y+0.2)*0.2+abs(sin(daycycle*6.282)));fragColor.rgba=vec4(suncolor,b);}`;var fw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;vec3 f(vec3 g,vec3 h,vec3 i,vec3 j,float k,vec3 l,float m){float n=clamp(dot(j,worldlight[2]),0.0,k);vec3 o=g*mix(0.7,1.1,0.5+(0.5*n));vec3 p=normalize(worldlight[2]+vViewDir);vec3 q=h*pow(max(0.0,dot(p,j)),20.0)*m*max(k*0.7+0.2,0.2)*20.0;vec3 r=o+h*n+l;return r*i+q;}void s(vec4 t,float u,vec4 v){float w=t.x+t.y+t.z;e+=v[3]*smoothstep(v[1],v[2],w)*u;t.a=u;t.rgb*=u;d+=t;}out vec4 fragColor;void main(){if(vCameraDistance>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec4 x=texture(atlas,vUvChannel);x[3]=max(0.0,min(1.0,1.0-(x.r+x.g+x.b)));if(x[0]==1.0&&x[1]==1.0&&x[2]==1.0)discard;s(texture(diffuse[0],vUvTexture[0]),x[0],terrainInfo[0]);s(texture(diffuse[1],vUvTexture[1]),x[1],terrainInfo[1]);s(texture(diffuse[2],vUvTexture[2]),x[2],terrainInfo[2]);s(texture(diffuse[3],vUvTexture[3]),x[3],terrainInfo[3]);d.rgb/=d.a;e/=d.a;d.a=1.0;float y=1.0;if(a==1&&vCameraDistance<shadowRange[2]){float az=smoothstep(shadowRange[1],shadowRange[2],vCameraDistance);if(vCameraDistance>shadowRange[0]){vec4 aa=shadowPVMatrix[1]*(vWorldPos);vec3 ab=(aa.xyz/aa.w)*0.5+0.5;y=texture(shadowMaps[1],ab);}else{vec4 aa=shadowPVMatrix[0]*(vWorldPos);vec3 ab=(aa.xyz/aa.w)*0.5+0.5;y=texture(shadowMaps[0],ab);}y=y;y=max(y,az);}d.rgb=f(worldlight[1],worldlight[0],d.rgb,vNormal,y,vLight,e);float ac=distance(vWorldPos.xz,circlePos.xz);float ad=min(1.0,max(0.0,4.0-abs(vWorldPos.y-circlePos.y)));if(ac<circlePos.w+0.1&&ad>0.0){d.rgb=mix(d.rgb,circleInfo.rgb,ad*circleInfo.a*((ac<circlePos.w?ac/circlePos.w*0.5:0.0)+max(0.,(0.1-abs(circlePos.w-ac))/0.1)));}float ae=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,ae);fragColor=d;}`;var uw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Pointlights{vec4 lightCols[16];vec3 lightPos[16];int lightCount;};out vec3 vLight;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float a=256.0;const float b=4.0;in vec3 position;in vec3 normal;out vec3 vNormal;out vec3 vUvChannel;out vec2 vUvTexture[4];out vec3 vViewDir;void main(){vNormal=normal;vWorldPos=modelMatrix*vec4(position,1.0);vUvChannel=vec3(position[0],position[2],0.0)/32.0;int c=quadrant%2;int d=int(quadrant%4);if(c==1)vUvChannel.x-=1.0;if(d>1)vUvChannel.y-=1.0;vUvChannel.z=float(quadrant);vec2 e=vec2(-vWorldPos[0],vWorldPos[2])/4.0;vUvTexture[0]=e*terrainInfo[0][0];vUvTexture[1]=e*terrainInfo[1][0];vUvTexture[2]=e*terrainInfo[2][0];vUvTexture[3]=e*terrainInfo[3][0];for(int f=0;f<lightCount;++f){vec3 g=lightPos[f]-vWorldPos.xyz;float h=lightCols[f].w-dot(g,g);if(h>0.0){h/=(lightCols[f].w);h=h*h;vLight+=0.2*lightCols[f].rgb*h;}}vViewDir=-normalize(vWorldPos.xyz-cameraPosition);vCameraDistance=length(cameraPosition-vWorldPos.xyz);gl_Position=projectionViewMatrix*vWorldPos;}`;var pw=`#version 300 es
precision highp float;precision highp int;in vec4 vWorldPos;out vec4 fragColor;uniform vec4 colors[576];uniform int divider;void main(){float a=64.0/float(divider);int b=int(floor(mod(vWorldPos.x,64.0)/a)+floor(mod(vWorldPos.z,64.0)/a)*float(divider));fragColor.rgba=colors[b];}`;var mw=`#version 300 es
precision highp float;precision highp int;in vec3 vPos;in vec3 vNormal;out vec4 fragColor;void main(){float a=0.0;if(vNormal.y<0.93){a=1.0;}fragColor=vec4(0.0,0.0,a,0.4+a*0.6);if(abs(vPos.x-0.0)<0.001||abs(vPos.x-64.0)<0.001||abs(vPos.z-0.0)<0.001||abs(vPos.z-64.0)<0.001)fragColor=vec4(1.0,1.0,0.0,1.0);if((abs(vPos.x-32.0)<0.001&&mod(vPos.z,1.0)<0.5)||(abs(vPos.z-32.0)<0.001&&mod(vPos.x,1.0)<0.5))fragColor=vec4(1.0,1.0,0.0,1.0);}`;var dw=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform mat4 modelMatrix;in vec3 normal;in vec3 position;out vec3 vPos;out vec3 vNormal;void main(){vNormal=normal;vPos=position;gl_Position=projectionViewMatrix*modelMatrix*vec4(position[0],position[1]+0.05,position[2],1.0);}`;var hw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;void f(vec4 g,float h,vec4 i){float j=g.x+g.y+g.z;e+=i[3]*smoothstep(i[1],i[2],j)*h;g.a=h;g.rgb*=h;d+=g;}out vec4 fragColor;void main(){vec4 k=texture(atlas,vUvChannel);k[3]=max(0.0,min(1.0,1.0-(k.r+k.g+k.b)));if(k[0]==1.0&&k[1]==1.0&&k[2]==1.0)discard;f(texture(diffuse[0],vUvTexture[0]),k[0],terrainInfo[0]);f(texture(diffuse[1],vUvTexture[1]),k[1],terrainInfo[1]);f(texture(diffuse[2],vUvTexture[2]),k[2],terrainInfo[2]);f(texture(diffuse[3],vUvTexture[3]),k[3],terrainInfo[3]);d.rgb/=d.a;e/=d.a;d.a=1.0;if(mod(vWorldPos.y,2.0)<0.2){d.rgb=mix(d.rgb,vec3(0.8),0.5);}else{d.rgb=mix(d.rgb,vec3(0.2),0.5);}vec3 l=worldlight[2];l.y*=0.5;l=normalize(l);d.rgb*=max(0.3,min(1.0,dot(l,vNormal)*0.5+0.5));float m=distance(vWorldPos.xz,circlePos.xz);if(m<circlePos.w+0.1){d.rgb=mix(d.rgb,circleInfo.rgb,circleInfo.a*(max(0.,(0.3-abs(circlePos.w-m))/0.3)));}float n=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,n);fragColor=d;}`;var gw=`#version 300 es
precision highp float;precision highp int;uniform Circle{vec4 circlePos;vec4 circleInfo;};precision highp sampler2DShadow;uniform Shadows{uniform mat4 shadowPVMatrix[2];uniform vec3 shadowRange;};const int a=
#SHADOWS;uniform sampler2DShadow shadowMaps[2];uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};const float b=256.0;const float c=4.0;precision highp sampler2DArray;uniform sampler2DArray atlas;uniform sampler2D diffuse[4];in vec3 vLight;in vec3 vNormal;in vec3 vViewDir;in vec3 vUvChannel;in vec2 vUvTexture[4];vec4 d;float e;void f(vec4 g,float h,vec4 i){float j=g.x+g.y+g.z;e+=i[3]*smoothstep(i[1],i[2],j)*h;g.a=h;g.rgb*=h;d+=g;}out vec4 fragColor;void main(){vec4 k=texture(atlas,vUvChannel);k[3]=max(0.0,min(1.0,1.0-(k.r+k.g+k.b)));if(k[0]==1.0&&k[1]==1.0&&k[2]==1.0)discard;d.rgb=texture(diffuse[0],vUvTexture[0]).rgb;float l=64.0/12.0;float m=l/2.0;bool n=mod(vWorldPos.z,l)>m;if(mod(vWorldPos.x,l)<m){if(n){d.rgb=vec3(0.45);}else{d.rgb=vec3(0.55);}}else{if(n){d.rgb=vec3(0.55);}else{d.rgb=vec3(0.45);}}vec3 o=worldlight[2];o.y*=0.5;o=normalize(o);d.rgb*=max(0.3,min(1.0,dot(o,vNormal)*0.5+0.5));float p=distance(vWorldPos.xz,circlePos.xz);if(p<circlePos.w+0.1){d.rgb=mix(d.rgb,circleInfo.rgb,circleInfo.a*(max(0.,(0.3-abs(circlePos.w-p))/0.3)));}float q=clamp((fog[1][1]-vCameraDistance)/(fog[1][1]-fog[1][0]),0.0,1.0);d.rgb=mix(fog[0],d.rgb,q);fragColor=d;}`;var vw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;out vec4 fragColor;void main(){fragColor.rgb=fog[0];}`;var _w=`#version 300 es
precision highp float;precision highp int;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform MeshTerrain{mat4 modelMatrix;vec4 terrainInfo[4];int quadrant;};in vec3 position;void main(){vec4 a=modelMatrix*vec4(position,1.0);gl_Position=projectionViewMatrix*a;}`;var bw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};in float vCameraDistance;in vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Screen{vec2 resolution;};uniform sampler2D waterLines;uniform sampler2D waterNoise;uniform sampler2D bufferPongColor;uniform sampler2D bufferPongDepth;in vec2 vUv;out vec4 fragColor;void main(){float a=length(cameraPosition-vWorldPos.xyz);float b=(texture(waterNoise,vUv.yx/4.0+time*0.1).r-0.5);float c=gl_FragCoord.z;c=c*2.0-1.0;c=projectionMatrix[3][2]/(c+projectionMatrix[2][2]);if(a>fog[1][1]){fragColor=vec4(fog[0],1.0);return;}vec2 d=gl_FragCoord.xy/resolution;float e=texture(bufferPongDepth,d.xy).r;e=e*2.0-1.0;e=projectionMatrix[3][2]/(e+projectionMatrix[2][2]);float f=e-c;vec2 g=vec2(b*0.05,0.0);float h=f;float i=1.0-clamp(h/0.1,0.0,1.0);float j=1.0-clamp(h/0.6,0.0,1.0);float k=1.0-clamp(h/2.0,0.0,1.0);float l=1.0-clamp(h/10.0,0.0,1.0);float m=1.0-clamp(h/100.0+0.5,0.0,1.0);float n=texture(waterLines,vUv.yx+b*0.15).r;vec3 o=mix(watercolors[2],watercolors[1],l);vec3 p=texture(bufferPongColor,d.xy+g).rgb;vec3 q=(worldlight[0]+worldlight[1]);vec3 r=mix(o,p*o,m)+n*watercolors[0]*(0.05+k*0.3);r=mix(r,watercolors[0],j)*q;vec4 s=vec4(r,1.0-i);float t=min(1.0,max(0.0,(n*(b+0.3)*0.5)));s.rgb+=t*worldlight[0];float u=clamp((fog[1][1]-a)/(fog[1][1]-fog[1][0]),0.0,1.0);s.rgb=mix(fog[0],s.rgb,u);fragColor=s;}`;var yw=`#version 300 es
precision highp float;precision highp int;uniform Environment{vec3 worldlight[3];vec3 fog[2];vec3 watercolors[3];float time;float daycycle;};out float vCameraDistance;out vec4 vWorldPos;uniform Camera{mat4 projectionMatrix;mat4 viewMatrix;mat4 projectionViewMatrix;vec3 cameraPosition;};uniform Water{vec3 verts[4];};in vec3 position;in vec3 color;in vec3 colorFoam;in vec3 colorShallow;out vec2 vUv;void main(){vWorldPos.xyz=verts[gl_VertexID];vWorldPos.w=1.0;vUv=vWorldPos.xz/2.0;gl_Position=projectionViewMatrix*vWorldPos;}`;var kw=`#version 300 es
precision highp float;precision highp int;in vec4 vWorldPos;out vec4 fragColor;void main(){fragColor.rgba=vec4(1.0,mod(vWorldPos.y+0.001,1.0),0.0,0.5);}`;var zm={frag:Fx,vert:Cx},$m={frag:Sx,vert:Ax},Um={frag:Px,vert:Tx},Om={frag:Ex,vert:Dx},Nm={frag:Ix,vert:Vx},jm={frag:Lx,vert:qx},Gf={frag:Rx,vert:Bx},Wm={frag:zx,vert:$x},R1={frag:Ux},Gm={vert:Ox},B1={frag:Nx},z1={frag:jx},$1={frag:Wx},U1={frag:Gx},O1={frag:Hx},N1={frag:Yx},Hf={frag:Xx,vert:Qx},j1={frag:Zx},Yf={frag:Jx,vert:Kx},W1={frag:ew},Hm={frag:tw,vert:nw},PE={frag:iw,vert:sw},TE={frag:ow,vert:rw},G1={frag:aw},H1={frag:lw},Y1={frag:cw},Ym={frag:fw,vert:uw},EE={frag:pw},DE={frag:mw,vert:dw},IE={frag:hw},VE={frag:gw},Xm={frag:vw,vert:_w},Qm={frag:bw,vert:yw},LE={frag:kw};var pt=[],X1=[],un={},Ht={},Xf={},ww=()=>{un={shadowMaps:{value:[jl.depthTexture,Nl[1].depthTexture]}};for(let e in Zm){let n=Zm[e];n.vert&&(n.vert=n.vert.replace("#SHADOWS",oe.shadows?1:0)),n.frag&&(n.frag=n.frag.replace("#SHADOWS",oe.shadows?1:0))}let t={mesh:["position","uv","normal","color","interiorlight","alpha","worldMatrix"],effect:["position","uv","normal","color","uvshift","ycutoff","worldMatrix"],drop:["position","shine","uv","uvshift","worldMatrix"],particle:["position","info","progress","scaleRota","colStart","colEnd"],ribbon:["position","uv"],foliage:["position","uv","instPos","instNorm"],post:["position","uv"]};pt[13]=cn({vertex:$m.vert,fragment:$m.frag,cullFace:null,instanced:[{name:"instPos",size:4},{name:"instNorm",size:3}],globalUniforms:un,transparent:!0,attributeLocations:t.foliage}),pt[14]=cn({vertex:Um.vert,fragment:Um.frag,cullFace:null,instanced:[{name:"instPos",size:4},{name:"instNorm",size:3}],globalUniforms:un,transparent:!0,attributeLocations:t.foliage}),pt[3]=cn({vertex:Nm.vert,fragment:Nm.frag,instanced:[{name:"color",size:4},{name:"alpha",size:1},{name:"interiorlight",size:4}],globalUniforms:un,attributeLocations:t.mesh,transparent:!0}),pt[4]=cn({vertex:Gf.vert,fragment:Gf.frag,instanced:[{name:"interiorlight",size:4}],globalUniforms:un,attributeLocations:t.mesh}),pt[5]=cn({vertex:Wm.vert,fragment:Wm.frag,globalUniforms:un,attributeLocations:t.mesh}),pt[15]=cn({vertex:Om.vert,fragment:Om.frag,globalUniforms:un,transparent:!0,depthWrite:!1,instanced:[{name:"color",size:4},{name:"uvshift",size:4},{name:"ycutoff",size:2}],attributeLocations:t.effect}),pt[6]=cn({vertex:Gf.vert,fragment:R1.frag,globalUniforms:un,instanced:[{name:"interiorlight",size:4}],attributeLocations:t.mesh}),pt[7]=cn({vertex:jm.vert,fragment:jm.frag,instanced:[{name:"color",size:4}],globalUniforms:un,attributeLocations:t.mesh}),pt[10]=cn({vertex:zm.vert,fragment:zm.frag,instanced:[{name:"uvshift",size:4},{name:"shine",size:1}],globalUniforms:un,attributeLocations:t.drop}),pt[8]=cn({vertex:Ym.vert,fragment:Ym.frag,globalUniforms:un,attributeLocations:t.mesh}),pt[9]=cn({vertex:Xm.vert,fragment:Xm.frag,globalUniforms:un,attributeLocations:t.mesh}),pt[12]=cn({vertex:Hm.vert,fragment:Y1.frag,transparent:!0,globalUniforms:un,attributeLocations:t.mesh}),pt[20]=cn({vertex:Qm.vert,fragment:Qm.frag,transparent:!0,cullFace:!1,globalUniforms:un,attributeLocations:t.mesh}),pt[11]=cn({vertex:Hm.vert,fragment:G1.frag,cullFace:null,depthTest:!0,globalUniforms:un,attributeLocations:t.mesh}),pt[1]=cn({cullFace:null,vertex:Yf.vert,fragment:W1.frag,globalUniforms:un,attributeLocations:t.mesh}),pt[2]=cn({vertex:Yf.vert,fragment:Yf.frag,globalUniforms:un,attributeLocations:t.mesh}),pt[16]=cn({vertex:Gm.vert,fragment:B1.frag,transparent:!0,depthWrite:!1,globalUniforms:un,attributeLocations:t.particle}),pt[17]=cn({vertex:Gm.vert,fragment:z1.frag,transparent:!1,globalUniforms:un,attributeLocations:t.particle}),pt[18]=cn({vertex:Hf.vert,fragment:Hf.frag,transparent:!0,cullFace:null,depthWrite:!1,globalUniforms:un,attributeLocations:t.ribbon}),pt[19]=cn({vertex:Hf.vert,fragment:j1.frag,transparent:!0,cullFace:null,depthWrite:!1,globalUniforms:un,attributeLocations:t.ribbon}),pt[32]=cn({vertex:dl,fragment:O1.frag,depthWrite:!1,depthTest:!1,globalUniforms:un,uniforms:{inputA:{value:null}},attributeLocations:t.post}),pt[30]=cn({vertex:dl,fragment:$1.frag,depthWrite:!1,depthTest:!1,uniforms:{inputA:{value:null},offset:{value:[0,0,0,0,0,0,0,0]},amount:{value:[0,0,0,0]}},globalUniforms:un,attributeLocations:t.post}),pt[31]=cn({vertex:dl,fragment:U1.frag,depthWrite:!1,depthTest:!1,uniforms:{inputA:{value:null},inputB:{value:null},amount:{value:1}},globalUniforms:un,attributeLocations:t.post}),pt[33]=cn({vertex:dl,fragment:N1.frag,depthWrite:!1,depthTest:!1,globalUniforms:un,uniforms:{inputA:{value:null},tint:{value:[0,0,0,0]},warp:{value:.5}},attributeLocations:t.post}),pt[34]=cn({vertex:dl,fragment:H1.frag,uniforms:{seed:{value:Date.now()%1e3}},attributeLocations:["position","uv"]}),qE(pt,un),Mf(pt[18],O.ONE,O.ONE_MINUS_SRC_ALPHA),Mf(pt[16],O.ONE,O.ONE_MINUS_SRC_ALPHA),Mf(pt[15],O.ONE,O.ONE_MINUS_SRC_ALPHA),X1.push(3,4,6,7,10,15,5)},qE=(t,e)=>{let n=t[4].program,i=["Environment","Camera","Pointlights","Shadows","Circle","Screen","Sky","MeshTerrain","Water"],s=[n,n,n,n,n,t[32].program,t[11].program,t[8].program,t[20].program],o=[!0,!0,!0,!0,!0,!0,!0,!1,!1],r=[];for(let a=0;a<i.length;++a){let l=i[a],c=yx(s[a],l,a),f=l.toLowerCase();if(Xf[f]=c,r.push(c),o[a]){let u=Ol(c);ca(u),Ht[f]=u}}for(let a=0;a<t.length;++a){let l=t[a];l&&(Ey(l,e),Dy(l,r))}},xw,Jm=(t,e)=>{if(t!==xw||e){let n=Ht.camera.data;xw=t,wo(n.cameraPosition,t.worldPosition,0),wo(n.viewMatrix,t.viewMatrix,0),wo(n.projectionMatrix,t.projectionMatrix,0),wo(n.projectionViewMatrix,t.projectionViewMatrix,0),si(Ht.camera)}},Mw=(t,e)=>{di(Ht.screen.data.resolution,t,e),si(Ht.screen)};var Tt=(t,e)=>{let n=t>>16&255,i=t>>8&255,s=t&255,o=[n/255,i/255,s/255];return e!==void 0&&o.push(e),o};var BE=[["white","common"],["green","uncommon"],["blue","rare"],["purp","epic"],["orange", "legendary"],["red", "mythical"]],Wl=t=>t>=110?5:t>=99?4:t>=90?3:t>=70?2:t>=50?1:0,Yt=t=>BE[Wl(t)];var In={black:Tt(0,0),white:Tt(16777215,0),deadgrey:Tt(3355443,0),teal:Tt(3384995,0),magicblue:Tt(3362252,0),paleskin:Tt(14267315,0),darkskin:Tt(8411481,0),slimegreen:Tt(2542694,0),mushgreen:Tt(2077529,0),linen:Tt(13408614,0),woodbrown:Tt(4859433,0),woodbrown2:Tt(10250315,0),tealsteel:Tt(3358797,.5),darksteel:Tt(3355443,.5),greysteel:Tt(5066061,.5),blacksteel:Tt(988178,.5),leather:Tt(4337198,0),emerald:Tt(22866,-.1),gold:Tt(16751616,.9),darkgold:Tt(16747008,.9),paper:Tt(15129011,0),richpurple:Tt(7484623,0),fireorange:Tt(14715686,-.7),archergreen:Tt(10471258,0),warbrown:Tt(15172191,0),bronze:Tt(9258571,.5),silver:Tt(11583679,.6),shamanblue:Tt(3687924,0),mageblue:Tt(6607340,0),bone:Tt(14535066,.2),bone2:Tt(11836267,.2),ice:Tt(14610164,-.2),vanguard:Tt(2848511,0),bloodlust:Tt(14289947,0),pink:Tt(16711935,0),warden:Tt(14755623,0),evilred:Tt(13239043,0),ruby:Tt(15733030,1),moss:Tt(2925637,.2),rock:Tt(5006687,.4),death:Tt(3750201,.8),diamond:Tt(3076559,.9)},Q1=[In.woodbrown,In.bronze,In.greysteel,In.silver,In.gold],Fw=[In.diamond,In.ruby],Z1=[In.leather,In.greysteel,In.silver,In.gold,In.diamond];var nr=[0,0,0],Km={enemy:[1,0,0],friendly:[0,1,0],dead:[.6,.6,.6]},ir=t=>{if(D&&D.player){let e=Ft.clientPlayerChangeTarget.packData({target:t});if(t!==Vn)if(t>0){let n=D.entity(t);n!==void 0&&(n.type===3?n.canBePickedUpBy(D.player)&&Mt(95):(Mt(93),n.faction===2&&tn(4,100)))}else t===0&&Mt(94);Yl=Vn,ma.reset(D.time),D.player.setTarget(t),Si(e)}Vn=t},Vn=0,_n=0,nd=!1,ma=new kt(0,1),Yl=0,tg=t=>{Yl!==t&&(Yl=t,ma.done(D.time)?(D.player.setTarget(t),Vn=t):ma.reset(D.time,vt(ma.passed(D.time)+.5,.5,2)))},K1=0,zE=()=>{tt.lmb.onPress(t=>{K1=D.time}),tt.lmb.onRelease(t=>{sr>0?WE():_n>0&&Lf<20&&D.time-K1<.3&&ir(_n)}),tt.nextTarget.onPress(t=>{Hl=t.shiftKey?2:1}),tt.nextParty.onPress(t=>{Hl=2}),tt.untarget.onPress(t=>{ir(0)})},Qf=(t,e=!0)=>{_n=t,nd=e&&_n>0,op.set(nd?"pointer":"auto"),cp.set(_n)},$E=(t,e,n,i)=>{let s=[0,0,0];for(let o=0,r=i.length;o<r;++o){let a=i[o],[l,c,f]=a.hudPos;if(l>0&&l<e&&c>0&&c<n&&f<1){st(s,a.pos),s[1]+=a.size*.3;let u=Kn(s,Dm(gt.worldPosition,nr,s));u<t&&u<(a.size+.7)**2&&a.stats.alive&&(t=u,_n=a.id)}}return t},UE=(t,e,n,i)=>{let s=!1;for(let o=0,r=i.length;o<r;++o){let a=i[o];if(a.hudPos[2]<1){let l=Kn(a.pos,Dm(gt.worldPosition,nr,a.pos));l<t&&(t=l,_n=a.id,s=!0)}}return s},OE=()=>{ao(gt,nr,Vm),Xt(nr,nr,gt.worldPosition),Zn(nr,nr);let t=En.width,e=En.height,n=_n,i=20,s=!1;_n=0;for(let o=0;o<=12;++o)o!==3&&o!==11&&(i=$E(i,t,e,D.entities.type[o]));s=_n!==0,UE(Math.min(i,.7),t,e,D.entities.type[3])&&(s=D.entity(_n).canBePickedUpBy(D.player)),(n!=_n||s!==nd)&&Qf(_n,s)},Cw=t=>{let e=[0,0,0];fl(An,gt.transform.worldMatrix),ao(gt,e,Vm),Xt(e,e,An),Zn(e,e);let n=[0,0];o3(n,An,e,D.player.pos,td);let i=999;if(t)if(i=n[1]-Math.max(0,n[0]),i<5||n[0]===-1&&n[0]===-1){let o=Dm(An,e,D.player.pos),r=o[0]-D.player.pos[0],a=o[2]-D.player.pos[2],l=1/Math.sqrt(r*r+a*a);st(An,D.player.pos),An[0]+=r*l*td,An[1]+=10,An[2]+=a*l*td,Y(e,0,-1,0),i=20}else n[0]>0&&sn(An,An,e,n[0]);hn(e,e,i);let s=D.raycastEnvironmentClosest(An[0],An[1],An[2],e[0],e[1],e[2]);return sn(An,An,e,s),s===1&&(An[1]=D.getHeight(An[0],An[2])),An},NE=t=>{if(ma.done(D.time)&&Vn!==Yl&&D.player.setTarget(Yl),!tt.shift.down){if(Lm){_n>0&&(Lf>=20||D.time-K1>.3)&&Qf(0,!1);return}OE()}},ts,eg=0,Gl=0,J1=[1,1,1,.3],jE=t=>{let e=Vn,n=_n>0?D.getEntityById(_n):void 0;n!==void 0?n!==ts&&(ts!==void 0&&ts.visual!==void 0&&ts.type!==3&&ts.visual.removeColor(J1),n.visual!==void 0&&n.type!==3&&n.visual.addColor(J1),ts=n):ts!==void 0&&ts.visual!==void 0&&(ts.type!==3&&ts.visual.removeColor(J1),ts=void 0);let i=Ht.circle.data;if(sr>0){let s=Cw(!0);ei(i.circleInfo,...Km.friendly,1),ei(i.circlePos,s[0],s[1],s[2],Sw)}else if(e!==eg?(eg=e,Gl=1):Gl=Math.max(Gl*(1-t*10),0),e>0){let s=D.getEntityById(e);if(s!==void 0){ei(i.circlePos,s.pos[0],s.pos[1]-s.radius,s.pos[2],s.size+Gl);let o=s.stats&&s.stats.alive?D.player.hostility(s)>0?Km.enemy:Km.friendly:Km.dead;ei(i.circleInfo,...o,1-Gl)}}else ei(i.circlePos,0,0,0,0);si(Ht.circle)},ed=[],Hl=0,ng=t=>{if(D.player){if(Hl===1){let e=0,n=0;t=t.filter(s=>s.visual!==void 0&&s.stats!==void 0&&s.stats.alive&&s!==D.player&&D.player.hostility(s)>0&&D.player.canCombatInteract(s)&&Math.abs(ra(D.player.rot,D.player.rotationToV3(s.pos)))<.7);let i=Vn===0;for(let s=t.length-1;s>=0;--s){let o=t[s];i&&(e=o.id),Vn===o.id&&(i=!0),n||(n=o.id),e!==0&&(s=0)}e===0&&n!==0&&(e=n),ir(e),Hl=0}else if(Hl===2){let e=D.entities.type[0].filter(s=>!oe.nextFriendlyTargetAllowNonParty&&!en.has(s.name)?!1:s.stats&&s.stats.alive&&s.faction===D.player.faction&&Er(s.pos,D.player.pos)<30).sort((s,o)=>{let r=en.has(s.name),a=en.has(o.name);return r&&!a?-1:!r&&a?1:0}),n=e.length;if(e=e.filter(s=>ed.indexOf(s.id)<0),e.length===0)ir(D.playerId);else{let s=e[0];ir(s.id)}ed.push(Vn);let i=Math.min(10,oe.nextFriendlyTargetCycle||10,n);for(;i>0&&ed.length>=i;)ed.shift();Hl=0}}},sr=0,td=0,Sw=0,An=[0,0,0],Zf=(t,e,n)=>{sr=t,td=e,Sw=n},WE=()=>{sr!==0&&(Si(Ft.clientPlayerEnvSkill.packData({id:sr,info:[],pos:An})),Zf(0,0,0))},GE=()=>{Yl=0,ma.reset(0),ts=void 0,eg=0,Gl=0};function Aw(t,e,n){let i=t.slice();return i[26]=e[n],i}function Pw(t){let e,n,i,s,o,r,a,l,c,f,u,p=[],g=new Map,v,_,b,y,w,C,A=t[2]=="default"&&Tw(t);l=new vi({props:{size:"1.3em",fract:t[8],barcol:t[13],left:t[10],right:t[6],darken:!1,$$slots:{default:[HE]},$$scope:{ctx:t}}});let M=(t[2]=="default"||t[18])&&Dw(t);function F(E,W){return E[5].role>=1?QE:XE}let V=F(t,-1),L=V(t),q=t[2]=="default"&&t[5].combat&&t[5].alive&&Iw(t),R=pe(t[19]),z=E=>E[26].id;for(let E=0;E<R.length;E+=1){let W=Aw(t,R,E),j=z(W);g.set(j,p[E]=Vw(j,W))}return{c(){e=h("div"),n=h("div"),A&&A.c(),i=h("img"),r=h("div"),a=h("div"),te(l.$$.fragment),M&&M.c(),L.c(),f=ge(),q&&q.c(),u=h("div");for(let E=0;E<p.length;E+=1)p[E].c();m(i,"class",s="pclass icon border black bgc"+t[5].class+" svelte-g292qg"),at(i.src,o=(t[5].rarity!==!1?"/data/ui/mobpower/"+t[5].rarity:"/data/ui/classes/"+t[5].class)+"."+zn+"?v=8582889")||m(i,"src",o),m(n,"class","iconcontainer svelte-g292qg"),m(a,"class",c="panel-black barsInner "+(t[5].id&&t[5].range?"targetable":"")+" svelte-g292qg"),m(u,"class",v="buffarray "+t[2]+" svelte-g292qg"),m(r,"class",_="bars "+(t[17]&&t[5].id==t[17].id&&t[2]=="party"?"target":"")+" svelte-g292qg"),m(e,"id",t[4]),m(e,"class",b="grid "+(t[3]?"right":"left")+" svelte-g292qg"),Pe(e,"font-size",t[15]+"%"),Pe(e,"opacity",t[5].range?"":.6)},m(E,W){x(E,e,W),d(e,n),A&&A.m(n,null),d(n,i),d(e,r),d(r,a),K(l,a,null),M&&M.m(a,null),L.m(r,null),d(r,f),q&&q.m(r,null),d(r,u);for(let j=0;j<p.length;j+=1)p[j]&&p[j].m(u,null);y=!0,w||(C=[Q(a,"click",t[20]),Q(a,"contextmenu",t[25])],w=!0)},p(E,W){E[2]=="default"?A||(A=Tw(E),A.c(),A.m(n,i)):A&&(A.d(1),A=null),(!y||W&32&&s!==(s="pclass icon border black bgc"+E[5].class+" svelte-g292qg"))&&m(i,"class",s),(!y||W&32&&!at(i.src,o=(E[5].rarity!==!1?"/data/ui/mobpower/"+E[5].rarity:"/data/ui/classes/"+E[5].class)+"."+zn+"?v=8582889"))&&m(i,"src",o);let j={};W&256&&(j.fract=E[8]),W&8192&&(j.barcol=E[13]),W&1024&&(j.left=E[10]),W&64&&(j.right=E[6]),W&536895748&&(j.$$scope={dirty:W,ctx:E}),l.$set(j),E[2]=="default"||E[18]?M?(M.p(E,W),W&262148&&P(M,1)):(M=Dw(E),M.c(),P(M,1),M.m(a,null)):M&&(Te(),I(M,1,1,()=>{M=null}),Ee()),(!y||W&32&&c!==(c="panel-black barsInner "+(E[5].id&&E[5].range?"targetable":"")+" svelte-g292qg"))&&m(a,"class",c),V===(V=F(E,W))&&L?L.p(E,W):(L.d(1),L=V(E),L&&(L.c(),L.m(r,f))),E[2]=="default"&&E[5].combat&&E[5].alive?q||(q=Iw(E),q.c(),q.m(r,u)):q&&(q.d(1),q=null),W&524292&&(R=pe(E[19]),Te(),p=ui(p,W,z,1,E,R,g,u,Ii,Vw,null,Aw),Ee()),(!y||W&4&&v!==(v="buffarray "+E[2]+" svelte-g292qg"))&&m(u,"class",v),(!y||W&131108&&_!==(_="bars "+(E[17]&&E[5].id==E[17].id&&E[2]=="party"?"target":"")+" svelte-g292qg"))&&m(r,"class",_),(!y||W&16)&&m(e,"id",E[4]),(!y||W&8&&b!==(b="grid "+(E[3]?"right":"left")+" svelte-g292qg"))&&m(e,"class",b),(!y||W&32768)&&Pe(e,"font-size",E[15]+"%"),(!y||W&32)&&Pe(e,"opacity",E[5].range?"":.6)},i(E){if(!y){P(l.$$.fragment,E),P(M);for(let W=0;W<R.length;W+=1)P(p[W]);y=!0}},o(E){I(l.$$.fragment,E),I(M);for(let W=0;W<p.length;W+=1)I(p[W]);y=!1},d(E){E&&k(e),A&&A.d(),ee(l),M&&M.d(),L.d(),q&&q.d();for(let W=0;W<p.length;W+=1)p[W].d();w=!1,ut(C)}}}function Tw(t){let e;return{c(){e=h("div"),m(e,"class","deco svelte-g292qg")},m(n,i){x(n,e,i)},d(n){n&&k(e)}}}function Ew(t){let e,n,i;return{c(){e=h("div"),m(e,"class",n="progressBar "+t[13]+" hpdelta svelte-g292qg"),m(e,"style",i=(t[14]?"transition:none;":"")+"width:"+t[8]+"%;")},m(s,o){x(s,e,o)},p(s,o){o&8192&&n!==(n="progressBar "+s[13]+" hpdelta svelte-g292qg")&&m(e,"class",n),o&16640&&i!==(i=(s[14]?"transition:none;":"")+"width:"+s[8]+"%;")&&m(e,"style",i)},d(s){s&&k(e)}}}function HE(t){let e,n=t[2]=="default"&&Ew(t);return{c(){n&&n.c(),e=ge()},m(i,s){n&&n.m(i,s),x(i,e,s)},p(i,s){i[2]=="default"?n?n.p(i,s):(n=Ew(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(i){i&&k(e),n&&n.d(i)}}}function Dw(t){let e,n;return e=new vi({props:{size:"0.7em",fract:t[9],barcol:t[16],left:t[11],right:t[7],darken:!0,$$slots:{default:[YE]},$$scope:{ctx:t}}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&512&&(o.fract=i[9]),s&65536&&(o.barcol=i[16]),s&2048&&(o.left=i[11]),s&128&&(o.right=i[7]),s&536875008&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function YE(t){let e;return{c(){e=h("div"),m(e,"class","progressBar bgspell castbar svelte-g292qg"),Pe(e,"width",t[12]+"%"),Pe(e,"display",t[12]>0?"inherit":"none")},m(n,i){x(n,e,i)},p(n,i){i&4096&&Pe(e,"width",n[12]+"%"),i&4096&&Pe(e,"display",n[12]>0?"inherit":"none")},d(n){n&&k(e)}}}function XE(t){let e,n,i;return{c(){e=h("img"),m(e,"class",n="tag icon border black bgf"+t[5].faction+" round svelte-g292qg"),at(e.src,i="/data/ui/factions/"+t[5].faction+"."+zn+"?v=8582889")||m(e,"src",i)},m(s,o){x(s,e,o)},p(s,o){o&32&&n!==(n="tag icon border black bgf"+s[5].faction+" round svelte-g292qg")&&m(e,"class",n),o&32&&!at(e.src,i="/data/ui/factions/"+s[5].faction+"."+zn+"?v=8582889")&&m(e,"src",i)},d(s){s&&k(e)}}}function QE(t){let e,n;return{c(){e=h("img"),m(e,"class","tag icon border black bgblack round svelte-g292qg"),at(e.src,n="/data/ui/icons/"+(t[5].role==2?"star":"starsilver")+"."+zn+"?v=8582889")||m(e,"src",n)},m(i,s){x(i,e,s)},p(i,s){s&32&&!at(e.src,n="/data/ui/icons/"+(i[5].role==2?"star":"starsilver")+"."+zn+"?v=8582889")&&m(e,"src",n)},d(i){i&&k(e)}}}function Iw(t){let e;return{c(){e=h("div"),m(e,"class","tag icon border black round combat svelte-g292qg")},m(n,i){x(n,e,i)},d(n){n&&k(e)}}}function Vw(t,e){let n,i,s,o=[e[26],{size:e[2]=="default"?31:23}],r={};for(let a=0;a<o.length;a+=1)r=ja(r,o[a]);return i=new _x({props:r}),{key:t,first:null,c(){n=ge(),te(i.$$.fragment),this.first=n},m(a,l){x(a,n,l),K(i,a,l),s=!0},p(a,l){e=a;let c=l&524292?tp(o,[l&524288&&np(e[26]),l&4&&{size:e[2]=="default"?31:23}]):{};i.$set(c)},i(a){s||(P(i.$$.fragment,a),s=!0)},o(a){I(i.$$.fragment,a),s=!1},d(a){a&&k(n),ee(i,a)}}}function ZE(t){let e,n,i=t[5].visible&&Pw(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[5].visible?i?(i.p(s,o),o&32&&P(i,1)):(i=Pw(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function JE(t,e,n){let i,s,o,r,a=ce,l=()=>(a(),a=as(v,ie=>n(5,r=ie)),v),c,f,u,p=ce,g=()=>(p(),p=as(_,ie=>n(19,u=ie)),_);se(t,Bs,ie=>n(17,c=ie)),se(t,vl,ie=>n(18,f=ie)),t.$$.on_destroy.push(()=>a()),t.$$.on_destroy.push(()=>p());let{unit:v}=e;l();let{buffs:_}=e;g();let{mode:b="default"}=e,{order:y=0}=e,{id:w=""}=e,C,A,M,F,V,L,q,R,z,E,W=!1,j=0,N=ie=>{r.id&&ir(r.id)},U=ie=>Yk(ie,r);return t.$$set=ie=>{"unit"in ie&&l(n(0,v=ie.unit)),"buffs"in ie&&g(n(1,_=ie.buffs)),"mode"in ie&&n(2,b=ie.mode),"order"in ie&&n(3,y=ie.order),"id"in ie&&n(4,w=ie.id)},t.$$.update=()=>{t.$$.dirty&32&&n(24,i=r.world==D.id?r.alive?!1:"Dead":r.world),t.$$.dirty&18874404&&(n(21,C=r.hpMax?b=="default"?ni(r.hp)+"/"+ni(r.hpMax):ni(r.hp):"?"),n(6,M=i||C),n(8,V=i!="offline"?~~(r.hpMax?r.hp/r.hpMax*100:100):0),n(13,E=i?"bggrey":(D.mode.partyBasedHostility?r.party===D.player.party:r.faction===D.player.faction)?"bghealth":"bgenemy")),t.$$.dirty&36&&n(22,A=r.mpMax?b=="default"?ni(r.mp)+"/"+ni(r.mpMax):ni(r.mp):"?"),t.$$.dirty&32&&n(10,q=r.name?fx(r.name,10):""),t.$$.dirty&32&&n(11,R=r.timedSkill?(S.ui.hiddenskills[r.timedSkill.id]||S.items.book[r.timedSkill.id]).name:`Lv. ${r.level}`),t.$$.dirty&20971552&&n(7,F=i||(r.timedSkill?r.timedCast.remaining(D.smoothtime).toFixed(1):A)),t.$$.dirty&16777248&&n(9,L=i!="offline"?~~(r.mpMax?r.mp/r.mpMax*100:100):0),t.$$.dirty&16777248&&n(12,z=i!="offline"&&r.timedSkill?r.timedCast.fraction(D.smoothtime)*100:0),t.$$.dirty&16777216&&n(16,s=i?"bggrey":"bgmana"),t.$$.dirty&4&&n(15,o=Math.round(b=="default"?100:85)),t.$$.dirty&8388640&&(n(14,W=j!=r.id),n(23,j=r.id))},[v,_,b,y,w,r,M,F,V,L,q,R,z,E,W,o,s,c,f,u,N,C,A,j,i,U]}var sg=class extends we{constructor(e){super(),Ce(this,e,JE,ZE,$e,{unit:0,buffs:1,mode:2,order:3,id:4})}},Jf=sg;function KE(t){let e,n,i,s;return n=new Jf({props:{id:"ufplayer",order:0,unit:Rs,buffs:nl}}),i=new Jf({props:{id:"uftarget",order:1,unit:Bs,buffs:Lc}}),{c(){e=h("div"),te(n.$$.fragment),te(i.$$.fragment),m(e,"class","targetframes svelte-17up9g6")},m(o,r){x(o,e,r),K(n,e,null),K(i,e,null),s=!0},p:ce,i(o){s||(P(n.$$.fragment,o),P(i.$$.fragment,o),s=!0)},o(o){I(n.$$.fragment,o),I(i.$$.fragment,o),s=!1},d(o){o&&k(e),ee(n),ee(i)}}}var og=class extends we{constructor(e){super(),Ce(this,e,null,KE,Fn,{})}},Lw=og;function qw(t){let e,n;return{c(){e=h("span"),n=T(t[2]),m(e,"class","slottext key svelte-1p1x0hl")},m(i,s){x(i,e,s),d(e,n)},p(i,s){s[0]&4&&G(n,i[2])},d(i){i&&k(e)}}}function Rw(t){let e,n;return{c(){e=h("span"),n=T(t[3]),m(e,"class","slottext stacks svelte-1p1x0hl")},m(i,s){x(i,e,s),d(e,n)},p(i,s){s[0]&8&&G(n,i[3])},d(i){i&&k(e)}}}function Bw(t){let e,n=(t[5]>99?Math.round(t[5]/60)+"'":t[5]<=3?t[5].toFixed(1):Math.ceil(t[5]))+"",i;return{c(){e=h("div"),i=T(n),m(e,"class","time absCentered slottext svelte-1p1x0hl")},m(s,o){x(s,e,o),d(e,i)},p(s,o){o[0]&32&&n!==(n=(s[5]>99?Math.round(s[5]/60)+"'":s[5]<=3?s[5].toFixed(1):Math.ceil(s[5]))+"")&&G(i,n)},d(s){s&&k(e)}}}function zw(t){let e;return{c(){e=h("div"),m(e,"class","autocast svelte-1p1x0hl")},m(n,i){x(n,e,i)},d(n){n&&k(e)}}}function $w(t){let e,n,i,s=t[31].default,o=Wa(s,t,t[30],null);return{c(){e=h("div"),o&&o.c(),m(e,"class",n="border "+t[6]+" slotdescription svelte-1p1x0hl"),m(e,"style",t[10])},m(r,a){x(r,e,a),o&&o.m(e,null),t[33](e),i=!0},p(r,a){o&&o.p&&(!i||a[0]&1073741824)&&Ha(o,s,r,r[30],i?Ga(s,r[30],a,null):Ya(r[30]),null),(!i||a[0]&64&&n!==(n="border "+r[6]+" slotdescription svelte-1p1x0hl"))&&m(e,"class",n),(!i||a[0]&1024)&&m(e,"style",r[10])},i(r){i||(P(o,r),i=!0)},o(r){I(o,r),i=!1},d(r){r&&k(e),o&&o.d(r),t[33](null)}}}function eD(t){let e,n,i,s,o,r,a,l,c,f,u,p,g,v,_,b,y=t[2]!==void 0&&qw(t),w=t[3]!==void 0&&Rw(t),C=oe.cdTextSkills&&t[5]!==void 0&&Bw(t),A=t[11]&&zw(t),M=t[9]&&t[0]&&!t[15]&&$w(t);return{c(){e=h("div"),y&&y.c(),n=ge(),w&&w.c(),i=ge(),C&&C.c(),s=h("div"),r=h("div"),l=h("div"),A&&A.c(),f=h("img"),M&&M.c(),m(s,"class",o="overlay "+(t[4]!==void 0?"":"hidden")+" svelte-1p1x0hl"),m(r,"class",a="overlay "+t[16]+" svelte-1p1x0hl"),m(l,"class",c="overlay "+(!t[14]||t[4]>0&&t[4]<10?"hidden":"offCd")+" svelte-1p1x0hl"),m(f,"class",u="icon "+t[7]+" svelte-1p1x0hl"),at(f.src,p=t[17])||m(f,"src",p),m(e,"id",t[8]),m(e,"class",g="border "+t[6]+" "+(t[15]&&t[15].data==t[1]?"grey":"")+" slot "+(t[1]?"filled":"")+" svelte-1p1x0hl")},m(F,V){x(F,e,V),y&&y.m(e,null),d(e,n),w&&w.m(e,null),d(e,i),C&&C.m(e,null),d(e,s),t[32](s),d(e,r),d(e,l),A&&A.m(e,null),d(e,f),M&&M.m(e,null),v=!0,_||(b=[Q(e,"pointerenter",t[20]),Q(e,"pointerleave",t[21]),Q(e,"pointerdown",t[18]),Q(e,"pointerup",t[19])],_=!0)},p(F,V){F[2]!==void 0?y?y.p(F,V):(y=qw(F),y.c(),y.m(e,n)):y&&(y.d(1),y=null),F[3]!==void 0?w?w.p(F,V):(w=Rw(F),w.c(),w.m(e,i)):w&&(w.d(1),w=null),oe.cdTextSkills&&F[5]!==void 0?C?C.p(F,V):(C=Bw(F),C.c(),C.m(e,s)):C&&(C.d(1),C=null),(!v||V[0]&16&&o!==(o="overlay "+(F[4]!==void 0?"":"hidden")+" svelte-1p1x0hl"))&&m(s,"class",o),(!v||V[0]&65536&&a!==(a="overlay "+F[16]+" svelte-1p1x0hl"))&&m(r,"class",a),(!v||V[0]&16400&&c!==(c="overlay "+(!F[14]||F[4]>0&&F[4]<10?"hidden":"offCd")+" svelte-1p1x0hl"))&&m(l,"class",c),F[11]?A||(A=zw(F),A.c(),A.m(e,f)):A&&(A.d(1),A=null),(!v||V[0]&128&&u!==(u="icon "+F[7]+" svelte-1p1x0hl"))&&m(f,"class",u),(!v||V[0]&131072&&!at(f.src,p=F[17]))&&m(f,"src",p),F[9]&&F[0]&&!F[15]?M?(M.p(F,V),V[0]&33281&&P(M,1)):(M=$w(F),M.c(),P(M,1),M.m(e,null)):M&&(Te(),I(M,1,1,()=>{M=null}),Ee()),(!v||V[0]&256)&&m(e,"id",F[8]),(!v||V[0]&32834&&g!==(g="border "+F[6]+" "+(F[15]&&F[15].data==F[1]?"grey":"")+" slot "+(F[1]?"filled":"")+" svelte-1p1x0hl"))&&m(e,"class",g)},i(F){v||(P(M),v=!0)},o(F){I(M),v=!1},d(F){F&&k(e),y&&y.d(),w&&w.d(),C&&C.d(),t[32](null),A&&A.d(),M&&M.d(),_=!1,ut(b)}}}function tD(t,e,n){let i,s,o,r;se(t,Pn,H=>n(15,r=H));let{$$slots:a={},$$scope:l}=e,{data:c=void 0}=e,{key:f}=e,{stacks:u}=e,{cd:p}=e,{remaining:g}=e,{border:v="grey"}=e,{img:_}=e,{meta:b}=e,{css:y=""}=e,{id:w=""}=e,{describe:C=!0}=e,{queued:A=!1}=e,{pickable:M=!0}=e,{descRoot:F}=e,{descPos:V="bottom: 100%; right: 100%;"}=e,{auto:L=!1}=e,{status:q=0}=e,{hover:R=!1}=e,{clickToUse:z=!1}=e,{shift:E=!1}=e,W=!1,j=(H,qe)=>H?"queued":qe==5?"oom":qe==6?"range":qe==11||qe==9?"combat":"hidden",N,U=H=>{z&&!E?Ne("use",{e:H,...b}):(W=!0,Me(!1),Ne("click",b))},ie=H=>{H.button==2?E?Ne("use",{e:H,...b}):Ne("context",{e:H,...b}):r?(r.data.type&&Mt(Ri[r.data.type].sound),Ne("move",{from:r.meta,to:b}),r.meta&&r.meta.store&&r.meta.store.set(),nt(Pn,r=void 0,r)):(!z||E)&&me(),W=!1},re=H=>{Me(!0)},ae=()=>{Ne("discard")},ue=H=>{Me(!1),c&&W&&(W=!1,me())},Me=H=>{R!=="force"&&n(0,R=H)},me=()=>{!c||M===!1||(c.moving||nt(Pn,r={data:c,img:_,meta:b,border:v,css:y,discard:ae},r),c.type&&Mt(Ri[c.type].sound))},Ne=Mr(),De;function Fe(H){Wt[H?"unshift":"push"](()=>{De=H,n(13,De)})}function _e(H){Wt[H?"unshift":"push"](()=>{N=H,n(12,N)})}return t.$$set=H=>{"data"in H&&n(1,c=H.data),"key"in H&&n(2,f=H.key),"stacks"in H&&n(3,u=H.stacks),"cd"in H&&n(4,p=H.cd),"remaining"in H&&n(5,g=H.remaining),"border"in H&&n(6,v=H.border),"img"in H&&n(22,_=H.img),"meta"in H&&n(23,b=H.meta),"css"in H&&n(7,y=H.css),"id"in H&&n(8,w=H.id),"describe"in H&&n(9,C=H.describe),"queued"in H&&n(24,A=H.queued),"pickable"in H&&n(25,M=H.pickable),"descRoot"in H&&n(26,F=H.descRoot),"descPos"in H&&n(10,V=H.descPos),"auto"in H&&n(11,L=H.auto),"status"in H&&n(27,q=H.status),"hover"in H&&n(0,R=H.hover),"clickToUse"in H&&n(28,z=H.clickToUse),"shift"in H&&n(29,E=H.shift),"$$scope"in H&&n(30,l=H.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&16400&&n(14,i=i||p>0),t.$$.dirty[0]&138444817&&n(17,s=_?r&&R||p>0||q==-1?_.replace(/(?<!githubusercontent)\.(?!githubusercontent)/,"_grey.").replace(/_q[0-9]/g,""):_:`/data/ui/slotbg/bg.${Gn}?v=8582889`),t.$$.dirty[0]&150996992&&n(16,o=j(L||A,q)),t.$$.dirty[0]&67112960&&N&&F&&F.appendChild(N),t.$$.dirty[0]&8208&&Wf(Math.floor(p||0),De,40)},[R,c,f,u,p,g,v,y,w,C,V,L,N,De,i,r,o,s,U,ie,re,ue,_,b,A,M,F,q,z,E,l,a,Fe,_e]}var rg=class extends we{constructor(e){super(),Ce(this,e,tD,eD,Fn,{data:1,key:2,stacks:3,cd:4,remaining:5,border:6,img:22,meta:23,css:7,id:8,describe:9,queued:24,pickable:25,descRoot:26,descPos:10,auto:11,status:27,hover:0,clickToUse:28,shift:29},null,[-1,-1])}},da=rg;var Uw=(t,e)=>typeof t=="function"?t(e):t;var Kf=Object.keys({onBlock:0,statsStatic:0,statsConvert:0,statsOverride:0,onInterval:0,multiplyIncomingHeal:0,multiplyIncomingDamage:0,addIncomingHeal:0,addIncomingDamage:0,addIncomingCrit:0,afterDamageEnemy:0,afterHealAlly:0,beforeDamageEnemy:0,beforeIncomingDamage:0,afterIncomingDamage:0,movementOverride:0,incapacitated:0,breakOnMove:0,breakOnCast:0,instantCast:0,onCast:0,onEnd:0,immuneAll:0,immuneCC:0,breakAfterPercentDamage:0}),de=class{constructor(e){this.id=e.id,this.intervalHaste=e.intervalHaste!==!1,this.intervalDuration=e.intervalDuration,this.intervalOnApply=e.intervalOnApply||!1,this.maxStacks=e.maxStacks,this.passive=e.passive||!1,this.clearOnDeath=e.clearOnDeath!==!1,this.custom=e.custom,this.unique=e.unique||!1,this.dr=e.dr||0,this.type=e.type||0,this.tags=e.tags||new Set,this.immuneAll=e.immuneAll||!1,this.immuneCC=e.immuneCC||!1,Kf.forEach(n=>{this[n]=e[n]}),this.customIcon=e.customIcon,this.icon=e.icon,this.fx=e.fx||{}}onSet(e,n,i){this.tags.forEach(s=>{i.tags.get(s).add(e)}),Kf.forEach(s=>{this[s]&&(s!=="incapacitated"&&s!=="movementOverride"||i.immuneCC.size<=0)&&i[s].add(e)})}onRemove(e,n,i){this.tags.forEach(s=>{i.tags.get(s).delete(e)}),Kf.forEach(s=>{this[s]&&i[s].delete(e)})}};var Ow=new de({id:77,passive:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(t.level*40)),e.addStat(28,Math.round(t.level*200))}});var Nw=new de({id:59,tags:new Set([11]),icon:"ui/skills/2",fx:{stick:15},statsStatic:(t,e)=>{e.addStat(13,300+t.level*40)}});var id=(t,e)=>t*e/65535;var jw=(t,e)=>{let n=e/65535;return[(t>>>16)*n,(t&65535)*n]};var _i=t=>t/60;var Xl=(t,e)=>{if(t.static||!e.data)return!1;let n=jw(e.data[0]*2,6400),i=[n[0]-t.pos[0],n[1]-t.pos[2]];return Ml(i)>t.size?(t.setSteer(0,1),t.setRot(oa(i)),t.setJump(0),!0):(t.setSteer(0,0),!1)};var Ww=new de({id:87,incapacitated:!0,icon:"ui/skills/33",fx:{stick:74,endSound:65},statsOverride:(t,e)=>{e.stat.set(15,250)},movementOverride:(t,e,n,i,s)=>{Xl(i,s)||i.buffs.removeBuff(s.id,i.id)}});var Gw=new de({id:76,icon:"ui/skills/20",fx:{stick:53},unique:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(t.level*30)),e.addStat(9,Math.round(t.level*22))}});var Hw=new de({id:73,passive:!0,icon:"ui/skills/17",custom:[[t=>93+t*32,"% as additional damage over 10 seconds"]],afterDamageEnemy:{3:(t,e,n)=>{}}});var Yw=new de({id:74,type:1,tags:new Set([1]),maxStacks:3,icon:"ui/skills/18",fx:{stick:38,color:[.7,.1,.1,.5]},intervalDuration:1.5,onInterval:(t,e,n)=>({id:18,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,noDaze:!0,type:1})});var Xw=new de({id:72,icon:"ui/skills/17",fx:{stick:18,color:[.9,.3,.1,.7]},custom:[[t=>t*12,"% increased damage"]]});var Qw=new de({id:121,incapacitated:!0,type:1,tags:new Set([7]),dr:3,breakAfterPercentDamage:.1,icon:"ui/skills/50",fx:{stick:86,incapacitated:!0},statsOverride:(t,e)=>{e.stat.get(15)>100&&e.stat.set(15,100)},movementOverride:(t,e,n,i,s)=>{Xl(i,s)},intervalDuration:1});var Zw=new de({id:61,passive:!0,icon:"ui/skills/8",statsConvert:[[0,.3,10],[0,.3,11],[0,.3,8]]});var Jw=new de({id:89,type:1,tags:new Set([3]),icon:"ui/skills/34",statsStatic:(t,e)=>{e.maxStat(29,10+t.level*10)}});var Kw=new de({id:105,maxStacks:3,icon:"ui/skills/temperBoostBuff",fx:{stick:24,color:[.2,.2,.25,.95]},statsStatic:(t,e)=>{e.addStat(15,20)}});var e4=new de({id:104,maxStacks:3,tags:new Set([3,4]),icon:"ui/skills/41",fx:{stick:23,color:[.1,.1,.1,.92]},intervalDuration:.5,onInterval:(t,e,n)=>!0});var t4=new de({id:75,icon:"ui/skills/19",fx:{stick:54},unique:!0,statsStatic:(t,e)=>{e.addStat(10,t.level*3),e.addStat(11,t.level*4),e.addStat(6,t.level*50)}});var n4=new de({id:115,incapacitated:!0,tags:new Set([8]),immuneCC:!0,icon:"ui/skills/46",fx:{anim:34},statsStatic:(t,e)=>{e.maxStat(29,40)},statsOverride:(t,e)=>{e.stat.set(13,0)},intervalDuration:.5,onInterval:(t,e,n)=>!0});var i4=new de({id:91,type:1,tags:new Set([6]),incapacitated:!0,dr:3,icon:"ui/skills/37",fx:{visual:20,stick:88,endSound:69},statsStatic:(t,e)=>{e.maxStat(29,30+t.level*7),e.maxStat(30,20+t.level*5)}});var s4=new de({id:84,icon:"ui/skills/28",fx:{stick:65},unique:!0,statsStatic:(t,e)=>{e.addStat(16,100+t.level*60)}});var o4=new de({id:67,type:1,tags:new Set([3,1]),icon:"ui/skills/12",fx:{apply:50,stick:49,color:[.5,.4,.05,.5]},statsStatic:(t,e)=>{e.maxStat(29,20+t.level*3)},intervalDuration:1.5,onInterval:(t,e,n)=>({id:12,mode:1,caster:t.caster,target:e.id,dmg:1+n.stats.getDamageRoll()*(.1+t.level*.08),type:1,noDaze:!0})});var r4=new de({id:68,icon:"ui/skills/13",fx:{stick:52},intervalDuration:1,custom:[[t=>30+40*t,"MP recovered"]],onInterval:(t,e,n)=>{}});var a4=new de({id:107,maxStacks:5,icon:"ui/skills/43",fx:{stick:20}});var l4=new de({id:106,passive:!0});var c4=new de({id:60,maxStacks:3,icon:"ui/skills/7",fx:{stick:37},intervalDuration:1,multiplyIncomingHeal:{6:t=>1+t.stacks*.3,7:t=>1+(t.stacks-1)*.3},onInterval:(t,e,n)=>({id:7,mode:2,caster:t.caster,target:e.id,heal:6+n.stats.getDamageRoll()*(.028+t.level*.024)})});var f4=new de({id:64,passive:!0,icon:"ui/skills/8",statsConvert:[[4,.4,10],[4,.4,11]]});var u4=new de({id:90,breakOnCast:!0,icon:"ui/skills/36",fx:{visual:26,apply:76,endSound:69},statsStatic:(t,e)=>{e.addStat(15,8+t.level*12)}});var p4=new de({id:119,incapacitated:!0,type:1,tags:new Set([7]),dr:3,breakAfterPercentDamage:.1,icon:"ui/skills/49",fx:{incapacitated:!0,apply:122,stick:124},statsOverride:(t,e)=>{e.stat.get(15)>50&&e.stat.set(15,50)},movementOverride:(t,e,n,i,s)=>{Xl(i,s)}});var m4=new de({id:120,passive:!0});var d4=new de({id:82,passive:!0,statsStatic:(t,e)=>{e.addStat(14,Math.round(t.level*30))}});var h4=new de({id:66,icon:"ui/skills/11",fx:{stick:39,endSound:69},custom:[[t=>t*9,"% increased damage"]]});var g4=new de({id:83,icon:"ui/skills/27",fx:{stick:63},unique:!0,statsStatic:(t,e)=>{e.addStat(15,5+t.level*13)}});var v4=new de({id:85,passive:!0,icon:"ui/skills/29",custom:[[t=>40+t*21,"% per stack as additional damage over 10 seconds"]],afterDamageEnemy:{9:(t,e,n)=>{}}});var _4=new de({id:86,type:1,maxStacks:3,tags:new Set([3,1]),icon:"ui/skills/29",fx:{apply:51,stick:66,color:[.1,1,.3,.3]},statsStatic:(t,e)=>{e.maxStat(29,30)},intervalDuration:1.5,onInterval:(t,e,n)=>({id:29,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,type:1,noDaze:!0})});var b4=new de({id:95,maxStacks:4,icon:"ui/skills/31",instantCast:new Set([31]),beforeDamageEnemy:{31:(t,e,n,i)=>{}}});var y4=new de({id:65,passive:!0,icon:"ui/skills/10",custom:[[t=>2+t*1," Jumps"],[t=>15+t*12.5,"% damage per Jump"]],afterDamageEnemy:{9:(t,e,n)=>{}}});var k4=new de({id:92,icon:"ui/skills/38",fx:{stick:77},statsStatic:(t,e)=>{e.addStat(15,30)},instantCast:new Set([9]),onCast:{9:(t,e)=>{}}});var x4=new de({id:96,passive:!1,incapacitated:!0,icon:"ui/skills/38",statsOverride:(t,e)=>{e.stat.set(15,400)},movementOverride:(t,e,n,i,s)=>{i.setSteer(s.data[0]-1,s.data[1]-1)}});var w4=new de({id:63,passive:!0,icon:"ui/skills/8",statsConvert:[[2,.4,10],[2,.4,11]]});var M4=new de({id:81,icon:"ui/skills/25",fx:{stick:64},unique:!0,statsStatic:(t,e)=>{e.addStat(16,t.level*30)}});var F4=new de({id:118,passive:!0});var C4=new de({id:114,incapacitated:!0,tags:new Set([8]),icon:"ui/skills/45",fx:{anim:33},intervalHaste:!1,intervalDuration:.25,statsStatic:(t,e)=>{e.maxStat(29,15)},onInterval:(t,e,n)=>!0});var S4=new de({id:78,icon:"ui/skills/22",fx:{stick:60},unique:!0,statsStatic:(t,e)=>{e.addStat(14,t.level*30)}});var A4=new de({id:101,type:1,tags:new Set([5]),incapacitated:!0,dr:1,icon:"ui/skills/deepFrozen",fx:{stick:57,color:[.1,.9,.8,.9],frozen:!0},statsStatic:(t,e)=>{e.maxStat(29,100)},multiplyIncomingDamage:{4:t=>1+t.level*.1,15:t=>1+t.level*.1,51:t=>1+t.level*.1}});var P4=new de({id:80,icon:"ui/skills/24",fx:{stick:91},unique:!0,statsStatic:(t,e)=>{e.addStat(10,Math.floor(2+t.level*1.5)),e.addStat(11,Math.floor(3+t.level*3.5))}});var T4=new de({id:108,icon:"ui/skills/extraBolt",fx:{stick:22}});var E4=new de({id:116,incapacitated:!0,tags:new Set([8,10]),breakOnMove:!0,icon:"ui/skills/52",fx:{anim:35},intervalDuration:1,intervalOnApply:1,onInterval:(t,e,n)=>!0});var D4=new de({id:69,type:1,tags:new Set([4]),dr:2,icon:"ui/skills/14",fx:{stick:56,color:[.7,.7,1,.4]},statsStatic:(t,e)=>{e.maxStat(29,100)},addIncomingCrit:{4:t=>10+t.level*30,15:t=>20+t.level*30},intervalDuration:1.5,onInterval:(t,e,n)=>({id:14,mode:1,caster:t.caster,target:e.id,dmg:n.stats.getDamageRoll()*(.09+t.level*.27),type:1,noDaze:!0})});var I4=new de({id:99,type:1,tags:new Set([3]),maxStacks:4,icon:"ui/skills/frozenBuff",fx:{stick:58,color:[.1,.1,.8,.5]},statsStatic:(t,e)=>{e.maxStat(29,20)}});var V4=new de({id:71,icon:"ui/skills/16",fx:{stick:40,endSound:69},statsStatic:(t,e)=>{e.addStat(16,30+t.level*70),e.addStat(27,2+t.level*8)}});var L4=new de({id:117,incapacitated:!0,tags:new Set([9,11,12]),immuneAll:!0,intervalDuration:1,intervalHaste:!1,icon:"ui/skills/53",fx:{stick:120,frozen:!0},statsStatic:(t,e)=>{e.maxStat(29,100)},onInterval:(t,e,n)=>({id:53,mode:2,caster:t.caster,target:n.id,heal:t.level*50,nocrit:!0})});var q4=new de({id:100,passive:!0});var R4=new de({id:79,icon:"ui/skills/23",fx:{stick:17}});var B4=new de({id:70,passive:!0});var z4=new de({id:62,passive:!0,icon:"ui/skills/8",statsConvert:[[3,.4,10],[3,.4,11]]});var $4=new de({id:112,type:0,icon:"ui/skills/charm4",fx:{stick:42,color:[0,0,1,.7]}});var U4=new de({id:113,type:1,tags:new Set([1]),maxStacks:10,icon:"ui/skills/firebuff",fx:{stick:67,color:[2,1,.3,1]}});var O4=new de({id:126,type:1,tags:new Set([1]),maxStacks:5,icon:"ui/skills/firebuff",fx:{stick:132,apply:135,color:[.7,.1,1.5,1]}});var N4=new de({id:94,type:1,tags:new Set([3]),icon:"ui/skills/dazedBuff",fx:{stick:73},statsStatic:(t,e)=>{e.maxStat(29,30)}});var j4=new de({id:110,type:0,icon:"ui/skills/charm2",fx:{stick:21,color:[1,0,0,.8]},statsStatic:(t,e)=>{e.addStat(27,t.level)}});var W4=new de({id:124,passive:!1,icon:"ui/skills/hellspawn"});var G4=new de({id:109,type:0,icon:"ui/skills/charm1",fx:{stick:61,color:[.3,.3,.3,.9]},statsStatic:(t,e)=>{e.addStat(31,50)},beforeIncomingDamage:(t,e,n,i)=>n*(t.level/100)});var H4=new de({id:123,passive:!0});var Y4=new de({id:93,breakOnCast:!0,tags:new Set([12]),icon:"ui/skills/39",customIcon:t=>"items/mount/mount"+tr[t.data[0]].tier+"_q1",fx:{mount:t=>tr[t.data[0]].skin,apply:76,endSound:69},statsStatic:(t,e)=>{e.addStat(15,60)}});var X4=new de({id:130,clearOnDeath:!1,tags:new Set([12]),icon:"ui/skills/39",customIcon:t=>"items/pet/pet"+tr[t.data[0]].tier+"_q1"});var Q4=new de({id:111,type:0,icon:"ui/skills/charm3",fx:{stick:62,color:[.3,0,.6,.8]},statsStatic:(t,e)=>{e.addStat(15,t.level)}});var Z4=new de({id:127,type:0,maxStacks:8,clearOnDeath:!1,icon:"ui/skills/obeliskbuff"});var J4=new de({id:125,maxStacks:25,type:1,icon:"ui/skills/pierce",multiplyIncomingDamage:{0:t=>1+t.stacks*.2,60:t=>1+t.stacks*.2}});var K4=new de({id:103,icon:"ui/skills/postsummon",fx:{stick:80},unique:!0,statsStatic:(t,e)=>{e.addStat(15,20)}});var ag=["potionhp","potionMp"].map((t,e)=>new de({id:[97,98][e],maxStacks:1,icon:"ui/skills/"+t,fx:{stick:[43,83][e]},intervalHaste:!1,intervalDuration:.5,onInterval:(n,i,s)=>({id:100,mode:[2,3][e],caster:n.caster,target:i.id,heal:e==1?void 0:n.level,mprec:e==0?void 0:n.level,nocrit:!0})}));var e5=new de({id:88,type:1,tags:new Set([5]),dr:1,incapacitated:!0,icon:"ui/skills/stunBuff",fx:{stick:86,incapacitated:!0},movementOverride:(t,e,n,i,s)=>{i.setSteer(0,0),i.setJump(0)}});var t5=new de({id:102,maxStacks:99,icon:"ui/skills/suddenDeath",statsStatic:(t,e)=>{e.maxStat(30,t.stacks)}});var n5=new de({id:122,passive:!1,immuneCC:!0,icon:"ui/skills/21",statsStatic:(t,e)=>{e.addStat(6,t.stacks*5e5),t.level>1&&(e.addStat(17,30),e.addStat(16,1e3),e.addStat(15,200),e.addStat(10,500),e.addStat(11,500))},onCast:{0:(t,e,n,i,s)=>{}}});var i5=new de({id:131,passive:!0});var s5=new de({id:132,passive:!0});var o5=new de({id:128,type:0,tags:new Set([12]),icon:"ui/skills/ghost",fx:{color:[.9,1.2,.8,.8],alpha:[.3]}});var r5=new de({id:129,type:0,icon:"ui/skills/moderator",fx:{color:[.3,1.2,.9,.7],alpha:[.3]}});var ha=new Map;[o5,r5,Z4,O4,J4,i5,H4,W4,n5,U4,$4,Q4,j4,G4,K4,t5,ag[0],ag[1],e5,Y4,X4,N4,Qw,n4,Kw,e4,Jw,Ww,t4,Gw,Ow,Yw,Hw,Xw,Nw,Zw,a4,l4,i4,u4,s4,r4,c4,f4,o4,L4,E4,T4,A4,q4,I4,P4,S4,R4,B4,D4,z4,V4,m4,s5,p4,F4,C4,x4,b4,k4,v4,_4,M4,g4,d4,w4,y4,h4].forEach(t=>{ha.set(t.id,t)});var Ql=class{constructor(e){this.entity=e,this.alive=!0,this.stat=new Map,this.resource=new Map,this.combatTimer=new kt(-1,6)}tick(e,n){this.combatTimer.start>0&&this.combatTimer.done(n)&&this.onCombatEnd(n)}die(){return this.alive?(this.alive=!1,this.entity.skills.onDeath(),this.entity.buffs.onDeath(),!0):!1}getStat(e){return this.stat.get(e)|0}getResource(e){return this.resource.get(e)|0}addStat(e,n){this.stat.set(e,(this.stat.get(e)|0)+n)}maxStat(e,n){this.stat.set(e,Math.max(this.stat.get(e)|0,n))}multiplyStat(e,n){this.stat.set(e,(this.stat.get(e)|0)*n)}setResource(e,n){let i=Math.round(vt(n,0,this.getStat(e)));return this.resource.set(e,i),i}changeResource(e,n){return this.setResource(e,this.getResource(e)+n)}respawn(){this.alive=!0,this.onCombatEnd()}clear(){}refreshCombatTimer(e,n){this.combatTimer.end<e+n&&this.combatTimer.reset(e,n)}onCombatEnd(){this.combatTimer.reset(-1)}getDamageRoll(){return Math.round((this.getStat(10)+this.getStat(11))/2)}};function a5(t,e,n){let i=t.slice();return i[12]=e[n],i}function l5(t,e,n){let i=t.slice();return i[15]=e[n],i}function c5(t,e,n){let i=t.slice();return i[18]=e[n],i}function f5(t,e,n){let i=t.slice();return i[18]=e[n],i}function u5(t,e,n){let i=t.slice();return i[23]=e[n],i}function p5(t,e,n){let i=t.slice();return i[26]=e[n],i}function m5(t,e,n){let i=t.slice();return i[23]=e[n],i}function d5(t,e,n){let i=t.slice();return i[26]=e[n],i}function h5(t,e,n){let i=t.slice();return i[33]=e[n],i}function g5(t,e,n){let i=t.slice();return i[26]=e[n],i}function nD(t){let e,n,i,s,o,r,a,l,c,f,u,p,g,v,_,b,y,w,C,A,M,F,V,L=!t[2]&&t[0].parent===void 0&&v5(t),q=t[0].actiontype&&_5(t),R=t[0].auto&&b5(t),z=t[0].costMp&&y5(t),E=t[0].castLen&&k5(t),W=t[0].cd&&x5(t),j=t[0].duration>0&&w5(t),N=t[0].unique&&M5(t),U=t[0].refresh&&F5(t),ie=t[0].range&&C5(t),re=t[6][t[0].targetMode]&&S5(t),ae=t[0].maxStacks&&A5(t),ue=t[0].dmg&&P5(t),Me=t[0].heal&&T5(t),me=pe([t[0].multiplyIncomingHeal,t[0].multiplyIncomingDamage]),Ne=[];for(let Z=0;Z<2;Z+=1)Ne[Z]=D5(h5(t,me,Z));let De=pe([t[0].addIncomingHeal,t[0].addIncomingDamage]),Fe=[];for(let Z=0;Z<2;Z+=1)Fe[Z]=V5(m5(t,De,Z));let _e=pe([t[0].addIncomingCrit]),H=[];for(let Z=0;Z<1;Z+=1)H[Z]=q5(u5(t,_e,Z));let qe=t[0].statsStatic&&R5(t),Oe=t[0].statsConvert&&z5(t),He=t[0].custom&&U5(t),Ye=t[0].aoe&&t[0].aoe.circleRadius&&N5(t),Ze=!t[0].parent&&j5(t),ve=pe(t[5]),le=[];for(let Z=0;Z<ve.length;Z+=1)le[Z]=W5(a5(t,ve,Z));let ze=Z=>I(le[Z],1,1,()=>{le[Z]=null});return{c(){L&&L.c(),e=h("div"),q&&q.c(),n=ge(),R&&R.c(),i=ge(),z&&z.c(),s=ge(),E&&E.c(),o=ge(),W&&W.c(),r=ge(),j&&j.c(),a=ge(),N&&N.c(),l=ge(),U&&U.c(),c=h("div"),ie&&ie.c(),f=ge(),re&&re.c(),ae&&ae.c(),u=ge(),ue&&ue.c(),p=ge(),Me&&Me.c(),g=ge();for(let Z=0;Z<2;Z+=1)Ne[Z].c();v=ge();for(let Z=0;Z<2;Z+=1)Fe[Z].c();_=ge();for(let Z=0;Z<1;Z+=1)H[Z].c();b=ge(),qe&&qe.c(),y=ge(),Oe&&Oe.c(),w=ge(),He&&He.c(),C=ge(),Ye&&Ye.c(),A=ge(),Ze&&Ze.c(),M=ge();for(let Z=0;Z<le.length;Z+=1)le[Z].c();F=ge(),m(e,"class","pad textgreen svelte-14w0l4b")},m(Z,X){L&&L.m(Z,X),x(Z,e,X),q&&q.m(e,null),d(e,n),R&&R.m(e,null),d(e,i),z&&z.m(e,null),d(e,s),E&&E.m(e,null),d(e,o),W&&W.m(e,null),d(e,r),j&&j.m(e,null),d(e,a),N&&N.m(e,null),d(e,l),U&&U.m(e,null),d(e,c),ie&&ie.m(c,null),d(c,f),re&&re.m(c,null),ae&&ae.m(Z,X),x(Z,u,X),ue&&ue.m(Z,X),x(Z,p,X),Me&&Me.m(Z,X),x(Z,g,X);for(let $=0;$<2;$+=1)Ne[$]&&Ne[$].m(Z,X);x(Z,v,X);for(let $=0;$<2;$+=1)Fe[$]&&Fe[$].m(Z,X);x(Z,_,X);for(let $=0;$<1;$+=1)H[$]&&H[$].m(Z,X);x(Z,b,X),qe&&qe.m(Z,X),x(Z,y,X),Oe&&Oe.m(Z,X),x(Z,w,X),He&&He.m(Z,X),x(Z,C,X),Ye&&Ye.m(Z,X),x(Z,A,X),Ze&&Ze.m(Z,X),x(Z,M,X);for(let $=0;$<le.length;$+=1)le[$]&&le[$].m(Z,X);x(Z,F,X),V=!0},p(Z,X){if(!Z[2]&&Z[0].parent===void 0?L?L.p(Z,X):(L=v5(Z),L.c(),L.m(e.parentNode,e)):L&&(L.d(1),L=null),Z[0].actiontype?q?q.p(Z,X):(q=_5(Z),q.c(),q.m(e,n)):q&&(q.d(1),q=null),Z[0].auto?R||(R=b5(Z),R.c(),R.m(e,i)):R&&(R.d(1),R=null),Z[0].costMp?z?z.p(Z,X):(z=y5(Z),z.c(),z.m(e,s)):z&&(z.d(1),z=null),Z[0].castLen?E?E.p(Z,X):(E=k5(Z),E.c(),E.m(e,o)):E&&(E.d(1),E=null),Z[0].cd?W?W.p(Z,X):(W=x5(Z),W.c(),W.m(e,r)):W&&(W.d(1),W=null),Z[0].duration>0?j?j.p(Z,X):(j=w5(Z),j.c(),j.m(e,a)):j&&(j.d(1),j=null),Z[0].unique?N||(N=M5(Z),N.c(),N.m(e,l)):N&&(N.d(1),N=null),Z[0].refresh?U||(U=F5(Z),U.c(),U.m(e,c)):U&&(U.d(1),U=null),Z[0].range?ie?ie.p(Z,X):(ie=C5(Z),ie.c(),ie.m(c,f)):ie&&(ie.d(1),ie=null),Z[6][Z[0].targetMode]?re?re.p(Z,X):(re=S5(Z),re.c(),re.m(c,null)):re&&(re.d(1),re=null),Z[0].maxStacks?ae?ae.p(Z,X):(ae=A5(Z),ae.c(),ae.m(u.parentNode,u)):ae&&(ae.d(1),ae=null),Z[0].dmg?ue?ue.p(Z,X):(ue=P5(Z),ue.c(),ue.m(p.parentNode,p)):ue&&(ue.d(1),ue=null),Z[0].heal?Me?Me.p(Z,X):(Me=T5(Z),Me.c(),Me.m(g.parentNode,g)):Me&&(Me.d(1),Me=null),X[0]&129){me=pe([Z[0].multiplyIncomingHeal,Z[0].multiplyIncomingDamage]);let $;for($=0;$<2;$+=1){let fe=h5(Z,me,$);Ne[$]?Ne[$].p(fe,X):(Ne[$]=D5(fe),Ne[$].c(),Ne[$].m(v.parentNode,v))}for(;$<2;$+=1)Ne[$].d(1)}if(X[0]&129){De=pe([Z[0].addIncomingHeal,Z[0].addIncomingDamage]);let $;for($=0;$<2;$+=1){let fe=m5(Z,De,$);Fe[$]?Fe[$].p(fe,X):(Fe[$]=V5(fe),Fe[$].c(),Fe[$].m(_.parentNode,_))}for(;$<2;$+=1)Fe[$].d(1)}if(X[0]&129){_e=pe([Z[0].addIncomingCrit]);let $;for($=0;$<1;$+=1){let fe=u5(Z,_e,$);H[$]?H[$].p(fe,X):(H[$]=q5(fe),H[$].c(),H[$].m(b.parentNode,b))}for(;$<1;$+=1)H[$].d(1)}if(Z[0].statsStatic?qe?qe.p(Z,X):(qe=R5(Z),qe.c(),qe.m(y.parentNode,y)):qe&&(qe.d(1),qe=null),Z[0].statsConvert?Oe?Oe.p(Z,X):(Oe=z5(Z),Oe.c(),Oe.m(w.parentNode,w)):Oe&&(Oe.d(1),Oe=null),Z[0].custom?He?He.p(Z,X):(He=U5(Z),He.c(),He.m(C.parentNode,C)):He&&(He.d(1),He=null),Z[0].aoe&&Z[0].aoe.circleRadius?Ye?Ye.p(Z,X):(Ye=N5(Z),Ye.c(),Ye.m(A.parentNode,A)):Ye&&(Ye.d(1),Ye=null),Z[0].parent?Ze&&(Ze.d(1),Ze=null):Ze?Ze.p(Z,X):(Ze=j5(Z),Ze.c(),Ze.m(M.parentNode,M)),X[0]&34){ve=pe(Z[5]);let $;for($=0;$<ve.length;$+=1){let fe=a5(Z,ve,$);le[$]?(le[$].p(fe,X),P(le[$],1)):(le[$]=W5(fe),le[$].c(),P(le[$],1),le[$].m(F.parentNode,F))}for(Te(),$=ve.length;$<le.length;$+=1)ze($);Ee()}},i(Z){if(!V){for(let X=0;X<ve.length;X+=1)P(le[X]);V=!0}},o(Z){le=le.filter(Boolean);for(let X=0;X<le.length;X+=1)I(le[X]);V=!1},d(Z){Z&&(k(e),k(u),k(p),k(g),k(v),k(_),k(b),k(y),k(w),k(C),k(A),k(M),k(F)),L&&L.d(Z),q&&q.d(),R&&R.d(),z&&z.d(),E&&E.d(),W&&W.d(),j&&j.d(),N&&N.d(),U&&U.d(),ie&&ie.d(),re&&re.d(),ae&&ae.d(Z),ue&&ue.d(Z),Me&&Me.d(Z),it(Ne,Z),it(Fe,Z),it(H,Z),qe&&qe.d(Z),Oe&&Oe.d(Z),He&&He.d(Z),Ye&&Ye.d(Z),Ze&&Ze.d(Z),it(le,Z)}}}function iD(t){let e,n=t[0].item+"",i;return{c(){e=h("div"),i=T(n)},m(s,o){x(s,e,o),d(e,i)},p(s,o){o[0]&1&&n!==(n=s[0].item+"")&&G(i,n)},i:ce,o:ce,d(s){s&&k(e)}}}function v5(t){let e,n,i,s,o=S.items.book[t[0].id].name+"",r,a=t[0].engineOnly?"":" Lv. "+t[1],l;return{c(){e=h("div"),n=h("img"),s=Ue(),r=T(o),l=T(a),m(n,"class","texticon"),at(n.src,i=Bf(t[0].id))||m(n,"src",i),m(e,"class","slottitle textprimary")},m(c,f){x(c,e,f),d(e,n),d(e,s),d(e,r),d(e,l)},p(c,f){f[0]&1&&!at(n.src,i=Bf(c[0].id))&&m(n,"src",i),f[0]&1&&o!==(o=S.items.book[c[0].id].name+"")&&G(r,o),f[0]&3&&a!==(a=c[0].engineOnly?"":" Lv. "+c[1])&&G(l,a)},d(c){c&&k(e)}}}function _5(t){let e,n=t[8][t[0].mode]+"",i,s,o=t[0].actiontype+"",r;return{c(){e=h("div"),i=T(n),s=Ue(),r=T(o),m(e,"class","textwhite")},m(a,l){x(a,e,l),d(e,i),d(e,s),d(e,r)},p(a,l){l[0]&1&&n!==(n=a[8][a[0].mode]+"")&&G(i,n),l[0]&1&&o!==(o=a[0].actiontype+"")&&G(r,o)},d(a){a&&k(e)}}}function b5(t){let e;return{c(){e=h("div"),e.textContent="Auto cast"},m(n,i){x(n,e,i)},d(n){n&&k(e)}}}function y5(t){let e,n,i=t[0].costMp(t[1])+"",s,o,r=S.ui.stats.array[7]+"",a;return{c(){e=h("div"),n=T("Cost: "),s=T(i),o=Ue(),a=T(r)},m(l,c){x(l,e,c),d(e,n),d(e,s),d(e,o),d(e,a)},p(l,c){c[0]&3&&i!==(i=l[0].costMp(l[1])+"")&&G(s,i)},d(l){l&&k(e)}}}function k5(t){let e,n=t[7](t[0].castLen)+"",i,s;return{c(){e=h("div"),i=T(n),s=T("s Cast time")},m(o,r){x(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].castLen)+"")&&G(i,n)},d(o){o&&k(e)}}}function x5(t){let e,n=t[7](t[0].cd)+"",i,s;return{c(){e=h("div"),i=T(n),s=T("s Cooldown")},m(o,r){x(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].cd)+"")&&G(i,n)},d(o){o&&k(e)}}}function w5(t){let e,n=t[7](t[0].duration)+"",i,s;return{c(){e=h("div"),i=T(n),s=T("s Duration")},m(o,r){x(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].duration)+"")&&G(i,n)},d(o){o&&k(e)}}}function M5(t){let e;return{c(){e=h("div"),e.textContent="Unique"},m(n,i){x(n,e,i)},d(n){n&&k(e)}}}function F5(t){let e;return{c(){e=h("div"),e.textContent="Stacks refresh duration"},m(n,i){x(n,e,i)},d(n){n&&k(e)}}}function C5(t){let e,n=t[7](t[0].range)+"",i,s;return{c(){e=h("span"),i=T(n),s=T("m range ")},m(o,r){x(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].range)+"")&&G(i,n)},d(o){o&&k(e)}}}function S5(t){let e,n=t[6][t[0].targetMode]+"",i;return{c(){e=h("span"),i=T(n)},m(s,o){x(s,e,o),d(e,i)},p(s,o){o[0]&1&&n!==(n=s[6][s[0].targetMode]+"")&&G(i,n)},d(s){s&&k(e)}}}function A5(t){let e,n,i,s=t[4].stacks+"",o,r,a,l;return{c(){e=h("div"),n=h("u"),i=T("At "),o=T(s),r=T(" stacks"),a=T(":"),l=h("span"),l.textContent="(Press shift to toggle)",m(e,"class","pad textsecondary svelte-14w0l4b"),m(l,"class","textgrey")},m(c,f){x(c,e,f),d(e,n),d(n,i),d(n,o),d(n,r),d(e,a),x(c,l,f)},p(c,f){f[0]&16&&s!==(s=c[4].stacks+"")&&G(o,s)},d(c){c&&(k(e),k(l))}}}function P5(t){let e,n=t[7](t[0].dmg)+"",i,s;return{c(){e=h("div"),i=T(n),s=T(" DMG"),m(e,"class","textgreen")},m(o,r){x(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].dmg)+"")&&G(i,n)},d(o){o&&k(e)}}}function T5(t){let e,n=t[7](t[0].heal)+"",i,s;return{c(){e=h("div"),i=T(n),s=T(" Heal"),m(e,"class","textgreen")},m(o,r){x(o,e,r),d(e,i),d(e,s)},p(o,r){r[0]&1&&n!==(n=o[7](o[0].heal)+"")&&G(i,n)},d(o){o&&k(e)}}}function E5(t){let e,n,i=S.items.book[t[26]].name+"",s,o,r=Math.round(100*t[7](t[33][t[26]](t[0]))-100)+"",a,l;return{c(){e=h("div"),n=T("Empower "),s=T(i),o=T(" by "),a=T(r),l=T("%"),m(e,"class","textcyan")},m(c,f){x(c,e,f),d(e,n),d(e,s),d(e,o),d(e,a),d(e,l)},p(c,f){f[0]&1&&i!==(i=S.items.book[c[26]].name+"")&&G(s,i),f[0]&1&&r!==(r=Math.round(100*c[7](c[33][c[26]](c[0]))-100)+"")&&G(a,r)},d(c){c&&k(e)}}}function D5(t){let e,n=pe(Object.keys(t[33]||{})),i=[];for(let s=0;s<n.length;s+=1)i[s]=E5(g5(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ge()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);x(s,e,o)},p(s,o){if(o[0]&129){n=pe(Object.keys(s[33]||{}));let r;for(r=0;r<n.length;r+=1){let a=g5(s,n,r);i[r]?i[r].p(a,o):(i[r]=E5(a),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&k(e),it(i,s)}}}function I5(t){let e,n,i=S.items.book[t[26]].name+"",s,o,r=t[7](t[23][t[26]](t[0]))+"",a;return{c(){e=h("div"),n=T("Empower "),s=T(i),o=T(" by "),a=T(r),m(e,"class","textcyan")},m(l,c){x(l,e,c),d(e,n),d(e,s),d(e,o),d(e,a)},p(l,c){c[0]&1&&i!==(i=S.items.book[l[26]].name+"")&&G(s,i),c[0]&1&&r!==(r=l[7](l[23][l[26]](l[0]))+"")&&G(a,r)},d(l){l&&k(e)}}}function V5(t){let e,n=pe(Object.keys(t[23]||{})),i=[];for(let s=0;s<n.length;s+=1)i[s]=I5(d5(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ge()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);x(s,e,o)},p(s,o){if(o[0]&129){n=pe(Object.keys(s[23]||{}));let r;for(r=0;r<n.length;r+=1){let a=d5(s,n,r);i[r]?i[r].p(a,o):(i[r]=I5(a),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&k(e),it(i,s)}}}function L5(t){let e,n,i=S.items.book[t[26]].name+"",s,o,r=ii(14,t[7](t[23][t[26]](t[0])))+"",a;return{c(){e=h("div"),n=T("Empower Crit% of "),s=T(i),o=T(" by "),a=T(r),m(e,"class","textcyan")},m(l,c){x(l,e,c),d(e,n),d(e,s),d(e,o),d(e,a)},p(l,c){c[0]&1&&i!==(i=S.items.book[l[26]].name+"")&&G(s,i),c[0]&1&&r!==(r=ii(14,l[7](l[23][l[26]](l[0])))+"")&&G(a,r)},d(l){l&&k(e)}}}function q5(t){let e,n=pe(Object.keys(t[23]||{})),i=[];for(let s=0;s<n.length;s+=1)i[s]=L5(p5(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ge()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);x(s,e,o)},p(s,o){if(o[0]&129){n=pe(Object.keys(s[23]||{}));let r;for(r=0;r<n.length;r+=1){let a=p5(s,n,r);i[r]?i[r].p(a,o):(i[r]=L5(a),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&k(e),it(i,s)}}}function R5(t){let e,n=pe(Array.from(t[3].stat)),i=[];for(let s=0;s<n.length;s+=1)i[s]=B5(f5(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ge()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);x(s,e,o)},p(s,o){if(o[0]&8){n=pe(Array.from(s[3].stat));let r;for(r=0;r<n.length;r+=1){let a=f5(s,n,r);i[r]?i[r].p(a,o):(i[r]=B5(a),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&k(e),it(i,s)}}}function B5(t){let e,n,i=ii(t[18][0],t[18][1])+"",s,o,r=S.ui.stats.array[t[18][0]]+"",a,l;return{c(){e=h("div"),n=T("+"),s=T(i),o=Ue(),a=T(r),l=Ue(),m(e,"class","textcyan")},m(c,f){x(c,e,f),d(e,n),d(e,s),d(e,o),d(e,a),d(e,l)},p(c,f){f[0]&8&&i!==(i=ii(c[18][0],c[18][1])+"")&&G(s,i),f[0]&8&&r!==(r=S.ui.stats.array[c[18][0]]+"")&&G(a,r)},d(c){c&&k(e)}}}function z5(t){let e,n=pe(t[0].statsConvert),i=[];for(let s=0;s<n.length;s+=1)i[s]=$5(c5(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ge()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);x(s,e,o)},p(s,o){if(o[0]&1){n=pe(s[0].statsConvert);let r;for(r=0;r<n.length;r+=1){let a=c5(s,n,r);i[r]?i[r].p(a,o):(i[r]=$5(a),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&k(e),it(i,s)}}}function $5(t){let e,n=S.ui.skilldescription.statincrement[0]+"",i,s,o=S.ui.stats.array[t[18][0]]+"",r,a,l=S.ui.skilldescription.statincrement[1]+"",c,f,u=ii(t[18][0],t[18][1])+"",p,g,v=S.ui.stats.array[t[18][2]]+"",_,b,y=S.ui.skilldescription.statincrement[2]+"",w;return{c(){e=h("div"),i=T(n),s=Ue(),r=T(o),a=Ue(),c=T(l),f=Ue(),p=T(u),g=Ue(),_=T(v),b=Ue(),w=T(y),m(e,"class","textcyan")},m(C,A){x(C,e,A),d(e,i),d(e,s),d(e,r),d(e,a),d(e,c),d(e,f),d(e,p),d(e,g),d(e,_),d(e,b),d(e,w)},p(C,A){A[0]&1&&o!==(o=S.ui.stats.array[C[18][0]]+"")&&G(r,o),A[0]&1&&u!==(u=ii(C[18][0],C[18][1])+"")&&G(p,u),A[0]&1&&v!==(v=S.ui.stats.array[C[18][2]]+"")&&G(_,v)},d(C){C&&k(e)}}}function U5(t){let e,n=pe(t[0].custom),i=[];for(let s=0;s<n.length;s+=1)i[s]=O5(l5(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ge()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);x(s,e,o)},p(s,o){if(o[0]&131){n=pe(s[0].custom);let r;for(r=0;r<n.length;r+=1){let a=l5(s,n,r);i[r]?i[r].p(a,o):(i[r]=O5(a),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&k(e),it(i,s)}}}function O5(t){let e,n=t[7](t[15][0](t[1]))+"",i,s=t[15][1]+"",o;return{c(){e=h("div"),i=T(n),o=T(s),m(e,"class","textcyan")},m(r,a){x(r,e,a),d(e,i),d(e,o)},p(r,a){a[0]&3&&n!==(n=r[7](r[15][0](r[1]))+"")&&G(i,n),a[0]&1&&s!==(s=r[15][1]+"")&&G(o,s)},d(r){r&&k(e)}}}function N5(t){let e,n=t[0].aoe.limit?"Up to "+t[0].aoe.limit:"All",i,s,o=t[0].aoe.faction?"allies":"enemies",r,a,l=t[7](t[0].aoe.circleRadius)+"",c,f;return{c(){e=h("div"),i=T(n),s=Ue(),r=T(o),a=T(" within "),c=T(l),f=T("m"),m(e,"class","textpvp")},m(u,p){x(u,e,p),d(e,i),d(e,s),d(e,r),d(e,a),d(e,c),d(e,f)},p(u,p){p[0]&1&&n!==(n=u[0].aoe.limit?"Up to "+u[0].aoe.limit:"All")&&G(i,n),p[0]&1&&o!==(o=u[0].aoe.faction?"allies":"enemies")&&G(r,o),p[0]&1&&l!==(l=u[7](u[0].aoe.circleRadius)+"")&&G(c,l)},d(u){u&&k(e)}}}function j5(t){let e,n,i,s=S.items.book[t[0].id].description+"",o;return{c(){e=h("div"),n=h("u"),n.textContent="Effect",i=T(": "),o=T(s),m(e,"class","textsecondary pad svelte-14w0l4b")},m(r,a){x(r,e,a),d(e,n),d(e,i),d(e,o)},p(r,a){a[0]&1&&s!==(s=S.items.book[r[0].id].description+"")&&G(o,s)},d(r){r&&k(e)}}}function W5(t){let e,n,i;return n=new sd({props:{level:t[1],skill:t[12]}}),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","pad svelte-14w0l4b")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o[0]&2&&(r.level=s[1]),o[0]&32&&(r.skill=s[12]),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function sD(t){let e,n,i,s,o=[iD,nD],r=[];function a(l,c){return l[0].item?0:1}return n=a(t,[-1,-1]),i=r[n]=o[n](t),{c(){e=h("div"),i.c(),m(e,"class","container textsecondary svelte-14w0l4b")},m(l,c){x(l,e,c),r[n].m(e,null),s=!0},p(l,c){let f=n;n=a(l,c),n===f?r[n].p(l,c):(Te(),I(r[f],1,1,()=>{r[f]=null}),Ee(),i=r[n],i?i.p(l,c):(i=r[n]=o[n](l),i.c()),P(i,1),i.m(e,null))},i(l){s||(P(i),s=!0)},o(l){I(i),s=!1},d(l){l&&k(e),r[n].d()}}}function oD(t,e,n){let{skill:i}=e,{level:s}=e,{asItemDescription:o=!1}=e,{shift:r=!1}=e,a={1:"Requires no target",16:"Self cast",256:"on Allies",4096:"on Enemy"},l=(_,b=D&&D.player)=>{if(!b)return"?";let y=Uw(_,b);return y%1===0?y:y.toFixed(1)},c={0:"Melee attack",1:"Magic attack",2:"Heal",4:"Buff",5:"Stackable buff",6:"Ranged missile",7:"Ranged effect",9:"Effect"},f=[],u,p={},g=_=>{if(D)return _.onCast&&v("on cast",_.onCast,D.player,s),_.onBlock&&v("on block",_.onBlock,p,D.player),_.onInterval&&v(`every ${_.intervalDuration.toFixed(1)}s`,_.onInterval,p,D.player,D.player),_.onPermanent&&v("permanently",()=>({id:_.onPermanent(D.player),mode:4}),D.player,s),_},v=(_,b,y,w,C)=>{let A=b(y,w,C);if(!A||A===!0)return;let M=Object.assign({},A);if(M.actiontype=_,M.parent||(M.parent=[]),M.parent.push(i),M.mode===4||M.mode===5){let F=ha.get(M.id);f.unshift(g({...M,...F}))}else if(i.id===M.id)i.parent||(M.parent=void 0),n(0,i={...i,...M});else{if(i.parent){let F=i.parent.find(V=>V.id==M.id);if(F){F.parent||(M.parent=void 0),Object.assign(F,M);return}}f.unshift(g(M))}};return t.$$set=_=>{"skill"in _&&n(0,i=_.skill),"level"in _&&n(1,s=_.level),"asItemDescription"in _&&n(2,o=_.asItemDescription),"shift"in _&&n(9,r=_.shift)},t.$$.update=()=>{t.$$.dirty[0]&539&&(n(4,p={stacks:1,level:s}),n(4,p.stacks=i.maxStacks?r?1:i.maxStacks:1,p),n(0,i.stacks=p.stacks,i),n(5,f=[]),i.parent||g(i),i.statsStatic&&(n(3,u=new Ql),i.statsStatic(p,u)))},[i,s,o,u,p,f,a,l,c,r]}var sd=class extends we{constructor(e){super(),Ce(this,e,oD,sD,$e,{skill:0,level:1,asItemDescription:2,shift:9},null,[-1,-1])}},ga=sd;function rD(t){let e;return{c(){e=h("span")},m(n,i){x(n,e,i),e.innerHTML=t[0]},p(n,[i]){i&1&&(e.innerHTML=n[0])},i:ce,o:ce,d(n){n&&k(e)}}}function aD(t,e,n){let i,s,o;se(t,Hi,l=>n(4,o=l));let{amount:r}=e,{isPrice:a=!1}=e;return t.$$set=l=>{"amount"in l&&n(1,r=l.amount),"isPrice"in l&&n(2,a=l.isPrice)},t.$$.update=()=>{t.$$.dirty&22&&n(3,i=a&&r>o),t.$$.dirty&10&&n(0,s=E1(r,i))},[s,r,a,i,o]}var lg=class extends we{constructor(e){super(),Ce(this,e,aD,rD,Fn,{amount:1,isPrice:2})}},yn=lg;function lD(t){let e;return{c(){e=h("span")},m(n,i){x(n,e,i),e.innerHTML=t[0]},p(n,[i]){i&1&&(e.innerHTML=n[0])},i:ce,o:ce,d(n){n&&k(e)}}}function cD(t,e,n){let i,s,o;se(t,il,l=>n(4,o=l));let{amount:r}=e,{isPrice:a=!1}=e;return t.$$set=l=>{"amount"in l&&n(1,r=l.amount),"isPrice"in l&&n(2,a=l.isPrice)},t.$$.update=()=>{t.$$.dirty&22&&n(3,i=a&&r>o),t.$$.dirty&10&&n(0,s=D1(r,i))},[s,r,a,i,o]}var cg=class extends we{constructor(e){super(),Ce(this,e,cD,lD,Fn,{amount:1,isPrice:2})}},or=cg;function fD(t){let e,n,i,s,o,r;return{c(){e=h("span"),n=h("img"),s=h("span"),o=T(t[0]),m(n,"class","svgicon texticon"),at(n.src,i="/data/ui/icons/gem.svg?v=8582889")||m(n,"src",i),m(s,"class",r=!t[1]||t[0]<t[2]?"textprimary":"textred")},m(a,l){x(a,e,l),d(e,n),d(e,s),d(s,o)},p(a,[l]){l&1&&G(o,a[0]),l&7&&r!==(r=!a[1]||a[0]<a[2]?"textprimary":"textred")&&m(s,"class",r)},i:ce,o:ce,d(a){a&&k(e)}}}function uD(t,e,n){let i;se(t,qo,r=>n(2,i=r));let{amount:s}=e,{isPrice:o=!1}=e;return t.$$set=r=>{"amount"in r&&n(0,s=r.amount),"isPrice"in r&&n(1,o=r.isPrice)},[s,o,i]}var fg=class extends we{constructor(e){super(),Ce(this,e,uD,fD,Fn,{amount:0,isPrice:1})}},rr=fg;function G5(t,e,n){let i=t.slice();return i[8]=e[n],i}function H5(t,e,n){let i=t.slice();return i[11]=e[n],i}function Y5(t,e,n){let i=t.slice();return i[11]=e[n],i}function X5(t,e,n){let i=t.slice();return i[16]=e[n],i}function Q5(t,e,n){let i=t.slice();return i[8]=e[n],i}function Z5(t){let e,n,i=t[0].gs+"",s,o;return{c(){e=h("span"),n=T("GS: "),s=T(i),o=Ue(),m(e,"class","textgreen")},m(r,a){x(r,e,a),d(e,n),d(e,s),x(r,o,a)},p(r,a){a&1&&i!==(i=r[0].gs+"")&&G(s,i)},d(r){r&&(k(e),k(o))}}}function J5(t){let e,n,i=t[0].dbid+"",s;return{c(){e=h("span"),n=T("ID: "),s=T(i),m(e,"class","textgrey")},m(o,r){x(o,e,r),d(e,n),d(e,s)},p(o,r){r&1&&i!==(i=o[0].dbid+"")&&G(s,i)},d(o){o&&k(e)}}}function pD(t){let e,n=t[8][1].type=="bonus"?"+ ":"",i,s=ii(t[8][0],t[8][1].value)+"",o,r,a=S.ui.stats.array[t[8][0]]+"",l,c,f,u=t[8][1].type=="bonus"&&t[2]&&K5(t);return{c(){e=h("div"),i=T(n),o=T(s),r=Ue(),l=T(a),c=Ue(),u&&u.c(),m(e,"class",f="text"+Yt(t[8][1].qual)[0]+" svelte-e3ao5j")},m(p,g){x(p,e,g),d(e,i),d(e,o),d(e,r),d(e,l),d(e,c),u&&u.m(e,null)},p(p,g){p[8][1].type=="bonus"&&p[2]?u?u.p(p,g):(u=K5(p),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},d(p){p&&k(e),u&&u.d()}}}function mD(t){let e,n,i=t[0].stats.get(10).value+"",s,o,r,a,l=t[0].stats.get(11).value+"",c,f,u,p,g=S.ui.stats.misc.damage+"",v,_;return{c(){e=h("div"),n=h("span"),s=T(i),r=T(" - "),a=h("span"),c=T(l),u=Ue(),p=h("span"),v=T(g),m(n,"class",o="text"+Yt(t[0].stats.get(10).qual)[0]+" svelte-e3ao5j"),m(a,"class",f="text"+Yt(t[0].stats.get(11).qual)[0]+" svelte-e3ao5j"),m(p,"class",_="text"+Yt(Math.min(t[0].stats.get(10).qual,t[0].stats.get(11).qual))[0]+" svelte-e3ao5j")},m(b,y){x(b,e,y),d(e,n),d(n,s),d(e,r),d(e,a),d(a,c),d(e,u),d(e,p),d(p,v)},p(b,y){y&1&&i!==(i=b[0].stats.get(10).value+"")&&G(s,i),y&1&&o!==(o="text"+Yt(b[0].stats.get(10).qual)[0]+" svelte-e3ao5j")&&m(n,"class",o),y&1&&l!==(l=b[0].stats.get(11).value+"")&&G(c,l),y&1&&f!==(f="text"+Yt(b[0].stats.get(11).qual)[0]+" svelte-e3ao5j")&&m(a,"class",f),y&1&&_!==(_="text"+Yt(Math.min(b[0].stats.get(10).qual,b[0].stats.get(11).qual))[0]+" svelte-e3ao5j")&&m(p,"class",_)},d(b){b&&k(e)}}}function K5(t){let e;return{c(){e=h("span"),e.textContent=`${Math.round(t[8][1].qual)}%`},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function eM(t){let e,n;function i(r,a){return a&1&&(e=null),e==null&&(e=!!(r[8][0]==10&&r[0].stats.has(11))),e?mD:pD}let s=i(t,-1),o=s(t);return{c(){o.c(),n=ge()},m(r,a){o.m(r,a),x(r,n,a)},p(r,a){s===(s=i(r,a))&&o?o.p(r,a):(o.d(1),o=s(r),o&&(o.c(),o.m(n.parentNode,n)))},d(r){r&&k(n),o.d(r)}}}function tM(t){let e,n=pe(t[0].logic.custom),i=[];for(let s=0;s<n.length;s+=1)i[s]=nM(X5(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ge()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);x(s,e,o)},p(s,o){if(o&1){n=pe(s[0].logic.custom);let r;for(r=0;r<n.length;r+=1){let a=X5(s,n,r);i[r]?i[r].p(a,o):(i[r]=nM(a),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&k(e),it(i,s)}}}function nM(t){let e,n=t[16]+"",i;return{c(){e=h("span"),i=T(n),m(e,"class","textgreen")},m(s,o){x(s,e,o),d(e,i)},p(s,o){o&1&&n!==(n=s[16]+"")&&G(i,n)},d(s){s&&k(e)}}}function iM(t){let e,n=t[11][0]+"",i,s;return{c(){e=h("div"),i=T(n),m(e,"class",s=t[11][1]?"textgreen":"textred")},m(o,r){x(o,e,r),d(e,i)},p(o,r){r&1&&n!==(n=o[11][0]+"")&&G(i,n),r&1&&s!==(s=o[11][1]?"textgreen":"textred")&&m(e,"class",s)},d(o){o&&k(e)}}}function dD(t){let e,n,i,s=t[0].logic.bindOnPurchase&&sM(t),o=t[0].logic.bindOnUse&&oM(t),r=t[0].logic.bindOnMerchant&&rM(t);return{c(){s&&s.c(),e=ge(),o&&o.c(),n=ge(),r&&r.c(),i=ge()},m(a,l){s&&s.m(a,l),x(a,e,l),o&&o.m(a,l),x(a,n,l),r&&r.m(a,l),x(a,i,l)},p(a,l){a[0].logic.bindOnPurchase?s?s.p(a,l):(s=sM(a),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null),a[0].logic.bindOnUse?o?o.p(a,l):(o=oM(a),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null),a[0].logic.bindOnMerchant?r?r.p(a,l):(r=rM(a),r.c(),r.m(i.parentNode,i)):r&&(r.d(1),r=null)},d(a){a&&(k(e),k(n),k(i)),s&&s.d(a),o&&o.d(a),r&&r.d(a)}}}function hD(t){let e,n=S.ui.inventory.bindlevel[t[0].bound]+"",i;return{c(){e=h("div"),i=T(n),m(e,"class","textgreen")},m(s,o){x(s,e,o),d(e,i)},p(s,o){o&1&&n!==(n=S.ui.inventory.bindlevel[s[0].bound]+"")&&G(i,n)},d(s){s&&k(e)}}}function sM(t){let e,n=S.ui.inventory.bindlevel[t[0].logic.bindOnPurchase]+"",i,s,o=S.ui.itemdescription.onpurchase+"",r;return{c(){e=h("div"),i=T(n),s=Ue(),r=T(o),m(e,"class","textcyan")},m(a,l){x(a,e,l),d(e,i),d(e,s),d(e,r)},p(a,l){l&1&&n!==(n=S.ui.inventory.bindlevel[a[0].logic.bindOnPurchase]+"")&&G(i,n)},d(a){a&&k(e)}}}function oM(t){let e,n=S.ui.inventory.bindlevel[t[0].logic.bindOnUse]+"",i,s,o=S.ui.itemdescription.onuse+"",r;return{c(){e=h("div"),i=T(n),s=Ue(),r=T(o),m(e,"class","textcyan")},m(a,l){x(a,e,l),d(e,i),d(e,s),d(e,r)},p(a,l){l&1&&n!==(n=S.ui.inventory.bindlevel[a[0].logic.bindOnUse]+"")&&G(i,n)},d(a){a&&k(e)}}}function rM(t){let e,n=S.ui.inventory.bindlevel[t[0].logic.bindOnMerchant]+"",i,s,o=S.ui.itemdescription.onsale+"",r;return{c(){e=h("div"),i=T(n),s=Ue(),r=T(o),m(e,"class","textcyan")},m(a,l){x(a,e,l),d(e,i),d(e,s),d(e,r)},p(a,l){l&1&&n!==(n=S.ui.inventory.bindlevel[a[0].logic.bindOnMerchant]+"")&&G(i,n)},d(a){a&&k(e)}}}function aM(t){let e,n,i=t[0].medalValue()>0&&t[1],s,o=t[0].storeValue()>0&&t[1],r,a=!(t[0].storeValue()>0&&t[1])&&t[0].canBeSold(),l,c=t[1]&&lM(t),f=i&&fM(t),u=o&&uM(t),p=a&&pM(t);return{c(){e=h("div"),c&&c.c(),n=ge(),f&&f.c(),s=ge(),u&&u.c(),r=ge(),p&&p.c(),m(e,"class","panel value pack svelte-e3ao5j")},m(g,v){x(g,e,v),c&&c.m(e,null),d(e,n),f&&f.m(e,null),d(e,s),u&&u.m(e,null),d(e,r),p&&p.m(e,null),l=!0},p(g,v){g[1]?c?c.p(g,v):(c=lM(g),c.c(),c.m(e,n)):c&&(c.d(1),c=null),v&3&&(i=g[0].medalValue()>0&&g[1]),i?f?(f.p(g,v),v&3&&P(f,1)):(f=fM(g),f.c(),P(f,1),f.m(e,s)):f&&(Te(),I(f,1,1,()=>{f=null}),Ee()),v&3&&(o=g[0].storeValue()>0&&g[1]),o?u?(u.p(g,v),v&3&&P(u,1)):(u=uM(g),u.c(),P(u,1),u.m(e,r)):u&&(Te(),I(u,1,1,()=>{u=null}),Ee()),v&3&&(a=!(g[0].storeValue()>0&&g[1])&&g[0].canBeSold()),a?p?(p.p(g,v),v&3&&P(p,1)):(p=pM(g),p.c(),P(p,1),p.m(e,null)):p&&(Te(),I(p,1,1,()=>{p=null}),Ee())},i(g){l||(P(f),P(u),P(p),l=!0)},o(g){I(f),I(u),I(p),l=!1},d(g){g&&k(e),c&&c.d(),f&&f.d(),u&&u.d(),p&&p.d()}}}function lM(t){let e,n=pe(t[0].buyReasons(D&&D.player)),i=[];for(let s=0;s<n.length;s+=1)i[s]=cM(H5(t,n,s));return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ge()},m(s,o){for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,o);x(s,e,o)},p(s,o){if(o&1){n=pe(s[0].buyReasons(D&&D.player));let r;for(r=0;r<n.length;r+=1){let a=H5(s,n,r);i[r]?i[r].p(a,o):(i[r]=cM(a),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&k(e),it(i,s)}}}function cM(t){let e,n=t[11][0]+"",i;return{c(){e=h("div"),m(e,"class",i=t[11][1]?"textgreen":"textred")},m(s,o){x(s,e,o),e.innerHTML=n},p(s,o){o&1&&n!==(n=s[11][0]+"")&&(e.innerHTML=n),o&1&&i!==(i=s[11][1]?"textgreen":"textred")&&m(e,"class",i)},d(s){s&&k(e)}}}function fM(t){let e,n,i;return n=new or({props:{amount:t[0].medalValue(),isPrice:!0}}),{c(){e=h("div"),te(n.$$.fragment)},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&1&&(r.amount=s[0].medalValue()),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function uM(t){let e,n,i;return n=new rr({props:{amount:t[0].storeValue(),isPrice:!0}}),{c(){e=h("div"),te(n.$$.fragment)},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&1&&(r.amount=s[0].storeValue()),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function pM(t){let e,n,i;return n=new yn({props:{amount:t[0].goldValue(t[1]),isPrice:t[1]}}),{c(){e=h("div"),te(n.$$.fragment)},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&3&&(r.amount=s[0].goldValue(s[1])),o&2&&(r.isPrice=s[1]),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function gD(t){let e,n,i,s,o=[bD,_D],r=[];function a(l,c){return l[0].type=="book"?0:1}return e=a(t,-1),n=r[e]=o[e](t),{c(){n.c(),i=ge()},m(l,c){r[e].m(l,c),x(l,i,c),s=!0},p(l,c){let f=e;e=a(l,c),e===f?r[e].p(l,c):(Te(),I(r[f],1,1,()=>{r[f]=null}),Ee(),n=r[e],n?n.p(l,c):(n=r[e]=o[e](l),n.c()),P(n,1),n.m(i.parentNode,i))},i(l){s||(P(n),s=!0)},o(l){I(n),s=!1},d(l){l&&k(i),r[e].d(l)}}}function vD(t){let e,n,i=pe(t[4]),s=[];for(let o=0;o<i.length;o+=1)s[o]=mM(G5(t,i,o));return{c(){e=h("div"),n=h("div"),n.textContent=`${S.ui.itemdescription.equipeffect}:`;for(let o=0;o<s.length;o+=1)s[o].c();m(n,"class","textgrey"),m(e,"class","pack svelte-e3ao5j")},m(o,r){x(o,e,r),d(e,n);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null)},p(o,r){if(r&16){i=pe(o[4]);let a;for(a=0;a<i.length;a+=1){let l=G5(o,i,a);s[a]?s[a].p(l,r):(s[a]=mM(l),s[a].c(),s[a].m(e,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=i.length}},i:ce,o:ce,d(o){o&&k(e),it(s,o)}}}function _D(t){let e,n=Dh(t[0].type,t[0].tier)+"",i;return{c(){e=h("div"),i=T(n),m(e,"class","pack description svelte-e3ao5j")},m(s,o){x(s,e,o),d(e,i)},p(s,o){o&1&&n!==(n=Dh(s[0].type,s[0].tier)+"")&&G(i,n)},i:ce,o:ce,d(s){s&&k(e)}}}function bD(t){let e,n;return e=new ga({props:{shift:t[2],level:t[0].logic.skilllevel+1,skill:Pt.get(t[0].logic.skillid),asItemDescription:!0}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&4&&(o.shift=i[2]),s&1&&(o.level=i[0].logic.skilllevel+1),s&1&&(o.skill=Pt.get(i[0].logic.skillid)),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function mM(t){let e,n=t[8][1]>0?"+":"",i,s=ii(t[8][0],t[8][1])+"",o,r,a=S.ui.stats.array[t[8][0]]+"",l,c;return{c(){e=h("div"),i=T(n),o=T(s),r=Ue(),l=T(a),m(e,"class",c="text"+(t[8][1]>0?"green":"red"))},m(f,u){x(f,e,u),d(e,i),d(e,o),d(e,r),d(e,l)},p(f,u){u&16&&n!==(n=f[8][1]>0?"+":"")&&G(i,n),u&16&&s!==(s=ii(f[8][0],f[8][1])+"")&&G(o,s),u&16&&a!==(a=S.ui.stats.array[f[8][0]]+"")&&G(l,a),u&16&&c!==(c="text"+(f[8][1]>0?"green":"red"))&&m(e,"class",c)},d(f){f&&k(e)}}}function dM(t){let e,n,i,s;return n=new od({props:{item:t[3],comparison:!0}}),{c(){e=h("div"),te(n.$$.fragment),m(e,"class",i="slotdescription border "+Yt(t[3].quality)[0]+" comparecontainer svelte-e3ao5j")},m(o,r){x(o,e,r),K(n,e,null),s=!0},p(o,r){let a={};r&8&&(a.item=o[3]),n.$set(a),(!s||r&8&&i!==(i="slotdescription border "+Yt(o[3].quality)[0]+" comparecontainer svelte-e3ao5j"))&&m(e,"class",i)},i(o){s||(P(n.$$.fragment,o),s=!0)},o(o){I(n.$$.fragment,o),s=!1},d(o){o&&k(e),ee(n)}}}function yD(t){let e,n,i,s=t[2]?"T"+(t[0].tier+1)+" ":"",o,r=gn(t[0].type,t[0].tier)+"",a,l,c=t[0].upgrade?" +"+t[0].upgrade:"",f,u,p,g=(t[0].stacks?"":Yt(t[0].quality)[1])+"",v,_,b=t[0].type+"",y,w,C,A=t[0].quality&&!t[0].stacks?t[0].quality+"%":"",M,F,V,L,q,R,z,E,W=t[1]||t[0].canBeSold(),j,N,U,ie,re,ae=t[0].gs>0&&Z5(t),ue=t[0].dbid&&J5(t),Me=pe(t[5]),me=[];for(let le=0;le<Me.length;le+=1)me[le]=eM(Q5(t,Me,le));let Ne=t[0].logic.custom!==void 0&&tM(t),De=pe(t[0].equipReasons(D&&D.player)),Fe=[];for(let le=0;le<De.length;le+=1)Fe[le]=iM(Y5(t,De,le));function _e(le,ze){return le[0].bound>0?hD:dD}let H=_e(t,-1),qe=H(t),Oe=W&&aM(t),He=[vD,gD],Ye=[];function Ze(le,ze){return le[3]?0:1}N=Ze(t,-1),U=Ye[N]=He[N](t);let ve=t[3]&&dM(t);return{c(){e=h("div"),n=h("div"),i=h("div"),o=T(s),a=T(r),l=h("span"),f=T(c),p=h("div"),v=T(g),_=Ue(),y=T(b),w=Ue(),C=h("span"),M=T(A),F=h("small"),ae&&ae.c(),V=ge(),ue&&ue.c(),L=Ue(),q=h("div");for(let le=0;le<me.length;le+=1)me[le].c();R=ge(),Ne&&Ne.c(),z=h("div");for(let le=0;le<Fe.length;le+=1)Fe[le].c();E=ge(),qe.c(),Oe&&Oe.c(),j=ge(),U.c(),ve&&ve.c(),ie=ge(),m(l,"class","textprimary"),m(i,"class",u="slottitle text"+Yt(t[0].quality)[0]+" svelte-e3ao5j"),m(p,"class","type textwhite svelte-e3ao5j"),m(n,"class","pack svelte-e3ao5j"),m(q,"class","pack svelte-e3ao5j"),m(z,"class","pack svelte-e3ao5j"),m(e,"class","container svelte-e3ao5j")},m(le,ze){x(le,e,ze),d(e,n),d(n,i),d(i,o),d(i,a),d(i,l),d(l,f),d(n,p),d(p,v),d(p,_),d(p,y),d(p,w),d(p,C),d(C,M),d(n,F),ae&&ae.m(F,null),d(F,V),ue&&ue.m(F,null),d(n,L),d(e,q);for(let Z=0;Z<me.length;Z+=1)me[Z]&&me[Z].m(q,null);d(q,R),Ne&&Ne.m(q,null),d(e,z);for(let Z=0;Z<Fe.length;Z+=1)Fe[Z]&&Fe[Z].m(z,null);d(z,E),qe.m(z,null),Oe&&Oe.m(e,null),d(e,j),Ye[N].m(e,null),ve&&ve.m(le,ze),x(le,ie,ze),re=!0},p(le,[ze]){if((!re||ze&5)&&s!==(s=le[2]?"T"+(le[0].tier+1)+" ":"")&&G(o,s),(!re||ze&1)&&r!==(r=gn(le[0].type,le[0].tier)+"")&&G(a,r),(!re||ze&1)&&c!==(c=le[0].upgrade?" +"+le[0].upgrade:"")&&G(f,c),(!re||ze&1&&u!==(u="slottitle text"+Yt(le[0].quality)[0]+" svelte-e3ao5j"))&&m(i,"class",u),(!re||ze&1)&&g!==(g=(le[0].stacks?"":Yt(le[0].quality)[1])+"")&&G(v,g),(!re||ze&1)&&b!==(b=le[0].type+"")&&G(y,b),(!re||ze&1)&&A!==(A=le[0].quality&&!le[0].stacks?le[0].quality+"%":"")&&G(M,A),le[0].gs>0?ae?ae.p(le,ze):(ae=Z5(le),ae.c(),ae.m(F,V)):ae&&(ae.d(1),ae=null),le[0].dbid?ue?ue.p(le,ze):(ue=J5(le),ue.c(),ue.m(F,null)):ue&&(ue.d(1),ue=null),ze&37){Me=pe(le[5]);let X;for(X=0;X<Me.length;X+=1){let $=Q5(le,Me,X);me[X]?me[X].p($,ze):(me[X]=eM($),me[X].c(),me[X].m(q,R))}for(;X<me.length;X+=1)me[X].d(1);me.length=Me.length}if(le[0].logic.custom!==void 0?Ne?Ne.p(le,ze):(Ne=tM(le),Ne.c(),Ne.m(q,null)):Ne&&(Ne.d(1),Ne=null),ze&1){De=pe(le[0].equipReasons(D&&D.player));let X;for(X=0;X<De.length;X+=1){let $=Y5(le,De,X);Fe[X]?Fe[X].p($,ze):(Fe[X]=iM($),Fe[X].c(),Fe[X].m(z,E))}for(;X<Fe.length;X+=1)Fe[X].d(1);Fe.length=De.length}H===(H=_e(le,ze))&&qe?qe.p(le,ze):(qe.d(1),qe=H(le),qe&&(qe.c(),qe.m(z,null))),ze&3&&(W=le[1]||le[0].canBeSold()),W?Oe?(Oe.p(le,ze),ze&3&&P(Oe,1)):(Oe=aM(le),Oe.c(),P(Oe,1),Oe.m(e,j)):Oe&&(Te(),I(Oe,1,1,()=>{Oe=null}),Ee());let Z=N;N=Ze(le,ze),N===Z?Ye[N].p(le,ze):(Te(),I(Ye[Z],1,1,()=>{Ye[Z]=null}),Ee(),U=Ye[N],U?U.p(le,ze):(U=Ye[N]=He[N](le),U.c()),P(U,1),U.m(e,null)),le[3]?ve?(ve.p(le,ze),ze&8&&P(ve,1)):(ve=dM(le),ve.c(),P(ve,1),ve.m(ie.parentNode,ie)):ve&&(Te(),I(ve,1,1,()=>{ve=null}),Ee())},i(le){re||(P(Oe),P(U),P(ve),re=!0)},o(le){I(Oe),I(U),I(ve),re=!1},d(le){le&&(k(e),k(ie)),ae&&ae.d(),ue&&ue.d(),it(me,le),Ne&&Ne.d(),it(Fe,le),qe.d(),Oe&&Oe.d(),Ye[N].d(),ve&&ve.d(le)}}}function kD(t,e,n){let{item:i}=e,{comparison:s=!1}=e,{isTrader:o=!1}=e,{shift:r=!1}=e,a=i.stats.has(10)?Array.from(i.stats).filter(u=>u[0]!==11):Array.from(i.stats),l,c,f=u=>{let p=new Map;return i.stats.forEach((g,v)=>{p.set(v,g.value)}),u.stats.forEach((g,v)=>{let _=(p.get(v)||0)-g.value;_!==0?p.set(v,_):p.delete(v)}),Array.from(p)};return t.$$set=u=>{"item"in u&&n(0,i=u.item),"comparison"in u&&n(6,s=u.comparison),"isTrader"in u&&n(1,o=u.isTrader),"shift"in u&&n(2,r=u.shift)},t.$$.update=()=>{if(t.$$.dirty&69)if(D&&r&&!s){let u=i.getEquipSlot();if(u!==void 0&&D.player.inventory.slots.has(u)){let p=D.player.inventory.slots.get(u);n(3,l=p.type!==void 0?p:void 0),n(4,c=f(p))}}else n(3,l=void 0),n(4,c=void 0)},[i,o,r,l,c,a,s]}var od=class extends we{constructor(e){super(),Ce(this,e,kD,yD,$e,{item:0,comparison:6,isTrader:1,shift:2})}},rd=od;var gg={};Xn(gg,{addMessage:()=>Nt,init:()=>MD,onWorldDestroy:()=>CD,postTick:()=>FD,wipeChatData:()=>hg});var ug,pg={},Dt=t=>(ug===void 0&&(ug=getComputedStyle(document.body)),pg[t]!==void 0?pg[t]:pg[t]=ug.getPropertyValue("--"+t));var hM=()=>{Ci.font="bold 18px hordes",Ci.fillText("Hordes",0,0)},ar=(t,e,n=1,i=1,s=1,o=1,r=0,a=0,l=.5,c=.5)=>{Ci.globalAlpha=oe.nameplateShowTransparency?n:1;let f=t.width*i,u=t.height*i,p=Math.round(f*s),g=Math.round(u*o);return p===0||g===0||Ci.drawImage(t,0,0,Math.round(t.width*s),Math.round(t.height*o),Math.round(e[0]-f*l+r*i),Math.round(e[1]-u*c+a*i),p,g),p},lr=(t,e,n,i,s,o=0,r=0,a=.5,l=.5)=>ar(eu(e,n),t,i,s,1,1,o,r,a,l),gM=(t,e,n,i,s=0,o=0,r=.5,a=.5)=>ar(e,t,n,i,1,1,s,o,r,a),va=(t,e,n=!1)=>(n?(e[0]=t[0],e[1]=t[1]):Mi(e,t,gt.projectionViewMatrix),n||e[2]<1&&e[0]>-1&&e[0]<1?(e[1]=Math.max(-1,Math.min(e[1],1)),e[0]=Math.round((e[0]*.5+.5)*En.width),e[1]=Math.round((e[1]*-.5+.5)*En.height),e[1]=Math.max(30,e[1]),e):!1),vM=(t,e,n)=>{t.font="bold "+e+"px hordes",t.shadowColor="#000",t.shadowOffsetX=1,t.shadowOffsetY=1,t.fillStyle=n},It={name:{fill:Dt("name"),size:17},enemy:{fill:Dt("enemy"),size:17},pvp:{fill:Dt("pvp"),size:17},nameSmall:{fill:Dt("name"),size:13},enemySmall:{fill:Dt("enemy"),size:13},pvpSmall:{fill:Dt("pvp"),size:13},chatGlobal:{fill:Dt("global"),size:13,wrap:150},chatClan:{fill:Dt("clan"),size:13,wrap:150},chatParty:{fill:Dt("party"),size:13,wrap:150},chatWhisper:{fill:Dt("pvp"),size:13,wrap:150},chatYell:{fill:Dt("yell"),size:13,wrap:150},lev0:{fill:"#919191",size:13},lev1:{fill:Dt("name"),size:13},lev2:{fill:"#EEA303",size:13},lev3:{fill:Dt("enemy"),size:13},clan:{fill:Dt("clan"),size:17},faction0:{fill:Dt("f0"),size:17},faction1:{fill:Dt("f1"),size:17},faction0small:{fill:Dt("f0"),size:13},faction1small:{fill:Dt("f1"),size:13},phys:{fill:Dt("name"),size:18},physCrit:{fill:Dt("name"),size:24},spell:{fill:"#FFE404",size:28},spellCrit:{fill:"#FFE404",size:40},heal:{fill:"#12F027",size:28},mana:{fill:Dt("mana"),size:20},exp:{fill:Dt("exp"),size:20},fame:{fill:Dt("fame"),size:20},gold:{fill:"#EEDDA3",size:16},misc:{fill:"#A6EBFA",size:16},book:{fill:"#749DEF",size:20},rune:{fill:"#DC9A4D",size:20},itemgrey:{fill:"#747474",size:16},common:{fill:"#dddddd",size:20},uncommon:{fill:Dt("green"),size:20},rare:{fill:Dt("blue"),size:20},epic:{fill:Dt("purp"),size:20},legendary:{fill:"#EE960B",size:20},mythical:{fill:"#a72929",size:20},pheal:{fill:"#12F027",size:20},pdmg:{fill:Dt("enemy"),size:20}},mg={},eu=(t,{fill:e,size:n,wrap:i=0})=>{let s=t+e+n;if(mg[s])return mg[s];let o=document.createElement("canvas"),r=o.getContext("2d");return r.font="bold "+n+"px hordes",i>0?xD(o,r,t,0,0,i,n,e):(o.width=Math.max(1,Math.ceil(r.measureText(t).width))+5,o.height=Math.ceil(n*1.2+5),vM(r,n,e),r.fillText(t,0,o.height-6)),mg[s]=o,o},Ti=(t,e,n,i,s,o,r)=>{t||(t=document.createElement("canvas"),t.width=n,t.height=i);let a=t.getContext("2d");return a.fillStyle=e,a.beginPath(),a.moveTo(s+r,o),a.arcTo(s+n,o,s+n,o+i,r),a.arcTo(s+n,o+i,s,o+i,r),a.arcTo(s,o+i,s,o,r),a.arcTo(s,o,s+n,o,r),a.closePath(),a.fill(),t},xD=(t,e,n,i,s,o,r,a)=>{let l=n.split(" "),c=[],f=0,u="";for(let p=0;p<l.length;++p){let g=u+l[p]+" ",v=e.measureText(g);v.width>o?(c.push(u),u=l[p]+" "):(f=Math.max(f,v.width),u=g)}c.push(u),t.width=Math.ceil(f+5),t.height=Math.ceil(c.length*r+10),Ti(t,"#00000099",t.width,t.height,0,0,5),vM(e,r,a);for(let p=0;p<c.length;++p)e.fillText(c[p],i+5,(p+1)*r+3)};var wD=0,_M=new kt(0,10),ad=[],ld=[],MD=()=>{Bn(Ft.serverChat.header,t=>{ad.push(t)}),Bn(Ft.serverSystemMessage.header,t=>{ld.push(t)})},dg=0,FD=(t,e)=>{ad.forEach(n=>{n=Ft.serverChat.decode(n),n.messages.forEach(i=>{if(i.from==""){let s=i.message.split(" ");S&&S.ui.messages[s[0]]&&(i.message=S.ui.messages[s[0]],s.splice(1).forEach((o,r)=>{i.message=i.message.replace("$"+(r+1),o)})),i.channel="notice"}else if(oe.chatbubbles&&dg>5){let s=i.channel=="to"?e.player.name:i.from,o=e.getPlayerByName(s);if(o){let r;switch(i.channel){case"from":case"to":r=It.chatWhisper;break;case"clan":r=It.chatClan;break;case"party":r=It.chatParty;break;case"yell":r=It.chatYell;break;default:case"global":r=It.chatGlobal;break}o.speech(s+": "+i.message,r)}}i.clan==="GM"&&i.channel==="global"&&(i.channel="GM"),Nt(i.channel,i.message,i.channel=="system"||i.channel=="notice",i.from,i.faction,i.class,i.level,i.subscribed,i.id)})}),ld.forEach(n=>{n=Ft.serverSystemMessage.decode(n),n.messages.forEach(i=>{Nt(i.type,i.message,!0)})}),ad.length=0,ld.length=0,dg++},Nt=(t,e,n=!1,i,s,o,r,a,l=0)=>{Vc.update(c=>{c.length>100&&c.shift(),n&&(e=Nf(e)),t==="from"&&(_M.done(D.time)&&Mt(97),_M.reset(D.time));let f=new Date;return c.push({channel:t,time:`${String(f.getHours()).padStart(2,"0")}.${String(f.getMinutes()).padStart(2,"0")}`,text:e,key:++wD,sender:i,sub:a,faction:s,cclass:o,level:r,interpolate:n,id:l}),c})},hg=()=>{Vc.set([]),dg=0},CD=()=>{ad.length=0,ld.length=0};function SD(t){let e,n;return e=new ga({props:{level:t[2]||1,skill:{...Pt.get(t[7].id)}}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&4&&(o.level=i[2]||1),s[0]&128&&(o.skill={...Pt.get(i[7].id)}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function AD(t){let e,n;return e=new rd({props:{item:t[4]}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&16&&(o.item=i[4]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function PD(t){let e,n,i,s,o=[AD,SD],r=[];function a(l,c){return l[4]?0:l[7].id>=0?1:-1}return~(e=a(t,[-1,-1]))&&(n=r[e]=o[e](t)),{c(){n&&n.c(),i=ge()},m(l,c){~e&&r[e].m(l,c),x(l,i,c),s=!0},p(l,c){let f=e;e=a(l,c),e===f?~e&&r[e].p(l,c):(n&&(Te(),I(r[f],1,1,()=>{r[f]=null}),Ee()),~e?(n=r[e],n?n.p(l,c):(n=r[e]=o[e](l),n.c()),P(n,1),n.m(i.parentNode,i)):n=null)},i(l){s||(P(n),s=!0)},o(l){I(n),s=!1},d(l){l&&k(i),~e&&r[e].d(l)}}}function TD(t){let e,n;return e=new da({props:{shift:t[1],describe:t[7].id>=0&&!t[7].item||t[4]!==void 0,descPos:"bottom:100%;left:50%;transform:translateX(-50%);",clickToUse:!0,status:t[11]?-1:t[5]!==void 0?t[5].status:0,id:"sk"+t[7].hotkey,data:t[7].id>=0||t[4]!==void 0?t[7]:void 0,auto:t[9],queued:t[10],meta:t[16],css:t[15],stacks:t[3],cd:t[13],img:t[14],remaining:t[12],key:t[7].hotkey,border:t[10]||t[8]?"auto":t[11]||t[9]||t[6]||t[13]?"grey":t[4]?Yt(t[4].quality)[0]:"white",$$slots:{default:[PD]},$$scope:{ctx:t}}}),e.$on("discard",t[25]),e.$on("move",t[26]),e.$on("use",t[17]),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&2&&(o.shift=i[1]),s[0]&144&&(o.describe=i[7].id>=0&&!i[7].item||i[4]!==void 0),s[0]&2080&&(o.status=i[11]?-1:i[5]!==void 0?i[5].status:0),s[0]&128&&(o.id="sk"+i[7].hotkey),s[0]&144&&(o.data=i[7].id>=0||i[4]!==void 0?i[7]:void 0),s[0]&512&&(o.auto=i[9]),s[0]&1024&&(o.queued=i[10]),s[0]&65536&&(o.meta=i[16]),s[0]&32768&&(o.css=i[15]),s[0]&8&&(o.stacks=i[3]),s[0]&8192&&(o.cd=i[13]),s[0]&16384&&(o.img=i[14]),s[0]&4096&&(o.remaining=i[12]),s[0]&128&&(o.key=i[7].hotkey),s[0]&12112&&(o.border=i[10]||i[8]?"auto":i[11]||i[9]||i[6]||i[13]?"grey":i[4]?Yt(i[4].quality)[0]:"white"),s[0]&148|s[1]&8&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function ED(t,e,n){let i,s,o,r,a,l,c,f,u,p,g,v,_,b,y,w,C=ce,A=()=>(C(),C=as(R,me=>n(7,w=me)),R),M,F,V,L,q;se(t,lp,me=>n(20,M=me)),se(t,ap,me=>n(21,F=me)),se(t,Bo,me=>n(22,V=me)),se(t,ol,me=>n(23,L=me)),se(t,Ro,me=>n(24,q=me)),t.$$.on_destroy.push(()=>C());let{skill:R}=e;A();let{skillslot:z}=e,{shift:E=!1}=e,W,j,N,U;Tc(()=>{if(w.hotkey!==W&&(j!==void 0&&ae(),W=w.hotkey,W!==void 0)){U=tt[W],U==null&&(U=tt[W]={});let me=fn(W,U);j=me.onPress(ie),N=me.onRelease(re)}});let ie=me=>{if(D.player&&w.id>=0){if(w.item){let De=D.player.inventory.findFirstSlotOfType(w.item.type,w.item.tier);if(De!==void 0){let Fe=D.player.inventory.slots.get(De);if(Fe.bound<Fe.logic.bindOnUse){Nt("error","Right-click and use the item in your inventory to bind it before using");return}nt(R,w.info[0]=De,w)}else return}let Ne=Pt.get(w.id);Ne.envCast>0?sr>0?Zf(0,0,0):Zf(w.id,Ne.range,Ne.envCast):Si(Ft.clientPlayerSkill.packData({id:w.id,info:w.info})),me.type==="keydown"&&n(8,u=!0),Mt(96)}},re=()=>{n(8,u=!1)},ae=()=>{U&&U.mappings&&(U.mappings=U.mappings.filter(me=>me!=W)),U&&U.press&&(U.press=U.press.filter(me=>me!=j)),U&&U.release&&(U.release=U.release.filter(me=>me!=N)),W=void 0,j=void 0,N=void 0};Wn(ae);function ue(me){io.call(this,t,me)}function Me(me){io.call(this,t,me)}return t.$$set=me=>{"skill"in me&&A(n(0,R=me.skill)),"skillslot"in me&&n(18,z=me.skillslot),"shift"in me&&n(1,E=me.shift)},t.$$.update=()=>{t.$$.dirty[0]&262272&&n(16,i={type:"skill",slot:z,skill:w}),t.$$.dirty[0]&128&&n(6,s=w.id<0),t.$$.dirty[0]&128&&n(19,o=w.item),t.$$.dirty[0]&16777408&&n(5,r=s?void 0:q[w.id]),t.$$.dirty[0]&128&&n(15,a=w.item?"slotitem":"slotskill"),t.$$.dirty[0]&8388736&&n(4,l=L&&w.item&&D.player?D.player.inventory.findFirstItemOfType(w.item.type,w.item.tier):void 0),t.$$.dirty[0]&524496&&n(14,c=s?void 0:o?l?Rf(l.type,l.tier,l.logic.class,Wl(l.quality)):Rf(o.type,o.tier,0,0):Bf(w.id)),t.$$.dirty[0]&8912912&&n(3,f=l!==void 0&&l.stacks!==void 0?L[o.type+o.tier]||0:void 0),t.$$.dirty[0]&4194496&&n(2,p=!w.item&&!s&&V.has(w.id)?V.get(w.id):0),t.$$.dirty[0]&32&&n(13,g=r?r.cd:void 0),t.$$.dirty[0]&32&&n(12,v=r?r.remaining:void 0),t.$$.dirty[0]&156&&n(11,_=w.item&&(!l||f===0)||!w.item&&p===0),t.$$.dirty[0]&2097280&&n(10,b=F!==void 0&&F===w.id),t.$$.dirty[0]&1048704&&n(9,y=M!==void 0&&M===w.id)},n(8,u=!1),[R,E,p,f,l,r,s,w,u,y,b,_,v,g,c,a,i,ie,z,o,M,F,V,L,q,ue,Me]}var vg=class extends we{constructor(e){super(),Ce(this,e,ED,TD,$e,{skill:0,skillslot:18,shift:1},null,[-1,-1])}},bM=vg;function yM(t,e,n){let i=t.slice();return i[10]=e[n],i[12]=n,i}function kM(t){let e,n;return e=new bM({props:{skill:t[10],skillslot:t[12],shift:t[0]}}),e.$on("discard",t[3]),e.$on("move",t[2]),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&1&&(o.shift=i[0]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function DD(t){let e,n,i=pe(wi),s=[];for(let r=0;r<i.length;r+=1)s[r]=kM(yM(t,i,r));let o=r=>I(s[r],1,1,()=>{s[r]=null});return{c(){e=h("div");for(let r=0;r<s.length;r+=1)s[r].c();m(e,"id","skillbar"),m(e,"class","panel-black bar svelte-1v6qmvo")},m(r,a){x(r,e,a);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null);n=!0},p(r,[a]){if(a&13){i=pe(wi);let l;for(l=0;l<i.length;l+=1){let c=yM(r,i,l);s[l]?(s[l].p(c,a),P(s[l],1)):(s[l]=kM(c),s[l].c(),P(s[l],1),s[l].m(e,null))}for(Te(),l=i.length;l<s.length;l+=1)o(l);Ee()}},i(r){if(!n){for(let a=0;a<i.length;a+=1)P(s[a]);n=!0}},o(r){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)I(s[a]);n=!1},d(r){r&&k(e),it(s,r)}}}function ID(t,e,n){let i,s,o,r;se(t,Pn,g=>n(5,i=g)),se(t,mo,g=>n(6,s=g)),se(t,Qr,g=>n(7,o=g));let a=tt.shift.store;se(t,a,g=>n(0,r=g));let l=D.player.name,c=s[l];c||(c=nt(mo,s[l]=[],s));for(let g=0;g<o;++g)if(s[l][g]===void 0){let v=Cm.get(D.player.class).startSkills[g];s[l].push({id:v!==void 0&&Pt.get(v).autoSkillbar?v:-1,type:0,info:[]}),g===4||g===5?(nt(mo,s[l][g].id=100,s),nt(mo,s[l][g].item={type:"misc",tier:g-4},s)):g===11&&nt(mo,s[l][11].id=40,s)}for(let g=0;g<o;++g)wi[g]===void 0&&wi.push(ne({id:-1,type:0,info:[]}));s[l].forEach((g,v)=>{wi[v]&&(g.hotkey=oe["kbSkillbar"+(v+1)],wi[v].set(g))}),wi.forEach((g,v)=>{g.subscribe(_=>{mo.update(b=>(b[l][v]=_,b))})});let f=g=>{let{from:v,to:_}=g.detail;v!==_&&(v.type=="item"?wi[_.slot].update(b=>(b.id=v.item.logic.useSkill,b.item={type:v.item.type,tier:v.item.tier},b)):v.type=="skill"&&(wi[_.slot].update(b=>(b.id=v.skill.id,b.item=v.skill.item,b)),v.slot!==void 0&&wi[v.slot].update(u)))},u=g=>(g.id=-1,g.item=void 0,g);return[r,a,f,g=>{wi[i.meta.slot].update(u)}]}var _g=class extends we{constructor(e){super(),Ce(this,e,ID,DD,Fn,{})}},xM=_g;function wM(t){let e,n;return e=new rd({props:{isTrader:t[6],item:t[10],shift:t[8]}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&64&&(o.isTrader=i[6]),s&1024&&(o.item=i[10]),s&256&&(o.shift=i[8]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function VD(t){let e,n,i=t[10]&&wM(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,o){s[10]?i?(i.p(s,o),o&1024&&P(i,1)):(i=wM(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function LD(t){let e,n;return e=new da({props:{describe:t[10]!==void 0,shift:t[8],cd:t[11],id:t[7],hover:t[5],descPos:t[4],descRoot:t[3],pickable:t[1],status:t[9]?-1:0,meta:t[14],img:t[15],border:t[13],stacks:t[12],data:t[10],key:t[2],$$slots:{default:[VD]},$$scope:{ctx:t}}}),e.$on("discard",t[21]),e.$on("use",t[22]),e.$on("click",t[23]),e.$on("context",t[24]),e.$on("move",t[25]),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,[s]){let o={};s&1024&&(o.describe=i[10]!==void 0),s&256&&(o.shift=i[8]),s&2048&&(o.cd=i[11]),s&128&&(o.id=i[7]),s&32&&(o.hover=i[5]),s&16&&(o.descPos=i[4]),s&8&&(o.descRoot=i[3]),s&2&&(o.pickable=i[1]),s&512&&(o.status=i[9]?-1:0),s&16384&&(o.meta=i[14]),s&32768&&(o.img=i[15]),s&8192&&(o.border=i[13]),s&4096&&(o.stacks=i[12]),s&1024&&(o.data=i[10]),s&4&&(o.key=i[2]),s&134219072&&(o.$$scope={dirty:s,ctx:i}),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function qD(t,e,n){let i,s,o,r,a,l,c,f,u=ce,p=()=>(u(),u=as(v,U=>n(10,f=U)),v),g;se(t,Ro,U=>n(20,g=U)),t.$$.on_destroy.push(()=>u());let{item:v}=e;p();let{filter:_=""}=e,{invslot:b}=e,{pickable:y=!0}=e,{text:w}=e,{descRoot:C}=e,{descPos:A}=e,{hover:M}=e,{isTrader:F=!1}=e,{clearOnMove:V=!1}=e,{id:L=""}=e,{shift:q=!1}=e,R=U=>U===!0||f.moving?!0:!(!U||f.type.includes(U)||f.logic.level>U||S.items[f.type][f.type==="book"?f.logic.skillid:f.tier].name.toLowerCase().includes(U));function z(U){io.call(this,t,U)}function E(U){io.call(this,t,U)}function W(U){io.call(this,t,U)}function j(U){io.call(this,t,U)}function N(U){io.call(this,t,U)}return t.$$set=U=>{"item"in U&&p(n(0,v=U.item)),"filter"in U&&n(16,_=U.filter),"invslot"in U&&n(17,b=U.invslot),"pickable"in U&&n(1,y=U.pickable),"text"in U&&n(2,w=U.text),"descRoot"in U&&n(3,C=U.descRoot),"descPos"in U&&n(4,A=U.descPos),"hover"in U&&n(5,M=U.hover),"isTrader"in U&&n(6,F=U.isTrader),"clearOnMove"in U&&n(18,V=U.clearOnMove),"id"in U&&n(7,L=U.id),"shift"in U&&n(8,q=U.shift)},t.$$.update=()=>{t.$$.dirty&132096&&n(15,i=f?Rf(f.type,f.tier,f.logic?f.logic.class:0,Wl(f.quality)):b>100?Ik(b):void 0),t.$$.dirty&394241&&n(14,s={type:"item",slot:b,item:f,store:V?v:void 0}),t.$$.dirty&66624&&n(9,o=f&&(F?!1:R(_))),t.$$.dirty&1536&&n(13,r=f?Yt(f.quality)[0]+(o?" grey":""):"grey"),t.$$.dirty&1024&&n(12,a=f&&(f.upgrade?"+"+f.upgrade:f.stacks)),t.$$.dirty&1049600&&n(19,l=f&&f.logic.useSkill?g[f.logic.useSkill]:void 0),t.$$.dirty&524288&&n(11,c=l?l.cd:void 0)},[v,y,w,C,A,M,F,L,q,o,f,c,a,r,s,i,_,b,V,l,g,z,E,W,j,N]}var bg=class extends we{constructor(e){super(),Ce(this,e,qD,LD,$e,{item:0,filter:16,invslot:17,pickable:1,text:2,descRoot:3,descPos:4,hover:5,isTrader:6,clearOnMove:18,id:7,shift:8})}},bi=bg;function MM(t,e,n){let i=t.slice();return i[19]=e[n],i[21]=n,i}function FM(t){let e,n;return e=new bi({props:{id:"bag"+t[21],item:t[19],invslot:t[21],filter:t[0].toLowerCase(),shift:t[4]||t[5]}}),e.$on("use",t[12]),e.$on("context",t[11]),e.$on("move",t[10]),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&2&&(o.item=i[19]),s&1&&(o.filter=i[0].toLowerCase()),s&48&&(o.shift=i[4]||i[5]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function RD(t){let e,n,i,s,o,r,a,l,c,f,u=pe(t[1].filter(CM)),p=[];for(let v=0;v<u.length;v+=1)p[v]=FM(MM(t,u,v));let g=v=>I(p[v],1,1,()=>{p[v]=null});return o=new yn({props:{amount:t[6]}}),a=new rr({props:{amount:t[7]}}),{c(){e=h("input"),i=h("div");for(let v=0;v<p.length;v+=1)p[v].c();s=h("div"),te(o.$$.fragment),r=h("a"),te(a.$$.fragment),m(e,"class","filter svelte-1axz35n"),m(e,"type","text"),m(e,"placeholder",n=S.ui.filter),m(i,"class","slotcontainer svelte-1axz35n"),Pe(i,"grid-template-columns","repeat("+t[3]+", auto)"),m(s,"class","panel-black gold svelte-1axz35n"),m(r,"class","panel-black gold svelte-1axz35n"),Pe(r,"margin-right","3px"),m(r,"target","_blank"),m(r,"href","/store")},m(v,_){x(v,e,_),Ge(e,t[0]),x(v,i,_);for(let b=0;b<p.length;b+=1)p[b]&&p[b].m(i,null);x(v,s,_),K(o,s,null),x(v,r,_),K(a,r,null),l=!0,c||(f=Q(e,"input",t[13]),c=!0)},p(v,_){if(_&1&&e.value!==v[0]&&Ge(e,v[0]),_&7219){u=pe(v[1].filter(CM));let w;for(w=0;w<u.length;w+=1){let C=MM(v,u,w);p[w]?(p[w].p(C,_),P(p[w],1)):(p[w]=FM(C),p[w].c(),P(p[w],1),p[w].m(i,null))}for(Te(),w=u.length;w<p.length;w+=1)g(w);Ee()}(!l||_&8)&&Pe(i,"grid-template-columns","repeat("+v[3]+", auto)");let b={};_&64&&(b.amount=v[6]),o.$set(b);let y={};_&128&&(y.amount=v[7]),a.$set(y)},i(v){if(!l){for(let _=0;_<u.length;_+=1)P(p[_]);P(o.$$.fragment,v),P(a.$$.fragment,v),l=!0}},o(v){p=p.filter(Boolean);for(let _=0;_<p.length;_+=1)I(p[_]);I(o.$$.fragment,v),I(a.$$.fragment,v),l=!1},d(v){v&&(k(e),k(i),k(s),k(r)),it(p,v),ee(o),ee(a),c=!1,f()}}}function BD(t){let e,n,i;return n=new Ot({props:{title:S.ui.inventory.name,pad:"5",icon:"bag",$$slots:{default:[RD]},$$scope:{ctx:t}}}),n.$on("close",t[14]),{c(){e=h("div"),te(n.$$.fragment),Pe(e,"display",t[2]?"block":"none"),m(e,"class","l-corner-lr container svelte-1axz35n")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,[o]){let r={};o&4194555&&(r.$$scope={dirty:o,ctx:s}),n.$set(r),(!i||o&4)&&Pe(e,"display",s[2]?"block":"none")},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}var CM=(t,e)=>e<101;function zD(t,e,n){let i,s,o,r,a,l,c,f,u,p,g;se(t,Yi,F=>n(15,i=F)),se(t,ls,F=>n(16,s=F)),se(t,Vi,F=>n(17,o=F)),se(t,Pn,F=>n(18,r=F)),se(t,sl,F=>n(1,a=F)),se(t,lo,F=>n(2,l=F)),se(t,Wr,F=>n(3,c=F)),se(t,Hi,F=>n(6,p=F)),se(t,qo,F=>n(7,g=F));let v="",_=tt.shift.store;se(t,_,F=>n(4,f=F));let b=tt.ctrl.store;se(t,b,F=>n(5,u=F));let y=F=>{let{from:V,to:L}=F.detail;if(V!==L&&V.type=="item"&&V.slot!==void 0&&L.slot!==void 0&&V.slot!==L.slot){if(xt("itemmove",`${V.slot} ${L.slot}`),V.slot>=101)return;V.item.stacks&&(V.item.stacks=""),V.item.moving=!0,L.item?(L.item.stacks&&(L.item.stacks=""),a[V.slot].set(L.item),L.item.moving=!0):a[V.slot]&&a[V.slot].set(void 0),a[L.slot].set(V.item)}},w=F=>{if(!F.detail.item||r)return;let V=[];if(o)V.push(nn.itemstash(F.detail.slot));else{if(F.detail.item.canEquip(D.player)){let L=F.detail.item.getBestEquipslot(D.player.inventory);L!==void 0&&V.push(nn.itemmove(F.detail.slot,L)),F.detail.item.logic.useSkill&&V.push(nn.itemuse(F.detail.slot,F.detail.item.logic.useSkill,F.detail.item.bound,F.detail.item.logic.bindOnUse))}i&&F.detail.item.canBeSold()&&V.push(nn.itemsell(F.detail.item.quality,F.detail.item.upgrade,F.detail.slot,F.detail.item.type,F.detail.item.tier)),F.detail.item.stacks>1&&(V.push(nn.itemsplithalf(F.detail.slot)),V.push(nn.itemsplitone(F.detail.slot))),V.push(nn.itemcopyid(F.detail.item.dbid)),F.detail.item.canBeDropped()&&V.push(nn.itemdrop(F.detail.item.quality,F.detail.item.upgrade,F.detail.slot,F.detail.item.type,F.detail.item.tier))}wn.set({x:F.detail.e.pageX-F.detail.e.layerX,y:F.detail.e.pageY+(46-F.detail.e.layerY),opts:V})},C=F=>{F.detail.item&&(o?xt("itemstash",`${F.detail.slot}`):s?(cs.set(F.detail.item),F.detail.item.type&&Mt(Ri[F.detail.item.type].sound)):i&&F.detail.item.canBeSold()?Uf(F.detail.item.quality,F.detail.item.upgrade,F.detail.slot,F.detail.item.type,F.detail.item.tier):F.detail.item.canBeDropped()&&S1(F.detail.item.quality,F.detail.item.upgrade,F.detail.slot,F.detail.item.type,F.detail.item.tier))};function A(){v=this.value,n(0,v)}return[v,a,l,c,f,u,p,g,_,b,y,w,C,A,F=>nt(lo,l=!1,l)]}var yg=class extends we{constructor(e){super(),Ce(this,e,zD,BD,$e,{})}},SM=yg;var xg={};Xn(xg,{add:()=>cd,init:()=>AM,onWorldEnter:()=>$D,tick:()=>UD,values:()=>ns});var ns=new Map,kg=new kt(0,.5),AM=()=>{ns.clear(),kg.reset(0)},$D=AM,UD=t=>{if(oe.dpsmeterOpen&&kg.done(D.time))if(kg.reset(D.time),ns.forEach((e,n)=>{if(e.ooc){D.time-e.start>5&&ns.delete(n);return}!D.entity(e.id)||D.time-e.last>5?(e.ooc=!0,e.start=D.time):e.dps=Math.ceil(e.amount/Math.max(5,D.time-e.start))}),oe.dpsmeterTarget){let e=ns.get(oe.dpsmeterTarget);e?zc.set(Array.from(e.skills).sort((n,i)=>i[1].amount-n[1].amount).map(n=>(n[1].dps=Math.ceil(n[1].amount/Math.max(5,D.time-n[1].start)),n)).slice(0,10)):Yr.set(0)}else zc.set(Array.from(ns).sort((e,n)=>n[1].amount-e[1].amount).slice(0,10))},cd=(t,e,n)=>{if(t.name===void 0||!oe.dpsmeterOpen||t.type!==0||oe.dpsmeterParty&&(D.player.party===0&&t!==D.player||t.party!==D.player.party))return;let i;ns.has(t.name)?i=ns.get(t.name):(ns.set(t.name,i={}),i.amount=0,i.start=0,i.class=t.class,i.dps=0,i.id=t.id,i.ooc=!0,i.skills=new Map),i.ooc?(i.start=D.time,i.ooc=!1,i.amount=e):i.amount+=e;let s=S.items.book[n]?S.items.book[n].name:"Unknown";i.skills.has(s)||i.skills.set(s,{id:n,class:t.class,amount:0,start:D.time});let o=i.skills.get(s);o.amount+=e,i.last=D.time};function PM(t,e,n){let i=t.slice();return i[11]=e[n],i[13]=n,i}function TM(t){let e,n,i;return n=new Ot({props:{title:t[5][t[1]],pad:"5",icon:"trophy",$$slots:{default:[OD]},$$scope:{ctx:t}}}),n.$on("close",t[10]),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","l-corner-lr container svelte-m4f7d2")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&2&&(r.title=s[5][s[1]]),o&16414&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function EM(t,e){let n,i,s,o,r;i=new vi({props:{size:"0.9em",fract:Math.round(100*e[11][1].amount/e[2][0][1].amount),barcol:"bgc"+e[11][1].class,left:`${e[13]+1}. ${e[11][0]}`,right:`${ni(e[11][1].amount)} (${ht(e[11][1].dps)})`}});function a(...l){return e[7](e[11],...l)}return{key:t,first:null,c(){n=h("div"),te(i.$$.fragment),this.first=n},m(l,c){x(l,n,c),K(i,n,null),s=!0,o||(r=Q(n,"click",a),o=!0)},p(l,c){e=l;let f={};c&4&&(f.fract=Math.round(100*e[11][1].amount/e[2][0][1].amount)),c&4&&(f.barcol="bgc"+e[11][1].class),c&4&&(f.left=`${e[13]+1}. ${e[11][0]}`),c&4&&(f.right=`${ni(e[11][1].amount)} (${ht(e[11][1].dps)})`),i.$set(f)},i(l){s||(P(i.$$.fragment,l),s=!0)},o(l){I(i.$$.fragment,l),s=!1},d(l){l&&k(n),ee(i),o=!1,r()}}}function OD(t){let e,n=[],i=new Map,s,o,r=t[5][t[1]]+"",a,l,c,f,u,p,g,v,_=pe(t[2]),b=y=>y[11][1].id;for(let y=0;y<_.length;y+=1){let w=PM(t,_,y),C=b(w);i.set(C,n[y]=EM(C,w))}return{c(){e=h("div");for(let y=0;y<n.length;y+=1)n[y].c();s=h("div"),o=h("div"),a=T(r),l=h("div"),c=T("Party"),u=h("div"),u.textContent=`${S.ui.reset}`,m(e,"class","wrapper svelte-m4f7d2"),m(o,"class","btn grey"),m(l,"class",f="btn "+(t[4]?"grey active":"black textgrey")),m(u,"class","btn grey"),m(s,"class","grid buttons marg-top svelte-m4f7d2"),Pe(s,"grid-template-columns","2fr 1fr 1fr")},m(y,w){x(y,e,w);for(let C=0;C<n.length;C+=1)n[C]&&n[C].m(e,null);x(y,s,w),d(s,o),d(o,a),d(s,l),d(l,c),d(s,u),p=!0,g||(v=[Q(o,"click",t[6]),Q(l,"click",t[8]),Q(u,"click",t[9])],g=!0)},p(y,w){w&12&&(_=pe(y[2]),Te(),n=ui(n,w,b,1,y,_,i,e,Ii,EM,null,PM),Ee()),(!p||w&2)&&r!==(r=y[5][y[1]]+"")&&G(a,r),(!p||w&16&&f!==(f="btn "+(y[4]?"grey active":"black textgrey")))&&m(l,"class",f)},i(y){if(!p){for(let w=0;w<_.length;w+=1)P(n[w]);p=!0}},o(y){for(let w=0;w<n.length;w+=1)I(n[w]);p=!1},d(y){y&&(k(e),k(s));for(let w=0;w<n.length;w+=1)n[w].d();g=!1,ut(v)}}}function ND(t){let e,n,i=t[0]&&TM(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=TM(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function jD(t,e,n){let i,s,o,r,a;se(t,Hr,v=>n(0,i=v)),se(t,tf,v=>n(1,s=v)),se(t,zc,v=>n(2,o=v)),se(t,Yr,v=>n(3,r=v)),se(t,ef,v=>n(4,a=v));let l=[S.ui.stats.misc.damage,S.ui.stats.misc.healing];return[i,s,o,r,a,l,v=>{wn.set({x:v.pageX,y:v.pageY-50,opts:l.map((_,b)=>({name:_,fun:()=>{tf.set(b),ns.clear()}}))})},(v,_)=>{nt(Yr,r=r?0:v[0],r)},v=>nt(ef,a=!a,a),v=>ns.clear(),v=>nt(Hr,i=!1,i)]}var wg=class extends we{constructor(e){super(),Ce(this,e,jD,ND,$e,{})}},DM=wg;function IM(t){let e,n=t[0].area+"",i,s,o,r;return{c(){e=h("p"),i=T(n),o=Ue(),m(e,"class","text location textgreen svelte-dujqu3")},m(a,l){x(a,e,l),d(e,i),x(a,o,l),r=!0},p(a,l){(!r||l&1)&&n!==(n=a[0].area+"")&&G(i,n)},i(a){r||(a&&mn(()=>{r&&(s||(s=Ka(e,Pr,{},!0)),s.run(1))}),r=!0)},o(a){a&&(s||(s=Ka(e,Pr,{},!1)),s.run(0)),r=!1},d(a){a&&(k(e),k(o)),a&&s&&s.end()}}}function VM(t){let e,n=t[0].error+"",i,s,o;return{c(){e=h("p"),i=T(n),m(e,"class","text error textred svelte-dujqu3")},m(r,a){x(r,e,a),d(e,i),o=!0},p(r,a){(!o||a&1)&&n!==(n=r[0].error+"")&&G(i,n)},i(r){o||(s&&s.end(1),o=!0)},o(r){r&&(s=J2(e,Pr,{})),o=!1},d(r){r&&k(e),r&&s&&s.end()}}}function WD(t){let e,n,i=t[0].area&&IM(t),s=t[0].error&&VM(t);return{c(){e=h("div"),i&&i.c(),n=ge(),s&&s.c(),m(e,"class","l-ui")},m(o,r){x(o,e,r),i&&i.m(e,null),d(e,n),s&&s.m(e,null)},p(o,[r]){o[0].area?i?(i.p(o,r),r&1&&P(i,1)):(i=IM(o),i.c(),P(i,1),i.m(e,n)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee()),o[0].error?s?(s.p(o,r),r&1&&P(s,1)):(s=VM(o),s.c(),P(s,1),s.m(e,null)):s&&(Te(),I(s,1,1,()=>{s=null}),Ee())},i(o){P(i),P(s)},o(o){I(i),I(s)},d(o){o&&k(e),i&&i.d(),s&&s.d()}}}function GD(t,e,n){let i={},s={};return Cr.subscribe(o=>{n(0,i[o.type]=o.text,i),s[o.type]&&clearTimeout(s[o.type]),s[o.type]=setTimeout(()=>{n(0,i[o.type]=void 0,i)},o.time||1e3)}),[i]}var Mg=class extends we{constructor(e){super(),Ce(this,e,GD,WD,$e,{})}},LM=Mg;function qM(t,e,n){let i=t.slice();return i[5]=e[n],i}function RM(t){let e,n,i,s,o,r;return n=new Ot({props:{title:S.ui.headers.request,close:!1,$$slots:{default:[HD]},$$scope:{ctx:t}}}),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","absCentered container svelte-1lvns9i")},m(a,l){x(a,e,l),K(n,e,null),s=!0,o||(r=Q(e,"outroend",t[4]),o=!0)},p(a,l){let c={};l&258&&(c.$$scope={dirty:l,ctx:a}),n.$set(c)},i(a){s||(P(n.$$.fragment,a),a&&mn(()=>{s&&(i||(i=Ka(e,Pr,{duration:100},!0)),i.run(1))}),s=!0)},o(a){I(n.$$.fragment,a),a&&(i||(i=Ka(e,Pr,{duration:100},!1)),i.run(0)),s=!1},d(a){a&&k(e),ee(n),a&&i&&i.end(),o=!1,r()}}}function BM(t){let e,n=t[5].text+"",i,s,o=(t[5].unavailable||"")+"",r,a,l=(t[5].additional||"")+"",c,f,u,p;function g(){return t[3](t[5])}return{c(){e=h("div"),i=T(n),s=Ue(),r=T(o),a=Ue(),c=T(l),m(e,"class",f="choice "+(t[5].unavailable?"unavailable textgrey":"")+" svelte-1lvns9i")},m(v,_){x(v,e,_),d(e,i),d(e,s),d(e,r),d(e,a),d(e,c),u||(p=Q(e,"click",g),u=!0)},p(v,_){t=v,_&2&&n!==(n=t[5].text+"")&&G(i,n),_&2&&o!==(o=(t[5].unavailable||"")+"")&&G(r,o),_&2&&l!==(l=(t[5].additional||"")+"")&&G(c,l),_&2&&f!==(f="choice "+(t[5].unavailable?"unavailable textgrey":"")+" svelte-1lvns9i")&&m(e,"class",f)},d(v){v&&k(e),u=!1,p()}}}function HD(t){let e,n,i=t[1][0].title+"",s,o,r=t[1][0].text+"",a=pe(t[1][0].choices),l=[];for(let c=0;c<a.length;c+=1)l[c]=BM(qM(t,a,c));return{c(){e=h("div"),n=h("h3"),s=T(i),o=h("p");for(let c=0;c<l.length;c+=1)l[c].c();m(n,"class","textprimary"),m(e,"class","container svelte-1lvns9i")},m(c,f){x(c,e,f),d(e,n),d(n,s),d(e,o),o.innerHTML=r;for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null)},p(c,f){if(f&2&&i!==(i=c[1][0].title+"")&&G(s,i),f&2&&r!==(r=c[1][0].text+"")&&(o.innerHTML=r),f&6){a=pe(c[1][0].choices);let u;for(u=0;u<a.length;u+=1){let p=qM(c,a,u);l[u]?l[u].p(p,f):(l[u]=BM(p),l[u].c(),l[u].m(e,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=a.length}},d(c){c&&k(e),it(l,c)}}}function YD(t){let e,n,i=t[1].length&&!t[0]&&RM(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[1].length&&!s[0]?i?(i.p(s,o),o&3&&P(i,1)):(i=RM(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function XD(t,e,n){let i;se(t,so,l=>n(1,i=l));let s=!1,o=async l=>{l&&await l(),Gh(),n(0,s=!0)};return[s,i,o,l=>{o(l.fun)},()=>{n(0,s=!1)}]}var Fg=class extends we{constructor(e){super(),Ce(this,e,XD,YD,$e,{})}},zM=Fg;function $M(t){let e,n,i=t[0][0].text+"",s,o,r=t[0][0].icon&&UM(t);return{c(){e=h("div"),r&&r.c(),n=h("div"),m(e,"class","notification panel-black border grey svelte-9nlpzp")},m(a,l){x(a,e,l),r&&r.m(e,null),d(e,n),n.innerHTML=i,s||(o=Q(e,"click",t[2]),s=!0)},p(a,l){a[0][0].icon?r?r.p(a,l):(r=UM(a),r.c(),r.m(e,n)):r&&(r.d(1),r=null),l&1&&i!==(i=a[0][0].text+"")&&(n.innerHTML=i)},d(a){a&&k(e),r&&r.d(),s=!1,o()}}}function UM(t){let e,n,i;return{c(){e=h("img"),m(e,"class",n="icon "+t[0][0].css+" svelte-9nlpzp"),at(e.src,i="/data/ui/"+t[0][0].icon)||m(e,"src",i)},m(s,o){x(s,e,o)},p(s,o){o&1&&n!==(n="icon "+s[0][0].css+" svelte-9nlpzp")&&m(e,"class",n),o&1&&!at(e.src,i="/data/ui/"+s[0][0].icon)&&m(e,"src",i)},d(s){s&&k(e)}}}function QD(t){let e,n=t[0].length&&!t[1]&&$M(t);return{c(){n&&n.c(),e=ge()},m(i,s){n&&n.m(i,s),x(i,e,s)},p(i,[s]){i[0].length&&!i[1]?n?n.p(i,s):(n=$M(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ce,o:ce,d(i){i&&k(e),n&&n.d(i)}}}function ZD(t,e,n){let i,s;return se(t,Ic,r=>n(0,i=r)),se(t,xi,r=>n(1,s=r)),[i,s,()=>{Ic.update(r=>(r.shift(),r))}]}var Cg=class extends we{constructor(e){super(),Ce(this,e,ZD,QD,$e,{})}},OM=Cg;function NM(t,e,n){let i=t.slice();return i[5]=e[n],i}function jM(t){let e,n;return{c(){e=h("div"),n=T(t[0]),m(e,"class","btn border grey")},m(i,s){x(i,e,s),d(e,n)},p(i,s){s&1&&G(n,i[0])},d(i){i&&k(e)}}}function WM(t){let e,n,i,s,o,r;function a(...c){return t[2](t[5],...c)}function l(...c){return t[4](t[5],...c)}return{c(){e=h("div"),n=h("img"),m(n,"class","svgicon"),at(n.src,i="/data/ui/icons/"+t[5].img+".svg?v=8582889")||m(n,"src",i),m(e,"id",s="sys"+t[5].img),m(e,"class","btn border black")},m(c,f){x(c,e,f),d(e,n),o||(r=[Q(e,"mouseenter",a),Q(e,"mouseleave",t[3]),Q(e,"click",l)],o=!0)},p(c,f){t=c},d(c){c&&k(e),o=!1,ut(r)}}}function JD(t){let e,n,i=t[0]!==""&&jM(t),s=pe(t[1]),o=[];for(let r=0;r<s.length;r+=1)o[r]=WM(NM(t,s,r));return{c(){e=h("div"),i&&i.c(),n=ge();for(let r=0;r<o.length;r+=1)o[r].c();m(e,"class","btnbar svelte-133q4bd")},m(r,a){x(r,e,a),i&&i.m(e,null),d(e,n);for(let l=0;l<o.length;l+=1)o[l]&&o[l].m(e,null)},p(r,[a]){if(r[0]!==""?i?i.p(r,a):(i=jM(r),i.c(),i.m(e,n)):i&&(i.d(1),i=null),a&3){s=pe(r[1]);let l;for(l=0;l<s.length;l+=1){let c=NM(r,s,l);o[l]?o[l].p(c,a):(o[l]=WM(c),o[l].c(),o[l].m(e,null))}for(;l<o.length;l+=1)o[l].d(1);o.length=s.length}},i:ce,o:ce,d(r){r&&k(e),i&&i.d(),it(o,r)}}}function KD(t,e,n){let i=[{img:"gem",desc:S.ui.elixir.subscription,store:Li},{img:"char",desc:S.ui.headers.character,store:po},{img:"book",desc:S.ui.headers.skills,store:co},{img:"bag",desc:S.ui.inventory.name,store:lo},{img:"pvp",desc:S.ui.headers.pvp,store:uo},{img:"clan",desc:S.ui.clan.heading,store:fo},{img:"trophy",desc:S.ui.headers.dpsMeter,store:Hr},{img:"cog",desc:S.ui.settings.name,store:Gr},{img:"fullscreen",desc:S.ui.headers.fullscreen,fun:async()=>{"keyboard"in navigator&&"lock"in navigator.keyboard&&await navigator.keyboard.lock(["Escape"]),document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}},{img:"back",desc:S.ui.headers.menuReturn,fun:()=>{document.location.href="/"}}],s="";return[s,i,(l,c)=>n(0,s=l.desc),l=>n(0,s=""),(l,c)=>{l.fun?l.fun():l.store.update(f=>!f)}]}var Sg=class extends we{constructor(e){super(),Ce(this,e,KD,JD,$e,{})}},GM=Sg;function eI(t){let e,n,i,s;return{c(){e=h("div"),m(e,"class",n="btn checkbox "+(t[2]?"active":""))},m(o,r){x(o,e,r),i||(s=Q(e,"click",t[3]),i=!0)},p(o,[r]){r&4&&n!==(n="btn checkbox "+(o[2]?"active":""))&&m(e,"class",n)},i:ce,o:ce,d(o){o&&k(e),i=!1,s()}}}function tI(t,e,n){let i,s=ce,o=()=>(s(),s=as(r,c=>n(2,i=c)),r);t.$$.on_destroy.push(()=>s());let{store:r}=e;o();let{cb:a}=e,l=c=>{nt(r,i=!i,i),a&&a(i)};return t.$$set=c=>{"store"in c&&o(n(0,r=c.store)),"cb"in c&&n(1,a=c.cb)},[r,a,i,l]}var Ag=class extends we{constructor(e){super(),Ce(this,e,tI,eI,$e,{store:0,cb:1})}},zt=Ag;function HM(t,e,n){let i=t.slice();return i[76]=e[n],i[78]=n,i}function YM(t,e,n){let i=t.slice();return i[73]=e[n],i}function XM(t,e,n){let i=t.slice();return i[70]=e[n],i[71]=e,i[72]=n,i}function QM(t,e,n){let i=t.slice();return i[79]=e[n],i}function ZM(t){let e,n,i;return n=new Ot({props:{title:S.ui.settings.name,icon:"cog",$$slots:{default:[aI]},$$scope:{ctx:t}}}),n.$on("close",t[68]),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","container svelte-ntyx09")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o[0]&2147483626|o[1]&1|o[2]&1048576&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function JM(t){let e,n=t[79].name+"",i,s,o,r;function a(...l){return t[36](t[79],...l)}return{c(){e=h("div"),i=T(n),m(e,"class",s="choice "+(t[79]==t[1]?"active":""))},m(l,c){x(l,e,c),d(e,i),o||(r=Q(e,"click",a),o=!0)},p(l,c){t=l,c[0]&2&&s!==(s="choice "+(t[79]==t[1]?"active":""))&&m(e,"class",s)},d(l){l&&k(e),o=!1,r()}}}function nI(t){let e,n,i,s,o,r;n=new zt({props:{store:Hp}});let a=pe(S.ui.chat.types),l=[];for(let c=0;c<a.length;c+=1)l[c]=KM(HM(t,a,c));return{c(){e=h("div"),e.textContent=`${S.ui.settings.chatbubbles}`,te(n.$$.fragment),i=h("div"),i.textContent=`${S.ui.settings.combatlog}`,s=h("div");for(let c=0;c<l.length;c+=1)l[c].c();o=ge(),m(i,"class","textprimary")},m(c,f){x(c,e,f),K(n,c,f),x(c,i,f),x(c,s,f);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(c,f);x(c,o,f),r=!0},p(c,f){if(f[1]&1){a=pe(S.ui.chat.types);let u;for(u=0;u<a.length;u+=1){let p=HM(c,a,u);l[u]?l[u].p(p,f):(l[u]=KM(p),l[u].c(),l[u].m(o.parentNode,o))}for(;u<l.length;u+=1)l[u].d(1);l.length=a.length}},i(c){r||(P(n.$$.fragment,c),r=!0)},o(c){I(n.$$.fragment,c),r=!1},d(c){c&&(k(e),k(i),k(s),k(o)),ee(n,c),it(l,c)}}}function iI(t){let e,n=S.ui.settings.language+"",i,s,o,r,a,l,c,f,u,p,g,v,_,b,y,w,C,A,M,F,V,L,q,R,z,E,W,j,N,U,ie,re,ae,ue,Me,me,Ne,De,Fe,_e,H,qe,Oe=S.ui.settings.qualitymin+"",He,Ye,Ze,ve,le,ze,Z,X=S.ui.settings.excludedrops+"",$,fe,je,Ve,ye,Re,Be,mt,wt,Qe,Et,be,Je,yt,St,Ae,ct,$t=S.ui.settings.skillcdtext+"",Le,Ct,Vt,We,Ke,xe,ot,Xe,ft,kn=S.ui.settings.flashinterval+"",Fs,ai,Di,dt=t[22].toFixed(1)+"",Lt,Cs,On,li,bc=S.ui.settings.flashduration+"",xr,Po,Ss,pn=t[23].toFixed(1)+"",Bt,Kt,ci,Du,As,Iu,Ps,Vu,Ia,yc,Z0,Lu,Va,qu,La,Ru,Ts,kc,J0,Bu,qa,zu,Ra,xc,K0,Ba,AP=S.ui.settings.protectedquality+"",S2,A2,wc,eh,P2,Es,za,PP=S.ui.settings.invwidth+"",T2,E2,$u,th,Ds,Mc,nh,$a,TP=S.ui.settings.stashwidth+"",D2,I2,Uu,ih,Is,Ua,EP=S.ui.settings.stashheight+"",V2,L2,Ou,sh,Vs,Fc,oh,Nu,Oa,rs,rh,q2,Na=pe(t[33]),fi=[];for(let J=0;J<Na.length;J+=1)fi[J]=e6(YM(t,Na,J));return y=new zt({props:{store:gl}}),V=new zt({props:{store:Lp}}),q=new zt({props:{store:Bp}}),z=new zt({props:{store:qp}}),W=new zt({props:{store:zp}}),N=new zt({props:{store:Rp}}),ie=new zt({props:{store:$p}}),ae=new zt({props:{store:Op}}),Me=new zt({props:{store:jp}}),Ne=new zt({props:{store:Up}}),H=new zt({props:{store:Zp}}),mt=new zt({props:{store:Xp}}),Qe=new zt({props:{store:Yp}}),be=new zt({props:{store:Qp}}),yt=new zt({props:{store:Np}}),We=new zt({props:{store:Jp,cb:t[34]}}),xe=new zt({props:{store:Kp}}),Xe=new zt({props:{store:nm}}),Ia=new zt({props:{store:em}}),Va=new zt({props:{store:tm}}),La=new zt({props:{store:vl}}),qa=new zt({props:{store:Wp}}),Ra=new zt({props:{store:Gp}}),Oa=new zt({props:{store:hl}}),{c(){e=h("div"),i=T(n),s=Ue(),o=h("br"),r=h("small"),r.textContent=`${S.ui.settings.reload}`,a=h("select");for(let J=0;J<fi.length;J+=1)fi[J].c();l=h("div"),l.textContent=`${S.ui.settings.tutorial}`,c=h("div"),f=h("div"),f.textContent=`${S.ui.reset}`,u=h("div"),u.textContent=`${S.ui.settings.resettutorial}`,p=h("div"),p.textContent=`${S.ui.disable}`,g=h("div"),g.textContent=`${S.ui.settings.disabletutorial}`,v=h("div"),v.textContent=`${S.ui.settings.fpsping}`,_=h("div"),b=h("div"),b.textContent=`${S.ui.settings.showfps}`,te(y.$$.fragment),w=h("div"),w.textContent=`${S.ui.settings.nameplates}`,C=h("div"),A=h("div"),A.textContent=`${S.ui.settings.drawrange}`,M=h("input"),F=h("div"),F.textContent=`${S.ui.settings.monsterbars}`,te(V.$$.fragment),L=h("div"),L.textContent=`${S.ui.settings.monsternames}`,te(q.$$.fragment),R=h("div"),R.textContent=`${S.ui.settings.friendlyplayerbars}`,te(z.$$.fragment),E=h("div"),E.textContent=`${S.ui.settings.friendlyplayernames}`,te(W.$$.fragment),j=h("div"),j.textContent=`${S.ui.settings.enemyplayerbars}`,te(N.$$.fragment),U=h("div"),U.textContent=`${S.ui.settings.enemyplayernames}`,te(ie.$$.fragment),re=h("div"),re.textContent=`${S.ui.settings.showlevel}`,te(ae.$$.fragment),ue=h("div"),ue.textContent=`${S.ui.settings.classcolors}`,te(Me.$$.fragment),me=h("div"),me.textContent=`${S.ui.settings.transparency}`,te(Ne.$$.fragment),De=h("div"),De.textContent=`${S.ui.settings.drops}`,Fe=h("div"),_e=h("div"),_e.textContent=`${S.ui.settings.showquality}`,te(H.$$.fragment),qe=h("div"),He=T(Oe),Ye=h("br"),Ze=h("small"),ve=T(t[20]),le=T("%"),ze=h("input"),Z=h("div"),$=T(X),fe=h("br"),je=h("small"),je.textContent=`${S.ui.settings.reload}`,Ve=h("input"),ye=h("div"),ye.textContent=`${S.ui.settings.damagehealing}`,Re=h("div"),Be=h("div"),Be.textContent=`${S.ui.settings.incomingdamage}`,te(mt.$$.fragment),wt=h("div"),wt.textContent=`${S.ui.settings.incominghealing}`,te(Qe.$$.fragment),Et=h("div"),Et.textContent=`${S.ui.settings.incomingmana}`,te(be.$$.fragment),Je=h("div"),Je.textContent=`${S.ui.settings.preventoverlap}`,te(yt.$$.fragment),St=h("div"),St.textContent=`${S.ui.settings.icons}`,Ae=h("div"),ct=h("div"),Le=T($t),Ct=h("br"),Vt=h("small"),Vt.textContent=`${S.ui.settings.reload}`,te(We.$$.fragment),Ke=h("div"),Ke.textContent=`${S.ui.settings.buffcdtext}`,te(xe.$$.fragment),ot=h("div"),ot.textContent=`${S.ui.settings.selfbuffsonly}`,te(Xe.$$.fragment),ft=h("div"),Fs=T(kn),ai=h("br"),Di=h("small"),Lt=T(dt),Cs=T("s"),On=h("input"),li=h("div"),xr=T(bc),Po=h("br"),Ss=h("small"),Bt=T(pn),Kt=T("s"),ci=h("input"),Du=h("div"),Du.textContent=`${S.ui.settings.buffmax}`,As=h("input"),Iu=h("div"),Iu.textContent=`${S.ui.settings.buffmaxparty}`,Ps=h("input"),Vu=h("div"),Vu.textContent=`${S.ui.settings.updateratelimit}`,te(Ia.$$.fragment),yc=h("div"),yc.textContent=`${S.ui.settings.unitframes}`,Z0=h("div"),Lu=h("div"),Lu.textContent=`${S.ui.settings.showselfparty}`,te(Va.$$.fragment),qu=h("div"),qu.textContent=`${S.ui.settings.partymana}`,te(La.$$.fragment),Ru=h("div"),Ru.textContent=`${S.ui.settings.partyframewidth}`,Ts=h("input"),kc=h("div"),kc.textContent=`${S.ui.settings.map}`,J0=h("div"),Bu=h("div"),Bu.textContent=`${S.ui.settings.mapshowmonsters}`,te(qa.$$.fragment),zu=h("div"),zu.textContent=`${S.ui.settings.maplowqual}`,te(Ra.$$.fragment),xc=h("div"),xc.textContent=`${S.ui.inventory.name}`,K0=h("div"),Ba=h("div"),S2=T(AP),A2=h("br"),wc=h("small"),eh=T(t[27]),P2=T("%"),Es=h("input"),za=h("div"),T2=T(PP),E2=h("br"),$u=h("small"),th=T(t[28]),Ds=h("input"),Mc=h("div"),Mc.textContent=`${S.ui.stash.name}`,nh=h("div"),$a=h("div"),D2=T(TP),I2=h("br"),Uu=h("small"),ih=T(t[29]),Is=h("input"),Ua=h("div"),V2=T(EP),L2=h("br"),Ou=h("small"),sh=T(t[30]),Vs=h("input"),Fc=h("div"),Fc.textContent="Social",oh=h("div"),Nu=h("div"),Nu.textContent="Twitch Streams",te(Oa.$$.fragment),m(r,"class","textgrey"),t[18]===void 0&&mn(()=>t[52].call(a)),m(l,"class","textprimary"),m(u,"class","btn blue"),m(g,"class","btn orange"),m(v,"class","textprimary"),m(w,"class","textprimary"),m(M,"type","range"),m(De,"class","textprimary"),m(Ze,"class","textgrey"),m(ze,"type","range"),m(ze,"min","0"),m(ze,"max","100"),m(je,"class","textgrey"),m(Ve,"type","text"),m(Ve,"placeholder","misc, gold, ..."),m(ye,"class","textprimary"),m(St,"class","textprimary"),m(Vt,"class","textgrey"),m(Di,"class","textgrey"),m(On,"type","range"),m(On,"min","0"),m(On,"max","1"),m(On,"step","0.1"),m(Ss,"class","textgrey"),m(ci,"type","range"),m(ci,"min","0"),m(ci,"max","5"),m(ci,"step","0.1"),m(As,"placeholder","14"),m(As,"type","number"),m(As,"min","0"),m(Ps,"placeholder","8"),m(Ps,"type","number"),m(Ps,"min","0"),m(yc,"class","textprimary"),m(Ts,"type","range"),m(Ts,"min","50"),m(Ts,"max","400"),m(kc,"class","textprimary"),m(xc,"class","textprimary"),m(wc,"class","textgrey"),m(Es,"type","range"),m(Es,"min","0"),m(Es,"max","110"),m($u,"class","textgrey"),m(Ds,"type","range"),m(Ds,"min","4"),m(Ds,"max","10"),m(Mc,"class","textprimary"),m(Uu,"class","textgrey"),m(Is,"type","range"),m(Is,"min","6"),m(Is,"max","20"),m(Ou,"class","textgrey"),m(Vs,"type","range"),m(Vs,"min","50"),m(Vs,"max","500"),m(Fc,"class","textprimary")},m(J,Se){x(J,e,Se),d(e,i),d(e,s),d(e,o),d(e,r),x(J,a,Se);for(let Nn=0;Nn<fi.length;Nn+=1)fi[Nn]&&fi[Nn].m(a,null);xn(a,t[18],!0),x(J,l,Se),x(J,c,Se),x(J,f,Se),x(J,u,Se),x(J,p,Se),x(J,g,Se),x(J,v,Se),x(J,_,Se),x(J,b,Se),K(y,J,Se),x(J,w,Se),x(J,C,Se),x(J,A,Se),x(J,M,Se),Ge(M,t[19]),x(J,F,Se),K(V,J,Se),x(J,L,Se),K(q,J,Se),x(J,R,Se),K(z,J,Se),x(J,E,Se),K(W,J,Se),x(J,j,Se),K(N,J,Se),x(J,U,Se),K(ie,J,Se),x(J,re,Se),K(ae,J,Se),x(J,ue,Se),K(Me,J,Se),x(J,me,Se),K(Ne,J,Se),x(J,De,Se),x(J,Fe,Se),x(J,_e,Se),K(H,J,Se),x(J,qe,Se),d(qe,He),d(qe,Ye),d(qe,Ze),d(Ze,ve),d(Ze,le),x(J,ze,Se),Ge(ze,t[20]),x(J,Z,Se),d(Z,$),d(Z,fe),d(Z,je),x(J,Ve,Se),Ge(Ve,t[21]),x(J,ye,Se),x(J,Re,Se),x(J,Be,Se),K(mt,J,Se),x(J,wt,Se),K(Qe,J,Se),x(J,Et,Se),K(be,J,Se),x(J,Je,Se),K(yt,J,Se),x(J,St,Se),x(J,Ae,Se),x(J,ct,Se),d(ct,Le),d(ct,Ct),d(ct,Vt),K(We,J,Se),x(J,Ke,Se),K(xe,J,Se),x(J,ot,Se),K(Xe,J,Se),x(J,ft,Se),d(ft,Fs),d(ft,ai),d(ft,Di),d(Di,Lt),d(Di,Cs),x(J,On,Se),Ge(On,t[22]),x(J,li,Se),d(li,xr),d(li,Po),d(li,Ss),d(Ss,Bt),d(Ss,Kt),x(J,ci,Se),Ge(ci,t[23]),x(J,Du,Se),x(J,As,Se),Ge(As,t[24]),x(J,Iu,Se),x(J,Ps,Se),Ge(Ps,t[25]),x(J,Vu,Se),K(Ia,J,Se),x(J,yc,Se),x(J,Z0,Se),x(J,Lu,Se),K(Va,J,Se),x(J,qu,Se),K(La,J,Se),x(J,Ru,Se),x(J,Ts,Se),Ge(Ts,t[26]),x(J,kc,Se),x(J,J0,Se),x(J,Bu,Se),K(qa,J,Se),x(J,zu,Se),K(Ra,J,Se),x(J,xc,Se),x(J,K0,Se),x(J,Ba,Se),d(Ba,S2),d(Ba,A2),d(Ba,wc),d(wc,eh),d(wc,P2),x(J,Es,Se),Ge(Es,t[27]),x(J,za,Se),d(za,T2),d(za,E2),d(za,$u),d($u,th),x(J,Ds,Se),Ge(Ds,t[28]),x(J,Mc,Se),x(J,nh,Se),x(J,$a,Se),d($a,D2),d($a,I2),d($a,Uu),d(Uu,ih),x(J,Is,Se),Ge(Is,t[29]),x(J,Ua,Se),d(Ua,V2),d(Ua,L2),d(Ua,Ou),d(Ou,sh),x(J,Vs,Se),Ge(Vs,t[30]),x(J,Fc,Se),x(J,oh,Se),x(J,Nu,Se),K(Oa,J,Se),rs=!0,rh||(q2=[Q(a,"change",t[52]),Q(a,"change",t[34]),Q(u,"click",t[53]),Q(g,"click",t[54]),Q(M,"change",t[55]),Q(M,"input",t[55]),Q(ze,"change",t[56]),Q(ze,"input",t[56]),Q(ze,"change",t[34]),Q(Ve,"input",t[57]),Q(Ve,"change",t[34]),Q(On,"change",t[58]),Q(On,"input",t[58]),Q(ci,"change",t[59]),Q(ci,"input",t[59]),Q(As,"input",t[60]),Q(Ps,"input",t[61]),Q(Ts,"change",t[62]),Q(Ts,"input",t[62]),Q(Es,"change",t[63]),Q(Es,"input",t[63]),Q(Ds,"change",t[64]),Q(Ds,"input",t[64]),Q(Is,"change",t[65]),Q(Is,"input",t[65]),Q(Vs,"change",t[66]),Q(Vs,"input",t[66])],rh=!0)},p(J,Se){if(Se[1]&4){Na=pe(J[33]);let Nn;for(Nn=0;Nn<Na.length;Nn+=1){let R2=YM(J,Na,Nn);fi[Nn]?fi[Nn].p(R2,Se):(fi[Nn]=e6(R2),fi[Nn].c(),fi[Nn].m(a,null))}for(;Nn<fi.length;Nn+=1)fi[Nn].d(1);fi.length=Na.length}Se[0]&262144|Se[1]&4&&xn(a,J[18]),Se[0]&524288&&Ge(M,J[19]),(!rs||Se[0]&1048576)&&G(ve,J[20]),Se[0]&1048576&&Ge(ze,J[20]),Se[0]&2097152&&Ve.value!==J[21]&&Ge(Ve,J[21]),(!rs||Se[0]&4194304)&&dt!==(dt=J[22].toFixed(1)+"")&&G(Lt,dt),Se[0]&4194304&&Ge(On,J[22]),(!rs||Se[0]&8388608)&&pn!==(pn=J[23].toFixed(1)+"")&&G(Bt,pn),Se[0]&8388608&&Ge(ci,J[23]),Se[0]&16777216&&jt(As.value)!==J[24]&&Ge(As,J[24]),Se[0]&33554432&&jt(Ps.value)!==J[25]&&Ge(Ps,J[25]),Se[0]&67108864&&Ge(Ts,J[26]),(!rs||Se[0]&134217728)&&G(eh,J[27]),Se[0]&134217728&&Ge(Es,J[27]),(!rs||Se[0]&268435456)&&G(th,J[28]),Se[0]&268435456&&Ge(Ds,J[28]),(!rs||Se[0]&536870912)&&G(ih,J[29]),Se[0]&536870912&&Ge(Is,J[29]),(!rs||Se[0]&1073741824)&&G(sh,J[30]),Se[0]&1073741824&&Ge(Vs,J[30])},i(J){rs||(P(y.$$.fragment,J),P(V.$$.fragment,J),P(q.$$.fragment,J),P(z.$$.fragment,J),P(W.$$.fragment,J),P(N.$$.fragment,J),P(ie.$$.fragment,J),P(ae.$$.fragment,J),P(Me.$$.fragment,J),P(Ne.$$.fragment,J),P(H.$$.fragment,J),P(mt.$$.fragment,J),P(Qe.$$.fragment,J),P(be.$$.fragment,J),P(yt.$$.fragment,J),P(We.$$.fragment,J),P(xe.$$.fragment,J),P(Xe.$$.fragment,J),P(Ia.$$.fragment,J),P(Va.$$.fragment,J),P(La.$$.fragment,J),P(qa.$$.fragment,J),P(Ra.$$.fragment,J),P(Oa.$$.fragment,J),rs=!0)},o(J){I(y.$$.fragment,J),I(V.$$.fragment,J),I(q.$$.fragment,J),I(z.$$.fragment,J),I(W.$$.fragment,J),I(N.$$.fragment,J),I(ie.$$.fragment,J),I(ae.$$.fragment,J),I(Me.$$.fragment,J),I(Ne.$$.fragment,J),I(H.$$.fragment,J),I(mt.$$.fragment,J),I(Qe.$$.fragment,J),I(be.$$.fragment,J),I(yt.$$.fragment,J),I(We.$$.fragment,J),I(xe.$$.fragment,J),I(Xe.$$.fragment,J),I(Ia.$$.fragment,J),I(Va.$$.fragment,J),I(La.$$.fragment,J),I(qa.$$.fragment,J),I(Ra.$$.fragment,J),I(Oa.$$.fragment,J),rs=!1},d(J){J&&(k(e),k(a),k(l),k(c),k(f),k(u),k(p),k(g),k(v),k(_),k(b),k(w),k(C),k(A),k(M),k(F),k(L),k(R),k(E),k(j),k(U),k(re),k(ue),k(me),k(De),k(Fe),k(_e),k(qe),k(ze),k(Z),k(Ve),k(ye),k(Re),k(Be),k(wt),k(Et),k(Je),k(St),k(Ae),k(ct),k(Ke),k(ot),k(ft),k(On),k(li),k(ci),k(Du),k(As),k(Iu),k(Ps),k(Vu),k(yc),k(Z0),k(Lu),k(qu),k(Ru),k(Ts),k(kc),k(J0),k(Bu),k(zu),k(xc),k(K0),k(Ba),k(Es),k(za),k(Ds),k(Mc),k(nh),k($a),k(Is),k(Ua),k(Vs),k(Fc),k(oh),k(Nu)),it(fi,J),ee(y,J),ee(V,J),ee(q,J),ee(z,J),ee(W,J),ee(N,J),ee(ie,J),ee(ae,J),ee(Me,J),ee(Ne,J),ee(H,J),ee(mt,J),ee(Qe,J),ee(be,J),ee(yt,J),ee(We,J),ee(xe,J),ee(Xe,J),ee(Ia,J),ee(Va,J),ee(La,J),ee(qa,J),ee(Ra,J),ee(Oa,J),rh=!1,ut(q2)}}}function sI(t){let e,n,i,s=S.ui.settings.sfxmultiplier+"",o,r,a,l,c,f,u,p,g,v;return{c(){e=h("div"),e.textContent=`${S.ui.settings.sfxvolume}`,n=h("input"),i=h("div"),o=T(s),r=h("br"),a=h("small"),a.textContent=`${S.ui.settings.multiplierdesc}`,l=h("input"),c=h("div"),c.textContent=`${S.ui.settings.musicvolume}`,f=h("input"),u=h("div"),u.textContent=`${S.ui.settings.ambiencevolume}`,p=h("input"),m(n,"type","range"),m(a,"class","textgrey"),m(l,"type","range"),m(f,"type","range"),m(p,"type","range")},m(_,b){x(_,e,b),x(_,n,b),Ge(n,t[14]),x(_,i,b),d(i,o),d(i,r),d(i,a),x(_,l,b),Ge(l,t[15]),x(_,c,b),x(_,f,b),Ge(f,t[16]),x(_,u,b),x(_,p,b),Ge(p,t[17]),g||(v=[Q(n,"change",t[48]),Q(n,"input",t[48]),Q(l,"change",t[49]),Q(l,"input",t[49]),Q(f,"change",t[50]),Q(f,"input",t[50]),Q(p,"change",t[51]),Q(p,"input",t[51])],g=!0)},p(_,b){b[0]&16384&&Ge(n,_[14]),b[0]&32768&&Ge(l,_[15]),b[0]&65536&&Ge(f,_[16]),b[0]&131072&&Ge(p,_[17])},i:ce,o:ce,d(_){_&&(k(e),k(n),k(i),k(l),k(c),k(f),k(u),k(p)),g=!1,ut(v)}}}function oI(t){let e,n,i,s=S.ui.settings.mousesensitivity+"",o,r,a,l=t[11].toFixed(2)+"",c,f,u,p,g,v,_,b,y,w,C,A,M,F=S.ui.settings.skillbarslots+"",V,L,q,R,z,E,W,j,N,U,ie,re,ae,ue,Me,me,Ne,De,Fe,_e,H,qe,Oe,He;p=new zt({props:{store:im}}),v=new zt({props:{store:sm}}),b=new zt({props:{store:om}}),w=new zt({props:{store:rm}}),ie=new zt({props:{store:am}});let Ye=pe(t[3]),Ze=[];for(let ve=0;ve<Ye.length;ve+=1)Ze[ve]=t6(XM(t,Ye,ve));return{c(){e=h("div"),e.textContent=`${S.ui.settings.camera}`,n=h("div"),i=h("div"),o=T(s),r=Ue(),a=h("span"),c=T(l),f=h("input"),u=h("div"),u.textContent=`${S.ui.settings.invertmousex}`,te(p.$$.fragment),g=h("div"),g.textContent=`${S.ui.settings.invertmousey}`,te(v.$$.fragment),_=h("div"),_.textContent=`${S.ui.settings.lockedcamera}`,te(b.$$.fragment),y=h("div"),y.textContent=`${S.ui.settings.pointerlock}`,te(w.$$.fragment),C=h("div"),C.textContent=`${S.ui.settings.skillbar}`,A=h("div"),M=h("div"),V=T(F),L=Ue(),q=h("span"),R=T(t[12]),z=h("br"),E=h("small"),E.textContent=`${S.ui.settings.reload}`,W=h("input"),j=h("div"),j.textContent="Targeting",N=h("div"),U=h("div"),U.textContent="Target Next Friendly: Allow Non-Partied",te(ie.$$.fragment),re=h("div"),ae=T("Target Next Friendly: Cycle Size "),ue=h("span"),Me=T(t[13]),me=h("input"),Ne=h("div"),Ne.textContent=`${S.ui.settings.keybindings}`,De=h("div"),Fe=h("small"),Fe.textContent=`${S.ui.settings.reload}`,_e=h("small"),_e.textContent=`${S.ui.settings.bindingreset}`;for(let ve=0;ve<Ze.length;ve+=1)Ze[ve].c();H=ge(),m(e,"class","textprimary"),m(a,"class","textgrey"),m(f,"type","range"),m(f,"step","0.05"),m(f,"min","0.1"),m(f,"max","3"),m(C,"class","textprimary"),m(q,"class","textgrey"),m(E,"class","textgrey"),m(W,"type","range"),m(W,"min","10"),m(W,"max","24"),m(j,"class","textprimary"),m(ue,"class","textgrey"),m(me,"type","range"),m(me,"min","1"),m(me,"max","10"),m(Ne,"class","textprimary"),m(Fe,"class","textgrey"),m(_e,"class","textprimary")},m(ve,le){x(ve,e,le),x(ve,n,le),x(ve,i,le),d(i,o),d(i,r),d(i,a),d(a,c),x(ve,f,le),Ge(f,t[11]),x(ve,u,le),K(p,ve,le),x(ve,g,le),K(v,ve,le),x(ve,_,le),K(b,ve,le),x(ve,y,le),K(w,ve,le),x(ve,C,le),x(ve,A,le),x(ve,M,le),d(M,V),d(M,L),d(M,q),d(q,R),d(M,z),d(M,E),x(ve,W,le),Ge(W,t[12]),x(ve,j,le),x(ve,N,le),x(ve,U,le),K(ie,ve,le),x(ve,re,le),d(re,ae),d(re,ue),d(ue,Me),x(ve,me,le),Ge(me,t[13]),x(ve,Ne,le),x(ve,De,le),x(ve,Fe,le),x(ve,_e,le);for(let ze=0;ze<Ze.length;ze+=1)Ze[ze]&&Ze[ze].m(ve,le);x(ve,H,le),qe=!0,Oe||(He=[Q(f,"change",t[43]),Q(f,"input",t[43]),Q(W,"change",t[44]),Q(W,"input",t[44]),Q(W,"change",t[34]),Q(me,"change",t[45]),Q(me,"input",t[45])],Oe=!0)},p(ve,le){if((!qe||le[0]&2048)&&l!==(l=ve[11].toFixed(2)+"")&&G(c,l),le[0]&2048&&Ge(f,ve[11]),(!qe||le[0]&4096)&&G(R,ve[12]),le[0]&4096&&Ge(W,ve[12]),(!qe||le[0]&8192)&&G(Me,ve[13]),le[0]&8192&&Ge(me,ve[13]),le[0]&8|le[1]&16){Ye=pe(ve[3]);let ze;for(ze=0;ze<Ye.length;ze+=1){let Z=XM(ve,Ye,ze);Ze[ze]?Ze[ze].p(Z,le):(Ze[ze]=t6(Z),Ze[ze].c(),Ze[ze].m(H.parentNode,H))}for(;ze<Ze.length;ze+=1)Ze[ze].d(1);Ze.length=Ye.length}},i(ve){qe||(P(p.$$.fragment,ve),P(v.$$.fragment,ve),P(b.$$.fragment,ve),P(w.$$.fragment,ve),P(ie.$$.fragment,ve),qe=!0)},o(ve){I(p.$$.fragment,ve),I(v.$$.fragment,ve),I(b.$$.fragment,ve),I(w.$$.fragment,ve),I(ie.$$.fragment,ve),qe=!1},d(ve){ve&&(k(e),k(n),k(i),k(f),k(u),k(g),k(_),k(y),k(C),k(A),k(M),k(W),k(j),k(N),k(U),k(re),k(me),k(Ne),k(De),k(Fe),k(_e),k(H)),ee(p,ve),ee(v,ve),ee(b,ve),ee(w,ve),ee(ie,ve),it(Ze,ve),Oe=!1,ut(He)}}}function rI(t){let e,n,i,s,o,r=S.ui.settings.fov+"",a,l,c,f,u,p,g=S.ui.settings.anisotropy+"",v,_,b,y,w,C=S.ui.settings.grass+"",A,M,F,V,L,q,R,z,E,W=S.ui.settings.disableoffscreen+"",j,N,U,ie,re,ae,ue,Me,me,Ne,De,Fe=S.ui.settings.shadows+"",_e,H,qe,Oe,He,Ye=S.ui.settings.shadowresolution+"",Ze,ve,le,ze,Z,X,$;return q=new zt({props:{store:Ap}}),z=new zt({props:{store:Ep}}),ie=new zt({props:{store:Pp}}),ae=new zt({props:{store:Dp}}),Me=new zt({props:{cb:t[34],store:Ip}}),Oe=new zt({props:{cb:t[34],store:Tp}}),{c(){e=h("div"),e.textContent=`${S.ui.settings.resolution}`,n=h("input"),i=h("div"),i.textContent=`${S.ui.settings.viewrange}`,s=h("input"),o=h("div"),a=T(r),l=Ue(),c=h("span"),f=T(t[7]),u=h("input"),p=h("div"),v=T(g),_=h("br"),b=h("small"),b.textContent=`${S.ui.settings.reload}`,y=h("input"),w=h("div"),A=T(C),M=h("br"),F=h("small"),F.textContent=`${S.ui.settings.reload}`,V=h("input"),L=h("div"),L.textContent=`${S.ui.settings.fxaa}`,te(q.$$.fragment),R=h("div"),R.textContent=`${S.ui.settings.bloom}`,te(z.$$.fragment),E=h("div"),j=T(W),N=h("br"),U=h("small"),U.textContent=`${S.ui.settings.offscreendesc}`,te(ie.$$.fragment),re=h("div"),re.textContent=`${S.ui.settings.particles}`,te(ae.$$.fragment),ue=h("div"),ue.textContent=`${S.ui.settings.fogpattern}`,te(Me.$$.fragment),me=h("div"),me.textContent=`${S.ui.settings.shadows}`,Ne=h("div"),De=h("div"),_e=T(Fe),H=h("br"),qe=h("small"),qe.textContent=`${S.ui.settings.reload}`,te(Oe.$$.fragment),He=h("div"),Ze=T(Ye),ve=h("br"),le=h("small"),le.textContent=`${S.ui.settings.reload}`,ze=h("input"),m(n,"type","range"),m(n,"min","30"),m(n,"step","10"),m(s,"type","range"),m(s,"min","30"),m(c,"class","textgrey"),m(u,"type","range"),m(u,"min","50"),m(u,"max","100"),m(b,"class","textgrey"),m(y,"type","range"),m(y,"min","0"),m(y,"max","4"),m(F,"class","textgrey"),m(V,"type","range"),m(V,"min","0"),m(V,"max","100"),m(U,"class","textgrey"),m(me,"class","textprimary"),m(qe,"class","textgrey"),m(le,"class","textgrey"),m(ze,"type","range"),m(ze,"min","0"),m(ze,"max","3")},m(fe,je){x(fe,e,je),x(fe,n,je),Ge(n,t[5]),x(fe,i,je),x(fe,s,je),Ge(s,t[6]),x(fe,o,je),d(o,a),d(o,l),d(o,c),d(c,f),x(fe,u,je),Ge(u,t[7]),x(fe,p,je),d(p,v),d(p,_),d(p,b),x(fe,y,je),Ge(y,t[8]),x(fe,w,je),d(w,A),d(w,M),d(w,F),x(fe,V,je),Ge(V,t[9]),x(fe,L,je),K(q,fe,je),x(fe,R,je),K(z,fe,je),x(fe,E,je),d(E,j),d(E,N),d(E,U),K(ie,fe,je),x(fe,re,je),K(ae,fe,je),x(fe,ue,je),K(Me,fe,je),x(fe,me,je),x(fe,Ne,je),x(fe,De,je),d(De,_e),d(De,H),d(De,qe),K(Oe,fe,je),x(fe,He,je),d(He,Ze),d(He,ve),d(He,le),x(fe,ze,je),Ge(ze,t[10]),Z=!0,X||($=[Q(n,"change",t[37]),Q(n,"input",t[37]),Q(s,"change",t[38]),Q(s,"input",t[38]),Q(u,"change",t[39]),Q(u,"input",t[39]),Q(y,"change",t[40]),Q(y,"input",t[40]),Q(y,"change",t[34]),Q(V,"change",t[41]),Q(V,"input",t[41]),Q(V,"change",t[34]),Q(ze,"change",t[42]),Q(ze,"input",t[42]),Q(ze,"change",t[34])],X=!0)},p(fe,je){je[0]&32&&Ge(n,fe[5]),je[0]&64&&Ge(s,fe[6]),(!Z||je[0]&128)&&G(f,fe[7]),je[0]&128&&Ge(u,fe[7]),je[0]&256&&Ge(y,fe[8]),je[0]&512&&Ge(V,fe[9]),je[0]&1024&&Ge(ze,fe[10])},i(fe){Z||(P(q.$$.fragment,fe),P(z.$$.fragment,fe),P(ie.$$.fragment,fe),P(ae.$$.fragment,fe),P(Me.$$.fragment,fe),P(Oe.$$.fragment,fe),Z=!0)},o(fe){I(q.$$.fragment,fe),I(z.$$.fragment,fe),I(ie.$$.fragment,fe),I(ae.$$.fragment,fe),I(Me.$$.fragment,fe),I(Oe.$$.fragment,fe),Z=!1},d(fe){fe&&(k(e),k(n),k(i),k(s),k(o),k(u),k(p),k(y),k(w),k(V),k(L),k(R),k(E),k(re),k(ue),k(me),k(Ne),k(De),k(He),k(ze)),ee(q,fe),ee(z,fe),ee(ie,fe),ee(ae,fe),ee(Me,fe),ee(Oe,fe),X=!1,ut($)}}}function KM(t){let e,n,i,s,o;function r(...a){return t[67](t[78],...a)}return{c(){e=h("div"),e.textContent=`${t[76]}`,n=h("div"),m(n,"class",i="btn checkbox "+(t[31][t[78]]?"active":""))},m(a,l){x(a,e,l),x(a,n,l),s||(o=Q(n,"click",r),s=!0)},p(a,l){t=a,l[1]&1&&i!==(i="btn checkbox "+(t[31][t[78]]?"active":""))&&m(n,"class",i)},d(a){a&&(k(e),k(n)),s=!1,o()}}}function e6(t){let e,n=t[73].name+"",i,s;return{c(){e=h("option"),i=T(n),e.__value=s=t[73].val,Ge(e,e.__value)},m(o,r){x(o,e,r),d(e,i)},p:ce,d(o){o&&k(e)}}}function t6(t){let e,n=t[70].name+"",i,s,o,r;function a(){t[46].call(s,t[70])}function l(...c){return t[47](t[70],...c)}return{c(){e=h("div"),i=T(n),s=h("input"),m(s,"type","text")},m(c,f){x(c,e,f),d(e,i),x(c,s,f),Ge(s,t[0].current[t[70].kb]),o||(r=[Q(s,"input",a),Q(s,"change",l)],o=!0)},p(c,f){t=c,f[0]&8&&n!==(n=t[70].name+"")&&G(i,n),f[0]&8&&s.value!==t[0].current[t[70].kb]&&Ge(s,t[0].current[t[70].kb])},d(c){c&&(k(e),k(s)),o=!1,ut(r)}}}function aI(t){let e,n,i,s,o=t[1].name+"",r,a,l,c,f,u=pe(t[32]),p=[];for(let b=0;b<u.length;b+=1)p[b]=JM(QM(t,u,b));let g=[rI,oI,sI,iI,nI],v=[];function _(b,y){return b[1].id=="gfx"?0:b[1].id=="controls"?1:b[1].id=="audio"?2:b[1].id=="ui"?3:b[1].id=="chat"?4:-1}return~(l=_(t,[-1,-1,-1]))&&(c=v[l]=g[l](t)),{c(){e=h("div"),n=h("div");for(let b=0;b<p.length;b+=1)p[b].c();i=h("div"),s=h("h3"),r=T(o),a=h("div"),c&&c.c(),m(s,"class","textprimary"),m(a,"class","settings svelte-ntyx09"),m(i,"class","menu panel-black scrollbar svelte-ntyx09"),m(e,"class","divide svelte-ntyx09")},m(b,y){x(b,e,y),d(e,n);for(let w=0;w<p.length;w+=1)p[w]&&p[w].m(n,null);d(e,i),d(i,s),d(s,r),d(i,a),~l&&v[l].m(a,null),f=!0},p(b,y){if(y[0]&2|y[1]&2){u=pe(b[32]);let C;for(C=0;C<u.length;C+=1){let A=QM(b,u,C);p[C]?p[C].p(A,y):(p[C]=JM(A),p[C].c(),p[C].m(n,null))}for(;C<p.length;C+=1)p[C].d(1);p.length=u.length}(!f||y[0]&2)&&o!==(o=b[1].name+"")&&G(r,o);let w=l;l=_(b,y),l===w?~l&&v[l].p(b,y):(c&&(Te(),I(v[w],1,1,()=>{v[w]=null}),Ee()),~l?(c=v[l],c?c.p(b,y):(c=v[l]=g[l](b),c.c()),P(c,1),c.m(a,null)):c=null)},i(b){f||(P(c),f=!0)},o(b){I(c),f=!1},d(b){b&&k(e),it(p,b),~l&&v[l].d()}}}function lI(t){let e,n,i=t[4]&&ZM(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,o){s[4]?i?(i.p(s,o),o[0]&16&&P(i,1)):(i=ZM(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function cI(t,e,n){let i,s,o,r,a,l,c,f,u,p,g,v,_,b,y,w,C,A,M,F,V,L,q,R,z,E,W,j;se(t,Gr,Le=>n(4,i=Le)),se(t,zr,Le=>n(5,s=Le)),se(t,Rr,Le=>n(6,o=Le)),se(t,Br,Le=>n(7,r=Le)),se(t,Xc,Le=>n(8,a=Le)),se(t,Hc,Le=>n(9,l=Le)),se(t,Yc,Le=>n(10,c=Le)),se(t,df,Le=>n(11,f=Le)),se(t,Qr,Le=>n(12,u=Le)),se(t,hf,Le=>n(13,p=Le)),se(t,$r,Le=>n(14,g=Le)),se(t,Ur,Le=>n(15,v=Le)),se(t,Zc,Le=>n(16,_=Le)),se(t,Qc,Le=>n(17,b=Le)),se(t,Or,Le=>n(18,y=Le)),se(t,sf,Le=>n(19,w=Le)),se(t,af,Le=>n(20,C=Le)),se(t,rf,Le=>n(21,A=Le)),se(t,cf,Le=>n(22,M=Le)),se(t,ff,Le=>n(23,F=Le)),se(t,uf,Le=>n(24,V=Le)),se(t,pf,Le=>n(25,L=Le)),se(t,Xr,Le=>n(26,q=Le)),se(t,lf,Le=>n(27,R=Le)),se(t,Wr,Le=>n(28,z=Le)),se(t,Nr,Le=>n(29,E=Le)),se(t,jr,Le=>n(30,W=Le)),se(t,nf,Le=>n(31,j=Le));let N=[{id:"ui",name:S.ui.settings.interface},{id:"gfx",name:S.ui.settings.graphics},{id:"controls",name:S.ui.settings.controls},{id:"chat",name:S.ui.settings.chat},{id:"audio",name:S.ui.settings.audio}],U=N[0],ie=[{val:"en",name:"English"},{val:"de",name:"German"},{val:"ru",name:"Russian"},{val:"zh",name:"Chinese"},{val:"pt",name:"Portugese"},{val:"es",name:"Spanish"},{val:"fr",name:"French"},{val:"ro",name:"Romanian"},{val:"it",name:"Italian"},{val:"nl",name:"Dutch"},{val:"vi",name:"Vietnamese"},{val:"hu",name:"Hungarian"},{val:"ro",name:"Romanian"},{val:"cs",name:"Czech"},{val:"pl",name:"Polish"}],re=!1,ae=()=>{n(2,re=!0)},ue=(Le,Ct)=>{Ct.set(Le===""?void 0:Le),n(2,re=!0)},Me=["Forward","Left","Back","Right","TurnLeft","TurnRight","Map","Skills","Character","Inventory","Clan","Pvp","Party","NextTarget","NextParty","Untarget"],me=["Forward","Left","Back","Right","Turn Left","Turn Right","Map","Skills","Character","Inventory","Clan","Pvp","Party","Target Next Enemy","Target Next Friendly","Untarget"];for(let Le=1;Le<25;++Le)Me.push("Skillbar"+Le);Me=Me.map((Le,Ct)=>({name:me[Ct]||Le,kb:"kb"+Le,setting:Ns["kb"+Le]}));let Ne=(Le,Ct)=>{n(1,U=Le)};function De(){s=jt(this.value),zr.set(s)}function Fe(){o=jt(this.value),Rr.set(o)}function _e(){r=jt(this.value),Br.set(r)}function H(){a=jt(this.value),Xc.set(a)}function qe(){l=jt(this.value),Hc.set(l)}function Oe(){c=jt(this.value),Yc.set(c)}function He(){f=jt(this.value),df.set(f)}function Ye(){u=jt(this.value),Qr.set(u)}function Ze(){p=jt(this.value),hf.set(p)}function ve(Le){oe[Le.kb]=this.value,n(0,Ns)}let le=(Le,Ct)=>{ue(oe[Le.kb],Le.setting)};function ze(){g=jt(this.value),$r.set(g)}function Z(){v=jt(this.value),Ur.set(v)}function X(){_=jt(this.value),Zc.set(_)}function $(){b=jt(this.value),Qc.set(b)}function fe(){y=ki(this),Or.set(y),n(33,ie)}let je=Le=>Os.set(0),Ve=Le=>Os.set(Pi.length);function ye(){w=jt(this.value),sf.set(w)}function Re(){C=jt(this.value),af.set(C)}function Be(){A=this.value,rf.set(A)}function mt(){M=jt(this.value),cf.set(M)}function wt(){F=jt(this.value),ff.set(F)}function Qe(){V=jt(this.value),uf.set(V)}function Et(){L=jt(this.value),pf.set(L)}function be(){q=jt(this.value),Xr.set(q)}function Je(){R=jt(this.value),lf.set(R)}function yt(){z=jt(this.value),Wr.set(z)}function St(){E=jt(this.value),Nr.set(E)}function Ae(){W=jt(this.value),jr.set(W)}return[Ns,U,re,Me,i,s,o,r,a,l,c,f,u,p,g,v,_,b,y,w,C,A,M,F,V,L,q,R,z,E,W,j,N,ie,ae,ue,Ne,De,Fe,_e,H,qe,Oe,He,Ye,Ze,ve,le,ze,Z,X,$,fe,je,Ve,ye,Re,Be,mt,wt,Qe,Et,be,Je,yt,St,Ae,(Le,Ct)=>nt(nf,j[Le]=j[Le]?0:1,j),()=>{nt(Gr,i=!1,i),re&&window.location.reload()}]}var Pg=class extends we{constructor(e){super(),Ce(this,e,cI,lI,$e,{},null,[-1,-1,-1])}},n6=Pg;var i6=(t,e,n,i,s,o)=>Tg(t,s,o)&&Zl(i,s,o)&&Dg(n,s,o)&&Ig(e,s,o),Tg=(t,e,n)=>rn[e+n]===void 0?(console.log("Error: Item can EQUIP type not found: "+e+n),!1):t>=rn[e+n].level,Zl=(t,e,n)=>rn[e+n].class===void 0||t===rn[e+n].class,fI=(t,e)=>t+Pt.get(e).skillpoints,Eg=t=>t.reduce(fI,0),Dg=(t,e,n)=>e!=="book"||tu(t,rn[e+n].skillid)===rn[e+n].skilllevel;var tu=(t,e)=>t.reduce((n,i)=>n+(i===e),0);var Ig=(t,e,n)=>rn[e+n].requiredSkill===void 0||t.indexOf(rn[e+n].requiredSkill)>0;var s6=(t,e,n)=>rn[e+n].buyElo===void 0||t>=rn[e+n].buyElo;function o6(t,e,n){let i=t.slice();return i[39]=e[n],i}function r6(t,e,n){let i=t.slice();return i[39]=e[n],i}function a6(t,e,n){let i=t.slice();return i[44]=e[n],i[46]=n,i}function l6(t,e,n){let i=t.slice();return i[47]=e[n],i}function c6(t){let e,n,i;return n=new Ot({props:{title:S.ui.headers.skills,cog:!0,icon:"book",$$slots:{default:[MI]},$$scope:{ctx:t}}}),n.$on("close",t[30]),n.$on("cog",t[31]),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","absCentered container svelte-12nd8ce")},m(s,o){x(s,e,o),K(n,e,null),t[32](e),i=!0},p(s,o){let r={};o[0]&6143|o[1]&524288&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n),t[32](null)}}}function f6(t){let e,n;function i(r,a){return r[6]===void 0?pI:uI}let s=i(t,[-1,-1]),o=s(t);return{c(){e=h("div"),o.c(),m(e,"class",n="panel-black "+(t[6]===void 0?"bar-top-config":"bar-top-save")+" svelte-12nd8ce")},m(r,a){x(r,e,a),o.m(e,null)},p(r,a){s===(s=i(r,a))&&o?o.p(r,a):(o.d(1),o=s(r),o&&(o.c(),o.m(e,null))),a[0]&64&&n!==(n="panel-black "+(r[6]===void 0?"bar-top-config":"bar-top-save")+" svelte-12nd8ce")&&m(e,"class",n)},d(r){r&&k(e),o.d()}}}function uI(t){let e,n,i,s,o,r,a;return{c(){e=h("div"),n=h("input"),i=h("div"),i.textContent="Save",s=h("div"),s.textContent="Cancel",o=h("div"),m(n,"placeholder","Enter Preset Name"),m(n,"maxlength","25"),m(i,"class","btn green"),m(s,"class","btn orange")},m(l,c){x(l,e,c),x(l,n,c),Ge(n,t[6]),x(l,i,c),x(l,s,c),x(l,o,c),r||(a=[Q(n,"input",t[25]),Q(i,"click",t[15]),Q(s,"click",t[26])],r=!0)},p(l,c){c[0]&64&&n.value!==l[6]&&Ge(n,l[6])},d(l){l&&(k(e),k(n),k(i),k(s),k(o)),r=!1,ut(a)}}}function pI(t){let e,n,i,s,o,r,a,l,c,f,u,p,g=pe(t[10].filter(t[21])),v=[];for(let b=0;b<g.length;b+=1)v[b]=u6(l6(t,g,b));let _=t[7]===void 0&&p6(t);return{c(){e=h("span"),e.textContent="Preset:",n=h("select");for(let b=0;b<v.length;b+=1)v[b].c();i=ge(),_&&_.c(),o=h("div"),r=T("Save"),l=h("div"),c=T("Delete"),m(e,"class","btn textprimary"),m(n,"class",s="btn grey "+(t[10].filter(t[22]).length===0?"disabled":"")),t[7]===void 0&&mn(()=>t[23].call(n)),m(o,"class",a="btn grey "+(t[5]?"":"disabled")),m(l,"class",f="btn grey "+(t[7]!==void 0?"":"disabled"))},m(b,y){x(b,e,y),x(b,n,y);for(let w=0;w<v.length;w+=1)v[w]&&v[w].m(n,null);d(n,i),_&&_.m(n,null),xn(n,t[7],!0),x(b,o,y),d(o,r),x(b,l,y),d(l,c),u||(p=[Q(n,"change",t[23]),Q(n,"change",t[16]),Q(o,"click",t[24]),Q(l,"click",t[17])],u=!0)},p(b,y){if(y[0]&1024){g=pe(b[10].filter(b[21]));let w;for(w=0;w<g.length;w+=1){let C=l6(b,g,w);v[w]?v[w].p(C,y):(v[w]=u6(C),v[w].c(),v[w].m(n,i))}for(;w<v.length;w+=1)v[w].d(1);v.length=g.length}b[7]===void 0?_?_.p(b,y):(_=p6(b),_.c(),_.m(n,null)):_&&(_.d(1),_=null),y[0]&1024&&s!==(s="btn grey "+(b[10].filter(b[22]).length===0?"disabled":""))&&m(n,"class",s),y[0]&1152&&xn(n,b[7]),y[0]&32&&a!==(a="btn grey "+(b[5]?"":"disabled"))&&m(o,"class",a),y[0]&1152&&f!==(f="btn grey "+(b[7]!==void 0?"":"disabled"))&&m(l,"class",f)},d(b){b&&(k(e),k(n),k(o),k(l)),it(v,b),_&&_.d(),u=!1,ut(p)}}}function u6(t){let e,n=t[47].name+"",i,s;return{c(){e=h("option"),i=T(n),e.__value=s=t[47].name,Ge(e,e.__value)},m(o,r){x(o,e,r),d(e,i)},p(o,r){r[0]&1024&&n!==(n=o[47].name+"")&&G(i,n),r[0]&1024&&s!==(s=o[47].name)&&(e.__value=s,Ge(e,e.__value))},d(o){o&&k(e)}}}function p6(t){let e,n;return{c(){e=h("option"),n=T("No Preset"),e.disabled=!0,e.selected=!0,e.__value=void 0,Ge(e,e.__value)},m(i,s){x(i,e,s),d(e,n)},p:ce,d(i){i&&k(e)}}}function mI(t){let e,n;return e=new ga({props:{level:Math.max(1,t[39].level),skill:Pt.get(t[39].id)}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&8&&(o.level=Math.max(1,i[39].level)),s[0]&8&&(o.skill=Pt.get(i[39].id)),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function dI(t){let e;return{c(){e=h("div"),e.textContent=`${S.ui.default}`,m(e,"class","textgrey")},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function hI(t){let e,n=pe(Array(Pt.get(t[39].id).skilllevels)),i=[];for(let s=0;s<n.length;s+=1)i[s]=m6(a6(t,n,s));return{c(){e=h("div");for(let s=0;s<i.length;s+=1)i[s].c();m(e,"class","skillpoints svelte-12nd8ce")},m(s,o){x(s,e,o);for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(e,null)},p(s,o){if(o[0]&24){n=pe(Array(Pt.get(s[39].id).skilllevels));let r;for(r=0;r<n.length;r+=1){let a=a6(s,n,r);i[r]?i[r].p(a,o):(i[r]=m6(a),i[r].c(),i[r].m(e,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(s){s&&k(e),it(i,s)}}}function gI(t){let e;return{c(){e=h("div"),m(e,"class","border grey")},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function vI(t){let e;return{c(){e=h("div"),m(e,"class","btn incbtn grey svelte-12nd8ce")},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function _I(t){let e,n;return{c(){e=h("div"),m(e,"class",n="btn incbtn "+(t[4]?"green":"white")+" svelte-12nd8ce")},m(i,s){x(i,e,s)},p(i,s){s[0]&16&&n!==(n="btn incbtn "+(i[4]?"green":"white")+" svelte-12nd8ce")&&m(e,"class",n)},d(i){i&&k(e)}}}function m6(t){let e;function n(o,r){return o[46]+1<=o[39].level?_I:o[46]+1<=o[39].learned?vI:gI}let i=n(t,[-1,-1]),s=i(t);return{c(){s.c(),e=ge()},m(o,r){s.m(o,r),x(o,e,r)},p(o,r){i===(i=n(o,r))&&s?s.p(o,r):(s.d(1),s=i(o),s&&(s.c(),s.m(e.parentNode,e)))},d(o){o&&k(e),s.d(o)}}}function bI(t){let e;return{c(){e=h("div"),m(e,"class","name svelte-12nd8ce")},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function yI(t){let e,n,i,s=t[39].level+"",o;return{c(){e=h("div"),n=T("Lv. "),i=h("span"),o=T(s),m(i,"class","bold textwhite"),m(e,"class","name svelte-12nd8ce")},m(r,a){x(r,e,a),d(e,n),d(e,i),d(i,o)},p(r,a){a[0]&8&&s!==(s=r[39].level+"")&&G(o,s)},d(r){r&&k(e)}}}function d6(t){let e,n,i,s,o,r,a;function l(...p){return t[27](t[39],...p)}function c(p,g){return g[0]&520&&(o=null),o==null&&(o=p[9]>=Pt.get(p[39].id).skillpoints&&p[39].level<Pt.get(p[39].id).skilllevels&&p[39].level<p[39].learned),o?xI:kI}let f=c(t,[-1,-1]),u=f(t);return{c(){e=h("div"),n=h("div"),i=T("-"),u.c(),m(n,"class",s="btn incbtn "+(t[39].level>0?"grey":"black disabled")+" svelte-12nd8ce"),m(e,"class","skillpoints svelte-12nd8ce")},m(p,g){x(p,e,g),d(e,n),d(n,i),u.m(e,null),r||(a=Q(n,"click",l),r=!0)},p(p,g){t=p,g[0]&8&&s!==(s="btn incbtn "+(t[39].level>0?"grey":"black disabled")+" svelte-12nd8ce")&&m(n,"class",s),f===(f=c(t,g))&&u?u.p(t,g):(u.d(1),u=f(t),u&&(u.c(),u.m(e,null)))},d(p){p&&k(e),u.d(),r=!1,a()}}}function kI(t){let e;return{c(){e=h("div"),e.textContent="+",m(e,"class","btn incbtn black disabled svelte-12nd8ce")},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function xI(t){let e,n,i;function s(...o){return t[28](t[39],...o)}return{c(){e=h("div"),e.textContent="+",m(e,"id","tutsetskillpoint"),m(e,"class","btn incbtn green svelte-12nd8ce")},m(o,r){x(o,e,r),n||(i=Q(e,"click",s),n=!0)},p(o,r){t=o},d(o){o&&k(e),n=!1,i()}}}function h6(t){let e,n,i,s,o=S.items.book[t[39].id].name+"",r,a,l,c,f;n=new da({props:{descPos:"left:100%;top:0;",descRoot:t[2],border:"white",data:{},pickable:t[39].pickable,meta:{type:"skill",skill:Pt.get(t[39].id)},css:"slotskill",img:`/data/ui/skills/${t[39].id}.${Gn}?v=8582889`,$$slots:{default:[mI]},$$scope:{ctx:t}}});function u(w,C){return w[39].engineOnly?dI:hI}let p=u(t,[-1,-1]),g=p(t);function v(w,C){return w[39].engineOnly?bI:yI}let _=v(t,[-1,-1]),b=_(t),y=!t[39].engineOnly&&d6(t);return{c(){e=h("div"),te(n.$$.fragment),i=h("div"),s=h("div"),r=T(o),a=Ue(),g.c(),l=h("div"),b.c(),c=ge(),y&&y.c(),m(s,"class","textprimary name svelte-12nd8ce"),m(e,"class","panel-bright skillbox svelte-12nd8ce")},m(w,C){x(w,e,C),K(n,e,null),d(e,i),d(i,s),d(s,r),d(i,a),g.m(i,null),d(e,l),b.m(l,null),d(l,c),y&&y.m(l,null),f=!0},p(w,C){let A={};C[0]&4&&(A.descRoot=w[2]),C[0]&8&&(A.pickable=w[39].pickable),C[0]&8&&(A.meta={type:"skill",skill:Pt.get(w[39].id)}),C[0]&8&&(A.img=`/data/ui/skills/${w[39].id}.${Gn}?v=8582889`),C[0]&8|C[1]&524288&&(A.$$scope={dirty:C,ctx:w}),n.$set(A),(!f||C[0]&8)&&o!==(o=S.items.book[w[39].id].name+"")&&G(r,o),p===(p=u(w,C))&&g?g.p(w,C):(g.d(1),g=p(w),g&&(g.c(),g.m(i,null))),_===(_=v(w,C))&&b?b.p(w,C):(b.d(1),b=_(w),b&&(b.c(),b.m(l,c))),w[39].engineOnly?y&&(y.d(1),y=null):y?y.p(w,C):(y=d6(w),y.c(),y.m(l,null))},i(w){f||(P(n.$$.fragment,w),f=!0)},o(w){I(n.$$.fragment,w),f=!1},d(w){w&&k(e),ee(n),g.d(),b.d(),y&&y.d()}}}function wI(t){let e,n;return e=new ga({props:{level:1,skill:t[39]}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&1&&(o.skill=i[39]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function g6(t){let e,n,i,s,o=S.items.book[t[39].id].name+"",r,a,l=S.ui.learnable+"",c,f,u=t[39].minlevel+"",p,g;return n=new da({props:{descPos:"left:100%;top:0;",descRoot:t[2],border:"grey filtered",data:{},pickable:!1,meta:{type:"skill",skill:t[39]},css:"slotskill",img:`/data/ui/skills/${t[39].id}.${Gn}?v=8582889`,$$slots:{default:[wI]},$$scope:{ctx:t}}}),{c(){e=h("div"),te(n.$$.fragment),i=h("div"),s=h("div"),r=T(o),a=h("div"),c=T(l),f=Ue(),p=T(u),m(s,"class","name svelte-12nd8ce"),m(i,"class","textgrey"),m(e,"class","panel-bright skillbox svelte-12nd8ce")},m(v,_){x(v,e,_),K(n,e,null),d(e,i),d(i,s),d(s,r),d(i,a),d(a,c),d(a,f),d(a,p),g=!0},p(v,_){let b={};_[0]&4&&(b.descRoot=v[2]),_[0]&1&&(b.meta={type:"skill",skill:v[39]}),_[0]&1&&(b.img=`/data/ui/skills/${v[39].id}.${Gn}?v=8582889`),_[0]&1|_[1]&524288&&(b.$$scope={dirty:_,ctx:v}),n.$set(b),(!g||_[0]&1)&&o!==(o=S.items.book[v[39].id].name+"")&&G(r,o),(!g||_[0]&1)&&u!==(u=v[39].minlevel+"")&&G(p,u)},i(v){g||(P(n.$$.fragment,v),g=!0)},o(v){I(n.$$.fragment,v),g=!1},d(v){v&&k(e),ee(n)}}}function MI(t){let e,n,i,s,o,r=(t[1]?t[1]:`${S.ui.stats.array[23]}: ${t[8]}`)+"",a,l,c,f,u,p,g,v,_,b=t[12]&&f6(t),y=pe(t[3]),w=[];for(let V=0;V<y.length;V+=1)w[V]=h6(r6(t,y,V));let C=V=>I(w[V],1,1,()=>{w[V]=null}),A=pe(Array.from(Pt.values()).filter(t[29]).sort(v6)),M=[];for(let V=0;V<A.length;V+=1)M[V]=g6(o6(t,A,V));let F=V=>I(M[V],1,1,()=>{M[V]=null});return{c(){e=h("div"),b&&b.c(),n=h("div");for(let V=0;V<w.length;V+=1)w[V].c();i=ge();for(let V=0;V<M.length;V+=1)M[V].c();s=h("div"),o=h("span"),a=T(r),c=h("div"),f=T("Activate Skills"),p=h("span"),m(n,"id","skilllist"),m(n,"class","scrollbar panel-black skilllist svelte-12nd8ce"),m(o,"class",l=t[1]?"textred":t[8]>0?"textprimary":"textgrey"),m(c,"id","tutapplyskills"),m(c,"class",u="btn "+(t[4]?"green":"grey disabled")),m(s,"class","panel-black bar-bot svelte-12nd8ce"),m(e,"class","flexer svelte-12nd8ce")},m(V,L){x(V,e,L),b&&b.m(e,null),d(e,n);for(let q=0;q<w.length;q+=1)w[q]&&w[q].m(n,null);d(n,i);for(let q=0;q<M.length;q+=1)M[q]&&M[q].m(n,null);d(e,s),d(s,o),d(o,a),d(s,c),d(c,f),d(s,p),g=!0,v||(_=Q(c,"click",t[13]),v=!0)},p(V,L){if(V[12]?b?b.p(V,L):(b=f6(V),b.c(),b.m(e,n)):b&&(b.d(1),b=null),L[0]&16924){y=pe(V[3]);let q;for(q=0;q<y.length;q+=1){let R=r6(V,y,q);w[q]?(w[q].p(R,L),P(w[q],1)):(w[q]=h6(R),w[q].c(),P(w[q],1),w[q].m(n,i))}for(Te(),q=y.length;q<w.length;q+=1)C(q);Ee()}if(L[0]&5){A=pe(Array.from(Pt.values()).filter(V[29]).sort(v6));let q;for(q=0;q<A.length;q+=1){let R=o6(V,A,q);M[q]?(M[q].p(R,L),P(M[q],1)):(M[q]=g6(R),M[q].c(),P(M[q],1),M[q].m(n,null))}for(Te(),q=A.length;q<M.length;q+=1)F(q);Ee()}(!g||L[0]&258)&&r!==(r=(V[1]?V[1]:`${S.ui.stats.array[23]}: ${V[8]}`)+"")&&G(a,r),(!g||L[0]&258&&l!==(l=V[1]?"textred":V[8]>0?"textprimary":"textgrey"))&&m(o,"class",l),(!g||L[0]&16&&u!==(u="btn "+(V[4]?"green":"grey disabled")))&&m(c,"class",u)},i(V){if(!g){for(let L=0;L<y.length;L+=1)P(w[L]);for(let L=0;L<A.length;L+=1)P(M[L]);g=!0}},o(V){w=w.filter(Boolean);for(let L=0;L<w.length;L+=1)I(w[L]);M=M.filter(Boolean);for(let L=0;L<M.length;L+=1)I(M[L]);g=!1},d(V){V&&k(e),b&&b.d(),it(w,V),it(M,V),v=!1,_()}}}function FI(t){let e,n,i=t[11]&&c6(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,o){s[11]?i?(i.p(s,o),o[0]&2048&&P(i,1)):(i=c6(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}var v6=(t,e)=>t.minlevel-e.minlevel;function CI(t,e,n){let i,s,o,r,a,l,c,f,u;se(t,Rc,_e=>n(0,o=_e)),se(t,_l,_e=>n(10,r=_e)),se(t,Uo,_e=>n(19,a=_e)),se(t,Bc,_e=>n(1,l=_e)),se(t,Bo,_e=>n(20,c=_e)),se(t,co,_e=>n(11,f=_e)),se(t,mf,_e=>n(12,u=_e));let p,g=_e=>{let H=[];return _e.forEach((qe,Oe)=>{for(let He=0;He<qe.level;++He)H.push(qe.id)}),H},v=()=>{let _e=A.filter(H=>!Pt.get(H)?.engineOnly);xt("skillconfig",_e),n(4,b=!1),nt(Bc,l=void 0,l),tn(28,100)},_=[],b=!1,y=!1,w=(_e,H)=>{n(3,_=[]),_e.forEach((qe,Oe)=>{let He=Pt.get(Oe);_.push({id:Oe,level:qe,minlevel:He.minlevel,learned:H.get(Oe)||0,engineOnly:He.engineOnly,pickable:He.onCast!==void 0})}),H.forEach((qe,Oe)=>{if(!_e.has(Oe)){let He=Pt.get(Oe);_.push({id:Oe,level:0,minlevel:He.minlevel,learned:qe,engineOnly:He.engineOnly,pickable:He.onCast!==void 0})}}),_.sort((qe,Oe)=>qe.id-Oe.id)},C=()=>{M=g(_);let _e=M.filter(H=>!Pt.get(H)?.engineOnly);n(18,F=Eg(_e))},A=[],M=[],F=0,V=(_e,H)=>{_e.level+=H,n(3,_),tn(27,100),L()},L=()=>{A=g(_);let _e=A.filter(He=>!Pt.get(He)?.engineOnly);n(18,F=Eg(_e));let H=A.sort().join(","),qe=M.sort().join(",");n(4,b=A.length&&H!==qe);let Oe=r.find(He=>H===He.skills.sort().join(","));Oe?(n(7,z=Oe.name),n(5,y=!1)):(n(7,z=void 0),n(5,y=!0))},q,R=()=>{q!==void 0&&(_l.update(_e=>(_e=_e.filter(H=>H.name!==q||H.pclass!==D.player.class),_e.push({name:q,skills:g(_),pclass:D.player.class}),_e)),n(7,z=q),n(6,q=void 0),n(5,y=!1))},z,E=_e=>{let H=r.find(qe=>qe.name===z&&qe.pclass===D.player.class);if(H){let qe=new Map;H.skills.forEach(Oe=>{qe.has(Oe)?qe.set(Oe,qe.get(Oe)+1):qe.set(Oe,1)}),w(qe,o),L(),b&&v()}},W=()=>{_l.update(_e=>_e.filter(H=>H.name!==z)),n(7,z=void 0),n(5,y=!0)},j=_e=>_e.pclass===D.player.class,N=_e=>_e.pclass===D.player.class;function U(){z=ki(this),n(7,z)}let ie=_e=>n(6,q="");function re(){q=this.value,n(6,q)}let ae=_e=>n(6,q=void 0),ue=(_e,H)=>V(_e,-1),Me=(_e,H)=>V(_e,1),me=_e=>_e.class===D.player.class&&!_e.engineOnly&&!o.has(_e.id),Ne=()=>{nt(co,f=!1,f)},De=()=>{nt(mf,u=!u,u)};function Fe(_e){Wt[_e?"unshift":"push"](()=>{p=_e,n(2,p)})}return t.$$.update=()=>{t.$$.dirty[0]&1048577&&(w(c,o),C(),L()),t.$$.dirty[0]&2&&l&&n(4,b=!0),t.$$.dirty[0]&786432&&n(9,i=a[24]-F),t.$$.dirty[0]&786432&&n(8,s=a[24]-F)},[o,l,p,_,b,y,q,z,s,i,r,f,u,v,V,R,E,W,F,a,c,j,N,U,ie,re,ae,ue,Me,me,Ne,De,Fe]}var Vg=class extends we{constructor(e){super(),Ce(this,e,CI,FI,$e,{},null,[-1,-1])}},_6=Vg;function b6(t,e,n){let i=t.slice();return i[19]=e[n],i[21]=n,i}function y6(t){let e,n,i=pe(t[1]),s=[];for(let r=0;r<i.length;r+=1)s[r]=x6(b6(t,i,r));let o=null;return i.length||(o=k6(t)),{c(){e=h("div");for(let r=0;r<s.length;r+=1)s[r].c();n=ge(),o&&o.c(),m(e,"class","divider")},m(r,a){x(r,e,a);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(r,a);x(r,n,a),o&&o.m(r,a)},p(r,a){if(a&74){i=pe(r[1]);let l;for(l=0;l<i.length;l+=1){let c=b6(r,i,l);s[l]?s[l].p(c,a):(s[l]=x6(c),s[l].c(),s[l].m(n.parentNode,n))}for(;l<s.length;l+=1)s[l].d(1);s.length=i.length,!i.length&&o?o.p(r,a):i.length?o&&(o.d(1),o=null):(o=k6(r),o.c(),o.m(n.parentNode,n))}},d(r){r&&(k(e),k(n)),it(s,r),o&&o.d(r)}}}function k6(t){let e;return{c(){e=h("div"),e.textContent="No results",m(e,"class","textgrey result svelte-17jb1r5")},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function x6(t){let e,n,i=t[19].name+"",s,o,r=t[19].type+"",a,l,c,f=(t[19].level||1)+"",u,p,g,v;function _(...b){return t[14](t[21],...b)}return{c(){e=h("div"),n=h("span"),s=T(i),o=h("span"),a=T(r),l=h("span"),c=T("Lv. "),u=T(f),m(o,"class","textgrey infocol svelte-17jb1r5"),m(l,"class","infocol svelte-17jb1r5"),m(e,"class",p="result "+(t[21]===t[3]?"sel":"")+" svelte-17jb1r5")},m(b,y){x(b,e,y),d(e,n),d(n,s),d(e,o),d(o,a),d(e,l),d(l,c),d(l,u),g||(v=Q(e,"mousedown",_),g=!0)},p(b,y){t=b,y&2&&i!==(i=t[19].name+"")&&G(s,i),y&2&&r!==(r=t[19].type+"")&&G(a,r),y&2&&f!==(f=(t[19].level||1)+"")&&G(u,f),y&8&&p!==(p="result "+(t[21]===t[3]?"sel":"")+" svelte-17jb1r5")&&m(e,"class",p)},d(b){b&&k(e),g=!1,v()}}}function SI(t){let e,n,i,s,o,r,a,l=t[2]&&y6(t);return{c(){e=h("div"),n=h("div"),i=h("input"),l&&l.c(),m(i,"placeholder",s=S.ui.merchant.itemSearch),m(i,"type","search"),m(n,"class",o="container input "+(t[2]?"focus":"")),m(e,"class","navbtn finder")},m(c,f){x(c,e,f),d(e,n),d(n,i),t[11](i),Ge(i,t[0]),l&&l.m(n,null),r||(a=[Q(i,"input",t[12]),Q(i,"input",t[5]),Q(i,"focus",t[13]),Q(i,"blur",t[7])],r=!0)},p(c,[f]){f&1&&i.value!==c[0]&&Ge(i,c[0]),c[2]?l?l.p(c,f):(l=y6(c),l.c(),l.m(n,null)):l&&(l.d(1),l=null),f&4&&o!==(o="container input "+(c[2]?"focus":""))&&m(n,"class",o)},i:ce,o:ce,d(c){c&&k(e),t[11](null),l&&l.d(),r=!1,ut(a)}}}function AI(t,e,n){let i=Mr(),s=tr.filter(F=>F.level<=45).map(F=>({name:gn(F.type,F.tier),type:F.type,tier:F.tier,level:F.level})),o=()=>{let F=l.toLowerCase();F.length?n(1,f=s.filter(V=>V.type===F||V.name.toLowerCase().includes(F)).slice(0,c)):n(1,f=[]),p>=f.length&&_(f.length-1)},{type:r}=e,{tier:a}=e,{name:l=""}=e,{limit:c=5}=e,f=[],u=!1,p=-1,g,v,_=F=>{n(3,p=F),p>=0?(g=f[p],n(0,l=g.name),n(8,r=g.type),n(9,a=g.tier)):(g=void 0,n(0,l=""),n(8,r="all"),n(9,a="all"))},b=F=>{F.target==v&&((F.keyCode===38||F.keyCode===40)&&f.length?(_(yl(p+(F.keyCode===38?-1:1),f.length)),F.preventDefault()):(F.keyCode==13||F.keyCode==27)&&v.blur())},y=F=>{n(2,u=!1),_(Math.min(Math.max(0,p),f.length-1)),p>=0&&i("finalize")};jn(()=>{document.addEventListener("keydown",b)}),Wn(()=>{document.removeEventListener("keydown",b),n(4,v=void 0)});function w(F){Wt[F?"unshift":"push"](()=>{v=F,n(4,v)})}function C(){l=this.value,n(0,l)}let A=F=>n(2,u=!0),M=(F,V)=>_(F);return t.$$set=F=>{"type"in F&&n(8,r=F.type),"tier"in F&&n(9,a=F.tier),"name"in F&&n(0,l=F.name),"limit"in F&&n(10,c=F.limit)},[l,f,u,p,v,o,_,y,r,a,c,w,C,A,M]}var Lg=class extends we{constructor(e){super(),Ce(this,e,AI,SI,$e,{type:8,tier:9,name:0,limit:10})}},w6=Lg;var M6=t=>9+Math.ceil(t*.001);function F6(t,e,n){let i=t.slice();return i[55]=e[n],i}function C6(t,e,n){let i=t.slice();return i[58]=e[n],i[60]=n,i}function S6(t){let e,n,i;return n=new Ot({props:{title:"Merchant",$$slots:{default:[LI]},$$scope:{ctx:t}}}),n.$on("close",t[50]),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","l-upperLeftModal container svelte-afakdv")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o[0]&2097135|o[1]&1073741824&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function PI(t){let e,n=t[58]+"",i,s,o,r;function a(...l){return t[44](t[58],...l)}return{c(){e=h("div"),i=T(n),m(e,"class",s="choice "+(t[58]==t[6]?"active":"")+" svelte-afakdv")},m(l,c){x(l,e,c),d(e,i),o||(r=Q(e,"click",a),o=!0)},p(l,c){t=l,c[0]&64&&s!==(s="choice "+(t[58]==t[6]?"active":"")+" svelte-afakdv")&&m(e,"class",s)},d(l){l&&k(e),o=!1,r()}}}function TI(t){let e;return{c(){e=h("div"),m(e,"class","divider svelte-afakdv")},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function A6(t){let e;function n(o,r){return o[58]===null?TI:PI}let s=n(t,[-1,-1])(t);return{c(){s.c(),e=ge()},m(o,r){s.m(o,r),x(o,e,r)},p(o,r){s.p(o,r)},d(o){o&&k(e),s.d(o)}}}function P6(t){let e,n,i,s=gn(t[55].temp.type,t[55].temp.tier)+"",o,r,a,l=(t[55].temp.logic.level||1)+"",c,f,u,p=t[55].temp.owner+"",g,v,_=t[27](t[55].temp.auction.getTime())+"",b,y,w,C=t[13]&&t[55].temp.stacks>0?t[55].temp.stacks+" x ":"",A,M,F,V,L,q;n=new bi({props:{shift:t[20],descPos:"right:0;top:0;",descRoot:t[5],pickable:!1,item:t[55]}}),M=new yn({props:{amount:t[13]&&t[55].temp.stacks>0?Math.ceil(t[55].temp.auctionprice/t[55].temp.stacks):t[55].temp.auctionprice}});function R(...z){return t[47](t[55],...z)}return{c(){e=h("div"),te(n.$$.fragment),i=h("span"),o=T(s),a=h("span"),c=T(l),u=h("span"),g=T(p),v=h("span"),b=T(_),y=h("div"),w=h("span"),A=T(C),te(M.$$.fragment),m(i,"class",r="marg text"+Yt(t[55].temp.quality)[0]+" svelte-afakdv"),Pe(i,"margin-left","6px"),m(a,"class",f="marg "+(D.player.level>=t[55].temp.logic.level?"textgreen":"textred")+" svelte-afakdv"),m(u,"class","marg svelte-afakdv"),m(v,"class","marg svelte-afakdv"),m(w,"class","textgreen"),m(y,"class","marg svelte-afakdv"),Pe(y,"text-align","end"),m(e,"class",F="buy "+(t[18]==t[55]?"selected":"")+" item panel-black svelte-afakdv")},m(z,E){x(z,e,E),K(n,e,null),d(e,i),d(i,o),d(e,a),d(a,c),d(e,u),d(u,g),d(e,v),d(v,b),d(e,y),d(y,w),d(w,A),K(M,y,null),V=!0,L||(q=Q(e,"click",R),L=!0)},p(z,E){t=z;let W={};E[0]&1048576&&(W.shift=t[20]),E[0]&32&&(W.descRoot=t[5]),E[0]&131072&&(W.item=t[55]),n.$set(W),(!V||E[0]&131072)&&s!==(s=gn(t[55].temp.type,t[55].temp.tier)+"")&&G(o,s),(!V||E[0]&131072&&r!==(r="marg text"+Yt(t[55].temp.quality)[0]+" svelte-afakdv"))&&m(i,"class",r),(!V||E[0]&131072)&&l!==(l=(t[55].temp.logic.level||1)+"")&&G(c,l),(!V||E[0]&131072&&f!==(f="marg "+(D.player.level>=t[55].temp.logic.level?"textgreen":"textred")+" svelte-afakdv"))&&m(a,"class",f),(!V||E[0]&131072)&&p!==(p=t[55].temp.owner+"")&&G(g,p),(!V||E[0]&131072)&&_!==(_=t[27](t[55].temp.auction.getTime())+"")&&G(b,_),(!V||E[0]&139264)&&C!==(C=t[13]&&t[55].temp.stacks>0?t[55].temp.stacks+" x ":"")&&G(A,C);let j={};E[0]&139264&&(j.amount=t[13]&&t[55].temp.stacks>0?Math.ceil(t[55].temp.auctionprice/t[55].temp.stacks):t[55].temp.auctionprice),M.$set(j),(!V||E[0]&393216&&F!==(F="buy "+(t[18]==t[55]?"selected":"")+" item panel-black svelte-afakdv"))&&m(e,"class",F)},i(z){V||(P(n.$$.fragment,z),P(M.$$.fragment,z),V=!0)},o(z){I(n.$$.fragment,z),I(M.$$.fragment,z),V=!1},d(z){z&&k(e),ee(n),ee(M),L=!1,q()}}}function EI(t){let e,n,i,s,o=[VI,II],r=[];function a(l,c){return l[18].temp.owner!==D.player.name?0:1}return n=a(t,[-1,-1]),i=r[n]=o[n](t),{c(){e=h("section"),i.c(),m(e,"class","confirm panel-black svelte-afakdv")},m(l,c){x(l,e,c),r[n].m(e,null),s=!0},p(l,c){let f=n;n=a(l,c),n===f?r[n].p(l,c):(Te(),I(r[f],1,1,()=>{r[f]=null}),Ee(),i=r[n],i?i.p(l,c):(i=r[n]=o[n](l),i.c()),P(i,1),i.m(e,null))},i(l){s||(P(i),s=!0)},o(l){I(i),s=!1},d(l){l&&k(e),r[n].d()}}}function DI(t){let e,n,i,s=(t[3]?gn(t[3].type,t[3].tier):S.ui.merchant.dragitem)+"",o,r,a,l,c=S.ui.merchant.price+"",f,u,p,g,v,_,b=S.ui.merchant.fee+"",y,w,C,A,M,F,V=S.ui.merchant.post+"",L,q,R,z,E,W;n=new bi({props:{descPos:"left:100%;bottom:100%;",clearOnMove:!0,invslot:void 0,pickable:!0,item:cs}}),n.$on("discard",t[26]),n.$on("move",t[25]),n.$on("click",t[26]),n.$on("context",t[26]),p=new yn({props:{amount:t[1]}}),C=new yn({props:{amount:t[15]}});let j=t[3]&&t[3].stacks>0&&T6(t);return{c(){e=h("section"),te(n.$$.fragment),i=h("span"),o=T(s),a=h("div"),l=h("span"),f=T(c),u=T(": "),te(p.$$.fragment),g=Ue(),v=h("br"),_=h("span"),y=T(b),w=T(": "),te(C.$$.fragment),A=h("input"),j&&j.c(),F=h("div"),L=T(V),m(i,"class",r="marg text"+(t[3]?Yt(t[3].quality)[0]:"grey")+" svelte-afakdv"),m(l,"class","textwhite"),m(_,"class","textgrey"),m(a,"class","marg svelte-afakdv"),Pe(a,"text-align","end"),m(A,"class","marg svelte-afakdv"),m(A,"type","number"),m(A,"placeholder",M=S.ui.merchant.setPrice),m(F,"class",q="marg btn formatted secondary "+(t[16]?"":"disabled")+" svelte-afakdv"),m(e,"class",R="post "+(t[3]&&t[3].stacks>0?"postStacks":"")+" panel-black svelte-afakdv")},m(N,U){x(N,e,U),K(n,e,null),d(e,i),d(i,o),d(e,a),d(a,l),d(l,f),d(l,u),K(p,l,null),d(l,g),d(a,v),d(a,_),d(_,y),d(_,w),K(C,_,null),d(e,A),Ge(A,t[0]),j&&j.m(e,null),d(e,F),d(F,L),z=!0,E||(W=[Q(A,"input",t[48]),Q(F,"click",t[24])],E=!0)},p(N,U){(!z||U[0]&8)&&s!==(s=(N[3]?gn(N[3].type,N[3].tier):S.ui.merchant.dragitem)+"")&&G(o,s),(!z||U[0]&8&&r!==(r="marg text"+(N[3]?Yt(N[3].quality)[0]:"grey")+" svelte-afakdv"))&&m(i,"class",r);let ie={};U[0]&2&&(ie.amount=N[1]),p.$set(ie);let re={};U[0]&32768&&(re.amount=N[15]),C.$set(re),U[0]&1&&jt(A.value)!==N[0]&&Ge(A,N[0]),N[3]&&N[3].stacks>0?j?j.p(N,U):(j=T6(N),j.c(),j.m(e,F)):j&&(j.d(1),j=null),(!z||U[0]&65536&&q!==(q="marg btn formatted secondary "+(N[16]?"":"disabled")+" svelte-afakdv"))&&m(F,"class",q),(!z||U[0]&8&&R!==(R="post "+(N[3]&&N[3].stacks>0?"postStacks":"")+" panel-black svelte-afakdv"))&&m(e,"class",R)},i(N){z||(P(n.$$.fragment,N),P(p.$$.fragment,N),P(C.$$.fragment,N),z=!0)},o(N){I(n.$$.fragment,N),I(p.$$.fragment,N),I(C.$$.fragment,N),z=!1},d(N){N&&k(e),ee(n),ee(p),ee(C),j&&j.d(),E=!1,ut(W)}}}function II(t){let e,n,i,s=gn(t[18].temp.type,t[18].temp.tier)+"",o,r,a,l,c,f,u;return{c(){e=h("span"),n=T("Stop "),i=h("span"),o=T(s),a=T(" from being listed?"),l=h("div"),l.textContent=`${S.ui.cancel}`,c=h("div"),c.textContent=`${S.ui.merchant.delist}`,m(i,"class",r="text"+Yt(t[18].temp.quality)[0]+" svelte-afakdv"),m(e,"class","marg svelte-afakdv"),m(l,"class","marg btn formatted grey svelte-afakdv"),m(c,"class","marg btn formatted orange svelte-afakdv")},m(p,g){x(p,e,g),d(e,n),d(e,i),d(i,o),d(e,a),x(p,l,g),x(p,c,g),f||(u=[Q(l,"click",t[29]),Q(c,"click",t[31])],f=!0)},p(p,g){g[0]&262144&&s!==(s=gn(p[18].temp.type,p[18].temp.tier)+"")&&G(o,s),g[0]&262144&&r!==(r="text"+Yt(p[18].temp.quality)[0]+" svelte-afakdv")&&m(i,"class",r)},i:ce,o:ce,d(p){p&&(k(e),k(l),k(c)),f=!1,ut(u)}}}function VI(t){let e,n=S.ui.merchant.buyItem[0]+"",i,s,o,r=t[18].temp.stacks>0?t[18].temp.stacks+" x ":"",a,l,c=gn(t[18].temp.type,t[18].temp.tier)+"",f,u,p,g=S.ui.merchant.buyItem[1]+"",v,_,b,y,w=S.ui.merchant.buyItem[2]+"",C,A,M,F,V,L;return b=new yn({props:{amount:t[18].temp.auctionprice}}),{c(){e=h("span"),i=T(n),s=Ue(),o=h("span"),a=T(r),l=h("span"),f=T(c),p=Ue(),v=T(g),_=Ue(),te(b.$$.fragment),y=Ue(),C=T(w),A=h("div"),A.textContent=`${S.ui.cancel}`,M=h("div"),M.textContent=`${S.ui.merchant.buy}`,m(o,"class","textgreen"),m(l,"class",u="text"+Yt(t[18].temp.quality)[0]+" svelte-afakdv"),m(e,"class","marg svelte-afakdv"),m(A,"class","marg btn formatted grey svelte-afakdv"),m(M,"class","marg btn formatted secondary svelte-afakdv")},m(q,R){x(q,e,R),d(e,i),d(e,s),d(e,o),d(o,a),d(e,l),d(l,f),d(e,p),d(e,v),d(e,_),K(b,e,null),d(e,y),d(e,C),x(q,A,R),x(q,M,R),F=!0,V||(L=[Q(A,"click",t[29]),Q(M,"click",t[30])],V=!0)},p(q,R){(!F||R[0]&262144)&&r!==(r=q[18].temp.stacks>0?q[18].temp.stacks+" x ":"")&&G(a,r),(!F||R[0]&262144)&&c!==(c=gn(q[18].temp.type,q[18].temp.tier)+"")&&G(f,c),(!F||R[0]&262144&&u!==(u="text"+Yt(q[18].temp.quality)[0]+" svelte-afakdv"))&&m(l,"class",u);let z={};R[0]&262144&&(z.amount=q[18].temp.auctionprice),b.$set(z)},i(q){F||(P(b.$$.fragment,q),F=!0)},o(q){I(b.$$.fragment,q),F=!1},d(q){q&&(k(e),k(A),k(M)),ee(b),V=!1,ut(L)}}}function T6(t){let e,n,i,s,o,r,a;return{c(){e=h("select"),n=h("option"),n.textContent="Total",s=h("option"),s.textContent="Per Unit",n.__value=i=!1,Ge(n,n.__value),s.__value=o=!0,Ge(s,s.__value),m(e,"class","marg formatted svelte-afakdv"),t[2]===void 0&&mn(()=>t[49].call(e))},m(l,c){x(l,e,c),d(e,n),d(e,s),xn(e,t[2],!0),r||(a=Q(e,"change",t[49]),r=!0)},p(l,c){c[0]&4&&xn(e,l[2])},d(l){l&&k(e),r=!1,a()}}}function LI(t){let e,n,i,s,o,r,a,l,c=S.ui.merchant.search+"",f,u,p,g=S.ui.merchant.previous+"",v,_,b,y=S.ui.merchant.next+"",w,C,A,M,F,V,L,q,R,z,E,W=S.ui.merchant.results+"",j,N,U=t[14]+1+"",ie,re,ae=Math.ceil(t[19]/50)+"",ue,Me,me,Ne,De,Fe=t[32](t[10],"time",t[11])+"",_e,H=S.ui.merchant.time+"",qe,Oe,He,Ye=(t[12]?S.ui.merchant.perUnit:S.ui.merchant.total)+"",Ze,ve,le,ze=t[32](t[10],"price",t[11])+"",Z,X=S.ui.merchant.price+"",$,fe,je,Ve,ye,Re,Be,mt,wt;function Qe(We){t[37](We)}function Et(We){t[38](We)}function be(We){t[39](We)}let Je={limit:10};t[8]!==void 0&&(Je.name=t[8]),t[7]!==void 0&&(Je.tier=t[7]),t[6]!==void 0&&(Je.type=t[6]),i=new w6({props:Je}),Wt.push(()=>Lo(i,"name",Qe)),Wt.push(()=>Lo(i,"tier",Et)),Wt.push(()=>Lo(i,"type",be)),i.$on("finalize",t[23]);let yt=pe(t[22]),St=[];for(let We=0;We<yt.length;We+=1)St[We]=A6(C6(t,yt,We));let Ae=pe(t[17]),ct=[];for(let We=0;We<Ae.length;We+=1)ct[We]=P6(F6(t,Ae,We));let $t=We=>I(ct[We],1,1,()=>{ct[We]=null}),Le=[DI,EI],Ct=[];function Vt(We,Ke){return We[18]?1:0}return ye=Vt(t,[-1,-1]),Re=Ct[ye]=Le[ye](t),{c(){e=h("div"),n=h("section"),te(i.$$.fragment),a=h("span"),l=h("div"),f=T(c),p=h("div"),v=T(g),b=h("div"),w=T(y),A=h("section");for(let We=0;We<St.length;We+=1)St[We].c();M=h("section"),F=h("div"),V=h("div"),L=h("div"),q=h("span"),R=h("span"),z=T(t[19]),E=Ue(),j=T(W),N=T(" ("),ie=T(U),re=T("/"),ue=T(ae),Me=T(")"),me=h("span"),me.textContent="Lv.",Ne=h("span"),Ne.textContent=`${S.ui.merchant.owner}`,De=h("span"),_e=T(Fe),qe=T(H),He=h("span"),Ze=T(Ye),le=h("span"),Z=T(ze),$=T(X),fe=Ue(),Ve=h("div");for(let We=0;We<ct.length;We+=1)ct[We].c();Re.c(),m(l,"class",u="btn formatted secondary "+(t[9]?"":"disabled")),m(p,"class",_="btn formatted grey "+(t[9]&&t[14]>0?"":"disabled")),m(b,"class",C="btn formatted grey "+(t[9]&&t[17].length==50?"":"disabled")),m(n,"class","search panel-black svelte-afakdv"),m(A,"class","choices border grey scrollbar svelte-afakdv"),m(R,"class","btn black disabled textgrey"),m(me,"class","btn black disabled textgrey"),m(Ne,"class","btn black disabled textgrey"),m(De,"class",Oe="btn grey "+(t[9]?"":"disabled")+" "+(t[10]=="time"?"textprimary active":"")),m(He,"class",ve="btn grey "+(t[9]?"":"disabled")+" "+(t[12]?"textgreen":"")),Pe(He,"text-align","end"),m(le,"class",je="btn grey "+(t[9]?"":"disabled")+" "+(t[10]=="price"?"textprimary active":"")),Pe(le,"text-align","end"),m(L,"class","buytblhead svelte-afakdv"),m(V,"class","scrollbar scrollbar-fix"),m(Ve,"class","scrollbar scrollbar-fix"),m(F,"class","buytable svelte-afakdv"),m(M,"class","items border grey svelte-afakdv"),m(e,"class","layout svelte-afakdv")},m(We,Ke){x(We,e,Ke),d(e,n),K(i,n,null),d(n,a),d(n,l),d(l,f),d(n,p),d(p,v),d(n,b),d(b,w),t[43](n),d(e,A);for(let xe=0;xe<St.length;xe+=1)St[xe]&&St[xe].m(A,null);d(e,M),d(M,F),d(F,V),d(V,L),d(L,q),d(L,R),d(R,z),d(R,E),d(R,j),d(R,N),d(R,ie),d(R,re),d(R,ue),d(R,Me),d(L,me),d(L,Ne),d(L,De),d(De,_e),d(De,qe),d(L,He),d(He,Ze),d(L,le),d(le,Z),d(le,$),d(le,fe),d(F,Ve);for(let xe=0;xe<ct.length;xe+=1)ct[xe]&&ct[xe].m(Ve,null);Ct[ye].m(e,null),Be=!0,mt||(wt=[Q(l,"click",t[40]),Q(p,"click",t[41]),Q(b,"click",t[42]),Q(De,"click",t[45]),Q(He,"click",t[34]),Q(le,"click",t[46])],mt=!0)},p(We,Ke){let xe={};if(!s&&Ke[0]&256&&(s=!0,xe.name=We[8],Vo(()=>s=!1)),!o&&Ke[0]&128&&(o=!0,xe.tier=We[7],Vo(()=>o=!1)),!r&&Ke[0]&64&&(r=!0,xe.type=We[6],Vo(()=>r=!1)),i.$set(xe),(!Be||Ke[0]&512&&u!==(u="btn formatted secondary "+(We[9]?"":"disabled")))&&m(l,"class",u),(!Be||Ke[0]&16896&&_!==(_="btn formatted grey "+(We[9]&&We[14]>0?"":"disabled")))&&m(p,"class",_),(!Be||Ke[0]&131584&&C!==(C="btn formatted grey "+(We[9]&&We[17].length==50?"":"disabled")))&&m(b,"class",C),Ke[0]&12599744){yt=pe(We[22]);let Xe;for(Xe=0;Xe<yt.length;Xe+=1){let ft=C6(We,yt,Xe);St[Xe]?St[Xe].p(ft,Ke):(St[Xe]=A6(ft),St[Xe].c(),St[Xe].m(A,null))}for(;Xe<St.length;Xe+=1)St[Xe].d(1);St.length=yt.length}if((!Be||Ke[0]&524288)&&G(z,We[19]),(!Be||Ke[0]&16384)&&U!==(U=We[14]+1+"")&&G(ie,U),(!Be||Ke[0]&524288)&&ae!==(ae=Math.ceil(We[19]/50)+"")&&G(ue,ae),(!Be||Ke[0]&3072)&&Fe!==(Fe=We[32](We[10],"time",We[11])+"")&&G(_e,Fe),(!Be||Ke[0]&1536&&Oe!==(Oe="btn grey "+(We[9]?"":"disabled")+" "+(We[10]=="time"?"textprimary active":"")))&&m(De,"class",Oe),(!Be||Ke[0]&4096)&&Ye!==(Ye=(We[12]?S.ui.merchant.perUnit:S.ui.merchant.total)+"")&&G(Ze,Ye),(!Be||Ke[0]&4608&&ve!==(ve="btn grey "+(We[9]?"":"disabled")+" "+(We[12]?"textgreen":"")))&&m(He,"class",ve),(!Be||Ke[0]&3072)&&ze!==(ze=We[32](We[10],"price",We[11])+"")&&G(Z,ze),(!Be||Ke[0]&1536&&je!==(je="btn grey "+(We[9]?"":"disabled")+" "+(We[10]=="price"?"textprimary active":"")))&&m(le,"class",je),Ke[0]&404103200){Ae=pe(We[17]);let Xe;for(Xe=0;Xe<Ae.length;Xe+=1){let ft=F6(We,Ae,Xe);ct[Xe]?(ct[Xe].p(ft,Ke),P(ct[Xe],1)):(ct[Xe]=P6(ft),ct[Xe].c(),P(ct[Xe],1),ct[Xe].m(Ve,null))}for(Te(),Xe=Ae.length;Xe<ct.length;Xe+=1)$t(Xe);Ee()}let ot=ye;ye=Vt(We,Ke),ye===ot?Ct[ye].p(We,Ke):(Te(),I(Ct[ot],1,1,()=>{Ct[ot]=null}),Ee(),Re=Ct[ye],Re?Re.p(We,Ke):(Re=Ct[ye]=Le[ye](We),Re.c()),P(Re,1),Re.m(e,null))},i(We){if(!Be){P(i.$$.fragment,We);for(let Ke=0;Ke<Ae.length;Ke+=1)P(ct[Ke]);P(Re),Be=!0}},o(We){I(i.$$.fragment,We),ct=ct.filter(Boolean);for(let Ke=0;Ke<ct.length;Ke+=1)I(ct[Ke]);I(Re),Be=!1},d(We){We&&k(e),ee(i),t[43](null),it(St,We),it(ct,We),Ct[ye].d(),mt=!1,ut(wt)}}}function qI(t){let e,n,i=t[4]&&S6(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,o){s[4]?i?(i.p(s,o),o[0]&16&&P(i,1)):(i=S6(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function RI(t,e,n){let i,s,o,r,a,l;se(t,rl,ye=>n(35,i=ye)),se(t,cs,ye=>n(3,s=ye)),se(t,ls,ye=>n(4,o=ye)),se(t,Sr,ye=>n(36,r=ye)),se(t,up,ye=>n(19,a=ye));let c=tt.shift.store;se(t,c,ye=>n(20,l=ye));let f,u=[S.ui.all,S.ui.merchant.filtermine,null,"bow","hammer","staff","sword",null,"orb","quiver","shield","totem",null,"armlet","armor","boot","glove",null,"amulet","bag","ring",null,"book","rune","misc",null,"mount","pet","box"],p=u[0],g="all",v="",_=[],b=!0,y="price",w=1,C=!1,A=!1,M=0,F=()=>{if(b&&o){n(18,ue=void 0);let ye=u.indexOf(p);xt("itemauctionfind",`${ye} ${ye===1?"all":g} ${y==="time"?0:C?2:1} ${w} ${M}`),n(9,b=!1)}},V,L,q=!1,R,z,E=()=>{z&&xt("itemauctionpost",`${s.dbid} ${L}`)},W=ye=>{let{from:Re,to:Be}=ye.detail;Re!==Be&&Re.type=="item"&&cs.set(Re.item)},j=ye=>{s&&s.type&&Mt(Ri[s.type].sound),cs.set()},N,U=[],ie=[],re=()=>{if(N=Date.now(),i.length){let ye=i.map(Re=>Re.dbid);fetch("/api/item/get",{method:"POST",body:JSON.stringify({auction:1,ids:ye})}).then(async Re=>{let Be=await Re.json();Be.fail?console.error(Be):(n(17,ie.length=0,ie),i.forEach((mt,wt)=>{let Qe=Be.find(Et=>Et.id===mt.dbid);Qe&&(Qe.store=U[wt]||(U[wt]=ne()),Qe.store.temp=mt,mt.hydrate(Qe),ie.push(Qe.store))}),n(13,A=C),n(9,b=!0))})}else n(13,A=C),n(9,b=!0),n(17,ie.length=0,ie)},ae=ye=>{let Re=Math.ceil((ye-N)/6e4);return Re<60?`${Re} m`:`${Math.ceil(Re/60)} h`},ue,Me=ye=>{n(18,ue=ye)},me=()=>{n(18,ue=void 0)},Ne=()=>{xt("itemauctionbuy",ue.temp.dbid+""),me()},De=()=>{xt("itemauctioncancel",ue.temp.dbid+""),me()},Fe=(ye,Re,Be)=>ye==Re?Be==1?"\u{1F815} ":"\u{1F817} ":"",_e=ye=>{n(14,M=0),ye==y?n(11,w=w==1?0:1):n(10,y=ye),F()},H=()=>{n(12,C=!C),y=="price"?F():n(13,A=C)};cs.subscribe(ye=>{ye!==void 0&&(n(6,p=ye.type),n(7,g=ye.tier),n(11,w=1),n(10,y="price"),n(12,C=!0),n(14,M=0),F())});function qe(ye){v=ye,n(8,v)}function Oe(ye){g=ye,n(7,g)}function He(ye){p=ye,n(6,p)}let Ye=ye=>{n(14,M=0),F()},Ze=ye=>{n(14,M--,M),F()},ve=ye=>{n(14,M++,M),F()};function le(ye){Wt[ye?"unshift":"push"](()=>{f=ye,n(5,f)})}let ze=(ye,Re)=>{n(6,p=ye),n(8,v=""),n(7,g="all"),n(14,M=0),F()},Z=ye=>_e("time"),X=ye=>_e("price"),$=(ye,Re)=>Me(ye);function fe(){V=jt(this.value),n(0,V),n(3,s),n(2,q),n(1,L),n(4,o)}function je(){q=ki(this),n(2,q)}let Ve=()=>{nt(ls,o=void 0,o),n(8,v=""),n(7,g="all")};return t.$$.update=()=>{t.$$.dirty[0]&16|t.$$.dirty[1]&32&&o&&F(),t.$$.dirty[0]&16&&(o?n(18,ue=void 0):nt(cs,s=void 0,s)),t.$$.dirty[0]&15&&(vt(),n(0,V=vt(V,0,2147483646)),n(1,L=s?vt((parseInt(V)||0)*(q&&s.stacks||1),0,2147483646):0),n(15,R=Number.isInteger(L)?M6(L):0),n(16,z=Number.isInteger(L)&&L>0&&s&&s.canBeTraded())),t.$$.dirty[1]&16&&re()},[V,L,q,s,o,f,p,g,v,b,y,w,C,A,M,R,z,ie,ue,a,l,c,u,F,E,W,j,ae,Me,me,Ne,De,Fe,_e,H,i,r,qe,Oe,He,Ye,Ze,ve,le,ze,Z,X,$,fe,je,Ve]}var qg=class extends we{constructor(e){super(),Ce(this,e,RI,qI,$e,{},null,[-1,-1])}},E6=qg;var fd=[{name:"Year",days:365,price:9e3},{name:"Month",days:30,price:900}],$n=[{sub:!1,stash:15,inventory:15,auction:10,auctionHours:12},{sub:!0,stash:100,inventory:25,auction:100,auctionHours:24}];function D6(t,e,n){let i=t.slice();return i[32]=e[n],i}function I6(t){let e,n,i,s,o;return n=new Ot({props:{title:"Stash",pad:"5",icon:"bag",$$slots:{default:[BI]},$$scope:{ctx:t}}}),n.$on("close",t[24]),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","l-upperLeftModal container svelte-1ilvxqc")},m(r,a){x(r,e,a),K(n,e,null),t[25](e),i=!0,s||(o=Q(e,"pointerup",t[13]),s=!0)},p(r,a){let l={};a[0]&4095|a[1]&16&&(l.$$scope={dirty:a,ctx:r}),n.$set(l)},i(r){i||(P(n.$$.fragment,r),i=!0)},o(r){I(n.$$.fragment,r),i=!1},d(r){r&&k(e),ee(n),t[25](null),s=!1,o()}}}function V6(t){let e;return{c(){e=h("div")},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function L6(t){let e,n;return e=new bi({props:{descPos:"left:100%;top:0;",shift:t[10],descRoot:t[3],pickable:!1,text:t[14](t[32].temp?t[32].temp.getStashTime():0),item:t[32],filter:!t[6]||(t[32].temp?t[32].temp.getStashTime()>t[4]?!0:"":!0)}}),e.$on("click",t[15]),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s[0]&1024&&(o.shift=i[10]),s[0]&8&&(o.descRoot=i[3]),s[0]&32&&(o.text=i[14](i[32].temp?i[32].temp.getStashTime():0)),s[0]&32&&(o.item=i[32]),s[0]&112&&(o.filter=!i[6]||(i[32].temp?i[32].temp.getStashTime()>i[4]?!0:"":!0)),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function q6(t){let e,n,i;return{c(){e=h("span"),e.innerHTML='Upgrade <img class="svgicon texticon" src="/data/ui/icons/gem.svg?v=8582889"/>',m(e,"class","btn textwhite")},m(s,o){x(s,e,o),n||(i=Q(e,"click",t[20]),n=!0)},p:ce,d(s){s&&k(e),n=!1,i()}}}function R6(t){let e,n,i=(t[0]===1?S.ui.stash.deposit:S.ui.stash.withdraw)+"",s,o,r,a,l,c,f,u,p=(t[0]===1?S.ui.stash.deposit:S.ui.stash.withdraw)+"",g,v,_,b,y;return r=new yn({props:{amount:t[0]>0?t[1]:0}}),{c(){e=h("div"),n=h("span"),s=T(i),o=Ue(),te(r.$$.fragment),a=T(" ?"),l=h("div"),c=h("input"),f=h("div"),f.textContent="Max",u=h("div"),g=T(p),Pe(c,"width","150px"),m(c,"class","navbtn formatted"),m(c,"type","number"),m(f,"class","btn navbtn cyan formatted"),m(u,"class",v="btn navbtn "+(!t[6]||t[1]<=0?"disabled":"")+" "+(t[0]===1?"blue":"green")+" formatted"),m(l,"class","marg-top formelements svelte-1ilvxqc"),m(e,"class","panel-black marg-top"),Pe(e,"text-align","right")},m(w,C){x(w,e,C),d(e,n),d(n,s),d(n,o),K(r,n,null),d(n,a),d(e,l),d(l,c),Ge(c,t[1]),d(l,f),d(l,u),d(u,g),_=!0,b||(y=[Q(c,"input",t[23]),Q(f,"click",t[17]),Q(u,"click",t[16])],b=!0)},p(w,C){(!_||C[0]&1)&&i!==(i=(w[0]===1?S.ui.stash.deposit:S.ui.stash.withdraw)+"")&&G(s,i);let A={};C[0]&3&&(A.amount=w[0]>0?w[1]:0),r.$set(A),C[0]&2&&jt(c.value)!==w[1]&&Ge(c,w[1]),(!_||C[0]&1)&&p!==(p=(w[0]===1?S.ui.stash.deposit:S.ui.stash.withdraw)+"")&&G(g,p),(!_||C[0]&67&&v!==(v="btn navbtn "+(!w[6]||w[1]<=0?"disabled":"")+" "+(w[0]===1?"blue":"green")+" formatted"))&&m(u,"class",v)},i(w){_||(P(r.$$.fragment,w),_=!0)},o(w){I(r.$$.fragment,w),_=!1},d(w){w&&k(e),ee(r),b=!1,ut(y)}}}function BI(t){let e,n,i,s,o=t[5].length+"",r,a,l=(t[7].subscribed_until?$n[1].stash:$n[0].stash)+"",c,f,u,p,g,v,_,b,y,w,C,A,M,F,V,L,q=pe(t[5]),R=[];for(let N=0;N<q.length;N+=1)R[N]=L6(D6(t,q,N));let z=N=>I(R[N],1,1,()=>{R[N]=null}),E=null;q.length||(E=V6(t));let W=!t[7].subscribed_until&&q6(t);p=new yn({props:{amount:t[2].gold}});let j=t[0]>0&&R6(t);return{c(){e=h("div");for(let N=0;N<R.length;N+=1)R[N].c();E&&E.c(),n=h("div"),i=h("div"),s=h("span"),r=T(o),a=T(" / "),c=T(l),W&&W.c(),u=h("div"),te(p.$$.fragment),g=h("div"),v=h("img"),y=h("div"),w=h("img"),j&&j.c(),M=ge(),m(e,"class","panel-black slotcontainer scrollbar svelte-1ilvxqc"),Pe(e,"width",t[5].length?"fit-content":"auto"),Pe(e,"grid-template-columns","repeat("+Math.min(t[5].length,t[8])+", auto)"),Pe(e,"max-height",t[9]+"px"),m(s,"class",f=t[5].length<(t[7].subscribed_until?$n[1].stash:$n[0].stash)?"textgreen":"textred"),m(i,"class","navbtn panel-black border black gold svelte-1ilvxqc"),Pe(i,"margin-right","auto"),m(u,"class","navbtn panel-black border black gold svelte-1ilvxqc"),m(v,"class","svgicon"),at(v.src,_="/data/ui/icons/deposit.svg?v=8582889")||m(v,"src",_),m(g,"class",b="navbtn btn grey gold "+(t[0]===1?"active":"")+" svelte-1ilvxqc"),m(w,"class","svgicon"),at(w.src,C="/data/ui/icons/withdraw.svg?v=8582889")||m(w,"src",C),m(y,"class",A="navbtn btn grey gold "+(t[0]===2?"active":"")+" svelte-1ilvxqc"),m(n,"class","formelements svelte-1ilvxqc")},m(N,U){x(N,e,U);for(let ie=0;ie<R.length;ie+=1)R[ie]&&R[ie].m(e,null);E&&E.m(e,null),x(N,n,U),d(n,i),d(i,s),d(s,r),d(s,a),d(s,c),W&&W.m(s,null),d(n,u),K(p,u,null),d(n,g),d(g,v),d(n,y),d(y,w),j&&j.m(N,U),x(N,M,U),F=!0,V||(L=[Q(g,"click",t[21]),Q(y,"click",t[22])],V=!0)},p(N,U){if(U[0]&50296){q=pe(N[5]);let re;for(re=0;re<q.length;re+=1){let ae=D6(N,q,re);R[re]?(R[re].p(ae,U),P(R[re],1)):(R[re]=L6(ae),R[re].c(),P(R[re],1),R[re].m(e,null))}for(Te(),re=q.length;re<R.length;re+=1)z(re);Ee(),!q.length&&E?E.p(N,U):q.length?E&&(E.d(1),E=null):(E=V6(N),E.c(),E.m(e,null))}(!F||U[0]&32)&&Pe(e,"width",N[5].length?"fit-content":"auto"),(!F||U[0]&288)&&Pe(e,"grid-template-columns","repeat("+Math.min(N[5].length,N[8])+", auto)"),(!F||U[0]&512)&&Pe(e,"max-height",N[9]+"px"),(!F||U[0]&32)&&o!==(o=N[5].length+"")&&G(r,o),(!F||U[0]&128)&&l!==(l=(N[7].subscribed_until?$n[1].stash:$n[0].stash)+"")&&G(c,l),N[7].subscribed_until?W&&(W.d(1),W=null):W?W.p(N,U):(W=q6(N),W.c(),W.m(s,null)),(!F||U[0]&160&&f!==(f=N[5].length<(N[7].subscribed_until?$n[1].stash:$n[0].stash)?"textgreen":"textred"))&&m(s,"class",f);let ie={};U[0]&4&&(ie.amount=N[2].gold),p.$set(ie),(!F||U[0]&1&&b!==(b="navbtn btn grey gold "+(N[0]===1?"active":"")+" svelte-1ilvxqc"))&&m(g,"class",b),(!F||U[0]&1&&A!==(A="navbtn btn grey gold "+(N[0]===2?"active":"")+" svelte-1ilvxqc"))&&m(y,"class",A),N[0]>0?j?(j.p(N,U),U[0]&1&&P(j,1)):(j=R6(N),j.c(),P(j,1),j.m(M.parentNode,M)):j&&(Te(),I(j,1,1,()=>{j=null}),Ee())},i(N){if(!F){for(let U=0;U<q.length;U+=1)P(R[U]);P(p.$$.fragment,N),P(j),F=!0}},o(N){R=R.filter(Boolean);for(let U=0;U<R.length;U+=1)I(R[U]);I(p.$$.fragment,N),I(j),F=!1},d(N){N&&(k(e),k(n),k(M)),it(R,N),E&&E.d(),W&&W.d(),ee(p),j&&j.d(N),V=!1,ut(L)}}}function zI(t){let e,n,i=t[2]&&t[7]&&I6(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,o){s[2]&&s[7]?i?(i.p(s,o),o[0]&132&&P(i,1)):(i=I6(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function $I(t,e,n){let i,s,o,r,a,l,c,f,u;se(t,Vi,ae=>n(2,i=ae)),se(t,Hi,ae=>n(18,s=ae)),se(t,Pn,ae=>n(28,o=ae)),se(t,pp,ae=>n(19,r=ae)),se(t,ll,ae=>n(7,a=ae)),se(t,Nr,ae=>n(8,l=ae)),se(t,jr,ae=>n(9,c=ae)),se(t,Li,ae=>n(11,u=ae));let p=tt.shift.store;se(t,p,ae=>n(10,f=ae));let g,v,_=[],b=[],y=!1,w,C=async()=>{if(n(4,v=Date.now()),r.length){let ue=await(await fetch("/api/item/get",{method:"POST",body:JSON.stringify({stash:1,ids:r.map(Me=>Me.dbid)})})).json();if(ue.fail)console.error(ue);else{n(5,b.length=0,b);let Me=new Map(r.map(me=>[me.dbid,me]));ue.forEach((me,Ne)=>{me.store=_[Ne]||(_[Ne]=ne()),n(5,b[Ne]=_[Ne],b),Me.has(me.id)&&(Me.get(me.id).hydrate(me),n(5,b[Ne].temp=Me.get(me.id),b))})}}else n(5,b.length=0,b);E()},A=ae=>{o&&(xt("itemstash",`${o.meta.slot}`),nt(Pn,o=void 0,o))},M=ae=>ae<v?void 0:`${Math.ceil((ae-v)/6e4)}m`,F=ae=>{y&&(ae.detail.item.getStashTime()>Date.now()?Nt("system",S.ui.stash.waitunstash):(xt("itemunstash",ae.detail.item.dbid+""),z()))},V=ae=>{y&&(xt("goldstash",q===1?R+"":-R+""),z())},L=()=>{n(1,R=q===1?s:i.gold)},q=2,R=0,z=()=>{n(6,y=!1),w=setTimeout(()=>{n(6,y=!0)},500)},E=()=>{n(6,y=!0),w&&(clearTimeout(w),w=void 0)},W=ae=>nt(Li,u=!0,u),j=ae=>n(0,q=1),N=ae=>n(0,q=2);function U(){R=jt(this.value),n(1,R),n(2,i),n(0,q),n(18,s)}let ie=ae=>nt(Vi,i=!1,i);function re(ae){Wt[ae?"unshift":"push"](()=>{g=ae,n(3,g)})}return t.$$.update=()=>{t.$$.dirty[0]&524288&&C(),t.$$.dirty[0]&262151&&n(1,R=i?Math.min(q===1?s:i.gold,R):0)},[q,R,i,g,v,b,y,a,l,c,f,u,p,A,M,F,V,L,s,r,W,j,N,U,ie,re]}var Rg=class extends we{constructor(e){super(),Ce(this,e,$I,zI,$e,{},null,[-1,-1])}},B6=Rg;function UI(t,e,n){let i=t.slice();return i[7]=e[n],i[9]=n,i}function z6(t,e,n){let i=t.slice();return i[10]=e[n],i}function $6(t){let e,n,i,s,o;return n=new Ot({props:{title:S.npcs.trader.name,icon:"bag",$$slots:{default:[HI]},$$scope:{ctx:t}}}),n.$on("close",t[5]),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","l-upperLeftModal container svelte-46w0ts")},m(r,a){x(r,e,a),K(n,e,null),t[6](e),i=!0,s||(o=Q(e,"pointerup",t[3]),s=!0)},p(r,a){let l={};a&8195&&(l.$$scope={dirty:a,ctx:r}),n.$set(l)},i(r){i||(P(n.$$.fragment,r),i=!0)},o(r){I(n.$$.fragment,r),i=!1},d(r){r&&k(e),ee(n),t[6](null),s=!1,o()}}}function U6(t){let e,n;return e=new bi({props:{id:"trader"+t[10][0].buyid,descPos:"left:100%;top:0;",descRoot:t[0],isTrader:!0,pickable:!1,item:t[10][1]}}),e.$on("click",t[4]),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&1&&(o.descRoot=i[0]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function OI(t){let e,n;return e=new bi({props:{isTrader:!0}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p:ce,i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function NI(t){let e;return{c(){e=h("span"),e.textContent=`${S.npcs.trader.select}`,m(e,"class","textgrey")},m(n,i){x(n,e,i)},p:ce,i:ce,o:ce,d(n){n&&k(e)}}}function jI(t){let e,n,i,s,o,r=[GI,WI],a=[];function l(c,f){return f&2&&(e=null),e==null&&(e=!!c[1].data.canBeSold()),e?0:1}return n=l(t,-1),i=a[n]=r[n](t),{c(){i.c(),s=ge()},m(c,f){a[n].m(c,f),x(c,s,f),o=!0},p(c,f){let u=n;n=l(c,f),n===u?a[n].p(c,f):(Te(),I(a[u],1,1,()=>{a[u]=null}),Ee(),i=a[n],i?i.p(c,f):(i=a[n]=r[n](c),i.c()),P(i,1),i.m(s.parentNode,s))},i(c){o||(P(i),o=!0)},o(c){I(i),o=!1},d(c){c&&k(s),a[n].d(c)}}}function WI(t){let e;return{c(){e=h("span"),e.textContent=`${S.npcs.trader.refuse}`,m(e,"class","textred")},m(n,i){x(n,e,i)},p:ce,i:ce,o:ce,d(n){n&&k(e)}}}function GI(t){let e,n;return e=new yn({props:{amount:t[1].data.goldValue()}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&2&&(o.amount=i[1].data.goldValue()),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function HI(t){let e,n,i,s,o,r,a,l,c,f,u=pe(D.player.getTargetEntity().items),p=[];for(let C=0;C<u.length;C+=1)p[C]=U6(z6(t,u,C));let g=C=>I(p[C],1,1,()=>{p[C]=null}),v=pe(Array(24-D.player.getTargetEntity().items.length)),_=[];for(let C=0;C<v.length;C+=1)_[C]=OI(UI(t,v,C));let b=[jI,NI],y=[];function w(C,A){return C[1]&&C[1].meta.type==="item"?0:1}return l=w(t,-1),c=y[l]=b[l](t),{c(){e=h("p"),e.textContent=`${S.npcs.trader.buy}`,n=h("div");for(let C=0;C<p.length;C+=1)p[C].c();i=ge();for(let C=0;C<_.length;C+=1)_[C].c();s=h("div"),o=h("p"),o.textContent=`${S.npcs.trader.info}`,r=h("p"),r.textContent=`${S.npcs.trader.price}`,a=h("span"),c.c(),m(e,"class","textprimary textcenter"),m(n,"class","panel-black slotcontainer svelte-46w0ts"),m(o,"class","textprimary"),m(a,"class","panel-black formatted info svelte-46w0ts"),m(s,"class","textcenter")},m(C,A){x(C,e,A),x(C,n,A);for(let M=0;M<p.length;M+=1)p[M]&&p[M].m(n,null);d(n,i);for(let M=0;M<_.length;M+=1)_[M]&&_[M].m(n,null);x(C,s,A),d(s,o),d(s,r),d(s,a),y[l].m(a,null),f=!0},p(C,A){if(A&17){u=pe(D.player.getTargetEntity().items);let F;for(F=0;F<u.length;F+=1){let V=z6(C,u,F);p[F]?(p[F].p(V,A),P(p[F],1)):(p[F]=U6(V),p[F].c(),P(p[F],1),p[F].m(n,i))}for(Te(),F=u.length;F<p.length;F+=1)g(F);Ee()}let M=l;l=w(C,A),l===M?y[l].p(C,A):(Te(),I(y[M],1,1,()=>{y[M]=null}),Ee(),c=y[l],c?c.p(C,A):(c=y[l]=b[l](C),c.c()),P(c,1),c.m(a,null))},i(C){if(!f){for(let A=0;A<u.length;A+=1)P(p[A]);for(let A=0;A<v.length;A+=1)P(_[A]);P(c),f=!0}},o(C){p=p.filter(Boolean);for(let A=0;A<p.length;A+=1)I(p[A]);_=_.filter(Boolean);for(let A=0;A<_.length;A+=1)I(_[A]);I(c),f=!1},d(C){C&&(k(e),k(n),k(s)),it(p,C),it(_,C),y[l].d()}}}function YI(t){let e,n,i=t[2]&&$6(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[2]?i?(i.p(s,o),o&4&&P(i,1)):(i=$6(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function XI(t,e,n){let i,s;se(t,Pn,f=>n(1,i=f)),se(t,Yi,f=>n(2,s=f));let o=f=>{i&&i.meta&&i.meta.type==="item"&&i.data.canBeSold()&&Uf(i.data.quality,i.data.upgrade,i.meta.slot,i.data.type,i.data.tier),nt(Pn,i=void 0,i)},r=f=>{xt("itemtraderbuy",`${f.detail.item.buyid}`)},a,l=f=>nt(Yi,s=!1,s);function c(f){Wt[f?"unshift":"push"](()=>{a=f,n(0,a)})}return[a,i,s,o,r,l,c]}var Bg=class extends we{constructor(e){super(),Ce(this,e,XI,YI,$e,{})}},O6=Bg;function N6(t,e,n){let i=t.slice();return i[13]=e[n],i[15]=n,i}function j6(t,e,n){let i=t.slice();return i[16]=e[n],i[15]=n,i}function W6(t,e,n){let i=t.slice();return i[18]=e[n],i}function G6(t){let e,n,i,s=t[16].classcount[t[18]]+"",o,r;return{c(){e=h("div"),n=h("div"),n.innerHTML=`<img class="texticon" src="${Ys(t[18])}"/>`,i=h("b"),o=T(s),m(i,"class",r=t[16].classcount[t[18]]>0?"textprimary":"textgrey")},m(a,l){x(a,e,l),d(e,n),d(e,i),d(i,o)},p(a,l){l&4&&s!==(s=a[16].classcount[a[18]]+"")&&G(o,s),l&4&&r!==(r=a[16].classcount[a[18]]>0?"textprimary":"textgrey")&&m(i,"class",r)},d(a){a&&k(e)}}}function H6(t){let e,n,i,s=t[16].message+"",o,r,a=t[4][t[16].activity]+"",l,c,f,u,p,g=t[16].minlevel+"",v,_,b=t[16].maxlevel+"",y,w,C,A,M,F,V;w=new Bi({props:{name:t[16].leadername,level:t[16].leaderlevel,pclass:t[16].leaderclass,faction:t[16].faction}});let L=pe([0,1,2,3]),q=[];for(let E=0;E<4;E+=1)q[E]=G6(W6(t,L,E));function R(...E){return t[10](t[16],...E)}function z(...E){return t[11](t[16],...E)}return{c(){e=h("div"),n=h("div"),i=h("div"),o=T(s),r=h("div"),l=T(a),c=h("div"),f=h("div"),u=T("Lv. "),p=h("span"),v=T(g),_=T(" - "),y=T(b),te(w.$$.fragment),C=h("div");for(let E=0;E<4;E+=1)q[E].c();m(i,"class","textprimary"),m(r,"class","textgrey textsmall"),Pe(n,"text-overflow","ellipsis"),Pe(n,"white-space","nowrap"),Pe(n,"overflow","hidden"),m(p,"class","textgreen"),m(f,"class","textgrey"),m(c,"class","textcenter"),m(C,"class","grid four textcenter"),m(e,"class",A="panel-black listing marg-bot "+(t[1]===t[16]?"selected":t[5][t[16].applied])+" svelte-12t87hd")},m(E,W){x(E,e,W),d(e,n),d(n,i),d(i,o),d(n,r),d(r,l),d(e,c),d(c,f),d(f,u),d(f,p),d(p,v),d(p,_),d(p,y),K(w,c,null),d(e,C);for(let j=0;j<4;j+=1)q[j]&&q[j].m(C,null);M=!0,F||(V=[Q(e,"click",R),Q(e,"contextmenu",z)],F=!0)},p(E,W){t=E,(!M||W&4)&&s!==(s=t[16].message+"")&&G(o,s),(!M||W&4)&&a!==(a=t[4][t[16].activity]+"")&&G(l,a),(!M||W&4)&&g!==(g=t[16].minlevel+"")&&G(v,g),(!M||W&4)&&b!==(b=t[16].maxlevel+"")&&G(y,b);let j={};if(W&4&&(j.name=t[16].leadername),W&4&&(j.level=t[16].leaderlevel),W&4&&(j.pclass=t[16].leaderclass),W&4&&(j.faction=t[16].faction),w.$set(j),W&4){L=pe([0,1,2,3]);let N;for(N=0;N<4;N+=1){let U=W6(t,L,N);q[N]?q[N].p(U,W):(q[N]=G6(U),q[N].c(),q[N].m(C,null))}for(;N<4;N+=1)q[N].d(1)}(!M||W&6&&A!==(A="panel-black listing marg-bot "+(t[1]===t[16]?"selected":t[5][t[16].applied])+" svelte-12t87hd"))&&m(e,"class",A)},i(E){M||(P(w.$$.fragment,E),M=!0)},o(E){I(w.$$.fragment,E),M=!1},d(E){E&&k(e),ee(w),it(q,E),F=!1,ut(V)}}}function Y6(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[13]}`,e.__value=n=t[15],Ge(e,e.__value)},m(i,s){x(i,e,s)},p:ce,d(i){i&&k(e)}}}function QI(t){let e,n,i,s,o,r,a,l,c;return{c(){e=h("div"),n=h("div"),i=T("\u{1F64B} Apply"),o=h("div"),r=T("\u{1F50E} Refresh"),m(n,"class",s="btn textcenter "+(t[1]&&t[1].applied===0?"green":"disabled")),m(o,"class",a="btn textcenter "+(t[0]?"disabled":"cyan")),m(e,"class","panel-black grid two")},m(f,u){x(f,e,u),d(e,n),d(n,i),d(e,o),d(o,r),l||(c=[Q(n,"click",t[7]),Q(o,"click",t[6])],l=!0)},p(f,u){u&2&&s!==(s="btn textcenter "+(f[1]&&f[1].applied===0?"green":"disabled"))&&m(n,"class",s),u&1&&a!==(a="btn textcenter "+(f[0]?"disabled":"cyan"))&&m(o,"class",a)},d(f){f&&k(e),l=!1,ut(c)}}}function ZI(t){let e;return{c(){e=h("div"),e.textContent="You are in a party.",m(e,"class","textcenter panel-black textgrey")},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function JI(t){let e,n,i,s,o,r,a,l,c,f,u,p,g,v,_,b=pe(t[2].parties.filter(t[9])),y=[];for(let L=0;L<b.length;L+=1)y[L]=H6(j6(t,b,L));let w=L=>I(y[L],1,1,()=>{y[L]=null}),C=pe(t[4]),A=[];for(let L=0;L<C.length;L+=1)A[L]=Y6(N6(t,C,L));function M(L,q){return L[3].membercount>0?ZI:QI}let F=M(t,-1),V=F(t);return{c(){e=h("div"),n=h("div");for(let L=0;L<y.length;L+=1)y[L].c();i=h("div"),s=h("div"),o=h("small"),o.textContent="Filter Party Listings",r=h("div"),a=h("div"),a.textContent="Activity",l=h("select"),c=h("option"),c.textContent="All";for(let L=0;L<A.length;L+=1)A[L].c();u=h("small"),u.textContent="More filters to come!",p=Ue(),V.c(),m(n,"class","listcontainer scrollbar border grey svelte-12t87hd"),Pe(n,"font-size","0.9em"),m(o,"class","textprimary"),c.__value=f=-1,Ge(c,c.__value),m(l,"class","btn grey small"),t[2].filterActivity===void 0&&mn(()=>t[12].call(l)),m(u,"class","textgrey"),m(r,"class","grid two search svelte-12t87hd"),m(s,"class","panel-black"),m(i,"class","grid"),Pe(i,"grid-template-rows","1fr auto"),m(e,"class","layout svelte-12t87hd")},m(L,q){x(L,e,q),d(e,n);for(let R=0;R<y.length;R+=1)y[R]&&y[R].m(n,null);d(e,i),d(i,s),d(s,o),d(s,r),d(r,a),d(r,l),d(l,c);for(let R=0;R<A.length;R+=1)A[R]&&A[R].m(l,null);xn(l,t[2].filterActivity,!0),d(r,u),d(i,p),V.m(i,null),g=!0,v||(_=Q(l,"change",t[12]),v=!0)},p(L,[q]){if(q&310){b=pe(L[2].parties.filter(L[9]));let R;for(R=0;R<b.length;R+=1){let z=j6(L,b,R);y[R]?(y[R].p(z,q),P(y[R],1)):(y[R]=H6(z),y[R].c(),P(y[R],1),y[R].m(n,null))}for(Te(),R=b.length;R<y.length;R+=1)w(R);Ee()}if(q&16){C=pe(L[4]);let R;for(R=0;R<C.length;R+=1){let z=N6(L,C,R);A[R]?A[R].p(z,q):(A[R]=Y6(z),A[R].c(),A[R].m(l,null))}for(;R<A.length;R+=1)A[R].d(1);A.length=C.length}q&4&&xn(l,L[2].filterActivity),F===(F=M(L,q))&&V?V.p(L,q):(V.d(1),V=F(L),V&&(V.c(),V.m(i,null)))},i(L){if(!g){for(let q=0;q<b.length;q+=1)P(y[q]);g=!0}},o(L){y=y.filter(Boolean);for(let q=0;q<y.length;q+=1)I(y[q]);g=!1},d(L){L&&k(e),it(y,L),it(A,L),V.d(),v=!1,_()}}}function KI(t,e,n){let i,s;se(t,ip,b=>n(2,i=b)),se(t,Qn,b=>n(3,s=b));let o=S.ui.party.activities,r=["","applied","denied"],a=!1,l,c=async()=>{n(0,a=!0);let b=await Ut("/api/party/getlistedparties",{},()=>{});nt(ip,i.parties=b,i),l&&n(1,l=b.find(y=>y.party===l.party)),setTimeout(()=>n(0,a=!1),200)};c();let f=()=>{l&&(n(1,l.applied=1,l),Ut("/api/party/makeapplication",{party:l.party,message:""},()=>{}),n(1,l=void 0))},u=(b,y)=>{wn.set({x:b.pageX,y:b.pageY,opts:[{name:y.leadername,css:"disabled"},nn.whisper(y.leadername)]})},p=b=>i.filterActivity===-1||b.activity===i.filterActivity,g=(b,y)=>n(1,l=b),v=(b,y)=>u(y,b);function _(){i.filterActivity=ki(this),ip.set(i)}return[a,l,i,s,o,r,c,f,u,p,g,v,_]}var zg=class extends we{constructor(e){super(),Ce(this,e,KI,JI,$e,{})}},X6=zg;var ud=async t=>{let e;try{e=await Ut("/api/party/getpartystate",{},()=>{})}catch{e=void 0}e&&Gi.update(n=>{let i=!1;return e.applications.forEach(s=>{n.applications.find(r=>r.player===s.player)||(i=!0)}),n.applications=e.applications,n.message=e.message||n.message||"",n.activity=e.activity||n.activity||0,n.listed=e.listed,n.flashing=i&&!oe.partyOpen,n})};function Q6(t,e,n){let i=t.slice();return i[14]=e[n],i[16]=n,i}function Z6(t,e,n){let i=t.slice();return i[17]=e[n],i[16]=n,i}function eV(t){let e,n,i,s=pe(t[1].applications),o=[];for(let a=0;a<s.length;a+=1)o[a]=J6(Z6(t,s,a));let r=a=>I(o[a],1,1,()=>{o[a]=null});return{c(){e=h("table"),n=h("tbody");for(let a=0;a<o.length;a+=1)o[a].c();m(e,"class","dense"),Pe(e,"width","100%"),Pe(e,"table-layout","fixed")},m(a,l){x(a,e,l),d(e,n);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(n,null);i=!0},p(a,l){if(l&226){s=pe(a[1].applications);let c;for(c=0;c<s.length;c+=1){let f=Z6(a,s,c);o[c]?(o[c].p(f,l),P(o[c],1)):(o[c]=J6(f),o[c].c(),P(o[c],1),o[c].m(n,null))}for(Te(),c=s.length;c<o.length;c+=1)r(c);Ee()}},i(a){if(!i){for(let l=0;l<s.length;l+=1)P(o[l]);i=!0}},o(a){o=o.filter(Boolean);for(let l=0;l<o.length;l+=1)I(o[l]);i=!1},d(a){a&&k(e),it(o,a)}}}function tV(t){let e;function n(o,r){return o[1].listed?iV:nV}let i=n(t,-1),s=i(t);return{c(){e=h("p"),s.c(),m(e,"class","textcenter textgrey")},m(o,r){x(o,e,r),s.m(e,null)},p(o,r){i!==(i=n(o,r))&&(s.d(1),s=i(o),s&&(s.c(),s.m(e,null)))},i:ce,o:ce,d(o){o&&k(e),s.d()}}}function J6(t){let e,n,i,s,o=t[17].gearscore+"",r,a,l,c,f,u,p,g,v,_,b;i=new Bi({props:{name:t[17].name,level:t[17].level,pclass:t[17].class,faction:t[17].faction}});function y(...A){return t[8](t[17],...A)}function w(...A){return t[9](t[17],...A)}function C(...A){return t[10](t[17],...A)}return{c(){e=h("tr"),n=h("td"),te(i.$$.fragment),s=h("td"),r=T(o),a=T(" GS"),l=h("td"),c=T("\u{1F91D}"),u=h("td"),p=T("\u274C"),m(n,"width","50%"),m(s,"width","20%"),m(s,"class","textcenter textcyan"),m(l,"width","15%"),m(l,"class",f="textcenter accept "+(t[17].invited?"active":"")+" svelte-6mz3cb"),m(u,"width","15%"),m(u,"class",g="textcenter deny "+(t[17].denied?"active":"")+" svelte-6mz3cb"),m(e,"class","striped"),Pe(e,"cursor","unset")},m(A,M){x(A,e,M),d(e,n),K(i,n,null),d(e,s),d(s,r),d(s,a),d(e,l),d(l,c),d(e,u),d(u,p),v=!0,_||(b=[Q(l,"click",y),Q(u,"click",w),Q(e,"contextmenu",C)],_=!0)},p(A,M){t=A;let F={};M&2&&(F.name=t[17].name),M&2&&(F.level=t[17].level),M&2&&(F.pclass=t[17].class),M&2&&(F.faction=t[17].faction),i.$set(F),(!v||M&2)&&o!==(o=t[17].gearscore+"")&&G(r,o),(!v||M&2&&f!==(f="textcenter accept "+(t[17].invited?"active":"")+" svelte-6mz3cb"))&&m(l,"class",f),(!v||M&2&&g!==(g="textcenter deny "+(t[17].denied?"active":"")+" svelte-6mz3cb"))&&m(u,"class",g)},i(A){v||(P(i.$$.fragment,A),v=!0)},o(A){I(i.$$.fragment,A),v=!1},d(A){A&&k(e),ee(i),_=!1,ut(b)}}}function nV(t){let e;return{c(){e=T("List your party to search for players")},m(n,i){x(n,e,i)},d(n){n&&k(e)}}}function iV(t){let e;return{c(){e=T("Waiting for players...")},m(n,i){x(n,e,i)},d(n){n&&k(e)}}}function K6(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[14]}`,e.__value=n=t[16],Ge(e,e.__value)},m(i,s){x(i,e,s)},p:ce,d(i){i&&k(e)}}}function sV(t){let e,n,i,s,o,r,a,l,c,f,u,p,g,v,_,b,y,w=t[1].listed?"\u{1F441}\uFE0F Unlist":"List",C,A,M,F,V,L,q=[tV,eV],R=[];function z(j,N){return j[1].applications.length===0?0:1}i=z(t,-1),s=R[i]=q[i](t);let E=pe(t[3]),W=[];for(let j=0;j<E.length;j+=1)W[j]=K6(Q6(t,E,j));return{c(){e=h("div"),n=h("div"),s.c(),o=h("div"),r=h("div"),a=h("div"),l=h("small"),l.textContent="Describe your party",c=h("input"),p=h("div"),g=h("small"),g.textContent="Select an activity",v=h("select");for(let j=0;j<W.length;j+=1)W[j].c();b=h("div"),y=h("div"),C=T(w),A=T(" Party"),m(n,"class","listcontainer scrollbar border grey svelte-6mz3cb"),m(l,"class","textprimary"),m(c,"maxlength",f=40),m(c,"class",u="marg-top "+(t[2].role<2||t[1].listed?"disabled":"")),m(c,"type","text"),m(c,"placeholder","Enter Party Message"),m(a,"class","panel-bright"),m(g,"class","textprimary"),m(v,"class",_="btn grey marg-top "+(t[2].role<2||t[1].listed?"disabled":"")),t[1].activity===void 0&&mn(()=>t[12].call(v)),m(p,"class","panel-bright marg-top"),m(r,"class","panel-black "),m(y,"class",M="btn purp textcenter "+(t[2].role<2||t[0]?"disabled":t[1].listed?"active":"")),m(b,"class","panel-black"),m(o,"class","grid"),Pe(o,"grid-template-rows","1fr auto"),m(e,"class","layout svelte-6mz3cb")},m(j,N){x(j,e,N),d(e,n),R[i].m(n,null),d(e,o),d(o,r),d(r,a),d(a,l),d(a,c),Ge(c,t[1].message),d(r,p),d(p,g),d(p,v);for(let U=0;U<W.length;U+=1)W[U]&&W[U].m(v,null);xn(v,t[1].activity,!0),d(o,b),d(b,y),d(y,C),d(y,A),F=!0,V||(L=[Q(c,"input",t[11]),Q(v,"change",t[12]),Q(y,"click",t[4])],V=!0)},p(j,[N]){let U=i;if(i=z(j,N),i===U?R[i].p(j,N):(Te(),I(R[U],1,1,()=>{R[U]=null}),Ee(),s=R[i],s?s.p(j,N):(s=R[i]=q[i](j),s.c()),P(s,1),s.m(n,null)),(!F||N&6&&u!==(u="marg-top "+(j[2].role<2||j[1].listed?"disabled":"")))&&m(c,"class",u),N&2&&c.value!==j[1].message&&Ge(c,j[1].message),N&8){E=pe(j[3]);let ie;for(ie=0;ie<E.length;ie+=1){let re=Q6(j,E,ie);W[ie]?W[ie].p(re,N):(W[ie]=K6(re),W[ie].c(),W[ie].m(v,null))}for(;ie<W.length;ie+=1)W[ie].d(1);W.length=E.length}(!F||N&6&&_!==(_="btn grey marg-top "+(j[2].role<2||j[1].listed?"disabled":"")))&&m(v,"class",_),N&2&&xn(v,j[1].activity),(!F||N&2)&&w!==(w=j[1].listed?"\u{1F441}\uFE0F Unlist":"List")&&G(C,w),(!F||N&7&&M!==(M="btn purp textcenter "+(j[2].role<2||j[0]?"disabled":j[1].listed?"active":"")))&&m(y,"class",M)},i(j){F||(P(s),F=!0)},o(j){I(s),F=!1},d(j){j&&k(e),R[i].d(),it(W,j),V=!1,ut(L)}}}function oV(t,e,n){let i,s;se(t,Gi,y=>n(1,i=y)),se(t,Qn,y=>n(2,s=y));let o=S.ui.party.activities,r,a=!1;ud();let l=async()=>{n(0,a=!0),i.listed?(nt(Gi,i.listed=!1,i),await Ut("/api/party/unlistparty",{},()=>{})):(nt(Gi,i.listed=!0,i),await Ut("/api/party/listparty",{message:i.message,activity:i.activity},()=>{})),n(0,a=!1)},c=y=>{xt("partyinvite",y.name),y.invited=!0,y.denied=!1,Gi.set(i)},f=y=>{y.denied=!0,y.invited=!1,nt(Gi,i.applications=i.applications.filter(w=>w.player!==y.player),i),Ut("/api/party/denyapplication",{player:y.player},()=>{})},u=(y,w)=>{wn.set({x:y.pageX,y:y.pageY,opts:[{name:w.name,css:"disabled"},nn.whisper(w.name)]})},p=(y,w)=>{c(y)},g=(y,w)=>{f(y)},v=(y,w)=>u(w,y);function _(){i.message=this.value,Gi.set(i)}function b(){i.activity=ki(this),Gi.set(i)}return[a,i,s,o,l,c,f,u,p,g,v,_,b]}var $g=class extends we{constructor(e){super(),Ce(this,e,oV,sV,$e,{})}},eF=$g;function tF(t){let e,n,i;return n=new Ot({props:{title:"\u{1F465} Party",$$slots:{default:[lV]},$$scope:{ctx:t}}}),n.$on("close",t[3]),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","absCentered"),Pe(e,"width","750px"),Pe(e,"max-height","50%")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&67&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function rV(t){let e,n;return e=new eF({}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function aV(t){let e,n;return e=new X6({}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function lV(t){let e,n,i,s,o,r,a,l,c,f,u,p=[aV,rV],g=[];function v(_,b){return _[1]===0||_[0].membercount===0?0:1}return r=v(t,-1),a=g[r]=p[r](t),{c(){e=h("div"),n=h("div"),n.textContent="Party List",i=h("div"),s=T("Your Party"),a.c(),l=ge(),m(n,"class","tab"),Do(n,"active",t[1]===0),m(i,"class",o="tab "+(t[0].membercount===0?"disabled":"")),Do(i,"active",t[1]===1),m(e,"class","tab-bar flex")},m(_,b){x(_,e,b),d(e,n),d(e,i),d(i,s),g[r].m(_,b),x(_,l,b),c=!0,f||(u=[Q(n,"click",t[4]),Q(i,"click",t[5])],f=!0)},p(_,b){(!c||b&2)&&Do(n,"active",_[1]===0),(!c||b&1&&o!==(o="tab "+(_[0].membercount===0?"disabled":"")))&&m(i,"class",o),(!c||b&3)&&Do(i,"active",_[1]===1);let y=r;r=v(_,b),r!==y&&(Te(),I(g[y],1,1,()=>{g[y]=null}),Ee(),a=g[r],a||(a=g[r]=p[r](_),a.c()),P(a,1),a.m(l.parentNode,l))},i(_){c||(P(a),c=!0)},o(_){I(a),c=!1},d(_){_&&(k(e),k(l)),g[r].d(_),f=!1,ut(u)}}}function cV(t){let e,n,i=t[2]&&tF(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[2]?i?(i.p(s,o),o&4&&P(i,1)):(i=tF(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function fV(t,e,n){let i,s;se(t,Zi,c=>n(2,i=c)),se(t,Qn,c=>n(0,s=c));let o=0,r=c=>nt(Zi,i=!1,i),a=()=>{n(1,o=0)},l=()=>{n(1,o=1)};return t.$$.update=()=>{t.$$.dirty&1&&s.membercount===0&&n(1,o=0)},[s,o,i,r,a,l]}var Ug=class extends we{constructor(e){super(),Ce(this,e,fV,cV,$e,{})}},nF=Ug;var pd=t=>t.type==="pet"&&t.upgrade>=1?!1:t.stacks===void 0&&t.rolls.length>0&&!Sn[t.type].noupgrade,iF=t=>t<101,md=t=>{if(!pd(t)||t.type==="pet")return 0;let e=rn[t.type+t.tier];return Math.ceil(((1+e.level*(1+t.upgrade))/Sn[t.type].drop)**(1.2+t.upgrade*.2))+100},sF=t=>{if(pd(t)){let e=[];if(t.type==="pet")e.push({type:"box",tier:2});else for(let n=0;n<Math.max(1,t.upgrade);++n)e.push({type:"rune",tier:n,stacks:Math.max(1,Math.min(2,t.upgrade-n))});return e}else return[]};var oF=(t,e,n,i)=>Math.ceil(t.goldValue||(.4*(t.level**1.3+e*.4))**(1.1+e/100)/Sn[t.type].drop)*(n||1)*(i?8:1);var dd=class{constructor(e){this.dbid=e,this.stats=new Map,this.dirty=!0}hydrate(e){if(this.dirty=!1,this.bound=e.bound,this.type=e.type,this.tier=e.tier,this.logic=rn[this.type+this.tier],this.auction=e.auction?new Date(e.auction):void 0,this.auctionprice=e.auctionprice,this.owner=e.name,this.stash=e.stash?new Date(e.stash):void 0,this.logic===void 0)throw"Unknown item "+e.type+e.tier;if(this.upgrade=e.upgrade,this.stats.clear(),e.rolls){if(this.setRolls(e.rolls),this.quality=this.nextRoll(),this.logic.stats){this.logic.stats.forEach((i,s)=>{this.stats.set(s,{type:"base",qual:this.quality,value:Math.floor(i.min+(i.max-i.min)*(this.quality/100)**2+$f[s]*this.upgrade)})});let n=Math.min(4,Math.round((this.quality/100)**1.5*3.6));for(let i=0;i<n;++i){let s=this.nextRoll(),o=-1;for(;o===-1||this.stats.has(o);)o=parseInt(g1(Uk,s/101)),s=(s+5)%100;let r=(this.nextRoll()+this.quality)/2;this.stats.set(o,{type:"bonus",qual:r,value:Math.ceil(Math.max((zf[o].min+(zf[o].max-zf[o].min)*(r/100)**2)*this.logic.level*Sn[this.type].weight,$f[o])+$f[o]*this.upgrade)})}}this.quality=this.logic.quality||this.quality,this.stacks=void 0}else this.stacks=e.stacks,this.quality=this.logic.quality||0;this.gs=0,this.logic.gs?this.gs=this.logic.gs:this.stats.forEach((n,i)=>{if(i===17)return;let s=n.value/$f[i];this.type=="shield"&&n.type=="base"&&(s*=.5),this.type=="orb"&&n.type=="base"&&(s*=.7),this.gs+=s}),this.gs=Math.round(this.gs)}setRolls(e){this.rolls=e,this.currentRoll=0}nextRoll(){if(this.currentRoll==this.rolls.length)throw"roll maximum reached";return this.rolls[this.currentRoll++]}goldValue(e){if(!this.canBeSold())throw"Item cant have value because it cant be sold";return oF(this.logic,this.quality,this.stacks,e)}storeValue(){return this.logic.storeValue||0}medalValue(){return this.logic.medalValue||0}canEquip(e){return i6(e.level,e.skills.skillIdsActive,e.skills.skillIdsLearned,e.class,this.type,this.tier)}canEquipClass(e){return Zl(e.class,this.type,this.tier)}equipReasons(e){let n=[];return this.logic.level&&n.push(["Lv. "+this.logic.level,!0]),n}canBeDropped(){return!Sn[this.type].undroppable&&!this.bound}canBeTraded(){return!this.bound}canBeSold(){return!this.logic.unsellable}getStashTime(){return this.dirty?0:this.stash!==void 0?this.stash.getTime():0}getEquipSlot(){return Sn[this.type].slot!==void 0?Sn[this.type].slot[0]:void 0}};var jg={};Xn(jg,{addExp:()=>Ng,addGold:()=>gd,init:()=>nu,onWorldEnter:()=>uV,tick:()=>pV,values:()=>ys});var ys=new Map,Og=new kt(0,1),hd=0,nu=()=>{ys.set("exp",0),ys.set("gold",0),Og.reset(0),hd=0},uV=nu,pV=t=>{Og.done(D.time)&&(++hd,Og.reset(D.time),mp.set({gold:ys.get("gold"),gph:ys.get("gold")/hd*60*60}),dp.set({exp:ys.get("exp"),exph:ys.get("exp")/hd*60*60}))},Ng=t=>{ys.set("exp",(ys.get("exp")||0)+t)},gd=t=>{ys.set("gold",(ys.get("gold")||0)+t)};var rF=(t,e,n)=>{if(t&&t.type)switch(e){case 13:t.rolls&&t.quality>=70&&Mt(t.quality<90?98:99);case 1:oe.chat[7]&&Nt("inv",S.ui.inventory.pick.replace("$1",gn(t.type,t.tier)),!0),tn(10,100),Mt(Ri[t.type].sound),Pi[12].element="bag"+n,t.type=="book"&&tn(23,100)&&(Pi[24].element="bag"+n);break;case 10:t.rolls&&$o.update(i=>(al.set(t.upgrade-i.upgrade),t));break}},aF=(t,e)=>{if(t&&t.type)switch(e){case 7:oe.chat[8]&&Nt("inv",S.ui.stash.stashed.replace("$1",gn(t.type,t.tier))),Mt(Ri[t.type].sound);break;case 6:cs.set(),Sr.update(n=>!n),oe.chat[8]&&Nt("inv",S.ui.merchant.auctionpost.replace("$1",gn(t.type,t.tier)));break;case 9:oe.chat[8]&&Nt("inv",S.ui.inventory.sold.replace("$1",gn(t.type,t.tier))),Mt(Ri[t.type].sound);break;case 2:oe.chat[7]&&Nt("inv",S.ui.inventory.throw.replace("$1",gn(t.type,t.tier))),Mt(Ri[t.type].sound);break}},iu=(t,e,n,i)=>{n!=0&&Mt(Ri.gold.sound);let s=i+e;switch(n){case 1:oe.chat[9]&&Nt("inv",S.ui.inventory.pick.replace("$1",s),!0),gd(e);break;case 4:Sr.update(o=>!o),oe.chat[10]&&Nt("inv",S.ui.merchant.auctionbuy.replace("$1",s),!0);break;case 12:case 3:oe.chat[10]&&Nt("inv",S.ui.inventory.spend.replace("$1",s),!0);break;case 11:oe.chat[10]&&Nt("inv",S.ui.inventory.death.replace("$1",s),!0);break;case 9:oe.chat[10]&&Nt("inv",S.ui.inventory.receive.replace("$1",s),!0),gd(e);break}};var Xs=class extends dd{constructor(e){super(e)}hydrate(e){super.hydrate(e),e.store?e.store.set(this):console.error("no store for item",e),rF(this,this.reason,e.slot)}equipReasons(e){let n=[];if(this.logic.class!==void 0&&n.push(["Class: "+S.classes[this.logic.class].name,Zl(e.class,this.type,this.tier)]),this.logic.level&&n.push(["Requires Lv. "+this.logic.level,Tg(e.level,this.type,this.tier)]),this.logic.requiredSkill&&n.push(["Must know: "+S.items.book[this.logic.requiredSkill].name,Ig(e.skills.skillIdsActive,this.type,this.tier)]),Zl(e.class,this.type,this.tier)&&this.type=="book"){let i=Dg(e.skills.skillIdsLearned,this.type,this.tier),s=tu(e.skills.skillIdsLearned,this.logic.skillid);n.push([i?"Use book to learn skill":s>=this.logic.skilllevel?"You already know this skill":`Must learn book Lv. ${this.logic.skilllevel} first`,i])}return n}buyReasons(e){let n=[];return this.logic.buyElo!==void 0&&n.push([`Min. Rating: ${Of(this.logic.buyElo)}`,s6(e.elo,this.type,this.tier)]),n}getBestEquipslot(e){let n=Sn[this.type].slot;return n===void 0?void 0:n.find(s=>e.slots.get(s)===void 0)||n[0]}};function lF(t,e,n){let i=t.slice();return i[18]=e[n],i}function cF(t){let e,n,i;return n=new Ot({props:{title:"Blacksmith",pad:"5",icon:"bag",$$slots:{default:[mV]},$$scope:{ctx:t}}}),n.$on("close",t[13]),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","absCentered container textcenter svelte-1u9u6qj")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&2097661&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function fF(t){let e;return{c(){e=h("div")},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function uF(t){let e,n;return e=new bi({props:{pickable:!1,item:t[18],filter:t[18].filter}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&8&&(o.item=i[18]),s&8&&(o.filter=i[18].filter),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function mV(t){let e,n,i=(t[7]||"Place an item into the upgrade slot")+"",s,o,r,a,l,c,f,u,p,g,v,_,b,y,w,C;a=new bi({props:{clearOnMove:!0,invslot:t[0]?t[2]:void 0,pickable:!0,item:$o,filter:t[5]?!0:""}}),a.$on("discard",t[10]),a.$on("move",t[9]);let A=pe(t[3]),M=[];for(let L=0;L<A.length;L+=1)M[L]=uF(lF(t,A,L));let F=L=>I(M[L],1,1,()=>{M[L]=null}),V=null;return A.length||(V=fF(t)),g=new yn({props:{isPrice:!0,amount:t[0]?md(t[0]):0}}),{c(){e=h("h3"),e.textContent="Upgrade Item",n=h("span"),s=T(i),r=h("div"),te(a.$$.fragment),c=h("div"),f=h("span"),f.textContent="Cost:",u=h("div");for(let L=0;L<M.length;L+=1)M[L].c();V&&V.c(),p=h("div"),te(g.$$.fragment),v=h("div"),_=T("Upgrade"),m(e,"class","textwhite"),m(n,"class",o="panel-black upgradetext "+t[8]+" svelte-1u9u6qj"),m(r,"class",l="upgradeslot "+t[6]+" svelte-1u9u6qj"),m(u,"class","panel-black costgrid svelte-1u9u6qj"),Pe(u,"grid-template-columns","repeat("+Math.min(3,t[3].length||1)+", 30px)"),m(v,"class",b="btn primary formatted textcenter upgradebutton "+(t[4]?"":"disabled")+" svelte-1u9u6qj"),m(c,"class","upgrade svelte-1u9u6qj")},m(L,q){x(L,e,q),x(L,n,q),d(n,s),x(L,r,q),K(a,r,null),x(L,c,q),d(c,f),d(c,u);for(let R=0;R<M.length;R+=1)M[R]&&M[R].m(u,null);V&&V.m(u,null),d(c,p),K(g,p,null),d(c,v),d(v,_),y=!0,w||(C=Q(v,"click",t[11]),w=!0)},p(L,q){(!y||q&128)&&i!==(i=(L[7]||"Place an item into the upgrade slot")+"")&&G(s,i),(!y||q&256&&o!==(o="panel-black upgradetext "+L[8]+" svelte-1u9u6qj"))&&m(n,"class",o);let R={};if(q&5&&(R.invslot=L[0]?L[2]:void 0),q&32&&(R.filter=L[5]?!0:""),a.$set(R),(!y||q&64&&l!==(l="upgradeslot "+L[6]+" svelte-1u9u6qj"))&&m(r,"class",l),q&8){A=pe(L[3]);let E;for(E=0;E<A.length;E+=1){let W=lF(L,A,E);M[E]?(M[E].p(W,q),P(M[E],1)):(M[E]=uF(W),M[E].c(),P(M[E],1),M[E].m(u,null))}for(Te(),E=A.length;E<M.length;E+=1)F(E);Ee(),!A.length&&V?V.p(L,q):A.length?V&&(V.d(1),V=null):(V=fF(L),V.c(),V.m(u,null))}(!y||q&8)&&Pe(u,"grid-template-columns","repeat("+Math.min(3,L[3].length||1)+", 30px)");let z={};q&1&&(z.amount=L[0]?md(L[0]):0),g.$set(z),(!y||q&16&&b!==(b="btn primary formatted textcenter upgradebutton "+(L[4]?"":"disabled")+" svelte-1u9u6qj"))&&m(v,"class",b)},i(L){if(!y){P(a.$$.fragment,L);for(let q=0;q<A.length;q+=1)P(M[q]);P(g.$$.fragment,L),y=!0}},o(L){I(a.$$.fragment,L),M=M.filter(Boolean);for(let q=0;q<M.length;q+=1)I(M[q]);I(g.$$.fragment,L),y=!1},d(L){L&&(k(e),k(n),k(r),k(c)),ee(a),it(M,L),V&&V.d(),ee(g),w=!1,C()}}}function dV(t){let e,n,i=t[1]&&cF(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[1]?i?(i.p(s,o),o&2&&P(i,1)):(i=cF(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function hV(t,e,n){let i,s,o,r,a;se(t,al,M=>n(12,i=M)),se(t,$o,M=>n(0,s=M)),se(t,ol,M=>n(14,o=M)),se(t,Hi,M=>n(15,r=M)),se(t,Us,M=>n(1,a=M));let l=M=>{let{from:F,to:V}=M.detail;F!==V&&F.type=="item"&&($o.set(F.item),n(2,f=F.slot))},c=M=>{$o.set(),n(2,f=void 0)},f,u=[],p=!1,g=!1,v=()=>{let M=pd(s),F=r>=md(s),V=iF(f);n(4,p=M&&F&&V);let L=sF(s);L.forEach((q,R)=>{let z=u[R]||n(3,u[R]=ne(),u),E=new Xs;E.hydrate({...q,store:z}),E.stacks!==void 0?z.filter=o[E.type+E.tier]>=E.stacks?"":!0:z.filter=o[E.type+E.tier]>=0?"":!0,z.filter&&n(4,p=!1)}),n(3,u=u.slice(0,L.length)),p||n(7,y="You lack the required materials"),M||n(7,y="This item cannot be upgraded"),F||n(7,y="You do not have enough gold"),V||n(7,y="You must un-equip the item first"),p?(n(8,w="textgreen"),n(7,y="Ready to upgrade")):n(8,w="textred")},_=()=>{s&&p&&!g&&(n(5,g=!0),nt(al,i=void 0,i),n(7,y="Upgrading..."),n(8,w="textprimary"),Mt(100),setTimeout(()=>xt("itemblacksmithupgrade",`${s.dbid}`),1e3))},b,y,w,C=()=>{Mt(i>0?101:102),n(6,b=i>0?"flash_success":"flash_fail"),n(7,y=(i>0?"Success! ":"Fail! ")+(i<0?"-":"+")+i),n(8,w=i>0?"textgreen":"textred")},A=M=>nt(Us,a=!1,a);return t.$$.update=()=>{t.$$.dirty&2&&(a||(nt($o,s=void 0,s),nt(al,i=void 0,i))),t.$$.dirty&1&&(n(4,p=!0),s?v():(n(3,u.length=0,u),n(4,p=!1),n(8,w=void 0),n(7,y=void 0)),n(5,g=!1)),t.$$.dirty&4096&&(i!==void 0?C():(n(6,b=""),n(8,w="")))},[s,a,f,u,p,g,b,y,w,l,c,_,i,A]}var Wg=class extends we{constructor(e){super(),Ce(this,e,hV,dV,$e,{})}},pF=Wg;function gV(t){let e;return{c(){e=h("span")},m(n,i){x(n,e,i),e.innerHTML=t[0]},p(n,[i]){i&1&&(e.innerHTML=n[0])},i:ce,o:ce,d(n){n&&k(e)}}}function vV(t,e,n){let i,{amount:s}=e;return t.$$set=o=>{"amount"in o&&n(1,s=o.amount)},t.$$.update=()=>{t.$$.dirty&2&&n(0,i=Of(s))},[i,s]}var Gg=class extends we{constructor(e){super(),Ce(this,e,vV,gV,Fn,{amount:1})}},vd=Gg;var Hg=Ul({0:{6:2,8:.3},1:{6:4,12:1},2:{14:.5},3:{14:.4,7:.8},4:{16:.3,7:.8},5:{14:.2,18:.3}});var mF=t=>1+t/1e3;function _V(t){let e,n=S.ui.stats.array[t[1]]+"",i,s,o=(t[3]?"+"+ii(t[1],t[0].get(t[2]).get(t[1])):ii(t[1],t[4][t[1]]||0))+"",r,a;return{c(){e=h("span"),i=T(n),s=h("span"),r=T(o),m(s,"class",a="statnumber "+(t[3]?"textgreen":t[0]?"textprimary":"textgreen"))},m(l,c){x(l,e,c),d(e,i),x(l,s,c),d(s,r)},p(l,[c]){c&2&&n!==(n=S.ui.stats.array[l[1]]+"")&&G(i,n),c&31&&o!==(o=(l[3]?"+"+ii(l[1],l[0].get(l[2]).get(l[1])):ii(l[1],l[4][l[1]]||0))+"")&&G(r,o),c&9&&a!==(a="statnumber "+(l[3]?"textgreen":l[0]?"textprimary":"textgreen"))&&m(s,"class",a)},i:ce,o:ce,d(l){l&&(k(e),k(s))}}}function bV(t,e,n){let i,s;se(t,Uo,l=>n(4,s=l));let{relmap:o}=e,{id:r}=e,{relation:a=void 0}=e;return t.$$set=l=>{"relmap"in l&&n(0,o=l.relmap),"id"in l&&n(1,r=l.id),"relation"in l&&n(2,a=l.relation)},t.$$.update=()=>{t.$$.dirty&7&&n(3,i=a!==void 0&&o.get(a).get(r)!==void 0)},[o,r,a,i,s]}var Yg=class extends we{constructor(e){super(),Ce(this,e,bV,_V,$e,{relmap:0,id:1,relation:2})}},_d=Yg;var Fo=[4e3,8e3,12e3,16e3,2e4,24e3,28e3,32e3,36e3,4e4,44e3,48e3];var cr=Fo.length,Jl=t=>{for(let e=0;e<cr;++e)if(Fo[e]>t)return e;return Math.max(0,cr)},yd=t=>t===0?0:Fo[t-1],Xg=t=>{for(let e=0;e<cr;++e)if(Fo[e]>t)return Fo[e];return Fo[cr-1]},bd=[1,.8,.63,.479,.342,.23,.146,.085,.045,.024,.01,.003,0],nfe=bd.map(t=>1-t);var su=t=>t===0?"No Bracket":t===bd.length?bd.length+" (Faction Leader)":`${t} (Top ${(bd[t-1]*100).toFixed(1)}%)`;function dF(t,e,n){let i=t.slice();return i[12]=e[n],i[14]=n,i}function hF(t,e,n){let i=t.slice();return i[15]=e[n],i}function gF(t,e,n){let i=t.slice();return i[18]=e[n],i[20]=n,i}function vF(t,e,n){let i=t.slice();return i[15]=e[n],i}function _F(t){let e,n,i;return n=new Ot({props:{title:S.ui.headers.character,icon:"char",$$slots:{default:[yV]},$$scope:{ctx:t}}}),n.$on("close",t[11]),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","l-upperLeftModal container uiscaled svelte-ggsnc")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&8388727&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function bF(t){let e,n,i,s,o,r,a;e=new _d({props:{id:t[15]}});function l(...f){return t[8](t[15],...f)}function c(...f){return t[10](t[15],...f)}return{c(){te(e.$$.fragment),n=h("img"),at(n.src,i="/data/ui/icons/arrow.svg?v=8582889")||m(n,"src",i),m(n,"class",s="btn "+(t[0][22]>0?"green":"disabled")+" svgicon statbtn svelte-ggsnc")},m(f,u){K(e,f,u),x(f,n,u),o=!0,r||(a=[Q(n,"pointerenter",l),Q(n,"pointerleave",t[9]),Q(n,"click",c)],r=!0)},p(f,u){t=f,(!o||u&1&&s!==(s="btn "+(t[0][22]>0?"green":"disabled")+" svgicon statbtn svelte-ggsnc"))&&m(n,"class",s)},i(f){o||(P(e.$$.fragment,f),o=!0)},o(f){I(e.$$.fragment,f),o=!1},d(f){f&&k(n),ee(e,f),r=!1,ut(a)}}}function yF(t){let e,n;return e=new bi({props:{descPos:"left:100%;top:0;",item:t[18],invslot:101+t[20]}}),e.$on("use",FF),e.$on("context",FF),e.$on("move",xV),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&64&&(o.item=i[18]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function kF(t){let e,n;return e=new _d({props:{id:t[15],relmap:Zg,relation:t[1]}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&2&&(o.relation=i[1]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function xF(t){let e,n,i=pe(t[12]),s=[];for(let r=0;r<i.length;r+=1)s[r]=kF(hF(t,i,r));let o=r=>I(s[r],1,1,()=>{s[r]=null});return{c(){e=h("div");for(let r=0;r<s.length;r+=1)s[r].c();m(e,"class","statcol panel-black svelte-ggsnc")},m(r,a){x(r,e,a);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null);n=!0},p(r,a){if(a&2){i=pe(r[12]);let l;for(l=0;l<i.length;l+=1){let c=hF(r,i,l);s[l]?(s[l].p(c,a),P(s[l],1)):(s[l]=kF(c),s[l].c(),P(s[l],1),s[l].m(e,null))}for(Te(),l=i.length;l<s.length;l+=1)o(l);Ee()}},i(r){if(!n){for(let a=0;a<i.length;a+=1)P(s[a]);n=!0}},o(r){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)I(s[a]);n=!1},d(r){r&&k(e),it(s,r)}}}function yV(t){let e,n,i,s,o=t[4].name+"",r,a,l,c=t[4].level+"",f,u,p,g,v,_,b=S.classes[t[4].class].name+"",y,w,C,A,M,F,V,L=S.factions[t[4].faction].name+"",q,R,z,E,W,j,N,U=ht(t[0][20]||0)+"",ie,re,ae=t[2]<cr?"/ "+ni(Fo[t[2]]):"",ue,Me,me=S.ui.charpanel.rank+"",Ne,De,Fe,_e,H,qe,Oe,He,Ye,Ze,ve,le,ze,Z,X,$,fe;Ye=new vd({props:{amount:t[0][21]||0}}),ve=new or({props:{amount:t[5],isPrice:!1}});let je=pe([0,1,2,3,4,5]),Ve=[];for(let be=0;be<6;be+=1)Ve[be]=bF(vF(t,je,be));let ye=be=>I(Ve[be],1,1,()=>{Ve[be]=null});Z=new _d({props:{id:22}});let Re=pe(t[6].filter(CF)),Be=[];for(let be=0;be<Re.length;be+=1)Be[be]=yF(gF(t,Re,be));let mt=be=>I(Be[be],1,1,()=>{Be[be]=null}),wt=pe(MF),Qe=[];for(let be=0;be<wt.length;be+=1)Qe[be]=xF(dF(t,wt,be));let Et=be=>I(Qe[be],1,1,()=>{Qe[be]=null});return{c(){e=h("div"),n=h("div"),i=h("span"),i.textContent=`${S.ui.charpanel.name}`,s=h("span"),r=T(o),a=h("span"),a.textContent=`${S.ui.charpanel.level}`,l=h("span"),f=T(c),u=h("span"),u.textContent=`${S.ui.charpanel.class}`,p=h("span"),g=h("img"),_=Ue(),y=T(b),C=h("span"),C.textContent=`${S.ui.charpanel.faction}`,A=h("span"),M=h("img"),V=Ue(),q=T(L),z=h("span"),z.textContent=`${S.ui.stats.array[20]}`,E=h("span"),W=h("img"),N=Ue(),ie=T(U),re=Ue(),ue=T(ae),Me=T(" ("),Ne=T(me),De=Ue(),Fe=T(t[2]),_e=T("/"),H=T(cr),qe=T(")"),Oe=h("span"),Oe.textContent=`${S.ui.charpanel.rating}`,He=h("span"),te(Ye.$$.fragment),Ze=h("span"),Ze.textContent=`${S.ui.charpanel.medals}`,te(ve.$$.fragment),le=h("div");for(let be=0;be<6;be+=1)Ve[be].c();ze=ge(),te(Z.$$.fragment),X=h("div");for(let be=0;be<Be.length;be+=1)Be[be].c();$=h("div");for(let be=0;be<Qe.length;be+=1)Qe[be].c();m(s,"class","bold textwhite"),m(l,"class","bold textwhite"),m(g,"class","texticon"),at(g.src,v=Ys(t[4].class))||m(g,"src",v),m(p,"class",w="bold "+("textc"+t[4].class)+" svelte-ggsnc"),m(M,"class","texticon"),at(M.src,F=M1(t[4].faction))||m(M,"src",F),m(A,"class",R="bold "+("textf"+t[4].faction)+" svelte-ggsnc"),m(W,"class","texticon"),at(W.src,j=$l)||m(W,"src",j),m(E,"class","bold textprestige"),m(n,"class","statcol panel-black svelte-ggsnc"),Pe(n,"grid-template-columns","1fr 2fr"),m(le,"id","statpoints"),m(le,"class","statcol panel-black svelte-ggsnc"),Pe(le,"grid-template-columns","1fr auto auto"),m(e,"class","grid"),Pe(e,"grid-template-columns","3fr 2fr"),m(X,"id","equipslots"),m(X,"class","items svelte-ggsnc"),m($,"class","grid three stats2 svelte-ggsnc")},m(be,Je){x(be,e,Je),d(e,n),d(n,i),d(n,s),d(s,r),d(n,a),d(n,l),d(l,f),d(n,u),d(n,p),d(p,g),d(p,_),d(p,y),d(n,C),d(n,A),d(A,M),d(A,V),d(A,q),d(n,z),d(n,E),d(E,W),d(E,N),d(E,ie),d(E,re),d(E,ue),d(E,Me),d(E,Ne),d(E,De),d(E,Fe),d(E,_e),d(E,H),d(E,qe),d(n,Oe),d(n,He),K(Ye,He,null),d(n,Ze),K(ve,n,null),d(e,le);for(let yt=0;yt<6;yt+=1)Ve[yt]&&Ve[yt].m(le,null);d(le,ze),K(Z,le,null),x(be,X,Je);for(let yt=0;yt<Be.length;yt+=1)Be[yt]&&Be[yt].m(X,null);x(be,$,Je);for(let yt=0;yt<Qe.length;yt+=1)Qe[yt]&&Qe[yt].m($,null);fe=!0},p(be,Je){(!fe||Je&16)&&o!==(o=be[4].name+"")&&G(r,o),(!fe||Je&16)&&c!==(c=be[4].level+"")&&G(f,c),(!fe||Je&16&&!at(g.src,v=Ys(be[4].class)))&&m(g,"src",v),(!fe||Je&16)&&b!==(b=S.classes[be[4].class].name+"")&&G(y,b),(!fe||Je&16&&w!==(w="bold "+("textc"+be[4].class)+" svelte-ggsnc"))&&m(p,"class",w),(!fe||Je&16&&!at(M.src,F=M1(be[4].faction)))&&m(M,"src",F),(!fe||Je&16)&&L!==(L=S.factions[be[4].faction].name+"")&&G(q,L),(!fe||Je&16&&R!==(R="bold "+("textf"+be[4].faction)+" svelte-ggsnc"))&&m(A,"class",R),(!fe||Je&1)&&U!==(U=ht(be[0][20]||0)+"")&&G(ie,U),(!fe||Je&4)&&ae!==(ae=be[2]<cr?"/ "+ni(Fo[be[2]]):"")&&G(ue,ae),(!fe||Je&4)&&G(Fe,be[2]);let yt={};Je&1&&(yt.amount=be[0][21]||0),Ye.$set(yt);let St={};if(Je&32&&(St.amount=be[5]),ve.$set(St),Je&131){je=pe([0,1,2,3,4,5]);let Ae;for(Ae=0;Ae<6;Ae+=1){let ct=vF(be,je,Ae);Ve[Ae]?(Ve[Ae].p(ct,Je),P(Ve[Ae],1)):(Ve[Ae]=bF(ct),Ve[Ae].c(),P(Ve[Ae],1),Ve[Ae].m(le,ze))}for(Te(),Ae=6;Ae<6;Ae+=1)ye(Ae);Ee()}if(Je&64){Re=pe(be[6].filter(CF));let Ae;for(Ae=0;Ae<Re.length;Ae+=1){let ct=gF(be,Re,Ae);Be[Ae]?(Be[Ae].p(ct,Je),P(Be[Ae],1)):(Be[Ae]=yF(ct),Be[Ae].c(),P(Be[Ae],1),Be[Ae].m(X,null))}for(Te(),Ae=Re.length;Ae<Be.length;Ae+=1)mt(Ae);Ee()}if(Je&2){wt=pe(MF);let Ae;for(Ae=0;Ae<wt.length;Ae+=1){let ct=dF(be,wt,Ae);Qe[Ae]?(Qe[Ae].p(ct,Je),P(Qe[Ae],1)):(Qe[Ae]=xF(ct),Qe[Ae].c(),P(Qe[Ae],1),Qe[Ae].m($,null))}for(Te(),Ae=wt.length;Ae<Qe.length;Ae+=1)Et(Ae);Ee()}},i(be){if(!fe){P(Ye.$$.fragment,be),P(ve.$$.fragment,be);for(let Je=0;Je<6;Je+=1)P(Ve[Je]);P(Z.$$.fragment,be);for(let Je=0;Je<Re.length;Je+=1)P(Be[Je]);for(let Je=0;Je<wt.length;Je+=1)P(Qe[Je]);fe=!0}},o(be){I(Ye.$$.fragment,be),I(ve.$$.fragment,be),Ve=Ve.filter(Boolean);for(let Je=0;Je<6;Je+=1)I(Ve[Je]);I(Z.$$.fragment,be),Be=Be.filter(Boolean);for(let Je=0;Je<Be.length;Je+=1)I(Be[Je]);Qe=Qe.filter(Boolean);for(let Je=0;Je<Qe.length;Je+=1)I(Qe[Je]);fe=!1},d(be){be&&(k(e),k(X),k($)),ee(Ye),ee(ve),it(Ve,be),ee(Z),it(Be,be),it(Qe,be)}}}function kV(t){let e,n,i=t[3]&&t[4].visible&&_F(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[3]&&s[4].visible?i?(i.p(s,o),o&24&&P(i,1)):(i=_F(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}var wF=!1,Zg=new Map;Hg.forEach((t,e)=>{let n=new Map;t.forEach((i,s)=>{n.set(s,i)}),Zg.set(e,n)});var MF=[[6,8,7,9,12,13],[10,11,17,14,16],[15,19,18,25,26]],xV=t=>{let{from:e,to:n}=t.detail;e!==n&&e.type=="item"&&xt("itemmove",`${e.slot} ${n.slot}`)},FF=t=>{let{item:e}=t.detail;if(e!==void 0){let n=D.player.inventory.getFirstEmptySlot();n>=0&&xt("itemmove",`${t.detail.slot} ${n}`)}},CF=(t,e)=>e>=101;function wV(t,e,n){let i,s,o,r,a,l;se(t,Uo,_=>n(0,s=_)),se(t,po,_=>n(3,o=_)),se(t,Rs,_=>n(4,r=_)),se(t,il,_=>n(5,a=_)),se(t,sl,_=>n(6,l=_)),D&&D.player&&!wF&&(wF=!0,ha.forEach((_,b)=>{b-61==D.player.class&&_.statsConvert&&_.statsConvert.forEach(y=>{let w=Hg.get(y[0])||new Map;w.set(y[2],(w.get(y[2])||0)+y[1]),Zg.set(y[0],w)})}));let c,f=_=>{s[22]&&(xt("statincrease",_+" "+(tt.shift.down?10:1)),n(1,c=void 0),tn(18,50))},u=(_,b)=>n(1,c=_),p=_=>n(1,c=void 0),g=(_,b)=>f(_),v=()=>{nt(po,o=!1,o)};return t.$$.update=()=>{t.$$.dirty&1&&n(2,i=Jl(s[20]||0))},[s,c,i,o,r,a,l,f,u,p,g,v]}var Qg=class extends we{constructor(e){super(),Ce(this,e,wV,kV,$e,{})}},SF=Qg;function AF(t,e,n){let i=t.slice();return i[16]=e[n],i}function MV(t){let e,n,i=t[4].listed?"\u{1F441}\uFE0F ":"",s,o=t[2].membercount+"",r,a,l,c,f;return{c(){e=h("div"),n=h("span"),s=T(i),r=T(o),a=T("/10"),m(e,"id","partybtn"),m(e,"class",l="btn border black textgreen "+(t[4].flashing?"flashing":"")+" svelte-14vfgvr")},m(u,p){x(u,e,p),d(e,n),d(n,s),d(e,r),d(e,a),c||(f=Q(e,"click",t[11]),c=!0)},p(u,p){p&16&&i!==(i=u[4].listed?"\u{1F441}\uFE0F ":"")&&G(s,i),p&4&&o!==(o=u[2].membercount+"")&&G(r,o),p&16&&l!==(l="btn border black textgreen "+(u[4].flashing?"flashing":"")+" svelte-14vfgvr")&&m(e,"class",l)},d(u){u&&k(e),c=!1,f()}}}function FV(t){let e,n,i;return{c(){e=h("div"),e.textContent=`${S.ui.party.noParty}`,m(e,"id","partybtn"),m(e,"class","btn border black textgrey")},m(s,o){x(s,e,o),n||(i=Q(e,"click",t[10]),n=!0)},p:ce,d(s){s&&k(e),n=!1,i()}}}function CV(t){let e=t[2].exprate+"",n,i,s=t[2].membercount===0?"":"/"+t[2].nearby,o;return{c(){n=T(e),i=T("% EXP"),o=T(s)},m(r,a){x(r,n,a),x(r,i,a),x(r,o,a)},p(r,a){a&4&&e!==(e=r[2].exprate+"")&&G(n,e),a&4&&s!==(s=r[2].membercount===0?"":"/"+r[2].nearby)&&G(o,s)},d(r){r&&(k(n),k(i),k(o))}}}function SV(t){let e=ht(~~t[1].exph)+"",n,i;return{c(){n=T(e),i=T(" EXP / h")},m(s,o){x(s,n,o),x(s,i,o)},p(s,o){o&2&&e!==(e=ht(~~s[1].exph)+"")&&G(n,e)},d(s){s&&(k(n),k(i))}}}function AV(t){let e=t[2].itemfind+"",n,i;return{c(){n=T(e),i=T("% FIND")},m(s,o){x(s,n,o),x(s,i,o)},p(s,o){o&4&&e!==(e=s[2].itemfind+"")&&G(n,e)},i:ce,o:ce,d(s){s&&(k(n),k(i))}}}function PV(t){let e,n,i;return e=new yn({props:{amount:Math.round(t[0].gph)}}),{c(){te(e.$$.fragment),n=T(" / h")},m(s,o){K(e,s,o),x(s,n,o),i=!0},p(s,o){let r={};o&1&&(r.amount=Math.round(s[0].gph)),e.$set(r)},i(s){i||(P(e.$$.fragment,s),i=!0)},o(s){I(e.$$.fragment,s),i=!1},d(s){s&&k(n),ee(e,s)}}}function PF(t,e){let n,i,s;return i=new Jf({props:{mode:"party",unit:e[16].unitStore,buffs:e[16].buffStore}}),{key:t,first:null,c(){n=ge(),te(i.$$.fragment),this.first=n},m(o,r){x(o,n,r),K(i,o,r),s=!0},p(o,r){e=o;let a={};r&256&&(a.unit=e[16].unitStore),r&256&&(a.buffs=e[16].buffStore),i.$set(a)},i(o){s||(P(i.$$.fragment,o),s=!0)},o(o){I(i.$$.fragment,o),s=!1},d(o){o&&k(n),ee(i,o)}}}function TV(t){let e,n,i,s,o,r,a,l,c,f=[],u=new Map,p,g,v;function _(R,z){return R[2].membercount===0?FV:MV}let b=_(t,-1),y=b(t);function w(R,z){return R[5]?SV:CV}let C=w(t,-1),A=C(t),M=[PV,AV],F=[];function V(R,z){return R[6]?0:1}r=V(t,-1),a=F[r]=M[r](t);let L=pe(t[8]),q=R=>R[16].name;for(let R=0;R<L.length;R+=1){let z=AF(t,L,R),E=q(z);u.set(E,f[R]=PF(E,z))}return{c(){e=h("div"),n=h("div"),i=h("div"),i.textContent=`\u{1F465} ${S.ui.party.name}`,y.c(),s=h("div"),A.c(),o=h("div"),a.c(),l=Ue(),c=h("div");for(let R=0;R<f.length;R+=1)f[R].c();m(i,"class","btn party"),m(s,"class","btn border black textexp"),m(o,"class","btn border black textcyan"),m(n,"class","btnbar"),m(c,"class","partyframes svelte-14vfgvr"),Pe(c,"width",t[7]+"px"),m(e,"class","l-corner-ul uiscaled")},m(R,z){x(R,e,z),d(e,n),d(n,i),y.m(n,null),d(n,s),A.m(s,null),d(n,o),F[r].m(o,null),d(e,l),d(e,c);for(let E=0;E<f.length;E+=1)f[E]&&f[E].m(c,null);p=!0,g||(v=[Q(i,"click",t[9]),Q(s,"click",t[12]),Q(s,"contextmenu",nu),Q(o,"click",t[13]),Q(o,"contextmenu",nu)],g=!0)},p(R,[z]){b===(b=_(R,z))&&y?y.p(R,z):(y.d(1),y=b(R),y&&(y.c(),y.m(n,s))),C===(C=w(R,z))&&A?A.p(R,z):(A.d(1),A=C(R),A&&(A.c(),A.m(s,null)));let E=r;r=V(R,z),r===E?F[r].p(R,z):(Te(),I(F[E],1,1,()=>{F[E]=null}),Ee(),a=F[r],a?a.p(R,z):(a=F[r]=M[r](R),a.c()),P(a,1),a.m(o,null)),z&256&&(L=pe(R[8]),Te(),f=ui(f,z,q,1,R,L,u,c,Ii,PF,null,AF),Ee()),(!p||z&128)&&Pe(c,"width",R[7]+"px")},i(R){if(!p){P(a);for(let z=0;z<L.length;z+=1)P(f[z]);p=!0}},o(R){I(a);for(let z=0;z<f.length;z+=1)I(f[z]);p=!1},d(R){R&&k(e),y.d(),A.d(),F[r].d();for(let z=0;z<f.length;z+=1)f[z].d();g=!1,ut(v)}}}function EV(t,e,n){let i,s,o,r,a,l,c,f,u;se(t,mp,C=>n(0,i=C)),se(t,dp,C=>n(1,s=C)),se(t,Qn,C=>n(2,o=C)),se(t,Zi,C=>n(3,r=C)),se(t,Gi,C=>n(4,a=C)),se(t,Kc,C=>n(5,l=C)),se(t,Jc,C=>n(6,c=C)),se(t,Xr,C=>n(7,f=C)),se(t,tl,C=>n(8,u=C));let p=C=>{let A=[{name:"Party Panel",fun:()=>{nt(Zi,r=!0,r)}},o.membercount?nn.partyleave():nn.partycreate()];wn.set({x:C.pageX,y:C.pageY,opts:A})},g=()=>{console.log(s)},v=()=>{console.log(i)};return[i,s,o,r,a,l,c,f,u,p,C=>nt(Zi,r=!r,r),C=>nt(Zi,r=!r,r),C=>{nt(Kc,l=!l,l)},C=>{nt(Jc,c=!c,c)}]}var Jg=class extends we{constructor(e){super(),Ce(this,e,EV,TV,$e,{})}},TF=Jg;function DV(t){let e;return{c(){e=h("div"),m(e,"class","pattern svelte-1m0q37p")},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function IV(t){let e,n,i;return n=new vi({props:{size:"0.8em",fract:t[0],barcol:"bgexp",left:t[1],right:`${t[0]}%`,$$slots:{default:[DV]},$$scope:{ctx:t}}}),{c(){e=h("div"),te(n.$$.fragment),m(e,"id","expbar"),m(e,"class","container svelte-1m0q37p")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,[o]){let r={};o&1&&(r.fract=s[0]),o&2&&(r.left=s[1]),o&1&&(r.right=`${s[0]}%`),o&8&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function VV(t,e,n){let i;se(t,rp,r=>n(2,i=r));let s,o;return t.$$.update=()=>{t.$$.dirty&4&&(n(0,s=(100*i.current/i.max).toFixed(2)),n(1,o=`${ht(i.current)} / ${ht(i.max)} EXP`))},[s,o,i]}var Kg=class extends we{constructor(e){super(),Ce(this,e,VV,IV,$e,{})}},EF=Kg;function DF(t){let e,n,i=t[5].msg+"",s,o,r,a=t[5].fixed||t[5].step||t[5].fixed?"Skip":"Next",l,c,f,u,p,g=(t[5].fixed||t[5].step||t[5].fixed)&&IF(t);return{c(){e=h("div"),n=h("div"),g&&g.c(),s=h("div"),o=h("div"),o.textContent="Disable tutorial",r=h("div"),l=T(a),m(n,"class","textprimary msgtext svelte-wv9du9"),m(o,"class","btn grey"),m(r,"class","btn green"),m(s,"class","marg-top"),Pe(s,"display","flex"),Pe(s,"justify-content","space-between"),m(e,"class",c="msg "+(t[5].complete?"complete":"")+" svelte-wv9du9"),Pe(e,"cursor","pointer")},m(v,_){x(v,e,_),d(e,n),n.innerHTML=i,g&&g.m(e,null),d(e,s),d(s,o),d(s,r),d(r,l),f=!0,u||(p=[Q(o,"click",t[6]),Q(e,"click",t[7])],u=!0)},p(v,_){(!f||_&32)&&i!==(i=v[5].msg+"")&&(n.innerHTML=i),v[5].fixed||v[5].step||v[5].fixed?g?(g.p(v,_),_&32&&P(g,1)):(g=IF(v),g.c(),P(g,1),g.m(e,s)):g&&(Te(),I(g,1,1,()=>{g=null}),Ee()),(!f||_&32)&&a!==(a=v[5].fixed||v[5].step||v[5].fixed?"Skip":"Next")&&G(l,a),(!f||_&32&&c!==(c="msg "+(v[5].complete?"complete":"")+" svelte-wv9du9"))&&m(e,"class",c)},i(v){f||(P(g),f=!0)},o(v){I(g),f=!1},d(v){v&&k(e),g&&g.d(),u=!1,ut(p)}}}function IF(t){let e,n;return e=new vi({props:{size:"0.8em",fract:t[5].progress,barcol:"bgtut",left:"",right:Math.ceil(t[5].progress)+"%"}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&32&&(o.fract=i[5].progress),s&32&&(o.right=Math.ceil(i[5].progress)+"%"),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function VF(t){let e,n;return{c(){e=h("div"),m(e,"class",n="border skill tut "+(t[5].complete?"complete":"")+" svelte-wv9du9"),Pe(e,"top",t[2]+"px"),Pe(e,"left",t[1]+"px"),Pe(e,"width",t[3]+"px"),Pe(e,"height",t[4]+"px")},m(i,s){x(i,e,s)},p(i,s){s&32&&n!==(n="border skill tut "+(i[5].complete?"complete":"")+" svelte-wv9du9")&&m(e,"class",n),s&4&&Pe(e,"top",i[2]+"px"),s&2&&Pe(e,"left",i[1]+"px"),s&8&&Pe(e,"width",i[3]+"px"),s&16&&Pe(e,"height",i[4]+"px")},d(i){i&&k(e)}}}function LV(t){let e,n,i,s=t[5]&&t[5].msg&&DF(t),o=t[0]&&VF(t);return{c(){s&&s.c(),e=ge(),o&&o.c(),n=ge()},m(r,a){s&&s.m(r,a),x(r,e,a),o&&o.m(r,a),x(r,n,a),i=!0},p(r,[a]){r[5]&&r[5].msg?s?(s.p(r,a),a&32&&P(s,1)):(s=DF(r),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(Te(),I(s,1,1,()=>{s=null}),Ee()),r[0]?o?o.p(r,a):(o=VF(r),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},i(r){i||(P(s),i=!0)},o(r){I(s),i=!1},d(r){r&&(k(e),k(n)),s&&s.d(r),o&&o.d(r)}}}function qV(t,e,n){let i;se(t,zo,u=>n(5,i=u));let s=!1,o,r,a,l;return zo.subscribe(u=>{if(u){let p=document.getElementById(u.element);if(p){n(0,s=!0);let g=p.getBoundingClientRect();n(3,a=g.width+10),n(4,l=g.height+10),n(1,o=g.x-5),n(2,r=g.y-5)}else n(0,s=!1)}else n(0,s=!1)}),[s,o,r,a,l,i,u=>Os.set(1e3),u=>{tn(-1,100)}]}var ev=class extends we{constructor(e){super(),Ce(this,e,qV,LV,$e,{})}},LF=ev;function RV(t,e,n){let i=t.slice();return i[7]=e[n],i[9]=n,i}function qF(t){let e,n,i;return n=new Ot({props:{title:"Report a player",$$slots:{default:[UV]},$$scope:{ctx:t}}}),n.$on("close",t[4]),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","absCentered"),Pe(e,"z-index","8")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&1031&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function BV(t){let e,n;return{c(){e=h("option"),e.textContent=`${t[7]}`,e.__value=n=t[9],Ge(e,e.__value)},m(i,s){x(i,e,s)},p:ce,d(i){i&&k(e)}}}function RF(t){let e,n=t[2].info+"",i;return{c(){e=h("p"),i=T(n),m(e,"class","textprimary")},m(s,o){x(s,e,o),d(e,i)},p(s,o){o&4&&n!==(n=s[2].info+"")&&G(i,n)},d(s){s&&k(e)}}}function zV(t){let e,n=(t[0].result==="ok"?"Report submitted.":t[0].result)+"",i,s,o,r,a,l;return{c(){e=h("p"),i=T(n),o=h("div"),r=h("div"),r.textContent="Close",m(e,"class",s=t[0].result==="ok"?"textgreen":"textred"),m(r,"class","btn grey navbtn"),m(o,"class","subnav")},m(c,f){x(c,e,f),d(e,i),x(c,o,f),d(o,r),a||(l=Q(r,"click",t[4]),a=!0)},p(c,f){f&1&&n!==(n=(c[0].result==="ok"?"Report submitted.":c[0].result)+"")&&G(i,n),f&1&&s!==(s=c[0].result==="ok"?"textgreen":"textred")&&m(e,"class",s)},d(c){c&&(k(e),k(o)),a=!1,l()}}}function $V(t){let e,n,i,s,o,r,a,l,c;return{c(){e=h("div"),n=h("div"),i=T("Report"),o=h("div"),r=T("Cancel"),m(n,"class",s="btn grey navbtn "+(t[1]?"disabled":"")),m(o,"class",a="btn grey navbtn "+(t[1]?"disabled":"")),m(e,"class","subnav")},m(f,u){x(f,e,u),d(e,n),d(n,i),d(e,o),d(o,r),l||(c=[Q(n,"click",t[3]),Q(o,"click",t[4])],l=!0)},p(f,u){u&2&&s!==(s="btn grey navbtn "+(f[1]?"disabled":""))&&m(n,"class",s),u&2&&a!==(a="btn grey navbtn "+(f[1]?"disabled":""))&&m(o,"class",a)},d(f){f&&k(e),l=!1,ut(c)}}}function UV(t){let e,n,i,s,o=t[2].name+"",r,a,l,c,f,u,p,g=S.ui.report.info[t[2].reason]+"",v,_,b,y,w,C,A,M,F=pe(S.ui.report.reasons),V=[];for(let E=0;E<F.length;E+=1)V[E]=BV(RV(t,F,E));let L=t[2].info&&RF(t);function q(E,W){return E[0]?zV:$V}let R=q(t,-1),z=R(t);return{c(){e=h("div"),n=h("p"),i=T("Describe what happened with "),s=h("span"),r=T(o),a=T(" as accurately as you can:"),l=h("div"),c=h("select");for(let E=0;E<V.length;E+=1)V[E].c();u=h("p"),p=h("small"),v=T(g),L&&L.c(),_=h("div"),b=h("textarea"),C=h("p"),C.innerHTML='<small>Please do not file false reports. If you are unsure about a players behavior, refer to our <a href="/terms" target="_blank">Conduct Policy</a>.</small>',z.c(),m(s,"class","textprimary"),m(c,"class",f=t[1]?"disabled":""),t[2].reason===void 0&&mn(()=>t[5].call(c)),m(l,"class","subnav"),m(u,"class","textgrey"),m(b,"maxlength",y=300),m(b,"class",w="scrollbar reportdescription "+(t[1]?"disabled":"")+" svelte-jnzoj3"),m(b,"rows","4"),m(b,"placeholder","Provide additional context, a little description of the situation helps our moderators."),m(_,"class","subnav"),m(C,"class","textgrey"),m(e,"class","card container svelte-jnzoj3")},m(E,W){x(E,e,W),d(e,n),d(n,i),d(n,s),d(s,r),d(n,a),d(e,l),d(l,c);for(let j=0;j<V.length;j+=1)V[j]&&V[j].m(c,null);xn(c,t[2].reason,!0),d(e,u),d(u,p),d(p,v),L&&L.m(e,null),d(e,_),d(_,b),Ge(b,t[2].description),d(e,C),z.m(e,null),A||(M=[Q(c,"change",t[5]),Q(b,"input",t[6])],A=!0)},p(E,W){W&4&&o!==(o=E[2].name+"")&&G(r,o),W&2&&f!==(f=E[1]?"disabled":"")&&m(c,"class",f),W&4&&xn(c,E[2].reason),W&4&&g!==(g=S.ui.report.info[E[2].reason]+"")&&G(v,g),E[2].info?L?L.p(E,W):(L=RF(E),L.c(),L.m(e,_)):L&&(L.d(1),L=null),W&2&&w!==(w="scrollbar reportdescription "+(E[1]?"disabled":"")+" svelte-jnzoj3")&&m(b,"class",w),W&4&&Ge(b,E[2].description),R===(R=q(E,W))&&z?z.p(E,W):(z.d(1),z=R(E),z&&(z.c(),z.m(e,null)))},d(E){E&&k(e),it(V,E),L&&L.d(),z.d(),A=!1,ut(M)}}}function OV(t){let e,n,i=t[2]!==void 0&&qF(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[2]!==void 0?i?(i.p(s,o),o&4&&P(i,1)):(i=qF(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function NV(t,e,n){let i;se(t,oo,f=>n(2,i=f));let s,o=!1,r=async()=>{n(1,o=!0),n(0,s=await Ut("/api/report/submit",{name:i.name,reason:i.reason,messageId:i.messageId,description:i.description||""}))},a=()=>{nt(oo,i=void 0,i),n(0,s=void 0),n(1,o=void 0)};function l(){i.reason=ki(this),oo.set(i)}function c(){i.description=this.value,oo.set(i)}return[s,o,i,r,a,l,c]}var tv=class extends we{constructor(e){super(),Ce(this,e,NV,OV,$e,{})}},BF=tv;var _a=t=>Math.round((10+t*5)**1.85/50)*50,ba=t=>Math.min(100,8+t*2);var zF=(t,e=200)=>{let n;return(i,s)=>{n&&clearTimeout(n),n=setTimeout(o=>t(i),s??e)}};function $F(t,e,n){let i=t.slice();return i[17]=e[n],i[19]=n,i}function UF(t){let e,n,i,s=pe(t[1]),o=[];for(let l=0;l<s.length;l+=1)o[l]=NF($F(t,s,l));let r=l=>I(o[l],1,1,()=>{o[l]=null}),a=null;return s.length||(a=OF(t)),{c(){e=h("div");for(let l=0;l<o.length;l+=1)o[l].c();n=ge(),a&&a.c(),m(e,"class","divider")},m(l,c){x(l,e,c);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(l,c);x(l,n,c),a&&a.m(l,c),i=!0},p(l,c){if(c&74){s=pe(l[1]);let f;for(f=0;f<s.length;f+=1){let u=$F(l,s,f);o[f]?(o[f].p(u,c),P(o[f],1)):(o[f]=NF(u),o[f].c(),P(o[f],1),o[f].m(n.parentNode,n))}for(Te(),f=s.length;f<o.length;f+=1)r(f);Ee(),!s.length&&a?a.p(l,c):s.length?a&&(a.d(1),a=null):(a=OF(l),a.c(),a.m(n.parentNode,n))}},i(l){if(!i){for(let c=0;c<s.length;c+=1)P(o[c]);i=!0}},o(l){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)I(o[c]);i=!1},d(l){l&&(k(e),k(n)),it(o,l),a&&a.d(l)}}}function OF(t){let e;return{c(){e=h("div"),e.textContent="No results",m(e,"class","textgrey result")},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function NF(t){let e,n,i,s,o,r,a=[t[17]],l={};for(let f=0;f<a.length;f+=1)l=ja(l,a[f]);n=new Bi({props:l});function c(...f){return t[14](t[19],...f)}return{c(){e=h("div"),te(n.$$.fragment),m(e,"class",i="result "+(t[19]===t[3]?"sel":""))},m(f,u){x(f,e,u),K(n,e,null),s=!0,o||(r=Q(e,"mousedown",c),o=!0)},p(f,u){t=f;let p=u&2?tp(a,[np(t[17])]):{};n.$set(p),(!s||u&8&&i!==(i="result "+(t[19]===t[3]?"sel":"")))&&m(e,"class",i)},i(f){s||(P(n.$$.fragment,f),s=!0)},o(f){I(n.$$.fragment,f),s=!1},d(f){f&&k(e),ee(n),o=!1,r()}}}function jV(t){let e,n,i,s,o,r,a,l=t[2]&&UF(t);return{c(){e=h("div"),n=h("div"),i=h("input"),l&&l.c(),m(i,"placeholder","Name"),m(i,"type","text"),m(n,"class",s="container input "+(t[2]?"focus":"")),m(e,"class","navbtn finder")},m(c,f){x(c,e,f),d(e,n),d(n,i),t[10](i),Ge(i,t[0]),l&&l.m(n,null),o=!0,r||(a=[Q(i,"input",t[11]),Q(i,"input",t[5]),Q(i,"focus",t[12]),Q(i,"blur",t[13])],r=!0)},p(c,[f]){f&1&&i.value!==c[0]&&Ge(i,c[0]),c[2]?l?(l.p(c,f),f&4&&P(l,1)):(l=UF(c),l.c(),P(l,1),l.m(n,null)):l&&(Te(),I(l,1,1,()=>{l=null}),Ee()),(!o||f&4&&s!==(s="container input "+(c[2]?"focus":"")))&&m(n,"class",s)},i(c){o||(P(l),o=!0)},o(c){I(l),o=!1},d(c){c&&k(e),t[10](null),l&&l.d(),r=!1,ut(a)}}}function WV(t,e,n){let i=zF(async()=>{n(1,l=await Ut("api/playerinfo/search",{[r]:o,order:"name",limit:a})),g(l.findIndex(A=>A.name.toLowerCase()==o.toLowerCase()))}),{id:s}=e,{name:o=""}=e,{type:r="name"}=e,{limit:a=5}=e,l=[],c=!1,f=-1,u,p,g=A=>{n(3,f=A),f>=0&&(u=l[f],n(0,o=u.name),n(7,s=u.id))},v=A=>{A.target==p&&((A.keyCode===38||A.keyCode===40)&&l.length?(g(yl(f+(A.keyCode===38?-1:1),l.length)),A.preventDefault()):(A.keyCode==13||A.keyCode==27)&&p.blur())};jn(()=>{document.addEventListener("keydown",v)}),Wn(()=>{document.removeEventListener("keydown",v),n(4,p=void 0)});function _(A){Wt[A?"unshift":"push"](()=>{p=A,n(4,p)})}function b(){o=this.value,n(0,o)}let y=A=>n(2,c=!0),w=A=>n(2,c=!1),C=(A,M)=>g(A);return t.$$set=A=>{"id"in A&&n(7,s=A.id),"name"in A&&n(0,o=A.name),"type"in A&&n(8,r=A.type),"limit"in A&&n(9,a=A.limit)},[o,l,c,f,p,i,g,s,r,a,_,b,y,w,C]}var nv=class extends we{constructor(e){super(),Ce(this,e,WV,jV,$e,{id:7,name:0,type:8,limit:9})}},kd=nv;function jF(t,e,n){let i=t.slice();return i[24]=e[n],i[23]=n,i}function WF(t,e,n){let i=t.slice();return i[21]=e[n],i[23]=n,i}function GF(t,e,n){let i=t.slice();return i[26]=e[n],i[23]=n,i}function HF(t){let e,n,i,s,o,r,a,l,c=t[0].tag+"",f,u,p=t[0].name+"",g,v,_,b=S.factions[t[0].faction].name+"",y,w,C=S.ui.clan.heading+"",A,M,F,V,L,q,R,z,E=t[0].level+"",W,j,N,U=ba(t[0].level)+"",ie,re,ae,ue,Me=ba(t[0].level+1)-ba(t[0].level)+"",me,Ne,De=S.ui.clan.capacity+"",Fe,_e,H,qe=t[0].tax+"",Oe,He,Ye,Ze,ve,le,ze=t[0].members.length+"",Z,X,$,fe=`${t[0].online} (+${t[0].online*60} EXP/h)`,je,Ve,ye,Re,Be,mt,wt=ht(t[0].prestige)+"",Qe,Et,be,Je,yt,St,Ae,ct,$t,Le,Ct,Vt,We,Ke;F=new vi({props:{size:"1em",fract:Math.ceil(t[0].exp/_a(t[0].level)*100),barcol:"bgpurp",left:`${ht(t[0].exp)} / ${ht(_a(t[0].level))} EXP`,right:`${Math.ceil(t[0].exp/_a(t[0].level)*100)}% `}}),be=new yn({props:{amount:t[0].gold}});let xe=t[0].role>-1&&YF(t),ot=t[0].role>0&&XF(t),Xe=t[0].eligibleApply.length>0&&QF(t),ft=t[1]&&JF(t),kn=t[0].role>0&&KF(t),Fs=[HV,GV],ai=[];function Di(dt,Lt){return dt[6]=="members"?0:dt[6]=="applications"?1:-1}return~(Le=Di(t,-1))&&(Ct=ai[Le]=Fs[Le](t)),{c(){e=h("div"),n=h("div"),i=h("div"),s=h("img"),r=h("div"),a=h("div"),l=h("h1"),f=T(c),u=h("h3"),g=T(p),_=h("p"),y=T(b),w=Ue(),A=T(C),M=h("div"),te(F.$$.fragment),V=h("div"),L=h("div"),q=h("div"),R=h("span"),R.textContent=`${S.ui.clan.level}`,z=h("span"),W=T(E),j=h("span"),j.textContent=`${S.ui.clan.capacity}`,N=h("span"),ie=T(U),re=h("span"),re.textContent=`${S.ui.clan.nextlevel}`,ae=h("span"),ue=T("+"),me=T(Me),Ne=Ue(),Fe=T(De),_e=h("span"),_e.textContent=`${S.ui.clan.taxrate}`,H=h("span"),Oe=T(qe),He=T("%"),Ye=h("div"),Ze=h("div"),ve=h("span"),ve.textContent=`${S.ui.clan.members}`,le=h("span"),Z=T(ze),X=h("span"),X.textContent=`${S.ui.clan.online}`,$=h("span"),je=T(fe),Ve=h("span"),Ve.textContent=`${S.ui.stats.array[20]}`,ye=h("span"),Re=h("img"),mt=Ue(),Qe=T(wt),Et=h("span"),Et.textContent=`${S.ui.clan.treasury}`,te(be.$$.fragment),xe&&xe.c(),Je=ge(),ot&&ot.c(),yt=ge(),Xe&&Xe.c(),St=ge(),ft&&ft.c(),Ae=h("div"),ct=h("div"),$t=h("div"),$t.textContent=`${S.ui.clan.members}`,kn&&kn.c(),Ct&&Ct.c(),m(s,"class","helmet absCentered svelte-6t8hqd"),at(s.src,o="/data/ui/factions/"+t[0].faction+".svg?v=8582889")||m(s,"src",o),m(a,"class",v="textf"+t[0].faction+" svelte-6t8hqd"),m(r,"class","textcenter"),m(i,"class","hero svelte-6t8hqd"),m(M,"class","panel-black svelte-6t8hqd"),m(R,"class","textprimary"),m(j,"class","textprimary"),m(re,"class","textprimary"),m(_e,"class","textprimary"),m(q,"class","panel-black grid two svelte-6t8hqd"),m(ve,"class","textprimary"),m(X,"class","textprimary"),m(Ve,"class","textprimary"),m(Re,"class","svgicon"),at(Re.src,Be=$l)||m(Re,"src",Be),m(ye,"class","textprestige"),m(Et,"class","textprimary"),m(Ze,"class","panel-black grid two svelte-6t8hqd"),m(V,"class","marg-top grid two"),m(n,"class","row slim"),m(e,"class","fold fadeIn"),m($t,"class","btn navbtn grey"),m(ct,"class","subnav marg-top"),m(Ae,"class","row slim fadeIn")},m(dt,Lt){x(dt,e,Lt),d(e,n),d(n,i),d(i,s),d(i,r),d(r,a),d(a,l),d(l,f),d(a,u),d(u,g),d(r,_),d(_,y),d(_,w),d(_,A),d(n,M),K(F,M,null),d(n,V),d(V,L),d(L,q),d(q,R),d(q,z),d(z,W),d(q,j),d(q,N),d(N,ie),d(q,re),d(q,ae),d(ae,ue),d(ae,me),d(ae,Ne),d(ae,Fe),d(q,_e),d(q,H),d(H,Oe),d(H,He),d(V,Ye),d(Ye,Ze),d(Ze,ve),d(Ze,le),d(le,Z),d(Ze,X),d(Ze,$),d($,je),d(Ze,Ve),d(Ze,ye),d(ye,Re),d(ye,mt),d(ye,Qe),d(Ze,Et),K(be,Ze,null),xe&&xe.m(n,null),d(n,Je),ot&&ot.m(n,null),d(n,yt),Xe&&Xe.m(n,null),d(n,St),ft&&ft.m(n,null),x(dt,Ae,Lt),d(Ae,ct),d(ct,$t),kn&&kn.m(ct,null),~Le&&ai[Le].m(Ae,null),Vt=!0,We||(Ke=Q($t,"click",t[14]),We=!0)},p(dt,Lt){(!Vt||Lt&1&&!at(s.src,o="/data/ui/factions/"+dt[0].faction+".svg?v=8582889"))&&m(s,"src",o),(!Vt||Lt&1)&&c!==(c=dt[0].tag+"")&&G(f,c),(!Vt||Lt&1)&&p!==(p=dt[0].name+"")&&G(g,p),(!Vt||Lt&1&&v!==(v="textf"+dt[0].faction+" svelte-6t8hqd"))&&m(a,"class",v),(!Vt||Lt&1)&&b!==(b=S.factions[dt[0].faction].name+"")&&G(y,b);let Cs={};Lt&1&&(Cs.fract=Math.ceil(dt[0].exp/_a(dt[0].level)*100)),Lt&1&&(Cs.left=`${ht(dt[0].exp)} / ${ht(_a(dt[0].level))} EXP`),Lt&1&&(Cs.right=`${Math.ceil(dt[0].exp/_a(dt[0].level)*100)}% `),F.$set(Cs),(!Vt||Lt&1)&&E!==(E=dt[0].level+"")&&G(W,E),(!Vt||Lt&1)&&U!==(U=ba(dt[0].level)+"")&&G(ie,U),(!Vt||Lt&1)&&Me!==(Me=ba(dt[0].level+1)-ba(dt[0].level)+"")&&G(me,Me),(!Vt||Lt&1)&&qe!==(qe=dt[0].tax+"")&&G(Oe,qe),(!Vt||Lt&1)&&ze!==(ze=dt[0].members.length+"")&&G(Z,ze),(!Vt||Lt&1)&&fe!==(fe=`${dt[0].online} (+${dt[0].online*60} EXP/h)`)&&G(je,fe),(!Vt||Lt&1)&&wt!==(wt=ht(dt[0].prestige)+"")&&G(Qe,wt);let On={};Lt&1&&(On.amount=dt[0].gold),be.$set(On),dt[0].role>-1?xe?xe.p(dt,Lt):(xe=YF(dt),xe.c(),xe.m(n,Je)):xe&&(xe.d(1),xe=null),dt[0].role>0?ot?(ot.p(dt,Lt),Lt&1&&P(ot,1)):(ot=XF(dt),ot.c(),P(ot,1),ot.m(n,yt)):ot&&(Te(),I(ot,1,1,()=>{ot=null}),Ee()),dt[0].eligibleApply.length>0?Xe?Xe.p(dt,Lt):(Xe=QF(dt),Xe.c(),Xe.m(n,St)):Xe&&(Xe.d(1),Xe=null),dt[1]?ft?ft.p(dt,Lt):(ft=JF(dt),ft.c(),ft.m(n,null)):ft&&(ft.d(1),ft=null),dt[0].role>0?kn?kn.p(dt,Lt):(kn=KF(dt),kn.c(),kn.m(ct,null)):kn&&(kn.d(1),kn=null);let li=Le;Le=Di(dt,Lt),Le===li?~Le&&ai[Le].p(dt,Lt):(Ct&&(Te(),I(ai[li],1,1,()=>{ai[li]=null}),Ee()),~Le?(Ct=ai[Le],Ct?Ct.p(dt,Lt):(Ct=ai[Le]=Fs[Le](dt),Ct.c()),P(Ct,1),Ct.m(Ae,null)):Ct=null)},i(dt){Vt||(P(F.$$.fragment,dt),P(be.$$.fragment,dt),P(ot),P(Ct),Vt=!0)},o(dt){I(F.$$.fragment,dt),I(be.$$.fragment,dt),I(ot),I(Ct),Vt=!1},d(dt){dt&&(k(e),k(Ae)),ee(F),ee(be),xe&&xe.d(),ot&&ot.d(),Xe&&Xe.d(),ft&&ft.d(),kn&&kn.d(),~Le&&ai[Le].d(),We=!1,Ke()}}}function YF(t){let e,n,i,s=S.ui.clan.roles[t[0].role]+"",o;return{c(){e=h("div"),n=h("span"),n.textContent=`${S.ui.clan.highestrank}: `,i=h("span"),o=T(s),m(n,"class","textprimary"),m(i,"class","textgreen"),m(e,"class","marg-top panel-black svelte-6t8hqd")},m(r,a){x(r,e,a),d(e,n),d(e,i),d(i,o)},p(r,a){a&1&&s!==(s=S.ui.clan.roles[r[0].role]+"")&&G(o,s)},d(r){r&&k(e)}}}function XF(t){let e,n,i,s,o,r,a=S.ui.clan.inviteplayer+"",l,c,f,u,p;function g(_){t[12](_)}let v={};return t[4]!==void 0&&(v.name=t[4]),s=new kd({props:v}),Wt.push(()=>Lo(s,"name",g)),{c(){e=h("div"),n=h("span"),n.textContent=`${S.ui.clan.inviteplayers}`,i=h("div"),te(s.$$.fragment),r=h("div"),l=T(a),m(n,"class","textgrey"),m(r,"class",c="btn formatted navbtn grey "+(t[3]||!t[4].length?"disabled":"")),m(i,"class","subnav"),m(e,"class","marg-top panel-black svelte-6t8hqd")},m(_,b){x(_,e,b),d(e,n),d(e,i),K(s,i,null),d(i,r),d(r,l),f=!0,u||(p=Q(r,"click",t[8]),u=!0)},p(_,b){let y={};!o&&b&16&&(o=!0,y.name=_[4],Vo(()=>o=!1)),s.$set(y),(!f||b&24&&c!==(c="btn formatted navbtn grey "+(_[3]||!_[4].length?"disabled":"")))&&m(r,"class",c)},i(_){f||(P(s.$$.fragment,_),f=!0)},o(_){I(s.$$.fragment,_),f=!1},d(_){_&&k(e),ee(s),u=!1,p()}}}function QF(t){let e,n,i,s,o,r=S.ui.apply+"",a,l,c,f,u=pe(t[0].eligibleApply),p=[];for(let g=0;g<u.length;g+=1)p[g]=ZF(GF(t,u,g));return{c(){e=h("div"),n=h("span"),n.textContent=`${S.ui.clan.apply}`,i=h("div"),s=h("select");for(let g=0;g<p.length;g+=1)p[g].c();o=h("div"),a=T(r),m(n,"class","textgrey"),m(s,"class","navbtn"),t[5]===void 0&&mn(()=>t[13].call(s)),m(o,"class",l="btn formatted navbtn grey "+(t[3]||!t[5].length?"disabled":"")),m(i,"class","subnav"),m(e,"class","marg-top panel-black svelte-6t8hqd")},m(g,v){x(g,e,v),d(e,n),d(e,i),d(i,s);for(let _=0;_<p.length;_+=1)p[_]&&p[_].m(s,null);xn(s,t[5],!0),d(i,o),d(o,a),c||(f=[Q(s,"change",t[13]),Q(o,"click",t[9])],c=!0)},p(g,v){if(v&33){u=pe(g[0].eligibleApply);let _;for(_=0;_<u.length;_+=1){let b=GF(g,u,_);p[_]?p[_].p(b,v):(p[_]=ZF(b),p[_].c(),p[_].m(s,null))}for(;_<p.length;_+=1)p[_].d(1);p.length=u.length}v&33&&xn(s,g[5]),v&41&&l!==(l="btn formatted navbtn grey "+(g[3]||!g[5].length?"disabled":""))&&m(o,"class",l)},d(g){g&&k(e),it(p,g),c=!1,ut(f)}}}function ZF(t){let e,n=t[26]+"",i,s,o;return{c(){e=h("option"),i=T(n),e.selected=s=t[5]==t[26],e.__value=o=t[26],Ge(e,e.__value)},m(r,a){x(r,e,a),d(e,i)},p(r,a){a&1&&n!==(n=r[26]+"")&&G(i,n),a&33&&s!==(s=r[5]==r[26])&&(e.selected=s),a&1&&o!==(o=r[26])&&(e.__value=o,Ge(e,e.__value))},d(r){r&&k(e)}}}function JF(t){let e,n,i,s,o;return{c(){e=h("div"),n=h("span"),i=T(t[1]),m(n,"class",s="text"+t[2]+" svelte-6t8hqd"),m(e,"class",o="marg-top panel-black border "+t[2]+" svelte-6t8hqd")},m(r,a){x(r,e,a),d(e,n),d(n,i)},p(r,a){a&2&&G(i,r[1]),a&4&&s!==(s="text"+r[2]+" svelte-6t8hqd")&&m(n,"class",s),a&4&&o!==(o="marg-top panel-black border "+r[2]+" svelte-6t8hqd")&&m(e,"class",o)},d(r){r&&k(e)}}}function KF(t){let e,n=S.ui.clan.applications+"",i,s,o=t[0].applications.length+"",r,a,l,c,f;return{c(){e=h("div"),i=T(n),s=T(" ("),r=T(o),a=T(")"),l=Ue(),m(e,"class","btn navbtn grey")},m(u,p){x(u,e,p),d(e,i),d(e,s),d(e,r),d(e,a),x(u,l,p),c||(f=Q(e,"click",t[15]),c=!0)},p(u,p){p&1&&o!==(o=u[0].applications.length+"")&&G(r,o)},d(u){u&&(k(e),k(l)),c=!1,f()}}}function GV(t){let e,n,i,s,o,r,a=[],l=new Map,c,f=pe(t[0].applications),u=p=>p[24].name;for(let p=0;p<f.length;p+=1){let g=jF(t,f,p),v=u(g);l.set(v,a[p]=eC(v,g))}return{c(){e=h("div"),e.textContent=`${S.ui.clan.applicationdesc}`,n=h("table"),i=h("thead"),s=h("tr"),o=h("th"),o.textContent=`${S.ui.clan.player}`,r=h("tbody");for(let p=0;p<a.length;p+=1)a[p].c();m(e,"class","marg-top textgrey"),m(o,"width","70%"),m(s,"class","textprimary"),m(n,"class","marg-top panel-black svelte-6t8hqd")},m(p,g){x(p,e,g),x(p,n,g),d(n,i),d(i,s),d(s,o),d(n,r);for(let v=0;v<a.length;v+=1)a[v]&&a[v].m(r,null);c=!0},p(p,g){g&1025&&(f=pe(p[0].applications),Te(),a=ui(a,g,u,1,p,f,l,r,Ii,eC,null,jF),Ee())},i(p){if(!c){for(let g=0;g<f.length;g+=1)P(a[g]);c=!0}},o(p){for(let g=0;g<a.length;g+=1)I(a[g]);c=!1},d(p){p&&(k(e),k(n));for(let g=0;g<a.length;g+=1)a[g].d()}}}function HV(t){let e,n,i,s,o,r,a,l=[],c=new Map,f,u=pe(t[0].members),p=g=>g[21].name;for(let g=0;g<u.length;g+=1){let v=WF(t,u,g),_=p(v);c.set(_,l[g]=tC(_,v))}return{c(){e=h("div"),e.textContent=`${S.ui.clan.memberdesc}`,n=h("table"),i=h("thead"),s=h("tr"),o=h("th"),o.textContent=`${S.ui.clan.roles[0]}`,r=h("th"),r.textContent=`${S.ui.clan.rank}`,a=h("tbody");for(let g=0;g<l.length;g+=1)l[g].c();m(e,"class","marg-top textgrey"),m(o,"width","70%"),m(s,"class","textprimary"),m(n,"class","marg-top panel-black svelte-6t8hqd")},m(g,v){x(g,e,v),x(g,n,v),d(n,i),d(i,s),d(s,o),d(s,r),d(n,a);for(let _=0;_<l.length;_+=1)l[_]&&l[_].m(a,null);f=!0},p(g,v){v&129&&(u=pe(g[0].members),Te(),l=ui(l,v,p,1,g,u,c,a,Ii,tC,null,WF),Ee())},i(g){if(!f){for(let v=0;v<u.length;v+=1)P(l[v]);f=!0}},o(g){for(let v=0;v<l.length;v+=1)I(l[v]);f=!1},d(g){g&&(k(e),k(n));for(let v=0;v<l.length;v+=1)l[v].d()}}}function eC(t,e){let n,i,s,o,r,a;s=new Bi({props:{name:e[24].name,pclass:e[24].class,level:e[24].level,faction:e[0].faction}});function l(...c){return e[17](e[24],...c)}return{key:t,first:null,c(){n=h("tr"),i=h("td"),te(s.$$.fragment),m(n,"class","striped"),this.first=n},m(c,f){x(c,n,f),d(n,i),K(s,i,null),o=!0,r||(a=Q(n,"mousedown",l),r=!0)},p(c,f){e=c;let u={};f&1&&(u.name=e[24].name),f&1&&(u.pclass=e[24].class),f&1&&(u.level=e[24].level),f&1&&(u.faction=e[0].faction),s.$set(u)},i(c){o||(P(s.$$.fragment,c),o=!0)},o(c){I(s.$$.fragment,c),o=!1},d(c){c&&k(n),ee(s),r=!1,a()}}}function tC(t,e){let n,i,s,o,r=e[21].online?"\u2B24":"",a,l=e[21].owned?"\u2B50":"",c,f,u=S.ui.clan.roles[e[21].clanrole]+"",p,g,v,_,b;s=new Bi({props:{name:e[21].name,pclass:e[21].class,level:e[21].level,faction:e[0].faction}});function y(...w){return e[16](e[21],...w)}return{key:t,first:null,c(){n=h("tr"),i=h("td"),te(s.$$.fragment),o=h("span"),a=T(r),c=T(l),f=h("td"),p=T(u),m(o,"class","textgreen"),m(n,"class",g="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"),this.first=n},m(w,C){x(w,n,C),d(n,i),K(s,i,null),d(i,o),d(o,a),d(o,c),d(n,f),d(f,p),v=!0,_||(b=Q(n,"mousedown",y),_=!0)},p(w,C){e=w;let A={};C&1&&(A.name=e[21].name),C&1&&(A.pclass=e[21].class),C&1&&(A.level=e[21].level),C&1&&(A.faction=e[0].faction),s.$set(A),(!v||C&1)&&r!==(r=e[21].online?"\u2B24":"")&&G(a,r),(!v||C&1)&&l!==(l=e[21].owned?"\u2B50":"")&&G(c,l),(!v||C&1)&&u!==(u=S.ui.clan.roles[e[21].clanrole]+"")&&G(p,u),(!v||C&1&&g!==(g="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"))&&m(n,"class",g)},i(w){v||(P(s.$$.fragment,w),v=!0)},o(w){I(s.$$.fragment,w),v=!1},d(w){w&&k(n),ee(s),_=!1,b()}}}function YV(t){let e,n,i=t[0]&&HF(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=HF(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function XV(t,e,n){let{tag:i}=e,s,o,r=async()=>{let L=await Ut("/api/claninfo/info",{tag:i});L.name&&(n(0,s=L),s.eligibleApply.length&&n(5,v=s.eligibleApply[0]),n(0,s.online=s.members.filter(q=>q.online).length,s)),o&&(clearTimeout(o),o=setTimeout(r,5e3))};o=!0,r(),Wn(()=>{clearTimeout(o),o=void 0});let a=(L,q)=>{let R=[];q.owned?R.push({name:S.ui.clan.leave,fun:async()=>{u(await Ut("/api/clan/leave",{name:q.name}),S.ui.clan.left)}}):q.clanrole<s.role&&R.push({name:S.ui.clan.kick,fun:async()=>{u(await Ut("/api/clan/kick",{name:q.name}),S.ui.clan.memberkicked)}});for(let z=0;z<(s.role==3?4:s.role);z++)R.push({name:S.ui.clan.setrank+": "+S.ui.clan.roles[z],fun:async()=>{u(await Ut("/api/clan/setrole",{name:q.name,role:z}),S.ui.clan.setrank+": "+S.ui.clan.roles[z])}});wn.set({x:L.pageX,y:L.pageY,opts:R})},l,c,f=!1,u=async(L,q)=>{L.result!=="ok"?(n(1,l=L.result),n(2,c="red")):(n(1,l=q),n(2,c="green")),await r(),n(3,f=!1)},p="",g=async()=>{n(3,f=!0),u(await Ut("/api/clan/invite",{name:p,tag:i}),S.ui.clan.invited[0]+p+S.ui.clan.invited[1]),n(4,p="")},v="",_=async()=>{n(3,f=!0),u(await Ut("/api/clan/apply",{name:v,tag:i}),S.ui.clan.applied),n(5,v="")},b=(L,q)=>{let R=[];s.role>0&&R.push({name:S.ui.clan.applicationaccept,fun:async()=>{u(await Ut("/api/clan/invite",{tag:i,name:q.name}),S.ui.clan.applicationaccepted)}}),s.role>1&&R.push({name:S.ui.clan.applicationdeny,fun:async()=>{u(await Ut("/api/clan/denyapplication",{id:q.id}),S.ui.clan.applicationdenied)}}),wn.set({x:L.pageX,y:L.pageY,opts:R})},y="members";function w(L){p=L,n(4,p)}function C(){v=ki(this),n(5,v),n(0,s)}let A=L=>n(6,y="members"),M=L=>n(6,y="applications"),F=(L,q)=>a(q,L),V=(L,q)=>b(q,L);return t.$$set=L=>{"tag"in L&&n(11,i=L.tag)},[s,l,c,f,p,v,y,a,g,_,b,i,w,C,A,M,F,V]}var iv=class extends we{constructor(e){super(),Ce(this,e,XV,YV,$e,{tag:11})}},nC=iv;function QV(t){let e,n,i,s,o,r,a=S.ui.cost+"",l,c,f,u,p,g,v,_=S.ui.clan.createbutton+"",b,y,w,C,A;return f=new yn({props:{amount:1e5}}),{c(){e=h("h3"),e.textContent=`${S.ui.clan.createheading}`,n=h("label"),n.textContent=`${S.ui.clan.createname}`,i=h("input"),s=h("label"),s.textContent=`${S.ui.clan.createtag}`,o=h("input"),r=h("p"),l=T(a),c=T(": "),te(f.$$.fragment),p=h("div"),g=T(t[3]),v=h("div"),b=T(_),m(e,"class","textprimary"),m(n,"class","svelte-7uvqsx"),m(i,"type","text"),m(i,"placeholder","Guardians of Guardstone (a-Z)"),m(i,"maxlength","20"),m(s,"class","svelte-7uvqsx"),m(o,"type","text"),m(o,"placeholder","GoG (a-Z !~=#*+-)"),m(o,"maxlength","4"),m(r,"class",u="text"+(t[2]>1e5?"primary":"red")),m(p,"class","textred"),Pe(v,"display","inline-block"),m(v,"class",y="btn marg-top formatted "+(t[4]?"blue":"blue disabled"))},m(M,F){x(M,e,F),x(M,n,F),x(M,i,F),Ge(i,t[0]),x(M,s,F),x(M,o,F),Ge(o,t[1]),x(M,r,F),d(r,l),d(r,c),K(f,r,null),x(M,p,F),d(p,g),x(M,v,F),d(v,b),w=!0,C||(A=[Q(i,"input",t[7]),Q(o,"input",t[8]),Q(v,"click",t[5])],C=!0)},p(M,[F]){F&1&&i.value!==M[0]&&Ge(i,M[0]),F&2&&o.value!==M[1]&&Ge(o,M[1]),(!w||F&4&&u!==(u="text"+(M[2]>1e5?"primary":"red")))&&m(r,"class",u),(!w||F&8)&&G(g,M[3]),(!w||F&16&&y!==(y="btn marg-top formatted "+(M[4]?"blue":"blue disabled")))&&m(v,"class",y)},i(M){w||(P(f.$$.fragment,M),w=!0)},o(M){I(f.$$.fragment,M),w=!1},d(M){M&&(k(e),k(n),k(i),k(s),k(o),k(r),k(p),k(v)),ee(f),C=!1,ut(A)}}}function ZV(t,e,n){let i,s;se(t,Hi,p=>n(2,s=p));let o="",r="",a=!1,l="",c=async()=>{if(a)return;n(6,a=!0);let p=await Ut("/api/clan/create",{name:o,tag:r});p.result!=="ok"&&(n(3,l=p.result),n(6,a=!1))};function f(){o=this.value,n(0,o)}function u(){r=this.value,n(1,r)}return t.$$.update=()=>{t.$$.dirty&71&&n(4,i=!a&&s>=1e5&&o.length<=20&&o.length>=3&&r.length<=4&&r.length>=2)},[o,r,s,l,i,c,a,f,u]}var sv=class extends we{constructor(e){super(),Ce(this,e,ZV,QV,$e,{})}},iC=sv;function sC(t,e,n){let i=t.slice();return i[4]=e[n],i[6]=n,i}function JV(t){let e,n,i;function s(...o){return t[2](t[4],...o)}return{c(){e=h("div"),e.textContent=`${S.ui.accept}`,m(e,"class","btn blue")},m(o,r){x(o,e,r),n||(i=Q(e,"click",s),n=!0)},p(o,r){t=o},d(o){o&&k(e),n=!1,i()}}}function KV(t){let e;return{c(){e=h("div"),e.textContent=`${S.ui.clan.application}`},m(n,i){x(n,e,i)},p:ce,d(n){n&&k(e)}}}function oC(t,e){let n,i,s=e[4].tag+"",o,r,a=e[4].name+"",l,c;function f(g,v){return g[4].request?KV:JV}let u=f(e,-1),p=u(e);return{key:t,first:null,c(){n=h("tr"),i=h("td"),o=T(s),r=h("td"),l=T(a),c=h("td"),p.c(),m(c,"class","textcenter"),m(n,"class","striped"),this.first=n},m(g,v){x(g,n,v),d(n,i),d(i,o),d(n,r),d(r,l),d(n,c),p.m(c,null)},p(g,v){e=g,v&1&&s!==(s=e[4].tag+"")&&G(o,s),v&1&&a!==(a=e[4].name+"")&&G(l,a),u===(u=f(e,v))&&p?p.p(e,v):(p.d(1),p=u(e),p&&(p.c(),p.m(c,null)))},d(g){g&&k(n),p.d()}}}function eL(t){let e,n,i,s,o,r,a,l=[],c=new Map,f=pe(t[0]),u=p=>p[4].clan;for(let p=0;p<f.length;p+=1){let g=sC(t,f,p),v=u(g);c.set(v,l[p]=oC(v,g))}return{c(){e=h("table"),n=h("thead"),i=h("tr"),s=h("th"),s.textContent=`${S.ui.clan.createtag}`,o=h("th"),o.textContent=`${S.ui.clan.createname}`,r=h("th"),r.textContent=`${S.ui.clan.action}`,a=h("tbody");for(let p=0;p<l.length;p+=1)l[p].c();m(s,"width","20%"),m(o,"width","60%"),m(r,"class","textcenter"),m(i,"class","textprimary"),m(e,"class","marg-top panel-black")},m(p,g){x(p,e,g),d(e,n),d(n,i),d(i,s),d(i,o),d(i,r),d(e,a);for(let v=0;v<l.length;v+=1)l[v]&&l[v].m(a,null)},p(p,[g]){g&3&&(f=pe(p[0]),l=ui(l,g,u,1,p,f,c,a,K2,oC,null,sC))},i:ce,o:ce,d(p){p&&k(e);for(let g=0;g<l.length;g+=1)l[g].d()}}}function tL(t,e,n){let i=[];(async()=>{n(0,i=await Ut("/api/clan/invites",{name:D.player.name}))})();let o=async a=>{await Ut("/api/clan/apply",{tag:a,name:D.player.name})};return[i,o,(a,l)=>o(a.tag)]}var ov=class extends we{constructor(e){super(),Ce(this,e,tL,eL,$e,{})}},rC=ov;function aC(t){let e,n,i;return n=new Ot({props:{title:S.ui.clan.heading,icon:"clan",scroll:"true",$$slots:{default:[aL]},$$scope:{ctx:t}}}),n.$on("close",t[6]),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","absCentered container svelte-1bfqv1s")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&133&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function nL(t){let e,n,i,s,o,r,a;return{c(){e=h("div"),n=h("div"),i=h("h3"),i.textContent=`${S.ui.clan.noclan}`,s=h("div"),s.textContent=`${S.ui.clan.viewinvites}`,o=h("div"),o.textContent=`${S.ui.clan.createheading}`,m(s,"class","btn grey"),m(o,"class","btn grey marg-top"),m(n,"class","panel-black"),m(e,"class","clanInfoBox textcenter svelte-1bfqv1s")},m(l,c){x(l,e,c),d(e,n),d(n,i),d(n,s),d(n,o),r||(a=[Q(s,"click",t[4]),Q(o,"click",t[5])],r=!0)},p:ce,i:ce,o:ce,d(l){l&&k(e),r=!1,ut(a)}}}function iL(t){let e,n,i,s,o,r,a,l=[rL,oL],c=[];function f(u,p){return u[0]=="create"?0:u[0]=="invites"?1:-1}return~(i=f(t,-1))&&(s=c[i]=l[i](t)),{c(){e=h("div"),n=h("div"),n.textContent=`${S.ui.back}`,s&&s.c(),Pe(n,"display","inline-block"),m(n,"class","btn formatted grey"),m(e,"class","modemenu svelte-1bfqv1s")},m(u,p){x(u,e,p),d(e,n),~i&&c[i].m(e,null),o=!0,r||(a=Q(n,"click",t[3]),r=!0)},p(u,p){let g=i;i=f(u,p),i!==g&&(s&&(Te(),I(c[g],1,1,()=>{c[g]=null}),Ee()),~i?(s=c[i],s||(s=c[i]=l[i](u),s.c()),P(s,1),s.m(e,null)):s=null)},i(u){o||(P(s),o=!0)},o(u){I(s),o=!1},d(u){u&&k(e),~i&&c[i].d(),r=!1,a()}}}function sL(t){let e,n,i;return n=new nC({props:{tag:t[2]}}),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","clanView svelte-1bfqv1s")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&4&&(r.tag=s[2]),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function oL(t){let e,n;return e=new rC({}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function rL(t){let e,n;return e=new iC({}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function aL(t){let e,n,i,s,o=[sL,iL,nL],r=[];function a(l,c){return l[2]?0:l[0]?1:2}return e=a(t,-1),n=r[e]=o[e](t),{c(){n.c(),i=ge()},m(l,c){r[e].m(l,c),x(l,i,c),s=!0},p(l,c){let f=e;e=a(l,c),e===f?r[e].p(l,c):(Te(),I(r[f],1,1,()=>{r[f]=null}),Ee(),n=r[e],n?n.p(l,c):(n=r[e]=o[e](l),n.c()),P(n,1),n.m(i.parentNode,i))},i(l){s||(P(n),s=!0)},o(l){I(n),s=!1},d(l){l&&k(i),r[e].d(l)}}}function lL(t){let e,n,i=t[1]&&aC(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[1]?i?(i.p(s,o),o&2&&P(i,1)):(i=aC(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function cL(t,e,n){let i,s;se(t,fo,f=>n(1,i=f)),se(t,hp,f=>n(2,s=f));let o=!1;return[o,i,s,f=>n(0,o=!1),f=>n(0,o="invites"),f=>n(0,o="create"),()=>{nt(fo,i=!1,i)}]}var rv=class extends we{constructor(e){super(),Ce(this,e,cL,lL,$e,{})}},lC=rv;var av=t=>{let e=~~(t/86400),n=~~(t/(60*60)%24),i=~~(t/60%60),s=~~(t%60);return`${e?e+"d ":""}${n?n+"h ":""}${i?i+"m ":""}${s?s+"s":""}`};var ou=t=>~~(1e4+t**1.5*8e3);function cC(t,e,n){let i=t.slice();return i[9]=e[n],i[11]=n,i}function fC(t){let e,n,i;return n=new Ot({props:{title:S.ui.headers.warstats,icon:"pvp",$$slots:{default:[uL]},$$scope:{ctx:t}}}),n.$on("close",t[8]),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","absCentered container svelte-3tysjz")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&4101&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function fL(t){let e,n=ht(t[2].contrib)+"",i,s,o=ht(ou(t[2].level))+"",r,a,l=t[2].level+"",c,f;return{c(){e=h("span"),i=T(n),s=T(" / "),r=T(o),a=T(" (Lv. "),c=T(l),f=T(" War)"),Pe(e,"font-size","14px"),m(e,"class","absCentered textprimary")},m(u,p){x(u,e,p),d(e,i),d(e,s),d(e,r),d(e,a),d(e,c),d(e,f)},p(u,p){p&4&&n!==(n=ht(u[2].contrib)+"")&&G(i,n),p&4&&o!==(o=ht(ou(u[2].level))+"")&&G(r,o),p&4&&l!==(l=u[2].level+"")&&G(c,l)},d(u){u&&k(e)}}}function uC(t,e){let n,i,s,o,r=ht(e[9].stats[1])+"",a,l,c=ht(e[9].stats[2])+"",f,u,p=e[9].stats[0]+"",g,v,_=ht(e[9].stats[3])+"",b,y,w;return s=new Bi({props:{name:e[9].name,pclass:e[9].class,level:e[9].level,faction:e[9].faction}}),{key:t,first:null,c(){n=h("tr"),i=h("td"),te(s.$$.fragment),o=h("td"),a=T(r),l=h("td"),f=T(c),u=h("td"),g=T(p),v=h("td"),b=T(_),m(o,"class","textcenter"),m(l,"class","textcenter"),m(u,"class","textcenter"),m(v,"class","textcenter textfame"),m(n,"class",y="striped "+(D&&D.player&&D.player.name===e[9].name?"selected":"")),this.first=n},m(C,A){x(C,n,A),d(n,i),K(s,i,null),d(n,o),d(o,a),d(n,l),d(l,f),d(n,u),d(u,g),d(n,v),d(v,b),w=!0},p(C,A){e=C;let M={};A&5&&(M.name=e[9].name),A&5&&(M.pclass=e[9].class),A&5&&(M.level=e[9].level),A&5&&(M.faction=e[9].faction),s.$set(M),(!w||A&5)&&r!==(r=ht(e[9].stats[1])+"")&&G(a,r),(!w||A&5)&&c!==(c=ht(e[9].stats[2])+"")&&G(f,c),(!w||A&5)&&p!==(p=e[9].stats[0]+"")&&G(g,p),(!w||A&5)&&_!==(_=ht(e[9].stats[3])+"")&&G(b,_),(!w||A&5&&y!==(y="striped "+(D&&D.player&&D.player.name===e[9].name?"selected":"")))&&m(n,"class",y)},i(C){w||(P(s.$$.fragment,C),w=!0)},o(C){I(s.$$.fragment,C),w=!1},d(C){C&&k(n),ee(s)}}}function uL(t){let e,n,i,s,o,r,a,l,c,f=t[2].kills[0]+"",u,p,g,v,_,b,y=ht(t[2].reward)+"",w,C,A=S.ui.war.status+"",M,F,V,L=S.ui.war.statustypes[t[2].status]+"",q,R,z,E=S.ui.war.duration+"",W,j,N,U=av(t[2].duration)+"",ie,re,ae,ue,Me,me,Ne,De,Fe=t[2].kills[1]+"",_e,H,qe,Oe,He,Ye,Ze,ve,le=S.ui.stats.misc.damage+"",ze,Z,X,$=S.ui.stats.misc.healing+"",fe,je,Ve,ye=S.ui.stats.misc.kills+"",Re,Be,mt,wt,Qe,Et,be=S.ui.stats.misc.fame+"",Je,yt,St,Ae=[],ct=new Map,$t,Le,Ct;H=new vi({props:{size:"1.3em",fract:~~(t[2].contrib/ou(t[2].level)*100),left:"",right:"",barcol:"bgpurp",$$slots:{default:[fL]},$$scope:{ctx:t}}});let Vt=pe(t[2].contributors.sort(t[7])),We=Ke=>Ke[9].name;for(let Ke=0;Ke<Vt.length;Ke+=1){let xe=cC(t,Vt,Ke),ot=We(xe);ct.set(ot,Ae[Ke]=uC(ot,xe))}return{c(){e=h("div"),n=h("div"),i=h("div"),s=h("div"),o=h("span"),o.textContent=`${S.factions[0].name}`,r=h("span"),a=h("img"),c=Ue(),u=T(f),p=h("div"),g=h("span"),v=h("img"),b=Ue(),w=T(y),C=h("span"),M=T(A),F=T(": "),V=h("span"),q=T(L),z=h("span"),W=T(E),j=T(": "),N=h("span"),ie=T(U),re=Ue(),ae=h("div"),ue=h("span"),ue.textContent=`${S.factions[1].name}`,Me=h("span"),me=h("img"),De=Ue(),_e=T(Fe),te(H.$$.fragment),qe=h("div"),Oe=h("table"),He=h("thead"),Ye=h("tr"),Ze=h("th"),Ze.textContent=`${S.ui.war.player}`,ve=h("th"),ze=T(le),X=h("th"),fe=T($),Ve=h("th"),Re=T(ye),mt=h("th"),wt=h("img"),Et=Ue(),Je=T(be),St=h("tbody");for(let Ke=0;Ke<Ae.length;Ke+=1)Ae[Ke].c();m(o,"class","infosmall textf0 svelte-3tysjz"),Pe(o,"margin-top","30px"),m(a,"class","svgicon"),at(a.src,l="/data/ui/icons/pvp.svg?v=8582889")||m(a,"src",l),m(r,"class","infobig textprimary svelte-3tysjz"),Pe(r,"margin-top","10px"),m(v,"class","svgicon"),at(v.src,_=Ko)||m(v,"src",_),m(g,"class","infobig textfame svelte-3tysjz"),Pe(g,"margin-top","20px"),m(V,"class",R="text"+["red","orange","green"][t[2].status]+" svelte-3tysjz"),m(C,"class","infosmall svelte-3tysjz"),Pe(C,"margin-top","10px"),m(N,"class","textprimary"),m(z,"class","infosmall svelte-3tysjz"),Pe(z,"margin-bottom","20px"),m(ue,"class","infosmall textf1 svelte-3tysjz"),Pe(ue,"margin-top","30px"),m(me,"class","svgicon"),at(me.src,Ne="/data/ui/icons/pvp.svg?v=8582889")||m(me,"src",Ne),m(Me,"class","infobig textprimary svelte-3tysjz"),Pe(Me,"margin-top","10px"),m(i,"class","grid three"),m(n,"class","panel-black border grey"),m(Ze,"width","30%"),m(ve,"class",Z="textcenter "+(t[0]==1?"textwhite":"")),m(X,"class",je="textcenter "+(t[0]==2?"textwhite":"")),m(Ve,"class",Be="textcenter "+(t[0]==0?"textwhite":"")),m(wt,"class","svgicon"),at(wt.src,Qe=Ko)||m(wt,"src",Qe),m(mt,"class",yt="textcenter "+(t[0]==3?"textwhite":"")),m(Ye,"class","textprimary"),m(Oe,"class","dense panel-black"),m(qe,"class","scrollbar"),m(e,"class","layout svelte-3tysjz")},m(Ke,xe){x(Ke,e,xe),d(e,n),d(n,i),d(i,s),d(s,o),d(s,r),d(r,a),d(r,c),d(r,u),d(i,p),d(p,g),d(g,v),d(g,b),d(g,w),d(p,C),d(C,M),d(C,F),d(C,V),d(V,q),d(p,z),d(z,W),d(z,j),d(z,N),d(N,ie),d(p,re),d(i,ae),d(ae,ue),d(ae,Me),d(Me,me),d(Me,De),d(Me,_e),K(H,n,null),d(e,qe),d(qe,Oe),d(Oe,He),d(He,Ye),d(Ye,Ze),d(Ye,ve),d(ve,ze),d(Ye,X),d(X,fe),d(Ye,Ve),d(Ve,Re),d(Ye,mt),d(mt,wt),d(mt,Et),d(mt,Je),d(Oe,St);for(let ot=0;ot<Ae.length;ot+=1)Ae[ot]&&Ae[ot].m(St,null);$t=!0,Le||(Ct=[Q(ve,"click",t[3]),Q(X,"click",t[4]),Q(Ve,"click",t[5]),Q(mt,"click",t[6])],Le=!0)},p(Ke,xe){(!$t||xe&4)&&f!==(f=Ke[2].kills[0]+"")&&G(u,f),(!$t||xe&4)&&y!==(y=ht(Ke[2].reward)+"")&&G(w,y),(!$t||xe&4)&&L!==(L=S.ui.war.statustypes[Ke[2].status]+"")&&G(q,L),(!$t||xe&4&&R!==(R="text"+["red","orange","green"][Ke[2].status]+" svelte-3tysjz"))&&m(V,"class",R),(!$t||xe&4)&&U!==(U=av(Ke[2].duration)+"")&&G(ie,U),(!$t||xe&4)&&Fe!==(Fe=Ke[2].kills[1]+"")&&G(_e,Fe);let ot={};xe&4&&(ot.fract=~~(Ke[2].contrib/ou(Ke[2].level)*100)),xe&4100&&(ot.$$scope={dirty:xe,ctx:Ke}),H.$set(ot),(!$t||xe&1&&Z!==(Z="textcenter "+(Ke[0]==1?"textwhite":"")))&&m(ve,"class",Z),(!$t||xe&1&&je!==(je="textcenter "+(Ke[0]==2?"textwhite":"")))&&m(X,"class",je),(!$t||xe&1&&Be!==(Be="textcenter "+(Ke[0]==0?"textwhite":"")))&&m(Ve,"class",Be),(!$t||xe&1&&yt!==(yt="textcenter "+(Ke[0]==3?"textwhite":"")))&&m(mt,"class",yt),xe&5&&(Vt=pe(Ke[2].contributors.sort(Ke[7])),Te(),Ae=ui(Ae,xe,We,1,Ke,Vt,ct,St,Ii,uC,null,cC),Ee())},i(Ke){if(!$t){P(H.$$.fragment,Ke);for(let xe=0;xe<Vt.length;xe+=1)P(Ae[xe]);$t=!0}},o(Ke){I(H.$$.fragment,Ke);for(let xe=0;xe<Ae.length;xe+=1)I(Ae[xe]);$t=!1},d(Ke){Ke&&k(e),ee(H);for(let xe=0;xe<Ae.length;xe+=1)Ae[xe].d();Le=!1,ut(Ct)}}}function pL(t){let e,n,i=t[1]&&fC(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[1]?i?(i.p(s,o),o&2&&P(i,1)):(i=fC(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function mL(t,e,n){let i,s;se(t,$s,p=>n(1,i=p)),se(t,zs,p=>n(2,s=p));let o=1;return[o,i,s,()=>n(0,o=1),()=>n(0,o=2),()=>n(0,o=0),()=>n(0,o=3),(p,g)=>g.stats[o]-p.stats[o],()=>{nt($s,i=!1,i)}]}var lv=class extends we{constructor(e){super(),Ce(this,e,mL,pL,$e,{})}},pC=lv;function mC(t,e,n){let i=t.slice();return i[15]=e[n],i}function dC(t,e,n){let i=t.slice();return i[18]=e[n],i[20]=n,i}function hC(t){let e,n,i;return n=new Ot({props:{title:S.ui.headers.pvp,icon:"pvp",$$slots:{default:[bL]},$$scope:{ctx:t}}}),n.$on("close",t[13]),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","l-upperLeftModal container uiscaled svelte-voya4q")},m(s,o){x(s,e,o),K(n,e,null),i=!0},p(s,o){let r={};o&2097278&&(r.$$scope={dirty:o,ctx:s}),n.$set(r)},i(s){i||(P(n.$$.fragment,s),i=!0)},o(s){I(n.$$.fragment,s),i=!1},d(s){s&&k(e),ee(n)}}}function gC(t){let e,n,i;function s(){return t[11](t[20])}return{c(){e=h("div"),e.textContent=`${t[18]}`,m(e,"class","tab"),Do(e,"active",t[20]===t[1])},m(o,r){x(o,e,r),n||(i=Q(e,"click",s),n=!0)},p(o,r){t=o,r&2&&Do(e,"active",t[20]===t[1])},d(o){o&&k(e),n=!1,i()}}}function dL(t){let e,n,i,s,o,r,a,l,c=t[5].arena_position+"",f,u,p,g,v=t[5].arena_wins_today+"",_,b,y,w,C=t[5].arena_losses_today+"",A,M,F,V,L,q,R,z,E,W,j,N,U,ie,re;s=new vd({props:{amount:t[5].arena_rating}});let ae=pe(t[8]),ue=[];for(let De=0;De<ae.length;De+=1)ue[De]=vC(mC(t,ae,De));L=new or({props:{amount:Math.ceil(qf(t[5].arena_rating)/5)}});let Me=[vL,gL],me=[];function Ne(De,Fe){return De[5].arena_wins_today?0:1}return W=Ne(t,-1),j=me[W]=Me[W](t),ie=new or({props:{amount:t[5].medals}}),{c(){e=h("div"),n=h("h4"),n.textContent="Current Rating",i=h("h2"),te(s.$$.fragment),o=h("div");for(let De=0;De<ue.length;De+=1)ue[De].c();r=h("div"),a=h("span"),a.textContent="Arena Position",l=h("span"),f=T(c),u=h("span"),u.textContent="Wins / Loss Today",p=h("span"),g=h("span"),_=T(v),y=T(" - "),w=h("span"),A=T(C),F=h("span"),F.textContent="Medals per win",V=h("span"),te(L.$$.fragment),q=h("span"),R=T("End of day bonus"),E=h("span"),j.c(),N=h("span"),N.textContent="Total Medals",U=h("span"),te(ie.$$.fragment),m(n,"class","textgreen"),m(e,"class","textcenter panel-black"),m(o,"class","panel-black marg-top grid two textcenter"),m(a,"class","textwhite"),m(l,"class","textgreen statnumber"),m(u,"class","textwhite"),m(g,"class",b=t[5].arena_wins_today?"textgreen":"textgrey"),m(w,"class",M=t[5].arena_losses_today?"textred":"textgrey"),m(p,"class","textgrey statnumber"),m(F,"class","textwhite"),m(V,"class","statnumber"),m(q,"class",z=t[5].arena_wins_today?"textgreen":"textgrey"),m(E,"class","statnumber"),m(N,"class","textwhite"),m(U,"class","statnumber"),m(r,"class","stats panel-black marg-top svelte-voya4q")},m(De,Fe){x(De,e,Fe),d(e,n),d(e,i),K(s,i,null),x(De,o,Fe);for(let _e=0;_e<ue.length;_e+=1)ue[_e]&&ue[_e].m(o,null);x(De,r,Fe),d(r,a),d(r,l),d(l,f),d(r,u),d(r,p),d(p,g),d(g,_),d(p,y),d(p,w),d(w,A),d(r,F),d(r,V),K(L,V,null),d(r,q),d(q,R),d(r,E),me[W].m(E,null),d(r,N),d(r,U),K(ie,U,null),re=!0},p(De,Fe){let _e={};if(Fe&32&&(_e.amount=De[5].arena_rating),s.$set(_e),Fe&832){ae=pe(De[8]);let He;for(He=0;He<ae.length;He+=1){let Ye=mC(De,ae,He);ue[He]?ue[He].p(Ye,Fe):(ue[He]=vC(Ye),ue[He].c(),ue[He].m(o,null))}for(;He<ue.length;He+=1)ue[He].d(1);ue.length=ae.length}(!re||Fe&32)&&c!==(c=De[5].arena_position+"")&&G(f,c),(!re||Fe&32)&&v!==(v=De[5].arena_wins_today+"")&&G(_,v),(!re||Fe&32&&b!==(b=De[5].arena_wins_today?"textgreen":"textgrey"))&&m(g,"class",b),(!re||Fe&32)&&C!==(C=De[5].arena_losses_today+"")&&G(A,C),(!re||Fe&32&&M!==(M=De[5].arena_losses_today?"textred":"textgrey"))&&m(w,"class",M);let H={};Fe&32&&(H.amount=Math.ceil(qf(De[5].arena_rating)/5)),L.$set(H),(!re||Fe&32&&z!==(z=De[5].arena_wins_today?"textgreen":"textgrey"))&&m(q,"class",z);let qe=W;W=Ne(De,Fe),W===qe?me[W].p(De,Fe):(Te(),I(me[qe],1,1,()=>{me[qe]=null}),Ee(),j=me[W],j?j.p(De,Fe):(j=me[W]=Me[W](De),j.c()),P(j,1),j.m(E,null));let Oe={};Fe&32&&(Oe.amount=De[5].medals),ie.$set(Oe)},i(De){re||(P(s.$$.fragment,De),P(L.$$.fragment,De),P(j),P(ie.$$.fragment,De),re=!0)},o(De){I(s.$$.fragment,De),I(L.$$.fragment,De),I(j),I(ie.$$.fragment,De),re=!1},d(De){De&&(k(e),k(o),k(r)),ee(s),it(ue,De),ee(L),me[W].d(),ee(ie)}}}function hL(t){let e,n,i,s,o,r,a,l,c=ht(t[5].prestige)+"",f,u,p,g,v=la(t[3],S.ui.title.name[D.player.faction][t[3]-1])+"",_,b=ht(Xg(t[5].prestige))+"",y,w,C,A,M,F,V,L=ht(t[5].kills_today)+"",q,R,z,E,W,j,N=ht(t[5].fame_today)+"",U,ie,re,ae,ue,Me,me=ht(t[5].kills_this_week)+"",Ne,De,Fe,_e,H,qe,Oe=ht(t[5].fame)+"",He,Ye,Ze,ve=t[5].fame_position+"",le,ze,Z,X=su(t[5].fame_bracket)+"",$,fe,je,Ve,ye,Re,Be=ht(t[5].kills_last_week)+"",mt,wt,Qe,Et,be,Je,yt=ht(t[5].fame_last_week)+"",St,Ae,ct,$t=t[5].fame_position_last_week+"",Le,Ct,Vt,We=su(t[5].fame_bracket_last_week)+"",Ke,xe,ot,Xe,ft,kn,Fs=ht(t[5].kills_lifetime)+"",ai,Di,dt,Lt,Cs,On,li=ht(t[5].fame_lifetime)+"",bc,xr,Po,Ss=(t[5].rank_lifetime>0?la(t[5].rank_lifetime,S.ui.title.name[D.player.faction][t[5].rank_lifetime-1]):"Unranked")+"",pn;return n=new vi({props:{size:"1.5em",fract:t[4],barcol:"bgpurp",$$slots:{default:[_L]},$$scope:{ctx:t}}}),{c(){e=h("div"),te(n.$$.fragment),i=h("div"),s=h("span"),s.textContent=`${S.ui.pvpmenu.currentprestige}`,o=h("span"),r=h("img"),l=Ue(),f=T(c),u=h("span"),u.textContent=`${S.ui.pvpmenu.nextrank}`,p=h("span"),g=new Xu(!1),_=T(" ("),y=T(b),w=T(")"),C=h("div"),A=h("small"),A.textContent=`${S.ui.pvpmenu.today}`,M=h("span"),F=h("span"),F.textContent=`${S.ui.stats.misc.kills}`,V=h("span"),q=T(L),R=h("span"),R.textContent=`${S.ui.stats.misc.fame}`,z=h("span"),E=h("img"),j=Ue(),U=T(N),ie=h("div"),re=h("small"),re.textContent=`${S.ui.pvpmenu.thisweek}`,ae=h("a"),ae.textContent=`${S.ui.pvpmenu.viewbrackets}`,ue=h("span"),ue.textContent=`${S.ui.stats.misc.kills}`,Me=h("span"),Ne=T(me),De=h("span"),De.textContent=`${S.ui.stats.misc.fame}`,Fe=h("span"),_e=h("img"),qe=Ue(),He=T(Oe),Ye=h("span"),Ye.textContent=`${S.ui.pvpmenu.fameposition}`,Ze=h("span"),le=T(ve),ze=h("span"),ze.textContent=`${S.ui.pvpmenu.famebracket}`,Z=h("span"),$=T(X),fe=h("div"),je=h("small"),je.textContent=`${S.ui.pvpmenu.lastweek}`,Ve=h("span"),ye=h("span"),ye.textContent=`${S.ui.stats.misc.kills}`,Re=h("span"),mt=T(Be),wt=h("span"),wt.textContent=`${S.ui.stats.misc.fame}`,Qe=h("span"),Et=h("img"),Je=Ue(),St=T(yt),Ae=h("span"),Ae.textContent=`${S.ui.pvpmenu.fameposition}`,ct=h("span"),Le=T($t),Ct=h("span"),Ct.textContent=`${S.ui.pvpmenu.famebracket}`,Vt=h("span"),Ke=T(We),xe=h("div"),ot=h("small"),ot.textContent=`${S.ui.pvpmenu.lifetime}`,Xe=h("span"),ft=h("span"),ft.textContent=`${S.ui.stats.misc.kills}`,kn=h("span"),ai=T(Fs),Di=h("span"),Di.textContent=`${S.ui.stats.misc.fame}`,dt=h("span"),Lt=h("img"),On=Ue(),bc=T(li),xr=h("span"),xr.textContent=`${S.ui.pvpmenu.highestrank}`,Po=h("span"),m(s,"class","textwhite"),m(r,"class","svgicon"),at(r.src,a=$l)||m(r,"src",a),m(o,"class","textprestige statnumber"),m(u,"class","textwhite"),g.a=_,m(p,"class","textprestige statnumber"),m(i,"class","stats marg-top svelte-voya4q"),m(e,"class","panel-black"),m(A,"class","bold textgreen"),m(F,"class","textwhite"),m(V,"class","textprimary statnumber"),m(R,"class","textwhite"),m(E,"class","svgicon"),at(E.src,W=Ko)||m(E,"src",W),m(z,"class","textfame statnumber"),m(C,"class","stats panel-black marg-top svelte-voya4q"),m(re,"class","bold textgreen"),m(ae,"class","statnumber"),m(ae,"href","/pvp"),m(ae,"target","_blank"),m(ae,"rel","noopener noreferrer"),m(ue,"class","textwhite"),m(Me,"class","textprimary statnumber"),m(De,"class","textwhite"),m(_e,"class","svgicon"),at(_e.src,H=Ko)||m(_e,"src",H),m(Fe,"class","textfame statnumber"),m(Ye,"class","textwhite"),m(Ze,"class","textgreen statnumber"),m(ze,"class","textwhite"),m(Z,"class","textprimary statnumber"),m(ie,"class","stats panel-black marg-top svelte-voya4q"),m(je,"class","bold textgreen"),m(ye,"class","textwhite"),m(Re,"class","textprimary statnumber"),m(wt,"class","textwhite"),m(Et,"class","svgicon"),at(Et.src,be=Ko)||m(Et,"src",be),m(Qe,"class","textfame statnumber"),m(Ae,"class","textwhite"),m(ct,"class","textgreen statnumber"),m(Ct,"class","textwhite"),m(Vt,"class","textprimary statnumber"),m(fe,"class","stats panel-black marg-top svelte-voya4q"),m(ot,"class","bold textgreen"),m(ft,"class","textwhite"),m(kn,"class","textprimary statnumber"),m(Di,"class","textwhite"),m(Lt,"class","svgicon"),at(Lt.src,Cs=Ko)||m(Lt,"src",Cs),m(dt,"class","textfame statnumber"),m(xr,"class","textwhite"),m(Po,"class","textprestige statnumber"),m(xe,"class","stats panel-black marg-top svelte-voya4q")},m(Bt,Kt){x(Bt,e,Kt),K(n,e,null),d(e,i),d(i,s),d(i,o),d(o,r),d(o,l),d(o,f),d(i,u),d(i,p),g.m(v,p),d(p,_),d(p,y),d(p,w),x(Bt,C,Kt),d(C,A),d(C,M),d(C,F),d(C,V),d(V,q),d(C,R),d(C,z),d(z,E),d(z,j),d(z,U),x(Bt,ie,Kt),d(ie,re),d(ie,ae),d(ie,ue),d(ie,Me),d(Me,Ne),d(ie,De),d(ie,Fe),d(Fe,_e),d(Fe,qe),d(Fe,He),d(ie,Ye),d(ie,Ze),d(Ze,le),d(ie,ze),d(ie,Z),d(Z,$),x(Bt,fe,Kt),d(fe,je),d(fe,Ve),d(fe,ye),d(fe,Re),d(Re,mt),d(fe,wt),d(fe,Qe),d(Qe,Et),d(Qe,Je),d(Qe,St),d(fe,Ae),d(fe,ct),d(ct,Le),d(fe,Ct),d(fe,Vt),d(Vt,Ke),x(Bt,xe,Kt),d(xe,ot),d(xe,Xe),d(xe,ft),d(xe,kn),d(kn,ai),d(xe,Di),d(xe,dt),d(dt,Lt),d(dt,On),d(dt,bc),d(xe,xr),d(xe,Po),Po.innerHTML=Ss,pn=!0},p(Bt,Kt){let ci={};Kt&16&&(ci.fract=Bt[4]),Kt&2097156&&(ci.$$scope={dirty:Kt,ctx:Bt}),n.$set(ci),(!pn||Kt&32)&&c!==(c=ht(Bt[5].prestige)+"")&&G(f,c),(!pn||Kt&8)&&v!==(v=la(Bt[3],S.ui.title.name[D.player.faction][Bt[3]-1])+"")&&g.p(v),(!pn||Kt&32)&&b!==(b=ht(Xg(Bt[5].prestige))+"")&&G(y,b),(!pn||Kt&32)&&L!==(L=ht(Bt[5].kills_today)+"")&&G(q,L),(!pn||Kt&32)&&N!==(N=ht(Bt[5].fame_today)+"")&&G(U,N),(!pn||Kt&32)&&me!==(me=ht(Bt[5].kills_this_week)+"")&&G(Ne,me),(!pn||Kt&32)&&Oe!==(Oe=ht(Bt[5].fame)+"")&&G(He,Oe),(!pn||Kt&32)&&ve!==(ve=Bt[5].fame_position+"")&&G(le,ve),(!pn||Kt&32)&&X!==(X=su(Bt[5].fame_bracket)+"")&&G($,X),(!pn||Kt&32)&&Be!==(Be=ht(Bt[5].kills_last_week)+"")&&G(mt,Be),(!pn||Kt&32)&&yt!==(yt=ht(Bt[5].fame_last_week)+"")&&G(St,yt),(!pn||Kt&32)&&$t!==($t=Bt[5].fame_position_last_week+"")&&G(Le,$t),(!pn||Kt&32)&&We!==(We=su(Bt[5].fame_bracket_last_week)+"")&&G(Ke,We),(!pn||Kt&32)&&Fs!==(Fs=ht(Bt[5].kills_lifetime)+"")&&G(ai,Fs),(!pn||Kt&32)&&li!==(li=ht(Bt[5].fame_lifetime)+"")&&G(bc,li),(!pn||Kt&32)&&Ss!==(Ss=(Bt[5].rank_lifetime>0?la(Bt[5].rank_lifetime,S.ui.title.name[D.player.faction][Bt[5].rank_lifetime-1]):"Unranked")+"")&&(Po.innerHTML=Ss)},i(Bt){pn||(P(n.$$.fragment,Bt),pn=!0)},o(Bt){I(n.$$.fragment,Bt),pn=!1},d(Bt){Bt&&(k(e),k(C),k(ie),k(fe),k(xe)),ee(n)}}}function vC(t){let e,n,i=t[15]+"",s,o,r,a;function l(...c){return t[12](t[15],...c)}return{c(){e=h("div"),n=T("Queue "),s=T(i),m(e,"class",o="btn grey "+(t[6].queues&&t[6].queues.includes("arena"+t[15])?"active":""))},m(c,f){x(c,e,f),d(e,n),d(e,s),r||(a=Q(e,"click",l),r=!0)},p(c,f){t=c,f&64&&o!==(o="btn grey "+(t[6].queues&&t[6].queues.includes("arena"+t[15])?"active":""))&&m(e,"class",o)},d(c){c&&k(e),r=!1,a()}}}function gL(t){let e;return{c(){e=T("-")},m(n,i){x(n,e,i)},p:ce,i:ce,o:ce,d(n){n&&k(e)}}}function vL(t){let e,n;return e=new or({props:{amount:qf(t[5].arena_rating)}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&32&&(o.amount=qf(i[5].arena_rating)),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function _L(t){let e,n=(t[2]>0?la(t[2],S.ui.title.name[D.player.faction][t[2]-1]):"Unranked")+"";return{c(){e=h("span"),m(e,"class","absCentered ranktitle svelte-voya4q")},m(i,s){x(i,e,s),e.innerHTML=n},p(i,s){s&4&&n!==(n=(i[2]>0?la(i[2],S.ui.title.name[D.player.faction][i[2]-1]):"Unranked")+"")&&(e.innerHTML=n)},d(i){i&&k(e)}}}function bL(t){let e,n,i,s,o,r=pe(t[7]),a=[];for(let u=0;u<r.length;u+=1)a[u]=gC(dC(t,r,u));let l=[hL,dL],c=[];function f(u,p){return u[1]===0?0:u[1]===1?1:-1}return~(i=f(t,-1))&&(s=c[i]=l[i](t)),{c(){e=h("div");for(let u=0;u<a.length;u+=1)a[u].c();n=h("div"),s&&s.c(),m(e,"class","tab-bar flex"),m(n,"class","panel-bright")},m(u,p){x(u,e,p);for(let g=0;g<a.length;g+=1)a[g]&&a[g].m(e,null);x(u,n,p),~i&&c[i].m(n,null),o=!0},p(u,p){if(p&130){r=pe(u[7]);let v;for(v=0;v<r.length;v+=1){let _=dC(u,r,v);a[v]?a[v].p(_,p):(a[v]=gC(_),a[v].c(),a[v].m(e,null))}for(;v<a.length;v+=1)a[v].d(1);a.length=r.length}let g=i;i=f(u,p),i===g?~i&&c[i].p(u,p):(s&&(Te(),I(c[g],1,1,()=>{c[g]=null}),Ee()),~i?(s=c[i],s?s.p(u,p):(s=c[i]=l[i](u),s.c()),P(s,1),s.m(n,null)):s=null)},i(u){o||(P(s),o=!0)},o(u){I(s),o=!1},d(u){u&&(k(e),k(n)),it(a,u),~i&&c[i].d()}}}function yL(t){let e,n,i=t[0]&&hC(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[0]?i?(i.p(s,o),o&1&&P(i,1)):(i=hC(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function kL(t,e,n){let i,s;se(t,Qn,w=>n(6,i=w)),se(t,uo,w=>n(0,s=w));let o=["Prestige","Arena"],r=0,a=0,l=1,c=0,f={},u=async()=>{n(5,f=await Ut("/api/pvp/getplayerpvpinfo",{name:D.player.name})),n(2,a=Jl(f.prestige)),n(3,l=Math.min(a+1,12));let w=yd(l)-yd(a),C=f.prestige-yd(a);n(4,c=~~(C/w*100))},p=0,g=["3v3","5v5"],v=w=>{xt(i.queues.includes(w)?"stopqueue":"startqueue",w)},_=w=>{n(1,r=w)},b=(w,C)=>v("arena"+w),y=()=>{nt(uo,s=!1,s)};return t.$$.update=()=>{t.$$.dirty&1025&&(s&&Date.now()-p>3e4||p===0)&&(u(),n(10,p=Date.now()))},[s,r,a,l,c,f,i,o,g,v,p,_,b,y]}var cv=class extends we{constructor(e){super(),Ce(this,e,kL,yL,$e,{})}},_C=cv;function bC(t){let e,n,i=t[1].name+"",s,o,r,a=t[1].level!==void 0?`Lv. ${t[1].level} `:"",l,c,f=(t[1].class!==void 0?S.classes[t[1].class].name:"Item")+"",u,p,g,v=(t[1].faction!==void 0?S.factions[t[1].faction].name:"")+"",_,b;return{c(){e=h("div"),n=h("div"),s=T(i),o=h("div"),r=h("span"),l=T(a),c=h("span"),u=T(f),g=h("span"),_=T(v),m(n,"class","textwhite title svelte-1wip79f"),m(c,"class",p=Eo(t[1].class!==void 0?"textc"+t[1].class:"textyellow")+" svelte-1wip79f"),m(g,"class",b=Eo(t[1].faction!==void 0?"textf"+t[1].faction:"")+" svelte-1wip79f"),m(e,"class","panel-black container svelte-1wip79f"),Pe(e,"display",t[0]?"block":"none")},m(y,w){x(y,e,w),d(e,n),d(n,s),d(e,o),d(o,r),d(r,l),d(o,c),d(c,u),d(e,g),d(g,_)},p(y,w){w&2&&i!==(i=y[1].name+"")&&G(s,i),w&2&&a!==(a=y[1].level!==void 0?`Lv. ${y[1].level} `:"")&&G(l,a),w&2&&f!==(f=(y[1].class!==void 0?S.classes[y[1].class].name:"Item")+"")&&G(u,f),w&2&&p!==(p=Eo(y[1].class!==void 0?"textc"+y[1].class:"textyellow")+" svelte-1wip79f")&&m(c,"class",p),w&2&&v!==(v=(y[1].faction!==void 0?S.factions[y[1].faction].name:"")+"")&&G(_,v),w&2&&b!==(b=Eo(y[1].faction!==void 0?"textf"+y[1].faction:"")+" svelte-1wip79f")&&m(g,"class",b),w&1&&Pe(e,"display",y[0]?"block":"none")},d(y){y&&k(e)}}}function xL(t){let e,n=t[1]&&bC(t);return{c(){n&&n.c(),e=ge()},m(i,s){n&&n.m(i,s),x(i,e,s)},p(i,[s]){i[1]?n?n.p(i,s):(n=bC(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ce,o:ce,d(i){i&&k(e),n&&n.d(i)}}}function wL(t,e,n){let i;se(t,cp,o=>n(0,i=o));let s;return t.$$.update=()=>{t.$$.dirty&1&&i>0&&D.isEntityIdTaken(i)&&n(1,s=D.entity(i))},[i,s]}var fv=class extends we{constructor(e){super(),Ce(this,e,wL,xL,$e,{})}},yC=fv;var uv=ll,ru=async t=>{let e=await Ut("/api/account/info");uv.set(e),qo.set(e.storepoints),t&&t(e)};function ML(t){let e,n,i,s,o,r,a,l,c=S.ui.elixir.chatsupport+"",f,u,p,g,v,_=S.ui.elixir.noads+"",b,y,w,C,A,M,F,V,L,q=S.ui.elixir.bagslots+"",R,z,E,W,j,N,U,ie,re,ae=S.ui.elixir.stashstorage+"",ue,Me,me,Ne,De,Fe,_e,H,qe,Oe=S.ui.elixir.merchantlimit+"",He,Ye,Ze,ve,le,ze,Z,X,$,fe=S.ui.elixir.merchantduration+"",je,Ve;return{c(){e=h("div"),n=h("div"),n.innerHTML='<img class="artwork svelte-cbx1m" src="/data/ui/elixir.svg?v=8582889"/><div class="sparkle svelte-cbx1m" style="font-size:35px; left:30%; top:30%; animation-delay: -1s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:50px; left:40%; top:60%; animation-delay: -2s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:80px; left:60%; top:20%; animation-delay: -3s;">+</div>',i=h("div"),s=h("h1"),s.innerHTML='Hordes <span class="textsub">Elixir</span>',o=h("div"),r=h("img"),l=Ue(),f=T(c),u=h("div"),p=h("img"),v=Ue(),b=T(_),y=h("div"),w=h("img"),A=Ue(),M=h("span"),M.textContent=`${$n[0].inventory}`,F=Ue(),V=h("span"),V.textContent=`${$n[1].inventory}`,L=Ue(),R=T(q),z=h("div"),E=h("img"),j=Ue(),N=h("span"),N.textContent=`${$n[0].stash}`,U=Ue(),ie=h("span"),ie.textContent=`${$n[1].stash}`,re=Ue(),ue=T(ae),Me=h("div"),me=h("img"),De=Ue(),Fe=h("span"),Fe.textContent=`${$n[0].auction}`,_e=Ue(),H=h("span"),H.textContent=`${$n[1].auction}`,qe=Ue(),He=T(Oe),Ye=h("div"),Ze=h("img"),le=Ue(),ze=h("span"),ze.textContent=`${$n[0].auctionHours}h`,Z=Ue(),X=h("span"),X.textContent=`${$n[1].auctionHours}h`,$=Ue(),je=T(fe),Ve=h("div"),Ve.textContent=`${S.ui.elixir.tba}`,m(n,"class","artcontainer svelte-cbx1m"),m(s,"class","textprimary"),m(r,"class","svgicon"),at(r.src,a="/data/ui/icons/gem.svg?v=8582889")||m(r,"src",a),m(o,"class","textwhite"),m(p,"class","svgicon"),at(p.src,g="/data/ui/icons/check.svg?v=8582889")||m(p,"src",g),m(u,"class","textwhite"),m(w,"class","svgicon"),at(w.src,C="/data/ui/icons/check.svg?v=8582889")||m(w,"src",C),m(M,"class","old svelte-cbx1m"),m(V,"class","textsub"),m(y,"class","textwhite"),m(E,"class","svgicon"),at(E.src,W="/data/ui/icons/check.svg?v=8582889")||m(E,"src",W),m(N,"class","old svelte-cbx1m"),m(ie,"class","textsub"),m(z,"class","textwhite"),m(me,"class","svgicon"),at(me.src,Ne="/data/ui/icons/check.svg?v=8582889")||m(me,"src",Ne),m(Fe,"class","old svelte-cbx1m"),m(H,"class","textsub"),m(Me,"class","textwhite"),m(Ze,"class","svgicon"),at(Ze.src,ve="/data/ui/icons/check.svg?v=8582889")||m(Ze,"src",ve),m(ze,"class","old svelte-cbx1m"),m(X,"class","textsub"),m(Ye,"class","textwhite"),m(Ve,"class","textgrey"),m(e,"class","split svelte-cbx1m")},m(ye,Re){x(ye,e,Re),d(e,n),d(e,i),d(i,s),d(i,o),d(o,r),d(o,l),d(o,f),d(i,u),d(u,p),d(u,v),d(u,b),d(i,y),d(y,w),d(y,A),d(y,M),d(y,F),d(y,V),d(y,L),d(y,R),d(i,z),d(z,E),d(z,j),d(z,N),d(z,U),d(z,ie),d(z,re),d(z,ue),d(i,Me),d(Me,me),d(Me,De),d(Me,Fe),d(Me,_e),d(Me,H),d(Me,qe),d(Me,He),d(i,Ye),d(Ye,Ze),d(Ye,le),d(Ye,ze),d(Ye,Z),d(Ye,X),d(Ye,$),d(Ye,je),d(i,Ve)},p:ce,i:ce,o:ce,d(ye){ye&&k(e)}}}var pv=class extends we{constructor(e){super(),Ce(this,e,null,ML,$e,{})}},kC=pv;var lt={SECONDS_A_MINUTE:60,SECONDS_A_HOUR:3600,SECONDS_A_DAY:86400,SECONDS_A_WEEK:604800,MILLISECONDS_A_SECOND:1e3,MILLISECONDS_A_MINUTE:6e4,MILLISECONDS_A_HOUR:36e5,MILLISECONDS_A_DAY:864e5,MILLISECONDS_A_WEEK:6048e5,MS:"millisecond",S:"second",MIN:"minute",H:"hour",D:"day",W:"week",M:"month",Q:"quarter",Y:"year",DATE:"date",FORMAT_DEFAULT:"YYYY-MM-DDTHH:mm:ssZ",INVALID_DATE_STRING:"Invalid Date",REGEX_PARSE:/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,REGEX_FORMAT:/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g},mv=(t,e,n)=>{let i=String(t);return!i||i.length>=e?t:`${Array(e+1-i.length).join(n)}${t}`},FL=t=>{let e=-t.utcOffset(),n=Math.abs(e),i=Math.floor(n/60),s=n%60;return`${e<=0?"+":"-"}${mv(i,2,"0")}:${mv(s,2,"0")}`},CL=(t,e)=>{let n=(e.year()-t.year())*12+(e.month()-t.month()),i=t.clone().add(n,lt.M),s=e-i<0,o=t.clone().add(n+(s?-1:1),lt.M);return Number(-(n+(e-i)/(s?i-o:o-i))||0)},SL=t=>t<0?Math.ceil(t)||0:Math.floor(t),AL=t=>({M:lt.M,y:lt.Y,w:lt.W,d:lt.D,h:lt.H,m:lt.MIN,s:lt.S,ms:lt.MS,Q:lt.Q})[t]||String(t||"").toLowerCase().replace(/s$/,""),PL=t=>t===void 0,TL={s:mv,z:FL,m:CL,a:SL,p:AL,u:PL},EL={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},xd="en",ya={};ya[xd]=EL;var dv=t=>t instanceof Kl,wd=(t,e,n)=>{let i;if(!t)return xd;if(typeof t=="string")ya[t]&&(i=t),e&&(ya[t]=e,i=t);else{let{name:s}=t;ya[s]=t,i=s}return n||(xd=i),i},Hn=(t,e,n)=>{if(dv(t))return t.clone();let i=e?typeof e=="string"?{format:e,pl:n}:e:{};return i.date=t,new Kl(i)},DL=(t,e)=>Hn(t,{locale:e.$L,utc:e.$u,$offset:e.$offset}),an=TL;an.l=wd;an.i=dv;an.w=DL;var IL=t=>{let{date:e,utc:n}=t;if(e===null)return new Date(NaN);if(an.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){let i=e.match(lt.REGEX_PARSE);if(i)return n?new Date(Date.UTC(i[1],i[2]-1,i[3]||1,i[4]||0,i[5]||0,i[6]||0,i[7]||0)):new Date(i[1],i[2]-1,i[3]||1,i[4]||0,i[5]||0,i[6]||0,i[7]||0)}return new Date(e)},Kl=class{constructor(e){this.$L=this.$L||wd(e.locale,null,!0),this.parse(e)}parse(e){this.$d=IL(e),this.init()}init(){let{$d:e}=this;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()}$utils(){return an}isValid(){return this.$d.toString()!==lt.INVALID_DATE_STRING}isSame(e,n){let i=Hn(e);return this.startOf(n)<=i&&i<=this.endOf(n)}isAfter(e,n){return Hn(e)<this.startOf(n)}isBefore(e,n){return this.endOf(n)<Hn(e)}$g(e,n,i){return an.u(e)?this[n]:this.set(i,e)}year(e){return this.$g(e,"$y",lt.Y)}month(e){return this.$g(e,"$M",lt.M)}day(e){return this.$g(e,"$W",lt.D)}date(e){return this.$g(e,"$D",lt.DATE)}hour(e){return this.$g(e,"$H",lt.H)}minute(e){return this.$g(e,"$m",lt.MIN)}second(e){return this.$g(e,"$s",lt.S)}millisecond(e){return this.$g(e,"$ms",lt.MS)}unix(){return Math.floor(this.valueOf()/1e3)}valueOf(){return this.$d.getTime()}startOf(e,n){let i=an.u(n)?!0:n,s=an.p(e),o=(u,p)=>{let g=an.w(this.$u?Date.UTC(this.$y,p,u):new Date(this.$y,p,u),this);return i?g:g.endOf(lt.D)},r=(u,p)=>{let g=[0,0,0,0],v=[23,59,59,999];return an.w(this.toDate()[u].apply(this.toDate(),(i?g:v).slice(p)),this)},{$W:a,$M:l,$D:c}=this,f=`set${this.$u?"UTC":""}`;switch(s){case lt.Y:return i?o(1,0):o(31,11);case lt.M:return i?o(1,l):o(0,l+1);case lt.W:{let u=this.$locale().weekStart||0,p=(a<u?a+7:a)-u;return o(i?c-p:c+(6-p),l)}case lt.D:case lt.DATE:return r(`${f}Hours`,0);case lt.H:return r(`${f}Minutes`,1);case lt.MIN:return r(`${f}Seconds`,2);case lt.S:return r(`${f}Milliseconds`,3);default:return this.clone()}}endOf(e){return this.startOf(e,!1)}$set(e,n){let i=an.p(e),s=`set${this.$u?"UTC":""}`,o={[lt.D]:`${s}Date`,[lt.DATE]:`${s}Date`,[lt.M]:`${s}Month`,[lt.Y]:`${s}FullYear`,[lt.H]:`${s}Hours`,[lt.MIN]:`${s}Minutes`,[lt.S]:`${s}Seconds`,[lt.MS]:`${s}Milliseconds`}[i],r=i===lt.D?this.$D+(n-this.$W):n;if(i===lt.M||i===lt.Y){let a=this.clone().set(lt.DATE,1);a.$d[o](r),a.init(),this.$d=a.set(lt.DATE,Math.min(this.$D,a.daysInMonth())).toDate()}else o&&this.$d[o](r);return this.init(),this}set(e,n){return this.clone().$set(e,n)}get(e){return this[an.p(e)]()}add(e,n){e=Number(e);let i=an.p(n),s=a=>{let l=Hn(this);return an.w(l.date(l.date()+Math.round(a*e)),this)};if(i===lt.M)return this.set(lt.M,this.$M+e);if(i===lt.Y)return this.set(lt.Y,this.$y+e);if(i===lt.D)return s(1);if(i===lt.W)return s(7);let o={[lt.MIN]:lt.MILLISECONDS_A_MINUTE,[lt.H]:lt.MILLISECONDS_A_HOUR,[lt.S]:lt.MILLISECONDS_A_SECOND}[i]||1,r=this.$d.getTime()+e*o;return an.w(r,this)}subtract(e,n){return this.add(e*-1,n)}format(e){if(!this.isValid())return lt.INVALID_DATE_STRING;let n=e||lt.FORMAT_DEFAULT,i=an.z(this),s=this.$locale(),{$H:o,$m:r,$M:a}=this,{weekdays:l,months:c,meridiem:f}=s,u=(_,b,y,w)=>_&&(_[b]||_(this,n))||y[b].substr(0,w),p=_=>an.s(o%12||12,_,"0"),g=f||((_,b,y)=>{let w=_<12?"AM":"PM";return y?w.toLowerCase():w}),v={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:an.s(a+1,2,"0"),MMM:u(s.monthsShort,a,c,3),MMMM:c[a]||c(this,n),D:this.$D,DD:an.s(this.$D,2,"0"),d:String(this.$W),dd:u(s.weekdaysMin,this.$W,l,2),ddd:u(s.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(o),HH:an.s(o,2,"0"),h:p(1),hh:p(2),a:g(o,r,!0),A:g(o,r,!1),m:String(r),mm:an.s(r,2,"0"),s:String(this.$s),ss:an.s(this.$s,2,"0"),SSS:an.s(this.$ms,3,"0"),Z:i};return n.replace(lt.REGEX_FORMAT,(_,b)=>b||v[_]||i.replace(":",""))}utcOffset(){return-Math.round(this.$d.getTimezoneOffset()/15)*15}diff(e,n,i){let s=an.p(n),o=Hn(e),r=(o.utcOffset()-this.utcOffset())*lt.MILLISECONDS_A_MINUTE,a=this-o,l=an.m(this,o);return l={[lt.Y]:l/12,[lt.M]:l,[lt.Q]:l/3,[lt.W]:(a-r)/lt.MILLISECONDS_A_WEEK,[lt.D]:(a-r)/lt.MILLISECONDS_A_DAY,[lt.H]:a/lt.MILLISECONDS_A_HOUR,[lt.MIN]:a/lt.MILLISECONDS_A_MINUTE,[lt.S]:a/lt.MILLISECONDS_A_SECOND}[s]||a,i?l:an.a(l)}daysInMonth(){return this.endOf(lt.M).$D}$locale(){return ya[this.$L]}locale(e,n){if(!e)return this.$L;let i=this.clone();return i.$L=wd(e,n,!0),i}clone(){return an.w(this.$d,this)}toDate(){return new Date(this.valueOf())}toJSON(){return this.isValid()?this.toISOString():null}toISOString(){return this.$d.toISOString()}toString(){return this.$d.toUTCString()}};Hn.prototype=Kl.prototype;Hn.extend=(t,e)=>(t(e,Kl,Hn),Hn);Hn.locale=wd;Hn.isDayjs=dv;Hn.unix=t=>Hn(t*1e3);Hn.en=ya[xd];Hn.Ls=ya;var au=Hn;function xC(t,e,n){let i=t.slice();return i[13]=e[n],i[15]=n,i}function VL(t){let e=S.ui.elixir.notactive+"",n;return{c(){n=T(e)},m(i,s){x(i,n,s)},p:ce,d(i){i&&k(n)}}}function LL(t){let e,n,i,s=au(t[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"",o;return{c(){e=h("img"),i=Ue(),o=T(s),m(e,"class","svgicon"),at(e.src,n="/data/ui/icons/check.svg?v=8582889")||m(e,"src",n)},m(r,a){x(r,e,a),x(r,i,a),x(r,o,a)},p(r,a){a&2&&s!==(s=au(r[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"")&&G(o,s)},d(r){r&&(k(e),k(i),k(o))}}}function wC(t){let e,n=t[13].name+"",i,s,o,r,a,l,c;o=new rr({props:{amount:t[13].price}});function f(...u){return t[9](t[15],...u)}return{c(){e=h("btn"),i=T(n),s=Ue(),te(o.$$.fragment),m(e,"class",r="btn black navbtn textwhite "+(t[5]==t[15]?"active":"")+" big")},m(u,p){x(u,e,p),d(e,i),d(e,s),K(o,e,null),a=!0,l||(c=Q(e,"click",f),l=!0)},p(u,p){t=u,(!a||p&32&&r!==(r="btn black navbtn textwhite "+(t[5]==t[15]?"active":"")+" big"))&&m(e,"class",r)},i(u){a||(P(o.$$.fragment,u),a=!0)},o(u){I(o.$$.fragment,u),a=!1},d(u){u&&k(e),ee(o),l=!1,c()}}}function MC(t){let e,n=S.ui.elixir.sendgift+"",i,s,o,r;return{c(){e=h("btn"),i=T(n),m(e,"class",s="btn navbtn "+(t[6]?"active white":"textprimary")+" big")},m(a,l){x(a,e,l),d(e,i),o||(r=Q(e,"click",t[10]),o=!0)},p(a,l){l&64&&s!==(s="btn navbtn "+(a[6]?"active white":"textprimary")+" big")&&m(e,"class",s)},d(a){a&&k(e),o=!1,r()}}}function qL(t){let e,n;return{c(){e=h("div"),n=h("p"),n.textContent=`${S.ui.elixir.thankyou}`,m(n,"class","fadeIn textsub"),m(e,"class","fadeIn card marg-top")},m(i,s){x(i,e,s),d(e,n)},p:ce,i:ce,o:ce,d(i){i&&k(e)}}}function RL(t){let e,n,i=(t[6]?S.ui.elixir.willgift:S.ui.elixir.willadd)+"",s,o,r,a=S.ui.elixir.subduration[t[5]]+"",l,c,f,u,p=S.ui.elixir.willcost+"",g,v,_,b,y,w,C,A,M=(t[6]?S.ui.elixir.send:t[1].subscribed_until?S.ui.elixir.extend:S.ui.elixir.activate)+"",F,V,L,q,R;v=new rr({props:{amount:t[8].price}});let z=[zL,BL],E=[];function W(U,ie){return U[6]?1:0}b=W(t,-1),y=E[b]=z[b](t);let j=t[0]=="addsubscription"&&t[2]&&FC(t),N=t[1].storepoints<t[8].price&&CC(t);return{c(){e=h("div"),n=h("div"),s=T(i),o=Ue(),r=h("span"),l=T(a),c=Ue(),f=h("span"),f.textContent=`${S.ui.elixir.subscription}`,u=T("? "),g=T(p),te(v.$$.fragment),_=T("."),y.c(),w=ge(),j&&j.c(),C=h("div"),A=h("div"),F=T(M),N&&N.c(),m(r,"class","bold textwhite"),m(f,"class","textsub"),m(n,"class","textgrey"),m(A,"class",V="btn grey formatted "+(t[3]=="addsubscription"||t[1].storepoints<t[8].price?"disabled":"")),m(C,"class","subnav"),m(e,"class","fadeIn card marg-top"),Pe(e,"padding","18px")},m(U,ie){x(U,e,ie),d(e,n),d(n,s),d(n,o),d(n,r),d(r,l),d(n,c),d(n,f),d(n,u),d(n,g),K(v,n,null),d(n,_),E[b].m(e,null),d(e,w),j&&j.m(e,null),d(e,C),d(C,A),d(A,F),N&&N.m(e,null),L=!0,q||(R=Q(A,"click",t[12]),q=!0)},p(U,ie){(!L||ie&64)&&i!==(i=(U[6]?S.ui.elixir.willgift:S.ui.elixir.willadd)+"")&&G(s,i),(!L||ie&32)&&a!==(a=S.ui.elixir.subduration[U[5]]+"")&&G(l,a);let re={};ie&256&&(re.amount=U[8].price),v.$set(re);let ae=b;b=W(U,ie),b===ae?E[b].p(U,ie):(Te(),I(E[ae],1,1,()=>{E[ae]=null}),Ee(),y=E[b],y?y.p(U,ie):(y=E[b]=z[b](U),y.c()),P(y,1),y.m(e,w)),U[0]=="addsubscription"&&U[2]?j?j.p(U,ie):(j=FC(U),j.c(),j.m(e,C)):j&&(j.d(1),j=null),(!L||ie&66)&&M!==(M=(U[6]?S.ui.elixir.send:U[1].subscribed_until?S.ui.elixir.extend:S.ui.elixir.activate)+"")&&G(F,M),(!L||ie&266&&V!==(V="btn grey formatted "+(U[3]=="addsubscription"||U[1].storepoints<U[8].price?"disabled":"")))&&m(A,"class",V),U[1].storepoints<U[8].price?N||(N=CC(U),N.c(),N.m(e,null)):N&&(N.d(1),N=null)},i(U){L||(P(v.$$.fragment,U),P(y),L=!0)},o(U){I(v.$$.fragment,U),I(y),L=!1},d(U){U&&k(e),ee(v),E[b].d(),j&&j.d(),N&&N.d(),q=!1,R()}}}function BL(t){let e,n,i,s;function o(a){t[11](a)}let r={};return t[7]!==void 0&&(r.name=t[7]),n=new kd({props:r}),Wt.push(()=>Lo(n,"name",o)),{c(){e=h("div"),te(n.$$.fragment),m(e,"class","subnav")},m(a,l){x(a,e,l),K(n,e,null),s=!0},p(a,l){let c={};!i&&l&128&&(i=!0,c.name=a[7],Vo(()=>i=!1)),n.$set(c)},i(a){s||(P(n.$$.fragment,a),s=!0)},o(a){I(n.$$.fragment,a),s=!1},d(a){a&&k(e),ee(n)}}}function zL(t){let e,n=S.ui.elixir.enable+"",i,s,o,r=au(t[1].subscribed_until||void 0).add(t[8].days,"day").format("MMM DD, YYYY HH:mm")+"",a,l;return{c(){e=h("p"),i=T(n),s=Ue(),o=h("span"),a=T(r),l=T("."),m(o,"class","textwhite"),m(e,"class","bold textsub")},m(c,f){x(c,e,f),d(e,i),d(e,s),d(e,o),d(o,a),d(e,l)},p(c,f){f&258&&r!==(r=au(c[1].subscribed_until||void 0).add(c[8].days,"day").format("MMM DD, YYYY HH:mm")+"")&&G(a,r)},i:ce,o:ce,d(c){c&&k(e)}}}function FC(t){let e,n;return{c(){e=h("p"),n=T(t[2]),m(e,"class","fadeIn textred")},m(i,s){x(i,e,s),d(e,n)},p(i,s){s&4&&G(n,i[2])},d(i){i&&k(e)}}}function CC(t){let e,n,i=S.ui.elixir.pointserror+"",s,o,r;return{c(){e=h("p"),n=h("small"),s=T(i),o=Ue(),r=h("a"),r.textContent=`${S.ui.elixir.buypoints} ${S.ui.elixir.currency}`,m(r,"class","textprimary"),m(r,"href","/store")},m(a,l){x(a,e,l),d(e,n),d(n,s),d(n,o),d(n,r)},d(a){a&&k(e)}}}function $L(t){let e,n,i,s,o,r,a,l,c,f,u,p,g,v,_,b;n=new kC({});function y(z,E){return z[1].subscribed_until?LL:VL}let w=y(t,-1),C=w(t);l=new rr({props:{amount:t[1].storepoints}});let A=pe(fd),M=[];for(let z=0;z<A.length;z+=1)M[z]=wC(xC(t,A,z));let F=z=>I(M[z],1,1,()=>{M[z]=null}),V=t[5]!==void 0&&MC(t),L=[RL,qL],q=[];function R(z,E){return z[5]!==void 0?0:z[0]=="addsubscription"?1:-1}return~(v=R(t,-1))&&(_=q[v]=L[v](t)),{c(){e=h("div"),te(n.$$.fragment),i=h("small"),i.textContent=`${S.ui.elixir.subscription}`,s=h("div"),C.c(),r=h("small"),r.textContent=`${S.ui.elixir.currency}`,a=h("div"),te(l.$$.fragment),c=Ue(),f=h("a"),f.textContent=`${S.ui.elixir.buypoints} ${S.ui.elixir.currency}`,u=h("p"),u.textContent=`${S.ui.elixir.support}`,p=h("div");for(let z=0;z<M.length;z+=1)M[z].c();g=ge(),V&&V.c(),_&&_.c(),m(i,"class","textgrey"),m(s,"class",o="cardinfo "+(t[1].subscribed_until?"textsub":"textgrey")),m(r,"class","textgrey"),m(f,"class","textwhite"),m(f,"href","/store"),m(a,"class","cardinfo"),m(u,"class","textgrey"),m(p,"class","subnav"),m(e,"class","card")},m(z,E){x(z,e,E),K(n,e,null),d(e,i),d(e,s),C.m(s,null),d(e,r),d(e,a),K(l,a,null),d(a,c),d(a,f),d(e,u),d(e,p);for(let W=0;W<M.length;W+=1)M[W]&&M[W].m(p,null);d(p,g),V&&V.m(p,null),~v&&q[v].m(e,null),b=!0},p(z,[E]){w===(w=y(z,E))&&C?C.p(z,E):(C.d(1),C=w(z),C&&(C.c(),C.m(s,null))),(!b||E&2&&o!==(o="cardinfo "+(z[1].subscribed_until?"textsub":"textgrey")))&&m(s,"class",o);let W={};if(E&2&&(W.amount=z[1].storepoints),l.$set(W),E&32){A=pe(fd);let N;for(N=0;N<A.length;N+=1){let U=xC(z,A,N);M[N]?(M[N].p(U,E),P(M[N],1)):(M[N]=wC(U),M[N].c(),P(M[N],1),M[N].m(p,g))}for(Te(),N=A.length;N<M.length;N+=1)F(N);Ee()}z[5]!==void 0?V?V.p(z,E):(V=MC(z),V.c(),V.m(p,null)):V&&(V.d(1),V=null);let j=v;v=R(z,E),v===j?~v&&q[v].p(z,E):(_&&(Te(),I(q[j],1,1,()=>{q[j]=null}),Ee()),~v?(_=q[v],_?_.p(z,E):(_=q[v]=L[v](z),_.c()),P(_,1),_.m(e,null)):_=null)},i(z){if(!b){P(n.$$.fragment,z),P(l.$$.fragment,z);for(let E=0;E<A.length;E+=1)P(M[E]);P(_),b=!0}},o(z){I(n.$$.fragment,z),I(l.$$.fragment,z),M=M.filter(Boolean);for(let E=0;E<M.length;E+=1)I(M[E]);I(_),b=!1},d(z){z&&k(e),ee(n),C.d(),ee(l),it(M,z),V&&V.d(),~v&&q[v].d()}}}function UL(t,e,n){let i,s,o=!1,r,{user:a}=e,{flash:l=void 0}=e,{flashmsg:c=void 0}=e,{action:f=void 0}=e,{apiCall:u}=e,p=(b,y)=>n(5,s=b),g=b=>n(6,o=!o);function v(b){r=b,n(7,r)}let _=b=>u("addsubscription","/api/account/addsubscription",{value:s,gift:o?r:void 0},!0,y=>{y.result=="ok"&&(n(5,s=void 0),n(0,l="addsubscription"))});return t.$$set=b=>{"user"in b&&n(1,a=b.user),"flash"in b&&n(0,l=b.flash),"flashmsg"in b&&n(2,c=b.flashmsg),"action"in b&&n(3,f=b.action),"apiCall"in b&&n(4,u=b.apiCall)},t.$$.update=()=>{t.$$.dirty&32&&n(8,i=fd[s])},[l,a,c,f,u,s,o,r,i,p,g,v,_]}var hv=class extends we{constructor(e){super(),Ce(this,e,UL,$L,$e,{user:1,flash:0,flashmsg:2,action:3,apiCall:4})}},SC=hv;function AC(t){let e,n,i,s;return i=new Ot({props:{title:"Store / Elixir",icon:"gem",$$slots:{default:[OL]},$$scope:{ctx:t}}}),i.$on("close",t[6]),{c(){e=h("div"),n=h("div"),te(i.$$.fragment),m(n,"class","uiscaled"),m(e,"class","absCentered container svelte-1un8upk")},m(o,r){x(o,e,r),d(e,n),K(i,n,null),s=!0},p(o,r){let a={};r&316&&(a.$$scope={dirty:r,ctx:o}),i.$set(a)},i(o){s||(P(i.$$.fragment,o),s=!0)},o(o){I(i.$$.fragment,o),s=!1},d(o){o&&k(e),ee(i)}}}function PC(t){let e,n;return e=new SC({props:{user:t[5],flash:t[2],flashmsg:t[3],action:t[4],apiCall:t[0]}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},p(i,s){let o={};s&32&&(o.user=i[5]),s&4&&(o.flash=i[2]),s&8&&(o.flashmsg=i[3]),s&16&&(o.action=i[4]),e.$set(o)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function OL(t){let e,n,i=t[5]&&PC(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,o){s[5]?i?(i.p(s,o),o&32&&P(i,1)):(i=PC(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function NL(t){let e,n,i=t[1]&&AC(t);return{c(){i&&i.c(),e=ge()},m(s,o){i&&i.m(s,o),x(s,e,o),n=!0},p(s,[o]){s[1]?i?(i.p(s,o),o&2&&P(i,1)):(i=AC(s),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(Te(),I(i,1,1,()=>{i=null}),Ee())},i(s){n||(P(i),n=!0)},o(s){I(i),n=!1},d(s){s&&k(e),i&&i.d(s)}}}function jL(t,e,n){let i,s;se(t,Li,u=>n(1,i=u)),se(t,uv,u=>n(5,s=u));let o,r,a,l,c=async(u,p,g,v,_)=>{n(4,l=u);let b=await Ut(p,g);n(4,l=void 0),b.result==="ok"?n(2,r=void 0):(n(2,r=u),n(3,a=b.result)),v&&ru(),_&&_(b)},f=u=>nt(Li,i=!1,i);return t.$$.update=()=>{t.$$.dirty&2&&i&&ru()},[c,i,r,a,l,s,f]}var gv=class extends we{constructor(e){super(),Ce(this,e,jL,NL,$e,{apiCall:0})}get apiCall(){return this.$$.ctx[0]}},TC=gv;function EC(t){let e,n;return{c(){e=h("ins"),n=h("script"),n.textContent="(adsbygoogle = window.adsbygoogle || []).push({});",m(e,"class","adsbygoogle"),Pe(e,"display","inline-block"),Pe(e,"width","728px"),Pe(e,"height","90px"),m(e,"data-ad-client","ca-pub-6128207871826113"),m(e,"data-ad-slot","2385450998")},m(i,s){x(i,e,s),x(i,n,s)},d(i){i&&(k(e),k(n))}}}function WL(t){let e,n,i,s,o,r,a,l=t[1]%2==0&&EC(t);return{c(){e=h("div"),n=h("h3"),i=T("Hordes.io is free! Buy "),s=h("span"),s.innerHTML='<span class="textwhite">Hordes</span> <img class="svgicon texticon" src="/data/ui/icons/gem.svg?v=8582889"/>  Elixir',o=T(" to hide this window and support development."),l&&l.c(),m(s,"class","btn textsub"),m(n,"class","textgrey blocktext svelte-svpjti"),m(e,"class","container panel-black svelte-svpjti")},m(c,f){x(c,e,f),d(e,n),d(n,i),d(n,s),d(n,o),l&&l.m(e,null),r||(a=Q(s,"click",t[2]),r=!0)},p(c,[f]){c[1]%2==0?l||(l=EC(c),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i:ce,o:ce,d(c){c&&k(e),l&&l.d(),r=!1,a()}}}function GL(t,e,n){let i,s;return se(t,Li,r=>n(0,i=r)),se(t,Ar,r=>n(1,s=r)),[i,s,r=>nt(Li,i=!0,i)]}var vv=class extends we{constructor(e){super(),Ce(this,e,GL,WL,$e,{})}},DC=vv;function IC(t,e,n){let i=t.slice();return i[4]=e[n],i}function VC(t){let e,n,i=ni(t[4].viewers)+"",s;return{c(){e=h("div"),n=h("span"),s=T(i),m(n,"class","textgreen"),m(e,"class","bold viewcount textbox svelte-13wcf6i")},m(o,r){x(o,e,r),d(e,n),d(n,s)},p(o,r){r&2&&i!==(i=ni(o[4].viewers)+"")&&G(s,i)},d(o){o&&k(e)}}}function LC(t){let e,n,i,s=t[4].name+"",o,r,a,l,c=t[4].viewers&&VC(t);return{c(){e=h("a"),n=h("div"),c&&c.c(),i=h("div"),o=T(s),m(i,"class","name textbox svelte-13wcf6i"),m(n,"class","border black preview svelte-13wcf6i"),m(n,"style",r=(t[4].preview?"background-image:url("+t[4].preview+");":"")+"); "+(t[0]?"margin-top:2px;":"")),m(e,"class","fadeIn stream svelte-13wcf6i"),m(e,"target","_blank"),m(e,"rel","noopener noreferrer"),m(e,"href",a=t[4].url),m(e,"style",l=t[0]?"":"width:calc(100%/6);")},m(f,u){x(f,e,u),d(e,n),c&&c.m(n,null),d(n,i),d(i,o)},p(f,u){f[4].viewers?c?c.p(f,u):(c=VC(f),c.c(),c.m(n,i)):c&&(c.d(1),c=null),u&2&&s!==(s=f[4].name+"")&&G(o,s),u&3&&r!==(r=(f[4].preview?"background-image:url("+f[4].preview+");":"")+"); "+(f[0]?"margin-top:2px;":""))&&m(n,"style",r),u&2&&a!==(a=f[4].url)&&m(e,"href",a),u&1&&l!==(l=f[0]?"":"width:calc(100%/6);")&&m(e,"style",l)},d(f){f&&k(e),c&&c.d()}}}function HL(t){let e,n,i=pe(t[1]),s=[];for(let o=0;o<i.length;o+=1)s[o]=LC(IC(t,i,o));return{c(){e=h("div");for(let o=0;o<s.length;o+=1)s[o].c();m(e,"style",n="pointer-events: all; "+(t[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))},m(o,r){x(o,e,r);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null)},p(o,[r]){if(r&3){i=pe(o[1]);let a;for(a=0;a<i.length;a+=1){let l=IC(o,i,a);s[a]?s[a].p(l,r):(s[a]=LC(l),s[a].c(),s[a].m(e,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=i.length}r&1&&n!==(n="pointer-events: all; "+(o[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))&&m(e,"style",n)},i:ce,o:ce,d(o){o&&k(e),it(s,o)}}}function YL(t,e,n){let{vertical:i=!1}=e,s=[],o,r=async()=>{o=setTimeout(r,2e4),n(1,s=await Ut("/api/twitch/streams",{max:6}))};return jn(r),Wn(a=>{o&&clearTimeout(o)}),t.$$set=a=>{"vertical"in a&&n(0,i=a.vertical)},[i,s]}var _v=class extends we{constructor(e){super(),Ce(this,e,YL,HL,$e,{vertical:0})}},qC=_v;function RC(t){let e,n,i=t[1][3]+"",s,o,r=t[1][1]+"",a,l,c,f=t[1][0]+"",u,p,g,v=t[1][2]+"",_,b,y,w=t[1][4]+"",C,A;return{c(){e=h("small"),n=h("div"),s=T(i),o=h("div"),a=T(r),l=T(" fps"),c=h("div"),u=T(f),p=T(" ms"),g=h("div"),_=T(v),b=T(" KBs"),y=h("div"),C=T(w),A=T(" BFR"),m(n,"class","textyellow"),m(o,"class","textgreen"),m(c,"class","textcyan"),m(g,"class","textorange"),m(y,"class","textpurp"),m(e,"class","marg-top bar btn black grey svelte-nijy6x")},m(M,F){x(M,e,F),d(e,n),d(n,s),d(e,o),d(o,a),d(o,l),d(e,c),d(c,u),d(c,p),d(e,g),d(g,_),d(g,b),d(e,y),d(y,C),d(y,A)},p(M,F){F&2&&i!==(i=M[1][3]+"")&&G(s,i),F&2&&r!==(r=M[1][1]+"")&&G(a,r),F&2&&f!==(f=M[1][0]+"")&&G(u,f),F&2&&v!==(v=M[1][2]+"")&&G(_,v),F&2&&w!==(w=M[1][4]+"")&&G(C,w)},d(M){M&&k(e)}}}function XL(t){let e,n=t[0]&&RC(t);return{c(){n&&n.c(),e=ge()},m(i,s){n&&n.m(i,s),x(i,e,s)},p(i,[s]){i[0]?n?n.p(i,s):(n=RC(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ce,o:ce,d(i){i&&k(e),n&&n.d(i)}}}function QL(t,e,n){let i,s;return se(t,gl,o=>n(0,i=o)),se(t,fp,o=>n(1,s=o)),[i,s]}var bv=class extends we{constructor(e){super(),Ce(this,e,QL,XL,$e,{})}},BC=bv;var s2={};Xn(s2,{canvas:()=>yi,changeCanvas:()=>o0,init:()=>iR,onWorldDestroy:()=>aR,onWorldEnter:()=>rR,postTick:()=>sR});var kv=0,is=0,xv=0,wv=5,lu=10,cu=10,UC=0,ZL,Mv=0,Fv=0,Cv=0,Sv=0,OC=(t,e)=>{t=Math.max(150,Math.min(1500,t)),is=t*.8,xv=Math.min(is,150),kv=20,Mv=is,Sv=is**2,Fv=Math.min(is,50),Cv=Math.min(is/32,150/32)**2,gt.far=UC=t,ZL=t**2,Oc(gt),cu=Math.min(is,100+e*50),lu=Math.min(is,40+e*10),wv=(cu+lu)/2,Un=Math.ceil(t*2/32),Un+=Un%2,ur=Un/2,ur+=ur%2,JL()},yv=[],fr=[],Md=[],Av=0,Pv=0,Tv=-1/0,Ev=-1/0,Dv=-1/0,Iv=-1/0,pr=-1/0,fu=-1/0,mr=-1/0,uu=-1/0,Un=0,ur=0,JL=()=>{let t=ur,e=(Math.min(is*.7,250)/32)**2,n=(Math.max(e,is)/32)**2,i=(UC/32)**2;yv.length=0,fr.length=0;for(let s=0;s<Un;++s)for(let o=0;o<Un;++o){let r=(t-o)**2+(t-s)**2,a=0;r>i?a=3:r>n?a=2:r>e&&(a=1),yv.push(r),fr.push(a)}Md.length=0;for(let s=0;s<Un;++s)for(let o=0;o<Un;++o){let r=o%2,l=s%2*2+r,c=Math.min(fr[o+s*Un],2);if(c<2){let f=fr[Math.min(Un-1,o+1)+s*Un]>c,u=fr[Math.max(0,o-1)+s*Un]>c,p=fr[o+Math.max(0,s-1)*Un]>c,g=fr[o+Math.min(Un-1,s+1)*Un]>c,v=l*33+c*16+((u?1:0)|(p?2:0)|(f?4:0)|(g?8:0));Md.push(v)}else Md.push(l*33+c*16)}},Vv=(t,e)=>{if(t<pr||t>=fu||e<mr||e>=uu)return 3;let n=t-pr,i=e-mr;return fr[n+i*Un]},NC=(t,e)=>{if(t<pr||t>=fu||e<mr||e>=uu)return 1/0;let n=t-pr,i=e-mr;return yv[n+i*Un]},jC=(t,e)=>{if(t<pr||t>=fu||e<mr||e>=uu)return 2*16;let n=t-pr,i=e-mr;return Md[n+i*Un]},zC=-1/0,$C=-1/0,KL=(t,e)=>(t=Math.floor(t/64)*2,e=Math.floor(e/64)*2,t!==zC||e!==$C?(pr=t-ur,fu=t+ur,mr=e-ur,uu=e+ur,Tv=Math.floor(pr/2),Ev=Math.ceil(fu/2),Dv=Math.floor(mr/2),Iv=Math.ceil(uu/2),Av=Math.floor(t/2),Pv=Math.floor(e/2),zC=t,$C=e,!0):!1),Lv=!0,WC=t=>{Lv=KL(Gt.position[0],Gt.position[2])};var eq=0,HC=(t,e,n,i=0,s=!1,o=!1)=>{let r={id:eq++,geometry:Cn({}),program:t,shadowProgram:i,mode:e,uniformData:{},individualFrustums:o,dynamic:s,needsUpdate:!1,lastUpdateCamPos:[0,0,0],drawCount:0,cullFace:1029,instances:[],instancedAttributeNames:[],instancedAttributes:[],instancedData:[]};for(let a=0;a<n.length;++a){let l=n[a];GC(r,l.name,l.size)}return GC(r,"worldMatrix",16),r},GC=(t,e,n)=>{t.instancedAttributes.push({name:e,instanced:!0,bufferMode:t.dynamic?35048:35044,size:n,data:new Float32Array(n)}),t.instancedAttributeNames.push(e),t.instancedData.push([])},qv=t=>{let e=on();e.geometry=t.geometry,e.data.multi=t,t.instances.push(e);for(let n=0;n<t.instancedAttributes.length;++n){let i=t.instancedAttributes[n],s=t.instancedAttributeNames[n];t.instancedData[n].push(e.data[s]=s==="worldMatrix"?e.worldMatrix:Array(i.size).fill(1))}return t.needsUpdate=!0,e},YC=(t,e,n,i)=>{let s=t.instances.indexOf(e),o=t.instancedAttributeNames.indexOf(n);o>=0&&(t.instancedData[o][s]=i,e.data[n]=i)},ks=(t,e)=>{let n=t.instances.indexOf(e);t.instances.splice(n,1);for(let i=0;i<t.instancedAttributes.length;++i)t.instancedData[i].splice(n,1);t.needsUpdate=!0,us(e)},XC=t=>{for(let e=0;e<t.instances;++e)us(t[e]);for(let e=0;e<t.instancedAttributes.length;++e)t.instancedData[e].length=0;t.instances.length=0,t.needsUpdate=!0},tq=(t,e)=>{t.needsUpdate=t.dynamic;for(let a=0;a<t.instancedAttributes.length;++a){let l=t.instancedAttributes[a];nq(l,l.size,t.instances.length)}let n=t.dynamic,i=t.individualFrustums,s=t.instancedData,o=t.instances,r=0;for(let a=0;a<o.length;++a){let l=o[a];if(l.visible&&(!n||!i||__(e,l.geometry,l))){for(let f=0;f<t.instancedAttributes.length;++f){let u=t.instancedAttributes[f],p=u.data,g=s[f][a],v=r*u.size,_=v+u.size;for(let b=v,y=0;b<_;++b,++y)p[b]=g[y]}r++}}if(t.drawCount=r,ym(t.geometry,t.drawCount),t.drawCount!==0)for(let a=0;a<t.instancedAttributes.length;++a){let l=t.instancedAttributes[a];bm(t.geometry,l,r)}},ec=(t,e,n,i)=>{if(n&&t.needsUpdate&&tq(t,i),e.active&&t.drawCount>0){e.cullFace=t.cullFace;for(let s=0;s<e.autoUniforms.length;++s){let o=e.autoUniforms[s];e.uniforms[o].value=t.uniformData[o]}km(t.uniformData,e),Sl(e,et.currentProgram===e.id),Cl(t.geometry,e,t.mode)}},QC=(t,e)=>{let n={...e};for(let i=0;i<t.instancedAttributeNames.length;++i)n[t.instancedAttributeNames[i]]=t.instancedAttributes[i];Qh(t.geometry,n)},nq=(t,e,n)=>{t.data=t.data.byteLength>=e*n*4?t.data:new Float32Array(e*(n+5))};var Co=[],ZC=(10+1)*6,xa=new Uint32Array(ZC);for(let t=0,e=0;t<ZC;t+=6,e+=2)xa[t+0]=e,xa[t+1]=e+1,xa[t+2]=e+3,xa[t+3]=e,xa[t+4]=e+3,xa[t+5]=e+2;var Fd=new Map,JC=(t,e,n,i,s,o)=>{let r=n1.get(t),a=Fd.get(r.steps),l;return!a||a.length===0?l=new Rv(r):l=a.pop(),l.reset(r,e,n,i,s,o),Co.push(l),l},KC=(t,e)=>{for(let n=0;n<Co.length;n++)if(Co[n].tick(t,e),Co[n].remove){let i=Co.splice(n--,1)[0];e8(i)}},e8=t=>{Fd.has(t.maxSteps)||Fd.set(t.maxSteps,[]),Fd.get(t.maxSteps).push(t),t.onCache()},t8=t=>{Co.forEach(e8),Co.length=0},n8=()=>{for(let t=0;t<Co.length;++t){let e=Co[t];e.mesh.transform.visible&&Ki(e.mesh,pt[e.mesh.program])}},Rv=class{constructor(e){this.maxSteps=e.steps,this.stepTimer=new kt(0,1),this.duration=new kt(0,1),this.remove=!1,this.a=[0,0,0],this.b=[0,0,0],this.timeoutSteps=0;let n=this.maxSteps+1;this.uv=new Float32Array(n*4),this.positions=new Float32Array(n*6);for(let i=0,s=0;i<n;++i,s+=4)this.uv[s]=i/this.maxSteps,this.uv[s+2]=i/this.maxSteps,this.uv[s+1]=1,this.uv[s+3]=0;this.geometry=Cn({position:{size:3,data:this.positions},uv:{size:2,data:this.uv},index:{type:O.UNSIGNED_INT,data:xa.subarray(0,6*this.maxSteps)}}),bm(this.geometry,this.geometry.attributes.uv,n),this.mesh=qi(this.geometry,19,O.TRIANGLES),this.mesh.uniformData.offset=[0,0],this.waitingForTexture=!1,this.parent=null}reset(e,n,i,s,o,r){this.stepTimer.reset(0,e.interval),this.duration.reset(r,o),this.currentStep=0,this.a=st(this.a,i),this.b=st(this.b,s),this.mesh.uniformData.offset[1]=1/(this.maxSteps+1),this.remove=!1,this.timeoutSteps=0,this.geometry.drawRangeCount=0,this.mesh.uniformData.colStart=e.colStart,this.mesh.uniformData.colEnd=e.colEnd,e.texture>0?(this.waitingForTexture=!0,this.mesh.program=19,gi(e.texture,a=>{this.mesh.uniformData.diffuse=a,this.waitingForTexture=!1})):(this.waitingForTexture=!1,this.mesh.program=18,this.mesh.uniformData.diffuse=void 0),this.parent=n}tick(e,n){if(this.waitingForTexture){this.mesh.transform.visible=!1;return}if(this.duration.duration>0&&this.duration.done(n)){this.remove=!0;return}if(this.parent!==null){if(this.mesh.transform.visible=this.parent.visible&&(!this.parent.parent||this.parent.parent.visible),!this.mesh.transform.visible)return;this.mesh.transform.visible&&this.timeoutSteps==0&&(this.positions.set(Mi(bt,this.a,this.parent.worldMatrix),0),this.positions.set(Mi(bt,this.b,this.parent.worldMatrix),3))}this.stepTimer.done(n)&&(this.stepTimer.reset(n),this.step()),hi(this.geometry,this.geometry.attributes.position);let i=this.stepTimer.fraction(n);this.mesh.uniformData.offset[0]=(1-i)/this.maxSteps}detach(){this.timeoutSteps=Math.max(1,this.currentStep),this.parent=null}step(){this.currentStep=Math.min(this.maxSteps,this.currentStep+1),this.positions.copyWithin(6,0),this.geometry.drawRangeCount=this.currentStep*6,this.timeoutSteps>0&&(this.timeoutSteps--,this.timeoutSteps==0&&(this.remove=!0))}onCache(){this.mesh.transform.visible=!1,this.parent=null}};var Cd=[],wa=1e3,sq=500,tc=sq,gr=[],s8=()=>{cq();for(let t=0;t<wa;++t)Cd.push({pos:[-0,-0,-0],vel:[-0,-0,-0],info:Mm.get(1),distance:0,start:0,end:1.01,forced:!1,scaleRota:[0,0,0,0],infoVec:[0,0,0,0],progVec:[0,0]})},Sd=(t,e,n,i)=>{let s=e,o=n,r=!0,a=n;for(;e-n<0;)r?t[a].distance>t[e].distance?(i8(t,a,e),a=e,n--,r=!r):e++:t[a].distance>=t[n].distance?n--:(i8(t,a,n),e++,a=n,r=!r);a-1>s&&Sd(t,s,a-1,i),a+1<o&&Sd(t,a+1,o,i)},i8=(t,e,n)=>{let i=t[e];t[e]=t[n],t[n]=i},oq=(t,e,n)=>{let i=[[],[]],s=0,o=0;for(;s<gr.length;){let r=gr[s];if(r.start<0||r.end>t){if(gr[o]=r,o++,r.pos[0]>-1e3){let a=r.pos,l=r.vel,c=r.info.acc;if(a[0]+=(l[0]+=c[0]*e)*e,a[1]+=(l[1]+=c[1]*e)*e,a[2]+=(l[2]+=c[2]*e)*e,r.info.friction>0){let f=1-r.info.friction;l[0]*=f,l[1]*=f,l[2]*=f}if(r.distance=dn(n.frustum[5],a)+n.frustumConstants[5],r.distance<Fv&&r.distance>0){let f=r.start<0?(Math.sin(t/r.info.duration)+1)*.5:(t-r.start)/r.info.duration;r.progVec[0]=f,r.progVec[1]=kl[r.info.interp](f),i[r.info.blend].push(r)}}}else tc+=r.forced?1:0,Cd.push(r);++s}return gr.length=o,Sd(i[0],0,i[0].length-1,i[0].length),Sd(i[1],0,i[1].length-1,i[1].length),i},rq=t=>{for(let e=0;e<2;++e)lq(t[e],pu[e]),aq(t[e],pu[e],Ma[e])},aq=(t,e,n)=>{t.length>0?(n.transform.visible=!0,Py(e,0,t.length),hi(e,e.attributes.position),hi(e,e.attributes.info),hi(e,e.attributes.progress),hi(e,e.attributes.scaleRota),hi(e,e.attributes.colStart),hi(e,e.attributes.colEnd)):n.transform.visible=!1},lq=(t,e)=>{let n=e.attributes.position.data,i=e.attributes.progress.data,s=e.attributes.info.data,o=e.attributes.scaleRota.data,r=e.attributes.colStart.data,a=e.attributes.colEnd.data;for(let l=0;l<t.length;++l){let c=t[l],f=c.pos,u=c.infoVec,p=c.progVec,g=c.scaleRota,v=c.info.colStart,_=c.info.colEnd,b=l*2,y=l*3,w=l*4;n[y]=f[0],n[y+1]=f[1],n[y+2]=f[2],s[w]=u[0],s[w+1]=u[1],s[w+2]=u[2],s[w+3]=u[3],i[b]=p[0],i[b+1]=p[1],o[w]=g[0],o[w+1]=g[1],o[w+2]=g[2],o[w+3]=g[3],r[w]=v[0],r[w+1]=v[1],r[w+2]=v[2],r[w+3]=v[3],a[w]=_[0],a[w+1]=_[1],a[w+2]=_[2],a[w+3]=_[3]}},o8=t=>{let e=oq(vo,t,gt);rq(e)},hr=[0,0,0],Qs=(t,e,n=0,i=0,s=0,o=0,r=0,a=0,l=!1)=>{if(e?Dr(hr,n,i,s,e):Y(hr,n,i,s),l){if(tc<=0)return}else{if(dn(gt.frustum[0],hr)+gt.frustumConstants[0]<0||dn(gt.frustum[1],hr)+gt.frustumConstants[1]<0)return;let v=dn(gt.frustum[5],hr)+gt.frustumConstants[5];if(v<0||v*10>Cd.length)return}let c=Cd.pop();if(!c){let v=gr.length-1;for(;v>=0&&gr[v].forced;)--v;v>=0&&(c=gr.splice(v,1)[0])}if(!c)return;let f=1;if(e){let v=e[0],_=e[1],b=e[2];f=Math.sqrt(v*v+_*_+b*b),yp(c.vel,o,r,a,e)}else Y(c.vel,o,r,a);c.pos[0]=hr[0],c.pos[1]=hr[1],c.pos[2]=hr[2];let u=Mm.get(t);c.info=u,c.start=l?-1:vo,c.end=c.start+c.info.duration;let p=Math.random()*u.randomRota,g=p+u.rota;return Math.random()<.5&&(p*=-1,g*=-1),ei(c.scaleRota,u.scaleStart*f,u.scaleEnd*f,p,g),ei(c.infoVec,u.idLoop,0,u.idStart,u.idEnd+1),di(c.progVec,0,0),c.forced=l,gr.push(c),l&&tc--,c},Ma=[],pu=[],cq=()=>{for(let t=0;t<2;++t)pu[t]=Cn({position:{size:3,data:new Float32Array(3*wa)},progress:{size:2,data:new Float32Array(2*wa)},info:{size:4,data:new Float32Array(4*wa)},scaleRota:{size:4,data:new Float32Array(4*wa)},colStart:{size:4,data:new Float32Array(4*wa)},colEnd:{size:4,data:new Float32Array(4*wa)}});Ma[0]=qi(pu[0],17,O.POINTS),Ma[1]=qi(pu[1],16,O.POINTS),gi(1215,t=>{Dn("particleDiffuse",t,0,pt[17]),Dn("particleDiffuse",t,0,pt[16])})};var r8=()=>{let t=pt[17];t.active&&Ma[0].transform.visible&&Ki(Ma[0],t)},a8=()=>{let t=pt[16];t.active&&Ma[1].transform.visible&&Ki(Ma[1],t)};var du=[],Ad,mu,l8,c8=()=>{mu=Ht.pointlights.data.lightCols,Ad=Ht.pointlights.data.lightPos,l8=Ht.pointlights.data.lightCount},f8=t=>{let e=[0,0,0],n=[];for(let s=0,o=du.length;s<o;++s){let r=du[s];r.remove?(du.splice(s,1),--s,--o):r.transform.visible&&(Y(e,r.transform.worldMatrix[12],r.transform.worldMatrix[13],r.transform.worldMatrix[14]),r.distance=Kn(gt.worldPosition,e),r.distance<Sv&&n.push(r))}n.sort((s,o)=>s.distance-o.distance);let i=Math.min(n.length,16);for(let s=0;s<i;++s){let o=n[s],r=s*4,a=s*3;Ad[a]=o.transform.worldMatrix[12],Ad[a+1]=o.transform.worldMatrix[13],Ad[a+2]=o.transform.worldMatrix[14],mu[r]=o.value[0],mu[r+1]=o.value[1],mu[r+2]=o.value[2],mu[r+3]=o.value[3]}l8[0]=i,si(Ht.pointlights)},u8=(t,e,n)=>{let i={transform:n,distance:0,remove:!1,value:[...t,e]};return du.push(i),i},p8=t=>{du.length=0};var Fa=[Uc(1,1),Uc(1,1)],nc=!1,m8=0,d8=t=>{m8=t},hu=t=>{nc=t},h8=t=>{let n=[lu,cu],i=[5,20,20];for(let s=0;s<Fa.length;++s){let o=Fa[s],r=n[s],a=[0,0,0];yp(a,1,1,1,o.transform.worldMatrix);let l=[...Gt.position],c=i[s];for(let g=0;g<3;++g)l[g]=Math.floor(l[g]/c)*c;let f=(Math.abs(Math.cos(-1))+Math.abs(Math.sin(-1)))*r,u=r,p=[u,f,f];for(let g=0;g<3;++g){let v=p[g]*2/m8,_=l[g]*a[g];_=_-_%v,_=_/a[g],l[g]=_}p_(o.transform.position,l)||(st(o.transform.position,l),Y(o.transform.rotation,-1,0,0),o.far=f,o.near=-1e3,v_(o,-u,u,-f,f),pl(o,!0),Fp(o),nc=!0)}if(nc){let s=Ht.shadows.data;wo(s.shadowRange,[lu,wv,cu],0),wo(s.shadowPVMatrix,Fa[0].projectionViewMatrix,0),wo(s.shadowPVMatrix,Fa[1].projectionViewMatrix,16),si(Ht.shadows)}return nc?1:0};var Pd=new Map,Td=[],Ed=[],Dd=[],Id=[],Vd=[],Zs=(t,e,n,i)=>{let s=t<<1|e;if(s=s<<1|n,s=s<<1|i,Pd.has(s))return qv(Pd.get(s));{let o=pq(t,e,n,i);return Pd.set(s,o),qv(o)}},v8=(t,e,n,i)=>{t?e?Ed.push(i):Dd.push(i):Td.push(i),n===2?(hu(!0),Id.push(i)):n===1&&(hu(!0),Vd.push(i))},pq=(t,e,n,i)=>{let s=_s.get(t),o=X1[s.shader],r=pt[o],a=oe.shadows&&e?s.texture?1:2:0,l=HC(o,O.TRIANGLES,r.instancedAttributes,a,n,i);l.cullFace=s.cull?O.BACK:O.NONE;let c=!1,f=!1;return s.texture?gi(s.texture,u=>{f=!0,l.uniformData.diffuse=u,c&&v8(r.transparent,r.depthWrite,oe.shadows&&e?n?2:1:0,l)}):f=!0,Yo(s.geometry,u=>{QC(l,u),c=!0,f&&v8(r.transparent,r.depthWrite,oe.shadows&&e?n?2:1:0,l)}),l},_8=()=>{Pd.forEach(XC)};var b8=[{fun:(t,e,n)=>{Qs(e[0],t.transform.worldMatrix,e[1],e[2],e[3],e[4],e[5],e[6],!1)}},{fun:(t,e,n)=>{let i=e[1],s=Math.PI*2/i;for(let o=0;o<i;++o){let r=Math.sin(o*s),a=Math.cos(o*s);Qs(e[0],t.transform.worldMatrix,r*e[6]+e[2],e[3],a*e[6]+e[4],r*e[5],0,a*e[5],!1)}}},{fun:(t,e,n)=>{for(let i=0;i<e[1];++i)Qs(e[0],t.transform.worldMatrix,e[2],e[3],e[4],Zt(e[5],e[6]),Zt(e[7],e[8]),Zt(e[9],e[10]),!1)}},{fun:(t,e,n)=>{Hs(e[0],t.transform,t.priority,!1,1)}}];var zv=[{create:(t,e)=>u8([e[0],e[1],e[2]],e[3],t.transform),tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{n.remove=!0},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,i,s)=>{let o=kl[e[2]](s);n.value[3]=e[0]+o*(e[1]-e[0])}]},{create:(t,e)=>[0,0,0,0],tick:(t,e,n,i,s)=>{n[0]>=e[1]&&(n[0]=0,Qs(e[0],t.transform.worldMatrix,Zt(e[2],e[3])+n[1],Zt(e[4],e[5])+n[2],Zt(e[6],e[7])+n[3],Zt(e[8],e[9]),Zt(e[10],e[11]),Zt(e[12],e[13]),!1)),n[0]+=~~(i*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,i,s)=>{let o=e[1]*s;n[1]=Math.sin(o)*e[0],n[3]=Math.cos(o)*e[0]}]},{create:(t,e)=>{if(tc>0)return Qs(e[0],t.transform.worldMatrix,0,0,0,0,0,0,!0)},tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{n.start=1,n.end=1},show:(t,e,n)=>{},hide:(t,e,n)=>{n.pos[0]=-1e3},modifiers:[(t,e,n,i,s)=>{let o=e[1]*s;Dr(n.pos,Math.sin(o)*e[0],0,Math.cos(o)*e[0],t.transform.worldMatrix)},(t,e,n,i,s)=>{Dr(n.pos,e[0],e[1],e[2],t.transform.worldMatrix)}]},{create:(t,e)=>Hs(e[0],t.transform,t.priority,!0,1),tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{n.stop()},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>{let n=Zs(e[0],!1,!0,!0);return Y(n.position,e[1],e[2],e[3]),Y(n.scale,e[4],e[5],e[6]),Y(n.rotation,e[7],e[8],e[9]),Mn(n,t.transform),qt(n,!1),n},tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{ks(n.data.multi,n)},show:(t,e,n)=>{n.visible=!0},hide:(t,e,n)=>{n.visible=!1},modifiers:[(t,e,n,i,s)=>{let o=e[1]*s;n.rotation[1]=e[2]+o,n.position[0]=Math.sin(o)*e[0],n.position[2]=Math.cos(o)*e[0],n.matrixNeedsUpdate=!0,qt(n,!1)},(t,e,n,i,s)=>{let o=n.data.multi.instancedAttributes[e[0]];for(let r=0;r<o.size;++r)n.data[o.name][r]=e[1+r]},(t,e,n,i,s)=>{let o=n.data.multi.instancedAttributes[e[0]];for(let r=0;r<o.size;++r){let a=e[1+r],l=e[5+r];n.data[o.name][r]=a+s*(l-a)}},(t,e,n,i,s)=>{let o=kl[e[6]](s);n.scale[0]=e[0]+o*(e[3]-e[0]),n.scale[1]=e[1]+o*(e[4]-e[1]),n.scale[2]=e[2]+o*(e[5]-e[2]),n.matrixNeedsUpdate=!0},(t,e,n,i,s)=>{let o=kl[e[6]](s);n.rotation[0]=e[0]+o*(e[3]-e[0]),n.rotation[1]=e[1]+o*(e[4]-e[1]),n.rotation[2]=e[2]+o*(e[5]-e[2]),n.matrixNeedsUpdate=!0}]},{create:(t,e)=>JC(e[0],t.transform,[e[1],e[2],e[3]],[e[4],e[5],e[6]],0,0),tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{n.detach()},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,i,s)=>{let o=e[1]*s;n.b[0]=n.a[0]=Math.sin(o)*e[0],n.b[2]=n.a[2]=Math.cos(o)*e[0]}]},{create:(t,e)=>{if(tc<e[1])return;let n=[];for(let i=0;i<e[1];++i)n.push(Qs(e[0],t.transform.worldMatrix,0,0,0,0,0,0,!0));return n},tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{for(let i=0;i<n.length;++i){let s=n[i];s.start=s.end=1}},show:(t,e,n)=>{},hide:(t,e,n)=>{for(let i=0;i<n.length;++i){let s=n[i];s.pos[0]=-1e3}},modifiers:[(t,e,n,i,s)=>{let o=n.length,r=6.283/o,a=e[0],l=e[1]*s;for(let c=0;c<o;++c){let f=n[c],u=r*c+l;Dr(f.pos,Math.sin(u)*a,0,Math.cos(u)*a,t.transform.worldMatrix)}}]},{create:(t,e)=>[0,0],tick:(t,e,n,i,s)=>{if(n[0]>=e[6]){n[0]=0;let o=e[1],r=Math.PI*2/o;for(let a=0;a<o;++a)Qs(e[0],t.transform.worldMatrix,e[2],e[3],e[4],Math.sin(a*r+n[1])*e[5],0,Math.cos(a*r+n[1])*e[5],!1)}n[0]+=~~(i*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[(t,e,n,i,s)=>{n[1]=e[0]*s}]},{create:(t,e)=>[0],tick:(t,e,n,i,s)=>{if(n[0]>=e[1]){n[0]=0;let o=on();Y(o.rotation,Zt(e[8],e[9]),Zt(e[10],e[11]),Zt(e[12],e[13])),Bv(e[0],o,t.priority,!0),Dr(o.position,Zt(e[2],e[3]),Zt(e[4],e[5]),Zt(e[6],e[7]),t.transform.worldMatrix),ro(o,!1)}n[0]+=~~(i*1e3)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>{let n=Math.sin(t.transform.rotation[1])*Math.cos(t.transform.rotation[0])*e[0],i=-Math.sin(t.transform.rotation[0])*e[0],s=Math.cos(t.transform.rotation[1])*Math.cos(t.transform.rotation[0])*e[0],o=t.info.duration,r=o;if(e[1]){let a=D.raycastEnvironmentClosest(t.transform.position[0],t.transform.position[1],t.transform.position[2],n*o,i*o,s*o);a<1&&(r=o*a)}return[n,i,s,r]},tick:(t,e,n,i,s)=>{if(e[1]&&(n[3]-=i,n[3]<=0)){t.done=!0;return}t.transform.position[0]+=n[0]*i,t.transform.position[1]+=n[1]*i,t.transform.position[2]+=n[2]*i,t.transform.matrixNeedsUpdate=!0,qt(t.transform,!1)},end:(t,e,n)=>{},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]},{create:(t,e)=>[],tick:(t,e,n,i,s)=>{},end:(t,e,n)=>{let i=on();st(i.position,t.transform.position),st(i.rotation,t.transform.rotation),Bv(e[0],i,t.priority,!0),ro(i,!1)},show:(t,e,n)=>{},hide:(t,e,n)=>{},modifiers:[]}],Bv,y8=t=>{Bv=t};var Ei=[],Ca=[],Sa=[],gu=[],k8=(t,e)=>{let n=Mv;vq(t,e,n),_q(t,e,n),bq(t,e,n),yq(t,e),kq(t,e),xq(t,e);for(let i=0;i<Ei.length;++i){let s=Ei[i],o=s.visible!==s.transform.visible;if(s.visible=s.transform.visible,s.visible)for(let r=0;r<s.info.events.length;++r){let a=s.info.events[r];(s.loops===0||a.fraction>0)&&s.fractionLast<=a.fraction&&s.fractionNow>a.fraction&&b8[a.id].fun(s,a.params,t)}for(let r=0;r<s.info.periods.length;++r){let a=s.info.periods[r],l=zv[a.id],c=s.periodData[r]!==void 0,f=s.fractionNow>=a.fractionStart&&s.fractionNow<=a.fractionEnd,u=!1;if(s.visible&&f&&!c&&s.fractionLast<=a.fractionStart&&(c=(s.periodData[r]=l.create(s,a.params,t))!==void 0,u=c),f&&c&&(o&&(s.visible?l.show(s,a.params,s.periodData[r]):l.hide(s,a.params,s.periodData[r])),s.visible)){let p=s.periodData[r],g=(s.fractionNow-a.fractionStart)/(a.fractionEnd-a.fractionStart);l.tick(s,a.params,p,t,g);for(let v=0;v<a.modifiers.length;++v){let _=a.modifiers[v];(u||o||_.mode===1)&&l.modifiers[_.id](s,_.params,p,t,g)}}!f&&c&&(l.end(s,a.params,s.periodData[r]),s.periodData[r]=void 0)}s.visible&&s.returnTransform&&s.transform.parent===null&&qt(s.transform,!1)}},$v=[],Uv=(t,e,n,i)=>$v.length>0?hq($v.pop(),t,e,n,i):dq(t,e,n,i),dq=(t,e,n,i)=>({info:t,priority:n,transform:e,returnTransform:i,visible:!0,fractionNow:0,fractionLast:0,timeEnd:0,periodData:[],done:!1,loops:0}),hq=(t,e,n,i,s)=>(t.info=e,t.priority=i,t.transform=n,t.returnTransform=s,t),gq=t=>(t.visible=!0,t.fractionNow=0,t.fractionLast=0,t.timeEnd=0,t.periodData.length=0,t.done=!1,t.loops=0,t),Ld=t=>{wq(t),t.returnTransform&&us(t.transform),$v.push(gq(t))},xs=(t,e,n,i)=>{let s=Cf.get(t),o=Uv(s,e,n,i);return Ei.push(o),Ca.push(o),o},zi=(t,e,n,i)=>{let s=Cf.get(t),o=Uv(s,e,n,i);return Ei.push(o),Sa.push(o),o},x8=(t,e,n,i)=>{let s=Cf.get(t),o=Uv(s,e,n,i);return Ei.push(o),gu.push(o),o},vq=(t,e,n)=>{for(let i=0;i<Ca.length;++i){let s=Ca[i];s.info.duration===0?s.timeEnd===0?(s.timeEnd=e+s.info.duration,s.fractionLast=0,s.fractionNow=.999):(s.fractionLast=0,s.fractionNow=1):(s.timeEnd===0&&(s.timeEnd=e+s.info.duration),s.fractionLast=s.fractionNow,s.fractionNow=vt(1-(s.timeEnd-e)/s.info.duration,0,1))}},_q=t=>{for(let e=0;e<Sa.length;++e){let n=Sa[e];n.fractionLast=n.fractionNow,n.fractionNow=(n.fractionNow+t/n.info.duration)%1,n.fractionLast>n.fractionNow&&(n.fractionLast=0,n.loops++)}},bq=(t,e,n)=>{},yq=(t,e,n)=>{let i=Ca.length;for(;i--;){let s=Ca[i];(s.fractionNow===1||s.done)&&(Ca.splice(i,1),Ei.splice(Ei.indexOf(s),1),Ld(s))}},kq=(t,e,n)=>{let i=Sa.length;for(;i--;){let s=Sa[i];s.done&&(Sa.splice(i,1),Ei.splice(Ei.indexOf(s),1),Ld(s))}},xq=(t,e,n)=>{let i=gu.length;for(;i--;){let s=gu[i];s.done&&(gu.splice(i,1),Ei.splice(Ei.indexOf(s),1),Ld(s))}},wq=t=>{for(let e=0;e<t.info.periods.length;++e){let n=t.info.periods[e],i=zv[n.id];t.periodData[e]!==void 0&&(i.end(t,n.params,t.periodData[e]),t.periodData[e]=void 0)}},w8=t=>{for(let e=0;e<Ei.length;++e)Ld(Ei[e]);Ei.length=0,Ca.length=0,Sa.length=0,gu.length=0};y8(xs);var ic=[0,2,2.3],sc=[0,0,0];Zn(ic,ic);var ln={},Bd=["fog","sun","direct","ambient","skytop","skymid","skybot","horizon","water","clouds"],zd=["bloom"];for(let t=0;t<Bd.length;++t)ln[Bd[t]]=[[.5,.5,.5],[.5,.5,.5],[.5,.5,.5]];for(let t=0;t<zd.length;++t)ln[zd[t]]=[0,0,0];var M8=(t,e,n,i)=>{Sq(),Tq(t,n,e),Aq(),e>0&&Pq(e,i),si(Ht.sky),si(Ht.environment);let s=Ht.environment.data;O.clearColor(s.fog[0],s.fog[1],s.fog[2],1)},Fq=(t,e,n,i,s,o,r)=>{let a=[0,0,0],l=[0,0,0];ul(a,e,n,o),ul(l,i,s,o),ul(t,a,l,r)},Cq=(t,e,n,i,s,o)=>{let r=_f(s,t,e),a=_f(s,n,i);return _f(o,r,a)},Js=(t,e,n,i,s)=>{let o=[0,0,0],r=[0,0,0];hn(o,n,1-s),hn(r,i,s),t[e]=o[0]+r[0],t[e+1]=o[1]+r[1],t[e+2]=o[2]+r[2]},Sq=()=>{let t=Gt.position[0],e=Gt.position[2],n=t,i=e,s=t+32,o=e+32,r=Il.get(D.getEnvironmentId(n,i)),a=Il.get(D.getEnvironmentId(s,i)),l=Il.get(D.getEnvironmentId(n,o)),c=Il.get(D.getEnvironmentId(s,o));if(!r||!a||!l||!c)return;let f=t/32%1,u=e/32%1;for(let p=0;p<Bd.length;++p){let g=Bd[p];for(let v=0;v<3;++v)Fq(ln[g][v],r[g][v],a[g][v],l[g][v],c[g][v],f,u)}for(let p=0;p<zd.length;++p){let g=zd[p];for(let v=0;v<3;++v)ln[g][v]=Cq(r[g][v],a[g][v],l[g][v],c[g][v],f,u)}},Aq=()=>{let t=Ht.environment.data.watercolors;for(let e=0;e<9;++e)t[e]=ln.water[Math.floor(e/3)][e%3]},Pq=(t,e)=>{let n=Ht.environment.data.worldlight,i=[0,0,0],s=Math.max(0,1-t/80),o=Math.min(1,1-s);Js(i,0,ln.water[1],ln.water[2],o);let r=[0,0,0];r[0]=(n[0]+n[3])*i[0]*1.5,r[1]=(n[1]+n[4])*i[1]*1.5,r[2]=(n[2]+n[5])*i[2]*1.5;let a=Ht.sky.data.skycolors,l=Ht.sky.data.suncolor,c=Ht.environment.data.worldlight,f=Ht.environment.data.fog,u=Math.max(.2,.5*s),p=Math.min(.4,Math.max(.1,.5*s)),g=Math.max(.3,.7*s);for(let v=0;v<15;++v)a[v]=u*r[v%3];Y(f,u*r[0],u*r[1],u*r[2]),st(l,f);for(let v=0;v<9;++v)Ht.environment.data.watercolors[v]=p;for(let v=0;v<6;++v)c[v]=g*r[v%3]},qd=0,So=1,Rd=2,$d=[{from:So,to:qd,start:0,end:0,dur:0},{from:qd,to:qd,start:0,end:0,dur:0},{from:qd,to:So,start:0,end:0,dur:0},{from:So,to:So,start:0,end:0,dur:0},{from:So,to:Rd,start:0,end:0,dur:0},{from:Rd,to:Rd,start:0,end:0,dur:0},{from:Rd,to:So,start:0,end:0,dur:0},{from:So,to:So,start:0,end:0,dur:0}],F8=0;$d.forEach(t=>{let e=t.from!==t.to,n=!e&&t.from!==So;e?t.dur=.5:n?t.dur=5:t.dur=1.5,F8+=t.dur});var Ov=0;$d.forEach(t=>{t.start=Ov,Ov=t.end=Ov+1/F8*t.dur});var Tq=(t,e,n)=>{t=vt(t,0,1);let i=.5,s=0,o=0;for(let l=0;l<$d.length;++l){let c=$d[l];if(c.end>=t){i=vf(c.start,c.end,t),s=c.from,o=c.to;break}}let r=Ht.sky.data;Js(r.skycolors,0,ln.skytop[s],ln.skytop[o],i),Js(r.skycolors,3,ln.skymid[s],ln.skymid[o],i),Js(r.skycolors,6,ln.skybot[s],ln.skybot[o],i),Js(r.skycolors,9,ln.horizon[s],ln.horizon[o],i),Js(r.skycolors,12,ln.clouds[s],ln.clouds[o],i),Js(r.suncolor,0,ln.sun[s],ln.sun[o],i),st(sc,ic),sc[1]=Math.abs(Math.sin(t*6.282)),Zn(sc,sc);let a=Ht.environment.data;Js(a.worldlight,0,ln.direct[s],ln.direct[o],i),Js(a.worldlight,3,ln.ambient[s],ln.ambient[o],i),a.worldlight[6]=ic[0],a.worldlight[7]=ic[1],a.worldlight[8]=ic[2],Js(a.fog,0,ln.fog[s],ln.fog[o],i),a.fog[3]=n>0?-100:kv,a.fog[4]=n>0?xv:is,a.daycycle[0]=t,a.time[0]=e%3600,pt[31].uniforms.amount.value=_f(i,ln.bloom[s],ln.bloom[o])};var Eq=[],Dq=[],S8=(t,e)=>{if(vn===void 0||vn.suspended)return;let n=vn.currentTime,i=Sf.get(D.getAreaId(Gt.position[0],Gt.position[2])),o=t>.5?i.ambientnight:i.ambientday,r=5;e>0&&(o=167,r=.5),C8(Eq,n,r,o,!1),C8(Dq,n,5,i.music,!0)},C8=(t,e,n,i,s)=>{let o=!1;for(let r=t.length-1;r>=0;--r){let a=t[r],l=a.sound,c=l.gain.gain;a.id===i&&!l.ended?(o=!0,a.fade!==1&&(a.fade=1,c.setTargetAtTime(1,e,n))):c.value<.02||l.ended?(l.stop(),t.splice(r,1)):a.fade!==0&&(a.fade=0,c.setTargetAtTime(0,e,a.fadeDuration))}if(!o&&i!==0){let r=s?n3(i,3):t3(i,2);r&&(r.gain.gain.setValueAtTime(0,e),t.push({id:i,sound:r,fade:0,fadeDuration:n}))}};var Ao=[0,0,0,0],A8=(t,e,n,i)=>{if(D.player&&D.player.buffs.buffs.has(128))Ao[0]=.2,Ao[1]=.4,Ao[2]=.4,Ao[3]=.7,i.add(33),pt[33].uniforms.warp.value=.1,pt[31].uniforms.amount.value=3;else if(e>0){let s=Ht.environment.data.fog;Ao[0]=s[0],Ao[1]=s[1],Ao[2]=s[2],Ao[3]=.5,i.add(33),pt[33].uniforms.warp.value=.3,pt[31].uniforms.amount.value=Math.min(3,Math.max(.3,e/10))}pt[33].uniforms.tint.value=Ao};var P8=()=>{},Ud=0,Od=t=>Ud=t,T8=(t,e,n)=>{let i=(e/3600+.9)%1;i<.7?i=vf(0,.7,i)*.4:i=.4+vf(.7,1,i)*.6,M8(i,Ud,e,n),A8(i,Ud,e,n),S8(i,Ud)};var vu=()=>[-0,-0,-0,-0,-0,-0],Ks=vu();var E8=(t,e)=>!(t[3]<e[0]||t[0]>e[3]||t[4]<e[1]||t[1]>e[4]||t[5]<e[2]||t[2]>e[5]),Vq=(t,e,n,i,s)=>(t[0]=e[0],t[3]=e[0]+n,t[1]=e[1],t[4]=e[1]+i,t[2]=e[2],t[5]=e[2]+s,t);var D8=(t,e)=>{t[0]=t[1]=t[2]=1/0,t[3]=t[4]=t[5]=-1/0;for(let n=0;n<e.length;++n){let i=e[n];t[0]=Math.min(t[0],i[0]),t[3]=Math.max(t[3],i[0]),t[1]=Math.min(t[1],i[1]),t[4]=Math.max(t[4],i[1]),t[2]=Math.min(t[2],i[2]),t[5]=Math.max(t[5],i[2])}return t};var Nd=(t,e,n,i,s)=>(Y(bt,e[0]-n/2,e[1]-i/2,e[2]-s/2),Vq(t,bt,n,i,s));var I8=(t,e,n,i,s)=>{let o=(t[0]-e[0])*n[0],r=(t[1]-e[1])*n[1],a=(t[2]-e[2])*n[2],l=(t[3]-e[0])*n[0],c=(t[4]-e[1])*n[1],f=(t[5]-e[2])*n[2],u=Math.max(i,Math.min(o,l),Math.min(r,c),Math.min(a,f)),p=Math.min(s,Math.max(o,l),Math.max(r,c),Math.max(a,f));return!(p<0||u>p)};var V8=(t,e,n)=>{let i=[0,0,0];for(let s=0;s<6;++s){let o=e[s],r=n[s];if(o[0]>0?i[0]=t[3]:i[0]=t[0],o[1]>0?i[1]=t[4]:i[1]=t[1],o[2]>0?i[2]=t[5]:i[2]=t[2],dn(o,i)+r<0)return!1}return!0};var jd=class{constructor(){this.id=0,this.pos=[-0,-0,-0],this.rot=[-0,-0,-0],this.scale=1,this.matrix=void 0,this.loaded=!1}setWorldMatrix(e,n){this.matrix=e,Ln(bt,n,this.pos),mi(bn,this.scale),kp(go,this.rot),_p(this.matrix,go,bt,bn)}loadGeometry(e,n){if(!this.loaded){let i=_s.get(this.id);this.loaded=!0,i.geometry===0?this.postGeometryLoad(e,n):Yo(i.geometry,(s,o)=>{let r=!e.finishedLoadingChunks.has(n.id);this.addMesh(e,n),r&&this.addCollider(e,n,s,o),this.postGeometryLoad(e,n)})}}onUpdate(e,n,i){}addMesh(){}postGeometryLoad(e,n){n.loadingProps--}handleColliderGeometry(e,n,i,s){let o=this.matrix,r=i.position,a=i.color,l=i.flags;for(let c=0,f=n.length;c<f;c+=3){let u=n[c],p=n[c+1],g=n[c+2],v=Nv(u*3,s,r,o),_=Nv(p*3,s,r,o),b=Nv(g*3,s,r,o),y=[v,_,b],w=D8(vu(),y);if(l[u]&1&&l[p]&1&&l[g]&1){if(y.push(Vf([0,0,0],v,_,b)),a.length){let C=[(a[u*4+0]+a[p*4+0]+a[g*4+0])/3,(a[u*4+1]+a[p*4+1]+a[g*4+1])/3,(a[u*4+2]+a[p*4+2]+a[g*4+2])/3,(a[u*4+3]+a[p*4+3]+a[g*4+3])/3];y.push(C)}e.triangleGrid.add(y,w)}}}addCollider(e,n,i,s){let o=new Map;this.handleColliderGeometry(e,s.index,s,o),this.handleColliderGeometry(e,s.indexInvisible,s,o)}onRemove(){}},Nv=(t,e,n,i)=>{if(e.has(t))return e.get(t);{let s=[n[t],n[t+1],n[t+2]];return Mi(s,s,i),e.set(t,s),s}};var Wd=class extends jd{constructor(){super(),this.mesh=void 0,this.effects=[],this.isEffectProp=!1,this.effectsCreated=!1}onUpdate(e,n,i){this.mesh!==void 0&&this.updateMesh(n),super.onUpdate(e,n,i)}updateMesh(e){this.setWorldMatrix(this.mesh.worldMatrix,e),Ln(this.mesh.position,e,this.pos),Y(this.mesh.rotation,this.rot[0],this.rot[1],this.rot[2]),mi(this.mesh.scale,this.scale),this.mesh.data.multi&&(this.mesh.data.multi.needsUpdate=!0)}onRemove(e){super.onRemove(e),_s.get(this.id).effects.length&&this.deleteEffects(),this.mesh&&(this.mesh.data.multi?ks(this.mesh.data.multi,this.mesh):us(this.mesh),this.mesh=void 0)}addMesh(e,n){if(this.mesh===void 0){let i=_s.get(this.id);this.mesh=Zs(this.id,i.shadow,!1,!0),this.mesh.visible=!1,this.updateMesh(n.origin),i.effects.length&&(this.isEffectProp=!0)}}onChunkRebuild(e){this.mesh&&this.mesh.data&&this.mesh.data.interiorlight&&D.getInteriorLight(this.mesh.data.interiorlight,Nd(Ks,this.mesh.position,3,3,3))}createEffects(){if(this.isEffectProp=!0,!this.effectsCreated){let e=_s.get(this.id).effects;for(let n=0;n<e.length;++n){let i=e[n],s=on();st(s.position,i.pos),st(s.scale,i.scale),st(s.rotation,i.rot),Mn(s,this.mesh),qt(s,!0);let o=zi(i.id,s,0,!0);this.effects.push(o)}this.effectsCreated=!0}}deleteEffects(){if(this.effectsCreated){for(let e=0;e<this.effects.length;++e)this.effects[e].done=!0;this.effects.length=0,this.effectsCreated=!1}}setVisible(e){this.mesh.visible!==e&&(this.mesh.visible=!0,this.mesh.data.multi.needsUpdate=!0)}setEffectVisible(e){this.isEffectProp&&this.effectsCreated!==e&&(e?this.createEffects():this.deleteEffects())}};var q8=(t,e,n)=>{e[n]=(t&31)*8,e[n+1]=(t>>5&31)*8,e[n+2]=(t>>10&31)*8},L8=65536/64,Lq=2147483647/2e3,jv=65536/(Math.PI*2),qq=65536/100;var R8=(t,e)=>(t.id=e.id,Y(t.pos,e.x/L8,e.y/Lq,e.z/L8),Y(t.rot,e.rx/jv,e.ry/jv,e.rz/jv),t.scale=Math.max(e.scale,100)/qq,t);var B8=(t,e,n,i)=>{t.id=e,t.x=n,t.z=i,t.origin[0]=n*64,t.origin[2]=i*64,t.deserialized=!1,t.props.length=0,t.data=void 0,t.loadingProps=0},z8=(t,e)=>{t.data=e,$8(t),Rq(t,!0),t.deserialized=!0},ws=(t,e,n)=>{e/=2.6666666666666665,n/=2.6666666666666665;let i=e%1,s=n%1;if(i===0&&s===0)return t.data.terrain[e+25*n]*.030517578125;{let o=Math.floor(e),r=Math.floor(n),a=i+s<1,l=t.data.terrain[o+25*r+(a?0:1)],c=t.data.terrain[o+25*Math.min(24,r+1)],f=t.data.terrain[o+1+25*(r+(a?0:1))],u=a?-(i-1+s):-(s-1),p=a?s:-(i-1),g=1-u-p;return(u*l+p*c+g*f)*.030517578125}},bu=(t,e,n)=>{if(t.data.holes.length===0)return!1;e/=2.6666666666666665,n/=2.6666666666666665;let i=Math.floor(e)+Math.floor(n)*24;return t.data.holes.indexOf(i)>=0},yu=(t,e,n)=>{if(t.data.water.length===0)return-1;e/=64,n/=64;let i=e%1,s=n%1;if(i===0&&s===0)return t.data.water[e+2*n]*.030517578125;{let o=Math.floor(e),r=Math.floor(n),a=i+s<1,l=t.data.water[o+2*r+(a?0:1)],c=t.data.water[o+2*Math.min(2-1,r+1)],f=t.data.water[o+1+2*(r+(a?0:1))],u=a?-(i-1+s):-(s-1),p=a?s:-(i-1),g=1-u-p;return(u*l+p*c+g*f)*.030517578125}};var Wv=(t,e,n)=>{e/=16,n/=16;let s=Math.floor(e)+Math.floor(n)*4;return t.data.area[s]||0},Gv=(t,e,n)=>{e/=32,n/=32;let s=Math.floor(e)+Math.floor(n)*2;return t.data.environment[s]||0},$8=t=>{let e=[-0,-0,-0];for(let n=0;n<24;++n)for(let i=0;i<24;++i){let s=(i*2+24*n*2)*3,o=i*2.6666666666666665,r=n*2.6666666666666665;Y(ms,o,ws(t,o,r),r),Y(um,o,ws(t,o,r+2.6666666666666665),r+2.6666666666666665),Y(gf,o+2.6666666666666665,ws(t,o+2.6666666666666665,r),r),Vf(e,ms,um,gf),t.normals[s]=e[0],t.normals[s+1]=e[1],t.normals[s+2]=e[2],Y(ms,o+2.6666666666666665,ws(t,o+2.6666666666666665,r),r),Y(gf,o+2.6666666666666665,ws(t,o+2.6666666666666665,r+2.6666666666666665),r+2.6666666666666665),Vf(e,ms,um,gf),t.normals[s+3]=e[0],t.normals[s+4]=e[1],t.normals[s+5]=e[2]}};var Rq=(t,e)=>{for(let n=0,i=t.data.props.length;n<i;++n){let s=t.data.props[n],o=R8(new Wd,s);t.props.push(o),e&&t.loadingProps++}for(let n=0;n<t.props.length;++n){let i=t.props[n];i.onUpdate(D,t.origin,D.bounds),i.loadGeometry(D,t)}},Bq=t=>{for(let e=0;e<t.props.length;++e)t.props[e].onRemove(t);t.props.length=0},U8=t=>{Bq(t)},O8=(t,e)=>Math.floor(t%64/32)+Math.floor(e%64/32)*2,N8=(t,e)=>Math.floor(t%32*3)+Math.floor(e%32*3)*96;var ku=1,Gd=t=>{ku=t%2147483647,ku<=0&&(ku+=2147483646),Aa(),Aa()},Aa=()=>ku=ku*16807%2147483647,xu=()=>(Aa()-1)/2147483647,oc=(t,e)=>xu()*(e-t)+t;var Yd,Xd,Qd,$i=[0,0,0],rc,ac,lc,zq=[21,56,50,44,13,19,7,42],Yv=3758102380,Xv=(t,e)=>t>>e&1,vr=(t,e,n,i)=>zq[Xv(t,i)<<2|Xv(e,i)<<1|Xv(n,i)],Hd=t=>{let e=($i[0]+$i[1]+$i[2])/6,n=rc-$i[0]+e,i=ac-$i[1]+e,s=lc-$i[2]+e,o=.6-n*n-i*i-s*s,r=$q(Yd+$i[0],Xd+$i[1],Qd+$i[2]);if($i[t]++,o<0)return 0;let a=r>>5&1,l=r>>4&1,c=r>>3&1,f=r>>2&1,u=r&3,p=u===1?n:u===2?i:s,g=u===1?i:u===2?s:n,v=u===1?s:u===2?n:i;return p=a===c?-p:p,g=a===l?-g:g,v=a!==(l^c)?-v:v,o*=o,8*o*o*(p+(u===0?g+v:f===0?g:v))},$q=(t,e,n)=>vr(t,e,n,0)+vr(e,n,t,1)+vr(n,t,e,2)+vr(t,e,n,3)+vr(e,n,t,4)+vr(n,t,e,5)+vr(t,e,n,6)+vr(e,n,t,7),W8=(t,e,n)=>{let i=t+Yv,s=e+Yv,o=n+Yv,r=(i+s+o)/3;Yd=Math.floor(i+r),Xd=Math.floor(s+r),Qd=Math.floor(o+r),r=(Yd+Xd+Qd)/6,rc=i-Yd+r,ac=s-Xd+r,lc=o-Qd+r,$i[0]=$i[1]=$i[2]=0;let a=rc>=lc?rc>=ac?0:1:ac>=lc?1:2,l=rc<lc?rc<ac?0:1:ac<lc?1:2;return Hd(a)+Hd(3-a-l)+Hd(l)+Hd(0)};var G8=t=>{let e=0,n=0,i=0;for(let u=0;u<t.nodes.length;++u){let p=t.nodes[u],g=p.leafCount,v=p.points.length/2;e+=v*3*g,n+=v*2*g,i+=Math.max(0,(v-2)*3)*g,p.geotype===1&&(i+=3*g*Math.min(1,p.points.length))}let s=new Float32Array(e),o=new Float32Array(n),r=new Uint32Array(i);Gd(t.seed);let a=0,l=0,c=0,f=0;for(let u=0;u<t.nodes.length;++u){let p=t.nodes[u],g=p.start,v=p.end,_=Math.atan2(v[1]-g[1],v[0]-g[0]),{geotype:b,leafCount:y,y:w,radius:C,slant:A,size:M,arc:F,jitter_slant:V,jitter_size:L,jitter_rotation:q,jitter_radius:R,jitter_y:z}=p,E=p.points.length/2,W=Math.PI*2/(y===2?4:y);for(let j=0;j<y;++j){let N=j*W+oc(-q,q),U=A+oc(-V,V),ie=M*oc(1-L,1),re=C*oc(1-R,1),ae=w*oc(1-z,1);for(let ue=0;ue<E;++ue){let Me=p.points[ue*2],me=p.points[ue*2+1],Ne=Me-g[0],De=me-g[1],Fe=Ne*Math.cos(-_)-De*Math.sin(-_),_e=Ne*Math.sin(-_)+De*Math.cos(-_),H=0,qe=0,Oe=0;if(p.geotype===0){let Ze=U+F*Fe;H=Math.sin(Ze)*Fe,qe=Math.cos(Ze)*Fe,Oe=_e}else H=Fe,qe=F*(Math.abs(Fe)+Math.abs(_e)),Oe=_e;let He=H*Math.cos(N)-Oe*Math.sin(N),Ye=H*Math.sin(N)+Oe*Math.cos(N);s[a]=He*ie+Math.cos(N)*re,s[a+1]=ae+qe*ie,s[a+2]=Ye*ie+Math.sin(N)*re,o[l]=Me,o[l+1]=1-me,a+=3,l+=2}if(b===0)for(let ue=0;ue<E-2;++ue)r[c]=f+ue,r[c+1]=f+ue+1,r[c+2]=f+ue+2,c+=3;else for(let ue=0;ue<E-1;++ue){let Me=ue===E-2;r[c]=f,r[c+1]=Me?f+E-1:f+ue+1,r[c+2]=Me?f+1:f+ue+2,c+=3}f+=E}}return Cn({position:{size:3,data:s},uv:{size:2,data:o},index:{type:5125,data:r}})};var Y8=Math.floor(64**2*(oe.foliage/100)),X8=[],Zd=[],Q8=[];for(let t=0;t<64*64;++t){let e=Math.max(0,W8(Math.floor(t/64)/7,t%64/7,1));Q8.push(e)}for(let t=0;t<8;++t)X8.push(new Float32Array(7*Y8)),Zd.push([]);var Z8=(t,e)=>{if(oe.foliage===0||!e)return;Nq(t,O),Gd(t.id+1e3);let n=t.geometry.foliage.folIds,i=[],s=t.geometry.foliage.instances,o=[];for(let c=0;c<n.length;++c)i.push(Dl.get(n[c])),o.push(0);let r=oe.foliage,a=!1;t.data.holes.length>0&&(a=!0);let l=[-1,-1,-1,-1];for(let c=0;c<4;++c){let f=t.data.textureid[c];for(let u=0;u<4;++u)f[u]===27&&(l[c]=u)}for(let c=0;c<64;++c)for(let f=0;f<64;++f){if(Aa()%100>r)continue;let u=c+t.origin[0],p=f+t.origin[2],g=D.getNormal(u,p);if(g[1]<.6||a&&bu(t,c,f)||yu(t,c,f)>ws(t,c,f)+80)continue;let v=O8(c,f),_=N8(c,f),b=t.data.texture[v][_],y=b&31,w=b>>5&31,C=b>>10&31,A=l[v];A>=0&&(A===0&&y>0?y=255:A===1&&w>0?w=255:A===2&&C>0&&(C=255));let M=Aa()%Math.max(32,y+w+C),F=3;M<y?F=0:M<y+w?F=1:M<y+w+C&&(F=2);let V=t.data.textureid[v][F],L=El.get(V).foliage,q=Q8[u%64+p%64*64];for(let R=0;R<L.length;++R){let z=L[R],E=z[1];if(Aa()%255>E||z[2]&&q<=0)continue;let W=z[0],j=n.indexOf(W);if(o[j]>=Y8||j<0)continue;let N=s[j].attributes.inst.data,U=o[j]*7,ie=Math.max(0,Math.min(64,c-.25+xu()*.5)),re=Math.max(0,Math.min(64,f-.25+xu()*.5)),ae=ws(t,ie,re);N[U]=ie+t.origin[0],N[U+1]=ae,N[U+2]=re+t.origin[2],N[U+3]=z[2]?.5+Math.min(1.4,q*1.5):.5+xu(),N[U+4]=g[0]+.001,N[U+5]=g[1],N[U+6]=g[2],o[j]++}}for(let c=0;c<n.length;++c){let f=s[c],u=o[c];ym(f,u),hi(f,f.attributes.inst),f.bounds=t.geometry.terrain.bounds}},Jd=new Map,Qv=new Map,H8=new Set,Uq=t=>Zd[t].length<1?Cn({inst:{instanced:!0,size:7,data:X8[t]}}):Zd[t].pop(),Oq=(t,e)=>{Zd[t].push(e)},Nq=(t,e)=>{if(!t.geometry.foliage){let n=t.geometry.foliage={instances:[],folIds:[]};for(let i=0;i<4;++i){let s=t.data.textureid[i];for(let o=0;o<4;++o){let r=El.get(s[o]).foliage;for(let a=0;a<r.length;++a)n.folIds.indexOf(r[a][0])<0&&n.folIds.push(r[a][0])}}n.folIds.length>8&&(n.folIds.length=8);for(let i=0;i<n.folIds.length;++i){let s=n.folIds[i];n.instances.push(Uq(i));let o=Dl.get(s);Jd.has(o.id)||Jd.set(o.id,G8(o)),H8.has(o.texture)||(H8.add(o.texture),gi(o.texture,r=>{xm(r,16),es(r),Qv.set(o.texture,r)}))}}},J8=t=>{if(t.geometry.foliage){for(let e=0;e<t.geometry.foliage.instances.length;++e)Oq(e,t.geometry.foliage.instances[e]);t.geometry.foliage=void 0}},K8=(t,e)=>{},eS=t=>{if(!oe.foliage)return;let e=3,n=2,i=[],s=[],o=[];for(let r=0,a=t.length;r<a;++r){let l=t[r];if(NC(l.x*2,l.z*2)<Cv){let c=l.geometry.foliage;for(let f=0;f<c.folIds.length;++f){let u=c.folIds[f],p=i.indexOf(u);p<0&&(i.push(u),s.push([]),o.push(Dl.get(u).type===0?13:14),p=i.length-1),s[p].push(c.instances[f])}}}for(let r=0;r<i.length;++r){let a=Dl.get(i[r]);if(Jd.has(a.id)&&Qv.has(a.texture)){let l=o[r],c=pt[l];et.currentProgram!==c.id&&(O.useProgram(c.program),et.currentProgram=c.id,Pl(c),Al(c),Jh(c.uniformArray));let f=Jd.get(a.id);Fl(f,c),Dn("foliageDiffuse",Qv.get(a.texture),0,c),wf(c);let u=s[r];for(let p=0;p<u.length;++p){let g=u[p];O.bindBuffer(O.ARRAY_BUFFER,g.attributes.inst.buffer),O.vertexAttribPointer(e,3,O.FLOAT,!1,7*4,4*4),O.enableVertexAttribArray(e),ml(e,1),O.vertexAttribPointer(n,4,O.FLOAT,!1,7*4,0),O.enableVertexAttribArray(n),ml(n,1),et.boundBuffer=g.attributes.inst.id,O.drawElementsInstanced(O.TRIANGLES,f.drawRangeCount,f.attributes.index.type,f.drawRangeStart,g.instancedCount)}}}};var cc=[],fc=[],_r=new Map,tS=(t,e,n,i,s)=>{let o=D.entity(t),r=D.entity(e);if(n.fx.effectMissile&&o!==void 0&&r!==void 0&&(!o.visual.inFog||!r.visual.inFog)){let a={mId:i,targetid:e,timer:s,effect:zi(n.fx.effectMissile,on(),o===D.playerId?1:0,!0),start:Ln([0,0,0],Ir(bt,[0,0,o.radius],o.rot),o.visualPosition)};a.effect.transform.matrixAutoUpdate=!0,cc.push(a),_r.set(i,a),iS(a,cc.length-1)}},nS=(t,e,n,i,s,o)=>{if(i.fx.effectMissile){let r={mId:s,timer:o,path:e,fractions:n,currentIndex:0,effect:zi(i.fx.effectMissile,on(),t===D.playerId?1:0,!0)};r.effect.transform.matrixAutoUpdate=!0,fc.push(r),_r.set(s,r),sS(r,fc.length-1)}},iS=(t,e)=>{if(!D.isEntityIdTaken(t.targetid)||t.timer.done(D.smoothtime)){cc.splice(e,1),t.effect.done=!0,_r.delete(t.mId);return}let n=D.entity(t.targetid),i=Xt(t.effect.transform.position,n.visualPosition,t.start);sn(t.effect.transform.position,t.start,i,t.timer.fraction(D.smoothtime));let s=D.getHeight(t.effect.transform.position[0],t.effect.transform.position[2])+.3;s>t.effect.transform.position[1]&&(t.effect.transform.position[1]=s),Lr(t.effect.transform,n.visualPosition,!1,fm),t.timer.passed(D.smoothtime)>.5&&(st(t.start,t.effect.transform.position),t.timer.reset(D.smoothtime,t.timer.end-D.smoothtime)),qt(t.effect.transform,!1)},sS=(t,e)=>{if(t.timer.done(D.smoothtime)){fc.splice(e,1),t.effect.done=!0,_r.delete(t.mId);return}let n=Math.max(0,Math.min(1,t.timer.fraction(D.smoothtime)));t.currentIndex=r3(t.effect.transform.position,t.path,n,t.fractions),qt(t.effect.transform,!1)},oS=()=>{cc.forEach(iS),fc.forEach(sS)},rS=t=>{cc.forEach(e=>{e.effect.done=!0}),fc.forEach(e=>{e.effect.done=!0}),cc.length=0,fc.length=0,_r.clear()};var ss,aS=()=>{ss=qi(void 0,11,O.TRIANGLES),mi(ss.transform.scale,40),ss.transform.visible=!1,ss.transform.matrixAutoUpdate=!0,Yo(1456,t=>{let e=Cn(t);ss.geometry=e;let n=yo(1024,1024,1,!1,O.NONE,O.REPEAT,O.REPEAT);T_(n),Ki(If,pt[34]);let i=n.colorTexture;Dn("skyDiffuse",i,0,pt[11]),gi(1748,s=>{ss.transform.visible=!0,Dn("cloudDiffuse",s,0,pt[11])})})},lS=()=>{Y(ss.transform.position,gt.transform.worldMatrix[12],gt.transform.worldMatrix[13],gt.transform.worldMatrix[14]),qt(ss.transform,!1)},cS=()=>{ss.transform.visible&&Ki(ss,pt[11])};var Ui,fS=()=>{Ui=qi(void 0,12,O.TRIANGLES),mi(Ui.transform.scale,.1),Mn(Ui.transform,ss.transform),Ui.transform.visible=!1,Yo(1455,t=>{Ui.geometry=Cn(t),Ui.transform.visible=!0})},uS=()=>{st(Ui.transform.position,sc),hn(Ui.transform.position,Ui.transform.position,.45),Lr(Ui.transform,D_,!1,E_),Ui.transform.matrixNeedsUpdate=!0},pS=()=>{Ui.transform.visible&&Ki(Ui,pt[12])};var e0=24,At=e0+1,gS=At**2,Zv=new Map,br=96,mS=96/12,uc=8,wu=new Uint8Array(3*br**2),Jv=new Map,Kd=e0/2,dS=3,hS=[1,2,4,8],Pa=[0],Jt=[],Yq=(t,e,n,i)=>{let s=e+n*At,o=e+(n+i)*At,r=e+(n+i)*At+i,a=e+n*At+i;Jt.push(s),Jt.push(o),Jt.push(a),Jt.push(o),Jt.push(r),Jt.push(a)};for(let t=0;t<2;++t)for(let e=0;e<2;++e)for(let n=0;n<dS;++n){let i=hS[n],s=hS[n+1],o=e*Kd,r=(e+1)*Kd,a=t*Kd,l=(t+1)*Kd;for(let c=0;c<(n===dS-1?1:16);++c){let f=1&c,u=2&c,p=4&c,g=8&c,v=o+(f?i:0),_=r-(p?i:0),b=a+(u?i:0),y=l-(g?i:0);for(let w=b;w<y;w+=i)for(let C=v;C<_;C+=i)Yq(Jt,C,w,i);if(f){for(let w=a;w<l;w+=s){let C=o+w*At,A=o+(w+s)*At,M=o+(w+i)*At+i;if(Jt.push(C,A,M),w<l-s){let F=M+i*At,V=F+i*At;Jt.push(M,A,F),Jt.push(F,A,V)}}u||Jt.push(o+a*At,o+(a+i)*At+i,o+a*At+i),g||Jt.push(o+l*At,o+l*At+i,o+(l-i)*At+i)}if(u){for(let w=o;w<r;w+=s){let C=w+a*At,A=w+a*At+s,M=w+(a+i)*At+i;if(Jt.push(C,M,A),w<r-s){let F=M+i;Jt.push(M,F,A),Jt.push(F,F+i,A)}}f||Jt.push(o+a*At,o+(a+i)*At,o+(a+i)*At+i),p||Jt.push(r+a*At,r+(a+i)*At-i,r+(a+i)*At)}if(p){for(let w=a;w<l;w+=s){let C=r+w*At,A=r+(w+s)*At,M=r+(w+i)*At-i;if(Jt.push(C,M,A),w<l-s){let F=M+i*At,V=F+i*At;Jt.push(M,F,A),Jt.push(F,V,A)}}u||Jt.push(r+a*At,r+a*At-i,r+(a+i)*At-i),g||Jt.push(r+l*At,r+(l-i)*At-i,r+l*At-i)}if(g){for(let w=o;w<r;w+=s){let C=w+l*At,A=w+l*At+s,M=w+(l-i)*At+i;if(Jt.push(C,A,M),w<r-s){let F=M+i,V=F+i;Jt.push(M,A,F),Jt.push(F,A,V)}}f||Jt.push(o+l*At,o+(l-i)*At+i,o+(l-i)*At),p||Jt.push(r+l*At,r+(l-i)*At,r+(l-i)*At-i)}Pa.push(Jt.length)}}var Xq={type:O.UNSIGNED_INT,data:new Uint32Array(Jt)},Kv=new Float32Array(gS*3),Qq=new Float32Array(gS*3);for(let t=0,e=0;t<=e0;++t)for(let n=0;n<=e0;++n,++e)Kv[e*3+0]=n*2.6666666666666665,Kv[e*3+2]=t*2.6666666666666665;var vS=()=>{},_S=(t,e,n)=>{if(Jq(t),e){let i=t.geometry.terrain,s=i.attributes.position.data,o=i.attributes.normal.data;for(let a=0;a<25;++a)for(let l=0;l<25;++l){let c=l+25*a,f=t.data.terrain[c]*.030517578125;s[c*3+1]=f}let r=t.normals;for(let a=0;a<25*25*3;++a)o[a]=0;for(let a=0;a<24;++a)for(let l=0;l<24;++l){let c=(l*2+24*a*2)*3,f=r[c],u=r[c+1],p=r[c+2],g=r[c+3],v=r[c+4],_=r[c+5],b=(l+25*a)*3,y=(l+25*(a+1))*3,w=(l+1+25*a)*3,C=(l+1+25*(a+1))*3;o[b]+=f,o[b+1]+=u,o[b+2]+=p,o[y]+=f+g,o[y+1]+=u+v,o[y+2]+=p+_,o[w]+=f+g,o[w+1]+=u+v,o[w+2]+=p+_,o[C]+=g,o[C+1]+=v,o[C+2]+=_}if(t.z>0){let l=D.getChunk(t.x,t.z-1).normals,c=24-1;for(let f=0;f<24;++f){let u=(f*2+24*c*2)*3,p=l[u],g=l[u+1],v=l[u+2],_=l[u+3],b=l[u+4],y=l[u+5],w=(f+1)*3,C=f*3;o[C]+=p+_,o[C+1]+=g+b,o[C+2]+=v+y,o[w]+=_,o[w+1]+=b,o[w+2]+=y}}if(t.z+1<D.chunkAmount){let l=D.getChunk(t.x,t.z+1).normals,c=0,f=25-1;for(let u=0;u<24;++u){let p=(u*2+24*c*2)*3,g=l[p],v=l[p+1],_=l[p+2],b=l[p+3],y=l[p+4],w=l[p+5],C=(u+25*f)*3,A=(u+1+25*f)*3;o[C]+=g,o[C+1]+=v,o[C+2]+=_,o[A]+=g+b,o[A+1]+=v+y,o[A+2]+=_+w}}if(t.x>0){let l=D.getChunk(t.x-1,t.z).normals,c=24-1;for(let f=0;f<24;++f){let u=(c*2+24*f*2)*3,p=l[u],g=l[u+1],v=l[u+2],_=l[u+3],b=l[u+4],y=l[u+5],w=25*f*3,C=25*(f+1)*3;o[w]+=p+_,o[w+1]+=g+b,o[w+2]+=v+y,o[C]+=_,o[C+1]+=b,o[C+2]+=y}}if(t.x+1<D.chunkAmount){let l=D.getChunk(t.x+1,t.z).normals,c=0,f=25-1;for(let u=0;u<24;++u){let p=(c*2+24*u*2)*3,g=l[p],v=l[p+1],_=l[p+2],b=l[p+3],y=l[p+4],w=l[p+5],C=(f+25*u)*3,A=(f+25*(u+1))*3;o[A]+=g+b,o[A+1]+=v+y,o[A+2]+=_+w,o[C]+=g,o[C+1]+=v,o[C+2]+=_}}for(let a=0;a<25;++a)for(let l=0;l<25;++l){let c=(l+25*a)*3,f=o[c],u=o[c+1],p=o[c+2],g=1/Math.sqrt(f*f+u*u+p*p);o[c]=f*g,o[c+1]=u*g,o[c+2]=p*g}hi(i,i.attributes.position),hi(i,i.attributes.normal)}if(n){let i=t.x*2%uc*2+t.z*2%uc*uc;t.meshes.atlas=Kq(t),t.meshes.texSet=t.data.textureid.map(eR);let s=t.data.holes.length>0;for(let o=0;o<2;++o)for(let r=0;r<2;++r){let a=r*2+o,l=t.data.texture[a];for(let f=0;f<br;++f)for(let u=0;u<br;++u){let p=f*br+u,g=p*3;if(q8(l[p],wu,g),s){let v=o*12+Math.floor(u/mS)+(Math.floor(f/mS)+r*12)*24;t.data.holes.indexOf(v)>=0&&(wu[g+0]=255,wu[g+1]=255,wu[g+2]=255)}}zy(t.meshes.atlas,i+a,br,br,wu);let c=t.meshes.quadrantUbos[a];c.data.quadrant[0]=i+a,c.data.terrainInfo=t.meshes.texSet[a].info,Bm(c),si(c)}}},Zq={min:[0,0,0],max:[64,64,64],center:[32,32,32],scale:[64,64,64],radius:60,initiated:!0},Jq=t=>{if(t.geometry.terrain||(t.geometry.terrain=Cn({position:{size:3,data:Kv},normal:{size:3,data:Qq},index:Xq}),Object.assign(t.geometry.terrain.bounds,Zq)),!t.meshes.terrain){let e=qi(t.geometry.terrain,8,O.TRIANGLES);t.meshes.terrain=e,t.meshes.quadrantUbos=[];for(let n=0;n<4;++n){let i=Ol(Xf.meshterrain);i.data.modelMatrix=e.transform.matrix,t.meshes.quadrantUbos.push(i)}}st(t.meshes.terrain.transform.position,t.origin),t.meshes.terrain.transform.matrixNeedsUpdate=!0,qt(t.meshes.terrain.transform,!1),t.state=Math.max(t.state,5)},Kq=t=>{let e=Math.floor(t.x*2/uc),n=Math.floor(t.z*2/uc),i=e+1e3*n;if(!Zv.has(i)){let s=Ho({width:br,height:br,target:O.TEXTURE_2D_ARRAY,format:O.RGB,internalFormat:O.RGB565,depth:uc**2,flipY:!1,generateMipmaps:!1});xm(s,4),es(s),Zv.set(i,s)}return Zv.get(i)},eR=t=>{let e=t.join(",");if(!Jv.has(e)){let n={info:[],diffuse:[],loaded:0};t.forEach((i,s)=>{let o=El.get(i);n.info[s*4+0]=o.scale/127,n.info[s*4+1]=o.darkest/255*3,n.info[s*4+2]=o.brightest/255*3,n.info[s*4+3]=o.spec/255,gi(o.texture,r=>{n.diffuse[s]=r,n.loaded++})}),Jv.set(e,n)}return Jv.get(e)},bS=t=>{},yS=(t,e)=>{},kS=()=>{},xS=t=>{let e=pt[8];if(!e.active)return;O.useProgram(e.program),et.currentProgram=e.id,Pl(e),Al(e);let n,i,s=1;for(let r=0;r<t.length;++r){let a=t[r],l=a.meshes.terrain,c=l.geometry;n!==a.meshes.atlas&&(Dn("atlas",a.meshes.atlas,0,e),n=a.meshes.atlas),Fl(c,e);for(let f=0;f<4;++f)if(a.quadrantlod[f]<=s){let u=a.meshes.texSet[f];if(u.loaded<4)continue;let p=a.meshes.quadrantUbos[f];if(ca(p),i!==u){for(let b=0;b<4;++b)Dn("diffuse",u.diffuse[b],b,e);i=u}wf(e);let g=a.quadrantmask[f],v=Pa[g]*4,_=Pa[g+1]-Pa[g];O.drawElements(l.mode,_,c.attributes.index.type,v)}}let o=pt[9];if(o.active){O.useProgram(o.program),et.currentProgram=o.id,Pl(o),Al(e);for(let r=0;r<t.length;++r){let a=t[r],l=a.meshes.terrain,c=l.geometry,f=a.meshes.quadrantUbos[0];ca(f),Fl(c,o);for(let u=0;u<4;++u)if(a.quadrantlod[u]>s){let p=a.quadrantmask[u],g=Pa[p]*4,v=Pa[p+1]-Pa[p];O.drawElements(l.mode,v,c.attributes.index.type,g)}}}};var wS,MS=()=>{wS=Cn({position:{size:3,data:new Float32Array([0,0,0,64,0,0,0,0,64,64,0,64])},index:{type:O.UNSIGNED_INT,data:new Uint32Array([0,2,1,2,3,1])}}),gi(1748,t=>Dn("waterNoise",t,0,pt[20])),gi(1243,t=>Dn("waterLines",t,0,pt[20])),Dn("bufferPongColor",Mo.colorTexture,0,pt[20]),Dn("bufferPongDepth",Mo.depthTexture,0,pt[20])},FS=(t,e)=>{if(!e||t.data.water.length===0)return;t.meshes.waterubo||(t.meshes.waterubo=Ol(Xf.water));let n=t.origin[0],i=t.origin[2],s=t.meshes.waterubo.data.verts;for(let o=0;o<4;++o){let r=t.data.water[o]*.030517578125;s[o*3]=n+o%2*64,s[o*3+1]=r,s[o*3+2]=i+Math.floor(o/2)*64}Bm(t.meshes.waterubo),si(t.meshes.waterubo)},CS=t=>{},SS=t=>{let e=pt[20];Sl(e,et.currentProgram===e.id);for(let n=0,i=t.length;n<i;++n){let s=t[n];s.data.water.length!==0&&(ca(s.meshes.waterubo),Cl(wS,e,O.TRIANGLES))}};var AS=t=>{Oy(),ww(),d8(t),P8(),MS(),s8(),c8(),aS(),fS(),kS()},PS=(t,e,n)=>{T8(t,e,n),vS(),h8(e),oS(),k8(t,e),o8(t),f8(t),KC(t,e),lS(),uS(),Yy(t)},TS=(t,e)=>{Ky(t,e),yS(t,e),K8(t,e)},ES=t=>{rS(t),w8(t),p8(t),t8(t),e3(t)},pc=[],DS=t=>{pc.push(t)},e2=t=>{pc.splice(pc.indexOf(t),1)},IS=t=>{xS(t),r8(),cS(),eS(t)},VS=t=>{pS()},LS=t=>{SS(t),a8(),n8()},qS=(t,e,n,i,s,o,r)=>{if(t.state!==8&&(_S(t,e,n),Z8(t,i),FS(t,o),s))for(let a=0;a<t.props.length;++a)t.props[a].onChunkRebuild(t)},RS=t=>{bS(t),J8(t),CS(t)};var mc={neticons:[],npcs:[]},yr=.6,n0=!1,Ta=200,Ea=200,i2=!1,i0=0,s0=0,yi=document.createElement("canvas");yi.className="border black minimap";var Ms=yi.getContext("2d"),t2=new Map,Fu=new Map;yi.addEventListener("wheel",t=>{yr=vt(yr+(t.deltaY<0?.07:-.07),.25,1.5)},{passive:!0});yi.addEventListener("mousedown",t=>{i2=!0});yi.addEventListener("mouseup",t=>{i2=!1});yi.addEventListener("mousemove",t=>{if(i2){let e=t.movementX,n=t.movementY;i0-=e/yr,s0-=n/yr}});var Mu={player:"#fff",monster:"#D53434",pvp:Dt("pvp"),friendly:Dt("health"),party:Dt("party"),black:Dt("black")},iR=()=>{tt.map.onPress(()=>{o0(n0=!n0)}),Bn(Ft.serverMapUpdate.header,t=>{mc.neticons=Ft.serverMapUpdate.decode(t).icons})},o0=t=>{i0=s0=0,t?(document.body.appendChild(yi),Ta=~~Math.min(Math.max(200,window.innerWidth*.7),1e3),Ea=~~Math.min(Math.max(200,window.innerHeight*.7),800),Ta%2!==0&&(Ta+=1),Ea%2!==0&&(Ea+=1),yi.width=Ta,yi.height=Ea,yi.className="border black minimap enlarged"):(document.getElementById("minimapcontainer").appendChild(yi),yi.className="border black minimap",Ta=yi.width=200,Ea=yi.height=200)},US=function(){this.loaded=!0},zS=0,sR=t=>{zS++;let e=D.player;if(!e||oe.mapLowQuality&&zS%10!==0)return;let n=Ms;n.globalAlpha=1,n.clearRect(0,0,Ta,Ea);let i=e,s=i.pos[0]+i0,o=i.pos[2]+s0,r=yr<.4?16:4,a=r*64,l=D.chunkAmount,c=Math.round(a*yr),f=Ta,u=Ea,p=f*(a/c),g=u*(a/c),v=Math.ceil(p/a),_=Math.ceil(g/a),b=s-p/2,y=o-g/2,w=Math.floor(b/a),C=Math.floor(y/a),A=w+v,M=C+_;(A*a-b)*(c/a)<f&&A++,(M*a-y)*(c/a)<u&&M++,w=Math.max(0,w),C=Math.max(0,C),A=Math.min(l/r,A),M=Math.min(l/r,M);for(let U=w;U<A;++U)for(let ie=C;ie<M;++ie){let re=U*r+ie*l*r,ae=r+"-"+re;if(Fu.has(ae)){let ue=Fu.get(ae);if(ue.loaded){let Me=(U*a-b)*(c/a),me=(ie*a-y)*(c/a);n.drawImage(ue,Me,me,c,c)}}else{let ue=new Image;ue.src=Vk(D.file,r,re),ue.onload=US,Fu.set(ae,ue)}}let F=!1;if(mc.neticons.forEach(U=>{F=F||U.blink;let ie=t0(U.pos[0],U.pos[1],s,o,c,a,f,u);n2(ie,U.id,U.blink)}),F&&(n.globalAlpha=1),mc.npcs.forEach(U=>{let ie=oR(U.pos[0],U.pos[1],s,o,c,a,f,u);ie[0]>0&&ie[1]>0&&ie[0]<f&&ie[1]<u&&n2(ie,U.img,!1)}),D.entities.array.forEach(U=>{if(!U.stats||!U.stats.alive||U===e)return;let ie=t0(U.pos[0],U.pos[2],s,o,c,a,f,u);$S(ie,U.type,e.hostility(U),U.party>0&&U.party===e.party)}),en.forEach(U=>{if(U.local&&U.pos!==void 0&&!D.isEntityIdTaken(U.id)){let ie=t0(U.pos[0],U.pos[1],s,o,c,a,f,u);$S(ie,0,0,e.party)}}),e.buffs.buffs.has(128)){let U=e.buffs.buffs.get(128).get(e.id);if(U.data){let ie=t0(U.data[0],U.data[1],s,o,c,a,f,u);n2(ie,2100,!1)}}n.globalAlpha=n0&&D.smoothtime%1<.5?.5:1;let V=D.player.visual.transform.rotation[1],L=Math.sin(V)*6,q=Math.cos(V)*6,R=Math.sin(V+2.4)*6,z=Math.cos(V+2.4)*6,E=Math.sin(V-2.4)*6,W=Math.cos(V-2.4)*6,j=f/2-i0*yr,N=u/2-s0*yr;n.fillStyle="#C1DAE2",n.strokeStyle="#1A293A",n.lineWidth=1,n.beginPath(),n.moveTo(j+L,N+q),n.lineTo(j+R,N+z),n.lineTo(j+E,N+W),n.closePath(),n.fill(),n.stroke()},n2=(t,e,n)=>{if(t2.has(e)){let i=t2.get(e);if(i.loaded===!0){!n||D.smoothtime%1<.5?Ms.globalAlpha=n?.6:.8:Ms.globalAlpha=1;let s=i.width,o=i.height;Ms.drawImage(i,t[0]-s/2,t[1]-o/2,~~s,~~o)}}else{let i=document.createElement("img");i.src="data/assets/"+Sm(e)+"?v=8582889",i.onload=US,t2.set(e,i)}},$S=(t,e,n,i)=>{if(!(!oe.mapShowMonsters&&e===1))if(e===0){if(n0&&i&&D.smoothtime%1>.5)return;n===0?Ms.fillStyle=i?Mu.party:Mu.friendly:Ms.fillStyle=Mu.pvp,Ms.fillRect(...t,6,6),Ms.strokeRect(...t,6,6)}else Ms.fillStyle=n>0?Mu.monster:Mu.friendly,Ms.fillRect(...t,4,4),Ms.strokeRect(...t,4,4)},oR=(t,e,n,i,s,o,r,a)=>{let l=t-n,c=e-i,f=l/o*s,u=c/o*s,p=r/2+f,g=a/2+u;return[p,g]},t0=(t,e,n,i,s,o,r,a)=>{let l=t-n,c=e-i,f=l/o*s,u=c/o*s,p=Math.min(r-3,Math.max(0,r/2+f)),g=Math.min(a-3,Math.max(0,a/2+u));return[p,g]},rR=t=>{Fu.clear();for(let e=0;e<Tf.length;++e)Tf[e].world===t.idInt&&mc.npcs.push(Tf[e])},aR=t=>{Fu.clear(),mc.neticons.length=0,mc.npcs.length=0};function OS(t){let e,n,i,s;return{c(){e=h("img"),m(e,"class","btn border black bgblack round warIcon svelte-1khf45q"),at(e.src,n="/data/ui/icons/war0."+zn+"?v=8582889")||m(e,"src",n)},m(o,r){x(o,e,r),i||(s=Q(e,"click",t[2]),i=!0)},p:ce,d(o){o&&k(e),i=!1,s()}}}function lR(t){let e,n=t[0]!==void 0&&OS(t);return{c(){e=h("div"),n&&n.c(),m(e,"id","minimapcontainer"),m(e,"class","marg-top minimapcontainer svelte-1khf45q")},m(i,s){x(i,e,s),n&&n.m(e,null)},p(i,[s]){i[0]!==void 0?n?n.p(i,s):(n=OS(i),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},i:ce,o:ce,d(i){i&&k(e),n&&n.d()}}}function cR(t,e,n){let i,s;return se(t,zs,r=>n(0,i=r)),se(t,$s,r=>n(1,s=r)),jn(()=>{o0(!1)}),[i,s,r=>nt($s,s=!s,s)]}var o2=class extends we{constructor(e){super(),Ce(this,e,cR,lR,$e,{})}},NS=o2;function jS(t){let e,n;return e=new DC({}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function WS(t){let e,n;return e=new qC({props:{vertical:!0}}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function fR(t){let e,n,i,s,o,r,a,l,c,f,u,p,g,v,_,b,y,w,C,A,M,F,V,L,q,R,z,E,W,j,N,U,ie,re,ae,ue,Me,me,Ne,De;e=new LM({}),i=new L_({});let Fe=t[0]&&!t[0].subscribed_until&&(t[1]||t[2]||t[3]||t[4]||t[5])&&jS(t);r=new LF({}),a=new BF({}),l=new Ib({}),c=new nF({}),f=new zM({}),u=new dx({}),g=new TF({}),v=new sx({}),_=new SM({}),b=new DM({}),y=new OM({}),w=new n6({}),C=new SF({}),A=new _6({}),M=new E6({}),F=new B6({}),V=new O6({}),L=new pF({}),q=new pC({}),R=new _C({}),z=new lC({}),E=new TC({}),j=new GM({}),N=new NS({}),U=new BC({});let _e=t[6]&&WS(t);return ue=new Lw({}),Me=new xM({}),me=new yC({}),Ne=new EF({}),{c(){te(e.$$.fragment),n=h("div"),te(i.$$.fragment),s=h("div"),Fe&&Fe.c(),o=ge(),te(r.$$.fragment),te(a.$$.fragment),te(l.$$.fragment),te(c.$$.fragment),te(f.$$.fragment),te(u.$$.fragment),p=Ue(),te(g.$$.fragment),te(v.$$.fragment),te(_.$$.fragment),te(b.$$.fragment),te(y.$$.fragment),te(w.$$.fragment),te(C.$$.fragment),te(A.$$.fragment),te(M.$$.fragment),te(F.$$.fragment),te(V.$$.fragment),te(L.$$.fragment),te(q.$$.fragment),te(R.$$.fragment),te(z.$$.fragment),te(E.$$.fragment),W=h("div"),te(j.$$.fragment),te(N.$$.fragment),te(U.$$.fragment),_e&&_e.c(),ie=h("div"),re=h("div"),ae=h("div"),te(ue.$$.fragment),te(Me.$$.fragment),te(me.$$.fragment),te(Ne.$$.fragment),m(W,"class","l-corner-ur uiscaled"),m(s,"class","container svelte-k3qmu8"),m(ae,"class","actionbarcontainer svelte-k3qmu8"),m(re,"class","uiscaled"),m(ie,"class","container svelte-k3qmu8"),m(n,"class","l-ui layout svelte-k3qmu8")},m(H,qe){K(e,H,qe),x(H,n,qe),K(i,n,null),d(n,s),Fe&&Fe.m(s,null),d(s,o),K(r,s,null),K(a,s,null),K(l,s,null),K(c,s,null),K(f,s,null),K(u,s,null),d(s,p),K(g,s,null),K(v,s,null),K(_,s,null),K(b,s,null),K(y,s,null),K(w,s,null),K(C,s,null),K(A,s,null),K(M,s,null),K(F,s,null),K(V,s,null),K(L,s,null),K(q,s,null),K(R,s,null),K(z,s,null),K(E,s,null),d(s,W),K(j,W,null),K(N,W,null),K(U,W,null),_e&&_e.m(W,null),d(n,ie),d(ie,re),d(re,ae),K(ue,ae,null),K(Me,ae,null),K(me,ie,null),K(Ne,n,null),De=!0},p(H,[qe]){H[0]&&!H[0].subscribed_until&&(H[1]||H[2]||H[3]||H[4]||H[5])?Fe?qe&63&&P(Fe,1):(Fe=jS(H),Fe.c(),P(Fe,1),Fe.m(s,o)):Fe&&(Te(),I(Fe,1,1,()=>{Fe=null}),Ee()),H[6]?_e?qe&64&&P(_e,1):(_e=WS(H),_e.c(),P(_e,1),_e.m(W,null)):_e&&(Te(),I(_e,1,1,()=>{_e=null}),Ee())},i(H){De||(P(e.$$.fragment,H),P(i.$$.fragment,H),P(Fe),P(r.$$.fragment,H),P(a.$$.fragment,H),P(l.$$.fragment,H),P(c.$$.fragment,H),P(f.$$.fragment,H),P(u.$$.fragment,H),P(g.$$.fragment,H),P(v.$$.fragment,H),P(_.$$.fragment,H),P(b.$$.fragment,H),P(y.$$.fragment,H),P(w.$$.fragment,H),P(C.$$.fragment,H),P(A.$$.fragment,H),P(M.$$.fragment,H),P(F.$$.fragment,H),P(V.$$.fragment,H),P(L.$$.fragment,H),P(q.$$.fragment,H),P(R.$$.fragment,H),P(z.$$.fragment,H),P(E.$$.fragment,H),P(j.$$.fragment,H),P(N.$$.fragment,H),P(U.$$.fragment,H),P(_e),P(ue.$$.fragment,H),P(Me.$$.fragment,H),P(me.$$.fragment,H),P(Ne.$$.fragment,H),De=!0)},o(H){I(e.$$.fragment,H),I(i.$$.fragment,H),I(Fe),I(r.$$.fragment,H),I(a.$$.fragment,H),I(l.$$.fragment,H),I(c.$$.fragment,H),I(f.$$.fragment,H),I(u.$$.fragment,H),I(g.$$.fragment,H),I(v.$$.fragment,H),I(_.$$.fragment,H),I(b.$$.fragment,H),I(y.$$.fragment,H),I(w.$$.fragment,H),I(C.$$.fragment,H),I(A.$$.fragment,H),I(M.$$.fragment,H),I(F.$$.fragment,H),I(V.$$.fragment,H),I(L.$$.fragment,H),I(q.$$.fragment,H),I(R.$$.fragment,H),I(z.$$.fragment,H),I(E.$$.fragment,H),I(j.$$.fragment,H),I(N.$$.fragment,H),I(U.$$.fragment,H),I(_e),I(ue.$$.fragment,H),I(Me.$$.fragment,H),I(me.$$.fragment,H),I(Ne.$$.fragment,H),De=!1},d(H){H&&k(n),ee(e,H),ee(i),Fe&&Fe.d(),ee(r),ee(a),ee(l),ee(c),ee(f),ee(u),ee(g),ee(v),ee(_),ee(b),ee(y),ee(w),ee(C),ee(A),ee(M),ee(F),ee(V),ee(L),ee(q),ee(R),ee(z),ee(E),ee(j),ee(N),ee(U),_e&&_e.d(),ee(ue),ee(Me),ee(me),ee(Ne)}}}function uR(t,e,n){let i,s,o,r,a,l,c;return se(t,ll,f=>n(0,i=f)),se(t,Ar,f=>n(1,s=f)),se(t,ls,f=>n(2,o=f)),se(t,Us,f=>n(3,r=f)),se(t,Yi,f=>n(4,a=f)),se(t,Vi,f=>n(5,l=f)),se(t,hl,f=>n(6,c=f)),ru(),[i,s,o,r,a,l,c]}var r2=class extends we{constructor(e){super(),Ce(this,e,uR,fR,$e,{})}},GS=r2;function HS(t){let e,n;return e=new GS({}),{c(){te(e.$$.fragment)},m(i,s){K(e,i,s),n=!0},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){I(e.$$.fragment,i),n=!1},d(i){ee(e,i)}}}function pR(t){let e,n,i,s;e=new o_({props:{active:t[0]}});let o=t[1]&&!t[0]&&t[2]&&HS(t);return i=new I_({}),{c(){te(e.$$.fragment),o&&o.c(),n=ge(),te(i.$$.fragment)},m(r,a){K(e,r,a),o&&o.m(r,a),x(r,n,a),K(i,r,a),s=!0},p(r,[a]){let l={};a&1&&(l.active=r[0]),e.$set(l),r[1]&&!r[0]&&r[2]?o?a&7&&P(o,1):(o=HS(r),o.c(),P(o,1),o.m(n.parentNode,n)):o&&(Te(),I(o,1,1,()=>{o=null}),Ee())},i(r){s||(P(e.$$.fragment,r),P(o),P(i.$$.fragment,r),s=!0)},o(r){I(e.$$.fragment,r),I(o),I(i.$$.fragment,r),s=!1},d(r){r&&k(n),ee(e,r),o&&o.d(r),ee(i,r)}}}function mR(t,e,n){let i,s,o;return se(t,xi,r=>n(0,i=r)),se(t,sp,r=>n(1,s=r)),se(t,qc,r=>n(2,o=r)),[i,s,o]}var a2=class extends we{constructor(e){super(),Ce(this,e,mR,pR,$e,{})}},YS=a2;var QS=[],Cu=0,r0=0,XS=()=>{let t=QS.shift();t[0](...t[1]),r0--},ZS=(t,e,n)=>{if(n)for(;Cu>0;)Cu--,r0++,XS();else Cu>0&&r0<5&&(Cu--,r0++,requestIdleCallback(XS,{timeout:5e3}))},l2=(t,e,n)=>{QS.push([t,e]),Cu++};var JS=()=>({id:0,x:0,z:0,origin:[0,0,0],deserialized:!1,props:[],normals:new Float32Array(3456),data:void 0,loadingProps:0,center2d:[0,0],geometry:{},meshes:{},state:0,neighbors:[],quadrantlod:[0,0,0,0],quadrantmask:[0,49,98,147],inRange:!1,isMeshVisible:!1,isEffectsVisible:!1}),c2=(t,e,n,i,s)=>{B8(t,e,n,i),t.center2d[0]=t.origin[0]+64/2,t.center2d[1]=t.origin[2]+64/2,t.neighbors.length=0;for(let o=Math.max(0,n-1);o<=Math.min(s-1,n+1);o++)for(let r=Math.max(0,i-1);r<=Math.min(s-1,i+1);r++){let a=o+r*s;a!==t.id&&t.neighbors.push(a)}t.state=0},KS=t=>t.state>=2?!1:(t.state=2,dR(t),!0),dR=async t=>{try{let n=await(await fetch(`data/world/${D.file}/${t.id}?v=8582889`,{cache:"default"})).arrayBuffer();l2(hR,[new Uint8Array(n),t])}catch{console.log(`failed to load chunk ${t.id}, retrying`),t.state=2-1,KS(t)}},hR=(t,e)=>{e.state=3,z8(e,bl.chunk.decode(t)),f2(e)},f2=t=>{if(t.inRange=Vv(t.x*2,t.z*2)<3,t.inRange)for(let e=0;e<2;++e)for(let n=0;n<2;++n){let i=n*2+e,s=Math.min(2,Vv(t.x*2+e,t.z*2+n)),o=jC(t.x*2+e,t.z*2+n);t.quadrantlod[i]=s,t.quadrantmask[i]=o}},eA=(t,e)=>{let n=t.state;if(n===0||n===3){if(t.inRange){n===0&&(t.state=1);let i=t.loadingProps===0;for(let s=0;s<t.neighbors.length;++s){let o=e.chunksMap.get(t.neighbors[s]);o?o.state<3&&(o.state===0&&(o.state=1),i=!1):i=!1}n===3&&i&&(t.state=4,gR(t,!0,!0,!0,!0,!0,!0))}}else n>=5?t.inRange&&t.state<7?(DS(t),t.state=7):!t.inRange&&t.state===7&&(e2(t),Su(t,!1,!1),t.state=6):n===1&&KS(t)&&(t.state=2)},Su=(t,e,n)=>{if(t.isMeshVisible!==e){t.isMeshVisible=e;for(let i=0;i<t.props.length;++i)t.props[i].setVisible(e)}if(!n&&t.isEffectsVisible!==e){t.isEffectsVisible=e;for(let i=0;i<t.props.length;++i)t.props[i].setEffectVisible(e)}},gR=(t,e,n,i,s,o,r)=>{l2(qS,[t,e,n,i,s,o])},u2=t=>{U8(t),t.state===7&&(e2(t),Su(t,!1,!1),t.state=6),RS(t),t.state=8};var nA=(t,e,n)=>{let i=[];for(let s=0;s<t.length;++s){let o=t[s];V8(o.data.aabb,e.frustum,e.frustumConstants)?(i.push(o),Su(o,!0,n)):Su(o,!1,n)}return i},vR=()=>{let t=pc;if(O.enable(O.POLYGON_OFFSET_FILL),O.polygonOffset(1.3,3),nc){for(let e=1;e>=0;--e){let n=Nl[e],i=Fa[e];Jm(i,!0),Au(n),Sh(n),t=nA(t,i,!0);for(let s=0,o=Vd.length;s<o;++s){let r=Vd[s];ec(r,pt[r.shadowProgram],!0,i)}}hu(!1)}Jm(Fa[0],!0),a0(Nl[0],jl,O.DEPTH_BUFFER_BIT),Au(jl);for(let e=0,n=Id.length;e<n;++e){let i=Id[e];ec(i,pt[i.shadowProgram],!1,gt)}O.disable(O.POLYGON_OFFSET_FILL)},_R=t=>{Jm(gt,!0),Au(bs),Sh(bs);for(let e=0,n=Td.length;e<n;++e){let i=Td[e];ec(i,pt[i.program],!0,gt)}IS(t)},bR=t=>{VS(t);for(let e=0,n=Ed.length;e<n;++e){let i=Ed[e];ec(i,pt[i.program],!0,gt)}a0(bs,Mo,O.DEPTH_BUFFER_BIT),a0(bs,Mo,O.COLOR_BUFFER_BIT),Au(bs),LS(t);for(let e=0,n=Dd.length;e<n;++e){let i=Dd[e];ec(i,pt[i.program],!0,gt)}},dc=(t,e,n,i,s)=>{let o=pt[t];n&&Dn("inputA",n.colorTexture,0,o),i&&Dn("inputB",i.colorTexture,0,o);for(let r=0;r<s.length;++r){let a=o.uniforms[s[r][0]];a.value=s[r][1]}Au(e),Ki(If,o)},yR=t=>{let e=Mo,n=bs;if(t.has(32)&&(t.delete(32),dc(32,e,n,null,[]),[e,n]=[n,e]),t.has(33)&&(t.delete(33),dc(33,e,n,null,[]),[e,n]=[n,e]),t.has(30)){t.delete(30);let i=.5/ua.width,s=.5/ua.height;dc(30,pa,n,null,[["offset",[-i,-s,i,-s,i,s,-i,s]],["amount",[.25,.25,.25,.25]]]);let o=["amount",[.125,.375,.375,.125]];i*=2,s*=2,dc(30,ua,pa,null,[["offset",[-i*2,0,-i,0,i,0,i*2,0]],o]),dc(30,pa,ua,null,[["offset",[0,-s*2,0,-s,0,s,0,s*2]],o]),dc(31,null,n,pa,[])}else a0(n,null,O.COLOR_BUFFER_BIT)},a0=(t,e,n,i=O.NEAREST)=>{let s=t.width,o=t.height,r=e!==null?e.width:bs.width,a=e!==null?e.height:bs.height;O.bindFramebuffer(O.READ_FRAMEBUFFER,t.buffer),O.bindFramebuffer(O.DRAW_FRAMEBUFFER,e!==null?e.buffer:null),O.blitFramebuffer(0,0,s,o,0,0,r,a,n,i)},Au=t=>{t?(O.bindFramebuffer(O.FRAMEBUFFER,t.buffer),Nc(t.width,t.height)):(O.bindFramebuffer(O.FRAMEBUFFER,null),Nc(et.width,et.height))},iA=t=>{xx(t)},sA=t=>{vR();let e=nA(pc,gt,!1);_R(e),bR(e),yR(t)};var hc=oe.resolution/100,rA=!1,oA=[256,512,1024,2048][oe.shadowmapResolution]||1024,aA=()=>{O||(alert("WebGL2 problem found."),window.location.href="/technical"),lA(),iA(oA),AS(oA),fA(et.width,et.height),En.className="l-canvas",Fi.className="l-canvas",Fi.style.pointerEvents="all",window.addEventListener("resize",cA,!1)};Rr.subscribe(t=>{OC(t**2/10,oe.shadowmapResolution)});Br.subscribe(t=>{gt.fov=t,Oc(gt)});xi.subscribe(t=>{rA=!t});var lA=()=>{let t=window.innerWidth*hc,e=window.innerHeight*hc;M_(t,e)},cA=()=>{let t=window.innerWidth*hc,e=window.innerHeight*hc;lA(),wx(t,e),fA(t,e)},fA=(t,e)=>{gt.aspect=t/e,Oc(gt),Mw(t,e)};zr.subscribe(t=>{let e=t/100,n=hc!==e;hc=e,oe.resolutionScale=e,n&&cA()});var uA=(t,e)=>{Fp(gt);let n=new Set;oe.fxaa&&n.add(32),oe.bloom&&n.add(30),rA&&(PS(t,e.smoothtime,n),sA(n))},pA=(t,e)=>{TS(t,e)},mA=t=>{ES(t),_8()};_o.report.fun=t=>{t.length>=3?oo.set({name:t,reason:0,reasonfixed:!1}):Nt("error","Enter a player name to report",!0)};var g2={};Xn(g2,{init:()=>AR,postTick:()=>PR});var Pu=[],eo=0,dA=t=>{eo+=t;let e=[];for(let i=0;i<Pu.length;i++){let s=Pu[i];if(s.timer.done(eo))wR(s),Pu.splice(i--,1);else if(eo>=s.timer.start){let o=s.timer.fraction(eo);st(s.screenPos,s.pos);let r=va(s.screenPos,s.screenPos,s.flat);if(r){let a=s.timer.remaining(eo);if(s.alpha=a<.3?a/.3:1,s.crit){let l=Math.min(1,o*6);s.scale=1+(l>.5?2-l*2:l*2)*1.6}else r[1]-=50-(1-o)**2*50,s.scale=1;e.push(s)}}}if(e.sort((i,s)=>s.timer.start-i.timer.start),oe.combatTextPush){let i=0,s=!0,o=[0,0],r=[0,0];for(;i<10&&s;){++i,s=!1;for(let a=0;a<e.length;++a){let l=e[a],c=l.width*l.scale,f=l.height*l.scale;o[0]=l.screenPos[0]+l.screenOffset[0],o[1]=l.screenPos[1]+l.screenOffset[1];for(let u=0;u<e.length;++u){if(u===a)continue;let p=e[u],g=p.width*p.scale;if(p.flat!==l.flat||g<c||g===c&&a<u)continue;let v=p.height*p.scale;r[0]=p.screenPos[0]+p.screenOffset[0],r[1]=p.screenPos[1]+p.screenOffset[1];let _=r[0]-o[0],b=r[1]-o[1],y=g/2+c/2,w=v/2+f/2;if(Math.abs(_)<y&&Math.abs(b)<w){let C=_<0?_+y:_-y,A=b<0?b+w:b-w;Math.abs(C)<Math.abs(A)*1.2?l.screenOffset[0]+=C:l.screenOffset[1]+=A,s=!0,o[0]=l.screenPos[0]+l.screenOffset[0],o[1]=l.screenPos[1]+l.screenOffset[1]}}}}}let n=[0,0];for(let i=0;i<e.length;++i){let s=e[i];s.screenOffset[0]*=Math.max(0,1-t*3),s.screenOffset[1]*=Math.max(0,1-t*3),n[0]=s.screenPos[0]+s.screenOffset[0],n[1]=s.screenPos[1]+s.screenOffset[1],gM(n,s.img,s.alpha,s.scale)}},m2=(t,e,n,i,s=!1,o)=>{let r=n===3;Tu(t,s,r,s||!r,n===0?"Miss":ht(e)+(n===1?"\u{1F6E1}\uFE0F":""),s?It.pdmg:i===1?r?It.spellCrit:It.spell:r?It.physCrit:It.phys,o,eo,r?1.2:.9)},d2=(t,e,n,i=!1,s)=>{Tu(t,i,n===3,i||n!==3,ht(e),i?It.pheal:It.heal,s,eo,1.3)},hA=(t,e,n)=>{Tu(t,n,!1,!0,"Immune",n?It.mana:It.spell,e,eo,2)},gA=(t,e,n,i=!1)=>{Tu(t,i,n===3,i||n!==3,e,It.mana,0,eo,1.3)};var vA=(t,e)=>{Tu(t,!1,!1,!0,`+${e} Fame`,It.fame,5.5,eo,1.5)},Tu=(t,e=!1,n=!1,i=!1,s,o,r,a,l)=>{let c=xR();st(c.pos,t),c.pos[1]+=r||0,c.side=Math.sin(Pu.length*2.3),c.flat=e,c.crit=n,c.float=i,c.timer.reset(a,l),Y(c.screenPos,0,0,0),di(c.screenOffset,0,0,0),c.scale=0,c.alpha=0,c.img=eu(s,o),c.width=c.img.width,c.height=c.img.height,Pu.push(c)},p2=[],xR=()=>p2.length?p2.pop():{pos:[0,0,0],flat:!0,crit:!0,float:!0,yoffset:0,timer:new kt(0,1),screenPos:[0,0,0],screenOffset:[0,0],scale:0,alpha:0,img:void 0,width:0,height:0},wR=t=>{p2.push(t)};var h2=oe.itemTypeFilter.toLowerCase().replace(/\s/g,"").split(","),gc=new Set,MR=(t,e,n)=>{for(let i=n.length-1;i>=0;i--){let s=n[i];(s==e||Kn(e.pos,s.pos)<5**2)&&(t.push(s),Ln(t.pos,t.pos,s.pos),n.splice(i,1))}},_A=(t,e)=>{st(t.hudPos,t.visualPosition||t.pos),va(t.hudPos,t.hudPos)&&t.hudPos[2]<.997&&e.push(t)},bA=t=>{let e=[];D.entities.array.forEach(s=>{s.type!==3||!s.visual.transform.visible||s.quality<oe.itemQualityFilter||h2.includes(s.droptype)||_A(s,e)}),gc.forEach(s=>{s.uiTimeout<D.time?gc.delete(s):_A(s,e)}),e=e.sort((s,o)=>o.id-s.id);let n=new Set;for(;e.length;){let s=e[0],o=[];o.pos=[0,0,0],MR(o,s,e),hn(o.pos,o.pos,1/o.length),Y(o.pos,Math.round(o.pos[0]),Math.round(o.pos[1]),Math.round(o.pos[2])),va(o.pos,o.pos)?n.add(o.sort((r,a)=>r.hudPos[2]-a.hudPos[2])):n.delete(o)}let i=0;Array.from(n).sort((s,o)=>o.pos[2]-s.pos[2]).forEach(s=>{let o=s.length/5*100,r=0,a=0;s.forEach((l,c)=>{l.hudTextImg||(l.hudTextImg=eu(l.name,It[l.color]));let f=l.hudTextImg.width,u=Math.round(s.pos[0]+a-o*.5)-2,p=Math.round(s.pos[1]-r*20)-8;if(l.uiTimeout===0){let g=l.canBePickedUpBy(D.player),v=l.partyTimeoutCheck(D.player);g&&!(Rl[0]>u+f||Rl[1]>p+20||Rl[0]<u||Rl[1]<p)?(i=l.id,Ci.globalAlpha=1):Ci.globalAlpha=g?.4:.1,Ci.fillStyle="#000000",Ci.beginPath(),Ci.rect(u,p,f,20),Ci.fill(),lr(di(Rn,u+2,p+8),l.name,v?It[l.color]:It.itemgrey,g?1:.8,1,0,0,0)}a+=f+3,a>o&&(r++,a=0)})}),i!==_n&&Qf(i)};var Yn=[],yA,kA,Oi=2,xA=()=>{let n=Math.ceil(100),i=Math.max(7,Math.ceil(9*1)),s=Math.max(1,Math.ceil(Oi*1)),o=n-Oi*2,r=i-Oi*2;Yn.push(Ti(null,Dt("panel"),n,i,0,0,s)),Ti(Yn[0],Dt("grey"),o,r,Oi,Oi,1),Yn.push(Ti(null,Dt("health"),o,r,0,0,1)),Yn.push(Ti(null,"#ffbc00",o,r,0,0,1)),Yn.push(Ti(null,Dt("enemy"),o,r,0,0,1)),Yn.push(Ti(null,Dt("party"),o,r,0,0,1)),Yn.push(Ti(null,Dt("pvp"),o,r,0,0,1)),Yn.push(Ti(null,"#555555",o,r,0,0,1)),Yn.push(Ti(null,Dt("spell"),o,r,0,0,1));for(let a=0;a<=3;++a)Yn.push(Ti(null,Dt("c"+a),o,r,0,0,1));yA=Ti(null,"#ffffff",100+Oi*2,9+Oi*2,0,0,3),kA=Ti(null,"#ffffff",100+Oi*2,16+Oi*2,0,0,3)},FR=()=>{let t=[];return D.entities.array.forEach((e,n)=>{!e.visual||!e.visual.transform.visible||e.stats&&!e.stats.alive||e.id!==Vn&&e.visual.cDist&&e.visual.cDist>60||e.type===3&&e.id!==_n||(st(e.hudPos,e.visualPosition||e.pos),e.type!==3&&(e.hudPos[1]+=e.visual.getTopAbsolute(),e.mount!==void 0&&(e.hudPos[1]+=1)),va(e.hudPos,e.hudPos)&&(e.id===D.playerId&&(e.hudPos[0]=Math.round(.5*En.width),e.hudPos[1]=Math.round(.5*En.height)),t.push(e)))}),t.sort((e,n)=>n.hudPos[2]-e.hudPos[2])},CR=(t,e,n)=>e?4:n===0?oe.classColorBars&&t.type===0?8+t.class:1:D.player.canCombatInteract(t)?n===2?oe.classColorBars?8+t.class:5:t.type===1&&t.aggroMode===0?2:3:6,SR=(t,e)=>{let n=t.visual&&t.visual.cDist;if(n>oe.nameplateViewRange)return;n?n/=70:n=0;let i=t.party>0&&t.party===D.player.party,s=t.faction!==void 0?D.player.hostility(t):0,o=D.player.clan,r=D.player.level,a=t.id===Vn,l=t.id===D.playerId,c=t.id===_n;if(t.type!==3&&t.stats&&t.stats.alive){t.namePlateScale=vt(t.namePlateScale+((a?1:0)-t.namePlateScale)*.25,.5,1);let p=a?1:Math.max(.1,Math.min(1,1-n))*.7,g=a||i?1:Math.min(.8,c?.9:p*.75+.2),v=t.skills.timedSkill!==void 0;!l&&a&&ar(v?kA:yA,t.hudPos,1,t.namePlateScale,1,v?2:1,0,v?4:0);let _=a||s===0&&oe.nameplateShowFriendlyPlayers||s===1&&oe.nameplateShowMonsters||s===2&&oe.nameplateShowEnemyPlayers;if(v&&_){let b=Yn[0].height-Oi,y=vt(t.skills.timedCast.fraction(D.smoothtime),0,1);ar(Yn[0],t.hudPos,g,t.namePlateScale,1,1,0,b),y>0&&ar(Yn[7],t.hudPos,g,t.namePlateScale,y,1,0,b)}if(!l&&_&&(ar(Yn[0],t.hudPos,g,t.namePlateScale,1,v?2:1),ar(Yn[CR(t,i,s)],t.hudPos,g,t.namePlateScale,t.stats.getResource(6)/t.stats.getStat(6),1),t.clan&&lr(di(Rn,t.hudPos[0]-(Yn[0].width/2+Oi)*t.namePlateScale,t.hudPos[1]),t.clan,t.clan==o?It.clan:t.faction===0?It.faction0small:It.faction1small,g,1,2,0,1),t.level&&(oe.alwaysShowLevel||a))){let b=It.lev1;s!==0&&(t.level-r>4?b=It.lev3:t.level-r>1?b=It.lev2:t.level-r<-5&&(b=It.lev0)),lr(di(Rn,t.hudPos[0]+(Yn[0].width/2+Oi)*t.namePlateScale,t.hudPos[1]),t.level,b,g,1,0,0,0)}}let f,u=!1;if(t.type===3?(f=t.partyTimeoutCheck(D.player)?It[t.color]:It.itemgrey,u=!0):s===0?(f=a?It.name:It.nameSmall,u=oe.nameShowFriendlyPlayers):s===1?(f=a?It.enemy:It.enemySmall,u=oe.nameShowMonsters):s===2&&(f=a?It.pvp:It.pvpSmall,u=oe.nameShowEnemyPlayers),a||u){let p=t.type===3&&c&&!t.canBePickedUpBy(D.player)?.5:a||t.type===3?1:c?.9:Math.max(.1,Math.min(1,1-n))*.7,g=a?-16:-9,v=l&&t.clan?t.clan.length*5:0,_=lr(t.hudPos,t.name,f,p,1,v,g);t.clan&&l&&lr(di(Rn,t.hudPos[0]-_/2+Oi,t.hudPos[1]),t.clan,t.faction===0?a?It.faction0:It.faction0small:a?It.faction1:It.faction1small,p,1,t.clan.length*5,g,1)}t.speechText&&lr(t.hudPos,t.speechText,t.speechStyle,1,1,0,a?-30:-20,.5,1)},wA=t=>{gc.clear();let e=FR();ng(e),e=e.sort((n,i)=>n.id===Vn||n.id===_n?1:i.id===Vn||i.id===_n?-1:i.hudPos[2]-n.hudPos[2]),ei(go,0,0,0,0),e.forEach(SR)};var AR=()=>{hM(),xA()},PR=t=>{Ci.clearRect(0,0,En.width,En.height),tt.shift.down?bA(t):wA(t),dA(t)};var v2={};Xn(v2,{onWorldEnter:()=>TR});var TR=()=>{xt("petlootsettings",h2.join(",")+" "+oe.itemQualityFilter)};var _2={};Xn(_2,{init:()=>ER});var ER=()=>{Bn(Ft.serverWarUpdate.header,t=>{let e=Ft.serverWarUpdate.decode(t);zs.update(n=>(n===void 0||e.contributors.length===0&&(e.contributors=n.contributors),e))})};var vc=[g2,ig,xg,jg,s2,C1,Oh,L1,Hh,v2,gg,gm,_2],b2=!1,MA=()=>{vc.forEach(t=>{t.init&&t.init()})},FA=t=>{vc.forEach(e=>{e.preTick&&e.preTick(t)})},CA=t=>{vc.forEach(e=>{e.tick&&e.tick(t)})},SA=(t,e)=>{vc.forEach(n=>{n.postTick&&n.postTick(t,e)})},AA=t=>{vc.forEach(e=>{e.onWorldEnter&&e.onWorldEnter(t)}),b2=!0},PA=t=>{b2&&vc.forEach(e=>{e.onWorldDestroy&&e.onWorldDestroy(t)}),b2=!1};var EA=async t=>{let n=await(await fetch("api/user/join",{method:"POST",body:JSON.stringify({id:t})})).json();if(n.world)qr.set(n.world),Gc.set(t);else throw qr.set(void 0),Gc.set(void 0),n.result||"Unknown Error";return!0};var DA=0,l0=!1,IA=new kt(0,2e4),VA=2,LA=t=>{IA.done(t)&&(t>1e5&&!l0&&t-DA>60*1e3*3?(l0=!0,DA=t,Ar.set(VA),VA++):l0&&(l0=!1,Ar.set(0)),IA.reset(t))};var y2={arena3v3:{port:5006},arena5v5:{port:5007},main:{port:5009},dev2:{port:5010},dev_default:{port:5010},dev_pathfind:{port:5011},arena_big_swamp:{port:5012},arena_cage:{port:5013},arena_cove:{port:5014},arena_lava:{port:5015},arena_ruins:{port:5016},arena_small_swamp:{port:5017}};var k2=t=>{y2[oe.activeWorld]===void 0?window.location.href="/":(console.log("Connecting to "+oe.activeWorld),t&&xi.set("Connecting"),vy(y2[oe.activeWorld].port))},qA=t=>{D.load(t.world,t.file,t.playerId),D.setTimeFromTickId(t.tickId),Eu=0},Eu=0,RA=async t=>{if(t===4002)xi.set("Connecting"),D.destroy();else try{if(Eu<10?xi.set("Connecting"):xi.set(`Connecting (${t})`),t===1006&&(Eu++,Eu>=20)||t>=4008)throw!0;D.destroy();let e=Eu>1?h1(500,1e3):h1(1200,1600);for(await new Promise(n=>setTimeout(n,e));document.visibilityState==="hidden";)xi.set("Browser is idle"),await new Promise(n=>setTimeout(n,e));await EA(oe.lastConnectedChar)}catch{return window.location.href="/",!1}k2(!1)},BA=(t,e)=>{fy(e),ZS(t,e,D.state<=2),LA(e),D&&D.player?(c3(t),FA(t),D.tick(t),CA(t),uA(t,D),SA(t,D)):D&&D.tick(t)};var c0=class{constructor(){this.nodes=new Map,this.width=-0,this.height=-0,this.depth=-0,this.yd=-0,this.zd=-0,this.xm=-0,this.ym=-0,this.zm=-0,this.xs=-0,this.ys=-0,this.zs=-0,this.dirty=!1}setDimensions(e,n,i,s,o,r){this.clear(),this.dirty=!0;let a=Math.floor(e/s),l=Math.floor(n/o),c=Math.floor(i/r);this.width=e,this.height=n,this.depth=i,this.yd=l,this.zd=c,this.xm=a-1,this.ym=l-1,this.zm=c-1,this.xs=e/a,this.ys=n/l,this.zs=i/c}clear(){this.nodes.clear()}add(e,n){let i=Math.max(0,Math.min(this.xm,~~(n[0]/this.xs))),s=Math.max(0,Math.min(this.ym,~~(n[1]/this.ys))),o=Math.max(0,Math.min(this.zm,~~(n[2]/this.zs))),r=Math.max(0,Math.min(this.xm,~~(n[3]/this.xs))),a=Math.max(0,Math.min(this.ym,~~(n[4]/this.ys))),l=Math.max(0,Math.min(this.zm,~~(n[5]/this.zs)));for(let c=i;c<=r;++c)for(let f=s;f<=a;++f)for(let u=o;u<=l;++u){let p=c*this.yd*this.zd+f*this.zd+u;this.nodes.has(p)||this.nodes.set(p,{aabbs:[],content:[],count:0});let g=this.nodes.get(p);g.content.push(e),g.aabbs.push(n),g.count++}}queryAABB(e){let n=Math.max(0,Math.min(this.xm,~~(e[0]/this.xs))),i=Math.max(0,Math.min(this.ym,~~(e[1]/this.ys))),s=Math.max(0,Math.min(this.zm,~~(e[2]/this.zs))),o=Math.max(0,Math.min(this.xm,~~(e[3]/this.xs))),r=Math.max(0,Math.min(this.ym,~~(e[4]/this.ys))),a=Math.max(0,Math.min(this.zm,~~(e[5]/this.zs))),l=[];for(let c=n;c<=o;++c)for(let f=i;f<=r;++f)for(let u=s;u<=a;++u){let p=c*this.yd*this.zd+f*this.zd+u;if(this.nodes.has(p)){let g=this.nodes.get(p);for(let v=0;v<g.count;++v){let _=g.content[v];E8(g.aabbs[v],e)&&!l.includes(_)&&l.push(_)}}}return l}queryRay(e,n,i){let s=e[0]+n[0],o=e[1]+n[1],r=e[2]+n[2],a=Math.max(0,Math.min(this.xm,~~(Math.min(e[0],s)/this.xs))),l=Math.max(0,Math.min(this.ym,~~(Math.min(e[1],o)/this.ys))),c=Math.max(0,Math.min(this.zm,~~(Math.min(e[2],r)/this.zs))),f=Math.max(0,Math.min(this.xm,~~(Math.max(e[0],s)/this.xs))),u=Math.max(0,Math.min(this.ym,~~(Math.max(e[1],o)/this.ys))),p=Math.max(0,Math.min(this.zm,~~(Math.max(e[2],r)/this.zs))),g=[];for(let v=a;v<=f;++v)for(let _=l;_<=u;++_)for(let b=c;b<=p;++b){let y=v*this.yd*this.zd+_*this.zd+b;if(this.nodes.has(y)){let w=this.nodes.get(y);for(let C=0;C<w.count;++C){let A=w.content[C];I8(w.aabbs[C],e,i,0,1)&&!g.includes(A)&&g.push(A)}}}return g}queryNodeContents(e,n,i){e=Math.max(0,Math.min(this.xm,~~(e/this.xs))),n=Math.max(0,Math.min(this.ym,~~(n/this.ys))),i=Math.max(0,Math.min(this.zm,~~(i/this.zs)));let s=e*this.yd*this.zd+n*this.zd+i;return this.nodes.has(s)?this.nodes.get(s).content:[]}};var oi={origin:[0,0,0],dir:[0,-1,0],invDir:[0,0,0]},f0=(t,e,n,i,s,o,r)=>{Y(t.origin,e,n,i),Y(t.dir,s,o,r),bp(t.invDir,t.dir)};var u0=class{constructor(e){this.entity=e,this.buffs=new Map,this.casters=new Map,Kf.forEach(n=>{this[n]=new Set}),this.tags=new Map;for(let n=0;n<13;++n)this.tags.set(n,new Set)}tick(e,n,i){}setBuff(e,n,i,s,o,r){i<=0&&console.error("buff with zero or less stacks");let a=this.buffs.get(e)||this.buffs.set(e,new Map).get(e),l=a.get(n)||{};if(l.caster=n,l.id=e,l.level=r,l.stacks=i,l.logic=ha.get(e),l.timer=new kt(s,o),l.active=!0,l.uniqueInstances=0,l.remove=!1,l.logic.intervalDuration!==void 0){let f=s;l.interval&&(f=l.interval.start);let u=D.entity(n);l.interval=new kt(f,l.logic.intervalHaste&&u!==void 0?l.logic.intervalDuration/mF(u.stats.getStat(16)):l.logic.intervalDuration)}else l.interval=new kt(0,0);return a.set(n,l),l.logic.onSet(l,n,this),(this.casters.get(n)||this.casters.set(n,new Map).get(n)).set(e,l),l.logic.unique&&this.updateUniqueState(e),l}removeBuff(e,n){let i=this.buffs.get(e);if(i){let s=i.get(n);if(s){s.logic.onRemove(s,n,this),i.delete(n),i.size===0&&this.buffs.delete(e);let o=this.casters.get(n);return o.delete(e),o.size===0&&this.casters.delete(n),s.logic.unique&&this.updateUniqueState(e),s}}}updateUniqueState(e){let n=this.buffs.get(e);if(n){let i;n.forEach((s,o)=>{(!i||s.level>i.level)&&(i=s),s.active=!1,s.uniqueInstances=n.size}),i.active=!0}}clear(e,n=!1){this.buffs.forEach((i,s)=>{i.forEach((o,r)=>{(!n||r!==this.entity.id)&&o.logic.passive==e&&o.logic.clearOnDeath&&this.removeBuff(s,r)})})}clearTempBuffs(){this.clear(!1)}clearPassiveBuffs(){this.clear(!0)}onDeath(){this.clearTempBuffs()}hasAnyWithTag(e){return this.tags.get(e).size>0}};var ji=[5,4,0,2,3,8,9],Wi=(t,e,n,i)=>{let s=t.entity.mount!==void 0;t.walking=!s&&t.walking,LR(t,s),qR(t,s),VR(t,s),IR(t,e,n,i,s),DR(t,e,n,i,s)},DR=(t,e,n,i)=>{if(t.body[0].visible&&t.entity.buffs.visualIncapacitate>0){Jn(t.body[0].rotation,(Math.sin(n*2.2)+Math.sin(n*2.1)*.3)*.3+1,(Math.sin(n*2.1)+Math.sin(n*2)*.6)*.3,(Math.sin(n*.8)+Math.sin(n*2.3)*.5)*.3);for(let s=2;s<=3;++s)t.body[s].position[1]-=.2}},IR=(t,e,n,i,s)=>{let o=t.body[2];if(o.visible&&(t.body[6]!==void 0&&(t.sheathed||(s?Ni(t,!0):t.entity.target&&!t.walking&&!t.falling?(o.rotation[0]+=1,o.rotation[2]+=.6,o.position[2]-=.3,o.position[1]-=.2,o.position[0]-=.1,t.body[4].position[0]-=.05,t.body[5].position[0]+=.05,t.body[4].position[2]-=.2,t.body[0].position[1]+=-.05+Math.sin(n*3)*.05,t.body[0].rotation[1]-=Math.cos(n*3)*.05):(o.rotation[0]+=.5,o.position[1]-=.2,o.position[0]-=.1))),t.currentAnim&&t.currentAnim.info.movement!==13)){let a=Qt.easeInOutCubic(t.currentAnim.fract),l=-Math.sin(a*7.5-1.5),c=-Math.sin(a*6.28),f=-Math.sin(a*3.14),u=Qt.easeOutExpo(-f);switch(hn(o.rotation,o.rotation,1-u),t.currentAnim.info.movement){case 0:if(t.body[6]!==void 0)Ni(t,!1),Jn(o.rotation,f*1.7,u*1.5,l*u+u*.5),o.position[2]-=f-a*u,o.position[1]+=Math.sin(a*13+3)*u*.5,o.position[0]+=(-.5+a*1.5)*u,t.body[0].rotation[1]+=c*1.5;else{let p=Math.cos(a*6.28);t.body[0].position[2]+=(.3+Math.sin(a*6.28-3.14)*.2)*u,t.body[0].rotation[0]+=Math.sin(a*3.28)*.5*u;for(let g=0;g<=1;++g){let v=t.body[2+g];v.visible&&(hn(v.position,v.position,1-u),v.position[2]+=(1-p*.5)*u,v.position[1]+=Math.sin(a*6.28)*(a>.5?.7:1),v.position[0]+=(g?.5+f*.2:-.5-f*.2)*u,Y(v.rotation,0,1.5,0))}}break;case 1:Ni(t,!1),o.rotation[0]-=f*1.7,o.rotation[1]+=u*1.5-u,o.rotation[2]+=l*u+u*.5,o.position[2]+=u,o.position[0]-=u*.5,t.body[0].rotation[1]-=c*1.5-u*.5;break;case 12:Ni(t,!1),o.rotation[0]=1.7,o.rotation[1]=0,o.rotation[2]=.5,o.position[2]=1.3,o.position[1]=.2,o.position[0]=-.5;break;case 4:Ni(t,!1),o.rotation[0]+=f*1.7,o.rotation[1]-=f*1.5,o.position[0]-=u*.5,t.body[0].rotation[1]=a*2*Math.PI+u*3;break;case 3:{Ni(t,!0),Y(t.body[0].rotation,f,0,0),Y(o.position,-.3,0,.7);break}case 11:{Ni(t,!1),Y(t.body[0].rotation,f*.4,0,f*.3),o.rotation[0]-=f*.8,o.rotation[1]+=f*.4;break}case 9:{Ni(t,!1),Y(o.rotation,0,0,0);break}case 5:{Ni(t,!0);break}}}let r=t.body[3];t.body[7]!==void 0&&r.visible&&(t.entity.target&&!t.walking&&!t.falling?(r.rotation[2]-=.2,r.rotation[1]-=1,r.position[1]+=.1,r.position[2]+=.4):(r.rotation[2]-=.1,r.position[1]+=.1))},VR=(t,e)=>{for(let n=0;n<=1;++n){let i=t.body[4+n];if(i.visible)if(e)Y(i.rotation,-.9,n?.2:-.2,n?.4:-.4),Y(i.position,n?.6:-.6,-.4,.5);else{let s=oa(t.entity.steer);if(t.currentAnim&&t.currentAnim.info.movement===10){Y(i.position,0,0,0);continue}if(t.falling)if(t.flip==0){let o=Math.max(-1,Math.min(0,t.entity.vel[1]*.2))*.1,r=n?t.cycle(0)*.3-o:t.cycle(.5)*.3+o;Y(bt,n?.3-o:-.3+o,-.65,r),Ir(i.position,bt,0),Y(i.rotation,-r,s,0)}else Y(i.position,n?.3:-.3,-.3,0),Y(i.rotation,0,0,0);else if(t.entity.inWater>t.entity.radius)t.walking?(Y(i.rotation,1.3,n?.1:-.1,0),Y(i.position,n?.3:-.3,Math.cos(t.cycleRad+n*Math.PI)*.4,-1.1)):(Y(i.rotation,1,n?.1:-.1,0),Y(i.position,n?.3:-.3,-.7,Math.cos(t.cycleRad+n*Math.PI)*.4));else{if(t.walking){let o=t.entity.steer[1]<0?.4:.6,r=t.cycle(0)*o*1.3;Y(bt,n?.3:-.3,Math.max(0,Math.cos(t.cycleRad+(n?0:Math.PI))*.6)-.55,t.cycle(n?0:.5)*o),Ir(i.position,bt,s),Y(i.rotation,n?-r:r,s,0)}else Y(i.rotation,0,n?.1:-.1,0),Y(i.position,n?.45:-.45,-.65,0);t.currentAnim&&!t.walking&&(t.currentAnim.info.movement==5||t.currentAnim.info.movement==13||t.currentAnim.info.movement==6||t.currentAnim.info.movement==9)&&Y(i.position,n?.4:-.55,-.65,n?.2:-.3)}}}},LR=(t,e)=>{let n=t.body[0],i=n.position,s=n.rotation;if(n.visible){if(!t.falling||e?(t.walking?t.entity.inWater>t.entity.radius?Y(i,0,-.1,0):Y(i,0,Math.cos(t.cycleRad*2)*.1+.4,0):t.entity.inWater>t.entity.radius?Y(i,0,.3,0):Y(i,0,e?.5:t.cycle(0)*.1+.4,0),t.transform.rotation[0]!==0&&(t.transform.rotation[0]=0)):(t.transform.rotation[0]=t.cycleRad*t.flip,Y(i,0,t.flip!=0?.3:.5,0)),t.entity.inWater>t.entity.radius)t.walking?Y(s,1.2,0,Math.sin(t.cycleRad)*.1):Y(s,Math.sin(t.cycleRad)*.1-.1,0,Math.cos(t.cycleRad)*.05);else{Y(s,-t.pushBack[1]*5+t.movementPushback[2],0,t.pushBack[0]*5-t.movementPushback[0]),Im(i,i,t.pushBackOffset),sn(i,i,t.movementPushback,1);let o=-t.movementPushback[1]*.5;Y(n.scale,1+o,1-o,1+o)}if(t.currentAnim!==void 0){let o=t.currentAnim.info.movement;if((o==5||o==6)&&(s[1]-=.3+.05*t.cycle(.2),s[0]+=.3+.02*t.cycle(.4),i[1]-=.1+.05*t.cycle(.6),i[0]-=.05),o==6)s[1]*=1-t.currentAnim.fract;else if(o==10)Y(i,0,.2+Math.sin(t.currentAnim.fract*Math.PI)*.5,0),s[0]+=t.currentAnim.fract*sa,s[1]+=oa(t.entity.steer);else if(o==9){let r=Qt.easeOutQuad(vt(t.currentAnim.fract*2,0,1));i[1]+=Math.sin(3+r*5)*.2,s[0]+=.5-r*.5}else o==12?s[1]=t.currentAnim.fract*Math.PI*2:o==13&&(i[2]-=.2+t.cycle(.4)*.05,s[0]=-.2+t.cycle(.8)*.12,s[1]=-.2,s[2]=.2+t.cycle(.15)*.05)}}},qR=(t,e)=>{for(let n=0;n<=1;++n){let i=t.body[2+n];if(i.visible){if(!t.falling||e)if(t.entity.inWater>t.entity.radius)if(t.walking){let s=t.cycle(0),o=t.entity.steer[1]<0?.3:.5,r=Math.sin(t.cycleRad*2+5);Y(i.rotation,0,s*o*1.3+(n?Math.PI:0),0),Y(i.position,(n?.7:-.7)+r*(n?-.2:.2),.2+s*o*(n?-1.5:1.5),-.2+s*(n?-.3:.3))}else{let s=Math.cos(t.cycleRad+n*2);Y(i.rotation,0,(n?-.43+Math.PI:.43)+s*.15*(n?1:-1),.3),Y(i.position,n?.7:-.7,s*.05-.2,.6-s*.2)}else if(t.walking){let s=t.cycle(0),o=t.entity.steer[1]<0?.3:.5,r=Math.sin(t.cycleRad*2+5);Y(i.rotation,0,s*o*1.3+(n?Math.PI:0),0),Y(i.position,(n?.7:-.7)+r*(n?-.2:.2),-.2+s*(n?.3:-.3),.2+s*o*(n?-1.5:1.5)),i.position[0]=n?Math.max(.5,i.position[0]):Math.min(-.5,i.position[0])}else if(e)Y(i.rotation,0,n?-1.3+Math.PI:1.3,.3),Y(i.position,n?.3:-.3,-.5,.7);else{let s=t.cycle(0);Y(i.rotation,0,(n?-.43+Math.PI:.43)+s*.15*(n?1:-1),.3),Y(i.position,n?.7:-.7,-.3+s*.08,.15-s*.1)}else Y(i.position,n?.6:-.6,-vt(t.entity.vel[1],-5,5)/20,0),i.position[0]+=(n?1:-1)*Math.sin(i.position[1]*3.1+.8)*.3,Y(i.rotation,0,n?Math.PI:0,-.3-i.position[1]);if(t.currentAnim){let s=t.currentAnim.info.movement;if(s==5||s==6)n==0?(i.position[0]-=.2,i.position[1]-=.2,s==6&&(hn(i.position,i.position,1-t.currentAnim.fract),i.position[0]+=-t.currentAnim.fract*.3,i.position[2]+=Math.sin(Math.min(.5,t.currentAnim.fract)*7+4)*.8+.4)):(i.position[0]-=.4,i.position[2]+=.5-t.cycle(.3)*.2,i.rotation[1]+=.6+t.cycle(.4)*.2,i.rotation[0]-=.8,s==6&&(hn(i.position,i.position,1-t.currentAnim.fract),i.position[0]+=t.currentAnim.fract*.3,i.position[2]+=Math.sin(Math.min(.5,t.currentAnim.fract)*7+4)*.7+.3));else if(s===9){let o=Qt.easeInOutCubic(vt(t.currentAnim.fract*2,0,1));Y(i.rotation,1-o,0,0);let r=Math.sin(o*3);n==0?Y(i.position,-.12-r*.35,-.1+o*1.2,.3+r):Y(i.position,.12+r*.35,o*1.2,.3+r)}else if(s===11){let o=Math.sin(Qt.easeInOutCubic(t.currentAnim.fract)*3);i.position[0]+=o*(n?.3:0),i.position[1]=o*(n?-.2:1)-.3,i.position[2]=o*(n?-.3:1)}else s===13&&(i.position[0]=n?.6:0,i.position[1]=n?.7:1,i.position[2]=.8,i.rotation[0]=n?t.cycle(.4)*.2:t.cycle(.2)*.2,i.rotation[1]=n?2:1,i.rotation[2]=n?2:1)}if(t.body[8+n]){let s=t.body[8+n];s.visible&&(Lr(s,i.position,!1,fm),hn(s.rotation,s.rotation,.5),s.rotation[1]-=n?.8:-.8,s.rotation[2]-=n?.5:-.5)}}}},Ni=(t,e)=>{t.sheathed!==e&&(t.sheathed=e,t.body[6]!==void 0&&(Mn(t.body[6],e?t.body[0]:t.body[2]),t.sheathed?st(t.body[6].position,t.skin.sheathedPos):st(t.body[6].position,t.skin.unsheathedPos),t.body[6].matrixNeedsUpdate=!0),t.body[7]!==void 0&&(Mn(t.body[7],e?t.body[0]:t.body[3]),t.sheathed?(Y(t.body[7].position,0,-.2,-.65),Y(t.body[7].rotation,0,-1.57,0)):(Y(t.body[7].position,-.2,0,0),Y(t.body[7].rotation,0,0,0)),t.body[7].matrixNeedsUpdate=!0))};var x2=[5,4,0,2,3],w2=(t,e,n,i)=>{let s=t.body[3];if(s.visible&&(Y(s.rotation,.2,1.7+t.cycleSin*.15,.4),Y(s.position,.1+t.cycleSin*.2,-.3,.9),t.entity.target>0&&(s.position[0]=.2,s.position[1]+=.15,s.position[2]+=.1,s.rotation[0]+=.2,s.rotation[1]=1.8,s.rotation[2]-=.2),t.currentAnim))switch(t.currentAnim.info.movement){case 5:{Ni(t,!1);let o=Qt.easeOutQuad(vt(t.currentAnim.fract*2,0,1));Y(s.rotation,1.2,2,.3),Y(s.position,.2,0,.8+o*.8),Y(t.body[2].position,-.1-Math.sin(o*2)*.6,o*.1,.8-o*.8),Y(t.body[0].position,0,.6-o*.2,0),Y(t.body[0].rotation,.2-o*.2,-.4+o*.3,0);break}case 7:{Ni(t,!1);let o=Qt.easeOutFlick(vt((t.currentAnim.fract-.5)*2,0,1));Y(s.rotation,1.2,2,.3+o*.1),Y(s.position,.2,o*.3,1.6),Y(t.body[2].position,-.7,.1,-o*.7),Y(t.body[0].position,0,.4,0),Y(t.body[0].rotation,0,-.1,0);break}case 8:{Ni(t,!1);let o=Qt.easeOutQuad(vt(t.currentAnim.fract*2,0,1));Y(t.body[2].position,-.5-o*.3,-.3+o*.3,Math.sin(o*6.28)*.6),Y(s.rotation,.2+.5*o,2,.3),Y(s.position,.2,-.4+o*.3,.8+o*.8),t.body[0].rotation[1]=0,t.body[0].rotation[0]=-.2+o*.2}break}!t.walking&&t.body[4].visible&&(t.body[4].position[2]-=.3,t.body[5].position[2]+=.1)};var zA=[2],$A=(t,e,n,i)=>{let s=t.body[2];Jn(s.rotation,.9,-.4,0),s.position[2]-=.1};var UA=[0,16,17],OA=(t,e,n,i)=>{let s=t.cycle(.5);if(Y(t.body[0].scale,s*.1+1,1+t.cycleSin*.1,s*.1+1),Y(t.body[0].position,0,-.2+t.cycleSin*.1,0),Y(t.body[0].rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5),Im(t.body[0].position,t.body[0].position,t.pushBackOffset),t.currentAnim){let o=Qt.easeOutExpo(t.currentAnim.fract**3);switch(t.currentAnim.info.movement){case 0:t.body[0].position[2]+=Math.sin(o*6.28-3.14);break}}for(let o=0;o<2;++o){let r=t.body[16+o];if(r.visible=t.transform.visible,!r.visible)continue;for(let c=0;c<r.children.length;++c)r.children[c].visible=!0;let a=o==0?t.transform:t.body[16+o-1];Xt(bt,a.position,r.position),Y(Zr,0,0,-a.scale[0]*.7),Ir(bn,Zr,a.rotation[1]),Ln(bt,bt,bn);let l=pi(bt);l>30*t.entity.size?st(r.position,t.entity.pos):sn(r.position,r.position,bt,Math.max(0,Math.min(.5,20*e*(l-r.scale[1]*.7)))),Y(r.rotation,0,Em(Xt(bt,a.position,r.position)),0),mi(r.scale,(3-o)*.3*(.8+t.cycle(o*.3)*.1)*t.transform.scale[0]),r.position[1]=Math.max(t.entity.pos[1]+r.scale[1]*.5,r.position[1]-e*2.5),qt(r,!1)}};var NA=[2,3],jA=(t,e,n,i)=>{if(!t.currentAnim)for(let s=0;s<2;++s){let o=t.body[2+s];if(!o.visible)continue;let r=t.cycle(1.3);Y(o.rotation,.78,0,s?r*.2:-r*.2),Y(o.position,s?.2:-.2,-.4,.6)}};var WA=[0,4,5],GA=(t,e,n,i)=>{let s=t.body[0],o=t.body[4],r=t.body[5];if(t.walking&&!t.falling){t.speed=t.entity.speed*(t.entity.steer[1]===-1?-1.2:1)*.04/(.6+t.entity.size*.6);let a=Math.cos(t.cycleRad);Y(o.rotation,0,t.cycleSin*.2,t.cycleSin*.2),Y(o.position,0,Math.abs(a)*.3+.2,0),Y(r.rotation,0,Math.PI+a*.2,a*.2),Y(r.position,0,Math.abs(t.cycleSin)*.3,0),Y(s.position,t.cycle(.3)*.01,t.cycleSin*.02,0),Y(s.rotation,0,t.cycleSin*.01,Math.sin(t.cycleRad*2)*.01),t.entity.target>0&&Math.random()<.3&&t.fraction(.1,e)&&t.playSound(t.stepset[0],!1)}else{if(t.speed=.5,t.currentAnim){let a=Qt.easeOutExpo(t.currentAnim.fract**3);switch(t.currentAnim.info.movement){case 0:{let l=Math.sin(a*6.28-3.14);Y(s.position,0,Math.max(0,-l),l*.5);for(let c=0;c<2;++c){let f=c==0?o:r,u=c==0?1:-1,p=c==1?Math.PI:0;Y(f.rotation,u*Math.min(l,0),p+l*.1*u,0),Y(f.position,0,Math.max(0,-l),l*.5)}break}}}else{let a=t.cycle(-.1)*.05;Y(s.position,0,t.cycle(-.1)*.1,0);for(let l=0;l<2;++l){let c=l==0?o:r;Y(c.rotation,0,l==1?Math.PI:0,t.falling?.4:a*.5),Y(c.position,0,0,0)}}Y(s.rotation,0,0,0)}Jn(s.rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5)};var HA=[],YA=(t,e,n,i)=>{Y(t.transform.rotation,-t.pushBack[1]*2,t.entity.rot,t.pushBack[0]*2)};var XA=[0,2,3,16],QA=(t,e,n,i)=>{let s=t.body[0],o=t.body[2],r=t.body[3],a=25/o.scale[0],l=n+t.entity.id;if(Y(s.rotation,Math.sin(l*a/8)*.15,0,Math.sin(l*a/10)*.07),Jn(s.rotation,-t.pushBack[1]*5,0,t.pushBack[0]*5),Y(s.position,0,1+Math.sin(l*18)*.1,0),t.body[16]!==void 0){let f=t.body[16];f.position[1]=f.data.skin.pos[1]+Math.sin(l*18+2.75)*.1}let c=Math.sin(l*a)*.7;for(let f=0;f<2;++f){let u=f==0,p=u?o:r;p.rotation[2]=p.data.skin.rot[2]+(u?Math.PI-c:c)}if(t.currentAnim&&t.currentAnim.info.movement===0){let f=t.currentAnim.fract,u=Math.sin(Go(f,.2,-.4)*3.14)*1.5;if(s.position[2]+=u,s.rotation[0]+=u*.4,f>.65){let p=Qt.easeOutQuad(ds(f,.65,1,0,1));s.rotation[0]-=p*Math.PI*2,s.position[1]+=Math.sin(p*Math.PI)*1.5}}};var ZA=[0,2,3],JA=(t,e,n,i)=>{for(let s=0;s<2;++s){let o=t.body[2+s];o.position[1]*=.8,o.position[2]*=.8,o.position[1]+=.5;let r=t.body[4+s];r.position[1]-=0,r.position[0]+=s?.4:-.4}Y(t.body[0].scale,1.8,2,1.8),t.body[0].position[1]+=1};var KA=[2],eP=(t,e,n,i)=>{Y(t.body[2].position,-.8,-.2,.7),Y(t.body[2].rotation,1.8+t.cycleSin*.1,0,0)};var tP=[17,0,16,21,2,3,4,5],nP=(t,e,n,i)=>{let s=t.body[4].scale[1];t.currentAnim&&t.currentAnim.info.movement===0?QR(t,s):HR(t,s)},HR=(t,e)=>{let n=ds(t.entity.speed/20/(.2+t.entity.size*.8),3,10,0,1),i=ds(n,0,1,.6,.4),s=ds(n,0,1,.5,.2);t.speedMultiplier=ds(n,0,1,1,.5),YR(t,s,i,e),XR(t,s,i,e)},YR=(t,e,n,i)=>{let s=0,o=0,r=0,a=0,l=0,c=0,f=0,u=ds(e,.2,.5,.5,1);t.walking?(s=Math.sin(t.cycleRad*2-1)*.07,r=Math.sin(t.cycleRad*2)*.07,o=-t.cycle(0)*.1*u,l=Math.sin(t.cycleRad*2+n)*.05,a=-t.cycle(n)*.07*u,c=t.cycle(n+.2)*.3,f=0):(s=t.cycle(.3)*.03,r=t.cycle(.35)*.02,l=t.cycle(0)*.02-.05,c=Math.sin(t.cycleRad*2)*.07,f=t.cycle(.3)*.1);let p=t.body[17];Y(p.position,0,i*.8+s-.15,1.2),Y(p.rotation,.1,f,0);let g=t.body[0];Y(g.position,0,i*.7+r-.15,.5),Y(g.rotation,-.06,o*1.3,o);let v=t.body[16];Y(v.position,0,i*.75+l-.15,-.35),Y(v.rotation,.04,a*1.3,a);let _=t.body[21];Y(_.position,-c*.35,-.18+s*.5,-.67),Y(_.rotation,.6,c,0)},XR=(t,e,n,i)=>{let s=[2,3,4,5];for(let o=0;o<4;++o){let r=s[o],a=t.body[r],l=o%2==0,c=o<2,f=-.75+i*.5,u=c?.8:-.6,p=c?.35:.26,g=t.entity.steer[1]<0?-.5:1;if(t.walking){let v=(l?0:e)+(c?0:n),_=t.cycleScaled(v,g),b=Math.max(0,t.cycleScaled(v-Math.PI,g)*.3);u-=_*.4,Y(a.rotation,_,0,0),Y(a.position,l?-p:p,f+b,u)}else Y(a.rotation,0,l?-.2:.2,0),Y(a.position,l?-p:p,f,u)}},QR=(t,e)=>{let n=t.currentAnim.fract,i=Math.sin(Go(n,.2,-.4)*3.14)*1.5,s=[2,3,4,5];for(let f=0;f<4;++f){let u=s[f],p=t.body[u],g=f%2==0,v=f<2,_=-.75+e*.5,b=(v?.8:-.6)+i*.2,y=v?.35:.26;Y(p.rotation,i*.5,0,0),Y(p.position,g?-y:y,_,b)}let o=t.body[17];Y(o.position,0,.8*e-.15,1.2+i*.4),Y(o.rotation,i*.4,0,Math.sin(i*3)*.5);let r=t.body[0];Y(r.position,0,.7*e-.15,.5+i*.4),Y(r.rotation,-.06,0,0);let a=t.body[16];Y(a.position,0,.75*e-.15,-.35+i*.4),Y(a.rotation,.04,0,0);let l=t.body[21],c=Math.max(i,0);Y(l.position,0,-.18*.5+c*.3,-.67),Y(l.rotation,.6+c,0,0)};var iP=[2,3,4,5],sP=[[-.6,-.5,.5],[.6,-.5,.5],[-.6,-.5,-.5],[.6,-.5,-.5]],oP=[2,3,4,5,0,16,21,17,19,20],rP=(t,e,n,i)=>{let s=t.body[4].scale[1];t.currentAnim&&t.currentAnim.info.movement===0?JR(t,s):KR(t,s)},JR=(t,e)=>{iB(t,e),sB(t,e),oB(t,e)},KR=(t,e)=>{t.speedMultiplier=.8,eB(t,e),tB(t,e),nB(t,e)},eB=(t,e)=>{let n=t.body[0],i=t.body[16],s=t.body[21],o=e-.9+n.scale[1]*.5;if(t.walking){let r=t.cycle(0)*.2;n.position[1]=o+Math.sin(t.cycleRad*2)*.05,i.position[1]=o+Math.sin(t.cycleRad*2+.5)*.05,Y(n.rotation,0,r,0),Y(i.rotation,0,-r,0),s&&(s.position[1]=s.data.skin.pos[1]+o+Math.sin(t.cycleRad*2)*.05)}else n.position[1]=o,i.position[1]=o,Y(n.rotation,0,0,0),Y(i.rotation,0,0,0),s&&(s.position[1]=s.data.skin.pos[1]+o+Math.sin(t.cycleRad)*.05);n.matrixNeedsUpdate=!0,i.matrixNeedsUpdate=!0,ro(n),ro(i)},tB=(t,e)=>{let n=t.walking?.2:.08,i=t.body[17];i!==void 0&&Y(i.rotation,0,t.cycle(.4)*n,0);let s=t.body[19];s!==void 0&&Y(s.rotation,0,t.cycle(.2)*n,0);let o=t.body[20];o!==void 0&&Y(o.rotation,0,t.cycle(t.walking?.1:.9)*n,0)},nB=(t,e)=>{let n=t.walking,i=n?t.cycle(0)*.5:0,s=n?t.cycle(.25)*.5:0,o=n?t.cycle(.75)*.5:0,r=t.entity.steer[1]<0?-.5:1;for(let a=0;a<4;++a){let l=iP[a],c=t.body[l],f=a%2==0,u=a<2,p=t.body[u?0:16],g=sP[a];Mi(c.position,g,p.matrix);let v=0,_=0;f&&u||!u&&!f?(v=s,_=i):(v=o,_=-i),c.position[1]+=Math.max(0,v*.5),c.position[2]+=_*r*.4,c.rotation[0]=-_*r}},iB=(t,e)=>{let n=t.currentAnim.fract,i=Math.sin(Go(n,.2,-.4)*3.14)*1.5,s=t.body[0],o=t.body[16],r=t.body[21],a=e-1+s.scale[1]*.5;Y(s.position,0,a,s.data.skin.pos[2]+i*.4),Y(s.rotation,0,i*.2,0),Y(o.position,0,a,o.data.skin.pos[2]+i*.4),Y(o.rotation,0,-i*.2,0),r!==void 0&&(Y(r.position,0,r.data.skin.pos[1]+a,r.data.skin.pos[2]+i*.4),Y(r.rotation,0,0,0)),s.matrixNeedsUpdate=!0,o.matrixNeedsUpdate=!0,ro(s),ro(o)},sB=(t,e)=>{let n=t.currentAnim.fract,i=Math.sin(Go(n,.2,-.4)*3.14)*1.5,s=t.body[17];s!==void 0&&Y(s.rotation,i*.4,0,Math.sin(i*3)*.5);let o=t.body[19];o!==void 0&&Y(o.rotation,0,i*.5,0);let r=t.body[20];r!==void 0&&Y(r.rotation,0,i*.5,0)},oB=(t,e)=>{let n=t.currentAnim.fract,i=Math.sin(Go(n,.2,-.4)*3.14)*1.5;for(let s=0;s<4;++s){let o=iP[s],r=t.body[o],a=s<2,l=t.body[a?0:16],c=sP[s];Mi(r.position,c,l.matrix),Y(r.rotation,i*.5,0,0)}};var aP=[18,3],lP=(t,e,n,i)=>{Y(t.body[18].rotation,0,0,n*.3),Y(t.body[3].position,.8,-.2,.7),Y(t.body[3].rotation,1.8,0,0)};var p0=[5,4,0,2,3],m0=(t,e,n,i)=>{Jn(t.body[0].rotation,(Math.sin(n*1.8)*Math.cos(n*12)*.3+Math.sin(n*1.4)*.3)*.1-.2,(Math.sin(n*1.3)+Math.sin(n*2.4)*.6)*.15,(Math.sin(n*.2)+Math.sin(n*1.9)*.5)*.2);for(let s=0;s<=1;++s){let o=t.body[2+s];o.visible&&Jn(o.rotation,(Math.sin(n*2)*Math.cos(n*9)+Math.sin(n*1.3))*.2,(Math.sin(n*2-2)*Math.cos(n*7)+Math.sin(n*.8))*.3,0);let r=t.body[4+s];r.visible&&(r.rotation[1]+=Math.sin(n*.2-s)*.3,r.position[0]+=s?.15:-.15)}};var cP=[2],fP=(t,e,n,i)=>{t.body[2].position[2]+=.6,Jn(t.body[2].rotation,-2.1,-4.1,-.2)};var uP=[2,3,0],pP=(t,e,n,i)=>{if(t.currentAnim===void 0||t.currentAnim.info.movement===0)for(let s=0;s<2;++s){let o=t.body[2+s],r=Math.sin(n*4+s);Y(o.position,s?.5:-.5,r*.2,1),Y(o.rotation,0,1.5,-r*.2)}Jn(t.body[0].rotation,(Math.sin(n*1.8)*Math.cos(n*2)*.3+Math.sin(n*1.4)*.3)*.1+.2,(Math.sin(n*1.3)+Math.sin(n*2.4)*.6)*.1,(Math.sin(n*.4)+Math.sin(n*1.9)*.5)*.1)};var mP=[[Wi,w2],[Wi,$A],[OA],[Wi,jA],[GA],[YA],[Wi,JA],[Wi],[],[Wi,eP],[Wi,lP],[Wi,m0],[Wi,w2,m0],[Wi,m0],[Wi,fP],[Wi,pP],[nP],[rP],[QA]],dP=[new Set([...ji,...x2]),new Set([...ji,...zA]),new Set([...UA]),new Set([...ji,...NA]),new Set([...WA]),new Set([...HA]),new Set([...ji,...ZA]),new Set([...ji]),new Set,new Set([...ji,...KA]),new Set([...ji,...aP]),new Set([...ji,...p0]),new Set([...ji,...x2,...p0]),new Set([...ji,...p0]),new Set([...ji,...cP]),new Set([...ji,...uP]),new Set([...tP]),new Set([...oP]),new Set([...XA])];var _c=class{constructor(e){this.transform=on(),this.transform.matrixAutoUpdate=!0,this.soundPrio=e.radius>3?1:0,this.doesYell=e.type!==0,this.entity=e,this.cycleOne=0,this.cycleRad=Zt(0,1),this.cycleSin=0,this.speed=1,this.speedMultiplier=1,this.lastFlags=0,this.deathTimer=new kt(0,0),this.hurtSoundTimer=new kt(0,5),this.pushBack=[0,0],this.pushBackVel=[0,0],this.pushBackOffset=[0,0],this.movementPushback=[0,0,0],this.movementPushbackVel=[0,0,0],this.groundNormal=[0,0,0],this.cDist=1/0,this.cDistLast=1/0,this.inFog=!0,this.animQueue=[],this.currentAnim=void 0,this.eyesBlink=0,this.capeoffset=0,this.walking=!0,this.falling=!1,this.hasDied=!1,this.flip=0,this.hasJustJumped=!1,this.hasJustLanded=!0,this.sheathed=!1,this.interiorlight=[0,0,0,0],this.needsColorUpdate=!1,this.colors=new Set,this.alphas=new Set,this.currentAlpha=0,this.goalAlpha=1,this.body=[],this.meshes=[],this.effects=[],this.skin=void 0,this.soundset=void 0,this.stepset=void 0,this.skeleton=void 0,this.animset=void 0,this.colPrim=void 0,this.colSec=void 0}setSkin(e,n,i){this.skin!==void 0&&(this.removeSkin(),this.cDistLast=0,this.hasDied=!1,this.deathTimer.reset(0,0),this.removeColor(In.death)),this.skin=i1.get(e);let s=e1.get(this.skin.soundset);this.soundset=s.sounds,this.stepset=t1.get(s.steps).steps,this.skeleton=s1.get(this.skin.skeleton),this.animset=mP[this.skin.animset],this.colPrim=n||this.skin.colPrim,this.colSec=i||this.skin.colSec;let o=dP[this.skin.animset];for(let r=0;r<this.skin.body.length;++r){let a=this.skin.body[r],l=a.col;a.colMode===1?l=this.colPrim:a.colMode===2&&(l=this.colSec);let c=this.mesh(a.bid,a.pid,o.has(a.bid),a.mid,a.lod,l,a.ts===1);c&&(st(c.position,a.pos),st(c.scale,a.scl),st(c.rotation,a.rot),c.data.skin=a)}for(let r=0;r<this.skin.effects.length;++r){let a=this.skin.effects[r];this.effects.push(zi(a.id,this.body[a.bid],0,!1))}}removeSkin(){this.clearAnims(),this.clearMeshes(),this.clearEffects()}cycle(e){return e==0?this.cycleSin:Math.sin(this.cycleRad+2*e*Math.PI)}cycleScaled(e,n){return Math.sin(this.cycleRad*Math.sign(n)+2*e*Math.PI)*n}checkCycleReset(){let e=this.falling<<1|(!this.falling&&this.walking)<<2;e!=this.lastFlags&&(this.cycleOne=0,this.lastFlags=e)}addPushBack(e,n,i){this.cDist<50&&(this.pushBackVel[0]-=e*i/this.entity.size,this.pushBackVel[1]-=n*i/this.entity.size)}addRandomPushback(e){this.cDist<50&&(this.pushBackVel[0]-=Zt(-1,1)*e/this.entity.size,this.pushBackVel[1]-=Zt(-1,1)*e/this.entity.size)}tickPushBack(e,n,i){this.cDist<50&&(Xh(this.pushBackVel,this.pushBackVel,this.pushBack,-e*1500/this.entity.size),xf(this.pushBackVel,this.pushBackVel,1-e*30),Xh(this.pushBack,this.pushBack,this.pushBackVel,e),Fy(this.pushBackOffset,this.pushBack,-this.entity.rot)),this.cDist<25&&(sn(this.movementPushback,this.movementPushback,this.movementPushbackVel,e*60),sn(this.movementPushbackVel,this.movementPushbackVel,this.movementPushbackVel,-(e*20)),sn(this.movementPushbackVel,this.movementPushbackVel,this.movementPushback,-(e*10)),this.movementPushbackVel[2]+=this.entity.steer[1]*.01,this.movementPushbackVel[0]-=this.entity.steer[0]*.01)}disableVis(e){for(let n=0,i=e.children.length;n<i;++n){let s=e.children[n];s.visible=!1,this.disableVis(s)}}checkVis(e,n,i){for(let s=0,o=e.children.length;s<o;++s){let r=e.children[s];this.meshes.indexOf(r)<0||(r.visible=r.data.lod*n/this.cDist>i,r.visible?this.checkVis(r,n,i):this.disableVis(r))}}updateVisibility(){let e=this.entity.mount!==void 0?1/0:Math.max(60,Math.min(150,gt.far*.7));return this.cDist=Er(this.transform.position,gt.worldPosition),this.inFog=this.cDist>e,!this.inFog&&(!oe.disableoffscreen||Mh(gt,this.entity.visualPosition,this.transform.scale[1]))?(!this.hasDied&&Math.abs(this.cDistLast-this.cDist)>1&&(this.cDistLast=this.cDist,this.checkVis(this.transform,Math.max(1,this.transform.scale[1]),1.5/(45+e))),this.transform.visible=!0,!0):(this.cDistLast=0,this.transform.visible&&(this.transform.visible=!1,this.meshes.forEach(n=>n.visible=!1),this.clearAnims()),!1)}tick(e,n,i){this.updateVisibility()?(this.needsColorUpdate&&this.colorUpdate(),this.alphaUpdate(e),this.entity.stats===void 0||this.entity.stats.alive?this.entity.buffs.visualFreeze===0&&(this.cycleOne=(this.cycleOne+this.speed*e)%1,this.cycleRad=this.cycleOne*Math.PI*2,this.cycleSin=Math.sin(this.cycleRad),this.tickAnimations(e),this.falling=this.entity.inWater<this.entity.radius&&(this.falling&&!this.entity.onGround||!this.falling&&!this.entity.onGround&&Math.abs(this.entity.vel[1])>6),this.walking=this.entity.steer[0]!=0||this.entity.steer[1]!=0,this.tickVisuals(e,n,i)):this.tickDeath(e,n,i),qt(this.transform,!1)):this.alphaUpdate(100)}tickVisuals(e,n,i){this.checkCycleReset(),this.calculateCycleSpeed(),this.body[1]!==void 0&&this.tickEyes(e,this.body[1]),this.body[10]!==void 0&&this.tickCape(e,this.body[10]),this.tickWalking(e),this.tickLanding();for(let s=0;s<this.animset.length;++s)this.animset[s](this,e,n,i);if(this.skeleton.groundNormal||this.entity.mount&&this.entity.mount.skeleton.groundNormal){let s=Math.min(1,e*10);this.groundNormal[0]+=(this.entity.groundNormal[0]-this.groundNormal[0])*s,this.groundNormal[2]+=(this.entity.groundNormal[2]-this.groundNormal[2])*s,Tm(this.transform.rotation,this.groundNormal)}else this.flip||(this.transform.rotation[0]=this.transform.rotation[2]=0)}tickFixed(e,n,i){this.hasDied||this.tickPushBack(e,n,i)}tickAnimations(e){let n=this.currentAnim=this.animQueue[0];if(n){let i=n.info,s=n.fract;if(this.animQueue.length>1&&i.priority===0?n.fract>.6?n.time+=e*5:n.time=n.info.duration:n.time+=e,n.fract=n.time/i.duration,n.time>i.duration)if(n.loop)n.fract%=1,n.time=0;else{n.fract=1,this.onAnimEnd(n),this.animQueue.shift();return}for(let o=0;o<i.sounds.length;++o){let r=i.sounds[o];r.end>0?n.fract>=r.start&&n.fract<=r.end?n.activeSounds[o]===void 0&&(n.activeSounds[o]=Hs(r.id,this.transform,this.soundPrio,!0,1)):n.activeSounds[o]!==void 0&&(n.activeSounds[o].stop(),n.activeSounds[o]=void 0):n.fract>=r.start&&(s<r.start||r.start===0&&s===0)&&(n.id===4&&r.id===50?Hs(this.soundset[4],this.transform,this.soundPrio,!1,1):Hs(r.id,this.transform,this.soundPrio,!1,1))}for(let o=0;o<i.effects.length;++o){let r=i.effects[o];if(r.type===0&&n.fract>r.start&&s<=r.start){let a,l=!1;if(r.body===99){let c=D.entity(n.dirImpactTarget);c&&c.visual&&(a=on(),wp(a,c.visual.transform,this.transform,c.radius),qt(a,!1),c.visual.addPushBack(this.transform.position[0]-c.visual.transform.position[0],this.transform.position[2]-c.visual.transform.position[2],2)),l=!0}else r.body===101?(a=on(),st(a.position,this.transform.position),st(a.scale,this.transform.scale),st(a.rotation,this.transform.rotation),qt(a,!1),l=!0):a=r.body===100?this.transform:this.body[r.body];if(a===void 0)continue;xs(r.id,a,this.soundPrio,l)}else if(r.type>0)if(n.fract>=r.start&&n.fract<=r.end)if(n.activeEffects[o]===void 0){let a=r.body===100?this.transform:this.body[r.body];a&&(n.activeEffects[o]=r.type===1?zi(r.id,a,this.soundPrio,!1):x8(r.id,a,this.soundPrio,!1))}else{let a=n.activeEffects[o];r.type===1||(a.fractionLast=a.fractionNow,a.fractionNow=Math.min(1,Math.max(0,1-(r.end-n.fract)/(r.end-r.start))))}else n.activeEffects[o]!==void 0&&(n.activeEffects[o].done=!0,n.activeEffects[o]=void 0)}}}tickEyes(e,n){if(n.visible){let i=0;this.eyesBlink>0?i=this.eyesBlink-e:Math.random()<.006?i=.1:i=this.eyesBlink,(this.eyesBlink>0&&i<0||i>0&&this.eyesBlink<0)&&(n.scale[1]=i>0?.1:n.scale[0],n.matrixNeedsUpdate=!0),this.eyesBlink=i}}tickCape(e,n){n.visible&&this.skin.capeswing&&((this.entity.steer[1]>0||this.falling)&&(this.capeoffset+=pi(this.entity.vel)*.5*e),this.capeoffset=Math.max(0,Math.min(2,this.capeoffset*(1-e*3))),Y(n.rotation,this.capeoffset,0,0))}tickLanding(){this.entity.inWater>this.entity.radius||(this.hasJustJumped&&this.entity.onGround&&(this.cDist<20&&this.entity.vel[1]<-4&&(this.soundPrio===1&&this.playSound(56,!0),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.15,this.eyesBlink=.3),this.hasJustLanded=!0,this.hasJustJumped=!1,this.flip=0),this.hasJustLanded&&!this.entity.onGround&&(this.entity.vel[1]>5&&(this.soundPrio===1&&this.playSound(57,!0),Math.random()<.5&&(this.flip=this.entity.steer[1]),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.1,this.eyesBlink=.3),this.hasJustJumped=!0,this.hasJustLanded=!1))}tickWalking(e){if((this.cDist<20||this.transform.scale[1]>2)&&!this.falling){let n=this.transform.scale[1]>2||this.body[0].scale[1]>2,i=this.fraction(.2,e),s=this.fraction(.7,e);if(this.entity.inWater>0){if(this.entity.inWater<this.entity.radius*2)this.walking?this.entity.inWater<this.entity.radius?(i||s)&&(this.playSound(n?55:this.entity.inWater>this.entity.radius/2?127:128,!1),this.watersplash(92)):(i||s)&&(i&&this.playSound(129,!1),this.watersplash(93)):(i||s)&&this.watersplash(93);else if(this.entity.inWater>3&&(i||s)&&Math.random()<.5){let o=this.transform.position;Qs(153,void 0,o[0],o[1],o[2],0,0,0,!1)}}else this.walking&&(n||this.soundPrio===1)&&(i||s)&&this.playSound(n?55:this.stepset[0],!n)}}calculateCycleSpeed(){this.falling?this.speed=1.5:this.walking?this.entity.inWater<this.entity.radius?this.speed=this.entity.speed/20*(this.entity.steer[1]===-1?1.3:1)*.45/(.4+this.entity.size*.6):this.speed=this.entity.speed/20*.2:this.speed=.5,this.speed*=this.speedMultiplier}fraction(e,n,i=this.cycleOne){return i>=e&&i-this.speed*n<e}mesh(e,n,i,s,o,r,a=!1){let l=Zs(s,a,!0,!1);if(l.data.lod=o,YC(l.data.multi,l,"interiorlight",this.interiorlight),l.visible=!1,l.matrixAutoUpdate=i,r!==void 0&&this.changeMeshBaseColor(l,r),l.data.basealpha=1,l.data.alpha[0]=this.currentAlpha,n>=0){if(!this.body[n])return;Mn(l,this.body[n]),l.parent.data.lod=Math.max(o,l.parent.data.lod||1)}else n===-1&&Mn(l,this.transform);return this.meshes.push(l),this.body[e]=l,l}removeMesh(e){let n=this.body[e];n!==void 0&&(ks(n.data.multi,n),this.meshes.splice(this.meshes.indexOf(n),1),this.body[e]=void 0)}clearMeshes(){for(let e=0;e<this.meshes.length;++e){let n=this.meshes[e];ks(n.data.multi,n)}this.meshes.length=0,this.body.length=0}clearEffects(){for(let e=0;e<this.effects.length;++e){let n=this.effects[e];n.done=!0}this.effects.length=0}onRemove(){this.removeSkin(),us(this.transform)}anim(e,n,i){if(this.transform.visible&&this.animQueue.length<=2){let s=Af.get(e),o={id:e,info:s,loop:n,dirImpactTarget:i,activeSounds:[],activeEffects:[],time:0,fract:0};this.animQueue.push(o)}}clearAnims(){for(let e=0;e<this.animQueue.length;++e)this.onAnimEnd(this.animQueue[e]);this.animQueue.length=0}onAnimEnd(e){for(let n=0;n<e.activeEffects.length;++n){let i=e.activeEffects[n];i&&(i.done=!0)}e.activeEffects.length=0;for(let n=0;n<e.activeSounds.length;++n){let i=e.activeSounds[n];i&&i.stop()}e.activeSounds.length=0}playSound(e,n){return e===0||this.inFog?!1:(Hs(e,this.transform,this.soundPrio,!1,n?this.getAudioPitch():1),!0)}onHurt(e){(e>.2||this.hurtSoundTimer.done(D.time))&&this.playSound(this.soundset[1],!0)&&this.hurtSoundTimer.reset(D.time)}onYell(){this.doesYell&&Zt(0,1)<.3&&this.playSound(this.soundset[0],!0)}onAggro(){this.playSound(this.soundset[3],!0)}onDeath(){this.hasDied=!0,this.playSound(this.soundset[2],!0),this.body[1]&&this.removeMesh(1),this.addColor(In.death),this.deathTimer.reset(D.time,3);let e=this.meshes.length;for(;e--;){let n=this.meshes[e];n.data.deathSize=(n.geometry.bounds.initiated?n.geometry.bounds.radius:1)*(n.scale[0]+n.scale[1]+n.scale[2])/3,Mn(n,null),fl(n.position,n.worldMatrix),a_(n.scale,n.worldMatrix),vp(n.quaternion,n.worldMatrix),n.data.deathVel=[Zt(-.5,.5),1,Zt(-.5,.5)],n.matrixAutoUpdate=!0}}tickDeath(e,n,i){this.deathTimer.done(n)?(this.clearMeshes(),this.clearEffects()):this.meshes.forEach(s=>{if(!s.visible||s.data.deathVel===void 0)return;let o=s.data.deathVel,r=s.data.deathSize;sn(s.position,s.position,o,e),hn(o,o,1-e*3);let a=i.getHeight(s.position[0],s.position[2])+r*.5;o[1]<0&&s.position[1]<a?o[1]<-1?(o[1]=Math.abs(o[1])*.7,o[0]+=Zt(-1,1)/r,o[2]+=Zt(-1,1)/r):o[1]=-.5:o[1]-=e*50,Xi(bt,o,[0,1,0]),sn(s.rotation,s.rotation,bt,-e*5),qt(s,!1)})}mountPosition(e){Mi(e,this.skin.mountPos,this.body[this.skin.mountPart].worldMatrix)}getAudioPitch(){return Math.max(.6,Math.min(1,.5/this.entity.radius))}getTopAbsolute(){return this.entity.radius*this.skeleton.height}addColor(e){this.colors.add(e),this.needsColorUpdate=!0}removeColor(e){this.colors.delete(e),this.needsColorUpdate=!0}colorUpdate(){this.needsColorUpdate=!1;for(let e=0;e<this.meshes.length;++e)this.updateMeshColor(this.meshes[e])}changeMeshBaseColor(e,n){e.data.basecolor=n,this.updateMeshColor(e)}updateMeshColor(e){let n=e.data.color;Vr(n,e.data.basecolor),this.colors.forEach(i=>{let s=i[3],o=1-s;n[0]=n[0]*o+i[0]*s,n[1]=n[1]*o+i[1]*s,n[2]=n[2]*o+i[2]*s})}addAlpha(e){this.alphas.add(e),this.updateGoalAlpha()}removeAlpha(e){this.alphas.delete(e),this.updateGoalAlpha()}updateGoalAlpha(){this.goalAlpha=1,this.alphas.forEach(e=>{this.goalAlpha=Math.min(this.goalAlpha,e)})}alphaUpdate(e){if(this.currentAlpha!==this.goalAlpha){Math.abs(this.goalAlpha-this.currentAlpha)<.1?this.currentAlpha=this.goalAlpha:(e=Math.min(e,2),this.currentAlpha<this.goalAlpha?this.currentAlpha=Math.min(this.goalAlpha,this.currentAlpha+e*.5):this.currentAlpha=Math.max(this.goalAlpha,this.currentAlpha-e*.5));for(let n=0;n<this.meshes.length;++n){let i=this.meshes[n];i.data.alpha[0]=i.data.basealpha*this.currentAlpha}}}changeMeshBaseAlpha(e,n){e.data.basealpha=n}setShoulders(e,n=1,i=!1){if(!(this.hasDied||!this.skeleton.shoulders)){if(e===!1){for(let s=8;s<=9;++s)this.removeMesh(s);for(let s=14;s<=15;++s)this.body[s]&&this.removeMesh(s)}else for(let s=0;s<=1;++s)if(!this.body[8+s]){let o=this.mesh(8+s,0,!0,1,.6);Y(o.position,s?.5:-.5,-.4+n*.4,-.05),Y(o.scale,.8*n,.5*n,.5*n),this.changeMeshBaseColor(o,e)}if(i!==!1)for(let s=0;s<=1;++s){this.body[14+s]||this.mesh(14+s,8+s,!1,7,.3);let o=this.body[14+s];Y(o.rotation,0,3.14,0),Y(o.position,s?.2:-.2,0,-.5),Y(o.scale,.35,.55,.2),this.changeMeshBaseColor(o,i)}else for(let s=14;s<=15;++s)this.body[s]&&this.removeMesh(s)}}setCape(e,n){if(!(this.hasDied||!this.skeleton.cape))if(e===!1)this.body[10]!==void 0&&this.removeMesh(10);else{if(this.body[10]===void 0){let i=this.mesh(10,0,!0,8,.7);Y(i.position,0,.2,-.55)}Y(this.body[10].scale,n,n,n),this.changeMeshBaseColor(this.body[10],e)}}setHeadgear(e){this.hasDied||!this.skeleton.helmet||(e===!1?this.body[11]!==void 0&&this.removeMesh(11):(this.body[11]===void 0&&this.mesh(11,0,!1,9,.5),this.changeMeshBaseColor(this.body[11],e)))}setGem(e,n=1){if(!(this.hasDied||!this.skeleton.helmet))if(e===!1)this.body[12]!==void 0&&this.removeMesh(12);else{if(this.body[12]===void 0){let i=this.mesh(12,0,!1,7,.5);Y(i.position,0,.4,.54),Y(i.scale,.3*n,.3*n,.08*n)}this.changeMeshBaseColor(this.body[12],e)}}setCrown(e){this.hasDied||!this.skeleton.helmet||(e===!1?this.body[13]!==void 0&&this.removeMesh(13):(this.body[13]===void 0&&(this.mesh(13,0,!1,10,.8),this.body[13].position[1]=.8),this.changeMeshBaseColor(this.body[13],e)))}watersplash(e){let n=on();st(n.position,this.entity.pos),n.position[1]=this.entity.pos[1]+this.entity.inWater+.05,qt(n),xs(e,n,this.soundPrio,!0)}};var d0=class extends u0{constructor(e){super(e),this.stickEffects=new Map,this.effects=new Set,this.visualFreeze=0,this.visualIncapacitate=0}addEffectBuff(e,n,i){if(n.logic.fx.stick&&(!(n.logic.incapacitated||n.logic.tags.has(4))||this.immuneCC.size<=0)&&!this.stickEffects.has(e)){let s=zi(n.logic.fx.stick,this.entity.visual.transform,this.entity.id===D.playerId||n.caster===D.playerId?1:0,!1);this.stickEffects.set(e,s)}if(!this.effects.has(e))n.logic.fx.visual&&this.entity.visual.skin.id!==n.logic.fx.visual&&this.changeEntityVisual(n.logic.fx.visual),n.logic.fx.mount&&this.changeEntityMount(n.logic.fx.mount(n)),n.logic.fx.color&&this.entity.visual.addColor(n.logic.fx.color),n.logic.fx.alpha&&this.entity.visual.addAlpha(n.logic.fx.alpha),n.logic.fx.anim&&(this.entity.visual.clearAnims(),this.entity.visual.anim(n.logic.fx.anim,!0,0)),this.visualFreeze+=n.visualFreeze,this.visualIncapacitate+=n.visualIncapacitate,this.effects.add(e);else if(i&&this.stickEffects.has(e)){let s=this.stickEffects.get(e);s.loops=0,s.fractionNow=0}n.logic.fx.apply&&i&&xs(n.logic.fx.apply,this.entity.visual.transform,this.entity.id===D.playerId||n.caster===D.playerId?1:0,!1)}removeEffectBuff(e,n,i){if(this.stickEffects.has(e)){let s=this.stickEffects.get(e);this.buffs.has(e)||(s.done=!0,this.stickEffects.delete(e))}this.effects.has(e)&&(n.fx.visual&&this.entity.visual.skin.id===n.fx.visual&&this.changeEntityVisual(),n.fx.mount&&this.changeEntityMount(),n.fx.color&&this.entity.visual.removeColor(n.fx.color),n.fx.alpha&&this.entity.visual.removeAlpha(n.fx.alpha),n.fx.anim&&this.entity.visual.clearAnims(),this.visualFreeze-=i.visualFreeze,this.visualIncapacitate-=i.visualIncapacitate,this.effects.delete(e))}setBuff(e,n,i,s,o,r,a,l){let c=super.setBuff(e,n,i,s,o,r);c.data=l,c.visualFreeze=c.visualIncapacitate=0,this.immuneCC.size===0&&(c.logic.fx.frozen&&c.visualFreeze++,c.logic.fx.incapacitated&&c.visualIncapacitate++),this.entity.buffDisplayDirty=!0,this.entity.visual&&this.addEffectBuff(e,c,a)}removeBuff(e,n){let i=super.removeBuff(e,n);i&&(this.entity.buffDisplayDirty=!0,this.removeEffectBuff(e,i.logic,i),i.logic.fx.endSound!==void 0&&D.player!==void 0&&Hs(i.logic.fx.endSound,this.entity.visual.transform,this.entity.id===D.playerId||n===D.playerId?1:0,0,1))}changeEntityVisual(e){this.entity.remakeTransform(e),this.stickEffects.forEach((n,i)=>{let s=zi(n.info.id,this.entity.visual.transform,n.priority,!1);s.loops=1,n.done=!0,this.stickEffects.set(i,s)})}changeEntityMount(e){this.entity.mount&&(this.entity.mount.onRemove(),this.entity.mount=void 0,this.entity.updateVisualPosition(0,D.time,D,!0)),e&&(this.entity.mount=new _c(this.entity),this.entity.mount.setSkin(e),this.entity.updateTransformScale(),this.entity.updateVisualPosition(0,D.time,D,!0),this.entity.updateTransformRotation(.016),this.entity.updateMountRotation(.016))}};var h0=class{constructor(e){this.id=e.id||0,this.type=e.type,this.pos=[0,0,0],this.vel=[0,0,0],this.rot=0,this.radius=0,this.size=0,this.name=e.name,this.setSize(e.size||1)}async init(e){this.name=e.name||""}preFixed(e,n,i){}tickFixed(e,n,i){}postFixed(e,n,i){}preDelta(e,n,i){}tickDelta(e,n,i){}postDelta(e,n,i){}onRemove(){}setPos(e){this.pos[0]=e[0],this.pos[1]=e[1],this.pos[2]=e[2]}setRot(e){this.rot=Vl(e)}onTarget(e){return!0}setName(e){this.name=e}setSize(e){this.size=e,this.radius=e/2}hSquaredDistanceV3(e){let n=e[0]-this.pos[0],i=e[2]-this.pos[2];return n*n+i*i}distanceV2(e){return wl(Rn,e,Ll(Ws,this.pos)),Ml(Rn)}distanceV3(e){return Xt(bt,e,this.pos),pi(bt)}squaredDistanceV2(e){return wl(Rn,e,Ll(Ws,this.pos)),My(Rn)}squaredDistance(e){return Xt(bt,e,this.pos),$c(bt)}rotationToV2(e){return wl(Rn,e,Ll(Ws,this.pos)),vm(Rn,Rn),oa(Rn)}rotationToV3(e){return Xt(bt,e,this.pos),Zn(bt,bt),Em(bt)}};var kr=class extends h0{constructor(e){super(e),this.hudPos=[0,0,0],this.netDeletion=new kt(0,0)}handleMovementData(e,n){st(this.pos,e.pos),st(this.vel,e.vel)}onRemove(){this.visual&&this.visual.onRemove()}};var g0=class{constructor(e){this.entity=e,this.skills=new Map,this.skillIdsLearned=[],this.skillIdsActive=[],this.timedCast=new kt,this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0,this.gcdEnd=0}add(e,n=0,i=0,s){let o=this.skills.get(e);return o=Object.assign(o||{},{level:s!==void 0?s:o?o.level+1:1,logic:Pt.get(e),cd:new kt(n,i-n),preGcdEnd:0}),this.skills.set(e,o),o}updateSkillsLearned(e){this.skillIdsLearned.length=0,this.skillIdsLearned.push(...e)}remove(e){this.skills.delete(e)}compileActiveSkillIds(){this.skillIdsActive.length=0,this.skills.forEach((e,n)=>{if(!e.logic.engineOnly)for(let i=0;i<e.level;++i)this.skillIdsActive.push(n)})}globalCd(e,n){this.skills.forEach(i=>{!i.logic.auto&&!i.logic.ignoreGcd&&(i.cd.end<e&&(i.cd.start=e),i.cd.end<n&&(i.preGcdEnd=i.cd.end,i.cd.end=n),i.cd.duration=i.cd.end-i.cd.start)}),this.gcdEnd=n}clearGlobalCd(){this.skills.forEach(e=>{!e.logic.auto&&!e.logic.ignoreGcd&&e.cd.end===this.gcdEnd&&(e.cd.end=e.preGcdEnd,e.cd.duration=e.preGcdEnd-e.cd.start)})}startTimedCast(e,n,i,s){this.timedCast.reset(n,s),this.timedSkill=e,this.timedTarget=i,this.entity.steer[0]=0,this.entity.steer[1]=0,this.pvpBoundModifier=Pt.get(e.id).pvpBoundsAdd}interruptTimedCast(e,n){this.timedCast.reset(0,0),this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0,n&&this.clearGlobalCd()}finishTimedCast(e){return this.interruptTimedCast(!1,!1)}onDeath(){this.interruptTimedCast(!0,!1)}clear(){}hasInstantCast(e){return this.entity.buffs.instantCast.size>0&&Array.from(this.entity.buffs.instantCast).some(n=>n.logic.instantCast.has(e))}};var hP=new Map,v0=class extends g0{constructor(e){super(e)}tick(e,n,i){if(this.isPlayer){let s=this.entity.buffs.incapacitated.size>0;this.skills.forEach((o,r)=>{let a=hP.get(r)||hP.set(r,new Map).get(r),l=new Map,c=0;if(s&&!o.logic.ignoreIncapacitated?c=9:(c=o.logic.can(this.entity,o.level,this.entity.target,!0),(c===3||c===4)&&(c=o.logic.can(this.entity,o.level,this.entity.id,!0))),c!==o.status&&(o.status=c,a.get("status")!==c&&l.set("status",c)),o.cd.done(i.smoothtime))o.cd.icondone||(o.cd.icondone=!0,a.get("cd")!==void 0&&l.set("cd",void 0),a.get("remaining")!==void 0&&l.set("remaining",void 0));else{o.cd.icondone=!1;let f=Math.round(100-o.cd.fraction(i.smoothtime)*100),u;o.cd.duration>1.5&&(u=o.cd.remaining(i.smoothtime),u<=3?u=Math.ceil(u*10)/10:u=Math.ceil(u)),a.get("cd")!==f&&l.set("cd",f),a.get("remaining")!==u&&l.set("remaining",u)}l.size>0&&Ro.update(f=>(l.forEach((u,p)=>{a.set(p,u),f[o.logic.id][p]=u}),f))})}if(this.timedSkill&&this.entity.visual){let s=this.timedSkill.fx;if(s){let o=this.entity.visual.animQueue[0],r=this.timedCast.remaining(n);if(s.animCast){let a=Af.get(s.animCast);r-=Math.min(.3,a.duration/2)}r>0?s.animChannel&&(!o||s.animChannel!==o.id)&&(this.entity.visual.clearAnims(),this.entity.visual.anim(s.animChannel,!0,0)):s.animCast&&(!o||s.animCast!==o.id)&&(this.entity.visual.clearAnims(),this.entity.visual.anim(s.animCast,!1,0))}}}add(e,n=0,i=0,s){super.add(e,n,i,s),this.isPlayer&&(this.compileActiveSkillIds(),Ro.update(r=>(r[e]={},r)),this.skills.get(e).logic.id<100&&Bo.update(r=>(r.set(e,s),r)))}remove(e){this.isPlayer&&(this.compileActiveSkillIds(),Ro.update(i=>(i[e]=void 0,i)),this.skills.get(e)&&Bo.update(i=>(i.delete(e),i))),super.remove(e)}updateSkillsLearned(e){super.updateSkillsLearned(e),Rc.update(n=>{n.clear();for(let i=0;i<e.length;++i){let s=e[i];n.has(s)||n.set(s,tu(e,s))}return n})}cd(e,n,i){this.skills.get(e).cd.set(n,i)}clearSkillInfo(){Bo.update(e=>(e.clear(),e)),Rc.update(e=>(e.clear(),e))}startTimedCast(e,n,i,s){super.startTimedCast(e,n,i,s),this.entity.uiFrameDirty=!0}interruptTimedCast(e,n){super.interruptTimedCast(e,n),this.entity.uiFrameDirty=!0,e&&this.entity.visual&&this.entity.visual.clearAnims()}};var _0=class extends Ql{constructor(e){super(e)}setStat(e,n){this.stat.set(e,n),this.entity.statsDirty=!0,e==20?this.entity.setPrestige(n):e==21?this.entity.setElo(n):e==6||e==7?this.entity.uiFrameDirty=!0:e==19&&this.entity.inventory&&this.entity.inventory.setSize(n)}setResource(e,n){super.setResource(e,n),this.entity.uiFrameDirty=!0}die(){super.die(),this.entity.uiFrameDirty=!0,this.entity.visual&&this.entity.visual.onDeath()}respawn(){super.respawn(),this.entity.uiFrameDirty=!0,this.entity.visual&&this.entity.remakeTransform()}refreshCombatTimer(e,n){super.refreshCombatTimer(e,n),this.entity.uiFrameDirty=!0}onCombatEnd(){super.onCombatEnd(),this.entity.uiFrameDirty=!0}};var b0=class extends kr{constructor(e){e.creature&&(e.skin=e.creature.skin,e.name=e.creature.name),super(e),this.creatureId=e.creature?e.creature.id:-1,this.stats=new _0(this),this.buffs=new d0(this),this.skills=new v0(this),this.steer=[0,0],this.speed=1,this.static=!1,this.jump=0,this.onGround=!0,this.belowGround=!1,this.inWater=0,this.groundNormal=[0,0,0],this.target=0,this.level=0,this.faction=0,this.posLock=[0,0],this.posLockRadius=0,this.aabb=vu()}setAABB(){Nd(this.aabb,this.pos,this.size,this.size,this.size)}preFixed(e,n,i){super.preFixed(e,n,i),this.buffs.tick(e,n,i),this.stats.tick(e,n),this.skills.tick(e,n,i),this.setSize((this.stats.getStat(31)||100)/100)}getStatBasedMoveSpeed(){return Math.max(Math.min(65534,this.stats.getStat(15)))}postFixed(e,n,i){this.handlePosLock()}handlePosLock(){if(this.posLockRadius>0){wl(Ws,Ll(Rn,this.pos),this.posLock);let e=Ml(Ws);if(e>this.posLockRadius){let n=wy(Ws,this.posLock,xf(Ws,Ws,this.posLockRadius/e));Y(this.pos,n[0],this.pos[1],n[1])}}}hasMovementOverride(){return this.buffs.movementOverride.size>0}buffMovementOverride(e,n,i){this.hasMovementOverride()&&this.buffs.movementOverride.forEach(s=>{s.logic.movementOverride(e,n,i,this,s)})}combatRangeCheck(e,n){let i=this.pos[0]-e.pos[0],s=Math.max(0,Math.abs(this.pos[1]-e.pos[1])-this.size),o=this.pos[2]-e.pos[2];return i*i+s*s+o*o<(n+(e.size+this.size))**2}combatCylinderCheck(e,n,i){return!(this.aabb[1]>e[1]+n||this.aabb[4]<e[1]-n||Math.sqrt((e[0]-this.pos[0])**2+(e[2]-this.pos[2])**2)>i+this.radius)}tickHoles(e){let n=D.getHole(this.pos[0],this.pos[2]),i=this.pos[1]-D.getHeight(this.pos[0],this.pos[2]);return this.belowGround=n&&i<=0,n}horizontalSteer(e,n,i){if(this.stats.alive){this.rot=i;let s=vm(Rn,n);n[1]<0&&(s[1]*=.5),xf(s,s,e/20),m_(this.vel,s,i)}else this.vel[0]=0,this.vel[2]=0}setSteer(e,n){this.steer[0]=e,this.steer[1]=n}setJump(e){this.jump=e}setRot(e){super.setRot(e)}setSpeed(e){this.speed=e}setTarget(e){let n=e>0&&this.canTarget(D.getEntityById(e));return n!==!1&&n!==void 0?n.onTarget(this.id):this.target!==(this.target=0)}onTarget(e){let n=D.getEntityById(e);return n.target=this.id,super.onTarget(e)}getTargetEntity(){return D.getEntityById(this.target)}canTarget(e){return e}setFaction(e){this.faction=e}setLevel(e){this.level=e}setClass(e){this.class=e}onRemove(){this.stats.clear(),this.buffs.clearTempBuffs(),this.buffs.clearPassiveBuffs(),this.skills.clear(),super.onRemove()}hostility(e){return e.faction!==this.faction?1:0}canCombatInteract(e){return!0}canSupportInteract(e){return!0}die(e,n,i){}setPosLock(e,n,i){this.posLock[0]=~~e,this.posLock[1]=~~n,this.posLockRadius=~~i}tickWaterCollisions(e){let n=this.inWater;return this.inWater=Math.max(0,e.getWaterHeight(this.pos[0],this.pos[2])-this.pos[1]),!n&&this.inWater>0&&this.vel[1]<-3&&this.onEnterWater(),this.inWater>0}onEnterWater(){}};var os=class extends b0{constructor(e){super(e),this.uiFrameDirty=!0,this.uiRange=!0,this.buffDisplayDirty=!0,this.visualPosition=[0,0,0],this.speechTimer=new kt(0,5),this.mount=void 0,this.mountRotAdd=0,this.namePlateScale=.5,e.creature&&(e.creature.col1[0]!==0&&(e.colPrim=e.creature.col1),e.creature.col2[0]!==0&&(e.colSec=e.creature.col2)),this.skin=e.skin,this.colPrim=e.colPrim,this.colSec=e.colSec,this.interiorlightTarget=[0,0,0,0],this.interiorlightTimer=new kt(0,.5),this.conciliator=[0,0,0],this.visual=new _c(this),this.skin>0&&this.remakeTransform()}handleMovementData(e,n){let i=Ln([0,0,0],this.pos,this.conciliator),s=Xt([0,0,0],i,e.pos);$c(s)>1?(Y(this.conciliator,0,0,0),st(this.pos,e.pos)):Ln(this.conciliator,this.conciliator,s),st(this.vel,e.vel)}makeVisual(e,n,i){this.visual.setSkin(e||this.skin,n||this.colPrim,i||this.colSec)}remakeTransform(e,n,i){this.makeVisual(e,n,i),this.updateTransformScale(),this.updateTransformRotation(1),this.updateVisualPosition(0,0,D,!0)}onRemove(){super.onRemove(),this.mount!==void 0&&this.mount.onRemove()}updateVisualPosition(e,n,i,s=!1){e>0&&(sn(this.pos,this.pos,this.conciliator,-e*10),hn(this.conciliator,this.conciliator,1-e*10));let o=Kn(this.pos,this.visualPosition);(s||o>1e-5)&&(st(this.visualPosition,this.pos),this.visualPosition[1]+=this.radius,this.mount===void 0?st(this.visual.transform.position,this.visualPosition):(st(this.mount.transform.position,this.visualPosition),this.mount.transform.position[1]+=this.mount.skin.size*.5-this.radius)),this.interiorlightTimer.done(n)&&(this.interiorlightTimer.reset(n),i.getInteriorLight(this.interiorlightTarget,this.aabb));let r=Math.min(1,e),a=this.interiorlightTarget,l=this.visual.interiorlight;l[0]+=Math.sign(a[0]-l[0])*r,l[1]+=Math.sign(a[1]-l[1])*r,l[2]+=Math.sign(a[2]-l[2])*r,l[3]+=Math.sign(a[3]-l[3])*r}updateTransformScale(){mi(this.visual.transform.scale,this.size*.7),this.mount!==void 0&&mi(this.mount.transform.scale,this.mount.skin.size*.7)}updateTransformRotation(e){if(this.stats.alive&&this.buffs.visualFreeze===0){this.updateMountRotation(e);let n=ra(this.rot+this.mountRotAdd,this.visual.transform.rotation[1]);Math.abs(n)>.01&&(this.visual.transform.rotation[1]=yl(this.visual.transform.rotation[1]-n*Math.min(1,e*20),Math.PI*2))}}updateMountRotation(e){if(this.mount!==void 0){if((this.onGround||this.inWater>0)&&(this.steer[0]!==0||this.steer[1]!==0)){let n=this.steer[0]*1.5;this.steer[1]!=0&&(n*=.5*this.steer[1]),this.mountRotAdd-=(this.mountRotAdd-n)*Math.min(1,e*10)}this.mount.transform.rotation[1]=this.visual.transform.rotation[1]}else this.mountRotAdd=0}postFixed(e,n,i){super.postFixed(e,n,i),this.visual.tickFixed(e,n,i),this.mount!==void 0&&this.mount.tickFixed(e,n,i)}postDelta(e,n,i){super.postDelta(e,n,i),this.updateVisuals(e,n,i),this.updateUiParts(n)}updateVisuals(e,n,i){this.updateTransformRotation(e),this.updateTransformScale(),this.updateVisualPosition(e,n,i),this.mount!==void 0&&(this.mount.tick(e,n,i),this.mount.mountPosition(this.visual.transform.position)),this.visual.tick(e,n,i)}updateUiParts(e){let n=this.id===D.playerId,i=Vn===this.id,s=en.has(this.name);if(i||s){let o=this.squaredDistance(D.player.pos)<900;o!=this.uiRange&&(this.uiFrameDirty=!0),this.uiRange=o}(this.uiFrameDirty||this.skills.timedSkill!==void 0)&&(i&&this.hydrateUnitStore(Bs),n?this.hydrateUnitStore(Rs):s&&this.hydrateUnitStore(en.get(this.name).unitStore)),(this.buffDisplayDirty||n||i)&&(i&&this.hydrateBuffStore(n,Lc,oe.buffcountUnitframes),n?this.hydrateBuffStore(n,nl,oe.buffcountUnitframes):(this.buffDisplayDirty||i)&&s&&this.hydrateBuffStore(n,en.get(this.name).buffStore,oe.buffcountParty)),this.speechText!==void 0&&this.speechTimer.done(e)&&(this.speechText=void 0)}setTarget(e){let n=this.target,i=super.setTarget(e);if(n!=this.target&&this==D.player&&i){let s=D.getEntityById(e);s?(s.hydrateUnitStore(Bs,oe.buffcountUnitframes),s.hydrateBuffStore(!1,Lc,oe.buffcountUnitframes)):Bs.update(o=>(o.visible=!1,o))}return i}hydrateUnitStore(e){e.update(n=>(n.visible=!0,n.name=this.name,n.alive=this.stats.alive,n.hp=this.stats.getResource(6),n.hpMax=this.stats.getStat(6),n.mp=this.stats.getResource(7),n.mpMax=this.stats.getStat(7),n.level=this.level,n.class=this.class,n.id=this.id,n.clan=this.clan,n.faction=this.faction,n.party=this.party,n.role=this.partyrole,n.type=this.type,n.combat=!this.stats.combatTimer.done(D.time),n.range=this.uiRange,n.rarity=this.faction===2&&(this.rarity||!1),n.timedSkill=this.skills.timedSkill,n.timedCast=this.skills.timedCast,n)),this.uiFrameDirty=!1}hydrateBuffStore(e,n,i){n.update(s=>uB(s,this.buffs,i,e)),this.buffDisplayDirty=!1}speech(e,n){this.speechText=e,this.speechStyle=n,this.speechTimer.reset(D.time)}},uB=(t,e,n,i)=>{let s=[];e.buffs.forEach((r,a)=>{r.forEach((l,c)=>{!l.logic.passive&&l.logic.icon!==void 0&&(!oe.buffsHideIrrelevant||c===D.playerId||c===e.entity.id&&e.entity.faction===2||e.entity===D.player&&l.logic.type==1)&&(!l.logic.unique||s.reduce((f,u)=>f+(u.id===l.id?1:0),0)===0)&&s.push(l)})});let o=s.sort((r,a)=>a.time-r.time).sort((r,a)=>r.type-a.type).slice(0,n);if(t.length<o.length)for(;t.length<o.length;)t.push(mB());else if(t.length>o.length)for(;t.length>o.length;)dB(t.pop());return o.forEach((r,a)=>{hB(D.smoothtime,r,t[a],i)}),t},pB=0,gP=[],mB=()=>gP.pop()||{id:pB++,icon:"",type:1,time:0,duration:10,stacks:0,cancel:-1},dB=t=>{gP.push(t)},hB=(t,e,n,i)=>{e.logic.customIcon===void 0?n.icon=`/data/${e.logic.icon}.${Gn}?v=8582889`:n.icon=`/data/${e.logic.customIcon(e)}.${Gn}?v=8582889`,n.cancel=i&&e.logic.tags.has(12)?e.logic.id:-1,n.type=e.logic.type,n.time=Math.min(e.timer.duration,e.timer.passed(t)),n.duration=e.timer.duration,n.stacks=e.uniqueInstances>1?e.uniqueInstances:e.stacks};var ri=class extends os{constructor(e){super(e),this.static=!0,this.interactions=e.interactions,this.interactions.length&&this.setDialogue(this.interactions[0].text,this.interactions[0].choices)}interact(e){this.createInteraction()}createInteraction(){qs.set({title:this.name,text:this.text,choices:this.choices})}setDialogue(e,n){this.text=e,this.choices=n}};var y0=class extends ri{constructor(e){super({type:6,...e})}};var k0=class extends y0{constructor(e){super({...e,...S.npcs.blacksmith})}};var x0=class extends ri{constructor(e){super({type:2,...e})}};var to=(t,e)=>{let n=t.length-e,i="",s=e+n;for(;e<s;){let o=t[e++];if(o<128)i+=String.fromCharCode(o);else if(o>191&&o<224){let r=t[e++];i+=String.fromCharCode((o&31)<<6|r&63)}else if(o>239&&o<365){let r=t[e++],a=t[e++],l=t[e++],c=((o&7)<<18|(r&63)<<12|(a&63)<<6|l&63)-65536;i+=String.fromCharCode(55296+(c>>10)),i+=String.fromCharCode(56320+(c&1023))}else{let r=t[e++],a=t[e++];i+=String.fromCharCode((o&15)<<12|(r&63)<<6|a&63)}}return i};var w0=class extends x0{constructor(e){super({...e,...S.npcs.conjurer})}interact(e){let n=to(e,1).split("#");n[0]!==""?this.setDialogue(this.interactions[0].text,Array.from(n,i=>{let s=i.split("~");return this.interactions[0].choices[0].replace("$1",s[0])+(s[1]>0?` (Lv. ${s[1]}+)`:"")})):this.setDialogue(this.interactions[0].text,[]),super.interact(e)}};var M0=class extends kr{constructor(e){super({type:3,...e}),this.partytimeout=0,this.party=0,this.droptype="",this.tier=0,this.quality=0}partyTimeoutCheck(e){return this.party===0||e.id===this.party||e.party===this.party||D.time>this.partytimeout}canBePickedUpBy(e,n=30){return this.partyTimeoutCheck(e)&&e.stats.alive&&!e.buffs.buffs.has(128,e.id)&&e.squaredDistance(this.pos)<n}};var F0=class extends M0{constructor(e){super(e),this.visual={transform:Zs(1561,!1,!1,!0)},this.visual.transform.data.multi.needsUpdate=!1,this.setSize(.2),this.visual.transform.visible=!1,this.uiTimeout=0,this.dirty=!1,this.hasInfo=!1,this.hasPos=!1,this.hasRot=!1,this.color="misc"}postDelta(e,n,i){if(this.visual.transform.visible&&this.dirty){let s=i.getChunkFromWorld(this.pos[0],this.pos[2]);s!==void 0&&s.deserialized&&(this.pos[1]=i.getHeight(this.pos[0],this.pos[2])+Math.random()*.1+.1,this.visual.transform.rotation[1]=Math.random()*Math.PI*2,Tm(this.visual.transform.rotation,i.getNormal(this.pos[0],this.pos[2])),st(this.visual.transform.position,this.pos),this.visual.transform.data.multi.needsUpdate=!0,qt(this.visual.transform,!1),this.dirty=!1)}}setDropInfo(e,n,i,s,o){this.hasInfo=!0,this.party=s,this.partytimeout=o,this.droptype=$k[e],this.tier=n,this.quality=i,this.lootquality=i;let r,a;this.droptype=="gold"?(this.name=this.tier+"c",this.setSize(.1),r="gold",this.color="gold",this.quality=100):(r=this.droptype+this.tier,a=rn[r],a&&(this.name=gn(this.droptype,this.tier)),this.droptype!=="misc"&&this.droptype!=="rune"&&this.droptype!=="book"?(this.color=Yt(i)[1],oe.itemQualityPercent&&(this.name+=` ${this.quality}%`)):(this.color=this.droptype,this.quality=100,this.droptype==="rune"&&(this.lootquality=90)));let l=a&&a.art||r;Vr(this.visual.transform.data.uvshift,ko[l]),Y(this.visual.transform.scale,ko[l][0]*20,1,ko[l][1]*20),this.visual.transform.data.shine[0]=Math.random()*6.1,this.dirty=!0,this.visual.transform.visible=!0}onRemove(){ks(this.visual.transform.data.multi,this.visual.transform),tt.shift.down&&(gc.add(this),this.uiTimeout=Math.round(D.time/5)*5+10)}};var C0=class extends os{constructor(e){super({type:7,...e}),this.static=!0,this.class=5}};var S0=class extends C0{};var A0=class extends ri{constructor(e){super({type:12,...e})}};var P0=class extends A0{constructor(e){super({...e,interactions:[]})}};var T0=class extends ri{constructor(e){super({type:4,...e})}};var E0=class extends T0{constructor(e){super({...e,...S.npcs.merchant})}};var D0=class extends os{constructor(e){super({type:1,...e}),this.groundHeight=0;let n=r1.get(e.creature.id);this.aggroMode=n.aggroMode,this.rarity=n.rarity}tickFixed(e,n,i){this.horizontalSteer(this.speed,this.steer,this.rot),super.tickFixed(e,n,i),this.tickHoles(e),this.stats.alive&&(sn(this.pos,this.pos,this.vel,e),this.groundHeight=i.raycastEnvironmentHeight(this.pos[0],this.pos[2],this.pos[1]+1,this.pos[1]-1,this.groundNormal),this.belowGround||(this.groundHeight=Math.max(this.groundHeight,i.getHeight(this.pos[0],this.pos[2])))),this.setAABB(),this.tickWaterCollisions(i),this.inWater>this.radius||(this.pos[1]-=10*e),this.pos[1]=Math.max(this.groundHeight,this.pos[1])}};var I0=class extends D0{};var V0=class extends kr{constructor(e){super({type:11,...e})}};var L0=class extends V0{constructor(e){super(e),this.meshId=0,this.scale=0,this.effects=[],this.dirty=!1,this.rot=Math.random()*3.14}postDelta(e,n,i){if(this.dirty){st(this.mesh.position,this.pos),this.mesh.rotation[1]=this.rot,mi(this.mesh.scale,this.scale),this.mesh.matrixNeedsUpdate=!0,qt(this.mesh,!0);for(let s=0;s<this.effects.length;++s){let o=this.effects[s];qt(o.transform,!0)}this.mesh.data.multi&&(this.mesh.data.multi.needsUpdate=!0),this.dirty=!1}}setNodeInfo(e,n){e!==this.meshId&&(this.meshId>0&&this.removeMesh(),this.meshId=e,this.makeMesh(),this.dirty=!0),this.scale!==n&&(this.scale=n,this.dirty=!0)}makeMesh(){let e=_s.get(this.meshId);e.geometry>0?(this.mesh=Zs(this.meshId,!0,!1,!0),ei(this.mesh.data.interiorlight,0,0,0,0)):this.mesh=on();for(let n=0;n<e.effects.length;++n){let i=e.effects[n],s=on();st(s.position,i.pos),st(s.scale,i.scale),st(s.rotation,i.rot),Mn(s,this.mesh);let o=zi(i.id,s,0,!0);this.effects.push(o)}}removeMesh(){this.mesh!==void 0&&(this.mesh.data.multi?ks(this.mesh.data.multi,this.mesh):us(this.mesh)),this.mesh=void 0;for(let e=0;e<this.effects.length;++e)this.effects[e].done=!0;this.effects.length=0}onRemove(){this.removeMesh()}};var q0=class extends os{constructor(e){super({type:10,...e}),this.groundHeight=0}tickFixed(e,n,i){this.horizontalSteer(this.speed,this.steer,this.rot),super.tickFixed(e,n,i),this.tickHoles(e),this.stats.alive&&(sn(this.pos,this.pos,this.vel,e),this.groundHeight=i.raycastEnvironmentHeight(this.pos[0],this.pos[2],this.pos[1]+1,this.pos[1]-1,this.groundNormal)),this.setAABB(),this.tickWaterCollisions(i),this.inWater>this.radius||(this.pos[1]-=10*e),this.pos[1]=Math.max(this.groundHeight,this.pos[1])}};var R0=class extends q0{};var B0=class extends os{constructor(e){super({type:0,size:.9,...e}),this.exp=0,this.party=0,this.partyrole=0,this.prestige=0,this.prestigeRank=0,this.elo=0,this.eloRank=0,this.clan=void 0,this.clanRole=0,this.jumpLast=0}tickVelocity(e,n,i,s,o){this.inWater>this.radius?(this.onGround&&(this.vel[1]=Math.max(0,this.vel[1])),this.inWater<this.radius+.1&&(this.jump>0||this.vel[1]===0)?this.vel[1]=this.jumpLast===0&&s>0?7:0:(this.vel[1]+=s?e*8:e*-4,this.vel[1]=Math.max(Math.min(this.vel[1],4),-3)),this.horizontalSteer(o*.5,n,i)):this.onGround?(this.stats.alive&&s>0&&o>0&&(this.vel[1]=9,this.onGround=!1),this.horizontalSteer(o,n,i)):(this.vel[1]=Math.max(-60,this.vel[1]-25*e),this.stats.alive&&this.vel[0]===0&&this.vel[2]===0&&this.horizontalSteer(o*.5,n,i)),this.jumpLast=this.vel[1]<0?this.jumpLast:this.jump}tickMovement(e,n,i,s,o){this.tickVelocity(e,n,i,s,o);let r=this.tickHoles(e);this.setWorldCollAABB(this.vel[0]*e,this.vel[1]*e,this.vel[2]*e);let a=D.triangleGrid.queryAABB(this.aabb),l=[],c=[],f=[];for(let v=0;v<a.length;++v){let _=a[v],b=_[3][1];b>.6?c.push(_):b<-.6?f.push(_):l.push(_)}let u=pi(this.vel)*e,p=Math.floor(Math.max(1,u/.1)),g=e/p;for(let v=0;v<p;++v)this.tickCollisions(g,l,c,f,r);this.setAABB(),this.tickWaterCollisions(D),D.clampV3(this.pos)}setWorldCollAABB(e,n,i){let s=this.aabb,o=this.radius+.5;s[0]=this.pos[0]-Math.min(0,e)-o,s[3]=this.pos[0]+Math.max(0,e)+o,s[1]=this.pos[1]-Math.min(0,n)-o,s[4]=this.pos[1]+Math.max(0,n)+o*2,s[2]=this.pos[2]-Math.min(0,i)-o,s[5]=this.pos[2]+Math.max(0,i)+o}tickCollisions(e,n,i,s,o){let r=[...this.pos];sn(this.pos,this.pos,this.vel,e);let a=this.belowGround||o?0:D.getHeight(this.pos[0],this.pos[2]),l=D.getNormal(this.pos[0],this.pos[2]);this.tickWallCollisions(n,a,l),a=this.belowGround||o?0:D.getHeight(this.pos[0],this.pos[2]),l=D.getNormal(this.pos[0],this.pos[2]),this.tickFloorCollisions(i,a,l),this.tickCeilCollisions(s,r),this.belowGround||(this.pos[1]=Math.max(this.pos[1],D.getHeight(this.pos[0],this.pos[2])))}tickWallCollisions(e,n,i){if(i[1]<.6&&this.pos[1]<n){let c=-(s3(...this.pos,this.pos[0],n,this.pos[2],...i)+.05);this.pos[0]-=i[0]*c,this.pos[2]-=i[2]*c}let s=this.radius,o=this.radius*1.5,r=this.pos[0],a=this.pos[1]+o,l=this.pos[2];for(let c=0;c<e.length;++c){let f=e[c];if(Pm(f[0],f[1],f[2],r,a,l)){let u=i3(r,a,l,...f[0],...f[3]);if(u<s&&u>-.5){let p=u-s;this.pos[0]-=f[3][0]*p,this.pos[2]-=f[3][2]*p}}}}tickFloorCollisions(e,n,i){let o=this.vel[1]>0||this.inWater>this.radius?0:.1,r=this.radius*1.5,a=1/0,l=!1;for(let f=0;f<e.length;++f){let u=e[f];if(Pm(u[0],u[1],u[2],...this.pos)){let p=b1(...this.pos,...u[0],...u[3]);p<a&&p<o&&p>-r&&(a=p,l=!0,st(this.groundNormal,u[3]))}}let c=-(n-this.pos[1]);i[1]>.6&&this.pos[1]<n+o&&c<a&&c<o&&c>-r&&(a=c,l=!0,st(this.groundNormal,i)),l?(this.pos[1]-=a,this.onGround||(this.onGround=!0,this.onFallLanding(-this.vel[1]),this.vel[1]=Math.max(0,this.vel[1]))):(this.onGround=!1,Y(this.groundNormal,0,1,0))}tickCeilCollisions(e,n){let i=this.radius*1.5;for(let s=0;s<e.length;++s){let o=e[s],r=this.pos[0],a=this.pos[1],l=this.pos[2];if(Pm(o[0],o[1],o[2],r,a,l)){let c=b1(...this.pos,...o[0],...o[3]);c<0&&c>-i&&(this.pos[1]>=n[1]&&(this.pos[0]=n[0],this.pos[2]=n[2]),this.vel[1]=Math.min(0,this.vel[1]),this.vel[0]=0,this.vel[2]=0)}}}setExp(e){this.exp=e}setParty(e,n){this.party=e,this.partyrole=n}setPrestige(e){return e!==this.prestige?(this.prestige=e,this.prestigeRank=Jl(e),!0):!1}setElo(e){return e!==this.elo?(this.elo=e,this.eloRank=zl(e),!0):!1}setClan(e,n=0){this.clan=e,this.clanRole=n}getNearbyPartyMembers(e){let n=[];return this.stats.alive&&n.push(this),this.party>0&&D.entities.type[0].forEach(i=>{i.party==this.party&&i!=this&&i.stats.alive&&Kn(e,i.pos)<1e3&&n.push(i)}),n}hostility(e){return(D.mode.partyBasedHostility===!0?e.party!==this.party:e.faction!==this.faction)?e.type===0?e.stats.stat.get(26)===0&&this.stats.stat.get(26)===0?0:2:1:0}canCombatInteract(e){return e.type===0?e.buffs.buffs.has(128,e.id)?!1:!D.mode.pvpprotect||this.hostility(e)<2?!0:!(this.stats.stat.get(26)===0||e.stats.stat.get(26)===0)&&Math.abs(this.stats.stat.get(26)-e.stats.stat.get(26))<=5+Math.max(this.skills.pvpBoundModifier,e.skills.pvpBoundModifier):e.type===1||e.type===10||e.type===12?e.stats.stat.get(26)>0:!0}canSupportInteract(e){return this.hostility(e)===0&&(!D.mode.pvpprotect||(e.type===0?Math.abs(this.stats.stat.get(26)-e.stats.stat.get(26))<=5:!0))}onFallLanding(e){}};var gB=[1,2,3,4],Da=class extends B0{constructor(e){e.skin=0,super(e)}tickFixed(e,n,i){super.tickFixed(e,n,i),this.tickMovement(e,this.steer,this.rot,this.jump,this.speed)}setClass(e){e!==this.class&&(super.setClass(e),this.skin=gB[this.class],this.remakeTransform())}makeVisual(e,n){super.makeVisual(e,n),this.prestige>0&&this.setPrestige(this.prestige,!0),this.level>=10&&this.setLevel(this.level),this.elo>1500&&this.setElo(this.elo,!0)}setPrestige(e,n){if(super.setPrestige(e)||n){let i=Math.min(this.prestigeRank,10),s=this.prestigeRank-11;i<1?(this.visual.setCrown(!1),this.visual.setHeadgear(!1)):(this.visual.setHeadgear(s<0?Q1[Math.min(4,i-1)]:In.darkgold),i>5?this.visual.setCrown(Q1[i-6]):this.visual.setCrown(!1)),s<0?this.visual.setGem(!1):this.visual.setGem(Fw[s],s>0?1:.8)}}setElo(e,n){if(super.setElo(e)||n){let i=zl(e);this.visual.setShoulders(Z1[Math.min(i,1)],.65+i*.08,i>0&&Z1[i])}}setLevel(e){super.setLevel(e),e>=15?this.visual.setCape(this.faction===0?In.vanguard:In.bloodlust,e>=25?1:.5):this.visual.setCape(!1)}setParty(e,n){this.uiFrameDirty=!0,this.buffDisplayDirty=!0,super.setParty(e,n)}onEnterWater(){this.visual.playSound(130,!1),this.visual.watersplash(94)}};var z0=class extends ri{constructor(e){super({type:9,...e})}};var $0=class extends z0{constructor(e){super({...e,...S.npcs.sage})}interact(e){this.interactions[0].choices[0]=this.interactions[0].choices[0].replace("$1",D.player.level*10),super.interact(e)}};var U0=class extends ri{constructor(e){super({type:5,...e})}};var O0=class extends U0{constructor(e){super({...e,...S.npcs.stash})}};var N0=class extends ri{constructor(e){super({type:8,...e})}};var j0=class extends N0{constructor(e){super({...e,...S.npcs.trader});let n=a1.get(e.creature.id);this.items=[],Pf.forEach(i=>{if(i.shop===n.shop){let s=new Xs,o=ne();s.hydrate({type:i.type,tier:i.tier,stacks:i.stacks===0?void 0:i.stacks,upgrade:i.upgrade,store:o}),s.buyid=i.id,this.items.push([s,o])}})}};var W0=class{constructor(e){this.entity=e,this.slots=new Map,this.gold=0,this.medals=0,this.size=0,this.firstEmptySlot=0,this.firstEmptySlotDirty=!0,this.setSize(0)}tickFixed(e,n,i){}setSize(e){this.size=Math.min(100,e)}setGold(e){this.gold=e}setMedals(e){this.medals=e}setItem(e,n){let i=new Xs(n);return this.slots.set(e,i),e===this.firstEmptySlot&&(this.firstEmptySlotDirty=!0),i}removeItem(e){let n=this.slots.get(e);return this.slots.delete(e),(e<this.firstEmptySlot||this.firstEmptySlot===-1)&&(this.firstEmptySlot=e),n}async hydrateItems(e=!1){let n=[],i=[];if(this.slots.forEach((s,o)=>{s.dirty&&(s.dirty=!1,n.push(s.dbid),i.push(o))}),n.length){let s=await this.fetchData(n);this.compareData(s,i,0),this.postHydrate(i,e)}else e&&this.postHydrate(i,e)}hydrate(e){this.slots.has(e.slot)?this.slots.get(e.slot).hydrate(e):console.error("received hydration of unknown item")}postHydrate(e){}compareData(e,n,i){e.forEach(s=>{s.slot!==null&&(this.hydrate(s),n=n.filter(o=>o!==s.slot))}),n.forEach(s=>this.removeItem(s,i))}findFirstItemOfType(e,n){for(let i of this.slots)if(i[1].type==e&&i[1].tier==n)return i[1]}findFirstSlotOfType(e,n){let i=-1,s=0;for(let o of this.slots){let r=o[0],a=o[1];a.type==e&&a.tier==n&&r>i&&a.bound>=s&&(i=r,s=a.bound)}return i>=0?i:void 0}getFirstEmptySlot(){if(this.firstEmptySlotDirty){this.firstEmptySlotDirty=!1;for(let e=0;e<this.size;++e)if(!this.slots.has(e))return this.firstEmptySlot=e;this.firstEmptySlot=-1}return this.firstEmptySlot}findFirstUnmaxedStackableOfType(e,n){for(let i of this.slots)if(i[1].type==e&&i[1].tier==n&&i[1].stacks<50)return i[1];return-1}};var G0,H0=class extends W0{constructor(e){super(e),this.dirty=!1}tickFixed(e,n,i){super.tickFixed(e,n,i),this.dirty&&(this.hydrateItems(),this.dirty=!1)}setGold(e,n,i){super.setGold(e),iu(e,n,i,"$g"),Hi.set(e)}setMedals(e,n,i){super.setMedals(e),iu(e,n,i,"$m"),il.set(e)}setItem(e,n,i){let s=super.setItem(e,n);s.reason=i,this.dirty=!0}removeItem(e,n){aF(super.removeItem(e),n),G0[e]!==void 0&&(G0[e].set(void 0),this.dirty=!0,this.updateInventoryCounts())}hydrate(e){e.store=G0[e.slot],super.hydrate(e)}postHydrate(e){super.postHydrate(e),this.updateInventoryCounts()}updateInventoryCounts(){let e={};this.slots.forEach(n=>{let i=n.type+n.tier;e[i]=(e[i]||0)+(n.stacks?n.stacks:1)}),ol.set(e)}async fetchData(e){let i=await(await fetch("/api/item/get",{method:"POST",body:JSON.stringify({ids:e})})).json();if(i.fail)console.error(i);else return i}setSize(e){super.setSize(e),sl.update(n=>{for(let i=111;i>=0;--i)i>=101?n[i]||(n[i]=ne(void 0)):i>=this.size?n[i]&&delete n[i]:n[i]||(n[i]=ne(void 0));return G0=n,n})}};var Y0=class extends Da{constructor(e){super(e),D.setPlayer(this),this.skills.isPlayer=!0,this.skills.clearSkillInfo(),this.inventory=new H0(this),this.partyInfoUpdateTimer=new kt(0,1),this.heartBeatTimer=new kt(0,1),this.secondlyUpdates=new kt(0,1),this.lastNetRot=this.rot,this.inputTicksPassed=0,this.inputTicksSinceLastPosUpdate=0,this.inputTicksSinceLastRotUpdate=0,ti[1]=.7,this.smoothZoom=0,this.areaid=-1}makeVisual(e,n){super.makeVisual(e,n),this.visual.soundPrio=1}tickFixed(e,n,i){super.tickFixed(e,n,i),this.inventory.tickFixed(e,n,i)}preFixed(e,n,i){super.preFixed(e,n,i),(tt.turnright.down||tt.turnleft.down)&&(ti[0]=Vl(ti[0]+oe.mouseSensitivity*3*e*((tt.turnleft.down?1:0)-(tt.turnright.down?1:0)))),this.handleInput(e,n,i)}postFixed(e,n,i){super.postFixed(e,n,i)}handleInput(e,n,i){this.inputTicksPassed++;let s=!1,o=!1,r=!1,a=!1,l=!1,c=!1,f=this.steer[0],u=this.steer[1],p=this.jump,g=this.rot,v=f,_=u,b=p,y=g;this.hasMovementOverride()?(this.buffMovementOverride(e,n,i),f=this.steer[0],u=this.steer[1],p=this.jump,g=this.rot):(f=(tt.left.down?1:0)+(tt.right.down?-1:0),u=(tt.fwd.down||tt.lmb.down&&tt.rmb.down?1:0)+(tt.back.down?-1:0),p=tt.jump.down?1:0,g=oe.lockedcamera&&tt.lmb.down||tt.rmb.down||tt.turnleft.down||tt.turnright.down?ti[0]:this.rot),(f!==v||u!==_)&&(o=f!==v,r=u!==_,this.setSteer(f,u)),p!==b&&(this.setJump(p),l=!0);let w=ra(g,this.lastNetRot);this.inputTicksSinceLastRotUpdate++,g!==y&&this.setRot(g),g!==this.lastNetRot&&((this.steer[0]!==0||this.steer[1]!==0)&&Math.abs(w)>.1||this.inputTicksSinceLastRotUpdate>10||r||o||Math.abs(w)>.2)&&(this.lastNetRot=y,s=!0);let C=this.getStatBasedMoveSpeed();C!=this.speed&&(this.setSpeed(C),a=!0),this.inputTicksSinceLastPosUpdate++,this.inputTicksSinceLastPosUpdate>600?c=!0:this.inputTicksSinceLastPosUpdate>40?(this.steer[0]!==0||this.steer[1]!==0)&&(c=!0):this.inputTicksSinceLastPosUpdate>20&&(this.steer[0]!==0||this.steer[1]!==0)&&(s||o||r)&&(c=!0),(s||o||r||a||l||c)&&this.sendInput(s,o,r,a,l,c)}sendInput(e,n,i,s,o,r){let a={uint8s:[],int8s:[],uint16s:[],doubles:[]};a.uint8s.push(Math.min(254,this.inputTicksPassed)),o&&a.uint8s.push(this.jump),n&&!i?a.int8s.push(this.steer[0]):(n||i)&&a.int8s.push(this.steer[0],this.steer[1]),e&&(this.inputTicksSinceLastRotUpdate=0,a.doubles.push(this.rot)),r&&(this.inputTicksSinceLastPosUpdate=0,a.doubles.push(this.pos[0],this.pos[1],this.pos[2])),s&&a.uint16s.push(this.speed),Si(Ft.clientPlayerInput.packData(a)),this.inputTicksPassed=0}updateCharPanel(){(oe.charpanelOpen||oe.skillmenuOpen)&&this.statsDirty&&(this.statsDirty=!1,Uo.update(e=>(Array.from(this.stats.stat).forEach(i=>e[i[0]]=i[1]),e)))}updatePartyInfo(e){if(this.partyInfoUpdateTimer.done(e)){this.partyInfoUpdateTimer.reset(e);let n=this.getNearbyPartyMembers(this.pos),i=k1(n.length);Qn.update(s=>(s.role=this.partyrole,s.nearby=n.length,s.exprate=Math.round(i*100),s.itemfind=Math.min(10*100,Math.round(i*100+m3(n)*100)),s))}}handleCamera(e){if(st(Gt.position,this.mount?this.mount.transform.position:this.visual.transform.position),Gt.position[1]+=1.25,Gt.rotation[0]=ti[1],!tt.lmb.down&&!tt.rmb.down&&(this.steer[0]!==0||this.steer[1]!==0)){let u=ra(this.rot,ti[0])*Math.min(1,e*2);u!==0&&(Math.abs(u)>.03*e?(u=u>0?Math.max(u,Math.min(1,.6*e)):Math.min(u,Math.max(1,-.6*e)),ti[0]-=u):ti[0]=this.rot)}Gt.rotation[1]=ti[0],qt(Gt,!1);let n=oe.cameraZoom;Y(gt.transform.position,0,0,-n),pl(gt,!1);let i=[0,0,0],s=[0,0,0],o=[0,0,0];ao(gt,o,[0,0]),Xt(i,o,Gt.position),bp(s,i);let r=pi(i),a=[0,0,0],l=[0,0,0],c=[[-1,1],[1,1],[-1,-1],[1,-1]];for(let u=0;u<c.length;++u){let p=c[u];ao(gt,a,p),Xt(l,a,o),Ln(a,Gt.position,l);let g=D.triangleGrid.queryRay(a,i,s),v=1;for(let _=0;_<g.length;++_){let b=g[_];v=Math.min(v,ql(b[0],b[1],b[2],a,i,!0))}v<1&&(n=Math.min(r*v,n))}if(this.smoothZoom=Math.max(0,Math.min(this.smoothZoom+e*20,n)),Y(gt.transform.position,0,0,-this.smoothZoom),wh(gt),!this.belowGround){ao(gt,a,[0,-1]);let u=D.getHeight(a[0],a[2]);u>a[1]&&(Gt.position[1]+=u-a[1])}qt(Gt,!1),pl(gt,!1),ao(gt,a,[0,-1]);let f=D.getWaterHeight(a[0],a[2]);if(f>a[1]){let u=f-a[1];Od(u);let p=a[1]-f;if(ao(gt,a,[0,1]),f<a[1]){let g=a[1]-f;Math.abs(g)>Math.abs(p)?(Gt.position[1]-=p,Od(0)):Gt.position[1]-=g,qt(Gt,!1),pl(gt,!1)}}else Od(0)}handleAreaCheck(e){let n=e.getAreaId(this.pos[0],this.pos[2]);if(n!==this.areaid){this.areaid=n;let i=Sf.get(n);i!==void 0&&Cr.set({type:"area",text:i.name,time:5e3})}}handleHeartBeat(e){let n=this.stats.getResource(6)/(this.stats.getStat(6)*.5);n>0&&n<1&&(n=(Math.max(0,Math.min(1,n))+.5)/1.5,Mt(103),this.heartBeatTimer.reset(e,n))}postDelta(e,n,i){this.updateCharPanel(),this.updatePartyInfo(n),super.postDelta(e,n,i),this.handleCamera(e),this.secondlyUpdates.done(n)&&this.handleAreaCheck(i),this.heartBeatTimer.done(n)&&this.handleHeartBeat(n)}updateTransformRotation(e){this.stats.alive&&this.buffs.visualFreeze===0&&(this.updateMountRotation(e),this.buffs.movementOverride.size||!tt.rmb.down&&!(oe.lockedcamera&&tt.lmb.down)?this.visual.transform.rotation[1]=this.rot:this.visual.transform.rotation[1]=ti[0],this.visual.transform.rotation[1]+=this.mountRotAdd)}setLevel(e){super.setLevel(e),this.uiFrameDirty=!0}onRemove(){super.onRemove(),D.removePlayer(this)}setExp(e){super.setExp(e),rp.update(n=>(n.current=e,n.max=Jo(this.level),n))}setClan(e,n=0){super.setClan(e,n),hp.set(e)}setRot(e,n=!1){super.setRot(e),n&&(ti[0]=e)}};var M2=new Map([[6,k0],[2,w0],[7,S0],[4,E0],[0,Da],[9,$0],[12,P0],[5,O0],[8,j0],[3,F0],[1,I0],[10,R0],[11,L0]]),vP=(t,e)=>t==0?e==D.playerId?Y0:Da:M2.get(t);var F2=[-0,-1,-0],X0=class{constructor(){this.id="",this.idInt=0,this.file="",this.bounds=0,this.chunkAmount=0,this.entities={array:[],map:new Map,type:{}},M2.forEach((e,n)=>this.entities.type[n]=[]),this.mode=dm.normal,this.chunksMap=new Map,this.chunksArray=[],this.finishedLoadingChunks=new Set,this.time=this.accum=-0,this.timestep=1/60,this.tickId=0,this.data=void 0,this.triangleGrid=new c0}load(e,n){this.id=e,this.file=n,l1.forEach(i=>{i.name===n&&(this.data=i,this.idInt=i.id)}),this.parse(!1)}tickIdToTimestamp(e){return e*this.timestep}setTimeFromTickId(e){return this.tickId=e,this.time=this.tickIdToTimestamp(e),this.tickId}createEntity(e,n,i){return i=i||{},i.id=n,new(vP(e,n))(i)}addEntity(e){if(e===void 0||e.type===void 0){console.log("Error: tried adding an entity of unknown type to the world");return}if(this.entities.array.length>=32766){console.log("Error: tried addint entity but we already are at the maximum");return}if(this.isEntityInWorld(e)||this.isEntityIdTaken(e.id)){console.log("Error: Entity in world or entity id taken"),console.log(e),console.log(this.getEntityById(e.id));return}return this.entities.array.push(e),this.entities.map.set(e.id,e),this.entities.type[e.type].push(e),e}removeEntity(e){if(e===void 0)return!1;this.entities.map.delete(e.id);let n=this.entities.array.indexOf(e);return n>-1&&this.entities.array.splice(n,1),n=this.entities.type[e.type].indexOf(e),n>-1&&this.entities.type[e.type].splice(n,1),e.onRemove(),e}isEntityIdTaken(e){return this.entities.map.has(e)}isEntityIdAllowed(e){return!0}isEntityInWorld(e){return this.entities.array.indexOf(e)>=0}entity(e){return this.entities.map.get(e)}getEntityById(e){return this.entities.map.get(e)}getPlayerByName(e){let n=e.toLowerCase();return this.entities.type[0].find(i=>i.name&&i.name.toLowerCase()===n)}getMonsterByName(e){let n=e.toLowerCase();return this.entities.array.find(i=>i.name&&i.name.toLowerCase()===n)}setMode(){this.mode=dm[this.id]||dm.normal}getHeight(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-0:ws(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getHole(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-0:bu(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getWaterHeight(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-1:yu(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getAreaId(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-0:Wv(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getEnvironmentId(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);return!i||!i.deserialized?-0:Gv(i,e>=this.bounds?63:e%64,n>=this.bounds?63:n%64)}getNormal(e,n){e=vt(e,0,this.bounds),n=vt(n,0,this.bounds);let i=this.chunksMap.get(Math.min(Math.floor(e/64),this.chunkAmount-1)+Math.min(Math.floor(n/64),this.chunkAmount-1)*this.chunkAmount);if(!i||!i.deserialized)Y(F2,0,0,0);else{e=e>=this.bounds?63:e%64,n=n>=this.bounds?63:n%64,e/=2.6666666666666665,n/=2.6666666666666665;let s=Math.floor(e)*2+24*Math.floor(n)*2;e%1+n%1>1&&s++,s*=3,Y(F2,i.normals[s],i.normals[s+1],i.normals[s+2])}return F2}clampV3(e){return e[0]=vt(e[0],0,this.bounds),e[1]=vt(e[1],0,2e3),e[2]=vt(e[2],0,this.bounds),e}getChunkFromWorld(e,n){return e=vt(e,0,this.bounds),n=vt(n,0,this.bounds),e=Math.min(Math.floor(e/64),this.chunkAmount-1),n=Math.min(Math.floor(n/64),this.chunkAmount-1),this.chunksMap.get(e+n*this.chunkAmount)}getChunk(e,n){if(!(e<0||n<0||e>=this.chunkAmount||n>=this.chunkAmount))return this.chunksMap.get(e+n*this.chunkAmount)}parse(e){this.setMode(),e||(this.chunkAmount=this.data.chunkAmount,this.bounds=64*this.chunkAmount,this.setGrids(),this.finishedLoadingChunks.clear(),this.createChunks())}setGrids(){this.triangleGrid.setDimensions(this.bounds,this.bounds,this.bounds,15,15,15)}rebuildTriangleOctree(){this.triangleGrid.clear(),this.chunksMap.forEach(e=>{for(let n=0;n<e.props.length;++n){let i=e.props[n];i.loaded=!1,i.loadGeometry(this,e)}})}triangleRaycastClosest(e,n,i,s,o,r){f0(oi,e,n,i,s,o,r);let a=1,l=this.triangleGrid.queryRay(oi.origin,oi.dir,oi.invDir);for(let c=0;c<l.length;++c){let f=l[c];a=Math.min(a,ql(f[0],f[1],f[2],oi.origin,oi.dir,!1))}return a}triangleRaycastAny(e,n,i,s,o,r,a){f0(oi,e,n,i,s,o,r);let l=this.triangleGrid.queryRay(oi.origin,oi.dir,oi.invDir);for(let c=0;c<l.length;++c){let f=l[c];if(ql(f[0],f[1],f[2],oi.origin,oi.dir,a)<1)return!0}return!1}raycastEnvironmentClosest(e,n,i,s,o,r){let a=this.getHeight(e,i)>n,l=this.triangleRaycastClosest(e,n,i,s,o,r);l<1&&(s*=l,o*=l,r*=l);let c=0,f=0,u=.1;if(a)f=1;else for(;c<100&&f<1;){let p=f+u,g=e+s*p,v=n+o*p,_=i+r*p,b=this.getHole(e,i)?0:this.getHeight(g,_),y=v-b;y<0?y>-.05?(f+=u,c=100):u*=.5:f+=u,c++}return Math.min(f,l,1)}raycastEnvironmentAny(e,n,i,s,o,r,a){let l=Math.sqrt(s*s+o*o+r*r),c=3/l,f=s*c,u=o*c,p=r*c,g=e,v=n+a,_=i,b=Math.floor(l/3),y=0;for(;y<b;)if(++y,g+=f,v+=u,_+=p,this.getHeight(g,_)>v)return!0;return this.triangleRaycastAny(e,n,i,s,o,r,!0)}raycastEnvironmentHeight(e,n,i,s,o){let a=this.getHole(e,n)?0:this.getHeight(e,n),l=0;i>a&&(o!==void 0&&st(o,this.getNormal(e,n)),l=a);let c=i-s;Ks[0]=Ks[3]=e,Ks[5]=Ks[2]=n,Ks[4]=i,Ks[1]=s;let f=this.triangleGrid.queryAABB(Ks);if(f.length>0){let u=1/0;f0(oi,e,i,n,0,-c,0);for(let p=0;p<f.length;++p){let g=f[p],v=ql(g[0],g[1],g[2],oi.origin,oi.dir,!1);if(v<u){u=v;let _=i-v*c;_>l&&(l=_,o!==void 0&&st(o,g[3]))}}}return l}addChunk(e){this.chunksMap.set(e.id,e),this.chunksArray.push(e)}removeChunk(e){this.chunksMap.delete(e.id),this.chunksArray.splice(this.chunksArray.indexOf(e),1)}};var _P=(t,e,n="")=>{Ic.update(i=>(i.push({text:t,icon:e,css:n}),i))};var vB={2:"On cooldown.",3:"Can only be cast on enemy.",4:"Can only be cast on ally.",5:"Not enough mana.",6:"Out of range.",10:"Target is dead.",7:"Can't do that during movement.",8:"Can't cast while busy.",9:"You are incapacitated.",11:"Can't do that in combat.",12:"Can't cast this right now.",13:"Level difference is too big.",14:"Target is not in line of sight."},yP=new Map;yP.set(16,t=>{if(Nt("system",`You have learned ${S.items.book[t[0]].name} Lv. ${t[1]}`,!0),Mt(89),tn(24,100),t[1]===0&&Pt.get(t[0]).autoSkillbar){let e=oe.skillbarsettings[D.player.name].findIndex(n=>n.id===-1);e>=0&&wi[e].update(n=>(n.id=t[0],n))}}).set(15,t=>{D.player.skills.add(t[0],_i(t[2]),_i(t[3]),t[1])}).set(17,t=>{D.player.skills.remove(t[0])}).set(18,t=>{D.player.skills.updateSkillsLearned(t)}).set(19,t=>{Bc.set(to(t,0))}).set(1,t=>{Cr.set({type:"error",text:vB[t[0]]})}).set(20,t=>{D.player.setExp(t[1]),oe.chat[0]&&Nt("exp",`Gained ${t[0]} experience. ${D.player.exp}/${Jo(D.player.level)}`,!0),Ng(t[0])}).set(21,t=>{D.player.setExp(t[1]),Nt("error",`Lost ${t[0]} experience. ${D.player.exp}/${Jo(D.player.level)}`,!0)}).set(22,t=>{D.player.setExp(t[0])}).set(45,t=>{let e=D.entity(t[1]);Mt(104),e&&vA(st([0,0,0],e.visualPosition),t[0]),oe.chat[11]&&Nt("fame",`Gained $fm${t[0]} fame ${e?"from "+e.name:""}`,!0)}).set(46,t=>{oe.chat[11]&&Nt("fame",`Lost $fm${t[0]} fame.`,!0)}).set(47,t=>{Mt(104),oe.chat[11]&&Nt("fame",`Gained $fm${t[0]} salary from the war.`,!0)}).set(48,t=>{Mt(105),oe.chat[11]&&Nt("fame",`War: Gained $fm${t[0]} spoils of war (Fight ${t[1]>0?"Victory!":"Loss!"}).`,!0)}).set(49,t=>{Mt(105),oe.chat[11]&&Nt("fame",`Obelisk: Captured obelisk for $fm${t[0]} and $m${t[2]}.`,!0),D.player.inventory.setMedals(t[1],t[2],1)}).set(50,t=>{zs.set(),$s.set(!1),t[0]===1&&Nt("system","War: You have left the war due to inactivity.",!0)}).set(23,t=>{let e=D.getEntityById(t[0]);e&&e.interact(t)}).set(24,t=>{qs.set(void 0)}).set(25,t=>{Nt("system",to(t,0),!0)}).set(26,t=>{Nt("error",to(t,0),!0)}).set(52,t=>{let e=to(t,1);xl(S.ui.party.summon,S.ui.party.onSummon.replace("$1",e),[{text:S.ui.accept,nocombat:!0,remaining:20,fun:()=>{xt("summonaccept",e)}},{text:S.ui.decline,fun:()=>{}}])}).set(27,t=>{let e=to(t,1);xl(S.ui.party.invite,S.ui.party.onInvite.replace("$1",e),[{text:S.ui.accept,fun:()=>{xt("partyaccept",t[0]+"")}},{text:S.ui.decline,fun:()=>{xt("partydecline",t[0]+"")}}])}).set(29,t=>{D.player.inventory.setItem(t[0],t[1],t[2])}).set(30,t=>{D.player.inventory.removeItem(t[0],t[1])}).set(31,t=>{D.player.inventory.setGold(t[0],t[1],t[2])}).set(32,t=>{D.player.inventory.setMedals(t[0],t[1],t[2])}).set(33,t=>{qo.set(t[0]),iu(t[0],t[1],12,"$sp")}).set(34,t=>{ap.set(t[0]==0?void 0:t[0]-1)}).set(51,t=>{lp.set(t[0]==0?void 0:t[0]-1)}).set(35,t=>{ls.set(t[0]),t[0]&&Mt(106)}).set(36,t=>{up.set(t.pop()),bP(t,rl)}).set(37,t=>{Sr.update(e=>!e),Nt("inv",S.ui.merchant.auctioncancel,!0)}).set(38,t=>{bP(t.slice(2),pp),t[0]&&Mt(107),Vi.set({gold:t[1]})}).set(39,t=>{Vi.set({gold:t[0]})}).set(40,t=>{Vi.set(!1)}).set(41,t=>{Yi.set(!0),Mt(108),tn(22,100)}).set(42,t=>{Yi.set(!1)}).set(43,t=>{Us.set(!0)}).set(44,t=>{Us.set(!1)}).set(54,t=>{let e=D.entity(t[0]);e!==void 0&&(e.party=1)}).set(55,t=>{window.open("/leaderboards?mode=1&kill="+t[0],"_blank")}).set(56,t=>{ud()}).set(53,t=>{let e=t[0];e<1e3&&e>0&&Cr.set({type:"error",timer:500,text:e}),e<=5&&e>0?Mt(109):e===0?Mt(110):e===1e3?Mt(111):e===2e3&&Mt(112)});var bP=(t,e)=>{e.update(n=>(n.length=0,t.forEach(i=>{n.push(new Xs(i))}),n))},kP=(t,e)=>{D.player&&yP.get(t)(e)},xP=new Map;xP.set(0,(t,e,n)=>{}).set(1,(t,e,n)=>{D.removeEntity(t)}).set(2,(t,e,n)=>{e[1]>0&&e[1]!==t.target&&t.visual&&t.type!==0&&t.visual.onAggro(),t===D.player&&tg(e[1])}).set(3,(t,e,n)=>{for(let i=1;i<e.length;i+=2)t.stats.setResource(e[i],e[i+1])}).set(6,(t,e,n)=>{for(let i=1;i<e.length;i+=2)t.stats.setResource(e[i],e[i+1])}).set(4,(t,e,n)=>{for(let i=1;i<e.length;i+=2)t.stats.setStat(e[i],e[i+1])}).set(5,(t,e,n)=>{if(t==D.player&&(tn(6,100),t.skills.cd(e[1],D.time,_i(e[2])),e[5]>0&&t.skills.globalCd(_i(e[4]),_i(e[5]))),!n&&t.visual&&!t.visual.inFog){let s=Pt.get(e[1]);(!s.castLen||!t.visual.currentAnim)&&s.fx.animCast&&t.visual.anim(s.fx.animCast),t.visual.onYell()}}).set(22,(t,e,n)=>{t.skills.startTimedCast(Pt.get(e[1]),_i(e[2]),e[3],_i(e[4])),e[5]>0&&t.skills.globalCd(_i(e[2]),_i(e[5]))}).set(23,(t,e,n)=>{t.skills.interruptTimedCast(!0,e[1]===1)}).set(24,(t,e,n)=>{t.skills.finishTimedCast(_i(e[1]))}).set(7,(t,e,n)=>{let i=e[1],s=e[2],o=D.getEntityById(e[3]),r=e[4],a=e[5],l=e[6],c=e[7];o!==void 0&&oe.dpsmeterMode===0&&cd(o,i,s);let f=t===D.player,u=o===D.player;f?oe.showIncomingDamage&&m2([-.3,-.3,.5],i,a,l,!0,0):u&&m2(t.visualPosition,i,a,l,!1,2),a>0&&t.stats.changeResource(6,-i),c>0&&(t.stats.refreshCombatTimer(D.time,c),o&&o.stats.refreshCombatTimer(D.time,c));let p=Pt.get(s);if(!n&&a>0&&t.visual&&!t.visual.inFog){let g=r>0&&_r.has(r)?_r.get(r).effect.transform:o&&o.visual&&o.visual.transform,v=t.visual.transform;o&&o.visual&&p.fx.animImpact&&o.visual.anim(p.fx.animImpact,!1,t.id),a!==1?(t.visual.onHurt(i/t.stats.getStat(6),a),g&&C2(p,g,v,t.radius,u?1:0)):g&&(p.fx.effectDirImpact||p.fx.animImpact)&&MP(13,g,v,t.radius,u?1:0)}}).set(8,(t,e,n)=>{let i=D.getEntityById(e[3]);i!==void 0&&oe.dpsmeterMode===1&&cd(i,e[1],e[2]),i&&e[5]>0&&i.stats.refreshCombatTimer(D.time,e[5]);let s=t===D.player,o=i===D.player;s?oe.showIncomingHeal&&d2([.3,-.3,.5],e[1],e[4],!0,0):o&&d2(t.visualPosition,e[1],e[4],!1,2),t.stats.changeResource(6,e[1]);let r=Pt.get(e[2]);!n&&i&&i.visual&&t.visual&&!t.visual.inFog&&C2(r,i.visual.transform,t.visual.transform,t.radius,s||o?1:0)}).set(9,(t,e,n)=>{t.stats.changeResource(7,e[1]);let i=D.getEntityById(e[3]),s=t===D.player;s&&oe.showIncomingHeal&&gA([.35,-.2,.5],e[1],e[4],!0,0);let o=Pt.get(e[2]);!n&&i&&i.visual&&t.visual&&!t.visual.inFog&&!i.visual.inFog&&C2(o,i.visual.transform,t.visual.transform,t.radius,s?1:0)}).set(10,(t,e,n)=>{e[1]==0?t.stats.alive&&(t.stats.die(),t==D.player?xl(S.ui.death.death,S.ui.death.deathmsg,[{text:S.ui.death.respawn,blockedTime:Math.max(0,Math.ceil(e[2]-D.time)+1),fun:()=>{xt("respawn","")}}]):D.player&&t.id==Vn&&tn(7,100)):t.stats.alive||t.stats.respawn()}).set(11,(t,e,n)=>{t.setFaction(e[1])}).set(14,(t,e,n)=>{t.setLevel(e[1])}).set(16,(t,e,n)=>{t.setClass(e[1])}).set(12,(t,e,n)=>{t.setName(to(e,1))}).set(13,(t,e,n)=>{t.setClan(e.length>2?to(e,2):void 0,e[1])}).set(15,(t,e,n)=>{if(t.setLevel(e[1]),oe.chat[6]){let i=`${t==D.player?"You":_B(e[0])} leveled up to ${e[1]}!`;Nt("lvlup",i),t==D.player&&(tn(16,100),Pt.forEach(s=>{s.class===D.player.class&&s.minlevel===e[1]&&(tn(19,100),_P(`<span class=textprimary><b class=textgreen>${S.items.book[s.id].name}</b><br>Skill book available at the Trader!</span>`,`skills/${s.id}.${Gn}`,"border primary"))}))}t.visual&&!t.visual.inFog&&xs(26,t.visual.transform,t==D.player?1:0,!1)}).set(17,(t,e,n)=>{t.buffs.setBuff(e[1],e[2],e[3],_i(e[4]),_i(e[5]),e[6],e[7],e.length>8?e.slice(8):void 0)}).set(19,(t,e,n)=>{e[2]===D.playerId&&hA(t.visualPosition,2,!1)}).set(18,(t,e,n)=>{t.buffs.removeBuff(e[1],e[2])}).set(20,(t,e,n)=>{let i=Pt.get(e[1]),s=new kt(D.time,_i(e[4])-D.time+.2);tS(e[0],e[2],i,e[3],s)}).set(21,(t,e,n)=>{let i=Pt.get(e[1]),s=e[2],o=_i(e[3])-D.time,r=new kt(D.time,o),a=4,l=e.length-a,c=l>6?2+(l-6)/4:2,f=[],u=[];for(let p=a;p<a+c*3;p+=3)f.push([id(e[p],6400),id(e[p+1],6400),id(e[p+2],6400)]);if(c>2)for(let p=a+c*3;p<e.length;++p)u.push(e[p]/65535);nS(t.id,f,u,i,s,r)}).set(25,(t,e,n)=>{t.setParty(e[1],e[2])}).set(26,(t,e,n)=>{t.hasInfo===!1&&t.setDropInfo(e[1],e[2],e[3],e[4],e[5])}).set(27,(t,e,n)=>{t.setNodeInfo(e[1],e[2],e[3])}).set(28,(t,e,n)=>{t.setPosLock(e[1],e[2],e[3])});var wP=(t,e,n)=>{let i=D.getEntityById(e[0]);i===void 0||xP.get(t)(i,e,n)},_B=t=>{let e=D.getEntityById(t);return`${t>0?e?e.name:"unknown":"nobody"}`},MP=(t,e,n,i,s)=>{let o=xs(t,on(),s,!0);wp(o.transform,n,e,i),qt(o.transform,!1)},C2=(t,e,n,i,s)=>{if(t.fx.effectDirImpact&&MP(t.fx.effectDirImpact,e,n,i,s),t.fx.effectImpact){let o=xs(t.fx.effectImpact,on(),s,!0);st(o.transform.position,n.position),qt(o.transform,!1)}t.fx.effectTarget&&xs(t.fx.effectTarget,n,s,!1)};var bB=[qs,ls,Vi,Us,Yi],yB=[tl,rl,so],kB=[Rs,Bs],FP=()=>{kB.forEach(t=>t.update(e=>(e.visible=!1,e))),Qn.update(t=>(t.membercount=0,t.role=0,oe.partyinfo=t,t)),bB.forEach(t=>t.set()),yB.forEach(t=>t.set([]))};var Q0=class extends X0{constructor(){super(),this.smoothtime=0,this.state=0,this.playerId=0,this.removePlayer(),this.netTimeoutTimer=new kt,this.chunkCache=[],Bn("close",()=>{this.onDisconnect()}),this.netData=[],Bn(Ft.serverEntityDelta.header,e=>{this.netData.push(Ft.serverEntityDelta.decode(e))}),Bn(Ft.ping.header,e=>{by(Ft.ping.decode(e))}),Bn(Ft.serverChangeWorld.header,e=>{qr.set(Ft.serverChangeWorld.decode(e).world)}),Bn(Ft.serverQueue.header,e=>{this.setState(1,"Queue Position: "+Ft.serverQueue.decode(e).pos)})}setState(e,n=""){this.state===2&&e===4&&AA(this),this.state=e,xi.set(e!==4?n:!1)}handleEntityCreation(e){for(let n=0,i=e.log.length;n<i;++n){let s=e.log[n];s.type===0&&(this.isEntityIdTaken(s.data[0])||this.addEntity(this.createEntity(s.data[1],s.data[0],{creature:o1.get(s.data[2])})))}}handleEntityInput(e){for(let n=0;n<e.inputs.length;++n){let i=e.inputs[n],s=this.entity(i.id);s!==void 0&&(xy(s.steer,i.steer),s.setRot(i.rot,!0),s.setJump(i.jump),s.setSpeed(i.speed))}}handleEntityMovements(e){for(let n=0;n<e.movements.length;++n){let i=e.movements[n],s=this.entity(i.id);if(s!==void 0){let o=e.inputs[n];s.handleMovementData(i,o)}}}handleEntityLog(e){for(let i=0,s=e.log.length;i<s;++i)wP(e.log[i].type,e.log[i].data,!1)}handlePersonalLog(e){for(let n=0,i=e.logPersonal.length;n<i;++n)kP(e.logPersonal[n].type,e.logPersonal[n].data)}pollNetData(e){let n=this.netData[0];if(n!==void 0)return Math.abs(n.tickId-e)>1&&(e=this.setTimeFromTickId(n.tickId)),n.tickId<=e?(this.netData.shift(),n):void 0}tickDelta(e,n){let i=this.time+n;for(let s=this.entities.array.length-1;s>=0;--s){let o=this.entities.array[s];o.preDelta(e,i,this),o.tickDelta(e,i,this),o.postDelta(e,i,this)}}tickFixed(e,n){let i=this.pollNetData(n);if(i!==void 0&&(this.handleEntityCreation(i),this.handleEntityInput(i),this.handleEntityLog(i),this.handlePersonalLog(i),this.handleEntityMovements(i)),this.state>2)for(let s=this.entities.array.length-1;s>=0;--s){let o=this.entities.array[s],r=this.getChunkFromWorld(o.pos[0],o.pos[2]);r!==void 0&&r.state>=5&&(o.preFixed(e,this.time,this,1),o.tickFixed(e,this.time,this,1),o.postFixed(e,this.time,this,1))}this.handleNetTimeouts()}tick(e){for(this.netData.length>5&&(this.accum+=(this.netData.length-5)*this.timestep),e=Math.min(e,1),this.accum+=e;this.accum>this.timestep;)this.accum-=this.timestep,this.setTimeFromTickId(this.tickId+1),this.tickFixed(this.timestep,this.tickId);this.setSmoothTime(e),this.state>2?(this.tickDelta(e,this.accum),_y()):this.player&&st(Gt.position,this.player.pos),this.player&&this.manageChunks(e)}handleNetTimeouts(){if(this.player&&(this.netTimeoutTimer.done(this.time)||this.time<this.netTimeoutTimer.start)){this.netTimeoutTimer.reset(this.time-.5,1);for(let e=this.entities.array.length-1;e>=0;e--){let n=this.entities.array[e];n!==this.player&&(Kn(n.pos,this.player.pos)<14400?n.netDeletion.reset(this.time,2):n.netDeletion.end>0&&n.netDeletion.done(this.time)&&(this.removeEntity(n),n.id===this.player.target&&this.player.setTarget(0)))}}}removeEntity(e){let n=super.removeEntity(e);return n&&this.state>2&&Yh(e),n}load(e,n,i){this.destroy(),super.load(e,n),this.playerId=i,this.setState(2,"Loading World")}parse(e){super.parse(e),pA(this,!e)}onDisconnect(){hg(),this.netData.length=0,this.setState(0,"Loading World")}destroy(){this.setState(0,"Loading World");for(let e=0;e<this.chunksArray.length;e++){let n=this.chunksArray[e];this.returnCachedChunk(n),u2(n)}this.chunksMap.clear(),this.chunksArray.length=0;for(let e=this.entities.array.length-1;e>=0;e--)this.removeEntity(this.entities.array[e]);this.data=void 0,this.bounds=1,this.triangleGrid.clear(),mA(this),PA(this)}setPlayer(e){this.player=e,qc.set(!0),FP()}removePlayer(e){this.player===e&&(this.player=void 0,this.playerId=0,qc.set(!1),zs.set(),$s.set(!1))}setSmoothTime(e){let n=this.smoothtime-this.time;Math.abs(n)>1?this.smoothtime=this.time:n>.05?this.smoothtime+=e*.5:n<-.05?this.smoothtime+=e*2:this.smoothtime+=e}getInteriorLight(e,n){let i=this.triangleGrid.queryAABB(n);for(let s=0;s<i.length;++s)if(i[s].length>4){Vr(e,i[s][4]);return}ei(e,0,0,0,0)}createChunks(){}createCachedChunk(e,n,i){if(this.chunkCache.length){let s=this.chunkCache.pop();return c2(s,e,n,i,this.chunkAmount),s}else{let s=JS();return c2(s,e,n,i,this.chunkAmount),s}}returnCachedChunk(e){this.chunkCache.push(e)}manageChunks(e){WC(e);let n=Math.min(Math.max(0,Tv),this.chunkAmount-1),i=Math.min(Math.max(0,Ev),this.chunkAmount-1),s=Math.min(Math.max(0,Dv),this.chunkAmount-1),o=Math.min(Math.max(0,Iv),this.chunkAmount-1),r=[];for(let u=n;u<=i;++u)for(let p=s;p<=o;++p){let g=this.chunkAmount*p+u,v=(u-Av)**2+(p-Pv)**2;r.push({x:u,z:p,id:g,priority:v})}r.sort((u,p)=>u.priority-p.priority);let a=0,l=!1,c=0;for(;a<r.length;){let u=r[a];if(c>10)break;if(this.chunksMap.has(u.id))this.chunksMap.get(u.id).state<3&&(u.priority<9&&(l=!0),c++);else{let p=this.createCachedChunk(u.id,u.x,u.z);this.addChunk(p),p.state=1,u.priority<9&&(l=!0),c++}++a}let f=[];for(let u=0;u<this.chunksArray.length;++u){let p=this.chunksArray[u];Lv&&(p.x+5<n||p.z+5<s||p.x-5>i||p.z-5>o?f.push(p):f2(p)),eA(p,this)}for(let u=f.length-1;u>=0;u--){let p=f[u];this.returnCachedChunk(p),this.removeChunk(p),u2(p)}l!==(this.state!==4)&&this.setState(l?3:4,"Loading World")}};window.onload=async()=>{console.log("Hordes 0.50.8582 Live"),await f1();let t=await fetch("data/game/game.bin?v=8582889");Kh(bl.gamedata.decode(new Uint8Array(await t.arrayBuffer()))),l3(),aA(),MA(),new YS({target:document.querySelector("body")}),gy(qA,RA),cy(new Q0({})),k2(!0),SP()};var CP=0,SP=()=>{let t=bf(),e=(t-(CP||1e3/60))/1e3;CP=t,BA(e,t),requestAnimationFrame(SP)};})();
